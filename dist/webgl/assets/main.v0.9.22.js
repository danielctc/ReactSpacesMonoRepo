function Sfe(r,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in r)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(r,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var T_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lS(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var rx={exports:{}},F0={},ix={exports:{}},dr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g9;function Tfe(){if(g9)return dr;g9=1;var r=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),g=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),O=Symbol.iterator;function N(Ee){return Ee===null||typeof Ee!="object"?null:(Ee=O&&Ee[O]||Ee["@@iterator"],typeof Ee=="function"?Ee:null)}var U={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K=Object.assign,z={};function H(Ee,Ye,Et){this.props=Ee,this.context=Ye,this.refs=z,this.updater=Et||U}H.prototype.isReactComponent={},H.prototype.setState=function(Ee,Ye){if(typeof Ee!="object"&&typeof Ee!="function"&&Ee!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ee,Ye,"setState")},H.prototype.forceUpdate=function(Ee){this.updater.enqueueForceUpdate(this,Ee,"forceUpdate")};function ne(){}ne.prototype=H.prototype;function J(Ee,Ye,Et){this.props=Ee,this.context=Ye,this.refs=z,this.updater=Et||U}var se=J.prototype=new ne;se.constructor=J,K(se,H.prototype),se.isPureReactComponent=!0;var le=Array.isArray,ce=Object.prototype.hasOwnProperty,Se={current:null},Z={key:!0,ref:!0,__self:!0,__source:!0};function te(Ee,Ye,Et){var ot,Ve={},et=null,gt=null;if(Ye!=null)for(ot in Ye.ref!==void 0&&(gt=Ye.ref),Ye.key!==void 0&&(et=""+Ye.key),Ye)ce.call(Ye,ot)&&!Z.hasOwnProperty(ot)&&(Ve[ot]=Ye[ot]);var Dt=arguments.length-2;if(Dt===1)Ve.children=Et;else if(1<Dt){for(var Gt=Array(Dt),Bt=0;Bt<Dt;Bt++)Gt[Bt]=arguments[Bt+2];Ve.children=Gt}if(Ee&&Ee.defaultProps)for(ot in Dt=Ee.defaultProps,Dt)Ve[ot]===void 0&&(Ve[ot]=Dt[ot]);return{$$typeof:r,type:Ee,key:et,ref:gt,props:Ve,_owner:Se.current}}function ie(Ee,Ye){return{$$typeof:r,type:Ee.type,key:Ye,ref:Ee.ref,props:Ee.props,_owner:Ee._owner}}function ae(Ee){return typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===r}function ve(Ee){var Ye={"=":"=0",":":"=2"};return"$"+Ee.replace(/[=:]/g,function(Et){return Ye[Et]})}var pe=/\/+/g;function de(Ee,Ye){return typeof Ee=="object"&&Ee!==null&&Ee.key!=null?ve(""+Ee.key):Ye.toString(36)}function ut(Ee,Ye,Et,ot,Ve){var et=typeof Ee;(et==="undefined"||et==="boolean")&&(Ee=null);var gt=!1;if(Ee===null)gt=!0;else switch(et){case"string":case"number":gt=!0;break;case"object":switch(Ee.$$typeof){case r:case t:gt=!0}}if(gt)return gt=Ee,Ve=Ve(gt),Ee=ot===""?"."+de(gt,0):ot,le(Ve)?(Et="",Ee!=null&&(Et=Ee.replace(pe,"$&/")+"/"),ut(Ve,Ye,Et,"",function(Bt){return Bt})):Ve!=null&&(ae(Ve)&&(Ve=ie(Ve,Et+(!Ve.key||gt&&gt.key===Ve.key?"":(""+Ve.key).replace(pe,"$&/")+"/")+Ee)),Ye.push(Ve)),1;if(gt=0,ot=ot===""?".":ot+":",le(Ee))for(var Dt=0;Dt<Ee.length;Dt++){et=Ee[Dt];var Gt=ot+de(et,Dt);gt+=ut(et,Ye,Et,Gt,Ve)}else if(Gt=N(Ee),typeof Gt=="function")for(Ee=Gt.call(Ee),Dt=0;!(et=Ee.next()).done;)et=et.value,Gt=ot+de(et,Dt++),gt+=ut(et,Ye,Et,Gt,Ve);else if(et==="object")throw Ye=String(Ee),Error("Objects are not valid as a React child (found: "+(Ye==="[object Object]"?"object with keys {"+Object.keys(Ee).join(", ")+"}":Ye)+"). If you meant to render a collection of children, use an array instead.");return gt}function mt(Ee,Ye,Et){if(Ee==null)return Ee;var ot=[],Ve=0;return ut(Ee,ot,"","",function(et){return Ye.call(Et,et,Ve++)}),ot}function Ze(Ee){if(Ee._status===-1){var Ye=Ee._result;Ye=Ye(),Ye.then(function(Et){(Ee._status===0||Ee._status===-1)&&(Ee._status=1,Ee._result=Et)},function(Et){(Ee._status===0||Ee._status===-1)&&(Ee._status=2,Ee._result=Et)}),Ee._status===-1&&(Ee._status=0,Ee._result=Ye)}if(Ee._status===1)return Ee._result.default;throw Ee._result}var Be={current:null},Ke={transition:null},nt={ReactCurrentDispatcher:Be,ReactCurrentBatchConfig:Ke,ReactCurrentOwner:Se};return dr.Children={map:mt,forEach:function(Ee,Ye,Et){mt(Ee,function(){Ye.apply(this,arguments)},Et)},count:function(Ee){var Ye=0;return mt(Ee,function(){Ye++}),Ye},toArray:function(Ee){return mt(Ee,function(Ye){return Ye})||[]},only:function(Ee){if(!ae(Ee))throw Error("React.Children.only expected to receive a single React element child.");return Ee}},dr.Component=H,dr.Fragment=s,dr.Profiler=l,dr.PureComponent=J,dr.StrictMode=a,dr.Suspense=S,dr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nt,dr.cloneElement=function(Ee,Ye,Et){if(Ee==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ee+".");var ot=K({},Ee.props),Ve=Ee.key,et=Ee.ref,gt=Ee._owner;if(Ye!=null){if(Ye.ref!==void 0&&(et=Ye.ref,gt=Se.current),Ye.key!==void 0&&(Ve=""+Ye.key),Ee.type&&Ee.type.defaultProps)var Dt=Ee.type.defaultProps;for(Gt in Ye)ce.call(Ye,Gt)&&!Z.hasOwnProperty(Gt)&&(ot[Gt]=Ye[Gt]===void 0&&Dt!==void 0?Dt[Gt]:Ye[Gt])}var Gt=arguments.length-2;if(Gt===1)ot.children=Et;else if(1<Gt){Dt=Array(Gt);for(var Bt=0;Bt<Gt;Bt++)Dt[Bt]=arguments[Bt+2];ot.children=Dt}return{$$typeof:r,type:Ee.type,key:Ve,ref:et,props:ot,_owner:gt}},dr.createContext=function(Ee){return Ee={$$typeof:g,_currentValue:Ee,_currentValue2:Ee,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ee.Provider={$$typeof:d,_context:Ee},Ee.Consumer=Ee},dr.createElement=te,dr.createFactory=function(Ee){var Ye=te.bind(null,Ee);return Ye.type=Ee,Ye},dr.createRef=function(){return{current:null}},dr.forwardRef=function(Ee){return{$$typeof:E,render:Ee}},dr.isValidElement=ae,dr.lazy=function(Ee){return{$$typeof:R,_payload:{_status:-1,_result:Ee},_init:Ze}},dr.memo=function(Ee,Ye){return{$$typeof:b,type:Ee,compare:Ye===void 0?null:Ye}},dr.startTransition=function(Ee){var Ye=Ke.transition;Ke.transition={};try{Ee()}finally{Ke.transition=Ye}},dr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},dr.useCallback=function(Ee,Ye){return Be.current.useCallback(Ee,Ye)},dr.useContext=function(Ee){return Be.current.useContext(Ee)},dr.useDebugValue=function(){},dr.useDeferredValue=function(Ee){return Be.current.useDeferredValue(Ee)},dr.useEffect=function(Ee,Ye){return Be.current.useEffect(Ee,Ye)},dr.useId=function(){return Be.current.useId()},dr.useImperativeHandle=function(Ee,Ye,Et){return Be.current.useImperativeHandle(Ee,Ye,Et)},dr.useInsertionEffect=function(Ee,Ye){return Be.current.useInsertionEffect(Ee,Ye)},dr.useLayoutEffect=function(Ee,Ye){return Be.current.useLayoutEffect(Ee,Ye)},dr.useMemo=function(Ee,Ye){return Be.current.useMemo(Ee,Ye)},dr.useReducer=function(Ee,Ye,Et){return Be.current.useReducer(Ee,Ye,Et)},dr.useRef=function(Ee){return Be.current.useRef(Ee)},dr.useState=function(Ee){return Be.current.useState(Ee)},dr.useSyncExternalStore=function(Ee,Ye,Et){return Be.current.useSyncExternalStore(Ee,Ye,Et)},dr.useTransition=function(){return Be.current.useTransition()},dr.version="18.2.0",dr}var _9;function Ql(){return _9||(_9=1,ix.exports=Tfe()),ix.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v9;function bfe(){if(v9)return F0;v9=1;var r=Ql(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function g(E,S,b){var R,O={},N=null,U=null;b!==void 0&&(N=""+b),S.key!==void 0&&(N=""+S.key),S.ref!==void 0&&(U=S.ref);for(R in S)a.call(S,R)&&!d.hasOwnProperty(R)&&(O[R]=S[R]);if(E&&E.defaultProps)for(R in S=E.defaultProps,S)O[R]===void 0&&(O[R]=S[R]);return{$$typeof:t,type:E,key:N,ref:U,props:O,_owner:l.current}}return F0.Fragment=s,F0.jsx=g,F0.jsxs=g,F0}var E9;function wfe(){return E9||(E9=1,rx.exports=bfe()),rx.exports}var F=wfe(),B=Ql();const Bi=lS(B),y9=Sfe({__proto__:null,default:Bi},[B]);var BA={},sx={exports:{}},Tc={},ox={exports:{}},ax={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S9;function Rfe(){return S9||(S9=1,function(r){function t(Ke,nt){var Ee=Ke.length;Ke.push(nt);e:for(;0<Ee;){var Ye=Ee-1>>>1,Et=Ke[Ye];if(0<l(Et,nt))Ke[Ye]=nt,Ke[Ee]=Et,Ee=Ye;else break e}}function s(Ke){return Ke.length===0?null:Ke[0]}function a(Ke){if(Ke.length===0)return null;var nt=Ke[0],Ee=Ke.pop();if(Ee!==nt){Ke[0]=Ee;e:for(var Ye=0,Et=Ke.length,ot=Et>>>1;Ye<ot;){var Ve=2*(Ye+1)-1,et=Ke[Ve],gt=Ve+1,Dt=Ke[gt];if(0>l(et,Ee))gt<Et&&0>l(Dt,et)?(Ke[Ye]=Dt,Ke[gt]=Ee,Ye=gt):(Ke[Ye]=et,Ke[Ve]=Ee,Ye=Ve);else if(gt<Et&&0>l(Dt,Ee))Ke[Ye]=Dt,Ke[gt]=Ee,Ye=gt;else break e}}return nt}function l(Ke,nt){var Ee=Ke.sortIndex-nt.sortIndex;return Ee!==0?Ee:Ke.id-nt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;r.unstable_now=function(){return d.now()}}else{var g=Date,E=g.now();r.unstable_now=function(){return g.now()-E}}var S=[],b=[],R=1,O=null,N=3,U=!1,K=!1,z=!1,H=typeof setTimeout=="function"?setTimeout:null,ne=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function se(Ke){for(var nt=s(b);nt!==null;){if(nt.callback===null)a(b);else if(nt.startTime<=Ke)a(b),nt.sortIndex=nt.expirationTime,t(S,nt);else break;nt=s(b)}}function le(Ke){if(z=!1,se(Ke),!K)if(s(S)!==null)K=!0,Ze(ce);else{var nt=s(b);nt!==null&&Be(le,nt.startTime-Ke)}}function ce(Ke,nt){K=!1,z&&(z=!1,ne(te),te=-1),U=!0;var Ee=N;try{for(se(nt),O=s(S);O!==null&&(!(O.expirationTime>nt)||Ke&&!ve());){var Ye=O.callback;if(typeof Ye=="function"){O.callback=null,N=O.priorityLevel;var Et=Ye(O.expirationTime<=nt);nt=r.unstable_now(),typeof Et=="function"?O.callback=Et:O===s(S)&&a(S),se(nt)}else a(S);O=s(S)}if(O!==null)var ot=!0;else{var Ve=s(b);Ve!==null&&Be(le,Ve.startTime-nt),ot=!1}return ot}finally{O=null,N=Ee,U=!1}}var Se=!1,Z=null,te=-1,ie=5,ae=-1;function ve(){return!(r.unstable_now()-ae<ie)}function pe(){if(Z!==null){var Ke=r.unstable_now();ae=Ke;var nt=!0;try{nt=Z(!0,Ke)}finally{nt?de():(Se=!1,Z=null)}}else Se=!1}var de;if(typeof J=="function")de=function(){J(pe)};else if(typeof MessageChannel<"u"){var ut=new MessageChannel,mt=ut.port2;ut.port1.onmessage=pe,de=function(){mt.postMessage(null)}}else de=function(){H(pe,0)};function Ze(Ke){Z=Ke,Se||(Se=!0,de())}function Be(Ke,nt){te=H(function(){Ke(r.unstable_now())},nt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ke){Ke.callback=null},r.unstable_continueExecution=function(){K||U||(K=!0,Ze(ce))},r.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ie=0<Ke?Math.floor(1e3/Ke):5},r.unstable_getCurrentPriorityLevel=function(){return N},r.unstable_getFirstCallbackNode=function(){return s(S)},r.unstable_next=function(Ke){switch(N){case 1:case 2:case 3:var nt=3;break;default:nt=N}var Ee=N;N=nt;try{return Ke()}finally{N=Ee}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Ke,nt){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var Ee=N;N=Ke;try{return nt()}finally{N=Ee}},r.unstable_scheduleCallback=function(Ke,nt,Ee){var Ye=r.unstable_now();switch(typeof Ee=="object"&&Ee!==null?(Ee=Ee.delay,Ee=typeof Ee=="number"&&0<Ee?Ye+Ee:Ye):Ee=Ye,Ke){case 1:var Et=-1;break;case 2:Et=250;break;case 5:Et=1073741823;break;case 4:Et=1e4;break;default:Et=5e3}return Et=Ee+Et,Ke={id:R++,callback:nt,priorityLevel:Ke,startTime:Ee,expirationTime:Et,sortIndex:-1},Ee>Ye?(Ke.sortIndex=Ee,t(b,Ke),s(S)===null&&Ke===s(b)&&(z?(ne(te),te=-1):z=!0,Be(le,Ee-Ye))):(Ke.sortIndex=Et,t(S,Ke),K||U||(K=!0,Ze(ce))),Ke},r.unstable_shouldYield=ve,r.unstable_wrapCallback=function(Ke){var nt=N;return function(){var Ee=N;N=nt;try{return Ke.apply(this,arguments)}finally{N=Ee}}}}(ax)),ax}var T9;function Cfe(){return T9||(T9=1,ox.exports=Rfe()),ox.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b9;function Ife(){if(b9)return Tc;b9=1;var r=Ql(),t=Cfe();function s(p){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+p,T=1;T<arguments.length;T++)m+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,m){g(p,m),g(p+"Capture",m)}function g(p,m){for(l[p]=m,p=0;p<m.length;p++)a.add(m[p])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),S=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,R={},O={};function N(p){return S.call(O,p)?!0:S.call(R,p)?!1:b.test(p)?O[p]=!0:(R[p]=!0,!1)}function U(p,m,T,A){if(T!==null&&T.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return A?!1:T!==null?!T.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function K(p,m,T,A){if(m===null||typeof m>"u"||U(p,m,T,A))return!0;if(A)return!1;if(T!==null)switch(T.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function z(p,m,T,A,L,W,re){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=A,this.attributeNamespace=L,this.mustUseProperty=T,this.propertyName=p,this.type=m,this.sanitizeURL=W,this.removeEmptyString=re}var H={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){H[p]=new z(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var m=p[0];H[m]=new z(m,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){H[p]=new z(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){H[p]=new z(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){H[p]=new z(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){H[p]=new z(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){H[p]=new z(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){H[p]=new z(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){H[p]=new z(p,5,!1,p.toLowerCase(),null,!1,!1)});var ne=/[\-:]([a-z])/g;function J(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var m=p.replace(ne,J);H[m]=new z(m,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var m=p.replace(ne,J);H[m]=new z(m,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var m=p.replace(ne,J);H[m]=new z(m,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){H[p]=new z(p,1,!1,p.toLowerCase(),null,!1,!1)}),H.xlinkHref=new z("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){H[p]=new z(p,1,!1,p.toLowerCase(),null,!0,!0)});function se(p,m,T,A){var L=H.hasOwnProperty(m)?H[m]:null;(L!==null?L.type!==0:A||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(K(m,T,L,A)&&(T=null),A||L===null?N(m)&&(T===null?p.removeAttribute(m):p.setAttribute(m,""+T)):L.mustUseProperty?p[L.propertyName]=T===null?L.type===3?!1:"":T:(m=L.attributeName,A=L.attributeNamespace,T===null?p.removeAttribute(m):(L=L.type,T=L===3||L===4&&T===!0?"":""+T,A?p.setAttributeNS(A,m,T):p.setAttribute(m,T))))}var le=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ce=Symbol.for("react.element"),Se=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),te=Symbol.for("react.strict_mode"),ie=Symbol.for("react.profiler"),ae=Symbol.for("react.provider"),ve=Symbol.for("react.context"),pe=Symbol.for("react.forward_ref"),de=Symbol.for("react.suspense"),ut=Symbol.for("react.suspense_list"),mt=Symbol.for("react.memo"),Ze=Symbol.for("react.lazy"),Be=Symbol.for("react.offscreen"),Ke=Symbol.iterator;function nt(p){return p===null||typeof p!="object"?null:(p=Ke&&p[Ke]||p["@@iterator"],typeof p=="function"?p:null)}var Ee=Object.assign,Ye;function Et(p){if(Ye===void 0)try{throw Error()}catch(T){var m=T.stack.trim().match(/\n( *(at )?)/);Ye=m&&m[1]||""}return`
`+Ye+p}var ot=!1;function Ve(p,m){if(!p||ot)return"";ot=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(ze){var A=ze}Reflect.construct(p,[],m)}else{try{m.call()}catch(ze){A=ze}p.call(m.prototype)}else{try{throw Error()}catch(ze){A=ze}p()}}catch(ze){if(ze&&A&&typeof ze.stack=="string"){for(var L=ze.stack.split(`
`),W=A.stack.split(`
`),re=L.length-1,ye=W.length-1;1<=re&&0<=ye&&L[re]!==W[ye];)ye--;for(;1<=re&&0<=ye;re--,ye--)if(L[re]!==W[ye]){if(re!==1||ye!==1)do if(re--,ye--,0>ye||L[re]!==W[ye]){var Ae=`
`+L[re].replace(" at new "," at ");return p.displayName&&Ae.includes("<anonymous>")&&(Ae=Ae.replace("<anonymous>",p.displayName)),Ae}while(1<=re&&0<=ye);break}}}finally{ot=!1,Error.prepareStackTrace=T}return(p=p?p.displayName||p.name:"")?Et(p):""}function et(p){switch(p.tag){case 5:return Et(p.type);case 16:return Et("Lazy");case 13:return Et("Suspense");case 19:return Et("SuspenseList");case 0:case 2:case 15:return p=Ve(p.type,!1),p;case 11:return p=Ve(p.type.render,!1),p;case 1:return p=Ve(p.type,!0),p;default:return""}}function gt(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Z:return"Fragment";case Se:return"Portal";case ie:return"Profiler";case te:return"StrictMode";case de:return"Suspense";case ut:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case ve:return(p.displayName||"Context")+".Consumer";case ae:return(p._context.displayName||"Context")+".Provider";case pe:var m=p.render;return p=p.displayName,p||(p=m.displayName||m.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case mt:return m=p.displayName||null,m!==null?m:gt(p.type)||"Memo";case Ze:m=p._payload,p=p._init;try{return gt(p(m))}catch{}}return null}function Dt(p){var m=p.type;switch(p.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=m.render,p=p.displayName||p.name||"",m.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gt(m);case 8:return m===te?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function Gt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Bt(p){var m=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function Vn(p){var m=Bt(p)?"checked":"value",T=Object.getOwnPropertyDescriptor(p.constructor.prototype,m),A=""+p[m];if(!p.hasOwnProperty(m)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var L=T.get,W=T.set;return Object.defineProperty(p,m,{configurable:!0,get:function(){return L.call(this)},set:function(re){A=""+re,W.call(this,re)}}),Object.defineProperty(p,m,{enumerable:T.enumerable}),{getValue:function(){return A},setValue:function(re){A=""+re},stopTracking:function(){p._valueTracker=null,delete p[m]}}}}function Dn(p){p._valueTracker||(p._valueTracker=Vn(p))}function un(p){if(!p)return!1;var m=p._valueTracker;if(!m)return!0;var T=m.getValue(),A="";return p&&(A=Bt(p)?p.checked?"true":"false":p.value),p=A,p!==T?(m.setValue(p),!0):!1}function gr(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Ar(p,m){var T=m.checked;return Ee({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??p._wrapperState.initialChecked})}function bt(p,m){var T=m.defaultValue==null?"":m.defaultValue,A=m.checked!=null?m.checked:m.defaultChecked;T=Gt(m.value!=null?m.value:T),p._wrapperState={initialChecked:A,initialValue:T,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Sn(p,m){m=m.checked,m!=null&&se(p,"checked",m,!1)}function Tn(p,m){Sn(p,m);var T=Gt(m.value),A=m.type;if(T!=null)A==="number"?(T===0&&p.value===""||p.value!=T)&&(p.value=""+T):p.value!==""+T&&(p.value=""+T);else if(A==="submit"||A==="reset"){p.removeAttribute("value");return}m.hasOwnProperty("value")?De(p,m.type,T):m.hasOwnProperty("defaultValue")&&De(p,m.type,Gt(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(p.defaultChecked=!!m.defaultChecked)}function we(p,m,T){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var A=m.type;if(!(A!=="submit"&&A!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+p._wrapperState.initialValue,T||m===p.value||(p.value=m),p.defaultValue=m}T=p.name,T!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,T!==""&&(p.name=T)}function De(p,m,T){(m!=="number"||gr(p.ownerDocument)!==p)&&(T==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+T&&(p.defaultValue=""+T))}var We=Array.isArray;function pt(p,m,T,A){if(p=p.options,m){m={};for(var L=0;L<T.length;L++)m["$"+T[L]]=!0;for(T=0;T<p.length;T++)L=m.hasOwnProperty("$"+p[T].value),p[T].selected!==L&&(p[T].selected=L),L&&A&&(p[T].defaultSelected=!0)}else{for(T=""+Gt(T),m=null,L=0;L<p.length;L++){if(p[L].value===T){p[L].selected=!0,A&&(p[L].defaultSelected=!0);return}m!==null||p[L].disabled||(m=p[L])}m!==null&&(m.selected=!0)}}function ft(p,m){if(m.dangerouslySetInnerHTML!=null)throw Error(s(91));return Ee({},m,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function dt(p,m){var T=m.value;if(T==null){if(T=m.children,m=m.defaultValue,T!=null){if(m!=null)throw Error(s(92));if(We(T)){if(1<T.length)throw Error(s(93));T=T[0]}m=T}m==null&&(m=""),T=m}p._wrapperState={initialValue:Gt(T)}}function Mt(p,m){var T=Gt(m.value),A=Gt(m.defaultValue);T!=null&&(T=""+T,T!==p.value&&(p.value=T),m.defaultValue==null&&p.defaultValue!==T&&(p.defaultValue=T)),A!=null&&(p.defaultValue=""+A)}function Fn(p){var m=p.textContent;m===p._wrapperState.initialValue&&m!==""&&m!==null&&(p.value=m)}function Cn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tn(p,m){return p==null||p==="http://www.w3.org/1999/xhtml"?Cn(m):p==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var _r,ya=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,T,A,L){MSApp.execUnsafeLocalFunction(function(){return p(m,T,A,L)})}:p}(function(p,m){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=m;else{for(_r=_r||document.createElement("div"),_r.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=_r.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;m.firstChild;)p.appendChild(m.firstChild)}});function ps(p,m){if(m){var T=p.firstChild;if(T&&T===p.lastChild&&T.nodeType===3){T.nodeValue=m;return}}p.textContent=m}var Qs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lt=["Webkit","ms","Moz","O"];Object.keys(Qs).forEach(function(p){Lt.forEach(function(m){m=m+p.charAt(0).toUpperCase()+p.substring(1),Qs[m]=Qs[p]})});function dn(p,m,T){return m==null||typeof m=="boolean"||m===""?"":T||typeof m!="number"||m===0||Qs.hasOwnProperty(p)&&Qs[p]?(""+m).trim():m+"px"}function Zs(p,m){p=p.style;for(var T in m)if(m.hasOwnProperty(T)){var A=T.indexOf("--")===0,L=dn(T,m[T],A);T==="float"&&(T="cssFloat"),A?p.setProperty(T,L):p[T]=L}}var sr=Ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zi(p,m){if(m){if(sr[p]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(s(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(s(61))}if(m.style!=null&&typeof m.style!="object")throw Error(s(62))}}function Nc(p,m){if(p.indexOf("-")===-1)return typeof m.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ga=null;function fo(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var za=null,xi=null,Cs=null;function Ko(p){if(p=cf(p)){if(typeof za!="function")throw Error(s(280));var m=p.stateNode;m&&(m=lf(m),za(p.stateNode,p.type,m))}}function Ha(p){xi?Cs?Cs.push(p):Cs=[p]:xi=p}function kc(){if(xi){var p=xi,m=Cs;if(Cs=xi=null,Ko(p),m)for(p=0;p<m.length;p++)Ko(m[p])}}function nu(p,m){return p(m)}function Ka(){}var Dc=!1;function mo(p,m,T){if(Dc)return p(m,T);Dc=!0;try{return nu(p,m,T)}finally{Dc=!1,(xi!==null||Cs!==null)&&(Ka(),kc())}}function wi(p,m){var T=p.stateNode;if(T===null)return null;var A=lf(T);if(A===null)return null;T=A[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(p=p.type,A=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!A;break e;default:p=!1}if(p)return null;if(T&&typeof T!="function")throw Error(s(231,m,typeof T));return T}var ts=!1;if(E)try{var Sa={};Object.defineProperty(Sa,"passive",{get:function(){ts=!0}}),window.addEventListener("test",Sa,Sa),window.removeEventListener("test",Sa,Sa)}catch{ts=!1}function ru(p,m,T,A,L,W,re,ye,Ae){var ze=Array.prototype.slice.call(arguments,3);try{m.apply(T,ze)}catch(vt){this.onError(vt)}}var $a=!1,$o=null,qo=!1,Zu=null,Mm={onError:function(p){$a=!0,$o=p}};function iu(p,m,T,A,L,W,re,ye,Ae){$a=!1,$o=null,ru.apply(Mm,arguments)}function vh(p,m,T,A,L,W,re,ye,Ae){if(iu.apply(this,arguments),$a){if($a){var ze=$o;$a=!1,$o=null}else throw Error(s(198));qo||(qo=!0,Zu=ze)}}function Is(p){var m=p,T=p;if(p.alternate)for(;m.return;)m=m.return;else{p=m;do m=p,(m.flags&4098)!==0&&(T=m.return),p=m.return;while(p)}return m.tag===3?T:null}function su(p){if(p.tag===13){var m=p.memoizedState;if(m===null&&(p=p.alternate,p!==null&&(m=p.memoizedState)),m!==null)return m.dehydrated}return null}function Yo(p){if(Is(p)!==p)throw Error(s(188))}function ed(p){var m=p.alternate;if(!m){if(m=Is(p),m===null)throw Error(s(188));return m!==p?null:p}for(var T=p,A=m;;){var L=T.return;if(L===null)break;var W=L.alternate;if(W===null){if(A=L.return,A!==null){T=A;continue}break}if(L.child===W.child){for(W=L.child;W;){if(W===T)return Yo(L),p;if(W===A)return Yo(L),m;W=W.sibling}throw Error(s(188))}if(T.return!==A.return)T=L,A=W;else{for(var re=!1,ye=L.child;ye;){if(ye===T){re=!0,T=L,A=W;break}if(ye===A){re=!0,A=L,T=W;break}ye=ye.sibling}if(!re){for(ye=W.child;ye;){if(ye===T){re=!0,T=W,A=L;break}if(ye===A){re=!0,A=W,T=L;break}ye=ye.sibling}if(!re)throw Error(s(189))}}if(T.alternate!==A)throw Error(s(190))}if(T.tag!==3)throw Error(s(188));return T.stateNode.current===T?p:m}function td(p){return p=ed(p),p!==null?Ta(p):null}function Ta(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var m=Ta(p);if(m!==null)return m;p=p.sibling}return null}var nd=t.unstable_scheduleCallback,ou=t.unstable_cancelCallback,go=t.unstable_shouldYield,rd=t.unstable_requestPaint,Mr=t.unstable_now,li=t.unstable_getCurrentPriorityLevel,qa=t.unstable_ImmediatePriority,Lc=t.unstable_UserBlockingPriority,Xo=t.unstable_NormalPriority,Eh=t.unstable_LowPriority,id=t.unstable_IdlePriority,hl=null,eo=null;function Kp(p){if(eo&&typeof eo.onCommitFiberRoot=="function")try{eo.onCommitFiberRoot(hl,p,void 0,(p.current.flags&128)===128)}catch{}}var Us=Math.clz32?Math.clz32:sd,yh=Math.log,xc=Math.LN2;function sd(p){return p>>>=0,p===0?32:31-(yh(p)/xc|0)|0}var od=64,or=4194304;function pl(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function fl(p,m){var T=p.pendingLanes;if(T===0)return 0;var A=0,L=p.suspendedLanes,W=p.pingedLanes,re=T&268435455;if(re!==0){var ye=re&~L;ye!==0?A=pl(ye):(W&=re,W!==0&&(A=pl(W)))}else re=T&~L,re!==0?A=pl(re):W!==0&&(A=pl(W));if(A===0)return 0;if(m!==0&&m!==A&&(m&L)===0&&(L=A&-A,W=m&-m,L>=W||L===16&&(W&4194240)!==0))return m;if((A&4)!==0&&(A|=T&16),m=p.entangledLanes,m!==0)for(p=p.entanglements,m&=A;0<m;)T=31-Us(m),L=1<<T,A|=p[T],m&=~L;return A}function au(p,m){switch(p){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ba(p,m){for(var T=p.suspendedLanes,A=p.pingedLanes,L=p.expirationTimes,W=p.pendingLanes;0<W;){var re=31-Us(W),ye=1<<re,Ae=L[re];Ae===-1?((ye&T)===0||(ye&A)!==0)&&(L[re]=au(ye,m)):Ae<=m&&(p.expiredLanes|=ye),W&=~ye}}function _o(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function cu(){var p=od;return od<<=1,(od&4194240)===0&&(od=64),p}function Mc(p){for(var m=[],T=0;31>T;T++)m.push(p);return m}function ml(p,m,T){p.pendingLanes|=m,m!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,m=31-Us(m),p[m]=T}function Br(p,m){var T=p.pendingLanes&~m;p.pendingLanes=m,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=m,p.mutableReadLanes&=m,p.entangledLanes&=m,m=p.entanglements;var A=p.eventTimes;for(p=p.expirationTimes;0<T;){var L=31-Us(T),W=1<<L;m[L]=0,A[L]=-1,p[L]=-1,T&=~W}}function wa(p,m){var T=p.entangledLanes|=m;for(p=p.entanglements;T;){var A=31-Us(T),L=1<<A;L&m|p[A]&m&&(p[A]|=m),T&=~L}}var Xn=0;function Ya(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var $p,gl,ad,Sh,qp,Th=!1,vo=[],Hi=null,Eo=null,yo=null,_l=new Map,So=new Map,To=[],Yp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xa(p,m){switch(p){case"focusin":case"focusout":Hi=null;break;case"dragenter":case"dragleave":Eo=null;break;case"mouseover":case"mouseout":yo=null;break;case"pointerover":case"pointerout":_l.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":So.delete(m.pointerId)}}function ns(p,m,T,A,L,W){return p===null||p.nativeEvent!==W?(p={blockedOn:m,domEventName:T,eventSystemFlags:A,nativeEvent:W,targetContainers:[L]},m!==null&&(m=cf(m),m!==null&&gl(m)),p):(p.eventSystemFlags|=A,m=p.targetContainers,L!==null&&m.indexOf(L)===-1&&m.push(L),p)}function lu(p,m,T,A,L){switch(m){case"focusin":return Hi=ns(Hi,p,m,T,A,L),!0;case"dragenter":return Eo=ns(Eo,p,m,T,A,L),!0;case"mouseover":return yo=ns(yo,p,m,T,A,L),!0;case"pointerover":var W=L.pointerId;return _l.set(W,ns(_l.get(W)||null,p,m,T,A,L)),!0;case"gotpointercapture":return W=L.pointerId,So.set(W,ns(So.get(W)||null,p,m,T,A,L)),!0}return!1}function bh(p){var m=Nh(p.target);if(m!==null){var T=Is(m);if(T!==null){if(m=T.tag,m===13){if(m=su(T),m!==null){p.blockedOn=m,qp(p.priority,function(){ad(T)});return}}else if(m===3&&T.stateNode.current.memoizedState.isDehydrated){p.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Uc(p){if(p.blockedOn!==null)return!1;for(var m=p.targetContainers;0<m.length;){var T=hr(p.domEventName,p.eventSystemFlags,m[0],p.nativeEvent);if(T===null){T=p.nativeEvent;var A=new T.constructor(T.type,T);Ga=A,T.target.dispatchEvent(A),Ga=null}else return m=cf(T),m!==null&&gl(m),p.blockedOn=T,!1;m.shift()}return!0}function vl(p,m,T){Uc(p)&&T.delete(m)}function Xp(){Th=!1,Hi!==null&&Uc(Hi)&&(Hi=null),Eo!==null&&Uc(Eo)&&(Eo=null),yo!==null&&Uc(yo)&&(yo=null),_l.forEach(vl),So.forEach(vl)}function Jo(p,m){p.blockedOn===m&&(p.blockedOn=null,Th||(Th=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Xp)))}function Qo(p){function m(L){return Jo(L,p)}if(0<vo.length){Jo(vo[0],p);for(var T=1;T<vo.length;T++){var A=vo[T];A.blockedOn===p&&(A.blockedOn=null)}}for(Hi!==null&&Jo(Hi,p),Eo!==null&&Jo(Eo,p),yo!==null&&Jo(yo,p),_l.forEach(m),So.forEach(m),T=0;T<To.length;T++)A=To[T],A.blockedOn===p&&(A.blockedOn=null);for(;0<To.length&&(T=To[0],T.blockedOn===null);)bh(T),T.blockedOn===null&&To.shift()}var Vc=le.ReactCurrentBatchConfig,_e=!0;function Ce(p,m,T,A){var L=Xn,W=Vc.transition;Vc.transition=null;try{Xn=1,jt(p,m,T,A)}finally{Xn=L,Vc.transition=W}}function Ge(p,m,T,A){var L=Xn,W=Vc.transition;Vc.transition=null;try{Xn=4,jt(p,m,T,A)}finally{Xn=L,Vc.transition=W}}function jt(p,m,T,A){if(_e){var L=hr(p,m,T,A);if(L===null)uv(p,m,A,Bn,T),Xa(p,A);else if(lu(L,p,m,T,A))A.stopPropagation();else if(Xa(p,A),m&4&&-1<Yp.indexOf(p)){for(;L!==null;){var W=cf(L);if(W!==null&&$p(W),W=hr(p,m,T,A),W===null&&uv(p,m,A,Bn,T),W===L)break;L=W}L!==null&&A.stopPropagation()}else uv(p,m,A,null,T)}}var Bn=null;function hr(p,m,T,A){if(Bn=null,p=fo(A),p=Nh(p),p!==null)if(m=Is(p),m===null)p=null;else if(T=m.tag,T===13){if(p=su(m),p!==null)return p;p=null}else if(T===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;p=null}else m!==p&&(p=null);return Bn=p,null}function Ur(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(li()){case qa:return 1;case Lc:return 4;case Xo:case Eh:return 16;case id:return 536870912;default:return 16}default:return 16}}var Xt=null,Or=null,ui=null;function fs(){if(ui)return ui;var p,m=Or,T=m.length,A,L="value"in Xt?Xt.value:Xt.textContent,W=L.length;for(p=0;p<T&&m[p]===L[p];p++);var re=T-p;for(A=1;A<=re&&m[T-A]===L[W-A];A++);return ui=L.slice(p,1<A?1-A:void 0)}function bo(p){var m=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&m===13&&(p=13)):p=m,p===10&&(p=13),32<=p||p===13?p:0}function wo(){return!0}function uu(){return!1}function Mi(p){function m(T,A,L,W,re){this._reactName=T,this._targetInst=L,this.type=A,this.nativeEvent=W,this.target=re,this.currentTarget=null;for(var ye in p)p.hasOwnProperty(ye)&&(T=p[ye],this[ye]=T?T(W):W[ye]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?wo:uu,this.isPropagationStopped=uu,this}return Ee(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=wo)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=wo)},persist:function(){},isPersistent:wo}),m}var Fc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cd=Mi(Fc),Ja=Ee({},Fc,{view:0,detail:0}),Um=Mi(Ja),Jp,du,Ro,El=Ee({},Ja,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qa,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Ro&&(Ro&&p.type==="mousemove"?(Jp=p.screenX-Ro.screenX,du=p.screenY-Ro.screenY):du=Jp=0,Ro=p),Jp)},movementY:function(p){return"movementY"in p?p.movementY:du}}),Qp=Mi(El),Vm=Ee({},El,{dataTransfer:0}),nv=Mi(Vm),Zp=Ee({},Ja,{relatedTarget:0}),ef=Mi(Zp),hu=Ee({},Fc,{animationName:0,elapsedTime:0,pseudoElement:0}),pu=Mi(hu),fu=Ee({},Fc,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Fm=Mi(fu),rv=Ee({},Fc,{data:0}),In=Mi(rv),tf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Co={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sv(p){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(p):(p=iv[p])?!!m[p]:!1}function Qa(){return sv}var C=Ee({},Ja,{key:function(p){if(p.key){var m=tf[p.key]||p.key;if(m!=="Unidentified")return m}return p.type==="keypress"?(p=bo(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Co[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qa,charCode:function(p){return p.type==="keypress"?bo(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?bo(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),V=Mi(C),X=Ee({},El,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),he=Mi(X),xe=Ee({},Ja,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qa}),qe=Mi(xe),At=Ee({},Fc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wr=Mi(At),ei=Ee({},El,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),pr=Mi(ei),As=[9,13,27,32],rs=E&&"CompositionEvent"in window,Ra=null;E&&"documentMode"in document&&(Ra=document.documentMode);var Io=E&&"TextEvent"in window&&!Ra,wh=E&&(!rs||Ra&&8<Ra&&11>=Ra),nf=" ",Ca=!1;function Xw(p,m){switch(p){case"keyup":return As.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jw(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var rf=!1;function PN(p,m){switch(p){case"compositionend":return Jw(m);case"keypress":return m.which!==32?null:(Ca=!0,nf);case"textInput":return p=m.data,p===nf&&Ca?null:p;default:return null}}function Qw(p,m){if(rf)return p==="compositionend"||!rs&&Xw(p,m)?(p=fs(),ui=Or=Xt=null,rf=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return wh&&m.locale!=="ko"?null:m.data;default:return null}}var NN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zw(p){var m=p&&p.nodeName&&p.nodeName.toLowerCase();return m==="input"?!!NN[p.type]:m==="textarea"}function SS(p,m,T,A){Ha(A),m=dv(m,"onChange"),0<m.length&&(T=new cd("onChange","change",null,T,A),p.push({event:T,listeners:m}))}var Rh=null,jm=null;function kN(p){AS(p,0)}function Ch(p){var m=kh(p);if(un(m))return p}function DN(p,m){if(p==="change")return m}var eR=!1;if(E){var TS;if(E){var Za="oninput"in document;if(!Za){var tR=document.createElement("div");tR.setAttribute("oninput","return;"),Za=typeof tR.oninput=="function"}TS=Za}else TS=!1;eR=TS&&(!document.documentMode||9<document.documentMode)}function nR(){Rh&&(Rh.detachEvent("onpropertychange",Zo),jm=Rh=null)}function Zo(p){if(p.propertyName==="value"&&Ch(jm)){var m=[];SS(m,jm,p,fo(p)),mo(kN,m)}}function LN(p,m,T){p==="focusin"?(nR(),Rh=m,jm=T,Rh.attachEvent("onpropertychange",Zo)):p==="focusout"&&nR()}function xN(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Ch(jm)}function MN(p,m){if(p==="click")return Ch(m)}function UN(p,m){if(p==="input"||p==="change")return Ch(m)}function rR(p,m){return p===m&&(p!==0||1/p===1/m)||p!==p&&m!==m}var jc=typeof Object.is=="function"?Object.is:rR;function Bm(p,m){if(jc(p,m))return!0;if(typeof p!="object"||p===null||typeof m!="object"||m===null)return!1;var T=Object.keys(p),A=Object.keys(m);if(T.length!==A.length)return!1;for(A=0;A<T.length;A++){var L=T[A];if(!S.call(m,L)||!jc(p[L],m[L]))return!1}return!0}function iR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function bS(p,m){var T=iR(p);p=0;for(var A;T;){if(T.nodeType===3){if(A=p+T.textContent.length,p<=m&&A>=m)return{node:T,offset:m-p};p=A}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=iR(T)}}function sR(p,m){return p&&m?p===m?!0:p&&p.nodeType===3?!1:m&&m.nodeType===3?sR(p,m.parentNode):"contains"in p?p.contains(m):p.compareDocumentPosition?!!(p.compareDocumentPosition(m)&16):!1:!1}function oR(){for(var p=window,m=gr();m instanceof p.HTMLIFrameElement;){try{var T=typeof m.contentWindow.location.href=="string"}catch{T=!1}if(T)p=m.contentWindow;else break;m=gr(p.document)}return m}function Wm(p){var m=p&&p.nodeName&&p.nodeName.toLowerCase();return m&&(m==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||m==="textarea"||p.contentEditable==="true")}function wS(p){var m=oR(),T=p.focusedElem,A=p.selectionRange;if(m!==T&&T&&T.ownerDocument&&sR(T.ownerDocument.documentElement,T)){if(A!==null&&Wm(T)){if(m=A.start,p=A.end,p===void 0&&(p=m),"selectionStart"in T)T.selectionStart=m,T.selectionEnd=Math.min(p,T.value.length);else if(p=(m=T.ownerDocument||document)&&m.defaultView||window,p.getSelection){p=p.getSelection();var L=T.textContent.length,W=Math.min(A.start,L);A=A.end===void 0?W:Math.min(A.end,L),!p.extend&&W>A&&(L=A,A=W,W=L),L=bS(T,W);var re=bS(T,A);L&&re&&(p.rangeCount!==1||p.anchorNode!==L.node||p.anchorOffset!==L.offset||p.focusNode!==re.node||p.focusOffset!==re.offset)&&(m=m.createRange(),m.setStart(L.node,L.offset),p.removeAllRanges(),W>A?(p.addRange(m),p.extend(re.node,re.offset)):(m.setEnd(re.node,re.offset),p.addRange(m)))}}for(m=[],p=T;p=p.parentNode;)p.nodeType===1&&m.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<m.length;T++)p=m[T],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var VN=E&&"documentMode"in document&&11>=document.documentMode,$e=null,RS=null,Gm=null,CS=!1;function aR(p,m,T){var A=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;CS||$e==null||$e!==gr(A)||(A=$e,"selectionStart"in A&&Wm(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),Gm&&Bm(Gm,A)||(Gm=A,A=dv(RS,"onSelect"),0<A.length&&(m=new cd("onSelect","select",null,m,T),p.push({event:m,listeners:A}),m.target=$e)))}function ov(p,m){var T={};return T[p.toLowerCase()]=m.toLowerCase(),T["Webkit"+p]="webkit"+m,T["Moz"+p]="moz"+m,T}var sf={animationend:ov("Animation","AnimationEnd"),animationiteration:ov("Animation","AnimationIteration"),animationstart:ov("Animation","AnimationStart"),transitionend:ov("Transition","TransitionEnd")},IS={},cR={};E&&(cR=document.createElement("div").style,"AnimationEvent"in window||(delete sf.animationend.animation,delete sf.animationiteration.animation,delete sf.animationstart.animation),"TransitionEvent"in window||delete sf.transitionend.transition);function Ih(p){if(IS[p])return IS[p];if(!sf[p])return p;var m=sf[p],T;for(T in m)if(m.hasOwnProperty(T)&&T in cR)return IS[p]=m[T];return p}var Ah=Ih("animationend"),lR=Ih("animationiteration"),uR=Ih("animationstart"),dR=Ih("transitionend"),hR=new Map,av="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ld(p,m){hR.set(p,m),d(m,[p])}for(var cv=0;cv<av.length;cv++){var Ia=av[cv],FN=Ia.toLowerCase(),zm=Ia[0].toUpperCase()+Ia.slice(1);ld(FN,"on"+zm)}ld(Ah,"onAnimationEnd"),ld(lR,"onAnimationIteration"),ld(uR,"onAnimationStart"),ld("dblclick","onDoubleClick"),ld("focusin","onFocus"),ld("focusout","onBlur"),ld(dR,"onTransitionEnd"),g("onMouseEnter",["mouseout","mouseover"]),g("onMouseLeave",["mouseout","mouseover"]),g("onPointerEnter",["pointerout","pointerover"]),g("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hm));function pR(p,m,T){var A=p.type||"unknown-event";p.currentTarget=T,vh(A,m,void 0,p),p.currentTarget=null}function AS(p,m){m=(m&4)!==0;for(var T=0;T<p.length;T++){var A=p[T],L=A.event;A=A.listeners;e:{var W=void 0;if(m)for(var re=A.length-1;0<=re;re--){var ye=A[re],Ae=ye.instance,ze=ye.currentTarget;if(ye=ye.listener,Ae!==W&&L.isPropagationStopped())break e;pR(L,ye,ze),W=Ae}else for(re=0;re<A.length;re++){if(ye=A[re],Ae=ye.instance,ze=ye.currentTarget,ye=ye.listener,Ae!==W&&L.isPropagationStopped())break e;pR(L,ye,ze),W=Ae}}}if(qo)throw p=Zu,qo=!1,Zu=null,p}function _i(p,m){var T=m[Ym];T===void 0&&(T=m[Ym]=new Set);var A=p+"__bubble";T.has(A)||(fR(m,p,2,!1),T.add(A))}function OS(p,m,T){var A=0;m&&(A|=4),fR(T,p,A,m)}var lv="_reactListening"+Math.random().toString(36).slice(2);function Oh(p){if(!p[lv]){p[lv]=!0,a.forEach(function(T){T!=="selectionchange"&&(jN.has(T)||OS(T,!1,p),OS(T,!0,p))});var m=p.nodeType===9?p:p.ownerDocument;m===null||m[lv]||(m[lv]=!0,OS("selectionchange",!1,m))}}function fR(p,m,T,A){switch(Ur(m)){case 1:var L=Ce;break;case 4:L=Ge;break;default:L=jt}T=L.bind(null,m,T,p),L=void 0,!ts||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(L=!0),A?L!==void 0?p.addEventListener(m,T,{capture:!0,passive:L}):p.addEventListener(m,T,!0):L!==void 0?p.addEventListener(m,T,{passive:L}):p.addEventListener(m,T,!1)}function uv(p,m,T,A,L){var W=A;if((m&1)===0&&(m&2)===0&&A!==null)e:for(;;){if(A===null)return;var re=A.tag;if(re===3||re===4){var ye=A.stateNode.containerInfo;if(ye===L||ye.nodeType===8&&ye.parentNode===L)break;if(re===4)for(re=A.return;re!==null;){var Ae=re.tag;if((Ae===3||Ae===4)&&(Ae=re.stateNode.containerInfo,Ae===L||Ae.nodeType===8&&Ae.parentNode===L))return;re=re.return}for(;ye!==null;){if(re=Nh(ye),re===null)return;if(Ae=re.tag,Ae===5||Ae===6){A=W=re;continue e}ye=ye.parentNode}}A=A.return}mo(function(){var ze=W,vt=fo(T),yt=[];e:{var _t=hR.get(p);if(_t!==void 0){var Vt=cd,zt=p;switch(p){case"keypress":if(bo(T)===0)break e;case"keydown":case"keyup":Vt=V;break;case"focusin":zt="focus",Vt=ef;break;case"focusout":zt="blur",Vt=ef;break;case"beforeblur":case"afterblur":Vt=ef;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Vt=Qp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Vt=nv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Vt=qe;break;case Ah:case lR:case uR:Vt=pu;break;case dR:Vt=Wr;break;case"scroll":Vt=Um;break;case"wheel":Vt=pr;break;case"copy":case"cut":case"paste":Vt=Fm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Vt=he}var $t=(m&4)!==0,Ki=!$t&&p==="scroll",Me=$t?_t!==null?_t+"Capture":null:_t;$t=[];for(var Oe=ze,je;Oe!==null;){je=Oe;var wt=je.stateNode;if(je.tag===5&&wt!==null&&(je=wt,Me!==null&&(wt=wi(Oe,Me),wt!=null&&$t.push(of(Oe,wt,je)))),Ki)break;Oe=Oe.return}0<$t.length&&(_t=new Vt(_t,zt,null,T,vt),yt.push({event:_t,listeners:$t}))}}if((m&7)===0){e:{if(_t=p==="mouseover"||p==="pointerover",Vt=p==="mouseout"||p==="pointerout",_t&&T!==Ga&&(zt=T.relatedTarget||T.fromElement)&&(Nh(zt)||zt[ec]))break e;if((Vt||_t)&&(_t=vt.window===vt?vt:(_t=vt.ownerDocument)?_t.defaultView||_t.parentWindow:window,Vt?(zt=T.relatedTarget||T.toElement,Vt=ze,zt=zt?Nh(zt):null,zt!==null&&(Ki=Is(zt),zt!==Ki||zt.tag!==5&&zt.tag!==6)&&(zt=null)):(Vt=null,zt=ze),Vt!==zt)){if($t=Qp,wt="onMouseLeave",Me="onMouseEnter",Oe="mouse",(p==="pointerout"||p==="pointerover")&&($t=he,wt="onPointerLeave",Me="onPointerEnter",Oe="pointer"),Ki=Vt==null?_t:kh(Vt),je=zt==null?_t:kh(zt),_t=new $t(wt,Oe+"leave",Vt,T,vt),_t.target=Ki,_t.relatedTarget=je,wt=null,Nh(vt)===ze&&($t=new $t(Me,Oe+"enter",zt,T,vt),$t.target=je,$t.relatedTarget=Ki,wt=$t),Ki=wt,Vt&&zt)t:{for($t=Vt,Me=zt,Oe=0,je=$t;je;je=Ph(je))Oe++;for(je=0,wt=Me;wt;wt=Ph(wt))je++;for(;0<Oe-je;)$t=Ph($t),Oe--;for(;0<je-Oe;)Me=Ph(Me),je--;for(;Oe--;){if($t===Me||Me!==null&&$t===Me.alternate)break t;$t=Ph($t),Me=Ph(Me)}$t=null}else $t=null;Vt!==null&&Km(yt,_t,Vt,$t,!1),zt!==null&&Ki!==null&&Km(yt,Ki,zt,$t,!0)}}e:{if(_t=ze?kh(ze):window,Vt=_t.nodeName&&_t.nodeName.toLowerCase(),Vt==="select"||Vt==="input"&&_t.type==="file")var Yt=DN;else if(Zw(_t))if(eR)Yt=UN;else{Yt=xN;var an=LN}else(Vt=_t.nodeName)&&Vt.toLowerCase()==="input"&&(_t.type==="checkbox"||_t.type==="radio")&&(Yt=MN);if(Yt&&(Yt=Yt(p,ze))){SS(yt,Yt,T,vt);break e}an&&an(p,_t,ze),p==="focusout"&&(an=_t._wrapperState)&&an.controlled&&_t.type==="number"&&De(_t,"number",_t.value)}switch(an=ze?kh(ze):window,p){case"focusin":(Zw(an)||an.contentEditable==="true")&&($e=an,RS=ze,Gm=null);break;case"focusout":Gm=RS=$e=null;break;case"mousedown":CS=!0;break;case"contextmenu":case"mouseup":case"dragend":CS=!1,aR(yt,T,vt);break;case"selectionchange":if(VN)break;case"keydown":case"keyup":aR(yt,T,vt)}var nn;if(rs)e:{switch(p){case"compositionstart":var bn="onCompositionStart";break e;case"compositionend":bn="onCompositionEnd";break e;case"compositionupdate":bn="onCompositionUpdate";break e}bn=void 0}else rf?Xw(p,T)&&(bn="onCompositionEnd"):p==="keydown"&&T.keyCode===229&&(bn="onCompositionStart");bn&&(wh&&T.locale!=="ko"&&(rf||bn!=="onCompositionStart"?bn==="onCompositionEnd"&&rf&&(nn=fs()):(Xt=vt,Or="value"in Xt?Xt.value:Xt.textContent,rf=!0)),an=dv(ze,bn),0<an.length&&(bn=new In(bn,p,null,T,vt),yt.push({event:bn,listeners:an}),nn?bn.data=nn:(nn=Jw(T),nn!==null&&(bn.data=nn)))),(nn=Io?PN(p,T):Qw(p,T))&&(ze=dv(ze,"onBeforeInput"),0<ze.length&&(vt=new In("onBeforeInput","beforeinput",null,T,vt),yt.push({event:vt,listeners:ze}),vt.data=nn))}AS(yt,m)})}function of(p,m,T){return{instance:p,listener:m,currentTarget:T}}function dv(p,m){for(var T=m+"Capture",A=[];p!==null;){var L=p,W=L.stateNode;L.tag===5&&W!==null&&(L=W,W=wi(p,T),W!=null&&A.unshift(of(p,W,L)),W=wi(p,m),W!=null&&A.push(of(p,W,L))),p=p.return}return A}function Ph(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function Km(p,m,T,A,L){for(var W=m._reactName,re=[];T!==null&&T!==A;){var ye=T,Ae=ye.alternate,ze=ye.stateNode;if(Ae!==null&&Ae===A)break;ye.tag===5&&ze!==null&&(ye=ze,L?(Ae=wi(T,W),Ae!=null&&re.unshift(of(T,Ae,ye))):L||(Ae=wi(T,W),Ae!=null&&re.push(of(T,Ae,ye)))),T=T.return}re.length!==0&&p.push({event:m,listeners:re})}var BN=/\r\n?/g,WN=/\u0000|\uFFFD/g;function mR(p){return(typeof p=="string"?p:""+p).replace(BN,`
`).replace(WN,"")}function hv(p,m,T){if(m=mR(m),mR(p)!==m&&T)throw Error(s(425))}function pv(){}var fv=null,$m=null;function PS(p,m){return p==="textarea"||p==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var qm=typeof setTimeout=="function"?setTimeout:void 0,GN=typeof clearTimeout=="function"?clearTimeout:void 0,gR=typeof Promise=="function"?Promise:void 0,zN=typeof queueMicrotask=="function"?queueMicrotask:typeof gR<"u"?function(p){return gR.resolve(null).then(p).catch(HN)}:qm;function HN(p){setTimeout(function(){throw p})}function NS(p,m){var T=m,A=0;do{var L=T.nextSibling;if(p.removeChild(T),L&&L.nodeType===8)if(T=L.data,T==="/$"){if(A===0){p.removeChild(L),Qo(m);return}A--}else T!=="$"&&T!=="$?"&&T!=="$!"||A++;T=L}while(T);Qo(m)}function ud(p){for(;p!=null;p=p.nextSibling){var m=p.nodeType;if(m===1||m===3)break;if(m===8){if(m=p.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return p}function _R(p){p=p.previousSibling;for(var m=0;p;){if(p.nodeType===8){var T=p.data;if(T==="$"||T==="$!"||T==="$?"){if(m===0)return p;m--}else T==="/$"&&m++}p=p.previousSibling}return null}var af=Math.random().toString(36).slice(2),yl="__reactFiber$"+af,dd="__reactProps$"+af,ec="__reactContainer$"+af,Ym="__reactEvents$"+af,KN="__reactListeners$"+af,$N="__reactHandles$"+af;function Nh(p){var m=p[yl];if(m)return m;for(var T=p.parentNode;T;){if(m=T[ec]||T[yl]){if(T=m.alternate,m.child!==null||T!==null&&T.child!==null)for(p=_R(p);p!==null;){if(T=p[yl])return T;p=_R(p)}return m}p=T,T=p.parentNode}return null}function cf(p){return p=p[yl]||p[ec],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function kh(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function lf(p){return p[dd]||null}var kS=[],uf=-1;function tc(p){return{current:p}}function vi(p){0>uf||(p.current=kS[uf],kS[uf]=null,uf--)}function di(p,m){uf++,kS[uf]=p.current,p.current=m}var hd={},to=tc(hd),ea=tc(!1),Dh=hd;function Lh(p,m){var T=p.type.contextTypes;if(!T)return hd;var A=p.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===m)return A.__reactInternalMemoizedMaskedChildContext;var L={},W;for(W in T)L[W]=m[W];return A&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=m,p.__reactInternalMemoizedMaskedChildContext=L),L}function ta(p){return p=p.childContextTypes,p!=null}function mv(){vi(ea),vi(to)}function vR(p,m,T){if(to.current!==hd)throw Error(s(168));di(to,m),di(ea,T)}function gv(p,m,T){var A=p.stateNode;if(m=m.childContextTypes,typeof A.getChildContext!="function")return T;A=A.getChildContext();for(var L in A)if(!(L in m))throw Error(s(108,Dt(p)||"Unknown",L));return Ee({},T,A)}function _v(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||hd,Dh=to.current,di(to,p),di(ea,ea.current),!0}function ER(p,m,T){var A=p.stateNode;if(!A)throw Error(s(169));T?(p=gv(p,m,Dh),A.__reactInternalMemoizedMergedChildContext=p,vi(ea),vi(to),di(to,p)):vi(ea),di(ea,T)}var nc=null,vv=!1,DS=!1;function yR(p){nc===null?nc=[p]:nc.push(p)}function qN(p){vv=!0,yR(p)}function pd(){if(!DS&&nc!==null){DS=!0;var p=0,m=Xn;try{var T=nc;for(Xn=1;p<T.length;p++){var A=T[p];do A=A(!0);while(A!==null)}nc=null,vv=!1}catch(L){throw nc!==null&&(nc=nc.slice(p+1)),nd(qa,pd),L}finally{Xn=m,DS=!1}}return null}var df=[],mu=0,Xm=null,Ev=0,rc=[],Aa=0,xh=null,gu=1,_u="";function vu(p,m){df[mu++]=Ev,df[mu++]=Xm,Xm=p,Ev=m}function yv(p,m,T){rc[Aa++]=gu,rc[Aa++]=_u,rc[Aa++]=xh,xh=p;var A=gu;p=_u;var L=32-Us(A)-1;A&=~(1<<L),T+=1;var W=32-Us(m)+L;if(30<W){var re=L-L%5;W=(A&(1<<re)-1).toString(32),A>>=re,L-=re,gu=1<<32-Us(m)+L|T<<L|A,_u=W+p}else gu=1<<W|T<<L|A,_u=p}function Sv(p){p.return!==null&&(vu(p,1),yv(p,1,0))}function Jm(p){for(;p===Xm;)Xm=df[--mu],df[mu]=null,Ev=df[--mu],df[mu]=null;for(;p===xh;)xh=rc[--Aa],rc[Aa]=null,_u=rc[--Aa],rc[Aa]=null,gu=rc[--Aa],rc[Aa]=null}var na=null,ra=null,ti=!1,Ao=null;function SR(p,m){var T=Bs(5,null,null,0);T.elementType="DELETED",T.stateNode=m,T.return=p,m=p.deletions,m===null?(p.deletions=[T],p.flags|=16):m.push(T)}function TR(p,m){switch(p.tag){case 5:var T=p.type;return m=m.nodeType!==1||T.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(p.stateNode=m,na=p,ra=ud(m.firstChild),!0):!1;case 6:return m=p.pendingProps===""||m.nodeType!==3?null:m,m!==null?(p.stateNode=m,na=p,ra=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(T=xh!==null?{id:gu,overflow:_u}:null,p.memoizedState={dehydrated:m,treeContext:T,retryLane:1073741824},T=Bs(18,null,null,0),T.stateNode=m,T.return=p,p.child=T,na=p,ra=null,!0):!1;default:return!1}}function Tv(p){return(p.mode&1)!==0&&(p.flags&128)===0}function LS(p){if(ti){var m=ra;if(m){var T=m;if(!TR(p,m)){if(Tv(p))throw Error(s(418));m=ud(T.nextSibling);var A=na;m&&TR(p,m)?SR(A,T):(p.flags=p.flags&-4097|2,ti=!1,na=p)}}else{if(Tv(p))throw Error(s(418));p.flags=p.flags&-4097|2,ti=!1,na=p}}}function bR(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;na=p}function Qm(p){if(p!==na)return!1;if(!ti)return bR(p),ti=!0,!1;var m;if((m=p.tag!==3)&&!(m=p.tag!==5)&&(m=p.type,m=m!=="head"&&m!=="body"&&!PS(p.type,p.memoizedProps)),m&&(m=ra)){if(Tv(p))throw wR(),Error(s(418));for(;m;)SR(p,m),m=ud(m.nextSibling)}if(bR(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,m=0;p;){if(p.nodeType===8){var T=p.data;if(T==="/$"){if(m===0){ra=ud(p.nextSibling);break e}m--}else T!=="$"&&T!=="$!"&&T!=="$?"||m++}p=p.nextSibling}ra=null}}else ra=na?ud(p.stateNode.nextSibling):null;return!0}function wR(){for(var p=ra;p;)p=ud(p.nextSibling)}function hf(){ra=na=null,ti=!1}function xS(p){Ao===null?Ao=[p]:Ao.push(p)}var YN=le.ReactCurrentBatchConfig;function Bc(p,m){if(p&&p.defaultProps){m=Ee({},m),p=p.defaultProps;for(var T in p)m[T]===void 0&&(m[T]=p[T]);return m}return m}var bv=tc(null),Zm=null,ic=null,MS=null;function US(){MS=ic=Zm=null}function VS(p){var m=bv.current;vi(bv),p._currentValue=m}function wv(p,m,T){for(;p!==null;){var A=p.alternate;if((p.childLanes&m)!==m?(p.childLanes|=m,A!==null&&(A.childLanes|=m)):A!==null&&(A.childLanes&m)!==m&&(A.childLanes|=m),p===T)break;p=p.return}}function pf(p,m){Zm=p,MS=ic=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&m)!==0&&(ia=!0),p.firstContext=null)}function Oa(p){var m=p._currentValue;if(MS!==p)if(p={context:p,memoizedValue:m,next:null},ic===null){if(Zm===null)throw Error(s(308));ic=p,Zm.dependencies={lanes:0,firstContext:p}}else ic=ic.next=p;return m}var Mh=null;function FS(p){Mh===null?Mh=[p]:Mh.push(p)}function RR(p,m,T,A){var L=m.interleaved;return L===null?(T.next=T,FS(m)):(T.next=L.next,L.next=T),m.interleaved=T,sc(p,A)}function sc(p,m){p.lanes|=m;var T=p.alternate;for(T!==null&&(T.lanes|=m),T=p,p=p.return;p!==null;)p.childLanes|=m,T=p.alternate,T!==null&&(T.childLanes|=m),T=p,p=p.return;return T.tag===3?T.stateNode:null}var fd=!1;function jS(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function CR(p,m){p=p.updateQueue,m.updateQueue===p&&(m.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Eu(p,m){return{eventTime:p,lane:m,tag:0,payload:null,callback:null,next:null}}function md(p,m,T){var A=p.updateQueue;if(A===null)return null;if(A=A.shared,(vr&2)!==0){var L=A.pending;return L===null?m.next=m:(m.next=L.next,L.next=m),A.pending=m,sc(p,T)}return L=A.interleaved,L===null?(m.next=m,FS(A)):(m.next=L.next,L.next=m),A.interleaved=m,sc(p,T)}function Rv(p,m,T){if(m=m.updateQueue,m!==null&&(m=m.shared,(T&4194240)!==0)){var A=m.lanes;A&=p.pendingLanes,T|=A,m.lanes=T,wa(p,T)}}function Cv(p,m){var T=p.updateQueue,A=p.alternate;if(A!==null&&(A=A.updateQueue,T===A)){var L=null,W=null;if(T=T.firstBaseUpdate,T!==null){do{var re={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};W===null?L=W=re:W=W.next=re,T=T.next}while(T!==null);W===null?L=W=m:W=W.next=m}else L=W=m;T={baseState:A.baseState,firstBaseUpdate:L,lastBaseUpdate:W,shared:A.shared,effects:A.effects},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=m:p.next=m,T.lastBaseUpdate=m}function Iv(p,m,T,A){var L=p.updateQueue;fd=!1;var W=L.firstBaseUpdate,re=L.lastBaseUpdate,ye=L.shared.pending;if(ye!==null){L.shared.pending=null;var Ae=ye,ze=Ae.next;Ae.next=null,re===null?W=ze:re.next=ze,re=Ae;var vt=p.alternate;vt!==null&&(vt=vt.updateQueue,ye=vt.lastBaseUpdate,ye!==re&&(ye===null?vt.firstBaseUpdate=ze:ye.next=ze,vt.lastBaseUpdate=Ae))}if(W!==null){var yt=L.baseState;re=0,vt=ze=Ae=null,ye=W;do{var _t=ye.lane,Vt=ye.eventTime;if((A&_t)===_t){vt!==null&&(vt=vt.next={eventTime:Vt,lane:0,tag:ye.tag,payload:ye.payload,callback:ye.callback,next:null});e:{var zt=p,$t=ye;switch(_t=m,Vt=T,$t.tag){case 1:if(zt=$t.payload,typeof zt=="function"){yt=zt.call(Vt,yt,_t);break e}yt=zt;break e;case 3:zt.flags=zt.flags&-65537|128;case 0:if(zt=$t.payload,_t=typeof zt=="function"?zt.call(Vt,yt,_t):zt,_t==null)break e;yt=Ee({},yt,_t);break e;case 2:fd=!0}}ye.callback!==null&&ye.lane!==0&&(p.flags|=64,_t=L.effects,_t===null?L.effects=[ye]:_t.push(ye))}else Vt={eventTime:Vt,lane:_t,tag:ye.tag,payload:ye.payload,callback:ye.callback,next:null},vt===null?(ze=vt=Vt,Ae=yt):vt=vt.next=Vt,re|=_t;if(ye=ye.next,ye===null){if(ye=L.shared.pending,ye===null)break;_t=ye,ye=_t.next,_t.next=null,L.lastBaseUpdate=_t,L.shared.pending=null}}while(!0);if(vt===null&&(Ae=yt),L.baseState=Ae,L.firstBaseUpdate=ze,L.lastBaseUpdate=vt,m=L.shared.interleaved,m!==null){L=m;do re|=L.lane,L=L.next;while(L!==m)}else W===null&&(L.shared.lanes=0);Gh|=re,p.lanes=re,p.memoizedState=yt}}function BS(p,m,T){if(p=m.effects,m.effects=null,p!==null)for(m=0;m<p.length;m++){var A=p[m],L=A.callback;if(L!==null){if(A.callback=null,A=T,typeof L!="function")throw Error(s(191,L));L.call(A)}}}var IR=new r.Component().refs;function Av(p,m,T,A){m=p.memoizedState,T=T(A,m),T=T==null?m:Ee({},m,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}var Ov={isMounted:function(p){return(p=p._reactInternals)?Is(p)===p:!1},enqueueSetState:function(p,m,T){p=p._reactInternals;var A=_s(),L=wu(p),W=Eu(A,L);W.payload=m,T!=null&&(W.callback=T),m=md(p,W,L),m!==null&&(Na(m,p,L,A),Rv(m,p,L))},enqueueReplaceState:function(p,m,T){p=p._reactInternals;var A=_s(),L=wu(p),W=Eu(A,L);W.tag=1,W.payload=m,T!=null&&(W.callback=T),m=md(p,W,L),m!==null&&(Na(m,p,L,A),Rv(m,p,L))},enqueueForceUpdate:function(p,m){p=p._reactInternals;var T=_s(),A=wu(p),L=Eu(T,A);L.tag=2,m!=null&&(L.callback=m),m=md(p,L,A),m!==null&&(Na(m,p,A,T),Rv(m,p,A))}};function AR(p,m,T,A,L,W,re){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(A,W,re):m.prototype&&m.prototype.isPureReactComponent?!Bm(T,A)||!Bm(L,W):!0}function OR(p,m,T){var A=!1,L=hd,W=m.contextType;return typeof W=="object"&&W!==null?W=Oa(W):(L=ta(m)?Dh:to.current,A=m.contextTypes,W=(A=A!=null)?Lh(p,L):hd),m=new m(T,W),p.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Ov,p.stateNode=m,m._reactInternals=p,A&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=L,p.__reactInternalMemoizedMaskedChildContext=W),m}function PR(p,m,T,A){p=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(T,A),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(T,A),m.state!==p&&Ov.enqueueReplaceState(m,m.state,null)}function WS(p,m,T,A){var L=p.stateNode;L.props=T,L.state=p.memoizedState,L.refs=IR,jS(p);var W=m.contextType;typeof W=="object"&&W!==null?L.context=Oa(W):(W=ta(m)?Dh:to.current,L.context=Lh(p,W)),L.state=p.memoizedState,W=m.getDerivedStateFromProps,typeof W=="function"&&(Av(p,m,W,T),L.state=p.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(m=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),m!==L.state&&Ov.enqueueReplaceState(L,L.state,null),Iv(p,T,L,A),L.state=p.memoizedState),typeof L.componentDidMount=="function"&&(p.flags|=4194308)}function eg(p,m,T){if(p=T.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(s(309));var A=T.stateNode}if(!A)throw Error(s(147,p));var L=A,W=""+p;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===W?m.ref:(m=function(re){var ye=L.refs;ye===IR&&(ye=L.refs={}),re===null?delete ye[W]:ye[W]=re},m._stringRef=W,m)}if(typeof p!="string")throw Error(s(284));if(!T._owner)throw Error(s(290,p))}return p}function tg(p,m){throw p=Object.prototype.toString.call(m),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":p))}function NR(p){var m=p._init;return m(p._payload)}function kR(p){function m(Me,Oe){if(p){var je=Me.deletions;je===null?(Me.deletions=[Oe],Me.flags|=16):je.push(Oe)}}function T(Me,Oe){if(!p)return null;for(;Oe!==null;)m(Me,Oe),Oe=Oe.sibling;return null}function A(Me,Oe){for(Me=new Map;Oe!==null;)Oe.key!==null?Me.set(Oe.key,Oe):Me.set(Oe.index,Oe),Oe=Oe.sibling;return Me}function L(Me,Oe){return Me=wd(Me,Oe),Me.index=0,Me.sibling=null,Me}function W(Me,Oe,je){return Me.index=je,p?(je=Me.alternate,je!==null?(je=je.index,je<Oe?(Me.flags|=2,Oe):je):(Me.flags|=2,Oe)):(Me.flags|=1048576,Oe)}function re(Me){return p&&Me.alternate===null&&(Me.flags|=2),Me}function ye(Me,Oe,je,wt){return Oe===null||Oe.tag!==6?(Oe=TT(je,Me.mode,wt),Oe.return=Me,Oe):(Oe=L(Oe,je),Oe.return=Me,Oe)}function Ae(Me,Oe,je,wt){var Yt=je.type;return Yt===Z?vt(Me,Oe,je.props.children,wt,je.key):Oe!==null&&(Oe.elementType===Yt||typeof Yt=="object"&&Yt!==null&&Yt.$$typeof===Ze&&NR(Yt)===Oe.type)?(wt=L(Oe,je.props),wt.ref=eg(Me,Oe,je),wt.return=Me,wt):(wt=qv(je.type,je.key,je.props,null,Me.mode,wt),wt.ref=eg(Me,Oe,je),wt.return=Me,wt)}function ze(Me,Oe,je,wt){return Oe===null||Oe.tag!==4||Oe.stateNode.containerInfo!==je.containerInfo||Oe.stateNode.implementation!==je.implementation?(Oe=bT(je,Me.mode,wt),Oe.return=Me,Oe):(Oe=L(Oe,je.children||[]),Oe.return=Me,Oe)}function vt(Me,Oe,je,wt,Yt){return Oe===null||Oe.tag!==7?(Oe=Hc(je,Me.mode,wt,Yt),Oe.return=Me,Oe):(Oe=L(Oe,je),Oe.return=Me,Oe)}function yt(Me,Oe,je){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return Oe=TT(""+Oe,Me.mode,je),Oe.return=Me,Oe;if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case ce:return je=qv(Oe.type,Oe.key,Oe.props,null,Me.mode,je),je.ref=eg(Me,null,Oe),je.return=Me,je;case Se:return Oe=bT(Oe,Me.mode,je),Oe.return=Me,Oe;case Ze:var wt=Oe._init;return yt(Me,wt(Oe._payload),je)}if(We(Oe)||nt(Oe))return Oe=Hc(Oe,Me.mode,je,null),Oe.return=Me,Oe;tg(Me,Oe)}return null}function _t(Me,Oe,je,wt){var Yt=Oe!==null?Oe.key:null;if(typeof je=="string"&&je!==""||typeof je=="number")return Yt!==null?null:ye(Me,Oe,""+je,wt);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case ce:return je.key===Yt?Ae(Me,Oe,je,wt):null;case Se:return je.key===Yt?ze(Me,Oe,je,wt):null;case Ze:return Yt=je._init,_t(Me,Oe,Yt(je._payload),wt)}if(We(je)||nt(je))return Yt!==null?null:vt(Me,Oe,je,wt,null);tg(Me,je)}return null}function Vt(Me,Oe,je,wt,Yt){if(typeof wt=="string"&&wt!==""||typeof wt=="number")return Me=Me.get(je)||null,ye(Oe,Me,""+wt,Yt);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case ce:return Me=Me.get(wt.key===null?je:wt.key)||null,Ae(Oe,Me,wt,Yt);case Se:return Me=Me.get(wt.key===null?je:wt.key)||null,ze(Oe,Me,wt,Yt);case Ze:var an=wt._init;return Vt(Me,Oe,je,an(wt._payload),Yt)}if(We(wt)||nt(wt))return Me=Me.get(je)||null,vt(Oe,Me,wt,Yt,null);tg(Oe,wt)}return null}function zt(Me,Oe,je,wt){for(var Yt=null,an=null,nn=Oe,bn=Oe=0,ss=null;nn!==null&&bn<je.length;bn++){nn.index>bn?(ss=nn,nn=null):ss=nn.sibling;var wr=_t(Me,nn,je[bn],wt);if(wr===null){nn===null&&(nn=ss);break}p&&nn&&wr.alternate===null&&m(Me,nn),Oe=W(wr,Oe,bn),an===null?Yt=wr:an.sibling=wr,an=wr,nn=ss}if(bn===je.length)return T(Me,nn),ti&&vu(Me,bn),Yt;if(nn===null){for(;bn<je.length;bn++)nn=yt(Me,je[bn],wt),nn!==null&&(Oe=W(nn,Oe,bn),an===null?Yt=nn:an.sibling=nn,an=nn);return ti&&vu(Me,bn),Yt}for(nn=A(Me,nn);bn<je.length;bn++)ss=Vt(nn,Me,bn,je[bn],wt),ss!==null&&(p&&ss.alternate!==null&&nn.delete(ss.key===null?bn:ss.key),Oe=W(ss,Oe,bn),an===null?Yt=ss:an.sibling=ss,an=ss);return p&&nn.forEach(function(Rd){return m(Me,Rd)}),ti&&vu(Me,bn),Yt}function $t(Me,Oe,je,wt){var Yt=nt(je);if(typeof Yt!="function")throw Error(s(150));if(je=Yt.call(je),je==null)throw Error(s(151));for(var an=Yt=null,nn=Oe,bn=Oe=0,ss=null,wr=je.next();nn!==null&&!wr.done;bn++,wr=je.next()){nn.index>bn?(ss=nn,nn=null):ss=nn.sibling;var Rd=_t(Me,nn,wr.value,wt);if(Rd===null){nn===null&&(nn=ss);break}p&&nn&&Rd.alternate===null&&m(Me,nn),Oe=W(Rd,Oe,bn),an===null?Yt=Rd:an.sibling=Rd,an=Rd,nn=ss}if(wr.done)return T(Me,nn),ti&&vu(Me,bn),Yt;if(nn===null){for(;!wr.done;bn++,wr=je.next())wr=yt(Me,wr.value,wt),wr!==null&&(Oe=W(wr,Oe,bn),an===null?Yt=wr:an.sibling=wr,an=wr);return ti&&vu(Me,bn),Yt}for(nn=A(Me,nn);!wr.done;bn++,wr=je.next())wr=Vt(nn,Me,bn,wr.value,wt),wr!==null&&(p&&wr.alternate!==null&&nn.delete(wr.key===null?bn:wr.key),Oe=W(wr,Oe,bn),an===null?Yt=wr:an.sibling=wr,an=wr);return p&&nn.forEach(function(TC){return m(Me,TC)}),ti&&vu(Me,bn),Yt}function Ki(Me,Oe,je,wt){if(typeof je=="object"&&je!==null&&je.type===Z&&je.key===null&&(je=je.props.children),typeof je=="object"&&je!==null){switch(je.$$typeof){case ce:e:{for(var Yt=je.key,an=Oe;an!==null;){if(an.key===Yt){if(Yt=je.type,Yt===Z){if(an.tag===7){T(Me,an.sibling),Oe=L(an,je.props.children),Oe.return=Me,Me=Oe;break e}}else if(an.elementType===Yt||typeof Yt=="object"&&Yt!==null&&Yt.$$typeof===Ze&&NR(Yt)===an.type){T(Me,an.sibling),Oe=L(an,je.props),Oe.ref=eg(Me,an,je),Oe.return=Me,Me=Oe;break e}T(Me,an);break}else m(Me,an);an=an.sibling}je.type===Z?(Oe=Hc(je.props.children,Me.mode,wt,je.key),Oe.return=Me,Me=Oe):(wt=qv(je.type,je.key,je.props,null,Me.mode,wt),wt.ref=eg(Me,Oe,je),wt.return=Me,Me=wt)}return re(Me);case Se:e:{for(an=je.key;Oe!==null;){if(Oe.key===an)if(Oe.tag===4&&Oe.stateNode.containerInfo===je.containerInfo&&Oe.stateNode.implementation===je.implementation){T(Me,Oe.sibling),Oe=L(Oe,je.children||[]),Oe.return=Me,Me=Oe;break e}else{T(Me,Oe);break}else m(Me,Oe);Oe=Oe.sibling}Oe=bT(je,Me.mode,wt),Oe.return=Me,Me=Oe}return re(Me);case Ze:return an=je._init,Ki(Me,Oe,an(je._payload),wt)}if(We(je))return zt(Me,Oe,je,wt);if(nt(je))return $t(Me,Oe,je,wt);tg(Me,je)}return typeof je=="string"&&je!==""||typeof je=="number"?(je=""+je,Oe!==null&&Oe.tag===6?(T(Me,Oe.sibling),Oe=L(Oe,je),Oe.return=Me,Me=Oe):(T(Me,Oe),Oe=TT(je,Me.mode,wt),Oe.return=Me,Me=Oe),re(Me)):T(Me,Oe)}return Ki}var Uh=kR(!0),DR=kR(!1),gd={},Wc=tc(gd),yu=tc(gd),ng=tc(gd);function Vh(p){if(p===gd)throw Error(s(174));return p}function GS(p,m){switch(di(ng,m),di(yu,p),di(Wc,gd),p=m.nodeType,p){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:tn(null,"");break;default:p=p===8?m.parentNode:m,m=p.namespaceURI||null,p=p.tagName,m=tn(m,p)}vi(Wc),di(Wc,m)}function ff(){vi(Wc),vi(yu),vi(ng)}function rg(p){Vh(ng.current);var m=Vh(Wc.current),T=tn(m,p.type);m!==T&&(di(yu,p),di(Wc,T))}function zS(p){yu.current===p&&(vi(Wc),vi(yu))}var Si=tc(0);function mf(p){for(var m=p;m!==null;){if(m.tag===13){var T=m.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===p)break;for(;m.sibling===null;){if(m.return===null||m.return===p)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var ig=[];function HS(){for(var p=0;p<ig.length;p++)ig[p]._workInProgressVersionPrimary=null;ig.length=0}var Pv=le.ReactCurrentDispatcher,KS=le.ReactCurrentBatchConfig,Fh=0,Ri=null,Ui=null,Os=null,Su=!1,jh=!1,_d=0,sg=0;function ms(){throw Error(s(321))}function $S(p,m){if(m===null)return!1;for(var T=0;T<m.length&&T<p.length;T++)if(!jc(p[T],m[T]))return!1;return!0}function Nv(p,m,T,A,L,W){if(Fh=W,Ri=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Pv.current=p===null||p.memoizedState===null?QN:ZN,p=T(A,L),jh){W=0;do{if(jh=!1,_d=0,25<=W)throw Error(s(301));W+=1,Os=Ui=null,m.updateQueue=null,Pv.current=ek,p=T(A,L)}while(jh)}if(Pv.current=Lv,m=Ui!==null&&Ui.next!==null,Fh=0,Os=Ui=Ri=null,Su=!1,m)throw Error(s(300));return p}function qS(){var p=_d!==0;return _d=0,p}function Gc(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Os===null?Ri.memoizedState=Os=p:Os=Os.next=p,Os}function oc(){if(Ui===null){var p=Ri.alternate;p=p!==null?p.memoizedState:null}else p=Ui.next;var m=Os===null?Ri.memoizedState:Os.next;if(m!==null)Os=m,Ui=p;else{if(p===null)throw Error(s(310));Ui=p,p={memoizedState:Ui.memoizedState,baseState:Ui.baseState,baseQueue:Ui.baseQueue,queue:Ui.queue,next:null},Os===null?Ri.memoizedState=Os=p:Os=Os.next=p}return Os}function og(p,m){return typeof m=="function"?m(p):m}function ag(p){var m=oc(),T=m.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var A=Ui,L=A.baseQueue,W=T.pending;if(W!==null){if(L!==null){var re=L.next;L.next=W.next,W.next=re}A.baseQueue=L=W,T.pending=null}if(L!==null){W=L.next,A=A.baseState;var ye=re=null,Ae=null,ze=W;do{var vt=ze.lane;if((Fh&vt)===vt)Ae!==null&&(Ae=Ae.next={lane:0,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null}),A=ze.hasEagerState?ze.eagerState:p(A,ze.action);else{var yt={lane:vt,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null};Ae===null?(ye=Ae=yt,re=A):Ae=Ae.next=yt,Ri.lanes|=vt,Gh|=vt}ze=ze.next}while(ze!==null&&ze!==W);Ae===null?re=A:Ae.next=ye,jc(A,m.memoizedState)||(ia=!0),m.memoizedState=A,m.baseState=re,m.baseQueue=Ae,T.lastRenderedState=A}if(p=T.interleaved,p!==null){L=p;do W=L.lane,Ri.lanes|=W,Gh|=W,L=L.next;while(L!==p)}else L===null&&(T.lanes=0);return[m.memoizedState,T.dispatch]}function cg(p){var m=oc(),T=m.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var A=T.dispatch,L=T.pending,W=m.memoizedState;if(L!==null){T.pending=null;var re=L=L.next;do W=p(W,re.action),re=re.next;while(re!==L);jc(W,m.memoizedState)||(ia=!0),m.memoizedState=W,m.baseQueue===null&&(m.baseState=W),T.lastRenderedState=W}return[W,A]}function LR(){}function xR(p,m){var T=Ri,A=oc(),L=m(),W=!jc(A.memoizedState,L);if(W&&(A.memoizedState=L,ia=!0),A=A.queue,Dv(MR.bind(null,T,A,p),[p]),A.getSnapshot!==m||W||Os!==null&&Os.memoizedState.tag&1){if(T.flags|=2048,gf(9,kv.bind(null,T,A,L,m),void 0,null),is===null)throw Error(s(349));(Fh&30)!==0||YS(T,m,L)}return L}function YS(p,m,T){p.flags|=16384,p={getSnapshot:m,value:T},m=Ri.updateQueue,m===null?(m={lastEffect:null,stores:null},Ri.updateQueue=m,m.stores=[p]):(T=m.stores,T===null?m.stores=[p]:T.push(p))}function kv(p,m,T,A){m.value=T,m.getSnapshot=A,zc(m)&&Bh(p)}function MR(p,m,T){return T(function(){zc(m)&&Bh(p)})}function zc(p){var m=p.getSnapshot;p=p.value;try{var T=m();return!jc(p,T)}catch{return!0}}function Bh(p){var m=sc(p,1);m!==null&&Na(m,p,1,-1)}function vd(p){var m=Gc();return typeof p=="function"&&(p=p()),m.memoizedState=m.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:og,lastRenderedState:p},m.queue=p,p=p.dispatch=eT.bind(null,Ri,p),[m.memoizedState,p]}function gf(p,m,T,A){return p={tag:p,create:m,destroy:T,deps:A,next:null},m=Ri.updateQueue,m===null?(m={lastEffect:null,stores:null},Ri.updateQueue=m,m.lastEffect=p.next=p):(T=m.lastEffect,T===null?m.lastEffect=p.next=p:(A=T.next,T.next=p,p.next=A,m.lastEffect=p)),p}function XS(){return oc().memoizedState}function Sl(p,m,T,A){var L=Gc();Ri.flags|=p,L.memoizedState=gf(1|m,T,void 0,A===void 0?null:A)}function _f(p,m,T,A){var L=oc();A=A===void 0?null:A;var W=void 0;if(Ui!==null){var re=Ui.memoizedState;if(W=re.destroy,A!==null&&$S(A,re.deps)){L.memoizedState=gf(m,T,W,A);return}}Ri.flags|=p,L.memoizedState=gf(1|m,T,W,A)}function UR(p,m){return Sl(8390656,8,p,m)}function Dv(p,m){return _f(2048,8,p,m)}function VR(p,m){return _f(4,2,p,m)}function JS(p,m){return _f(4,4,p,m)}function QS(p,m){if(typeof m=="function")return p=p(),m(p),function(){m(null)};if(m!=null)return p=p(),m.current=p,function(){m.current=null}}function FR(p,m,T){return T=T!=null?T.concat([p]):null,_f(4,4,QS.bind(null,m,p),T)}function Tl(){}function jR(p,m){var T=oc();m=m===void 0?null:m;var A=T.memoizedState;return A!==null&&m!==null&&$S(m,A[1])?A[0]:(T.memoizedState=[p,m],p)}function BR(p,m){var T=oc();m=m===void 0?null:m;var A=T.memoizedState;return A!==null&&m!==null&&$S(m,A[1])?A[0]:(p=p(),T.memoizedState=[p,m],p)}function WR(p,m,T){return(Fh&21)===0?(p.baseState&&(p.baseState=!1,ia=!0),p.memoizedState=T):(jc(T,m)||(T=cu(),Ri.lanes|=T,Gh|=T,p.baseState=!0),m)}function XN(p,m){var T=Xn;Xn=T!==0&&4>T?T:4,p(!0);var A=KS.transition;KS.transition={};try{p(!1),m()}finally{Xn=T,KS.transition=A}}function ZS(){return oc().memoizedState}function JN(p,m,T){var A=wu(p);if(T={lane:A,action:T,hasEagerState:!1,eagerState:null,next:null},tT(p))GR(m,T);else if(T=RR(p,m,T,A),T!==null){var L=_s();Na(T,p,A,L),nT(T,m,A)}}function eT(p,m,T){var A=wu(p),L={lane:A,action:T,hasEagerState:!1,eagerState:null,next:null};if(tT(p))GR(m,L);else{var W=p.alternate;if(p.lanes===0&&(W===null||W.lanes===0)&&(W=m.lastRenderedReducer,W!==null))try{var re=m.lastRenderedState,ye=W(re,T);if(L.hasEagerState=!0,L.eagerState=ye,jc(ye,re)){var Ae=m.interleaved;Ae===null?(L.next=L,FS(m)):(L.next=Ae.next,Ae.next=L),m.interleaved=L;return}}catch{}finally{}T=RR(p,m,L,A),T!==null&&(L=_s(),Na(T,p,A,L),nT(T,m,A))}}function tT(p){var m=p.alternate;return p===Ri||m!==null&&m===Ri}function GR(p,m){jh=Su=!0;var T=p.pending;T===null?m.next=m:(m.next=T.next,T.next=m),p.pending=m}function nT(p,m,T){if((T&4194240)!==0){var A=m.lanes;A&=p.pendingLanes,T|=A,m.lanes=T,wa(p,T)}}var Lv={readContext:Oa,useCallback:ms,useContext:ms,useEffect:ms,useImperativeHandle:ms,useInsertionEffect:ms,useLayoutEffect:ms,useMemo:ms,useReducer:ms,useRef:ms,useState:ms,useDebugValue:ms,useDeferredValue:ms,useTransition:ms,useMutableSource:ms,useSyncExternalStore:ms,useId:ms,unstable_isNewReconciler:!1},QN={readContext:Oa,useCallback:function(p,m){return Gc().memoizedState=[p,m===void 0?null:m],p},useContext:Oa,useEffect:UR,useImperativeHandle:function(p,m,T){return T=T!=null?T.concat([p]):null,Sl(4194308,4,QS.bind(null,m,p),T)},useLayoutEffect:function(p,m){return Sl(4194308,4,p,m)},useInsertionEffect:function(p,m){return Sl(4,2,p,m)},useMemo:function(p,m){var T=Gc();return m=m===void 0?null:m,p=p(),T.memoizedState=[p,m],p},useReducer:function(p,m,T){var A=Gc();return m=T!==void 0?T(m):m,A.memoizedState=A.baseState=m,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:m},A.queue=p,p=p.dispatch=JN.bind(null,Ri,p),[A.memoizedState,p]},useRef:function(p){var m=Gc();return p={current:p},m.memoizedState=p},useState:vd,useDebugValue:Tl,useDeferredValue:function(p){return Gc().memoizedState=p},useTransition:function(){var p=vd(!1),m=p[0];return p=XN.bind(null,p[1]),Gc().memoizedState=p,[m,p]},useMutableSource:function(){},useSyncExternalStore:function(p,m,T){var A=Ri,L=Gc();if(ti){if(T===void 0)throw Error(s(407));T=T()}else{if(T=m(),is===null)throw Error(s(349));(Fh&30)!==0||YS(A,m,T)}L.memoizedState=T;var W={value:T,getSnapshot:m};return L.queue=W,UR(MR.bind(null,A,W,p),[p]),A.flags|=2048,gf(9,kv.bind(null,A,W,T,m),void 0,null),T},useId:function(){var p=Gc(),m=is.identifierPrefix;if(ti){var T=_u,A=gu;T=(A&~(1<<32-Us(A)-1)).toString(32)+T,m=":"+m+"R"+T,T=_d++,0<T&&(m+="H"+T.toString(32)),m+=":"}else T=sg++,m=":"+m+"r"+T.toString(32)+":";return p.memoizedState=m},unstable_isNewReconciler:!1},ZN={readContext:Oa,useCallback:jR,useContext:Oa,useEffect:Dv,useImperativeHandle:FR,useInsertionEffect:VR,useLayoutEffect:JS,useMemo:BR,useReducer:ag,useRef:XS,useState:function(){return ag(og)},useDebugValue:Tl,useDeferredValue:function(p){var m=oc();return WR(m,Ui.memoizedState,p)},useTransition:function(){var p=ag(og)[0],m=oc().memoizedState;return[p,m]},useMutableSource:LR,useSyncExternalStore:xR,useId:ZS,unstable_isNewReconciler:!1},ek={readContext:Oa,useCallback:jR,useContext:Oa,useEffect:Dv,useImperativeHandle:FR,useInsertionEffect:VR,useLayoutEffect:JS,useMemo:BR,useReducer:cg,useRef:XS,useState:function(){return cg(og)},useDebugValue:Tl,useDeferredValue:function(p){var m=oc();return Ui===null?m.memoizedState=p:WR(m,Ui.memoizedState,p)},useTransition:function(){var p=cg(og)[0],m=oc().memoizedState;return[p,m]},useMutableSource:LR,useSyncExternalStore:xR,useId:ZS,unstable_isNewReconciler:!1};function vf(p,m){try{var T="",A=m;do T+=et(A),A=A.return;while(A);var L=T}catch(W){L=`
Error generating stack: `+W.message+`
`+W.stack}return{value:p,source:m,stack:L,digest:null}}function rT(p,m,T){return{value:p,source:null,stack:T??null,digest:m??null}}function iT(p,m){try{console.error(m.value)}catch(T){setTimeout(function(){throw T})}}var zR=typeof WeakMap=="function"?WeakMap:Map;function Tu(p,m,T){T=Eu(-1,T),T.tag=3,T.payload={element:null};var A=m.value;return T.callback=function(){Wv||(Wv=!0,_T=A),iT(p,m)},T}function HR(p,m,T){T=Eu(-1,T),T.tag=3;var A=p.type.getDerivedStateFromError;if(typeof A=="function"){var L=m.value;T.payload=function(){return A(L)},T.callback=function(){iT(p,m)}}var W=p.stateNode;return W!==null&&typeof W.componentDidCatch=="function"&&(T.callback=function(){iT(p,m),typeof A!="function"&&(wl===null?wl=new Set([this]):wl.add(this));var re=m.stack;this.componentDidCatch(m.value,{componentStack:re!==null?re:""})}),T}function KR(p,m,T){var A=p.pingCache;if(A===null){A=p.pingCache=new zR;var L=new Set;A.set(m,L)}else L=A.get(m),L===void 0&&(L=new Set,A.set(m,L));L.has(T)||(L.add(T),p=gC.bind(null,p,m,T),m.then(p,p))}function $R(p){do{var m;if((m=p.tag===13)&&(m=p.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return p;p=p.return}while(p!==null);return null}function qR(p,m,T,A,L){return(p.mode&1)===0?(p===m?p.flags|=65536:(p.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(m=Eu(-1,1),m.tag=2,md(T,m,1))),T.lanes|=1),p):(p.flags|=65536,p.lanes=L,p)}var tk=le.ReactCurrentOwner,ia=!1;function Vs(p,m,T,A){m.child=p===null?DR(m,null,T,A):Uh(m,p.child,T,A)}function YR(p,m,T,A,L){T=T.render;var W=m.ref;return pf(m,L),A=Nv(p,m,T,A,W,L),T=qS(),p!==null&&!ia?(m.updateQueue=p.updateQueue,m.flags&=-2053,p.lanes&=~L,bl(p,m,L)):(ti&&T&&Sv(m),m.flags|=1,Vs(p,m,A,L),m.child)}function XR(p,m,T,A,L){if(p===null){var W=T.type;return typeof W=="function"&&!Iu(W)&&W.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(m.tag=15,m.type=W,JR(p,m,W,A,L)):(p=qv(T.type,null,A,m,m.mode,L),p.ref=m.ref,p.return=m,m.child=p)}if(W=p.child,(p.lanes&L)===0){var re=W.memoizedProps;if(T=T.compare,T=T!==null?T:Bm,T(re,A)&&p.ref===m.ref)return bl(p,m,L)}return m.flags|=1,p=wd(W,A),p.ref=m.ref,p.return=m,m.child=p}function JR(p,m,T,A,L){if(p!==null){var W=p.memoizedProps;if(Bm(W,A)&&p.ref===m.ref)if(ia=!1,m.pendingProps=A=W,(p.lanes&L)!==0)(p.flags&131072)!==0&&(ia=!0);else return m.lanes=p.lanes,bl(p,m,L)}return sT(p,m,T,A,L)}function QR(p,m,T){var A=m.pendingProps,L=A.children,W=p!==null?p.memoizedState:null;if(A.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},di(Wh,Ns),Ns|=T;else{if((T&1073741824)===0)return p=W!==null?W.baseLanes|T:T,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:p,cachePool:null,transitions:null},m.updateQueue=null,di(Wh,Ns),Ns|=p,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=W!==null?W.baseLanes:T,di(Wh,Ns),Ns|=A}else W!==null?(A=W.baseLanes|T,m.memoizedState=null):A=T,di(Wh,Ns),Ns|=A;return Vs(p,m,L,T),m.child}function ZR(p,m){var T=m.ref;(p===null&&T!==null||p!==null&&p.ref!==T)&&(m.flags|=512,m.flags|=2097152)}function sT(p,m,T,A,L){var W=ta(T)?Dh:to.current;return W=Lh(m,W),pf(m,L),T=Nv(p,m,T,A,W,L),A=qS(),p!==null&&!ia?(m.updateQueue=p.updateQueue,m.flags&=-2053,p.lanes&=~L,bl(p,m,L)):(ti&&A&&Sv(m),m.flags|=1,Vs(p,m,T,L),m.child)}function oT(p,m,T,A,L){if(ta(T)){var W=!0;_v(m)}else W=!1;if(pf(m,L),m.stateNode===null)hg(p,m),OR(m,T,A),WS(m,T,A,L),A=!0;else if(p===null){var re=m.stateNode,ye=m.memoizedProps;re.props=ye;var Ae=re.context,ze=T.contextType;typeof ze=="object"&&ze!==null?ze=Oa(ze):(ze=ta(T)?Dh:to.current,ze=Lh(m,ze));var vt=T.getDerivedStateFromProps,yt=typeof vt=="function"||typeof re.getSnapshotBeforeUpdate=="function";yt||typeof re.UNSAFE_componentWillReceiveProps!="function"&&typeof re.componentWillReceiveProps!="function"||(ye!==A||Ae!==ze)&&PR(m,re,A,ze),fd=!1;var _t=m.memoizedState;re.state=_t,Iv(m,A,re,L),Ae=m.memoizedState,ye!==A||_t!==Ae||ea.current||fd?(typeof vt=="function"&&(Av(m,T,vt,A),Ae=m.memoizedState),(ye=fd||AR(m,T,ye,A,_t,Ae,ze))?(yt||typeof re.UNSAFE_componentWillMount!="function"&&typeof re.componentWillMount!="function"||(typeof re.componentWillMount=="function"&&re.componentWillMount(),typeof re.UNSAFE_componentWillMount=="function"&&re.UNSAFE_componentWillMount()),typeof re.componentDidMount=="function"&&(m.flags|=4194308)):(typeof re.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=A,m.memoizedState=Ae),re.props=A,re.state=Ae,re.context=ze,A=ye):(typeof re.componentDidMount=="function"&&(m.flags|=4194308),A=!1)}else{re=m.stateNode,CR(p,m),ye=m.memoizedProps,ze=m.type===m.elementType?ye:Bc(m.type,ye),re.props=ze,yt=m.pendingProps,_t=re.context,Ae=T.contextType,typeof Ae=="object"&&Ae!==null?Ae=Oa(Ae):(Ae=ta(T)?Dh:to.current,Ae=Lh(m,Ae));var Vt=T.getDerivedStateFromProps;(vt=typeof Vt=="function"||typeof re.getSnapshotBeforeUpdate=="function")||typeof re.UNSAFE_componentWillReceiveProps!="function"&&typeof re.componentWillReceiveProps!="function"||(ye!==yt||_t!==Ae)&&PR(m,re,A,Ae),fd=!1,_t=m.memoizedState,re.state=_t,Iv(m,A,re,L);var zt=m.memoizedState;ye!==yt||_t!==zt||ea.current||fd?(typeof Vt=="function"&&(Av(m,T,Vt,A),zt=m.memoizedState),(ze=fd||AR(m,T,ze,A,_t,zt,Ae)||!1)?(vt||typeof re.UNSAFE_componentWillUpdate!="function"&&typeof re.componentWillUpdate!="function"||(typeof re.componentWillUpdate=="function"&&re.componentWillUpdate(A,zt,Ae),typeof re.UNSAFE_componentWillUpdate=="function"&&re.UNSAFE_componentWillUpdate(A,zt,Ae)),typeof re.componentDidUpdate=="function"&&(m.flags|=4),typeof re.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof re.componentDidUpdate!="function"||ye===p.memoizedProps&&_t===p.memoizedState||(m.flags|=4),typeof re.getSnapshotBeforeUpdate!="function"||ye===p.memoizedProps&&_t===p.memoizedState||(m.flags|=1024),m.memoizedProps=A,m.memoizedState=zt),re.props=A,re.state=zt,re.context=Ae,A=ze):(typeof re.componentDidUpdate!="function"||ye===p.memoizedProps&&_t===p.memoizedState||(m.flags|=4),typeof re.getSnapshotBeforeUpdate!="function"||ye===p.memoizedProps&&_t===p.memoizedState||(m.flags|=1024),A=!1)}return xv(p,m,T,A,W,L)}function xv(p,m,T,A,L,W){ZR(p,m);var re=(m.flags&128)!==0;if(!A&&!re)return L&&ER(m,T,!1),bl(p,m,W);A=m.stateNode,tk.current=m;var ye=re&&typeof T.getDerivedStateFromError!="function"?null:A.render();return m.flags|=1,p!==null&&re?(m.child=Uh(m,p.child,null,W),m.child=Uh(m,null,ye,W)):Vs(p,m,ye,W),m.memoizedState=A.state,L&&ER(m,T,!0),m.child}function eC(p){var m=p.stateNode;m.pendingContext?vR(p,m.pendingContext,m.pendingContext!==m.context):m.context&&vR(p,m.context,!1),GS(p,m.containerInfo)}function tC(p,m,T,A,L){return hf(),xS(L),m.flags|=256,Vs(p,m,T,A),m.child}var Ef={dehydrated:null,treeContext:null,retryLane:0};function lg(p){return{baseLanes:p,cachePool:null,transitions:null}}function aT(p,m,T){var A=m.pendingProps,L=Si.current,W=!1,re=(m.flags&128)!==0,ye;if((ye=re)||(ye=p!==null&&p.memoizedState===null?!1:(L&2)!==0),ye?(W=!0,m.flags&=-129):(p===null||p.memoizedState!==null)&&(L|=1),di(Si,L&1),p===null)return LS(m),p=m.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((m.mode&1)===0?m.lanes=1:p.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(re=A.children,p=A.fallback,W?(A=m.mode,W=m.child,re={mode:"hidden",children:re},(A&1)===0&&W!==null?(W.childLanes=0,W.pendingProps=re):W=Yv(re,A,0,null),p=Hc(p,A,T,null),W.return=m,p.return=m,W.sibling=p,m.child=W,m.child.memoizedState=lg(T),m.memoizedState=Ef,p):yf(m,re));if(L=p.memoizedState,L!==null&&(ye=L.dehydrated,ye!==null))return nk(p,m,re,A,ye,L,T);if(W){W=A.fallback,re=m.mode,L=p.child,ye=L.sibling;var Ae={mode:"hidden",children:A.children};return(re&1)===0&&m.child!==L?(A=m.child,A.childLanes=0,A.pendingProps=Ae,m.deletions=null):(A=wd(L,Ae),A.subtreeFlags=L.subtreeFlags&14680064),ye!==null?W=wd(ye,W):(W=Hc(W,re,T,null),W.flags|=2),W.return=m,A.return=m,A.sibling=W,m.child=A,A=W,W=m.child,re=p.child.memoizedState,re=re===null?lg(T):{baseLanes:re.baseLanes|T,cachePool:null,transitions:re.transitions},W.memoizedState=re,W.childLanes=p.childLanes&~T,m.memoizedState=Ef,A}return W=p.child,p=W.sibling,A=wd(W,{mode:"visible",children:A.children}),(m.mode&1)===0&&(A.lanes=T),A.return=m,A.sibling=null,p!==null&&(T=m.deletions,T===null?(m.deletions=[p],m.flags|=16):T.push(p)),m.child=A,m.memoizedState=null,A}function yf(p,m){return m=Yv({mode:"visible",children:m},p.mode,0,null),m.return=p,p.child=m}function ug(p,m,T,A){return A!==null&&xS(A),Uh(m,p.child,null,T),p=yf(m,m.pendingProps.children),p.flags|=2,m.memoizedState=null,p}function nk(p,m,T,A,L,W,re){if(T)return m.flags&256?(m.flags&=-257,A=rT(Error(s(422))),ug(p,m,re,A)):m.memoizedState!==null?(m.child=p.child,m.flags|=128,null):(W=A.fallback,L=m.mode,A=Yv({mode:"visible",children:A.children},L,0,null),W=Hc(W,L,re,null),W.flags|=2,A.return=m,W.return=m,A.sibling=W,m.child=A,(m.mode&1)!==0&&Uh(m,p.child,null,re),m.child.memoizedState=lg(re),m.memoizedState=Ef,W);if((m.mode&1)===0)return ug(p,m,re,null);if(L.data==="$!"){if(A=L.nextSibling&&L.nextSibling.dataset,A)var ye=A.dgst;return A=ye,W=Error(s(419)),A=rT(W,A,void 0),ug(p,m,re,A)}if(ye=(re&p.childLanes)!==0,ia||ye){if(A=is,A!==null){switch(re&-re){case 4:L=2;break;case 16:L=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:L=32;break;case 536870912:L=268435456;break;default:L=0}L=(L&(A.suspendedLanes|re))!==0?0:L,L!==0&&L!==W.retryLane&&(W.retryLane=L,sc(p,L),Na(A,p,L,-1))}return Cu(),A=rT(Error(s(421))),ug(p,m,re,A)}return L.data==="$?"?(m.flags|=128,m.child=p.child,m=_C.bind(null,p),L._reactRetry=m,null):(p=W.treeContext,ra=ud(L.nextSibling),na=m,ti=!0,Ao=null,p!==null&&(rc[Aa++]=gu,rc[Aa++]=_u,rc[Aa++]=xh,gu=p.id,_u=p.overflow,xh=m),m=yf(m,A.children),m.flags|=4096,m)}function cT(p,m,T){p.lanes|=m;var A=p.alternate;A!==null&&(A.lanes|=m),wv(p.return,m,T)}function dg(p,m,T,A,L){var W=p.memoizedState;W===null?p.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:A,tail:T,tailMode:L}:(W.isBackwards=m,W.rendering=null,W.renderingStartTime=0,W.last=A,W.tail=T,W.tailMode=L)}function nC(p,m,T){var A=m.pendingProps,L=A.revealOrder,W=A.tail;if(Vs(p,m,A.children,T),A=Si.current,(A&2)!==0)A=A&1|2,m.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=m.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&cT(p,T,m);else if(p.tag===19)cT(p,T,m);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===m)break e;for(;p.sibling===null;){if(p.return===null||p.return===m)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}A&=1}if(di(Si,A),(m.mode&1)===0)m.memoizedState=null;else switch(L){case"forwards":for(T=m.child,L=null;T!==null;)p=T.alternate,p!==null&&mf(p)===null&&(L=T),T=T.sibling;T=L,T===null?(L=m.child,m.child=null):(L=T.sibling,T.sibling=null),dg(m,!1,L,T,W);break;case"backwards":for(T=null,L=m.child,m.child=null;L!==null;){if(p=L.alternate,p!==null&&mf(p)===null){m.child=L;break}p=L.sibling,L.sibling=T,T=L,L=p}dg(m,!0,T,null,W);break;case"together":dg(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function hg(p,m){(m.mode&1)===0&&p!==null&&(p.alternate=null,m.alternate=null,m.flags|=2)}function bl(p,m,T){if(p!==null&&(m.dependencies=p.dependencies),Gh|=m.lanes,(T&m.childLanes)===0)return null;if(p!==null&&m.child!==p.child)throw Error(s(153));if(m.child!==null){for(p=m.child,T=wd(p,p.pendingProps),m.child=T,T.return=m;p.sibling!==null;)p=p.sibling,T=T.sibling=wd(p,p.pendingProps),T.return=m;T.sibling=null}return m.child}function rk(p,m,T){switch(m.tag){case 3:eC(m),hf();break;case 5:rg(m);break;case 1:ta(m.type)&&_v(m);break;case 4:GS(m,m.stateNode.containerInfo);break;case 10:var A=m.type._context,L=m.memoizedProps.value;di(bv,A._currentValue),A._currentValue=L;break;case 13:if(A=m.memoizedState,A!==null)return A.dehydrated!==null?(di(Si,Si.current&1),m.flags|=128,null):(T&m.child.childLanes)!==0?aT(p,m,T):(di(Si,Si.current&1),p=bl(p,m,T),p!==null?p.sibling:null);di(Si,Si.current&1);break;case 19:if(A=(T&m.childLanes)!==0,(p.flags&128)!==0){if(A)return nC(p,m,T);m.flags|=128}if(L=m.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),di(Si,Si.current),A)break;return null;case 22:case 23:return m.lanes=0,QR(p,m,T)}return bl(p,m,T)}var lT,Mv,rC,iC;lT=function(p,m){for(var T=m.child;T!==null;){if(T.tag===5||T.tag===6)p.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===m)break;for(;T.sibling===null;){if(T.return===null||T.return===m)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},Mv=function(){},rC=function(p,m,T,A){var L=p.memoizedProps;if(L!==A){p=m.stateNode,Vh(Wc.current);var W=null;switch(T){case"input":L=Ar(p,L),A=Ar(p,A),W=[];break;case"select":L=Ee({},L,{value:void 0}),A=Ee({},A,{value:void 0}),W=[];break;case"textarea":L=ft(p,L),A=ft(p,A),W=[];break;default:typeof L.onClick!="function"&&typeof A.onClick=="function"&&(p.onclick=pv)}zi(T,A);var re;T=null;for(ze in L)if(!A.hasOwnProperty(ze)&&L.hasOwnProperty(ze)&&L[ze]!=null)if(ze==="style"){var ye=L[ze];for(re in ye)ye.hasOwnProperty(re)&&(T||(T={}),T[re]="")}else ze!=="dangerouslySetInnerHTML"&&ze!=="children"&&ze!=="suppressContentEditableWarning"&&ze!=="suppressHydrationWarning"&&ze!=="autoFocus"&&(l.hasOwnProperty(ze)?W||(W=[]):(W=W||[]).push(ze,null));for(ze in A){var Ae=A[ze];if(ye=L!=null?L[ze]:void 0,A.hasOwnProperty(ze)&&Ae!==ye&&(Ae!=null||ye!=null))if(ze==="style")if(ye){for(re in ye)!ye.hasOwnProperty(re)||Ae&&Ae.hasOwnProperty(re)||(T||(T={}),T[re]="");for(re in Ae)Ae.hasOwnProperty(re)&&ye[re]!==Ae[re]&&(T||(T={}),T[re]=Ae[re])}else T||(W||(W=[]),W.push(ze,T)),T=Ae;else ze==="dangerouslySetInnerHTML"?(Ae=Ae?Ae.__html:void 0,ye=ye?ye.__html:void 0,Ae!=null&&ye!==Ae&&(W=W||[]).push(ze,Ae)):ze==="children"?typeof Ae!="string"&&typeof Ae!="number"||(W=W||[]).push(ze,""+Ae):ze!=="suppressContentEditableWarning"&&ze!=="suppressHydrationWarning"&&(l.hasOwnProperty(ze)?(Ae!=null&&ze==="onScroll"&&_i("scroll",p),W||ye===Ae||(W=[])):(W=W||[]).push(ze,Ae))}T&&(W=W||[]).push("style",T);var ze=W;(m.updateQueue=ze)&&(m.flags|=4)}},iC=function(p,m,T,A){T!==A&&(m.flags|=4)};function pg(p,m){if(!ti)switch(p.tailMode){case"hidden":m=p.tail;for(var T=null;m!==null;)m.alternate!==null&&(T=m),m=m.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var A=null;T!==null;)T.alternate!==null&&(A=T),T=T.sibling;A===null?m||p.tail===null?p.tail=null:p.tail.sibling=null:A.sibling=null}}function gs(p){var m=p.alternate!==null&&p.alternate.child===p.child,T=0,A=0;if(m)for(var L=p.child;L!==null;)T|=L.lanes|L.childLanes,A|=L.subtreeFlags&14680064,A|=L.flags&14680064,L.return=p,L=L.sibling;else for(L=p.child;L!==null;)T|=L.lanes|L.childLanes,A|=L.subtreeFlags,A|=L.flags,L.return=p,L=L.sibling;return p.subtreeFlags|=A,p.childLanes=T,m}function ik(p,m,T){var A=m.pendingProps;switch(Jm(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gs(m),null;case 1:return ta(m.type)&&mv(),gs(m),null;case 3:return A=m.stateNode,ff(),vi(ea),vi(to),HS(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(p===null||p.child===null)&&(Qm(m)?m.flags|=4:p===null||p.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Ao!==null&&(Af(Ao),Ao=null))),Mv(p,m),gs(m),null;case 5:zS(m);var L=Vh(ng.current);if(T=m.type,p!==null&&m.stateNode!=null)rC(p,m,T,A,L),p.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!A){if(m.stateNode===null)throw Error(s(166));return gs(m),null}if(p=Vh(Wc.current),Qm(m)){A=m.stateNode,T=m.type;var W=m.memoizedProps;switch(A[yl]=m,A[dd]=W,p=(m.mode&1)!==0,T){case"dialog":_i("cancel",A),_i("close",A);break;case"iframe":case"object":case"embed":_i("load",A);break;case"video":case"audio":for(L=0;L<Hm.length;L++)_i(Hm[L],A);break;case"source":_i("error",A);break;case"img":case"image":case"link":_i("error",A),_i("load",A);break;case"details":_i("toggle",A);break;case"input":bt(A,W),_i("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!W.multiple},_i("invalid",A);break;case"textarea":dt(A,W),_i("invalid",A)}zi(T,W),L=null;for(var re in W)if(W.hasOwnProperty(re)){var ye=W[re];re==="children"?typeof ye=="string"?A.textContent!==ye&&(W.suppressHydrationWarning!==!0&&hv(A.textContent,ye,p),L=["children",ye]):typeof ye=="number"&&A.textContent!==""+ye&&(W.suppressHydrationWarning!==!0&&hv(A.textContent,ye,p),L=["children",""+ye]):l.hasOwnProperty(re)&&ye!=null&&re==="onScroll"&&_i("scroll",A)}switch(T){case"input":Dn(A),we(A,W,!0);break;case"textarea":Dn(A),Fn(A);break;case"select":case"option":break;default:typeof W.onClick=="function"&&(A.onclick=pv)}A=L,m.updateQueue=A,A!==null&&(m.flags|=4)}else{re=L.nodeType===9?L:L.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Cn(T)),p==="http://www.w3.org/1999/xhtml"?T==="script"?(p=re.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof A.is=="string"?p=re.createElement(T,{is:A.is}):(p=re.createElement(T),T==="select"&&(re=p,A.multiple?re.multiple=!0:A.size&&(re.size=A.size))):p=re.createElementNS(p,T),p[yl]=m,p[dd]=A,lT(p,m,!1,!1),m.stateNode=p;e:{switch(re=Nc(T,A),T){case"dialog":_i("cancel",p),_i("close",p),L=A;break;case"iframe":case"object":case"embed":_i("load",p),L=A;break;case"video":case"audio":for(L=0;L<Hm.length;L++)_i(Hm[L],p);L=A;break;case"source":_i("error",p),L=A;break;case"img":case"image":case"link":_i("error",p),_i("load",p),L=A;break;case"details":_i("toggle",p),L=A;break;case"input":bt(p,A),L=Ar(p,A),_i("invalid",p);break;case"option":L=A;break;case"select":p._wrapperState={wasMultiple:!!A.multiple},L=Ee({},A,{value:void 0}),_i("invalid",p);break;case"textarea":dt(p,A),L=ft(p,A),_i("invalid",p);break;default:L=A}zi(T,L),ye=L;for(W in ye)if(ye.hasOwnProperty(W)){var Ae=ye[W];W==="style"?Zs(p,Ae):W==="dangerouslySetInnerHTML"?(Ae=Ae?Ae.__html:void 0,Ae!=null&&ya(p,Ae)):W==="children"?typeof Ae=="string"?(T!=="textarea"||Ae!=="")&&ps(p,Ae):typeof Ae=="number"&&ps(p,""+Ae):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(l.hasOwnProperty(W)?Ae!=null&&W==="onScroll"&&_i("scroll",p):Ae!=null&&se(p,W,Ae,re))}switch(T){case"input":Dn(p),we(p,A,!1);break;case"textarea":Dn(p),Fn(p);break;case"option":A.value!=null&&p.setAttribute("value",""+Gt(A.value));break;case"select":p.multiple=!!A.multiple,W=A.value,W!=null?pt(p,!!A.multiple,W,!1):A.defaultValue!=null&&pt(p,!!A.multiple,A.defaultValue,!0);break;default:typeof L.onClick=="function"&&(p.onclick=pv)}switch(T){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return gs(m),null;case 6:if(p&&m.stateNode!=null)iC(p,m,p.memoizedProps,A);else{if(typeof A!="string"&&m.stateNode===null)throw Error(s(166));if(T=Vh(ng.current),Vh(Wc.current),Qm(m)){if(A=m.stateNode,T=m.memoizedProps,A[yl]=m,(W=A.nodeValue!==T)&&(p=na,p!==null))switch(p.tag){case 3:hv(A.nodeValue,T,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&hv(A.nodeValue,T,(p.mode&1)!==0)}W&&(m.flags|=4)}else A=(T.nodeType===9?T:T.ownerDocument).createTextNode(A),A[yl]=m,m.stateNode=A}return gs(m),null;case 13:if(vi(Si),A=m.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(ti&&ra!==null&&(m.mode&1)!==0&&(m.flags&128)===0)wR(),hf(),m.flags|=98560,W=!1;else if(W=Qm(m),A!==null&&A.dehydrated!==null){if(p===null){if(!W)throw Error(s(318));if(W=m.memoizedState,W=W!==null?W.dehydrated:null,!W)throw Error(s(317));W[yl]=m}else hf(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;gs(m),W=!1}else Ao!==null&&(Af(Ao),Ao=null),W=!0;if(!W)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=T,m):(A=A!==null,A!==(p!==null&&p.memoizedState!==null)&&A&&(m.child.flags|=8192,(m.mode&1)!==0&&(p===null||(Si.current&1)!==0?Pr===0&&(Pr=3):Cu())),m.updateQueue!==null&&(m.flags|=4),gs(m),null);case 4:return ff(),Mv(p,m),p===null&&Oh(m.stateNode.containerInfo),gs(m),null;case 10:return VS(m.type._context),gs(m),null;case 17:return ta(m.type)&&mv(),gs(m),null;case 19:if(vi(Si),W=m.memoizedState,W===null)return gs(m),null;if(A=(m.flags&128)!==0,re=W.rendering,re===null)if(A)pg(W,!1);else{if(Pr!==0||p!==null&&(p.flags&128)!==0)for(p=m.child;p!==null;){if(re=mf(p),re!==null){for(m.flags|=128,pg(W,!1),A=re.updateQueue,A!==null&&(m.updateQueue=A,m.flags|=4),m.subtreeFlags=0,A=T,T=m.child;T!==null;)W=T,p=A,W.flags&=14680066,re=W.alternate,re===null?(W.childLanes=0,W.lanes=p,W.child=null,W.subtreeFlags=0,W.memoizedProps=null,W.memoizedState=null,W.updateQueue=null,W.dependencies=null,W.stateNode=null):(W.childLanes=re.childLanes,W.lanes=re.lanes,W.child=re.child,W.subtreeFlags=0,W.deletions=null,W.memoizedProps=re.memoizedProps,W.memoizedState=re.memoizedState,W.updateQueue=re.updateQueue,W.type=re.type,p=re.dependencies,W.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),T=T.sibling;return di(Si,Si.current&1|2),m.child}p=p.sibling}W.tail!==null&&Mr()>zh&&(m.flags|=128,A=!0,pg(W,!1),m.lanes=4194304)}else{if(!A)if(p=mf(re),p!==null){if(m.flags|=128,A=!0,T=p.updateQueue,T!==null&&(m.updateQueue=T,m.flags|=4),pg(W,!0),W.tail===null&&W.tailMode==="hidden"&&!re.alternate&&!ti)return gs(m),null}else 2*Mr()-W.renderingStartTime>zh&&T!==1073741824&&(m.flags|=128,A=!0,pg(W,!1),m.lanes=4194304);W.isBackwards?(re.sibling=m.child,m.child=re):(T=W.last,T!==null?T.sibling=re:m.child=re,W.last=re)}return W.tail!==null?(m=W.tail,W.rendering=m,W.tail=m.sibling,W.renderingStartTime=Mr(),m.sibling=null,T=Si.current,di(Si,A?T&1|2:T&1),m):(gs(m),null);case 22:case 23:return $v(),A=m.memoizedState!==null,p!==null&&p.memoizedState!==null!==A&&(m.flags|=8192),A&&(m.mode&1)!==0?(Ns&1073741824)!==0&&(gs(m),m.subtreeFlags&6&&(m.flags|=8192)):gs(m),null;case 24:return null;case 25:return null}throw Error(s(156,m.tag))}function sk(p,m){switch(Jm(m),m.tag){case 1:return ta(m.type)&&mv(),p=m.flags,p&65536?(m.flags=p&-65537|128,m):null;case 3:return ff(),vi(ea),vi(to),HS(),p=m.flags,(p&65536)!==0&&(p&128)===0?(m.flags=p&-65537|128,m):null;case 5:return zS(m),null;case 13:if(vi(Si),p=m.memoizedState,p!==null&&p.dehydrated!==null){if(m.alternate===null)throw Error(s(340));hf()}return p=m.flags,p&65536?(m.flags=p&-65537|128,m):null;case 19:return vi(Si),null;case 4:return ff(),null;case 10:return VS(m.type._context),null;case 22:case 23:return $v(),null;case 24:return null;default:return null}}var Uv=!1,Fs=!1,ok=typeof WeakSet=="function"?WeakSet:Set,Ht=null;function Ed(p,m){var T=p.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(A){Ii(p,m,A)}else T.current=null}function uT(p,m,T){try{T()}catch(A){Ii(p,m,A)}}var Vv=!1;function ak(p,m){if(fv=_e,p=oR(),Wm(p)){if("selectionStart"in p)var T={start:p.selectionStart,end:p.selectionEnd};else e:{T=(T=p.ownerDocument)&&T.defaultView||window;var A=T.getSelection&&T.getSelection();if(A&&A.rangeCount!==0){T=A.anchorNode;var L=A.anchorOffset,W=A.focusNode;A=A.focusOffset;try{T.nodeType,W.nodeType}catch{T=null;break e}var re=0,ye=-1,Ae=-1,ze=0,vt=0,yt=p,_t=null;t:for(;;){for(var Vt;yt!==T||L!==0&&yt.nodeType!==3||(ye=re+L),yt!==W||A!==0&&yt.nodeType!==3||(Ae=re+A),yt.nodeType===3&&(re+=yt.nodeValue.length),(Vt=yt.firstChild)!==null;)_t=yt,yt=Vt;for(;;){if(yt===p)break t;if(_t===T&&++ze===L&&(ye=re),_t===W&&++vt===A&&(Ae=re),(Vt=yt.nextSibling)!==null)break;yt=_t,_t=yt.parentNode}yt=Vt}T=ye===-1||Ae===-1?null:{start:ye,end:Ae}}else T=null}T=T||{start:0,end:0}}else T=null;for($m={focusedElem:p,selectionRange:T},_e=!1,Ht=m;Ht!==null;)if(m=Ht,p=m.child,(m.subtreeFlags&1028)!==0&&p!==null)p.return=m,Ht=p;else for(;Ht!==null;){m=Ht;try{var zt=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(zt!==null){var $t=zt.memoizedProps,Ki=zt.memoizedState,Me=m.stateNode,Oe=Me.getSnapshotBeforeUpdate(m.elementType===m.type?$t:Bc(m.type,$t),Ki);Me.__reactInternalSnapshotBeforeUpdate=Oe}break;case 3:var je=m.stateNode.containerInfo;je.nodeType===1?je.textContent="":je.nodeType===9&&je.documentElement&&je.removeChild(je.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(wt){Ii(m,m.return,wt)}if(p=m.sibling,p!==null){p.return=m.return,Ht=p;break}Ht=m.return}return zt=Vv,Vv=!1,zt}function Sf(p,m,T){var A=m.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var L=A=A.next;do{if((L.tag&p)===p){var W=L.destroy;L.destroy=void 0,W!==void 0&&uT(m,T,W)}L=L.next}while(L!==A)}}function Fv(p,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var T=m=m.next;do{if((T.tag&p)===p){var A=T.create;T.destroy=A()}T=T.next}while(T!==m)}}function dT(p){var m=p.ref;if(m!==null){var T=p.stateNode;switch(p.tag){case 5:p=T;break;default:p=T}typeof m=="function"?m(p):m.current=p}}function hT(p){var m=p.alternate;m!==null&&(p.alternate=null,hT(m)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(m=p.stateNode,m!==null&&(delete m[yl],delete m[dd],delete m[Ym],delete m[KN],delete m[$N])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function sC(p){return p.tag===5||p.tag===3||p.tag===4}function oC(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||sC(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function jv(p,m,T){var A=p.tag;if(A===5||A===6)p=p.stateNode,m?T.nodeType===8?T.parentNode.insertBefore(p,m):T.insertBefore(p,m):(T.nodeType===8?(m=T.parentNode,m.insertBefore(p,T)):(m=T,m.appendChild(p)),T=T._reactRootContainer,T!=null||m.onclick!==null||(m.onclick=pv));else if(A!==4&&(p=p.child,p!==null))for(jv(p,m,T),p=p.sibling;p!==null;)jv(p,m,T),p=p.sibling}function pT(p,m,T){var A=p.tag;if(A===5||A===6)p=p.stateNode,m?T.insertBefore(p,m):T.appendChild(p);else if(A!==4&&(p=p.child,p!==null))for(pT(p,m,T),p=p.sibling;p!==null;)pT(p,m,T),p=p.sibling}var Ps=null,Pa=!1;function yd(p,m,T){for(T=T.child;T!==null;)aC(p,m,T),T=T.sibling}function aC(p,m,T){if(eo&&typeof eo.onCommitFiberUnmount=="function")try{eo.onCommitFiberUnmount(hl,T)}catch{}switch(T.tag){case 5:Fs||Ed(T,m);case 6:var A=Ps,L=Pa;Ps=null,yd(p,m,T),Ps=A,Pa=L,Ps!==null&&(Pa?(p=Ps,T=T.stateNode,p.nodeType===8?p.parentNode.removeChild(T):p.removeChild(T)):Ps.removeChild(T.stateNode));break;case 18:Ps!==null&&(Pa?(p=Ps,T=T.stateNode,p.nodeType===8?NS(p.parentNode,T):p.nodeType===1&&NS(p,T),Qo(p)):NS(Ps,T.stateNode));break;case 4:A=Ps,L=Pa,Ps=T.stateNode.containerInfo,Pa=!0,yd(p,m,T),Ps=A,Pa=L;break;case 0:case 11:case 14:case 15:if(!Fs&&(A=T.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){L=A=A.next;do{var W=L,re=W.destroy;W=W.tag,re!==void 0&&((W&2)!==0||(W&4)!==0)&&uT(T,m,re),L=L.next}while(L!==A)}yd(p,m,T);break;case 1:if(!Fs&&(Ed(T,m),A=T.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=T.memoizedProps,A.state=T.memoizedState,A.componentWillUnmount()}catch(ye){Ii(T,m,ye)}yd(p,m,T);break;case 21:yd(p,m,T);break;case 22:T.mode&1?(Fs=(A=Fs)||T.memoizedState!==null,yd(p,m,T),Fs=A):yd(p,m,T);break;default:yd(p,m,T)}}function Tf(p){var m=p.updateQueue;if(m!==null){p.updateQueue=null;var T=p.stateNode;T===null&&(T=p.stateNode=new ok),m.forEach(function(A){var L=ST.bind(null,p,A);T.has(A)||(T.add(A),A.then(L,L))})}}function ac(p,m){var T=m.deletions;if(T!==null)for(var A=0;A<T.length;A++){var L=T[A];try{var W=p,re=m,ye=re;e:for(;ye!==null;){switch(ye.tag){case 5:Ps=ye.stateNode,Pa=!1;break e;case 3:Ps=ye.stateNode.containerInfo,Pa=!0;break e;case 4:Ps=ye.stateNode.containerInfo,Pa=!0;break e}ye=ye.return}if(Ps===null)throw Error(s(160));aC(W,re,L),Ps=null,Pa=!1;var Ae=L.alternate;Ae!==null&&(Ae.return=null),L.return=null}catch(ze){Ii(L,m,ze)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)bf(m,p),m=m.sibling}function bf(p,m){var T=p.alternate,A=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(ac(m,p),Oo(p),A&4){try{Sf(3,p,p.return),Fv(3,p)}catch($t){Ii(p,p.return,$t)}try{Sf(5,p,p.return)}catch($t){Ii(p,p.return,$t)}}break;case 1:ac(m,p),Oo(p),A&512&&T!==null&&Ed(T,T.return);break;case 5:if(ac(m,p),Oo(p),A&512&&T!==null&&Ed(T,T.return),p.flags&32){var L=p.stateNode;try{ps(L,"")}catch($t){Ii(p,p.return,$t)}}if(A&4&&(L=p.stateNode,L!=null)){var W=p.memoizedProps,re=T!==null?T.memoizedProps:W,ye=p.type,Ae=p.updateQueue;if(p.updateQueue=null,Ae!==null)try{ye==="input"&&W.type==="radio"&&W.name!=null&&Sn(L,W),Nc(ye,re);var ze=Nc(ye,W);for(re=0;re<Ae.length;re+=2){var vt=Ae[re],yt=Ae[re+1];vt==="style"?Zs(L,yt):vt==="dangerouslySetInnerHTML"?ya(L,yt):vt==="children"?ps(L,yt):se(L,vt,yt,ze)}switch(ye){case"input":Tn(L,W);break;case"textarea":Mt(L,W);break;case"select":var _t=L._wrapperState.wasMultiple;L._wrapperState.wasMultiple=!!W.multiple;var Vt=W.value;Vt!=null?pt(L,!!W.multiple,Vt,!1):_t!==!!W.multiple&&(W.defaultValue!=null?pt(L,!!W.multiple,W.defaultValue,!0):pt(L,!!W.multiple,W.multiple?[]:"",!1))}L[dd]=W}catch($t){Ii(p,p.return,$t)}}break;case 6:if(ac(m,p),Oo(p),A&4){if(p.stateNode===null)throw Error(s(162));L=p.stateNode,W=p.memoizedProps;try{L.nodeValue=W}catch($t){Ii(p,p.return,$t)}}break;case 3:if(ac(m,p),Oo(p),A&4&&T!==null&&T.memoizedState.isDehydrated)try{Qo(m.containerInfo)}catch($t){Ii(p,p.return,$t)}break;case 4:ac(m,p),Oo(p);break;case 13:ac(m,p),Oo(p),L=p.child,L.flags&8192&&(W=L.memoizedState!==null,L.stateNode.isHidden=W,!W||L.alternate!==null&&L.alternate.memoizedState!==null||(gT=Mr())),A&4&&Tf(p);break;case 22:if(vt=T!==null&&T.memoizedState!==null,p.mode&1?(Fs=(ze=Fs)||vt,ac(m,p),Fs=ze):ac(m,p),Oo(p),A&8192){if(ze=p.memoizedState!==null,(p.stateNode.isHidden=ze)&&!vt&&(p.mode&1)!==0)for(Ht=p,vt=p.child;vt!==null;){for(yt=Ht=vt;Ht!==null;){switch(_t=Ht,Vt=_t.child,_t.tag){case 0:case 11:case 14:case 15:Sf(4,_t,_t.return);break;case 1:Ed(_t,_t.return);var zt=_t.stateNode;if(typeof zt.componentWillUnmount=="function"){A=_t,T=_t.return;try{m=A,zt.props=m.memoizedProps,zt.state=m.memoizedState,zt.componentWillUnmount()}catch($t){Ii(A,T,$t)}}break;case 5:Ed(_t,_t.return);break;case 22:if(_t.memoizedState!==null){lC(yt);continue}}Vt!==null?(Vt.return=_t,Ht=Vt):lC(yt)}vt=vt.sibling}e:for(vt=null,yt=p;;){if(yt.tag===5){if(vt===null){vt=yt;try{L=yt.stateNode,ze?(W=L.style,typeof W.setProperty=="function"?W.setProperty("display","none","important"):W.display="none"):(ye=yt.stateNode,Ae=yt.memoizedProps.style,re=Ae!=null&&Ae.hasOwnProperty("display")?Ae.display:null,ye.style.display=dn("display",re))}catch($t){Ii(p,p.return,$t)}}}else if(yt.tag===6){if(vt===null)try{yt.stateNode.nodeValue=ze?"":yt.memoizedProps}catch($t){Ii(p,p.return,$t)}}else if((yt.tag!==22&&yt.tag!==23||yt.memoizedState===null||yt===p)&&yt.child!==null){yt.child.return=yt,yt=yt.child;continue}if(yt===p)break e;for(;yt.sibling===null;){if(yt.return===null||yt.return===p)break e;vt===yt&&(vt=null),yt=yt.return}vt===yt&&(vt=null),yt.sibling.return=yt.return,yt=yt.sibling}}break;case 19:ac(m,p),Oo(p),A&4&&Tf(p);break;case 21:break;default:ac(m,p),Oo(p)}}function Oo(p){var m=p.flags;if(m&2){try{e:{for(var T=p.return;T!==null;){if(sC(T)){var A=T;break e}T=T.return}throw Error(s(160))}switch(A.tag){case 5:var L=A.stateNode;A.flags&32&&(ps(L,""),A.flags&=-33);var W=oC(p);pT(p,W,L);break;case 3:case 4:var re=A.stateNode.containerInfo,ye=oC(p);jv(p,ye,re);break;default:throw Error(s(161))}}catch(Ae){Ii(p,p.return,Ae)}p.flags&=-3}m&4096&&(p.flags&=-4097)}function cC(p,m,T){Ht=p,Bv(p)}function Bv(p,m,T){for(var A=(p.mode&1)!==0;Ht!==null;){var L=Ht,W=L.child;if(L.tag===22&&A){var re=L.memoizedState!==null||Uv;if(!re){var ye=L.alternate,Ae=ye!==null&&ye.memoizedState!==null||Fs;ye=Uv;var ze=Fs;if(Uv=re,(Fs=Ae)&&!ze)for(Ht=L;Ht!==null;)re=Ht,Ae=re.child,re.tag===22&&re.memoizedState!==null?uC(L):Ae!==null?(Ae.return=re,Ht=Ae):uC(L);for(;W!==null;)Ht=W,Bv(W),W=W.sibling;Ht=L,Uv=ye,Fs=ze}fg(p)}else(L.subtreeFlags&8772)!==0&&W!==null?(W.return=L,Ht=W):fg(p)}}function fg(p){for(;Ht!==null;){var m=Ht;if((m.flags&8772)!==0){var T=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:Fs||Fv(5,m);break;case 1:var A=m.stateNode;if(m.flags&4&&!Fs)if(T===null)A.componentDidMount();else{var L=m.elementType===m.type?T.memoizedProps:Bc(m.type,T.memoizedProps);A.componentDidUpdate(L,T.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var W=m.updateQueue;W!==null&&BS(m,W,A);break;case 3:var re=m.updateQueue;if(re!==null){if(T=null,m.child!==null)switch(m.child.tag){case 5:T=m.child.stateNode;break;case 1:T=m.child.stateNode}BS(m,re,T)}break;case 5:var ye=m.stateNode;if(T===null&&m.flags&4){T=ye;var Ae=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":Ae.autoFocus&&T.focus();break;case"img":Ae.src&&(T.src=Ae.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var ze=m.alternate;if(ze!==null){var vt=ze.memoizedState;if(vt!==null){var yt=vt.dehydrated;yt!==null&&Qo(yt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Fs||m.flags&512&&dT(m)}catch(_t){Ii(m,m.return,_t)}}if(m===p){Ht=null;break}if(T=m.sibling,T!==null){T.return=m.return,Ht=T;break}Ht=m.return}}function lC(p){for(;Ht!==null;){var m=Ht;if(m===p){Ht=null;break}var T=m.sibling;if(T!==null){T.return=m.return,Ht=T;break}Ht=m.return}}function uC(p){for(;Ht!==null;){var m=Ht;try{switch(m.tag){case 0:case 11:case 15:var T=m.return;try{Fv(4,m)}catch(Ae){Ii(m,T,Ae)}break;case 1:var A=m.stateNode;if(typeof A.componentDidMount=="function"){var L=m.return;try{A.componentDidMount()}catch(Ae){Ii(m,L,Ae)}}var W=m.return;try{dT(m)}catch(Ae){Ii(m,W,Ae)}break;case 5:var re=m.return;try{dT(m)}catch(Ae){Ii(m,re,Ae)}}}catch(Ae){Ii(m,m.return,Ae)}if(m===p){Ht=null;break}var ye=m.sibling;if(ye!==null){ye.return=m.return,Ht=ye;break}Ht=m.return}}var ck=Math.ceil,mg=le.ReactCurrentDispatcher,fT=le.ReactCurrentOwner,cc=le.ReactCurrentBatchConfig,vr=0,is=null,Ci=null,js=0,Ns=0,Wh=tc(0),Pr=0,gg=null,Gh=0,_g=0,mT=0,wf=null,Po=null,gT=0,zh=1/0,bu=null,Wv=!1,_T=null,wl=null,Rf=!1,Sd=null,Cf=0,vg=0,Gv=null,zv=-1,If=0;function _s(){return(vr&6)!==0?Mr():zv!==-1?zv:zv=Mr()}function wu(p){return(p.mode&1)===0?1:(vr&2)!==0&&js!==0?js&-js:YN.transition!==null?(If===0&&(If=cu()),If):(p=Xn,p!==0||(p=window.event,p=p===void 0?16:Ur(p.type)),p)}function Na(p,m,T,A){if(50<vg)throw vg=0,Gv=null,Error(s(185));ml(p,T,A),((vr&2)===0||p!==is)&&(p===is&&((vr&2)===0&&(_g|=T),Pr===4&&ka(p,js)),no(p,A),T===1&&vr===0&&(m.mode&1)===0&&(zh=Mr()+500,vv&&pd()))}function no(p,m){var T=p.callbackNode;ba(p,m);var A=fl(p,p===is?js:0);if(A===0)T!==null&&ou(T),p.callbackNode=null,p.callbackPriority=0;else if(m=A&-A,p.callbackPriority!==m){if(T!=null&&ou(T),m===1)p.tag===0?qN(Kv.bind(null,p)):yR(Kv.bind(null,p)),zN(function(){(vr&6)===0&&pd()}),T=null;else{switch(Ya(A)){case 1:T=qa;break;case 4:T=Lc;break;case 16:T=Xo;break;case 536870912:T=id;break;default:T=Xo}T=bg(T,vT.bind(null,p))}p.callbackPriority=m,p.callbackNode=T}}function vT(p,m){if(zv=-1,If=0,(vr&6)!==0)throw Error(s(327));var T=p.callbackNode;if(bd()&&p.callbackNode!==T)return null;var A=fl(p,p===is?js:0);if(A===0)return null;if((A&30)!==0||(A&p.expiredLanes)!==0||m)m=yg(p,A);else{m=A;var L=vr;vr|=2;var W=pC();(is!==p||js!==m)&&(bu=null,zh=Mr()+500,Td(p,m));do try{ET();break}catch(ye){hC(p,ye)}while(!0);US(),mg.current=W,vr=L,Ci!==null?m=0:(is=null,js=0,m=Pr)}if(m!==0){if(m===2&&(L=_o(p),L!==0&&(A=L,m=Hv(p,L))),m===1)throw T=gg,Td(p,0),ka(p,A),no(p,Mr()),T;if(m===6)ka(p,A);else{if(L=p.current.alternate,(A&30)===0&&!dC(L)&&(m=yg(p,A),m===2&&(W=_o(p),W!==0&&(A=W,m=Hv(p,W))),m===1))throw T=gg,Td(p,0),ka(p,A),no(p,Mr()),T;switch(p.finishedWork=L,p.finishedLanes=A,m){case 0:case 1:throw Error(s(345));case 2:Hh(p,Po,bu);break;case 3:if(ka(p,A),(A&130023424)===A&&(m=gT+500-Mr(),10<m)){if(fl(p,0)!==0)break;if(L=p.suspendedLanes,(L&A)!==A){_s(),p.pingedLanes|=p.suspendedLanes&L;break}p.timeoutHandle=qm(Hh.bind(null,p,Po,bu),m);break}Hh(p,Po,bu);break;case 4:if(ka(p,A),(A&4194240)===A)break;for(m=p.eventTimes,L=-1;0<A;){var re=31-Us(A);W=1<<re,re=m[re],re>L&&(L=re),A&=~W}if(A=L,A=Mr()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*ck(A/1960))-A,10<A){p.timeoutHandle=qm(Hh.bind(null,p,Po,bu),A);break}Hh(p,Po,bu);break;case 5:Hh(p,Po,bu);break;default:throw Error(s(329))}}}return no(p,Mr()),p.callbackNode===T?vT.bind(null,p):null}function Hv(p,m){var T=wf;return p.current.memoizedState.isDehydrated&&(Td(p,m).flags|=256),p=yg(p,m),p!==2&&(m=Po,Po=T,m!==null&&Af(m)),p}function Af(p){Po===null?Po=p:Po.push.apply(Po,p)}function dC(p){for(var m=p;;){if(m.flags&16384){var T=m.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var A=0;A<T.length;A++){var L=T[A],W=L.getSnapshot;L=L.value;try{if(!jc(W(),L))return!1}catch{return!1}}}if(T=m.child,m.subtreeFlags&16384&&T!==null)T.return=m,m=T;else{if(m===p)break;for(;m.sibling===null;){if(m.return===null||m.return===p)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function ka(p,m){for(m&=~mT,m&=~_g,p.suspendedLanes|=m,p.pingedLanes&=~m,p=p.expirationTimes;0<m;){var T=31-Us(m),A=1<<T;p[T]=-1,m&=~A}}function Kv(p){if((vr&6)!==0)throw Error(s(327));bd();var m=fl(p,0);if((m&1)===0)return no(p,Mr()),null;var T=yg(p,m);if(p.tag!==0&&T===2){var A=_o(p);A!==0&&(m=A,T=Hv(p,A))}if(T===1)throw T=gg,Td(p,0),ka(p,m),no(p,Mr()),T;if(T===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=m,Hh(p,Po,bu),no(p,Mr()),null}function Eg(p,m){var T=vr;vr|=1;try{return p(m)}finally{vr=T,vr===0&&(zh=Mr()+500,vv&&pd())}}function Ru(p){Sd!==null&&Sd.tag===0&&(vr&6)===0&&bd();var m=vr;vr|=1;var T=cc.transition,A=Xn;try{if(cc.transition=null,Xn=1,p)return p()}finally{Xn=A,cc.transition=T,vr=m,(vr&6)===0&&pd()}}function $v(){Ns=Wh.current,vi(Wh)}function Td(p,m){p.finishedWork=null,p.finishedLanes=0;var T=p.timeoutHandle;if(T!==-1&&(p.timeoutHandle=-1,GN(T)),Ci!==null)for(T=Ci.return;T!==null;){var A=T;switch(Jm(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&mv();break;case 3:ff(),vi(ea),vi(to),HS();break;case 5:zS(A);break;case 4:ff();break;case 13:vi(Si);break;case 19:vi(Si);break;case 10:VS(A.type._context);break;case 22:case 23:$v()}T=T.return}if(is=p,Ci=p=wd(p.current,null),js=Ns=m,Pr=0,gg=null,mT=_g=Gh=0,Po=wf=null,Mh!==null){for(m=0;m<Mh.length;m++)if(T=Mh[m],A=T.interleaved,A!==null){T.interleaved=null;var L=A.next,W=T.pending;if(W!==null){var re=W.next;W.next=L,A.next=re}T.pending=A}Mh=null}return p}function hC(p,m){do{var T=Ci;try{if(US(),Pv.current=Lv,Su){for(var A=Ri.memoizedState;A!==null;){var L=A.queue;L!==null&&(L.pending=null),A=A.next}Su=!1}if(Fh=0,Os=Ui=Ri=null,jh=!1,_d=0,fT.current=null,T===null||T.return===null){Pr=1,gg=m,Ci=null;break}e:{var W=p,re=T.return,ye=T,Ae=m;if(m=js,ye.flags|=32768,Ae!==null&&typeof Ae=="object"&&typeof Ae.then=="function"){var ze=Ae,vt=ye,yt=vt.tag;if((vt.mode&1)===0&&(yt===0||yt===11||yt===15)){var _t=vt.alternate;_t?(vt.updateQueue=_t.updateQueue,vt.memoizedState=_t.memoizedState,vt.lanes=_t.lanes):(vt.updateQueue=null,vt.memoizedState=null)}var Vt=$R(re);if(Vt!==null){Vt.flags&=-257,qR(Vt,re,ye,W,m),Vt.mode&1&&KR(W,ze,m),m=Vt,Ae=ze;var zt=m.updateQueue;if(zt===null){var $t=new Set;$t.add(Ae),m.updateQueue=$t}else zt.add(Ae);break e}else{if((m&1)===0){KR(W,ze,m),Cu();break e}Ae=Error(s(426))}}else if(ti&&ye.mode&1){var Ki=$R(re);if(Ki!==null){(Ki.flags&65536)===0&&(Ki.flags|=256),qR(Ki,re,ye,W,m),xS(vf(Ae,ye));break e}}W=Ae=vf(Ae,ye),Pr!==4&&(Pr=2),wf===null?wf=[W]:wf.push(W),W=re;do{switch(W.tag){case 3:W.flags|=65536,m&=-m,W.lanes|=m;var Me=Tu(W,Ae,m);Cv(W,Me);break e;case 1:ye=Ae;var Oe=W.type,je=W.stateNode;if((W.flags&128)===0&&(typeof Oe.getDerivedStateFromError=="function"||je!==null&&typeof je.componentDidCatch=="function"&&(wl===null||!wl.has(je)))){W.flags|=65536,m&=-m,W.lanes|=m;var wt=HR(W,ye,m);Cv(W,wt);break e}}W=W.return}while(W!==null)}mC(T)}catch(Yt){m=Yt,Ci===T&&T!==null&&(Ci=T=T.return);continue}break}while(!0)}function pC(){var p=mg.current;return mg.current=Lv,p===null?Lv:p}function Cu(){(Pr===0||Pr===3||Pr===2)&&(Pr=4),is===null||(Gh&268435455)===0&&(_g&268435455)===0||ka(is,js)}function yg(p,m){var T=vr;vr|=2;var A=pC();(is!==p||js!==m)&&(bu=null,Td(p,m));do try{lk();break}catch(L){hC(p,L)}while(!0);if(US(),vr=T,mg.current=A,Ci!==null)throw Error(s(261));return is=null,js=0,Pr}function lk(){for(;Ci!==null;)fC(Ci)}function ET(){for(;Ci!==null&&!go();)fC(Ci)}function fC(p){var m=Tg(p.alternate,p,Ns);p.memoizedProps=p.pendingProps,m===null?mC(p):Ci=m,fT.current=null}function mC(p){var m=p;do{var T=m.alternate;if(p=m.return,(m.flags&32768)===0){if(T=ik(T,m,Ns),T!==null){Ci=T;return}}else{if(T=sk(T,m),T!==null){T.flags&=32767,Ci=T;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Pr=6,Ci=null;return}}if(m=m.sibling,m!==null){Ci=m;return}Ci=m=p}while(m!==null);Pr===0&&(Pr=5)}function Hh(p,m,T){var A=Xn,L=cc.transition;try{cc.transition=null,Xn=1,uk(p,m,T,A)}finally{cc.transition=L,Xn=A}return null}function uk(p,m,T,A){do bd();while(Sd!==null);if((vr&6)!==0)throw Error(s(327));T=p.finishedWork;var L=p.finishedLanes;if(T===null)return null;if(p.finishedWork=null,p.finishedLanes=0,T===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var W=T.lanes|T.childLanes;if(Br(p,W),p===is&&(Ci=is=null,js=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Rf||(Rf=!0,bg(Xo,function(){return bd(),null})),W=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||W){W=cc.transition,cc.transition=null;var re=Xn;Xn=1;var ye=vr;vr|=4,fT.current=null,ak(p,T),bf(T,p),wS($m),_e=!!fv,$m=fv=null,p.current=T,cC(T),rd(),vr=ye,Xn=re,cc.transition=W}else p.current=T;if(Rf&&(Rf=!1,Sd=p,Cf=L),W=p.pendingLanes,W===0&&(wl=null),Kp(T.stateNode),no(p,Mr()),m!==null)for(A=p.onRecoverableError,T=0;T<m.length;T++)L=m[T],A(L.value,{componentStack:L.stack,digest:L.digest});if(Wv)throw Wv=!1,p=_T,_T=null,p;return(Cf&1)!==0&&p.tag!==0&&bd(),W=p.pendingLanes,(W&1)!==0?p===Gv?vg++:(vg=0,Gv=p):vg=0,pd(),null}function bd(){if(Sd!==null){var p=Ya(Cf),m=cc.transition,T=Xn;try{if(cc.transition=null,Xn=16>p?16:p,Sd===null)var A=!1;else{if(p=Sd,Sd=null,Cf=0,(vr&6)!==0)throw Error(s(331));var L=vr;for(vr|=4,Ht=p.current;Ht!==null;){var W=Ht,re=W.child;if((Ht.flags&16)!==0){var ye=W.deletions;if(ye!==null){for(var Ae=0;Ae<ye.length;Ae++){var ze=ye[Ae];for(Ht=ze;Ht!==null;){var vt=Ht;switch(vt.tag){case 0:case 11:case 15:Sf(8,vt,W)}var yt=vt.child;if(yt!==null)yt.return=vt,Ht=yt;else for(;Ht!==null;){vt=Ht;var _t=vt.sibling,Vt=vt.return;if(hT(vt),vt===ze){Ht=null;break}if(_t!==null){_t.return=Vt,Ht=_t;break}Ht=Vt}}}var zt=W.alternate;if(zt!==null){var $t=zt.child;if($t!==null){zt.child=null;do{var Ki=$t.sibling;$t.sibling=null,$t=Ki}while($t!==null)}}Ht=W}}if((W.subtreeFlags&2064)!==0&&re!==null)re.return=W,Ht=re;else e:for(;Ht!==null;){if(W=Ht,(W.flags&2048)!==0)switch(W.tag){case 0:case 11:case 15:Sf(9,W,W.return)}var Me=W.sibling;if(Me!==null){Me.return=W.return,Ht=Me;break e}Ht=W.return}}var Oe=p.current;for(Ht=Oe;Ht!==null;){re=Ht;var je=re.child;if((re.subtreeFlags&2064)!==0&&je!==null)je.return=re,Ht=je;else e:for(re=Oe;Ht!==null;){if(ye=Ht,(ye.flags&2048)!==0)try{switch(ye.tag){case 0:case 11:case 15:Fv(9,ye)}}catch(Yt){Ii(ye,ye.return,Yt)}if(ye===re){Ht=null;break e}var wt=ye.sibling;if(wt!==null){wt.return=ye.return,Ht=wt;break e}Ht=ye.return}}if(vr=L,pd(),eo&&typeof eo.onPostCommitFiberRoot=="function")try{eo.onPostCommitFiberRoot(hl,p)}catch{}A=!0}return A}finally{Xn=T,cc.transition=m}}return!1}function yT(p,m,T){m=vf(T,m),m=Tu(p,m,1),p=md(p,m,1),m=_s(),p!==null&&(ml(p,1,m),no(p,m))}function Ii(p,m,T){if(p.tag===3)yT(p,p,T);else for(;m!==null;){if(m.tag===3){yT(m,p,T);break}else if(m.tag===1){var A=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(wl===null||!wl.has(A))){p=vf(T,p),p=HR(m,p,1),m=md(m,p,1),p=_s(),m!==null&&(ml(m,1,p),no(m,p));break}}m=m.return}}function gC(p,m,T){var A=p.pingCache;A!==null&&A.delete(m),m=_s(),p.pingedLanes|=p.suspendedLanes&T,is===p&&(js&T)===T&&(Pr===4||Pr===3&&(js&130023424)===js&&500>Mr()-gT?Td(p,0):mT|=T),no(p,m)}function Sg(p,m){m===0&&((p.mode&1)===0?m=1:(m=or,or<<=1,(or&130023424)===0&&(or=4194304)));var T=_s();p=sc(p,m),p!==null&&(ml(p,m,T),no(p,T))}function _C(p){var m=p.memoizedState,T=0;m!==null&&(T=m.retryLane),Sg(p,T)}function ST(p,m){var T=0;switch(p.tag){case 13:var A=p.stateNode,L=p.memoizedState;L!==null&&(T=L.retryLane);break;case 19:A=p.stateNode;break;default:throw Error(s(314))}A!==null&&A.delete(m),Sg(p,T)}var Tg;Tg=function(p,m,T){if(p!==null)if(p.memoizedProps!==m.pendingProps||ea.current)ia=!0;else{if((p.lanes&T)===0&&(m.flags&128)===0)return ia=!1,rk(p,m,T);ia=(p.flags&131072)!==0}else ia=!1,ti&&(m.flags&1048576)!==0&&yv(m,Ev,m.index);switch(m.lanes=0,m.tag){case 2:var A=m.type;hg(p,m),p=m.pendingProps;var L=Lh(m,to.current);pf(m,T),L=Nv(null,m,A,p,L,T);var W=qS();return m.flags|=1,typeof L=="object"&&L!==null&&typeof L.render=="function"&&L.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,ta(A)?(W=!0,_v(m)):W=!1,m.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,jS(m),L.updater=Ov,m.stateNode=L,L._reactInternals=m,WS(m,A,p,T),m=xv(null,m,A,!0,W,T)):(m.tag=0,ti&&W&&Sv(m),Vs(null,m,L,T),m=m.child),m;case 16:A=m.elementType;e:{switch(hg(p,m),p=m.pendingProps,L=A._init,A=L(A._payload),m.type=A,L=m.tag=EC(A),p=Bc(A,p),L){case 0:m=sT(null,m,A,p,T);break e;case 1:m=oT(null,m,A,p,T);break e;case 11:m=YR(null,m,A,p,T);break e;case 14:m=XR(null,m,A,Bc(A.type,p),T);break e}throw Error(s(306,A,""))}return m;case 0:return A=m.type,L=m.pendingProps,L=m.elementType===A?L:Bc(A,L),sT(p,m,A,L,T);case 1:return A=m.type,L=m.pendingProps,L=m.elementType===A?L:Bc(A,L),oT(p,m,A,L,T);case 3:e:{if(eC(m),p===null)throw Error(s(387));A=m.pendingProps,W=m.memoizedState,L=W.element,CR(p,m),Iv(m,A,null,T);var re=m.memoizedState;if(A=re.element,W.isDehydrated)if(W={element:A,isDehydrated:!1,cache:re.cache,pendingSuspenseBoundaries:re.pendingSuspenseBoundaries,transitions:re.transitions},m.updateQueue.baseState=W,m.memoizedState=W,m.flags&256){L=vf(Error(s(423)),m),m=tC(p,m,A,T,L);break e}else if(A!==L){L=vf(Error(s(424)),m),m=tC(p,m,A,T,L);break e}else for(ra=ud(m.stateNode.containerInfo.firstChild),na=m,ti=!0,Ao=null,T=DR(m,null,A,T),m.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(hf(),A===L){m=bl(p,m,T);break e}Vs(p,m,A,T)}m=m.child}return m;case 5:return rg(m),p===null&&LS(m),A=m.type,L=m.pendingProps,W=p!==null?p.memoizedProps:null,re=L.children,PS(A,L)?re=null:W!==null&&PS(A,W)&&(m.flags|=32),ZR(p,m),Vs(p,m,re,T),m.child;case 6:return p===null&&LS(m),null;case 13:return aT(p,m,T);case 4:return GS(m,m.stateNode.containerInfo),A=m.pendingProps,p===null?m.child=Uh(m,null,A,T):Vs(p,m,A,T),m.child;case 11:return A=m.type,L=m.pendingProps,L=m.elementType===A?L:Bc(A,L),YR(p,m,A,L,T);case 7:return Vs(p,m,m.pendingProps,T),m.child;case 8:return Vs(p,m,m.pendingProps.children,T),m.child;case 12:return Vs(p,m,m.pendingProps.children,T),m.child;case 10:e:{if(A=m.type._context,L=m.pendingProps,W=m.memoizedProps,re=L.value,di(bv,A._currentValue),A._currentValue=re,W!==null)if(jc(W.value,re)){if(W.children===L.children&&!ea.current){m=bl(p,m,T);break e}}else for(W=m.child,W!==null&&(W.return=m);W!==null;){var ye=W.dependencies;if(ye!==null){re=W.child;for(var Ae=ye.firstContext;Ae!==null;){if(Ae.context===A){if(W.tag===1){Ae=Eu(-1,T&-T),Ae.tag=2;var ze=W.updateQueue;if(ze!==null){ze=ze.shared;var vt=ze.pending;vt===null?Ae.next=Ae:(Ae.next=vt.next,vt.next=Ae),ze.pending=Ae}}W.lanes|=T,Ae=W.alternate,Ae!==null&&(Ae.lanes|=T),wv(W.return,T,m),ye.lanes|=T;break}Ae=Ae.next}}else if(W.tag===10)re=W.type===m.type?null:W.child;else if(W.tag===18){if(re=W.return,re===null)throw Error(s(341));re.lanes|=T,ye=re.alternate,ye!==null&&(ye.lanes|=T),wv(re,T,m),re=W.sibling}else re=W.child;if(re!==null)re.return=W;else for(re=W;re!==null;){if(re===m){re=null;break}if(W=re.sibling,W!==null){W.return=re.return,re=W;break}re=re.return}W=re}Vs(p,m,L.children,T),m=m.child}return m;case 9:return L=m.type,A=m.pendingProps.children,pf(m,T),L=Oa(L),A=A(L),m.flags|=1,Vs(p,m,A,T),m.child;case 14:return A=m.type,L=Bc(A,m.pendingProps),L=Bc(A.type,L),XR(p,m,A,L,T);case 15:return JR(p,m,m.type,m.pendingProps,T);case 17:return A=m.type,L=m.pendingProps,L=m.elementType===A?L:Bc(A,L),hg(p,m),m.tag=1,ta(A)?(p=!0,_v(m)):p=!1,pf(m,T),OR(m,A,L),WS(m,A,L,T),xv(null,m,A,!0,p,T);case 19:return nC(p,m,T);case 22:return QR(p,m,T)}throw Error(s(156,m.tag))};function bg(p,m){return nd(p,m)}function vC(p,m,T,A){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bs(p,m,T,A){return new vC(p,m,T,A)}function Iu(p){return p=p.prototype,!(!p||!p.isReactComponent)}function EC(p){if(typeof p=="function")return Iu(p)?1:0;if(p!=null){if(p=p.$$typeof,p===pe)return 11;if(p===mt)return 14}return 2}function wd(p,m){var T=p.alternate;return T===null?(T=Bs(p.tag,m,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=m,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&14680064,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,m=p.dependencies,T.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T}function qv(p,m,T,A,L,W){var re=2;if(A=p,typeof p=="function")Iu(p)&&(re=1);else if(typeof p=="string")re=5;else e:switch(p){case Z:return Hc(T.children,L,W,m);case te:re=8,L|=8;break;case ie:return p=Bs(12,T,m,L|2),p.elementType=ie,p.lanes=W,p;case de:return p=Bs(13,T,m,L),p.elementType=de,p.lanes=W,p;case ut:return p=Bs(19,T,m,L),p.elementType=ut,p.lanes=W,p;case Be:return Yv(T,L,W,m);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ae:re=10;break e;case ve:re=9;break e;case pe:re=11;break e;case mt:re=14;break e;case Ze:re=16,A=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return m=Bs(re,T,m,L),m.elementType=p,m.type=A,m.lanes=W,m}function Hc(p,m,T,A){return p=Bs(7,p,A,m),p.lanes=T,p}function Yv(p,m,T,A){return p=Bs(22,p,A,m),p.elementType=Be,p.lanes=T,p.stateNode={isHidden:!1},p}function TT(p,m,T){return p=Bs(6,p,null,m),p.lanes=T,p}function bT(p,m,T){return m=Bs(4,p.children!==null?p.children:[],p.key,m),m.lanes=T,m.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},m}function dk(p,m,T,A,L){this.tag=m,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mc(0),this.expirationTimes=Mc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mc(0),this.identifierPrefix=A,this.onRecoverableError=L,this.mutableSourceEagerHydrationData=null}function wT(p,m,T,A,L,W,re,ye,Ae){return p=new dk(p,m,T,ye,Ae),m===1?(m=1,W===!0&&(m|=8)):m=0,W=Bs(3,null,null,m),p.current=W,W.stateNode=p,W.memoizedState={element:A,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},jS(W),p}function hk(p,m,T){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Se,key:A==null?null:""+A,children:p,containerInfo:m,implementation:T}}function Xv(p){if(!p)return hd;p=p._reactInternals;e:{if(Is(p)!==p||p.tag!==1)throw Error(s(170));var m=p;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(ta(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(s(171))}if(p.tag===1){var T=p.type;if(ta(T))return gv(p,T,m)}return m}function RT(p,m,T,A,L,W,re,ye,Ae){return p=wT(T,A,!0,p,L,W,re,ye,Ae),p.context=Xv(null),T=p.current,A=_s(),L=wu(T),W=Eu(A,L),W.callback=m??null,md(T,W,L),p.current.lanes=L,ml(p,L,A),no(p,A),p}function Jv(p,m,T,A){var L=m.current,W=_s(),re=wu(L);return T=Xv(T),m.context===null?m.context=T:m.pendingContext=T,m=Eu(W,re),m.payload={element:p},A=A===void 0?null:A,A!==null&&(m.callback=A),p=md(L,m,re),p!==null&&(Na(p,L,re,W),Rv(p,L,re)),re}function wg(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function yC(p,m){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<m?T:m}}function Kh(p,m){yC(p,m),(p=p.alternate)&&yC(p,m)}function Rl(){return null}var CT=typeof reportError=="function"?reportError:function(p){console.error(p)};function IT(p){this._internalRoot=p}Qv.prototype.render=IT.prototype.render=function(p){var m=this._internalRoot;if(m===null)throw Error(s(409));Jv(p,m,null,null)},Qv.prototype.unmount=IT.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var m=p.containerInfo;Ru(function(){Jv(null,p,null,null)}),m[ec]=null}};function Qv(p){this._internalRoot=p}Qv.prototype.unstable_scheduleHydration=function(p){if(p){var m=Sh();p={blockedOn:null,target:p,priority:m};for(var T=0;T<To.length&&m!==0&&m<To[T].priority;T++);To.splice(T,0,p),T===0&&bh(p)}};function Rg(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Cg(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function SC(){}function Zv(p,m,T,A,L){if(L){if(typeof A=="function"){var W=A;A=function(){var ze=wg(re);W.call(ze)}}var re=RT(m,A,p,0,null,!1,!1,"",SC);return p._reactRootContainer=re,p[ec]=re.current,Oh(p.nodeType===8?p.parentNode:p),Ru(),re}for(;L=p.lastChild;)p.removeChild(L);if(typeof A=="function"){var ye=A;A=function(){var ze=wg(Ae);ye.call(ze)}}var Ae=wT(p,0,!1,null,null,!1,!1,"",SC);return p._reactRootContainer=Ae,p[ec]=Ae.current,Oh(p.nodeType===8?p.parentNode:p),Ru(function(){Jv(m,Ae,T,A)}),Ae}function Kc(p,m,T,A,L){var W=T._reactRootContainer;if(W){var re=W;if(typeof L=="function"){var ye=L;L=function(){var Ae=wg(re);ye.call(Ae)}}Jv(m,re,p,L)}else re=Zv(T,m,p,L,A);return wg(re)}$p=function(p){switch(p.tag){case 3:var m=p.stateNode;if(m.current.memoizedState.isDehydrated){var T=pl(m.pendingLanes);T!==0&&(wa(m,T|1),no(m,Mr()),(vr&6)===0&&(zh=Mr()+500,pd()))}break;case 13:Ru(function(){var A=sc(p,1);if(A!==null){var L=_s();Na(A,p,1,L)}}),Kh(p,1)}},gl=function(p){if(p.tag===13){var m=sc(p,134217728);if(m!==null){var T=_s();Na(m,p,134217728,T)}Kh(p,134217728)}},ad=function(p){if(p.tag===13){var m=wu(p),T=sc(p,m);if(T!==null){var A=_s();Na(T,p,m,A)}Kh(p,m)}},Sh=function(){return Xn},qp=function(p,m){var T=Xn;try{return Xn=p,m()}finally{Xn=T}},za=function(p,m,T){switch(m){case"input":if(Tn(p,T),m=T.name,T.type==="radio"&&m!=null){for(T=p;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<T.length;m++){var A=T[m];if(A!==p&&A.form===p.form){var L=lf(A);if(!L)throw Error(s(90));un(A),Tn(A,L)}}}break;case"textarea":Mt(p,T);break;case"select":m=T.value,m!=null&&pt(p,!!T.multiple,m,!1)}},nu=Eg,Ka=Ru;var Ig={usingClientEntryPoint:!1,Events:[cf,kh,lf,Ha,kc,Eg]},Ag={findFiberByHostInstance:Nh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},pk={bundleType:Ag.bundleType,version:Ag.version,rendererPackageName:Ag.rendererPackageName,rendererConfig:Ag.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:le.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=td(p),p===null?null:p.stateNode},findFiberByHostInstance:Ag.findFiberByHostInstance||Rl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var eE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!eE.isDisabled&&eE.supportsFiber)try{hl=eE.inject(pk),eo=eE}catch{}}return Tc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ig,Tc.createPortal=function(p,m){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rg(m))throw Error(s(200));return hk(p,m,null,T)},Tc.createRoot=function(p,m){if(!Rg(p))throw Error(s(299));var T=!1,A="",L=CT;return m!=null&&(m.unstable_strictMode===!0&&(T=!0),m.identifierPrefix!==void 0&&(A=m.identifierPrefix),m.onRecoverableError!==void 0&&(L=m.onRecoverableError)),m=wT(p,1,!1,null,null,T,!1,A,L),p[ec]=m.current,Oh(p.nodeType===8?p.parentNode:p),new IT(m)},Tc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var m=p._reactInternals;if(m===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=td(m),p=p===null?null:p.stateNode,p},Tc.flushSync=function(p){return Ru(p)},Tc.hydrate=function(p,m,T){if(!Cg(m))throw Error(s(200));return Kc(null,p,m,!0,T)},Tc.hydrateRoot=function(p,m,T){if(!Rg(p))throw Error(s(405));var A=T!=null&&T.hydratedSources||null,L=!1,W="",re=CT;if(T!=null&&(T.unstable_strictMode===!0&&(L=!0),T.identifierPrefix!==void 0&&(W=T.identifierPrefix),T.onRecoverableError!==void 0&&(re=T.onRecoverableError)),m=RT(m,null,p,1,T??null,L,!1,W,re),p[ec]=m.current,Oh(p),A)for(p=0;p<A.length;p++)T=A[p],L=T._getVersion,L=L(T._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[T,L]:m.mutableSourceEagerHydrationData.push(T,L);return new Qv(m)},Tc.render=function(p,m,T){if(!Cg(m))throw Error(s(200));return Kc(null,p,m,!1,T)},Tc.unmountComponentAtNode=function(p){if(!Cg(p))throw Error(s(40));return p._reactRootContainer?(Ru(function(){Kc(null,null,p,!1,function(){p._reactRootContainer=null,p[ec]=null})}),!0):!1},Tc.unstable_batchedUpdates=Eg,Tc.unstable_renderSubtreeIntoContainer=function(p,m,T,A){if(!Cg(T))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return Kc(p,m,T,!1,A)},Tc.version="18.2.0-next-9e3b772b8-20220608",Tc}var w9;function yY(){if(w9)return sx.exports;w9=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),sx.exports=Ife(),sx.exports}var R9;function Afe(){if(R9)return BA;R9=1;var r=yY();return BA.createRoot=r.createRoot,BA.hydrateRoot=r.hydrateRoot,BA}var Ofe=Afe();const Pfe=lS(Ofe);function Nfe(r){if(r.sheet)return r.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===r)return document.styleSheets[t]}function kfe(r){var t=document.createElement("style");return t.setAttribute("data-emotion",r.key),r.nonce!==void 0&&t.setAttribute("nonce",r.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var Dfe=function(){function r(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=r.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(kfe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=Nfe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){return a.parentNode&&a.parentNode.removeChild(a)}),this.tags=[],this.ctr=0},r}(),pa="-ms-",XO="-moz-",Hr="-webkit-",SY="comm",nU="rule",rU="decl",Lfe="@import",TY="@keyframes",xfe="@layer",Mfe=Math.abs,xP=String.fromCharCode,Ufe=Object.assign;function Vfe(r,t){return Wo(r,0)^45?(((t<<2^Wo(r,0))<<2^Wo(r,1))<<2^Wo(r,2))<<2^Wo(r,3):0}function bY(r){return r.trim()}function Ffe(r,t){return(r=t.exec(r))?r[0]:r}function Kr(r,t,s){return r.replace(t,s)}function OM(r,t){return r.indexOf(t)}function Wo(r,t){return r.charCodeAt(t)|0}function Fb(r,t,s){return r.slice(t,s)}function Yd(r){return r.length}function iU(r){return r.length}function WA(r,t){return t.push(r),r}function jfe(r,t){return r.map(t).join("")}var MP=1,Hy=1,wY=0,Oc=0,Ls=0,uS="";function UP(r,t,s,a,l,d,g){return{value:r,root:t,parent:s,type:a,props:l,children:d,line:MP,column:Hy,length:g,return:""}}function j0(r,t){return Ufe(UP("",null,null,"",null,null,0),r,{length:-r.length},t)}function Bfe(){return Ls}function Wfe(){return Ls=Oc>0?Wo(uS,--Oc):0,Hy--,Ls===10&&(Hy=1,MP--),Ls}function cl(){return Ls=Oc<wY?Wo(uS,Oc++):0,Hy++,Ls===10&&(Hy=1,MP++),Ls}function nh(){return Wo(uS,Oc)}function _O(){return Oc}function gw(r,t){return Fb(uS,r,t)}function jb(r){switch(r){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function RY(r){return MP=Hy=1,wY=Yd(uS=r),Oc=0,[]}function CY(r){return uS="",r}function vO(r){return bY(gw(Oc-1,PM(r===91?r+2:r===40?r+1:r)))}function Gfe(r){for(;(Ls=nh())&&Ls<33;)cl();return jb(r)>2||jb(Ls)>3?"":" "}function zfe(r,t){for(;--t&&cl()&&!(Ls<48||Ls>102||Ls>57&&Ls<65||Ls>70&&Ls<97););return gw(r,_O()+(t<6&&nh()==32&&cl()==32))}function PM(r){for(;cl();)switch(Ls){case r:return Oc;case 34:case 39:r!==34&&r!==39&&PM(Ls);break;case 40:r===41&&PM(r);break;case 92:cl();break}return Oc}function Hfe(r,t){for(;cl()&&r+Ls!==57;)if(r+Ls===84&&nh()===47)break;return"/*"+gw(t,Oc-1)+"*"+xP(r===47?r:cl())}function Kfe(r){for(;!jb(nh());)cl();return gw(r,Oc)}function $fe(r){return CY(EO("",null,null,null,[""],r=RY(r),0,[0],r))}function EO(r,t,s,a,l,d,g,E,S){for(var b=0,R=0,O=g,N=0,U=0,K=0,z=1,H=1,ne=1,J=0,se="",le=l,ce=d,Se=a,Z=se;H;)switch(K=J,J=cl()){case 40:if(K!=108&&Wo(Z,O-1)==58){OM(Z+=Kr(vO(J),"&","&\f"),"&\f")!=-1&&(ne=-1);break}case 34:case 39:case 91:Z+=vO(J);break;case 9:case 10:case 13:case 32:Z+=Gfe(K);break;case 92:Z+=zfe(_O()-1,7);continue;case 47:switch(nh()){case 42:case 47:WA(qfe(Hfe(cl(),_O()),t,s),S);break;default:Z+="/"}break;case 123*z:E[b++]=Yd(Z)*ne;case 125*z:case 59:case 0:switch(J){case 0:case 125:H=0;case 59+R:ne==-1&&(Z=Kr(Z,/\f/g,"")),U>0&&Yd(Z)-O&&WA(U>32?I9(Z+";",a,s,O-1):I9(Kr(Z," ","")+";",a,s,O-2),S);break;case 59:Z+=";";default:if(WA(Se=C9(Z,t,s,b,R,l,E,se,le=[],ce=[],O),d),J===123)if(R===0)EO(Z,t,Se,Se,le,d,O,E,ce);else switch(N===99&&Wo(Z,3)===110?100:N){case 100:case 108:case 109:case 115:EO(r,Se,Se,a&&WA(C9(r,Se,Se,0,0,l,E,se,l,le=[],O),ce),l,ce,O,E,a?le:ce);break;default:EO(Z,Se,Se,Se,[""],ce,0,E,ce)}}b=R=U=0,z=ne=1,se=Z="",O=g;break;case 58:O=1+Yd(Z),U=K;default:if(z<1){if(J==123)--z;else if(J==125&&z++==0&&Wfe()==125)continue}switch(Z+=xP(J),J*z){case 38:ne=R>0?1:(Z+="\f",-1);break;case 44:E[b++]=(Yd(Z)-1)*ne,ne=1;break;case 64:nh()===45&&(Z+=vO(cl())),N=nh(),R=O=Yd(se=Z+=Kfe(_O())),J++;break;case 45:K===45&&Yd(Z)==2&&(z=0)}}return d}function C9(r,t,s,a,l,d,g,E,S,b,R){for(var O=l-1,N=l===0?d:[""],U=iU(N),K=0,z=0,H=0;K<a;++K)for(var ne=0,J=Fb(r,O+1,O=Mfe(z=g[K])),se=r;ne<U;++ne)(se=bY(z>0?N[ne]+" "+J:Kr(J,/&\f/g,N[ne])))&&(S[H++]=se);return UP(r,t,s,l===0?nU:E,S,b,R)}function qfe(r,t,s){return UP(r,t,s,SY,xP(Bfe()),Fb(r,2,-2),0)}function I9(r,t,s,a){return UP(r,t,s,rU,Fb(r,0,a),Fb(r,a+1,-1),a)}function Ny(r,t){for(var s="",a=iU(r),l=0;l<a;l++)s+=t(r[l],l,r,t)||"";return s}function Yfe(r,t,s,a){switch(r.type){case xfe:if(r.children.length)break;case Lfe:case rU:return r.return=r.return||r.value;case SY:return"";case TY:return r.return=r.value+"{"+Ny(r.children,a)+"}";case nU:r.value=r.props.join(",")}return Yd(s=Ny(r.children,a))?r.return=r.value+"{"+s+"}":""}function Xfe(r){var t=iU(r);return function(s,a,l,d){for(var g="",E=0;E<t;E++)g+=r[E](s,a,l,d)||"";return g}}function Jfe(r){return function(t){t.root||(t=t.return)&&r(t)}}var A9=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function IY(r){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=r(s)),t[s]}}var Qfe=function(t,s,a){for(var l=0,d=0;l=d,d=nh(),l===38&&d===12&&(s[a]=1),!jb(d);)cl();return gw(t,Oc)},Zfe=function(t,s){var a=-1,l=44;do switch(jb(l)){case 0:l===38&&nh()===12&&(s[a]=1),t[a]+=Qfe(Oc-1,s,a);break;case 2:t[a]+=vO(l);break;case 4:if(l===44){t[++a]=nh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=xP(l)}while(l=cl());return t},eme=function(t,s){return CY(Zfe(RY(t),s))},O9=new WeakMap,tme=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!O9.get(a))&&!l){O9.set(t,!0);for(var d=[],g=eme(s,d),E=a.props,S=0,b=0;S<g.length;S++)for(var R=0;R<E.length;R++,b++)t.props[b]=d[S]?g[S].replace(/&\f/g,E[R]):E[R]+" "+g[S]}}},nme=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function AY(r,t){switch(Vfe(r,t)){case 5103:return Hr+"print-"+r+r;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Hr+r+r;case 5349:case 4246:case 4810:case 6968:case 2756:return Hr+r+XO+r+pa+r+r;case 6828:case 4268:return Hr+r+pa+r+r;case 6165:return Hr+r+pa+"flex-"+r+r;case 5187:return Hr+r+Kr(r,/(\w+).+(:[^]+)/,Hr+"box-$1$2"+pa+"flex-$1$2")+r;case 5443:return Hr+r+pa+"flex-item-"+Kr(r,/flex-|-self/,"")+r;case 4675:return Hr+r+pa+"flex-line-pack"+Kr(r,/align-content|flex-|-self/,"")+r;case 5548:return Hr+r+pa+Kr(r,"shrink","negative")+r;case 5292:return Hr+r+pa+Kr(r,"basis","preferred-size")+r;case 6060:return Hr+"box-"+Kr(r,"-grow","")+Hr+r+pa+Kr(r,"grow","positive")+r;case 4554:return Hr+Kr(r,/([^-])(transform)/g,"$1"+Hr+"$2")+r;case 6187:return Kr(Kr(Kr(r,/(zoom-|grab)/,Hr+"$1"),/(image-set)/,Hr+"$1"),r,"")+r;case 5495:case 3959:return Kr(r,/(image-set\([^]*)/,Hr+"$1$`$1");case 4968:return Kr(Kr(r,/(.+:)(flex-)?(.*)/,Hr+"box-pack:$3"+pa+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Hr+r+r;case 4095:case 3583:case 4068:case 2532:return Kr(r,/(.+)-inline(.+)/,Hr+"$1$2")+r;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Yd(r)-1-t>6)switch(Wo(r,t+1)){case 109:if(Wo(r,t+4)!==45)break;case 102:return Kr(r,/(.+:)(.+)-([^]+)/,"$1"+Hr+"$2-$3$1"+XO+(Wo(r,t+3)==108?"$3":"$2-$3"))+r;case 115:return~OM(r,"stretch")?AY(Kr(r,"stretch","fill-available"),t)+r:r}break;case 4949:if(Wo(r,t+1)!==115)break;case 6444:switch(Wo(r,Yd(r)-3-(~OM(r,"!important")&&10))){case 107:return Kr(r,":",":"+Hr)+r;case 101:return Kr(r,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Hr+(Wo(r,14)===45?"inline-":"")+"box$3$1"+Hr+"$2$3$1"+pa+"$2box$3")+r}break;case 5936:switch(Wo(r,t+11)){case 114:return Hr+r+pa+Kr(r,/[svh]\w+-[tblr]{2}/,"tb")+r;case 108:return Hr+r+pa+Kr(r,/[svh]\w+-[tblr]{2}/,"tb-rl")+r;case 45:return Hr+r+pa+Kr(r,/[svh]\w+-[tblr]{2}/,"lr")+r}return Hr+r+pa+r+r}return r}var rme=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case rU:t.return=AY(t.value,t.length);break;case TY:return Ny([j0(t,{value:Kr(t.value,"@","@"+Hr)})],l);case nU:if(t.length)return jfe(t.props,function(d){switch(Ffe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Ny([j0(t,{props:[Kr(d,/:(read-\w+)/,":"+XO+"$1")]})],l);case"::placeholder":return Ny([j0(t,{props:[Kr(d,/:(plac\w+)/,":"+Hr+"input-$1")]}),j0(t,{props:[Kr(d,/:(plac\w+)/,":"+XO+"$1")]}),j0(t,{props:[Kr(d,/:(plac\w+)/,pa+"input-$1")]})],l)}return""})}},ime=[rme],sme=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(z){var H=z.getAttribute("data-emotion");H.indexOf(" ")!==-1&&(document.head.appendChild(z),z.setAttribute("data-s",""))})}var l=t.stylisPlugins||ime,d={},g,E=[];g=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(z){for(var H=z.getAttribute("data-emotion").split(" "),ne=1;ne<H.length;ne++)d[H[ne]]=!0;E.push(z)});var S,b=[tme,nme];{var R,O=[Yfe,Jfe(function(z){R.insert(z)})],N=Xfe(b.concat(l,O)),U=function(H){return Ny($fe(H),N)};S=function(H,ne,J,se){R=J,U(H?H+"{"+ne.styles+"}":ne.styles),se&&(K.inserted[ne.name]=!0)}}var K={key:s,sheet:new Dfe({key:s,container:g,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:S};return K.sheet.hydrate(E),K};function U_(){return U_=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},U_.apply(this,arguments)}var cx={exports:{}},Zr={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P9;function ome(){if(P9)return Zr;P9=1;var r=typeof Symbol=="function"&&Symbol.for,t=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,d=r?Symbol.for("react.profiler"):60114,g=r?Symbol.for("react.provider"):60109,E=r?Symbol.for("react.context"):60110,S=r?Symbol.for("react.async_mode"):60111,b=r?Symbol.for("react.concurrent_mode"):60111,R=r?Symbol.for("react.forward_ref"):60112,O=r?Symbol.for("react.suspense"):60113,N=r?Symbol.for("react.suspense_list"):60120,U=r?Symbol.for("react.memo"):60115,K=r?Symbol.for("react.lazy"):60116,z=r?Symbol.for("react.block"):60121,H=r?Symbol.for("react.fundamental"):60117,ne=r?Symbol.for("react.responder"):60118,J=r?Symbol.for("react.scope"):60119;function se(ce){if(typeof ce=="object"&&ce!==null){var Se=ce.$$typeof;switch(Se){case t:switch(ce=ce.type,ce){case S:case b:case a:case d:case l:case O:return ce;default:switch(ce=ce&&ce.$$typeof,ce){case E:case R:case K:case U:case g:return ce;default:return Se}}case s:return Se}}}function le(ce){return se(ce)===b}return Zr.AsyncMode=S,Zr.ConcurrentMode=b,Zr.ContextConsumer=E,Zr.ContextProvider=g,Zr.Element=t,Zr.ForwardRef=R,Zr.Fragment=a,Zr.Lazy=K,Zr.Memo=U,Zr.Portal=s,Zr.Profiler=d,Zr.StrictMode=l,Zr.Suspense=O,Zr.isAsyncMode=function(ce){return le(ce)||se(ce)===S},Zr.isConcurrentMode=le,Zr.isContextConsumer=function(ce){return se(ce)===E},Zr.isContextProvider=function(ce){return se(ce)===g},Zr.isElement=function(ce){return typeof ce=="object"&&ce!==null&&ce.$$typeof===t},Zr.isForwardRef=function(ce){return se(ce)===R},Zr.isFragment=function(ce){return se(ce)===a},Zr.isLazy=function(ce){return se(ce)===K},Zr.isMemo=function(ce){return se(ce)===U},Zr.isPortal=function(ce){return se(ce)===s},Zr.isProfiler=function(ce){return se(ce)===d},Zr.isStrictMode=function(ce){return se(ce)===l},Zr.isSuspense=function(ce){return se(ce)===O},Zr.isValidElementType=function(ce){return typeof ce=="string"||typeof ce=="function"||ce===a||ce===b||ce===d||ce===l||ce===O||ce===N||typeof ce=="object"&&ce!==null&&(ce.$$typeof===K||ce.$$typeof===U||ce.$$typeof===g||ce.$$typeof===E||ce.$$typeof===R||ce.$$typeof===H||ce.$$typeof===ne||ce.$$typeof===J||ce.$$typeof===z)},Zr.typeOf=se,Zr}var N9;function ame(){return N9||(N9=1,cx.exports=ome()),cx.exports}var lx,k9;function cme(){if(k9)return lx;k9=1;var r=ame(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[r.ForwardRef]=a,d[r.Memo]=l;function g(K){return r.isMemo(K)?l:d[K.$$typeof]||t}var E=Object.defineProperty,S=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,R=Object.getOwnPropertyDescriptor,O=Object.getPrototypeOf,N=Object.prototype;function U(K,z,H){if(typeof z!="string"){if(N){var ne=O(z);ne&&ne!==N&&U(K,ne,H)}var J=S(z);b&&(J=J.concat(b(z)));for(var se=g(K),le=g(z),ce=0;ce<J.length;++ce){var Se=J[ce];if(!s[Se]&&!(H&&H[Se])&&!(le&&le[Se])&&!(se&&se[Se])){var Z=R(z,Se);try{E(K,Se,Z)}catch{}}}}return K}return lx=U,lx}cme();var lme=!0;function ume(r,t,s){var a="";return s.split(" ").forEach(function(l){r[l]!==void 0?t.push(r[l]+";"):a+=l+" "}),a}var OY=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||lme===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},PY=function(t,s,a){OY(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function dme(r){for(var t=0,s,a=0,l=r.length;l>=4;++a,l-=4)s=r.charCodeAt(a)&255|(r.charCodeAt(++a)&255)<<8|(r.charCodeAt(++a)&255)<<16|(r.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(r.charCodeAt(a+2)&255)<<16;case 2:t^=(r.charCodeAt(a+1)&255)<<8;case 1:t^=r.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var hme={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},pme=/[A-Z]|^ms/g,fme=/_EMO_([^_]+?)_([^]*?)_EMO_/g,NY=function(t){return t.charCodeAt(1)===45},D9=function(t){return t!=null&&typeof t!="boolean"},ux=IY(function(r){return NY(r)?r:r.replace(pme,"-$&").toLowerCase()}),L9=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(fme,function(a,l,d){return Xd={name:l,styles:d,next:Xd},l})}return hme[t]!==1&&!NY(t)&&typeof s=="number"&&s!==0?s+"px":s};function Bb(r,t,s){if(s==null)return"";if(s.__emotion_styles!==void 0)return s;switch(typeof s){case"boolean":return"";case"object":{if(s.anim===1)return Xd={name:s.name,styles:s.styles,next:Xd},s.name;if(s.styles!==void 0){var a=s.next;if(a!==void 0)for(;a!==void 0;)Xd={name:a.name,styles:a.styles,next:Xd},a=a.next;var l=s.styles+";";return l}return mme(r,t,s)}case"function":{if(r!==void 0){var d=Xd,g=s(r);return Xd=d,Bb(r,t,g)}break}}if(t==null)return s;var E=t[s];return E!==void 0?E:s}function mme(r,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=Bb(r,t,s[l])+";";else for(var d in s){var g=s[d];if(typeof g!="object")t!=null&&t[g]!==void 0?a+=d+"{"+t[g]+"}":D9(g)&&(a+=ux(d)+":"+L9(d,g)+";");else if(Array.isArray(g)&&typeof g[0]=="string"&&(t==null||t[g[0]]===void 0))for(var E=0;E<g.length;E++)D9(g[E])&&(a+=ux(d)+":"+L9(d,g[E])+";");else{var S=Bb(r,t,g);switch(d){case"animation":case"animationName":{a+=ux(d)+":"+S+";";break}default:a+=d+"{"+S+"}"}}}return a}var x9=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Xd,sU=function(t,s,a){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var l=!0,d="";Xd=void 0;var g=t[0];g==null||g.raw===void 0?(l=!1,d+=Bb(a,s,g)):d+=g[0];for(var E=1;E<t.length;E++)d+=Bb(a,s,t[E]),l&&(d+=g[E]);x9.lastIndex=0;for(var S="",b;(b=x9.exec(d))!==null;)S+="-"+b[1];var R=dme(d)+S;return{name:R,styles:d,next:Xd}},gme=function(t){return t()},kY=y9.useInsertionEffect?y9.useInsertionEffect:!1,_me=kY||gme,M9=kY||B.useLayoutEffect,DY=B.createContext(typeof HTMLElement<"u"?sme({key:"css"}):null);DY.Provider;var LY=function(t){return B.forwardRef(function(s,a){var l=B.useContext(DY);return t(s,l,a)})},Wb=B.createContext({}),vme=function(t,s){if(typeof s=="function"){var a=s(t);return a}return U_({},t,s)},Eme=A9(function(r){return A9(function(t){return vme(r,t)})}),yme=function(t){var s=B.useContext(Wb);return t.theme!==s&&(s=Eme(s)(t.theme)),B.createElement(Wb.Provider,{value:s},t.children)},VP=LY(function(r,t){var s=r.styles,a=sU([s],void 0,B.useContext(Wb)),l=B.useRef();return M9(function(){var d=t.key+"-global",g=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,S=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(g.before=t.sheet.tags[0]),S!==null&&(E=!0,S.setAttribute("data-emotion",d),g.hydrate([S])),l.current=[g,E],function(){g.flush()}},[t]),M9(function(){var d=l.current,g=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&PY(t,a.next,!0),g.tags.length){var S=g.tags[g.tags.length-1].nextElementSibling;g.before=S,g.flush()}t.insert("",a,g,!1)},[t,a.name]),null});function Sme(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return sU(t)}var _w=function(){var t=Sme.apply(void 0,arguments),s="animation-"+t.name;return{name:s,styles:"@keyframes "+s+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},xY=String.raw,MY=xY`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,Tme=()=>F.jsx(VP,{styles:MY}),bme=({scope:r=""})=>F.jsx(VP,{styles:xY`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${r} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${r} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${r} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${r} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${r} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${r} :where(b, strong) {
        font-weight: bold;
      }

      ${r} small {
        font-size: 80%;
      }

      ${r} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${r} sub {
        bottom: -0.25em;
      }

      ${r} sup {
        top: -0.5em;
      }

      ${r} img {
        border-style: none;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${r} :where(button, input) {
        overflow: visible;
      }

      ${r} :where(button, select) {
        text-transform: none;
      }

      ${r} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${r} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${r} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${r} progress {
        vertical-align: baseline;
      }

      ${r} textarea {
        overflow: auto;
      }

      ${r} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${r} input[type="number"]::-webkit-inner-spin-button,
      ${r} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${r} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${r} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${r} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${r} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${r} details {
        display: block;
      }

      ${r} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${r} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${r} button {
        background: transparent;
        padding: 0;
      }

      ${r} fieldset {
        margin: 0;
        padding: 0;
      }

      ${r} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${r} textarea {
        resize: vertical;
      }

      ${r} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${r} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${r} table {
        border-collapse: collapse;
      }

      ${r} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${r} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${r} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${r} select::-ms-expand {
        display: none;
      }

      ${MY}
    `});function wme(r,t){return`${r} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Gi(r={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:g}=r,E=B.createContext(g);E.displayName=t;function S(){var b;const R=B.useContext(E);if(!R&&s){const O=new Error(d??wme(a,l));throw O.name="ContextError",(b=Error.captureStackTrace)==null||b.call(Error,O,S),O}return R}return[E.Provider,S,E]}var[Rme,Cme]=Gi({strict:!1,name:"PortalManagerContext"});function oU(r){const{children:t,zIndex:s}=r;return F.jsx(Rme,{value:{zIndex:s},children:t})}oU.displayName="PortalManager";var Rp=globalThis!=null&&globalThis.document?B.useLayoutEffect:B.useEffect,UY=yY(),[VY,Ime]=Gi({strict:!1,name:"PortalContext"}),aU="chakra-portal",Ame=".chakra-portal",Ome=r=>F.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:r.zIndex,top:0,left:0,right:0},children:r.children}),Pme=r=>{const{appendToParentPortal:t,children:s}=r,[a,l]=B.useState(null),d=B.useRef(null),[,g]=B.useState({});B.useEffect(()=>g({}),[]);const E=Ime(),S=Cme();Rp(()=>{if(!a)return;const R=a.ownerDocument,O=t?E??R.body:R.body;if(!O)return;d.current=R.createElement("div"),d.current.className=aU,O.appendChild(d.current),g({});const N=d.current;return()=>{O.contains(N)&&O.removeChild(N)}},[a]);const b=S!=null&&S.zIndex?F.jsx(Ome,{zIndex:S==null?void 0:S.zIndex,children:s}):s;return d.current?UY.createPortal(F.jsx(VY,{value:d.current,children:b}),d.current):F.jsx("span",{ref:R=>{R&&l(R)}})},Nme=r=>{const{children:t,containerRef:s,appendToParentPortal:a}=r,l=s.current,d=l??(typeof window<"u"?document.body:void 0),g=B.useMemo(()=>{const S=l==null?void 0:l.ownerDocument.createElement("div");return S&&(S.className=aU),S},[l]),[,E]=B.useState({});return Rp(()=>E({}),[]),Rp(()=>{if(!(!g||!d))return d.appendChild(g),()=>{d.removeChild(g)}},[g,d]),d&&g?UY.createPortal(F.jsx(VY,{value:a?g:null,children:t}),g):null};function Ju(r){const t={appendToParentPortal:!0,...r},{containerRef:s,...a}=t;return s?F.jsx(Nme,{containerRef:s,...a}):F.jsx(Pme,{...a})}Ju.className=aU;Ju.selector=Ame;Ju.displayName="Portal";function dS(){const r=B.useContext(Wb);if(!r)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return r}var cU=B.createContext({});cU.displayName="ColorModeContext";function FP(){const r=B.useContext(cU);if(r===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return r}function kme(r,t){const{colorMode:s}=FP();return s==="dark"?t:r}var GA={light:"chakra-ui-light",dark:"chakra-ui-dark"};function Dme(r={}){const{preventTransition:t=!0}=r,s={setDataset:a=>{const l=t?s.preventTransition():void 0;document.documentElement.dataset.theme=a,document.documentElement.style.colorScheme=a,l==null||l()},setClassName(a){document.body.classList.add(a?GA.dark:GA.light),document.body.classList.remove(a?GA.light:GA.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(a){var l;return((l=s.query().matches)!=null?l:a==="dark")?"dark":"light"},addListener(a){const l=s.query(),d=g=>{a(g.matches?"dark":"light")};return typeof l.addListener=="function"?l.addListener(d):l.addEventListener("change",d),()=>{typeof l.removeListener=="function"?l.removeListener(d):l.removeEventListener("change",d)}},preventTransition(){const a=document.createElement("style");return a.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(a),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(a)})})}}};return s}var Lme="chakra-ui-color-mode";function xme(r){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(r)||t}catch{}return s||t},set(t){try{localStorage.setItem(r,t)}catch{}}}}var Mme=xme(Lme),U9=()=>{};function V9(r,t){return r.type==="cookie"&&r.ssr?r.get(t):t}function FY(r){const{value:t,children:s,options:{useSystemColorMode:a,initialColorMode:l,disableTransitionOnChange:d}={},colorModeManager:g=Mme}=r,E=l==="dark"?"dark":"light",[S,b]=B.useState(()=>V9(g,E)),[R,O]=B.useState(()=>V9(g)),{getSystemTheme:N,setClassName:U,setDataset:K,addListener:z}=B.useMemo(()=>Dme({preventTransition:d}),[d]),H=l==="system"&&!S?R:S,ne=B.useCallback(le=>{const ce=le==="system"?N():le;b(ce),U(ce==="dark"),K(ce),g.set(ce)},[g,N,U,K]);Rp(()=>{l==="system"&&O(N())},[]),B.useEffect(()=>{const le=g.get();if(le){ne(le);return}if(l==="system"){ne("system");return}ne(E)},[g,E,l,ne]);const J=B.useCallback(()=>{ne(H==="dark"?"light":"dark")},[H,ne]);B.useEffect(()=>{if(a)return z(ne)},[a,z,ne]);const se=B.useMemo(()=>({colorMode:t??H,toggleColorMode:t?U9:J,setColorMode:t?U9:ne,forced:t!==void 0}),[H,J,ne,t]);return F.jsx(cU.Provider,{value:se,children:s})}FY.displayName="ColorModeProvider";function jY(){const r=FP(),t=dS();return{...r,theme:t}}function Ume(r,t,s){var a,l;if(t==null)return t;const d=g=>{var E,S;return(S=(E=r.__cssMap)==null?void 0:E[g])==null?void 0:S.value};return(l=(a=d(t))!=null?a:d(s))!=null?l:s}function Vme(r,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const g=l.filter(Boolean),E=a.map((S,b)=>{var R;const O=`${r}.${S}`;return Ume(d,O,(R=g[b])!=null?R:S)});return Array.isArray(t)?E:E[0]}}var Un=(...r)=>r.filter(Boolean).join(" ");function Yu(r){const t=typeof r;return r!=null&&(t==="object"||t==="function")&&!Array.isArray(r)}function Xl(r,...t){return Fme(r)?r(...t):r}var Fme=r=>typeof r=="function",cr=r=>r?"":void 0,dx=r=>r?!0:void 0;function nr(...r){return function(s){r.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function BY(...r){return function(s){r.forEach(a=>{a==null||a(s)})}}var ib={exports:{}};ib.exports;var F9;function jme(){return F9||(F9=1,function(r,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,g=9007199254740991,E="[object Arguments]",S="[object Array]",b="[object AsyncFunction]",R="[object Boolean]",O="[object Date]",N="[object Error]",U="[object Function]",K="[object GeneratorFunction]",z="[object Map]",H="[object Number]",ne="[object Null]",J="[object Object]",se="[object Proxy]",le="[object RegExp]",ce="[object Set]",Se="[object String]",Z="[object Undefined]",te="[object WeakMap]",ie="[object ArrayBuffer]",ae="[object DataView]",ve="[object Float32Array]",pe="[object Float64Array]",de="[object Int8Array]",ut="[object Int16Array]",mt="[object Int32Array]",Ze="[object Uint8Array]",Be="[object Uint8ClampedArray]",Ke="[object Uint16Array]",nt="[object Uint32Array]",Ee=/[\\^$.*+?()[\]{}|]/g,Ye=/^\[object .+?Constructor\]$/,Et=/^(?:0|[1-9]\d*)$/,ot={};ot[ve]=ot[pe]=ot[de]=ot[ut]=ot[mt]=ot[Ze]=ot[Be]=ot[Ke]=ot[nt]=!0,ot[E]=ot[S]=ot[ie]=ot[R]=ot[ae]=ot[O]=ot[N]=ot[U]=ot[z]=ot[H]=ot[J]=ot[le]=ot[ce]=ot[Se]=ot[te]=!1;var Ve=typeof T_=="object"&&T_&&T_.Object===Object&&T_,et=typeof self=="object"&&self&&self.Object===Object&&self,gt=Ve||et||Function("return this")(),Dt=t&&!t.nodeType&&t,Gt=Dt&&!0&&r&&!r.nodeType&&r,Bt=Gt&&Gt.exports===Dt,Vn=Bt&&Ve.process,Dn=function(){try{var _e=Gt&&Gt.require&&Gt.require("util").types;return _e||Vn&&Vn.binding&&Vn.binding("util")}catch{}}(),un=Dn&&Dn.isTypedArray;function gr(_e,Ce,Ge){switch(Ge.length){case 0:return _e.call(Ce);case 1:return _e.call(Ce,Ge[0]);case 2:return _e.call(Ce,Ge[0],Ge[1]);case 3:return _e.call(Ce,Ge[0],Ge[1],Ge[2])}return _e.apply(Ce,Ge)}function Ar(_e,Ce){for(var Ge=-1,jt=Array(_e);++Ge<_e;)jt[Ge]=Ce(Ge);return jt}function bt(_e){return function(Ce){return _e(Ce)}}function Sn(_e,Ce){return _e==null?void 0:_e[Ce]}function Tn(_e,Ce){return function(Ge){return _e(Ce(Ge))}}var we=Array.prototype,De=Function.prototype,We=Object.prototype,pt=gt["__core-js_shared__"],ft=De.toString,dt=We.hasOwnProperty,Mt=function(){var _e=/[^.]+$/.exec(pt&&pt.keys&&pt.keys.IE_PROTO||"");return _e?"Symbol(src)_1."+_e:""}(),Fn=We.toString,Cn=ft.call(Object),tn=RegExp("^"+ft.call(dt).replace(Ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_r=Bt?gt.Buffer:void 0,ya=gt.Symbol,ps=gt.Uint8Array;_r&&_r.allocUnsafe;var Qs=Tn(Object.getPrototypeOf,Object),Lt=Object.create,dn=We.propertyIsEnumerable,Zs=we.splice,sr=ya?ya.toStringTag:void 0,zi=function(){try{var _e=ba(Object,"defineProperty");return _e({},"",{}),_e}catch{}}(),Nc=_r?_r.isBuffer:void 0,Ga=Math.max,fo=Date.now,za=ba(gt,"Map"),xi=ba(Object,"create"),Cs=function(){function _e(){}return function(Ce){if(!Xa(Ce))return{};if(Lt)return Lt(Ce);_e.prototype=Ce;var Ge=new _e;return _e.prototype=void 0,Ge}}();function Ko(_e){var Ce=-1,Ge=_e==null?0:_e.length;for(this.clear();++Ce<Ge;){var jt=_e[Ce];this.set(jt[0],jt[1])}}function Ha(){this.__data__=xi?xi(null):{},this.size=0}function kc(_e){var Ce=this.has(_e)&&delete this.__data__[_e];return this.size-=Ce?1:0,Ce}function nu(_e){var Ce=this.__data__;if(xi){var Ge=Ce[_e];return Ge===a?void 0:Ge}return dt.call(Ce,_e)?Ce[_e]:void 0}function Ka(_e){var Ce=this.__data__;return xi?Ce[_e]!==void 0:dt.call(Ce,_e)}function Dc(_e,Ce){var Ge=this.__data__;return this.size+=this.has(_e)?0:1,Ge[_e]=xi&&Ce===void 0?a:Ce,this}Ko.prototype.clear=Ha,Ko.prototype.delete=kc,Ko.prototype.get=nu,Ko.prototype.has=Ka,Ko.prototype.set=Dc;function mo(_e){var Ce=-1,Ge=_e==null?0:_e.length;for(this.clear();++Ce<Ge;){var jt=_e[Ce];this.set(jt[0],jt[1])}}function wi(){this.__data__=[],this.size=0}function ts(_e){var Ce=this.__data__,Ge=rd(Ce,_e);if(Ge<0)return!1;var jt=Ce.length-1;return Ge==jt?Ce.pop():Zs.call(Ce,Ge,1),--this.size,!0}function Sa(_e){var Ce=this.__data__,Ge=rd(Ce,_e);return Ge<0?void 0:Ce[Ge][1]}function ru(_e){return rd(this.__data__,_e)>-1}function $a(_e,Ce){var Ge=this.__data__,jt=rd(Ge,_e);return jt<0?(++this.size,Ge.push([_e,Ce])):Ge[jt][1]=Ce,this}mo.prototype.clear=wi,mo.prototype.delete=ts,mo.prototype.get=Sa,mo.prototype.has=ru,mo.prototype.set=$a;function $o(_e){var Ce=-1,Ge=_e==null?0:_e.length;for(this.clear();++Ce<Ge;){var jt=_e[Ce];this.set(jt[0],jt[1])}}function qo(){this.size=0,this.__data__={hash:new Ko,map:new(za||mo),string:new Ko}}function Zu(_e){var Ce=au(this,_e).delete(_e);return this.size-=Ce?1:0,Ce}function Mm(_e){return au(this,_e).get(_e)}function iu(_e){return au(this,_e).has(_e)}function vh(_e,Ce){var Ge=au(this,_e),jt=Ge.size;return Ge.set(_e,Ce),this.size+=Ge.size==jt?0:1,this}$o.prototype.clear=qo,$o.prototype.delete=Zu,$o.prototype.get=Mm,$o.prototype.has=iu,$o.prototype.set=vh;function Is(_e){var Ce=this.__data__=new mo(_e);this.size=Ce.size}function su(){this.__data__=new mo,this.size=0}function Yo(_e){var Ce=this.__data__,Ge=Ce.delete(_e);return this.size=Ce.size,Ge}function ed(_e){return this.__data__.get(_e)}function td(_e){return this.__data__.has(_e)}function Ta(_e,Ce){var Ge=this.__data__;if(Ge instanceof mo){var jt=Ge.__data__;if(!za||jt.length<s-1)return jt.push([_e,Ce]),this.size=++Ge.size,this;Ge=this.__data__=new $o(jt)}return Ge.set(_e,Ce),this.size=Ge.size,this}Is.prototype.clear=su,Is.prototype.delete=Yo,Is.prototype.get=ed,Is.prototype.has=td,Is.prototype.set=Ta;function nd(_e,Ce){var Ge=Eo(_e),jt=!Ge&&Hi(_e),Bn=!Ge&&!jt&&So(_e),hr=!Ge&&!jt&&!Bn&&bh(_e),Ur=Ge||jt||Bn||hr,Xt=Ur?Ar(_e.length,String):[],Or=Xt.length;for(var ui in _e)Ur&&(ui=="length"||Bn&&(ui=="offset"||ui=="parent")||hr&&(ui=="buffer"||ui=="byteLength"||ui=="byteOffset")||Mc(ui,Or))||Xt.push(ui);return Xt}function ou(_e,Ce,Ge){(Ge!==void 0&&!vo(_e[Ce],Ge)||Ge===void 0&&!(Ce in _e))&&Mr(_e,Ce,Ge)}function go(_e,Ce,Ge){var jt=_e[Ce];(!(dt.call(_e,Ce)&&vo(jt,Ge))||Ge===void 0&&!(Ce in _e))&&Mr(_e,Ce,Ge)}function rd(_e,Ce){for(var Ge=_e.length;Ge--;)if(vo(_e[Ge][0],Ce))return Ge;return-1}function Mr(_e,Ce,Ge){Ce=="__proto__"&&zi?zi(_e,Ce,{configurable:!0,enumerable:!0,value:Ge,writable:!0}):_e[Ce]=Ge}var li=fl();function qa(_e){return _e==null?_e===void 0?Z:ne:sr&&sr in Object(_e)?_o(_e):$p(_e)}function Lc(_e){return ns(_e)&&qa(_e)==E}function Xo(_e){if(!Xa(_e)||wa(_e))return!1;var Ce=To(_e)?tn:Ye;return Ce.test(Th(_e))}function Eh(_e){return ns(_e)&&Yp(_e.length)&&!!ot[qa(_e)]}function id(_e){if(!Xa(_e))return Ya(_e);var Ce=Xn(_e),Ge=[];for(var jt in _e)jt=="constructor"&&(Ce||!dt.call(_e,jt))||Ge.push(jt);return Ge}function hl(_e,Ce,Ge,jt,Bn){_e!==Ce&&li(Ce,function(hr,Ur){if(Bn||(Bn=new Is),Xa(hr))eo(_e,Ce,Ur,Ge,hl,jt,Bn);else{var Xt=jt?jt(ad(_e,Ur),hr,Ur+"",_e,Ce,Bn):void 0;Xt===void 0&&(Xt=hr),ou(_e,Ur,Xt)}},vl)}function eo(_e,Ce,Ge,jt,Bn,hr,Ur){var Xt=ad(_e,Ge),Or=ad(Ce,Ge),ui=Ur.get(Or);if(ui){ou(_e,Ge,ui);return}var fs=hr?hr(Xt,Or,Ge+"",_e,Ce,Ur):void 0,bo=fs===void 0;if(bo){var wo=Eo(Or),uu=!wo&&So(Or),Mi=!wo&&!uu&&bh(Or);fs=Or,wo||uu||Mi?Eo(Xt)?fs=Xt:_l(Xt)?fs=od(Xt):uu?(bo=!1,fs=yh(Or)):Mi?(bo=!1,fs=sd(Or)):fs=[]:lu(Or)||Hi(Or)?(fs=Xt,Hi(Xt)?fs=Uc(Xt):(!Xa(Xt)||To(Xt))&&(fs=cu(Or))):bo=!1}bo&&(Ur.set(Or,fs),Bn(fs,Or,jt,hr,Ur),Ur.delete(Or)),ou(_e,Ge,fs)}function Kp(_e,Ce){return Sh(gl(_e,Ce,Qo),_e+"")}var Us=zi?function(_e,Ce){return zi(_e,"toString",{configurable:!0,enumerable:!1,value:Jo(Ce),writable:!0})}:Qo;function yh(_e,Ce){return _e.slice()}function xc(_e){var Ce=new _e.constructor(_e.byteLength);return new ps(Ce).set(new ps(_e)),Ce}function sd(_e,Ce){var Ge=xc(_e.buffer);return new _e.constructor(Ge,_e.byteOffset,_e.length)}function od(_e,Ce){var Ge=-1,jt=_e.length;for(Ce||(Ce=Array(jt));++Ge<jt;)Ce[Ge]=_e[Ge];return Ce}function or(_e,Ce,Ge,jt){var Bn=!Ge;Ge||(Ge={});for(var hr=-1,Ur=Ce.length;++hr<Ur;){var Xt=Ce[hr],Or=void 0;Or===void 0&&(Or=_e[Xt]),Bn?Mr(Ge,Xt,Or):go(Ge,Xt,Or)}return Ge}function pl(_e){return Kp(function(Ce,Ge){var jt=-1,Bn=Ge.length,hr=Bn>1?Ge[Bn-1]:void 0,Ur=Bn>2?Ge[2]:void 0;for(hr=_e.length>3&&typeof hr=="function"?(Bn--,hr):void 0,Ur&&ml(Ge[0],Ge[1],Ur)&&(hr=Bn<3?void 0:hr,Bn=1),Ce=Object(Ce);++jt<Bn;){var Xt=Ge[jt];Xt&&_e(Ce,Xt,jt,hr)}return Ce})}function fl(_e){return function(Ce,Ge,jt){for(var Bn=-1,hr=Object(Ce),Ur=jt(Ce),Xt=Ur.length;Xt--;){var Or=Ur[++Bn];if(Ge(hr[Or],Or,hr)===!1)break}return Ce}}function au(_e,Ce){var Ge=_e.__data__;return Br(Ce)?Ge[typeof Ce=="string"?"string":"hash"]:Ge.map}function ba(_e,Ce){var Ge=Sn(_e,Ce);return Xo(Ge)?Ge:void 0}function _o(_e){var Ce=dt.call(_e,sr),Ge=_e[sr];try{_e[sr]=void 0;var jt=!0}catch{}var Bn=Fn.call(_e);return jt&&(Ce?_e[sr]=Ge:delete _e[sr]),Bn}function cu(_e){return typeof _e.constructor=="function"&&!Xn(_e)?Cs(Qs(_e)):{}}function Mc(_e,Ce){var Ge=typeof _e;return Ce=Ce??g,!!Ce&&(Ge=="number"||Ge!="symbol"&&Et.test(_e))&&_e>-1&&_e%1==0&&_e<Ce}function ml(_e,Ce,Ge){if(!Xa(Ge))return!1;var jt=typeof Ce;return(jt=="number"?yo(Ge)&&Mc(Ce,Ge.length):jt=="string"&&Ce in Ge)?vo(Ge[Ce],_e):!1}function Br(_e){var Ce=typeof _e;return Ce=="string"||Ce=="number"||Ce=="symbol"||Ce=="boolean"?_e!=="__proto__":_e===null}function wa(_e){return!!Mt&&Mt in _e}function Xn(_e){var Ce=_e&&_e.constructor,Ge=typeof Ce=="function"&&Ce.prototype||We;return _e===Ge}function Ya(_e){var Ce=[];if(_e!=null)for(var Ge in Object(_e))Ce.push(Ge);return Ce}function $p(_e){return Fn.call(_e)}function gl(_e,Ce,Ge){return Ce=Ga(Ce===void 0?_e.length-1:Ce,0),function(){for(var jt=arguments,Bn=-1,hr=Ga(jt.length-Ce,0),Ur=Array(hr);++Bn<hr;)Ur[Bn]=jt[Ce+Bn];Bn=-1;for(var Xt=Array(Ce+1);++Bn<Ce;)Xt[Bn]=jt[Bn];return Xt[Ce]=Ge(Ur),gr(_e,this,Xt)}}function ad(_e,Ce){if(!(Ce==="constructor"&&typeof _e[Ce]=="function")&&Ce!="__proto__")return _e[Ce]}var Sh=qp(Us);function qp(_e){var Ce=0,Ge=0;return function(){var jt=fo(),Bn=d-(jt-Ge);if(Ge=jt,Bn>0){if(++Ce>=l)return arguments[0]}else Ce=0;return _e.apply(void 0,arguments)}}function Th(_e){if(_e!=null){try{return ft.call(_e)}catch{}try{return _e+""}catch{}}return""}function vo(_e,Ce){return _e===Ce||_e!==_e&&Ce!==Ce}var Hi=Lc(function(){return arguments}())?Lc:function(_e){return ns(_e)&&dt.call(_e,"callee")&&!dn.call(_e,"callee")},Eo=Array.isArray;function yo(_e){return _e!=null&&Yp(_e.length)&&!To(_e)}function _l(_e){return ns(_e)&&yo(_e)}var So=Nc||Vc;function To(_e){if(!Xa(_e))return!1;var Ce=qa(_e);return Ce==U||Ce==K||Ce==b||Ce==se}function Yp(_e){return typeof _e=="number"&&_e>-1&&_e%1==0&&_e<=g}function Xa(_e){var Ce=typeof _e;return _e!=null&&(Ce=="object"||Ce=="function")}function ns(_e){return _e!=null&&typeof _e=="object"}function lu(_e){if(!ns(_e)||qa(_e)!=J)return!1;var Ce=Qs(_e);if(Ce===null)return!0;var Ge=dt.call(Ce,"constructor")&&Ce.constructor;return typeof Ge=="function"&&Ge instanceof Ge&&ft.call(Ge)==Cn}var bh=un?bt(un):Eh;function Uc(_e){return or(_e,vl(_e))}function vl(_e){return yo(_e)?nd(_e):id(_e)}var Xp=pl(function(_e,Ce,Ge,jt){hl(_e,Ce,Ge,jt)});function Jo(_e){return function(){return _e}}function Qo(_e){return _e}function Vc(){return!1}r.exports=Xp}(ib,ib.exports)),ib.exports}var Bme=jme();const Zd=lS(Bme);var Wme=r=>/!(important)?$/.test(r),j9=r=>typeof r=="string"?r.replace(/!(important)?$/,"").trim():r,Gme=(r,t)=>s=>{const a=String(t),l=Wme(a),d=j9(a),g=r?`${r}.${d}`:d;let E=Yu(s.__cssMap)&&g in s.__cssMap?s.__cssMap[g].varRef:t;return E=j9(E),l?`${E} !important`:E};function lU(r){const{scale:t,transform:s,compose:a}=r;return(d,g)=>{var E;const S=Gme(t,d)(g);let b=(E=s==null?void 0:s(S,g))!=null?E:S;return a&&(b=a(b,g)),b}}var zA=(...r)=>t=>r.reduce((s,a)=>a(s),t);function zl(r,t){return s=>{const a={property:s,scale:r};return a.transform=lU({scale:r,transform:t}),a}}var zme=({rtl:r,ltr:t})=>s=>s.direction==="rtl"?r:t;function Hme(r){const{property:t,scale:s,transform:a}=r;return{scale:s,property:zme(t),transform:s?lU({scale:s,compose:a}):a}}var WY=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function Kme(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...WY].join(" ")}function $me(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...WY].join(" ")}var qme={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},Yme={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function Xme(r){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":r,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}var Jme={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},NM={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},Qme=new Set(Object.values(NM)),kM=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),Zme=r=>r.trim();function ege(r,t){if(r==null||kM.has(r))return r;if(!(DM(r)||kM.has(r)))return`url('${r}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(r),d=l==null?void 0:l[1],g=l==null?void 0:l[2];if(!d||!g)return r;const E=d.includes("-gradient")?d:`${d}-gradient`,[S,...b]=g.split(",").map(Zme).filter(Boolean);if((b==null?void 0:b.length)===0)return r;const R=S in NM?NM[S]:S;b.unshift(R);const O=b.map(N=>{if(Qme.has(N))return N;const U=N.indexOf(" "),[K,z]=U!==-1?[N.substr(0,U),N.substr(U+1)]:[N],H=DM(z)?z:z&&z.split(" "),ne=`colors.${K}`,J=ne in t.__cssMap?t.__cssMap[ne].varRef:K;return H?[J,...Array.isArray(H)?H:[H]].join(" "):J});return`${E}(${O.join(", ")})`}var DM=r=>typeof r=="string"&&r.includes("(")&&r.includes(")"),tge=(r,t)=>ege(r,t??{});function nge(r){return/^var\(--.+\)$/.test(r)}var rge=r=>{const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},$d=r=>t=>`${r}(${t})`,Tr={filter(r){return r!=="auto"?r:qme},backdropFilter(r){return r!=="auto"?r:Yme},ring(r){return Xme(Tr.px(r))},bgClip(r){return r==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:r}},transform(r){return r==="auto"?Kme():r==="auto-gpu"?$me():r},vh(r){return r==="$100vh"?"var(--chakra-vh)":r},px(r){if(r==null)return r;const{unitless:t}=rge(r);return t||typeof r=="number"?`${r}px`:r},fraction(r){return typeof r!="number"||r>1?r:`${r*100}%`},float(r,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[r]:r},degree(r){if(nge(r)||r==null)return r;const t=typeof r=="string"&&!r.endsWith("deg");return typeof r=="number"||t?`${r}deg`:r},gradient:tge,blur:$d("blur"),opacity:$d("opacity"),brightness:$d("brightness"),contrast:$d("contrast"),dropShadow:$d("drop-shadow"),grayscale:$d("grayscale"),hueRotate:r=>$d("hue-rotate")(Tr.degree(r)),invert:$d("invert"),saturate:$d("saturate"),sepia:$d("sepia"),bgImage(r){return r==null||DM(r)||kM.has(r)?r:`url(${r})`},outline(r){const t=String(r)==="0"||String(r)==="none";return r!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:r}},flexDirection(r){var t;const{space:s,divide:a}=(t=Jme[r])!=null?t:{},l={flexDirection:r};return s&&(l[s]=1),a&&(l[a]=1),l}},Ne={borderWidths:zl("borderWidths"),borderStyles:zl("borderStyles"),colors:zl("colors"),borders:zl("borders"),gradients:zl("gradients",Tr.gradient),radii:zl("radii",Tr.px),space:zl("space",zA(Tr.vh,Tr.px)),spaceT:zl("space",zA(Tr.vh,Tr.px)),degreeT(r){return{property:r,transform:Tr.degree}},prop(r,t,s){return{property:r,scale:t,...t&&{transform:lU({scale:t,transform:s})}}},propT(r,t){return{property:r,transform:t}},sizes:zl("sizes",zA(Tr.vh,Tr.px)),sizesT:zl("sizes",zA(Tr.vh,Tr.fraction)),shadows:zl("shadows"),logical:Hme,blur:zl("blur",Tr.blur)},yO={background:Ne.colors("background"),backgroundColor:Ne.colors("backgroundColor"),backgroundImage:Ne.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Tr.bgClip},bgSize:Ne.prop("backgroundSize"),bgPosition:Ne.prop("backgroundPosition"),bg:Ne.colors("background"),bgColor:Ne.colors("backgroundColor"),bgPos:Ne.prop("backgroundPosition"),bgRepeat:Ne.prop("backgroundRepeat"),bgAttachment:Ne.prop("backgroundAttachment"),bgGradient:Ne.gradients("backgroundImage"),bgClip:{transform:Tr.bgClip}};Object.assign(yO,{bgImage:yO.backgroundImage,bgImg:yO.backgroundImage});var zr={border:Ne.borders("border"),borderWidth:Ne.borderWidths("borderWidth"),borderStyle:Ne.borderStyles("borderStyle"),borderColor:Ne.colors("borderColor"),borderRadius:Ne.radii("borderRadius"),borderTop:Ne.borders("borderTop"),borderBlockStart:Ne.borders("borderBlockStart"),borderTopLeftRadius:Ne.radii("borderTopLeftRadius"),borderStartStartRadius:Ne.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ne.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ne.radii("borderTopRightRadius"),borderStartEndRadius:Ne.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ne.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ne.borders("borderRight"),borderInlineEnd:Ne.borders("borderInlineEnd"),borderBottom:Ne.borders("borderBottom"),borderBlockEnd:Ne.borders("borderBlockEnd"),borderBottomLeftRadius:Ne.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ne.radii("borderBottomRightRadius"),borderLeft:Ne.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ne.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ne.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ne.borders(["borderLeft","borderRight"]),borderInline:Ne.borders("borderInline"),borderY:Ne.borders(["borderTop","borderBottom"]),borderBlock:Ne.borders("borderBlock"),borderTopWidth:Ne.borderWidths("borderTopWidth"),borderBlockStartWidth:Ne.borderWidths("borderBlockStartWidth"),borderTopColor:Ne.colors("borderTopColor"),borderBlockStartColor:Ne.colors("borderBlockStartColor"),borderTopStyle:Ne.borderStyles("borderTopStyle"),borderBlockStartStyle:Ne.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ne.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ne.borderWidths("borderBlockEndWidth"),borderBottomColor:Ne.colors("borderBottomColor"),borderBlockEndColor:Ne.colors("borderBlockEndColor"),borderBottomStyle:Ne.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ne.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ne.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ne.borderWidths("borderInlineStartWidth"),borderLeftColor:Ne.colors("borderLeftColor"),borderInlineStartColor:Ne.colors("borderInlineStartColor"),borderLeftStyle:Ne.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ne.borderStyles("borderInlineStartStyle"),borderRightWidth:Ne.borderWidths("borderRightWidth"),borderInlineEndWidth:Ne.borderWidths("borderInlineEndWidth"),borderRightColor:Ne.colors("borderRightColor"),borderInlineEndColor:Ne.colors("borderInlineEndColor"),borderRightStyle:Ne.borderStyles("borderRightStyle"),borderInlineEndStyle:Ne.borderStyles("borderInlineEndStyle"),borderTopRadius:Ne.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ne.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ne.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ne.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(zr,{rounded:zr.borderRadius,roundedTop:zr.borderTopRadius,roundedTopLeft:zr.borderTopLeftRadius,roundedTopRight:zr.borderTopRightRadius,roundedTopStart:zr.borderStartStartRadius,roundedTopEnd:zr.borderStartEndRadius,roundedBottom:zr.borderBottomRadius,roundedBottomLeft:zr.borderBottomLeftRadius,roundedBottomRight:zr.borderBottomRightRadius,roundedBottomStart:zr.borderEndStartRadius,roundedBottomEnd:zr.borderEndEndRadius,roundedLeft:zr.borderLeftRadius,roundedRight:zr.borderRightRadius,roundedStart:zr.borderInlineStartRadius,roundedEnd:zr.borderInlineEndRadius,borderStart:zr.borderInlineStart,borderEnd:zr.borderInlineEnd,borderTopStartRadius:zr.borderStartStartRadius,borderTopEndRadius:zr.borderStartEndRadius,borderBottomStartRadius:zr.borderEndStartRadius,borderBottomEndRadius:zr.borderEndEndRadius,borderStartRadius:zr.borderInlineStartRadius,borderEndRadius:zr.borderInlineEndRadius,borderStartWidth:zr.borderInlineStartWidth,borderEndWidth:zr.borderInlineEndWidth,borderStartColor:zr.borderInlineStartColor,borderEndColor:zr.borderInlineEndColor,borderStartStyle:zr.borderInlineStartStyle,borderEndStyle:zr.borderInlineEndStyle});var ige={color:Ne.colors("color"),textColor:Ne.colors("color"),fill:Ne.colors("fill"),stroke:Ne.colors("stroke")},LM={boxShadow:Ne.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ne.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ne.prop("backgroundBlendMode"),opacity:!0};Object.assign(LM,{shadow:LM.boxShadow});var sge={filter:{transform:Tr.filter},blur:Ne.blur("--chakra-blur"),brightness:Ne.propT("--chakra-brightness",Tr.brightness),contrast:Ne.propT("--chakra-contrast",Tr.contrast),hueRotate:Ne.propT("--chakra-hue-rotate",Tr.hueRotate),invert:Ne.propT("--chakra-invert",Tr.invert),saturate:Ne.propT("--chakra-saturate",Tr.saturate),dropShadow:Ne.propT("--chakra-drop-shadow",Tr.dropShadow),backdropFilter:{transform:Tr.backdropFilter},backdropBlur:Ne.blur("--chakra-backdrop-blur"),backdropBrightness:Ne.propT("--chakra-backdrop-brightness",Tr.brightness),backdropContrast:Ne.propT("--chakra-backdrop-contrast",Tr.contrast),backdropHueRotate:Ne.propT("--chakra-backdrop-hue-rotate",Tr.hueRotate),backdropInvert:Ne.propT("--chakra-backdrop-invert",Tr.invert),backdropSaturate:Ne.propT("--chakra-backdrop-saturate",Tr.saturate)},JO={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Tr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ne.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ne.space("gap"),rowGap:Ne.space("rowGap"),columnGap:Ne.space("columnGap")};Object.assign(JO,{flexDir:JO.flexDirection});var GY={gridGap:Ne.space("gridGap"),gridColumnGap:Ne.space("gridColumnGap"),gridRowGap:Ne.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0},oge={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Tr.outline},outlineOffset:!0,outlineColor:Ne.colors("outlineColor")},$l={width:Ne.sizesT("width"),inlineSize:Ne.sizesT("inlineSize"),height:Ne.sizes("height"),blockSize:Ne.sizes("blockSize"),boxSize:Ne.sizes(["width","height"]),minWidth:Ne.sizes("minWidth"),minInlineSize:Ne.sizes("minInlineSize"),minHeight:Ne.sizes("minHeight"),minBlockSize:Ne.sizes("minBlockSize"),maxWidth:Ne.sizes("maxWidth"),maxInlineSize:Ne.sizes("maxInlineSize"),maxHeight:Ne.sizes("maxHeight"),maxBlockSize:Ne.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(r,t)=>{var s,a,l;return{[`@media screen and (min-width: ${(l=(a=(s=t.__breakpoints)==null?void 0:s.get(r))==null?void 0:a.minW)!=null?l:r})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(r,t)=>{var s,a,l;return{[`@media screen and (max-width: ${(l=(a=(s=t.__breakpoints)==null?void 0:s.get(r))==null?void 0:a._minW)!=null?l:r})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ne.propT("float",Tr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign($l,{w:$l.width,h:$l.height,minW:$l.minWidth,maxW:$l.maxWidth,minH:$l.minHeight,maxH:$l.maxHeight,overscroll:$l.overscrollBehavior,overscrollX:$l.overscrollBehaviorX,overscrollY:$l.overscrollBehaviorY});var age={listStyleType:!0,listStylePosition:!0,listStylePos:Ne.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ne.prop("listStyleImage")};function cge(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}var lge=r=>{const t=new WeakMap;return(a,l,d,g)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const S=r(a,l,d,g);return E.set(l,S),S}},uge=lge(cge),dge={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},hge={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},hx=(r,t,s)=>{const a={},l=uge(r,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},pge={srOnly:{transform(r){return r===!0?dge:r==="focusable"?hge:{}}},layerStyle:{processResult:!0,transform:(r,t,s)=>hx(t,`layerStyles.${r}`,s)},textStyle:{processResult:!0,transform:(r,t,s)=>hx(t,`textStyles.${r}`,s)},apply:{processResult:!0,transform:(r,t,s)=>hx(t,r,s)}},Sb={position:!0,pos:Ne.prop("position"),zIndex:Ne.prop("zIndex","zIndices"),inset:Ne.spaceT("inset"),insetX:Ne.spaceT(["left","right"]),insetInline:Ne.spaceT("insetInline"),insetY:Ne.spaceT(["top","bottom"]),insetBlock:Ne.spaceT("insetBlock"),top:Ne.spaceT("top"),insetBlockStart:Ne.spaceT("insetBlockStart"),bottom:Ne.spaceT("bottom"),insetBlockEnd:Ne.spaceT("insetBlockEnd"),left:Ne.spaceT("left"),insetInlineStart:Ne.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ne.spaceT("right"),insetInlineEnd:Ne.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Sb,{insetStart:Sb.insetInlineStart,insetEnd:Sb.insetInlineEnd});var fge={ring:{transform:Tr.ring},ringColor:Ne.colors("--chakra-ring-color"),ringOffset:Ne.prop("--chakra-ring-offset-width"),ringOffsetColor:Ne.colors("--chakra-ring-offset-color"),ringInset:Ne.prop("--chakra-ring-inset")},Di={margin:Ne.spaceT("margin"),marginTop:Ne.spaceT("marginTop"),marginBlockStart:Ne.spaceT("marginBlockStart"),marginRight:Ne.spaceT("marginRight"),marginInlineEnd:Ne.spaceT("marginInlineEnd"),marginBottom:Ne.spaceT("marginBottom"),marginBlockEnd:Ne.spaceT("marginBlockEnd"),marginLeft:Ne.spaceT("marginLeft"),marginInlineStart:Ne.spaceT("marginInlineStart"),marginX:Ne.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ne.spaceT("marginInline"),marginY:Ne.spaceT(["marginTop","marginBottom"]),marginBlock:Ne.spaceT("marginBlock"),padding:Ne.space("padding"),paddingTop:Ne.space("paddingTop"),paddingBlockStart:Ne.space("paddingBlockStart"),paddingRight:Ne.space("paddingRight"),paddingBottom:Ne.space("paddingBottom"),paddingBlockEnd:Ne.space("paddingBlockEnd"),paddingLeft:Ne.space("paddingLeft"),paddingInlineStart:Ne.space("paddingInlineStart"),paddingInlineEnd:Ne.space("paddingInlineEnd"),paddingX:Ne.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ne.space("paddingInline"),paddingY:Ne.space(["paddingTop","paddingBottom"]),paddingBlock:Ne.space("paddingBlock")};Object.assign(Di,{m:Di.margin,mt:Di.marginTop,mr:Di.marginRight,me:Di.marginInlineEnd,marginEnd:Di.marginInlineEnd,mb:Di.marginBottom,ml:Di.marginLeft,ms:Di.marginInlineStart,marginStart:Di.marginInlineStart,mx:Di.marginX,my:Di.marginY,p:Di.padding,pt:Di.paddingTop,py:Di.paddingY,px:Di.paddingX,pb:Di.paddingBottom,pl:Di.paddingLeft,ps:Di.paddingInlineStart,paddingStart:Di.paddingInlineStart,pr:Di.paddingRight,pe:Di.paddingInlineEnd,paddingEnd:Di.paddingInlineEnd});var mge={textDecorationColor:Ne.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ne.shadows("textShadow")},gge={clipPath:!0,transform:Ne.propT("transform",Tr.transform),transformOrigin:!0,translateX:Ne.spaceT("--chakra-translate-x"),translateY:Ne.spaceT("--chakra-translate-y"),skewX:Ne.degreeT("--chakra-skew-x"),skewY:Ne.degreeT("--chakra-skew-y"),scaleX:Ne.prop("--chakra-scale-x"),scaleY:Ne.prop("--chakra-scale-y"),scale:Ne.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ne.degreeT("--chakra-rotate")},_ge={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ne.prop("transitionDuration","transition.duration"),transitionProperty:Ne.prop("transitionProperty","transition.property"),transitionTimingFunction:Ne.prop("transitionTimingFunction","transition.easing")},vge={fontFamily:Ne.prop("fontFamily","fonts"),fontSize:Ne.prop("fontSize","fontSizes",Tr.px),fontWeight:Ne.prop("fontWeight","fontWeights"),lineHeight:Ne.prop("lineHeight","lineHeights"),letterSpacing:Ne.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(r){if(r===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},Ege={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ne.spaceT("scrollMargin"),scrollMarginTop:Ne.spaceT("scrollMarginTop"),scrollMarginBottom:Ne.spaceT("scrollMarginBottom"),scrollMarginLeft:Ne.spaceT("scrollMarginLeft"),scrollMarginRight:Ne.spaceT("scrollMarginRight"),scrollMarginX:Ne.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ne.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ne.spaceT("scrollPadding"),scrollPaddingTop:Ne.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ne.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ne.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ne.spaceT("scrollPaddingRight"),scrollPaddingX:Ne.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ne.spaceT(["scrollPaddingTop","scrollPaddingBottom"])};function zY(r){return Yu(r)&&r.reference?r.reference:String(r)}var jP=(r,...t)=>t.map(zY).join(` ${r} `).replace(/calc/g,""),B9=(...r)=>`calc(${jP("+",...r)})`,W9=(...r)=>`calc(${jP("-",...r)})`,xM=(...r)=>`calc(${jP("*",...r)})`,G9=(...r)=>`calc(${jP("/",...r)})`,z9=r=>{const t=zY(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:xM(t,-1)},y_=Object.assign(r=>({add:(...t)=>y_(B9(r,...t)),subtract:(...t)=>y_(W9(r,...t)),multiply:(...t)=>y_(xM(r,...t)),divide:(...t)=>y_(G9(r,...t)),negate:()=>y_(z9(r)),toString:()=>r.toString()}),{add:B9,subtract:W9,multiply:xM,divide:G9,negate:z9});function yge(r,t="-"){return r.replace(/\s+/g,t)}function Sge(r){const t=yge(r.toString());return bge(Tge(t))}function Tge(r){return r.includes("\\.")?r:!Number.isInteger(parseFloat(r.toString()))?r.replace(".","\\."):r}function bge(r){return r.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function wge(r,t=""){return[t,r].filter(Boolean).join("-")}function Rge(r,t){return`var(${r}${t?`, ${t}`:""})`}function Cge(r,t=""){return Sge(`--${wge(r,t)}`)}function yn(r,t,s){const a=Cge(r,s);return{variable:a,reference:Rge(a,t)}}function Ige(r,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=yn(`${r}-${l}`,d);continue}s[a]=yn(`${r}-${a}`)}return s}function Age(r){const t=r==null?0:r.length;return t?r[t-1]:void 0}function Oge(r){const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function MM(r){if(r==null)return r;const{unitless:t}=Oge(r);return t||typeof r=="number"?`${r}px`:r}var HY=(r,t)=>parseInt(r[1],10)>parseInt(t[1],10)?1:-1,uU=r=>Object.fromEntries(Object.entries(r).sort(HY));function H9(r){const t=uU(r);return Object.assign(Object.values(t),t)}function Pge(r){const t=Object.keys(uU(r));return new Set(t)}function K9(r){var t;if(!r)return r;r=(t=MM(r))!=null?t:r;const s=-.02;return typeof r=="number"?`${r+s}`:r.replace(/(\d+\.?\d*)/u,a=>`${parseFloat(a)+s}`)}function sb(r,t){const s=["@media screen"];return r&&s.push("and",`(min-width: ${MM(r)})`),t&&s.push("and",`(max-width: ${MM(t)})`),s.join(" ")}function Nge(r){var t;if(!r)return null;r.base=(t=r.base)!=null?t:"0px";const s=H9(r),a=Object.entries(r).sort(HY).map(([g,E],S,b)=>{var R;let[,O]=(R=b[S+1])!=null?R:[];return O=parseFloat(O)>0?K9(O):void 0,{_minW:K9(E),breakpoint:g,minW:E,maxW:O,maxWQuery:sb(null,O),minWQuery:sb(E),minMaxQuery:sb(E,O)}}),l=Pge(r),d=Array.from(l.values());return{keys:l,normalized:s,isResponsive(g){const E=Object.keys(g);return E.length>0&&E.every(S=>l.has(S))},asObject:uU(r),asArray:H9(r),details:a,get(g){return a.find(E=>E.breakpoint===g)},media:[null,...s.map(g=>sb(g)).slice(1)],toArrayValue(g){if(!Yu(g))throw new Error("toArrayValue: value must be an object");const E=d.map(S=>{var b;return(b=g[S])!=null?b:null});for(;Age(E)===null;)E.pop();return E},toObjectValue(g){if(!Array.isArray(g))throw new Error("toObjectValue: value must be an array");return g.reduce((E,S,b)=>{const R=d[b];return R!=null&&S!=null&&(E[R]=S),E},{})}}}var Vo={hover:(r,t)=>`${r}:hover ${t}, ${r}[data-hover] ${t}`,focus:(r,t)=>`${r}:focus ${t}, ${r}[data-focus] ${t}`,focusVisible:(r,t)=>`${r}:focus-visible ${t}`,focusWithin:(r,t)=>`${r}:focus-within ${t}`,active:(r,t)=>`${r}:active ${t}, ${r}[data-active] ${t}`,disabled:(r,t)=>`${r}:disabled ${t}, ${r}[data-disabled] ${t}`,invalid:(r,t)=>`${r}:invalid ${t}, ${r}[data-invalid] ${t}`,checked:(r,t)=>`${r}:checked ${t}, ${r}[data-checked] ${t}`,placeholderShown:(r,t)=>`${r}:placeholder-shown ${t}`},em=r=>KY(t=>r(t,"&"),"[role=group]","[data-group]",".group"),hp=r=>KY(t=>r(t,"~ &"),"[data-peer]",".peer"),KY=(r,...t)=>t.map(r).join(", "),BP={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty",_expanded:"&[aria-expanded=true], &[data-expanded]",_checked:"&[aria-checked=true], &[data-checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate]",_groupHover:em(Vo.hover),_peerHover:hp(Vo.hover),_groupFocus:em(Vo.focus),_peerFocus:hp(Vo.focus),_groupFocusVisible:em(Vo.focusVisible),_peerFocusVisible:hp(Vo.focusVisible),_groupActive:em(Vo.active),_peerActive:hp(Vo.active),_groupDisabled:em(Vo.disabled),_peerDisabled:hp(Vo.disabled),_groupInvalid:em(Vo.invalid),_peerInvalid:hp(Vo.invalid),_groupChecked:em(Vo.checked),_peerChecked:hp(Vo.checked),_groupFocusWithin:em(Vo.focusWithin),_peerFocusWithin:hp(Vo.focusWithin),_peerPlaceholderShown:hp(Vo.placeholderShown),_placeholder:"&::placeholder",_placeholderShown:"&:placeholder-shown",_fullScreen:"&:fullscreen",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]"},$Y=Object.keys(BP);function $9(r,t){return yn(String(r).replace(/\./g,"-"),void 0,t)}function kge(r,t){let s={};const a={};for(const[l,d]of Object.entries(r)){const{isSemantic:g,value:E}=d,{variable:S,reference:b}=$9(l,t==null?void 0:t.cssVarPrefix);if(!g){if(l.startsWith("space")){const N=l.split("."),[U,...K]=N,z=`${U}.-${K.join(".")}`,H=y_.negate(E),ne=y_.negate(b);a[z]={value:H,var:S,varRef:ne}}s[S]=E,a[l]={value:E,var:S,varRef:b};continue}const R=N=>{const K=[String(l).split(".")[0],N].join(".");if(!r[K])return N;const{reference:H}=$9(K,t==null?void 0:t.cssVarPrefix);return H},O=Yu(E)?E:{default:E};s=Zd(s,Object.entries(O).reduce((N,[U,K])=>{var z,H;if(!K)return N;const ne=R(`${K}`);if(U==="default")return N[S]=ne,N;const J=(H=(z=BP)==null?void 0:z[U])!=null?H:U;return N[J]={[S]:ne},N},{})),a[l]={value:b,var:S,varRef:b}}return{cssVars:s,cssMap:a}}function Dge(r,t=[]){const s=Object.assign({},r);for(const a of t)a in s&&delete s[a];return s}function Lge(r,t){const s={};for(const a of t)a in r&&(s[a]=r[a]);return s}function xge(r){return typeof r=="object"&&r!=null&&!Array.isArray(r)}function q9(r,t,s={}){const{stop:a,getKey:l}=s;function d(g,E=[]){var S;if(xge(g)||Array.isArray(g)){const b={};for(const[R,O]of Object.entries(g)){const N=(S=l==null?void 0:l(R))!=null?S:R,U=[...E,N];if(a!=null&&a(g,U))return t(g,E);b[N]=d(O,U)}return b}return t(g,E)}return d(r)}var Mge=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Uge(r){return Lge(r,Mge)}function Vge(r){return r.semanticTokens}function Fge(r){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=r;return l}var jge=r=>$Y.includes(r)||r==="default";function Bge({tokens:r,semanticTokens:t}){const s={};return q9(r,(a,l)=>{a!=null&&(s[l.join(".")]={isSemantic:!1,value:a})}),q9(t,(a,l)=>{a!=null&&(s[l.join(".")]={isSemantic:!0,value:a})},{stop:a=>Object.keys(a).every(jge)}),s}function Wge(r){var t;const s=Fge(r),a=Uge(s),l=Vge(s),d=Bge({tokens:a,semanticTokens:l}),g=(t=s.config)==null?void 0:t.cssVarPrefix,{cssMap:E,cssVars:S}=kge(d,{cssVarPrefix:g});return Object.assign(s,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...S},__cssMap:E,__breakpoints:Nge(s.breakpoints)}),s}var dU=Zd({},yO,zr,ige,JO,$l,sge,fge,oge,GY,pge,Sb,LM,Di,Ege,vge,mge,gge,age,_ge),Gge=Object.assign({},Di,$l,JO,GY,Sb),zge=Object.keys(Gge),Hge=[...Object.keys(dU),...$Y],Kge={...dU,...BP},$ge=r=>r in Kge,qge=r=>t=>{if(!t.__breakpoints)return r;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const g in r){let E=Xl(r[g],t);if(E==null)continue;if(E=Yu(E)&&s(E)?a(E):E,!Array.isArray(E)){d[g]=E;continue}const S=E.slice(0,l.length).length;for(let b=0;b<S;b+=1){const R=l==null?void 0:l[b];if(!R){d[g]=E[b];continue}d[R]=d[R]||{},E[b]!=null&&(d[R][g]=E[b])}}return d};function Yge(r){const t=[];let s="",a=!1;for(let l=0;l<r.length;l++){const d=r[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function Xge(r){return/^var\(--.+\)$/.test(r)}var Jge=(r,t)=>r.startsWith("--")&&typeof t=="string"&&!Xge(t),Qge=(r,t)=>{var s,a;if(t==null)return t;const l=S=>{var b,R;return(R=(b=r.__cssMap)==null?void 0:b[S])==null?void 0:R.varRef},d=S=>{var b;return(b=l(S))!=null?b:S},[g,E]=Yge(t);return t=(a=(s=l(g))!=null?s:d(E))!=null?a:d(t),t};function Zge(r){const{configs:t={},pseudos:s={},theme:a}=r,l=(d,g=!1)=>{var E,S,b;const R=Xl(d,a),O=qge(R)(a);let N={};for(let U in O){const K=O[U];let z=Xl(K,a);U in s&&(U=s[U]),Jge(U,z)&&(z=Qge(a,z));let H=t[U];if(H===!0&&(H={property:U}),Yu(z)){N[U]=(E=N[U])!=null?E:{},N[U]=Zd({},N[U],l(z,!0));continue}let ne=(b=(S=H==null?void 0:H.transform)==null?void 0:S.call(H,z,a,R))!=null?b:z;ne=H!=null&&H.processResult?l(ne,!0):ne;const J=Xl(H==null?void 0:H.property,a);if(!g&&(H!=null&&H.static)){const se=Xl(H.static,a);N=Zd({},N,se)}if(J&&Array.isArray(J)){for(const se of J)N[se]=ne;continue}if(J){J==="&"&&Yu(ne)?N=Zd({},N,ne):N[J]=ne;continue}if(Yu(ne)){N=Zd({},N,ne);continue}N[U]=ne}return N};return l}var qY=r=>t=>Zge({theme:t,pseudos:BP,configs:dU})(r);function p4e(r){return r}function f4e(r){return r}function bi(r){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:r,...t}}}}function e_e(r,t){if(Array.isArray(r))return r;if(Yu(r))return t(r);if(r!=null)return[r]}function t_e(r,t){for(let s=t+1;s<r.length;s++)if(r[s]!=null)return s;return-1}function n_e(r){const t=r.__breakpoints;return function(a,l,d,g){var E,S;if(!t)return;const b={},R=e_e(d,t.toArrayValue);if(!R)return b;const O=R.length,N=O===1,U=!!a.parts;for(let K=0;K<O;K++){const z=t.details[K],H=t.details[t_e(R,K)],ne=sb(z.minW,H==null?void 0:H._minW),J=Xl((E=a[l])==null?void 0:E[R[K]],g);if(J){if(U){(S=a.parts)==null||S.forEach(se=>{Zd(b,{[se]:N?J[se]:{[ne]:J[se]}})});continue}if(!U){N?Zd(b,J):b[ne]=J;continue}b[ne]=J}}return b}}function r_e(r){return t=>{var s;const{variant:a,size:l,theme:d}=t,g=n_e(d);return Zd({},Xl((s=r.baseStyle)!=null?s:{},t),g(r,"sizes",l,t),g(r,"variants",a,t))}}function i_e(r,t,s){var a,l,d;return(d=(l=(a=r.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)!=null?d:s}function es(r){return Dge(r,["styleConfig","size","variant","colorScheme"])}var s_e={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},o_e={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},a_e={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},c_e={property:s_e,easing:o_e,duration:a_e},l_e=c_e,u_e={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},d_e=u_e,h_e={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},p_e=h_e,f_e={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},m_e=f_e,g_e={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"},linkedin:{50:"#E8F4F9",100:"#CFEDFB",200:"#9BDAF3",300:"#68C7EC",400:"#34B3E4",500:"#00A0DC",600:"#008CC9",700:"#0077B5",800:"#005E93",900:"#004471"},facebook:{50:"#E8F4F9",100:"#D9DEE9",200:"#B7C2DA",300:"#6482C0",400:"#4267B2",500:"#385898",600:"#314E89",700:"#29487D",800:"#223B67",900:"#1E355B"},messenger:{50:"#D0E6FF",100:"#B9DAFF",200:"#A2CDFF",300:"#7AB8FF",400:"#2E90FF",500:"#0078FF",600:"#0063D1",700:"#0052AC",800:"#003C7E",900:"#002C5C"},whatsapp:{50:"#dffeec",100:"#b9f5d0",200:"#90edb3",300:"#65e495",400:"#3cdd78",500:"#22c35e",600:"#179848",700:"#0c6c33",800:"#01421c",900:"#001803"},twitter:{50:"#E5F4FD",100:"#C8E9FB",200:"#A8DCFA",300:"#83CDF7",400:"#57BBF5",500:"#1DA1F2",600:"#1A94DA",700:"#1681BF",800:"#136B9E",900:"#0D4D71"},telegram:{50:"#E3F2F9",100:"#C5E4F3",200:"#A2D4EC",300:"#7AC1E4",400:"#47A9DA",500:"#0088CC",600:"#007AB8",700:"#006BA1",800:"#005885",900:"#003F5E"}},__e=g_e,v_e={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},E_e=v_e,y_e={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},S_e=y_e,T_e={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},b_e=T_e,w_e={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},YY=w_e,XY={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},R_e={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},C_e={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},I_e={...XY,...R_e,container:C_e},JY=I_e,A_e={breakpoints:m_e,zIndices:d_e,radii:E_e,blur:b_e,colors:__e,...YY,sizes:JY,shadows:S_e,space:XY,borders:p_e,transition:l_e},{defineMultiStyleConfig:O_e,definePartsStyle:ob}=bi(["stepper","step","title","description","indicator","separator","icon","number"]),vp=yn("stepper-indicator-size"),vy=yn("stepper-icon-size"),Ey=yn("stepper-title-font-size"),ab=yn("stepper-description-font-size"),B0=yn("stepper-accent-color"),P_e=ob(({colorScheme:r})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[B0.variable]:`colors.${r}.500`,_dark:{[B0.variable]:`colors.${r}.200`}},title:{fontSize:Ey.reference,fontWeight:"medium"},description:{fontSize:ab.reference,color:"chakra-subtle-text"},number:{fontSize:Ey.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:vy.reference,height:vy.reference},indicator:{flexShrink:0,borderRadius:"full",width:vp.reference,height:vp.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:B0.reference},"&[data-status=complete]":{bg:B0.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:B0.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${vp.reference} - 8px)`,top:`calc(${vp.reference} + 4px)`,insetStart:`calc(${vp.reference} / 2 - 1px)`}}})),N_e=O_e({baseStyle:P_e,sizes:{xs:ob({stepper:{[vp.variable]:"sizes.4",[vy.variable]:"sizes.3",[Ey.variable]:"fontSizes.xs",[ab.variable]:"fontSizes.xs"}}),sm:ob({stepper:{[vp.variable]:"sizes.6",[vy.variable]:"sizes.4",[Ey.variable]:"fontSizes.sm",[ab.variable]:"fontSizes.xs"}}),md:ob({stepper:{[vp.variable]:"sizes.8",[vy.variable]:"sizes.5",[Ey.variable]:"fontSizes.md",[ab.variable]:"fontSizes.sm"}}),lg:ob({stepper:{[vp.variable]:"sizes.10",[vy.variable]:"sizes.6",[Ey.variable]:"fontSizes.lg",[ab.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}});function qr(r,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...R){a();for(const O of R)t[O]=S(O);return qr(r,t)}function d(...R){for(const O of R)O in t||(t[O]=S(O));return qr(r,t)}function g(){return Object.fromEntries(Object.entries(t).map(([O,N])=>[O,N.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([O,N])=>[O,N.className]))}function S(R){const U=`chakra-${(["container","root"].includes(R??"")?[r]:[r,R]).filter(Boolean).join("__")}`;return{className:U,selector:`.${U}`,toString:()=>R}}return{parts:l,toPart:S,extend:d,selectors:g,classnames:E,get keys(){return Object.keys(t)},__type:{}}}var k_e=qr("accordion").parts("root","container","button","panel").extend("icon"),D_e=qr("alert").parts("title","description","container").extend("icon","spinner"),L_e=qr("avatar").parts("label","badge","container").extend("excessLabel","group"),x_e=qr("breadcrumb").parts("link","item","container").extend("separator");qr("button").parts();var M_e=qr("checkbox").parts("control","icon","container").extend("label");qr("progress").parts("track","filledTrack").extend("label");var U_e=qr("drawer").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),V_e=qr("editable").parts("preview","input","textarea"),F_e=qr("form").parts("container","requiredIndicator","helperText"),j_e=qr("formError").parts("text","icon"),B_e=qr("input").parts("addon","field","element","group"),W_e=qr("list").parts("container","item","icon"),G_e=qr("menu").parts("button","list","item").extend("groupTitle","icon","command","divider"),z_e=qr("modal").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),H_e=qr("numberinput").parts("root","field","stepperGroup","stepper");qr("pininput").parts("field");var K_e=qr("popover").parts("content","header","body","footer").extend("popper","arrow","closeButton"),$_e=qr("progress").parts("label","filledTrack","track"),q_e=qr("radio").parts("container","control","label"),Y_e=qr("select").parts("field","icon"),X_e=qr("slider").parts("container","track","thumb","filledTrack","mark"),J_e=qr("stat").parts("container","label","helpText","number","icon"),Q_e=qr("switch").parts("container","track","thumb","label"),Z_e=qr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),eve=qr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),tve=qr("tag").parts("container","label","closeButton"),nve=qr("card").parts("container","header","body","footer");qr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");function b_(r,t,s){return Math.min(Math.max(r,s),t)}class rve extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var cb=rve;function hU(r){if(typeof r!="string")throw new cb(r);if(r.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=r.trim();t=dve.test(r)?ove(r):r;const s=ave.exec(t);if(s){const g=Array.from(s).slice(1);return[...g.slice(0,3).map(E=>parseInt(Gb(E,2),16)),parseInt(Gb(g[3]||"f",2),16)/255]}const a=cve.exec(t);if(a){const g=Array.from(a).slice(1);return[...g.slice(0,3).map(E=>parseInt(E,16)),parseInt(g[3]||"ff",16)/255]}const l=lve.exec(t);if(l){const g=Array.from(l).slice(1);return[...g.slice(0,3).map(E=>parseInt(E,10)),parseFloat(g[3]||"1")]}const d=uve.exec(t);if(d){const[g,E,S,b]=Array.from(d).slice(1).map(parseFloat);if(b_(0,100,E)!==E)throw new cb(r);if(b_(0,100,S)!==S)throw new cb(r);return[...hve(g,E,S),Number.isNaN(b)?1:b]}throw new cb(r)}function ive(r){let t=5381,s=r.length;for(;s;)t=t*33^r.charCodeAt(--s);return(t>>>0)%2341}const Y9=r=>parseInt(r.replace(/_/g,""),36),sve="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((r,t)=>{const s=Y9(t.substring(0,3)),a=Y9(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return r[s]=`${l}${a}`,r},{});function ove(r){const t=r.toLowerCase().trim(),s=sve[ive(t)];if(!s)throw new cb(r);return`#${s}`}const Gb=(r,t)=>Array.from(Array(t)).map(()=>r).join(""),ave=new RegExp(`^#${Gb("([a-f0-9])",3)}([a-f0-9])?$`,"i"),cve=new RegExp(`^#${Gb("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),lve=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${Gb(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),uve=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,dve=/^[a-z]+$/i,X9=r=>Math.round(r*255),hve=(r,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(X9);const l=(r%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),g=d*(1-Math.abs(l%2-1));let E=0,S=0,b=0;l>=0&&l<1?(E=d,S=g):l>=1&&l<2?(E=g,S=d):l>=2&&l<3?(S=d,b=g):l>=3&&l<4?(S=g,b=d):l>=4&&l<5?(E=g,b=d):l>=5&&l<6&&(E=d,b=g);const R=a-d/2,O=E+R,N=S+R,U=b+R;return[O,N,U].map(X9)};function pve(r,t,s,a){return`rgba(${b_(0,255,r).toFixed()}, ${b_(0,255,t).toFixed()}, ${b_(0,255,s).toFixed()}, ${parseFloat(b_(0,1,a).toFixed(3))})`}function fve(r,t){const[s,a,l,d]=hU(r);return pve(s,a,l,d-t)}function mve(r){const[t,s,a,l]=hU(r);let d=g=>{const E=b_(0,255,g).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}function gve(r,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)r=r?r[t[a]]:l;return r===l?s:r}var _ve=r=>Object.keys(r).length===0,ja=(r,t,s)=>{const a=gve(r,`colors.${t}`,t);try{return mve(a),a}catch{return s??"#000000"}},vve=r=>{const[t,s,a]=hU(r);return(t*299+s*587+a*114)/1e3},Eve=r=>t=>{const s=ja(t,r);return vve(s)<128?"dark":"light"},yve=r=>t=>Eve(r)(t)==="dark",Ky=(r,t)=>s=>{const a=ja(s,r);return fve(a,1-t)};function J9(r="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${r} ${r}`}}var Sve=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function Tve(r){const t=Sve();return!r||_ve(r)?t:r.string&&r.colors?wve(r.string,r.colors):r.string&&!r.colors?bve(r.string):r.colors&&!r.string?Rve(r.colors):t}function bve(r){let t=0;if(r.length===0)return t.toString();for(let a=0;a<r.length;a+=1)t=r.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function wve(r,t){let s=0;if(r.length===0)return t[0];for(let a=0;a<r.length;a+=1)s=r.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function Rve(r){return r[Math.floor(Math.random()*r.length)]}function vn(r,t){return s=>s.colorMode==="dark"?t:r}function pU(r){const{orientation:t,vertical:s,horizontal:a}=r;return t?t==="vertical"?s:a:{}}function QY(r){return Yu(r)&&r.reference?r.reference:String(r)}var WP=(r,...t)=>t.map(QY).join(` ${r} `).replace(/calc/g,""),Q9=(...r)=>`calc(${WP("+",...r)})`,Z9=(...r)=>`calc(${WP("-",...r)})`,UM=(...r)=>`calc(${WP("*",...r)})`,eK=(...r)=>`calc(${WP("/",...r)})`,tK=r=>{const t=QY(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:UM(t,-1)},Ep=Object.assign(r=>({add:(...t)=>Ep(Q9(r,...t)),subtract:(...t)=>Ep(Z9(r,...t)),multiply:(...t)=>Ep(UM(r,...t)),divide:(...t)=>Ep(eK(r,...t)),negate:()=>Ep(tK(r)),toString:()=>r.toString()}),{add:Q9,subtract:Z9,multiply:UM,divide:eK,negate:tK});function Cve(r){return!Number.isInteger(parseFloat(r.toString()))}function Ive(r,t="-"){return r.replace(/\s+/g,t)}function ZY(r){const t=Ive(r.toString());return t.includes("\\.")?r:Cve(r)?t.replace(".","\\."):r}function Ave(r,t=""){return[t,ZY(r)].filter(Boolean).join("-")}function Ove(r,t){return`var(${ZY(r)}${t?`, ${t}`:""})`}function Pve(r,t=""){return`--${Ave(r,t)}`}function Js(r,t){const s=Pve(r,void 0);return{variable:s,reference:Ove(s,Nve(void 0))}}function Nve(r){return r==null?void 0:r.reference}var{defineMultiStyleConfig:kve,definePartsStyle:SO}=bi(Q_e.keys),Tb=Js("switch-track-width"),I_=Js("switch-track-height"),px=Js("switch-track-diff"),Dve=Ep.subtract(Tb,I_),VM=Js("switch-thumb-x"),W0=Js("switch-bg"),Lve=r=>{const{colorScheme:t}=r;return{borderRadius:"full",p:"0.5",width:[Tb.reference],height:[I_.reference],transitionProperty:"common",transitionDuration:"fast",[W0.variable]:"colors.gray.300",_dark:{[W0.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[W0.variable]:`colors.${t}.500`,_dark:{[W0.variable]:`colors.${t}.200`}},bg:W0.reference}},xve={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[I_.reference],height:[I_.reference],_checked:{transform:`translateX(${VM.reference})`}},Mve=SO(r=>({container:{[px.variable]:Dve,[VM.variable]:px.reference,_rtl:{[VM.variable]:Ep(px).negate().toString()}},track:Lve(r),thumb:xve})),Uve={sm:SO({container:{[Tb.variable]:"1.375rem",[I_.variable]:"sizes.3"}}),md:SO({container:{[Tb.variable]:"1.875rem",[I_.variable]:"sizes.4"}}),lg:SO({container:{[Tb.variable]:"2.875rem",[I_.variable]:"sizes.6"}})},Vve=kve({baseStyle:Mve,sizes:Uve,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Fve,definePartsStyle:ky}=bi(Z_e.keys),jve=ky({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),QO={"&[data-is-numeric=true]":{textAlign:"end"}},Bve=ky(r=>{const{colorScheme:t}=r;return{th:{color:vn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:vn(`${t}.100`,`${t}.700`)(r),...QO},td:{borderBottom:"1px",borderColor:vn(`${t}.100`,`${t}.700`)(r),...QO},caption:{color:vn("gray.600","gray.100")(r)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Wve=ky(r=>{const{colorScheme:t}=r;return{th:{color:vn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:vn(`${t}.100`,`${t}.700`)(r),...QO},td:{borderBottom:"1px",borderColor:vn(`${t}.100`,`${t}.700`)(r),...QO},caption:{color:vn("gray.600","gray.100")(r)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:vn(`${t}.100`,`${t}.700`)(r)},td:{background:vn(`${t}.100`,`${t}.700`)(r)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Gve={simple:Bve,striped:Wve,unstyled:{}},zve={sm:ky({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:ky({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:ky({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Hve=Fve({baseStyle:jve,variants:Gve,sizes:zve,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),bc=yn("tabs-color"),$u=yn("tabs-bg"),HA=yn("tabs-border-color"),{defineMultiStyleConfig:Kve,definePartsStyle:rh}=bi(eve.keys),$ve=r=>{const{orientation:t}=r;return{display:t==="vertical"?"flex":"block"}},qve=r=>{const{isFitted:t}=r;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},Yve=r=>{const{align:t="start",orientation:s}=r;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},Xve={p:4},Jve=rh(r=>({root:$ve(r),tab:qve(r),tablist:Yve(r),tabpanel:Xve})),Qve={sm:rh({tab:{py:1,px:4,fontSize:"sm"}}),md:rh({tab:{fontSize:"md",py:2,px:4}}),lg:rh({tab:{fontSize:"lg",py:3,px:4}})},Zve=rh(r=>{const{colorScheme:t,orientation:s}=r,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[bc.variable]:`colors.${t}.600`,_dark:{[bc.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[$u.variable]:"colors.gray.200",_dark:{[$u.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:bc.reference,bg:$u.reference}}}),eEe=rh(r=>{const{colorScheme:t}=r;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[HA.variable]:"transparent",_selected:{[bc.variable]:`colors.${t}.600`,[HA.variable]:"colors.white",_dark:{[bc.variable]:`colors.${t}.300`,[HA.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:HA.reference},color:bc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),tEe=rh(r=>{const{colorScheme:t}=r;return{tab:{border:"1px solid",borderColor:"inherit",[$u.variable]:"colors.gray.50",_dark:{[$u.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[$u.variable]:"colors.white",[bc.variable]:`colors.${t}.600`,_dark:{[$u.variable]:"colors.gray.800",[bc.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:bc.reference,bg:$u.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),nEe=rh(r=>{const{colorScheme:t,theme:s}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:ja(s,`${t}.700`),bg:ja(s,`${t}.100`)}}}}),rEe=rh(r=>{const{colorScheme:t}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",[bc.variable]:"colors.gray.600",_dark:{[bc.variable]:"inherit"},_selected:{[bc.variable]:"colors.white",[$u.variable]:`colors.${t}.600`,_dark:{[bc.variable]:"colors.gray.800",[$u.variable]:`colors.${t}.300`}},color:bc.reference,bg:$u.reference}}}),iEe=rh({}),sEe={line:Zve,enclosed:eEe,"enclosed-colored":tEe,"soft-rounded":nEe,"solid-rounded":rEe,unstyled:iEe},oEe=Kve({baseStyle:Jve,sizes:Qve,variants:sEe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),Rs=Ige("badge",["bg","color","shadow"]),aEe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Rs.bg.reference,color:Rs.color.reference,boxShadow:Rs.shadow.reference},cEe=r=>{const{colorScheme:t,theme:s}=r,a=Ky(`${t}.500`,.6)(s);return{[Rs.bg.variable]:`colors.${t}.500`,[Rs.color.variable]:"colors.white",_dark:{[Rs.bg.variable]:a,[Rs.color.variable]:"colors.whiteAlpha.800"}}},lEe=r=>{const{colorScheme:t,theme:s}=r,a=Ky(`${t}.200`,.16)(s);return{[Rs.bg.variable]:`colors.${t}.100`,[Rs.color.variable]:`colors.${t}.800`,_dark:{[Rs.bg.variable]:a,[Rs.color.variable]:`colors.${t}.200`}}},uEe=r=>{const{colorScheme:t,theme:s}=r,a=Ky(`${t}.200`,.8)(s);return{[Rs.color.variable]:`colors.${t}.500`,_dark:{[Rs.color.variable]:a},[Rs.shadow.variable]:`inset 0 0 0px 1px ${Rs.color.reference}`}},dEe={solid:cEe,subtle:lEe,outline:uEe},bb={baseStyle:aEe,variants:dEe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:hEe,definePartsStyle:A_}=bi(tve.keys),nK=yn("tag-bg"),rK=yn("tag-color"),fx=yn("tag-shadow"),TO=yn("tag-min-height"),bO=yn("tag-min-width"),wO=yn("tag-font-size"),RO=yn("tag-padding-inline"),pEe={fontWeight:"medium",lineHeight:1.2,outline:0,[rK.variable]:Rs.color.reference,[nK.variable]:Rs.bg.reference,[fx.variable]:Rs.shadow.reference,color:rK.reference,bg:nK.reference,boxShadow:fx.reference,borderRadius:"md",minH:TO.reference,minW:bO.reference,fontSize:wO.reference,px:RO.reference,_focusVisible:{[fx.variable]:"shadows.outline"}},fEe={lineHeight:1.2,overflow:"visible"},mEe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},gEe=A_({container:pEe,label:fEe,closeButton:mEe}),_Ee={sm:A_({container:{[TO.variable]:"sizes.5",[bO.variable]:"sizes.5",[wO.variable]:"fontSizes.xs",[RO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:A_({container:{[TO.variable]:"sizes.6",[bO.variable]:"sizes.6",[wO.variable]:"fontSizes.sm",[RO.variable]:"space.2"}}),lg:A_({container:{[TO.variable]:"sizes.8",[bO.variable]:"sizes.8",[wO.variable]:"fontSizes.md",[RO.variable]:"space.3"}})},vEe={subtle:A_(r=>{var t;return{container:(t=bb.variants)==null?void 0:t.subtle(r)}}),solid:A_(r=>{var t;return{container:(t=bb.variants)==null?void 0:t.solid(r)}}),outline:A_(r=>{var t;return{container:(t=bb.variants)==null?void 0:t.outline(r)}})},EEe=hEe({variants:vEe,baseStyle:gEe,sizes:_Ee,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}}),{definePartsStyle:yp,defineMultiStyleConfig:yEe}=bi(B_e.keys),yy=yn("input-height"),Sy=yn("input-font-size"),Ty=yn("input-padding"),by=yn("input-border-radius"),SEe=yp({addon:{height:yy.reference,fontSize:Sy.reference,px:Ty.reference,borderRadius:by.reference},field:{width:"100%",height:yy.reference,fontSize:Sy.reference,px:Ty.reference,borderRadius:by.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),tm={lg:{[Sy.variable]:"fontSizes.lg",[Ty.variable]:"space.4",[by.variable]:"radii.md",[yy.variable]:"sizes.12"},md:{[Sy.variable]:"fontSizes.md",[Ty.variable]:"space.4",[by.variable]:"radii.md",[yy.variable]:"sizes.10"},sm:{[Sy.variable]:"fontSizes.sm",[Ty.variable]:"space.3",[by.variable]:"radii.sm",[yy.variable]:"sizes.8"},xs:{[Sy.variable]:"fontSizes.xs",[Ty.variable]:"space.2",[by.variable]:"radii.sm",[yy.variable]:"sizes.6"}},TEe={lg:yp({field:tm.lg,group:tm.lg}),md:yp({field:tm.md,group:tm.md}),sm:yp({field:tm.sm,group:tm.sm}),xs:yp({field:tm.xs,group:tm.xs})};function fU(r){const{focusBorderColor:t,errorBorderColor:s}=r;return{focusBorderColor:t||vn("blue.500","blue.300")(r),errorBorderColor:s||vn("red.500","red.300")(r)}}var bEe=yp(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=fU(r);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:vn("gray.300","whiteAlpha.400")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ja(t,a),boxShadow:`0 0 0 1px ${ja(t,a)}`},_focusVisible:{zIndex:1,borderColor:ja(t,s),boxShadow:`0 0 0 1px ${ja(t,s)}`}},addon:{border:"1px solid",borderColor:vn("inherit","whiteAlpha.50")(r),bg:vn("gray.100","whiteAlpha.300")(r)}}}),wEe=yp(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=fU(r);return{field:{border:"2px solid",borderColor:"transparent",bg:vn("gray.100","whiteAlpha.50")(r),_hover:{bg:vn("gray.200","whiteAlpha.100")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ja(t,a)},_focusVisible:{bg:"transparent",borderColor:ja(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:vn("gray.100","whiteAlpha.50")(r)}}}),REe=yp(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=fU(r);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ja(t,a),boxShadow:`0px 1px 0px 0px ${ja(t,a)}`},_focusVisible:{borderColor:ja(t,s),boxShadow:`0px 1px 0px 0px ${ja(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),CEe=yp({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),IEe={outline:bEe,filled:wEe,flushed:REe,unstyled:CEe},$r=yEe({baseStyle:SEe,sizes:TEe,variants:IEe,defaultProps:{size:"md",variant:"outline"}}),iK,AEe={...(iK=$r.baseStyle)==null?void 0:iK.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"},sK,oK,OEe={outline:r=>{var t,s;return(s=(t=$r.variants)==null?void 0:t.outline(r).field)!=null?s:{}},flushed:r=>{var t,s;return(s=(t=$r.variants)==null?void 0:t.flushed(r).field)!=null?s:{}},filled:r=>{var t,s;return(s=(t=$r.variants)==null?void 0:t.filled(r).field)!=null?s:{}},unstyled:(oK=(sK=$r.variants)==null?void 0:sK.unstyled.field)!=null?oK:{}},aK,cK,lK,uK,dK,hK,pK,fK,PEe={xs:(cK=(aK=$r.sizes)==null?void 0:aK.xs.field)!=null?cK:{},sm:(uK=(lK=$r.sizes)==null?void 0:lK.sm.field)!=null?uK:{},md:(hK=(dK=$r.sizes)==null?void 0:dK.md.field)!=null?hK:{},lg:(fK=(pK=$r.sizes)==null?void 0:pK.lg.field)!=null?fK:{}},NEe={baseStyle:AEe,sizes:PEe,variants:OEe,defaultProps:{size:"md",variant:"outline"}},KA=Js("tooltip-bg"),mx=Js("tooltip-fg"),kEe=Js("popper-arrow-bg"),DEe={bg:KA.reference,color:mx.reference,[KA.variable]:"colors.gray.700",[mx.variable]:"colors.whiteAlpha.900",_dark:{[KA.variable]:"colors.gray.300",[mx.variable]:"colors.gray.900"},[kEe.variable]:KA.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},LEe={baseStyle:DEe},{defineMultiStyleConfig:xEe,definePartsStyle:lb}=bi($_e.keys),MEe=r=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=r,d=vn(J9(),J9("1rem","rgba(0,0,0,0.1)"))(r),g=vn(`${t}.500`,`${t}.200`)(r),E=`linear-gradient(
    to right,
    transparent 0%,
    ${ja(s,g)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:g}}},UEe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},VEe=r=>({bg:vn("gray.100","whiteAlpha.300")(r)}),FEe=r=>({transitionProperty:"common",transitionDuration:"slow",...MEe(r)}),jEe=lb(r=>({label:UEe,filledTrack:FEe(r),track:VEe(r)})),BEe={xs:lb({track:{h:"1"}}),sm:lb({track:{h:"2"}}),md:lb({track:{h:"3"}}),lg:lb({track:{h:"4"}})},WEe=xEe({sizes:BEe,baseStyle:jEe,defaultProps:{size:"md",colorScheme:"blue"}}),GEe=r=>typeof r=="function";function Ba(r,...t){return GEe(r)?r(...t):r}var{definePartsStyle:CO,defineMultiStyleConfig:zEe}=bi(M_e.keys),wb=yn("checkbox-size"),HEe=r=>{const{colorScheme:t}=r;return{w:wb.reference,h:wb.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:vn(`${t}.500`,`${t}.200`)(r),borderColor:vn(`${t}.500`,`${t}.200`)(r),color:vn("white","gray.900")(r),_hover:{bg:vn(`${t}.600`,`${t}.300`)(r),borderColor:vn(`${t}.600`,`${t}.300`)(r)},_disabled:{borderColor:vn("gray.200","transparent")(r),bg:vn("gray.200","whiteAlpha.300")(r),color:vn("gray.500","whiteAlpha.500")(r)}},_indeterminate:{bg:vn(`${t}.500`,`${t}.200`)(r),borderColor:vn(`${t}.500`,`${t}.200`)(r),color:vn("white","gray.900")(r)},_disabled:{bg:vn("gray.100","whiteAlpha.100")(r),borderColor:vn("gray.100","transparent")(r)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:vn("red.500","red.300")(r)}}},KEe={_disabled:{cursor:"not-allowed"}},$Ee={userSelect:"none",_disabled:{opacity:.4}},qEe={transitionProperty:"transform",transitionDuration:"normal"},YEe=CO(r=>({icon:qEe,container:KEe,control:Ba(HEe,r),label:$Ee})),XEe={sm:CO({control:{[wb.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:CO({control:{[wb.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:CO({control:{[wb.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},ZO=zEe({baseStyle:YEe,sizes:XEe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:JEe,definePartsStyle:IO}=bi(q_e.keys),QEe=r=>{var t;const s=(t=Ba(ZO.baseStyle,r))==null?void 0:t.control;return{...s,borderRadius:"full",_checked:{...s==null?void 0:s._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},ZEe=IO(r=>{var t,s,a,l;return{label:(s=(t=ZO).baseStyle)==null?void 0:s.call(t,r).label,container:(l=(a=ZO).baseStyle)==null?void 0:l.call(a,r).container,control:QEe(r)}}),eye={md:IO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:IO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:IO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},tye=JEe({baseStyle:ZEe,sizes:eye,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:nye,definePartsStyle:rye}=bi(Y_e.keys),$A=yn("select-bg"),mK,iye={...(mK=$r.baseStyle)==null?void 0:mK.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:$A.reference,[$A.variable]:"colors.white",_dark:{[$A.variable]:"colors.gray.700"},"> option, > optgroup":{bg:$A.reference}},sye={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},oye=rye({field:iye,icon:sye}),qA={paddingInlineEnd:"8"},gK,_K,vK,EK,yK,SK,TK,bK,aye={lg:{...(gK=$r.sizes)==null?void 0:gK.lg,field:{...(_K=$r.sizes)==null?void 0:_K.lg.field,...qA}},md:{...(vK=$r.sizes)==null?void 0:vK.md,field:{...(EK=$r.sizes)==null?void 0:EK.md.field,...qA}},sm:{...(yK=$r.sizes)==null?void 0:yK.sm,field:{...(SK=$r.sizes)==null?void 0:SK.sm.field,...qA}},xs:{...(TK=$r.sizes)==null?void 0:TK.xs,field:{...(bK=$r.sizes)==null?void 0:bK.xs.field,...qA},icon:{insetEnd:"1"}}},cye=nye({baseStyle:oye,sizes:aye,variants:$r.variants,defaultProps:$r.defaultProps}),gx=yn("skeleton-start-color"),_x=yn("skeleton-end-color"),lye={[gx.variable]:"colors.gray.100",[_x.variable]:"colors.gray.400",_dark:{[gx.variable]:"colors.gray.800",[_x.variable]:"colors.gray.600"},background:gx.reference,borderColor:_x.reference,opacity:.7,borderRadius:"sm"},uye={baseStyle:lye},vx=yn("skip-link-bg"),dye={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[vx.variable]:"colors.white",_dark:{[vx.variable]:"colors.gray.700"},bg:vx.reference}},hye={baseStyle:dye},{defineMultiStyleConfig:pye,definePartsStyle:GP}=bi(X_e.keys),zb=yn("slider-thumb-size"),Hb=yn("slider-track-size"),om=yn("slider-bg"),fye=r=>{const{orientation:t}=r;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...pU({orientation:t,vertical:{h:"100%"},horizontal:{w:"100%"}})}},mye=r=>({...pU({orientation:r.orientation,horizontal:{h:Hb.reference},vertical:{w:Hb.reference}}),overflow:"hidden",borderRadius:"sm",[om.variable]:"colors.gray.200",_dark:{[om.variable]:"colors.whiteAlpha.200"},_disabled:{[om.variable]:"colors.gray.300",_dark:{[om.variable]:"colors.whiteAlpha.300"}},bg:om.reference}),gye=r=>{const{orientation:t}=r;return{...pU({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:zb.reference,h:zb.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},_ye=r=>{const{colorScheme:t}=r;return{width:"inherit",height:"inherit",[om.variable]:`colors.${t}.500`,_dark:{[om.variable]:`colors.${t}.200`},bg:om.reference}},vye=GP(r=>({container:fye(r),track:mye(r),thumb:gye(r),filledTrack:_ye(r)})),Eye=GP({container:{[zb.variable]:"sizes.4",[Hb.variable]:"sizes.1"}}),yye=GP({container:{[zb.variable]:"sizes.3.5",[Hb.variable]:"sizes.1"}}),Sye=GP({container:{[zb.variable]:"sizes.2.5",[Hb.variable]:"sizes.0.5"}}),Tye={lg:Eye,md:yye,sm:Sye},bye=pye({baseStyle:vye,sizes:Tye,defaultProps:{size:"md",colorScheme:"blue"}}),S_=Js("spinner-size"),wye={width:[S_.reference],height:[S_.reference]},Rye={xs:{[S_.variable]:"sizes.3"},sm:{[S_.variable]:"sizes.4"},md:{[S_.variable]:"sizes.6"},lg:{[S_.variable]:"sizes.8"},xl:{[S_.variable]:"sizes.12"}},Cye={baseStyle:wye,sizes:Rye,defaultProps:{size:"md"}},{defineMultiStyleConfig:Iye,definePartsStyle:eX}=bi(J_e.keys),Aye={fontWeight:"medium"},Oye={opacity:.8,marginBottom:"2"},Pye={verticalAlign:"baseline",fontWeight:"semibold"},Nye={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},kye=eX({container:{},label:Aye,helpText:Oye,number:Pye,icon:Nye}),Dye={md:eX({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},Lye=Iye({baseStyle:kye,sizes:Dye,defaultProps:{size:"md"}}),Ex=yn("kbd-bg"),xye={[Ex.variable]:"colors.gray.100",_dark:{[Ex.variable]:"colors.whiteAlpha.100"},bg:Ex.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},Mye={baseStyle:xye},Uye={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},Vye={baseStyle:Uye},{defineMultiStyleConfig:Fye,definePartsStyle:jye}=bi(W_e.keys),Bye={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},Wye=jye({icon:Bye}),Gye=Fye({baseStyle:Wye}),{defineMultiStyleConfig:zye,definePartsStyle:Hye}=bi(G_e.keys),qd=yn("menu-bg"),yx=yn("menu-shadow"),Kye={[qd.variable]:"#fff",[yx.variable]:"shadows.sm",_dark:{[qd.variable]:"colors.gray.700",[yx.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:1,borderRadius:"md",borderWidth:"1px",bg:qd.reference,boxShadow:yx.reference},$ye={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[qd.variable]:"colors.gray.100",_dark:{[qd.variable]:"colors.whiteAlpha.100"}},_active:{[qd.variable]:"colors.gray.200",_dark:{[qd.variable]:"colors.whiteAlpha.200"}},_expanded:{[qd.variable]:"colors.gray.100",_dark:{[qd.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:qd.reference},qye={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Yye={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},Xye={opacity:.6},Jye={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},Qye={transitionProperty:"common",transitionDuration:"normal"},Zye=Hye({button:Qye,list:Kye,item:$ye,groupTitle:qye,icon:Yye,command:Xye,divider:Jye}),eSe=zye({baseStyle:Zye}),{defineMultiStyleConfig:tSe,definePartsStyle:FM}=bi(z_e.keys),Sx=yn("modal-bg"),Tx=yn("modal-shadow"),nSe={bg:"blackAlpha.600",zIndex:"modal"},rSe=r=>{const{isCentered:t,scrollBehavior:s}=r;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},iSe=r=>{const{isCentered:t,scrollBehavior:s}=r;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[Sx.variable]:"colors.white",[Tx.variable]:"shadows.lg",_dark:{[Sx.variable]:"colors.gray.700",[Tx.variable]:"shadows.dark-lg"},bg:Sx.reference,boxShadow:Tx.reference}},sSe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},oSe={position:"absolute",top:"2",insetEnd:"3"},aSe=r=>{const{scrollBehavior:t}=r;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},cSe={px:"6",py:"4"},lSe=FM(r=>({overlay:nSe,dialogContainer:Ba(rSe,r),dialog:Ba(iSe,r),header:sSe,closeButton:oSe,body:Ba(aSe,r),footer:cSe}));function zu(r){return FM(r==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:r}})}var uSe={xs:zu("xs"),sm:zu("sm"),md:zu("md"),lg:zu("lg"),xl:zu("xl"),"2xl":zu("2xl"),"3xl":zu("3xl"),"4xl":zu("4xl"),"5xl":zu("5xl"),"6xl":zu("6xl"),full:zu("full")},dSe=tSe({baseStyle:lSe,sizes:uSe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:hSe,definePartsStyle:tX}=bi(H_e.keys),mU=Js("number-input-stepper-width"),nX=Js("number-input-input-padding"),pSe=Ep(mU).add("0.5rem").toString(),bx=Js("number-input-bg"),wx=Js("number-input-color"),Rx=Js("number-input-border-color"),fSe={[mU.variable]:"sizes.6",[nX.variable]:pSe},mSe=r=>{var t,s;return(s=(t=Ba($r.baseStyle,r))==null?void 0:t.field)!=null?s:{}},gSe={width:mU.reference},_Se={borderStart:"1px solid",borderStartColor:Rx.reference,color:wx.reference,bg:bx.reference,[wx.variable]:"colors.chakra-body-text",[Rx.variable]:"colors.chakra-border-color",_dark:{[wx.variable]:"colors.whiteAlpha.800",[Rx.variable]:"colors.whiteAlpha.300"},_active:{[bx.variable]:"colors.gray.200",_dark:{[bx.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},vSe=tX(r=>{var t;return{root:fSe,field:(t=Ba(mSe,r))!=null?t:{},stepperGroup:gSe,stepper:_Se}});function YA(r){var t,s,a;const l=(t=$r.sizes)==null?void 0:t[r],d={lg:"md",md:"md",sm:"sm",xs:"sm"},g=(a=(s=l.field)==null?void 0:s.fontSize)!=null?a:"md",E=YY.fontSizes[g];return tX({field:{...l.field,paddingInlineEnd:nX.reference,verticalAlign:"top"},stepper:{fontSize:Ep(E).multiply(.75).toString(),_first:{borderTopEndRadius:d[r]},_last:{borderBottomEndRadius:d[r],mt:"-1px",borderTopWidth:1}}})}var ESe={xs:YA("xs"),sm:YA("sm"),md:YA("md"),lg:YA("lg")},ySe=hSe({baseStyle:vSe,sizes:ESe,variants:$r.variants,defaultProps:$r.defaultProps}),wK,SSe={...(wK=$r.baseStyle)==null?void 0:wK.field,textAlign:"center"},TSe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}},RK,CK,bSe={outline:r=>{var t,s,a;return(a=(s=Ba((t=$r.variants)==null?void 0:t.outline,r))==null?void 0:s.field)!=null?a:{}},flushed:r=>{var t,s,a;return(a=(s=Ba((t=$r.variants)==null?void 0:t.flushed,r))==null?void 0:s.field)!=null?a:{}},filled:r=>{var t,s,a;return(a=(s=Ba((t=$r.variants)==null?void 0:t.filled,r))==null?void 0:s.field)!=null?a:{}},unstyled:(CK=(RK=$r.variants)==null?void 0:RK.unstyled.field)!=null?CK:{}},wSe={baseStyle:SSe,sizes:TSe,variants:bSe,defaultProps:$r.defaultProps},{defineMultiStyleConfig:RSe,definePartsStyle:CSe}=bi(K_e.keys),XA=Js("popper-bg"),ISe=Js("popper-arrow-bg"),IK=Js("popper-arrow-shadow-color"),ASe={zIndex:10},OSe={[XA.variable]:"colors.white",bg:XA.reference,[ISe.variable]:XA.reference,[IK.variable]:"colors.gray.200",_dark:{[XA.variable]:"colors.gray.700",[IK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},PSe={px:3,py:2,borderBottomWidth:"1px"},NSe={px:3,py:2},kSe={px:3,py:2,borderTopWidth:"1px"},DSe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},LSe=CSe({popper:ASe,content:OSe,header:PSe,body:NSe,footer:kSe,closeButton:DSe}),xSe=RSe({baseStyle:LSe}),{definePartsStyle:jM,defineMultiStyleConfig:MSe}=bi(U_e.keys),Cx=yn("drawer-bg"),Ix=yn("drawer-box-shadow");function iy(r){return jM(r==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:r}})}var USe={bg:"blackAlpha.600",zIndex:"modal"},VSe={display:"flex",zIndex:"modal",justifyContent:"center"},FSe=r=>{const{isFullHeight:t}=r;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[Cx.variable]:"colors.white",[Ix.variable]:"shadows.lg",_dark:{[Cx.variable]:"colors.gray.700",[Ix.variable]:"shadows.dark-lg"},bg:Cx.reference,boxShadow:Ix.reference}},jSe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},BSe={position:"absolute",top:"2",insetEnd:"3"},WSe={px:"6",py:"2",flex:"1",overflow:"auto"},GSe={px:"6",py:"4"},zSe=jM(r=>({overlay:USe,dialogContainer:VSe,dialog:Ba(FSe,r),header:jSe,closeButton:BSe,body:WSe,footer:GSe})),HSe={xs:iy("xs"),sm:iy("md"),md:iy("lg"),lg:iy("2xl"),xl:iy("4xl"),full:iy("full")},KSe=MSe({baseStyle:zSe,sizes:HSe,defaultProps:{size:"xs"}}),{definePartsStyle:$Se,defineMultiStyleConfig:qSe}=bi(V_e.keys),YSe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},XSe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},JSe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},QSe=$Se({preview:YSe,input:XSe,textarea:JSe}),ZSe=qSe({baseStyle:QSe}),{definePartsStyle:eTe,defineMultiStyleConfig:tTe}=bi(F_e.keys),Dy=yn("form-control-color"),nTe={marginStart:"1",[Dy.variable]:"colors.red.500",_dark:{[Dy.variable]:"colors.red.300"},color:Dy.reference},rTe={mt:"2",[Dy.variable]:"colors.gray.600",_dark:{[Dy.variable]:"colors.whiteAlpha.600"},color:Dy.reference,lineHeight:"normal",fontSize:"sm"},iTe=eTe({container:{width:"100%",position:"relative"},requiredIndicator:nTe,helperText:rTe}),sTe=tTe({baseStyle:iTe}),{definePartsStyle:oTe,defineMultiStyleConfig:aTe}=bi(j_e.keys),Ly=yn("form-error-color"),cTe={[Ly.variable]:"colors.red.500",_dark:{[Ly.variable]:"colors.red.300"},color:Ly.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},lTe={marginEnd:"0.5em",[Ly.variable]:"colors.red.500",_dark:{[Ly.variable]:"colors.red.300"},color:Ly.reference},uTe=oTe({text:cTe,icon:lTe}),dTe=aTe({baseStyle:uTe}),hTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},pTe={baseStyle:hTe},fTe={fontFamily:"heading",fontWeight:"bold"},mTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},gTe={baseStyle:fTe,sizes:mTe,defaultProps:{size:"xl"}},{defineMultiStyleConfig:_Te,definePartsStyle:vTe}=bi(x_e.keys),Ax=yn("breadcrumb-link-decor"),ETe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:Ax.reference,[Ax.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[Ax.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},yTe=vTe({link:ETe}),STe=_Te({baseStyle:yTe}),TTe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},rX=r=>{const{colorScheme:t,theme:s}=r;if(t==="gray")return{color:vn("gray.800","whiteAlpha.900")(r),_hover:{bg:vn("gray.100","whiteAlpha.200")(r)},_active:{bg:vn("gray.200","whiteAlpha.300")(r)}};const a=Ky(`${t}.200`,.12)(s),l=Ky(`${t}.200`,.24)(s);return{color:vn(`${t}.600`,`${t}.200`)(r),bg:"transparent",_hover:{bg:vn(`${t}.50`,a)(r)},_active:{bg:vn(`${t}.100`,l)(r)}}},bTe=r=>{const{colorScheme:t}=r,s=vn("gray.200","whiteAlpha.300")(r);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Ba(rX,r)}},wTe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},RTe=r=>{var t;const{colorScheme:s}=r;if(s==="gray"){const S=vn("gray.100","whiteAlpha.200")(r);return{bg:S,color:vn("gray.800","whiteAlpha.900")(r),_hover:{bg:vn("gray.200","whiteAlpha.300")(r),_disabled:{bg:S}},_active:{bg:vn("gray.300","whiteAlpha.400")(r)}}}const{bg:a=`${s}.500`,color:l="white",hoverBg:d=`${s}.600`,activeBg:g=`${s}.700`}=(t=wTe[s])!=null?t:{},E=vn(a,`${s}.200`)(r);return{bg:E,color:vn(l,"gray.800")(r),_hover:{bg:vn(d,`${s}.300`)(r),_disabled:{bg:E}},_active:{bg:vn(g,`${s}.400`)(r)}}},CTe=r=>{const{colorScheme:t}=r;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:vn(`${t}.500`,`${t}.200`)(r),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:vn(`${t}.700`,`${t}.500`)(r)}}},ITe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},ATe={ghost:rX,outline:bTe,solid:RTe,link:CTe,unstyled:ITe},OTe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},PTe={baseStyle:TTe,variants:ATe,sizes:OTe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:O_,defineMultiStyleConfig:NTe}=bi(nve.keys),eP=yn("card-bg"),Cp=yn("card-padding"),iX=yn("card-shadow"),AO=yn("card-radius"),sX=yn("card-border-width","0"),oX=yn("card-border-color"),kTe=O_({container:{[eP.variable]:"colors.chakra-body-bg",backgroundColor:eP.reference,boxShadow:iX.reference,borderRadius:AO.reference,color:"chakra-body-text",borderWidth:sX.reference,borderColor:oX.reference},body:{padding:Cp.reference,flex:"1 1 0%"},header:{padding:Cp.reference},footer:{padding:Cp.reference}}),DTe={sm:O_({container:{[AO.variable]:"radii.base",[Cp.variable]:"space.3"}}),md:O_({container:{[AO.variable]:"radii.md",[Cp.variable]:"space.5"}}),lg:O_({container:{[AO.variable]:"radii.xl",[Cp.variable]:"space.7"}})},LTe={elevated:O_({container:{[iX.variable]:"shadows.base",_dark:{[eP.variable]:"colors.gray.700"}}}),outline:O_({container:{[sX.variable]:"1px",[oX.variable]:"colors.chakra-border-color"}}),filled:O_({container:{[eP.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Cp.variable]:0},header:{[Cp.variable]:0},footer:{[Cp.variable]:0}}},xTe=NTe({baseStyle:kTe,variants:LTe,sizes:DTe,defaultProps:{variant:"elevated",size:"md"}}),Rb=Js("close-button-size"),G0=Js("close-button-bg"),MTe={w:[Rb.reference],h:[Rb.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[G0.variable]:"colors.blackAlpha.100",_dark:{[G0.variable]:"colors.whiteAlpha.100"}},_active:{[G0.variable]:"colors.blackAlpha.200",_dark:{[G0.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:G0.reference},UTe={lg:{[Rb.variable]:"sizes.10",fontSize:"md"},md:{[Rb.variable]:"sizes.8",fontSize:"xs"},sm:{[Rb.variable]:"sizes.6",fontSize:"2xs"}},VTe={baseStyle:MTe,sizes:UTe,defaultProps:{size:"md"}},{variants:FTe,defaultProps:jTe}=bb,BTe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Rs.bg.reference,color:Rs.color.reference,boxShadow:Rs.shadow.reference},WTe={baseStyle:BTe,variants:FTe,defaultProps:jTe},GTe={w:"100%",mx:"auto",maxW:"prose",px:"4"},zTe={baseStyle:GTe},HTe={opacity:.6,borderColor:"inherit"},KTe={borderStyle:"solid"},$Te={borderStyle:"dashed"},qTe={solid:KTe,dashed:$Te},YTe={baseStyle:HTe,variants:qTe,defaultProps:{variant:"solid"}},{definePartsStyle:XTe,defineMultiStyleConfig:JTe}=bi(k_e.keys),QTe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},ZTe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},e0e={pt:"2",px:"4",pb:"5"},t0e={fontSize:"1.25em"},n0e=XTe({container:QTe,button:ZTe,panel:e0e,icon:t0e}),r0e=JTe({baseStyle:n0e}),{definePartsStyle:vw,defineMultiStyleConfig:i0e}=bi(D_e.keys),ll=yn("alert-fg"),kp=yn("alert-bg"),s0e=vw({container:{bg:kp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:ll.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:ll.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function gU(r){const{theme:t,colorScheme:s}=r,a=Ky(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}var o0e=vw(r=>{const{colorScheme:t}=r,s=gU(r);return{container:{[ll.variable]:`colors.${t}.600`,[kp.variable]:s.light,_dark:{[ll.variable]:`colors.${t}.200`,[kp.variable]:s.dark}}}}),a0e=vw(r=>{const{colorScheme:t}=r,s=gU(r);return{container:{[ll.variable]:`colors.${t}.600`,[kp.variable]:s.light,_dark:{[ll.variable]:`colors.${t}.200`,[kp.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:ll.reference}}}),c0e=vw(r=>{const{colorScheme:t}=r,s=gU(r);return{container:{[ll.variable]:`colors.${t}.600`,[kp.variable]:s.light,_dark:{[ll.variable]:`colors.${t}.200`,[kp.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:ll.reference}}}),l0e=vw(r=>{const{colorScheme:t}=r;return{container:{[ll.variable]:"colors.white",[kp.variable]:`colors.${t}.600`,_dark:{[ll.variable]:"colors.gray.900",[kp.variable]:`colors.${t}.200`},color:ll.reference}}}),u0e={subtle:o0e,"left-accent":a0e,"top-accent":c0e,solid:l0e},d0e=i0e({baseStyle:s0e,variants:u0e,defaultProps:{variant:"subtle",colorScheme:"blue"}}),{definePartsStyle:aX,defineMultiStyleConfig:h0e}=bi(L_e.keys),xy=yn("avatar-border-color"),Cb=yn("avatar-bg"),Kb=yn("avatar-font-size"),$y=yn("avatar-size"),p0e={borderRadius:"full",border:"0.2em solid",borderColor:xy.reference,[xy.variable]:"white",_dark:{[xy.variable]:"colors.gray.800"}},f0e={bg:Cb.reference,fontSize:Kb.reference,width:$y.reference,height:$y.reference,lineHeight:"1",[Cb.variable]:"colors.gray.200",_dark:{[Cb.variable]:"colors.whiteAlpha.400"}},m0e=r=>{const{name:t,theme:s}=r,a=t?Tve({string:t}):"colors.gray.400",l=yve(a)(s);let d="white";return l||(d="gray.800"),{bg:Cb.reference,fontSize:Kb.reference,color:d,borderColor:xy.reference,verticalAlign:"top",width:$y.reference,height:$y.reference,"&:not([data-loaded])":{[Cb.variable]:a},[xy.variable]:"colors.white",_dark:{[xy.variable]:"colors.gray.800"}}},g0e={fontSize:Kb.reference,lineHeight:"1"},_0e=aX(r=>({badge:Ba(p0e,r),excessLabel:Ba(f0e,r),container:Ba(m0e,r),label:g0e}));function nm(r){const t=r!=="100%"?JY[r]:void 0;return aX({container:{[$y.variable]:t??r,[Kb.variable]:`calc(${t??r} / 2.5)`},excessLabel:{[$y.variable]:t??r,[Kb.variable]:`calc(${t??r} / 2.5)`}})}var v0e={"2xs":nm(4),xs:nm(6),sm:nm(8),md:nm(12),lg:nm(16),xl:nm(24),"2xl":nm(32),full:nm("100%")},E0e=h0e({baseStyle:_0e,sizes:v0e,defaultProps:{size:"md"}}),y0e={Accordion:r0e,Alert:d0e,Avatar:E0e,Badge:bb,Breadcrumb:STe,Button:PTe,Checkbox:ZO,CloseButton:VTe,Code:WTe,Container:zTe,Divider:YTe,Drawer:KSe,Editable:ZSe,Form:sTe,FormError:dTe,FormLabel:pTe,Heading:gTe,Input:$r,Kbd:Mye,Link:Vye,List:Gye,Menu:eSe,Modal:dSe,NumberInput:ySe,PinInput:wSe,Popover:xSe,Progress:WEe,Radio:tye,Select:cye,Skeleton:uye,SkipLink:hye,Slider:bye,Spinner:Cye,Stat:Lye,Switch:Vve,Table:Hve,Tabs:oEe,Tag:EEe,Textarea:NEe,Tooltip:LEe,Card:xTe,Stepper:N_e},S0e={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},T0e={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},b0e="ltr",w0e={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},R0e={semanticTokens:S0e,direction:b0e,...A_e,components:y0e,styles:T0e,config:w0e};function C0e(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var I0e=C0e();function A0e(r,t){const s={};return Object.keys(r).forEach(a=>{t.includes(a)||(s[a]=r[a])}),s}function O0e(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}var P0e=r=>{const t=new WeakMap;return(a,l,d,g)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const S=r(a,l,d,g);return E.set(l,S),S}},cX=P0e(O0e);function lX(r,t){const s={};return Object.keys(r).forEach(a=>{const l=r[a];t(l,a,r)&&(s[a]=l)}),s}var uX=r=>lX(r,t=>t!=null);function N0e(r){return typeof r=="function"}function dX(r,...t){return N0e(r)?r(...t):r}function k0e(...r){return function(s){r.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}const hX=1/60*1e3,D0e=typeof performance<"u"?()=>performance.now():()=>Date.now(),pX=typeof window<"u"?r=>window.requestAnimationFrame(r):r=>setTimeout(()=>r(D0e()),hX);function L0e(r){let t=[],s=[],a=0,l=!1,d=!1;const g=new WeakSet,E={schedule:(S,b=!1,R=!1)=>{const O=R&&l,N=O?t:s;return b&&g.add(S),N.indexOf(S)===-1&&(N.push(S),O&&l&&(a=t.length)),S},cancel:S=>{const b=s.indexOf(S);b!==-1&&s.splice(b,1),g.delete(S)},process:S=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let b=0;b<a;b++){const R=t[b];R(S),g.has(R)&&(E.schedule(R),r())}l=!1,d&&(d=!1,E.process(S))}};return E}const x0e=40;let BM=!0,$b=!1,WM=!1;const My={delta:0,timestamp:0},Ew=["read","update","preRender","render","postRender"],zP=Ew.reduce((r,t)=>(r[t]=L0e(()=>$b=!0),r),{}),M0e=Ew.reduce((r,t)=>{const s=zP[t];return r[t]=(a,l=!1,d=!1)=>($b||F0e(),s.schedule(a,l,d)),r},{}),U0e=Ew.reduce((r,t)=>(r[t]=zP[t].cancel,r),{});Ew.reduce((r,t)=>(r[t]=()=>zP[t].process(My),r),{});const V0e=r=>zP[r].process(My),fX=r=>{$b=!1,My.delta=BM?hX:Math.max(Math.min(r-My.timestamp,x0e),1),My.timestamp=r,WM=!0,Ew.forEach(V0e),WM=!1,$b&&(BM=!1,pX(fX))},F0e=()=>{$b=!0,BM=!0,WM||pX(fX)},AK=()=>My;var Ox,OK;function j0e(){if(OK)return Ox;OK=1;var r=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,g){if(d===g)return!0;if(d&&g&&typeof d=="object"&&typeof g=="object"){if(d.constructor!==g.constructor)return!1;var E,S,b;if(Array.isArray(d)){if(E=d.length,E!=g.length)return!1;for(S=E;S--!==0;)if(!l(d[S],g[S]))return!1;return!0}var R;if(t&&d instanceof Map&&g instanceof Map){if(d.size!==g.size)return!1;for(R=d.entries();!(S=R.next()).done;)if(!g.has(S.value[0]))return!1;for(R=d.entries();!(S=R.next()).done;)if(!l(S.value[1],g.get(S.value[0])))return!1;return!0}if(s&&d instanceof Set&&g instanceof Set){if(d.size!==g.size)return!1;for(R=d.entries();!(S=R.next()).done;)if(!g.has(S.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(g)){if(E=d.length,E!=g.length)return!1;for(S=E;S--!==0;)if(d[S]!==g[S])return!1;return!0}if(d.constructor===RegExp)return d.source===g.source&&d.flags===g.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof g.valueOf=="function")return d.valueOf()===g.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof g.toString=="function")return d.toString()===g.toString();if(b=Object.keys(d),E=b.length,E!==Object.keys(g).length)return!1;for(S=E;S--!==0;)if(!Object.prototype.hasOwnProperty.call(g,b[S]))return!1;if(r&&d instanceof Element)return!1;for(S=E;S--!==0;)if(!((b[S]==="_owner"||b[S]==="__v"||b[S]==="__o")&&d.$$typeof)&&!l(d[b[S]],g[b[S]]))return!1;return!0}return d!==d&&g!==g}return Ox=function(g,E){try{return l(g,E)}catch(S){if((S.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw S}},Ox}var B0e=j0e();const W0e=lS(B0e);function mX(r,t={}){var s;const{styleConfig:a,...l}=t,{theme:d,colorMode:g}=jY(),E=r?cX(d,`components.${r}`):void 0,S=a||E,b=Zd({theme:d,colorMode:g},(s=S==null?void 0:S.defaultProps)!=null?s:{},uX(A0e(l,["children"]))),R=B.useRef({});if(S){const N=r_e(S)(b);W0e(R.current,N)||(R.current=N)}return R.current}function Qu(r,t={}){return mX(r,t)}function Pc(r,t={}){return mX(r,t)}var G0e=new Set([...Hge,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),z0e=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function H0e(r){return z0e.has(r)||!G0e.has(r)}function K0e(r,...t){if(r==null)throw new TypeError("Cannot convert undefined or null to object");const s={...r};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}function gX(r){const t=Object.assign({},r);for(let s in t)t[s]===void 0&&delete t[s];return t}var $0e=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,q0e=IY(function(r){return $0e.test(r)||r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)<91}),Y0e=q0e,X0e=function(t){return t!=="theme"},PK=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?Y0e:X0e},NK=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(g){return t.__emotion_forwardProp(g)&&d(g)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},J0e=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return OY(s,a,l),_me(function(){return PY(s,a,l)}),null},Q0e=function r(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,g;s!==void 0&&(d=s.label,g=s.target);var E=NK(t,s,a),S=E||PK(l),b=!S("as");return function(){var R=arguments,O=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&O.push("label:"+d+";"),R[0]==null||R[0].raw===void 0)O.push.apply(O,R);else{O.push(R[0][0]);for(var N=R.length,U=1;U<N;U++)O.push(R[U],R[0][U])}var K=LY(function(z,H,ne){var J=b&&z.as||l,se="",le=[],ce=z;if(z.theme==null){ce={};for(var Se in z)ce[Se]=z[Se];ce.theme=B.useContext(Wb)}typeof z.className=="string"?se=ume(H.registered,le,z.className):z.className!=null&&(se=z.className+" ");var Z=sU(O.concat(le),H.registered,ce);se+=H.key+"-"+Z.name,g!==void 0&&(se+=" "+g);var te=b&&E===void 0?PK(J):S,ie={};for(var ae in z)b&&ae==="as"||te(ae)&&(ie[ae]=z[ae]);return ie.className=se,ie.ref=ne,B.createElement(B.Fragment,null,B.createElement(J0e,{cache:H,serialized:Z,isStringTag:typeof J=="string"}),B.createElement(J,ie))});return K.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",K.defaultProps=t.defaultProps,K.__emotion_real=K,K.__emotion_base=l,K.__emotion_styles=O,K.__emotion_forwardProp=E,Object.defineProperty(K,"toString",{value:function(){return"."+g}}),K.withComponent=function(z,H){return r(z,U_({},s,H,{shouldForwardProp:NK(K,H,!0)})).apply(void 0,O)},K}},Z0e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],tP=Q0e.bind();Z0e.forEach(function(r){tP[r]=tP(r)});var kK,ebe=(kK=tP.default)!=null?kK:tP,tbe=({baseStyle:r})=>t=>{const{theme:s,css:a,__css:l,sx:d,...g}=t,E=lX(g,(O,N)=>$ge(N)),S=dX(r,t),b=K0e({},l,S,uX(E),d),R=qY(b)(t.theme);return a?[R,a]:R};function Px(r,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=H0e);const l=tbe({baseStyle:s}),d=ebe(r,a)(l);return Bi.forwardRef(function(S,b){const{colorMode:R,forced:O}=FP();return Bi.createElement(d,{ref:b,"data-theme":O?R:void 0,...S})})}function nbe(){const r=new Map;return new Proxy(Px,{apply(t,s,a){return Px(...a)},get(t,s){return r.has(s)||r.set(s,Px(s)),r.get(s)}})}var Nt=nbe();function qt(r){return B.forwardRef(r)}function rbe(r={}){const{strict:t=!0,errorMessage:s="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:a}=r,l=B.createContext(void 0);l.displayName=a;function d(){var g;const E=B.useContext(l);if(!E&&t){const S=new Error(s);throw S.name="ContextError",(g=Error.captureStackTrace)==null||g.call(Error,S,d),S}return E}return[l.Provider,d,l]}function ibe(r){const{cssVarsRoot:t,theme:s,children:a}=r,l=B.useMemo(()=>Wge(s),[s]);return F.jsxs(yme,{theme:l,children:[F.jsx(sbe,{root:t}),a]})}function sbe({root:r=":host, :root"}){const t=[r,"[data-theme]"].join(",");return F.jsx(VP,{styles:s=>({[t]:s.__cssVars})})}rbe({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function obe(){const{colorMode:r}=FP();return F.jsx(VP,{styles:t=>{const s=cX(t,"styles.global"),a=dX(s,{theme:t,colorMode:r});return a?qY(a)(t):void 0}})}var _X=B.createContext({getDocument(){return document},getWindow(){return window}});_X.displayName="EnvironmentContext";function vX(r){const{children:t,environment:s,disabled:a}=r,l=B.useRef(null),d=B.useMemo(()=>s||{getDocument:()=>{var E,S;return(S=(E=l.current)==null?void 0:E.ownerDocument)!=null?S:document},getWindow:()=>{var E,S;return(S=(E=l.current)==null?void 0:E.ownerDocument.defaultView)!=null?S:window}},[s]),g=!a||!s;return F.jsxs(_X.Provider,{value:d,children:[t,g&&F.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}vX.displayName="EnvironmentProvider";var abe=r=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:g={},environment:E,cssVarsRoot:S,disableEnvironment:b,disableGlobalStyle:R}=r,O=F.jsx(vX,{environment:E,disabled:b,children:t});return F.jsx(ibe,{theme:g,cssVarsRoot:S,children:F.jsxs(FY,{colorModeManager:s,options:g.config,children:[d?F.jsx(bme,{scope:l}):F.jsx(Tme,{}),!R&&F.jsx(obe,{}),a?F.jsx(oU,{zIndex:a,children:O}):O]})})},cbe=(r,t)=>r.find(s=>s.id===t);function DK(r,t){const s=EX(r,t),a=s?r[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function EX(r,t){for(const[s,a]of Object.entries(r))if(cbe(a,t))return s}function lbe(r){const t=r.includes("right"),s=r.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function ube(r){const s=r==="top"||r==="bottom"?"0 auto":void 0,a=r.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=r.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=r.includes("left")?void 0:"env(safe-area-inset-right, 0px)",g=r.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:g}}function Rc(r,t=[]){const s=B.useRef(r);return B.useEffect(()=>{s.current=r}),B.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function dbe(r,t){const s=Rc(r);B.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}function V_(r,t){const s=B.useRef(!1),a=B.useRef(!1);B.useEffect(()=>{if(s.current&&a.current)return r();a.current=!0},t),B.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])}const _U=B.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"}),HP=B.createContext({}),yw=B.createContext(null),vU=typeof document<"u",EU=vU?B.useLayoutEffect:B.useEffect,yX=B.createContext({strict:!1}),yU=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),hbe="framerAppearId",SX="data-"+yU(hbe),pbe={useManualTiming:!1};class LK{constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const s=this.order.indexOf(t);s!==-1&&(this.order.splice(s,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function fbe(r){let t=new LK,s=new LK,a=0,l=!1,d=!1;const g=new WeakSet,E={schedule:(S,b=!1,R=!1)=>{const O=R&&l,N=O?t:s;return b&&g.add(S),N.add(S)&&O&&l&&(a=t.order.length),S},cancel:S=>{s.remove(S),g.delete(S)},process:S=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.clear(),a=t.order.length,a)for(let b=0;b<a;b++){const R=t.order[b];g.has(R)&&(E.schedule(R),r()),R(S)}l=!1,d&&(d=!1,E.process(S))}};return E}const JA=["read","resolveKeyframes","update","preRender","render","postRender"],mbe=40;function TX(r,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=JA.reduce((O,N)=>(O[N]=fbe(()=>s=!0),O),{}),g=O=>{d[O].process(l)},E=()=>{const O=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(O-l.timestamp,mbe),1),l.timestamp=O,l.isProcessing=!0,JA.forEach(g),l.isProcessing=!1,s&&t&&(a=!1,r(E))},S=()=>{s=!0,a=!0,l.isProcessing||r(E)};return{schedule:JA.reduce((O,N)=>{const U=d[N];return O[N]=(K,z=!1,H=!1)=>(s||S(),U.schedule(K,z,H)),O},{}),cancel:O=>JA.forEach(N=>d[N].cancel(O)),state:l,steps:d}}const{schedule:SU}=TX(queueMicrotask,!1);function gbe(r,t,s,a){const{visualElement:l}=B.useContext(HP),d=B.useContext(yX),g=B.useContext(yw),E=B.useContext(_U).reducedMotion,S=B.useRef();a=a||d.renderer,!S.current&&a&&(S.current=a(r,{visualState:t,parent:l,props:s,presenceContext:g,blockInitialAnimation:g?g.initial===!1:!1,reducedMotionConfig:E}));const b=S.current;B.useInsertionEffect(()=>{b&&b.update(s,g)});const R=B.useRef(!!(s[SX]&&!window.HandoffComplete));return EU(()=>{b&&(SU.render(b.render),R.current&&b.animationState&&b.animationState.animateChanges())}),B.useEffect(()=>{b&&(b.updateFeatures(),!R.current&&b.animationState&&b.animationState.animateChanges(),R.current&&(R.current=!1,window.HandoffComplete=!0))}),b}function wy(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function _be(r,t,s){return B.useCallback(a=>{a&&r.mount&&r.mount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):wy(s)&&(s.current=a))},[t])}function qb(r){return typeof r=="string"||Array.isArray(r)}function KP(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}const TU=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],bU=["initial",...TU];function $P(r){return KP(r.animate)||bU.some(t=>qb(r[t]))}function bX(r){return!!($P(r)||r.variants)}function vbe(r,t){if($P(r)){const{initial:s,animate:a}=r;return{initial:s===!1||qb(s)?s:void 0,animate:qb(a)?a:void 0}}return r.inherit!==!1?t:{}}function Ebe(r){const{initial:t,animate:s}=vbe(r,B.useContext(HP));return B.useMemo(()=>({initial:t,animate:s}),[xK(t),xK(s)])}function xK(r){return Array.isArray(r)?r.join(" "):r}const MK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Yb={};for(const r in MK)Yb[r]={isEnabled:t=>MK[r].some(s=>!!t[s])};function ybe(r){for(const t in r)Yb[t]={...Yb[t],...r[t]}}const wU=B.createContext({}),wX=B.createContext({}),Sbe=Symbol.for("motionComponentSymbol");function Tbe({preloadedFeatures:r,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){r&&ybe(r);function d(E,S){let b;const R={...B.useContext(_U),...E,layoutId:bbe(E)},{isStatic:O}=R,N=Ebe(E),U=a(E,O);if(!O&&vU){N.visualElement=gbe(l,U,R,t);const K=B.useContext(wX),z=B.useContext(yX).strict;N.visualElement&&(b=N.visualElement.loadFeatures(R,z,r,K))}return F.jsxs(HP.Provider,{value:N,children:[b&&N.visualElement?F.jsx(b,{visualElement:N.visualElement,...R}):null,s(l,E,_be(U,N.visualElement,S),U,O,N.visualElement)]})}const g=B.forwardRef(d);return g[Sbe]=l,g}function bbe({layoutId:r}){const t=B.useContext(wU).id;return t&&r!==void 0?t+"-"+r:r}function wbe(r){function t(a,l={}){return Tbe(r(a,l))}if(typeof Proxy>"u")return t;const s=new Map;return new Proxy(t,{get:(a,l)=>(s.has(l)||s.set(l,t(l)),s.get(l))})}const Rbe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function RU(r){return typeof r!="string"||r.includes("-")?!1:!!(Rbe.indexOf(r)>-1||/[A-Z]/u.test(r))}const nP={};function Cbe(r){Object.assign(nP,r)}const Sw=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],J_=new Set(Sw);function RX(r,{layout:t,layoutId:s}){return J_.has(r)||r.startsWith("origin")||(t||s!==void 0)&&(!!nP[r]||r==="opacity")}const _a=r=>!!(r&&r.getVelocity),Ibe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Abe=Sw.length;function Obe(r,{enableHardwareAcceleration:t=!0,allowTransformNone:s=!0},a,l){let d="";for(let g=0;g<Abe;g++){const E=Sw[g];if(r[E]!==void 0){const S=Ibe[E]||E;d+=`${S}(${r[E]}) `}}return t&&!r.z&&(d+="translateZ(0)"),d=d.trim(),l?d=l(r,a?"":d):s&&a&&(d="none"),d}const CX=r=>t=>typeof t=="string"&&t.startsWith(r),IX=CX("--"),Pbe=CX("var(--"),CU=r=>Pbe(r)?Nbe.test(r.split("/*")[0].trim()):!1,Nbe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,kbe=(r,t)=>t&&typeof r=="number"?t.transform(r):r,Em=(r,t,s)=>s>t?t:s<r?r:s,hS={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},Ib={...hS,transform:r=>Em(0,1,r)},QA={...hS,default:1},Ab=r=>Math.round(r*1e5)/1e5,IU=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,Dbe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,Lbe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function Tw(r){return typeof r=="string"}const bw=r=>({test:t=>Tw(t)&&t.endsWith(r)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${r}`}),im=bw("deg"),ih=bw("%"),Rn=bw("px"),xbe=bw("vh"),Mbe=bw("vw"),UK={...ih,parse:r=>ih.parse(r)/100,transform:r=>ih.transform(r*100)},VK={...hS,transform:Math.round},AX={borderWidth:Rn,borderTopWidth:Rn,borderRightWidth:Rn,borderBottomWidth:Rn,borderLeftWidth:Rn,borderRadius:Rn,radius:Rn,borderTopLeftRadius:Rn,borderTopRightRadius:Rn,borderBottomRightRadius:Rn,borderBottomLeftRadius:Rn,width:Rn,maxWidth:Rn,height:Rn,maxHeight:Rn,size:Rn,top:Rn,right:Rn,bottom:Rn,left:Rn,padding:Rn,paddingTop:Rn,paddingRight:Rn,paddingBottom:Rn,paddingLeft:Rn,margin:Rn,marginTop:Rn,marginRight:Rn,marginBottom:Rn,marginLeft:Rn,rotate:im,rotateX:im,rotateY:im,rotateZ:im,scale:QA,scaleX:QA,scaleY:QA,scaleZ:QA,skew:im,skewX:im,skewY:im,distance:Rn,translateX:Rn,translateY:Rn,translateZ:Rn,x:Rn,y:Rn,z:Rn,perspective:Rn,transformPerspective:Rn,opacity:Ib,originX:UK,originY:UK,originZ:Rn,zIndex:VK,backgroundPositionX:Rn,backgroundPositionY:Rn,fillOpacity:Ib,strokeOpacity:Ib,numOctaves:VK};function AU(r,t,s,a){const{style:l,vars:d,transform:g,transformOrigin:E}=r;let S=!1,b=!1,R=!0;for(const O in t){const N=t[O];if(IX(O)){d[O]=N;continue}const U=AX[O],K=kbe(N,U);if(J_.has(O)){if(S=!0,g[O]=K,!R)continue;N!==(U.default||0)&&(R=!1)}else O.startsWith("origin")?(b=!0,E[O]=K):l[O]=K}if(t.transform||(S||a?l.transform=Obe(r.transform,s,R,a):l.transform&&(l.transform="none")),b){const{originX:O="50%",originY:N="50%",originZ:U=0}=E;l.transformOrigin=`${O} ${N} ${U}`}}const OU=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function OX(r,t,s){for(const a in t)!_a(t[a])&&!RX(a,s)&&(r[a]=t[a])}function Ube({transformTemplate:r},t,s){return B.useMemo(()=>{const a=OU();return AU(a,t,{enableHardwareAcceleration:!s},r),Object.assign({},a.vars,a.style)},[t])}function Vbe(r,t,s){const a=r.style||{},l={};return OX(l,a,r),Object.assign(l,Ube(r,t,s)),l}function Fbe(r,t,s){const a={},l=Vbe(r,t,s);return r.drag&&r.dragListener!==!1&&(a.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(a.tabIndex=0),a.style=l,a}const jbe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function rP(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||jbe.has(r)}let PX=r=>!rP(r);function Bbe(r){r&&(PX=t=>t.startsWith("on")?!rP(t):r(t))}try{Bbe(require("@emotion/is-prop-valid").default)}catch{}function Wbe(r,t,s){const a={};for(const l in r)l==="values"&&typeof r.values=="object"||(PX(l)||s===!0&&rP(l)||!t&&!rP(l)||r.draggable&&l.startsWith("onDrag"))&&(a[l]=r[l]);return a}function FK(r,t,s){return typeof r=="string"?r:Rn.transform(t+s*r)}function Gbe(r,t,s){const a=FK(t,r.x,r.width),l=FK(s,r.y,r.height);return`${a} ${l}`}const zbe={offset:"stroke-dashoffset",array:"stroke-dasharray"},Hbe={offset:"strokeDashoffset",array:"strokeDasharray"};function Kbe(r,t,s=1,a=0,l=!0){r.pathLength=1;const d=l?zbe:Hbe;r[d.offset]=Rn.transform(-a);const g=Rn.transform(t),E=Rn.transform(s);r[d.array]=`${g} ${E}`}function PU(r,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:g,pathSpacing:E=1,pathOffset:S=0,...b},R,O,N){if(AU(r,b,R,N),O){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:U,style:K,dimensions:z}=r;U.transform&&(z&&(K.transform=U.transform),delete U.transform),z&&(l!==void 0||d!==void 0||K.transform)&&(K.transformOrigin=Gbe(z,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(U.x=t),s!==void 0&&(U.y=s),a!==void 0&&(U.scale=a),g!==void 0&&Kbe(U,g,E,S,!1)}const NX=()=>({...OU(),attrs:{}}),NU=r=>typeof r=="string"&&r.toLowerCase()==="svg";function $be(r,t,s,a){const l=B.useMemo(()=>{const d=NX();return PU(d,t,{enableHardwareAcceleration:!1},NU(a),r.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(r.style){const d={};OX(d,r.style,r),l.style={...d,...l.style}}return l}function qbe(r=!1){return(s,a,l,{latestValues:d},g)=>{const S=(RU(s)?$be:Fbe)(a,d,g,s),b=Wbe(a,typeof s=="string",r),R=s!==B.Fragment?{...b,...S,ref:l}:{},{children:O}=a,N=B.useMemo(()=>_a(O)?O.get():O,[O]);return B.createElement(s,{...R,children:N})}}function kX(r,{style:t,vars:s},a,l){Object.assign(r.style,t,l&&l.getProjectionStyles(a));for(const d in s)r.style.setProperty(d,s[d])}const DX=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function LX(r,t,s,a){kX(r,t,void 0,a);for(const l in t.attrs)r.setAttribute(DX.has(l)?l:yU(l),t.attrs[l])}function kU(r,t,s){var a;const{style:l}=r,d={};for(const g in l)(_a(l[g])||t.style&&_a(t.style[g])||RX(g,r)||((a=s==null?void 0:s.getValue(g))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[g]=l[g]);return d}function xX(r,t,s){const a=kU(r,t,s);for(const l in r)if(_a(r[l])||_a(t[l])){const d=Sw.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=r[l]}return a}function jK(r){const t=[{},{}];return r==null||r.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function DU(r,t,s,a){if(typeof t=="function"){const[l,d]=jK(a);t=t(s!==void 0?s:r.custom,l,d)}if(typeof t=="string"&&(t=r.variants&&r.variants[t]),typeof t=="function"){const[l,d]=jK(a);t=t(s!==void 0?s:r.custom,l,d)}return t}function MX(r){const t=B.useRef(null);return t.current===null&&(t.current=r()),t.current}const GM=r=>Array.isArray(r),Ybe=r=>!!(r&&typeof r=="object"&&r.mix&&r.toValue),Xbe=r=>GM(r)?r[r.length-1]||0:r;function OO(r){const t=_a(r)?r.get():r;return Ybe(t)?t.toValue():t}function Jbe({scrapeMotionValuesFromProps:r,createRenderState:t,onMount:s},a,l,d){const g={latestValues:Qbe(a,l,d,r),renderState:t()};return s&&(g.mount=E=>s(a,E,g)),g}const UX=r=>(t,s)=>{const a=B.useContext(HP),l=B.useContext(yw),d=()=>Jbe(r,t,a,l);return s?d():MX(d)};function Qbe(r,t,s,a){const l={},d=a(r,{});for(const N in d)l[N]=OO(d[N]);let{initial:g,animate:E}=r;const S=$P(r),b=bX(r);t&&b&&!S&&r.inherit!==!1&&(g===void 0&&(g=t.initial),E===void 0&&(E=t.animate));let R=s?s.initial===!1:!1;R=R||g===!1;const O=R?E:g;return O&&typeof O!="boolean"&&!KP(O)&&(Array.isArray(O)?O:[O]).forEach(U=>{const K=DU(r,U);if(!K)return;const{transitionEnd:z,transition:H,...ne}=K;for(const J in ne){let se=ne[J];if(Array.isArray(se)){const le=R?se.length-1:0;se=se[le]}se!==null&&(l[J]=se)}for(const J in z)l[J]=z[J]}),l}const va=r=>r,{schedule:gi,cancel:ym,state:Fo,steps:Nx}=TX(typeof requestAnimationFrame<"u"?requestAnimationFrame:va,!0),Zbe={useVisualState:UX({scrapeMotionValuesFromProps:xX,createRenderState:NX,onMount:(r,t,{renderState:s,latestValues:a})=>{gi.read(()=>{try{s.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{s.dimensions={x:0,y:0,width:0,height:0}}}),gi.render(()=>{PU(s,a,{enableHardwareAcceleration:!1},NU(t.tagName),r.transformTemplate),LX(t,s)})}})},ewe={useVisualState:UX({scrapeMotionValuesFromProps:kU,createRenderState:OU})};function twe(r,{forwardMotionProps:t=!1},s,a){return{...RU(r)?Zbe:ewe,preloadedFeatures:s,useRender:qbe(t),createVisualElement:a,Component:r}}function Sp(r,t,s,a={passive:!0}){return r.addEventListener(t,s,a),()=>r.removeEventListener(t,s)}const VX=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1;function qP(r,t="page"){return{point:{x:r[`${t}X`],y:r[`${t}Y`]}}}const nwe=r=>t=>VX(t)&&r(t,qP(t));function Ip(r,t,s,a){return Sp(r,t,nwe(s),a)}const rwe=(r,t)=>s=>t(r(s)),Ap=(...r)=>r.reduce(rwe);function FX(r){let t=null;return()=>{const s=()=>{t=null};return t===null?(t=r,s):!1}}const BK=FX("dragHorizontal"),WK=FX("dragVertical");function jX(r){let t=!1;if(r==="y")t=WK();else if(r==="x")t=BK();else{const s=BK(),a=WK();s&&a?t=()=>{s(),a()}:(s&&s(),a&&a())}return t}function BX(){const r=jX(!0);return r?(r(),!1):!0}class Am{constructor(t){this.isMounted=!1,this.node=t}update(){}}function GK(r,t){const s=t?"pointerenter":"pointerleave",a=t?"onHoverStart":"onHoverEnd",l=(d,g)=>{if(d.pointerType==="touch"||BX())return;const E=r.getProps();r.animationState&&E.whileHover&&r.animationState.setActive("whileHover",t);const S=E[a];S&&gi.postRender(()=>S(d,g))};return Ip(r.current,s,l,{passive:!r.getProps()[a]})}class iwe extends Am{mount(){this.unmount=Ap(GK(this.node,!0),GK(this.node,!1))}unmount(){}}class swe extends Am{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ap(Sp(this.node.current,"focus",()=>this.onFocus()),Sp(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const WX=(r,t)=>t?r===t?!0:WX(r,t.parentElement):!1;function kx(r,t){if(!t)return;const s=new PointerEvent("pointer"+r);t(s,qP(s))}class owe extends Am{constructor(){super(...arguments),this.removeStartListeners=va,this.removeEndListeners=va,this.removeAccessibleListeners=va,this.startPointerPress=(t,s)=>{if(this.isPressing)return;this.removeEndListeners();const a=this.node.getProps(),d=Ip(window,"pointerup",(E,S)=>{if(!this.checkPressEnd())return;const{onTap:b,onTapCancel:R,globalTapTarget:O}=this.node.getProps(),N=!O&&!WX(this.node.current,E.target)?R:b;N&&gi.update(()=>N(E,S))},{passive:!(a.onTap||a.onPointerUp)}),g=Ip(window,"pointercancel",(E,S)=>this.cancelPress(E,S),{passive:!(a.onTapCancel||a.onPointerCancel)});this.removeEndListeners=Ap(d,g),this.startPress(t,s)},this.startAccessiblePress=()=>{const t=d=>{if(d.key!=="Enter"||this.isPressing)return;const g=E=>{E.key!=="Enter"||!this.checkPressEnd()||kx("up",(S,b)=>{const{onTap:R}=this.node.getProps();R&&gi.postRender(()=>R(S,b))})};this.removeEndListeners(),this.removeEndListeners=Sp(this.node.current,"keyup",g),kx("down",(E,S)=>{this.startPress(E,S)})},s=Sp(this.node.current,"keydown",t),a=()=>{this.isPressing&&kx("cancel",(d,g)=>this.cancelPress(d,g))},l=Sp(this.node.current,"blur",a);this.removeAccessibleListeners=Ap(s,l)}}startPress(t,s){this.isPressing=!0;const{onTapStart:a,whileTap:l}=this.node.getProps();l&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),a&&gi.postRender(()=>a(t,s))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!BX()}cancelPress(t,s){if(!this.checkPressEnd())return;const{onTapCancel:a}=this.node.getProps();a&&gi.postRender(()=>a(t,s))}mount(){const t=this.node.getProps(),s=Ip(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),a=Sp(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Ap(s,a)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const zM=new WeakMap,Dx=new WeakMap,awe=r=>{const t=zM.get(r.target);t&&t(r)},cwe=r=>{r.forEach(awe)};function lwe({root:r,...t}){const s=r||document;Dx.has(s)||Dx.set(s,{});const a=Dx.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(cwe,{root:r,...t})),a[l]}function uwe(r,t,s){const a=lwe(t);return zM.set(r,s),a.observe(r),()=>{zM.delete(r),a.unobserve(r)}}const dwe={some:0,all:1};class hwe extends Am{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,g={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:dwe[l]},E=S=>{const{isIntersecting:b}=S;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:R,onViewportLeave:O}=this.node.getProps(),N=b?R:O;N&&N(S)};return uwe(this.node.current,g,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(pwe(t,s))&&this.startObserver()}unmount(){}}function pwe({viewport:r={}},{viewport:t={}}={}){return s=>r[s]!==t[s]}const fwe={inView:{Feature:hwe},tap:{Feature:owe},focus:{Feature:swe},hover:{Feature:iwe}};function GX(r,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==r.length)return!1;for(let a=0;a<s;a++)if(t[a]!==r[a])return!1;return!0}function YP(r,t,s){const a=r.getProps();return DU(a,t,s!==void 0?s:a.custom,r)}const pm=r=>r*1e3,Op=r=>r/1e3,mwe={type:"spring",stiffness:500,damping:25,restSpeed:10},gwe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),_we={type:"keyframes",duration:.8},vwe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ewe=(r,{keyframes:t})=>t.length>2?_we:J_.has(r)?r.startsWith("scale")?gwe(t[1]):mwe:vwe;function ywe({when:r,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:g,repeatDelay:E,from:S,elapsed:b,...R}){return!!Object.keys(R).length}function LU(r,t){return r[t]||r.default||r}const Swe=r=>r!==null;function XP(r,{repeat:t,repeatType:s="loop"},a){const l=r.filter(Swe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}let PO;function Twe(){PO=void 0}const fm={now:()=>(PO===void 0&&fm.set(Fo.isProcessing||pbe.useManualTiming?Fo.timestamp:performance.now()),PO),set:r=>{PO=r,queueMicrotask(Twe)}},zX=r=>/^0[^.\s]+$/u.test(r);function bwe(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||zX(r):!0}let HX=va;const KX=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r),wwe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Rwe(r){const t=wwe.exec(r);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function $X(r,t,s=1){const[a,l]=Rwe(r);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const g=d.trim();return KX(g)?parseFloat(g):g}return CU(l)?$X(l,t,s+1):l}const Cwe=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),zK=r=>r===hS||r===Rn,HK=(r,t)=>parseFloat(r.split(", ")[t]),KK=(r,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return HK(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?HK(d[1],r):0}},Iwe=new Set(["x","y","z"]),Awe=Sw.filter(r=>!Iwe.has(r));function Owe(r){const t=[];return Awe.forEach(s=>{const a=r.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const qy={width:({x:r},{paddingLeft:t="0",paddingRight:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),height:({y:r},{paddingTop:t="0",paddingBottom:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),top:(r,{top:t})=>parseFloat(t),left:(r,{left:t})=>parseFloat(t),bottom:({y:r},{top:t})=>parseFloat(t)+(r.max-r.min),right:({x:r},{left:t})=>parseFloat(t)+(r.max-r.min),x:KK(4,13),y:KK(5,14)};qy.translateX=qy.x;qy.translateY=qy.y;const qX=r=>t=>t.test(r),Pwe={test:r=>r==="auto",parse:r=>r},YX=[hS,Rn,ih,im,Mbe,xbe,Pwe],$K=r=>YX.find(qX(r)),P_=new Set;let HM=!1,KM=!1;function XX(){if(KM){const r=Array.from(P_).filter(a=>a.needsMeasurement),t=new Set(r.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=Owe(a);l.length&&(s.set(a,l),a.render())}),r.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,g])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(g)})}),r.forEach(a=>a.measureEndState()),r.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}KM=!1,HM=!1,P_.forEach(r=>r.complete()),P_.clear()}function JX(){P_.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(KM=!0)})}function Nwe(){JX(),XX()}class xU{constructor(t,s,a,l,d,g=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=g}scheduleResolve(){this.isScheduled=!0,this.isAsync?(P_.add(this),HM||(HM=!0,gi.read(JX),gi.resolveKeyframes(XX))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const g=l==null?void 0:l.get(),E=t[t.length-1];if(g!==void 0)t[0]=g;else if(a&&s){const S=a.readValue(s,E);S!=null&&(t[0]=S)}t[0]===void 0&&(t[0]=E),l&&g===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),P_.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,P_.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const MU=(r,t)=>s=>!!(Tw(s)&&Lbe.test(s)&&s.startsWith(r)||t&&Object.prototype.hasOwnProperty.call(s,t)),QX=(r,t,s)=>a=>{if(!Tw(a))return a;const[l,d,g,E]=a.match(IU);return{[r]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(g),alpha:E!==void 0?parseFloat(E):1}},kwe=r=>Em(0,255,r),Lx={...hS,transform:r=>Math.round(kwe(r))},w_={test:MU("rgb","red"),parse:QX("red","green","blue"),transform:({red:r,green:t,blue:s,alpha:a=1})=>"rgba("+Lx.transform(r)+", "+Lx.transform(t)+", "+Lx.transform(s)+", "+Ab(Ib.transform(a))+")"};function Dwe(r){let t="",s="",a="",l="";return r.length>5?(t=r.substring(1,3),s=r.substring(3,5),a=r.substring(5,7),l=r.substring(7,9)):(t=r.substring(1,2),s=r.substring(2,3),a=r.substring(3,4),l=r.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const $M={test:MU("#"),parse:Dwe,transform:w_.transform},Ry={test:MU("hsl","hue"),parse:QX("hue","saturation","lightness"),transform:({hue:r,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(r)+", "+ih.transform(Ab(t))+", "+ih.transform(Ab(s))+", "+Ab(Ib.transform(a))+")"},fa={test:r=>w_.test(r)||$M.test(r)||Ry.test(r),parse:r=>w_.test(r)?w_.parse(r):Ry.test(r)?Ry.parse(r):$M.parse(r),transform:r=>Tw(r)?r:r.hasOwnProperty("red")?w_.transform(r):Ry.transform(r)};function Lwe(r){var t,s;return isNaN(r)&&Tw(r)&&(((t=r.match(IU))===null||t===void 0?void 0:t.length)||0)+(((s=r.match(Dbe))===null||s===void 0?void 0:s.length)||0)>0}const ZX="number",eJ="color",xwe="var",Mwe="var(",qK="${}",Uwe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Xb(r){const t=r.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(Uwe,S=>(fa.test(S)?(a.color.push(d),l.push(eJ),s.push(fa.parse(S))):S.startsWith(Mwe)?(a.var.push(d),l.push(xwe),s.push(S)):(a.number.push(d),l.push(ZX),s.push(parseFloat(S))),++d,qK)).split(qK);return{values:s,split:E,indexes:a,types:l}}function tJ(r){return Xb(r).values}function nJ(r){const{split:t,types:s}=Xb(r),a=t.length;return l=>{let d="";for(let g=0;g<a;g++)if(d+=t[g],l[g]!==void 0){const E=s[g];E===ZX?d+=Ab(l[g]):E===eJ?d+=fa.transform(l[g]):d+=l[g]}return d}}const Vwe=r=>typeof r=="number"?0:r;function Fwe(r){const t=tJ(r);return nJ(r)(t.map(Vwe))}const Sm={test:Lwe,parse:tJ,createTransformer:nJ,getAnimatableNone:Fwe},jwe=new Set(["brightness","contrast","saturate","opacity"]);function Bwe(r){const[t,s]=r.slice(0,-1).split("(");if(t==="drop-shadow")return r;const[a]=s.match(IU)||[];if(!a)return r;const l=s.replace(a,"");let d=jwe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const Wwe=/\b([a-z-]*)\(.*?\)/gu,qM={...Sm,getAnimatableNone:r=>{const t=r.match(Wwe);return t?t.map(Bwe).join(" "):r}},Gwe={...AX,color:fa,backgroundColor:fa,outlineColor:fa,fill:fa,stroke:fa,borderColor:fa,borderTopColor:fa,borderRightColor:fa,borderBottomColor:fa,borderLeftColor:fa,filter:qM,WebkitFilter:qM},UU=r=>Gwe[r];function rJ(r,t){let s=UU(r);return s!==qM&&(s=Sm),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const zwe=new Set(["auto","none","0"]);function Hwe(r,t,s){let a=0,l;for(;a<r.length&&!l;){const d=r[a];typeof d=="string"&&!zwe.has(d)&&Xb(d).values.length&&(l=r[a]),a++}if(l&&s)for(const d of t)r[d]=rJ(s,l)}class iJ extends xU{constructor(t,s,a,l){super(t,s,a,l,l==null?void 0:l.owner,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s.current)return;super.readKeyframes();for(let S=0;S<t.length;S++){const b=t[S];if(typeof b=="string"&&CU(b)){const R=$X(b,s.current);R!==void 0&&(t[S]=R),S===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!Cwe.has(a)||t.length!==2)return;const[l,d]=t,g=$K(l),E=$K(d);if(g!==E)if(zK(g)&&zK(E))for(let S=0;S<t.length;S++){const b=t[S];typeof b=="string"&&(t[S]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)bwe(t[l])&&a.push(l);a.length&&Hwe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=qy[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const g=l.length-1,E=l[g];l[g]=qy[a](s.measureViewportBox(),window.getComputedStyle(s.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([S,b])=>{s.getValue(S).set(b)}),this.resolveNoneKeyframes()}}function Kwe(r){let t;return()=>(t===void 0&&(t=r()),t)}const YK=(r,t)=>t==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(Sm.test(r)||r==="0")&&!r.startsWith("url("));function $we(r){const t=r[0];if(r.length===1)return!0;for(let s=0;s<r.length;s++)if(r[s]!==t)return!0}function qwe(r,t,s,a){const l=r[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=r[r.length-1],g=YK(l,t),E=YK(d,t);return!g||!E?!1:$we(r)||s==="spring"&&a}class sJ{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:g="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:g,...E},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Nwe(),this._resolved}onKeyframesResolved(t,s){this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:g,onComplete:E,onUpdate:S,isGenerator:b}=this.options;if(!b&&!qwe(t,a,l,d))if(g)this.options.duration=0;else{S==null||S(XP(t,this.options,s)),E==null||E(),this.resolveFinishedPromise();return}const R=this.initPlayback(t,s);R!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...R},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function oJ(r,t){return t?r*(1e3/t):0}const Ywe=5;function aJ(r,t,s){const a=Math.max(t-Ywe,0);return oJ(s-r(a),t-a)}const XK=.001,Xwe=.01,Jwe=10,Qwe=.05,Zwe=1;function eRe({duration:r=800,bounce:t=.25,velocity:s=0,mass:a=1}){let l,d,g=1-t;g=Em(Qwe,Zwe,g),r=Em(Xwe,Jwe,Op(r)),g<1?(l=b=>{const R=b*g,O=R*r,N=R-s,U=YM(b,g),K=Math.exp(-O);return XK-N/U*K},d=b=>{const O=b*g*r,N=O*s+s,U=Math.pow(g,2)*Math.pow(b,2)*r,K=Math.exp(-O),z=YM(Math.pow(b,2),g);return(-l(b)+XK>0?-1:1)*((N-U)*K)/z}):(l=b=>{const R=Math.exp(-b*r),O=(b-s)*r+1;return-.001+R*O},d=b=>{const R=Math.exp(-b*r),O=(s-b)*(r*r);return R*O});const E=5/r,S=nRe(l,d,E);if(r=pm(r),isNaN(S))return{stiffness:100,damping:10,duration:r};{const b=Math.pow(S,2)*a;return{stiffness:b,damping:g*2*Math.sqrt(a*b),duration:r}}}const tRe=12;function nRe(r,t,s){let a=s;for(let l=1;l<tRe;l++)a=a-r(a)/t(a);return a}function YM(r,t){return r*Math.sqrt(1-t*t)}const rRe=["duration","bounce"],iRe=["stiffness","damping","mass"];function JK(r,t){return t.some(s=>r[s]!==void 0)}function sRe(r){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...r};if(!JK(r,iRe)&&JK(r,rRe)){const s=eRe(r);t={...t,...s,mass:1},t.isResolvedFromDuration=!0}return t}function cJ({keyframes:r,restDelta:t,restSpeed:s,...a}){const l=r[0],d=r[r.length-1],g={done:!1,value:l},{stiffness:E,damping:S,mass:b,duration:R,velocity:O,isResolvedFromDuration:N}=sRe({...a,velocity:-Op(a.velocity||0)}),U=O||0,K=S/(2*Math.sqrt(E*b)),z=d-l,H=Op(Math.sqrt(E/b)),ne=Math.abs(z)<5;s||(s=ne?.01:2),t||(t=ne?.005:.5);let J;if(K<1){const se=YM(H,K);J=le=>{const ce=Math.exp(-K*H*le);return d-ce*((U+K*H*z)/se*Math.sin(se*le)+z*Math.cos(se*le))}}else if(K===1)J=se=>d-Math.exp(-H*se)*(z+(U+H*z)*se);else{const se=H*Math.sqrt(K*K-1);J=le=>{const ce=Math.exp(-K*H*le),Se=Math.min(se*le,300);return d-ce*((U+K*H*z)*Math.sinh(Se)+se*z*Math.cosh(Se))/se}}return{calculatedDuration:N&&R||null,next:se=>{const le=J(se);if(N)g.done=se>=R;else{let ce=U;se!==0&&(K<1?ce=aJ(J,se,le):ce=0);const Se=Math.abs(ce)<=s,Z=Math.abs(d-le)<=t;g.done=Se&&Z}return g.value=g.done?d:le,g}}}function QK({keyframes:r,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:g,min:E,max:S,restDelta:b=.5,restSpeed:R}){const O=r[0],N={done:!1,value:O},U=te=>E!==void 0&&te<E||S!==void 0&&te>S,K=te=>E===void 0?S:S===void 0||Math.abs(E-te)<Math.abs(S-te)?E:S;let z=s*t;const H=O+z,ne=g===void 0?H:g(H);ne!==H&&(z=ne-O);const J=te=>-z*Math.exp(-te/a),se=te=>ne+J(te),le=te=>{const ie=J(te),ae=se(te);N.done=Math.abs(ie)<=b,N.value=N.done?ne:ae};let ce,Se;const Z=te=>{U(N.value)&&(ce=te,Se=cJ({keyframes:[N.value,K(N.value)],velocity:aJ(se,te,N.value),damping:l,stiffness:d,restDelta:b,restSpeed:R}))};return Z(0),{calculatedDuration:null,next:te=>{let ie=!1;return!Se&&ce===void 0&&(ie=!0,le(te),Z(te)),ce!==void 0&&te>=ce?Se.next(te-ce):(!ie&&le(te),N)}}}const lJ=(r,t,s)=>(((1-3*s+3*t)*r+(3*s-6*t))*r+3*t)*r,oRe=1e-7,aRe=12;function cRe(r,t,s,a,l){let d,g,E=0;do g=t+(s-t)/2,d=lJ(g,a,l)-r,d>0?s=g:t=g;while(Math.abs(d)>oRe&&++E<aRe);return g}function ww(r,t,s,a){if(r===t&&s===a)return va;const l=d=>cRe(d,0,1,r,s);return d=>d===0||d===1?d:lJ(l(d),t,a)}const lRe=ww(.42,0,1,1),uRe=ww(0,0,.58,1),uJ=ww(.42,0,.58,1),dRe=r=>Array.isArray(r)&&typeof r[0]!="number",dJ=r=>t=>t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2,hJ=r=>t=>1-r(1-t),VU=r=>1-Math.sin(Math.acos(r)),pJ=hJ(VU),hRe=dJ(VU),fJ=ww(.33,1.53,.69,.99),FU=hJ(fJ),pRe=dJ(FU),fRe=r=>(r*=2)<1?.5*FU(r):.5*(2-Math.pow(2,-10*(r-1))),mRe={linear:va,easeIn:lRe,easeInOut:uJ,easeOut:uRe,circIn:VU,circInOut:hRe,circOut:pJ,backIn:FU,backInOut:pRe,backOut:fJ,anticipate:fRe},ZK=r=>{if(Array.isArray(r)){HX(r.length===4);const[t,s,a,l]=r;return ww(t,s,a,l)}else if(typeof r=="string")return mRe[r];return r},Jb=(r,t,s)=>{const a=t-r;return a===0?1:(s-r)/a},Ji=(r,t,s)=>r+(t-r)*s;function xx(r,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?r+(t-r)*6*s:s<1/2?t:s<2/3?r+(t-r)*(2/3-s)*6:r}function gRe({hue:r,saturation:t,lightness:s,alpha:a}){r/=360,t/=100,s/=100;let l=0,d=0,g=0;if(!t)l=d=g=s;else{const E=s<.5?s*(1+t):s+t-s*t,S=2*s-E;l=xx(S,E,r+1/3),d=xx(S,E,r),g=xx(S,E,r-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(g*255),alpha:a}}const Mx=(r,t,s)=>{const a=r*r,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},_Re=[$M,w_,Ry],vRe=r=>_Re.find(t=>t.test(r));function e$(r){const t=vRe(r);let s=t.parse(r);return t===Ry&&(s=gRe(s)),s}const t$=(r,t)=>{const s=e$(r),a=e$(t),l={...s};return d=>(l.red=Mx(s.red,a.red,d),l.green=Mx(s.green,a.green,d),l.blue=Mx(s.blue,a.blue,d),l.alpha=Ji(s.alpha,a.alpha,d),w_.transform(l))},XM=new Set(["none","hidden"]);function ERe(r,t){return XM.has(r)?s=>s<=0?r:t:s=>s>=1?t:r}function JM(r,t){return s=>s>0?t:r}function yRe(r,t){return s=>Ji(r,t,s)}function jU(r){return typeof r=="number"?yRe:typeof r=="string"?CU(r)?JM:fa.test(r)?t$:bRe:Array.isArray(r)?mJ:typeof r=="object"?fa.test(r)?t$:SRe:JM}function mJ(r,t){const s=[...r],a=s.length,l=r.map((d,g)=>jU(d)(d,t[g]));return d=>{for(let g=0;g<a;g++)s[g]=l[g](d);return s}}function SRe(r,t){const s={...r,...t},a={};for(const l in s)r[l]!==void 0&&t[l]!==void 0&&(a[l]=jU(r[l])(r[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function TRe(r,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const g=t.types[d],E=r.indexes[g][l[g]],S=(s=r.values[E])!==null&&s!==void 0?s:0;a[d]=S,l[g]++}return a}const bRe=(r,t)=>{const s=Sm.createTransformer(t),a=Xb(r),l=Xb(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?XM.has(r)&&!l.values.length||XM.has(t)&&!a.values.length?ERe(r,t):Ap(mJ(TRe(a,l),l.values),s):JM(r,t)};function gJ(r,t,s){return typeof r=="number"&&typeof t=="number"&&typeof s=="number"?Ji(r,t,s):jU(r)(r,t)}function wRe(r,t,s){const a=[],l=s||gJ,d=r.length-1;for(let g=0;g<d;g++){let E=l(r[g],r[g+1]);if(t){const S=Array.isArray(t)?t[g]||va:t;E=Ap(S,E)}a.push(E)}return a}function RRe(r,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=r.length;if(HX(d===t.length),d===1)return()=>t[0];if(d===2&&r[0]===r[1])return()=>t[1];r[0]>r[d-1]&&(r=[...r].reverse(),t=[...t].reverse());const g=wRe(t,a,l),E=g.length,S=b=>{let R=0;if(E>1)for(;R<r.length-2&&!(b<r[R+1]);R++);const O=Jb(r[R],r[R+1],b);return g[R](O)};return s?b=>S(Em(r[0],r[d-1],b)):S}function CRe(r,t){const s=r[r.length-1];for(let a=1;a<=t;a++){const l=Jb(0,t,a);r.push(Ji(s,1,l))}}function IRe(r){const t=[0];return CRe(t,r.length-1),t}function ARe(r,t){return r.map(s=>s*t)}function ORe(r,t){return r.map(()=>t||uJ).splice(0,r.length-1)}function iP({duration:r=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=dRe(a)?a.map(ZK):ZK(a),d={done:!1,value:t[0]},g=ARe(s&&s.length===t.length?s:IRe(t),r),E=RRe(g,t,{ease:Array.isArray(l)?l:ORe(t,l)});return{calculatedDuration:r,next:S=>(d.value=E(S),d.done=S>=r,d)}}const n$=2e4;function PRe(r){let t=0;const s=50;let a=r.next(t);for(;!a.done&&t<n$;)t+=s,a=r.next(t);return t>=n$?1/0:t}const NRe=r=>{const t=({timestamp:s})=>r(s);return{start:()=>gi.update(t,!0),stop:()=>ym(t),now:()=>Fo.isProcessing?Fo.timestamp:fm.now()}},kRe={decay:QK,inertia:QK,tween:iP,keyframes:iP,spring:cJ},DRe=r=>r/100;class BU extends sJ{constructor({KeyframeResolver:t=xU,...s}){super(s),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:a,motionValue:l,keyframes:d}=this.options,g=(E,S)=>this.onKeyframesResolved(E,S);a&&l&&l.owner?this.resolver=l.owner.resolveKeyframes(d,g,a,l):this.resolver=new t(d,g,a,l),this.resolver.scheduleResolve()}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:g=0}=this.options,E=kRe[s]||iP;let S,b;E!==iP&&typeof t[0]!="number"&&(S=Ap(DRe,gJ(t[0],t[1])),t=[0,100]);const R=E({...this.options,keyframes:t});d==="mirror"&&(b=E({...this.options,keyframes:[...t].reverse(),velocity:-g})),R.calculatedDuration===null&&(R.calculatedDuration=PRe(R));const{calculatedDuration:O}=R,N=O+l,U=N*(a+1)-l;return{generator:R,mirroredGenerator:b,mapPercentToKeyframes:S,calculatedDuration:O,resolvedDuration:N,totalDuration:U}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:te}=this.options;return{done:!0,value:te[te.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:g,mapPercentToKeyframes:E,keyframes:S,calculatedDuration:b,totalDuration:R,resolvedDuration:O}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:U,repeatType:K,repeatDelay:z,onUpdate:H}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-R/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const ne=this.currentTime-N*(this.speed>=0?1:-1),J=this.speed>=0?ne<0:ne>R;this.currentTime=Math.max(ne,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=R);let se=this.currentTime,le=d;if(U){const te=Math.min(this.currentTime,R)/O;let ie=Math.floor(te),ae=te%1;!ae&&te>=1&&(ae=1),ae===1&&ie--,ie=Math.min(ie,U+1),!!(ie%2)&&(K==="reverse"?(ae=1-ae,z&&(ae-=z/O)):K==="mirror"&&(le=g)),se=Em(0,1,ae)*O}const ce=J?{done:!1,value:S[0]}:le.next(se);E&&(ce.value=E(ce.value));let{done:Se}=ce;!J&&b!==null&&(Se=this.speed>=0?this.currentTime>=R:this.currentTime<=0);const Z=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Se);return Z&&l!==void 0&&(ce.value=XP(S,this.options,l)),H&&H(ce.value),Z&&this.finish(),ce}get duration(){const{resolved:t}=this;return t?Op(t.calculatedDuration):0}get time(){return Op(this.currentTime)}set time(t){t=pm(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=Op(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=NRe,onPlay:s}=this.options;this.driver||(this.driver=t(l=>this.tick(l))),s&&s();const a=this.driver.now();this.holdTime!==null?this.startTime=a-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=a),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const _J=r=>Array.isArray(r)&&typeof r[0]=="number";function vJ(r){return!!(!r||typeof r=="string"&&r in WU||_J(r)||Array.isArray(r)&&r.every(vJ))}const ub=([r,t,s,a])=>`cubic-bezier(${r}, ${t}, ${s}, ${a})`,WU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ub([0,.65,.55,1]),circOut:ub([.55,0,1,.45]),backIn:ub([.31,.01,.66,-.59]),backOut:ub([.33,1.53,.69,.99])};function LRe(r){return EJ(r)||WU.easeOut}function EJ(r){if(r)return _J(r)?ub(r):Array.isArray(r)?r.map(LRe):WU[r]}function xRe(r,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:g="loop",ease:E,times:S}={}){const b={[t]:s};S&&(b.offset=S);const R=EJ(E);return Array.isArray(R)&&(b.easing=R),r.animate(b,{delay:a,duration:l,easing:Array.isArray(R)?"linear":R,fill:"both",iterations:d+1,direction:g==="reverse"?"alternate":"normal"})}const MRe=Kwe(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),URe=new Set(["opacity","clipPath","filter","transform"]),sP=10,VRe=2e4;function FRe(r){return r.type==="spring"||r.name==="backgroundColor"||!vJ(r.ease)}function jRe(r,t){const s=new BU({...t,keyframes:r,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:r[0]};const l=[];let d=0;for(;!a.done&&d<VRe;)a=s.sample(d),l.push(a.value),d+=sP;return{times:void 0,keyframes:l,duration:d-sP,ease:"linear"}}class r$ extends sJ{constructor(t){super(t);const{name:s,motionValue:a,keyframes:l}=this.options;this.resolver=new iJ(l,(d,g)=>this.onKeyframesResolved(d,g),s,a),this.resolver.scheduleResolve()}initPlayback(t,s){var a;let{duration:l=300,times:d,ease:g,type:E,motionValue:S,name:b}=this.options;if(!(!((a=S.owner)===null||a===void 0)&&a.current))return!1;if(FRe(this.options)){const{onComplete:O,onUpdate:N,motionValue:U,...K}=this.options,z=jRe(t,K);t=z.keyframes,t.length===1&&(t[1]=t[0]),l=z.duration,d=z.times,g=z.ease,E="keyframes"}const R=xRe(S.owner.current,b,t,{...this.options,duration:l,times:d,ease:g});return R.startTime=fm.now(),this.pendingTimeline?(R.timeline=this.pendingTimeline,this.pendingTimeline=void 0):R.onfinish=()=>{const{onComplete:O}=this.options;S.set(XP(t,this.options,s)),O&&O(),this.cancel(),this.resolveFinishedPromise()},{animation:R,duration:l,times:d,type:E,ease:g,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return Op(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return Op(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=pm(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return va;const{animation:a}=s;a.timeline=t,a.onfinish=null}return va}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:g,times:E}=t;if(!(s.playState==="idle"||s.playState==="finished")){if(this.time){const{motionValue:S,onUpdate:b,onComplete:R,...O}=this.options,N=new BU({...O,keyframes:a,duration:l,type:d,ease:g,times:E,isGenerator:!0}),U=pm(this.time);S.setWithVelocity(N.sample(U-sP).value,N.sample(U).value,sP)}this.cancel()}}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:g,type:E}=t;return MRe()&&a&&URe.has(a)&&s&&s.owner&&s.owner.current instanceof HTMLElement&&!s.owner.getProps().onUpdate&&!l&&d!=="mirror"&&g!==0&&E!=="inertia"}}const GU=(r,t,s,a={},l,d)=>g=>{const E=LU(a,r)||{},S=E.delay||a.delay||0;let{elapsed:b=0}=a;b=b-pm(S);let R={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-b,onUpdate:N=>{t.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{g(),E.onComplete&&E.onComplete()},name:r,motionValue:t,element:d?void 0:l};ywe(E)||(R={...R,...Ewe(r,R)}),R.duration&&(R.duration=pm(R.duration)),R.repeatDelay&&(R.repeatDelay=pm(R.repeatDelay)),R.from!==void 0&&(R.keyframes[0]=R.from);let O=!1;if((R.type===!1||R.duration===0&&!R.repeatDelay)&&(R.duration=0,R.delay===0&&(O=!0)),O&&!d&&t.get()!==void 0){const N=XP(R.keyframes,E);if(N!==void 0){gi.update(()=>{R.onUpdate(N),R.onComplete()});return}}return!d&&r$.supports(R)?new r$(R):new BU(R)};function oP(r){return!!(_a(r)&&r.add)}function zU(r,t){r.indexOf(t)===-1&&r.push(t)}function HU(r,t){const s=r.indexOf(t);s>-1&&r.splice(s,1)}class KU{constructor(){this.subscriptions=[]}add(t){return zU(this.subscriptions,t),()=>HU(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const g=this.subscriptions[d];g&&g(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const i$=30,BRe=r=>!isNaN(parseFloat(r));class WRe{constructor(t,s={}){this.version="11.2.6",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=fm.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=fm.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=BRe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new KU);const a=this.events[t].add(s);return t==="change"?()=>{a(),gi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=fm.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>i$)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,i$);return oJ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Qb(r,t){return new WRe(r,t)}function GRe(r,t,s){r.hasValue(t)?r.getValue(t).set(s):r.addValue(t,Qb(s))}function zRe(r,t){const s=YP(r,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const g in d){const E=Xbe(d[g]);GRe(r,g,E)}}function HRe({protectedKeys:r,needsAnimating:t},s){const a=r.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function yJ(r,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:g=r.getDefaultTransition(),transitionEnd:E,...S}=t;const b=r.getValue("willChange");a&&(g=a);const R=[],O=l&&r.animationState&&r.animationState.getState()[l];for(const N in S){const U=r.getValue(N,(d=r.latestValues[N])!==null&&d!==void 0?d:null),K=S[N];if(K===void 0||O&&HRe(O,N))continue;const z={delay:s,elapsed:0,...LU(g||{},N)};let H=!1;if(window.HandoffAppearAnimations){const se=r.getProps()[SX];if(se){const le=window.HandoffAppearAnimations(se,N,U,gi);le!==null&&(z.elapsed=le,H=!0)}}U.start(GU(N,U,K,r.shouldReduceMotion&&J_.has(N)?{type:!1}:z,r,H));const ne=U.animation;ne&&(oP(b)&&(b.add(N),ne.then(()=>b.remove(N))),R.push(ne))}return E&&Promise.all(R).then(()=>{gi.update(()=>{E&&zRe(r,E)})}),R}function QM(r,t,s={}){var a;const l=YP(r,t,s.type==="exit"?(a=r.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=r.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const g=l?()=>Promise.all(yJ(r,l,s)):()=>Promise.resolve(),E=r.variantChildren&&r.variantChildren.size?(b=0)=>{const{delayChildren:R=0,staggerChildren:O,staggerDirection:N}=d;return KRe(r,t,R+b,O,N,s)}:()=>Promise.resolve(),{when:S}=d;if(S){const[b,R]=S==="beforeChildren"?[g,E]:[E,g];return b().then(()=>R())}else return Promise.all([g(),E(s.delay)])}function KRe(r,t,s=0,a=0,l=1,d){const g=[],E=(r.variantChildren.size-1)*a,S=l===1?(b=0)=>b*a:(b=0)=>E-b*a;return Array.from(r.variantChildren).sort($Re).forEach((b,R)=>{b.notify("AnimationStart",t),g.push(QM(b,t,{...d,delay:s+S(R)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(g)}function $Re(r,t){return r.sortNodePosition(t)}function qRe(r,t,s={}){r.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>QM(r,d,s));a=Promise.all(l)}else if(typeof t=="string")a=QM(r,t,s);else{const l=typeof t=="function"?YP(r,t,s.custom):t;a=Promise.all(yJ(r,l,s))}return a.then(()=>{gi.postRender(()=>{r.notify("AnimationComplete",t)})})}const YRe=[...TU].reverse(),XRe=TU.length;function JRe(r){return t=>Promise.all(t.map(({animation:s,options:a})=>qRe(r,s,a)))}function QRe(r){let t=JRe(r);const s=eCe();let a=!0;const l=S=>(b,R)=>{var O;const N=YP(r,R,S==="exit"?(O=r.presenceContext)===null||O===void 0?void 0:O.custom:void 0);if(N){const{transition:U,transitionEnd:K,...z}=N;b={...b,...z,...K}}return b};function d(S){t=S(r)}function g(S){const b=r.getProps(),R=r.getVariantContext(!0)||{},O=[],N=new Set;let U={},K=1/0;for(let H=0;H<XRe;H++){const ne=YRe[H],J=s[ne],se=b[ne]!==void 0?b[ne]:R[ne],le=qb(se),ce=ne===S?J.isActive:null;ce===!1&&(K=H);let Se=se===R[ne]&&se!==b[ne]&&le;if(Se&&a&&r.manuallyAnimateOnMount&&(Se=!1),J.protectedKeys={...U},!J.isActive&&ce===null||!se&&!J.prevProp||KP(se)||typeof se=="boolean")continue;let te=ZRe(J.prevProp,se)||ne===S&&J.isActive&&!Se&&le||H>K&&le,ie=!1;const ae=Array.isArray(se)?se:[se];let ve=ae.reduce(l(ne),{});ce===!1&&(ve={});const{prevResolvedValues:pe={}}=J,de={...pe,...ve},ut=mt=>{te=!0,N.has(mt)&&(ie=!0,N.delete(mt)),J.needsAnimating[mt]=!0;const Ze=r.getValue(mt);Ze&&(Ze.liveStyle=!1)};for(const mt in de){const Ze=ve[mt],Be=pe[mt];if(U.hasOwnProperty(mt))continue;let Ke=!1;GM(Ze)&&GM(Be)?Ke=!GX(Ze,Be):Ke=Ze!==Be,Ke?Ze!=null?ut(mt):N.add(mt):Ze!==void 0&&N.has(mt)?ut(mt):J.protectedKeys[mt]=!0}J.prevProp=se,J.prevResolvedValues=ve,J.isActive&&(U={...U,...ve}),a&&r.blockInitialAnimation&&(te=!1),te&&(!Se||ie)&&O.push(...ae.map(mt=>({animation:mt,options:{type:ne}})))}if(N.size){const H={};N.forEach(ne=>{const J=r.getBaseTarget(ne),se=r.getValue(ne);se&&(se.liveStyle=!0),H[ne]=J??null}),O.push({animation:H})}let z=!!O.length;return a&&(b.initial===!1||b.initial===b.animate)&&!r.manuallyAnimateOnMount&&(z=!1),a=!1,z?t(O):Promise.resolve()}function E(S,b){var R;if(s[S].isActive===b)return Promise.resolve();(R=r.variantChildren)===null||R===void 0||R.forEach(N=>{var U;return(U=N.animationState)===null||U===void 0?void 0:U.setActive(S,b)}),s[S].isActive=b;const O=g(S);for(const N in s)s[N].protectedKeys={};return O}return{animateChanges:g,setActive:E,setAnimateFunction:d,getState:()=>s}}function ZRe(r,t){return typeof t=="string"?t!==r:Array.isArray(t)?!GX(t,r):!1}function h_(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function eCe(){return{animate:h_(!0),whileInView:h_(),whileHover:h_(),whileTap:h_(),whileDrag:h_(),whileFocus:h_(),exit:h_()}}class tCe extends Am{constructor(t){super(t),t.animationState||(t.animationState=QRe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),KP(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){}}let nCe=0;class rCe extends Am{constructor(){super(...arguments),this.id=nCe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const iCe={animation:{Feature:tCe},exit:{Feature:rCe}},s$=(r,t)=>Math.abs(r-t);function sCe(r,t){const s=s$(r.x,t.x),a=s$(r.y,t.y);return Math.sqrt(s**2+a**2)}class SJ{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=Vx(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,U=sCe(O.offset,{x:0,y:0})>=3;if(!N&&!U)return;const{point:K}=O,{timestamp:z}=Fo;this.history.push({...K,timestamp:z});const{onStart:H,onMove:ne}=this.handlers;N||(H&&H(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),ne&&ne(this.lastMoveEvent,O)},this.handlePointerMove=(O,N)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=Ux(N,this.transformPagePoint),gi.update(this.updatePoint,!0)},this.handlePointerUp=(O,N)=>{this.end();const{onEnd:U,onSessionEnd:K,resumeAnimation:z}=this.handlers;if(this.dragSnapToOrigin&&z&&z(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const H=Vx(O.type==="pointercancel"?this.lastMoveEventInfo:Ux(N,this.transformPagePoint),this.history);this.startEvent&&U&&U(O,H),K&&K(O,H)},!VX(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const g=qP(t),E=Ux(g,this.transformPagePoint),{point:S}=E,{timestamp:b}=Fo;this.history=[{...S,timestamp:b}];const{onSessionStart:R}=s;R&&R(t,Vx(E,this.history)),this.removeListeners=Ap(Ip(this.contextWindow,"pointermove",this.handlePointerMove),Ip(this.contextWindow,"pointerup",this.handlePointerUp),Ip(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),ym(this.updatePoint)}}function Ux(r,t){return t?{point:t(r.point)}:r}function o$(r,t){return{x:r.x-t.x,y:r.y-t.y}}function Vx({point:r},t){return{point:r,delta:o$(r,TJ(t)),offset:o$(r,oCe(t)),velocity:aCe(t,.1)}}function oCe(r){return r[0]}function TJ(r){return r[r.length-1]}function aCe(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=TJ(r);for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>pm(t)));)s--;if(!a)return{x:0,y:0};const d=Op(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const g={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}function ul(r){return r.max-r.min}function ZM(r,t=0,s=.01){return Math.abs(r-t)<=s}function a$(r,t,s,a=.5){r.origin=a,r.originPoint=Ji(t.min,t.max,r.origin),r.scale=ul(s)/ul(t),(ZM(r.scale,1,1e-4)||isNaN(r.scale))&&(r.scale=1),r.translate=Ji(s.min,s.max,r.origin)-r.originPoint,(ZM(r.translate)||isNaN(r.translate))&&(r.translate=0)}function Ob(r,t,s,a){a$(r.x,t.x,s.x,a?a.originX:void 0),a$(r.y,t.y,s.y,a?a.originY:void 0)}function c$(r,t,s){r.min=s.min+t.min,r.max=r.min+ul(t)}function cCe(r,t,s){c$(r.x,t.x,s.x),c$(r.y,t.y,s.y)}function l$(r,t,s){r.min=t.min-s.min,r.max=r.min+ul(t)}function Pb(r,t,s){l$(r.x,t.x,s.x),l$(r.y,t.y,s.y)}function lCe(r,{min:t,max:s},a){return t!==void 0&&r<t?r=a?Ji(t,r,a.min):Math.max(r,t):s!==void 0&&r>s&&(r=a?Ji(s,r,a.max):Math.min(r,s)),r}function u$(r,t,s){return{min:t!==void 0?r.min+t:void 0,max:s!==void 0?r.max+s-(r.max-r.min):void 0}}function uCe(r,{top:t,left:s,bottom:a,right:l}){return{x:u$(r.x,s,l),y:u$(r.y,t,a)}}function d$(r,t){let s=t.min-r.min,a=t.max-r.max;return t.max-t.min<r.max-r.min&&([s,a]=[a,s]),{min:s,max:a}}function dCe(r,t){return{x:d$(r.x,t.x),y:d$(r.y,t.y)}}function hCe(r,t){let s=.5;const a=ul(r),l=ul(t);return l>a?s=Jb(t.min,t.max-a,r.min):a>l&&(s=Jb(r.min,r.max-l,t.min)),Em(0,1,s)}function pCe(r,t){const s={};return t.min!==void 0&&(s.min=t.min-r.min),t.max!==void 0&&(s.max=t.max-r.min),s}const e2=.35;function fCe(r=e2){return r===!1?r=0:r===!0&&(r=e2),{x:h$(r,"left","right"),y:h$(r,"top","bottom")}}function h$(r,t,s){return{min:p$(r,t),max:p$(r,s)}}function p$(r,t){return typeof r=="number"?r:r[t]||0}const f$=()=>({translate:0,scale:1,origin:0,originPoint:0}),Cy=()=>({x:f$(),y:f$()}),m$=()=>({min:0,max:0}),Ts=()=>({x:m$(),y:m$()});function ql(r){return[r("x"),r("y")]}function bJ({top:r,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:r,max:a}}}function mCe({x:r,y:t}){return{top:t.min,right:r.max,bottom:t.max,left:r.min}}function gCe(r,t){if(!t)return r;const s=t({x:r.left,y:r.top}),a=t({x:r.right,y:r.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function Fx(r){return r===void 0||r===1}function t2({scale:r,scaleX:t,scaleY:s}){return!Fx(r)||!Fx(t)||!Fx(s)}function f_(r){return t2(r)||wJ(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function wJ(r){return g$(r.x)||g$(r.y)}function g$(r){return r&&r!=="0%"}function aP(r,t,s){const a=r-s,l=t*a;return s+l}function _$(r,t,s,a,l){return l!==void 0&&(r=aP(r,l,a)),aP(r,s,a)+t}function n2(r,t=0,s=1,a,l){r.min=_$(r.min,t,s,a,l),r.max=_$(r.max,t,s,a,l)}function RJ(r,{x:t,y:s}){n2(r.x,t.translate,t.scale,t.originPoint),n2(r.y,s.translate,s.scale,s.originPoint)}function _Ce(r,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,g;for(let E=0;E<l;E++){d=s[E],g=d.projectionDelta;const S=d.instance;S&&S.style&&S.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Iy(r,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),g&&(t.x*=g.x.scale,t.y*=g.y.scale,RJ(r,g)),a&&f_(d.latestValues)&&Iy(r,d.latestValues))}t.x=v$(t.x),t.y=v$(t.y)}function v$(r){return Number.isInteger(r)||r>1.0000000000001||r<.999999999999?r:1}function sm(r,t){r.min=r.min+t,r.max=r.max+t}function E$(r,t,[s,a,l]){const d=t[l]!==void 0?t[l]:.5,g=Ji(r.min,r.max,d);n2(r,t[s],t[a],g,t.scale)}const vCe=["x","scaleX","originX"],ECe=["y","scaleY","originY"];function Iy(r,t){E$(r.x,t,vCe),E$(r.y,t,ECe)}function CJ(r,t){return bJ(gCe(r.getBoundingClientRect(),t))}function yCe(r,t,s){const a=CJ(r,s),{scroll:l}=t;return l&&(sm(a.x,l.offset.x),sm(a.y,l.offset.y)),a}const IJ=({current:r})=>r?r.ownerDocument.defaultView:null,SCe=new WeakMap;class TCe{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ts(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=R=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(qP(R,"page").point)},d=(R,O)=>{const{drag:N,dragPropagation:U,onDragStart:K}=this.getProps();if(N&&!U&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=jX(N),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ql(H=>{let ne=this.getAxisMotionValue(H).get()||0;if(ih.test(ne)){const{projection:J}=this.visualElement;if(J&&J.layout){const se=J.layout.layoutBox[H];se&&(ne=ul(se)*(parseFloat(ne)/100))}}this.originPoint[H]=ne}),K&&gi.postRender(()=>K(R,O));const{animationState:z}=this.visualElement;z&&z.setActive("whileDrag",!0)},g=(R,O)=>{const{dragPropagation:N,dragDirectionLock:U,onDirectionLock:K,onDrag:z}=this.getProps();if(!N&&!this.openGlobalLock)return;const{offset:H}=O;if(U&&this.currentDirection===null){this.currentDirection=bCe(H),this.currentDirection!==null&&K&&K(this.currentDirection);return}this.updateAxis("x",O.point,H),this.updateAxis("y",O.point,H),this.visualElement.render(),z&&z(R,O)},E=(R,O)=>this.stop(R,O),S=()=>ql(R=>{var O;return this.getAnimationState(R)==="paused"&&((O=this.getAxisMotionValue(R).animation)===null||O===void 0?void 0:O.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new SJ(t,{onSessionStart:l,onStart:d,onMove:g,onSessionEnd:E,resumeAnimation:S},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:IJ(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&gi.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!ZA(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let g=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(g=lCe(g,this.constraints[t],this.elastic[t])),d.set(g)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&wy(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=uCe(l.layoutBox,s):this.constraints=!1,this.elastic=fCe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&ql(g=>{this.constraints!==!1&&this.getAxisMotionValue(g)&&(this.constraints[g]=pCe(l.layoutBox[g],this.constraints[g]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!wy(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=yCe(a,l.root,this.visualElement.getTransformPagePoint());let g=dCe(l.layout.layoutBox,d);if(s){const E=s(mCe(g));this.hasMutatedConstraints=!!E,E&&(g=bJ(E))}return g}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:g,onDragTransitionEnd:E}=this.getProps(),S=this.constraints||{},b=ql(R=>{if(!ZA(R,s,this.currentDirection))return;let O=S&&S[R]||{};g&&(O={min:0,max:0});const N=l?200:1e6,U=l?40:1e7,K={type:"inertia",velocity:a?t[R]:0,bounceStiffness:N,bounceDamping:U,timeConstant:750,restDelta:1,restSpeed:10,...d,...O};return this.startAxisValueAnimation(R,K)});return Promise.all(b).then(E)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return a.start(GU(t,a,0,s,this.visualElement))}stopAnimation(){ql(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){ql(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){ql(s=>{const{drag:a}=this.getProps();if(!ZA(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:g,max:E}=l.layout.layoutBox[s];d.set(t[s]-Ji(g,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!wy(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};ql(g=>{const E=this.getAxisMotionValue(g);if(E&&this.constraints!==!1){const S=E.get();l[g]=hCe({min:S,max:S},this.constraints[g])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),ql(g=>{if(!ZA(g,t,null))return;const E=this.getAxisMotionValue(g),{min:S,max:b}=this.constraints[g];E.set(Ji(S,b,l[g]))})}addListeners(){if(!this.visualElement.current)return;SCe.set(this.visualElement,this);const t=this.visualElement.current,s=Ip(t,"pointerdown",S=>{const{drag:b,dragListener:R=!0}=this.getProps();b&&R&&this.start(S)}),a=()=>{const{dragConstraints:S}=this.getProps();wy(S)&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),a();const g=Sp(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:S,hasLayoutChanged:b})=>{this.isDragging&&b&&(ql(R=>{const O=this.getAxisMotionValue(R);O&&(this.originPoint[R]+=S[R].translate,O.set(O.get()+S[R].translate))}),this.visualElement.render())});return()=>{g(),s(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:g=e2,dragMomentum:E=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:g,dragMomentum:E}}}function ZA(r,t,s){return(t===!0||t===r)&&(s===null||s===r)}function bCe(r,t=10){let s=null;return Math.abs(r.y)>t?s="y":Math.abs(r.x)>t&&(s="x"),s}class wCe extends Am{constructor(t){super(t),this.removeGroupControls=va,this.removeListeners=va,this.controls=new TCe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||va}unmount(){this.removeGroupControls(),this.removeListeners()}}const y$=r=>(t,s)=>{r&&gi.postRender(()=>r(t,s))};class RCe extends Am{constructor(){super(...arguments),this.removePointerDownListener=va}onPointerDown(t){this.session=new SJ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:IJ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:y$(t),onStart:y$(s),onMove:a,onEnd:(d,g)=>{delete this.session,l&&gi.postRender(()=>l(d,g))}}}mount(){this.removePointerDownListener=Ip(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function AJ(){const r=B.useContext(yw);if(r===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:a}=r,l=B.useId();return B.useEffect(()=>a(l),[]),!t&&s?[!1,()=>s&&s(l)]:[!0]}function CCe(){return ICe(B.useContext(yw))}function ICe(r){return r===null?!0:r.isPresent}const NO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function S$(r,t){return t.max===t.min?0:r/(t.max-t.min)*100}const z0={correct:(r,t)=>{if(!t.target)return r;if(typeof r=="string")if(Rn.test(r))r=parseFloat(r);else return r;const s=S$(r,t.target.x),a=S$(r,t.target.y);return`${s}% ${a}%`}},ACe={correct:(r,{treeScale:t,projectionDelta:s})=>{const a=r,l=Sm.parse(r);if(l.length>5)return a;const d=Sm.createTransformer(r),g=typeof l[0]!="number"?1:0,E=s.x.scale*t.x,S=s.y.scale*t.y;l[0+g]/=E,l[1+g]/=S;const b=Ji(E,S,.5);return typeof l[2+g]=="number"&&(l[2+g]/=b),typeof l[3+g]=="number"&&(l[3+g]/=b),d(l)}};class OCe extends B.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;Cbe(PCe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),NO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,g=a.projection;return g&&(g.isPresent=d,l||t.layoutDependency!==s||s===void 0?g.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?g.promote():g.relegate()||gi.postRender(()=>{const E=g.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),SU.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function OJ(r){const[t,s]=AJ(),a=B.useContext(wU);return F.jsx(OCe,{...r,layoutGroup:a,switchLayoutGroup:B.useContext(wX),isPresent:t,safeToRemove:s})}const PCe={borderRadius:{...z0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:z0,borderTopRightRadius:z0,borderBottomLeftRadius:z0,borderBottomRightRadius:z0,boxShadow:ACe},PJ=["TopLeft","TopRight","BottomLeft","BottomRight"],NCe=PJ.length,T$=r=>typeof r=="string"?parseFloat(r):r,b$=r=>typeof r=="number"||Rn.test(r);function kCe(r,t,s,a,l,d){l?(r.opacity=Ji(0,s.opacity!==void 0?s.opacity:1,DCe(a)),r.opacityExit=Ji(t.opacity!==void 0?t.opacity:1,0,LCe(a))):d&&(r.opacity=Ji(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let g=0;g<NCe;g++){const E=`border${PJ[g]}Radius`;let S=w$(t,E),b=w$(s,E);if(S===void 0&&b===void 0)continue;S||(S=0),b||(b=0),S===0||b===0||b$(S)===b$(b)?(r[E]=Math.max(Ji(T$(S),T$(b),a),0),(ih.test(b)||ih.test(S))&&(r[E]+="%")):r[E]=b}(t.rotate||s.rotate)&&(r.rotate=Ji(t.rotate||0,s.rotate||0,a))}function w$(r,t){return r[t]!==void 0?r[t]:r.borderRadius}const DCe=NJ(0,.5,pJ),LCe=NJ(.5,.95,va);function NJ(r,t,s){return a=>a<r?0:a>t?1:s(Jb(r,t,a))}function R$(r,t){r.min=t.min,r.max=t.max}function Hl(r,t){R$(r.x,t.x),R$(r.y,t.y)}function C$(r,t,s,a,l){return r-=t,r=aP(r,1/s,a),l!==void 0&&(r=aP(r,1/l,a)),r}function xCe(r,t=0,s=1,a=.5,l,d=r,g=r){if(ih.test(t)&&(t=parseFloat(t),t=Ji(g.min,g.max,t/100)-g.min),typeof t!="number")return;let E=Ji(d.min,d.max,a);r===d&&(E-=t),r.min=C$(r.min,t,s,E,l),r.max=C$(r.max,t,s,E,l)}function I$(r,t,[s,a,l],d,g){xCe(r,t[s],t[a],t[l],t.scale,d,g)}const MCe=["x","scaleX","originX"],UCe=["y","scaleY","originY"];function A$(r,t,s,a){I$(r.x,t,MCe,s?s.x:void 0,a?a.x:void 0),I$(r.y,t,UCe,s?s.y:void 0,a?a.y:void 0)}function O$(r){return r.translate===0&&r.scale===1}function kJ(r){return O$(r.x)&&O$(r.y)}function VCe(r,t){return r.x.min===t.x.min&&r.x.max===t.x.max&&r.y.min===t.y.min&&r.y.max===t.y.max}function DJ(r,t){return Math.round(r.x.min)===Math.round(t.x.min)&&Math.round(r.x.max)===Math.round(t.x.max)&&Math.round(r.y.min)===Math.round(t.y.min)&&Math.round(r.y.max)===Math.round(t.y.max)}function P$(r){return ul(r.x)/ul(r.y)}class FCe{constructor(){this.members=[]}add(t){zU(this.members,t),t.scheduleRender()}remove(t){if(HU(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function N$(r,t,s){let a="";const l=r.x.translate/t.x,d=r.y.translate/t.y,g=(s==null?void 0:s.z)||0;if((l||d||g)&&(a=`translate3d(${l}px, ${d}px, ${g}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:b,rotate:R,rotateX:O,rotateY:N,skewX:U,skewY:K}=s;b&&(a=`perspective(${b}px) ${a}`),R&&(a+=`rotate(${R}deg) `),O&&(a+=`rotateX(${O}deg) `),N&&(a+=`rotateY(${N}deg) `),U&&(a+=`skewX(${U}deg) `),K&&(a+=`skewY(${K}deg) `)}const E=r.x.scale*t.x,S=r.y.scale*t.y;return(E!==1||S!==1)&&(a+=`scale(${E}, ${S})`),a||"none"}const jCe=(r,t)=>r.depth-t.depth;class BCe{constructor(){this.children=[],this.isDirty=!1}add(t){zU(this.children,t),this.isDirty=!0}remove(t){HU(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(jCe),this.isDirty=!1,this.children.forEach(t)}}function WCe(r,t){const s=fm.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(ym(a),r(d-t))};return gi.read(a,!0),()=>ym(a)}function GCe(r){window.MotionDebug&&window.MotionDebug.record(r)}function zCe(r){return r instanceof SVGElement&&r.tagName!=="svg"}function HCe(r,t,s){const a=_a(r)?r:Qb(r);return a.start(GU("",a,t,s)),a.animation}const jx=["","X","Y","Z"],KCe={visibility:"hidden"},k$=1e3;let $Ce=0;const m_={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function Bx(r,t,s,a){const{latestValues:l}=t;l[r]&&(s[r]=l[r],t.setStaticValue(r,0),a&&(a[r]=0))}function LJ({attachResizeListener:r,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(g={},E=t==null?void 0:t()){this.id=$Ce++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,m_.totalNodes=m_.resolvedTargetDeltas=m_.recalculatedProjection=0,this.nodes.forEach(XCe),this.nodes.forEach(tIe),this.nodes.forEach(nIe),this.nodes.forEach(JCe),GCe(m_)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=g,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let S=0;S<this.path.length;S++)this.path[S].shouldResetTransform=!0;this.root===this&&(this.nodes=new BCe)}addEventListener(g,E){return this.eventHandlers.has(g)||this.eventHandlers.set(g,new KU),this.eventHandlers.get(g).add(E)}notifyListeners(g,...E){const S=this.eventHandlers.get(g);S&&S.notify(...E)}hasListeners(g){return this.eventHandlers.has(g)}mount(g,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=zCe(g),this.instance=g;const{layoutId:S,layout:b,visualElement:R}=this.options;if(R&&!R.current&&R.mount(g),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(b||S)&&(this.isLayoutDirty=!0),r){let O;const N=()=>this.root.updateBlockedByResize=!1;r(g,()=>{this.root.updateBlockedByResize=!0,O&&O(),O=WCe(N,250),NO.hasAnimatedSinceResize&&(NO.hasAnimatedSinceResize=!1,this.nodes.forEach(L$))})}S&&this.root.registerSharedNode(S,this),this.options.animate!==!1&&R&&(S||b)&&this.addEventListener("didUpdate",({delta:O,hasLayoutChanged:N,hasRelativeTargetChanged:U,layout:K})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const z=this.options.transition||R.getDefaultTransition()||aIe,{onLayoutAnimationStart:H,onLayoutAnimationComplete:ne}=R.getProps(),J=!this.targetLayout||!DJ(this.targetLayout,K)||U,se=!N&&U;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||se||N&&(J||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(O,se);const le={...LU(z,"layout"),onPlay:H,onComplete:ne};(R.shouldReduceMotion||this.options.layoutRoot)&&(le.delay=0,le.type=!1),this.startAnimation(le)}else N||L$(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=K})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const g=this.getStack();g&&g.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,ym(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,window.HandoffCancelAllAnimations&&window.HandoffCancelAllAnimations(),this.nodes&&this.nodes.forEach(rIe),this.animationId++)}getTransformTemplate(){const{visualElement:g}=this.options;return g&&g.getProps().transformTemplate}willUpdate(g=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let R=0;R<this.path.length;R++){const O=this.path[R];O.shouldResetTransform=!0,O.updateScroll("snapshot"),O.options.layoutRoot&&O.willUpdate(!1)}const{layoutId:E,layout:S}=this.options;if(E===void 0&&!S)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),g&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(D$);return}this.isUpdating||this.nodes.forEach(ZCe),this.isUpdating=!1,this.nodes.forEach(eIe),this.nodes.forEach(qCe),this.nodes.forEach(YCe),this.clearAllSnapshots();const E=fm.now();Fo.delta=Em(0,1e3/60,E-Fo.timestamp),Fo.timestamp=E,Fo.isProcessing=!0,Nx.update.process(Fo),Nx.preRender.process(Fo),Nx.render.process(Fo),Fo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,SU.read(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(QCe),this.sharedNodes.forEach(iIe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,gi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){gi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let S=0;S<this.path.length;S++)this.path[S].updateScroll();const g=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ts(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,g?g.layoutBox:void 0)}updateScroll(g="measure"){let E=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===g&&(E=!1),E&&(this.scroll={animationId:this.root.animationId,phase:g,isRoot:a(this.instance),offset:s(this.instance)})}resetTransform(){if(!l)return;const g=this.isLayoutDirty||this.shouldResetTransform,E=this.projectionDelta&&!kJ(this.projectionDelta),S=this.getTransformTemplate(),b=S?S(this.latestValues,""):void 0,R=b!==this.prevTransformTemplateValue;g&&(E||f_(this.latestValues)||R)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(g=!0){const E=this.measurePageBox();let S=this.removeElementScroll(E);return g&&(S=this.removeTransform(S)),cIe(S),{animationId:this.root.animationId,measuredBox:E,layoutBox:S,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:g}=this.options;if(!g)return Ts();const E=g.measureViewportBox(),{scroll:S}=this.root;return S&&(sm(E.x,S.offset.x),sm(E.y,S.offset.y)),E}removeElementScroll(g){const E=Ts();Hl(E,g);for(let S=0;S<this.path.length;S++){const b=this.path[S],{scroll:R,options:O}=b;if(b!==this.root&&R&&O.layoutScroll){if(R.isRoot){Hl(E,g);const{scroll:N}=this.root;N&&(sm(E.x,-N.offset.x),sm(E.y,-N.offset.y))}sm(E.x,R.offset.x),sm(E.y,R.offset.y)}}return E}applyTransform(g,E=!1){const S=Ts();Hl(S,g);for(let b=0;b<this.path.length;b++){const R=this.path[b];!E&&R.options.layoutScroll&&R.scroll&&R!==R.root&&Iy(S,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),f_(R.latestValues)&&Iy(S,R.latestValues)}return f_(this.latestValues)&&Iy(S,this.latestValues),S}removeTransform(g){const E=Ts();Hl(E,g);for(let S=0;S<this.path.length;S++){const b=this.path[S];if(!b.instance||!f_(b.latestValues))continue;t2(b.latestValues)&&b.updateSnapshot();const R=Ts(),O=b.measurePageBox();Hl(R,O),A$(E,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,R)}return f_(this.latestValues)&&A$(E,this.latestValues),E}setTargetDelta(g){this.targetDelta=g,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(g){this.options={...this.options,...g,crossfade:g.crossfade!==void 0?g.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Fo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(g=!1){var E;const S=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=S.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=S.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=S.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==S;if(!(g||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:O,layoutId:N}=this.options;if(!(!this.layout||!(O||N))){if(this.resolvedRelativeTargetAt=Fo.timestamp,!this.targetDelta&&!this.relativeTarget){const U=this.getClosestProjectingParent();U&&U.layout&&this.animationProgress!==1?(this.relativeParent=U,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ts(),this.relativeTargetOrigin=Ts(),Pb(this.relativeTargetOrigin,this.layout.layoutBox,U.layout.layoutBox),Hl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ts(),this.targetWithTransforms=Ts()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),cCe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Hl(this.target,this.layout.layoutBox),RJ(this.target,this.targetDelta)):Hl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const U=this.getClosestProjectingParent();U&&!!U.resumingFrom==!!this.resumingFrom&&!U.options.layoutScroll&&U.target&&this.animationProgress!==1?(this.relativeParent=U,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ts(),this.relativeTargetOrigin=Ts(),Pb(this.relativeTargetOrigin,this.target,U.target),Hl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}m_.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||t2(this.parent.latestValues)||wJ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var g;const E=this.getLead(),S=!!this.resumingFrom||this!==E;let b=!0;if((this.isProjectionDirty||!((g=this.parent)===null||g===void 0)&&g.isProjectionDirty)&&(b=!1),S&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Fo.timestamp&&(b=!1),b)return;const{layout:R,layoutId:O}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(R||O))return;Hl(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,U=this.treeScale.y;_Ce(this.layoutCorrected,this.treeScale,this.path,S),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=Ts());const{target:K}=E;if(!K){this.projectionTransform&&(this.projectionDelta=Cy(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Cy(),this.projectionDeltaWithTransform=Cy());const z=this.projectionTransform;Ob(this.projectionDelta,this.layoutCorrected,K,this.latestValues),this.projectionTransform=N$(this.projectionDelta,this.treeScale),(this.projectionTransform!==z||this.treeScale.x!==N||this.treeScale.y!==U)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",K)),m_.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(g=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),g){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(g,E=!1){const S=this.snapshot,b=S?S.latestValues:{},R={...this.latestValues},O=Cy();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=Ts(),U=S?S.source:void 0,K=this.layout?this.layout.source:void 0,z=U!==K,H=this.getStack(),ne=!H||H.members.length<=1,J=!!(z&&!ne&&this.options.crossfade===!0&&!this.path.some(oIe));this.animationProgress=0;let se;this.mixTargetDelta=le=>{const ce=le/1e3;x$(O.x,g.x,ce),x$(O.y,g.y,ce),this.setTargetDelta(O),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Pb(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),sIe(this.relativeTarget,this.relativeTargetOrigin,N,ce),se&&VCe(this.relativeTarget,se)&&(this.isProjectionDirty=!1),se||(se=Ts()),Hl(se,this.relativeTarget)),z&&(this.animationValues=R,kCe(R,b,this.latestValues,ce,J,ne)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ce},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(g){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(ym(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=gi.update(()=>{NO.hasAnimatedSinceResize=!0,this.currentAnimation=HCe(0,k$,{...g,onUpdate:E=>{this.mixTargetDelta(E),g.onUpdate&&g.onUpdate(E)},onComplete:()=>{g.onComplete&&g.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const g=this.getStack();g&&g.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(k$),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const g=this.getLead();let{targetWithTransforms:E,target:S,layout:b,latestValues:R}=g;if(!(!E||!S||!b)){if(this!==g&&this.layout&&b&&xJ(this.options.animationType,this.layout.layoutBox,b.layoutBox)){S=this.target||Ts();const O=ul(this.layout.layoutBox.x);S.x.min=g.target.x.min,S.x.max=S.x.min+O;const N=ul(this.layout.layoutBox.y);S.y.min=g.target.y.min,S.y.max=S.y.min+N}Hl(E,S),Iy(E,R),Ob(this.projectionDeltaWithTransform,this.layoutCorrected,E,R)}}registerSharedNode(g,E){this.sharedNodes.has(g)||this.sharedNodes.set(g,new FCe),this.sharedNodes.get(g).add(E);const b=E.options.initialPromotionConfig;E.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(E):void 0})}isLead(){const g=this.getStack();return g?g.lead===this:!0}getLead(){var g;const{layoutId:E}=this.options;return E?((g=this.getStack())===null||g===void 0?void 0:g.lead)||this:this}getPrevLead(){var g;const{layoutId:E}=this.options;return E?(g=this.getStack())===null||g===void 0?void 0:g.prevLead:void 0}getStack(){const{layoutId:g}=this.options;if(g)return this.root.sharedNodes.get(g)}promote({needsReset:g,transition:E,preserveFollowOpacity:S}={}){const b=this.getStack();b&&b.promote(this,S),g&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const g=this.getStack();return g?g.relegate(this):!1}resetSkewAndRotation(){const{visualElement:g}=this.options;if(!g)return;let E=!1;const{latestValues:S}=g;if((S.z||S.rotate||S.rotateX||S.rotateY||S.rotateZ||S.skewX||S.skewY)&&(E=!0),!E)return;const b={};S.z&&Bx("z",g,b,this.animationValues);for(let R=0;R<jx.length;R++)Bx(`rotate${jx[R]}`,g,b,this.animationValues),Bx(`skew${jx[R]}`,g,b,this.animationValues);g.render();for(const R in b)g.setStaticValue(R,b[R]),this.animationValues&&(this.animationValues[R]=b[R]);g.scheduleRender()}getProjectionStyles(g){var E,S;if(!this.instance||this.isSVG)return;if(!this.isVisible)return KCe;const b={visibility:""},R=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=OO(g==null?void 0:g.pointerEvents)||"",b.transform=R?R(this.latestValues,""):"none",b;const O=this.getLead();if(!this.projectionDelta||!this.layout||!O.target){const z={};return this.options.layoutId&&(z.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,z.pointerEvents=OO(g==null?void 0:g.pointerEvents)||""),this.hasProjected&&!f_(this.latestValues)&&(z.transform=R?R({},""):"none",this.hasProjected=!1),z}const N=O.animationValues||O.latestValues;this.applyTransformsToTarget(),b.transform=N$(this.projectionDeltaWithTransform,this.treeScale,N),R&&(b.transform=R(N,b.transform));const{x:U,y:K}=this.projectionDelta;b.transformOrigin=`${U.origin*100}% ${K.origin*100}% 0`,O.animationValues?b.opacity=O===this?(S=(E=N.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&S!==void 0?S:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:b.opacity=O===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const z in nP){if(N[z]===void 0)continue;const{correct:H,applyTo:ne}=nP[z],J=b.transform==="none"?N[z]:H(N[z],O);if(ne){const se=ne.length;for(let le=0;le<se;le++)b[ne[le]]=J}else b[z]=J}return this.options.layoutId&&(b.pointerEvents=O===this?OO(g==null?void 0:g.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(g=>{var E;return(E=g.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(D$),this.root.sharedNodes.clear()}}}function qCe(r){r.updateLayout()}function YCe(r){var t;const s=((t=r.resumeFrom)===null||t===void 0?void 0:t.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&s&&r.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=r.layout,{animationType:d}=r.options,g=s.source!==r.layout.source;d==="size"?ql(O=>{const N=g?s.measuredBox[O]:s.layoutBox[O],U=ul(N);N.min=a[O].min,N.max=N.min+U}):xJ(d,s.layoutBox,a)&&ql(O=>{const N=g?s.measuredBox[O]:s.layoutBox[O],U=ul(a[O]);N.max=N.min+U,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[O].max=r.relativeTarget[O].min+U)});const E=Cy();Ob(E,a,s.layoutBox);const S=Cy();g?Ob(S,r.applyTransform(l,!0),s.measuredBox):Ob(S,a,s.layoutBox);const b=!kJ(E);let R=!1;if(!r.resumeFrom){const O=r.getClosestProjectingParent();if(O&&!O.resumeFrom){const{snapshot:N,layout:U}=O;if(N&&U){const K=Ts();Pb(K,s.layoutBox,N.layoutBox);const z=Ts();Pb(z,a,U.layoutBox),DJ(K,z)||(R=!0),O.options.layoutRoot&&(r.relativeTarget=z,r.relativeTargetOrigin=K,r.relativeParent=O)}}}r.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:S,layoutDelta:E,hasLayoutChanged:b,hasRelativeTargetChanged:R})}else if(r.isLead()){const{onExitComplete:a}=r.options;a&&a()}r.options.transition=void 0}function XCe(r){m_.totalNodes++,r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function JCe(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function QCe(r){r.clearSnapshot()}function D$(r){r.clearMeasurements()}function ZCe(r){r.isLayoutDirty=!1}function eIe(r){const{visualElement:t}=r.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),r.resetTransform()}function L$(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function tIe(r){r.resolveTargetDelta()}function nIe(r){r.calcProjection()}function rIe(r){r.resetSkewAndRotation()}function iIe(r){r.removeLeadSnapshot()}function x$(r,t,s){r.translate=Ji(t.translate,0,s),r.scale=Ji(t.scale,1,s),r.origin=t.origin,r.originPoint=t.originPoint}function M$(r,t,s,a){r.min=Ji(t.min,s.min,a),r.max=Ji(t.max,s.max,a)}function sIe(r,t,s,a){M$(r.x,t.x,s.x,a),M$(r.y,t.y,s.y,a)}function oIe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const aIe={duration:.45,ease:[.4,0,.1,1]},U$=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),V$=U$("applewebkit/")&&!U$("chrome/")?Math.round:va;function F$(r){r.min=V$(r.min),r.max=V$(r.max)}function cIe(r){F$(r.x),F$(r.y)}function xJ(r,t,s){return r==="position"||r==="preserve-aspect"&&!ZM(P$(t),P$(s),.2)}const lIe=LJ({attachResizeListener:(r,t)=>Sp(r,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Wx={current:void 0},MJ=LJ({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!Wx.current){const r=new lIe({});r.mount(window),r.setOptions({layoutScroll:!0}),Wx.current=r}return Wx.current},resetTransform:(r,t)=>{r.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),uIe={pan:{Feature:RCe},drag:{Feature:wCe,ProjectionNode:MJ,MeasureLayout:OJ}},r2={current:null},UJ={current:!1};function dIe(){if(UJ.current=!0,!!vU)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),t=()=>r2.current=r.matches;r.addListener(t),t()}else r2.current=!1}function hIe(r,t,s){const{willChange:a}=t;for(const l in t){const d=t[l],g=s[l];if(_a(d))r.addValue(l,d),oP(a)&&a.add(l);else if(_a(g))r.addValue(l,Qb(d,{owner:r})),oP(a)&&a.remove(l);else if(g!==d)if(r.hasValue(l)){const E=r.getValue(l);E.liveStyle===!0?E.jump(d):E.hasAnimated||E.set(d)}else{const E=r.getStaticValue(l);r.addValue(l,Qb(E!==void 0?E:d,{owner:r}))}}for(const l in s)t[l]===void 0&&r.removeValue(l);return t}const j$=new WeakMap,pIe=[...YX,fa,Sm],fIe=r=>pIe.find(qX(r)),VJ=Object.keys(Yb),mIe=VJ.length,B$=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],gIe=bU.length;function FJ(r){if(r)return r.options.allowProjection!==!1?r.projection:FJ(r.parent)}class _Ie{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:g},E={}){this.resolveKeyframes=(N,U,K,z)=>new this.KeyframeResolver(N,U,K,z,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=xU,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>gi.render(this.render,!1,!0);const{latestValues:S,renderState:b}=g;this.latestValues=S,this.baseTarget={...S},this.initialValues=s.initial?{...S}:{},this.renderState=b,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=$P(s),this.isVariantNode=bX(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:R,...O}=this.scrapeMotionValuesFromProps(s,{},this);for(const N in O){const U=O[N];S[N]!==void 0&&_a(U)&&(U.set(S[N],!1),oP(R)&&R.add(N))}}mount(t){this.current=t,j$.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),UJ.current||dIe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:r2.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){var t;j$.delete(this.current),this.projection&&this.projection.unmount(),ym(this.notifyUpdate),ym(this.render),this.valueSubscriptions.forEach(s=>s()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const s in this.events)this.events[s].clear();for(const s in this.features)(t=this.features[s])===null||t===void 0||t.unmount();this.current=null}bindToMotionValue(t,s){const a=J_.has(t),l=s.on("change",g=>{this.latestValues[t]=g,this.props.onUpdate&&gi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{l(),d(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...s},a,l,d){let g,E;for(let S=0;S<mIe;S++){const b=VJ[S],{isEnabled:R,Feature:O,ProjectionNode:N,MeasureLayout:U}=Yb[b];N&&(g=N),R(s)&&(!this.features[b]&&O&&(this.features[b]=new O(this)),U&&(E=U))}if((this.type==="html"||this.type==="svg")&&!this.projection&&g){const{layoutId:S,layout:b,drag:R,dragConstraints:O,layoutScroll:N,layoutRoot:U}=s;this.projection=new g(this.latestValues,s["data-framer-portal-id"]?void 0:FJ(this.parent)),this.projection.setOptions({layoutId:S,layout:b,alwaysMeasureLayout:!!R||O&&wy(O),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof b=="string"?b:"both",initialPromotionConfig:d,layoutScroll:N,layoutRoot:U})}return E}updateFeatures(){for(const t in this.features){const s=this.features[t];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ts()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<B$.length;a++){const l=B$[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,g=t[d];g&&(this.propEventSubscriptions[l]=this.on(l,g))}this.prevMotionValues=hIe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const a=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(a.initial=this.props.initial),a}const s={};for(let a=0;a<gIe;a++){const l=bU[a],d=this.props[l];(qb(d)||d===!1)&&(s[l]=d)}return s}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=Qb(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(KX(l)||zX(l))?l=parseFloat(l):!fIe(l)&&Sm.test(s)&&(l=rJ(t,s)),this.setBaseTarget(t,_a(l)?l.get():l)),_a(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const g=DU(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);g&&(l=g[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!_a(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new KU),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class jJ extends _Ie{constructor(){super(...arguments),this.KeyframeResolver=iJ}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}}function vIe(r){return window.getComputedStyle(r)}class EIe extends jJ{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,s){if(J_.has(s)){const a=UU(s);return a&&a.default||0}else{const a=vIe(t),l=(IX(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return CJ(t,s)}build(t,s,a,l){AU(t,s,a,l.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return kU(t,s,a)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;_a(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}renderInstance(t,s,a,l){kX(t,s,a,l)}}class yIe extends jJ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(J_.has(s)){const a=UU(s);return a&&a.default||0}return s=DX.has(s)?s:yU(s),t.getAttribute(s)}measureInstanceViewportBox(){return Ts()}scrapeMotionValuesFromProps(t,s,a){return xX(t,s,a)}build(t,s,a,l){PU(t,s,a,this.isSVGTag,l.transformTemplate)}renderInstance(t,s,a,l){LX(t,s,a,l)}mount(t){this.isSVGTag=NU(t.tagName),super.mount(t)}}const SIe=(r,t)=>RU(r)?new yIe(t,{enableHardwareAcceleration:!1}):new EIe(t,{allowProjection:r!==B.Fragment,enableHardwareAcceleration:!0}),TIe={layout:{ProjectionNode:MJ,MeasureLayout:OJ}},bIe={...iCe,...fwe,...uIe,...TIe},Fp=wbe((r,t)=>twe(r,t,bIe,SIe));function BJ(){const r=B.useRef(!1);return EU(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function wIe(){const r=BJ(),[t,s]=B.useState(0),a=B.useCallback(()=>{r.current&&s(t+1)},[t]);return[B.useCallback(()=>gi.postRender(a),[a]),t]}class RIe extends B.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function CIe({children:r,isPresent:t}){const s=B.useId(),a=B.useRef(null),l=B.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=B.useContext(_U);return B.useInsertionEffect(()=>{const{width:g,height:E,top:S,left:b}=l.current;if(t||!a.current||!g||!E)return;a.current.dataset.motionPopId=s;const R=document.createElement("style");return d&&(R.nonce=d),document.head.appendChild(R),R.sheet&&R.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${E}px !important;
            top: ${S}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(R)}},[t]),F.jsx(RIe,{isPresent:t,childRef:a,sizeRef:l,children:B.cloneElement(r,{ref:a})})}const Gx=({children:r,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:g})=>{const E=MX(IIe),S=B.useId(),b=B.useMemo(()=>({id:S,initial:t,isPresent:s,custom:l,onExitComplete:R=>{E.set(R,!0);for(const O of E.values())if(!O)return;a&&a()},register:R=>(E.set(R,!1),()=>E.delete(R))}),d?[Math.random()]:[s]);return B.useMemo(()=>{E.forEach((R,O)=>E.set(O,!1))},[s]),B.useEffect(()=>{!s&&!E.size&&a&&a()},[s]),g==="popLayout"&&(r=F.jsx(CIe,{isPresent:s,children:r})),F.jsx(yw.Provider,{value:b,children:r})};function IIe(){return new Map}function AIe(r){return B.useEffect(()=>()=>r(),[])}const g_=r=>r.key||"";function OIe(r,t){r.forEach(s=>{const a=g_(s);t.set(a,s)})}function PIe(r){const t=[];return B.Children.forEach(r,s=>{B.isValidElement(s)&&t.push(s)}),t}const pS=({children:r,custom:t,initial:s=!0,onExitComplete:a,exitBeforeEnter:l,presenceAffectsLayout:d=!0,mode:g="sync"})=>{const E=B.useContext(wU).forceRender||wIe()[0],S=BJ(),b=PIe(r);let R=b;const O=B.useRef(new Map).current,N=B.useRef(R),U=B.useRef(new Map).current,K=B.useRef(!0);if(EU(()=>{K.current=!1,OIe(b,U),N.current=R}),AIe(()=>{K.current=!0,U.clear(),O.clear()}),K.current)return F.jsx(F.Fragment,{children:R.map(J=>F.jsx(Gx,{isPresent:!0,initial:s?void 0:!1,presenceAffectsLayout:d,mode:g,children:J},g_(J)))});R=[...R];const z=N.current.map(g_),H=b.map(g_),ne=z.length;for(let J=0;J<ne;J++){const se=z[J];H.indexOf(se)===-1&&!O.has(se)&&O.set(se,void 0)}return g==="wait"&&O.size&&(R=[]),O.forEach((J,se)=>{if(H.indexOf(se)!==-1)return;const le=U.get(se);if(!le)return;const ce=z.indexOf(se);let Se=J;if(!Se){const Z=()=>{O.delete(se);const te=Array.from(U.keys()).filter(ie=>!H.includes(ie));if(te.forEach(ie=>U.delete(ie)),N.current=b.filter(ie=>{const ae=g_(ie);return ae===se||te.includes(ae)}),!O.size){if(S.current===!1)return;E(),a&&a()}};Se=F.jsx(Gx,{isPresent:!1,onExitComplete:Z,custom:t,presenceAffectsLayout:d,mode:g,children:le},g_(le)),O.set(se,Se)}R.splice(ce,0,Se)}),R=R.map(J=>{const se=J.key;return O.has(se)?J:F.jsx(Gx,{isPresent:!0,presenceAffectsLayout:d,mode:g,children:J},g_(J))}),F.jsx(F.Fragment,{children:O.size?R:R.map(J=>B.cloneElement(J))})};var NIe={initial:r=>{const{position:t}=r,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},WJ=B.memo(r=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:g="bottom",duration:E=5e3,containerStyle:S,motionVariants:b=NIe,toastSpacing:R="0.5rem"}=r,[O,N]=B.useState(E),U=CCe();V_(()=>{U||a==null||a()},[U]),V_(()=>{N(E)},[E]);const K=()=>N(null),z=()=>N(E),H=()=>{U&&l()};B.useEffect(()=>{U&&d&&l()},[U,d,l]),dbe(H,O);const ne=B.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:R,...S}),[S,R]),J=B.useMemo(()=>lbe(g),[g]);return F.jsx(Fp.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:K,onHoverEnd:z,custom:{position:g},style:J,children:F.jsx(Nt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:ne,children:Xl(s,{id:t,onClose:H})})})});WJ.displayName="ToastComponent";function kIe(r,t){var s;const a=r??"bottom",d={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[a];return(s=d==null?void 0:d[t])!=null?s:a}var W$={path:F.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[F.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),F.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),F.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Om=qt((r,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:g,className:E,__css:S,...b}=r,R=Un("chakra-icon",E),O=Qu("Icon",r),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...S,...O},U={ref:t,focusable:d,className:R,__css:N},K=a??W$.viewBox;if(s&&typeof s!="string")return F.jsx(Nt.svg,{as:s,...U,...b});const z=g??W$.path;return F.jsx(Nt.svg,{verticalAlign:"middle",viewBox:K,...U,...b,children:z})});Om.displayName="Icon";function Rw(r){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=r,d=B.Children.toArray(r.path),g=qt((E,S)=>F.jsx(Om,{ref:S,viewBox:t,...l,...E,children:d.length?d:F.jsx("path",{fill:"currentColor",d:s})}));return g.displayName=a,g}function DIe(r){return F.jsx(Om,{viewBox:"0 0 24 24",...r,children:F.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function LIe(r){return F.jsx(Om,{viewBox:"0 0 24 24",...r,children:F.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function G$(r){return F.jsx(Om,{viewBox:"0 0 24 24",...r,children:F.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}var xIe=_w({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),Cw=qt((r,t)=>{const s=Qu("Spinner",r),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:g="transparent",className:E,...S}=es(r),b=Un("chakra-spinner",E),R={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:g,borderLeftColor:g,animation:`${xIe} ${d} linear infinite`,...s};return F.jsx(Nt.div,{ref:t,__css:R,className:b,...S,children:a&&F.jsx(Nt.span,{srOnly:!0,children:a})})});Cw.displayName="Spinner";var[MIe,$U]=Gi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[UIe,qU]=Gi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),GJ={info:{icon:LIe,colorScheme:"blue"},warning:{icon:G$,colorScheme:"orange"},success:{icon:DIe,colorScheme:"green"},error:{icon:G$,colorScheme:"red"},loading:{icon:Cw,colorScheme:"blue"}};function VIe(r){return GJ[r].colorScheme}function FIe(r){return GJ[r].icon}var zJ=qt(function(t,s){const a=qU(),{status:l}=$U(),d={display:"inline",...a.description};return F.jsx(Nt.div,{ref:s,"data-status":l,...t,className:Un("chakra-alert__desc",t.className),__css:d})});zJ.displayName="AlertDescription";function JP(r){const{status:t}=$U(),s=FIe(t),a=qU(),l=t==="loading"?a.spinner:a.icon;return F.jsx(Nt.span,{display:"inherit","data-status":t,...r,className:Un("chakra-alert__icon",r.className),__css:l,children:r.children||F.jsx(s,{h:"100%",w:"100%"})})}JP.displayName="AlertIcon";var HJ=qt(function(t,s){const a=qU(),{status:l}=$U();return F.jsx(Nt.div,{ref:s,"data-status":l,...t,className:Un("chakra-alert__title",t.className),__css:a.title})});HJ.displayName="AlertTitle";var QP=qt(function(t,s){var a;const{status:l="info",addRole:d=!0,...g}=es(t),E=(a=t.colorScheme)!=null?a:VIe(l),S=Pc("Alert",{...t,colorScheme:E}),b={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...S.container};return F.jsx(MIe,{value:{status:l},children:F.jsx(UIe,{value:S,children:F.jsx(Nt.div,{"data-status":l,role:d?"alert":void 0,ref:s,...g,className:Un("chakra-alert",t.className),__css:b})})})});QP.displayName="Alert";function jIe(r){return F.jsx(Om,{focusable:"false","aria-hidden":!0,...r,children:F.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}var Zb=qt(function(t,s){const a=Qu("CloseButton",t),{children:l,isDisabled:d,__css:g,...E}=es(t),S={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return F.jsx(Nt.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...S,...a,...g},...E,children:l||F.jsx(jIe,{width:"1em",height:"1em"})})});Zb.displayName="CloseButton";var BIe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Jd=WIe(BIe);function WIe(r){let t=r;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>r),s.delete(l)}),removeToast:(l,d)=>{a(g=>({...g,[d]:g[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const g=GIe(l,d),{position:E,id:S}=g;return a(b=>{var R,O;const U=E.includes("top")?[g,...(R=b[E])!=null?R:[]]:[...(O=b[E])!=null?O:[],g];return{...b,[E]:U}}),S},update:(l,d)=>{l&&a(g=>{const E={...g},{position:S,index:b}=DK(E,l);return S&&b!==-1&&(E[S][b]={...E[S][b],...d,message:KJ(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((S,b)=>(S[b]=d[b].map(R=>({...R,requestClose:!0})),S),{...d}))},close:l=>{a(d=>{const g=EX(d,l);return g?{...d,[g]:d[g].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!DK(Jd.getState(),l).position}}var z$=0;function GIe(r,t={}){var s,a;z$+=1;const l=(s=t.id)!=null?s:z$,d=(a=t.position)!=null?a:"bottom";return{id:l,message:r,position:d,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>Jd.removeToast(String(l),d),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var zIe=r=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:g,description:E,colorScheme:S,icon:b}=r,R=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return F.jsxs(QP,{addRole:!1,status:t,variant:s,id:R==null?void 0:R.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:S,children:[F.jsx(JP,{children:b}),F.jsxs(Nt.div,{flex:"1",maxWidth:"100%",children:[l&&F.jsx(HJ,{id:R==null?void 0:R.title,children:l}),E&&F.jsx(zJ,{id:R==null?void 0:R.description,display:"block",children:E})]}),d&&F.jsx(Zb,{size:"sm",onClick:g,position:"absolute",insetEnd:1,top:1})]})};function KJ(r={}){const{render:t,toastComponent:s=zIe}=r;return l=>typeof t=="function"?t({...l,...r}):F.jsx(s,{...l,...r})}function HIe(r,t){const s=l=>{var d;return{...t,...l,position:kIe((d=l==null?void 0:l.position)!=null?d:t==null?void 0:t.position,r)}},a=l=>{const d=s(l),g=KJ(d);return Jd.notify(g,d)};return a.update=(l,d)=>{Jd.update(l,s(d))},a.promise=(l,d)=>{const g=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(g,{status:"success",duration:5e3,...Xl(d.success,E)})).catch(E=>a.update(g,{status:"error",duration:5e3,...Xl(d.error,E)}))},a.closeAll=Jd.closeAll,a.close=Jd.close,a.isActive=Jd.isActive,a}var[KIe,$Ie]=Gi({name:"ToastOptionsContext",strict:!1}),qIe=r=>{const t=B.useSyncExternalStore(Jd.subscribe,Jd.getState,Jd.getState),{motionVariants:s,component:a=WJ,portalProps:l}=r,g=Object.keys(t).map(E=>{const S=t[E];return F.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:ube(E),children:F.jsx(pS,{initial:!1,children:S.map(b=>F.jsx(a,{motionVariants:s,...b},b.id))})},E)});return F.jsx(Ju,{...l,children:g})};function Iw(r){const{theme:t}=jY(),s=$Ie();return B.useMemo(()=>HIe(t.direction,{...s,...r}),[r,t.direction,s])}var YIe=r=>function({children:s,theme:a=r,toastOptions:l,...d}){return F.jsxs(abe,{theme:a,...d,children:[F.jsx(KIe,{value:l==null?void 0:l.defaultOptions,children:s}),F.jsx(qIe,{...l})]})},XIe=YIe(R0e),JIe=Object.defineProperty,QIe=(r,t,s)=>t in r?JIe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,hs=(r,t,s)=>(QIe(r,typeof t!="symbol"?t+"":t,s),s);function H$(r){return r.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}var ZIe=r=>typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE;function K$(r,t,s){let a=r+1;return s&&a>=t&&(a=0),a}function $$(r,t,s){let a=r-1;return s&&a<0&&(a=t),a}var i2=typeof window<"u"?B.useLayoutEffect:B.useEffect,cP=r=>r,eAe=class{constructor(){hs(this,"descendants",new Map),hs(this,"register",r=>{if(r!=null)return ZIe(r)?this.registerNode(r):t=>{this.registerNode(t,r)}}),hs(this,"unregister",r=>{this.descendants.delete(r);const t=H$(Array.from(this.descendants.keys()));this.assignIndex(t)}),hs(this,"destroy",()=>{this.descendants.clear()}),hs(this,"assignIndex",r=>{this.descendants.forEach(t=>{const s=r.indexOf(t.node);t.index=s,t.node.dataset.index=t.index.toString()})}),hs(this,"count",()=>this.descendants.size),hs(this,"enabledCount",()=>this.enabledValues().length),hs(this,"values",()=>Array.from(this.descendants.values()).sort((t,s)=>t.index-s.index)),hs(this,"enabledValues",()=>this.values().filter(r=>!r.disabled)),hs(this,"item",r=>{if(this.count()!==0)return this.values()[r]}),hs(this,"enabledItem",r=>{if(this.enabledCount()!==0)return this.enabledValues()[r]}),hs(this,"first",()=>this.item(0)),hs(this,"firstEnabled",()=>this.enabledItem(0)),hs(this,"last",()=>this.item(this.descendants.size-1)),hs(this,"lastEnabled",()=>{const r=this.enabledValues().length-1;return this.enabledItem(r)}),hs(this,"indexOf",r=>{var t,s;return r&&(s=(t=this.descendants.get(r))==null?void 0:t.index)!=null?s:-1}),hs(this,"enabledIndexOf",r=>r==null?-1:this.enabledValues().findIndex(t=>t.node.isSameNode(r))),hs(this,"next",(r,t=!0)=>{const s=K$(r,this.count(),t);return this.item(s)}),hs(this,"nextEnabled",(r,t=!0)=>{const s=this.item(r);if(!s)return;const a=this.enabledIndexOf(s.node),l=K$(a,this.enabledCount(),t);return this.enabledItem(l)}),hs(this,"prev",(r,t=!0)=>{const s=$$(r,this.count()-1,t);return this.item(s)}),hs(this,"prevEnabled",(r,t=!0)=>{const s=this.item(r);if(!s)return;const a=this.enabledIndexOf(s.node),l=$$(a,this.enabledCount()-1,t);return this.enabledItem(l)}),hs(this,"registerNode",(r,t)=>{if(!r||this.descendants.has(r))return;const s=Array.from(this.descendants.keys()).concat(r),a=H$(s);t!=null&&t.disabled&&(t.disabled=!!t.disabled);const l={node:r,index:-1,...t};this.descendants.set(r,l),this.assignIndex(a)})}};function tAe(r,t){if(r!=null){if(typeof r=="function"){r(t);return}try{r.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${r}'`)}}}function Qi(...r){return t=>{r.forEach(s=>{tAe(s,t)})}}function nAe(...r){return B.useMemo(()=>Qi(...r),r)}function rAe(){const r=B.useRef(new eAe);return i2(()=>()=>r.current.destroy()),r.current}var[iAe,$J]=Gi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});function sAe(r){const t=$J(),[s,a]=B.useState(-1),l=B.useRef(null);i2(()=>()=>{l.current&&t.unregister(l.current)},[]),i2(()=>{if(!l.current)return;const g=Number(l.current.dataset.index);s!=g&&!Number.isNaN(g)&&a(g)});const d=cP(r?t.register(r):t.register);return{descendants:t,index:s,enabledIndex:t.enabledIndexOf(l.current),register:Qi(d,l)}}function qJ(){return[cP(iAe),()=>cP($J()),()=>rAe(),l=>sAe(l)]}function YJ(r){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(N,U)=>N!==U}=r,d=Rc(a),g=Rc(l),[E,S]=B.useState(s),b=t!==void 0,R=b?t:E,O=Rc(N=>{const K=typeof N=="function"?N(R):N;g(R,K)&&(b||S(K),d(K))},[b,d,R,g]);return[R,O]}var q$={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},N_={enter:{duration:.2,ease:q$.easeOut},exit:{duration:.1,ease:q$.easeIn}},k_={enter:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.exit})},oAe={enter:({transition:r,transitionEnd:t,delay:s}={})=>{var a;return{opacity:1,transition:(a=r==null?void 0:r.enter)!=null?a:k_.enter(N_.enter,s),transitionEnd:t==null?void 0:t.enter}},exit:({transition:r,transitionEnd:t,delay:s}={})=>{var a;return{opacity:0,transition:(a=r==null?void 0:r.exit)!=null?a:k_.exit(N_.exit,s),transitionEnd:t==null?void 0:t.exit}}},XJ={initial:"exit",animate:"enter",exit:"exit",variants:oAe},aAe=B.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:g,transitionEnd:E,delay:S,...b}=t,R=l||a?"enter":"exit",O=a?l&&a:!0,N={transition:g,transitionEnd:E,delay:S};return F.jsx(pS,{custom:N,children:O&&F.jsx(Fp.div,{ref:s,className:Un("chakra-fade",d),custom:N,...XJ,animate:R,...b})})});aAe.displayName="Fade";var cAe={exit:({reverse:r,initialScale:t,transition:s,transitionEnd:a,delay:l})=>{var d;return{opacity:0,...r?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(d=s==null?void 0:s.exit)!=null?d:k_.exit(N_.exit,l)}},enter:({transitionEnd:r,transition:t,delay:s})=>{var a;return{opacity:1,scale:1,transition:(a=t==null?void 0:t.enter)!=null?a:k_.enter(N_.enter,s),transitionEnd:r==null?void 0:r.enter}}},JJ={initial:"exit",animate:"enter",exit:"exit",variants:cAe},lAe=B.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:g=.95,className:E,transition:S,transitionEnd:b,delay:R,...O}=t,N=a?l&&a:!0,U=l||a?"enter":"exit",K={initialScale:g,reverse:d,transition:S,transitionEnd:b,delay:R};return F.jsx(pS,{custom:K,children:N&&F.jsx(Fp.div,{ref:s,className:Un("chakra-offset-slide",E),...JJ,animate:U,custom:K,...O})})});lAe.displayName="ScaleFade";var uAe={initial:({offsetX:r,offsetY:t,transition:s,transitionEnd:a,delay:l})=>{var d;return{opacity:0,x:r,y:t,transition:(d=s==null?void 0:s.exit)!=null?d:k_.exit(N_.exit,l),transitionEnd:a==null?void 0:a.exit}},enter:({transition:r,transitionEnd:t,delay:s})=>{var a;return{opacity:1,x:0,y:0,transition:(a=r==null?void 0:r.enter)!=null?a:k_.enter(N_.enter,s),transitionEnd:t==null?void 0:t.enter}},exit:({offsetY:r,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{var g;const E={x:t,y:r};return{opacity:0,transition:(g=s==null?void 0:s.exit)!=null?g:k_.exit(N_.exit,d),...l?{...E,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...E,...a==null?void 0:a.exit}}}}},db={initial:"initial",animate:"enter",exit:"exit",variants:uAe},dAe=B.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:g,offsetX:E=0,offsetY:S=8,transition:b,transitionEnd:R,delay:O,...N}=t,U=a?l&&a:!0,K=l||a?"enter":"exit",z={offsetX:E,offsetY:S,reverse:d,transition:b,transitionEnd:R,delay:O};return F.jsx(pS,{custom:z,children:U&&F.jsx(Fp.div,{ref:s,className:Un("chakra-offset-slide",g),custom:z,...db,animate:K,...N})})});dAe.displayName="SlideFade";var[hAe,pAe]=Gi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function fAe(r){var t;const s=r.split(" "),a=(t=s[0])!=null?t:"",l=s.length>1?s[s.length-1]:"";return a&&l?`${a.charAt(0)}${l.charAt(0)}`:a.charAt(0)}function QJ(r){const{name:t,getInitials:s,...a}=r,l=pAe();return F.jsx(Nt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}QJ.displayName="AvatarName";var ZJ=r=>F.jsxs(Nt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...r,children:[F.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),F.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]}),s2=qt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...g}=t;return F.jsx("img",{width:a,height:l,ref:s,alt:d,...g})});s2.displayName="NativeImage";function eQ(r){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:g,sizes:E,ignoreFallback:S}=r,[b,R]=B.useState("pending");B.useEffect(()=>{R(s?"loading":"pending")},[s]);const O=B.useRef(),N=B.useCallback(()=>{if(!s)return;U();const K=new Image;K.src=s,g&&(K.crossOrigin=g),a&&(K.srcset=a),E&&(K.sizes=E),t&&(K.loading=t),K.onload=z=>{U(),R("loaded"),l==null||l(z)},K.onerror=z=>{U(),R("failed"),d==null||d(z)},O.current=K},[s,g,a,E,l,d,t]),U=()=>{O.current&&(O.current.onload=null,O.current.onerror=null,O.current=null)};return Rp(()=>{if(!S)return b==="loading"&&N(),()=>{U()}},[b,N,S]),S?"loaded":b}var mAe=(r,t)=>r!=="loaded"&&t==="beforeLoadOrError"||r==="failed"&&t==="onError";function gAe(r,t=[]){const s=Object.assign({},r);for(const a of t)a in s&&delete s[a];return s}var YU=qt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:g,align:E,fit:S,loading:b,ignoreFallback:R,crossOrigin:O,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:U,...K}=t,z=a!==void 0||l!==void 0,H=b!=null||R||!z,ne=eQ({...t,crossOrigin:O,ignoreFallback:H}),J=mAe(ne,N),se={ref:s,objectFit:S,objectPosition:E,...H?K:gAe(K,["onError","onLoad"])};return J?l||F.jsx(Nt.img,{as:s2,className:"chakra-image__placeholder",src:a,...se}):F.jsx(Nt.img,{as:s2,src:d,srcSet:g,crossOrigin:O,loading:b,referrerPolicy:U,className:"chakra-image",...se})});YU.displayName="Image";function tQ(r){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:g,borderRadius:E,loading:S,iconLabel:b,icon:R=F.jsx(ZJ,{}),ignoreFallback:O,referrerPolicy:N,crossOrigin:U}=r,z=eQ({src:t,onError:a,crossOrigin:U,ignoreFallback:O})==="loaded";return!t||!z?g?F.jsx(QJ,{className:"chakra-avatar__initials",getInitials:d,name:g}):B.cloneElement(R,{role:"img","aria-label":b}):F.jsx(Nt.img,{src:t,srcSet:s,alt:g,onLoad:l,referrerPolicy:N,crossOrigin:U??void 0,className:"chakra-avatar__img",loading:S,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}tQ.displayName="AvatarImage";var _Ae={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},F_=qt((r,t)=>{const s=Pc("Avatar",r),[a,l]=B.useState(!1),{src:d,srcSet:g,name:E,showBorder:S,borderRadius:b="full",onError:R,onLoad:O,getInitials:N=fAe,icon:U=F.jsx(ZJ,{}),iconLabel:K=" avatar",loading:z,children:H,borderColor:ne,ignoreFallback:J,crossOrigin:se,referrerPolicy:le,...ce}=es(r),Se={borderRadius:b,borderWidth:S?"2px":void 0,..._Ae,...s.container};return ne&&(Se.borderColor=ne),F.jsx(Nt.span,{ref:t,...ce,className:Un("chakra-avatar",r.className),"data-loaded":cr(a),__css:Se,children:F.jsxs(hAe,{value:s,children:[F.jsx(tQ,{src:d,srcSet:g,loading:z,onLoad:nr(O,()=>{l(!0)}),onError:R,getInitials:N,name:E,borderRadius:b,icon:U,iconLabel:K,ignoreFallback:J,crossOrigin:se,referrerPolicy:le}),H]})})});F_.displayName="Avatar";function XU(r){return B.Children.toArray(r).filter(t=>B.isValidElement(t))}var[g4e,vAe]=Gi({strict:!1,name:"ButtonGroupContext"});function EAe(r){const[t,s]=B.useState(!r);return{ref:B.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}function o2(r){const{children:t,className:s,...a}=r,l=B.isValidElement(t)?B.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=Un("chakra-button__icon",s);return F.jsx(Nt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}o2.displayName="ButtonIcon";function a2(r){const{label:t,placement:s,spacing:a="0.5rem",children:l=F.jsx(Cw,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:g,...E}=r,S=Un("chakra-button__spinner",d),b=s==="start"?"marginEnd":"marginStart",R=B.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...g}),[g,t,b,a]);return F.jsx(Nt.div,{className:S,...E,__css:R,children:l})}a2.displayName="ButtonSpinner";var Tm=qt((r,t)=>{const s=vAe(),a=Qu("Button",{...s,...r}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:g,children:E,leftIcon:S,rightIcon:b,loadingText:R,iconSpacing:O="0.5rem",type:N,spinner:U,spinnerPlacement:K="start",className:z,as:H,...ne}=es(r),J=B.useMemo(()=>{const Se={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:Se}}},[a,s]),{ref:se,type:le}=EAe(H),ce={rightIcon:b,leftIcon:S,iconSpacing:O,children:E};return F.jsxs(Nt.button,{ref:nAe(t,se),as:H,type:N??le,"data-active":cr(g),"data-loading":cr(d),__css:J,className:Un("chakra-button",z),...ne,disabled:l||d,children:[d&&K==="start"&&F.jsx(a2,{className:"chakra-button__spinner--start",label:R,placement:"start",spacing:O,children:U}),d?R||F.jsx(Nt.span,{opacity:0,children:F.jsx(Y$,{...ce})}):F.jsx(Y$,{...ce}),d&&K==="end"&&F.jsx(a2,{className:"chakra-button__spinner--end",label:R,placement:"end",spacing:O,children:U})]})});Tm.displayName="Button";function Y$(r){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l}=r;return F.jsxs(F.Fragment,{children:[t&&F.jsx(o2,{marginEnd:l,children:t}),a,s&&F.jsx(o2,{marginStart:l,children:s})]})}var sl=qt((r,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...g}=r,E=s||a,S=B.isValidElement(E)?B.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return F.jsx(Tm,{padding:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...g,children:S})});sl.displayName="IconButton";var[yAe,nQ]=Gi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[SAe,fS]=Gi({strict:!1,name:"FormControlContext"});function TAe(r){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...g}=r,E=B.useId(),S=t||`field-${E}`,b=`${S}-label`,R=`${S}-feedback`,O=`${S}-helptext`,[N,U]=B.useState(!1),[K,z]=B.useState(!1),[H,ne]=B.useState(!1),J=B.useCallback((Z={},te=null)=>({id:O,...Z,ref:Qi(te,ie=>{ie&&z(!0)})}),[O]),se=B.useCallback((Z={},te=null)=>({...Z,ref:te,"data-focus":cr(H),"data-disabled":cr(l),"data-invalid":cr(a),"data-readonly":cr(d),id:Z.id!==void 0?Z.id:b,htmlFor:Z.htmlFor!==void 0?Z.htmlFor:S}),[S,l,H,a,d,b]),le=B.useCallback((Z={},te=null)=>({id:R,...Z,ref:Qi(te,ie=>{ie&&U(!0)}),"aria-live":"polite"}),[R]),ce=B.useCallback((Z={},te=null)=>({...Z,...g,ref:te,role:"group","data-focus":cr(H),"data-disabled":cr(l),"data-invalid":cr(a),"data-readonly":cr(d)}),[g,l,H,a,d]),Se=B.useCallback((Z={},te=null)=>({...Z,ref:te,role:"presentation","aria-hidden":!0,children:Z.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!H,onFocus:()=>ne(!0),onBlur:()=>ne(!1),hasFeedbackText:N,setHasFeedbackText:U,hasHelpText:K,setHasHelpText:z,id:S,labelId:b,feedbackId:R,helpTextId:O,htmlProps:g,getHelpTextProps:J,getErrorMessageProps:le,getRootProps:ce,getLabelProps:se,getRequiredIndicatorProps:Se}}var jo=qt(function(t,s){const a=Pc("Form",t),l=es(t),{getRootProps:d,htmlProps:g,...E}=TAe(l),S=Un("chakra-form-control",t.className);return F.jsx(SAe,{value:E,children:F.jsx(yAe,{value:a,children:F.jsx(Nt.div,{...d({},s),className:S,__css:a.container})})})});jo.displayName="FormControl";var bAe=qt(function(t,s){const a=fS(),l=nQ(),d=Un("chakra-form__helper-text",t.className);return F.jsx(Nt.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});bAe.displayName="FormHelperText";var[wAe,RAe]=Gi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),gp=qt((r,t)=>{const s=Pc("FormError",r),a=es(r),l=fS();return l!=null&&l.isInvalid?F.jsx(wAe,{value:s,children:F.jsx(Nt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:Un("chakra-form__error-message",r.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});gp.displayName="FormErrorMessage";var CAe=qt((r,t)=>{const s=RAe(),a=fS();if(!(a!=null&&a.isInvalid))return null;const l=Un("chakra-form__error-icon",r.className);return F.jsx(Om,{ref:t,"aria-hidden":!0,...r,__css:s.icon,className:l,children:F.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});CAe.displayName="FormErrorIcon";var __=qt(function(t,s){var a;const l=Qu("FormLabel",t),d=es(t),{className:g,children:E,requiredIndicator:S=F.jsx(rQ,{}),optionalIndicator:b=null,...R}=d,O=fS(),N=(a=O==null?void 0:O.getLabelProps(R,s))!=null?a:{ref:s,...R};return F.jsxs(Nt.label,{...N,className:Un("chakra-form__label",d.className),__css:{display:"block",textAlign:"start",...l},children:[E,O!=null&&O.isRequired?S:b]})});__.displayName="FormLabel";var rQ=qt(function(t,s){const a=fS(),l=nQ();if(!(a!=null&&a.isRequired))return null;const d=Un("chakra-form__required-indicator",t.className);return F.jsx(Nt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});rQ.displayName="RequiredIndicator";function iQ(r){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=sQ(r);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":dx(s),"aria-required":dx(l),"aria-readonly":dx(a)}}function sQ(r){var t,s,a;const l=fS(),{id:d,disabled:g,readOnly:E,required:S,isRequired:b,isInvalid:R,isReadOnly:O,isDisabled:N,onFocus:U,onBlur:K,...z}=r,H=r["aria-describedby"]?[r["aria-describedby"]]:[];return l!=null&&l.hasFeedbackText&&(l!=null&&l.isInvalid)&&H.push(l.feedbackId),l!=null&&l.hasHelpText&&H.push(l.helpTextId),{...z,"aria-describedby":H.join(" ")||void 0,id:d??(l==null?void 0:l.id),isDisabled:(t=g??N)!=null?t:l==null?void 0:l.isDisabled,isReadOnly:(s=E??O)!=null?s:l==null?void 0:l.isReadOnly,isRequired:(a=S??b)!=null?a:l==null?void 0:l.isRequired,isInvalid:R??(l==null?void 0:l.isInvalid),onFocus:nr(l==null?void 0:l.onFocus,U),onBlur:nr(l==null?void 0:l.onBlur,K)}}var IAe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},AAe=()=>typeof document<"u",X$=!1,Aw=null,j_=!1,c2=!1,l2=new Set;function JU(r,t){l2.forEach(s=>s(r,t))}var OAe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function PAe(r){return!(r.metaKey||!OAe&&r.altKey||r.ctrlKey||r.key==="Control"||r.key==="Shift"||r.key==="Meta")}function J$(r){j_=!0,PAe(r)&&(Aw="keyboard",JU("keyboard",r))}function sy(r){if(Aw="pointer",r.type==="mousedown"||r.type==="pointerdown"){j_=!0;const t=r.composedPath?r.composedPath()[0]:r.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;JU("pointer",r)}}function NAe(r){return r.mozInputSource===0&&r.isTrusted?!0:r.detail===0&&!r.pointerType}function kAe(r){NAe(r)&&(j_=!0,Aw="virtual")}function DAe(r){r.target===window||r.target===document||(!j_&&!c2&&(Aw="virtual",JU("virtual",r)),j_=!1,c2=!1)}function LAe(){j_=!1,c2=!0}function Q$(){return Aw!=="pointer"}function xAe(){if(!AAe()||X$)return;const{focus:r}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){j_=!0,r.apply(this,s)},document.addEventListener("keydown",J$,!0),document.addEventListener("keyup",J$,!0),document.addEventListener("click",kAe,!0),window.addEventListener("focus",DAe,!0),window.addEventListener("blur",LAe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",sy,!0),document.addEventListener("pointermove",sy,!0),document.addEventListener("pointerup",sy,!0)):(document.addEventListener("mousedown",sy,!0),document.addEventListener("mousemove",sy,!0),document.addEventListener("mouseup",sy,!0)),X$=!0}function MAe(r){xAe(),r(Q$());const t=()=>r(Q$());return l2.add(t),()=>{l2.delete(t)}}function UAe(r,t=[]){const s=Object.assign({},r);for(const a of t)a in s&&delete s[a];return s}function VAe(r={}){const t=sQ(r),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:g,onBlur:E,onFocus:S,"aria-describedby":b}=t,{defaultChecked:R,isChecked:O,isFocusable:N,onChange:U,isIndeterminate:K,name:z,value:H,tabIndex:ne=void 0,"aria-label":J,"aria-labelledby":se,"aria-invalid":le,...ce}=r,Se=UAe(ce,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Z=Rc(U),te=Rc(E),ie=Rc(S),[ae,ve]=B.useState(!1),[pe,de]=B.useState(!1),[ut,mt]=B.useState(!1),[Ze,Be]=B.useState(!1);B.useEffect(()=>MAe(ve),[]);const Ke=B.useRef(null),[nt,Ee]=B.useState(!0),[Ye,Et]=B.useState(!!R),ot=O!==void 0,Ve=ot?O:Ye,et=B.useCallback(bt=>{if(a||s){bt.preventDefault();return}ot||Et(Ve?bt.target.checked:K?!0:bt.target.checked),Z==null||Z(bt)},[a,s,Ve,ot,K,Z]);Rp(()=>{Ke.current&&(Ke.current.indeterminate=!!K)},[K]),V_(()=>{s&&de(!1)},[s,de]),Rp(()=>{const bt=Ke.current;if(!(bt!=null&&bt.form))return;const Sn=()=>{Et(!!R)};return bt.form.addEventListener("reset",Sn),()=>{var Tn;return(Tn=bt.form)==null?void 0:Tn.removeEventListener("reset",Sn)}},[]);const gt=s&&!N,Dt=B.useCallback(bt=>{bt.key===" "&&Be(!0)},[Be]),Gt=B.useCallback(bt=>{bt.key===" "&&Be(!1)},[Be]);Rp(()=>{if(!Ke.current)return;Ke.current.checked!==Ve&&Et(Ke.current.checked)},[Ke.current]);const Bt=B.useCallback((bt={},Sn=null)=>{const Tn=we=>{pe&&we.preventDefault(),Be(!0)};return{...bt,ref:Sn,"data-active":cr(Ze),"data-hover":cr(ut),"data-checked":cr(Ve),"data-focus":cr(pe),"data-focus-visible":cr(pe&&ae),"data-indeterminate":cr(K),"data-disabled":cr(s),"data-invalid":cr(d),"data-readonly":cr(a),"aria-hidden":!0,onMouseDown:nr(bt.onMouseDown,Tn),onMouseUp:nr(bt.onMouseUp,()=>Be(!1)),onMouseEnter:nr(bt.onMouseEnter,()=>mt(!0)),onMouseLeave:nr(bt.onMouseLeave,()=>mt(!1))}},[Ze,Ve,s,pe,ae,ut,K,d,a]),Vn=B.useCallback((bt={},Sn=null)=>({...bt,ref:Sn,"data-active":cr(Ze),"data-hover":cr(ut),"data-checked":cr(Ve),"data-focus":cr(pe),"data-focus-visible":cr(pe&&ae),"data-indeterminate":cr(K),"data-disabled":cr(s),"data-invalid":cr(d),"data-readonly":cr(a)}),[Ze,Ve,s,pe,ae,ut,K,d,a]),Dn=B.useCallback((bt={},Sn=null)=>({...Se,...bt,ref:Qi(Sn,Tn=>{Tn&&Ee(Tn.tagName==="LABEL")}),onClick:nr(bt.onClick,()=>{var Tn;nt||((Tn=Ke.current)==null||Tn.click(),requestAnimationFrame(()=>{var we;(we=Ke.current)==null||we.focus({preventScroll:!0})}))}),"data-disabled":cr(s),"data-checked":cr(Ve),"data-invalid":cr(d)}),[Se,s,Ve,d,nt]),un=B.useCallback((bt={},Sn=null)=>({...bt,ref:Qi(Ke,Sn),type:"checkbox",name:z,value:H,id:g,tabIndex:ne,onChange:nr(bt.onChange,et),onBlur:nr(bt.onBlur,te,()=>de(!1)),onFocus:nr(bt.onFocus,ie,()=>de(!0)),onKeyDown:nr(bt.onKeyDown,Dt),onKeyUp:nr(bt.onKeyUp,Gt),required:l,checked:Ve,disabled:gt,readOnly:a,"aria-label":J,"aria-labelledby":se,"aria-invalid":le?!!le:d,"aria-describedby":b,"aria-disabled":s,style:IAe}),[z,H,g,et,te,ie,Dt,Gt,l,Ve,gt,a,J,se,le,d,b,s,ne]),gr=B.useCallback((bt={},Sn=null)=>({...bt,ref:Sn,onMouseDown:nr(bt.onMouseDown,FAe),"data-disabled":cr(s),"data-checked":cr(Ve),"data-invalid":cr(d)}),[Ve,s,d]);return{state:{isInvalid:d,isFocused:pe,isChecked:Ve,isActive:Ze,isHovered:ut,isIndeterminate:K,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:Dn,getCheckboxProps:Bt,getIndicatorProps:Vn,getInputProps:un,getLabelProps:gr,htmlProps:Se}}function FAe(r){r.preventDefault(),r.stopPropagation()}function jAe(r){const t=parseFloat(r);return typeof t!="number"||Number.isNaN(t)?0:t}function BAe(r,t){let s=jAe(r);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function WAe(r){if(!Number.isFinite(r))return 0;let t=1,s=0;for(;Math.round(r*t)/t!==r;)t*=10,s+=1;return s}function Z$(r,t,s){return(r-t)*100/(s-t)}function GAe(r,t,s){return(s-t)*r+t}function e7(r,t,s){const a=Math.round((r-t)/s)*s+t,l=WAe(s);return BAe(a,l)}function zx(r,t,s){return r==null?r:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(r,t),s))}function Uy(r,t,s,a){const l=Rc(s);return B.useEffect(()=>{const d=typeof r=="function"?r():r??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,r,a,l,s]),()=>{const d=typeof r=="function"?r():r??document;d==null||d.removeEventListener(t,l,a)}}function zAe(r){return"current"in r}var oQ=()=>typeof window<"u";function HAe(){var r;const t=navigator.userAgentData;return(r=t==null?void 0:t.platform)!=null?r:navigator.platform}var KAe=r=>oQ()&&r.test(navigator.vendor),$Ae=r=>oQ()&&r.test(HAe()),qAe=()=>$Ae(/mac|iphone|ipad|ipod/i),YAe=()=>qAe()&&KAe(/apple/i);function XAe(r){const{ref:t,elements:s,enabled:a}=r,l=()=>{var d,g;return(g=(d=t.current)==null?void 0:d.ownerDocument)!=null?g:document};Uy(l,"pointerdown",d=>{if(!YAe()||!a)return;const g=d.target,S=(s??[t]).some(b=>{const R=zAe(b)?b.current:b;return(R==null?void 0:R.contains(g))||R===g});l().activeElement!==g&&S&&(d.preventDefault(),g.focus())})}function JAe(r,t){if(r==null)return{};var s={},a=Object.keys(r),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(s[l]=r[l]);return s}var Hx={exports:{}},Kx,t7;function QAe(){if(t7)return Kx;t7=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Kx=r,Kx}var $x,n7;function ZAe(){if(n7)return $x;n7=1;var r=QAe();function t(){}function s(){}return s.resetWarningCache=t,$x=function(){function a(g,E,S,b,R,O){if(O!==r){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},$x}var r7;function eOe(){return r7||(r7=1,Hx.exports=ZAe()()),Hx.exports}var tOe=eOe();const ai=lS(tOe);var u2="data-focus-lock",aQ="data-focus-lock-disabled",nOe="data-no-focus-lock",rOe="data-autofocus-inside",iOe="data-no-autofocus";function qx(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function sOe(r,t){var s=B.useState(function(){return{value:r,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var oOe=typeof window<"u"?B.useLayoutEffect:B.useEffect,i7=new WeakMap;function cQ(r,t){var s=sOe(null,function(a){return r.forEach(function(l){return qx(l,a)})});return oOe(function(){var a=i7.get(s);if(a){var l=new Set(a),d=new Set(r),g=s.current;l.forEach(function(E){d.has(E)||qx(E,null)}),d.forEach(function(E){l.has(E)||qx(E,g)})}i7.set(s,r)},[r]),s}var Yx={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Qd=function(){return Qd=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},Qd.apply(this,arguments)};function Ow(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s}function aOe(r,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return r.concat(d||Array.prototype.slice.call(t))}function lQ(r){return r}function uQ(r,t){t===void 0&&(t=lQ);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:r},useMedium:function(d){var g=t(d,a);return s.push(g),function(){s=s.filter(function(E){return E!==g})}},assignSyncMedium:function(d){for(a=!0;s.length;){var g=s;s=[],g.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var g=[];if(s.length){var E=s;s=[],E.forEach(d),g=s}var S=function(){var R=g;g=[],R.forEach(d)},b=function(){return Promise.resolve().then(S)};b(),s={push:function(R){g.push(R),b()},filter:function(R){return g=g.filter(R),s}}}};return l}function QU(r,t){return t===void 0&&(t=lQ),uQ(r,t)}function dQ(r){r===void 0&&(r={});var t=uQ(null);return t.options=Qd({async:!0,ssr:!1},r),t}var hQ=function(r){var t=r.sideCar,s=Ow(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return B.createElement(a,Qd({},s))};hQ.isSideCarExport=!0;function cOe(r,t){return r.useMedium(t),hQ}var pQ=QU({},function(r){var t=r.target,s=r.currentTarget;return{target:t,currentTarget:s}}),fQ=QU(),lOe=QU(),uOe=dQ({async:!0,ssr:typeof document<"u"}),dOe=B.createContext(void 0),hOe=[],ZU=B.forwardRef(function(t,s){var a,l=B.useState(),d=l[0],g=l[1],E=B.useRef(),S=B.useRef(!1),b=B.useRef(null),R=B.useState({}),O=R[1],N=t.children,U=t.disabled,K=U===void 0?!1:U,z=t.noFocusGuards,H=z===void 0?!1:z,ne=t.persistentFocus,J=ne===void 0?!1:ne,se=t.crossFrame,le=se===void 0?!0:se,ce=t.autoFocus,Se=ce===void 0?!0:ce;t.allowTextSelection;var Z=t.group,te=t.className,ie=t.whiteList,ae=t.hasPositiveIndices,ve=t.shards,pe=ve===void 0?hOe:ve,de=t.as,ut=de===void 0?"div":de,mt=t.lockProps,Ze=mt===void 0?{}:mt,Be=t.sideCar,Ke=t.returnFocus,nt=Ke===void 0?!1:Ke,Ee=t.focusOptions,Ye=t.onActivation,Et=t.onDeactivation,ot=B.useState({}),Ve=ot[0],et=B.useCallback(function(Sn){var Tn=Sn.captureFocusRestore;if(!b.current){var we,De=(we=document)==null?void 0:we.activeElement;b.current=De,De!==document.body&&(b.current=Tn(De))}E.current&&Ye&&Ye(E.current),S.current=!0,O()},[Ye]),gt=B.useCallback(function(){S.current=!1,Et&&Et(E.current),O()},[Et]),Dt=B.useCallback(function(Sn){var Tn=b.current;if(Tn){var we=(typeof Tn=="function"?Tn():Tn)||document.body,De=typeof nt=="function"?nt(we):nt;if(De){var We=typeof De=="object"?De:void 0;b.current=null,Sn?Promise.resolve().then(function(){return we.focus(We)}):we.focus(We)}}},[nt]),Gt=B.useCallback(function(Sn){S.current&&pQ.useMedium(Sn)},[]),Bt=fQ.useMedium,Vn=B.useCallback(function(Sn){E.current!==Sn&&(E.current=Sn,g(Sn))},[]),Dn=U_((a={},a[aQ]=K&&"disabled",a[u2]=Z,a),Ze),un=H!==!0,gr=un&&H!=="tail",Ar=cQ([s,Vn]),bt=B.useMemo(function(){return{observed:E,shards:pe,enabled:!K,active:S.current}},[K,S.current,pe,d]);return B.createElement(B.Fragment,null,un&&[B.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:K?-1:0,style:Yx}),ae?B.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:K?-1:1,style:Yx}):null],!K&&B.createElement(Be,{id:Ve,sideCar:uOe,observed:d,disabled:K,persistentFocus:J,crossFrame:le,autoFocus:Se,whiteList:ie,shards:pe,onActivation:et,onDeactivation:gt,returnFocus:Dt,focusOptions:Ee}),B.createElement(ut,U_({ref:Ar},Dn,{className:te,onBlur:Bt,onFocus:Gt}),B.createElement(dOe.Provider,{value:bt},N)),gr&&B.createElement("div",{"data-focus-guard":!0,tabIndex:K?-1:0,style:Yx}))});ZU.propTypes={};function d2(r,t){return d2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,l){return a.__proto__=l,a},d2(r,t)}function pOe(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,d2(r,t)}function ew(r){"@babel/helpers - typeof";return ew=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ew(r)}function fOe(r,t){if(ew(r)!="object"||!r)return r;var s=r[Symbol.toPrimitive];if(s!==void 0){var a=s.call(r,t);if(ew(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function mOe(r){var t=fOe(r,"string");return ew(t)=="symbol"?t:t+""}function gOe(r,t,s){return t=mOe(t),t in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function _Oe(r,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],g;function E(){g=r(d.map(function(b){return b.props})),t(g)}var S=function(b){pOe(R,b);function R(){return b.apply(this,arguments)||this}R.peek=function(){return g};var O=R.prototype;return O.componentDidMount=function(){d.push(this),E()},O.componentDidUpdate=function(){E()},O.componentWillUnmount=function(){var U=d.indexOf(this);d.splice(U,1),E()},O.render=function(){return Bi.createElement(l,this.props)},R}(B.PureComponent);return gOe(S,"displayName","SideEffect("+s(l)+")"),S}}var gh=function(r){for(var t=Array(r.length),s=0;s<r.length;++s)t[s]=r[s];return t},B_=function(r){return Array.isArray(r)?r:[r]},mQ=function(r){return Array.isArray(r)?r[0]:r},vOe=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(r,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},gQ=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},_Q=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},EOe=function(r){return r.hasAttribute("inert")},yOe=function(r,t){return!r||_Q(r)||!vOe(r)&&!EOe(r)&&t(gQ(r))},vQ=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=yOe(t,vQ.bind(void 0,r));return r.set(t,a),a},SOe=function(r,t){return r&&!_Q(r)?wOe(r)?t(gQ(r)):!1:!0},EQ=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=SOe(t,EQ.bind(void 0,r));return r.set(t,a),a},yQ=function(r){return r.dataset},TOe=function(r){return r.tagName==="BUTTON"},SQ=function(r){return r.tagName==="INPUT"},TQ=function(r){return SQ(r)&&r.type==="radio"},bOe=function(r){return!((SQ(r)||TOe(r))&&(r.type==="hidden"||r.disabled))},wOe=function(r){var t=r.getAttribute(iOe);return![!0,"true",""].includes(t)},eV=function(r){var t;return!!(r&&(!((t=yQ(r))===null||t===void 0)&&t.focusGuard))},h2=function(r){return!eV(r)},ROe=function(r){return!!r},COe=function(r,t){var s=Math.max(0,r.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=r.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},IOe=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},tV=function(r,t,s){return gh(r).map(function(a,l){var d=IOe(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(COe)},AOe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],nV=AOe.join(","),OOe="".concat(nV,", [data-focus-guard]"),bQ=function(r,t){return gh((r.shadowRoot||r).children).reduce(function(s,a){return s.concat(a.matches(t?OOe:nV)?[a]:[],bQ(a))},[])},POe=function(r,t){var s;return r instanceof HTMLIFrameElement&&(!((s=r.contentDocument)===null||s===void 0)&&s.body)?Yy([r.contentDocument.body],t):[r]},Yy=function(r,t){return r.reduce(function(s,a){var l,d=bQ(a,t),g=(l=[]).concat.apply(l,d.map(function(E){return POe(E,t)}));return s.concat(g,a.parentNode?gh(a.parentNode.querySelectorAll(nV)).filter(function(E){return E===a}):[])},[])},NOe=function(r){var t=r.querySelectorAll("[".concat(rOe,"]"));return gh(t).map(function(s){return Yy([s])}).reduce(function(s,a){return s.concat(a)},[])},rV=function(r,t){return gh(r).filter(function(s){return vQ(t,s)}).filter(function(s){return bOe(s)})},s7=function(r,t){return t===void 0&&(t=new Map),gh(r).filter(function(s){return EQ(t,s)})},iV=function(r,t,s){return tV(rV(Yy(r,s),t),!0,s)},lP=function(r,t){return tV(rV(Yy(r),t),!1)},kOe=function(r,t){return rV(NOe(r),t)},D_=function(r,t){return r.shadowRoot?D_(r.shadowRoot,t):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,t)?!0:gh(r.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?D_(l,t):!1}return D_(s,t)})},DOe=function(r){for(var t=new Set,s=r.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=r[a].compareDocumentPosition(r[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return r.filter(function(g,E){return!t.has(E)})},wQ=function(r){return r.parentNode?wQ(r.parentNode):r},sV=function(r){var t=B_(r);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(u2);return s.push.apply(s,l?DOe(gh(wQ(a).querySelectorAll("[".concat(u2,'="').concat(l,'"]:not([').concat(aQ,'="disabled"])')))):[a]),s},[])},LOe=function(r){try{return r()}catch{return}},tw=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var t=r.activeElement;return t.shadowRoot?tw(t.shadowRoot):t instanceof HTMLIFrameElement&&LOe(function(){return t.contentWindow.document})?tw(t.contentWindow.document):t}},xOe=function(r,t){return r===t},MOe=function(r,t){return!!gh(r.querySelectorAll("iframe")).some(function(s){return xOe(s,t)})},RQ=function(r,t){return t===void 0&&(t=tw(mQ(r).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:sV(r).some(function(s){return D_(s,t)||MOe(s,t)})},UOe=function(r){r===void 0&&(r=document);var t=tw(r);return t?gh(r.querySelectorAll("[".concat(nOe,"]"))).some(function(s){return D_(s,t)}):!1},VOe=function(r,t){return t.filter(TQ).filter(function(s){return s.name===r.name}).filter(function(s){return s.checked})[0]||r},oV=function(r,t){return TQ(r)&&r.name?VOe(r,t):r},FOe=function(r){var t=new Set;return r.forEach(function(s){return t.add(oV(s,r))}),r.filter(function(s){return t.has(s)})},o7=function(r){return r[0]&&r.length>1?oV(r[0],r):r[0]},a7=function(r,t){return r.indexOf(oV(t,r))},p2="NEW_FOCUS",jOe=function(r,t,s,a,l){var d=r.length,g=r[0],E=r[d-1],S=eV(a);if(!(a&&r.indexOf(a)>=0)){var b=a!==void 0?s.indexOf(a):-1,R=l?s.indexOf(l):b,O=l?r.indexOf(l):-1;if(b===-1)return O!==-1?O:p2;if(O===-1)return p2;var N=b-R,U=s.indexOf(g),K=s.indexOf(E),z=FOe(s),H=a!==void 0?z.indexOf(a):-1,ne=H-(l?z.indexOf(l):b);if(!N&&O>=0||t.length===0)return O;var J=a7(r,t[0]),se=a7(r,t[t.length-1]);if(b<=U&&S&&Math.abs(N)>1)return se;if(b>=K&&S&&Math.abs(N)>1)return J;if(N&&Math.abs(ne)>1)return O;if(b<=U)return se;if(b>K)return J;if(N)return Math.abs(N)>1?O:(d+O+N)%d}},BOe=function(r){return function(t){var s,a=(s=yQ(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||r.indexOf(t)>=0}},c7=function(r,t,s){var a=r.map(function(d){var g=d.node;return g}),l=s7(a.filter(BOe(s)));return l&&l.length?o7(l):o7(s7(t))},f2=function(r,t){return t===void 0&&(t=[]),t.push(r),r.parentNode&&f2(r.parentNode.host||r.parentNode,t),t},Xx=function(r,t){for(var s=f2(r),a=f2(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},CQ=function(r,t,s){var a=B_(r),l=B_(t),d=a[0],g=!1;return l.filter(Boolean).forEach(function(E){g=Xx(g||E,E)||g,s.filter(Boolean).forEach(function(S){var b=Xx(d,S);b&&(!g||D_(b,g)?g=b:g=Xx(b,g))})}),g},l7=function(r,t){return r.reduce(function(s,a){return s.concat(kOe(a,t))},[])},WOe=function(r,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),r.map(function(a){return s.get(a)}).filter(ROe)},GOe=function(r,t){var s=tw(B_(r).length>0?document:mQ(r).ownerDocument),a=sV(r).filter(h2),l=CQ(s||r,r,a),d=new Map,g=lP(a,d),E=g.filter(function(K){var z=K.node;return h2(z)});if(E[0]){var S=lP([l],d).map(function(K){var z=K.node;return z}),b=WOe(S,E),R=b.map(function(K){var z=K.node;return z}),O=b.filter(function(K){var z=K.tabIndex;return z>=0}).map(function(K){var z=K.node;return z}),N=jOe(R,O,S,s,t);if(N===p2){var U=c7(g,O,l7(a,d))||c7(g,R,l7(a,d));if(U)return{node:U};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:b[N]}},zOe=function(r){var t=sV(r).filter(h2),s=CQ(r,r,t),a=tV(Yy([s],!0),!0,!0),l=Yy(t,!1);return a.map(function(d){var g=d.node,E=d.index;return{node:g,index:E,lockItem:l.indexOf(g)>=0,guard:eV(g)}})},aV=function(r,t){r&&("focus"in r&&r.focus(t),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},Jx=0,Qx=!1,IQ=function(r,t,s){s===void 0&&(s={});var a=GOe(r,t);if(!Qx&&a){if(Jx>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),Qx=!0,setTimeout(function(){Qx=!1},1);return}Jx++,aV(a.node,s.focusOptions),Jx--}};function H0(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var t=r?new WeakRef(r):null;return function(){return(t==null?void 0:t.deref())||null}}var HOe=function(r){if(!r)return null;for(var t=[],s=r;s&&s!==document.body;)t.push({current:H0(s),parent:H0(s.parentElement),left:H0(s.previousElementSibling),right:H0(s.nextElementSibling)}),s=s.parentElement;return{element:H0(r),stack:t,ownerDocument:r.ownerDocument}},KOe=function(r){var t,s,a,l,d;if(r)for(var g=r.stack,E=r.ownerDocument,S=new Map,b=0,R=g;b<R.length;b++){var O=R[b],N=(t=O.parent)===null||t===void 0?void 0:t.call(O);if(N&&E.contains(N)){for(var U=(s=O.left)===null||s===void 0?void 0:s.call(O),K=O.current(),z=N.contains(K)?K:void 0,H=(a=O.right)===null||a===void 0?void 0:a.call(O),ne=iV([N],S),J=(d=(l=z??(U==null?void 0:U.nextElementSibling))!==null&&l!==void 0?l:H)!==null&&d!==void 0?d:U;J;){for(var se=0,le=ne;se<le.length;se++){var ce=le[se];if(J!=null&&J.contains(ce.node))return ce.node}J=J.nextElementSibling}if(ne.length)return ne[0].node}}},$Oe=function(r){var t=HOe(r);return function(){return KOe(t)}},qOe=function(r,t,s){if(!r||!t)return console.error("no element or scope given"),{};var a=B_(t);if(a.every(function(g){return!D_(g,r)}))return console.error("Active element is not contained in the scope"),{};var l=s?iV(a,new Map):lP(a,new Map),d=l.findIndex(function(g){var E=g.node;return E===r});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},YOe=function(r,t){var s=t?iV(B_(r),new Map):lP(B_(r),new Map);return{first:s[0],last:s[s.length-1]}},XOe=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},AQ=function(r,t,s){t===void 0&&(t={});var a=XOe(t),l=qOe(r,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&aV(d.node,a.focusOptions)}},JOe=function(r,t){t===void 0&&(t={}),AQ(r,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},QOe=function(r,t){t===void 0&&(t={}),AQ(r,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},OQ=function(r,t,s){var a,l=YOe(r,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&aV(d.node,t.focusOptions)},ZOe=function(r,t){t===void 0&&(t={}),OQ(r,t,"first")},ePe=function(r,t){t===void 0&&(t={}),OQ(r,t,"last")};function cV(r){setTimeout(r,1)}var tPe=function(t){return t&&"current"in t?t.current:t},nPe=function(){return document&&document.activeElement===document.body},rPe=function(){return nPe()||UOe()},Vy=null,Ay=null,Fy=null,nw=!1,iPe=function(){return!0},sPe=function(t){return(Vy.whiteList||iPe)(t)},oPe=function(t,s){Fy={observerNode:t,portaledElement:s}},aPe=function(t){return Fy&&Fy.portaledElement===t};function u7(r,t,s,a){var l=null,d=r;do{var g=a[d];if(g.guard)g.node.dataset.focusAutoGuard&&(l=g);else if(g.lockItem){if(d!==r)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var cPe=function(t){return t?!!nw:nw==="meanwhile"},lPe=function r(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&r(t,s.parentNode,a))},uPe=function(t,s){return s.some(function(a){return lPe(t,a,a)})},uP=function(){var t=!1;if(Vy){var s=Vy,a=s.observed,l=s.persistentFocus,d=s.autoFocus,g=s.shards,E=s.crossFrame,S=s.focusOptions,b=a||Fy&&Fy.portaledElement,R=document&&document.activeElement;if(b){var O=[b].concat(g.map(tPe).filter(Boolean));if((!R||sPe(R))&&(l||cPe(E)||!rPe()||!Ay&&d)&&(b&&!(RQ(O)||R&&uPe(R,O)||aPe(R))&&(document&&!Ay&&R&&!d?(R.blur&&R.blur(),document.body.focus()):(t=IQ(O,Ay,{focusOptions:S}),Fy={})),nw=!1,Ay=document&&document.activeElement),document&&R!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var N=document&&document.activeElement,U=zOe(O),K=U.map(function(z){var H=z.node;return H}).indexOf(N);K>-1&&(U.filter(function(z){var H=z.guard,ne=z.node;return H&&ne.dataset.focusAutoGuard}).forEach(function(z){var H=z.node;return H.removeAttribute("tabIndex")}),u7(K,U.length,1,U),u7(K,-1,-1,U))}}}return t},PQ=function(t){uP()&&t&&(t.stopPropagation(),t.preventDefault())},lV=function(){return cV(uP)},dPe=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||oPe(a,s)},hPe=function(){return null},NQ=function(){nw="just",cV(function(){nw="meanwhile"})},pPe=function(){document.addEventListener("focusin",PQ),document.addEventListener("focusout",lV),window.addEventListener("blur",NQ)},fPe=function(){document.removeEventListener("focusin",PQ),document.removeEventListener("focusout",lV),window.removeEventListener("blur",NQ)};function mPe(r){return r.filter(function(t){var s=t.disabled;return!s})}var kQ={moveFocusInside:IQ,focusInside:RQ,focusNextElement:JOe,focusPrevElement:QOe,focusFirstElement:ZOe,focusLastElement:ePe,captureFocusRestore:$Oe};function gPe(r){var t=r.slice(-1)[0];t&&!Vy&&pPe();var s=Vy,a=s&&t&&t.id===s.id;Vy=t,s&&!a&&(s.onDeactivation(),r.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(Ay=null,(!a||s.observed!==t.observed)&&t.onActivation(kQ),uP(),cV(uP)):(fPe(),Ay=null)}pQ.assignSyncMedium(dPe);fQ.assignMedium(lV);lOe.assignMedium(function(r){return r(kQ)});const _Pe=_Oe(mPe,gPe)(hPe);var m2=B.forwardRef(function(t,s){return B.createElement(ZU,U_({sideCar:_Pe,ref:s},t))}),DQ=ZU.propTypes||{};DQ.sideCar;JAe(DQ,["sideCar"]);m2.propTypes={};function LQ(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}function uV(r){var t;if(!LQ(r))return!1;const s=(t=r.ownerDocument.defaultView)!=null?t:window;return r instanceof s.HTMLElement}function vPe(r){var t,s;return(s=(t=xQ(r))==null?void 0:t.defaultView)!=null?s:window}function xQ(r){return LQ(r)?r.ownerDocument:document}function EPe(r){return xQ(r).activeElement}function yPe(r){const t=r.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(r);return/auto|scroll|overlay|hidden/.test(s+l+a)}function SPe(r){return r.localName==="html"?r:r.assignedSlot||r.parentElement||r.ownerDocument.documentElement}function MQ(r){return["html","body","#document"].includes(r.localName)?r.ownerDocument.body:uV(r)&&yPe(r)?r:MQ(SPe(r))}var UQ=r=>r.hasAttribute("tabindex"),TPe=r=>UQ(r)&&r.tabIndex===-1;function bPe(r){return!!r.getAttribute("disabled")||!!r.getAttribute("aria-disabled")}function VQ(r){return r.parentElement&&VQ(r.parentElement)?!0:r.hidden}function wPe(r){const t=r.getAttribute("contenteditable");return t!=="false"&&t!=null}function FQ(r){if(!uV(r)||VQ(r)||bPe(r))return!1;const{localName:t}=r;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>r.hasAttribute("href"),audio:()=>r.hasAttribute("controls"),video:()=>r.hasAttribute("controls")};return t in a?a[t]():wPe(r)?!0:UQ(r)}function RPe(r){return r?uV(r)&&FQ(r)&&!TPe(r):!1}var CPe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],IPe=CPe.join(),APe=r=>r.offsetWidth>0&&r.offsetHeight>0;function jQ(r){const t=Array.from(r.querySelectorAll(IPe));return t.unshift(r),t.filter(s=>FQ(s)&&APe(s))}var d7,OPe=(d7=m2.default)!=null?d7:m2,BQ=r=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:g,autoFocus:E,persistentFocus:S,lockFocusAcrossFrames:b}=r,R=B.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&jQ(a.current).length===0&&requestAnimationFrame(()=>{var K;(K=a.current)==null||K.focus()})},[t,a]),O=B.useCallback(()=>{var U;(U=s==null?void 0:s.current)==null||U.focus()},[s]),N=l&&!s;return F.jsx(OPe,{crossFrame:b,persistentFocus:S,autoFocus:E,disabled:g,onActivation:R,onDeactivation:O,returnFocus:N,children:d})};BQ.displayName="FocusLock";var PPe=I0e?B.useLayoutEffect:B.useEffect;function h7(r,t=[]){const s=B.useRef(r);return PPe(()=>{s.current=r}),B.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function NPe(r,t){const s=B.useId();return B.useMemo(()=>r||[t,s].filter(Boolean).join("-"),[r,t,s])}function kPe(r,t){const s=r!==void 0;return[s,s&&typeof r<"u"?r:t]}function DPe(r={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=r,d=h7(s),g=h7(t),[E,S]=B.useState(r.defaultIsOpen||!1),[b,R]=kPe(a,E),O=NPe(l,"disclosure"),N=B.useCallback(()=>{b||S(!1),g==null||g()},[b,g]),U=B.useCallback(()=>{b||S(!0),d==null||d()},[b,d]),K=B.useCallback(()=>{(R?N:U)()},[R,U,N]);return{isOpen:!!R,onOpen:U,onClose:N,onToggle:K,isControlled:b,getButtonProps:(z={})=>({...z,"aria-expanded":R,"aria-controls":O,onClick:k0e(z.onClick,K)}),getDisclosureProps:(z={})=>({...z,hidden:!R,id:O})}}var[LPe,xPe]=Gi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),g2=qt(function(t,s){const a=Pc("Input",t),{children:l,className:d,...g}=es(t),E=Un("chakra-input__group",d),S={},b=XU(l),R=a.field;b.forEach(N=>{var U,K;a&&(R&&N.type.id==="InputLeftElement"&&(S.paddingStart=(U=R.height)!=null?U:R.h),R&&N.type.id==="InputRightElement"&&(S.paddingEnd=(K=R.height)!=null?K:R.h),N.type.id==="InputRightAddon"&&(S.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(S.borderStartRadius=0))});const O=b.map(N=>{var U,K;const z=gX({size:((U=N.props)==null?void 0:U.size)||t.size,variant:((K=N.props)==null?void 0:K.variant)||t.variant});return N.type.id!=="Input"?B.cloneElement(N,z):B.cloneElement(N,Object.assign(z,S,N.props))});return F.jsx(Nt.div,{className:E,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...g,children:F.jsx(LPe,{value:a,children:O})})});g2.displayName="InputGroup";var MPe=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),ZP=qt(function(t,s){var a,l;const{placement:d="left",...g}=t,E=xPe(),S=E.field,R={[d==="left"?"insetStart":"insetEnd"]:"0",width:(a=S==null?void 0:S.height)!=null?a:S==null?void 0:S.h,height:(l=S==null?void 0:S.height)!=null?l:S==null?void 0:S.h,fontSize:S==null?void 0:S.fontSize,...E.element};return F.jsx(MPe,{ref:s,__css:R,...g})});ZP.id="InputElement";ZP.displayName="InputElement";var dP=qt(function(t,s){const{className:a,...l}=t,d=Un("chakra-input__left-element",a);return F.jsx(ZP,{ref:s,placement:"left",className:d,...l})});dP.id="InputLeftElement";dP.displayName="InputLeftElement";var WQ=qt(function(t,s){const{className:a,...l}=t,d=Un("chakra-input__right-element",a);return F.jsx(ZP,{ref:s,placement:"right",className:d,...l})});WQ.id="InputRightElement";WQ.displayName="InputRightElement";var Yl=qt(function(t,s){const{htmlSize:a,...l}=t,d=Pc("Input",l),g=es(l),E=iQ(g),S=Un("chakra-input",t.className);return F.jsx(Nt.input,{size:a,...E,__css:d.field,ref:s,className:S})});Yl.displayName="Input";Yl.id="Input";var hh=qt(function(t,s){const a=Qu("Link",t),{className:l,isExternal:d,...g}=es(t);return F.jsx(Nt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:Un("chakra-link",l),...g,__css:a})});hh.displayName="Link";var GQ=qt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:g,column:E,row:S,autoFlow:b,autoRows:R,templateRows:O,autoColumns:N,templateColumns:U,...K}=t,z={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:g,gridAutoColumns:N,gridColumn:E,gridRow:S,gridAutoFlow:b,gridAutoRows:R,gridTemplateRows:O,gridTemplateColumns:U};return F.jsx(Nt.div,{ref:s,__css:z,...K})});GQ.displayName="Grid";function dV(r,t){return Array.isArray(r)?r.map(s=>s===null?null:t(s)):Yu(r)?Object.keys(r).reduce((s,a)=>(s[a]=t(r[a]),s),{}):r!=null?t(r):null}var zQ=qt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:g,minChildWidth:E,...S}=t,b=dS(),R=E?VPe(E,b):FPe(a);return F.jsx(GQ,{ref:s,gap:g,columnGap:l,rowGap:d,templateColumns:R,...S})});zQ.displayName="SimpleGrid";function UPe(r){return typeof r=="number"?`${r}px`:r}function VPe(r,t){return dV(r,s=>{const a=Vme("sizes",s,UPe(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function FPe(r){return dV(r,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}var HQ=Nt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});HQ.displayName="Spacer";var ir=qt(function(t,s){const a=Qu("Text",t),{className:l,align:d,decoration:g,casing:E,...S}=es(t),b=gX({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return F.jsx(Nt.p,{ref:s,className:Un("chakra-text",t.className),...b,...S,__css:a})});ir.displayName="Text";var KQ=r=>F.jsx(Nt.div,{className:"chakra-stack__item",...r,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...r.__css}});KQ.displayName="StackItem";function jPe(r){const{spacing:t,direction:s}=r,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":dV(s,l=>a[l])}}var hV=qt((r,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:g="0.5rem",wrap:E,children:S,divider:b,className:R,shouldWrapChildren:O,...N}=r,U=s?"row":a??"column",K=B.useMemo(()=>jPe({spacing:g,direction:U}),[g,U]),z=!!b,H=!O&&!z,ne=B.useMemo(()=>{const se=XU(S);return H?se:se.map((le,ce)=>{const Se=typeof le.key<"u"?le.key:ce,Z=ce+1===se.length,ie=O?F.jsx(KQ,{children:le},Se):le;if(!z)return ie;const ae=B.cloneElement(b,{__css:K}),ve=Z?null:ae;return F.jsxs(B.Fragment,{children:[ie,ve]},Se)})},[b,K,z,H,O,S]),J=Un("chakra-stack",R);return F.jsx(Nt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:U,flexWrap:E,gap:z?void 0:g,className:J,...N,children:ne})});hV.displayName="Stack";var Wa=qt((r,t)=>F.jsx(hV,{align:"center",...r,direction:"column",ref:t}));Wa.displayName="VStack";var Xy=qt((r,t)=>F.jsx(hV,{align:"center",...r,direction:"row",ref:t}));Xy.displayName="HStack";var pV=qt(function(t,s){const a=Qu("Heading",t),{className:l,...d}=es(t);return F.jsx(Nt.h2,{ref:s,className:Un("chakra-heading",t.className),...d,__css:a})});pV.displayName="Heading";var Nn=Nt("div");Nn.displayName="Box";var $Q=qt(function(t,s){const{size:a,centerContent:l=!0,...d}=t,g=l?{display:"flex",alignItems:"center",justifyContent:"center"}:{};return F.jsx(Nn,{ref:s,boxSize:a,__css:{...g,flexShrink:0,flexGrow:0},...d})});$Q.displayName="Square";var BPe=qt(function(t,s){const{size:a,...l}=t;return F.jsx($Q,{size:a,ref:s,borderRadius:"9999px",...l})});BPe.displayName="Circle";var qQ=qt(function(t,s){const a=Qu("Badge",t),{className:l,...d}=es(t);return F.jsx(Nt.span,{ref:s,className:Un("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});qQ.displayName="Badge";var YQ=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});YQ.displayName="Center";var WPe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};qt(function(t,s){const{axis:a="both",...l}=t;return F.jsx(Nt.div,{ref:s,__css:WPe[a],...l,position:"absolute"})});var fV=qt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:g,borderWidth:E,borderStyle:S,borderColor:b,...R}=Qu("Divider",t),{className:O,orientation:N="horizontal",__css:U,...K}=es(t),z={vertical:{borderLeftWidth:a||g||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return F.jsx(Nt.hr,{ref:s,"aria-orientation":N,...K,__css:{...R,border:"0",borderColor:b,borderStyle:S,...z[N],...U},className:Un("chakra-divider",O)})});fV.displayName="Divider";var hP=qt(function(t,s){const{direction:a,align:l,justify:d,wrap:g,basis:E,grow:S,shrink:b,...R}=t,O={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:g,flexBasis:E,flexGrow:S,flexShrink:b};return F.jsx(Nt.div,{ref:s,__css:O,...R})});hP.displayName="Flex";function GPe(r){const{key:t}=r;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function zPe(r={}){const{timeout:t=300,preventDefault:s=()=>!0}=r,[a,l]=B.useState([]),d=B.useRef(),g=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{g(),d.current=setTimeout(()=>{l([]),d.current=null},t)};B.useEffect(()=>g,[]);function S(b){return R=>{if(R.key==="Backspace"){const O=[...a];O.pop(),l(O);return}if(GPe(R)){const O=a.concat(R.key);s(R)&&(R.preventDefault(),R.stopPropagation()),l(O),b(O.join("")),E()}}}return S}function HPe(r,t,s,a){if(t==null)return a;if(!a)return r.find(g=>s(g).toLowerCase().startsWith(t.toLowerCase()));const l=r.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=r.indexOf(l[0]),r[d])}return a}function KPe(){const r=B.useRef(new Map),t=r.current,s=B.useCallback((l,d,g,E)=>{r.current.set(g,{type:d,el:l,options:E}),l.addEventListener(d,g,E)},[]),a=B.useCallback((l,d,g,E)=>{l.removeEventListener(d,g,E),r.current.delete(g)},[]);return B.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function Zx(r){const t=r.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function $Pe(r={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:g,onMouseUp:E,onClick:S,onKeyDown:b,onKeyUp:R,tabIndex:O,onMouseOver:N,onMouseLeave:U,...K}=r,[z,H]=B.useState(!0),[ne,J]=B.useState(!1),se=KPe(),le=Be=>{Be&&Be.tagName!=="BUTTON"&&H(!1)},ce=z?O:O||0,Se=s&&!a,Z=B.useCallback(Be=>{if(s){Be.stopPropagation(),Be.preventDefault();return}Be.currentTarget.focus(),S==null||S(Be)},[s,S]),te=B.useCallback(Be=>{ne&&Zx(Be)&&(Be.preventDefault(),Be.stopPropagation(),J(!1),se.remove(document,"keyup",te,!1))},[ne,se]),ie=B.useCallback(Be=>{if(b==null||b(Be),s||Be.defaultPrevented||Be.metaKey||!Zx(Be.nativeEvent)||z)return;const Ke=l&&Be.key==="Enter";d&&Be.key===" "&&(Be.preventDefault(),J(!0)),Ke&&(Be.preventDefault(),Be.currentTarget.click()),se.add(document,"keyup",te,!1)},[s,z,b,l,d,se,te]),ae=B.useCallback(Be=>{if(R==null||R(Be),s||Be.defaultPrevented||Be.metaKey||!Zx(Be.nativeEvent)||z)return;d&&Be.key===" "&&(Be.preventDefault(),J(!1),Be.currentTarget.click())},[d,z,s,R]),ve=B.useCallback(Be=>{Be.button===0&&(J(!1),se.remove(document,"mouseup",ve,!1))},[se]),pe=B.useCallback(Be=>{if(Be.button!==0)return;if(s){Be.stopPropagation(),Be.preventDefault();return}z||J(!0),Be.currentTarget.focus({preventScroll:!0}),se.add(document,"mouseup",ve,!1),g==null||g(Be)},[s,z,g,se,ve]),de=B.useCallback(Be=>{Be.button===0&&(z||J(!1),E==null||E(Be))},[E,z]),ut=B.useCallback(Be=>{if(s){Be.preventDefault();return}N==null||N(Be)},[s,N]),mt=B.useCallback(Be=>{ne&&(Be.preventDefault(),J(!1)),U==null||U(Be)},[ne,U]),Ze=Qi(t,le);return z?{...K,ref:Ze,type:"button","aria-disabled":Se?void 0:s,disabled:Se,onClick:Z,onMouseDown:g,onMouseUp:E,onKeyUp:R,onKeyDown:b,onMouseOver:N,onMouseLeave:U}:{...K,ref:Ze,role:"button","data-active":cr(ne),"aria-disabled":s?"true":void 0,tabIndex:Se?void 0:ce,onClick:Z,onMouseDown:pe,onMouseUp:de,onKeyUp:ae,onKeyDown:ie,onMouseOver:ut,onMouseLeave:mt}}function qPe(r){const t=r.current;if(!t)return!1;const s=EPe(t);return!s||t.contains(s)?!1:!!RPe(s)}function XQ(r,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;V_(()=>{if(!d||qPe(r))return;const g=(l==null?void 0:l.current)||r.current;let E;if(g)return E=requestAnimationFrame(()=>{g.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,r,l])}var YPe={preventScroll:!0,shouldFocus:!1};function XPe(r,t=YPe){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,g=JPe(r)?r.current:r,E=l&&d,S=B.useRef(E),b=B.useRef(d);Rp(()=>{!b.current&&d&&(S.current=E),b.current=d},[d,E]);const R=B.useCallback(()=>{if(!(!d||!g||!S.current)&&(S.current=!1,!g.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var O;(O=s.current)==null||O.focus({preventScroll:a})});else{const O=jQ(g);O.length>0&&requestAnimationFrame(()=>{O[0].focus({preventScroll:a})})}},[d,a,g,s]);V_(()=>{R()},[R]),Uy(g,"transitionend",R)}function JPe(r){return"current"in r}var oy=(r,t)=>({var:r,varRef:t?`var(${r}, ${t})`:`var(${r})`}),xs={arrowShadowColor:oy("--popper-arrow-shadow-color"),arrowSize:oy("--popper-arrow-size","8px"),arrowSizeHalf:oy("--popper-arrow-size-half"),arrowBg:oy("--popper-arrow-bg"),transformOrigin:oy("--popper-transform-origin"),arrowOffset:oy("--popper-arrow-offset")};function QPe(r){if(r.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}var ZPe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},eNe=r=>ZPe[r],p7={scroll:!0,resize:!0};function tNe(r){let t;return typeof r=="object"?t={enabled:!0,options:{...p7,...r}}:t={enabled:r,options:p7},t}var nNe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:r})=>{r.styles.popper.width=`${r.rects.reference.width}px`},effect:({state:r})=>()=>{const t=r.elements.reference;r.elements.popper.style.width=`${t.offsetWidth}px`}},rNe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:r})=>{f7(r)},effect:({state:r})=>()=>{f7(r)}},f7=r=>{r.elements.popper.style.setProperty(xs.transformOrigin.var,eNe(r.placement))},iNe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:r})=>{sNe(r)}},sNe=r=>{var t;if(!r.placement)return;const s=oNe(r.placement);if((t=r.elements)!=null&&t.arrow&&s){Object.assign(r.elements.arrow.style,{[s.property]:s.value,width:xs.arrowSize.varRef,height:xs.arrowSize.varRef,zIndex:-1});const a={[xs.arrowSizeHalf.var]:`calc(${xs.arrowSize.varRef} / 2 - 1px)`,[xs.arrowOffset.var]:`calc(${xs.arrowSizeHalf.varRef} * -1)`};for(const l in a)r.elements.arrow.style.setProperty(l,a[l])}},oNe=r=>{if(r.startsWith("top"))return{property:"bottom",value:xs.arrowOffset.varRef};if(r.startsWith("bottom"))return{property:"top",value:xs.arrowOffset.varRef};if(r.startsWith("left"))return{property:"right",value:xs.arrowOffset.varRef};if(r.startsWith("right"))return{property:"left",value:xs.arrowOffset.varRef}},aNe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:r})=>{m7(r)},effect:({state:r})=>()=>{m7(r)}},m7=r=>{if(!r.elements.arrow)return;const t=r.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=QPe(r.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:xs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},cNe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},lNe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function uNe(r,t="ltr"){var s,a;const l=((s=cNe[r])==null?void 0:s[t])||r;return t==="ltr"?l:(a=lNe[r])!=null?a:l}var Cc="top",Zl="bottom",eu="right",Ic="left",mV="auto",Pw=[Cc,Zl,eu,Ic],Jy="start",rw="end",dNe="clippingParents",JQ="viewport",K0="popper",hNe="reference",g7=Pw.reduce(function(r,t){return r.concat([t+"-"+Jy,t+"-"+rw])},[]),QQ=[].concat(Pw,[mV]).reduce(function(r,t){return r.concat([t,t+"-"+Jy,t+"-"+rw])},[]),pNe="beforeRead",fNe="read",mNe="afterRead",gNe="beforeMain",_Ne="main",vNe="afterMain",ENe="beforeWrite",yNe="write",SNe="afterWrite",TNe=[pNe,fNe,mNe,gNe,_Ne,vNe,ENe,yNe,SNe];function ph(r){return r?(r.nodeName||"").toLowerCase():null}function dl(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var t=r.ownerDocument;return t&&t.defaultView||window}return r}function W_(r){var t=dl(r).Element;return r instanceof t||r instanceof Element}function Jl(r){var t=dl(r).HTMLElement;return r instanceof t||r instanceof HTMLElement}function gV(r){if(typeof ShadowRoot>"u")return!1;var t=dl(r).ShadowRoot;return r instanceof t||r instanceof ShadowRoot}function bNe(r){var t=r.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!Jl(d)||!ph(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(g){var E=l[g];E===!1?d.removeAttribute(g):d.setAttribute(g,E===!0?"":E)}))})}function wNe(r){var t=r.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},g=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),E=g.reduce(function(S,b){return S[b]="",S},{});!Jl(l)||!ph(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(S){l.removeAttribute(S)}))})}}const RNe={name:"applyStyles",enabled:!0,phase:"write",fn:bNe,effect:wNe,requires:["computeStyles"]};function sh(r){return r.split("-")[0]}var L_=Math.max,pP=Math.min,Qy=Math.round;function _2(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function ZQ(){return!/^((?!chrome|android).)*safari/i.test(_2())}function Zy(r,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=r.getBoundingClientRect(),l=1,d=1;t&&Jl(r)&&(l=r.offsetWidth>0&&Qy(a.width)/r.offsetWidth||1,d=r.offsetHeight>0&&Qy(a.height)/r.offsetHeight||1);var g=W_(r)?dl(r):window,E=g.visualViewport,S=!ZQ()&&s,b=(a.left+(S&&E?E.offsetLeft:0))/l,R=(a.top+(S&&E?E.offsetTop:0))/d,O=a.width/l,N=a.height/d;return{width:O,height:N,top:R,right:b+O,bottom:R+N,left:b,x:b,y:R}}function _V(r){var t=Zy(r),s=r.offsetWidth,a=r.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:r.offsetLeft,y:r.offsetTop,width:s,height:a}}function eZ(r,t){var s=t.getRootNode&&t.getRootNode();if(r.contains(t))return!0;if(s&&gV(s)){var a=t;do{if(a&&r.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Dp(r){return dl(r).getComputedStyle(r)}function CNe(r){return["table","td","th"].indexOf(ph(r))>=0}function Pm(r){return((W_(r)?r.ownerDocument:r.document)||window.document).documentElement}function eN(r){return ph(r)==="html"?r:r.assignedSlot||r.parentNode||(gV(r)?r.host:null)||Pm(r)}function _7(r){return!Jl(r)||Dp(r).position==="fixed"?null:r.offsetParent}function INe(r){var t=/firefox/i.test(_2()),s=/Trident/i.test(_2());if(s&&Jl(r)){var a=Dp(r);if(a.position==="fixed")return null}var l=eN(r);for(gV(l)&&(l=l.host);Jl(l)&&["html","body"].indexOf(ph(l))<0;){var d=Dp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function Nw(r){for(var t=dl(r),s=_7(r);s&&CNe(s)&&Dp(s).position==="static";)s=_7(s);return s&&(ph(s)==="html"||ph(s)==="body"&&Dp(s).position==="static")?t:s||INe(r)||t}function vV(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Nb(r,t,s){return L_(r,pP(t,s))}function ANe(r,t,s){var a=Nb(r,t,s);return a>s?s:a}function tZ(){return{top:0,right:0,bottom:0,left:0}}function nZ(r){return Object.assign({},tZ(),r)}function rZ(r,t){return t.reduce(function(s,a){return s[a]=r,s},{})}var ONe=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,nZ(typeof t!="number"?t:rZ(t,Pw))};function PNe(r){var t,s=r.state,a=r.name,l=r.options,d=s.elements.arrow,g=s.modifiersData.popperOffsets,E=sh(s.placement),S=vV(E),b=[Ic,eu].indexOf(E)>=0,R=b?"height":"width";if(!(!d||!g)){var O=ONe(l.padding,s),N=_V(d),U=S==="y"?Cc:Ic,K=S==="y"?Zl:eu,z=s.rects.reference[R]+s.rects.reference[S]-g[S]-s.rects.popper[R],H=g[S]-s.rects.reference[S],ne=Nw(d),J=ne?S==="y"?ne.clientHeight||0:ne.clientWidth||0:0,se=z/2-H/2,le=O[U],ce=J-N[R]-O[K],Se=J/2-N[R]/2+se,Z=Nb(le,Se,ce),te=S;s.modifiersData[a]=(t={},t[te]=Z,t.centerOffset=Z-Se,t)}}function NNe(r){var t=r.state,s=r.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||eZ(t.elements.popper,l)&&(t.elements.arrow=l))}const kNe={name:"arrow",enabled:!0,phase:"main",fn:PNe,effect:NNe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function eS(r){return r.split("-")[1]}var DNe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function LNe(r,t){var s=r.x,a=r.y,l=t.devicePixelRatio||1;return{x:Qy(s*l)/l||0,y:Qy(a*l)/l||0}}function v7(r){var t,s=r.popper,a=r.popperRect,l=r.placement,d=r.variation,g=r.offsets,E=r.position,S=r.gpuAcceleration,b=r.adaptive,R=r.roundOffsets,O=r.isFixed,N=g.x,U=N===void 0?0:N,K=g.y,z=K===void 0?0:K,H=typeof R=="function"?R({x:U,y:z}):{x:U,y:z};U=H.x,z=H.y;var ne=g.hasOwnProperty("x"),J=g.hasOwnProperty("y"),se=Ic,le=Cc,ce=window;if(b){var Se=Nw(s),Z="clientHeight",te="clientWidth";if(Se===dl(s)&&(Se=Pm(s),Dp(Se).position!=="static"&&E==="absolute"&&(Z="scrollHeight",te="scrollWidth")),Se=Se,l===Cc||(l===Ic||l===eu)&&d===rw){le=Zl;var ie=O&&Se===ce&&ce.visualViewport?ce.visualViewport.height:Se[Z];z-=ie-a.height,z*=S?1:-1}if(l===Ic||(l===Cc||l===Zl)&&d===rw){se=eu;var ae=O&&Se===ce&&ce.visualViewport?ce.visualViewport.width:Se[te];U-=ae-a.width,U*=S?1:-1}}var ve=Object.assign({position:E},b&&DNe),pe=R===!0?LNe({x:U,y:z},dl(s)):{x:U,y:z};if(U=pe.x,z=pe.y,S){var de;return Object.assign({},ve,(de={},de[le]=J?"0":"",de[se]=ne?"0":"",de.transform=(ce.devicePixelRatio||1)<=1?"translate("+U+"px, "+z+"px)":"translate3d("+U+"px, "+z+"px, 0)",de))}return Object.assign({},ve,(t={},t[le]=J?z+"px":"",t[se]=ne?U+"px":"",t.transform="",t))}function xNe(r){var t=r.state,s=r.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,g=d===void 0?!0:d,E=s.roundOffsets,S=E===void 0?!0:E,b={placement:sh(t.placement),variation:eS(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,v7(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:g,roundOffsets:S})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,v7(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:S})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const MNe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:xNe,data:{}};var eO={passive:!0};function UNe(r){var t=r.state,s=r.instance,a=r.options,l=a.scroll,d=l===void 0?!0:l,g=a.resize,E=g===void 0?!0:g,S=dl(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(R){R.addEventListener("scroll",s.update,eO)}),E&&S.addEventListener("resize",s.update,eO),function(){d&&b.forEach(function(R){R.removeEventListener("scroll",s.update,eO)}),E&&S.removeEventListener("resize",s.update,eO)}}const VNe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:UNe,data:{}};var FNe={left:"right",right:"left",bottom:"top",top:"bottom"};function kO(r){return r.replace(/left|right|bottom|top/g,function(t){return FNe[t]})}var jNe={start:"end",end:"start"};function E7(r){return r.replace(/start|end/g,function(t){return jNe[t]})}function EV(r){var t=dl(r),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function yV(r){return Zy(Pm(r)).left+EV(r).scrollLeft}function BNe(r,t){var s=dl(r),a=Pm(r),l=s.visualViewport,d=a.clientWidth,g=a.clientHeight,E=0,S=0;if(l){d=l.width,g=l.height;var b=ZQ();(b||!b&&t==="fixed")&&(E=l.offsetLeft,S=l.offsetTop)}return{width:d,height:g,x:E+yV(r),y:S}}function WNe(r){var t,s=Pm(r),a=EV(r),l=(t=r.ownerDocument)==null?void 0:t.body,d=L_(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),g=L_(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+yV(r),S=-a.scrollTop;return Dp(l||s).direction==="rtl"&&(E+=L_(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:g,x:E,y:S}}function SV(r){var t=Dp(r),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function iZ(r){return["html","body","#document"].indexOf(ph(r))>=0?r.ownerDocument.body:Jl(r)&&SV(r)?r:iZ(eN(r))}function kb(r,t){var s;t===void 0&&(t=[]);var a=iZ(r),l=a===((s=r.ownerDocument)==null?void 0:s.body),d=dl(a),g=l?[d].concat(d.visualViewport||[],SV(a)?a:[]):a,E=t.concat(g);return l?E:E.concat(kb(eN(g)))}function v2(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function GNe(r,t){var s=Zy(r,!1,t==="fixed");return s.top=s.top+r.clientTop,s.left=s.left+r.clientLeft,s.bottom=s.top+r.clientHeight,s.right=s.left+r.clientWidth,s.width=r.clientWidth,s.height=r.clientHeight,s.x=s.left,s.y=s.top,s}function y7(r,t,s){return t===JQ?v2(BNe(r,s)):W_(t)?GNe(t,s):v2(WNe(Pm(r)))}function zNe(r){var t=kb(eN(r)),s=["absolute","fixed"].indexOf(Dp(r).position)>=0,a=s&&Jl(r)?Nw(r):r;return W_(a)?t.filter(function(l){return W_(l)&&eZ(l,a)&&ph(l)!=="body"}):[]}function HNe(r,t,s,a){var l=t==="clippingParents"?zNe(r):[].concat(t),d=[].concat(l,[s]),g=d[0],E=d.reduce(function(S,b){var R=y7(r,b,a);return S.top=L_(R.top,S.top),S.right=pP(R.right,S.right),S.bottom=pP(R.bottom,S.bottom),S.left=L_(R.left,S.left),S},y7(r,g,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function sZ(r){var t=r.reference,s=r.element,a=r.placement,l=a?sh(a):null,d=a?eS(a):null,g=t.x+t.width/2-s.width/2,E=t.y+t.height/2-s.height/2,S;switch(l){case Cc:S={x:g,y:t.y-s.height};break;case Zl:S={x:g,y:t.y+t.height};break;case eu:S={x:t.x+t.width,y:E};break;case Ic:S={x:t.x-s.width,y:E};break;default:S={x:t.x,y:t.y}}var b=l?vV(l):null;if(b!=null){var R=b==="y"?"height":"width";switch(d){case Jy:S[b]=S[b]-(t[R]/2-s[R]/2);break;case rw:S[b]=S[b]+(t[R]/2-s[R]/2);break}}return S}function iw(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?r.placement:a,d=s.strategy,g=d===void 0?r.strategy:d,E=s.boundary,S=E===void 0?dNe:E,b=s.rootBoundary,R=b===void 0?JQ:b,O=s.elementContext,N=O===void 0?K0:O,U=s.altBoundary,K=U===void 0?!1:U,z=s.padding,H=z===void 0?0:z,ne=nZ(typeof H!="number"?H:rZ(H,Pw)),J=N===K0?hNe:K0,se=r.rects.popper,le=r.elements[K?J:N],ce=HNe(W_(le)?le:le.contextElement||Pm(r.elements.popper),S,R,g),Se=Zy(r.elements.reference),Z=sZ({reference:Se,element:se,placement:l}),te=v2(Object.assign({},se,Z)),ie=N===K0?te:Se,ae={top:ce.top-ie.top+ne.top,bottom:ie.bottom-ce.bottom+ne.bottom,left:ce.left-ie.left+ne.left,right:ie.right-ce.right+ne.right},ve=r.modifiersData.offset;if(N===K0&&ve){var pe=ve[l];Object.keys(ae).forEach(function(de){var ut=[eu,Zl].indexOf(de)>=0?1:-1,mt=[Cc,Zl].indexOf(de)>=0?"y":"x";ae[de]+=pe[mt]*ut})}return ae}function KNe(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,g=s.padding,E=s.flipVariations,S=s.allowedAutoPlacements,b=S===void 0?QQ:S,R=eS(a),O=R?E?g7:g7.filter(function(K){return eS(K)===R}):Pw,N=O.filter(function(K){return b.indexOf(K)>=0});N.length===0&&(N=O);var U=N.reduce(function(K,z){return K[z]=iw(r,{placement:z,boundary:l,rootBoundary:d,padding:g})[sh(z)],K},{});return Object.keys(U).sort(function(K,z){return U[K]-U[z]})}function $Ne(r){if(sh(r)===mV)return[];var t=kO(r);return[E7(r),t,E7(t)]}function qNe(r){var t=r.state,s=r.options,a=r.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,g=s.altAxis,E=g===void 0?!0:g,S=s.fallbackPlacements,b=s.padding,R=s.boundary,O=s.rootBoundary,N=s.altBoundary,U=s.flipVariations,K=U===void 0?!0:U,z=s.allowedAutoPlacements,H=t.options.placement,ne=sh(H),J=ne===H,se=S||(J||!K?[kO(H)]:$Ne(H)),le=[H].concat(se).reduce(function(Ve,et){return Ve.concat(sh(et)===mV?KNe(t,{placement:et,boundary:R,rootBoundary:O,padding:b,flipVariations:K,allowedAutoPlacements:z}):et)},[]),ce=t.rects.reference,Se=t.rects.popper,Z=new Map,te=!0,ie=le[0],ae=0;ae<le.length;ae++){var ve=le[ae],pe=sh(ve),de=eS(ve)===Jy,ut=[Cc,Zl].indexOf(pe)>=0,mt=ut?"width":"height",Ze=iw(t,{placement:ve,boundary:R,rootBoundary:O,altBoundary:N,padding:b}),Be=ut?de?eu:Ic:de?Zl:Cc;ce[mt]>Se[mt]&&(Be=kO(Be));var Ke=kO(Be),nt=[];if(d&&nt.push(Ze[pe]<=0),E&&nt.push(Ze[Be]<=0,Ze[Ke]<=0),nt.every(function(Ve){return Ve})){ie=ve,te=!1;break}Z.set(ve,nt)}if(te)for(var Ee=K?3:1,Ye=function(et){var gt=le.find(function(Dt){var Gt=Z.get(Dt);if(Gt)return Gt.slice(0,et).every(function(Bt){return Bt})});if(gt)return ie=gt,"break"},Et=Ee;Et>0;Et--){var ot=Ye(Et);if(ot==="break")break}t.placement!==ie&&(t.modifiersData[a]._skip=!0,t.placement=ie,t.reset=!0)}}const YNe={name:"flip",enabled:!0,phase:"main",fn:qNe,requiresIfExists:["offset"],data:{_skip:!1}};function S7(r,t,s){return s===void 0&&(s={x:0,y:0}),{top:r.top-t.height-s.y,right:r.right-t.width+s.x,bottom:r.bottom-t.height+s.y,left:r.left-t.width-s.x}}function T7(r){return[Cc,eu,Zl,Ic].some(function(t){return r[t]>=0})}function XNe(r){var t=r.state,s=r.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,g=iw(t,{elementContext:"reference"}),E=iw(t,{altBoundary:!0}),S=S7(g,a),b=S7(E,l,d),R=T7(S),O=T7(b);t.modifiersData[s]={referenceClippingOffsets:S,popperEscapeOffsets:b,isReferenceHidden:R,hasPopperEscaped:O},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":R,"data-popper-escaped":O})}const JNe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:XNe};function QNe(r,t,s){var a=sh(r),l=[Ic,Cc].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:r})):s,g=d[0],E=d[1];return g=g||0,E=(E||0)*l,[Ic,eu].indexOf(a)>=0?{x:E,y:g}:{x:g,y:E}}function ZNe(r){var t=r.state,s=r.options,a=r.name,l=s.offset,d=l===void 0?[0,0]:l,g=QQ.reduce(function(R,O){return R[O]=QNe(O,t.rects,d),R},{}),E=g[t.placement],S=E.x,b=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=S,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=g}const eke={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:ZNe};function tke(r){var t=r.state,s=r.name;t.modifiersData[s]=sZ({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const nke={name:"popperOffsets",enabled:!0,phase:"read",fn:tke,data:{}};function rke(r){return r==="x"?"y":"x"}function ike(r){var t=r.state,s=r.options,a=r.name,l=s.mainAxis,d=l===void 0?!0:l,g=s.altAxis,E=g===void 0?!1:g,S=s.boundary,b=s.rootBoundary,R=s.altBoundary,O=s.padding,N=s.tether,U=N===void 0?!0:N,K=s.tetherOffset,z=K===void 0?0:K,H=iw(t,{boundary:S,rootBoundary:b,padding:O,altBoundary:R}),ne=sh(t.placement),J=eS(t.placement),se=!J,le=vV(ne),ce=rke(le),Se=t.modifiersData.popperOffsets,Z=t.rects.reference,te=t.rects.popper,ie=typeof z=="function"?z(Object.assign({},t.rects,{placement:t.placement})):z,ae=typeof ie=="number"?{mainAxis:ie,altAxis:ie}:Object.assign({mainAxis:0,altAxis:0},ie),ve=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,pe={x:0,y:0};if(Se){if(d){var de,ut=le==="y"?Cc:Ic,mt=le==="y"?Zl:eu,Ze=le==="y"?"height":"width",Be=Se[le],Ke=Be+H[ut],nt=Be-H[mt],Ee=U?-te[Ze]/2:0,Ye=J===Jy?Z[Ze]:te[Ze],Et=J===Jy?-te[Ze]:-Z[Ze],ot=t.elements.arrow,Ve=U&&ot?_V(ot):{width:0,height:0},et=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:tZ(),gt=et[ut],Dt=et[mt],Gt=Nb(0,Z[Ze],Ve[Ze]),Bt=se?Z[Ze]/2-Ee-Gt-gt-ae.mainAxis:Ye-Gt-gt-ae.mainAxis,Vn=se?-Z[Ze]/2+Ee+Gt+Dt+ae.mainAxis:Et+Gt+Dt+ae.mainAxis,Dn=t.elements.arrow&&Nw(t.elements.arrow),un=Dn?le==="y"?Dn.clientTop||0:Dn.clientLeft||0:0,gr=(de=ve==null?void 0:ve[le])!=null?de:0,Ar=Be+Bt-gr-un,bt=Be+Vn-gr,Sn=Nb(U?pP(Ke,Ar):Ke,Be,U?L_(nt,bt):nt);Se[le]=Sn,pe[le]=Sn-Be}if(E){var Tn,we=le==="x"?Cc:Ic,De=le==="x"?Zl:eu,We=Se[ce],pt=ce==="y"?"height":"width",ft=We+H[we],dt=We-H[De],Mt=[Cc,Ic].indexOf(ne)!==-1,Fn=(Tn=ve==null?void 0:ve[ce])!=null?Tn:0,Cn=Mt?ft:We-Z[pt]-te[pt]-Fn+ae.altAxis,tn=Mt?We+Z[pt]+te[pt]-Fn-ae.altAxis:dt,_r=U&&Mt?ANe(Cn,We,tn):Nb(U?Cn:ft,We,U?tn:dt);Se[ce]=_r,pe[ce]=_r-We}t.modifiersData[a]=pe}}const ske={name:"preventOverflow",enabled:!0,phase:"main",fn:ike,requiresIfExists:["offset"]};function oke(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function ake(r){return r===dl(r)||!Jl(r)?EV(r):oke(r)}function cke(r){var t=r.getBoundingClientRect(),s=Qy(t.width)/r.offsetWidth||1,a=Qy(t.height)/r.offsetHeight||1;return s!==1||a!==1}function lke(r,t,s){s===void 0&&(s=!1);var a=Jl(t),l=Jl(t)&&cke(t),d=Pm(t),g=Zy(r,l,s),E={scrollLeft:0,scrollTop:0},S={x:0,y:0};return(a||!a&&!s)&&((ph(t)!=="body"||SV(d))&&(E=ake(t)),Jl(t)?(S=Zy(t,!0),S.x+=t.clientLeft,S.y+=t.clientTop):d&&(S.x=yV(d))),{x:g.left+E.scrollLeft-S.x,y:g.top+E.scrollTop-S.y,width:g.width,height:g.height}}function uke(r){var t=new Map,s=new Set,a=[];r.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var g=[].concat(d.requires||[],d.requiresIfExists||[]);g.forEach(function(E){if(!s.has(E)){var S=t.get(E);S&&l(S)}}),a.push(d)}return r.forEach(function(d){s.has(d.name)||l(d)}),a}function dke(r){var t=uke(r);return TNe.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function hke(r){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(r())})})),t}}function pke(r){var t=r.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var b7={placement:"bottom",modifiers:[],strategy:"absolute"};function w7(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function fke(r){r===void 0&&(r={});var t=r,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?b7:l;return function(E,S,b){b===void 0&&(b=d);var R={placement:"bottom",orderedModifiers:[],options:Object.assign({},b7,d),modifiersData:{},elements:{reference:E,popper:S},attributes:{},styles:{}},O=[],N=!1,U={state:R,setOptions:function(ne){var J=typeof ne=="function"?ne(R.options):ne;z(),R.options=Object.assign({},d,R.options,J),R.scrollParents={reference:W_(E)?kb(E):E.contextElement?kb(E.contextElement):[],popper:kb(S)};var se=dke(pke([].concat(a,R.options.modifiers)));return R.orderedModifiers=se.filter(function(le){return le.enabled}),K(),U.update()},forceUpdate:function(){if(!N){var ne=R.elements,J=ne.reference,se=ne.popper;if(w7(J,se)){R.rects={reference:lke(J,Nw(se),R.options.strategy==="fixed"),popper:_V(se)},R.reset=!1,R.placement=R.options.placement,R.orderedModifiers.forEach(function(ae){return R.modifiersData[ae.name]=Object.assign({},ae.data)});for(var le=0;le<R.orderedModifiers.length;le++){if(R.reset===!0){R.reset=!1,le=-1;continue}var ce=R.orderedModifiers[le],Se=ce.fn,Z=ce.options,te=Z===void 0?{}:Z,ie=ce.name;typeof Se=="function"&&(R=Se({state:R,options:te,name:ie,instance:U})||R)}}}},update:hke(function(){return new Promise(function(H){U.forceUpdate(),H(R)})}),destroy:function(){z(),N=!0}};if(!w7(E,S))return U;U.setOptions(b).then(function(H){!N&&b.onFirstUpdate&&b.onFirstUpdate(H)});function K(){R.orderedModifiers.forEach(function(H){var ne=H.name,J=H.options,se=J===void 0?{}:J,le=H.effect;if(typeof le=="function"){var ce=le({state:R,name:ne,instance:U,options:se}),Se=function(){};O.push(ce||Se)}})}function z(){O.forEach(function(H){return H()}),O=[]}return U}}var mke=[VNe,nke,MNe,RNe,eke,YNe,ske,kNe,JNe],gke=fke({defaultModifiers:mke});function TV(r={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:g=!0,offset:E,gutter:S=8,flip:b=!0,boundary:R="clippingParents",preventOverflow:O=!0,matchWidth:N,direction:U="ltr"}=r,K=B.useRef(null),z=B.useRef(null),H=B.useRef(null),ne=uNe(a,U),J=B.useRef(()=>{}),se=B.useCallback(()=>{var ae;!t||!K.current||!z.current||((ae=J.current)==null||ae.call(J),H.current=gke(K.current,z.current,{placement:ne,modifiers:[aNe,iNe,rNe,{...nNe,enabled:!!N},{name:"eventListeners",...tNe(g)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,S]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!O,options:{boundary:R}},...s??[]],strategy:l}),H.current.forceUpdate(),J.current=H.current.destroy)},[ne,t,s,N,g,d,E,S,b,O,R,l]);B.useEffect(()=>()=>{var ae;!K.current&&!z.current&&((ae=H.current)==null||ae.destroy(),H.current=null)},[]);const le=B.useCallback(ae=>{K.current=ae,se()},[se]),ce=B.useCallback((ae={},ve=null)=>({...ae,ref:Qi(le,ve)}),[le]),Se=B.useCallback(ae=>{z.current=ae,se()},[se]),Z=B.useCallback((ae={},ve=null)=>({...ae,ref:Qi(Se,ve),style:{...ae.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,Se,N]),te=B.useCallback((ae={},ve=null)=>{const{size:pe,shadowColor:de,bg:ut,style:mt,...Ze}=ae;return{...Ze,ref:ve,"data-popper-arrow":"",style:_ke(ae)}},[]),ie=B.useCallback((ae={},ve=null)=>({...ae,ref:ve,"data-popper-arrow-inner":""}),[]);return{update(){var ae;(ae=H.current)==null||ae.update()},forceUpdate(){var ae;(ae=H.current)==null||ae.forceUpdate()},transformOrigin:xs.transformOrigin.varRef,referenceRef:le,popperRef:Se,getPopperProps:Z,getArrowProps:te,getArrowInnerProps:ie,getReferenceProps:ce}}function _ke(r){const{size:t,shadowColor:s,bg:a,style:l}=r,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function bV(r={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=r,d=Rc(s),g=Rc(t),[E,S]=B.useState(r.defaultIsOpen||!1),b=a!==void 0?a:E,R=a!==void 0,O=B.useId(),N=l??`disclosure-${O}`,U=B.useCallback(()=>{R||S(!1),g==null||g()},[R,g]),K=B.useCallback(()=>{R||S(!0),d==null||d()},[R,d]),z=B.useCallback(()=>{b?U():K()},[b,K,U]);function H(J={}){return{...J,"aria-expanded":b,"aria-controls":N,onClick(se){var le;(le=J.onClick)==null||le.call(J,se),z()}}}function ne(J={}){return{...J,hidden:!b,id:N}}return{isOpen:b,onOpen:K,onClose:U,onToggle:z,isControlled:R,getButtonProps:H,getDisclosureProps:ne}}function vke(r){const{ref:t,handler:s,enabled:a=!0}=r,l=Rc(s),g=B.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;B.useEffect(()=>{if(!a)return;const E=O=>{eM(O,t)&&(g.isPointerDown=!0)},S=O=>{if(g.ignoreEmulatedMouseEvents){g.ignoreEmulatedMouseEvents=!1;return}g.isPointerDown&&s&&eM(O,t)&&(g.isPointerDown=!1,l(O))},b=O=>{g.ignoreEmulatedMouseEvents=!0,s&&g.isPointerDown&&eM(O,t)&&(g.isPointerDown=!1,l(O))},R=oZ(t.current);return R.addEventListener("mousedown",E,!0),R.addEventListener("mouseup",S,!0),R.addEventListener("touchstart",E,!0),R.addEventListener("touchend",b,!0),()=>{R.removeEventListener("mousedown",E,!0),R.removeEventListener("mouseup",S,!0),R.removeEventListener("touchstart",E,!0),R.removeEventListener("touchend",b,!0)}},[s,t,l,g,a])}function eM(r,t){var s;const a=r.target;return a&&!oZ(a).contains(a)?!1:!((s=t.current)!=null&&s.contains(a))}function oZ(r){var t;return(t=r==null?void 0:r.ownerDocument)!=null?t:document}function aZ(r){const{isOpen:t,ref:s}=r,[a,l]=B.useState(t),[d,g]=B.useState(!1);return B.useEffect(()=>{d||(l(t),g(!0))},[t,d,a]),Uy(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var S;const b=vPe(s.current),R=new b.CustomEvent("animationend",{bubbles:!0});(S=s.current)==null||S.dispatchEvent(R)}}}function wV(r){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=r;return!!(!s||a||l==="keepMounted"&&t)}var[Eke,yke,Ske,_4e]=qJ(),[Tke,tN]=Gi({strict:!1,name:"MenuContext"});function bke(r,...t){const s=B.useId(),a=r||s;return B.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}function wke(r){var t;return(t=r==null?void 0:r.ownerDocument)!=null?t:document}function Rke(r={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:g,isOpen:E,defaultIsOpen:S,onClose:b,onOpen:R,placement:O="bottom-start",lazyBehavior:N="unmount",direction:U,computePositionOnMount:K=!1,...z}=r,H=B.useRef(null),ne=B.useRef(null),J=Ske(),se=B.useCallback(()=>{requestAnimationFrame(()=>{var ot;(ot=H.current)==null||ot.focus({preventScroll:!1})})},[]),le=B.useCallback(()=>{const ot=setTimeout(()=>{var Ve;if(l)(Ve=l.current)==null||Ve.focus();else{const et=J.firstEnabled();et&&de(et.index)}});Ke.current.add(ot)},[J,l]),ce=B.useCallback(()=>{const ot=setTimeout(()=>{const Ve=J.lastEnabled();Ve&&de(Ve.index)});Ke.current.add(ot)},[J]),Se=B.useCallback(()=>{R==null||R(),d?le():se()},[d,le,se,R]),{isOpen:Z,onOpen:te,onClose:ie,onToggle:ae}=bV({isOpen:E,defaultIsOpen:S,onClose:b,onOpen:Se});vke({enabled:Z&&a,ref:H,handler:ot=>{var Ve;(Ve=ne.current)!=null&&Ve.contains(ot.target)||ie()}});const ve=TV({...z,enabled:Z||K,placement:O,direction:U}),[pe,de]=B.useState(-1);V_(()=>{Z||de(-1)},[Z]),XQ(H,{focusRef:ne,visible:Z,shouldFocus:!0});const ut=aZ({isOpen:Z,ref:H}),[mt,Ze]=bke(t,"menu-button","menu-list"),Be=B.useCallback(()=>{te(),se()},[te,se]),Ke=B.useRef(new Set([]));B.useEffect(()=>{const ot=Ke.current;return()=>{ot.forEach(Ve=>clearTimeout(Ve)),ot.clear()}},[]);const nt=B.useCallback(()=>{te(),le()},[le,te]),Ee=B.useCallback(()=>{te(),ce()},[te,ce]),Ye=B.useCallback(()=>{var ot,Ve;const et=wke(H.current),gt=(ot=H.current)==null?void 0:ot.contains(et.activeElement);if(!(Z&&!gt))return;const Gt=(Ve=J.item(pe))==null?void 0:Ve.node;Gt==null||Gt.focus({preventScroll:!0})},[Z,pe,J]),Et=B.useRef(null);return{openAndFocusMenu:Be,openAndFocusFirstItem:nt,openAndFocusLastItem:Ee,onTransitionEnd:Ye,unstable__animationState:ut,descendants:J,popper:ve,buttonId:mt,menuId:Ze,forceUpdate:ve.forceUpdate,orientation:"vertical",isOpen:Z,onToggle:ae,onOpen:te,onClose:ie,menuRef:H,buttonRef:ne,focusedIndex:pe,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:de,isLazy:g,lazyBehavior:N,initialFocusRef:l,rafId:Et}}function Cke(r={},t=null){const s=tN(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:g}=s,E=B.useCallback(S=>{const b=S.key,O={Enter:d,ArrowDown:d,ArrowUp:g}[b];O&&(S.preventDefault(),S.stopPropagation(),O(S))},[d,g]);return{...r,ref:Qi(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":cr(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:nr(r.onClick,a),onKeyDown:nr(r.onKeyDown,E)}}function R7(r){var t;return Oke(r)&&!!((t=r==null?void 0:r.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function Ike(r={},t=null){const s=tN();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:g,onClose:E,menuId:S,isLazy:b,lazyBehavior:R,unstable__animationState:O}=s,N=yke(),U=zPe({preventDefault:ne=>ne.key!==" "&&R7(ne.target)}),K=B.useCallback(ne=>{if(!ne.currentTarget.contains(ne.target))return;const J=ne.key,le={Tab:Se=>Se.preventDefault(),Escape:E,ArrowDown:()=>{const Se=N.nextEnabled(a);Se&&l(Se.index)},ArrowUp:()=>{const Se=N.prevEnabled(a);Se&&l(Se.index)}}[J];if(le){ne.preventDefault(),le(ne);return}const ce=U(Se=>{const Z=HPe(N.values(),Se,te=>{var ie,ae;return(ae=(ie=te==null?void 0:te.node)==null?void 0:ie.textContent)!=null?ae:""},N.item(a));if(Z){const te=N.indexOf(Z.node);l(te)}});R7(ne.target)&&ce(ne)},[N,a,U,E,l]),z=B.useRef(!1);g&&(z.current=!0);const H=wV({wasSelected:z.current,enabled:b,mode:R,isSelected:O.present});return{...r,ref:Qi(d,t),children:H?r.children:null,tabIndex:-1,role:"menu",id:S,style:{...r.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:nr(r.onKeyDown,K)}}function Ake(r={}){const{popper:t,isOpen:s}=tN();return t.getPopperProps({...r,style:{visibility:s?"visible":"hidden",...r.style}})}function Oke(r){var t;if(!Pke(r))return!1;const s=(t=r.ownerDocument.defaultView)!=null?t:window;return r instanceof s.HTMLElement}function Pke(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}var[Nke,cZ]=Gi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),lZ=r=>{const{children:t}=r,s=Pc("Menu",r),a=es(r),{direction:l}=dS(),{descendants:d,...g}=Rke({...a,direction:l}),E=B.useMemo(()=>g,[g]),{isOpen:S,onClose:b,forceUpdate:R}=E;return F.jsx(Eke,{value:d,children:F.jsx(Tke,{value:E,children:F.jsx(Nke,{value:s,children:Xl(t,{isOpen:S,onClose:b,forceUpdate:R})})})})};lZ.displayName="Menu";var kke={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},Dke=Nt(Fp.div),uZ=qt(function(t,s){var a,l;const{rootProps:d,motionProps:g,...E}=t,{isOpen:S,onTransitionEnd:b,unstable__animationState:R}=tN(),O=Ike(E,s),N=Ake(d),U=cZ();return F.jsx(Nt.div,{...N,__css:{zIndex:(l=t.zIndex)!=null?l:(a=U.list)==null?void 0:a.zIndex},children:F.jsx(Dke,{variants:kke,initial:!1,animate:S?"enter":"exit",__css:{outline:0,...U.list},...g,className:Un("chakra-menu__menu-list",O.className),...O,onUpdate:b,onAnimationComplete:BY(R.onComplete,O.onAnimationComplete)})})});uZ.displayName="MenuList";var Lke=qt((r,t)=>{const s=cZ();return F.jsx(Nt.button,{ref:t,...r,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),dZ=qt((r,t)=>{const{children:s,as:a,...l}=r,d=Cke(l,t),g=a||Lke;return F.jsx(g,{...d,className:Un("chakra-menu__menu-button",r.className),children:F.jsx(Nt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:r.children})})});dZ.displayName="MenuButton";var xke={slideInBottom:{...db,custom:{offsetY:16,reverse:!0}},slideInRight:{...db,custom:{offsetX:16,reverse:!0}},slideInTop:{...db,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...db,custom:{offsetX:-16,reverse:!0}},scale:{...JJ,custom:{initialScale:.95,reverse:!0}},none:{}},Mke=Nt(Fp.section),Uke=r=>xke[r||"none"],hZ=B.forwardRef((r,t)=>{const{preset:s,motionProps:a=Uke(s),...l}=r;return F.jsx(Mke,{ref:t,...a,...l})});hZ.displayName="ModalTransition";var Vke=Object.defineProperty,Fke=(r,t,s)=>t in r?Vke(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,jke=(r,t,s)=>(Fke(r,t+"",s),s),Bke=class{constructor(){jke(this,"modals"),this.modals=new Map}add(r){return this.modals.set(r,this.modals.size+1),this.modals.size}remove(r){this.modals.delete(r)}isTopModal(r){return r?this.modals.get(r)===this.modals.size:!1}},E2=new Bke;function pZ(r,t){const[s,a]=B.useState(0);return B.useEffect(()=>{const l=r.current;if(l){if(t){const d=E2.add(l);a(d)}return()=>{E2.remove(l),a(0)}}},[t,r]),s}var Wke=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},ay=new WeakMap,tO=new WeakMap,nO={},tM=0,fZ=function(r){return r&&(r.host||fZ(r.parentNode))},Gke=function(r,t){return t.map(function(s){if(r.contains(s))return s;var a=fZ(s);return a&&r.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",r,". Doing nothing"),null)}).filter(function(s){return!!s})},zke=function(r,t,s,a){var l=Gke(t,Array.isArray(r)?r:[r]);nO[s]||(nO[s]=new WeakMap);var d=nO[s],g=[],E=new Set,S=new Set(l),b=function(O){!O||E.has(O)||(E.add(O),b(O.parentNode))};l.forEach(b);var R=function(O){!O||S.has(O)||Array.prototype.forEach.call(O.children,function(N){if(E.has(N))R(N);else try{var U=N.getAttribute(a),K=U!==null&&U!=="false",z=(ay.get(N)||0)+1,H=(d.get(N)||0)+1;ay.set(N,z),d.set(N,H),g.push(N),z===1&&K&&tO.set(N,!0),H===1&&N.setAttribute(s,"true"),K||N.setAttribute(a,"true")}catch(ne){console.error("aria-hidden: cannot operate on ",N,ne)}})};return R(t),E.clear(),tM++,function(){g.forEach(function(O){var N=ay.get(O)-1,U=d.get(O)-1;ay.set(O,N),d.set(O,U),N||(tO.has(O)||O.removeAttribute(a),tO.delete(O)),U||O.removeAttribute(s)}),tM--,tM||(ay=new WeakMap,ay=new WeakMap,tO=new WeakMap,nO={})}},Hke=function(r,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(r)?r:[r]),l=Wke(r);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),zke(a,l,s,"aria-hidden")):function(){return null}};function Kke(r){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:g=!0,onOverlayClick:E,onEsc:S}=r,b=B.useRef(null),R=B.useRef(null),[O,N,U]=qke(a,"chakra-modal","chakra-modal--header","chakra-modal--body");$ke(b,t&&g);const K=pZ(b,t),z=B.useRef(null),H=B.useCallback(ie=>{z.current=ie.target},[]),ne=B.useCallback(ie=>{ie.key==="Escape"&&(ie.stopPropagation(),d&&(s==null||s()),S==null||S())},[d,s,S]),[J,se]=B.useState(!1),[le,ce]=B.useState(!1),Se=B.useCallback((ie={},ae=null)=>({role:"dialog",...ie,ref:Qi(ae,b),id:O,tabIndex:-1,"aria-modal":!0,"aria-labelledby":J?N:void 0,"aria-describedby":le?U:void 0,onClick:nr(ie.onClick,ve=>ve.stopPropagation())}),[U,le,O,N,J]),Z=B.useCallback(ie=>{ie.stopPropagation(),z.current===ie.target&&E2.isTopModal(b.current)&&(l&&(s==null||s()),E==null||E())},[s,l,E]),te=B.useCallback((ie={},ae=null)=>({...ie,ref:Qi(ae,R),onClick:nr(ie.onClick,Z),onKeyDown:nr(ie.onKeyDown,ne),onMouseDown:nr(ie.onMouseDown,H)}),[ne,H,Z]);return{isOpen:t,onClose:s,headerId:N,bodyId:U,setBodyMounted:ce,setHeaderMounted:se,dialogRef:b,overlayRef:R,getDialogProps:Se,getDialogContainerProps:te,index:K}}function $ke(r,t){const s=r.current;B.useEffect(()=>{if(!(!r.current||!t))return Hke(r.current)},[t,r,s])}function qke(r,...t){const s=B.useId(),a=r||s;return B.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}var[Yke,mS]=Gi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[Xke,G_]=Gi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),jp=r=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,motionPreset:"scale",lockFocusAcrossFrames:!0,...r},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:g,finalFocusRef:E,returnFocusOnClose:S,blockScrollOnMount:b,allowPinchZoom:R,preserveScrollBarGap:O,motionPreset:N,lockFocusAcrossFrames:U,onCloseComplete:K}=t,z=Pc("Modal",t),ne={...Kke(t),autoFocus:l,trapFocus:d,initialFocusRef:g,finalFocusRef:E,returnFocusOnClose:S,blockScrollOnMount:b,allowPinchZoom:R,preserveScrollBarGap:O,motionPreset:N,lockFocusAcrossFrames:U};return F.jsx(Xke,{value:ne,children:F.jsx(Yke,{value:z,children:F.jsx(pS,{onExitComplete:K,children:ne.isOpen&&F.jsx(Ju,{...s,children:a})})})})};jp.displayName="Modal";var DO="right-scroll-bar-position",LO="width-before-scroll-bar",Jke="with-scroll-bars-hidden",Qke="--removed-body-scroll-bar-size",mZ=dQ(),nM=function(){},nN=B.forwardRef(function(r,t){var s=B.useRef(null),a=B.useState({onScrollCapture:nM,onWheelCapture:nM,onTouchMoveCapture:nM}),l=a[0],d=a[1],g=r.forwardProps,E=r.children,S=r.className,b=r.removeScrollBar,R=r.enabled,O=r.shards,N=r.sideCar,U=r.noIsolation,K=r.inert,z=r.allowPinchZoom,H=r.as,ne=H===void 0?"div":H,J=r.gapMode,se=Ow(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),le=N,ce=cQ([s,t]),Se=Qd(Qd({},se),l);return B.createElement(B.Fragment,null,R&&B.createElement(le,{sideCar:mZ,removeScrollBar:b,shards:O,noIsolation:U,inert:K,setCallbacks:d,allowPinchZoom:!!z,lockRef:s,gapMode:J}),g?B.cloneElement(B.Children.only(E),Qd(Qd({},Se),{ref:ce})):B.createElement(ne,Qd({},Se,{className:S,ref:ce}),E))});nN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};nN.classNames={fullWidth:LO,zeroRight:DO};var Zke=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function eDe(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=Zke();return t&&r.setAttribute("nonce",t),r}function tDe(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function nDe(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var rDe=function(){var r=0,t=null;return{add:function(s){r==0&&(t=eDe())&&(tDe(t,s),nDe(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},iDe=function(){var r=rDe();return function(t,s){B.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&s])}},gZ=function(){var r=iDe(),t=function(s){var a=s.styles,l=s.dynamic;return r(a,l),null};return t},sDe={left:0,top:0,right:0,gap:0},rM=function(r){return parseInt(r||"",10)||0},oDe=function(r){var t=window.getComputedStyle(document.body),s=t[r==="padding"?"paddingLeft":"marginLeft"],a=t[r==="padding"?"paddingTop":"marginTop"],l=t[r==="padding"?"paddingRight":"marginRight"];return[rM(s),rM(a),rM(l)]},aDe=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return sDe;var t=oDe(r),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},cDe=gZ(),jy="data-scroll-locked",lDe=function(r,t,s,a){var l=r.left,d=r.top,g=r.right,E=r.gap;return s===void 0&&(s="margin"),`
  .`.concat(Jke,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(jy,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(g,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(DO,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(LO,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(DO," .").concat(DO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(LO," .").concat(LO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(jy,`] {
    `).concat(Qke,": ").concat(E,`px;
  }
`)},C7=function(){var r=parseInt(document.body.getAttribute(jy)||"0",10);return isFinite(r)?r:0},uDe=function(){B.useEffect(function(){return document.body.setAttribute(jy,(C7()+1).toString()),function(){var r=C7()-1;r<=0?document.body.removeAttribute(jy):document.body.setAttribute(jy,r.toString())}},[])},dDe=function(r){var t=r.noRelative,s=r.noImportant,a=r.gapMode,l=a===void 0?"margin":a;uDe();var d=B.useMemo(function(){return aDe(l)},[l]);return B.createElement(cDe,{styles:lDe(d,!t,l,s?"":"!important")})},y2=!1;if(typeof window<"u")try{var rO=Object.defineProperty({},"passive",{get:function(){return y2=!0,!0}});window.addEventListener("test",rO,rO),window.removeEventListener("test",rO,rO)}catch{y2=!1}var cy=y2?{passive:!1}:!1,hDe=function(r){return r.tagName==="TEXTAREA"},_Z=function(r,t){var s=window.getComputedStyle(r);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!hDe(r)&&s[t]==="visible")},pDe=function(r){return _Z(r,"overflowY")},fDe=function(r){return _Z(r,"overflowX")},I7=function(r,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=vZ(r,a);if(l){var d=EZ(r,a),g=d[1],E=d[2];if(g>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},mDe=function(r){var t=r.scrollTop,s=r.scrollHeight,a=r.clientHeight;return[t,s,a]},gDe=function(r){var t=r.scrollLeft,s=r.scrollWidth,a=r.clientWidth;return[t,s,a]},vZ=function(r,t){return r==="v"?pDe(t):fDe(t)},EZ=function(r,t){return r==="v"?mDe(t):gDe(t)},_De=function(r,t){return r==="h"&&t==="rtl"?-1:1},vDe=function(r,t,s,a,l){var d=_De(r,window.getComputedStyle(t).direction),g=d*a,E=s.target,S=t.contains(E),b=!1,R=g>0,O=0,N=0;do{var U=EZ(r,E),K=U[0],z=U[1],H=U[2],ne=z-H-d*K;(K||ne)&&vZ(r,E)&&(O+=ne,N+=K),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!S&&E!==document.body||S&&(t.contains(E)||t===E));return(R&&Math.abs(O)<1||!R&&Math.abs(N)<1)&&(b=!0),b},iO=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},A7=function(r){return[r.deltaX,r.deltaY]},O7=function(r){return r&&"current"in r?r.current:r},EDe=function(r,t){return r[0]===t[0]&&r[1]===t[1]},yDe=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},SDe=0,ly=[];function TDe(r){var t=B.useRef([]),s=B.useRef([0,0]),a=B.useRef(),l=B.useState(SDe++)[0],d=B.useState(gZ)[0],g=B.useRef(r);B.useEffect(function(){g.current=r},[r]),B.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(l));var z=aOe([r.lockRef.current],(r.shards||[]).map(O7),!0).filter(Boolean);return z.forEach(function(H){return H.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),z.forEach(function(H){return H.classList.remove("allow-interactivity-".concat(l))})}}},[r.inert,r.lockRef.current,r.shards]);var E=B.useCallback(function(z,H){if("touches"in z&&z.touches.length===2)return!g.current.allowPinchZoom;var ne=iO(z),J=s.current,se="deltaX"in z?z.deltaX:J[0]-ne[0],le="deltaY"in z?z.deltaY:J[1]-ne[1],ce,Se=z.target,Z=Math.abs(se)>Math.abs(le)?"h":"v";if("touches"in z&&Z==="h"&&Se.type==="range")return!1;var te=I7(Z,Se);if(!te)return!0;if(te?ce=Z:(ce=Z==="v"?"h":"v",te=I7(Z,Se)),!te)return!1;if(!a.current&&"changedTouches"in z&&(se||le)&&(a.current=ce),!ce)return!0;var ie=a.current||ce;return vDe(ie,H,z,ie==="h"?se:le)},[]),S=B.useCallback(function(z){var H=z;if(!(!ly.length||ly[ly.length-1]!==d)){var ne="deltaY"in H?A7(H):iO(H),J=t.current.filter(function(ce){return ce.name===H.type&&(ce.target===H.target||H.target===ce.shadowParent)&&EDe(ce.delta,ne)})[0];if(J&&J.should){H.cancelable&&H.preventDefault();return}if(!J){var se=(g.current.shards||[]).map(O7).filter(Boolean).filter(function(ce){return ce.contains(H.target)}),le=se.length>0?E(H,se[0]):!g.current.noIsolation;le&&H.cancelable&&H.preventDefault()}}},[]),b=B.useCallback(function(z,H,ne,J){var se={name:z,delta:H,target:ne,should:J,shadowParent:bDe(ne)};t.current.push(se),setTimeout(function(){t.current=t.current.filter(function(le){return le!==se})},1)},[]),R=B.useCallback(function(z){s.current=iO(z),a.current=void 0},[]),O=B.useCallback(function(z){b(z.type,A7(z),z.target,E(z,r.lockRef.current))},[]),N=B.useCallback(function(z){b(z.type,iO(z),z.target,E(z,r.lockRef.current))},[]);B.useEffect(function(){return ly.push(d),r.setCallbacks({onScrollCapture:O,onWheelCapture:O,onTouchMoveCapture:N}),document.addEventListener("wheel",S,cy),document.addEventListener("touchmove",S,cy),document.addEventListener("touchstart",R,cy),function(){ly=ly.filter(function(z){return z!==d}),document.removeEventListener("wheel",S,cy),document.removeEventListener("touchmove",S,cy),document.removeEventListener("touchstart",R,cy)}},[]);var U=r.removeScrollBar,K=r.inert;return B.createElement(B.Fragment,null,K?B.createElement(d,{styles:yDe(l)}):null,U?B.createElement(dDe,{gapMode:r.gapMode}):null)}function bDe(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const wDe=cOe(mZ,TDe);var yZ=B.forwardRef(function(r,t){return B.createElement(nN,Qd({},r,{ref:t,sideCar:wDe}))});yZ.classNames=nN.classNames;function RDe(r){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:g,finalFocusRef:E,returnFocusOnClose:S,preserveScrollBarGap:b,lockFocusAcrossFrames:R,isOpen:O}=G_(),[N,U]=AJ();B.useEffect(()=>{!N&&U&&setTimeout(U)},[N,U]);const K=pZ(a,O);return F.jsx(BQ,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:E,restoreFocus:S,contentRef:a,lockFocusAcrossFrames:R,children:F.jsx(yZ,{removeScrollBar:!b,allowPinchZoom:g,enabled:K===1&&d,forwardProps:!0,children:r.children})})}var Bp=qt((r,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...g}=r,{getDialogProps:E,getDialogContainerProps:S}=G_(),b=E(g,t),R=S(l),O=Un("chakra-modal__content",s),N=mS(),U={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},K={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:z}=G_();return F.jsx(RDe,{children:F.jsx(Nt.div,{...R,className:"chakra-modal__content-container",tabIndex:-1,__css:K,children:F.jsx(hZ,{preset:z,motionProps:d,className:O,...b,__css:U,children:a})})})});Bp.displayName="ModalContent";var rN=qt((r,t)=>{const{className:s,...a}=r,l=Un("chakra-modal__footer",s),g={display:"flex",alignItems:"center",justifyContent:"flex-end",...mS().footer};return F.jsx(Nt.footer,{ref:t,...a,__css:g,className:l})});rN.displayName="ModalFooter";var Nm=qt((r,t)=>{const{className:s,...a}=r,{headerId:l,setHeaderMounted:d}=G_();B.useEffect(()=>(d(!0),()=>d(!1)),[d]);const g=Un("chakra-modal__header",s),S={flex:0,...mS().header};return F.jsx(Nt.header,{ref:t,className:g,id:l,...a,__css:S})});Nm.displayName="ModalHeader";var CDe=Nt(Fp.div),Wp=qt((r,t)=>{const{className:s,transition:a,motionProps:l,...d}=r,g=Un("chakra-modal__overlay",s),S={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...mS().overlay},{motionPreset:b}=G_(),O=l||(b==="none"?{}:XJ);return F.jsx(CDe,{...O,__css:S,ref:t,className:g,...d})});Wp.displayName="ModalOverlay";var Gp=qt((r,t)=>{const{className:s,...a}=r,{bodyId:l,setBodyMounted:d}=G_();B.useEffect(()=>(d(!0),()=>d(!1)),[d]);const g=Un("chakra-modal__body",s),E=mS();return F.jsx(Nt.div,{ref:t,className:g,id:l,...a,__css:E.body})});Gp.displayName="ModalBody";var zp=qt((r,t)=>{const{onClick:s,className:a,...l}=r,{onClose:d}=G_(),g=Un("chakra-modal__close-btn",a),E=mS();return F.jsx(Zb,{ref:t,__css:E.closeButton,className:g,onClick:nr(s,S=>{S.stopPropagation(),d()}),...l})});zp.displayName="ModalCloseButton";var[IDe,iN]=Gi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[ADe,SZ]=Gi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `});function TZ(r){const t=B.Children.only(r.children),{getTriggerProps:s}=iN();return B.cloneElement(t,s(t.props,t.ref))}TZ.displayName="PopoverTrigger";var uy={click:"click",hover:"hover"};function ODe(r={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:g=!0,arrowSize:E,arrowShadowColor:S,trigger:b=uy.click,openDelay:R=200,closeDelay:O=200,isLazy:N,lazyBehavior:U="unmount",computePositionOnMount:K,...z}=r,{isOpen:H,onClose:ne,onOpen:J,onToggle:se}=bV(r),le=B.useRef(null),ce=B.useRef(null),Se=B.useRef(null),Z=B.useRef(!1),te=B.useRef(!1);H&&(te.current=!0);const[ie,ae]=B.useState(!1),[ve,pe]=B.useState(!1),de=B.useId(),ut=l??de,[mt,Ze,Be,Ke]=["popover-trigger","popover-content","popover-header","popover-body"].map(bt=>`${bt}-${ut}`),{referenceRef:nt,getArrowProps:Ee,getPopperProps:Ye,getArrowInnerProps:Et,forceUpdate:ot}=TV({...z,enabled:H||!!K}),Ve=aZ({isOpen:H,ref:Se});XAe({enabled:H,ref:ce}),XQ(Se,{focusRef:ce,visible:H,shouldFocus:d&&b===uy.click}),XPe(Se,{focusRef:a,visible:H,shouldFocus:g&&b===uy.click});const et=wV({wasSelected:te.current,enabled:N,mode:U,isSelected:Ve.present}),gt=B.useCallback((bt={},Sn=null)=>{const Tn={...bt,style:{...bt.style,transformOrigin:xs.transformOrigin.varRef,[xs.arrowSize.var]:E?`${E}px`:void 0,[xs.arrowShadowColor.var]:S},ref:Qi(Se,Sn),children:et?bt.children:null,id:Ze,tabIndex:-1,role:"dialog",onKeyDown:nr(bt.onKeyDown,we=>{s&&we.key==="Escape"&&ne()}),onBlur:nr(bt.onBlur,we=>{const De=P7(we),We=iM(Se.current,De),pt=iM(ce.current,De);H&&t&&(!We&&!pt)&&ne()}),"aria-labelledby":ie?Be:void 0,"aria-describedby":ve?Ke:void 0};return b===uy.hover&&(Tn.role="tooltip",Tn.onMouseEnter=nr(bt.onMouseEnter,()=>{Z.current=!0}),Tn.onMouseLeave=nr(bt.onMouseLeave,we=>{we.nativeEvent.relatedTarget!==null&&(Z.current=!1,setTimeout(()=>ne(),O))})),Tn},[et,Ze,ie,Be,ve,Ke,b,s,ne,H,t,O,S,E]),Dt=B.useCallback((bt={},Sn=null)=>Ye({...bt,style:{visibility:H?"visible":"hidden",...bt.style}},Sn),[H,Ye]),Gt=B.useCallback((bt,Sn=null)=>({...bt,ref:Qi(Sn,le,nt)}),[le,nt]),Bt=B.useRef(),Vn=B.useRef(),Dn=B.useCallback(bt=>{le.current==null&&nt(bt)},[nt]),un=B.useCallback((bt={},Sn=null)=>{const Tn={...bt,ref:Qi(ce,Sn,Dn),id:mt,"aria-haspopup":"dialog","aria-expanded":H,"aria-controls":Ze};return b===uy.click&&(Tn.onClick=nr(bt.onClick,se)),b===uy.hover&&(Tn.onFocus=nr(bt.onFocus,()=>{Bt.current===void 0&&J()}),Tn.onBlur=nr(bt.onBlur,we=>{const De=P7(we),We=!iM(Se.current,De);H&&t&&We&&ne()}),Tn.onKeyDown=nr(bt.onKeyDown,we=>{we.key==="Escape"&&ne()}),Tn.onMouseEnter=nr(bt.onMouseEnter,()=>{Z.current=!0,Bt.current=window.setTimeout(()=>J(),R)}),Tn.onMouseLeave=nr(bt.onMouseLeave,()=>{Z.current=!1,Bt.current&&(clearTimeout(Bt.current),Bt.current=void 0),Vn.current=window.setTimeout(()=>{Z.current===!1&&ne()},O)})),Tn},[mt,H,Ze,b,Dn,se,J,t,ne,R,O]);B.useEffect(()=>()=>{Bt.current&&clearTimeout(Bt.current),Vn.current&&clearTimeout(Vn.current)},[]);const gr=B.useCallback((bt={},Sn=null)=>({...bt,id:Be,ref:Qi(Sn,Tn=>{ae(!!Tn)})}),[Be]),Ar=B.useCallback((bt={},Sn=null)=>({...bt,id:Ke,ref:Qi(Sn,Tn=>{pe(!!Tn)})}),[Ke]);return{forceUpdate:ot,isOpen:H,onAnimationComplete:Ve.onComplete,onClose:ne,getAnchorProps:Gt,getArrowProps:Ee,getArrowInnerProps:Et,getPopoverPositionerProps:Dt,getPopoverProps:gt,getTriggerProps:un,getHeaderProps:gr,getBodyProps:Ar}}function iM(r,t){return r===t||(r==null?void 0:r.contains(t))}function P7(r){var t;const s=r.currentTarget.ownerDocument.activeElement;return(t=r.relatedTarget)!=null?t:s}function bZ(r){const t=Pc("Popover",r),{children:s,...a}=es(r),l=dS(),d=ODe({...a,direction:l.direction});return F.jsx(IDe,{value:d,children:F.jsx(ADe,{value:t,children:Xl(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}bZ.displayName="Popover";var wZ=qt(function(t,s){const{getBodyProps:a}=iN(),l=SZ();return F.jsx(Nt.div,{...a(t,s),className:Un("chakra-popover__body",t.className),__css:l.body})});wZ.displayName="PopoverBody";function PDe(r){if(r)return{enter:{...r.enter,visibility:"visible"},exit:{...r.exit,transitionEnd:{visibility:"hidden"}}}}var NDe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},kDe=Nt(Fp.section),RZ=qt(function(t,s){const{variants:a=NDe,...l}=t,{isOpen:d}=iN();return F.jsx(kDe,{ref:s,variants:PDe(a),initial:!1,animate:d?"enter":"exit",...l})});RZ.displayName="PopoverTransition";var CZ=qt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:g,getPopoverPositionerProps:E,onAnimationComplete:S}=iN(),b=SZ(),R={position:"relative",display:"flex",flexDirection:"column",...b.content};return F.jsx(Nt.div,{...E(a),__css:b.popper,className:"chakra-popover__popper",children:F.jsx(RZ,{...l,...g(d,s),onAnimationComplete:BY(S,d.onAnimationComplete),className:Un("chakra-popover__content",t.className),__css:R})})});CZ.displayName="PopoverContent";function DDe(r,t,s){return(r-t)*100/(s-t)}_w({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});_w({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var LDe=_w({"0%":{left:"-40%"},"100%":{left:"100%"}}),xDe=_w({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function MDe(r){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:g,role:E="progressbar"}=r,S=DDe(t,s,a);return{bind:{"data-indeterminate":g?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":g?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,S):l})(),role:E},percent:S,value:t}}var[UDe,VDe]=Gi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),FDe=qt((r,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:g,...E}=r,S=MDe({value:l,min:s,max:a,isIndeterminate:d,role:g}),R={height:"100%",...VDe().filledTrack};return F.jsx(Nt.div,{ref:t,style:{width:`${S.percent}%`,...E.style},...S.bind,...E,__css:R})}),RV=qt((r,t)=>{var s;const{value:a,min:l=0,max:d=100,hasStripe:g,isAnimated:E,children:S,borderRadius:b,isIndeterminate:R,"aria-label":O,"aria-labelledby":N,"aria-valuetext":U,title:K,role:z,...H}=es(r),ne=Pc("Progress",r),J=b??((s=ne.track)==null?void 0:s.borderRadius),se={animation:`${xDe} 1s linear infinite`},Se={...!R&&g&&E&&se,...R&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${LDe} 1s ease infinite normal none running`}},Z={overflow:"hidden",position:"relative",...ne.track};return F.jsx(Nt.div,{ref:t,borderRadius:J,__css:Z,...H,children:F.jsxs(UDe,{value:ne,children:[F.jsx(FDe,{"aria-label":O,"aria-labelledby":N,"aria-valuetext":U,min:l,max:d,value:a,isIndeterminate:R,css:Se,borderRadius:J,title:K,role:z}),S]})})});RV.displayName="Progress";var IZ=qt(function(t,s){const{children:a,placeholder:l,className:d,...g}=t;return F.jsxs(Nt.select,{...g,ref:s,className:Un("chakra-select",d),children:[l&&F.jsx("option",{value:"",children:l}),a]})});IZ.displayName="SelectField";function jDe(r,t){const s={},a={};for(const[l,d]of Object.entries(r))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}var AZ=qt((r,t)=>{var s;const a=Pc("Select",r),{rootProps:l,placeholder:d,icon:g,color:E,height:S,h:b,minH:R,minHeight:O,iconColor:N,iconSize:U,...K}=es(r),[z,H]=jDe(K,zge),ne=iQ(H),J={width:"100%",height:"fit-content",position:"relative",color:E},se={paddingEnd:"2rem",...a.field,_focus:{zIndex:"unset",...(s=a.field)==null?void 0:s._focus}};return F.jsxs(Nt.div,{className:"chakra-select__wrapper",__css:J,...z,...l,children:[F.jsx(IZ,{ref:t,height:b??S,minH:R??O,placeholder:d,...ne,__css:se,children:r.children}),F.jsx(OZ,{"data-disabled":cr(ne.disabled),...(N||E)&&{color:N||E},__css:a.icon,...U&&{fontSize:U},children:g})]})});AZ.displayName="Select";var BDe=r=>F.jsx("svg",{viewBox:"0 0 24 24",...r,children:F.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),WDe=Nt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),OZ=r=>{const{children:t=F.jsx(BDe,{}),...s}=r,a=B.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return F.jsx(WDe,{...s,className:"chakra-select__icon-wrapper",children:B.isValidElement(t)?a:null})};OZ.displayName="SelectIcon";var dy=r=>r?"":void 0,sM=r=>r?!0:void 0,kw=(...r)=>r.filter(Boolean).join(" ");function oM(...r){return function(s){r.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function sO(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}var xO={width:0,height:0},oO=r=>r||xO;function GDe(r){const{orientation:t,thumbPercents:s,thumbRects:a,isReversed:l}=r,d=z=>{var H;const ne=(H=a[z])!=null?H:xO;return{position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...sO({orientation:t,vertical:{bottom:`calc(${s[z]}% - ${ne.height/2}px)`},horizontal:{left:`calc(${s[z]}% - ${ne.width/2}px)`}})}},g=t==="vertical"?a.reduce((z,H)=>oO(z).height>oO(H).height?z:H,xO):a.reduce((z,H)=>oO(z).width>oO(H).width?z:H,xO),E={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0,...sO({orientation:t,vertical:g?{paddingLeft:g.width/2,paddingRight:g.width/2}:{},horizontal:g?{paddingTop:g.height/2,paddingBottom:g.height/2}:{}})},S={position:"absolute",...sO({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},b=s.length===1,R=[0,l?100-s[0]:s[0]],O=b?R:s;let N=O[0];!b&&l&&(N=100-N);const U=Math.abs(O[O.length-1]-O[0]),K={...S,...sO({orientation:t,vertical:l?{height:`${U}%`,top:`${N}%`}:{height:`${U}%`,bottom:`${N}%`},horizontal:l?{width:`${U}%`,right:`${N}%`}:{width:`${U}%`,left:`${N}%`}})};return{trackStyle:S,innerTrackStyle:K,rootStyle:E,getThumbStyle:d}}function zDe(r){const{isReversed:t,direction:s,orientation:a}=r;return s==="ltr"||a==="vertical"?t:!t}function HDe(r,t,s,a){return r.addEventListener(t,s,a),()=>{r.removeEventListener(t,s,a)}}function KDe(r){const t=qDe(r);return typeof t.PointerEvent<"u"&&r instanceof t.PointerEvent?r.pointerType==="mouse":r instanceof t.MouseEvent}function PZ(r){return!!r.touches}function $De(r){return PZ(r)&&r.touches.length>1}function qDe(r){var t;return(t=r.view)!=null?t:window}function YDe(r,t="page"){const s=r.touches[0]||r.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function XDe(r,t="page"){return{x:r[`${t}X`],y:r[`${t}Y`]}}function NZ(r,t="page"){return PZ(r)?YDe(r,t):XDe(r,t)}function JDe(r){return t=>{const s=KDe(t);(!s||s&&t.button===0)&&r(t)}}function QDe(r,t=!1){function s(l){r(l,{point:NZ(l)})}return t?JDe(s):s}function MO(r,t,s,a){return HDe(r,t,QDe(s,t==="pointerdown"),a)}var ZDe=Object.defineProperty,e1e=(r,t,s)=>t in r?ZDe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Hu=(r,t,s)=>(e1e(r,typeof t!="symbol"?t+"":t,s),s),t1e=class{constructor(r,t,s){Hu(this,"history",[]),Hu(this,"startEvent",null),Hu(this,"lastEvent",null),Hu(this,"lastEventInfo",null),Hu(this,"handlers",{}),Hu(this,"removeListeners",()=>{}),Hu(this,"threshold",3),Hu(this,"win"),Hu(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=aM(this.lastEventInfo,this.history),S=this.startEvent!==null,b=s1e(E.offset,{x:0,y:0})>=this.threshold;if(!S&&!b)return;const{timestamp:R}=AK();this.history.push({...E.point,timestamp:R});const{onStart:O,onMove:N}=this.handlers;S||(O==null||O(this.lastEvent,E),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,E)}),Hu(this,"onPointerMove",(E,S)=>{this.lastEvent=E,this.lastEventInfo=S,M0e.update(this.updatePoint,!0)}),Hu(this,"onPointerUp",(E,S)=>{const b=aM(S,this.history),{onEnd:R,onSessionEnd:O}=this.handlers;O==null||O(E,b),this.end(),!(!R||!this.startEvent)&&(R==null||R(E,b))});var a;if(this.win=(a=r.view)!=null?a:window,$De(r))return;this.handlers=t,s&&(this.threshold=s),r.stopPropagation(),r.preventDefault();const l={point:NZ(r)},{timestamp:d}=AK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:g}=t;g==null||g(r,aM(l,this.history)),this.removeListeners=i1e(MO(this.win,"pointermove",this.onPointerMove),MO(this.win,"pointerup",this.onPointerUp),MO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(r){this.handlers=r}end(){var r;(r=this.removeListeners)==null||r.call(this),U0e.update(this.updatePoint)}};function N7(r,t){return{x:r.x-t.x,y:r.y-t.y}}function aM(r,t){return{point:r.point,delta:N7(r.point,t[t.length-1]),offset:N7(r.point,t[0]),velocity:r1e(t,.1)}}var n1e=r=>r*1e3;function r1e(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=r[r.length-1];for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>n1e(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const g={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}function i1e(...r){return t=>r.reduce((s,a)=>a(s),t)}function cM(r,t){return Math.abs(r-t)}function k7(r){return"x"in r&&"y"in r}function s1e(r,t){if(typeof r=="number"&&typeof t=="number")return cM(r,t);if(k7(r)&&k7(t)){const s=cM(r.x,t.x),a=cM(r.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function kZ(r){const t=B.useRef(null);return t.current=r,t}function o1e(r,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:g,threshold:E}=t,S=!!(s||a||l||d||g),b=B.useRef(null),R=kZ({onSessionStart:d,onSessionEnd:g,onStart:a,onMove:s,onEnd(O,N){b.current=null,l==null||l(O,N)}});B.useEffect(()=>{var O;(O=b.current)==null||O.updateHandlers(R.current)}),B.useEffect(()=>{const O=r.current;if(!O||!S)return;function N(U){b.current=new t1e(U,R.current,E)}return MO(O,"pointerdown",N)},[r,S,R,E]),B.useEffect(()=>()=>{var O;(O=b.current)==null||O.end(),b.current=null},[])}function a1e(r,t){if(!r){t(void 0);return}t({width:r.offsetWidth,height:r.offsetHeight});const s=r.ownerDocument.defaultView??window,a=new s.ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const[d]=l;let g,E;if("borderBoxSize"in d){const S=d.borderBoxSize,b=Array.isArray(S)?S[0]:S;g=b.inlineSize,E=b.blockSize}else g=r.offsetWidth,E=r.offsetHeight;t({width:g,height:E})});return a.observe(r,{box:"border-box"}),()=>a.unobserve(r)}var c1e=globalThis!=null&&globalThis.document?B.useLayoutEffect:B.useEffect;function l1e(r,t){var s,a;if(!r||!r.parentElement)return;const l=(a=(s=r.ownerDocument)==null?void 0:s.defaultView)!=null?a:window,d=new l.MutationObserver(()=>{t()});return d.observe(r.parentElement,{childList:!0}),()=>{d.disconnect()}}function u1e({getNodes:r,observeMutation:t=!0}){const[s,a]=B.useState([]),[l,d]=B.useState(0);return c1e(()=>{const g=r(),E=g.map((S,b)=>a1e(S,R=>{a(O=>[...O.slice(0,b),R,...O.slice(b+1)])}));if(t){const S=g[0];E.push(l1e(S,()=>{d(b=>b+1)}))}return()=>{E.forEach(S=>{S==null||S()})}},[l]),s}function d1e(r){return typeof r=="object"&&r!==null&&"current"in r}function h1e(r){const[t]=u1e({observeMutation:!1,getNodes(){return[d1e(r)?r.current:r]}});return t}function p1e(r){var t;const{min:s=0,max:a=100,onChange:l,value:d,defaultValue:g,isReversed:E,direction:S="ltr",orientation:b="horizontal",id:R,isDisabled:O,isReadOnly:N,onChangeStart:U,onChangeEnd:K,step:z=1,getAriaValueText:H,"aria-valuetext":ne,"aria-label":J,"aria-labelledby":se,name:le,focusThumbOnChange:ce=!0,...Se}=r,Z=Rc(U),te=Rc(K),ie=Rc(H),ae=zDe({isReversed:E,direction:S,orientation:b}),[ve,pe]=YJ({value:d,defaultValue:g??m1e(s,a),onChange:l}),[de,ut]=B.useState(!1),[mt,Ze]=B.useState(!1),Be=!(O||N),Ke=(a-s)/10,nt=z||(a-s)/100,Ee=zx(ve,s,a),Ye=a-Ee+s,ot=Z$(ae?Ye:Ee,s,a),Ve=b==="vertical",et=kZ({min:s,max:a,step:z,isDisabled:O,value:Ee,isInteractive:Be,isReversed:ae,isVertical:Ve,eventSource:null,focusThumbOnChange:ce,orientation:b}),gt=B.useRef(null),Dt=B.useRef(null),Gt=B.useRef(null),Bt=B.useId(),Vn=R??Bt,[Dn,un]=[`slider-thumb-${Vn}`,`slider-track-${Vn}`],gr=B.useCallback(Lt=>{var dn,Zs;if(!gt.current)return;const sr=et.current;sr.eventSource="pointer";const zi=gt.current.getBoundingClientRect(),{clientX:Nc,clientY:Ga}=(Zs=(dn=Lt.touches)==null?void 0:dn[0])!=null?Zs:Lt,fo=Ve?zi.bottom-Ga:Nc-zi.left,za=Ve?zi.height:zi.width;let xi=fo/za;ae&&(xi=1-xi);let Cs=GAe(xi,sr.min,sr.max);return sr.step&&(Cs=parseFloat(e7(Cs,sr.min,sr.step))),Cs=zx(Cs,sr.min,sr.max),Cs},[Ve,ae,et]),Ar=B.useCallback(Lt=>{const dn=et.current;dn.isInteractive&&(Lt=parseFloat(e7(Lt,dn.min,nt)),Lt=zx(Lt,dn.min,dn.max),pe(Lt))},[nt,pe,et]),bt=B.useMemo(()=>({stepUp(Lt=nt){const dn=ae?Ee-Lt:Ee+Lt;Ar(dn)},stepDown(Lt=nt){const dn=ae?Ee+Lt:Ee-Lt;Ar(dn)},reset(){Ar(g||0)},stepTo(Lt){Ar(Lt)}}),[Ar,ae,Ee,nt,g]),Sn=B.useCallback(Lt=>{const dn=et.current,sr={ArrowRight:()=>bt.stepUp(),ArrowUp:()=>bt.stepUp(),ArrowLeft:()=>bt.stepDown(),ArrowDown:()=>bt.stepDown(),PageUp:()=>bt.stepUp(Ke),PageDown:()=>bt.stepDown(Ke),Home:()=>Ar(dn.min),End:()=>Ar(dn.max)}[Lt.key];sr&&(Lt.preventDefault(),Lt.stopPropagation(),sr(Lt),dn.eventSource="keyboard")},[bt,Ar,Ke,et]),Tn=(t=ie==null?void 0:ie(Ee))!=null?t:ne,we=h1e(Dt),{getThumbStyle:De,rootStyle:We,trackStyle:pt,innerTrackStyle:ft}=B.useMemo(()=>{const Lt=et.current,dn=we??{width:0,height:0};return GDe({isReversed:ae,orientation:Lt.orientation,thumbRects:[dn],thumbPercents:[ot]})},[ae,we,ot,et]),dt=B.useCallback(()=>{et.current.focusThumbOnChange&&setTimeout(()=>{var dn;return(dn=Dt.current)==null?void 0:dn.focus()})},[et]);V_(()=>{const Lt=et.current;dt(),Lt.eventSource==="keyboard"&&(te==null||te(Lt.value))},[Ee,te]);function Mt(Lt){const dn=gr(Lt);dn!=null&&dn!==et.current.value&&pe(dn)}o1e(Gt,{onPanSessionStart(Lt){const dn=et.current;dn.isInteractive&&(ut(!0),dt(),Mt(Lt),Z==null||Z(dn.value))},onPanSessionEnd(){const Lt=et.current;Lt.isInteractive&&(ut(!1),te==null||te(Lt.value))},onPan(Lt){et.current.isInteractive&&Mt(Lt)}});const Fn=B.useCallback((Lt={},dn=null)=>({...Lt,...Se,ref:Qi(dn,Gt),tabIndex:-1,"aria-disabled":sM(O),"data-focused":dy(mt),style:{...Lt.style,...We}}),[Se,O,mt,We]),Cn=B.useCallback((Lt={},dn=null)=>({...Lt,ref:Qi(dn,gt),id:un,"data-disabled":dy(O),style:{...Lt.style,...pt}}),[O,un,pt]),tn=B.useCallback((Lt={},dn=null)=>({...Lt,ref:dn,style:{...Lt.style,...ft}}),[ft]),_r=B.useCallback((Lt={},dn=null)=>({...Lt,ref:Qi(dn,Dt),role:"slider",tabIndex:Be?0:void 0,id:Dn,"data-active":dy(de),"aria-valuetext":Tn,"aria-valuemin":s,"aria-valuemax":a,"aria-valuenow":Ee,"aria-orientation":b,"aria-disabled":sM(O),"aria-readonly":sM(N),"aria-label":J,"aria-labelledby":J?void 0:se,style:{...Lt.style,...De(0)},onKeyDown:oM(Lt.onKeyDown,Sn),onFocus:oM(Lt.onFocus,()=>Ze(!0)),onBlur:oM(Lt.onBlur,()=>Ze(!1))}),[Be,Dn,de,Tn,s,a,Ee,b,O,N,J,se,De,Sn]),ya=B.useCallback((Lt,dn=null)=>{const Zs=!(Lt.value<s||Lt.value>a),sr=Ee>=Lt.value,zi=Z$(Lt.value,s,a),Nc={position:"absolute",pointerEvents:"none",...f1e({orientation:b,vertical:{bottom:ae?`${100-zi}%`:`${zi}%`},horizontal:{left:ae?`${100-zi}%`:`${zi}%`}})};return{...Lt,ref:dn,role:"presentation","aria-hidden":!0,"data-disabled":dy(O),"data-invalid":dy(!Zs),"data-highlighted":dy(sr),style:{...Lt.style,...Nc}}},[O,ae,a,s,b,Ee]),ps=B.useCallback((Lt={},dn=null)=>({...Lt,ref:dn,type:"hidden",value:Ee,name:le}),[le,Ee]);return{state:{value:Ee,isFocused:mt,isDragging:de},actions:bt,getRootProps:Fn,getTrackProps:Cn,getInnerTrackProps:tn,getThumbProps:_r,getMarkerProps:ya,getInputProps:ps}}function f1e(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function m1e(r,t){return t<r?r:r+(t-r)/2}var[g1e,sN]=Gi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[_1e,oN]=Gi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),S2=qt((r,t)=>{var s;const a={...r,orientation:(s=r==null?void 0:r.orientation)!=null?s:"horizontal"},l=Pc("Slider",a),d=es(a),{direction:g}=dS();d.direction=g;const{getInputProps:E,getRootProps:S,...b}=p1e(d),R=S(),O=E({},t);return F.jsx(g1e,{value:b,children:F.jsx(_1e,{value:l,children:F.jsxs(Nt.div,{...R,className:kw("chakra-slider",a.className),__css:l.container,children:[a.children,F.jsx("input",{...O})]})})})});S2.displayName="Slider";var T2=qt((r,t)=>{const{getThumbProps:s}=sN(),a=oN(),l=s(r,t);return F.jsx(Nt.div,{...l,className:kw("chakra-slider__thumb",r.className),__css:a.thumb})});T2.displayName="SliderThumb";var b2=qt((r,t)=>{const{getTrackProps:s}=sN(),a=oN(),l=s(r,t);return F.jsx(Nt.div,{...l,className:kw("chakra-slider__track",r.className),__css:a.track})});b2.displayName="SliderTrack";var w2=qt((r,t)=>{const{getInnerTrackProps:s}=sN(),a=oN(),l=s(r,t);return F.jsx(Nt.div,{...l,className:kw("chakra-slider__filled-track",r.className),__css:a.filledTrack})});w2.displayName="SliderFilledTrack";var v1e=qt((r,t)=>{const{getMarkerProps:s}=sN(),a=oN(),l=s(r,t);return F.jsx(Nt.div,{...l,className:kw("chakra-slider__marker",r.className),__css:a.mark})});v1e.displayName="SliderMark";var UO=qt(function(t,s){const a=Pc("Switch",t),{spacing:l="0.5rem",children:d,...g}=es(t),{getIndicatorProps:E,getInputProps:S,getCheckboxProps:b,getRootProps:R,getLabelProps:O}=VAe(g),N=B.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),U=B.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),K=B.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return F.jsxs(Nt.label,{...R(),className:Un("chakra-switch",t.className),__css:N,children:[F.jsx("input",{className:"chakra-switch__input",...S({},s)}),F.jsx(Nt.span,{...b(),className:"chakra-switch__track",__css:U,children:F.jsx(Nt.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&F.jsx(Nt.span,{className:"chakra-switch__label",...O(),__css:K,children:d})]})});UO.displayName="Switch";var[E1e,y1e,S1e,T1e]=qJ();function b1e(r){var t;const{defaultIndex:s,onChange:a,index:l,isManual:d,isLazy:g,lazyBehavior:E="unmount",orientation:S="horizontal",direction:b="ltr",...R}=r,[O,N]=B.useState(s??0),[U,K]=YJ({defaultValue:s??0,value:l,onChange:a});B.useEffect(()=>{l!=null&&N(l)},[l]);const z=S1e(),H=B.useId();return{id:`tabs-${(t=r.id)!=null?t:H}`,selectedIndex:U,focusedIndex:O,setSelectedIndex:K,setFocusedIndex:N,isManual:d,isLazy:g,lazyBehavior:E,orientation:S,descendants:z,direction:b,htmlProps:R}}var[w1e,aN]=Gi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function R1e(r){const{focusedIndex:t,orientation:s,direction:a}=aN(),l=y1e(),d=B.useCallback(g=>{const E=()=>{var J;const se=l.nextEnabled(t);se&&((J=se.node)==null||J.focus())},S=()=>{var J;const se=l.prevEnabled(t);se&&((J=se.node)==null||J.focus())},b=()=>{var J;const se=l.firstEnabled();se&&((J=se.node)==null||J.focus())},R=()=>{var J;const se=l.lastEnabled();se&&((J=se.node)==null||J.focus())},O=s==="horizontal",N=s==="vertical",U=g.key,K=a==="ltr"?"ArrowLeft":"ArrowRight",z=a==="ltr"?"ArrowRight":"ArrowLeft",ne={[K]:()=>O&&S(),[z]:()=>O&&E(),ArrowDown:()=>N&&E(),ArrowUp:()=>N&&S(),Home:b,End:R}[U];ne&&(g.preventDefault(),ne(g))},[l,t,s,a]);return{...r,role:"tablist","aria-orientation":s,onKeyDown:nr(r.onKeyDown,d)}}function C1e(r){const{isDisabled:t=!1,isFocusable:s=!1,...a}=r,{setSelectedIndex:l,isManual:d,id:g,setFocusedIndex:E,selectedIndex:S}=aN(),{index:b,register:R}=T1e({disabled:t&&!s}),O=b===S,N=()=>{l(b)},U=()=>{E(b),!d&&!(t&&s)&&l(b)};return{...$Pe({...a,ref:Qi(R,r.ref),isDisabled:t,isFocusable:s,onClick:nr(r.onClick,N)}),id:DZ(g,b),role:"tab",tabIndex:O?0:-1,type:"button","aria-selected":O,"aria-controls":LZ(g,b),onFocus:t?void 0:nr(r.onFocus,U)}}var[I1e,A1e]=Gi({});function O1e(r){const t=aN(),{id:s,selectedIndex:a}=t,d=XU(r.children).map((g,E)=>B.createElement(I1e,{key:E,value:{isSelected:E===a,id:LZ(s,E),tabId:DZ(s,E),selectedIndex:a}},g));return{...r,children:d}}function P1e(r){const{children:t,...s}=r,{isLazy:a,lazyBehavior:l}=aN(),{isSelected:d,id:g,tabId:E}=A1e(),S=B.useRef(!1);d&&(S.current=!0);const b=wV({wasSelected:S.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:b?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:g}}function DZ(r,t){return`${r}--tab-${t}`}function LZ(r,t){return`${r}--tabpanel-${t}`}var[N1e,cN]=Gi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),xZ=qt(function(t,s){const a=Pc("Tabs",t),{children:l,className:d,...g}=es(t),{htmlProps:E,descendants:S,...b}=b1e(g),R=B.useMemo(()=>b,[b]),{isFitted:O,...N}=E,U={position:"relative",...a.root};return F.jsx(E1e,{value:S,children:F.jsx(w1e,{value:R,children:F.jsx(N1e,{value:a,children:F.jsx(Nt.div,{className:Un("chakra-tabs",d),ref:s,...N,__css:U,children:l})})})})});xZ.displayName="Tabs";var MZ=qt(function(t,s){const a=R1e({...t,ref:s}),d={display:"flex",...cN().tablist};return F.jsx(Nt.div,{...a,className:Un("chakra-tabs__tablist",t.className),__css:d})});MZ.displayName="TabList";var R2=qt(function(t,s){const a=P1e({...t,ref:s}),l=cN();return F.jsx(Nt.div,{outline:"0",...a,className:Un("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});R2.displayName="TabPanel";var UZ=qt(function(t,s){const a=O1e(t),l=cN();return F.jsx(Nt.div,{...a,width:"100%",ref:s,className:Un("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});UZ.displayName="TabPanels";var C2=qt(function(t,s){const a=cN(),l=C1e({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return F.jsx(Nt.button,{...l,className:Un("chakra-tabs__tab",t.className),__css:d})});C2.displayName="Tab";var k1e={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},I2=r=>{var t;return((t=r.current)==null?void 0:t.ownerDocument)||document},VO=r=>{var t,s;return((s=(t=r.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function D1e(r={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:g=l,closeOnEsc:E=!0,onOpen:S,onClose:b,placement:R,id:O,isOpen:N,defaultIsOpen:U,arrowSize:K=10,arrowShadowColor:z,arrowPadding:H,modifiers:ne,isDisabled:J,gutter:se,offset:le,direction:ce,...Se}=r,{isOpen:Z,onOpen:te,onClose:ie}=bV({isOpen:N,defaultIsOpen:U,onOpen:S,onClose:b}),{referenceRef:ae,getPopperProps:ve,getArrowInnerProps:pe,getArrowProps:de}=TV({enabled:Z,placement:R,arrowPadding:H,modifiers:ne,gutter:se,offset:le,direction:ce}),ut=B.useId(),Ze=`tooltip-${O??ut}`,Be=B.useRef(null),Ke=B.useRef(),nt=B.useCallback(()=>{Ke.current&&(clearTimeout(Ke.current),Ke.current=void 0)},[]),Ee=B.useRef(),Ye=B.useCallback(()=>{Ee.current&&(clearTimeout(Ee.current),Ee.current=void 0)},[]),Et=B.useCallback(()=>{Ye(),ie()},[ie,Ye]),ot=L1e(Be,Et),Ve=B.useCallback(()=>{if(!J&&!Ke.current){Z&&ot();const un=VO(Be);Ke.current=un.setTimeout(te,t)}},[ot,J,Z,te,t]),et=B.useCallback(()=>{nt();const un=VO(Be);Ee.current=un.setTimeout(Et,s)},[s,Et,nt]),gt=B.useCallback(()=>{Z&&a&&et()},[a,et,Z]),Dt=B.useCallback(()=>{Z&&g&&et()},[g,et,Z]),Gt=B.useCallback(un=>{Z&&un.key==="Escape"&&et()},[Z,et]);Uy(()=>I2(Be),"keydown",E?Gt:void 0),Uy(()=>{if(!d)return null;const un=Be.current;if(!un)return null;const gr=MQ(un);return gr.localName==="body"?VO(Be):gr},"scroll",()=>{Z&&d&&Et()},{passive:!0,capture:!0}),B.useEffect(()=>{J&&(nt(),Z&&ie())},[J,Z,ie,nt]),B.useEffect(()=>()=>{nt(),Ye()},[nt,Ye]),Uy(()=>Be.current,"pointerleave",et);const Bt=B.useCallback((un={},gr=null)=>({...un,ref:Qi(Be,gr,ae),onPointerEnter:nr(un.onPointerEnter,bt=>{bt.pointerType!=="touch"&&Ve()}),onClick:nr(un.onClick,gt),onPointerDown:nr(un.onPointerDown,Dt),onFocus:nr(un.onFocus,Ve),onBlur:nr(un.onBlur,et),"aria-describedby":Z?Ze:void 0}),[Ve,et,Dt,Z,Ze,gt,ae]),Vn=B.useCallback((un={},gr=null)=>ve({...un,style:{...un.style,[xs.arrowSize.var]:K?`${K}px`:void 0,[xs.arrowShadowColor.var]:z}},gr),[ve,K,z]),Dn=B.useCallback((un={},gr=null)=>{const Ar={...un.style,position:"relative",transformOrigin:xs.transformOrigin.varRef};return{ref:gr,...Se,...un,id:Ze,role:"tooltip",style:Ar}},[Se,Ze]);return{isOpen:Z,show:Ve,hide:et,getTriggerProps:Bt,getTooltipProps:Dn,getTooltipPositionerProps:Vn,getArrowProps:de,getArrowInnerProps:pe}}var lM="chakra-ui:close-tooltip";function L1e(r,t){return B.useEffect(()=>{const s=I2(r);return s.addEventListener(lM,t),()=>s.removeEventListener(lM,t)},[t,r]),()=>{const s=I2(r),a=VO(r);s.dispatchEvent(new a.CustomEvent(lM))}}function x1e(r,t=[]){const s=Object.assign({},r);for(const a of t)a in s&&delete s[a];return s}function M1e(r,t){const s={};for(const a of t)a in r&&(s[a]=r[a]);return s}var U1e=Nt(Fp.div),Dw=qt((r,t)=>{var s,a;const l=Qu("Tooltip",r),d=es(r),g=dS(),{children:E,label:S,shouldWrapChildren:b,"aria-label":R,hasArrow:O,bg:N,portalProps:U,background:K,backgroundColor:z,bgColor:H,motionProps:ne,...J}=d,se=(a=(s=K??z)!=null?s:N)!=null?a:H;if(se){l.bg=se;const ve=i_e(g,"colors",se);l[xs.arrowBg.var]=ve}const le=D1e({...J,direction:g.direction}),ce=typeof E=="string"||b;let Se;if(ce)Se=F.jsx(Nt.span,{display:"inline-block",tabIndex:0,...le.getTriggerProps(),children:E});else{const ve=B.Children.only(E);Se=B.cloneElement(ve,le.getTriggerProps(ve.props,ve.ref))}const Z=!!R,te=le.getTooltipProps({},t),ie=Z?x1e(te,["role","id"]):te,ae=M1e(te,["role","id"]);return S?F.jsxs(F.Fragment,{children:[Se,F.jsx(pS,{children:le.isOpen&&F.jsx(Ju,{...U,children:F.jsx(Nt.div,{...le.getTooltipPositionerProps(),__css:{zIndex:l.zIndex,pointerEvents:"none"},children:F.jsxs(U1e,{variants:k1e,initial:"exit",animate:"enter",exit:"exit",...ne,...ie,__css:l,children:[S,Z&&F.jsx(Nt.span,{srOnly:!0,...ae,children:R}),O&&F.jsx(Nt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:F.jsx(Nt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:l.bg}})})]})})})})]}):F.jsx(F.Fragment,{children:E})});Dw.displayName="Tooltip";const V1e="modulepreload",F1e=function(r,t){return new URL(r,t).href},D7={},uM=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const g=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),S=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(s.map(b=>{if(b=F1e(b,a),b in D7)return;D7[b]=!0;const R=b.endsWith(".css"),O=R?'[rel="stylesheet"]':"";if(!!a)for(let K=g.length-1;K>=0;K--){const z=g[K];if(z.href===b&&(!R||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${O}`))return;const U=document.createElement("link");if(U.rel=R?"stylesheet":V1e,R||(U.as="script"),U.crossOrigin="",U.href=b,S&&U.setAttribute("nonce",S),document.head.appendChild(U),R)return new Promise((K,z)=>{U.addEventListener("load",K),U.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(g){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=g,window.dispatchEvent(E),!E.defaultPrevented)throw g}return l.then(g=>{for(const E of g||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},aO=()=>{const r=new Date,t=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0"),a=r.getSeconds().toString().padStart(2,"0"),l=r.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},It={log:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${aO()}] `,...t)}},error:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${aO()}] `,...t)}},warn:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${aO()}]`,...t)}},trace:r=>{console.trace(`[TRACE] [${aO()}] ${r}`)}};async function j1e(r){let t;try{switch(r){case"default":t=await uM(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await uM(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(s){return It.error("Failed to load theme:",s),t=await uM(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}var L7={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VZ=function(r){const t=[];let s=0;for(let a=0;a<r.length;a++){let l=r.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<r.length&&(r.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(r.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},B1e=function(r){const t=[];let s=0,a=0;for(;s<r.length;){const l=r[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=r[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=r[s++],g=r[s++],E=r[s++],S=((l&7)<<18|(d&63)<<12|(g&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(S>>10)),t[a++]=String.fromCharCode(56320+(S&1023))}else{const d=r[s++],g=r[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|g&63)}}return t.join("")},FZ={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<r.length;l+=3){const d=r[l],g=l+1<r.length,E=g?r[l+1]:0,S=l+2<r.length,b=S?r[l+2]:0,R=d>>2,O=(d&3)<<4|E>>4;let N=(E&15)<<2|b>>6,U=b&63;S||(U=64,g||(N=64)),a.push(s[R],s[O],s[N],s[U])}return a.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(VZ(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):B1e(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<r.length;){const d=s[r.charAt(l++)],E=l<r.length?s[r.charAt(l)]:0;++l;const b=l<r.length?s[r.charAt(l)]:64;++l;const O=l<r.length?s[r.charAt(l)]:64;if(++l,d==null||E==null||b==null||O==null)throw new W1e;const N=d<<2|E>>4;if(a.push(N),b!==64){const U=E<<4&240|b>>2;if(a.push(U),O!==64){const K=b<<6&192|O;a.push(K)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class W1e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const G1e=function(r){const t=VZ(r);return FZ.encodeByteArray(t,!0)},fP=function(r){return G1e(r).replace(/\./g,"")},jZ=function(r){try{return FZ.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z1e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H1e=()=>z1e().__FIREBASE_DEFAULTS__,K1e=()=>{if(typeof process>"u"||typeof L7>"u")return;const r=L7.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},$1e=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&jZ(r[1]);return t&&JSON.parse(t)},lN=()=>{try{return H1e()||K1e()||$1e()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},BZ=r=>{var t,s;return(s=(t=lN())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[r]},WZ=r=>{const t=BZ(r);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},GZ=()=>{var r;return(r=lN())===null||r===void 0?void 0:r.config},zZ=r=>{var t;return(t=lN())===null||t===void 0?void 0:t[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HZ(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=r.iat||0,d=r.sub||r.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const g=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},r);return[fP(JSON.stringify(s)),fP(JSON.stringify(g)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ea(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Y1e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ea())}function X1e(){var r;const t=(r=lN())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function J1e(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Q1e(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Z1e(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function eLe(){const r=Ea();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function tLe(){return!X1e()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function nLe(){try{return typeof indexedDB=="object"}catch{return!1}}function rLe(){return new Promise((r,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),r(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iLe="FirebaseError";class _h extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=iLe,Object.setPrototypeOf(this,_h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Lw.prototype.create)}}class Lw{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],g=d?sLe(d,a):"Error",E=`${this.serviceName}: ${g} (${l}).`;return new _h(l,E,a)}}function sLe(r,t){return r.replace(oLe,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const oLe=/\{\$([^}]+)}/g;function aLe(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function mP(r,t){if(r===t)return!0;const s=Object.keys(r),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=r[l],g=t[l];if(x7(d)&&x7(g)){if(!mP(d,g))return!1}else if(d!==g)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function x7(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xw(r){const t=[];for(const[s,a]of Object.entries(r))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function hb(r){const t={};return r.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function pb(r){const t=r.indexOf("?");if(!t)return"";const s=r.indexOf("#",t);return r.substring(t,s>0?s:void 0)}function cLe(r,t){const s=new lLe(r,t);return s.subscribe.bind(s)}class lLe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");uLe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=dM),l.error===void 0&&(l.error=dM),l.complete===void 0&&(l.complete=dM);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function uLe(r,t){if(typeof r!="object"||r===null)return!1;for(const s of t)if(s in r&&typeof r[s]=="function")return!0;return!1}function dM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ms(r){return r&&r._delegate?r._delegate:r}class bm{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dLe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new q1e;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(pLe(t))try{this.getOrInitializeService({instanceIdentifier:v_})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=v_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=v_){return this.instances.has(t)}getOptions(t=v_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,g]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&g.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const g=this.instances.get(l);return g&&t(g,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:hLe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=v_){return this.component?this.component.multipleInstances?t:v_:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function hLe(r){return r===v_?void 0:r}function pLe(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fLe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new dLe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var br;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(br||(br={}));const mLe={debug:br.DEBUG,verbose:br.VERBOSE,info:br.INFO,warn:br.WARN,error:br.ERROR,silent:br.SILENT},gLe=br.INFO,_Le={[br.DEBUG]:"log",[br.VERBOSE]:"log",[br.INFO]:"info",[br.WARN]:"warn",[br.ERROR]:"error"},vLe=(r,t,...s)=>{if(t<r.logLevel)return;const a=new Date().toISOString(),l=_Le[t];if(l)console[l](`[${a}]  ${r.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class CV{constructor(t){this.name=t,this._logLevel=gLe,this._logHandler=vLe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in br))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?mLe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,br.DEBUG,...t),this._logHandler(this,br.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,br.VERBOSE,...t),this._logHandler(this,br.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,br.INFO,...t),this._logHandler(this,br.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,br.WARN,...t),this._logHandler(this,br.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,br.ERROR,...t),this._logHandler(this,br.ERROR,...t)}}const ELe=(r,t)=>t.some(s=>r instanceof s);let M7,U7;function yLe(){return M7||(M7=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function SLe(){return U7||(U7=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const KZ=new WeakMap,A2=new WeakMap,$Z=new WeakMap,hM=new WeakMap,IV=new WeakMap;function TLe(r){const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("success",d),r.removeEventListener("error",g)},d=()=>{s(mm(r.result)),l()},g=()=>{a(r.error),l()};r.addEventListener("success",d),r.addEventListener("error",g)});return t.then(s=>{s instanceof IDBCursor&&KZ.set(s,r)}).catch(()=>{}),IV.set(t,r),t}function bLe(r){if(A2.has(r))return;const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("complete",d),r.removeEventListener("error",g),r.removeEventListener("abort",g)},d=()=>{s(),l()},g=()=>{a(r.error||new DOMException("AbortError","AbortError")),l()};r.addEventListener("complete",d),r.addEventListener("error",g),r.addEventListener("abort",g)});A2.set(r,t)}let O2={get(r,t,s){if(r instanceof IDBTransaction){if(t==="done")return A2.get(r);if(t==="objectStoreNames")return r.objectStoreNames||$Z.get(r);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return mm(r[t])},set(r,t,s){return r[t]=s,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function wLe(r){O2=r(O2)}function RLe(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=r.call(pM(this),t,...s);return $Z.set(a,t.sort?t.sort():[t]),mm(a)}:SLe().includes(r)?function(...t){return r.apply(pM(this),t),mm(KZ.get(this))}:function(...t){return mm(r.apply(pM(this),t))}}function CLe(r){return typeof r=="function"?RLe(r):(r instanceof IDBTransaction&&bLe(r),ELe(r,yLe())?new Proxy(r,O2):r)}function mm(r){if(r instanceof IDBRequest)return TLe(r);if(hM.has(r))return hM.get(r);const t=CLe(r);return t!==r&&(hM.set(r,t),IV.set(t,r)),t}const pM=r=>IV.get(r);function ILe(r,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const g=indexedDB.open(r,t),E=mm(g);return a&&g.addEventListener("upgradeneeded",S=>{a(mm(g.result),S.oldVersion,S.newVersion,mm(g.transaction),S)}),s&&g.addEventListener("blocked",S=>s(S.oldVersion,S.newVersion,S)),E.then(S=>{d&&S.addEventListener("close",()=>d()),l&&S.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),E}const ALe=["get","getKey","getAll","getAllKeys","count"],OLe=["put","add","delete","clear"],fM=new Map;function V7(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(fM.get(t))return fM.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=OLe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||ALe.includes(s)))return;const d=async function(g,...E){const S=this.transaction(g,l?"readwrite":"readonly");let b=S.store;return a&&(b=b.index(E.shift())),(await Promise.all([b[s](...E),l&&S.done]))[0]};return fM.set(t,d),d}wLe(r=>({...r,get:(t,s,a)=>V7(t,s)||r.get(t,s,a),has:(t,s)=>!!V7(t,s)||r.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PLe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(NLe(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function NLe(r){const t=r.getComponent();return(t==null?void 0:t.type)==="VERSION"}const P2="@firebase/app",F7="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lp=new CV("@firebase/app"),kLe="@firebase/app-compat",DLe="@firebase/analytics-compat",LLe="@firebase/analytics",xLe="@firebase/app-check-compat",MLe="@firebase/app-check",ULe="@firebase/auth",VLe="@firebase/auth-compat",FLe="@firebase/database",jLe="@firebase/data-connect",BLe="@firebase/database-compat",WLe="@firebase/functions",GLe="@firebase/functions-compat",zLe="@firebase/installations",HLe="@firebase/installations-compat",KLe="@firebase/messaging",$Le="@firebase/messaging-compat",qLe="@firebase/performance",YLe="@firebase/performance-compat",XLe="@firebase/remote-config",JLe="@firebase/remote-config-compat",QLe="@firebase/storage",ZLe="@firebase/storage-compat",exe="@firebase/firestore",txe="@firebase/vertexai-preview",nxe="@firebase/firestore-compat",rxe="firebase",ixe="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N2="[DEFAULT]",sxe={[P2]:"fire-core",[kLe]:"fire-core-compat",[LLe]:"fire-analytics",[DLe]:"fire-analytics-compat",[MLe]:"fire-app-check",[xLe]:"fire-app-check-compat",[ULe]:"fire-auth",[VLe]:"fire-auth-compat",[FLe]:"fire-rtdb",[jLe]:"fire-data-connect",[BLe]:"fire-rtdb-compat",[WLe]:"fire-fn",[GLe]:"fire-fn-compat",[zLe]:"fire-iid",[HLe]:"fire-iid-compat",[KLe]:"fire-fcm",[$Le]:"fire-fcm-compat",[qLe]:"fire-perf",[YLe]:"fire-perf-compat",[XLe]:"fire-rc",[JLe]:"fire-rc-compat",[QLe]:"fire-gcs",[ZLe]:"fire-gcs-compat",[exe]:"fire-fst",[nxe]:"fire-fst-compat",[txe]:"fire-vertex","fire-js":"fire-js",[rxe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gP=new Map,oxe=new Map,k2=new Map;function j7(r,t){try{r.container.addComponent(t)}catch(s){Lp.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,s)}}function z_(r){const t=r.name;if(k2.has(t))return Lp.debug(`There were multiple attempts to register component ${t}.`),!1;k2.set(t,r);for(const s of gP.values())j7(s,r);for(const s of oxe.values())j7(s,r);return!0}function uN(r,t){const s=r.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),r.container.getProvider(t)}function eh(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const axe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},gm=new Lw("app","Firebase",axe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cxe{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new bm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw gm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q_=ixe;function qZ(r,t={}){let s=r;typeof t!="object"&&(t={name:t});const a=Object.assign({name:N2,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw gm.create("bad-app-name",{appName:String(l)});if(s||(s=GZ()),!s)throw gm.create("no-options");const d=gP.get(l);if(d){if(mP(s,d.options)&&mP(a,d.config))return d;throw gm.create("duplicate-app",{appName:l})}const g=new fLe(l);for(const S of k2.values())g.addComponent(S);const E=new cxe(s,a,g);return gP.set(l,E),E}function AV(r=N2){const t=gP.get(r);if(!t&&r===N2&&GZ())return qZ();if(!t)throw gm.create("no-app",{appName:r});return t}function oh(r,t,s){var a;let l=(a=sxe[r])!==null&&a!==void 0?a:r;s&&(l+=`-${s}`);const d=l.match(/\s|\//),g=t.match(/\s|\//);if(d||g){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&g&&E.push("and"),g&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Lp.warn(E.join(" "));return}z_(new bm(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lxe="firebase-heartbeat-database",uxe=1,sw="firebase-heartbeat-store";let mM=null;function YZ(){return mM||(mM=ILe(lxe,uxe,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(sw)}catch(s){console.warn(s)}}}}).catch(r=>{throw gm.create("idb-open",{originalErrorMessage:r.message})})),mM}async function dxe(r){try{const s=(await YZ()).transaction(sw),a=await s.objectStore(sw).get(XZ(r));return await s.done,a}catch(t){if(t instanceof _h)Lp.warn(t.message);else{const s=gm.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Lp.warn(s.message)}}}async function B7(r,t){try{const a=(await YZ()).transaction(sw,"readwrite");await a.objectStore(sw).put(t,XZ(r)),await a.done}catch(s){if(s instanceof _h)Lp.warn(s.message);else{const a=gm.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Lp.warn(a.message)}}}function XZ(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hxe=1024,pxe=30*24*60*60*1e3;class fxe{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new gxe(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=W7();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(g=>g.date===d)?void 0:(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(g=>{const E=new Date(g.date).valueOf();return Date.now()-E<=pxe}),this._storage.overwrite(this._heartbeatsCache))}catch(a){Lp.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=W7(),{heartbeatsToSend:a,unsentEntries:l}=mxe(this._heartbeatsCache.heartbeats),d=fP(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return Lp.warn(s),""}}}function W7(){return new Date().toISOString().substring(0,10)}function mxe(r,t=hxe){const s=[];let a=r.slice();for(const l of r){const d=s.find(g=>g.agent===l.agent);if(d){if(d.dates.push(l.date),G7(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),G7(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class gxe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return nLe()?rLe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await dxe(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return B7(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return B7(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function G7(r){return fP(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _xe(r){z_(new bm("platform-logger",t=>new PLe(t),"PRIVATE")),z_(new bm("heartbeat",t=>new fxe(t),"PRIVATE")),oh(P2,F7,r),oh(P2,F7,"esm2017"),oh("fire-js","")}_xe("");function JZ(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const vxe=JZ,QZ=new Lw("auth","Firebase",JZ());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P=new CV("@firebase/auth");function Exe(r,...t){_P.logLevel<=br.WARN&&_P.warn(`Auth (${Q_}): ${r}`,...t)}function FO(r,...t){_P.logLevel<=br.ERROR&&_P.error(`Auth (${Q_}): ${r}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xu(r,...t){throw OV(r,...t)}function ah(r,...t){return OV(r,...t)}function ZZ(r,t,s){const a=Object.assign(Object.assign({},vxe()),{[t]:s});return new Lw("auth","Firebase",a).create(t,{appName:r.name})}function Pp(r){return ZZ(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function OV(r,...t){if(typeof r!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=r.name),r._errorFactory.create(s,...a)}return QZ.create(r,...t)}function kn(r,t,...s){if(!r)throw OV(t,...s)}function Tp(r){const t="INTERNAL ASSERTION FAILED: "+r;throw FO(t),new Error(t)}function xp(r,t){r||Tp(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D2(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function yxe(){return z7()==="http:"||z7()==="https:"}function z7(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sxe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(yxe()||Q1e()||"connection"in navigator)?navigator.onLine:!0}function Txe(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{constructor(t,s){this.shortDelay=t,this.longDelay=s,xp(s>t,"Short delay should be less than long delay!"),this.isMobile=Y1e()||Z1e()}get(){return Sxe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PV(r,t){xp(r.emulator,"Emulator should always be set here");const{url:s}=r.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eee{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Tp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Tp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Tp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bxe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wxe=new Mw(3e4,6e4);function km(r,t){return r.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:r.tenantId}):t}async function Dm(r,t,s,a,l={}){return tee(r,l,async()=>{let d={},g={};a&&(t==="GET"?g=a:d={body:JSON.stringify(a)});const E=xw(Object.assign({key:r.config.apiKey},g)).slice(1),S=await r._getAdditionalHeaders();S["Content-Type"]="application/json",r.languageCode&&(S["X-Firebase-Locale"]=r.languageCode);const b=Object.assign({method:t,headers:S},d);return J1e()||(b.referrerPolicy="no-referrer"),eee.fetch()(nee(r,r.config.apiHost,s,E),b)})}async function tee(r,t,s){r._canInitEmulator=!1;const a=Object.assign(Object.assign({},bxe),t);try{const l=new Cxe(r),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const g=await d.json();if("needConfirmation"in g)throw cO(r,"account-exists-with-different-credential",g);if(d.ok&&!("errorMessage"in g))return g;{const E=d.ok?g.errorMessage:g.error.message,[S,b]=E.split(" : ");if(S==="FEDERATED_USER_ID_ALREADY_LINKED")throw cO(r,"credential-already-in-use",g);if(S==="EMAIL_EXISTS")throw cO(r,"email-already-in-use",g);if(S==="USER_DISABLED")throw cO(r,"user-disabled",g);const R=a[S]||S.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw ZZ(r,R,b);Xu(r,R)}}catch(l){if(l instanceof _h)throw l;Xu(r,"network-request-failed",{message:String(l)})}}async function Uw(r,t,s,a,l={}){const d=await Dm(r,t,s,a,l);return"mfaPendingCredential"in d&&Xu(r,"multi-factor-auth-required",{_serverResponse:d}),d}function nee(r,t,s,a){const l=`${t}${s}?${a}`;return r.config.emulator?PV(r.config,l):`${r.config.apiScheme}://${l}`}function Rxe(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Cxe{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(ah(this.auth,"network-request-failed")),wxe.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function cO(r,t,s){const a={appName:r.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=ah(r,t,a);return l.customData._tokenResponse=s,l}function H7(r){return r!==void 0&&r.enterprise!==void 0}class Ixe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return Rxe(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}}async function Axe(r,t){return Dm(r,"GET","/v2/recaptchaConfig",km(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oxe(r,t){return Dm(r,"POST","/v1/accounts:delete",t)}async function ree(r,t){return Dm(r,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Db(r){if(r)try{const t=new Date(Number(r));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function Pxe(r,t=!1){const s=Ms(r),a=await s.getIdToken(t),l=NV(a);kn(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,g=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:Db(gM(l.auth_time)),issuedAtTime:Db(gM(l.iat)),expirationTime:Db(gM(l.exp)),signInProvider:g||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function gM(r){return Number(r)*1e3}function NV(r){const[t,s,a]=r.split(".");if(t===void 0||s===void 0||a===void 0)return FO("JWT malformed, contained fewer than 3 sections"),null;try{const l=jZ(s);return l?JSON.parse(l):(FO("Failed to decode base64 JWT payload"),null)}catch(l){return FO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function K7(r){const t=NV(r);return kn(t,"internal-error"),kn(typeof t.exp<"u","internal-error"),kn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ow(r,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof _h&&Nxe(a)&&r.auth.currentUser===r&&await r.auth.signOut(),a}}function Nxe({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kxe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Db(this.lastLoginAt),this.creationTime=Db(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vP(r){var t;const s=r.auth,a=await r.getIdToken(),l=await ow(r,ree(s,{idToken:a}));kn(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];r._notifyReloadListener(d);const g=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?iee(d.providerUserInfo):[],E=Lxe(r.providerData,g),S=r.isAnonymous,b=!(r.email&&d.passwordHash)&&!(E!=null&&E.length),R=S?b:!1,O={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new L2(d.createdAt,d.lastLoginAt),isAnonymous:R};Object.assign(r,O)}async function Dxe(r){const t=Ms(r);await vP(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Lxe(r,t){return[...r.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function iee(r){return r.map(t=>{var{providerId:s}=t,a=Ow(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xxe(r,t){const s=await tee(r,{},async()=>{const a=xw({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=r.config,g=nee(r,l,"/v1/token",`key=${d}`),E=await r._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",eee.fetch()(g,{method:"POST",headers:E,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function Mxe(r,t){return Dm(r,"POST","/v2/accounts:revokeToken",km(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){kn(t.idToken,"internal-error"),kn(typeof t.idToken<"u","internal-error"),kn(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):K7(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){kn(t.length!==0,"internal-error");const s=K7(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(kn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await xxe(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,g=new By;return a&&(kn(typeof a=="string","internal-error",{appName:t}),g.refreshToken=a),l&&(kn(typeof l=="string","internal-error",{appName:t}),g.accessToken=l),d&&(kn(typeof d=="number","internal-error",{appName:t}),g.expirationTime=d),g}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new By,this.toJSON())}_performRefresh(){return Tp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rm(r,t){kn(typeof r=="string"||typeof r>"u","internal-error",{appName:t})}class bp{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=Ow(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new kxe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new L2(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await ow(this,this.stsTokenManager.getToken(this.auth,t));return kn(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return Pxe(this,t)}reload(){return Dxe(this)}_assign(t){this!==t&&(kn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new bp(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){kn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await vP(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eh(this.auth.app))return Promise.reject(Pp(this.auth));const t=await this.getIdToken();return await ow(this,Oxe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,g,E,S,b,R;const O=(a=s.displayName)!==null&&a!==void 0?a:void 0,N=(l=s.email)!==null&&l!==void 0?l:void 0,U=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,K=(g=s.photoURL)!==null&&g!==void 0?g:void 0,z=(E=s.tenantId)!==null&&E!==void 0?E:void 0,H=(S=s._redirectEventId)!==null&&S!==void 0?S:void 0,ne=(b=s.createdAt)!==null&&b!==void 0?b:void 0,J=(R=s.lastLoginAt)!==null&&R!==void 0?R:void 0,{uid:se,emailVerified:le,isAnonymous:ce,providerData:Se,stsTokenManager:Z}=s;kn(se&&Z,t,"internal-error");const te=By.fromJSON(this.name,Z);kn(typeof se=="string",t,"internal-error"),rm(O,t.name),rm(N,t.name),kn(typeof le=="boolean",t,"internal-error"),kn(typeof ce=="boolean",t,"internal-error"),rm(U,t.name),rm(K,t.name),rm(z,t.name),rm(H,t.name),rm(ne,t.name),rm(J,t.name);const ie=new bp({uid:se,auth:t,email:N,emailVerified:le,displayName:O,isAnonymous:ce,photoURL:K,phoneNumber:U,tenantId:z,stsTokenManager:te,createdAt:ne,lastLoginAt:J});return Se&&Array.isArray(Se)&&(ie.providerData=Se.map(ae=>Object.assign({},ae))),H&&(ie._redirectEventId=H),ie}static async _fromIdTokenResponse(t,s,a=!1){const l=new By;l.updateFromServerResponse(s);const d=new bp({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await vP(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];kn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?iee(l.providerUserInfo):[],g=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new By;E.updateFromIdToken(a);const S=new bp({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:g}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new L2(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(S,b),S}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $7=new Map;function wp(r){xp(r instanceof Function,"Expected a class definition");let t=$7.get(r);return t?(xp(t instanceof r,"Instance stored in cache mismatched with class"),t):(t=new r,$7.set(r,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class see{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}see.type="NONE";const q7=see;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jO(r,t,s){return`firebase:${r}:${t}:${s}`}class Wy{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=jO(this.userKey,l.apiKey,d),this.fullPersistenceKey=jO("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?bp._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new Wy(wp(q7),t,a);const l=(await Promise.all(s.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||wp(q7);const g=jO(a,t.config.apiKey,t.name);let E=null;for(const b of s)try{const R=await b._get(g);if(R){const O=bp._fromJSON(t,R);b!==d&&(E=O),d=b;break}}catch{}const S=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!S.length?new Wy(d,t,a):(d=S[0],E&&await d._set(g,E.toJSON()),await Promise.all(s.map(async b=>{if(b!==d)try{await b._remove(g)}catch{}})),new Wy(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y7(r){const t=r.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(lee(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(oee(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(dee(t))return"Blackberry";if(hee(t))return"Webos";if(aee(t))return"Safari";if((t.includes("chrome/")||cee(t))&&!t.includes("edge/"))return"Chrome";if(uee(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=r.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function oee(r=Ea()){return/firefox\//i.test(r)}function aee(r=Ea()){const t=r.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function cee(r=Ea()){return/crios\//i.test(r)}function lee(r=Ea()){return/iemobile/i.test(r)}function uee(r=Ea()){return/android/i.test(r)}function dee(r=Ea()){return/blackberry/i.test(r)}function hee(r=Ea()){return/webos/i.test(r)}function kV(r=Ea()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function Uxe(r=Ea()){var t;return kV(r)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function Vxe(){return eLe()&&document.documentMode===10}function pee(r=Ea()){return kV(r)||uee(r)||hee(r)||dee(r)||/windows phone/i.test(r)||lee(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fee(r,t=[]){let s;switch(r){case"Browser":s=Y7(Ea());break;case"Worker":s=`${Y7(Ea())}-${r}`;break;default:s=r}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${Q_}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fxe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((g,E)=>{try{const S=t(d);g(S)}catch(S){E(S)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jxe(r,t={}){return Dm(r,"GET","/v2/passwordPolicy",km(r,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bxe=6;class Wxe{constructor(t){var s,a,l,d;const g=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=g.minPasswordLength)!==null&&s!==void 0?s:Bxe,g.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=g.maxPasswordLength),g.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=g.containsLowercaseCharacter),g.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=g.containsUppercaseCharacter),g.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=g.containsNumericCharacter),g.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=g.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,g,E;const S={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,S),this.validatePasswordCharacterOptions(t,S),S.isValid&&(S.isValid=(s=S.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),S.isValid&&(S.isValid=(a=S.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),S.isValid&&(S.isValid=(l=S.containsLowercaseLetter)!==null&&l!==void 0?l:!0),S.isValid&&(S.isValid=(d=S.containsUppercaseLetter)!==null&&d!==void 0?d:!0),S.isValid&&(S.isValid=(g=S.containsNumericCharacter)!==null&&g!==void 0?g:!0),S.isValid&&(S.isValid=(E=S.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),S}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gxe{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new X7(this),this.idTokenSubscription=new X7(this),this.beforeStateQueue=new Fxe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=QZ,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=wp(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await Wy.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await ree(this,{idToken:t}),a=await bp._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(eh(this.app)){const g=this.app.settings.authIdToken;return g?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(g).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const g=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,E=l==null?void 0:l._redirectEventId,S=await this.tryRedirectSignIn(t);(!g||g===E)&&(S!=null&&S.user)&&(l=S.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(g){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(g))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return kn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await vP(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=Txe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(eh(this.app))return Promise.reject(Pp(this));const s=t?Ms(t):null;return s&&kn(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&kn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return eh(this.app)?Promise.reject(Pp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return eh(this.app)?Promise.reject(Pp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(wp(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await jxe(this),s=new Wxe(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Lw("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await Mxe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&wp(t)||this._popupRedirectResolver;kn(s,this,"argument-error"),this.redirectPersistenceManager=await Wy.create(this,[wp(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let g=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(kn(E,this,"internal-error"),E.then(()=>{g||d(this.currentUser)}),typeof s=="function"){const S=t.addObserver(s,a,l);return()=>{g=!0,S()}}else{const S=t.addObserver(s);return()=>{g=!0,S()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return kn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=fee(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&Exe(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Z_(r){return Ms(r)}class X7{constructor(t){this.auth=t,this.observer=null,this.addObserver=cLe(s=>this.observer=s)}get next(){return kn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zxe(r){dN=r}function mee(r){return dN.loadJS(r)}function Hxe(){return dN.recaptchaEnterpriseScript}function Kxe(){return dN.gapiScript}function $xe(r){return`__${r}${Math.floor(Math.random()*1e6)}`}const qxe="recaptcha-enterprise",Yxe="NO_RECAPTCHA";class Xxe{constructor(t){this.type=qxe,this.auth=Z_(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(g,E)=>{Axe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(S=>{if(S.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const b=new Ixe(S);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,g(b.siteKey)}}).catch(S=>{E(S)})})}function l(d,g,E){const S=window.grecaptcha;H7(S)?S.enterprise.ready(()=>{S.enterprise.execute(d,{action:t}).then(b=>{g(b)}).catch(()=>{g(Yxe)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((d,g)=>{a(this.auth).then(E=>{if(!s&&H7(window.grecaptcha))l(E,d,g);else{if(typeof window>"u"){g(new Error("RecaptchaVerifier is only supported in browser"));return}let S=Hxe();S.length!==0&&(S+=E),mee(S).then(()=>{l(E,d,g)}).catch(b=>{g(b)})}}).catch(E=>{g(E)})})}}async function J7(r,t,s,a=!1){const l=new Xxe(r);let d;try{d=await l.verify(s)}catch{d=await l.verify(s,!0)}const g=Object.assign({},t);return a?Object.assign(g,{captchaResp:d}):Object.assign(g,{captchaResponse:d}),Object.assign(g,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(g,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),g}async function x2(r,t,s,a){var l;if(!((l=r._getRecaptchaConfig())===null||l===void 0)&&l.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const d=await J7(r,t,s,s==="getOobCode");return a(r,d)}else return a(r,t).catch(async d=>{if(d.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const g=await J7(r,t,s,s==="getOobCode");return a(r,g)}else return Promise.reject(d)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jxe(r,t){const s=uN(r,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(mP(d,t??{}))return l;Xu(l,"already-initialized")}return s.initialize({options:t})}function Qxe(r,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(wp);t!=null&&t.errorMap&&r._updateErrorMap(t.errorMap),r._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function Zxe(r,t,s){const a=Z_(r);kn(a._canInitEmulator,a,"emulator-config-failed"),kn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=gee(t),{host:g,port:E}=eMe(t),S=E===null?"":`:${E}`;a.config.emulator={url:`${d}//${g}${S}/`},a.settings.appVerificationDisabledForTesting=!0,a.emulatorConfig=Object.freeze({host:g,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})}),tMe()}function gee(r){const t=r.indexOf(":");return t<0?"":r.substr(0,t+1)}function eMe(r){const t=gee(r),s=/(\/\/)?([^?#/]+)/.exec(r.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:Q7(a.substr(d.length+1))}}else{const[d,g]=a.split(":");return{host:d,port:Q7(g)}}}function Q7(r){if(!r)return null;const t=Number(r);return isNaN(t)?null:t}function tMe(){function r(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return Tp("not implemented")}_getIdTokenResponse(t){return Tp("not implemented")}_linkToIdToken(t,s){return Tp("not implemented")}_getReauthenticationResolver(t){return Tp("not implemented")}}async function nMe(r,t){return Dm(r,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rMe(r,t){return Uw(r,"POST","/v1/accounts:signInWithPassword",km(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iMe(r,t){return Uw(r,"POST","/v1/accounts:signInWithEmailLink",km(r,t))}async function sMe(r,t){return Uw(r,"POST","/v1/accounts:signInWithEmailLink",km(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw extends DV{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new aw(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new aw(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return x2(t,s,"signInWithPassword",rMe);case"emailLink":return iMe(t,{email:this._email,oobCode:this._password});default:Xu(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return x2(t,a,"signUpPassword",nMe);case"emailLink":return sMe(t,{idToken:s,email:this._email,oobCode:this._password});default:Xu(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gy(r,t){return Uw(r,"POST","/v1/accounts:signInWithIdp",km(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oMe="http://localhost";class H_ extends DV{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new H_(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):Xu("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=Ow(s,["providerId","signInMethod"]);if(!a||!l)return null;const g=new H_(a,l);return g.idToken=d.idToken||void 0,g.accessToken=d.accessToken||void 0,g.secret=d.secret,g.nonce=d.nonce,g.pendingToken=d.pendingToken||null,g}_getIdTokenResponse(t){const s=this.buildRequest();return Gy(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,Gy(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,Gy(t,s)}buildRequest(){const t={requestUri:oMe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=xw(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aMe(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function cMe(r){const t=hb(pb(r)).link,s=t?hb(pb(t)).deep_link_id:null,a=hb(pb(r)).deep_link_id;return(a?hb(pb(a)).link:null)||a||s||t||r}class LV{constructor(t){var s,a,l,d,g,E;const S=hb(pb(t)),b=(s=S.apiKey)!==null&&s!==void 0?s:null,R=(a=S.oobCode)!==null&&a!==void 0?a:null,O=aMe((l=S.mode)!==null&&l!==void 0?l:null);kn(b&&R&&O,"argument-error"),this.apiKey=b,this.operation=O,this.code=R,this.continueUrl=(d=S.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(g=S.languageCode)!==null&&g!==void 0?g:null,this.tenantId=(E=S.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const s=cMe(t);try{return new LV(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{constructor(){this.providerId=gS.PROVIDER_ID}static credential(t,s){return aw._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=LV.parseLink(s);return kn(a,"argument-error"),aw._fromEmailAndCode(t,a.code,a.tenantId)}}gS.PROVIDER_ID="password";gS.EMAIL_PASSWORD_SIGN_IN_METHOD="password";gS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ee{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw extends _ee{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am extends Vw{constructor(){super("facebook.com")}static credential(t){return H_._fromParams({providerId:am.PROVIDER_ID,signInMethod:am.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return am.credentialFromTaggedObject(t)}static credentialFromError(t){return am.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return am.credential(t.oauthAccessToken)}catch{return null}}}am.FACEBOOK_SIGN_IN_METHOD="facebook.com";am.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm extends Vw{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return H_._fromParams({providerId:cm.PROVIDER_ID,signInMethod:cm.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return cm.credentialFromTaggedObject(t)}static credentialFromError(t){return cm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return cm.credential(s,a)}catch{return null}}}cm.GOOGLE_SIGN_IN_METHOD="google.com";cm.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm extends Vw{constructor(){super("github.com")}static credential(t){return H_._fromParams({providerId:lm.PROVIDER_ID,signInMethod:lm.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return lm.credentialFromTaggedObject(t)}static credentialFromError(t){return lm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return lm.credential(t.oauthAccessToken)}catch{return null}}}lm.GITHUB_SIGN_IN_METHOD="github.com";lm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um extends Vw{constructor(){super("twitter.com")}static credential(t,s){return H_._fromParams({providerId:um.PROVIDER_ID,signInMethod:um.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return um.credentialFromTaggedObject(t)}static credentialFromError(t){return um.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return um.credential(s,a)}catch{return null}}}um.TWITTER_SIGN_IN_METHOD="twitter.com";um.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lMe(r,t){return Uw(r,"POST","/v1/accounts:signUp",km(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await bp._fromIdTokenResponse(t,a,l),g=Z7(a);return new K_({user:d,providerId:g,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=Z7(a);return new K_({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function Z7(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP extends _h{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,EP.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new EP(t,s,a,l)}}function vee(r,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(r):s._getIdTokenResponse(r)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?EP._fromErrorAndOperation(r,d,t,a):d})}async function uMe(r,t,s=!1){const a=await ow(r,t._linkToIdToken(r.auth,await r.getIdToken()),s);return K_._forOperation(r,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dMe(r,t,s=!1){const{auth:a}=r;if(eh(a.app))return Promise.reject(Pp(a));const l="reauthenticate";try{const d=await ow(r,vee(a,l,t,r),s);kn(d.idToken,a,"internal-error");const g=NV(d.idToken);kn(g,a,"internal-error");const{sub:E}=g;return kn(r.uid===E,a,"user-mismatch"),K_._forOperation(r,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Xu(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Eee(r,t,s=!1){if(eh(r.app))return Promise.reject(Pp(r));const a="signIn",l=await vee(r,a,t),d=await K_._fromIdTokenResponse(r,a,l);return s||await r._updateCurrentUser(d.user),d}async function hMe(r,t){return Eee(Z_(r),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yee(r){const t=Z_(r);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function pMe(r,t,s){if(eh(r.app))return Promise.reject(Pp(r));const a=Z_(r),g=await x2(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",lMe).catch(S=>{throw S.code==="auth/password-does-not-meet-requirements"&&yee(r),S}),E=await K_._fromIdTokenResponse(a,"signIn",g);return await a._updateCurrentUser(E.user),E}function fMe(r,t,s){return eh(r.app)?Promise.reject(Pp(r)):hMe(Ms(r),gS.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&yee(r),a})}function mMe(r,t,s,a){return Ms(r).onIdTokenChanged(t,s,a)}function gMe(r,t,s){return Ms(r).beforeAuthStateChanged(t,s)}function _Me(r,t,s,a){return Ms(r).onAuthStateChanged(t,s,a)}function vMe(r){return Ms(r).signOut()}const yP="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class See{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(yP,"1"),this.storage.removeItem(yP),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EMe=1e3,yMe=10;class Tee extends See{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=pee(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((g,E,S)=>{this.notifyListeners(g,S)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const g=this.storage.getItem(a);!s&&this.localCache[a]===g||this.notifyListeners(a,g)},d=this.storage.getItem(a);Vxe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,yMe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},EMe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}Tee.type="LOCAL";const SMe=Tee;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bee extends See{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}bee.type="SESSION";const wee=bee;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TMe(r){return Promise.all(r.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new hN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,g=this.handlersMap[l];if(!(g!=null&&g.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(g).map(async b=>b(s.origin,d)),S=await TMe(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:S})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}hN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xV(r="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return r+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bMe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,g;return new Promise((E,S)=>{const b=xV("",20);l.port1.start();const R=setTimeout(()=>{S(new Error("unsupported_event"))},a);g={messageChannel:l,onMessage(O){const N=O;if(N.data.eventId===b)switch(N.data.status){case"ack":clearTimeout(R),d=setTimeout(()=>{S(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(R),clearTimeout(d),S(new Error("invalid_response"));break}}},this.handlers.add(g),l.port1.addEventListener("message",g.onMessage),this.target.postMessage({eventType:t,eventId:b,data:s},[l.port2])}).finally(()=>{g&&this.removeMessageHandler(g)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ch(){return window}function wMe(r){ch().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ree(){return typeof ch().WorkerGlobalScope<"u"&&typeof ch().importScripts=="function"}async function RMe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function CMe(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function IMe(){return Ree()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cee="firebaseLocalStorageDb",AMe=1,SP="firebaseLocalStorage",Iee="fbase_key";class Fw{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function pN(r,t){return r.transaction([SP],t?"readwrite":"readonly").objectStore(SP)}function OMe(){const r=indexedDB.deleteDatabase(Cee);return new Fw(r).toPromise()}function M2(){const r=indexedDB.open(Cee,AMe);return new Promise((t,s)=>{r.addEventListener("error",()=>{s(r.error)}),r.addEventListener("upgradeneeded",()=>{const a=r.result;try{a.createObjectStore(SP,{keyPath:Iee})}catch(l){s(l)}}),r.addEventListener("success",async()=>{const a=r.result;a.objectStoreNames.contains(SP)?t(a):(a.close(),await OMe(),t(await M2()))})})}async function eq(r,t,s){const a=pN(r,!0).put({[Iee]:t,value:s});return new Fw(a).toPromise()}async function PMe(r,t){const s=pN(r,!1).get(t),a=await new Fw(s).toPromise();return a===void 0?null:a.value}function tq(r,t){const s=pN(r,!0).delete(t);return new Fw(s).toPromise()}const NMe=800,kMe=3;class Aee{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await M2(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>kMe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ree()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=hN._getInstance(IMe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await RMe(),!this.activeServiceWorker)return;this.sender=new bMe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||CMe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await M2();return await eq(t,yP,"1"),await tq(t,yP),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>eq(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>PMe(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>tq(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=pN(l,!1).getAll();return new Fw(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),NMe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Aee.type="LOCAL";const DMe=Aee;new Mw(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LMe(r,t){return t?wp(t):(kn(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV extends DV{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Gy(t,this._buildIdpRequest())}_linkToIdToken(t,s){return Gy(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return Gy(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function xMe(r){return Eee(r.auth,new MV(r),r.bypassAuthState)}function MMe(r){const{auth:t,user:s}=r;return kn(s,t,"internal-error"),dMe(s,new MV(r),r.bypassAuthState)}async function UMe(r){const{auth:t,user:s}=r;return kn(s,t,"internal-error"),uMe(s,new MV(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oee{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:g,type:E}=t;if(g){this.reject(g);return}const S={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(S))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return xMe;case"linkViaPopup":case"linkViaRedirect":return UMe;case"reauthViaPopup":case"reauthViaRedirect":return MMe;default:Xu(this.auth,"internal-error")}}resolve(t){xp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){xp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VMe=new Mw(2e3,1e4);class Oy extends Oee{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,Oy.currentPopupAction&&Oy.currentPopupAction.cancel(),Oy.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return kn(t,this.auth,"internal-error"),t}async onExecution(){xp(this.filter.length===1,"Popup operations only handle one event");const t=xV();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(ah(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(ah(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Oy.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ah(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,VMe.get())};t()}}Oy.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FMe="pendingRedirect",BO=new Map;class jMe extends Oee{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=BO.get(this.auth._key());if(!t){try{const a=await BMe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}BO.set(this.auth._key(),t)}return this.bypassAuthState||BO.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function BMe(r,t){const s=zMe(t),a=GMe(r);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function WMe(r,t){BO.set(r._key(),t)}function GMe(r){return wp(r._redirectPersistence)}function zMe(r){return jO(FMe,r.config.apiKey,r.name)}async function HMe(r,t,s=!1){if(eh(r.app))return Promise.reject(Pp(r));const a=Z_(r),l=LMe(a,t),g=await new jMe(a,l,s).execute();return g&&!s&&(delete g.user._redirectEventId,await a._persistUserIfCurrent(g.user),await a._setRedirectUser(null,t)),g}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KMe=10*60*1e3;class $Me{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!qMe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!Pee(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(ah(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=KMe&&this.cachedEventUids.clear(),this.cachedEventUids.has(nq(t))}saveEventToCache(t){this.cachedEventUids.add(nq(t)),this.lastProcessedEventTime=Date.now()}}function nq(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(t=>t).join("-")}function Pee({type:r,error:t}){return r==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function qMe(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Pee(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YMe(r,t={}){return Dm(r,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XMe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,JMe=/^https?/;async function QMe(r){if(r.config.emulator)return;const{authorizedDomains:t}=await YMe(r);for(const s of t)try{if(ZMe(s))return}catch{}Xu(r,"unauthorized-domain")}function ZMe(r){const t=D2(),{protocol:s,hostname:a}=new URL(t);if(r.startsWith("chrome-extension://")){const g=new URL(r);return g.hostname===""&&a===""?s==="chrome-extension:"&&r.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&g.hostname===a}if(!JMe.test(s))return!1;if(XMe.test(r))return a===r;const l=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e2e=new Mw(3e4,6e4);function rq(){const r=ch().___jsl;if(r!=null&&r.H){for(const t of Object.keys(r.H))if(r.H[t].r=r.H[t].r||[],r.H[t].L=r.H[t].L||[],r.H[t].r=[...r.H[t].L],r.CP)for(let s=0;s<r.CP.length;s++)r.CP[s]=null}}function t2e(r){return new Promise((t,s)=>{var a,l,d;function g(){rq(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{rq(),s(ah(r,"network-request-failed"))},timeout:e2e.get()})}if(!((l=(a=ch().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=ch().gapi)===null||d===void 0)&&d.load)g();else{const E=$xe("iframefcb");return ch()[E]=()=>{gapi.load?g():s(ah(r,"network-request-failed"))},mee(`${Kxe()}?onload=${E}`).catch(S=>s(S))}}).catch(t=>{throw WO=null,t})}let WO=null;function n2e(r){return WO=WO||t2e(r),WO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r2e=new Mw(5e3,15e3),i2e="__/auth/iframe",s2e="emulator/auth/iframe",o2e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},a2e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function c2e(r){const t=r.config;kn(t.authDomain,r,"auth-domain-config-required");const s=t.emulator?PV(t,s2e):`https://${r.config.authDomain}/${i2e}`,a={apiKey:t.apiKey,appName:r.name,v:Q_},l=a2e.get(r.config.apiHost);l&&(a.eid=l);const d=r._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${xw(a).slice(1)}`}async function l2e(r){const t=await n2e(r),s=ch().gapi;return kn(s,r,"internal-error"),t.open({where:document.body,url:c2e(r),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:o2e,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const g=ah(r,"network-request-failed"),E=ch().setTimeout(()=>{d(g)},r2e.get());function S(){ch().clearTimeout(E),l(a)}a.ping(S).then(S,()=>{d(g)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u2e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},d2e=500,h2e=600,p2e="_blank",f2e="http://localhost";class iq{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function m2e(r,t,s,a=d2e,l=h2e){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),g=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const S=Object.assign(Object.assign({},u2e),{width:a.toString(),height:l.toString(),top:d,left:g}),b=Ea().toLowerCase();s&&(E=cee(b)?p2e:s),oee(b)&&(t=t||f2e,S.scrollbars="yes");const R=Object.entries(S).reduce((N,[U,K])=>`${N}${U}=${K},`,"");if(Uxe(b)&&E!=="_self")return g2e(t||"",E),new iq(null);const O=window.open(t||"",E,R);kn(O,r,"popup-blocked");try{O.focus()}catch{}return new iq(O)}function g2e(r,t){const s=document.createElement("a");s.href=r,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _2e="__/auth/handler",v2e="emulator/auth/handler",E2e=encodeURIComponent("fac");async function sq(r,t,s,a,l,d){kn(r.config.authDomain,r,"auth-domain-config-required"),kn(r.config.apiKey,r,"invalid-api-key");const g={apiKey:r.config.apiKey,appName:r.name,authType:s,redirectUrl:a,v:Q_,eventId:l};if(t instanceof _ee){t.setDefaultLanguage(r.languageCode),g.providerId=t.providerId||"",aLe(t.getCustomParameters())||(g.customParameters=JSON.stringify(t.getCustomParameters()));for(const[R,O]of Object.entries({}))g[R]=O}if(t instanceof Vw){const R=t.getScopes().filter(O=>O!=="");R.length>0&&(g.scopes=R.join(","))}r.tenantId&&(g.tid=r.tenantId);const E=g;for(const R of Object.keys(E))E[R]===void 0&&delete E[R];const S=await r._getAppCheckToken(),b=S?`#${E2e}=${encodeURIComponent(S)}`:"";return`${y2e(r)}?${xw(E).slice(1)}${b}`}function y2e({config:r}){return r.emulator?PV(r,v2e):`https://${r.authDomain}/${_2e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _M="webStorageSupport";class S2e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wee,this._completeRedirectFn=HMe,this._overrideRedirectResult=WMe}async _openPopup(t,s,a,l){var d;xp((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const g=await sq(t,s,a,D2(),l);return m2e(t,g,xV())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await sq(t,s,a,D2(),l);return wMe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(xp(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await l2e(t),a=new $Me(t);return s.register("authEvent",l=>(kn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(_M,{type:_M},l=>{var d;const g=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[_M];g!==void 0&&s(!!g),Xu(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=QMe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return pee()||aee()||kV()}}const T2e=S2e;var oq="@firebase/auth",aq="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b2e{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){kn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w2e(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function R2e(r){z_(new bm("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:g,authDomain:E}=a.options;kn(g&&!g.includes(":"),"invalid-api-key",{appName:a.name});const S={apiKey:g,authDomain:E,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fee(r)},b=new Gxe(a,l,d,S);return Qxe(b,s),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),z_(new bm("auth-internal",t=>{const s=Z_(t.getProvider("auth").getImmediate());return(a=>new b2e(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),oh(oq,aq,w2e(r)),oh(oq,aq,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2e=5*60,I2e=zZ("authIdTokenMaxAge")||C2e;let cq=null;const A2e=r=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>I2e)return;const l=s==null?void 0:s.token;cq!==l&&(cq=l,await fetch(r,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function Nee(r=AV()){const t=uN(r,"auth");if(t.isInitialized())return t.getImmediate();const s=Jxe(r,{popupRedirectResolver:T2e,persistence:[DMe,SMe,wee]}),a=zZ("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const g=A2e(d.toString());gMe(s,g,()=>g(s.currentUser)),mMe(s,E=>g(E))}}const l=BZ("auth");return l&&Zxe(s,`http://${l}`),s}function O2e(){var r,t;return(t=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&t!==void 0?t:document}zxe({loadJS(r){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",r),a.onload=t,a.onerror=l=>{const d=ah("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",O2e().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});R2e("Browser");var lq=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var x_,kee;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Z,te){function ie(){}ie.prototype=te.prototype,Z.D=te.prototype,Z.prototype=new ie,Z.prototype.constructor=Z,Z.C=function(ae,ve,pe){for(var de=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)de[ut-2]=arguments[ut];return te.prototype[ve].apply(ae,de)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Z,te,ie){ie||(ie=0);var ae=Array(16);if(typeof te=="string")for(var ve=0;16>ve;++ve)ae[ve]=te.charCodeAt(ie++)|te.charCodeAt(ie++)<<8|te.charCodeAt(ie++)<<16|te.charCodeAt(ie++)<<24;else for(ve=0;16>ve;++ve)ae[ve]=te[ie++]|te[ie++]<<8|te[ie++]<<16|te[ie++]<<24;te=Z.g[0],ie=Z.g[1],ve=Z.g[2];var pe=Z.g[3],de=te+(pe^ie&(ve^pe))+ae[0]+3614090360&4294967295;te=ie+(de<<7&4294967295|de>>>25),de=pe+(ve^te&(ie^ve))+ae[1]+3905402710&4294967295,pe=te+(de<<12&4294967295|de>>>20),de=ve+(ie^pe&(te^ie))+ae[2]+606105819&4294967295,ve=pe+(de<<17&4294967295|de>>>15),de=ie+(te^ve&(pe^te))+ae[3]+3250441966&4294967295,ie=ve+(de<<22&4294967295|de>>>10),de=te+(pe^ie&(ve^pe))+ae[4]+4118548399&4294967295,te=ie+(de<<7&4294967295|de>>>25),de=pe+(ve^te&(ie^ve))+ae[5]+1200080426&4294967295,pe=te+(de<<12&4294967295|de>>>20),de=ve+(ie^pe&(te^ie))+ae[6]+2821735955&4294967295,ve=pe+(de<<17&4294967295|de>>>15),de=ie+(te^ve&(pe^te))+ae[7]+4249261313&4294967295,ie=ve+(de<<22&4294967295|de>>>10),de=te+(pe^ie&(ve^pe))+ae[8]+1770035416&4294967295,te=ie+(de<<7&4294967295|de>>>25),de=pe+(ve^te&(ie^ve))+ae[9]+2336552879&4294967295,pe=te+(de<<12&4294967295|de>>>20),de=ve+(ie^pe&(te^ie))+ae[10]+4294925233&4294967295,ve=pe+(de<<17&4294967295|de>>>15),de=ie+(te^ve&(pe^te))+ae[11]+2304563134&4294967295,ie=ve+(de<<22&4294967295|de>>>10),de=te+(pe^ie&(ve^pe))+ae[12]+1804603682&4294967295,te=ie+(de<<7&4294967295|de>>>25),de=pe+(ve^te&(ie^ve))+ae[13]+4254626195&4294967295,pe=te+(de<<12&4294967295|de>>>20),de=ve+(ie^pe&(te^ie))+ae[14]+2792965006&4294967295,ve=pe+(de<<17&4294967295|de>>>15),de=ie+(te^ve&(pe^te))+ae[15]+1236535329&4294967295,ie=ve+(de<<22&4294967295|de>>>10),de=te+(ve^pe&(ie^ve))+ae[1]+4129170786&4294967295,te=ie+(de<<5&4294967295|de>>>27),de=pe+(ie^ve&(te^ie))+ae[6]+3225465664&4294967295,pe=te+(de<<9&4294967295|de>>>23),de=ve+(te^ie&(pe^te))+ae[11]+643717713&4294967295,ve=pe+(de<<14&4294967295|de>>>18),de=ie+(pe^te&(ve^pe))+ae[0]+3921069994&4294967295,ie=ve+(de<<20&4294967295|de>>>12),de=te+(ve^pe&(ie^ve))+ae[5]+3593408605&4294967295,te=ie+(de<<5&4294967295|de>>>27),de=pe+(ie^ve&(te^ie))+ae[10]+38016083&4294967295,pe=te+(de<<9&4294967295|de>>>23),de=ve+(te^ie&(pe^te))+ae[15]+3634488961&4294967295,ve=pe+(de<<14&4294967295|de>>>18),de=ie+(pe^te&(ve^pe))+ae[4]+3889429448&4294967295,ie=ve+(de<<20&4294967295|de>>>12),de=te+(ve^pe&(ie^ve))+ae[9]+568446438&4294967295,te=ie+(de<<5&4294967295|de>>>27),de=pe+(ie^ve&(te^ie))+ae[14]+3275163606&4294967295,pe=te+(de<<9&4294967295|de>>>23),de=ve+(te^ie&(pe^te))+ae[3]+4107603335&4294967295,ve=pe+(de<<14&4294967295|de>>>18),de=ie+(pe^te&(ve^pe))+ae[8]+1163531501&4294967295,ie=ve+(de<<20&4294967295|de>>>12),de=te+(ve^pe&(ie^ve))+ae[13]+2850285829&4294967295,te=ie+(de<<5&4294967295|de>>>27),de=pe+(ie^ve&(te^ie))+ae[2]+4243563512&4294967295,pe=te+(de<<9&4294967295|de>>>23),de=ve+(te^ie&(pe^te))+ae[7]+1735328473&4294967295,ve=pe+(de<<14&4294967295|de>>>18),de=ie+(pe^te&(ve^pe))+ae[12]+2368359562&4294967295,ie=ve+(de<<20&4294967295|de>>>12),de=te+(ie^ve^pe)+ae[5]+4294588738&4294967295,te=ie+(de<<4&4294967295|de>>>28),de=pe+(te^ie^ve)+ae[8]+2272392833&4294967295,pe=te+(de<<11&4294967295|de>>>21),de=ve+(pe^te^ie)+ae[11]+1839030562&4294967295,ve=pe+(de<<16&4294967295|de>>>16),de=ie+(ve^pe^te)+ae[14]+4259657740&4294967295,ie=ve+(de<<23&4294967295|de>>>9),de=te+(ie^ve^pe)+ae[1]+2763975236&4294967295,te=ie+(de<<4&4294967295|de>>>28),de=pe+(te^ie^ve)+ae[4]+1272893353&4294967295,pe=te+(de<<11&4294967295|de>>>21),de=ve+(pe^te^ie)+ae[7]+4139469664&4294967295,ve=pe+(de<<16&4294967295|de>>>16),de=ie+(ve^pe^te)+ae[10]+3200236656&4294967295,ie=ve+(de<<23&4294967295|de>>>9),de=te+(ie^ve^pe)+ae[13]+681279174&4294967295,te=ie+(de<<4&4294967295|de>>>28),de=pe+(te^ie^ve)+ae[0]+3936430074&4294967295,pe=te+(de<<11&4294967295|de>>>21),de=ve+(pe^te^ie)+ae[3]+3572445317&4294967295,ve=pe+(de<<16&4294967295|de>>>16),de=ie+(ve^pe^te)+ae[6]+76029189&4294967295,ie=ve+(de<<23&4294967295|de>>>9),de=te+(ie^ve^pe)+ae[9]+3654602809&4294967295,te=ie+(de<<4&4294967295|de>>>28),de=pe+(te^ie^ve)+ae[12]+3873151461&4294967295,pe=te+(de<<11&4294967295|de>>>21),de=ve+(pe^te^ie)+ae[15]+530742520&4294967295,ve=pe+(de<<16&4294967295|de>>>16),de=ie+(ve^pe^te)+ae[2]+3299628645&4294967295,ie=ve+(de<<23&4294967295|de>>>9),de=te+(ve^(ie|~pe))+ae[0]+4096336452&4294967295,te=ie+(de<<6&4294967295|de>>>26),de=pe+(ie^(te|~ve))+ae[7]+1126891415&4294967295,pe=te+(de<<10&4294967295|de>>>22),de=ve+(te^(pe|~ie))+ae[14]+2878612391&4294967295,ve=pe+(de<<15&4294967295|de>>>17),de=ie+(pe^(ve|~te))+ae[5]+4237533241&4294967295,ie=ve+(de<<21&4294967295|de>>>11),de=te+(ve^(ie|~pe))+ae[12]+1700485571&4294967295,te=ie+(de<<6&4294967295|de>>>26),de=pe+(ie^(te|~ve))+ae[3]+2399980690&4294967295,pe=te+(de<<10&4294967295|de>>>22),de=ve+(te^(pe|~ie))+ae[10]+4293915773&4294967295,ve=pe+(de<<15&4294967295|de>>>17),de=ie+(pe^(ve|~te))+ae[1]+2240044497&4294967295,ie=ve+(de<<21&4294967295|de>>>11),de=te+(ve^(ie|~pe))+ae[8]+1873313359&4294967295,te=ie+(de<<6&4294967295|de>>>26),de=pe+(ie^(te|~ve))+ae[15]+4264355552&4294967295,pe=te+(de<<10&4294967295|de>>>22),de=ve+(te^(pe|~ie))+ae[6]+2734768916&4294967295,ve=pe+(de<<15&4294967295|de>>>17),de=ie+(pe^(ve|~te))+ae[13]+1309151649&4294967295,ie=ve+(de<<21&4294967295|de>>>11),de=te+(ve^(ie|~pe))+ae[4]+4149444226&4294967295,te=ie+(de<<6&4294967295|de>>>26),de=pe+(ie^(te|~ve))+ae[11]+3174756917&4294967295,pe=te+(de<<10&4294967295|de>>>22),de=ve+(te^(pe|~ie))+ae[2]+718787259&4294967295,ve=pe+(de<<15&4294967295|de>>>17),de=ie+(pe^(ve|~te))+ae[9]+3951481745&4294967295,Z.g[0]=Z.g[0]+te&4294967295,Z.g[1]=Z.g[1]+(ve+(de<<21&4294967295|de>>>11))&4294967295,Z.g[2]=Z.g[2]+ve&4294967295,Z.g[3]=Z.g[3]+pe&4294967295}a.prototype.u=function(Z,te){te===void 0&&(te=Z.length);for(var ie=te-this.blockSize,ae=this.B,ve=this.h,pe=0;pe<te;){if(ve==0)for(;pe<=ie;)l(this,Z,pe),pe+=this.blockSize;if(typeof Z=="string"){for(;pe<te;)if(ae[ve++]=Z.charCodeAt(pe++),ve==this.blockSize){l(this,ae),ve=0;break}}else for(;pe<te;)if(ae[ve++]=Z[pe++],ve==this.blockSize){l(this,ae),ve=0;break}}this.h=ve,this.o+=te},a.prototype.v=function(){var Z=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Z[0]=128;for(var te=1;te<Z.length-8;++te)Z[te]=0;var ie=8*this.o;for(te=Z.length-8;te<Z.length;++te)Z[te]=ie&255,ie/=256;for(this.u(Z),Z=Array(16),te=ie=0;4>te;++te)for(var ae=0;32>ae;ae+=8)Z[ie++]=this.g[te]>>>ae&255;return Z};function d(Z,te){var ie=E;return Object.prototype.hasOwnProperty.call(ie,Z)?ie[Z]:ie[Z]=te(Z)}function g(Z,te){this.h=te;for(var ie=[],ae=!0,ve=Z.length-1;0<=ve;ve--){var pe=Z[ve]|0;ae&&pe==te||(ie[ve]=pe,ae=!1)}this.g=ie}var E={};function S(Z){return-128<=Z&&128>Z?d(Z,function(te){return new g([te|0],0>te?-1:0)}):new g([Z|0],0>Z?-1:0)}function b(Z){if(isNaN(Z)||!isFinite(Z))return O;if(0>Z)return H(b(-Z));for(var te=[],ie=1,ae=0;Z>=ie;ae++)te[ae]=Z/ie|0,ie*=4294967296;return new g(te,0)}function R(Z,te){if(Z.length==0)throw Error("number format error: empty string");if(te=te||10,2>te||36<te)throw Error("radix out of range: "+te);if(Z.charAt(0)=="-")return H(R(Z.substring(1),te));if(0<=Z.indexOf("-"))throw Error('number format error: interior "-" character');for(var ie=b(Math.pow(te,8)),ae=O,ve=0;ve<Z.length;ve+=8){var pe=Math.min(8,Z.length-ve),de=parseInt(Z.substring(ve,ve+pe),te);8>pe?(pe=b(Math.pow(te,pe)),ae=ae.j(pe).add(b(de))):(ae=ae.j(ie),ae=ae.add(b(de)))}return ae}var O=S(0),N=S(1),U=S(16777216);r=g.prototype,r.m=function(){if(z(this))return-H(this).m();for(var Z=0,te=1,ie=0;ie<this.g.length;ie++){var ae=this.i(ie);Z+=(0<=ae?ae:4294967296+ae)*te,te*=4294967296}return Z},r.toString=function(Z){if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(K(this))return"0";if(z(this))return"-"+H(this).toString(Z);for(var te=b(Math.pow(Z,6)),ie=this,ae="";;){var ve=le(ie,te).g;ie=ne(ie,ve.j(te));var pe=((0<ie.g.length?ie.g[0]:ie.h)>>>0).toString(Z);if(ie=ve,K(ie))return pe+ae;for(;6>pe.length;)pe="0"+pe;ae=pe+ae}},r.i=function(Z){return 0>Z?0:Z<this.g.length?this.g[Z]:this.h};function K(Z){if(Z.h!=0)return!1;for(var te=0;te<Z.g.length;te++)if(Z.g[te]!=0)return!1;return!0}function z(Z){return Z.h==-1}r.l=function(Z){return Z=ne(this,Z),z(Z)?-1:K(Z)?0:1};function H(Z){for(var te=Z.g.length,ie=[],ae=0;ae<te;ae++)ie[ae]=~Z.g[ae];return new g(ie,~Z.h).add(N)}r.abs=function(){return z(this)?H(this):this},r.add=function(Z){for(var te=Math.max(this.g.length,Z.g.length),ie=[],ae=0,ve=0;ve<=te;ve++){var pe=ae+(this.i(ve)&65535)+(Z.i(ve)&65535),de=(pe>>>16)+(this.i(ve)>>>16)+(Z.i(ve)>>>16);ae=de>>>16,pe&=65535,de&=65535,ie[ve]=de<<16|pe}return new g(ie,ie[ie.length-1]&-2147483648?-1:0)};function ne(Z,te){return Z.add(H(te))}r.j=function(Z){if(K(this)||K(Z))return O;if(z(this))return z(Z)?H(this).j(H(Z)):H(H(this).j(Z));if(z(Z))return H(this.j(H(Z)));if(0>this.l(U)&&0>Z.l(U))return b(this.m()*Z.m());for(var te=this.g.length+Z.g.length,ie=[],ae=0;ae<2*te;ae++)ie[ae]=0;for(ae=0;ae<this.g.length;ae++)for(var ve=0;ve<Z.g.length;ve++){var pe=this.i(ae)>>>16,de=this.i(ae)&65535,ut=Z.i(ve)>>>16,mt=Z.i(ve)&65535;ie[2*ae+2*ve]+=de*mt,J(ie,2*ae+2*ve),ie[2*ae+2*ve+1]+=pe*mt,J(ie,2*ae+2*ve+1),ie[2*ae+2*ve+1]+=de*ut,J(ie,2*ae+2*ve+1),ie[2*ae+2*ve+2]+=pe*ut,J(ie,2*ae+2*ve+2)}for(ae=0;ae<te;ae++)ie[ae]=ie[2*ae+1]<<16|ie[2*ae];for(ae=te;ae<2*te;ae++)ie[ae]=0;return new g(ie,0)};function J(Z,te){for(;(Z[te]&65535)!=Z[te];)Z[te+1]+=Z[te]>>>16,Z[te]&=65535,te++}function se(Z,te){this.g=Z,this.h=te}function le(Z,te){if(K(te))throw Error("division by zero");if(K(Z))return new se(O,O);if(z(Z))return te=le(H(Z),te),new se(H(te.g),H(te.h));if(z(te))return te=le(Z,H(te)),new se(H(te.g),te.h);if(30<Z.g.length){if(z(Z)||z(te))throw Error("slowDivide_ only works with positive integers.");for(var ie=N,ae=te;0>=ae.l(Z);)ie=ce(ie),ae=ce(ae);var ve=Se(ie,1),pe=Se(ae,1);for(ae=Se(ae,2),ie=Se(ie,2);!K(ae);){var de=pe.add(ae);0>=de.l(Z)&&(ve=ve.add(ie),pe=de),ae=Se(ae,1),ie=Se(ie,1)}return te=ne(Z,ve.j(te)),new se(ve,te)}for(ve=O;0<=Z.l(te);){for(ie=Math.max(1,Math.floor(Z.m()/te.m())),ae=Math.ceil(Math.log(ie)/Math.LN2),ae=48>=ae?1:Math.pow(2,ae-48),pe=b(ie),de=pe.j(te);z(de)||0<de.l(Z);)ie-=ae,pe=b(ie),de=pe.j(te);K(pe)&&(pe=N),ve=ve.add(pe),Z=ne(Z,de)}return new se(ve,Z)}r.A=function(Z){return le(this,Z).h},r.and=function(Z){for(var te=Math.max(this.g.length,Z.g.length),ie=[],ae=0;ae<te;ae++)ie[ae]=this.i(ae)&Z.i(ae);return new g(ie,this.h&Z.h)},r.or=function(Z){for(var te=Math.max(this.g.length,Z.g.length),ie=[],ae=0;ae<te;ae++)ie[ae]=this.i(ae)|Z.i(ae);return new g(ie,this.h|Z.h)},r.xor=function(Z){for(var te=Math.max(this.g.length,Z.g.length),ie=[],ae=0;ae<te;ae++)ie[ae]=this.i(ae)^Z.i(ae);return new g(ie,this.h^Z.h)};function ce(Z){for(var te=Z.g.length+1,ie=[],ae=0;ae<te;ae++)ie[ae]=Z.i(ae)<<1|Z.i(ae-1)>>>31;return new g(ie,Z.h)}function Se(Z,te){var ie=te>>5;te%=32;for(var ae=Z.g.length-ie,ve=[],pe=0;pe<ae;pe++)ve[pe]=0<te?Z.i(pe+ie)>>>te|Z.i(pe+ie+1)<<32-te:Z.i(pe+ie);return new g(ve,Z.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,kee=a,g.prototype.add=g.prototype.add,g.prototype.multiply=g.prototype.j,g.prototype.modulo=g.prototype.A,g.prototype.compare=g.prototype.l,g.prototype.toNumber=g.prototype.m,g.prototype.toString=g.prototype.toString,g.prototype.getBits=g.prototype.i,g.fromNumber=b,g.fromString=R,x_=g}).apply(typeof lq<"u"?lq:typeof self<"u"?self:typeof window<"u"?window:{});var lO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Dee,fb,Lee,GO,U2,xee,Mee,Uee;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(C,V,X){return C==Array.prototype||C==Object.prototype||(C[V]=X.value),C};function s(C){C=[typeof globalThis=="object"&&globalThis,C,typeof window=="object"&&window,typeof self=="object"&&self,typeof lO=="object"&&lO];for(var V=0;V<C.length;++V){var X=C[V];if(X&&X.Math==Math)return X}throw Error("Cannot find global object")}var a=s(this);function l(C,V){if(V)e:{var X=a;C=C.split(".");for(var he=0;he<C.length-1;he++){var xe=C[he];if(!(xe in X))break e;X=X[xe]}C=C[C.length-1],he=X[C],V=V(he),V!=he&&V!=null&&t(X,C,{configurable:!0,writable:!0,value:V})}}function d(C,V){C instanceof String&&(C+="");var X=0,he=!1,xe={next:function(){if(!he&&X<C.length){var qe=X++;return{value:V(qe,C[qe]),done:!1}}return he=!0,{done:!0,value:void 0}}};return xe[Symbol.iterator]=function(){return xe},xe}l("Array.prototype.values",function(C){return C||function(){return d(this,function(V,X){return X})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var g=g||{},E=this||self;function S(C){var V=typeof C;return V=V!="object"?V:C?Array.isArray(C)?"array":V:"null",V=="array"||V=="object"&&typeof C.length=="number"}function b(C){var V=typeof C;return V=="object"&&C!=null||V=="function"}function R(C,V,X){return C.call.apply(C.bind,arguments)}function O(C,V,X){if(!C)throw Error();if(2<arguments.length){var he=Array.prototype.slice.call(arguments,2);return function(){var xe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(xe,he),C.apply(V,xe)}}return function(){return C.apply(V,arguments)}}function N(C,V,X){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?R:O,N.apply(null,arguments)}function U(C,V){var X=Array.prototype.slice.call(arguments,1);return function(){var he=X.slice();return he.push.apply(he,arguments),C.apply(this,he)}}function K(C,V){function X(){}X.prototype=V.prototype,C.aa=V.prototype,C.prototype=new X,C.prototype.constructor=C,C.Qb=function(he,xe,qe){for(var At=Array(arguments.length-2),Wr=2;Wr<arguments.length;Wr++)At[Wr-2]=arguments[Wr];return V.prototype[xe].apply(he,At)}}function z(C){const V=C.length;if(0<V){const X=Array(V);for(let he=0;he<V;he++)X[he]=C[he];return X}return[]}function H(C,V){for(let X=1;X<arguments.length;X++){const he=arguments[X];if(S(he)){const xe=C.length||0,qe=he.length||0;C.length=xe+qe;for(let At=0;At<qe;At++)C[xe+At]=he[At]}else C.push(he)}}class ne{constructor(V,X){this.i=V,this.j=X,this.h=0,this.g=null}get(){let V;return 0<this.h?(this.h--,V=this.g,this.g=V.next,V.next=null):V=this.i(),V}}function J(C){return/^[\s\xa0]*$/.test(C)}function se(){var C=E.navigator;return C&&(C=C.userAgent)?C:""}function le(C){return le[" "](C),C}le[" "]=function(){};var ce=se().indexOf("Gecko")!=-1&&!(se().toLowerCase().indexOf("webkit")!=-1&&se().indexOf("Edge")==-1)&&!(se().indexOf("Trident")!=-1||se().indexOf("MSIE")!=-1)&&se().indexOf("Edge")==-1;function Se(C,V,X){for(const he in C)V.call(X,C[he],he,C)}function Z(C,V){for(const X in C)V.call(void 0,C[X],X,C)}function te(C){const V={};for(const X in C)V[X]=C[X];return V}const ie="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(C,V){let X,he;for(let xe=1;xe<arguments.length;xe++){he=arguments[xe];for(X in he)C[X]=he[X];for(let qe=0;qe<ie.length;qe++)X=ie[qe],Object.prototype.hasOwnProperty.call(he,X)&&(C[X]=he[X])}}function ve(C){var V=1;C=C.split(":");const X=[];for(;0<V&&C.length;)X.push(C.shift()),V--;return C.length&&X.push(C.join(":")),X}function pe(C){E.setTimeout(()=>{throw C},0)}function de(){var C=nt;let V=null;return C.g&&(V=C.g,C.g=C.g.next,C.g||(C.h=null),V.next=null),V}class ut{constructor(){this.h=this.g=null}add(V,X){const he=mt.get();he.set(V,X),this.h?this.h.next=he:this.g=he,this.h=he}}var mt=new ne(()=>new Ze,C=>C.reset());class Ze{constructor(){this.next=this.g=this.h=null}set(V,X){this.h=V,this.g=X,this.next=null}reset(){this.next=this.g=this.h=null}}let Be,Ke=!1,nt=new ut,Ee=()=>{const C=E.Promise.resolve(void 0);Be=()=>{C.then(Ye)}};var Ye=()=>{for(var C;C=de();){try{C.h.call(C.g)}catch(X){pe(X)}var V=mt;V.j(C),100>V.h&&(V.h++,C.next=V.g,V.g=C)}Ke=!1};function Et(){this.s=this.s,this.C=this.C}Et.prototype.s=!1,Et.prototype.ma=function(){this.s||(this.s=!0,this.N())},Et.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ot(C,V){this.type=C,this.g=this.target=V,this.defaultPrevented=!1}ot.prototype.h=function(){this.defaultPrevented=!0};var Ve=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var C=!1,V=Object.defineProperty({},"passive",{get:function(){C=!0}});try{const X=()=>{};E.addEventListener("test",X,V),E.removeEventListener("test",X,V)}catch{}return C}();function et(C,V){if(ot.call(this,C?C.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,C){var X=this.type=C.type,he=C.changedTouches&&C.changedTouches.length?C.changedTouches[0]:null;if(this.target=C.target||C.srcElement,this.g=V,V=C.relatedTarget){if(ce){e:{try{le(V.nodeName);var xe=!0;break e}catch{}xe=!1}xe||(V=null)}}else X=="mouseover"?V=C.fromElement:X=="mouseout"&&(V=C.toElement);this.relatedTarget=V,he?(this.clientX=he.clientX!==void 0?he.clientX:he.pageX,this.clientY=he.clientY!==void 0?he.clientY:he.pageY,this.screenX=he.screenX||0,this.screenY=he.screenY||0):(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0),this.button=C.button,this.key=C.key||"",this.ctrlKey=C.ctrlKey,this.altKey=C.altKey,this.shiftKey=C.shiftKey,this.metaKey=C.metaKey,this.pointerId=C.pointerId||0,this.pointerType=typeof C.pointerType=="string"?C.pointerType:gt[C.pointerType]||"",this.state=C.state,this.i=C,C.defaultPrevented&&et.aa.h.call(this)}}K(et,ot);var gt={2:"touch",3:"pen",4:"mouse"};et.prototype.h=function(){et.aa.h.call(this);var C=this.i;C.preventDefault?C.preventDefault():C.returnValue=!1};var Dt="closure_listenable_"+(1e6*Math.random()|0),Gt=0;function Bt(C,V,X,he,xe){this.listener=C,this.proxy=null,this.src=V,this.type=X,this.capture=!!he,this.ha=xe,this.key=++Gt,this.da=this.fa=!1}function Vn(C){C.da=!0,C.listener=null,C.proxy=null,C.src=null,C.ha=null}function Dn(C){this.src=C,this.g={},this.h=0}Dn.prototype.add=function(C,V,X,he,xe){var qe=C.toString();C=this.g[qe],C||(C=this.g[qe]=[],this.h++);var At=gr(C,V,he,xe);return-1<At?(V=C[At],X||(V.fa=!1)):(V=new Bt(V,this.src,qe,!!he,xe),V.fa=X,C.push(V)),V};function un(C,V){var X=V.type;if(X in C.g){var he=C.g[X],xe=Array.prototype.indexOf.call(he,V,void 0),qe;(qe=0<=xe)&&Array.prototype.splice.call(he,xe,1),qe&&(Vn(V),C.g[X].length==0&&(delete C.g[X],C.h--))}}function gr(C,V,X,he){for(var xe=0;xe<C.length;++xe){var qe=C[xe];if(!qe.da&&qe.listener==V&&qe.capture==!!X&&qe.ha==he)return xe}return-1}var Ar="closure_lm_"+(1e6*Math.random()|0),bt={};function Sn(C,V,X,he,xe){if(Array.isArray(V)){for(var qe=0;qe<V.length;qe++)Sn(C,V[qe],X,he,xe);return null}return X=Fn(X),C&&C[Dt]?C.K(V,X,b(he)?!!he.capture:!1,xe):Tn(C,V,X,!1,he,xe)}function Tn(C,V,X,he,xe,qe){if(!V)throw Error("Invalid event type");var At=b(xe)?!!xe.capture:!!xe,Wr=dt(C);if(Wr||(C[Ar]=Wr=new Dn(C)),X=Wr.add(V,X,he,At,qe),X.proxy)return X;if(he=we(),X.proxy=he,he.src=C,he.listener=X,C.addEventListener)Ve||(xe=At),xe===void 0&&(xe=!1),C.addEventListener(V.toString(),he,xe);else if(C.attachEvent)C.attachEvent(pt(V.toString()),he);else if(C.addListener&&C.removeListener)C.addListener(he);else throw Error("addEventListener and attachEvent are unavailable.");return X}function we(){function C(X){return V.call(C.src,C.listener,X)}const V=ft;return C}function De(C,V,X,he,xe){if(Array.isArray(V))for(var qe=0;qe<V.length;qe++)De(C,V[qe],X,he,xe);else he=b(he)?!!he.capture:!!he,X=Fn(X),C&&C[Dt]?(C=C.i,V=String(V).toString(),V in C.g&&(qe=C.g[V],X=gr(qe,X,he,xe),-1<X&&(Vn(qe[X]),Array.prototype.splice.call(qe,X,1),qe.length==0&&(delete C.g[V],C.h--)))):C&&(C=dt(C))&&(V=C.g[V.toString()],C=-1,V&&(C=gr(V,X,he,xe)),(X=-1<C?V[C]:null)&&We(X))}function We(C){if(typeof C!="number"&&C&&!C.da){var V=C.src;if(V&&V[Dt])un(V.i,C);else{var X=C.type,he=C.proxy;V.removeEventListener?V.removeEventListener(X,he,C.capture):V.detachEvent?V.detachEvent(pt(X),he):V.addListener&&V.removeListener&&V.removeListener(he),(X=dt(V))?(un(X,C),X.h==0&&(X.src=null,V[Ar]=null)):Vn(C)}}}function pt(C){return C in bt?bt[C]:bt[C]="on"+C}function ft(C,V){if(C.da)C=!0;else{V=new et(V,this);var X=C.listener,he=C.ha||C.src;C.fa&&We(C),C=X.call(he,V)}return C}function dt(C){return C=C[Ar],C instanceof Dn?C:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fn(C){return typeof C=="function"?C:(C[Mt]||(C[Mt]=function(V){return C.handleEvent(V)}),C[Mt])}function Cn(){Et.call(this),this.i=new Dn(this),this.M=this,this.F=null}K(Cn,Et),Cn.prototype[Dt]=!0,Cn.prototype.removeEventListener=function(C,V,X,he){De(this,C,V,X,he)};function tn(C,V){var X,he=C.F;if(he)for(X=[];he;he=he.F)X.push(he);if(C=C.M,he=V.type||V,typeof V=="string")V=new ot(V,C);else if(V instanceof ot)V.target=V.target||C;else{var xe=V;V=new ot(he,C),ae(V,xe)}if(xe=!0,X)for(var qe=X.length-1;0<=qe;qe--){var At=V.g=X[qe];xe=_r(At,he,!0,V)&&xe}if(At=V.g=C,xe=_r(At,he,!0,V)&&xe,xe=_r(At,he,!1,V)&&xe,X)for(qe=0;qe<X.length;qe++)At=V.g=X[qe],xe=_r(At,he,!1,V)&&xe}Cn.prototype.N=function(){if(Cn.aa.N.call(this),this.i){var C=this.i,V;for(V in C.g){for(var X=C.g[V],he=0;he<X.length;he++)Vn(X[he]);delete C.g[V],C.h--}}this.F=null},Cn.prototype.K=function(C,V,X,he){return this.i.add(String(C),V,!1,X,he)},Cn.prototype.L=function(C,V,X,he){return this.i.add(String(C),V,!0,X,he)};function _r(C,V,X,he){if(V=C.i.g[String(V)],!V)return!0;V=V.concat();for(var xe=!0,qe=0;qe<V.length;++qe){var At=V[qe];if(At&&!At.da&&At.capture==X){var Wr=At.listener,ei=At.ha||At.src;At.fa&&un(C.i,At),xe=Wr.call(ei,he)!==!1&&xe}}return xe&&!he.defaultPrevented}function ya(C,V,X){if(typeof C=="function")X&&(C=N(C,X));else if(C&&typeof C.handleEvent=="function")C=N(C.handleEvent,C);else throw Error("Invalid listener argument");return 2147483647<Number(V)?-1:E.setTimeout(C,V||0)}function ps(C){C.g=ya(()=>{C.g=null,C.i&&(C.i=!1,ps(C))},C.l);const V=C.h;C.h=null,C.m.apply(null,V)}class Qs extends Et{constructor(V,X){super(),this.m=V,this.l=X,this.h=null,this.i=!1,this.g=null}j(V){this.h=arguments,this.g?this.i=!0:ps(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lt(C){Et.call(this),this.h=C,this.g={}}K(Lt,Et);var dn=[];function Zs(C){Se(C.g,function(V,X){this.g.hasOwnProperty(X)&&We(V)},C),C.g={}}Lt.prototype.N=function(){Lt.aa.N.call(this),Zs(this)},Lt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var sr=E.JSON.stringify,zi=E.JSON.parse,Nc=class{stringify(C){return E.JSON.stringify(C,void 0)}parse(C){return E.JSON.parse(C,void 0)}};function Ga(){}Ga.prototype.h=null;function fo(C){return C.h||(C.h=C.i())}function za(){}var xi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Cs(){ot.call(this,"d")}K(Cs,ot);function Ko(){ot.call(this,"c")}K(Ko,ot);var Ha={},kc=null;function nu(){return kc=kc||new Cn}Ha.La="serverreachability";function Ka(C){ot.call(this,Ha.La,C)}K(Ka,ot);function Dc(C){const V=nu();tn(V,new Ka(V))}Ha.STAT_EVENT="statevent";function mo(C,V){ot.call(this,Ha.STAT_EVENT,C),this.stat=V}K(mo,ot);function wi(C){const V=nu();tn(V,new mo(V,C))}Ha.Ma="timingevent";function ts(C,V){ot.call(this,Ha.Ma,C),this.size=V}K(ts,ot);function Sa(C,V){if(typeof C!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){C()},V)}function ru(){this.g=!0}ru.prototype.xa=function(){this.g=!1};function $a(C,V,X,he,xe,qe){C.info(function(){if(C.g)if(qe)for(var At="",Wr=qe.split("&"),ei=0;ei<Wr.length;ei++){var pr=Wr[ei].split("=");if(1<pr.length){var As=pr[0];pr=pr[1];var rs=As.split("_");At=2<=rs.length&&rs[1]=="type"?At+(As+"="+pr+"&"):At+(As+"=redacted&")}}else At=null;else At=qe;return"XMLHTTP REQ ("+he+") [attempt "+xe+"]: "+V+`
`+X+`
`+At})}function $o(C,V,X,he,xe,qe,At){C.info(function(){return"XMLHTTP RESP ("+he+") [ attempt "+xe+"]: "+V+`
`+X+`
`+qe+" "+At})}function qo(C,V,X,he){C.info(function(){return"XMLHTTP TEXT ("+V+"): "+Mm(C,X)+(he?" "+he:"")})}function Zu(C,V){C.info(function(){return"TIMEOUT: "+V})}ru.prototype.info=function(){};function Mm(C,V){if(!C.g)return V;if(!V)return null;try{var X=JSON.parse(V);if(X){for(C=0;C<X.length;C++)if(Array.isArray(X[C])){var he=X[C];if(!(2>he.length)){var xe=he[1];if(Array.isArray(xe)&&!(1>xe.length)){var qe=xe[0];if(qe!="noop"&&qe!="stop"&&qe!="close")for(var At=1;At<xe.length;At++)xe[At]=""}}}}return sr(X)}catch{return V}}var iu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},vh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Is;function su(){}K(su,Ga),su.prototype.g=function(){return new XMLHttpRequest},su.prototype.i=function(){return{}},Is=new su;function Yo(C,V,X,he){this.j=C,this.i=V,this.l=X,this.R=he||1,this.U=new Lt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ed}function ed(){this.i=null,this.g="",this.h=!1}var td={},Ta={};function nd(C,V,X){C.L=1,C.v=wa(_o(V)),C.m=X,C.P=!0,ou(C,null)}function ou(C,V){C.F=Date.now(),Mr(C),C.A=_o(C.v);var X=C.A,he=C.R;Array.isArray(he)||(he=[String(he)]),_l(X.i,"t",he),C.C=0,X=C.j.J,C.h=new ed,C.g=rv(C.j,X?V:null,!C.m),0<C.O&&(C.M=new Qs(N(C.Y,C,C.g),C.O)),V=C.U,X=C.g,he=C.ca;var xe="readystatechange";Array.isArray(xe)||(xe&&(dn[0]=xe.toString()),xe=dn);for(var qe=0;qe<xe.length;qe++){var At=Sn(X,xe[qe],he||V.handleEvent,!1,V.h||V);if(!At)break;V.g[At.key]=At}V=C.H?te(C.H):{},C.m?(C.u||(C.u="POST"),V["Content-Type"]="application/x-www-form-urlencoded",C.g.ea(C.A,C.u,C.m,V)):(C.u="GET",C.g.ea(C.A,C.u,null,V)),Dc(),$a(C.i,C.u,C.A,C.l,C.R,C.m)}Yo.prototype.ca=function(C){C=C.target;const V=this.M;V&&ui(C)==3?V.j():this.Y(C)},Yo.prototype.Y=function(C){try{if(C==this.g)e:{const rs=ui(this.g);var V=this.g.Ba();const Ra=this.g.Z();if(!(3>rs)&&(rs!=3||this.g&&(this.h.h||this.g.oa()||fs(this.g)))){this.J||rs!=4||V==7||(V==8||0>=Ra?Dc(3):Dc(2)),qa(this);var X=this.g.Z();this.X=X;t:if(go(this)){var he=fs(this.g);C="";var xe=he.length,qe=ui(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Xo(this),Lc(this);var At="";break t}this.h.i=new E.TextDecoder}for(V=0;V<xe;V++)this.h.h=!0,C+=this.h.i.decode(he[V],{stream:!(qe&&V==xe-1)});he.length=0,this.h.g+=C,this.C=0,At=this.h.g}else At=this.g.oa();if(this.o=X==200,$o(this.i,this.u,this.A,this.l,this.R,rs,X),this.o){if(this.T&&!this.K){t:{if(this.g){var Wr,ei=this.g;if((Wr=ei.g?ei.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!J(Wr)){var pr=Wr;break t}}pr=null}if(X=pr)qo(this.i,this.l,X,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Eh(this,X);else{this.o=!1,this.s=3,wi(12),Xo(this),Lc(this);break e}}if(this.P){X=!0;let Io;for(;!this.J&&this.C<At.length;)if(Io=rd(this,At),Io==Ta){rs==4&&(this.s=4,wi(14),X=!1),qo(this.i,this.l,null,"[Incomplete Response]");break}else if(Io==td){this.s=4,wi(15),qo(this.i,this.l,At,"[Invalid Chunk]"),X=!1;break}else qo(this.i,this.l,Io,null),Eh(this,Io);if(go(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),rs!=4||At.length!=0||this.h.h||(this.s=1,wi(16),X=!1),this.o=this.o&&X,!X)qo(this.i,this.l,At,"[Invalid Chunked Response]"),Xo(this),Lc(this);else if(0<At.length&&!this.W){this.W=!0;var As=this.j;As.g==this&&As.ba&&!As.M&&(As.j.info("Great, no buffering proxy detected. Bytes received: "+At.length),Vm(As),As.M=!0,wi(11))}}else qo(this.i,this.l,At,null),Eh(this,At);rs==4&&Xo(this),this.o&&!this.J&&(rs==4?ef(this.j,this):(this.o=!1,Mr(this)))}else bo(this.g),X==400&&0<At.indexOf("Unknown SID")?(this.s=3,wi(12)):(this.s=0,wi(13)),Xo(this),Lc(this)}}}catch{}finally{}};function go(C){return C.g?C.u=="GET"&&C.L!=2&&C.j.Ca:!1}function rd(C,V){var X=C.C,he=V.indexOf(`
`,X);return he==-1?Ta:(X=Number(V.substring(X,he)),isNaN(X)?td:(he+=1,he+X>V.length?Ta:(V=V.slice(he,he+X),C.C=he+X,V)))}Yo.prototype.cancel=function(){this.J=!0,Xo(this)};function Mr(C){C.S=Date.now()+C.I,li(C,C.I)}function li(C,V){if(C.B!=null)throw Error("WatchDog timer not null");C.B=Sa(N(C.ba,C),V)}function qa(C){C.B&&(E.clearTimeout(C.B),C.B=null)}Yo.prototype.ba=function(){this.B=null;const C=Date.now();0<=C-this.S?(Zu(this.i,this.A),this.L!=2&&(Dc(),wi(17)),Xo(this),this.s=2,Lc(this)):li(this,this.S-C)};function Lc(C){C.j.G==0||C.J||ef(C.j,C)}function Xo(C){qa(C);var V=C.M;V&&typeof V.ma=="function"&&V.ma(),C.M=null,Zs(C.U),C.g&&(V=C.g,C.g=null,V.abort(),V.ma())}function Eh(C,V){try{var X=C.j;if(X.G!=0&&(X.g==C||Us(X.h,C))){if(!C.K&&Us(X.h,C)&&X.G==3){try{var he=X.Da.g.parse(V)}catch{he=null}if(Array.isArray(he)&&he.length==3){var xe=he;if(xe[0]==0){e:if(!X.u){if(X.g)if(X.g.F+3e3<C.F)Zp(X),Fc(X);else break e;Qp(X),wi(18)}}else X.za=xe[1],0<X.za-X.T&&37500>xe[2]&&X.F&&X.v==0&&!X.C&&(X.C=Sa(N(X.Za,X),6e3));if(1>=Kp(X.h)&&X.ca){try{X.ca()}catch{}X.ca=void 0}}else pu(X,11)}else if((C.K||X.g==C)&&Zp(X),!J(V))for(xe=X.Da.g.parse(V),V=0;V<xe.length;V++){let pr=xe[V];if(X.T=pr[0],pr=pr[1],X.G==2)if(pr[0]=="c"){X.K=pr[1],X.ia=pr[2];const As=pr[3];As!=null&&(X.la=As,X.j.info("VER="+X.la));const rs=pr[4];rs!=null&&(X.Aa=rs,X.j.info("SVER="+X.Aa));const Ra=pr[5];Ra!=null&&typeof Ra=="number"&&0<Ra&&(he=1.5*Ra,X.L=he,X.j.info("backChannelRequestTimeoutMs_="+he)),he=X;const Io=C.g;if(Io){const wh=Io.g?Io.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wh){var qe=he.h;qe.g||wh.indexOf("spdy")==-1&&wh.indexOf("quic")==-1&&wh.indexOf("h2")==-1||(qe.j=qe.l,qe.g=new Set,qe.h&&(yh(qe,qe.h),qe.h=null))}if(he.D){const nf=Io.g?Io.g.getResponseHeader("X-HTTP-Session-Id"):null;nf&&(he.ya=nf,Br(he.I,he.D,nf))}}X.G=3,X.l&&X.l.ua(),X.ba&&(X.R=Date.now()-C.F,X.j.info("Handshake RTT: "+X.R+"ms")),he=X;var At=C;if(he.qa=Fm(he,he.J?he.ia:null,he.W),At.K){xc(he.h,At);var Wr=At,ei=he.L;ei&&(Wr.I=ei),Wr.B&&(qa(Wr),Mr(Wr)),he.g=At}else El(he);0<X.i.length&&Ja(X)}else pr[0]!="stop"&&pr[0]!="close"||pu(X,7);else X.G==3&&(pr[0]=="stop"||pr[0]=="close"?pr[0]=="stop"?pu(X,7):Mi(X):pr[0]!="noop"&&X.l&&X.l.ta(pr),X.v=0)}}Dc(4)}catch{}}var id=class{constructor(C,V){this.g=C,this.map=V}};function hl(C){this.l=C||10,E.PerformanceNavigationTiming?(C=E.performance.getEntriesByType("navigation"),C=0<C.length&&(C[0].nextHopProtocol=="hq"||C[0].nextHopProtocol=="h2")):C=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=C?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eo(C){return C.h?!0:C.g?C.g.size>=C.j:!1}function Kp(C){return C.h?1:C.g?C.g.size:0}function Us(C,V){return C.h?C.h==V:C.g?C.g.has(V):!1}function yh(C,V){C.g?C.g.add(V):C.h=V}function xc(C,V){C.h&&C.h==V?C.h=null:C.g&&C.g.has(V)&&C.g.delete(V)}hl.prototype.cancel=function(){if(this.i=sd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const C of this.g.values())C.cancel();this.g.clear()}};function sd(C){if(C.h!=null)return C.i.concat(C.h.D);if(C.g!=null&&C.g.size!==0){let V=C.i;for(const X of C.g.values())V=V.concat(X.D);return V}return z(C.i)}function od(C){if(C.V&&typeof C.V=="function")return C.V();if(typeof Map<"u"&&C instanceof Map||typeof Set<"u"&&C instanceof Set)return Array.from(C.values());if(typeof C=="string")return C.split("");if(S(C)){for(var V=[],X=C.length,he=0;he<X;he++)V.push(C[he]);return V}V=[],X=0;for(he in C)V[X++]=C[he];return V}function or(C){if(C.na&&typeof C.na=="function")return C.na();if(!C.V||typeof C.V!="function"){if(typeof Map<"u"&&C instanceof Map)return Array.from(C.keys());if(!(typeof Set<"u"&&C instanceof Set)){if(S(C)||typeof C=="string"){var V=[];C=C.length;for(var X=0;X<C;X++)V.push(X);return V}V=[],X=0;for(const he in C)V[X++]=he;return V}}}function pl(C,V){if(C.forEach&&typeof C.forEach=="function")C.forEach(V,void 0);else if(S(C)||typeof C=="string")Array.prototype.forEach.call(C,V,void 0);else for(var X=or(C),he=od(C),xe=he.length,qe=0;qe<xe;qe++)V.call(void 0,he[qe],X&&X[qe],C)}var fl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function au(C,V){if(C){C=C.split("&");for(var X=0;X<C.length;X++){var he=C[X].indexOf("="),xe=null;if(0<=he){var qe=C[X].substring(0,he);xe=C[X].substring(he+1)}else qe=C[X];V(qe,xe?decodeURIComponent(xe.replace(/\+/g," ")):"")}}}function ba(C){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,C instanceof ba){this.h=C.h,cu(this,C.j),this.o=C.o,this.g=C.g,Mc(this,C.s),this.l=C.l;var V=C.i,X=new vo;X.i=V.i,V.g&&(X.g=new Map(V.g),X.h=V.h),ml(this,X),this.m=C.m}else C&&(V=String(C).match(fl))?(this.h=!1,cu(this,V[1]||"",!0),this.o=Xn(V[2]||""),this.g=Xn(V[3]||"",!0),Mc(this,V[4]),this.l=Xn(V[5]||"",!0),ml(this,V[6]||"",!0),this.m=Xn(V[7]||"")):(this.h=!1,this.i=new vo(null,this.h))}ba.prototype.toString=function(){var C=[],V=this.j;V&&C.push(Ya(V,gl,!0),":");var X=this.g;return(X||V=="file")&&(C.push("//"),(V=this.o)&&C.push(Ya(V,gl,!0),"@"),C.push(encodeURIComponent(String(X)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),X=this.s,X!=null&&C.push(":",String(X))),(X=this.l)&&(this.g&&X.charAt(0)!="/"&&C.push("/"),C.push(Ya(X,X.charAt(0)=="/"?Sh:ad,!0))),(X=this.i.toString())&&C.push("?",X),(X=this.m)&&C.push("#",Ya(X,Th)),C.join("")};function _o(C){return new ba(C)}function cu(C,V,X){C.j=X?Xn(V,!0):V,C.j&&(C.j=C.j.replace(/:$/,""))}function Mc(C,V){if(V){if(V=Number(V),isNaN(V)||0>V)throw Error("Bad port number "+V);C.s=V}else C.s=null}function ml(C,V,X){V instanceof vo?(C.i=V,To(C.i,C.h)):(X||(V=Ya(V,qp)),C.i=new vo(V,C.h))}function Br(C,V,X){C.i.set(V,X)}function wa(C){return Br(C,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),C}function Xn(C,V){return C?V?decodeURI(C.replace(/%25/g,"%2525")):decodeURIComponent(C):""}function Ya(C,V,X){return typeof C=="string"?(C=encodeURI(C).replace(V,$p),X&&(C=C.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C):null}function $p(C){return C=C.charCodeAt(0),"%"+(C>>4&15).toString(16)+(C&15).toString(16)}var gl=/[#\/\?@]/g,ad=/[#\?:]/g,Sh=/[#\?]/g,qp=/[#\?@]/g,Th=/#/g;function vo(C,V){this.h=this.g=null,this.i=C||null,this.j=!!V}function Hi(C){C.g||(C.g=new Map,C.h=0,C.i&&au(C.i,function(V,X){C.add(decodeURIComponent(V.replace(/\+/g," ")),X)}))}r=vo.prototype,r.add=function(C,V){Hi(this),this.i=null,C=So(this,C);var X=this.g.get(C);return X||this.g.set(C,X=[]),X.push(V),this.h+=1,this};function Eo(C,V){Hi(C),V=So(C,V),C.g.has(V)&&(C.i=null,C.h-=C.g.get(V).length,C.g.delete(V))}function yo(C,V){return Hi(C),V=So(C,V),C.g.has(V)}r.forEach=function(C,V){Hi(this),this.g.forEach(function(X,he){X.forEach(function(xe){C.call(V,xe,he,this)},this)},this)},r.na=function(){Hi(this);const C=Array.from(this.g.values()),V=Array.from(this.g.keys()),X=[];for(let he=0;he<V.length;he++){const xe=C[he];for(let qe=0;qe<xe.length;qe++)X.push(V[he])}return X},r.V=function(C){Hi(this);let V=[];if(typeof C=="string")yo(this,C)&&(V=V.concat(this.g.get(So(this,C))));else{C=Array.from(this.g.values());for(let X=0;X<C.length;X++)V=V.concat(C[X])}return V},r.set=function(C,V){return Hi(this),this.i=null,C=So(this,C),yo(this,C)&&(this.h-=this.g.get(C).length),this.g.set(C,[V]),this.h+=1,this},r.get=function(C,V){return C?(C=this.V(C),0<C.length?String(C[0]):V):V};function _l(C,V,X){Eo(C,V),0<X.length&&(C.i=null,C.g.set(So(C,V),z(X)),C.h+=X.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const C=[],V=Array.from(this.g.keys());for(var X=0;X<V.length;X++){var he=V[X];const qe=encodeURIComponent(String(he)),At=this.V(he);for(he=0;he<At.length;he++){var xe=qe;At[he]!==""&&(xe+="="+encodeURIComponent(String(At[he]))),C.push(xe)}}return this.i=C.join("&")};function So(C,V){return V=String(V),C.j&&(V=V.toLowerCase()),V}function To(C,V){V&&!C.j&&(Hi(C),C.i=null,C.g.forEach(function(X,he){var xe=he.toLowerCase();he!=xe&&(Eo(this,he),_l(this,xe,X))},C)),C.j=V}function Yp(C,V){const X=new ru;if(E.Image){const he=new Image;he.onload=U(ns,X,"TestLoadImage: loaded",!0,V,he),he.onerror=U(ns,X,"TestLoadImage: error",!1,V,he),he.onabort=U(ns,X,"TestLoadImage: abort",!1,V,he),he.ontimeout=U(ns,X,"TestLoadImage: timeout",!1,V,he),E.setTimeout(function(){he.ontimeout&&he.ontimeout()},1e4),he.src=C}else V(!1)}function Xa(C,V){const X=new ru,he=new AbortController,xe=setTimeout(()=>{he.abort(),ns(X,"TestPingServer: timeout",!1,V)},1e4);fetch(C,{signal:he.signal}).then(qe=>{clearTimeout(xe),qe.ok?ns(X,"TestPingServer: ok",!0,V):ns(X,"TestPingServer: server error",!1,V)}).catch(()=>{clearTimeout(xe),ns(X,"TestPingServer: error",!1,V)})}function ns(C,V,X,he,xe){try{xe&&(xe.onload=null,xe.onerror=null,xe.onabort=null,xe.ontimeout=null),he(X)}catch{}}function lu(){this.g=new Nc}function bh(C,V,X){const he=X||"";try{pl(C,function(xe,qe){let At=xe;b(xe)&&(At=sr(xe)),V.push(he+qe+"="+encodeURIComponent(At))})}catch(xe){throw V.push(he+"type="+encodeURIComponent("_badmap")),xe}}function Uc(C){this.l=C.Ub||null,this.j=C.eb||!1}K(Uc,Ga),Uc.prototype.g=function(){return new vl(this.l,this.j)},Uc.prototype.i=function(C){return function(){return C}}({});function vl(C,V){Cn.call(this),this.D=C,this.o=V,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}K(vl,Cn),r=vl.prototype,r.open=function(C,V){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=C,this.A=V,this.readyState=1,Qo(this)},r.send=function(C){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const V={headers:this.u,method:this.B,credentials:this.m,cache:void 0};C&&(V.body=C),(this.D||E).fetch(new Request(this.A,V)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Jo(this)),this.readyState=0},r.Sa=function(C){if(this.g&&(this.l=C,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=C.headers,this.readyState=2,Qo(this)),this.g&&(this.readyState=3,Qo(this),this.g)))if(this.responseType==="arraybuffer")C.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in C){if(this.j=C.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Xp(this)}else C.text().then(this.Ra.bind(this),this.ga.bind(this))};function Xp(C){C.j.read().then(C.Pa.bind(C)).catch(C.ga.bind(C))}r.Pa=function(C){if(this.g){if(this.o&&C.value)this.response.push(C.value);else if(!this.o){var V=C.value?C.value:new Uint8Array(0);(V=this.v.decode(V,{stream:!C.done}))&&(this.response=this.responseText+=V)}C.done?Jo(this):Qo(this),this.readyState==3&&Xp(this)}},r.Ra=function(C){this.g&&(this.response=this.responseText=C,Jo(this))},r.Qa=function(C){this.g&&(this.response=C,Jo(this))},r.ga=function(){this.g&&Jo(this)};function Jo(C){C.readyState=4,C.l=null,C.j=null,C.v=null,Qo(C)}r.setRequestHeader=function(C,V){this.u.append(C,V)},r.getResponseHeader=function(C){return this.h&&this.h.get(C.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const C=[],V=this.h.entries();for(var X=V.next();!X.done;)X=X.value,C.push(X[0]+": "+X[1]),X=V.next();return C.join(`\r
`)};function Qo(C){C.onreadystatechange&&C.onreadystatechange.call(C)}Object.defineProperty(vl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(C){this.m=C?"include":"same-origin"}});function Vc(C){let V="";return Se(C,function(X,he){V+=he,V+=":",V+=X,V+=`\r
`}),V}function _e(C,V,X){e:{for(he in X){var he=!1;break e}he=!0}he||(X=Vc(X),typeof C=="string"?X!=null&&encodeURIComponent(String(X)):Br(C,V,X))}function Ce(C){Cn.call(this),this.headers=new Map,this.o=C||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}K(Ce,Cn);var Ge=/^https?$/i,jt=["POST","PUT"];r=Ce.prototype,r.Ha=function(C){this.J=C},r.ea=function(C,V,X,he){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+C);V=V?V.toUpperCase():"GET",this.D=C,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Is.g(),this.v=this.o?fo(this.o):fo(Is),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(V,String(C),!0),this.B=!1}catch(qe){Bn(this,qe);return}if(C=X||"",X=new Map(this.headers),he)if(Object.getPrototypeOf(he)===Object.prototype)for(var xe in he)X.set(xe,he[xe]);else if(typeof he.keys=="function"&&typeof he.get=="function")for(const qe of he.keys())X.set(qe,he.get(qe));else throw Error("Unknown input type for opt_headers: "+String(he));he=Array.from(X.keys()).find(qe=>qe.toLowerCase()=="content-type"),xe=E.FormData&&C instanceof E.FormData,!(0<=Array.prototype.indexOf.call(jt,V,void 0))||he||xe||X.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[qe,At]of X)this.g.setRequestHeader(qe,At);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Or(this),this.u=!0,this.g.send(C),this.u=!1}catch(qe){Bn(this,qe)}};function Bn(C,V){C.h=!1,C.g&&(C.j=!0,C.g.abort(),C.j=!1),C.l=V,C.m=5,hr(C),Xt(C)}function hr(C){C.A||(C.A=!0,tn(C,"complete"),tn(C,"error"))}r.abort=function(C){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=C||7,tn(this,"complete"),tn(this,"abort"),Xt(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xt(this,!0)),Ce.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Ur(this):this.bb())},r.bb=function(){Ur(this)};function Ur(C){if(C.h&&typeof g<"u"&&(!C.v[1]||ui(C)!=4||C.Z()!=2)){if(C.u&&ui(C)==4)ya(C.Ea,0,C);else if(tn(C,"readystatechange"),ui(C)==4){C.h=!1;try{const At=C.Z();e:switch(At){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var V=!0;break e;default:V=!1}var X;if(!(X=V)){var he;if(he=At===0){var xe=String(C.D).match(fl)[1]||null;!xe&&E.self&&E.self.location&&(xe=E.self.location.protocol.slice(0,-1)),he=!Ge.test(xe?xe.toLowerCase():"")}X=he}if(X)tn(C,"complete"),tn(C,"success");else{C.m=6;try{var qe=2<ui(C)?C.g.statusText:""}catch{qe=""}C.l=qe+" ["+C.Z()+"]",hr(C)}}finally{Xt(C)}}}}function Xt(C,V){if(C.g){Or(C);const X=C.g,he=C.v[0]?()=>{}:null;C.g=null,C.v=null,V||tn(C,"ready");try{X.onreadystatechange=he}catch{}}}function Or(C){C.I&&(E.clearTimeout(C.I),C.I=null)}r.isActive=function(){return!!this.g};function ui(C){return C.g?C.g.readyState:0}r.Z=function(){try{return 2<ui(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(C){if(this.g){var V=this.g.responseText;return C&&V.indexOf(C)==0&&(V=V.substring(C.length)),zi(V)}};function fs(C){try{if(!C.g)return null;if("response"in C.g)return C.g.response;switch(C.H){case"":case"text":return C.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in C.g)return C.g.mozResponseArrayBuffer}return null}catch{return null}}function bo(C){const V={};C=(C.g&&2<=ui(C)&&C.g.getAllResponseHeaders()||"").split(`\r
`);for(let he=0;he<C.length;he++){if(J(C[he]))continue;var X=ve(C[he]);const xe=X[0];if(X=X[1],typeof X!="string")continue;X=X.trim();const qe=V[xe]||[];V[xe]=qe,qe.push(X)}Z(V,function(he){return he.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function wo(C,V,X){return X&&X.internalChannelParams&&X.internalChannelParams[C]||V}function uu(C){this.Aa=0,this.i=[],this.j=new ru,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=wo("failFast",!1,C),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=wo("baseRetryDelayMs",5e3,C),this.cb=wo("retryDelaySeedMs",1e4,C),this.Wa=wo("forwardChannelMaxRetries",2,C),this.wa=wo("forwardChannelRequestTimeoutMs",2e4,C),this.pa=C&&C.xmlHttpFactory||void 0,this.Xa=C&&C.Tb||void 0,this.Ca=C&&C.useFetchStreams||!1,this.L=void 0,this.J=C&&C.supportsCrossDomainXhr||!1,this.K="",this.h=new hl(C&&C.concurrentRequestLimit),this.Da=new lu,this.P=C&&C.fastHandshake||!1,this.O=C&&C.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=C&&C.Rb||!1,C&&C.xa&&this.j.xa(),C&&C.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&C&&C.detectBufferingProxy||!1,this.ja=void 0,C&&C.longPollingTimeout&&0<C.longPollingTimeout&&(this.ja=C.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=uu.prototype,r.la=8,r.G=1,r.connect=function(C,V,X,he){wi(0),this.W=C,this.H=V||{},X&&he!==void 0&&(this.H.OSID=X,this.H.OAID=he),this.F=this.X,this.I=Fm(this,null,this.W),Ja(this)};function Mi(C){if(cd(C),C.G==3){var V=C.U++,X=_o(C.I);if(Br(X,"SID",C.K),Br(X,"RID",V),Br(X,"TYPE","terminate"),du(C,X),V=new Yo(C,C.j,V),V.L=2,V.v=wa(_o(X)),X=!1,E.navigator&&E.navigator.sendBeacon)try{X=E.navigator.sendBeacon(V.v.toString(),"")}catch{}!X&&E.Image&&(new Image().src=V.v,X=!0),X||(V.g=rv(V.j,null),V.g.ea(V.v)),V.F=Date.now(),Mr(V)}fu(C)}function Fc(C){C.g&&(Vm(C),C.g.cancel(),C.g=null)}function cd(C){Fc(C),C.u&&(E.clearTimeout(C.u),C.u=null),Zp(C),C.h.cancel(),C.s&&(typeof C.s=="number"&&E.clearTimeout(C.s),C.s=null)}function Ja(C){if(!eo(C.h)&&!C.s){C.s=!0;var V=C.Ga;Be||Ee(),Ke||(Be(),Ke=!0),nt.add(V,C),C.B=0}}function Um(C,V){return Kp(C.h)>=C.h.j-(C.s?1:0)?!1:C.s?(C.i=V.D.concat(C.i),!0):C.G==1||C.G==2||C.B>=(C.Va?0:C.Wa)?!1:(C.s=Sa(N(C.Ga,C,V),hu(C,C.B)),C.B++,!0)}r.Ga=function(C){if(this.s)if(this.s=null,this.G==1){if(!C){this.U=Math.floor(1e5*Math.random()),C=this.U++;const xe=new Yo(this,this.j,C);let qe=this.o;if(this.S&&(qe?(qe=te(qe),ae(qe,this.S)):qe=this.S),this.m!==null||this.O||(xe.H=qe,qe=null),this.P)e:{for(var V=0,X=0;X<this.i.length;X++){t:{var he=this.i[X];if("__data__"in he.map&&(he=he.map.__data__,typeof he=="string")){he=he.length;break t}he=void 0}if(he===void 0)break;if(V+=he,4096<V){V=X;break e}if(V===4096||X===this.i.length-1){V=X+1;break e}}V=1e3}else V=1e3;V=Ro(this,xe,V),X=_o(this.I),Br(X,"RID",C),Br(X,"CVER",22),this.D&&Br(X,"X-HTTP-Session-Id",this.D),du(this,X),qe&&(this.O?V="headers="+encodeURIComponent(String(Vc(qe)))+"&"+V:this.m&&_e(X,this.m,qe)),yh(this.h,xe),this.Ua&&Br(X,"TYPE","init"),this.P?(Br(X,"$req",V),Br(X,"SID","null"),xe.T=!0,nd(xe,X,null)):nd(xe,X,V),this.G=2}}else this.G==3&&(C?Jp(this,C):this.i.length==0||eo(this.h)||Jp(this))};function Jp(C,V){var X;V?X=V.l:X=C.U++;const he=_o(C.I);Br(he,"SID",C.K),Br(he,"RID",X),Br(he,"AID",C.T),du(C,he),C.m&&C.o&&_e(he,C.m,C.o),X=new Yo(C,C.j,X,C.B+1),C.m===null&&(X.H=C.o),V&&(C.i=V.D.concat(C.i)),V=Ro(C,X,1e3),X.I=Math.round(.5*C.wa)+Math.round(.5*C.wa*Math.random()),yh(C.h,X),nd(X,he,V)}function du(C,V){C.H&&Se(C.H,function(X,he){Br(V,he,X)}),C.l&&pl({},function(X,he){Br(V,he,X)})}function Ro(C,V,X){X=Math.min(C.i.length,X);var he=C.l?N(C.l.Na,C.l,C):null;e:{var xe=C.i;let qe=-1;for(;;){const At=["count="+X];qe==-1?0<X?(qe=xe[0].g,At.push("ofs="+qe)):qe=0:At.push("ofs="+qe);let Wr=!0;for(let ei=0;ei<X;ei++){let pr=xe[ei].g;const As=xe[ei].map;if(pr-=qe,0>pr)qe=Math.max(0,xe[ei].g-100),Wr=!1;else try{bh(As,At,"req"+pr+"_")}catch{he&&he(As)}}if(Wr){he=At.join("&");break e}}}return C=C.i.splice(0,X),V.D=C,he}function El(C){if(!C.g&&!C.u){C.Y=1;var V=C.Fa;Be||Ee(),Ke||(Be(),Ke=!0),nt.add(V,C),C.v=0}}function Qp(C){return C.g||C.u||3<=C.v?!1:(C.Y++,C.u=Sa(N(C.Fa,C),hu(C,C.v)),C.v++,!0)}r.Fa=function(){if(this.u=null,nv(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var C=2*this.R;this.j.info("BP detection timer enabled: "+C),this.A=Sa(N(this.ab,this),C)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,wi(10),Fc(this),nv(this))};function Vm(C){C.A!=null&&(E.clearTimeout(C.A),C.A=null)}function nv(C){C.g=new Yo(C,C.j,"rpc",C.Y),C.m===null&&(C.g.H=C.o),C.g.O=0;var V=_o(C.qa);Br(V,"RID","rpc"),Br(V,"SID",C.K),Br(V,"AID",C.T),Br(V,"CI",C.F?"0":"1"),!C.F&&C.ja&&Br(V,"TO",C.ja),Br(V,"TYPE","xmlhttp"),du(C,V),C.m&&C.o&&_e(V,C.m,C.o),C.L&&(C.g.I=C.L);var X=C.g;C=C.ia,X.L=1,X.v=wa(_o(V)),X.m=null,X.P=!0,ou(X,C)}r.Za=function(){this.C!=null&&(this.C=null,Fc(this),Qp(this),wi(19))};function Zp(C){C.C!=null&&(E.clearTimeout(C.C),C.C=null)}function ef(C,V){var X=null;if(C.g==V){Zp(C),Vm(C),C.g=null;var he=2}else if(Us(C.h,V))X=V.D,xc(C.h,V),he=1;else return;if(C.G!=0){if(V.o)if(he==1){X=V.m?V.m.length:0,V=Date.now()-V.F;var xe=C.B;he=nu(),tn(he,new ts(he,X)),Ja(C)}else El(C);else if(xe=V.s,xe==3||xe==0&&0<V.X||!(he==1&&Um(C,V)||he==2&&Qp(C)))switch(X&&0<X.length&&(V=C.h,V.i=V.i.concat(X)),xe){case 1:pu(C,5);break;case 4:pu(C,10);break;case 3:pu(C,6);break;default:pu(C,2)}}}function hu(C,V){let X=C.Ta+Math.floor(Math.random()*C.cb);return C.isActive()||(X*=2),X*V}function pu(C,V){if(C.j.info("Error code "+V),V==2){var X=N(C.fb,C),he=C.Xa;const xe=!he;he=new ba(he||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||cu(he,"https"),wa(he),xe?Yp(he.toString(),X):Xa(he.toString(),X)}else wi(2);C.G=0,C.l&&C.l.sa(V),fu(C),cd(C)}r.fb=function(C){C?(this.j.info("Successfully pinged google.com"),wi(2)):(this.j.info("Failed to ping google.com"),wi(1))};function fu(C){if(C.G=0,C.ka=[],C.l){const V=sd(C.h);(V.length!=0||C.i.length!=0)&&(H(C.ka,V),H(C.ka,C.i),C.h.i.length=0,z(C.i),C.i.length=0),C.l.ra()}}function Fm(C,V,X){var he=X instanceof ba?_o(X):new ba(X);if(he.g!="")V&&(he.g=V+"."+he.g),Mc(he,he.s);else{var xe=E.location;he=xe.protocol,V=V?V+"."+xe.hostname:xe.hostname,xe=+xe.port;var qe=new ba(null);he&&cu(qe,he),V&&(qe.g=V),xe&&Mc(qe,xe),X&&(qe.l=X),he=qe}return X=C.D,V=C.ya,X&&V&&Br(he,X,V),Br(he,"VER",C.la),du(C,he),he}function rv(C,V,X){if(V&&!C.J)throw Error("Can't create secondary domain capable XhrIo object.");return V=C.Ca&&!C.pa?new Ce(new Uc({eb:X})):new Ce(C.pa),V.Ha(C.J),V}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function In(){}r=In.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function tf(){}tf.prototype.g=function(C,V){return new Co(C,V)};function Co(C,V){Cn.call(this),this.g=new uu(V),this.l=C,this.h=V&&V.messageUrlParams||null,C=V&&V.messageHeaders||null,V&&V.clientProtocolHeaderRequired&&(C?C["X-Client-Protocol"]="webchannel":C={"X-Client-Protocol":"webchannel"}),this.g.o=C,C=V&&V.initMessageHeaders||null,V&&V.messageContentType&&(C?C["X-WebChannel-Content-Type"]=V.messageContentType:C={"X-WebChannel-Content-Type":V.messageContentType}),V&&V.va&&(C?C["X-WebChannel-Client-Profile"]=V.va:C={"X-WebChannel-Client-Profile":V.va}),this.g.S=C,(C=V&&V.Sb)&&!J(C)&&(this.g.m=C),this.v=V&&V.supportsCrossDomainXhr||!1,this.u=V&&V.sendRawJson||!1,(V=V&&V.httpSessionIdParam)&&!J(V)&&(this.g.D=V,C=this.h,C!==null&&V in C&&(C=this.h,V in C&&delete C[V])),this.j=new Qa(this)}K(Co,Cn),Co.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Co.prototype.close=function(){Mi(this.g)},Co.prototype.o=function(C){var V=this.g;if(typeof C=="string"){var X={};X.__data__=C,C=X}else this.u&&(X={},X.__data__=sr(C),C=X);V.i.push(new id(V.Ya++,C)),V.G==3&&Ja(V)},Co.prototype.N=function(){this.g.l=null,delete this.j,Mi(this.g),delete this.g,Co.aa.N.call(this)};function iv(C){Cs.call(this),C.__headers__&&(this.headers=C.__headers__,this.statusCode=C.__status__,delete C.__headers__,delete C.__status__);var V=C.__sm__;if(V){e:{for(const X in V){C=X;break e}C=void 0}(this.i=C)&&(C=this.i,V=V!==null&&C in V?V[C]:void 0),this.data=V}else this.data=C}K(iv,Cs);function sv(){Ko.call(this),this.status=1}K(sv,Ko);function Qa(C){this.g=C}K(Qa,In),Qa.prototype.ua=function(){tn(this.g,"a")},Qa.prototype.ta=function(C){tn(this.g,new iv(C))},Qa.prototype.sa=function(C){tn(this.g,new sv)},Qa.prototype.ra=function(){tn(this.g,"b")},tf.prototype.createWebChannel=tf.prototype.g,Co.prototype.send=Co.prototype.o,Co.prototype.open=Co.prototype.m,Co.prototype.close=Co.prototype.close,Uee=function(){return new tf},Mee=function(){return nu()},xee=Ha,U2={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},iu.NO_ERROR=0,iu.TIMEOUT=8,iu.HTTP_ERROR=6,GO=iu,vh.COMPLETE="complete",Lee=vh,za.EventType=xi,xi.OPEN="a",xi.CLOSE="b",xi.ERROR="c",xi.MESSAGE="d",Cn.prototype.listen=Cn.prototype.K,fb=za,Ce.prototype.listenOnce=Ce.prototype.L,Ce.prototype.getLastError=Ce.prototype.Ka,Ce.prototype.getLastErrorCode=Ce.prototype.Ba,Ce.prototype.getStatus=Ce.prototype.Z,Ce.prototype.getResponseJson=Ce.prototype.Oa,Ce.prototype.getResponseText=Ce.prototype.oa,Ce.prototype.send=Ce.prototype.ea,Ce.prototype.setWithCredentials=Ce.prototype.Ha,Dee=Ce}).apply(typeof lO<"u"?lO:typeof self<"u"?self:typeof window<"u"?window:{});const uq="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ma.UNAUTHENTICATED=new ma(null),ma.GOOGLE_CREDENTIALS=new ma("google-credentials-uid"),ma.FIRST_PARTY=new ma("first-party-uid"),ma.MOCK_USER=new ma("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _S="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $_=new CV("@firebase/firestore");function $0(){return $_.logLevel}function Qt(r,...t){if($_.logLevel<=br.DEBUG){const s=t.map(UV);$_.debug(`Firestore (${_S}): ${r}`,...s)}}function Mp(r,...t){if($_.logLevel<=br.ERROR){const s=t.map(UV);$_.error(`Firestore (${_S}): ${r}`,...s)}}function tS(r,...t){if($_.logLevel<=br.WARN){const s=t.map(UV);$_.warn(`Firestore (${_S}): ${r}`,...s)}}function UV(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(r="Unexpected state"){const t=`FIRESTORE (${_S}) INTERNAL ASSERTION FAILED: `+r;throw Mp(t),new Error(t)}function ci(r,t){r||Mn()}function zn(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const St={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class en extends _h{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vee{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class P2e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(ma.UNAUTHENTICATED))}shutdown(){}}class N2e{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class k2e{constructor(t){this.t=t,this.currentUser=ma.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){ci(this.o===void 0);let a=this.i;const l=S=>this.i!==a?(a=this.i,s(S)):Promise.resolve();let d=new Np;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Np,t.enqueueRetryable(()=>l(this.currentUser))};const g=()=>{const S=d;t.enqueueRetryable(async()=>{await S.promise,await l(this.currentUser)})},E=S=>{Qt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=S,this.o&&(this.auth.addAuthTokenListener(this.o),g())};this.t.onInit(S=>E(S)),setTimeout(()=>{if(!this.auth){const S=this.t.getImmediate({optional:!0});S?E(S):(Qt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Np)}},0),g()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(Qt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(ci(typeof a.accessToken=="string"),new Vee(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ci(t===null||typeof t=="string"),new ma(t)}}class D2e{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=ma.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class L2e{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new D2e(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(ma.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class x2e{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class M2e{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,s){ci(this.o===void 0);const a=d=>{d.error!=null&&Qt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const g=d.token!==this.R;return this.R=d.token,Qt("FirebaseAppCheckTokenProvider",`Received ${g?"new":"existing"} token.`),g?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{Qt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Qt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(ci(typeof s.token=="string"),this.R=s.token,new x2e(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U2e(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<r;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fee{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=Math.floor(256/t.length)*t.length;let a="";for(;a.length<20;){const l=U2e(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%t.length))}return a}}function jr(r,t){return r<t?-1:r>t?1:0}function nS(r,t,s){return r.length===t.length&&r.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new en(St.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new en(St.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<-62135596800)throw new en(St.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new en(St.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ys.fromMillis(Date.now())}static fromDate(t){return Ys.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor(1e6*(t-1e3*s));return new Ys(s,a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?jr(this.nanoseconds,t.nanoseconds):jr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Gn(t)}static min(){return new Gn(new Ys(0,0))}static max(){return new Gn(new Ys(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(t,s,a){s===void 0?s=0:s>t.length&&Mn(),a===void 0?a=t.length-s:a>t.length-s&&Mn(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return cw.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof cw?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=t.get(l),g=s.get(l);if(d<g)return-1;if(d>g)return 1}return t.length<s.length?-1:t.length>s.length?1:0}}class Wi extends cw{construct(t,s,a){return new Wi(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new en(St.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new Wi(s)}static emptyPath(){return new Wi([])}}const V2e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Go extends cw{construct(t,s,a){return new Go(t,s,a)}static isValidIdentifier(t){return V2e.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Go.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Go(["__name__"])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new en(St.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let g=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new en(St.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const S=t[l+1];if(S!=="\\"&&S!=="."&&S!=="`")throw new en(St.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=S,l+=2}else E==="`"?(g=!g,l++):E!=="."||g?(a+=E,l++):(d(),l++)}if(d(),g)throw new en(St.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Go(s)}static emptyPath(){return new Go([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(t){this.path=t}static fromPath(t){return new En(Wi.fromString(t))}static fromName(t){return new En(Wi.fromString(t).popFirst(5))}static empty(){return new En(Wi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Wi.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return Wi.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new En(new Wi(t.slice()))}}function F2e(r,t){const s=r.toTimestamp().seconds,a=r.toTimestamp().nanoseconds+1,l=Gn.fromTimestamp(a===1e9?new Ys(s+1,0):new Ys(s,a));return new wm(l,En.empty(),t)}function j2e(r){return new wm(r.readTime,r.key,-1)}class wm{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new wm(Gn.min(),En.empty(),-1)}static max(){return new wm(Gn.max(),En.empty(),-1)}}function B2e(r,t){let s=r.readTime.compareTo(t.readTime);return s!==0?s:(s=En.comparator(r.documentKey,t.documentKey),s!==0?s:jr(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class G2e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jw(r){if(r.code!==St.FAILED_PRECONDITION||r.message!==W2e)throw r;Qt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&Mn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new Tt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof Tt?s:Tt.resolve(s)}catch(s){return Tt.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):Tt.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):Tt.reject(s)}static resolve(t){return new Tt((s,a)=>{s(t)})}static reject(t){return new Tt((s,a)=>{a(t)})}static waitFor(t){return new Tt((s,a)=>{let l=0,d=0,g=!1;t.forEach(E=>{++l,E.next(()=>{++d,g&&d===l&&s()},S=>a(S))}),g=!0,d===l&&s()})}static or(t){let s=Tt.resolve(!1);for(const a of t)s=s.next(l=>l?Tt.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new Tt((a,l)=>{const d=t.length,g=new Array(d);let E=0;for(let S=0;S<d;S++){const b=S;s(t[b]).next(R=>{g[b]=R,++E,E===d&&a(g)},R=>l(R))}})}static doWhile(t,s){return new Tt((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function z2e(r){const t=r.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function Bw(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VV{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.ie(a),this.se=a=>s.writeSequenceNumber(a))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}VV.oe=-1;function fN(r){return r==null}function TP(r){return r===0&&1/r==-1/0}function H2e(r){return typeof r=="number"&&Number.isInteger(r)&&!TP(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dq(r){let t=0;for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t++;return t}function ev(r,t){for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t(s,r[s])}function jee(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(t,s){this.comparator=t,this.root=s||Bo.EMPTY}insert(t,s){return new Zi(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,Bo.BLACK,null,null))}remove(t){return new Zi(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Bo.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new uO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new uO(this.root,t,this.comparator,!1)}getReverseIterator(){return new uO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new uO(this.root,t,this.comparator,!0)}}class uO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Bo{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??Bo.RED,this.left=l??Bo.EMPTY,this.right=d??Bo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new Bo(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Bo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return Bo.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Bo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Bo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Mn();const t=this.left.check();if(t!==this.right.check())throw Mn();return t+(this.isRed()?0:1)}}Bo.EMPTY=null,Bo.RED=!0,Bo.BLACK=!1;Bo.EMPTY=new class{constructor(){this.size=0}get key(){throw Mn()}get value(){throw Mn()}get color(){throw Mn()}get left(){throw Mn()}get right(){throw Mn()}copy(t,s,a,l,d){return this}insert(t,s,a){return new Bo(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(t){this.comparator=t,this.data=new Zi(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new hq(this.data.getIterator())}getIteratorFrom(t){return new hq(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof zo)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new zo(this.comparator);return s.data=t,s}}class hq{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(t){this.fields=t,t.sort(Go.comparator)}static empty(){return new ol([])}unionWith(t){let s=new zo(Go.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new ol(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return nS(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bee extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Bee("Invalid base64 string: "+d):d}}(t);return new Ho(s)}static fromUint8Array(t){const s=function(l){let d="";for(let g=0;g<l.length;++g)d+=String.fromCharCode(l[g]);return d}(t);return new Ho(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return jr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ho.EMPTY_BYTE_STRING=new Ho("");const K2e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rm(r){if(ci(!!r),typeof r=="string"){let t=0;const s=K2e.exec(r);if(ci(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(r);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:ws(r.seconds),nanos:ws(r.nanos)}}function ws(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function q_(r){return typeof r=="string"?Ho.fromBase64String(r):Ho.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FV(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||s===void 0?void 0:s.stringValue)==="server_timestamp"}function jV(r){const t=r.mapValue.fields.__previous_value__;return FV(t)?jV(t):t}function lw(r){const t=Rm(r.mapValue.fields.__local_write_time__.timestampValue);return new Ys(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2e{constructor(t,s,a,l,d,g,E,S,b){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=g,this.autoDetectLongPolling=E,this.longPollingOptions=S,this.useFetchStreams=b}}class uw{constructor(t,s){this.projectId=t,this.database=s||"(default)"}static empty(){return new uw("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof uw&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dO={mapValue:{}};function Y_(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?FV(r)?4:Y2e(r)?9007199254740991:q2e(r)?10:11:Mn()}function fh(r,t){if(r===t)return!0;const s=Y_(r);if(s!==Y_(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return lw(r).isEqual(lw(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const g=Rm(l.timestampValue),E=Rm(d.timestampValue);return g.seconds===E.seconds&&g.nanos===E.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(l,d){return q_(l.bytesValue).isEqual(q_(d.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(l,d){return ws(l.geoPointValue.latitude)===ws(d.geoPointValue.latitude)&&ws(l.geoPointValue.longitude)===ws(d.geoPointValue.longitude)}(r,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return ws(l.integerValue)===ws(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const g=ws(l.doubleValue),E=ws(d.doubleValue);return g===E?TP(g)===TP(E):isNaN(g)&&isNaN(E)}return!1}(r,t);case 9:return nS(r.arrayValue.values||[],t.arrayValue.values||[],fh);case 10:case 11:return function(l,d){const g=l.mapValue.fields||{},E=d.mapValue.fields||{};if(dq(g)!==dq(E))return!1;for(const S in g)if(g.hasOwnProperty(S)&&(E[S]===void 0||!fh(g[S],E[S])))return!1;return!0}(r,t);default:return Mn()}}function dw(r,t){return(r.values||[]).find(s=>fh(s,t))!==void 0}function rS(r,t){if(r===t)return 0;const s=Y_(r),a=Y_(t);if(s!==a)return jr(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return jr(r.booleanValue,t.booleanValue);case 2:return function(d,g){const E=ws(d.integerValue||d.doubleValue),S=ws(g.integerValue||g.doubleValue);return E<S?-1:E>S?1:E===S?0:isNaN(E)?isNaN(S)?0:-1:1}(r,t);case 3:return pq(r.timestampValue,t.timestampValue);case 4:return pq(lw(r),lw(t));case 5:return jr(r.stringValue,t.stringValue);case 6:return function(d,g){const E=q_(d),S=q_(g);return E.compareTo(S)}(r.bytesValue,t.bytesValue);case 7:return function(d,g){const E=d.split("/"),S=g.split("/");for(let b=0;b<E.length&&b<S.length;b++){const R=jr(E[b],S[b]);if(R!==0)return R}return jr(E.length,S.length)}(r.referenceValue,t.referenceValue);case 8:return function(d,g){const E=jr(ws(d.latitude),ws(g.latitude));return E!==0?E:jr(ws(d.longitude),ws(g.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return fq(r.arrayValue,t.arrayValue);case 10:return function(d,g){var E,S,b,R;const O=d.fields||{},N=g.fields||{},U=(E=O.value)===null||E===void 0?void 0:E.arrayValue,K=(S=N.value)===null||S===void 0?void 0:S.arrayValue,z=jr(((b=U==null?void 0:U.values)===null||b===void 0?void 0:b.length)||0,((R=K==null?void 0:K.values)===null||R===void 0?void 0:R.length)||0);return z!==0?z:fq(U,K)}(r.mapValue,t.mapValue);case 11:return function(d,g){if(d===dO.mapValue&&g===dO.mapValue)return 0;if(d===dO.mapValue)return 1;if(g===dO.mapValue)return-1;const E=d.fields||{},S=Object.keys(E),b=g.fields||{},R=Object.keys(b);S.sort(),R.sort();for(let O=0;O<S.length&&O<R.length;++O){const N=jr(S[O],R[O]);if(N!==0)return N;const U=rS(E[S[O]],b[R[O]]);if(U!==0)return U}return jr(S.length,R.length)}(r.mapValue,t.mapValue);default:throw Mn()}}function pq(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return jr(r,t);const s=Rm(r),a=Rm(t),l=jr(s.seconds,a.seconds);return l!==0?l:jr(s.nanos,a.nanos)}function fq(r,t){const s=r.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=rS(s[l],a[l]);if(d)return d}return jr(s.length,a.length)}function iS(r){return V2(r)}function V2(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(s){const a=Rm(s);return`time(${a.seconds},${a.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(s){return q_(s).toBase64()}(r.bytesValue):"referenceValue"in r?function(s){return En.fromName(s).toString()}(r.referenceValue):"geoPointValue"in r?function(s){return`geo(${s.latitude},${s.longitude})`}(r.geoPointValue):"arrayValue"in r?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=V2(d);return a+"]"}(r.arrayValue):"mapValue"in r?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const g of a)d?d=!1:l+=",",l+=`${g}:${V2(s.fields[g])}`;return l+"}"}(r.mapValue):Mn()}function F2(r){return!!r&&"integerValue"in r}function BV(r){return!!r&&"arrayValue"in r}function mq(r){return!!r&&"nullValue"in r}function gq(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function zO(r){return!!r&&"mapValue"in r}function q2e(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||s===void 0?void 0:s.stringValue)==="__vector__"}function Lb(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return ev(r.mapValue.fields,(s,a)=>t.mapValue.fields[s]=Lb(a)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(r.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=Lb(r.arrayValue.values[s]);return t}return Object.assign({},r)}function Y2e(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(t){this.value=t}static empty(){return new wc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!zO(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=Lb(s)}setAll(t){let s=Go.emptyPath(),a={},l=[];t.forEach((g,E)=>{if(!s.isImmediateParentOf(E)){const S=this.getFieldsMap(s);this.applyChanges(S,a,l),a={},l=[],s=E.popLast()}g?a[E.lastSegment()]=Lb(g):l.push(E.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());zO(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return fh(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];zO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){ev(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new wc(Lb(this.value))}}function Wee(r){const t=[];return ev(r.fields,(s,a)=>{const l=new Go([s]);if(zO(a)){const d=Wee(a.mapValue).fields;if(d.length===0)t.push(l);else for(const g of d)t.push(l.child(g))}else t.push(l)}),new ol(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(t,s,a,l,d,g,E){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=g,this.documentState=E}static newInvalidDocument(t){return new ga(t,0,Gn.min(),Gn.min(),Gn.min(),wc.empty(),0)}static newFoundDocument(t,s,a,l){return new ga(t,1,s,Gn.min(),a,l,0)}static newNoDocument(t,s){return new ga(t,2,s,Gn.min(),Gn.min(),wc.empty(),0)}static newUnknownDocument(t,s){return new ga(t,3,s,Gn.min(),Gn.min(),wc.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual(Gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=wc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=wc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ga&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ga(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(t,s){this.position=t,this.inclusive=s}}function _q(r,t,s){let a=0;for(let l=0;l<r.position.length;l++){const d=t[l],g=r.position[l];if(d.field.isKeyField()?a=En.comparator(En.fromName(g.referenceValue),s.key):a=rS(g,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function vq(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let s=0;s<r.position.length;s++)if(!fh(r.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wP{constructor(t,s="asc"){this.field=t,this.dir=s}}function X2e(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gee{}class qs extends Gee{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new Q2e(t,s,a):s==="array-contains"?new tUe(t,a):s==="in"?new nUe(t,a):s==="not-in"?new rUe(t,a):s==="array-contains-any"?new iUe(t,a):new qs(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new Z2e(t,a):new eUe(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(rS(s,this.value)):s!==null&&Y_(this.value)===Y_(s)&&this.matchesComparison(rS(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Mn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class mh extends Gee{constructor(t,s){super(),this.filters=t,this.op=s,this.ae=null}static create(t,s){return new mh(t,s)}matches(t){return zee(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function zee(r){return r.op==="and"}function Hee(r){return J2e(r)&&zee(r)}function J2e(r){for(const t of r.filters)if(t instanceof mh)return!1;return!0}function j2(r){if(r instanceof qs)return r.field.canonicalString()+r.op.toString()+iS(r.value);if(Hee(r))return r.filters.map(t=>j2(t)).join(",");{const t=r.filters.map(s=>j2(s)).join(",");return`${r.op}(${t})`}}function Kee(r,t){return r instanceof qs?function(a,l){return l instanceof qs&&a.op===l.op&&a.field.isEqual(l.field)&&fh(a.value,l.value)}(r,t):r instanceof mh?function(a,l){return l instanceof mh&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,g,E)=>d&&Kee(g,l.filters[E]),!0):!1}(r,t):void Mn()}function $ee(r){return r instanceof qs?function(s){return`${s.field.canonicalString()} ${s.op} ${iS(s.value)}`}(r):r instanceof mh?function(s){return s.op.toString()+" {"+s.getFilters().map($ee).join(" ,")+"}"}(r):"Filter"}class Q2e extends qs{constructor(t,s,a){super(t,s,a),this.key=En.fromName(a.referenceValue)}matches(t){const s=En.comparator(t.key,this.key);return this.matchesComparison(s)}}class Z2e extends qs{constructor(t,s){super(t,"in",s),this.keys=qee("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class eUe extends qs{constructor(t,s){super(t,"not-in",s),this.keys=qee("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function qee(r,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>En.fromName(a.referenceValue))}class tUe extends qs{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return BV(s)&&dw(s.arrayValue,this.value)}}class nUe extends qs{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&dw(this.value.arrayValue,s)}}class rUe extends qs{constructor(t,s){super(t,"not-in",s)}matches(t){if(dw(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!dw(this.value.arrayValue,s)}}class iUe extends qs{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!BV(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>dw(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sUe{constructor(t,s=null,a=[],l=[],d=null,g=null,E=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=g,this.endAt=E,this.ue=null}}function Eq(r,t=null,s=[],a=[],l=null,d=null,g=null){return new sUe(r,t,s,a,l,d,g)}function WV(r){const t=zn(r);if(t.ue===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>j2(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),fN(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>iS(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>iS(a)).join(",")),t.ue=s}return t.ue}function GV(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<r.orderBy.length;s++)if(!X2e(r.orderBy[s],t.orderBy[s]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let s=0;s<r.filters.length;s++)if(!Kee(r.filters[s],t.filters[s]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!vq(r.startAt,t.startAt)&&vq(r.endAt,t.endAt)}function B2(r){return En.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mN{constructor(t,s=null,a=[],l=[],d=null,g="F",E=null,S=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=g,this.startAt=E,this.endAt=S,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function oUe(r,t,s,a,l,d,g,E){return new mN(r,t,s,a,l,d,g,E)}function zV(r){return new mN(r)}function yq(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function aUe(r){return r.collectionGroup!==null}function xb(r){const t=zn(r);if(t.ce===null){t.ce=[];const s=new Set;for(const d of t.explicitOrderBy)t.ce.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(g){let E=new zo(Go.comparator);return g.filters.forEach(S=>{S.getFlattenedFilters().forEach(b=>{b.isInequality()&&(E=E.add(b.field))})}),E})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.ce.push(new wP(d,a))}),s.has(Go.keyField().canonicalString())||t.ce.push(new wP(Go.keyField(),a))}return t.ce}function lh(r){const t=zn(r);return t.le||(t.le=cUe(t,xb(r))),t.le}function cUe(r,t){if(r.limitType==="F")return Eq(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new wP(l.field,d)});const s=r.endAt?new bP(r.endAt.position,r.endAt.inclusive):null,a=r.startAt?new bP(r.startAt.position,r.startAt.inclusive):null;return Eq(r.path,r.collectionGroup,t,r.filters,r.limit,s,a)}}function W2(r,t,s){return new mN(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,s,r.startAt,r.endAt)}function gN(r,t){return GV(lh(r),lh(t))&&r.limitType===t.limitType}function Yee(r){return`${WV(lh(r))}|lt:${r.limitType}`}function fy(r){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>$ee(l)).join(", ")}]`),fN(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(g){return`${g.field.canonicalString()} (${g.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>iS(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>iS(l)).join(",")),`Target(${a})`}(lh(r))}; limitType=${r.limitType})`}function _N(r,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):En.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(r,t)&&function(a,l){for(const d of xb(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(r,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(r,t)&&function(a,l){return!(a.startAt&&!function(g,E,S){const b=_q(g,E,S);return g.inclusive?b<=0:b<0}(a.startAt,xb(a),l)||a.endAt&&!function(g,E,S){const b=_q(g,E,S);return g.inclusive?b>=0:b>0}(a.endAt,xb(a),l))}(r,t)}function lUe(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Xee(r){return(t,s)=>{let a=!1;for(const l of xb(r)){const d=uUe(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function uUe(r,t,s){const a=r.field.isKeyField()?En.comparator(t.key,s.key):function(d,g,E){const S=g.data.field(d),b=E.data.field(d);return S!==null&&b!==null?rS(S,b):Mn()}(r.field,t,s);switch(r.dir){case"asc":return a;case"desc":return-1*a;default:return Mn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){ev(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return jee(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dUe=new Zi(En.comparator);function Up(){return dUe}const Jee=new Zi(En.comparator);function mb(...r){let t=Jee;for(const s of r)t=t.insert(s.key,s);return t}function Qee(r){let t=Jee;return r.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function R_(){return Mb()}function Zee(){return Mb()}function Mb(){return new vS(r=>r.toString(),(r,t)=>r.isEqual(t))}const hUe=new Zi(En.comparator),pUe=new zo(En.comparator);function mr(...r){let t=pUe;for(const s of r)t=t.add(s);return t}const fUe=new zo(jr);function mUe(){return fUe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HV(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:TP(t)?"-0":t}}function ete(r){return{integerValue:""+r}}function gUe(r,t){return H2e(t)?ete(t):HV(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{constructor(){this._=void 0}}function _Ue(r,t,s){return r instanceof RP?function(l,d){const g={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&FV(d)&&(d=jV(d)),d&&(g.fields.__previous_value__=d),{mapValue:g}}(s,t):r instanceof hw?nte(r,t):r instanceof pw?rte(r,t):function(l,d){const g=tte(l,d),E=Sq(g)+Sq(l.Pe);return F2(g)&&F2(l.Pe)?ete(E):HV(l.serializer,E)}(r,t)}function vUe(r,t,s){return r instanceof hw?nte(r,t):r instanceof pw?rte(r,t):s}function tte(r,t){return r instanceof CP?function(a){return F2(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class RP extends vN{}class hw extends vN{constructor(t){super(),this.elements=t}}function nte(r,t){const s=ite(t);for(const a of r.elements)s.some(l=>fh(l,a))||s.push(a);return{arrayValue:{values:s}}}class pw extends vN{constructor(t){super(),this.elements=t}}function rte(r,t){let s=ite(t);for(const a of r.elements)s=s.filter(l=>!fh(l,a));return{arrayValue:{values:s}}}class CP extends vN{constructor(t,s){super(),this.serializer=t,this.Pe=s}}function Sq(r){return ws(r.integerValue||r.doubleValue)}function ite(r){return BV(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function EUe(r,t){return r.field.isEqual(t.field)&&function(a,l){return a instanceof hw&&l instanceof hw||a instanceof pw&&l instanceof pw?nS(a.elements,l.elements,fh):a instanceof CP&&l instanceof CP?fh(a.Pe,l.Pe):a instanceof RP&&l instanceof RP}(r.transform,t.transform)}class yUe{constructor(t,s){this.version=t,this.transformResults=s}}class uh{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new uh}static exists(t){return new uh(void 0,t)}static updateTime(t){return new uh(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function HO(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class EN{}function ste(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new ate(r.key,uh.none()):new Ww(r.key,r.data,uh.none());{const s=r.data,a=wc.empty();let l=new zo(Go.comparator);for(let d of t.fields)if(!l.has(d)){let g=s.field(d);g===null&&d.length>1&&(d=d.popLast(),g=s.field(d)),g===null?a.delete(d):a.set(d,g),l=l.add(d)}return new Lm(r.key,a,new ol(l.toArray()),uh.none())}}function SUe(r,t,s){r instanceof Ww?function(l,d,g){const E=l.value.clone(),S=bq(l.fieldTransforms,d,g.transformResults);E.setAll(S),d.convertToFoundDocument(g.version,E).setHasCommittedMutations()}(r,t,s):r instanceof Lm?function(l,d,g){if(!HO(l.precondition,d))return void d.convertToUnknownDocument(g.version);const E=bq(l.fieldTransforms,d,g.transformResults),S=d.data;S.setAll(ote(l)),S.setAll(E),d.convertToFoundDocument(g.version,S).setHasCommittedMutations()}(r,t,s):function(l,d,g){d.convertToNoDocument(g.version).setHasCommittedMutations()}(0,t,s)}function Ub(r,t,s,a){return r instanceof Ww?function(d,g,E,S){if(!HO(d.precondition,g))return E;const b=d.value.clone(),R=wq(d.fieldTransforms,S,g);return b.setAll(R),g.convertToFoundDocument(g.version,b).setHasLocalMutations(),null}(r,t,s,a):r instanceof Lm?function(d,g,E,S){if(!HO(d.precondition,g))return E;const b=wq(d.fieldTransforms,S,g),R=g.data;return R.setAll(ote(d)),R.setAll(b),g.convertToFoundDocument(g.version,R).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(O=>O.field))}(r,t,s,a):function(d,g,E){return HO(d.precondition,g)?(g.convertToNoDocument(g.version).setHasLocalMutations(),null):E}(r,t,s)}function TUe(r,t){let s=null;for(const a of r.fieldTransforms){const l=t.data.field(a.field),d=tte(a.transform,l||null);d!=null&&(s===null&&(s=wc.empty()),s.set(a.field,d))}return s||null}function Tq(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&nS(a,l,(d,g)=>EUe(d,g))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class Ww extends EN{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Lm extends EN{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function ote(r){const t=new Map;return r.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=r.data.field(s);t.set(s,a)}}),t}function bq(r,t,s){const a=new Map;ci(r.length===s.length);for(let l=0;l<s.length;l++){const d=r[l],g=d.transform,E=t.data.field(d.field);a.set(d.field,vUe(g,E,s[l]))}return a}function wq(r,t,s){const a=new Map;for(const l of r){const d=l.transform,g=s.data.field(l.field);a.set(l.field,_Ue(d,g,t))}return a}class ate extends EN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bUe extends EN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wUe{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&SUe(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=Ub(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=Ub(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=Zee();return this.mutations.forEach(l=>{const d=t.get(l.key),g=d.overlayedDocument;let E=this.applyToLocalView(g,d.mutatedFields);E=s.has(l.key)?null:E;const S=ste(g,E);S!==null&&a.set(l.key,S),g.isValidDocument()||g.convertToNoDocument(Gn.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),mr())}isEqual(t){return this.batchId===t.batchId&&nS(this.mutations,t.mutations,(s,a)=>Tq(s,a))&&nS(this.baseMutations,t.baseMutations,(s,a)=>Tq(s,a))}}class KV{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){ci(t.mutations.length===a.length);let l=function(){return hUe}();const d=t.mutations;for(let g=0;g<d.length;g++)l=l.insert(d[g].key,a[g].version);return new KV(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RUe{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CUe{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ds,Ir;function IUe(r){switch(r){default:return Mn();case St.CANCELLED:case St.UNKNOWN:case St.DEADLINE_EXCEEDED:case St.RESOURCE_EXHAUSTED:case St.INTERNAL:case St.UNAVAILABLE:case St.UNAUTHENTICATED:return!1;case St.INVALID_ARGUMENT:case St.NOT_FOUND:case St.ALREADY_EXISTS:case St.PERMISSION_DENIED:case St.FAILED_PRECONDITION:case St.ABORTED:case St.OUT_OF_RANGE:case St.UNIMPLEMENTED:case St.DATA_LOSS:return!0}}function cte(r){if(r===void 0)return Mp("GRPC error has no .code"),St.UNKNOWN;switch(r){case Ds.OK:return St.OK;case Ds.CANCELLED:return St.CANCELLED;case Ds.UNKNOWN:return St.UNKNOWN;case Ds.DEADLINE_EXCEEDED:return St.DEADLINE_EXCEEDED;case Ds.RESOURCE_EXHAUSTED:return St.RESOURCE_EXHAUSTED;case Ds.INTERNAL:return St.INTERNAL;case Ds.UNAVAILABLE:return St.UNAVAILABLE;case Ds.UNAUTHENTICATED:return St.UNAUTHENTICATED;case Ds.INVALID_ARGUMENT:return St.INVALID_ARGUMENT;case Ds.NOT_FOUND:return St.NOT_FOUND;case Ds.ALREADY_EXISTS:return St.ALREADY_EXISTS;case Ds.PERMISSION_DENIED:return St.PERMISSION_DENIED;case Ds.FAILED_PRECONDITION:return St.FAILED_PRECONDITION;case Ds.ABORTED:return St.ABORTED;case Ds.OUT_OF_RANGE:return St.OUT_OF_RANGE;case Ds.UNIMPLEMENTED:return St.UNIMPLEMENTED;case Ds.DATA_LOSS:return St.DATA_LOSS;default:return Mn()}}(Ir=Ds||(Ds={}))[Ir.OK=0]="OK",Ir[Ir.CANCELLED=1]="CANCELLED",Ir[Ir.UNKNOWN=2]="UNKNOWN",Ir[Ir.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ir[Ir.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ir[Ir.NOT_FOUND=5]="NOT_FOUND",Ir[Ir.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ir[Ir.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ir[Ir.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ir[Ir.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ir[Ir.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ir[Ir.ABORTED=10]="ABORTED",Ir[Ir.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ir[Ir.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ir[Ir.INTERNAL=13]="INTERNAL",Ir[Ir.UNAVAILABLE=14]="UNAVAILABLE",Ir[Ir.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AUe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OUe=new x_([4294967295,4294967295],0);function Rq(r){const t=AUe().encode(r),s=new kee;return s.update(t),new Uint8Array(s.digest())}function Cq(r){const t=new DataView(r.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new x_([s,a],0),new x_([l,d],0)]}class $V{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new gb(`Invalid padding: ${s}`);if(a<0)throw new gb(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new gb(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new gb(`Invalid padding when bitmap length is 0: ${s}`);this.Ie=8*t.length-s,this.Te=x_.fromNumber(this.Ie)}Ee(t,s,a){let l=t.add(s.multiply(x_.fromNumber(a)));return l.compare(OUe)===1&&(l=new x_([l.getBits(0),l.getBits(1)],0)),l.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;const s=Rq(t),[a,l]=Cq(s);for(let d=0;d<this.hashCount;d++){const g=this.Ee(a,l,d);if(!this.de(g))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),g=new $V(d,l,s);return a.forEach(E=>g.insert(E)),g}insert(t){if(this.Ie===0)return;const s=Rq(t),[a,l]=Cq(s);for(let d=0;d<this.hashCount;d++){const g=this.Ee(a,l,d);this.Ae(g)}}Ae(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class gb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,Gw.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new yN(Gn.min(),l,new Zi(jr),Up(),mr())}}class Gw{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new Gw(a,s,mr(),mr(),mr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KO{constructor(t,s,a,l){this.Re=t,this.removedTargetIds=s,this.key=a,this.Ve=l}}class lte{constructor(t,s){this.targetId=t,this.me=s}}class ute{constructor(t,s,a=Ho.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class Iq{constructor(){this.fe=0,this.ge=Oq(),this.pe=Ho.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=mr(),s=mr(),a=mr();return this.ge.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:Mn()}}),new Gw(this.pe,this.ye,t,s,a)}Ce(){this.we=!1,this.ge=Oq()}Fe(t,s){this.we=!0,this.ge=this.ge.insert(t,s)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,ci(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class PUe{constructor(t){this.Le=t,this.Be=new Map,this.ke=Up(),this.qe=Aq(),this.Qe=new Zi(jr)}Ke(t){for(const s of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(s,t.Ve):this.Ue(s,t.key,t.Ve);for(const s of t.removedTargetIds)this.Ue(s,t.key,t.Ve)}We(t){this.forEachTarget(t,s=>{const a=this.Ge(s);switch(t.state){case 0:this.ze(s)&&a.De(t.resumeToken);break;case 1:a.Oe(),a.Se||a.Ce(),a.De(t.resumeToken);break;case 2:a.Oe(),a.Se||this.removeTarget(s);break;case 3:this.ze(s)&&(a.Ne(),a.De(t.resumeToken));break;case 4:this.ze(s)&&(this.je(s),a.De(t.resumeToken));break;default:Mn()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.Be.forEach((a,l)=>{this.ze(l)&&s(l)})}He(t){const s=t.targetId,a=t.me.count,l=this.Je(s);if(l){const d=l.target;if(B2(d))if(a===0){const g=new En(d.path);this.Ue(s,g,ga.newNoDocument(g,Gn.min()))}else ci(a===1);else{const g=this.Ye(s);if(g!==a){const E=this.Ze(t),S=E?this.Xe(E,t,g):1;if(S!==0){this.je(s);const b=S===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(s,b)}}}}}Ze(t){const s=t.me.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let g,E;try{g=q_(a).toUint8Array()}catch(S){if(S instanceof Bee)return tS("Decoding the base64 bloom filter in existence filter failed ("+S.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw S}try{E=new $V(g,l,d)}catch(S){return tS(S instanceof gb?"BloomFilter error: ":"Applying bloom filter failed: ",S),null}return E.Ie===0?null:E}Xe(t,s,a){return s.me.count===a-this.nt(t,s.targetId)?0:2}nt(t,s){const a=this.Le.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const g=this.Le.tt(),E=`projects/${g.projectId}/databases/${g.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.Ue(s,d,null),l++)}),l}rt(t){const s=new Map;this.Be.forEach((d,g)=>{const E=this.Je(g);if(E){if(d.current&&B2(E.target)){const S=new En(E.target.path);this.ke.get(S)!==null||this.it(g,S)||this.Ue(g,S,ga.newNoDocument(S,t))}d.be&&(s.set(g,d.ve()),d.Ce())}});let a=mr();this.qe.forEach((d,g)=>{let E=!0;g.forEachWhile(S=>{const b=this.Je(S);return!b||b.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.ke.forEach((d,g)=>g.setReadTime(t));const l=new yN(t,s,this.Qe,this.ke,a);return this.ke=Up(),this.qe=Aq(),this.Qe=new Zi(jr),l}$e(t,s){if(!this.ze(t))return;const a=this.it(t,s.key)?2:0;this.Ge(t).Fe(s.key,a),this.ke=this.ke.insert(s.key,s),this.qe=this.qe.insert(s.key,this.st(s.key).add(t))}Ue(t,s,a){if(!this.ze(t))return;const l=this.Ge(t);this.it(t,s)?l.Fe(s,1):l.Me(s),this.qe=this.qe.insert(s,this.st(s).delete(t)),a&&(this.ke=this.ke.insert(s,a))}removeTarget(t){this.Be.delete(t)}Ye(t){const s=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let s=this.Be.get(t);return s||(s=new Iq,this.Be.set(t,s)),s}st(t){let s=this.qe.get(t);return s||(s=new zo(jr),this.qe=this.qe.insert(t,s)),s}ze(t){const s=this.Je(t)!==null;return s||Qt("WatchChangeAggregator","Detected inactive target",t),s}Je(t){const s=this.Be.get(t);return s&&s.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new Iq),this.Le.getRemoteKeysForTarget(t).forEach(s=>{this.Ue(t,s,null)})}it(t,s){return this.Le.getRemoteKeysForTarget(t).has(s)}}function Aq(){return new Zi(En.comparator)}function Oq(){return new Zi(En.comparator)}const NUe={asc:"ASCENDING",desc:"DESCENDING"},kUe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},DUe={and:"AND",or:"OR"};class LUe{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function G2(r,t){return r.useProto3Json||fN(t)?t:{value:t}}function IP(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function dte(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function xUe(r,t){return IP(r,t.toTimestamp())}function dh(r){return ci(!!r),Gn.fromTimestamp(function(s){const a=Rm(s);return new Ys(a.seconds,a.nanos)}(r))}function qV(r,t){return z2(r,t).canonicalString()}function z2(r,t){const s=function(l){return new Wi(["projects",l.projectId,"databases",l.database])}(r).child("documents");return t===void 0?s:s.child(t)}function hte(r){const t=Wi.fromString(r);return ci(_te(t)),t}function H2(r,t){return qV(r.databaseId,t.path)}function vM(r,t){const s=hte(t);if(s.get(1)!==r.databaseId.projectId)throw new en(St.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+r.databaseId.projectId);if(s.get(3)!==r.databaseId.database)throw new en(St.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+r.databaseId.database);return new En(fte(s))}function pte(r,t){return qV(r.databaseId,t)}function MUe(r){const t=hte(r);return t.length===4?Wi.emptyPath():fte(t)}function K2(r){return new Wi(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function fte(r){return ci(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Pq(r,t,s){return{name:H2(r,t),fields:s.value.mapValue.fields}}function UUe(r,t){let s;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Mn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,R){return b.useProto3Json?(ci(R===void 0||typeof R=="string"),Ho.fromBase64String(R||"")):(ci(R===void 0||R instanceof Buffer||R instanceof Uint8Array),Ho.fromUint8Array(R||new Uint8Array))}(r,t.targetChange.resumeToken),g=t.targetChange.cause,E=g&&function(b){const R=b.code===void 0?St.UNKNOWN:cte(b.code);return new en(R,b.message||"")}(g);s=new ute(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=vM(r,a.document.name),d=dh(a.document.updateTime),g=a.document.createTime?dh(a.document.createTime):Gn.min(),E=new wc({mapValue:{fields:a.document.fields}}),S=ga.newFoundDocument(l,d,g,E),b=a.targetIds||[],R=a.removedTargetIds||[];s=new KO(b,R,S.key,S)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=vM(r,a.document),d=a.readTime?dh(a.readTime):Gn.min(),g=ga.newNoDocument(l,d),E=a.removedTargetIds||[];s=new KO([],E,g.key,g)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=vM(r,a.document),d=a.removedTargetIds||[];s=new KO([],d,l,null)}else{if(!("filter"in t))return Mn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,g=new CUe(l,d),E=a.targetId;s=new lte(E,g)}}return s}function VUe(r,t){let s;if(t instanceof Ww)s={update:Pq(r,t.key,t.value)};else if(t instanceof ate)s={delete:H2(r,t.key)};else if(t instanceof Lm)s={update:Pq(r,t.key,t.data),updateMask:$Ue(t.fieldMask)};else{if(!(t instanceof bUe))return Mn();s={verify:H2(r,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,g){const E=g.transform;if(E instanceof RP)return{fieldPath:g.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof hw)return{fieldPath:g.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof pw)return{fieldPath:g.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof CP)return{fieldPath:g.field.canonicalString(),increment:E.Pe};throw Mn()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:xUe(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Mn()}(r,t.precondition)),s}function FUe(r,t){return r&&r.length>0?(ci(t!==void 0),r.map(s=>function(l,d){let g=l.updateTime?dh(l.updateTime):dh(d);return g.isEqual(Gn.min())&&(g=dh(d)),new yUe(g,l.transformResults||[])}(s,t))):[]}function jUe(r,t){return{documents:[pte(r,t.path)]}}function BUe(r,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=pte(r,l);const d=function(b){if(b.length!==0)return gte(mh.create(b,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const g=function(b){if(b.length!==0)return b.map(R=>function(N){return{field:my(N.field),direction:zUe(N.dir)}}(R))}(t.orderBy);g&&(s.structuredQuery.orderBy=g);const E=G2(r,t.limit);return E!==null&&(s.structuredQuery.limit=E),t.startAt&&(s.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{_t:s,parent:l}}function WUe(r){let t=MUe(r.parent);const s=r.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){ci(a===1);const R=s.from[0];R.allDescendants?l=R.collectionId:t=t.child(R.collectionId)}let d=[];s.where&&(d=function(O){const N=mte(O);return N instanceof mh&&Hee(N)?N.getFilters():[N]}(s.where));let g=[];s.orderBy&&(g=function(O){return O.map(N=>function(K){return new wP(gy(K.field),function(H){switch(H){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(K.direction))}(N))}(s.orderBy));let E=null;s.limit&&(E=function(O){let N;return N=typeof O=="object"?O.value:O,fN(N)?null:N}(s.limit));let S=null;s.startAt&&(S=function(O){const N=!!O.before,U=O.values||[];return new bP(U,N)}(s.startAt));let b=null;return s.endAt&&(b=function(O){const N=!O.before,U=O.values||[];return new bP(U,N)}(s.endAt)),oUe(t,l,g,d,E,"F",S,b)}function GUe(r,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Mn()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function mte(r){return r.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=gy(s.unaryFilter.field);return qs.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=gy(s.unaryFilter.field);return qs.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=gy(s.unaryFilter.field);return qs.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const g=gy(s.unaryFilter.field);return qs.create(g,"!=",{nullValue:"NULL_VALUE"});default:return Mn()}}(r):r.fieldFilter!==void 0?function(s){return qs.create(gy(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Mn()}}(s.fieldFilter.op),s.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(s){return mh.create(s.compositeFilter.filters.map(a=>mte(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Mn()}}(s.compositeFilter.op))}(r):Mn()}function zUe(r){return NUe[r]}function HUe(r){return kUe[r]}function KUe(r){return DUe[r]}function my(r){return{fieldPath:r.canonicalString()}}function gy(r){return Go.fromServerFormat(r.fieldPath)}function gte(r){return r instanceof qs?function(s){if(s.op==="=="){if(gq(s.value))return{unaryFilter:{field:my(s.field),op:"IS_NAN"}};if(mq(s.value))return{unaryFilter:{field:my(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(gq(s.value))return{unaryFilter:{field:my(s.field),op:"IS_NOT_NAN"}};if(mq(s.value))return{unaryFilter:{field:my(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:my(s.field),op:HUe(s.op),value:s.value}}}(r):r instanceof mh?function(s){const a=s.getFilters().map(l=>gte(l));return a.length===1?a[0]:{compositeFilter:{op:KUe(s.op),filters:a}}}(r):Mn()}function $Ue(r){const t=[];return r.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function _te(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dm{constructor(t,s,a,l,d=Gn.min(),g=Gn.min(),E=Ho.EMPTY_BYTE_STRING,S=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=g,this.resumeToken=E,this.expectedCount=S}withSequenceNumber(t){return new dm(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new dm(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new dm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new dm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qUe{constructor(t){this.ct=t}}function YUe(r){const t=WUe({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?W2(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XUe{constructor(){this.un=new JUe}addToCollectionParentIndex(t,s){return this.un.add(s),Tt.resolve()}getCollectionParents(t,s){return Tt.resolve(this.un.getEntries(s))}addFieldIndex(t,s){return Tt.resolve()}deleteFieldIndex(t,s){return Tt.resolve()}deleteAllFieldIndexes(t){return Tt.resolve()}createTargetIndexes(t,s){return Tt.resolve()}getDocumentsMatchingTarget(t,s){return Tt.resolve(null)}getIndexType(t,s){return Tt.resolve(0)}getFieldIndexes(t,s){return Tt.resolve([])}getNextCollectionGroupToUpdate(t){return Tt.resolve(null)}getMinOffset(t,s){return Tt.resolve(wm.min())}getMinOffsetFromCollectionGroup(t,s){return Tt.resolve(wm.min())}updateCollectionGroup(t,s,a){return Tt.resolve()}updateIndexEntries(t,s){return Tt.resolve()}}class JUe{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new zo(Wi.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new zo(Wi.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new sS(0)}static kn(){return new sS(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QUe{constructor(){this.changes=new vS(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,ga.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?Tt.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZUe{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eVe{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&Ub(a.mutation,l,ol.empty(),Ys.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,mr()).next(()=>a))}getLocalViewOfDocuments(t,s,a=mr()){const l=R_();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let g=mb();return d.forEach((E,S)=>{g=g.insert(E,S.overlayedDocument)}),g}))}getOverlayedDocuments(t,s){const a=R_();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,mr()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((g,E)=>{s.set(g,E)})})}computeViews(t,s,a,l){let d=Up();const g=Mb(),E=function(){return Mb()}();return s.forEach((S,b)=>{const R=a.get(b.key);l.has(b.key)&&(R===void 0||R.mutation instanceof Lm)?d=d.insert(b.key,b):R!==void 0?(g.set(b.key,R.mutation.getFieldMask()),Ub(R.mutation,b,R.mutation.getFieldMask(),Ys.now())):g.set(b.key,ol.empty())}),this.recalculateAndSaveOverlays(t,d).next(S=>(S.forEach((b,R)=>g.set(b,R)),s.forEach((b,R)=>{var O;return E.set(b,new ZUe(R,(O=g.get(b))!==null&&O!==void 0?O:null))}),E))}recalculateAndSaveOverlays(t,s){const a=Mb();let l=new Zi((g,E)=>g-E),d=mr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(g=>{for(const E of g)E.keys().forEach(S=>{const b=s.get(S);if(b===null)return;let R=a.get(S)||ol.empty();R=E.applyToLocalView(b,R),a.set(S,R);const O=(l.get(E.batchId)||mr()).add(S);l=l.insert(E.batchId,O)})}).next(()=>{const g=[],E=l.getReverseIterator();for(;E.hasNext();){const S=E.getNext(),b=S.key,R=S.value,O=Zee();R.forEach(N=>{if(!d.has(N)){const U=ste(s.get(N),a.get(N));U!==null&&O.set(N,U),d=d.add(N)}}),g.push(this.documentOverlayCache.saveOverlays(t,b,O))}return Tt.waitFor(g)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(g){return En.isDocumentKey(g.path)&&g.collectionGroup===null&&g.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):aUe(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const g=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):Tt.resolve(R_());let E=-1,S=d;return g.next(b=>Tt.forEach(b,(R,O)=>(E<O.largestBatchId&&(E=O.largestBatchId),d.get(R)?Tt.resolve():this.remoteDocumentCache.getEntry(t,R).next(N=>{S=S.insert(R,N)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,S,b,mr())).next(R=>({batchId:E,changes:Qee(R)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new En(s)).next(a=>{let l=mb();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let g=mb();return this.indexManager.getCollectionParents(t,d).next(E=>Tt.forEach(E,S=>{const b=function(O,N){return new mN(N,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(s,S.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(R=>{R.forEach((O,N)=>{g=g.insert(O,N)})})}).next(()=>g))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(g=>(d=g,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(g=>{d.forEach((S,b)=>{const R=b.getKey();g.get(R)===null&&(g=g.insert(R,ga.newInvalidDocument(R)))});let E=mb();return g.forEach((S,b)=>{const R=d.get(S);R!==void 0&&Ub(R.mutation,b,ol.empty(),Ys.now()),_N(s,b)&&(E=E.insert(S,b))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tVe{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,s){return Tt.resolve(this.hr.get(s))}saveBundleMetadata(t,s){return this.hr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:dh(l.createTime)}}(s)),Tt.resolve()}getNamedQuery(t,s){return Tt.resolve(this.Pr.get(s))}saveNamedQuery(t,s){return this.Pr.set(s.name,function(l){return{name:l.name,query:YUe(l.bundledQuery),readTime:dh(l.readTime)}}(s)),Tt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nVe{constructor(){this.overlays=new Zi(En.comparator),this.Ir=new Map}getOverlay(t,s){return Tt.resolve(this.overlays.get(s))}getOverlays(t,s){const a=R_();return Tt.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.ht(t,s,d)}),Tt.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Ir.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Ir.delete(a)),Tt.resolve()}getOverlaysForCollection(t,s,a){const l=R_(),d=s.length+1,g=new En(s.child("")),E=this.overlays.getIteratorFrom(g);for(;E.hasNext();){const S=E.getNext().value,b=S.getKey();if(!s.isPrefixOf(b.path))break;b.path.length===d&&S.largestBatchId>a&&l.set(S.getKey(),S)}return Tt.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new Zi((b,R)=>b-R);const g=this.overlays.getIterator();for(;g.hasNext();){const b=g.getNext().value;if(b.getKey().getCollectionGroup()===s&&b.largestBatchId>a){let R=d.get(b.largestBatchId);R===null&&(R=R_(),d=d.insert(b.largestBatchId,R)),R.set(b.getKey(),b)}}const E=R_(),S=d.getIterator();for(;S.hasNext()&&(S.getNext().value.forEach((b,R)=>E.set(b,R)),!(E.size()>=l)););return Tt.resolve(E)}ht(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const g=this.Ir.get(l.largestBatchId).delete(a.key);this.Ir.set(l.largestBatchId,g)}this.overlays=this.overlays.insert(a.key,new RUe(s,a));let d=this.Ir.get(s);d===void 0&&(d=mr(),this.Ir.set(s,d)),this.Ir.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rVe{constructor(){this.sessionToken=Ho.EMPTY_BYTE_STRING}getSessionToken(t){return Tt.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,Tt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YV{constructor(){this.Tr=new zo(uo.Er),this.dr=new zo(uo.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,s){const a=new uo(t,s);this.Tr=this.Tr.add(a),this.dr=this.dr.add(a)}Rr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.Vr(new uo(t,s))}mr(t,s){t.forEach(a=>this.removeReference(a,s))}gr(t){const s=new En(new Wi([])),a=new uo(s,t),l=new uo(s,t+1),d=[];return this.dr.forEachInRange([a,l],g=>{this.Vr(g),d.push(g.key)}),d}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){const s=new En(new Wi([])),a=new uo(s,t),l=new uo(s,t+1);let d=mr();return this.dr.forEachInRange([a,l],g=>{d=d.add(g.key)}),d}containsKey(t){const s=new uo(t,0),a=this.Tr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class uo{constructor(t,s){this.key=t,this.wr=s}static Er(t,s){return En.comparator(t.key,s.key)||jr(t.wr,s.wr)}static Ar(t,s){return jr(t.wr,s.wr)||En.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iVe{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Sr=1,this.br=new zo(uo.Er)}checkEmpty(t){return Tt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const g=new wUe(d,s,a,l);this.mutationQueue.push(g);for(const E of l)this.br=this.br.add(new uo(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return Tt.resolve(g)}lookupMutationBatch(t,s){return Tt.resolve(this.Dr(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.vr(a),d=l<0?0:l;return Tt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Tt.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return Tt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new uo(s,0),l=new uo(s,Number.POSITIVE_INFINITY),d=[];return this.br.forEachInRange([a,l],g=>{const E=this.Dr(g.wr);d.push(E)}),Tt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new zo(jr);return s.forEach(l=>{const d=new uo(l,0),g=new uo(l,Number.POSITIVE_INFINITY);this.br.forEachInRange([d,g],E=>{a=a.add(E.wr)})}),Tt.resolve(this.Cr(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;En.isDocumentKey(d)||(d=d.child(""));const g=new uo(new En(d),0);let E=new zo(jr);return this.br.forEachWhile(S=>{const b=S.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(E=E.add(S.wr)),!0)},g),Tt.resolve(this.Cr(E))}Cr(t){const s=[];return t.forEach(a=>{const l=this.Dr(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){ci(this.Fr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.br;return Tt.forEach(s.mutations,l=>{const d=new uo(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.br=a})}On(t){}containsKey(t,s){const a=new uo(s,0),l=this.br.firstAfterOrEqual(a);return Tt.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Tt.resolve()}Fr(t,s){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){const s=this.vr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sVe{constructor(t){this.Mr=t,this.docs=function(){return new Zi(En.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,g=this.Mr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:g}),this.size+=g-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return Tt.resolve(a?a.document.mutableCopy():ga.newInvalidDocument(s))}getEntries(t,s){let a=Up();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():ga.newInvalidDocument(l))}),Tt.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=Up();const g=s.path,E=new En(g.child("")),S=this.docs.getIteratorFrom(E);for(;S.hasNext();){const{key:b,value:{document:R}}=S.getNext();if(!g.isPrefixOf(b.path))break;b.path.length>g.length+1||B2e(j2e(R),a)<=0||(l.has(R.key)||_N(s,R))&&(d=d.insert(R.key,R.mutableCopy()))}return Tt.resolve(d)}getAllFromCollectionGroup(t,s,a,l){Mn()}Or(t,s){return Tt.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new oVe(this)}getSize(t){return Tt.resolve(this.size)}}class oVe extends QUe{constructor(t){super(),this.cr=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.cr.addEntry(t,l)):this.cr.removeEntry(a)}),Tt.waitFor(s)}getFromCache(t,s){return this.cr.getEntry(t,s)}getAllFromCache(t,s){return this.cr.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aVe{constructor(t){this.persistence=t,this.Nr=new vS(s=>WV(s),GV),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.Lr=0,this.Br=new YV,this.targetCount=0,this.kr=sS.Bn()}forEachTarget(t,s){return this.Nr.forEach((a,l)=>s(l)),Tt.resolve()}getLastRemoteSnapshotVersion(t){return Tt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Tt.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),Tt.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.Lr&&(this.Lr=s),Tt.resolve()}Kn(t){this.Nr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.kr=new sS(s),this.highestTargetId=s),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,s){return this.Kn(s),this.targetCount+=1,Tt.resolve()}updateTargetData(t,s){return this.Kn(s),Tt.resolve()}removeTargetData(t,s){return this.Nr.delete(s.target),this.Br.gr(s.targetId),this.targetCount-=1,Tt.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Nr.forEach((g,E)=>{E.sequenceNumber<=s&&a.get(E.targetId)===null&&(this.Nr.delete(g),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),Tt.waitFor(d).next(()=>l)}getTargetCount(t){return Tt.resolve(this.targetCount)}getTargetData(t,s){const a=this.Nr.get(s)||null;return Tt.resolve(a)}addMatchingKeys(t,s,a){return this.Br.Rr(s,a),Tt.resolve()}removeMatchingKeys(t,s,a){this.Br.mr(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(g=>{d.push(l.markPotentiallyOrphaned(t,g))}),Tt.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Br.gr(s),Tt.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Br.yr(s);return Tt.resolve(a)}containsKey(t,s){return Tt.resolve(this.Br.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cVe{constructor(t,s){this.qr={},this.overlays={},this.Qr=new VV(0),this.Kr=!1,this.Kr=!0,this.$r=new rVe,this.referenceDelegate=t(this),this.Ur=new aVe(this),this.indexManager=new XUe,this.remoteDocumentCache=function(l){return new sVe(l)}(a=>this.referenceDelegate.Wr(a)),this.serializer=new qUe(s),this.Gr=new tVe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new nVe,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.qr[t.toKey()];return a||(a=new iVe(s,this.referenceDelegate),this.qr[t.toKey()]=a),a}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,s,a){Qt("MemoryPersistence","Starting transaction:",t);const l=new lVe(this.Qr.next());return this.referenceDelegate.zr(),a(l).next(d=>this.referenceDelegate.jr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}Hr(t,s){return Tt.or(Object.values(this.qr).map(a=>()=>a.containsKey(t,s)))}}class lVe extends G2e{constructor(t){super(),this.currentSequenceNumber=t}}class XV{constructor(t){this.persistence=t,this.Jr=new YV,this.Yr=null}static Zr(t){return new XV(t)}get Xr(){if(this.Yr)return this.Yr;throw Mn()}addReference(t,s,a){return this.Jr.addReference(a,s),this.Xr.delete(a.toString()),Tt.resolve()}removeReference(t,s,a){return this.Jr.removeReference(a,s),this.Xr.add(a.toString()),Tt.resolve()}markPotentiallyOrphaned(t,s){return this.Xr.add(s.toString()),Tt.resolve()}removeTarget(t,s){this.Jr.gr(s.targetId).forEach(l=>this.Xr.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.Xr.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}zr(){this.Yr=new Set}jr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Tt.forEach(this.Xr,a=>{const l=En.fromPath(a);return this.ei(t,l).next(d=>{d||s.removeEntry(l,Gn.min())})}).next(()=>(this.Yr=null,s.apply(t)))}updateLimboDocument(t,s){return this.ei(t,s).next(a=>{a?this.Xr.delete(s.toString()):this.Xr.add(s.toString())})}Wr(t){return 0}ei(t,s){return Tt.or([()=>Tt.resolve(this.Jr.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.Hr(t,s)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JV{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.$i=a,this.Ui=l}static Wi(t,s){let a=mr(),l=mr();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new JV(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uVe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dVe{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return tLe()?8:z2e(Ea())>0?6:4}()}initialize(t,s){this.Ji=t,this.indexManager=s,this.Gi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.Yi(t,s).next(g=>{d.result=g}).next(()=>{if(!d.result)return this.Zi(t,s,l,a).next(g=>{d.result=g})}).next(()=>{if(d.result)return;const g=new uVe;return this.Xi(t,s,g).next(E=>{if(d.result=E,this.zi)return this.es(t,s,g,E.size)})}).next(()=>d.result)}es(t,s,a,l){return a.documentReadCount<this.ji?($0()<=br.DEBUG&&Qt("QueryEngine","SDK will not create cache indexes for query:",fy(s),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Tt.resolve()):($0()<=br.DEBUG&&Qt("QueryEngine","Query:",fy(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.Hi*l?($0()<=br.DEBUG&&Qt("QueryEngine","The SDK decides to create cache indexes for query:",fy(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,lh(s))):Tt.resolve())}Yi(t,s){if(yq(s))return Tt.resolve(null);let a=lh(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=W2(s,null,"F"),a=lh(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const g=mr(...d);return this.Ji.getDocuments(t,g).next(E=>this.indexManager.getMinOffset(t,a).next(S=>{const b=this.ts(s,E);return this.ns(s,b,g,S.readTime)?this.Yi(t,W2(s,null,"F")):this.rs(t,b,s,S)}))})))}Zi(t,s,a,l){return yq(s)||l.isEqual(Gn.min())?Tt.resolve(null):this.Ji.getDocuments(t,a).next(d=>{const g=this.ts(s,d);return this.ns(s,g,a,l)?Tt.resolve(null):($0()<=br.DEBUG&&Qt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),fy(s)),this.rs(t,g,s,F2e(l,-1)).next(E=>E))})}ts(t,s){let a=new zo(Xee(t));return s.forEach((l,d)=>{_N(t,d)&&(a=a.add(d))}),a}ns(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}Xi(t,s,a){return $0()<=br.DEBUG&&Qt("QueryEngine","Using full collection scan to execute query:",fy(s)),this.Ji.getDocumentsMatchingQuery(t,s,wm.min(),a)}rs(t,s,a,l){return this.Ji.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(g=>{d=d.insert(g.key,g)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hVe{constructor(t,s,a,l){this.persistence=t,this.ss=s,this.serializer=l,this.os=new Zi(jr),this._s=new vS(d=>WV(d),GV),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(a)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new eVe(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.os))}}function pVe(r,t,s,a){return new hVe(r,t,s,a)}async function vte(r,t){const s=zn(r);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.ls(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const g=[],E=[];let S=mr();for(const b of l){g.push(b.batchId);for(const R of b.mutations)S=S.add(R.key)}for(const b of d){E.push(b.batchId);for(const R of b.mutations)S=S.add(R.key)}return s.localDocuments.getDocuments(a,S).next(b=>({hs:b,removedBatchIds:g,addedBatchIds:E}))})})}function fVe(r,t){const s=zn(r);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.cs.newChangeBuffer({trackRemovals:!0});return function(E,S,b,R){const O=b.batch,N=O.keys();let U=Tt.resolve();return N.forEach(K=>{U=U.next(()=>R.getEntry(S,K)).next(z=>{const H=b.docVersions.get(K);ci(H!==null),z.version.compareTo(H)<0&&(O.applyToRemoteDocument(z,b),z.isValidDocument()&&(z.setReadTime(b.commitVersion),R.addEntry(z)))})}),U.next(()=>E.mutationQueue.removeMutationBatch(S,O))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let S=mr();for(let b=0;b<E.mutationResults.length;++b)E.mutationResults[b].transformResults.length>0&&(S=S.add(E.batch.mutations[b].key));return S}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function Ete(r){const t=zn(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Ur.getLastRemoteSnapshotVersion(s))}function mVe(r,t){const s=zn(r),a=t.snapshotVersion;let l=s.os;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const g=s.cs.newChangeBuffer({trackRemovals:!0});l=s.os;const E=[];t.targetChanges.forEach((R,O)=>{const N=l.get(O);if(!N)return;E.push(s.Ur.removeMatchingKeys(d,R.removedDocuments,O).next(()=>s.Ur.addMatchingKeys(d,R.addedDocuments,O)));let U=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(O)!==null?U=U.withResumeToken(Ho.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):R.resumeToken.approximateByteSize()>0&&(U=U.withResumeToken(R.resumeToken,a)),l=l.insert(O,U),function(z,H,ne){return z.resumeToken.approximateByteSize()===0||H.snapshotVersion.toMicroseconds()-z.snapshotVersion.toMicroseconds()>=3e8?!0:ne.addedDocuments.size+ne.modifiedDocuments.size+ne.removedDocuments.size>0}(N,U,R)&&E.push(s.Ur.updateTargetData(d,U))});let S=Up(),b=mr();if(t.documentUpdates.forEach(R=>{t.resolvedLimboDocuments.has(R)&&E.push(s.persistence.referenceDelegate.updateLimboDocument(d,R))}),E.push(gVe(d,g,t.documentUpdates).next(R=>{S=R.Ps,b=R.Is})),!a.isEqual(Gn.min())){const R=s.Ur.getLastRemoteSnapshotVersion(d).next(O=>s.Ur.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(R)}return Tt.waitFor(E).next(()=>g.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,S,b)).next(()=>S)}).then(d=>(s.os=l,d))}function gVe(r,t,s){let a=mr(),l=mr();return s.forEach(d=>a=a.add(d)),t.getEntries(r,a).next(d=>{let g=Up();return s.forEach((E,S)=>{const b=d.get(E);S.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(E)),S.isNoDocument()&&S.version.isEqual(Gn.min())?(t.removeEntry(E,S.readTime),g=g.insert(E,S)):!b.isValidDocument()||S.version.compareTo(b.version)>0||S.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(S),g=g.insert(E,S)):Qt("LocalStore","Ignoring outdated watch update for ",E,". Current version:",b.version," Watch version:",S.version)}),{Ps:g,Is:l}})}function _Ve(r,t){const s=zn(r);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=-1),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function vVe(r,t){const s=zn(r);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Ur.getTargetData(a,t).next(d=>d?(l=d,Tt.resolve(l)):s.Ur.allocateTargetId(a).next(g=>(l=new dm(t,g,"TargetPurposeListen",a.currentSequenceNumber),s.Ur.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.os.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.os=s.os.insert(a.targetId,a),s._s.set(t,a.targetId)),a})}async function $2(r,t,s){const a=zn(r),l=a.os.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,g=>a.persistence.referenceDelegate.removeTarget(g,l))}catch(g){if(!Bw(g))throw g;Qt("LocalStore",`Failed to update sequence numbers for target ${t}: ${g}`)}a.os=a.os.remove(t),a._s.delete(l.target)}function Nq(r,t,s){const a=zn(r);let l=Gn.min(),d=mr();return a.persistence.runTransaction("Execute query","readwrite",g=>function(S,b,R){const O=zn(S),N=O._s.get(R);return N!==void 0?Tt.resolve(O.os.get(N)):O.Ur.getTargetData(b,R)}(a,g,lh(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Ur.getMatchingKeysForTargetId(g,E.targetId).next(S=>{d=S})}).next(()=>a.ss.getDocumentsMatchingQuery(g,t,s?l:Gn.min(),s?d:mr())).next(E=>(EVe(a,lUe(t),E),{documents:E,Ts:d})))}function EVe(r,t,s){let a=r.us.get(t)||Gn.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),r.us.set(t,a)}class kq{constructor(){this.activeTargetIds=mUe()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class yVe{constructor(){this.so=new kq,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,s,a){this.oo[t]=s}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new kq,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SVe{_o(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dq{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Qt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ho)t(0)}lo(){Qt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hO=null;function EM(){return hO===null?hO=function(){return 268435456+Math.round(2147483648*Math.random())}():hO++,"0x"+hO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TVe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bVe{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ha="WebChannelConnection";class wVe extends class{constructor(s){this.databaseInfo=s,this.databaseId=s.databaseId;const a=s.ssl?"https":"http",l=encodeURIComponent(this.databaseId.projectId),d=encodeURIComponent(this.databaseId.database);this.Do=a+"://"+s.host,this.vo=`projects/${l}/databases/${d}`,this.Co=this.databaseId.database==="(default)"?`project_id=${l}`:`project_id=${l}&database_id=${d}`}get Fo(){return!1}Mo(s,a,l,d,g){const E=EM(),S=this.xo(s,a.toUriEncodedString());Qt("RestConnection",`Sending RPC '${s}' ${E}:`,S,l);const b={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(b,d,g),this.No(s,S,b,l).then(R=>(Qt("RestConnection",`Received RPC '${s}' ${E}: `,R),R),R=>{throw tS("RestConnection",`RPC '${s}' ${E} failed with error: `,R,"url: ",S,"request:",l),R})}Lo(s,a,l,d,g,E){return this.Mo(s,a,l,d,g)}Oo(s,a,l){s["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+_S}(),s["Content-Type"]="text/plain",this.databaseInfo.appId&&(s["X-Firebase-GMPID"]=this.databaseInfo.appId),a&&a.headers.forEach((d,g)=>s[g]=d),l&&l.headers.forEach((d,g)=>s[g]=d)}xo(s,a){const l=TVe[s];return`${this.Do}/v1/${a}:${l}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,s,a,l){const d=EM();return new Promise((g,E)=>{const S=new Dee;S.setWithCredentials(!0),S.listenOnce(Lee.COMPLETE,()=>{try{switch(S.getLastErrorCode()){case GO.NO_ERROR:const R=S.getResponseJson();Qt(ha,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(R)),g(R);break;case GO.TIMEOUT:Qt(ha,`RPC '${t}' ${d} timed out`),E(new en(St.DEADLINE_EXCEEDED,"Request time out"));break;case GO.HTTP_ERROR:const O=S.getStatus();if(Qt(ha,`RPC '${t}' ${d} failed with status:`,O,"response text:",S.getResponseText()),O>0){let N=S.getResponseJson();Array.isArray(N)&&(N=N[0]);const U=N==null?void 0:N.error;if(U&&U.status&&U.message){const K=function(H){const ne=H.toLowerCase().replace(/_/g,"-");return Object.values(St).indexOf(ne)>=0?ne:St.UNKNOWN}(U.status);E(new en(K,U.message))}else E(new en(St.UNKNOWN,"Server responded with status "+S.getStatus()))}else E(new en(St.UNAVAILABLE,"Connection failed."));break;default:Mn()}}finally{Qt(ha,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);Qt(ha,`RPC '${t}' ${d} sending request:`,l),S.send(s,"POST",b,a,15)})}Bo(t,s,a){const l=EM(),d=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],g=Uee(),E=Mee(),S={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(S.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(S.useFetchStreams=!0),this.Oo(S.initMessageHeaders,s,a),S.encodeInitMessageHeaders=!0;const R=d.join("");Qt(ha,`Creating RPC '${t}' stream ${l}: ${R}`,S);const O=g.createWebChannel(R,S);let N=!1,U=!1;const K=new bVe({Io:H=>{U?Qt(ha,`Not sending because RPC '${t}' stream ${l} is closed:`,H):(N||(Qt(ha,`Opening RPC '${t}' stream ${l} transport.`),O.open(),N=!0),Qt(ha,`RPC '${t}' stream ${l} sending:`,H),O.send(H))},To:()=>O.close()}),z=(H,ne,J)=>{H.listen(ne,se=>{try{J(se)}catch(le){setTimeout(()=>{throw le},0)}})};return z(O,fb.EventType.OPEN,()=>{U||(Qt(ha,`RPC '${t}' stream ${l} transport opened.`),K.yo())}),z(O,fb.EventType.CLOSE,()=>{U||(U=!0,Qt(ha,`RPC '${t}' stream ${l} transport closed`),K.So())}),z(O,fb.EventType.ERROR,H=>{U||(U=!0,tS(ha,`RPC '${t}' stream ${l} transport errored:`,H),K.So(new en(St.UNAVAILABLE,"The operation could not be completed")))}),z(O,fb.EventType.MESSAGE,H=>{var ne;if(!U){const J=H.data[0];ci(!!J);const se=J,le=se.error||((ne=se[0])===null||ne===void 0?void 0:ne.error);if(le){Qt(ha,`RPC '${t}' stream ${l} received error:`,le);const ce=le.status;let Se=function(ie){const ae=Ds[ie];if(ae!==void 0)return cte(ae)}(ce),Z=le.message;Se===void 0&&(Se=St.INTERNAL,Z="Unknown error status: "+ce+" with message "+le.message),U=!0,K.So(new en(Se,Z)),O.close()}else Qt(ha,`RPC '${t}' stream ${l} received:`,J),K.bo(J)}}),z(E,xee.STAT_EVENT,H=>{H.stat===U2.PROXY?Qt(ha,`RPC '${t}' stream ${l} detected buffering proxy`):H.stat===U2.NOPROXY&&Qt(ha,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{K.wo()},0),K}}function yM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SN(r){return new LUe(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yte{constructor(t,s,a=1e3,l=1.5,d=6e4){this.ui=t,this.timerId=s,this.ko=a,this.qo=l,this.Qo=d,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();const s=Math.floor(this.Ko+this.zo()),a=Math.max(0,Date.now()-this.Uo),l=Math.max(0,s-a);l>0&&Qt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ko} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,l,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ste{constructor(t,s,a,l,d,g,E,S){this.ui=t,this.Ho=a,this.Jo=l,this.connection=d,this.authCredentialsProvider=g,this.appCheckCredentialsProvider=E,this.listener=S,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new yte(t,s)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(t,s){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():s&&s.code===St.RESOURCE_EXHAUSTED?(Mp(s.toString()),Mp("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):s&&s.code===St.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.mo(s)}l_(){}auth(){this.state=1;const t=this.h_(this.Yo),s=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.Yo===s&&this.P_(a,l)},a=>{t(()=>{const l=new en(St.UNKNOWN,"Fetching auth token failed: "+a.message);return this.I_(l)})})}P_(t,s){const a=this.h_(this.Yo);this.stream=this.T_(t,s),this.stream.Eo(()=>{a(()=>this.listener.Eo())}),this.stream.Ro(()=>{a(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(l=>{a(()=>this.I_(l))}),this.stream.onMessage(l=>{a(()=>++this.e_==1?this.E_(l):this.onNext(l))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(t){return Qt("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return s=>{this.ui.enqueueAndForget(()=>this.Yo===t?s():(Qt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class RVe extends Ste{constructor(t,s,a,l,d,g){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,g),this.serializer=d}T_(t,s){return this.connection.Bo("Listen",t,s)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();const s=UUe(this.serializer,t),a=function(d){if(!("targetChange"in d))return Gn.min();const g=d.targetChange;return g.targetIds&&g.targetIds.length?Gn.min():g.readTime?dh(g.readTime):Gn.min()}(t);return this.listener.d_(s,a)}A_(t){const s={};s.database=K2(this.serializer),s.addTarget=function(d,g){let E;const S=g.target;if(E=B2(S)?{documents:jUe(d,S)}:{query:BUe(d,S)._t},E.targetId=g.targetId,g.resumeToken.approximateByteSize()>0){E.resumeToken=dte(d,g.resumeToken);const b=G2(d,g.expectedCount);b!==null&&(E.expectedCount=b)}else if(g.snapshotVersion.compareTo(Gn.min())>0){E.readTime=IP(d,g.snapshotVersion.toTimestamp());const b=G2(d,g.expectedCount);b!==null&&(E.expectedCount=b)}return E}(this.serializer,t);const a=GUe(this.serializer,t);a&&(s.labels=a),this.a_(s)}R_(t){const s={};s.database=K2(this.serializer),s.removeTarget=t,this.a_(s)}}class CVe extends Ste{constructor(t,s,a,l,d,g){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,g),this.serializer=d}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,s){return this.connection.Bo("Write",t,s)}E_(t){return ci(!!t.streamToken),this.lastStreamToken=t.streamToken,ci(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){ci(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();const s=FUe(t.writeResults,t.commitTime),a=dh(t.commitTime);return this.listener.g_(a,s)}p_(){const t={};t.database=K2(this.serializer),this.a_(t)}m_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>VUe(this.serializer,a))};this.a_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IVe extends class{}{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.y_=!1}w_(){if(this.y_)throw new en(St.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,s,a,l){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,g])=>this.connection.Mo(t,z2(s,a),l,d,g)).catch(d=>{throw d.name==="FirebaseError"?(d.code===St.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new en(St.UNKNOWN,d.toString())})}Lo(t,s,a,l,d){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([g,E])=>this.connection.Lo(t,z2(s,a),l,g,E,d)).catch(g=>{throw g.name==="FirebaseError"?(g.code===St.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new en(St.UNKNOWN,g.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class AVe{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Mp(s),this.D_=!1):Qt("OnlineStateTracker",s)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OVe{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=d,this.k_._o(g=>{a.enqueueAndForget(async()=>{tv(this)&&(Qt("RemoteStore","Restarting streams for network reachability change."),await async function(S){const b=zn(S);b.L_.add(4),await zw(b),b.q_.set("Unknown"),b.L_.delete(4),await TN(b)}(this))})}),this.q_=new AVe(a,l)}}async function TN(r){if(tv(r))for(const t of r.B_)await t(!0)}async function zw(r){for(const t of r.B_)await t(!1)}function Tte(r,t){const s=zn(r);s.N_.has(t.targetId)||(s.N_.set(t.targetId,t),tF(s)?eF(s):ES(s).r_()&&ZV(s,t))}function QV(r,t){const s=zn(r),a=ES(s);s.N_.delete(t),a.r_()&&bte(s,t),s.N_.size===0&&(a.r_()?a.o_():tv(s)&&s.q_.set("Unknown"))}function ZV(r,t){if(r.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Gn.min())>0){const s=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}ES(r).A_(t)}function bte(r,t){r.Q_.xe(t),ES(r).R_(t)}function eF(r){r.Q_=new PUe({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>r.N_.get(t)||null,tt:()=>r.datastore.serializer.databaseId}),ES(r).start(),r.q_.v_()}function tF(r){return tv(r)&&!ES(r).n_()&&r.N_.size>0}function tv(r){return zn(r).L_.size===0}function wte(r){r.Q_=void 0}async function PVe(r){r.q_.set("Online")}async function NVe(r){r.N_.forEach((t,s)=>{ZV(r,t)})}async function kVe(r,t){wte(r),tF(r)?(r.q_.M_(t),eF(r)):r.q_.set("Unknown")}async function DVe(r,t,s){if(r.q_.set("Online"),t instanceof ute&&t.state===2&&t.cause)try{await async function(l,d){const g=d.cause;for(const E of d.targetIds)l.N_.has(E)&&(await l.remoteSyncer.rejectListen(E,g),l.N_.delete(E),l.Q_.removeTarget(E))}(r,t)}catch(a){Qt("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),a),await AP(r,a)}else if(t instanceof KO?r.Q_.Ke(t):t instanceof lte?r.Q_.He(t):r.Q_.We(t),!s.isEqual(Gn.min()))try{const a=await Ete(r.localStore);s.compareTo(a)>=0&&await function(d,g){const E=d.Q_.rt(g);return E.targetChanges.forEach((S,b)=>{if(S.resumeToken.approximateByteSize()>0){const R=d.N_.get(b);R&&d.N_.set(b,R.withResumeToken(S.resumeToken,g))}}),E.targetMismatches.forEach((S,b)=>{const R=d.N_.get(S);if(!R)return;d.N_.set(S,R.withResumeToken(Ho.EMPTY_BYTE_STRING,R.snapshotVersion)),bte(d,S);const O=new dm(R.target,S,b,R.sequenceNumber);ZV(d,O)}),d.remoteSyncer.applyRemoteEvent(E)}(r,s)}catch(a){Qt("RemoteStore","Failed to raise snapshot:",a),await AP(r,a)}}async function AP(r,t,s){if(!Bw(t))throw t;r.L_.add(1),await zw(r),r.q_.set("Offline"),s||(s=()=>Ete(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Qt("RemoteStore","Retrying IndexedDB access"),await s(),r.L_.delete(1),await TN(r)})}function Rte(r,t){return t().catch(s=>AP(r,s,t))}async function bN(r){const t=zn(r),s=Cm(t);let a=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;LVe(t);)try{const l=await _Ve(t.localStore,a);if(l===null){t.O_.length===0&&s.o_();break}a=l.batchId,xVe(t,l)}catch(l){await AP(t,l)}Cte(t)&&Ite(t)}function LVe(r){return tv(r)&&r.O_.length<10}function xVe(r,t){r.O_.push(t);const s=Cm(r);s.r_()&&s.V_&&s.m_(t.mutations)}function Cte(r){return tv(r)&&!Cm(r).n_()&&r.O_.length>0}function Ite(r){Cm(r).start()}async function MVe(r){Cm(r).p_()}async function UVe(r){const t=Cm(r);for(const s of r.O_)t.m_(s.mutations)}async function VVe(r,t,s){const a=r.O_.shift(),l=KV.from(a,t,s);await Rte(r,()=>r.remoteSyncer.applySuccessfulWrite(l)),await bN(r)}async function FVe(r,t){t&&Cm(r).V_&&await async function(a,l){if(function(g){return IUe(g)&&g!==St.ABORTED}(l.code)){const d=a.O_.shift();Cm(a).s_(),await Rte(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await bN(a)}}(r,t),Cte(r)&&Ite(r)}async function Lq(r,t){const s=zn(r);s.asyncQueue.verifyOperationInProgress(),Qt("RemoteStore","RemoteStore received new credentials");const a=tv(s);s.L_.add(3),await zw(s),a&&s.q_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.L_.delete(3),await TN(s)}async function jVe(r,t){const s=zn(r);t?(s.L_.delete(2),await TN(s)):t||(s.L_.add(2),await zw(s),s.q_.set("Unknown"))}function ES(r){return r.K_||(r.K_=function(s,a,l){const d=zn(s);return d.w_(),new RVe(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{Eo:PVe.bind(null,r),Ro:NVe.bind(null,r),mo:kVe.bind(null,r),d_:DVe.bind(null,r)}),r.B_.push(async t=>{t?(r.K_.s_(),tF(r)?eF(r):r.q_.set("Unknown")):(await r.K_.stop(),wte(r))})),r.K_}function Cm(r){return r.U_||(r.U_=function(s,a,l){const d=zn(s);return d.w_(),new CVe(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:MVe.bind(null,r),mo:FVe.bind(null,r),f_:UVe.bind(null,r),g_:VVe.bind(null,r)}),r.B_.push(async t=>{t?(r.U_.s_(),await bN(r)):(await r.U_.stop(),r.O_.length>0&&(Qt("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nF{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Np,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(g=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const g=Date.now()+a,E=new nF(t,s,g,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new en(St.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function rF(r,t){if(Mp("AsyncQueue",`${t}: ${r}`),Bw(r))return new en(St.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(t){this.comparator=t?(s,a)=>t(s,a)||En.comparator(s.key,a.key):(s,a)=>En.comparator(s.key,a.key),this.keyedMap=mb(),this.sortedSet=new Zi(this.comparator)}static emptySet(t){return new zy(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof zy)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new zy;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xq{constructor(){this.W_=new Zi(En.comparator)}track(t){const s=t.doc.key,a=this.W_.get(s);a?t.type!==0&&a.type===3?this.W_=this.W_.insert(s,t):t.type===3&&a.type!==1?this.W_=this.W_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.W_=this.W_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.W_=this.W_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.W_=this.W_.remove(s):t.type===1&&a.type===2?this.W_=this.W_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.W_=this.W_.insert(s,{type:2,doc:t.doc}):Mn():this.W_=this.W_.insert(s,t)}G_(){const t=[];return this.W_.inorderTraversal((s,a)=>{t.push(a)}),t}}class oS{constructor(t,s,a,l,d,g,E,S,b){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=g,this.syncStateChanged=E,this.excludesMetadataChanges=S,this.hasCachedResults=b}static fromInitialDocuments(t,s,a,l,d){const g=[];return s.forEach(E=>{g.push({type:0,doc:E})}),new oS(t,s,zy.emptySet(s),g,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&gN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BVe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}}class WVe{constructor(){this.queries=Mq(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(s,a){const l=zn(s),d=l.queries;l.queries=Mq(),d.forEach((g,E)=>{for(const S of E.j_)S.onError(a)})})(this,new en(St.ABORTED,"Firestore shutting down"))}}function Mq(){return new vS(r=>Yee(r),gN)}async function Ate(r,t){const s=zn(r);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.H_()&&t.J_()&&(a=2):(d=new BVe,a=t.J_()?0:1);try{switch(a){case 0:d.z_=await s.onListen(l,!0);break;case 1:d.z_=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(g){const E=rF(g,`Initialization of query '${fy(t.query)}' failed`);return void t.onError(E)}s.queries.set(l,d),d.j_.push(t),t.Z_(s.onlineState),d.z_&&t.X_(d.z_)&&iF(s)}async function Ote(r,t){const s=zn(r),a=t.query;let l=3;const d=s.queries.get(a);if(d){const g=d.j_.indexOf(t);g>=0&&(d.j_.splice(g,1),d.j_.length===0?l=t.J_()?0:1:!d.H_()&&t.J_()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function GVe(r,t){const s=zn(r);let a=!1;for(const l of t){const d=l.query,g=s.queries.get(d);if(g){for(const E of g.j_)E.X_(l)&&(a=!0);g.z_=l}}a&&iF(s)}function zVe(r,t,s){const a=zn(r),l=a.queries.get(t);if(l)for(const d of l.j_)d.onError(s);a.queries.delete(t)}function iF(r){r.Y_.forEach(t=>{t.next()})}var q2,Uq;(Uq=q2||(q2={})).ea="default",Uq.Cache="cache";class Pte{constructor(t,s,a){this.query=t,this.ta=s,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=a||{}}X_(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new oS(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.na?this.ia(t)&&(this.ta.next(t),s=!0):this.sa(t,this.onlineState)&&(this.oa(t),s=!0),this.ra=t,s}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let s=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),s=!0),s}sa(t,s){if(!t.fromCache||!this.J_())return!0;const a=s!=="Offline";return(!this.options._a||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}ia(t){if(t.docChanges.length>0)return!0;const s=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}oa(t){t=oS.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==q2.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nte{constructor(t){this.key=t}}class kte{constructor(t){this.key=t}}class HVe{constructor(t,s){this.query=t,this.Ta=s,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=mr(),this.mutatedKeys=mr(),this.Aa=Xee(t),this.Ra=new zy(this.Aa)}get Va(){return this.Ta}ma(t,s){const a=s?s.fa:new xq,l=s?s.Ra:this.Ra;let d=s?s.mutatedKeys:this.mutatedKeys,g=l,E=!1;const S=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((R,O)=>{const N=l.get(R),U=_N(this.query,O)?O:null,K=!!N&&this.mutatedKeys.has(N.key),z=!!U&&(U.hasLocalMutations||this.mutatedKeys.has(U.key)&&U.hasCommittedMutations);let H=!1;N&&U?N.data.isEqual(U.data)?K!==z&&(a.track({type:3,doc:U}),H=!0):this.ga(N,U)||(a.track({type:2,doc:U}),H=!0,(S&&this.Aa(U,S)>0||b&&this.Aa(U,b)<0)&&(E=!0)):!N&&U?(a.track({type:0,doc:U}),H=!0):N&&!U&&(a.track({type:1,doc:N}),H=!0,(S||b)&&(E=!0)),H&&(U?(g=g.add(U),d=z?d.add(R):d.delete(R)):(g=g.delete(R),d=d.delete(R)))}),this.query.limit!==null)for(;g.size>this.query.limit;){const R=this.query.limitType==="F"?g.last():g.first();g=g.delete(R.key),d=d.delete(R.key),a.track({type:1,doc:R})}return{Ra:g,fa:a,ns:E,mutatedKeys:d}}ga(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;const g=t.fa.G_();g.sort((R,O)=>function(U,K){const z=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Mn()}};return z(U)-z(K)}(R.type,O.type)||this.Aa(R.doc,O.doc)),this.pa(a),l=l!=null&&l;const E=s&&!l?this.ya():[],S=this.da.size===0&&this.current&&!l?1:0,b=S!==this.Ea;return this.Ea=S,g.length!==0||b?{snapshot:new oS(this.query,t.Ra,d,g,t.mutatedKeys,S===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),wa:E}:{wa:E}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new xq,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(s=>this.Ta=this.Ta.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.Ta=this.Ta.delete(s)),this.current=t.current)}ya(){if(!this.current)return[];const t=this.da;this.da=mr(),this.Ra.forEach(a=>{this.Sa(a.key)&&(this.da=this.da.add(a.key))});const s=[];return t.forEach(a=>{this.da.has(a)||s.push(new kte(a))}),this.da.forEach(a=>{t.has(a)||s.push(new Nte(a))}),s}ba(t){this.Ta=t.Ts,this.da=mr();const s=this.ma(t.documents);return this.applyChanges(s,!0)}Da(){return oS.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class KVe{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class $Ve{constructor(t){this.key=t,this.va=!1}}class qVe{constructor(t,s,a,l,d,g){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=g,this.Ca={},this.Fa=new vS(E=>Yee(E),gN),this.Ma=new Map,this.xa=new Set,this.Oa=new Zi(En.comparator),this.Na=new Map,this.La=new YV,this.Ba={},this.ka=new Map,this.qa=sS.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function YVe(r,t,s=!0){const a=Vte(r);let l;const d=a.Fa.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Da()):l=await Dte(a,t,s,!0),l}async function XVe(r,t){const s=Vte(r);await Dte(s,t,!0,!1)}async function Dte(r,t,s,a){const l=await vVe(r.localStore,lh(t)),d=l.targetId,g=r.sharedClientState.addLocalQueryTarget(d,s);let E;return a&&(E=await JVe(r,t,d,g==="current",l.resumeToken)),r.isPrimaryClient&&s&&Tte(r.remoteStore,l),E}async function JVe(r,t,s,a,l){r.Ka=(O,N,U)=>async function(z,H,ne,J){let se=H.view.ma(ne);se.ns&&(se=await Nq(z.localStore,H.query,!1).then(({documents:Z})=>H.view.ma(Z,se)));const le=J&&J.targetChanges.get(H.targetId),ce=J&&J.targetMismatches.get(H.targetId)!=null,Se=H.view.applyChanges(se,z.isPrimaryClient,le,ce);return Fq(z,H.targetId,Se.wa),Se.snapshot}(r,O,N,U);const d=await Nq(r.localStore,t,!0),g=new HVe(t,d.Ts),E=g.ma(d.documents),S=Gw.createSynthesizedTargetChangeForCurrentChange(s,a&&r.onlineState!=="Offline",l),b=g.applyChanges(E,r.isPrimaryClient,S);Fq(r,s,b.wa);const R=new KVe(t,s,g);return r.Fa.set(t,R),r.Ma.has(s)?r.Ma.get(s).push(t):r.Ma.set(s,[t]),b.snapshot}async function QVe(r,t,s){const a=zn(r),l=a.Fa.get(t),d=a.Ma.get(l.targetId);if(d.length>1)return a.Ma.set(l.targetId,d.filter(g=>!gN(g,t))),void a.Fa.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await $2(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&QV(a.remoteStore,l.targetId),Y2(a,l.targetId)}).catch(jw)):(Y2(a,l.targetId),await $2(a.localStore,l.targetId,!0))}async function ZVe(r,t){const s=zn(r),a=s.Fa.get(t),l=s.Ma.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),QV(s.remoteStore,a.targetId))}async function eFe(r,t,s){const a=aFe(r);try{const l=await function(g,E){const S=zn(g),b=Ys.now(),R=E.reduce((U,K)=>U.add(K.key),mr());let O,N;return S.persistence.runTransaction("Locally write mutations","readwrite",U=>{let K=Up(),z=mr();return S.cs.getEntries(U,R).next(H=>{K=H,K.forEach((ne,J)=>{J.isValidDocument()||(z=z.add(ne))})}).next(()=>S.localDocuments.getOverlayedDocuments(U,K)).next(H=>{O=H;const ne=[];for(const J of E){const se=TUe(J,O.get(J.key).overlayedDocument);se!=null&&ne.push(new Lm(J.key,se,Wee(se.value.mapValue),uh.exists(!0)))}return S.mutationQueue.addMutationBatch(U,b,ne,E)}).next(H=>{N=H;const ne=H.applyToLocalDocumentSet(O,z);return S.documentOverlayCache.saveOverlays(U,H.batchId,ne)})}).then(()=>({batchId:N.batchId,changes:Qee(O)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(g,E,S){let b=g.Ba[g.currentUser.toKey()];b||(b=new Zi(jr)),b=b.insert(E,S),g.Ba[g.currentUser.toKey()]=b}(a,l.batchId,s),await Hw(a,l.changes),await bN(a.remoteStore)}catch(l){const d=rF(l,"Failed to persist write");s.reject(d)}}async function Lte(r,t){const s=zn(r);try{const a=await mVe(s.localStore,t);t.targetChanges.forEach((l,d)=>{const g=s.Na.get(d);g&&(ci(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?g.va=!0:l.modifiedDocuments.size>0?ci(g.va):l.removedDocuments.size>0&&(ci(g.va),g.va=!1))}),await Hw(s,a,t)}catch(a){await jw(a)}}function Vq(r,t,s){const a=zn(r);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.Fa.forEach((d,g)=>{const E=g.view.Z_(t);E.snapshot&&l.push(E.snapshot)}),function(g,E){const S=zn(g);S.onlineState=E;let b=!1;S.queries.forEach((R,O)=>{for(const N of O.j_)N.Z_(E)&&(b=!0)}),b&&iF(S)}(a.eventManager,t),l.length&&a.Ca.d_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function tFe(r,t,s){const a=zn(r);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Na.get(t),d=l&&l.key;if(d){let g=new Zi(En.comparator);g=g.insert(d,ga.newNoDocument(d,Gn.min()));const E=mr().add(d),S=new yN(Gn.min(),new Map,new Zi(jr),g,E);await Lte(a,S),a.Oa=a.Oa.remove(d),a.Na.delete(t),sF(a)}else await $2(a.localStore,t,!1).then(()=>Y2(a,t,s)).catch(jw)}async function nFe(r,t){const s=zn(r),a=t.batch.batchId;try{const l=await fVe(s.localStore,t);Mte(s,a,null),xte(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await Hw(s,l)}catch(l){await jw(l)}}async function rFe(r,t,s){const a=zn(r);try{const l=await function(g,E){const S=zn(g);return S.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let R;return S.mutationQueue.lookupMutationBatch(b,E).next(O=>(ci(O!==null),R=O.keys(),S.mutationQueue.removeMutationBatch(b,O))).next(()=>S.mutationQueue.performConsistencyCheck(b)).next(()=>S.documentOverlayCache.removeOverlaysForBatchId(b,R,E)).next(()=>S.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,R)).next(()=>S.localDocuments.getDocuments(b,R))})}(a.localStore,t);Mte(a,t,s),xte(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await Hw(a,l)}catch(l){await jw(l)}}function xte(r,t){(r.ka.get(t)||[]).forEach(s=>{s.resolve()}),r.ka.delete(t)}function Mte(r,t,s){const a=zn(r);let l=a.Ba[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Ba[a.currentUser.toKey()]=l}}function Y2(r,t,s=null){r.sharedClientState.removeLocalQueryTarget(t);for(const a of r.Ma.get(t))r.Fa.delete(a),s&&r.Ca.$a(a,s);r.Ma.delete(t),r.isPrimaryClient&&r.La.gr(t).forEach(a=>{r.La.containsKey(a)||Ute(r,a)})}function Ute(r,t){r.xa.delete(t.path.canonicalString());const s=r.Oa.get(t);s!==null&&(QV(r.remoteStore,s),r.Oa=r.Oa.remove(t),r.Na.delete(s),sF(r))}function Fq(r,t,s){for(const a of s)a instanceof Nte?(r.La.addReference(a.key,t),iFe(r,a)):a instanceof kte?(Qt("SyncEngine","Document no longer in limbo: "+a.key),r.La.removeReference(a.key,t),r.La.containsKey(a.key)||Ute(r,a.key)):Mn()}function iFe(r,t){const s=t.key,a=s.path.canonicalString();r.Oa.get(s)||r.xa.has(a)||(Qt("SyncEngine","New document in limbo: "+s),r.xa.add(a),sF(r))}function sF(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const t=r.xa.values().next().value;r.xa.delete(t);const s=new En(Wi.fromString(t)),a=r.qa.next();r.Na.set(a,new $Ve(s)),r.Oa=r.Oa.insert(s,a),Tte(r.remoteStore,new dm(lh(zV(s.path)),a,"TargetPurposeLimboResolution",VV.oe))}}async function Hw(r,t,s){const a=zn(r),l=[],d=[],g=[];a.Fa.isEmpty()||(a.Fa.forEach((E,S)=>{g.push(a.Ka(S,t,s).then(b=>{var R;if((b||s)&&a.isPrimaryClient){const O=b?!b.fromCache:(R=s==null?void 0:s.targetChanges.get(S.targetId))===null||R===void 0?void 0:R.current;a.sharedClientState.updateQueryState(S.targetId,O?"current":"not-current")}if(b){l.push(b);const O=JV.Wi(S.targetId,b);d.push(O)}}))}),await Promise.all(g),a.Ca.d_(l),await async function(S,b){const R=zn(S);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>Tt.forEach(b,N=>Tt.forEach(N.$i,U=>R.persistence.referenceDelegate.addReference(O,N.targetId,U)).next(()=>Tt.forEach(N.Ui,U=>R.persistence.referenceDelegate.removeReference(O,N.targetId,U)))))}catch(O){if(!Bw(O))throw O;Qt("LocalStore","Failed to update sequence numbers: "+O)}for(const O of b){const N=O.targetId;if(!O.fromCache){const U=R.os.get(N),K=U.snapshotVersion,z=U.withLastLimboFreeSnapshotVersion(K);R.os=R.os.insert(N,z)}}}(a.localStore,d))}async function sFe(r,t){const s=zn(r);if(!s.currentUser.isEqual(t)){Qt("SyncEngine","User change. New user:",t.toKey());const a=await vte(s.localStore,t);s.currentUser=t,function(d,g){d.ka.forEach(E=>{E.forEach(S=>{S.reject(new en(St.CANCELLED,g))})}),d.ka.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await Hw(s,a.hs)}}function oFe(r,t){const s=zn(r),a=s.Na.get(t);if(a&&a.va)return mr().add(a.key);{let l=mr();const d=s.Ma.get(t);if(!d)return l;for(const g of d){const E=s.Fa.get(g);l=l.unionWith(E.view.Va)}return l}}function Vte(r){const t=zn(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Lte.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=oFe.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=tFe.bind(null,t),t.Ca.d_=GVe.bind(null,t.eventManager),t.Ca.$a=zVe.bind(null,t.eventManager),t}function aFe(r){const t=zn(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=nFe.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=rFe.bind(null,t),t}class OP{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=SN(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),await this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)}ja(t,s){return null}Ha(t,s){return null}za(t){return pVe(this.persistence,new dVe,t.initialUser,this.serializer)}Ga(t){return new cVe(XV.Zr,this.serializer)}Wa(t){return new yVe}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}OP.provider={build:()=>new OP};class X2{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>Vq(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=sFe.bind(null,this.syncEngine),await jVe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new WVe}()}createDatastore(t){const s=SN(t.databaseInfo.databaseId),a=function(d){return new wVe(d)}(t.databaseInfo);return function(d,g,E,S){return new IVe(d,g,E,S)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,g,E){return new OVe(a,l,d,g,E)}(this.localStore,this.datastore,t.asyncQueue,s=>Vq(this.syncEngine,s,0),function(){return Dq.D()?new Dq:new SVe}())}createSyncEngine(t,s){return function(l,d,g,E,S,b,R){const O=new qVe(l,d,g,E,S,b);return R&&(O.Qa=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=zn(l);Qt("RemoteStore","RemoteStore shutting down."),d.L_.add(5),await zw(d),d.k_.shutdown(),d.q_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}X2.provider={build:()=>new X2};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fte{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ya(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ya(this.observer.error,t):Mp("Uncaught Error in snapshot listener:",t.toString()))}Za(){this.muted=!0}Ya(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cFe{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=ma.UNAUTHENTICATED,this.clientId=Fee.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async g=>{Qt("FirestoreClient","Received user=",g.uid),await this.authCredentialListener(g),this.user=g}),this.appCheckCredentials.start(a,g=>(Qt("FirestoreClient","Received new app check token=",g),this.appCheckCredentialListener(g,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Np;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=rF(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function SM(r,t){r.asyncQueue.verifyOperationInProgress(),Qt("FirestoreClient","Initializing OfflineComponentProvider");const s=r.configuration;await t.initialize(s);let a=s.initialUser;r.setCredentialChangeListener(async l=>{a.isEqual(l)||(await vte(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function jq(r,t){r.asyncQueue.verifyOperationInProgress();const s=await lFe(r);Qt("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(s,r.configuration),r.setCredentialChangeListener(a=>Lq(t.remoteStore,a)),r.setAppCheckTokenChangeListener((a,l)=>Lq(t.remoteStore,l)),r._onlineComponents=t}async function lFe(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Qt("FirestoreClient","Using user provided OfflineComponentProvider");try{await SM(r,r._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===St.FAILED_PRECONDITION||l.code===St.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;tS("Error using user provided cache. Falling back to memory cache: "+s),await SM(r,new OP)}}else Qt("FirestoreClient","Using default OfflineComponentProvider"),await SM(r,new OP);return r._offlineComponents}async function jte(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Qt("FirestoreClient","Using user provided OnlineComponentProvider"),await jq(r,r._uninitializedComponentsProvider._online)):(Qt("FirestoreClient","Using default OnlineComponentProvider"),await jq(r,new X2))),r._onlineComponents}function uFe(r){return jte(r).then(t=>t.syncEngine)}async function Bte(r){const t=await jte(r),s=t.eventManager;return s.onListen=YVe.bind(null,t.syncEngine),s.onUnlisten=QVe.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=XVe.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=ZVe.bind(null,t.syncEngine),s}function dFe(r,t,s={}){const a=new Np;return r.asyncQueue.enqueueAndForget(async()=>function(d,g,E,S,b){const R=new Fte({next:N=>{R.Za(),g.enqueueAndForget(()=>Ote(d,O));const U=N.docs.has(E);!U&&N.fromCache?b.reject(new en(St.UNAVAILABLE,"Failed to get document because the client is offline.")):U&&N.fromCache&&S&&S.source==="server"?b.reject(new en(St.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(N)},error:N=>b.reject(N)}),O=new Pte(zV(E.path),R,{includeMetadataChanges:!0,_a:!0});return Ate(d,O)}(await Bte(r),r.asyncQueue,t,s,a)),a.promise}function hFe(r,t,s={}){const a=new Np;return r.asyncQueue.enqueueAndForget(async()=>function(d,g,E,S,b){const R=new Fte({next:N=>{R.Za(),g.enqueueAndForget(()=>Ote(d,O)),N.fromCache&&S.source==="server"?b.reject(new en(St.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(N)},error:N=>b.reject(N)}),O=new Pte(E,R,{includeMetadataChanges:!0,_a:!0});return Ate(d,O)}(await Bte(r),r.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wte(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bq=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gte(r,t,s){if(!s)throw new en(St.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function pFe(r,t,s,a){if(t===!0&&a===!0)throw new en(St.INVALID_ARGUMENT,`${r} and ${s} cannot be used together.`)}function Wq(r){if(!En.isDocumentKey(r))throw new en(St.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Gq(r){if(En.isDocumentKey(r))throw new en(St.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function oF(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":Mn()}function Vp(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new en(St.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=oF(r);throw new en(St.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zq{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new en(St.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(s=t.ssl)===null||s===void 0||s;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new en(St.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}pFe("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Wte((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new en(St.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new en(St.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new en(St.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class wN{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zq({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new en(St.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new en(St.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zq(t),t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new P2e;switch(a.type){case"firstParty":return new L2e(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new en(St.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=Bq.get(s);a&&(Qt("ComponentProvider","Removing Datastore"),Bq.delete(s),a.terminate())}(this),Promise.resolve()}}function fFe(r,t,s,a={}){var l;const d=(r=Vp(r,wN))._getSettings(),g=`${t}:${s}`;if(d.host!=="firestore.googleapis.com"&&d.host!==g&&tS("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},d),{host:g,ssl:!1})),a.mockUserToken){let E,S;if(typeof a.mockUserToken=="string")E=a.mockUserToken,S=ma.MOCK_USER;else{E=HZ(a.mockUserToken,(l=r._app)===null||l===void 0?void 0:l.options.projectId);const b=a.mockUserToken.sub||a.mockUserToken.user_id;if(!b)throw new en(St.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");S=new ma(b)}r._authCredentials=new N2e(new Vee(E,S))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RN{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new RN(this.firestore,t,this._query)}}class Ac{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _m(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ac(this.firestore,t,this._key)}}class _m extends RN{constructor(t,s,a){super(t,s,zV(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ac(this.firestore,null,new En(t))}withConverter(t){return new _m(this.firestore,t,this._path)}}function mFe(r,t,...s){if(r=Ms(r),Gte("collection","path",t),r instanceof wN){const a=Wi.fromString(t,...s);return Gq(a),new _m(r,null,a)}{if(!(r instanceof Ac||r instanceof _m))throw new en(St.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(Wi.fromString(t,...s));return Gq(a),new _m(r.firestore,null,a)}}function fw(r,t,...s){if(r=Ms(r),arguments.length===1&&(t=Fee.newId()),Gte("doc","path",t),r instanceof wN){const a=Wi.fromString(t,...s);return Wq(a),new Ac(r,null,new En(a))}{if(!(r instanceof Ac||r instanceof _m))throw new en(St.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(Wi.fromString(t,...s));return Wq(a),new Ac(r.firestore,r instanceof _m?r.converter:null,new En(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hq{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new yte(this,"async_queue_retry"),this.Vu=()=>{const a=yM();a&&Qt("AsyncQueue","Visibility state changed to "+a.visibilityState),this.t_.jo()},this.mu=t;const s=yM();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;const s=yM();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise(()=>{});const s=new Np;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Pu.push(t),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!Bw(t))throw t;Qt("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(t){const s=this.mu.then(()=>(this.du=!0,t().catch(a=>{this.Eu=a,this.du=!1;const l=function(g){let E=g.message||"";return g.stack&&(E=g.stack.includes(g.message)?g.stack:g.message+`
`+g.stack),E}(a);throw Mp("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.du=!1,a))));return this.mu=s,s}enqueueAfterDelay(t,s,a){this.fu(),this.Ru.indexOf(t)>-1&&(s=0);const l=nF.createAndSchedule(this,t,s,a,d=>this.yu(d));return this.Tu.push(l),l}fu(){this.Eu&&Mn()}verifyOperationInProgress(){}async wu(){let t;do t=this.mu,await t;while(t!==this.mu)}Su(t){for(const s of this.Tu)if(s.timerId===t)return!0;return!1}bu(t){return this.wu().then(()=>{this.Tu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.Tu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.wu()})}Du(t){this.Ru.push(t)}yu(t){const s=this.Tu.indexOf(t);this.Tu.splice(s,1)}}class Kw extends wN{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new Hq,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Hq(t),this._firestoreClient=void 0,await t}}}function gFe(r,t){const s=typeof r=="object"?r:AV(),a=typeof r=="string"?r:"(default)",l=uN(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=WZ("firestore");d&&fFe(l,...d)}return l}function aF(r){if(r._terminated)throw new en(St.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||_Fe(r),r._firestoreClient}function _Fe(r){var t,s,a;const l=r._freezeSettings(),d=function(E,S,b,R){return new $2e(E,S,b,R.host,R.ssl,R.experimentalForceLongPolling,R.experimentalAutoDetectLongPolling,Wte(R.experimentalLongPollingOptions),R.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,l);r._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(r._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),r._firestoreClient=new cFe(r._authCredentials,r._appCheckCredentials,r._queue,d,r._componentsProvider&&function(E){const S=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(S),_online:S}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(t){this._byteString=t}static fromBase64String(t){try{return new aS(Ho.fromBase64String(t))}catch(s){throw new en(St.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new aS(Ho.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CN{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new en(St.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Go(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cF{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lF{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new en(St.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new en(St.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return jr(this._lat,t._lat)||jr(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uF{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vFe=/^__.*__$/;class EFe{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new Lm(t,this.data,this.fieldMask,s,this.fieldTransforms):new Ww(t,this.data,s,this.fieldTransforms)}}class zte{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new Lm(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function Hte(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Mn()}}class dF{constructor(t,s,a,l,d,g){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.vu(),this.fieldTransforms=d||[],this.fieldMask=g||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(t){return new dF(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.Fu({path:a,xu:!1});return l.Ou(t),l}Nu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.Fu({path:a,xu:!1});return l.vu(),l}Lu(t){return this.Fu({path:void 0,xu:!0})}Bu(t){return PP(t,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ou(this.path.get(t))}Ou(t){if(t.length===0)throw this.Bu("Document fields must not be empty");if(Hte(this.Cu)&&vFe.test(t))throw this.Bu('Document fields cannot begin and end with "__"')}}class yFe{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||SN(t)}Qu(t,s,a,l=!1){return new dF({Cu:t,methodName:s,qu:a,path:Go.emptyPath(),xu:!1,ku:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Kte(r){const t=r._freezeSettings(),s=SN(r._databaseId);return new yFe(r._databaseId,!!t.ignoreUndefinedProperties,s)}function SFe(r,t,s,a,l,d={}){const g=r.Qu(d.merge||d.mergeFields?2:0,t,s,l);hF("Data must be an object, but it was:",g,a);const E=$te(a,g);let S,b;if(d.merge)S=new ol(g.fieldMask),b=g.fieldTransforms;else if(d.mergeFields){const R=[];for(const O of d.mergeFields){const N=J2(t,O,s);if(!g.contains(N))throw new en(St.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Yte(R,N)||R.push(N)}S=new ol(R),b=g.fieldTransforms.filter(O=>S.covers(O.field))}else S=null,b=g.fieldTransforms;return new EFe(new wc(E),S,b)}class IN extends cF{_toFieldTransform(t){if(t.Cu!==2)throw t.Cu===1?t.Bu(`${this._methodName}() can only appear at the top level of your update data`):t.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof IN}}function TFe(r,t,s,a){const l=r.Qu(1,t,s);hF("Data must be an object, but it was:",l,a);const d=[],g=wc.empty();ev(a,(S,b)=>{const R=pF(t,S,s);b=Ms(b);const O=l.Nu(R);if(b instanceof IN)d.push(R);else{const N=AN(b,O);N!=null&&(d.push(R),g.set(R,N))}});const E=new ol(d);return new zte(g,E,l.fieldTransforms)}function bFe(r,t,s,a,l,d){const g=r.Qu(1,t,s),E=[J2(t,a,s)],S=[l];if(d.length%2!=0)throw new en(St.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)E.push(J2(t,d[N])),S.push(d[N+1]);const b=[],R=wc.empty();for(let N=E.length-1;N>=0;--N)if(!Yte(b,E[N])){const U=E[N];let K=S[N];K=Ms(K);const z=g.Nu(U);if(K instanceof IN)b.push(U);else{const H=AN(K,z);H!=null&&(b.push(U),R.set(U,H))}}const O=new ol(b);return new zte(R,O,g.fieldTransforms)}function AN(r,t){if(qte(r=Ms(r)))return hF("Unsupported field value:",t,r),$te(r,t);if(r instanceof cF)return function(a,l){if(!Hte(l.Cu))throw l.Bu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Bu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.xu&&t.Cu!==4)throw t.Bu("Nested arrays are not supported");return function(a,l){const d=[];let g=0;for(const E of a){let S=AN(E,l.Lu(g));S==null&&(S={nullValue:"NULL_VALUE"}),d.push(S),g++}return{arrayValue:{values:d}}}(r,t)}return function(a,l){if((a=Ms(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return gUe(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=Ys.fromDate(a);return{timestampValue:IP(l.serializer,d)}}if(a instanceof Ys){const d=new Ys(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:IP(l.serializer,d)}}if(a instanceof lF)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof aS)return{bytesValue:dte(l.serializer,a._byteString)};if(a instanceof Ac){const d=l.databaseId,g=a.firestore._databaseId;if(!g.isEqual(d))throw l.Bu(`Document reference is for database ${g.projectId}/${g.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:qV(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof uF)return function(g,E){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:g.toArray().map(S=>{if(typeof S!="number")throw E.Bu("VectorValues must only contain numeric values.");return HV(E.serializer,S)})}}}}}}(a,l);throw l.Bu(`Unsupported field value: ${oF(a)}`)}(r,t)}function $te(r,t){const s={};return jee(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ev(r,(a,l)=>{const d=AN(l,t.Mu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function qte(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Ys||r instanceof lF||r instanceof aS||r instanceof Ac||r instanceof cF||r instanceof uF)}function hF(r,t,s){if(!qte(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=oF(s);throw a==="an object"?t.Bu(r+" a custom object"):t.Bu(r+" "+a)}}function J2(r,t,s){if((t=Ms(t))instanceof CN)return t._internalPath;if(typeof t=="string")return pF(r,t);throw PP("Field path arguments must be of type string or ",r,!1,void 0,s)}const wFe=new RegExp("[~\\*/\\[\\]]");function pF(r,t,s){if(t.search(wFe)>=0)throw PP(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,s);try{return new CN(...t.split("."))._internalPath}catch{throw PP(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,s)}}function PP(r,t,s,a,l){const d=a&&!a.isEmpty(),g=l!==void 0;let E=`Function ${t}() called with invalid data`;s&&(E+=" (via `toFirestore()`)"),E+=". ";let S="";return(d||g)&&(S+=" (found",d&&(S+=` in field ${a}`),g&&(S+=` in document ${l}`),S+=")"),new en(St.INVALID_ARGUMENT,E+r+S)}function Yte(r,t){return r.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xte{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Ac(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new RFe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(Jte("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class RFe extends Xte{data(){return super.data()}}function Jte(r,t){return typeof t=="string"?pF(r,t):t instanceof CN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CFe(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new en(St.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class IFe{convertValue(t,s="none"){switch(Y_(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ws(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(q_(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw Mn()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return ev(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s.value.arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(g=>ws(g.doubleValue));return new uF(d)}convertGeoPoint(t){return new lF(ws(t.latitude),ws(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=jV(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(lw(t));default:return null}}convertTimestamp(t){const s=Rm(t);return new Ys(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=Wi.fromString(t);ci(_te(a));const l=new uw(a.get(1),a.get(3)),d=new En(a.popFirst(5));return l.isEqual(s)||Mp(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AFe(r,t,s){let a;return a=r?r.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _b{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Qte extends Xte{constructor(t,s,a,l,d,g){super(t,s,a,l,g),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new $O(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(Jte("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class $O extends Qte{data(t={}){return super.data(t)}}class OFe{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new _b(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new $O(this._firestore,this._userDataWriter,a.key,a,new _b(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new en(St.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let g=0;return l._snapshot.docChanges.map(E=>{const S=new $O(l._firestore,l._userDataWriter,E.doc.key,E.doc,new _b(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:S,oldIndex:-1,newIndex:g++}})}{let g=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const S=new $O(l._firestore,l._userDataWriter,E.doc.key,E.doc,new _b(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,R=-1;return E.type!==0&&(b=g.indexOf(E.doc.key),g=g.delete(E.doc.key)),E.type!==1&&(g=g.add(E.doc),R=g.indexOf(E.doc.key)),{type:PFe(E.type),doc:S,oldIndex:b,newIndex:R}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function PFe(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Mn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q2(r){r=Vp(r,Ac);const t=Vp(r.firestore,Kw);return dFe(aF(t),r._key).then(s=>LFe(t,r,s))}class Zte extends IFe{constructor(t){super(),this.firestore=t}convertBytes(t){return new aS(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new Ac(this.firestore,null,s)}}function NFe(r){r=Vp(r,RN);const t=Vp(r.firestore,Kw),s=aF(t),a=new Zte(t);return CFe(r._query),hFe(s,r._query).then(l=>new OFe(t,a,r,l))}function kFe(r,t,s){r=Vp(r,Ac);const a=Vp(r.firestore,Kw),l=AFe(r.converter,t);return ene(a,[SFe(Kte(a),"setDoc",r._key,l,r.converter!==null,s).toMutation(r._key,uh.none())])}function DFe(r,t,s,...a){r=Vp(r,Ac);const l=Vp(r.firestore,Kw),d=Kte(l);let g;return g=typeof(t=Ms(t))=="string"||t instanceof CN?bFe(d,"updateDoc",r._key,t,s,a):TFe(d,"updateDoc",r._key,t),ene(l,[g.toMutation(r._key,uh.exists(!0))])}function ene(r,t){return function(a,l){const d=new Np;return a.asyncQueue.enqueueAndForget(async()=>eFe(await uFe(a),l,d)),d.promise}(aF(r),t)}function LFe(r,t,s){const a=s.docs.get(t._key),l=new Zte(r);return new Qte(r,l,t._key,a,new _b(s.hasPendingWrites,s.fromCache),t.converter)}(function(t,s=!0){(function(l){_S=l})(Q_),z_(new bm("firestore",(a,{instanceIdentifier:l,options:d})=>{const g=a.getProvider("app").getImmediate(),E=new Kw(new k2e(a.getProvider("auth-internal")),new M2e(a.getProvider("app-check-internal")),function(b,R){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new en(St.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new uw(b.options.projectId,R)}(g,l),g);return d=Object.assign({useFetchStreams:s},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),oh(uq,"4.7.3",t),oh(uq,"4.7.3","esm2017")})();var xFe="firebase",MFe="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */oh(xFe,MFe,"app");const UFe={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},tne=qZ(UFe),VFe=Nee(tne),cS=gFe(tne),Im=async r=>{try{It.log("userFirestore: Get user Profile data for user ID: "+r);const t=fw(cS,"users",r),s=await Q2(t);return s.exists()?(It.log("userFirestore: Found Profile for : "+s.data().Nickname),s.data()):(It.error("userFirestore: user profile document not found"),null)}catch(t){throw It.error("userFirestore: Error fetching user profile data:",t),t}},FFe=async(r,t,s)=>{try{const l=(await pMe(VFe,r,t)).user,d=fw(cS,"users",l.uid);return await kFe(d,{email:l.email,createdAt:new Date,...s}),It.log("userFirestore: User created successfully."),l}catch(a){throw It.error("userFirestore: Error creating user:",a),a}},nne=async(r,t)=>{try{It.log(`userFirestore: Updating rpmURL for user ID: ${r}`);const s=fw(cS,"users",r);await DFe(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),It.log("userFirestore: rpmURL updated successfully.")}catch(s){throw It.error("userFirestore: Error updating rpmURL:",s),s}},jFe=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile"],vb={sendUserToUnity:"sendUserToUnity"};class BFe{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),It.log(`EventBus: Published event '${t}'`)):It.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const Eb=new BFe,tu=B.createContext(null),WFe=({children:r})=>{const[t,s]=B.useState(null),a=B.useRef(null),[l,d]=B.useState(!0),g=Nee(),E=H=>H?H.Nickname?H.Nickname:`${H.firstName} ${H.lastName}`:"Anon";B.useEffect(()=>{const H=_Me(g,async ne=>{if(It.log("UserProvider: Firebase onAuthStateChanged() fired"),ne)try{const J=await Im(ne.uid),se=E(J),le={uid:ne.uid,email:ne.email,...J,displayName:se};console.log(le),s(le),a.current=le,O(le)}catch(J){It.error("UserProvider: Error fetching user profile data:",J)}else s(null),a.current=null;d(!1)});return()=>{H&&H()}},[]);const S=async(H,ne,J)=>{try{const{firstName:se,lastName:le}=J,ce=`${se}${le.charAt(0).toUpperCase()}`,Se={...J,Nickname:ce,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"},Z=await FFe(H,ne,Se);s(Z),a.current=Z}catch(se){throw It.error("UserProvider: Error creating user:",se),se}},b=async(H,ne)=>{try{const J=await fMe(g,H,ne),se=await Im(J.user.uid),le=E(se),ce={uid:J.user.uid,email:J.user.email,...se,displayName:le};s(ce),O(ce)}catch(J){throw It.error("UserProvider: Error signing in:",J),J}},R=async()=>{try{await vMe(g),s(null),It.log("UserProvider: User signed out.")}catch(H){throw It.error("UserProvider: Error signing out:",H),H}},O=()=>{const H=a.current;if(H){const ne=N(H);It.log("UserProvider: sendUserToUnity() using the eventBus",ne),Eb.publish(vb.sendUserToUnity,ne)}else It.log("UserProvider: No current user to send to Unity.")},N=H=>{const ne={};return[...jFe,"uid"].forEach(se=>{H.hasOwnProperty(se)&&(ne[se]=H[se])}),ne},U=async H=>{if(!t||!t.uid)return!1;try{const ne=await getSpaceItem(H);return ne.usersAllowed.includes(t.uid)||ne.userAdmin.includes(t.uid)||ne.usersModerators.includes(t.uid)}catch(ne){return It.error("UserProvider: Error verifying user access to space:",ne),!1}},K=async H=>{if(!t||!t.uid)return!1;try{return(await getSpaceItem(H)).userAdmin.includes(t.uid)}catch(ne){return It.error("UserProvider: Error verifying user admin status for space:",ne),!1}},z=async H=>{if(!t||!t.uid)return!1;try{return(await getSpaceItem(H)).usersModerators.includes(t.uid)}catch(ne){return It.error("UserProvider: Error verifying user moderator status for space:",ne),!1}};return F.jsx(tu.Provider,{value:{user:t,loading:l,register:S,signIn:b,signOut:R,sendUserToUnity:O,userHasAccessToSpace:U,userIsAdminOfSpace:K,userIsModeratorOfSpace:z},children:r})},rne=B.createContext(),Hp=()=>B.useContext(rne),GFe=({children:r})=>{const[t,s]=B.useState(!1),a=B.useRef(null),[l,d]=B.useState(!1);B.useEffect(()=>{const S=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const g=B.useCallback(S=>{a.current=S},[]),E=B.useCallback(()=>{const S=a.current;if(!S)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const R=S.querySelector("video")||S;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(R.webkitEnterFullscreen)try{R.webkitEnterFullscreen(),s(!0);return}catch(O){console.error("iOS fullscreen error:",O)}try{if(R.webkitRequestFullscreen){R.webkitRequestFullscreen(),s(!0);return}}catch(O){console.error("iOS fallback fullscreen error:",O)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(S.requestFullscreen?S.requestFullscreen():S.webkitRequestFullscreen?S.webkitRequestFullscreen():S.mozRequestFullScreen?S.mozRequestFullScreen():S.msRequestFullscreen&&S.msRequestFullscreen(),s(!0));return}catch(O){console.error("Android fullscreen error:",O)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(R=>console.error("Error exiting fullscreen:",R)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):S.requestFullscreen?S.requestFullscreen().then(()=>{s(!0)}).catch(R=>console.error("Error entering fullscreen:",R)):S.webkitRequestFullscreen?(S.webkitRequestFullscreen(),s(!0)):S.mozRequestFullScreen?(S.mozRequestFullScreen(),s(!0)):S.msRequestFullscreen&&(S.msRequestFullscreen(),s(!0))}catch(R){console.error("Fullscreen error:",R)}},[l]);return B.useEffect(()=>{const S=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!b)};return document.addEventListener("fullscreenchange",S),document.addEventListener("webkitfullscreenchange",S),document.addEventListener("mozfullscreenchange",S),document.addEventListener("MSFullscreenChange",S),()=>{document.removeEventListener("fullscreenchange",S),document.removeEventListener("webkitfullscreenchange",S),document.removeEventListener("mozfullscreenchange",S),document.removeEventListener("MSFullscreenChange",S)}},[]),F.jsx(rne.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:g,isMobile:l},children:F.jsx("div",{ref:g,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:r})})};var TM={},q0={},Y0={},Kq;function zFe(){if(Kq)return Y0;Kq=1,Object.defineProperty(Y0,"__esModule",{value:!0}),Y0.useUnityCanvasId=void 0;var r=Ql(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,r.useMemo)(function(){return[s,++t].join("-")},[]);return d};return Y0.useUnityCanvasId=a,Y0}var pp={},X0={},$q;function ine(){if($q)return X0;$q=1,Object.defineProperty(X0,"__esModule",{value:!0}),X0.UnityLoaderStatus=void 0;var r;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(r||(X0.UnityLoaderStatus=r={})),X0}var J0={},qq;function fF(){return qq||(qq=1,Object.defineProperty(J0,"__esModule",{value:!0}),J0.isBrowserEnvironment=void 0,J0.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),J0}var Yq;function HFe(){if(Yq)return pp;Yq=1;var r=pp&&pp.__awaiter||function(g,E,S,b){function R(O){return O instanceof S?O:new S(function(N){N(O)})}return new(S||(S=Promise))(function(O,N){function U(H){try{z(b.next(H))}catch(ne){N(ne)}}function K(H){try{z(b.throw(H))}catch(ne){N(ne)}}function z(H){H.done?O(H.value):R(H.value).then(U,K)}z((b=b.apply(g,E||[])).next())})},t=pp&&pp.__generator||function(g,E){var S={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},b,R,O,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=U(0),N.throw=U(1),N.return=U(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function U(z){return function(H){return K([z,H])}}function K(z){if(b)throw new TypeError("Generator is already executing.");for(;N&&(N=0,z[0]&&(S=0)),S;)try{if(b=1,R&&(O=z[0]&2?R.return:z[0]?R.throw||((O=R.return)&&O.call(R),0):R.next)&&!(O=O.call(R,z[1])).done)return O;switch(R=0,O&&(z=[z[0]&2,O.value]),z[0]){case 0:case 1:O=z;break;case 4:return S.label++,{value:z[1],done:!1};case 5:S.label++,R=z[1],z=[0];continue;case 7:z=S.ops.pop(),S.trys.pop();continue;default:if(O=S.trys,!(O=O.length>0&&O[O.length-1])&&(z[0]===6||z[0]===2)){S=0;continue}if(z[0]===3&&(!O||z[1]>O[0]&&z[1]<O[3])){S.label=z[1];break}if(z[0]===6&&S.label<O[1]){S.label=O[1],O=z;break}if(O&&S.label<O[2]){S.label=O[2],S.ops.push(z);break}O[2]&&S.ops.pop(),S.trys.pop();continue}z=E.call(g,S)}catch(H){z=[6,H],R=0}finally{b=O=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}};Object.defineProperty(pp,"__esModule",{value:!0}),pp.useUnityInstance=void 0;var s=Ql(),a=ine(),l=fF(),d=function(g,E,S,b){(0,s.useEffect)(function(){(function(){return r(void 0,void 0,void 0,function(){var R,O;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(g!==a.UnityLoaderStatus.Loaded||E===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(E,S,b.setLoadingProgression)];case 2:return R=N.sent(),b.setUnityInstance(R),b.setInitialisationError(null),[3,4];case 3:return O=N.sent(),b.setUnityInstance(null),b.setInitialisationError(O),[3,4];case 4:return[2]}})})})()},[g,E,S,b])};return pp.useUnityInstance=d,pp}var Q0={},Xq;function KFe(){if(Xq)return Q0;Xq=1,Object.defineProperty(Q0,"__esModule",{value:!0}),Q0.useUnityArguments=void 0;var r=Ql(),t=function(s){return(0,r.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return Q0.useUnityArguments=t,Q0}var Z0={},Jq;function $Fe(){if(Jq)return Z0;Jq=1,Object.defineProperty(Z0,"__esModule",{value:!0}),Z0.useUnityLoader=void 0;var r=Ql(),t=fF(),s=ine(),a=function(l){var d=(0,r.useState)(s.UnityLoaderStatus.Loading),g=d[0],E=d[1];return(0,r.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(s.UnityLoaderStatus.Idle);return}var S=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));S===null?(S=window.document.createElement("script"),S.type="text/javascript",S.src=l.loaderUrl,S.async=!0,S.setAttribute("data-status","loading"),window.document.body.appendChild(S),S.addEventListener("load",function(){return S==null?void 0:S.setAttribute("data-status","loaded")}),S.addEventListener("error",function(){return S==null?void 0:S.setAttribute("data-status","error")})):E(S.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var b=function(R){return E(R.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return S.addEventListener("load",b),S.addEventListener("error",b),function(){S!==null&&(S.removeEventListener("load",b),S.removeEventListener("error",b),window.document.body.removeChild(S))}}},[l.loaderUrl]),g};return Z0.useUnityLoader=a,Z0}var Qq;function qFe(){if(Qq)return q0;Qq=1,Object.defineProperty(q0,"__esModule",{value:!0}),q0.Unity=void 0;var r=Ql(),t=Ql(),s=zFe(),a=HFe(),l=KFe(),d=$Fe(),g=(0,t.forwardRef)(function(E,S){var b=(0,t.useRef)(null),R=(0,s.useUnityCanvasId)(E),O=(0,l.useUnityArguments)(E),N=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,b.current,O,E.unityProvider),(0,r.useImperativeHandle)(S,function(){return b.current}),(0,r.createElement)("canvas",{ref:b,id:R,style:E.style,className:E.className,tabIndex:E.tabIndex})});return q0.Unity=g,q0}var fp={},eb={},Zq;function sne(){if(Zq)return eb;Zq=1,Object.defineProperty(eb,"__esModule",{value:!0}),eb.errorMessages=void 0;var r={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return eb.errorMessages=r,eb}var p_={},eY;function YFe(){if(eY)return p_;eY=1;var r=p_&&p_.__spreadArray||function(E,S,b){if(b||arguments.length===2)for(var R=0,O=S.length,N;R<O;R++)(N||!(R in S))&&(N||(N=Array.prototype.slice.call(S,0,R)),N[R]=S[R]);return E.concat(N||Array.prototype.slice.call(S))};Object.defineProperty(p_,"__esModule",{value:!0}),p_.useEventSystem=void 0;var t=Ql(),s=sne(),a=fF(),l=[],d=function(E){for(var S=[],b=1;b<arguments.length;b++)S[b-1]=arguments[b];var R=void 0;return l.forEach(function(O){R=O.apply(void 0,r([E],S,!1))}),R};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var g=function(){var E=(0,t.useRef)([]),S=(0,t.useCallback)(function(O,N){E.current=r(r([],E.current,!0),[{eventName:O,callback:N}],!1)},[E]),b=(0,t.useCallback)(function(O,N){E.current=E.current.filter(function(U){return U.eventName!==O&&U.callback!==N})},[E]),R=(0,t.useCallback)(function(O){for(var N=[],U=1;U<arguments.length;U++)N[U-1]=arguments[U];var K=E.current.find(function(z){return z.eventName===O});if(typeof K>"u"){console.warn(s.errorMessages.noEventListener,{eventName:O});return}return K.callback.apply(K,N)},[E]);return(0,t.useEffect)(function(){return l.push(R),function(){l.splice(l.indexOf(R),1)}},[R]),{addEventListener:S,removeEventListener:b}};return p_.useEventSystem=g,p_}var tb={},tY;function XFe(){if(tY)return tb;tY=1,Object.defineProperty(tb,"__esModule",{value:!0}),tb.useNullableState=void 0;var r=Ql(),t=function(s){return(0,r.useState)(s||null)};return tb.useNullableState=t,tb}var nY;function JFe(){if(nY)return fp;nY=1;var r=fp&&fp.__awaiter||function(E,S,b,R){function O(N){return N instanceof b?N:new b(function(U){U(N)})}return new(b||(b=Promise))(function(N,U){function K(ne){try{H(R.next(ne))}catch(J){U(J)}}function z(ne){try{H(R.throw(ne))}catch(J){U(J)}}function H(ne){ne.done?N(ne.value):O(ne.value).then(K,z)}H((R=R.apply(E,S||[])).next())})},t=fp&&fp.__generator||function(E,S){var b={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},R,O,N,U=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return U.next=K(0),U.throw=K(1),U.return=K(2),typeof Symbol=="function"&&(U[Symbol.iterator]=function(){return this}),U;function K(H){return function(ne){return z([H,ne])}}function z(H){if(R)throw new TypeError("Generator is already executing.");for(;U&&(U=0,H[0]&&(b=0)),b;)try{if(R=1,O&&(N=H[0]&2?O.return:H[0]?O.throw||((N=O.return)&&N.call(O),0):O.next)&&!(N=N.call(O,H[1])).done)return N;switch(O=0,N&&(H=[H[0]&2,N.value]),H[0]){case 0:case 1:N=H;break;case 4:return b.label++,{value:H[1],done:!1};case 5:b.label++,O=H[1],H=[0];continue;case 7:H=b.ops.pop(),b.trys.pop();continue;default:if(N=b.trys,!(N=N.length>0&&N[N.length-1])&&(H[0]===6||H[0]===2)){b=0;continue}if(H[0]===3&&(!N||H[1]>N[0]&&H[1]<N[3])){b.label=H[1];break}if(H[0]===6&&b.label<N[1]){b.label=N[1],N=H;break}if(N&&b.label<N[2]){b.label=N[2],b.ops.push(H);break}N[2]&&b.ops.pop(),b.trys.pop();continue}H=S.call(E,b)}catch(ne){H=[6,ne],O=0}finally{R=N=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}};Object.defineProperty(fp,"__esModule",{value:!0}),fp.useUnityContext=void 0;var s=Ql(),a=sne(),l=YFe(),d=XFe(),g=function(E){var S=(0,d.useNullableState)(),b=S[0],R=S[1],O=(0,s.useState)(0),N=O[0],U=O[1],K=(0,s.useState)(!1),z=K[0],H=K[1],ne=(0,d.useNullableState)(),J=ne[0],se=ne[1],le=(0,l.useEventSystem)(),ce=(0,s.useRef)({setLoadingProgression:U,setInitialisationError:se,setUnityInstance:R,setIsLoaded:H,unityConfig:E}),Se=(0,s.useCallback)(function(pe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(pe===!0?1:0)},[b]),Z=(0,s.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),te=(0,s.useCallback)(function(pe,de,ut){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(pe,de,ut)},[b]),ie=(0,s.useCallback)(function(pe,de){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(pe,de)},[b]),ae=(0,s.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),ve=(0,s.useCallback)(function(){return r(void 0,void 0,void 0,function(){var pe;return t(this,function(de){switch(de.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(pe=b.Module.canvas,document.body.appendChild(pe),pe.style.display="none",[4,ae()]);case 1:return de.sent(),pe.remove(),[2]}})})},[b]);return(0,s.useEffect)(function(){H(N===1)},[N]),{unityProvider:ce.current,loadingProgression:N,initialisationError:J,isLoaded:z,UNSAFE__unityInstance:b,requestFullscreen:Se,requestPointerLock:Z,sendMessage:te,takeScreenshot:ie,unload:ae,UNSAFE__detachAndUnloadImmediate:ve,addEventListener:le.addEventListener,removeEventListener:le.removeEventListener}};return fp.useUnityContext=g,fp}var rY;function QFe(){return rY||(rY=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.useUnityContext=r.Unity=void 0;var t=qFe();Object.defineProperty(r,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=JFe();Object.defineProperty(r,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(TM)),TM}var one=QFe();const Ku="[UnityProvider]",ane=B.createContext(),ZFe=({spaceID:r,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:g,showLoginButton:E,showDisruptiveLogo:S})=>{It.log(`${Ku} Initializing with spaceID:`,r),It.log(`${Ku} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:R,isLoaded:O,sendMessage:N,addEventListener:U,removeEventListener:K,error:z}=one.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),H=B.useRef(null),ne=B.useRef(Date.now());B.useEffect(()=>{const ce=()=>{document.hidden?(It.log(`${Ku} Page hidden, starting keep-alive`),J()):(It.log(`${Ku} Page visible, stopping keep-alive`),se())};return document.addEventListener("visibilitychange",ce),()=>{document.removeEventListener("visibilitychange",ce),se()}},[]),B.useEffect(()=>{const ce=()=>{ne.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ce),window.addEventListener("keydown",ce),window.addEventListener("touchstart",ce),()=>{window.removeEventListener("mousemove",ce),window.removeEventListener("keydown",ce),window.removeEventListener("touchstart",ce)}},[N]);const J=()=>{H.current||(H.current=setInterval(()=>{O&&document.hidden&&(N("WebGLInputManager","KeepAlive"),It.debug(`${Ku} Sent keep-alive message`))},1e4))},se=()=>{H.current&&(clearInterval(H.current),H.current=null)};B.useEffect(()=>(It.log(`${Ku} Component mounted`),()=>{It.log(`${Ku} Component unmounting`),se()}),[]),B.useEffect(()=>{It.log(`${Ku} Loading progress:`,R)},[R]),B.useEffect(()=>{O&&(It.log(`${Ku} Unity instance loaded for:`,r),document.hidden&&J())},[O,r]),B.useEffect(()=>{z&&It.error(`${Ku} Unity error:`,z)},[z]);const le={spaceID:r,unityProvider:b,loadingProgression:R,isLoaded:O,sendMessage:N,addEventListener:U,removeEventListener:K};return It.log(`${Ku} Rendering provider with instance:`,le),F.jsx(ane.Provider,{value:le,children:t})},yS=()=>B.useContext(ane);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cne="firebasestorage.googleapis.com",lne="storageBucket",eje=2*60*1e3,tje=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po extends _h{constructor(t,s,a=0){super(bM(t),`Firebase Storage: ${s} (${bM(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,po.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return bM(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ho;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ho||(ho={}));function bM(r){return"storage/"+r}function une(){const r="An unknown error occurred, please check the error payload for server response.";return new po(ho.UNKNOWN,r)}function nje(r){return new po(ho.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function rje(r){return new po(ho.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function ije(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new po(ho.UNAUTHENTICATED,r)}function sje(){return new po(ho.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function oje(r){return new po(ho.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function aje(){return new po(ho.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function cje(){return new po(ho.CANCELED,"User canceled the upload/download.")}function lje(r){return new po(ho.INVALID_URL,"Invalid URL '"+r+"'.")}function uje(r){return new po(ho.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function dje(){return new po(ho.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+lne+"' property when initializing the app?")}function hje(){return new po(ho.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Z2(r){return new po(ho.INVALID_ARGUMENT,r)}function dne(){return new po(ho.APP_DELETED,"The Firebase app was deleted.")}function pje(r){return new po(ho.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function nb(r){throw new po(ho.INTERNAL_ERROR,"Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=al.makeFromUrl(t,s)}catch{return new al(t,"")}if(a.path==="")return a;throw uje(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(le){le.path.charAt(le.path.length-1)==="/"&&(le.path_=le.path_.slice(0,-1))}const g="(/(.*))?$",E=new RegExp("^gs://"+l+g,"i"),S={bucket:1,path:3};function b(le){le.path_=decodeURIComponent(le.path)}const R="v[A-Za-z0-9_]+",O=s.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",U=new RegExp(`^https?://${O}/${R}/b/${l}/o${N}`,"i"),K={bucket:1,path:3},z=s===cne?"(?:storage.googleapis.com|storage.cloud.google.com)":s,H="([^?#]*)",ne=new RegExp(`^https?://${z}/${l}/${H}`,"i"),se=[{regex:E,indices:S,postModify:d},{regex:U,indices:K,postModify:b},{regex:ne,indices:{bucket:1,path:2},postModify:b}];for(let le=0;le<se.length;le++){const ce=se[le],Se=ce.regex.exec(t);if(Se){const Z=Se[ce.indices.bucket];let te=Se[ce.indices.path];te||(te=""),a=new al(Z,te),ce.postModify(a);break}}if(a==null)throw lje(t);return a}}class fje{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mje(r,t,s){let a=1,l=null,d=null,g=!1,E=0;function S(){return E===2}let b=!1;function R(...H){b||(b=!0,t.apply(null,H))}function O(H){l=setTimeout(()=>{l=null,r(U,S())},H)}function N(){d&&clearTimeout(d)}function U(H,...ne){if(b){N();return}if(H){N(),R.call(null,H,...ne);return}if(S()||g){N(),R.call(null,H,...ne);return}a<64&&(a*=2);let se;E===1?(E=2,se=0):se=(a+Math.random())*1e3,O(se)}let K=!1;function z(H){K||(K=!0,N(),!b&&(l!==null?(H||(E=2),clearTimeout(l),O(0)):H||(E=1)))}return O(0),d=setTimeout(()=>{g=!0,z(!0)},s),z}function gje(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _je(r){return r!==void 0}function vje(r){return typeof r=="object"&&!Array.isArray(r)}function hne(r){return typeof r=="string"||r instanceof String}function iY(r,t,s,a){if(a<t)throw Z2(`Invalid value for '${r}'. Expected ${t} or greater.`);if(a>s)throw Z2(`Invalid value for '${r}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pne(r,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${r}`}function fne(r){const t=encodeURIComponent;let s="?";for(const a in r)if(r.hasOwnProperty(a)){const l=t(a)+"="+t(r[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var M_;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(M_||(M_={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eje(r,t){const s=r>=500&&r<600,l=[408,429].indexOf(r)!==-1,d=t.indexOf(r)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yje{constructor(t,s,a,l,d,g,E,S,b,R,O,N=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=g,this.callback_=E,this.errorCallback_=S,this.timeout_=b,this.progressCallback_=R,this.connectionFactory_=O,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((U,K)=>{this.resolve_=U,this.reject_=K,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new pO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const g=E=>{const S=E.loaded,b=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(S,b)};this.progressCallback_!==null&&d.addUploadProgressListener(g),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(g),this.pendingConnection_=null;const E=d.getErrorCode()===M_.NO_ERROR,S=d.getStatus();if(!E||Eje(S,this.additionalRetryCodes_)&&this.retry){const R=d.getErrorCode()===M_.ABORT;a(!1,new pO(!1,null,R));return}const b=this.successCodes_.indexOf(S)!==-1;a(!0,new pO(b,d))})},s=(a,l)=>{const d=this.resolve_,g=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const S=this.callback_(E,E.getResponse());_je(S)?d(S):d()}catch(S){g(S)}else if(E!==null){const S=une();S.serverResponse=E.getErrorText(),this.errorCallback_?g(this.errorCallback_(E,S)):g(S)}else if(l.canceled){const S=this.appDelete_?dne():cje();g(S)}else{const S=aje();g(S)}};this.canceled_?s(!1,new pO(!1,null,!0)):this.backoffId_=mje(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&gje(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class pO{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function Sje(r,t){t!==null&&t.length>0&&(r.Authorization="Firebase "+t)}function Tje(r,t){r["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function bje(r,t){t&&(r["X-Firebase-GMPID"]=t)}function wje(r,t){t!==null&&(r["X-Firebase-AppCheck"]=t)}function Rje(r,t,s,a,l,d,g=!0){const E=fne(r.urlParams),S=r.url+E,b=Object.assign({},r.headers);return bje(b,t),Sje(b,s),Tje(b,d),wje(b,a),new yje(S,r.method,b,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,l,g)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mne(r){let t;try{t=JSON.parse(r)}catch{return null}return vje(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cje(r){if(r.length===0)return null;const t=r.lastIndexOf("/");return t===-1?"":r.slice(0,t)}function Ije(r,t){const s=t.split("/").filter(a=>a.length>0).join("/");return r.length===0?s:r+"/"+s}function gne(r){const t=r.lastIndexOf("/",r.length-2);return t===-1?r:r.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aje(r,t){return t}class Va{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||Aje}}let fO=null;function Oje(r){return!hne(r)||r.length<2?r:gne(r)}function Pje(){if(fO)return fO;const r=[];r.push(new Va("bucket")),r.push(new Va("generation")),r.push(new Va("metageneration")),r.push(new Va("name","fullPath",!0));function t(d,g){return Oje(g)}const s=new Va("name");s.xform=t,r.push(s);function a(d,g){return g!==void 0?Number(g):g}const l=new Va("size");return l.xform=a,r.push(l),r.push(new Va("timeCreated")),r.push(new Va("updated")),r.push(new Va("md5Hash",null,!0)),r.push(new Va("cacheControl",null,!0)),r.push(new Va("contentDisposition",null,!0)),r.push(new Va("contentEncoding",null,!0)),r.push(new Va("contentLanguage",null,!0)),r.push(new Va("contentType",null,!0)),r.push(new Va("metadata","customMetadata",!0)),fO=r,fO}function Nje(r,t){function s(){const a=r.bucket,l=r.fullPath,d=new al(a,l);return t._makeStorageReference(d)}Object.defineProperty(r,"ref",{get:s})}function kje(r,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const g=s[d];a[g.local]=g.xform(a,t[g.server])}return Nje(a,r),a}function Dje(r,t,s){const a=mne(t);return a===null?null:kje(r,a,s)}function Lje(r,t,s,a){const l=mne(t);if(l===null||!hne(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const g=encodeURIComponent;return d.split(",").map(b=>{const R=r.bucket,O=r.fullPath,N="/b/"+g(R)+"/o/"+g(O),U=pne(N,s,a),K=fne({alt:"media",token:b});return U+K})[0]}class xje{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mje(r){if(!r)throw une()}function Uje(r,t){function s(a,l){const d=Dje(r,l,t);return Mje(d!==null),Lje(d,l,r.host,r._protocol)}return s}function Vje(r){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=sje():l=ije():s.getStatus()===402?l=rje(r.bucket):s.getStatus()===403?l=oje(r.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function Fje(r){const t=Vje(r);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=nje(r.path)),d.serverResponse=l.serverResponse,d}return s}function jje(r,t,s){const a=t.fullServerUrl(),l=pne(a,r.host,r._protocol),d="GET",g=r.maxOperationRetryTime,E=new xje(l,d,Uje(r,s),g);return E.errorHandler=Fje(t),E}class Bje{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=M_.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=M_.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=M_.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw nb("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw nb("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw nb("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw nb("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw nb("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class Wje extends Bje{initXhr(){this.xhr_.responseType="text"}}function Gje(){return new Wje}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(t,s){this._service=t,s instanceof al?this._location=s:this._location=al.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new X_(t,s)}get root(){const t=new al(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return gne(this._location.path)}get storage(){return this._service}get parent(){const t=Cje(this._location.path);if(t===null)return null;const s=new al(this._location.bucket,t);return new X_(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw pje(t)}}function zje(r){r._throwIfRoot("getDownloadURL");const t=jje(r.storage,r._location,Pje());return r.storage.makeRequestWithTokens(t,Gje).then(s=>{if(s===null)throw hje();return s})}function Hje(r,t){const s=Ije(r._location.path,t),a=new al(r._location.bucket,s);return new X_(r.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kje(r){return/^[A-Za-z]+:\/\//.test(r)}function $je(r,t){return new X_(r,t)}function _ne(r,t){if(r instanceof mF){const s=r;if(s._bucket==null)throw dje();const a=new X_(s,s._bucket);return t!=null?_ne(a,t):a}else return t!==void 0?Hje(r,t):r}function qje(r,t){if(t&&Kje(t)){if(r instanceof mF)return $je(r,t);throw Z2("To use ref(service, url), the first argument must be a Storage instance.")}else return _ne(r,t)}function sY(r,t){const s=t==null?void 0:t[lne];return s==null?null:al.makeFromBucketSpec(s,r)}function Yje(r,t,s,a={}){r.host=`${t}:${s}`,r._protocol="http";const{mockUserToken:l}=a;l&&(r._overrideAuthToken=typeof l=="string"?l:HZ(l,r.app.options.projectId))}class mF{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=cne,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=eje,this._maxUploadRetryTime=tje,this._requests=new Set,l!=null?this._bucket=al.makeFromBucketSpec(l,this._host):this._bucket=sY(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=al.makeFromBucketSpec(this._url,t):this._bucket=sY(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){iY("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){iY("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new X_(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new fje(dne());{const g=Rje(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(g),g.getPromise().then(()=>this._requests.delete(g),()=>this._requests.delete(g)),g}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const oY="@firebase/storage",aY="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vne="storage";function Xje(r){return r=Ms(r),zje(r)}function Jje(r,t){return r=Ms(r),qje(r,t)}function Qje(r=AV(),t){r=Ms(r);const a=uN(r,vne).getImmediate({identifier:t}),l=WZ("storage");return l&&Zje(a,...l),a}function Zje(r,t,s,a={}){Yje(r,t,s,a)}function eBe(r,{instanceIdentifier:t}){const s=r.getProvider("app").getImmediate(),a=r.getProvider("auth-internal"),l=r.getProvider("app-check-internal");return new mF(s,a,l,t,Q_)}function tBe(){z_(new bm(vne,eBe,"PUBLIC").setMultipleInstances(!0)),oh(oY,aY,""),oh(oY,aY,"esm2017")}tBe();const Ene=async r=>{const t=Qje(),s=Jje(t,r);try{return await Xje(s)}catch(a){throw It.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let nBe={};const rBe=async r=>{try{const t=fw(cS,"spaces",r),s=await Q2(t);if(s.exists()){let a=s.data();if(a.webglBuildId){const l=fw(cS,"webglBuilds",a.webglBuildId),d=await Q2(l);if(d.exists()){const g=d.data();a={...a,...g}}else It.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await iBe(a),a=sBe(a),console.log("Space data:",a),It.log(`spacesFirestore: Caching space data for: ${r}`),nBe[r]=a,a}else return It.warn(`spacesFirestore: No document found for item ID: ${r}`),null}catch(t){throw It.error("spacesFirestore: Error fetching item data:",t),t}},iBe=async r=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=r[a];l&&l.startsWith("gs://")&&(r[a]=await Ene(l))});return await Promise.all(s),r},sBe=r=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=r;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let wM={};const yne=async r=>{It.log("spacesFirestore: Get Videos from Firestore for space: ",r);try{if(wM[r])return It.log("spacesFirestore: Returning cached videos for space:",r),wM[r];const t=mFe(cS,`spaces/${r}/videos`),s=await NFe(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),wM[r]=a,a}catch(t){throw It.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},ON=()=>{const{sendMessage:r,isLoaded:t}=yS(),s=B.useRef([]),a=B.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:g}=s.current.shift();It.log("useSendUnityEvent: Processing queued event to Unity:",d,g);try{r("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(g)}))}catch(E){It.error("useSendUnityEvent: Error sending event to Unity:",E),s.current.unshift({eventName:d,data:g});break}}},[r,t]);return B.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),B.useCallback((d,g)=>{It.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:g}),a()},[a])},$w=()=>{const{addEventListener:r,removeEventListener:t}=yS();return B.useCallback((s,a)=>{const l=d=>{It.log(s+" unity message received.");let g=null;if(d)try{g=JSON.parse(d)}catch(E){It.warn("Failed to parse JSON data from Unity message:",E)}a(g)};return r(s,l),()=>{t(s,l)}},[r,t])},oBe=()=>{const[r,t]=B.useState(!1),s=$w();return B.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{It.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),r},aBe=r=>{const[t,s]=B.useState(null),a=$w(),{spaceID:l}=yS();return B.useEffect(()=>{let g=!0;const S=a("PlayVideo",async b=>{try{const{gameObjectName:R}=b;if(!R){It.error("Game object name is missing in Unity event data.");return}const O=await yne(l);It.log("SPACES VIDEOS",O);const N=O.find(U=>U.id===R);N&&g?(s(N.url),It.log("Video URL set to:",N.url)):console.error("Video not found for game object:",R)}catch(R){console.error("Error fetching space videos:",R)}});return()=>{g=!1,S()}},[a,l,r]),[t,()=>{s(null)}]},cBe=()=>{const r=$w(),{sendUserToUnity:t}=B.useContext(tu);return B.useEffect(()=>{const a=r("RequestUserForUnity",()=>{It.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[r,t]),!0},lBe=()=>{const{spaceID:r}=yS(),t=ON();B.useEffect(()=>{(async()=>{try{if(!r)throw new Error("spaceID is not defined.");const a=await yne(r),l=async E=>{const S=`https://vimeo.com/api/oembed.json?url=${E}`,b=await fetch(S);if(!b.ok)throw new Error(`Failed to fetch thumbnail: ${b.statusText}`);const R=await b.json(),O=R.thumbnail_url.replace(/_\d+x\d+/,""),N=["640x360","295x166"];let U=null;for(let K of N){const z=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${O}_${K}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(z,{method:"HEAD"})).ok){U=z;break}}catch(H){console.warn(`Failed to validate thumbnail URL: ${z}`,H)}}return U||R.thumbnail_url},d=a.map(async E=>{const S=await l(E.url);return{gameObjectName:E.id,thumbnailUrl:S}}),g=await Promise.all(d);It.log("Fetched Thumbnails",g),g.forEach(({gameObjectName:E,thumbnailUrl:S})=>{t("SetThumbnail",{gameObjectName:E,thumbnailUrl:S})})}catch(a){It.error("Error fetching thumbnails:",a)}})()},[t,r])},uBe=()=>{const[r,t]=B.useState(null),s=$w();return console.log(" Nameplate click hook initialized"),B.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",g=>{if(console.log(" Nameplate click detected!",g),!g){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof g=="string"?JSON.parse(g):g;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[r,()=>{console.log(" Resetting nameplate data"),t(null)}]},Sne=()=>{const[r,t]=B.useState([]),s=$w();return B.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(It.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},g=U=>{if(a){It.log("UpdatePlayerList unity message received.");try{let K=[];if(typeof U=="object"&&U!==null?K=U.players||[]:K=JSON.parse(U).players||[],Array.isArray(K)){const z=Array.from(new Map(K.map(H=>[H.playerId,H])).values());t(z),l&&(clearTimeout(l),l=null)}}catch(K){It.error("Error handling player list data:",K),l||(l=setTimeout(d,1e3))}}},E=()=>{It.log("Player disconnected, requesting fresh player list"),d()},S=()=>{It.log("Player left, requesting fresh player list"),d()};d();const b=s("UpdatePlayerList",g),R=s("PlayerDisconnected",E),O=s("PlayerLeft",S),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof R=="function"&&R(),typeof O=="function"&&O(),clearInterval(N)}},[s]),r},dBe=r=>({opacity:1});ai.string.isRequired,ai.func.isRequired;var qw=r=>r.type==="checkbox",Py=r=>r instanceof Date,Fa=r=>r==null;const Tne=r=>typeof r=="object";var Xs=r=>!Fa(r)&&!Array.isArray(r)&&Tne(r)&&!Py(r),hBe=r=>Xs(r)&&r.target?qw(r.target)?r.target.checked:r.target.value:r,pBe=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,fBe=(r,t)=>r.has(pBe(t)),mBe=r=>{const t=r.constructor&&r.constructor.prototype;return Xs(t)&&t.hasOwnProperty("isPrototypeOf")},gF=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Kl(r){let t;const s=Array.isArray(r);if(r instanceof Date)t=new Date(r);else if(r instanceof Set)t=new Set(r);else if(!(gF&&(r instanceof Blob||r instanceof FileList))&&(s||Xs(r)))if(t=s?[]:{},!s&&!mBe(r))t=r;else for(const a in r)r.hasOwnProperty(a)&&(t[a]=Kl(r[a]));else return r;return t}var Yw=r=>Array.isArray(r)?r.filter(Boolean):[],bs=r=>r===void 0,Jt=(r,t,s)=>{if(!t||!Xs(r))return s;const a=Yw(t.split(/[,[\].]+?/)).reduce((l,d)=>Fa(l)?l:l[d],r);return bs(a)||a===r?bs(r[t])?s:r[t]:a},_p=r=>typeof r=="boolean";const cY={BLUR:"blur",FOCUS_OUT:"focusout"},qu={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},mp={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};Bi.createContext(null);var gBe=(r,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in r)Object.defineProperty(l,d,{get:()=>{const g=d;return t._proxyFormState[g]!==qu.all&&(t._proxyFormState[g]=!a||qu.all),r[g]}});return l},il=r=>Xs(r)&&!Object.keys(r).length,_Be=(r,t,s,a)=>{s(r);const{name:l,...d}=r;return il(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(g=>t[g]===qu.all)},RM=r=>Array.isArray(r)?r:[r];function vBe(r){const t=Bi.useRef(r);t.current=r,Bi.useEffect(()=>{const s=!r.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[r.disabled])}var th=r=>typeof r=="string",EBe=(r,t,s,a,l)=>th(r)?(a&&t.watch.add(r),Jt(s,r,l)):Array.isArray(r)?r.map(d=>(a&&t.watch.add(d),Jt(s,d))):(a&&(t.watchAll=!0),s),_F=r=>/^\w*$/.test(r),bne=r=>Yw(r.replace(/["|']|\]/g,"").split(/\.|\[/)),Li=(r,t,s)=>{let a=-1;const l=_F(t)?[t]:bne(t),d=l.length,g=d-1;for(;++a<d;){const E=l[a];let S=s;if(a!==g){const b=r[E];S=Xs(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}r[E]=S,r=r[E]}return r},yBe=(r,t,s,a,l)=>t?{...s[r],types:{...s[r]&&s[r].types?s[r].types:{},[a]:l||!0}}:{},lY=r=>({isOnSubmit:!r||r===qu.onSubmit,isOnBlur:r===qu.onBlur,isOnChange:r===qu.onChange,isOnAll:r===qu.all,isOnTouch:r===qu.onTouched}),uY=(r,t,s)=>!s&&(t.watchAll||t.watch.has(r)||[...t.watch].some(a=>r.startsWith(a)&&/^\.\w+/.test(r.slice(a.length))));const Vb=(r,t,s,a)=>{for(const l of s||Object.keys(r)){const d=Jt(r,l);if(d){const{_f:g,...E}=d;if(g){if(g.refs&&g.refs[0]&&t(g.refs[0],l)&&!a)break;if(g.ref&&t(g.ref,g.name)&&!a)break;Vb(E,t)}else Xs(E)&&Vb(E,t)}}};var SBe=(r,t,s)=>{const a=Yw(Jt(r,s));return Li(a,"root",t[s]),Li(r,s,a),r},vF=r=>r.type==="file",hm=r=>typeof r=="function",NP=r=>{if(!gF)return!1;const t=r?r.ownerDocument:0;return r instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},qO=r=>th(r),EF=r=>r.type==="radio",kP=r=>r instanceof RegExp;const dY={value:!1,isValid:!1},hY={value:!0,isValid:!0};var wne=r=>{if(Array.isArray(r)){if(r.length>1){const t=r.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!bs(r[0].attributes.value)?bs(r[0].value)||r[0].value===""?hY:{value:r[0].value,isValid:!0}:hY:dY}return dY};const pY={isValid:!1,value:null};var Rne=r=>Array.isArray(r)?r.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,pY):pY;function fY(r,t,s="validate"){if(qO(r)||Array.isArray(r)&&r.every(qO)||_p(r)&&!r)return{type:s,message:qO(r)?r:"",ref:t}}var hy=r=>Xs(r)&&!kP(r)?r:{value:r,message:""},mY=async(r,t,s,a,l)=>{const{ref:d,refs:g,required:E,maxLength:S,minLength:b,min:R,max:O,pattern:N,validate:U,name:K,valueAsNumber:z,mount:H,disabled:ne}=r._f,J=Jt(t,K);if(!H||ne)return{};const se=g?g[0]:d,le=pe=>{a&&se.reportValidity&&(se.setCustomValidity(_p(pe)?"":pe||""),se.reportValidity())},ce={},Se=EF(d),Z=qw(d),te=Se||Z,ie=(z||vF(d))&&bs(d.value)&&bs(J)||NP(d)&&d.value===""||J===""||Array.isArray(J)&&!J.length,ae=yBe.bind(null,K,s,ce),ve=(pe,de,ut,mt=mp.maxLength,Ze=mp.minLength)=>{const Be=pe?de:ut;ce[K]={type:pe?mt:Ze,message:Be,ref:d,...ae(pe?mt:Ze,Be)}};if(l?!Array.isArray(J)||!J.length:E&&(!te&&(ie||Fa(J))||_p(J)&&!J||Z&&!wne(g).isValid||Se&&!Rne(g).isValid)){const{value:pe,message:de}=qO(E)?{value:!!E,message:E}:hy(E);if(pe&&(ce[K]={type:mp.required,message:de,ref:se,...ae(mp.required,de)},!s))return le(de),ce}if(!ie&&(!Fa(R)||!Fa(O))){let pe,de;const ut=hy(O),mt=hy(R);if(!Fa(J)&&!isNaN(J)){const Ze=d.valueAsNumber||J&&+J;Fa(ut.value)||(pe=Ze>ut.value),Fa(mt.value)||(de=Ze<mt.value)}else{const Ze=d.valueAsDate||new Date(J),Be=Ee=>new Date(new Date().toDateString()+" "+Ee),Ke=d.type=="time",nt=d.type=="week";th(ut.value)&&J&&(pe=Ke?Be(J)>Be(ut.value):nt?J>ut.value:Ze>new Date(ut.value)),th(mt.value)&&J&&(de=Ke?Be(J)<Be(mt.value):nt?J<mt.value:Ze<new Date(mt.value))}if((pe||de)&&(ve(!!pe,ut.message,mt.message,mp.max,mp.min),!s))return le(ce[K].message),ce}if((S||b)&&!ie&&(th(J)||l&&Array.isArray(J))){const pe=hy(S),de=hy(b),ut=!Fa(pe.value)&&J.length>+pe.value,mt=!Fa(de.value)&&J.length<+de.value;if((ut||mt)&&(ve(ut,pe.message,de.message),!s))return le(ce[K].message),ce}if(N&&!ie&&th(J)){const{value:pe,message:de}=hy(N);if(kP(pe)&&!J.match(pe)&&(ce[K]={type:mp.pattern,message:de,ref:d,...ae(mp.pattern,de)},!s))return le(de),ce}if(U){if(hm(U)){const pe=await U(J,t),de=fY(pe,se);if(de&&(ce[K]={...de,...ae(mp.validate,de.message)},!s))return le(de.message),ce}else if(Xs(U)){let pe={};for(const de in U){if(!il(pe)&&!s)break;const ut=fY(await U[de](J,t),se,de);ut&&(pe={...ut,...ae(de,ut.message)},le(ut.message),s&&(ce[K]=pe))}if(!il(pe)&&(ce[K]={ref:se,...pe},!s))return ce}}return le(!0),ce};function TBe(r,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)r=bs(r)?a++:r[t[a++]];return r}function bBe(r){for(const t in r)if(r.hasOwnProperty(t)&&!bs(r[t]))return!1;return!0}function $s(r,t){const s=Array.isArray(t)?t:_F(t)?[t]:bne(t),a=s.length===1?r:TBe(r,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(Xs(a)&&il(a)||Array.isArray(a)&&bBe(a))&&$s(r,s.slice(0,-1)),r}var CM=()=>{let r=[];return{get observers(){return r},next:l=>{for(const d of r)d.next&&d.next(l)},subscribe:l=>(r.push(l),{unsubscribe:()=>{r=r.filter(d=>d!==l)}}),unsubscribe:()=>{r=[]}}},DP=r=>Fa(r)||!Tne(r);function C_(r,t){if(DP(r)||DP(t))return r===t;if(Py(r)&&Py(t))return r.getTime()===t.getTime();const s=Object.keys(r),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=r[l];if(!a.includes(l))return!1;if(l!=="ref"){const g=t[l];if(Py(d)&&Py(g)||Xs(d)&&Xs(g)||Array.isArray(d)&&Array.isArray(g)?!C_(d,g):d!==g)return!1}}return!0}var Cne=r=>r.type==="select-multiple",wBe=r=>EF(r)||qw(r),IM=r=>NP(r)&&r.isConnected,Ine=r=>{for(const t in r)if(hm(r[t]))return!0;return!1};function LP(r,t={}){const s=Array.isArray(r);if(Xs(r)||s)for(const a in r)Array.isArray(r[a])||Xs(r[a])&&!Ine(r[a])?(t[a]=Array.isArray(r[a])?[]:{},LP(r[a],t[a])):Fa(r[a])||(t[a]=!0);return t}function Ane(r,t,s){const a=Array.isArray(r);if(Xs(r)||a)for(const l in r)Array.isArray(r[l])||Xs(r[l])&&!Ine(r[l])?bs(t)||DP(s[l])?s[l]=Array.isArray(r[l])?LP(r[l],[]):{...LP(r[l])}:Ane(r[l],Fa(t)?{}:t[l],s[l]):s[l]=!C_(r[l],t[l]);return s}var mO=(r,t)=>Ane(r,t,LP(t)),One=(r,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>bs(r)?r:t?r===""?NaN:r&&+r:s&&th(r)?new Date(r):a?a(r):r;function AM(r){const t=r.ref;if(!(r.refs?r.refs.every(s=>s.disabled):t.disabled))return vF(t)?t.files:EF(t)?Rne(r.refs).value:Cne(t)?[...t.selectedOptions].map(({value:s})=>s):qw(t)?wne(r.refs).value:One(bs(t.value)?r.ref.value:t.value,r)}var RBe=(r,t,s,a)=>{const l={};for(const d of r){const g=Jt(t,d);g&&Li(l,d,g._f)}return{criteriaMode:s,names:[...r],fields:l,shouldUseNativeValidation:a}},rb=r=>bs(r)?r:kP(r)?r.source:Xs(r)?kP(r.value)?r.value.source:r.value:r,CBe=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate);function gY(r,t,s){const a=Jt(r,s);if(a||_F(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),g=Jt(t,d),E=Jt(r,d);if(g&&!Array.isArray(g)&&s!==d)return{name:s};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:s}}var IBe=(r,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||r):(s?a.isOnBlur:l.isOnBlur)?!r:(s?a.isOnChange:l.isOnChange)?r:!0,ABe=(r,t)=>!Yw(Jt(r,t)).length&&$s(r,t);const OBe={mode:qu.onSubmit,reValidateMode:qu.onChange,shouldFocusError:!0};function PBe(r={}){let t={...OBe,...r},s={submitCount:0,isDirty:!1,isLoading:hm(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=Xs(t.defaultValues)||Xs(t.values)?Kl(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Kl(l),g={action:!1,mount:!1,watch:!1},E={mount:new Set,unMount:new Set,array:new Set,watch:new Set},S,b=0;const R={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},O={values:CM(),array:CM(),state:CM()},N=lY(t.mode),U=lY(t.reValidateMode),K=t.criteriaMode===qu.all,z=we=>De=>{clearTimeout(b),b=setTimeout(we,De)},H=async we=>{if(R.isValid||we){const De=t.resolver?il((await te()).errors):await ae(a,!0);De!==s.isValid&&O.state.next({isValid:De})}},ne=(we,De)=>{(R.isValidating||R.validatingFields)&&((we||Array.from(E.mount)).forEach(We=>{We&&(De?Li(s.validatingFields,We,De):$s(s.validatingFields,We))}),O.state.next({validatingFields:s.validatingFields,isValidating:!il(s.validatingFields)}))},J=(we,De=[],We,pt,ft=!0,dt=!0)=>{if(pt&&We){if(g.action=!0,dt&&Array.isArray(Jt(a,we))){const Mt=We(Jt(a,we),pt.argA,pt.argB);ft&&Li(a,we,Mt)}if(dt&&Array.isArray(Jt(s.errors,we))){const Mt=We(Jt(s.errors,we),pt.argA,pt.argB);ft&&Li(s.errors,we,Mt),ABe(s.errors,we)}if(R.touchedFields&&dt&&Array.isArray(Jt(s.touchedFields,we))){const Mt=We(Jt(s.touchedFields,we),pt.argA,pt.argB);ft&&Li(s.touchedFields,we,Mt)}R.dirtyFields&&(s.dirtyFields=mO(l,d)),O.state.next({name:we,isDirty:pe(we,De),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else Li(d,we,De)},se=(we,De)=>{Li(s.errors,we,De),O.state.next({errors:s.errors})},le=we=>{s.errors=we,O.state.next({errors:s.errors,isValid:!1})},ce=(we,De,We,pt)=>{const ft=Jt(a,we);if(ft){const dt=Jt(d,we,bs(We)?Jt(l,we):We);bs(dt)||pt&&pt.defaultChecked||De?Li(d,we,De?dt:AM(ft._f)):mt(we,dt),g.mount&&H()}},Se=(we,De,We,pt,ft)=>{let dt=!1,Mt=!1;const Fn={name:we},Cn=!!(Jt(a,we)&&Jt(a,we)._f.disabled);if(!We||pt){R.isDirty&&(Mt=s.isDirty,s.isDirty=Fn.isDirty=pe(),dt=Mt!==Fn.isDirty);const tn=Cn||C_(Jt(l,we),De);Mt=!!(!Cn&&Jt(s.dirtyFields,we)),tn||Cn?$s(s.dirtyFields,we):Li(s.dirtyFields,we,!0),Fn.dirtyFields=s.dirtyFields,dt=dt||R.dirtyFields&&Mt!==!tn}if(We){const tn=Jt(s.touchedFields,we);tn||(Li(s.touchedFields,we,We),Fn.touchedFields=s.touchedFields,dt=dt||R.touchedFields&&tn!==We)}return dt&&ft&&O.state.next(Fn),dt?Fn:{}},Z=(we,De,We,pt)=>{const ft=Jt(s.errors,we),dt=R.isValid&&_p(De)&&s.isValid!==De;if(r.delayError&&We?(S=z(()=>se(we,We)),S(r.delayError)):(clearTimeout(b),S=null,We?Li(s.errors,we,We):$s(s.errors,we)),(We?!C_(ft,We):ft)||!il(pt)||dt){const Mt={...pt,...dt&&_p(De)?{isValid:De}:{},errors:s.errors,name:we};s={...s,...Mt},O.state.next(Mt)}},te=async we=>{ne(we,!0);const De=await t.resolver(d,t.context,RBe(we||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return ne(we),De},ie=async we=>{const{errors:De}=await te(we);if(we)for(const We of we){const pt=Jt(De,We);pt?Li(s.errors,We,pt):$s(s.errors,We)}else s.errors=De;return De},ae=async(we,De,We={valid:!0})=>{for(const pt in we){const ft=we[pt];if(ft){const{_f:dt,...Mt}=ft;if(dt){const Fn=E.array.has(dt.name);ne([pt],!0);const Cn=await mY(ft,d,K,t.shouldUseNativeValidation&&!De,Fn);if(ne([pt]),Cn[dt.name]&&(We.valid=!1,De))break;!De&&(Jt(Cn,dt.name)?Fn?SBe(s.errors,Cn,dt.name):Li(s.errors,dt.name,Cn[dt.name]):$s(s.errors,dt.name))}Mt&&await ae(Mt,De,We)}}return We.valid},ve=()=>{for(const we of E.unMount){const De=Jt(a,we);De&&(De._f.refs?De._f.refs.every(We=>!IM(We)):!IM(De._f.ref))&&gt(we)}E.unMount=new Set},pe=(we,De)=>(we&&De&&Li(d,we,De),!C_(Ye(),l)),de=(we,De,We)=>EBe(we,E,{...g.mount?d:bs(De)?l:th(we)?{[we]:De}:De},We,De),ut=we=>Yw(Jt(g.mount?d:l,we,r.shouldUnregister?Jt(l,we,[]):[])),mt=(we,De,We={})=>{const pt=Jt(a,we);let ft=De;if(pt){const dt=pt._f;dt&&(!dt.disabled&&Li(d,we,One(De,dt)),ft=NP(dt.ref)&&Fa(De)?"":De,Cne(dt.ref)?[...dt.ref.options].forEach(Mt=>Mt.selected=ft.includes(Mt.value)):dt.refs?qw(dt.ref)?dt.refs.length>1?dt.refs.forEach(Mt=>(!Mt.defaultChecked||!Mt.disabled)&&(Mt.checked=Array.isArray(ft)?!!ft.find(Fn=>Fn===Mt.value):ft===Mt.value)):dt.refs[0]&&(dt.refs[0].checked=!!ft):dt.refs.forEach(Mt=>Mt.checked=Mt.value===ft):vF(dt.ref)?dt.ref.value="":(dt.ref.value=ft,dt.ref.type||O.values.next({name:we,values:{...d}})))}(We.shouldDirty||We.shouldTouch)&&Se(we,ft,We.shouldTouch,We.shouldDirty,!0),We.shouldValidate&&Ee(we)},Ze=(we,De,We)=>{for(const pt in De){const ft=De[pt],dt=`${we}.${pt}`,Mt=Jt(a,dt);(E.array.has(we)||!DP(ft)||Mt&&!Mt._f)&&!Py(ft)?Ze(dt,ft,We):mt(dt,ft,We)}},Be=(we,De,We={})=>{const pt=Jt(a,we),ft=E.array.has(we),dt=Kl(De);Li(d,we,dt),ft?(O.array.next({name:we,values:{...d}}),(R.isDirty||R.dirtyFields)&&We.shouldDirty&&O.state.next({name:we,dirtyFields:mO(l,d),isDirty:pe(we,dt)})):pt&&!pt._f&&!Fa(dt)?Ze(we,dt,We):mt(we,dt,We),uY(we,E)&&O.state.next({...s}),O.values.next({name:g.mount?we:void 0,values:{...d}})},Ke=async we=>{g.mount=!0;const De=we.target;let We=De.name,pt=!0;const ft=Jt(a,We),dt=()=>De.type?AM(ft._f):hBe(we),Mt=Fn=>{pt=Number.isNaN(Fn)||Fn===Jt(d,We,Fn)};if(ft){let Fn,Cn;const tn=dt(),_r=we.type===cY.BLUR||we.type===cY.FOCUS_OUT,ya=!CBe(ft._f)&&!t.resolver&&!Jt(s.errors,We)&&!ft._f.deps||IBe(_r,Jt(s.touchedFields,We),s.isSubmitted,U,N),ps=uY(We,E,_r);Li(d,We,tn),_r?(ft._f.onBlur&&ft._f.onBlur(we),S&&S(0)):ft._f.onChange&&ft._f.onChange(we);const Qs=Se(We,tn,_r,!1),Lt=!il(Qs)||ps;if(!_r&&O.values.next({name:We,type:we.type,values:{...d}}),ya)return R.isValid&&H(),Lt&&O.state.next({name:We,...ps?{}:Qs});if(!_r&&ps&&O.state.next({...s}),t.resolver){const{errors:dn}=await te([We]);if(Mt(tn),pt){const Zs=gY(s.errors,a,We),sr=gY(dn,a,Zs.name||We);Fn=sr.error,We=sr.name,Cn=il(dn)}}else ne([We],!0),Fn=(await mY(ft,d,K,t.shouldUseNativeValidation))[We],ne([We]),Mt(tn),pt&&(Fn?Cn=!1:R.isValid&&(Cn=await ae(a,!0)));pt&&(ft._f.deps&&Ee(ft._f.deps),Z(We,Cn,Fn,Qs))}},nt=(we,De)=>{if(Jt(s.errors,De)&&we.focus)return we.focus(),1},Ee=async(we,De={})=>{let We,pt;const ft=RM(we);if(t.resolver){const dt=await ie(bs(we)?we:ft);We=il(dt),pt=we?!ft.some(Mt=>Jt(dt,Mt)):We}else we?(pt=(await Promise.all(ft.map(async dt=>{const Mt=Jt(a,dt);return await ae(Mt&&Mt._f?{[dt]:Mt}:Mt)}))).every(Boolean),!(!pt&&!s.isValid)&&H()):pt=We=await ae(a);return O.state.next({...!th(we)||R.isValid&&We!==s.isValid?{}:{name:we},...t.resolver||!we?{isValid:We}:{},errors:s.errors}),De.shouldFocus&&!pt&&Vb(a,nt,we?ft:E.mount),pt},Ye=we=>{const De={...l,...g.mount?d:{}};return bs(we)?De:th(we)?Jt(De,we):we.map(We=>Jt(De,We))},Et=(we,De)=>({invalid:!!Jt((De||s).errors,we),isDirty:!!Jt((De||s).dirtyFields,we),isTouched:!!Jt((De||s).touchedFields,we),isValidating:!!Jt((De||s).validatingFields,we),error:Jt((De||s).errors,we)}),ot=we=>{we&&RM(we).forEach(De=>$s(s.errors,De)),O.state.next({errors:we?s.errors:{}})},Ve=(we,De,We)=>{const pt=(Jt(a,we,{_f:{}})._f||{}).ref;Li(s.errors,we,{...De,ref:pt}),O.state.next({name:we,errors:s.errors,isValid:!1}),We&&We.shouldFocus&&pt&&pt.focus&&pt.focus()},et=(we,De)=>hm(we)?O.values.subscribe({next:We=>we(de(void 0,De),We)}):de(we,De,!0),gt=(we,De={})=>{for(const We of we?RM(we):E.mount)E.mount.delete(We),E.array.delete(We),De.keepValue||($s(a,We),$s(d,We)),!De.keepError&&$s(s.errors,We),!De.keepDirty&&$s(s.dirtyFields,We),!De.keepTouched&&$s(s.touchedFields,We),!De.keepIsValidating&&$s(s.validatingFields,We),!t.shouldUnregister&&!De.keepDefaultValue&&$s(l,We);O.values.next({values:{...d}}),O.state.next({...s,...De.keepDirty?{isDirty:pe()}:{}}),!De.keepIsValid&&H()},Dt=({disabled:we,name:De,field:We,fields:pt,value:ft})=>{if(_p(we)){const dt=we?void 0:bs(ft)?AM(We?We._f:Jt(pt,De)._f):ft;Li(d,De,dt),Se(De,dt,!1,!1,!0)}},Gt=(we,De={})=>{let We=Jt(a,we);const pt=_p(De.disabled);return Li(a,we,{...We||{},_f:{...We&&We._f?We._f:{ref:{name:we}},name:we,mount:!0,...De}}),E.mount.add(we),We?Dt({field:We,disabled:De.disabled,name:we,value:De.value}):ce(we,!0,De.value),{...pt?{disabled:De.disabled}:{},...t.progressive?{required:!!De.required,min:rb(De.min),max:rb(De.max),minLength:rb(De.minLength),maxLength:rb(De.maxLength),pattern:rb(De.pattern)}:{},name:we,onChange:Ke,onBlur:Ke,ref:ft=>{if(ft){Gt(we,De),We=Jt(a,we);const dt=bs(ft.value)&&ft.querySelectorAll&&ft.querySelectorAll("input,select,textarea")[0]||ft,Mt=wBe(dt),Fn=We._f.refs||[];if(Mt?Fn.find(Cn=>Cn===dt):dt===We._f.ref)return;Li(a,we,{_f:{...We._f,...Mt?{refs:[...Fn.filter(IM),dt,...Array.isArray(Jt(l,we))?[{}]:[]],ref:{type:dt.type,name:we}}:{ref:dt}}}),ce(we,!1,void 0,dt)}else We=Jt(a,we,{}),We._f&&(We._f.mount=!1),(t.shouldUnregister||De.shouldUnregister)&&!(fBe(E.array,we)&&g.action)&&E.unMount.add(we)}}},Bt=()=>t.shouldFocusError&&Vb(a,nt,E.mount),Vn=we=>{_p(we)&&(O.state.next({disabled:we}),Vb(a,(De,We)=>{let pt=we;const ft=Jt(a,We);ft&&_p(ft._f.disabled)&&(pt||(pt=ft._f.disabled)),De.disabled=pt},0,!1))},Dn=(we,De)=>async We=>{let pt;We&&(We.preventDefault&&We.preventDefault(),We.persist&&We.persist());let ft=Kl(d);if(O.state.next({isSubmitting:!0}),t.resolver){const{errors:dt,values:Mt}=await te();s.errors=dt,ft=Mt}else await ae(a);if($s(s.errors,"root"),il(s.errors)){O.state.next({errors:{}});try{await we(ft,We)}catch(dt){pt=dt}}else De&&await De({...s.errors},We),Bt(),setTimeout(Bt);if(O.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:il(s.errors)&&!pt,submitCount:s.submitCount+1,errors:s.errors}),pt)throw pt},un=(we,De={})=>{Jt(a,we)&&(bs(De.defaultValue)?Be(we,Kl(Jt(l,we))):(Be(we,De.defaultValue),Li(l,we,Kl(De.defaultValue))),De.keepTouched||$s(s.touchedFields,we),De.keepDirty||($s(s.dirtyFields,we),s.isDirty=De.defaultValue?pe(we,Kl(Jt(l,we))):pe()),De.keepError||($s(s.errors,we),R.isValid&&H()),O.state.next({...s}))},gr=(we,De={})=>{const We=we?Kl(we):l,pt=Kl(We),ft=il(we),dt=ft?l:pt;if(De.keepDefaultValues||(l=We),!De.keepValues){if(De.keepDirtyValues)for(const Mt of E.mount)Jt(s.dirtyFields,Mt)?Li(dt,Mt,Jt(d,Mt)):Be(Mt,Jt(dt,Mt));else{if(gF&&bs(we))for(const Mt of E.mount){const Fn=Jt(a,Mt);if(Fn&&Fn._f){const Cn=Array.isArray(Fn._f.refs)?Fn._f.refs[0]:Fn._f.ref;if(NP(Cn)){const tn=Cn.closest("form");if(tn){tn.reset();break}}}}a={}}d=r.shouldUnregister?De.keepDefaultValues?Kl(l):{}:Kl(dt),O.array.next({values:{...dt}}),O.values.next({values:{...dt}})}E={mount:De.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},g.mount=!R.isValid||!!De.keepIsValid||!!De.keepDirtyValues,g.watch=!!r.shouldUnregister,O.state.next({submitCount:De.keepSubmitCount?s.submitCount:0,isDirty:ft?!1:De.keepDirty?s.isDirty:!!(De.keepDefaultValues&&!C_(we,l)),isSubmitted:De.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:ft?[]:De.keepDirtyValues?De.keepDefaultValues&&d?mO(l,d):s.dirtyFields:De.keepDefaultValues&&we?mO(l,we):{},touchedFields:De.keepTouched?s.touchedFields:{},errors:De.keepErrors?s.errors:{},isSubmitSuccessful:De.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},Ar=(we,De)=>gr(hm(we)?we(d):we,De);return{control:{register:Gt,unregister:gt,getFieldState:Et,handleSubmit:Dn,setError:Ve,_executeSchema:te,_getWatch:de,_getDirty:pe,_updateValid:H,_removeUnmounted:ve,_updateFieldArray:J,_updateDisabledField:Dt,_getFieldArray:ut,_reset:gr,_resetDefaultValues:()=>hm(t.defaultValues)&&t.defaultValues().then(we=>{Ar(we,t.resetOptions),O.state.next({isLoading:!1})}),_updateFormState:we=>{s={...s,...we}},_disableForm:Vn,_subjects:O,_proxyFormState:R,_setErrors:le,get _fields(){return a},get _formValues(){return d},get _state(){return g},set _state(we){g=we},get _defaultValues(){return l},get _names(){return E},set _names(we){E=we},get _formState(){return s},set _formState(we){s=we},get _options(){return t},set _options(we){t={...t,...we}}},trigger:Ee,register:Gt,handleSubmit:Dn,watch:et,setValue:Be,getValues:Ye,reset:Ar,resetField:un,clearErrors:ot,unregister:gt,setError:Ve,setFocus:(we,De={})=>{const We=Jt(a,we),pt=We&&We._f;if(pt){const ft=pt.refs?pt.refs[0]:pt.ref;ft.focus&&(ft.focus(),De.shouldSelect&&ft.select())}},getFieldState:Et}}function Pne(r={}){const t=Bi.useRef(),s=Bi.useRef(),[a,l]=Bi.useState({isDirty:!1,isValidating:!1,isLoading:hm(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,defaultValues:hm(r.defaultValues)?void 0:r.defaultValues});t.current||(t.current={...PBe(r),formState:a});const d=t.current.control;return d._options=r,vBe({subject:d._subjects.state,next:g=>{_Be(g,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),Bi.useEffect(()=>d._disableForm(r.disabled),[d,r.disabled]),Bi.useEffect(()=>{if(d._proxyFormState.isDirty){const g=d._getDirty();g!==a.isDirty&&d._subjects.state.next({isDirty:g})}},[d,a.isDirty]),Bi.useEffect(()=>{r.values&&!C_(r.values,s.current)?(d._reset(r.values,d._options.resetOptions),s.current=r.values,l(g=>({...g}))):d._resetDefaultValues()},[r.values,d]),Bi.useEffect(()=>{r.errors&&d._setErrors(r.errors)},[r.errors,d]),Bi.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),Bi.useEffect(()=>{r.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[r.shouldUnregister,d]),t.current.formState=gBe(a,d),t.current}const Nne=r=>{B.useEffect(()=>{if(!window.unityInstance)return;const t=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),It.log("Unity input disabled")}catch(a){It.error("Failed to disable Unity input:",a)}},s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),It.log("Unity input enabled")}catch(a){It.error("Failed to enable Unity input:",a)}};return r?t():s(),()=>{r&&s()}},[r])};function yF({mode:r,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:g,formState:{errors:E}}=Pne(),{register:S}=B.useContext(tu),b=Iw(),{fullscreenRef:R}=Hp(),[O,N]=B.useState(!1),[U,K]=B.useState(!1),z=a!==void 0?a:O,H=l||(()=>N(!1));Nne(z);const ne=async le=>{const{email:ce,password:Se,confirmPassword:Z,...te}=le;if(Se!==Z){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}K(!0);try{await S(ce,Se,te),It.log("User: Registration process complete."),H(),b({title:"Registration Successful",description:"Your account has been created.",status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(ie){It.error("User: Registration Error:",ie),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{K(!1)}},J=()=>{l?l():N(!O)},se=r==="link"?F.jsx(hh,{variant:"header",onClick:J,children:t}):F.jsx(Tm,{onClick:J,...s,children:t});return F.jsxs(F.Fragment,{children:[!a&&se,F.jsxs(jp,{isOpen:z,onClose:H,size:"md",portalProps:{containerRef:R},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[F.jsx(Wp,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),F.jsxs(Bp,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:le=>{le.stopPropagation()},children:[F.jsxs(Nm,{p:8,textAlign:"center",children:[F.jsx(pV,{size:"lg",mb:2,children:"Create Account"}),F.jsx(ir,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),F.jsx(zp,{color:"gray.400"}),F.jsx(Gp,{px:8,children:F.jsx("form",{onSubmit:g(ne),children:F.jsxs(Wa,{spacing:4,children:[F.jsxs(jo,{isInvalid:E.companyName,isRequired:!0,children:[F.jsx(Yl,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),F.jsx(gp,{children:E.companyName&&E.companyName.message})]}),F.jsxs(hP,{gap:4,w:"100%",children:[F.jsxs(jo,{isInvalid:E.firstName,isRequired:!0,children:[F.jsx(Yl,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),F.jsx(gp,{children:E.firstName&&E.firstName.message})]}),F.jsxs(jo,{isInvalid:E.lastName,isRequired:!0,children:[F.jsx(Yl,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),F.jsx(gp,{children:E.lastName&&E.lastName.message})]})]}),F.jsxs(jo,{isInvalid:E.email,isRequired:!0,children:[F.jsx(Yl,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),F.jsx(gp,{children:E.email&&E.email.message})]}),F.jsxs(hP,{gap:4,w:"100%",children:[F.jsxs(jo,{isInvalid:E.password,isRequired:!0,children:[F.jsx(Yl,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),F.jsx(gp,{children:E.password&&E.password.message})]}),F.jsxs(jo,{isInvalid:E.confirmPassword,isRequired:!0,children:[F.jsx(Yl,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),F.jsx(gp,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),F.jsx(jo,{children:F.jsx(Yl,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),F.jsx(jo,{children:F.jsx(Yl,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),F.jsxs(rN,{px:8,pb:8,flexDirection:"column",gap:4,children:[F.jsx(Tm,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:g(ne),isLoading:U,loadingText:"Creating Account",children:"Create Account"}),F.jsxs(ir,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",F.jsx(hh,{color:"blue.400",onClick:H,children:"Sign In"})]})]})]})]})]})}yF.propTypes={mode:ai.oneOf(["button","link"]),label:ai.string,buttonProps:ai.object,isOpen:ai.bool,onClose:ai.func};var NBe=Rw({displayName:"QuestionOutlineIcon",path:F.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[F.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),F.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),F.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),kBe=Rw({displayName:"EmailIcon",path:F.jsxs("g",{fill:"currentColor",children:[F.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),F.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),DBe=Rw({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),LBe=Rw({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),xBe=Rw({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"});function SF({mode:r,label:t,buttonProps:s={}}){const{signIn:a}=B.useContext(tu),{fullscreenRef:l}=Hp(),d=Iw(),{register:g,handleSubmit:E,formState:{errors:S,isSubmitting:b}}=Pne({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[R,O]=B.useState(!1),[N,U]=B.useState(!1);Nne(R);const K=async J=>{try{await a(J.email,J.password),It.log("User: Sign-in process complete."),O(!1),window.location.reload()}catch(se){It.error("User: SignIn Error:",se),d({title:"Error",description:"An error occurred while logging in. Please check your credentials.",status:"error",duration:1e4,isClosable:!0,position:"top",container:l.current})}},z=()=>O(J=>!J),H=()=>{O(!1),U(!0)},ne=r==="link"?F.jsx(hh,{variant:"header",onClick:z,children:t}):F.jsx(Tm,{onClick:z,...s,children:t});return F.jsxs(F.Fragment,{children:[ne,F.jsxs(jp,{isOpen:R,onClose:z,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[F.jsx(Wp,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),F.jsx("form",{onSubmit:E(K),children:F.jsxs(Bp,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:J=>{J.stopPropagation()},children:[F.jsxs(Nm,{p:8,textAlign:"center",children:[F.jsx(pV,{size:"lg",mb:2,children:"Welcome Back"}),F.jsx(ir,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),F.jsx(zp,{color:"gray.400"}),F.jsx(Gp,{px:8,pb:8,children:F.jsxs(Wa,{spacing:4,children:[F.jsxs(jo,{isInvalid:S.email,children:[F.jsxs(g2,{children:[F.jsx(dP,{pointerEvents:"none",children:F.jsx(kBe,{color:"gray.500"})}),F.jsx(Yl,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...g("email",{required:"Email is required."})})]}),F.jsx(gp,{children:S.email&&S.email.message})]}),F.jsxs(jo,{isInvalid:S.password,children:[F.jsxs(g2,{children:[F.jsx(dP,{pointerEvents:"none",children:F.jsx(LBe,{color:"gray.500"})}),F.jsx(Yl,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...g("password",{required:"Password is required."})})]}),F.jsx(gp,{children:S.password&&S.password.message})]})]})}),F.jsxs(rN,{px:8,pb:8,flexDirection:"column",gap:4,children:[F.jsx(Tm,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:b,loadingText:"Signing In",children:"Sign In"}),F.jsxs(ir,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",F.jsx(hh,{color:"blue.400",onClick:H,children:"Sign Up"})]})]})]})})]}),F.jsx(yF,{mode:"link",isOpen:N,onClose:()=>U(!1)})]})}SF.propTypes={mode:ai.oneOf(["button","link"]),label:ai.string,buttonProps:ai.object};SF.defaultProps={mode:"button",label:"Sign In"};function MBe(){const{loadingProgression:r,isLoaded:t,error:s}=yS(),{user:a}=B.useContext(tu),[l,d]=B.useState(!1),[g,E]=B.useState(!1);return B.useEffect(()=>{d(!a&&r===0)},[a,r]),F.jsx(F.Fragment,{children:l?F.jsx(Nn,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:F.jsxs(Wa,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[F.jsx(ir,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),F.jsx(ir,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),F.jsx(Tm,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):F.jsx(Nn,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 3s ease-in-out",opacity:t?0:1,children:F.jsxs(hP,{flexDirection:"column",alignItems:"center",padding:4,marginY:4,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",zIndex:"1",children:[F.jsx(ir,{fontWeight:"bold",children:"Entering The Disruptive Spaces"}),F.jsxs(ir,{fontSize:"sm",children:[t?"World Initialising":"World loading","."]}),F.jsx(RV,{value:r*100,size:"lg",width:"100%",marginY:2})]})})})}function TF({mode:r,label:t}){const s=Iw(),{signOut:a}=B.useContext(tu),{fullscreenRef:l}=Hp(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},g=r==="link"?F.jsx(hh,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return F.jsx(F.Fragment,{children:g})}TF.propTypes={mode:ai.oneOf(["button","link"]),label:ai.string};TF.defaultProps={mode:"button",label:"Sign Out"};function UBe(){const{user:r}=B.useContext(tu);return F.jsx("div",{children:r!==null?F.jsx("div",{children:F.jsx(TF,{})}):F.jsxs("div",{children:[F.jsx(yF,{}),F.jsx(SF,{})]})})}function VBe(){const{fullscreenRef:r}=Hp(),[t,s]=B.useState(!1),a=()=>{s(!t)};return F.jsxs(F.Fragment,{children:[F.jsx(Dw,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:r},children:F.jsx(sl,{"aria-label":"Controller Help",icon:F.jsx(NBe,{}),onClick:a,variant:"iconButton"})}),F.jsxs(jp,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:r},children:[F.jsx(Wp,{}),F.jsxs(Bp,{children:[F.jsx(Nm,{children:"Notes"}),F.jsx(zp,{}),F.jsx(Gp,{children:F.jsx(ir,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),F.jsx(rN,{children:F.jsx(Tm,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var kne={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},_Y=Bi.createContext&&Bi.createContext(kne),vm=function(){return vm=Object.assign||function(r){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(r[l]=t[l])}return r},vm.apply(this,arguments)},FBe=function(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s};function Dne(r){return r&&r.map(function(t,s){return Bi.createElement(t.tag,vm({key:s},t.attr),Dne(t.child))})}function xm(r){return function(t){return Bi.createElement(jBe,vm({attr:vm({},r.attr)},t),Dne(r.child))}}function jBe(r){var t=function(s){var a=r.attr,l=r.size,d=r.title,g=FBe(r,["attr","size","title"]),E=l||s.size||"1em",S;return s.className&&(S=s.className),r.className&&(S=(S?S+" ":"")+r.className),Bi.createElement("svg",vm({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,g,{className:S,style:vm(vm({color:r.color||s.color},s.style),r.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&Bi.createElement("title",null,d),r.children)};return _Y!==void 0?Bi.createElement(_Y.Consumer,null,function(s){return t(s)}):t(kne)}function Lne(r){return xm({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(r)}function xne(r){return xm({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(r)}function eU(r){return xm({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(r)}function tU(r){return xm({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(r)}function BBe(r){return xm({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(r)}function WBe(r){return xm({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(r)}function Mne({open:r,onClose:t}){const s=B.useRef(null),a=ON(),{user:l}=B.useContext(tu),d=S=>{s.current&&!s.current.contains(S.target)&&t()},g=async S=>{const b=E(S);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const R=b.data.url;if(console.log(`Avatar URL: ${R}`),a("AvatarUrlFromReact",{url:R}),l&&l.uid)try{await nne(l.uid,R),t()}catch(O){console.error("Error updating RPM URL:",O)}else console.error("No authenticated user found to update rpmURL.")}},E=S=>{try{return JSON.parse(S.data)}catch{return null}};return B.useEffect(()=>(r&&(document.addEventListener("mousedown",d),window.addEventListener("message",g)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",g)}),[r]),r&&F.jsx(Ju,{children:F.jsx(Nn,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:S=>S.stopPropagation(),children:F.jsx(Nn,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:F.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function GBe({isOpen:r,onClose:t}){const[s,a]=B.useState(!1),[l,d]=B.useState(null),{user:g}=B.useContext(tu),E=ON(),S=K=>{K.stopPropagation(),a(!0)},b=()=>{a(!1),t()},R=async K=>{if(d(K),g&&g.uid)try{await nne(g.uid,K.url),E("AvatarUrlFromReact",{url:K.url}),t()}catch(z){console.error("Error updating RPM URL:",z)}else console.error("No authenticated user found to update rpmURL.")},O=kme("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",U=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return F.jsxs(F.Fragment,{children:[F.jsx(Ju,{children:F.jsxs(jp,{isOpen:r,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[F.jsx(Wp,{bg:"rgba(0, 0, 0, 0.7)"}),F.jsxs(Bp,{bg:"gray.800",color:"white",maxW:"900px",children:[F.jsx(Nm,{fontSize:"lg",children:"Customise Your Avatar"}),F.jsx(zp,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),F.jsx(Gp,{pb:4,children:F.jsxs(Wa,{spacing:4,align:"stretch",children:[F.jsx(ir,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),F.jsxs(zQ,{columns:5,spacing:2,children:[F.jsx(Nn,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:O,borderRadius:"lg",overflow:"hidden",onClick:S,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:F.jsxs(Wa,{spacing:1,children:[F.jsx(Om,{as:BBe,boxSize:4}),F.jsx(ir,{fontSize:"xs",children:"Create Custom Avatar"})]})}),U.map(K=>F.jsxs(Nn,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===K.id?"blue.400":O,borderRadius:"lg",overflow:"hidden",onClick:()=>R(K),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[F.jsx(YU,{src:K.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:K.name,width:"100%",height:"100%",objectFit:"cover"}),F.jsx(Nn,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:F.jsx(ir,{fontSize:"xs",children:K.name})})]},K.id))]})]})})]})]})}),s&&F.jsx(Mne,{open:s,onClose:b})]})}function zBe(){const{fullscreenRef:r}=Hp(),[t,s]=B.useState(!1),[a,l]=B.useState(!1),[d,g]=B.useState(!1),[E,S]=B.useState(!1),{user:b}=B.useContext(tu),[R,O]=B.useState(null),[N,U]=B.useState(!0),K=(J,se)=>!J||!se?"?":`${J.charAt(0)}${se.charAt(0)}`.toUpperCase(),z=async()=>{if(b!=null&&b.uid){U(!0);try{const J=await Im(b.uid);O({rpmURL:J.rpmURL?J.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:J.firstName,lastName:J.lastName})}catch(J){console.error("Error fetching profile data:",J)}finally{U(!1)}}};B.useEffect(()=>{z()},[b==null?void 0:b.uid]),B.useEffect(()=>{const J=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",J),()=>{window.removeEventListener("PlayerInstantiated",J)}},[]);const H=()=>l(!a),ne=()=>{l(!1),z()};return t?F.jsxs(F.Fragment,{children:[F.jsx(Dw,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:r},children:F.jsxs(Nn,{position:"relative",onMouseEnter:()=>{g(!0),S(!0)},onMouseLeave:()=>{g(!1),S(!1)},cursor:"pointer",onClick:H,children:[F.jsx(F_,{src:N||R==null?void 0:R.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?K(R==null?void 0:R.firstName,R==null?void 0:R.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&F.jsx(Nn,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:F.jsx(ir,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),F.jsx(GBe,{isOpen:a,onClose:ne})]}):null}function HBe(r){return xm({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(r)}function KBe(r){return xm({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(r)}function $Be(){const{isFullscreen:r,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=Hp(),l=Iw();B.useEffect(()=>{const g=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",g),document.addEventListener("webkitfullscreenerror",g),document.addEventListener("mozfullscreenerror",g),document.addEventListener("MSFullscreenError",g),()=>{document.removeEventListener("fullscreenerror",g),document.removeEventListener("webkitfullscreenerror",g),document.removeEventListener("mozfullscreenerror",g),document.removeEventListener("MSFullscreenError",g)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!r&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return F.jsx(Dw,{label:r?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:F.jsx(sl,{"aria-label":r?"Exit Fullscreen":"Enter Fullscreen",icon:r?F.jsx(HBe,{}):F.jsx(KBe,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const qBe=()=>(lBe(),null),vY={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function YBe(){const{isOpen:r,onOpen:t,onClose:s}=DPe(),{fullscreenRef:a}=Hp(),[l,d]=aBe(!1);B.useEffect(()=>{It.log("VideoPlayer: Current video URL:",l),l&&(It.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const g=()=>{It.log("VideoPlayer: Closing modal"),d(),s()};return F.jsx(Ju,{containerRef:a,children:F.jsxs(jp,{isOpen:r,onClose:g,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[F.jsx(Wp,{bg:"rgba(0, 0, 0, 0.8)"}),F.jsxs(Bp,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[F.jsx(zp,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),F.jsx(Gp,{p:0,width:"100%",children:l&&F.jsx(Nn,{style:vY.iframeContainer,children:F.jsx("iframe",{src:l,style:vY.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function XBe({isOpen:r,onClose:t,playerName:s,playerId:a,uid:l}){const[d,g]=B.useState(null),[E,S]=B.useState(!0),[b,R]=B.useState(null);return B.useEffect(()=>{r&&(async()=>{if(S(!0),R(null),!l){It.warn("NameplateModal: No UID provided for player:",s),R("No user ID available for this player"),S(!1);return}try{It.log("NameplateModal: Fetching profile for UID:",l);const N=await Im(l);N?g({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):R("Could not find profile data for this player")}catch(N){It.error("Error fetching profile data:",N),R("Error loading profile data")}finally{S(!1)}})()},[l,r,s]),F.jsxs(jp,{isOpen:r,onClose:t,isCentered:!0,size:"md",children:[F.jsx(Wp,{backdropFilter:"blur(10px)"}),F.jsxs(Bp,{bg:"gray.900",color:"white",borderRadius:"xl",children:[F.jsx(Nm,{children:"Player Info"}),F.jsx(zp,{}),F.jsx(Gp,{pb:6,children:E?F.jsx(YQ,{py:8,children:F.jsx(Cw,{size:"xl",color:"blue.400"})}):b?F.jsxs(QP,{status:"warning",variant:"solid",borderRadius:"md",children:[F.jsx(JP,{}),b]}):F.jsxs(Wa,{spacing:4,align:"center",children:[F.jsx(F_,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),F.jsxs(Wa,{spacing:1,children:[F.jsx(ir,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&F.jsxs(ir,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),F.jsxs(ir,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&F.jsxs(F.Fragment,{children:[F.jsx(fV,{borderColor:"whiteAlpha.300"}),F.jsxs(Xy,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&F.jsx(hh,{href:d.linkedinUrl,isExternal:!0,children:F.jsx(sl,{icon:F.jsx(Lne,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&F.jsx(hh,{href:d.websiteUrl,isExternal:!0,children:F.jsx(sl,{icon:F.jsx(xne,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const JBe=({isVisible:r,onToggleVisibility:t})=>{const s=Sne(),[a,l]=B.useState(!1),[d,g]=B.useState([]),[E,S]=B.useState(!1),[b,R]=B.useState({}),[O,N]=B.useState({}),U=window.currentUser||{};B.useEffect(()=>{const se={};s.forEach(le=>{if(le.uid){if(le.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)se[le.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ce=window.agoraClient.client.remoteUsers,Se=ce.find(Z=>String(Z.uid)===String(le.uid));if(Se)se[le.uid]=Se.uid;else{const Z=ce.find(te=>typeof te.uid=="string"&&te.uid.includes(le.uid));if(Z)se[le.uid]=Z.uid;else{const te=ce.find(ie=>typeof le.uid=="string"&&le.uid.includes(String(ie.uid)));if(te)se[le.uid]=te.uid;else{const ie=ce.filter(ae=>!(typeof ae.uid=="string"&&ae.uid.startsWith("screen-")));ie.length===1&&!le.isLocalPlayer&&(console.log(`Special case: Mapping player ${le.playerName} (${le.uid}) to the only remote user: ${ie[0].uid}`),se[le.uid]=ie[0].uid)}}}}}}),N(se)},[s]);const K=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const se=window.agoraClient.isVoiceEnabled;se!==E&&(console.log("UnityPlayerList: Updating mic state from window.agoraClient:",se),S(se))}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const se=window.agoraClient.client.remoteUsers,le={};se.forEach(ce=>{typeof ce.uid=="string"&&ce.uid.startsWith("screen-")||(le[ce.uid]=!!ce.audioTrack&&!ce.audioTrack.muted)}),JSON.stringify(le)!==JSON.stringify(b)&&(console.log("UnityPlayerList: Updating active mics:",le),R(le))}};B.useEffect(()=>{const se=setInterval(K,500),le=ce=>{console.log("UnityPlayerList: Voice toggle event received:",ce.detail),ce.detail&&typeof ce.detail.enabled=="boolean"&&S(ce.detail.enabled)};return window.addEventListener("VoiceToggled",le),K(),()=>{clearInterval(se),window.removeEventListener("VoiceToggled",le)}},[]),B.useEffect(()=>{const se=()=>{It.log("UnityPlayerList: Player instantiated, showing list"),l(!0)};return window.addEventListener("PlayerInstantiated",se),window.isPlayerInstantiated&&(It.log("UnityPlayerList: Player was already instantiated"),l(!0)),()=>{window.removeEventListener("PlayerInstantiated",se)}},[]),B.useEffect(()=>{(async()=>{const le=await Promise.all(s.map(async ce=>{if(ce.uid)try{const Se=await Im(ce.uid);return{...ce,firstName:Se.firstName,lastName:Se.lastName,linkedInProfile:Se.linkedInProfile,websiteUrl:Se.websiteUrl,rpmURL:Se.rpmURL?Se.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}}catch(Se){return It.error(`Error fetching data for player ${ce.playerName}:`,Se),ce}return ce}));g(le)})()},[s]);const z=[...d].sort((se,le)=>se.isLocalPlayer?-1:le.isLocalPlayer?1:0),H=()=>{It.log("UnityPlayerList: Toggling visibility"),t&&t()},ne=se=>!!(se.isLocalPlayer||U&&U.uid&&se.uid===U.uid),J=se=>{try{if(ne(se))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:E;if(se.uid){if(b[se.uid])return!0;const le=O[se.uid];if(le&&b[le])return!0;const ce=parseInt(se.uid);if(!isNaN(ce)&&b[ce])return!0}return!1}catch(le){return console.error("Error in hasActiveMic:",le),!1}};return F.jsxs(Nn,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:a&&r?"visible":"hidden",role:"group",children:[F.jsx(Nn,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:F.jsx(sl,{icon:F.jsx(xBe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:H,_hover:{opacity:.8}})}),F.jsxs(ir,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",s.length]}),F.jsx(Nn,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:F.jsx(Wa,{align:"stretch",spacing:1,width:"100%",children:z.map((se,le)=>{const ce=ne(se),Se=J(se);return F.jsx(Nn,{children:F.jsxs(bZ,{placement:"left",trigger:"hover",children:[F.jsx(TZ,{children:F.jsxs(Xy,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[F.jsx(F_,{size:"xs",src:se.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),F.jsx(ir,{fontSize:"xs",children:se.playerName}),F.jsx(HQ,{}),Se?F.jsx(Nn,{color:"green.400",children:F.jsx(tU,{})}):F.jsx(Nn,{color:"red.400",children:F.jsx(eU,{})}),ce&&F.jsx(ir,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),F.jsx(CZ,{bg:"rgba(0,0,0,0.4)",border:"none",boxShadow:"lg",color:"white",p:3,width:"auto",minWidth:"200px",ml:"-20px",position:"absolute",left:"-220px",top:"-100px",transform:"none !important",children:F.jsx(wZ,{children:F.jsxs(Wa,{align:"center",spacing:2,children:[F.jsx(F_,{size:"lg",src:se.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),F.jsx(ir,{fontSize:"lg",fontWeight:"bold",children:se.playerName}),se.firstName&&F.jsxs(ir,{fontSize:"sm",color:"gray.300",children:[se.firstName," ",se.lastName]}),F.jsxs(Xy,{spacing:4,pt:2,children:[se.linkedInProfile&&F.jsx(hh,{href:se.linkedInProfile,isExternal:!0,children:F.jsx(sl,{icon:F.jsx(Lne,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),se.websiteUrl&&F.jsx(hh,{href:se.websiteUrl,isExternal:!0,children:F.jsx(sl,{icon:F.jsx(xne,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),F.jsx(sl,{icon:Se?F.jsx(tU,{}):F.jsx(eU,{}),variant:"ghost",colorScheme:Se?"green":"red",size:"sm","aria-label":"Microphone status",isDisabled:!0})]})]})})})]})},le)})})})]})};var YO={exports:{}},QBe=YO.exports,EY;function ZBe(){return EY||(EY=1,function(r,t){(function(s,a){r.exports=a()})(QBe,function(){function s(e,n){return n.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof T_<"u"?T_:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},g=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=g,S=Function.prototype,b=S.call,R=E&&S.bind.bind(b,b),O=E?R:function(e){return function(){return b.apply(e,arguments)}},N=O({}.isPrototypeOf),U=function(e){return e&&e.Math==Math&&e},K=U(typeof globalThis=="object"&&globalThis)||U(typeof window=="object"&&window)||U(typeof self=="object"&&self)||U(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),z=g,H=Function.prototype,ne=H.apply,J=H.call,se=typeof Reflect=="object"&&Reflect.apply||(z?J.bind(ne):function(){return J.apply(ne,arguments)}),le=O,ce=le({}.toString),Se=le("".slice),Z=function(e){return Se(ce(e),8,-1)},te=Z,ie=O,ae=function(e){if(te(e)==="Function")return ie(e)},ve=typeof document=="object"&&document.all,pe={all:ve,IS_HTMLDDA:ve===void 0&&ve!==void 0},de=pe.all,ut=pe.IS_HTMLDDA?function(e){return typeof e=="function"||e===de}:function(e){return typeof e=="function"},mt={},Ze=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Be=g,Ke=Function.prototype.call,nt=Be?Ke.bind(Ke):function(){return Ke.apply(Ke,arguments)},Ee={},Ye={}.propertyIsEnumerable,Et=Object.getOwnPropertyDescriptor,ot=Et&&!Ye.call({1:2},1);Ee.f=ot?function(e){var n=Et(this,e);return!!n&&n.enumerable}:Ye;var Ve,et,gt=function(e,n){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:n}},Dt=d,Gt=Z,Bt=Object,Vn=O("".split),Dn=Dt(function(){return!Bt("z").propertyIsEnumerable(0)})?function(e){return Gt(e)=="String"?Vn(e,""):Bt(e)}:Bt,un=function(e){return e==null},gr=un,Ar=TypeError,bt=function(e){if(gr(e))throw Ar("Can't call method on "+e);return e},Sn=Dn,Tn=bt,we=function(e){return Sn(Tn(e))},De=ut,We=pe.all,pt=pe.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:De(e)||e===We}:function(e){return typeof e=="object"?e!==null:De(e)},ft={},dt=ft,Mt=K,Fn=ut,Cn=function(e){return Fn(e)?e:void 0},tn=function(e,n){return arguments.length<2?Cn(dt[e])||Cn(Mt[e]):dt[e]&&dt[e][n]||Mt[e]&&Mt[e][n]},_r=typeof navigator<"u"&&String(navigator.userAgent)||"",ya=K,ps=_r,Qs=ya.process,Lt=ya.Deno,dn=Qs&&Qs.versions||Lt&&Lt.version,Zs=dn&&dn.v8;Zs&&(et=(Ve=Zs.split("."))[0]>0&&Ve[0]<4?1:+(Ve[0]+Ve[1])),!et&&ps&&(!(Ve=ps.match(/Edge\/(\d+)/))||Ve[1]>=74)&&(Ve=ps.match(/Chrome\/(\d+)/))&&(et=+Ve[1]);var sr=et,zi=sr,Nc=d,Ga=K.String,fo=!!Object.getOwnPropertySymbols&&!Nc(function(){var e=Symbol();return!Ga(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&zi&&zi<41}),za=fo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",xi=tn,Cs=ut,Ko=N,Ha=Object,kc=za?function(e){return typeof e=="symbol"}:function(e){var n=xi("Symbol");return Cs(n)&&Ko(n.prototype,Ha(e))},nu=String,Ka=function(e){try{return nu(e)}catch{return"Object"}},Dc=ut,mo=Ka,wi=TypeError,ts=function(e){if(Dc(e))return e;throw wi(mo(e)+" is not a function")},Sa=ts,ru=un,$a=function(e,n){var i=e[n];return ru(i)?void 0:Sa(i)},$o=nt,qo=ut,Zu=pt,Mm=TypeError,iu={exports:{}},vh=K,Is=Object.defineProperty,su=function(e,n){try{Is(vh,e,{value:n,configurable:!0,writable:!0})}catch{vh[e]=n}return n},Yo="__core-js_shared__",ed=K[Yo]||su(Yo,{}),td=ed;(iu.exports=function(e,n){return td[e]||(td[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ta=iu.exports,nd=bt,ou=Object,go=function(e){return ou(nd(e))},rd=go,Mr=O({}.hasOwnProperty),li=Object.hasOwn||function(e,n){return Mr(rd(e),n)},qa=O,Lc=0,Xo=Math.random(),Eh=qa(1 .toString),id=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Eh(++Lc+Xo,36)},hl=Ta,eo=li,Kp=id,Us=fo,yh=za,xc=K.Symbol,sd=hl("wks"),od=yh?xc.for||xc:xc&&xc.withoutSetter||Kp,or=function(e){return eo(sd,e)||(sd[e]=Us&&eo(xc,e)?xc[e]:od("Symbol."+e)),sd[e]},pl=nt,fl=pt,au=kc,ba=$a,_o=function(e,n){var i,o;if(qo(i=e.toString)&&!Zu(o=$o(i,e))||qo(i=e.valueOf)&&!Zu(o=$o(i,e)))return o;throw Mm("Can't convert object to primitive value")},cu=TypeError,Mc=or("toPrimitive"),ml=function(e,n){if(!fl(e)||au(e))return e;var i,o=ba(e,Mc);if(o){if(i=pl(o,e,n),!fl(i)||au(i))return i;throw cu("Can't convert object to primitive value")}return _o(e)},Br=kc,wa=function(e){var n=ml(e,"string");return Br(n)?n:n+""},Xn=pt,Ya=K.document,$p=Xn(Ya)&&Xn(Ya.createElement),gl=function(e){return $p?Ya.createElement(e):{}},ad=gl,Sh=!Ze&&!d(function(){return Object.defineProperty(ad("div"),"a",{get:function(){return 7}}).a!=7}),qp=Ze,Th=nt,vo=Ee,Hi=gt,Eo=we,yo=wa,_l=li,So=Sh,To=Object.getOwnPropertyDescriptor;mt.f=qp?To:function(e,n){if(e=Eo(e),n=yo(n),So)try{return To(e,n)}catch{}if(_l(e,n))return Hi(!Th(vo.f,e,n),e[n])};var Yp=d,Xa=ut,ns=/#|\.prototype\./,lu=function(e,n){var i=Uc[bh(e)];return i==Xp||i!=vl&&(Xa(n)?Yp(n):!!n)},bh=lu.normalize=function(e){return String(e).replace(ns,".").toLowerCase()},Uc=lu.data={},vl=lu.NATIVE="N",Xp=lu.POLYFILL="P",Jo=lu,Qo=ts,Vc=g,_e=ae(ae.bind),Ce=function(e,n){return Qo(e),n===void 0?e:Vc?_e(e,n):function(){return e.apply(n,arguments)}},Ge={},jt=Ze&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Bn=pt,hr=String,Ur=TypeError,Xt=function(e){if(Bn(e))return e;throw Ur(hr(e)+" is not an object")},Or=Ze,ui=Sh,fs=jt,bo=Xt,wo=wa,uu=TypeError,Mi=Object.defineProperty,Fc=Object.getOwnPropertyDescriptor,cd="enumerable",Ja="configurable",Um="writable";Ge.f=Or?fs?function(e,n,i){if(bo(e),n=wo(n),bo(i),typeof e=="function"&&n==="prototype"&&"value"in i&&Um in i&&!i[Um]){var o=Fc(e,n);o&&o[Um]&&(e[n]=i.value,i={configurable:Ja in i?i[Ja]:o[Ja],enumerable:cd in i?i[cd]:o[cd],writable:!1})}return Mi(e,n,i)}:Mi:function(e,n,i){if(bo(e),n=wo(n),bo(i),ui)try{return Mi(e,n,i)}catch{}if("get"in i||"set"in i)throw uu("Accessors not supported");return"value"in i&&(e[n]=i.value),e};var Jp=Ge,du=gt,Ro=Ze?function(e,n,i){return Jp.f(e,n,du(1,i))}:function(e,n,i){return e[n]=i,e},El=K,Qp=se,Vm=ae,nv=ut,Zp=mt.f,ef=Jo,hu=ft,pu=Ce,fu=Ro,Fm=li,rv=function(e){var n=function(i,o,c){if(this instanceof n){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return Qp(e,this,arguments)};return n.prototype=e.prototype,n},In=function(e,n){var i,o,c,u,h,f,_,v,y,w=e.target,I=e.global,P=e.stat,j=e.proto,x=I?El:P?El[w]:(El[w]||{}).prototype,M=I?hu:hu[w]||fu(hu,w,{})[w],$=M.prototype;for(u in n)o=!(i=ef(I?u:w+(P?".":"#")+u,e.forced))&&x&&Fm(x,u),f=M[u],o&&(_=e.dontCallGetSet?(y=Zp(x,u))&&y.value:x[u]),h=o&&_?_:n[u],o&&typeof f==typeof h||(v=e.bind&&o?pu(h,El):e.wrap&&o?rv(h):j&&nv(h)?Vm(h):h,(e.sham||h&&h.sham||f&&f.sham)&&fu(v,"sham",!0),fu(M,u,v),j&&(Fm(hu,c=w+"Prototype")||fu(hu,c,{}),fu(hu[c],u,h),e.real&&$&&(i||!$[u])&&fu($,u,h)))},tf=Math.ceil,Co=Math.floor,iv=Math.trunc||function(e){var n=+e;return(n>0?Co:tf)(n)},sv=iv,Qa=function(e){var n=+e;return n!=n||n===0?0:sv(n)},C=Qa,V=Math.max,X=Math.min,he=function(e,n){var i=C(e);return i<0?V(i+n,0):X(i,n)},xe=Qa,qe=Math.min,At=function(e){return e>0?qe(xe(e),9007199254740991):0},Wr=At,ei=function(e){return Wr(e.length)},pr=we,As=he,rs=ei,Ra=function(e){return function(n,i,o){var c,u=pr(n),h=rs(u),f=As(o,h);if(e&&i!=i){for(;h>f;)if((c=u[f++])!=c)return!0}else for(;h>f;f++)if((e||f in u)&&u[f]===i)return e||f||0;return!e&&-1}},Io={includes:Ra(!0),indexOf:Ra(!1)},wh=Io.includes;In({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return wh(this,e,arguments.length>1?arguments[1]:void 0)}});var nf=ft,Ca=function(e){return nf[e+"Prototype"]},Xw=Ca("Array").includes,Jw=pt,rf=Z,PN=or("match"),Qw=function(e){var n;return Jw(e)&&((n=e[PN])!==void 0?!!n:rf(e)=="RegExp")},NN=Qw,Zw=TypeError,SS={};SS[or("toStringTag")]="z";var Rh=String(SS)==="[object z]",jm=Rh,kN=ut,Ch=Z,DN=or("toStringTag"),eR=Object,TS=Ch(function(){return arguments}())=="Arguments",Za=jm?Ch:function(e){var n,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(n=eR(e),DN))=="string"?i:TS?Ch(n):(o=Ch(n))=="Object"&&kN(n.callee)?"Arguments":o},tR=Za,nR=String,Zo=function(e){if(tR(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return nR(e)},LN=or("match"),xN=In,MN=function(e){if(NN(e))throw Zw("The method doesn't accept regular expressions");return e},UN=bt,rR=Zo,jc=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[LN]=!1,"/./"[e](n)}catch{}}return!1},Bm=O("".indexOf);xN({target:"String",proto:!0,forced:!jc("includes")},{includes:function(e){return!!~Bm(rR(UN(this)),rR(MN(e)),arguments.length>1?arguments[1]:void 0)}});var iR=Ca("String").includes,bS=N,sR=Xw,oR=iR,Wm=Array.prototype,wS=String.prototype,VN=function(e){var n=e.includes;return e===Wm||bS(Wm,e)&&n===Wm.includes?sR:typeof e=="string"||e===wS||bS(wS,e)&&n===wS.includes?oR:n},$e=l(VN),RS=ts,Gm=go,CS=Dn,aR=ei,ov=TypeError,sf=function(e){return function(n,i,o,c){RS(i);var u=Gm(n),h=CS(u),f=aR(u),_=e?f-1:0,v=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=v;break}if(_+=v,e?_<0:f<=_)throw ov("Reduce of empty array with no initial value")}for(;e?_>=0:f>_;_+=v)_ in h&&(c=i(c,h[_],_,u));return c}},IS={left:sf(!1)},cR=d,Ih=function(e,n){var i=[][e];return!!i&&cR(function(){i.call(null,n||function(){return 1},1)})},Ah=typeof process<"u"&&Z(process)=="process",lR=IS.left;In({target:"Array",proto:!0,forced:!Ah&&sr>79&&sr<83||!Ih("reduce")},{reduce:function(e){var n=arguments.length;return lR(this,e,n,n>1?arguments[1]:void 0)}});var uR=Ca("Array").reduce,dR=N,hR=uR,av=Array.prototype,ld=function(e){var n=e.reduce;return e===av||dR(av,e)&&n===av.reduce?hR:n},cv=ld,Ia=l(cv),FN=Z,zm=Array.isArray||function(e){return FN(e)=="Array"},Hm=In,jN=zm,pR=O([].reverse),AS=[1,2];Hm({target:"Array",proto:!0,forced:String(AS)===String(AS.reverse())},{reverse:function(){return jN(this)&&(this.length=this.length),pR(this)}});var _i=Ca("Array").reverse,OS=N,lv=_i,Oh=Array.prototype,fR=function(e){var n=e.reverse;return e===Oh||OS(Oh,e)&&n===Oh.reverse?lv:n},uv=fR,of=l(uv),dv=id,Ph=Ta("keys"),Km=function(e){return Ph[e]||(Ph[e]=dv(e))},BN=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),WN=li,mR=ut,hv=go,pv=BN,fv=Km("IE_PROTO"),$m=Object,PS=$m.prototype,qm=pv?$m.getPrototypeOf:function(e){var n=hv(e);if(WN(n,fv))return n[fv];var i=n.constructor;return mR(i)&&n instanceof i?i.prototype:n instanceof $m?PS:null},GN=O,gR=ts,zN=ut,HN=String,NS=TypeError,ud=function(e,n,i){try{return GN(gR(Object.getOwnPropertyDescriptor(e,n)[i]))}catch{}},_R=Xt,af=function(e){if(typeof e=="object"||zN(e))return e;throw NS("Can't set "+HN(e)+" as a prototype")},yl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,n=!1,i={};try{(e=ud(Object.prototype,"__proto__","set"))(i,[]),n=i instanceof Array}catch{}return function(o,c){return _R(o),af(c),n?e(o,c):o.__proto__=c,o}}():void 0),dd={},ec={},Ym=li,KN=we,$N=Io.indexOf,Nh=ec,cf=O([].push),kh=function(e,n){var i,o=KN(e),c=0,u=[];for(i in o)!Ym(Nh,i)&&Ym(o,i)&&cf(u,i);for(;n.length>c;)Ym(o,i=n[c++])&&(~$N(u,i)||cf(u,i));return u},lf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],kS=kh,uf=lf.concat("length","prototype");dd.f=Object.getOwnPropertyNames||function(e){return kS(e,uf)};var tc={};tc.f=Object.getOwnPropertySymbols;var vi=tn,di=dd,hd=tc,to=Xt,ea=O([].concat),Dh=vi("Reflect","ownKeys")||function(e){var n=di.f(to(e)),i=hd.f;return i?ea(n,i(e)):n},Lh=li,ta=Dh,mv=mt,vR=Ge,gv={},_v=kh,ER=lf,nc=Object.keys||function(e){return _v(e,ER)},vv=Ze,DS=jt,yR=Ge,qN=Xt,pd=we,df=nc;gv.f=vv&&!DS?Object.defineProperties:function(e,n){qN(e);for(var i,o=pd(n),c=df(n),u=c.length,h=0;u>h;)yR.f(e,i=c[h++],o[i]);return e};var mu,Xm=tn("document","documentElement"),Ev=Xt,rc=gv,Aa=lf,xh=ec,gu=Xm,_u=gl,vu="prototype",yv="script",Sv=Km("IE_PROTO"),Jm=function(){},na=function(e){return"<"+yv+">"+e+"</"+yv+">"},ra=function(e){e.write(na("")),e.close();var n=e.parentWindow.Object;return e=null,n},ti=function(){try{mu=new ActiveXObject("htmlfile")}catch{}var e,n,i;ti=typeof document<"u"?document.domain&&mu?ra(mu):(n=_u("iframe"),i="java"+yv+":",n.style.display="none",gu.appendChild(n),n.src=String(i),(e=n.contentWindow.document).open(),e.write(na("document.F=Object")),e.close(),e.F):ra(mu);for(var o=Aa.length;o--;)delete ti[vu][Aa[o]];return ti()};xh[Sv]=!0;var Ao=Object.create||function(e,n){var i;return e!==null?(Jm[vu]=Ev(e),i=new Jm,Jm[vu]=null,i[Sv]=e):i=ti(),n===void 0?i:rc.f(i,n)},SR=pt,TR=Ro,Tv=Error,LS=O("".replace),bR=String(Tv("zxcasd").stack),Qm=/\n\s*at [^:]*:[^\n]*/,wR=Qm.test(bR),hf=gt,xS=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",hf(1,7)),e.stack!==7)}),YN=Ro,Bc=function(e,n){if(wR&&typeof e=="string"&&!Tv.prepareStackTrace)for(;n--;)e=LS(e,Qm,"");return e},bv=xS,Zm=Error.captureStackTrace,ic={},MS=ic,US=or("iterator"),VS=Array.prototype,wv=function(e){return e!==void 0&&(MS.Array===e||VS[US]===e)},pf=Za,Oa=$a,Mh=un,FS=ic,RR=or("iterator"),sc=function(e){if(!Mh(e))return Oa(e,RR)||Oa(e,"@@iterator")||FS[pf(e)]},fd=nt,jS=ts,CR=Xt,Eu=Ka,md=sc,Rv=TypeError,Cv=function(e,n){var i=arguments.length<2?md(e):n;if(jS(i))return CR(fd(i,e));throw Rv(Eu(e)+" is not iterable")},Iv=nt,BS=Xt,IR=$a,Av=function(e,n,i){var o,c;BS(e);try{if(!(o=IR(e,"return"))){if(n==="throw")throw i;return i}o=Iv(o,e)}catch(u){c=!0,o=u}if(n==="throw")throw i;if(c)throw o;return BS(o),i},Ov=Ce,AR=nt,OR=Xt,PR=Ka,WS=wv,eg=ei,tg=N,NR=Cv,kR=sc,Uh=Av,DR=TypeError,gd=function(e,n){this.stopped=e,this.result=n},Wc=gd.prototype,yu=function(e,n,i){var o,c,u,h,f,_,v,y=i&&i.that,w=!(!i||!i.AS_ENTRIES),I=!(!i||!i.IS_RECORD),P=!(!i||!i.IS_ITERATOR),j=!(!i||!i.INTERRUPTED),x=Ov(n,y),M=function(q){return o&&Uh(o,"normal",q),new gd(!0,q)},$=function(q){return w?(OR(q),j?x(q[0],q[1],M):x(q[0],q[1])):j?x(q,M):x(q)};if(I)o=e.iterator;else if(P)o=e;else{if(!(c=kR(e)))throw DR(PR(e)+" is not iterable");if(WS(c)){for(u=0,h=eg(e);h>u;u++)if((f=$(e[u]))&&tg(Wc,f))return f;return new gd(!1)}o=NR(e,c)}for(_=I?e.next:o.next;!(v=AR(_,o)).done;){try{f=$(v.value)}catch(q){Uh(o,"throw",q)}if(typeof f=="object"&&f&&tg(Wc,f))return f}return new gd(!1)},ng=Zo,Vh=In,GS=N,ff=qm,rg=yl,zS=function(e,n,i){for(var o=ta(n),c=vR.f,u=mv.f,h=0;h<o.length;h++){var f=o[h];Lh(e,f)||i&&Lh(i,f)||c(e,f,u(n,f))}},Si=Ao,mf=Ro,ig=gt,HS=function(e,n){SR(n)&&"cause"in n&&TR(e,"cause",n.cause)},Pv=function(e,n,i,o){bv&&(Zm?Zm(e,n):YN(e,"stack",Bc(i,o)))},KS=yu,Fh=function(e,n){return e===void 0?arguments.length<2?"":n:ng(e)},Ri=or("toStringTag"),Ui=Error,Os=[].push,Su=function(e,n){var i,o=GS(jh,this);rg?i=rg(Ui(),o?ff(this):jh):(i=o?this:Si(jh),mf(i,Ri,"Error")),n!==void 0&&mf(i,"message",Fh(n)),Pv(i,Su,i.stack,1),arguments.length>2&&HS(i,arguments[2]);var c=[];return KS(e,Os,{that:c}),mf(i,"errors",c),i};rg?rg(Su,Ui):zS(Su,Ui,{name:!0});var jh=Su.prototype=Si(Ui.prototype,{constructor:ig(1,Su),message:ig(1,""),name:ig(1,"AggregateError")});Vh({global:!0},{AggregateError:Su});var _d,sg,ms,$S=ut,Nv=K.WeakMap,qS=$S(Nv)&&/native code/.test(String(Nv)),Gc=K,oc=pt,og=Ro,ag=li,cg=ed,LR=Km,xR=ec,YS="Object already initialized",kv=Gc.TypeError,MR=Gc.WeakMap;if(qS||cg.state){var zc=cg.state||(cg.state=new MR);zc.get=zc.get,zc.has=zc.has,zc.set=zc.set,_d=function(e,n){if(zc.has(e))throw kv(YS);return n.facade=e,zc.set(e,n),n},sg=function(e){return zc.get(e)||{}},ms=function(e){return zc.has(e)}}else{var Bh=LR("state");xR[Bh]=!0,_d=function(e,n){if(ag(e,Bh))throw kv(YS);return n.facade=e,og(e,Bh,n),n},sg=function(e){return ag(e,Bh)?e[Bh]:{}},ms=function(e){return ag(e,Bh)}}var vd,gf,XS,Sl={set:_d,get:sg,has:ms,enforce:function(e){return ms(e)?sg(e):_d(e,{})},getterFor:function(e){return function(n){var i;if(!oc(n)||(i=sg(n)).type!==e)throw kv("Incompatible receiver, "+e+" required");return i}}},_f=Ze,UR=li,Dv=Function.prototype,VR=_f&&Object.getOwnPropertyDescriptor,JS=UR(Dv,"name"),QS={PROPER:JS&&(function(){}).name==="something",CONFIGURABLE:JS&&(!_f||_f&&VR(Dv,"name").configurable)},FR=Ro,Tl=function(e,n,i,o){return o&&o.enumerable?e[n]=i:FR(e,n,i),e},jR=d,BR=ut,WR=pt,XN=Ao,ZS=qm,JN=Tl,eT=or("iterator"),tT=!1;[].keys&&("next"in(XS=[].keys())?(gf=ZS(ZS(XS)))!==Object.prototype&&(vd=gf):tT=!0);var GR=!WR(vd)||jR(function(){var e={};return vd[eT].call(e)!==e});BR((vd=GR?{}:XN(vd))[eT])||JN(vd,eT,function(){return this});var nT={IteratorPrototype:vd,BUGGY_SAFARI_ITERATORS:tT},Lv=Za,QN=Rh?{}.toString:function(){return"[object "+Lv(this)+"]"},ZN=Rh,ek=Ge.f,vf=Ro,rT=li,iT=QN,zR=or("toStringTag"),Tu=function(e,n,i,o){if(e){var c=i?e:e.prototype;rT(c,zR)||ek(c,zR,{configurable:!0,value:n}),o&&!ZN&&vf(c,"toString",iT)}},HR=nT.IteratorPrototype,KR=Ao,$R=gt,qR=Tu,tk=ic,ia=function(){return this},Vs=function(e,n,i,o){var c=n+" Iterator";return e.prototype=KR(HR,{next:$R(+!o,i)}),qR(e,c,!1,!0),tk[c]=ia,e},YR=In,XR=nt,JR=QS,QR=Vs,ZR=qm,sT=Tu,oT=Tl,xv=ic,eC=nT,tC=JR.PROPER,Ef=eC.BUGGY_SAFARI_ITERATORS,lg=or("iterator"),aT="keys",yf="values",ug="entries",nk=function(){return this},cT=function(e,n,i,o,c,u,h){QR(i,n,o);var f,_,v,y=function($){if($===c&&x)return x;if(!Ef&&$ in P)return P[$];switch($){case aT:case yf:case ug:return function(){return new i(this,$)}}return function(){return new i(this)}},w=n+" Iterator",I=!1,P=e.prototype,j=P[lg]||P["@@iterator"]||c&&P[c],x=!Ef&&j||y(c),M=n=="Array"&&P.entries||j;if(M&&(f=ZR(M.call(new e)))!==Object.prototype&&f.next&&(sT(f,w,!0,!0),xv[w]=nk),tC&&c==yf&&j&&j.name!==yf&&(I=!0,x=function(){return XR(j,this)}),c)if(_={values:y(yf),keys:u?x:y(aT),entries:y(ug)},h)for(v in _)(Ef||I||!(v in P))&&oT(P,v,_[v]);else YR({target:n,proto:!0,forced:Ef||I},_);return h&&P[lg]!==x&&oT(P,lg,x,{}),xv[n]=x,_},dg=function(e,n){return{value:e,done:n}},nC=we,hg=ic,bl=Sl;Ge.f;var rk=cT,lT=dg,Mv="Array Iterator",rC=bl.set,iC=bl.getterFor(Mv);rk(Array,"Array",function(e,n){rC(this,{type:Mv,target:nC(e),index:0,kind:n})},function(){var e=iC(this),n=e.target,i=e.kind,o=e.index++;return!n||o>=n.length?(e.target=void 0,lT(void 0,!0)):lT(i=="keys"?o:i=="values"?n[o]:[o,n[o]],!1)},"values"),hg.Arguments=hg.Array;var pg=Ge,gs=function(e,n,i){return pg.f(e,n,i)},ik=tn,sk=gs,Uv=Ze,Fs=or("species"),ok=N,Ht=TypeError,Ed=function(e,n){if(ok(n,e))return e;throw Ht("Incorrect invocation")},uT=ut,Vv=ed,ak=O(Function.toString);uT(Vv.inspectSource)||(Vv.inspectSource=function(e){return ak(e)});var Sf=Vv.inspectSource,Fv=O,dT=d,hT=ut,sC=Za,oC=Sf,jv=function(){},pT=[],Ps=tn("Reflect","construct"),Pa=/^\s*(?:class|function)\b/,yd=Fv(Pa.exec),aC=!Pa.exec(jv),Tf=function(e){if(!hT(e))return!1;try{return Ps(jv,pT,e),!0}catch{return!1}},ac=function(e){if(!hT(e))return!1;switch(sC(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return aC||!!yd(Pa,oC(e))}catch{return!0}};ac.sham=!0;var bf,Oo,cC,Bv,fg=!Ps||dT(function(){var e;return Tf(Tf.call)||!Tf(Object)||!Tf(function(){e=!0})||e})?ac:Tf,lC=fg,uC=Ka,ck=TypeError,mg=Xt,fT=function(e){if(lC(e))return e;throw ck(uC(e)+" is not a constructor")},cc=un,vr=or("species"),is=function(e,n){var i,o=mg(e).constructor;return o===void 0||cc(i=mg(o)[vr])?n:fT(i)},Ci=O([].slice),js=TypeError,Ns=function(e,n){if(e<n)throw js("Not enough arguments");return e},Wh=/(?:ipad|iphone|ipod).*applewebkit/i.test(_r),Pr=K,gg=se,Gh=Ce,_g=ut,mT=li,wf=d,Po=Xm,gT=Ci,zh=gl,bu=Ns,Wv=Wh,_T=Ah,wl=Pr.setImmediate,Rf=Pr.clearImmediate,Sd=Pr.process,Cf=Pr.Dispatch,vg=Pr.Function,Gv=Pr.MessageChannel,zv=Pr.String,If=0,_s={},wu="onreadystatechange";wf(function(){bf=Pr.location});var Na=function(e){if(mT(_s,e)){var n=_s[e];delete _s[e],n()}},no=function(e){return function(){Na(e)}},vT=function(e){Na(e.data)},Hv=function(e){Pr.postMessage(zv(e),bf.protocol+"//"+bf.host)};wl&&Rf||(wl=function(e){bu(arguments.length,1);var n=_g(e)?e:vg(e),i=gT(arguments,1);return _s[++If]=function(){gg(n,void 0,i)},Oo(If),If},Rf=function(e){delete _s[e]},_T?Oo=function(e){Sd.nextTick(no(e))}:Cf&&Cf.now?Oo=function(e){Cf.now(no(e))}:Gv&&!Wv?(Bv=(cC=new Gv).port2,cC.port1.onmessage=vT,Oo=Gh(Bv.postMessage,Bv)):Pr.addEventListener&&_g(Pr.postMessage)&&!Pr.importScripts&&bf&&bf.protocol!=="file:"&&!wf(Hv)?(Oo=Hv,Pr.addEventListener("message",vT,!1)):Oo=wu in zh("script")?function(e){Po.appendChild(zh("script"))[wu]=function(){Po.removeChild(this),Na(e)}}:function(e){setTimeout(no(e),0)});var Af={set:wl,clear:Rf},dC=function(){this.head=null,this.tail=null};dC.prototype={add:function(e){var n={item:e,next:null},i=this.tail;i?i.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var ka,Kv,Eg,Ru,$v,Td=dC,hC=/ipad|iphone|ipod/i.test(_r)&&typeof Pebble<"u",pC=/web0s(?!.*chrome)/i.test(_r),Cu=K,yg=Ce,lk=mt.f,ET=Af.set,fC=Td,mC=Wh,Hh=hC,uk=pC,bd=Ah,yT=Cu.MutationObserver||Cu.WebKitMutationObserver,Ii=Cu.document,gC=Cu.process,Sg=Cu.Promise,_C=lk(Cu,"queueMicrotask"),ST=_C&&_C.value;if(!ST){var Tg=new fC,bg=function(){var e,n;for(bd&&(e=gC.domain)&&e.exit();n=Tg.get();)try{n()}catch(i){throw Tg.head&&ka(),i}e&&e.enter()};mC||bd||uk||!yT||!Ii?!Hh&&Sg&&Sg.resolve?((Ru=Sg.resolve(void 0)).constructor=Sg,$v=yg(Ru.then,Ru),ka=function(){$v(bg)}):bd?ka=function(){gC.nextTick(bg)}:(ET=yg(ET,Cu),ka=function(){ET(bg)}):(Kv=!0,Eg=Ii.createTextNode(""),new yT(bg).observe(Eg,{characterData:!0}),ka=function(){Eg.data=Kv=!Kv}),ST=function(e){Tg.head||ka(),Tg.add(e)}}var vC=ST,Bs=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},Iu=K.Promise,EC=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",wd=!EC&&!Ah&&typeof window=="object"&&typeof document=="object",qv=K,Hc=Iu,Yv=ut,TT=Jo,bT=Sf,dk=or,wT=wd,hk=EC,Xv=sr,RT=Hc&&Hc.prototype,Jv=dk("species"),wg=Yv(qv.PromiseRejectionEvent),yC=TT("Promise",function(){var e=bT(Hc),n=e!==String(Hc);if(!n&&Xv===66||!RT.catch||!RT.finally)return!0;if(!Xv||Xv<51||!/native code/.test(e)){var i=new Hc(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[Jv]=o,!(i.then(function(){})instanceof o))return!0}return!n&&(wT||hk)&&!wg}),Kh={CONSTRUCTOR:yC,REJECTION_EVENT:wg},Rl={},CT=ts,IT=TypeError,Qv=function(e){var n,i;this.promise=new e(function(o,c){if(n!==void 0||i!==void 0)throw IT("Bad Promise constructor");n=o,i=c}),this.resolve=CT(n),this.reject=CT(i)};Rl.f=function(e){return new Qv(e)};var Rg,Cg,SC=In,Zv=Ah,Kc=K,Ig=nt,Ag=Tl,pk=Tu,eE=function(e){var n=ik(e);Uv&&n&&!n[Fs]&&sk(n,Fs,{configurable:!0,get:function(){return this}})},p=ts,m=ut,T=pt,A=Ed,L=is,W=Af.set,re=vC,ye=function(e,n){try{arguments.length==1?console.error(e):console.error(e,n)}catch{}},Ae=Bs,ze=Td,vt=Sl,yt=Iu,_t=Kh,Vt=Rl,zt="Promise",$t=_t.CONSTRUCTOR,Ki=_t.REJECTION_EVENT,Me=vt.getterFor(zt),Oe=vt.set,je=yt&&yt.prototype,wt=yt,Yt=je,an=Kc.TypeError,nn=Kc.document,bn=Kc.process,ss=Vt.f,wr=ss,Rd=!!(nn&&nn.createEvent&&Kc.dispatchEvent),TC="unhandledrejection",wF=function(e){var n;return!(!T(e)||!m(n=e.then))&&n},RF=function(e,n){var i,o,c,u=n.value,h=n.state==1,f=h?e.ok:e.fail,_=e.resolve,v=e.reject,y=e.domain;try{f?(h||(n.rejection===2&&zne(n),n.rejection=1),f===!0?i=u:(y&&y.enter(),i=f(u),y&&(y.exit(),c=!0)),i===e.promise?v(an("Promise-chain cycle")):(o=wF(i))?Ig(o,i,_,v):_(i)):v(u)}catch(w){y&&!c&&y.exit(),v(w)}},CF=function(e,n){e.notified||(e.notified=!0,re(function(){for(var i,o=e.reactions;i=o.get();)RF(i,e);e.notified=!1,n&&!e.rejection&&Gne(e)}))},IF=function(e,n,i){var o,c;Rd?((o=nn.createEvent("Event")).promise=n,o.reason=i,o.initEvent(e,!1,!0),Kc.dispatchEvent(o)):o={promise:n,reason:i},!Ki&&(c=Kc["on"+e])?c(o):e===TC&&ye("Unhandled promise rejection",i)},Gne=function(e){Ig(W,Kc,function(){var n,i=e.facade,o=e.value;if(AF(e)&&(n=Ae(function(){Zv?bn.emit("unhandledRejection",o,i):IF(TC,i,o)}),e.rejection=Zv||AF(e)?2:1,n.error))throw n.value})},AF=function(e){return e.rejection!==1&&!e.parent},zne=function(e){Ig(W,Kc,function(){var n=e.facade;Zv?bn.emit("rejectionHandled",n):IF("rejectionhandled",n,e.value)})},tE=function(e,n,i){return function(o){e(n,o,i)}},nE=function(e,n,i){e.done||(e.done=!0,i&&(e=i),e.value=n,e.state=2,CF(e,!0))},fk=function(e,n,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===n)throw an("Promise can't be resolved itself");var o=wF(n);o?re(function(){var c={done:!1};try{Ig(o,n,tE(fk,c,e),tE(nE,c,e))}catch(u){nE(c,u,e)}}):(e.value=n,e.state=1,CF(e,!1))}catch(c){nE({done:!1},c,e)}}};$t&&(Yt=(wt=function(e){A(this,Yt),p(e),Ig(Rg,this);var n=Me(this);try{e(tE(fk,n),tE(nE,n))}catch(i){nE(n,i)}}).prototype,(Rg=function(e){Oe(this,{type:zt,done:!1,notified:!1,parent:!1,reactions:new ze,rejection:!1,state:0,value:void 0})}).prototype=Ag(Yt,"then",function(e,n){var i=Me(this),o=ss(L(this,wt));return i.parent=!0,o.ok=!m(e)||e,o.fail=m(n)&&n,o.domain=Zv?bn.domain:void 0,i.state==0?i.reactions.add(o):re(function(){RF(o,i)}),o.promise}),Cg=function(){var e=new Rg,n=Me(e);this.promise=e,this.resolve=tE(fk,n),this.reject=tE(nE,n)},Vt.f=ss=function(e){return e===wt||e===void 0?new Cg(e):wr(e)}),SC({global:!0,wrap:!0,forced:$t},{Promise:wt}),pk(wt,zt,!1,!0),eE(zt);var OF=or("iterator"),PF=!1;try{var Hne=0,NF={next:function(){return{done:!!Hne++}},return:function(){PF=!0}};NF[OF]=function(){return this},Array.from(NF,function(){throw 2})}catch{}var Kne=Iu,$ne=function(e,n){if(!PF)return!1;var i=!1;try{var o={};o[OF]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},bC=Kh.CONSTRUCTOR||!$ne(function(e){Kne.all(e).then(void 0,function(){})}),qne=nt,Yne=ts,Xne=Rl,Jne=Bs,Qne=yu;In({target:"Promise",stat:!0,forced:bC},{all:function(e){var n=this,i=Xne.f(n),o=i.resolve,c=i.reject,u=Jne(function(){var h=Yne(n.resolve),f=[],_=0,v=1;Qne(e,function(y){var w=_++,I=!1;v++,qne(h,n,y).then(function(P){I||(I=!0,f[w]=P,--v||o(f))},c)}),--v||o(f)});return u.error&&c(u.value),i.promise}});var Zne=In,ere=Kh.CONSTRUCTOR;Iu&&Iu.prototype,Zne({target:"Promise",proto:!0,forced:ere,real:!0},{catch:function(e){return this.then(void 0,e)}});var tre=nt,nre=ts,rre=Rl,ire=Bs,sre=yu;In({target:"Promise",stat:!0,forced:bC},{race:function(e){var n=this,i=rre.f(n),o=i.reject,c=ire(function(){var u=nre(n.resolve);sre(e,function(h){tre(u,n,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var ore=nt,are=Rl;In({target:"Promise",stat:!0,forced:Kh.CONSTRUCTOR},{reject:function(e){var n=are.f(this);return ore(n.reject,void 0,e),n.promise}});var cre=Xt,lre=pt,ure=Rl,kF=function(e,n){if(cre(e),lre(n)&&n.constructor===e)return n;var i=ure.f(e);return(0,i.resolve)(n),i.promise},dre=In,hre=Iu,pre=Kh.CONSTRUCTOR,fre=kF,mre=tn("Promise"),gre=!pre;dre({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return fre(gre&&this===mre?hre:this,e)}});var _re=nt,vre=ts,Ere=Rl,yre=Bs,Sre=yu;In({target:"Promise",stat:!0,forced:bC},{allSettled:function(e){var n=this,i=Ere.f(n),o=i.resolve,c=i.reject,u=yre(function(){var h=vre(n.resolve),f=[],_=0,v=1;Sre(e,function(y){var w=_++,I=!1;v++,_re(h,n,y).then(function(P){I||(I=!0,f[w]={status:"fulfilled",value:P},--v||o(f))},function(P){I||(I=!0,f[w]={status:"rejected",reason:P},--v||o(f))})}),--v||o(f)});return u.error&&c(u.value),i.promise}});var Tre=nt,bre=ts,wre=tn,Rre=Rl,Cre=Bs,Ire=yu,DF="No one promise resolved";In({target:"Promise",stat:!0,forced:bC},{any:function(e){var n=this,i=wre("AggregateError"),o=Rre.f(n),c=o.resolve,u=o.reject,h=Cre(function(){var f=bre(n.resolve),_=[],v=0,y=1,w=!1;Ire(e,function(I){var P=v++,j=!1;y++,Tre(f,n,I).then(function(x){j||w||(w=!0,c(x))},function(x){j||w||(j=!0,_[P]=x,--y||u(new i(_,DF)))})}),--y||u(new i(_,DF))});return h.error&&u(h.value),o.promise}});var Are=In,mk=Iu,Ore=d,Pre=tn,Nre=ut,kre=is,LF=kF,Dre=mk&&mk.prototype;Are({target:"Promise",proto:!0,real:!0,forced:!!mk&&Ore(function(){Dre.finally.call({then:function(){}},function(){})})},{finally:function(e){var n=kre(this,Pre("Promise")),i=Nre(e);return this.then(i?function(o){return LF(n,e()).then(function(){return o})}:e,i?function(o){return LF(n,e()).then(function(){throw o})}:e)}});var gk=O,Lre=Qa,xre=Zo,Mre=bt,Ure=gk("".charAt),xF=gk("".charCodeAt),Vre=gk("".slice),MF=function(e){return function(n,i){var o,c,u=xre(Mre(n)),h=Lre(i),f=u.length;return h<0||h>=f?e?"":void 0:(o=xF(u,h))<55296||o>56319||h+1===f||(c=xF(u,h+1))<56320||c>57343?e?Ure(u,h):o:e?Vre(u,h,h+2):c-56320+(o-55296<<10)+65536}},_k={codeAt:MF(!1),charAt:MF(!0)},Fre=_k.charAt,jre=Zo,UF=Sl,Bre=cT,VF=dg,FF="String Iterator",Wre=UF.set,Gre=UF.getterFor(FF);Bre(String,"String",function(e){Wre(this,{type:FF,string:jre(e),index:0})},function(){var e,n=Gre(this),i=n.string,o=n.index;return o>=i.length?VF(void 0,!0):(e=Fre(i,o),n.index+=e.length,VF(e,!1))});var zre=ft.Promise,Hre={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Kre=K,$re=Za,qre=Ro,jF=ic,BF=or("toStringTag");for(var vk in Hre){var WF=Kre[vk],Ek=WF&&WF.prototype;Ek&&$re(Ek)!==BF&&qre(Ek,BF,vk),jF[vk]=jF.Array}var GF=zre,Je=l(GF),Yre=Ca("Array").values,Xre=Za,Jre=li,Qre=N,Zre=Yre,yk=Array.prototype,eie={DOMTokenList:!0,NodeList:!0},tie=function(e){var n=e.values;return e===yk||Qre(yk,e)&&n===yk.values||Jre(eie,Xre(e))?Zre:n},lc=l(tie),nie=d,rie=or("iterator"),Sk=!nie(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),n=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",n.forEach(function(c,u){n.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!n.size&&!0||!n.sort||e.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[rie]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),iie=Tl,sie=wa,oie=Ge,aie=gt,wC=function(e,n,i){var o=sie(n);o in e?oie.f(e,o,aie(0,i)):e[o]=i},zF=he,cie=ei,lie=wC,uie=Array,die=Math.max,Tk=function(e,n,i){for(var o=cie(e),c=zF(n,o),u=zF(i===void 0?o:i,o),h=uie(die(u-c,0)),f=0;c<u;c++,f++)lie(h,f,e[c]);return h.length=f,h},HF=Tk,hie=Math.floor,bk=function(e,n){var i=e.length,o=hie(i/2);return i<8?pie(e,n):fie(e,bk(HF(e,0,o),n),bk(HF(e,o),n),n)},pie=function(e,n){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&n(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},fie=function(e,n,i,o){for(var c=n.length,u=i.length,h=0,f=0;h<c||f<u;)e[h+f]=h<c&&f<u?o(n[h],i[f])<=0?n[h++]:i[f++]:h<c?n[h++]:i[f++];return e},KF=bk,wk=In,rE=K,RC=nt,Cd=O,iE=Ze,$F=Sk,qF=Tl,mie=gs,gie=function(e,n,i){for(var o in n)i&&i.unsafe&&e[o]?e[o]=n[o]:iie(e,o,n[o],i);return e},_ie=Tu,vie=Vs,Rk=Sl,YF=Ed,Ck=ut,Eie=li,yie=Ce,Sie=Za,Tie=Xt,XF=pt,Da=Zo,bie=Ao,JF=gt,Ik=Cv,wie=sc,sE=Ns,Rie=KF,Cie=or("iterator"),AT="URLSearchParams",QF=AT+"Iterator",ZF=Rk.set,Cl=Rk.getterFor(AT),Iie=Rk.getterFor(QF),Aie=Object.getOwnPropertyDescriptor,Ak=function(e){if(!iE)return rE[e];var n=Aie(rE,e);return n&&n.value},ej=Ak("fetch"),CC=Ak("Request"),OT=Ak("Headers"),Ok=CC&&CC.prototype,tj=OT&&OT.prototype,Oie=rE.RegExp,Pie=rE.TypeError,nj=rE.decodeURIComponent,Nie=rE.encodeURIComponent,kie=Cd("".charAt),rj=Cd([].join),Og=Cd([].push),Pk=Cd("".replace),Die=Cd([].shift),ij=Cd([].splice),sj=Cd("".split),Lie=Cd("".slice),xie=/\+/g,oj=Array(4),Mie=function(e){return oj[e-1]||(oj[e-1]=Oie("((?:%[\\da-f]{2}){"+e+"})","gi"))},Uie=function(e){try{return nj(e)}catch{return e}},aj=function(e){var n=Pk(e,xie," "),i=4;try{return nj(n)}catch{for(;i;)n=Pk(n,Mie(i--),Uie);return n}},Vie=/[!'()~]|%20/g,Fie={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},jie=function(e){return Fie[e]},cj=function(e){return Pk(Nie(e),Vie,jie)},Nk=vie(function(e,n){ZF(this,{type:QF,iterator:Ik(Cl(e).entries),kind:n})},"Iterator",function(){var e=Iie(this),n=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=n==="keys"?o.key:n==="values"?o.value:[o.key,o.value]),i},!0),lj=function(e){this.entries=[],this.url=null,e!==void 0&&(XF(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?kie(e,0)==="?"?Lie(e,1):e:Da(e)))};lj.prototype={type:AT,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n,i,o,c,u,h,f,_=wie(e);if(_)for(i=(n=Ik(e,_)).next;!(o=RC(i,n)).done;){if(u=(c=Ik(Tie(o.value))).next,(h=RC(u,c)).done||(f=RC(u,c)).done||!RC(u,c).done)throw Pie("Expected sequence with length 2");Og(this.entries,{key:Da(h.value),value:Da(f.value)})}else for(var v in e)Eie(e,v)&&Og(this.entries,{key:v,value:Da(e[v])})},parseQuery:function(e){if(e)for(var n,i,o=sj(e,"&"),c=0;c<o.length;)(n=o[c++]).length&&(i=sj(n,"="),Og(this.entries,{key:aj(Die(i)),value:aj(rj(i,"="))}))},serialize:function(){for(var e,n=this.entries,i=[],o=0;o<n.length;)e=n[o++],Og(i,cj(e.key)+"="+cj(e.value));return rj(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var IC=function(){YF(this,oE);var e=ZF(this,new lj(arguments.length>0?arguments[0]:void 0));iE||(this.size=e.entries.length)},oE=IC.prototype;if(gie(oE,{append:function(e,n){var i=Cl(this);sE(arguments.length,2),Og(i.entries,{key:Da(e),value:Da(n)}),iE||this.length++,i.updateURL()},delete:function(e){for(var n=Cl(this),i=sE(arguments.length,1),o=n.entries,c=Da(e),u=i<2?void 0:arguments[1],h=u===void 0?u:Da(u),f=0;f<o.length;){var _=o[f];if(_.key!==c||h!==void 0&&_.value!==h)f++;else if(ij(o,f,1),h!==void 0)break}iE||(this.size=o.length),n.updateURL()},get:function(e){var n=Cl(this).entries;sE(arguments.length,1);for(var i=Da(e),o=0;o<n.length;o++)if(n[o].key===i)return n[o].value;return null},getAll:function(e){var n=Cl(this).entries;sE(arguments.length,1);for(var i=Da(e),o=[],c=0;c<n.length;c++)n[c].key===i&&Og(o,n[c].value);return o},has:function(e){for(var n=Cl(this).entries,i=sE(arguments.length,1),o=Da(e),c=i<2?void 0:arguments[1],u=c===void 0?c:Da(c),h=0;h<n.length;){var f=n[h++];if(f.key===o&&(u===void 0||f.value===u))return!0}return!1},set:function(e,n){var i=Cl(this);sE(arguments.length,1);for(var o,c=i.entries,u=!1,h=Da(e),f=Da(n),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?ij(c,_--,1):(u=!0,o.value=f));u||Og(c,{key:h,value:f}),iE||(this.size=c.length),i.updateURL()},sort:function(){var e=Cl(this);Rie(e.entries,function(n,i){return n.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var n,i=Cl(this).entries,o=yie(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((n=i[c++]).value,n.key,this)},keys:function(){return new Nk(this,"keys")},values:function(){return new Nk(this,"values")},entries:function(){return new Nk(this,"entries")}},{enumerable:!0}),qF(oE,Cie,oE.entries,{}),qF(oE,"toString",function(){return Cl(this).serialize()},{enumerable:!0}),iE&&mie(oE,"size",{get:function(){return Cl(this).entries.length},configurable:!0,enumerable:!0}),_ie(IC,AT),wk({global:!0,forced:!$F},{URLSearchParams:IC}),!$F&&Ck(OT)){var Bie=Cd(tj.has),Wie=Cd(tj.set),uj=function(e){if(XF(e)){var n,i=e.body;if(Sie(i)===AT)return n=e.headers?new OT(e.headers):new OT,Bie(n,"content-type")||Wie(n,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),bie(e,{body:JF(0,Da(i)),headers:JF(0,n)})}return e};if(Ck(ej)&&wk({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return ej(e,arguments.length>1?uj(arguments[1]):{})}}),Ck(CC)){var kk=function(e){return YF(this,Ok),new CC(e,arguments.length>1?uj(arguments[1]):{})};Ok.constructor=kk,kk.prototype=Ok,wk({global:!0,dontCallGetSet:!0,forced:!0},{Request:kk})}}var Il,Gie={URLSearchParams:IC,getState:Cl},zie=ft.URLSearchParams,dj=Ze,Hie=O,Kie=nt,$ie=d,Dk=nc,qie=tc,Yie=Ee,Xie=go,Jie=Dn,aE=Object.assign,hj=Object.defineProperty,Qie=Hie([].concat),Zie=!aE||$ie(function(){if(dj&&aE({b:1},aE(hj({},"a",{enumerable:!0,get:function(){hj(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){n[c]=c}),aE({},e)[i]!=7||Dk(aE({},n)).join("")!=o})?function(e,n){for(var i=Xie(e),o=arguments.length,c=1,u=qie.f,h=Yie.f;o>c;)for(var f,_=Jie(arguments[c++]),v=u?Qie(Dk(_),u(_)):Dk(_),y=v.length,w=0;y>w;)f=v[w++],dj&&!Kie(h,_,f)||(i[f]=_[f]);return i}:aE,ese=Xt,tse=Av,nse=Ce,rse=nt,ise=go,sse=function(e,n,i,o){try{return o?n(ese(i)[0],i[1]):n(i)}catch(c){tse(e,"throw",c)}},ose=wv,ase=fg,cse=ei,pj=wC,lse=Cv,use=sc,fj=Array,Pg=O,Lk=2147483647,dse=/[^\0-\u007E]/,mj=/[.\u3002\uFF0E\uFF61]/g,gj="Overflow: input needs wider integers to process",_j=RangeError,hse=Pg(mj.exec),cE=Math.floor,xk=String.fromCharCode,vj=Pg("".charCodeAt),Ej=Pg([].join),Of=Pg([].push),pse=Pg("".replace),fse=Pg("".split),mse=Pg("".toLowerCase),yj=function(e){return e+22+75*(e<26)},gse=function(e,n,i){var o=0;for(e=i?cE(e/700):e>>1,e+=cE(e/n);e>455;)e=cE(e/35),o+=36;return cE(o+36*e/(e+38))},_se=function(e){var n=[];e=function($){for(var q=[],oe=0,me=$.length;oe<me;){var ge=vj($,oe++);if(ge>=55296&&ge<=56319&&oe<me){var fe=vj($,oe++);(64512&fe)==56320?Of(q,((1023&ge)<<10)+(1023&fe)+65536):(Of(q,ge),oe--)}else Of(q,ge)}return q}(e);var i,o,c=e.length,u=128,h=0,f=72;for(i=0;i<e.length;i++)(o=e[i])<128&&Of(n,xk(o));var _=n.length,v=_;for(_&&Of(n,"-");v<c;){var y=Lk;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<y&&(y=o);var w=v+1;if(y-u>cE((Lk-h)/w))throw _j(gj);for(h+=(y-u)*w,u=y,i=0;i<e.length;i++){if((o=e[i])<u&&++h>Lk)throw _j(gj);if(o==u){for(var I=h,P=36;;){var j=P<=f?1:P>=f+26?26:P-f;if(I<j)break;var x=I-j,M=36-j;Of(n,xk(yj(j+x%M))),I=cE(x/M),P+=36}Of(n,xk(yj(I))),f=gse(h,w,v==_),h=0,v++}}h++,u++}return Ej(n,"")},vse=In,Mk=Ze,Ese=Sk,Uk=K,Sj=Ce,Al=O,AC=Tl,Ol=gs,yse=Ed,Vk=li,Fk=Zie,lE=function(e){var n=ise(e),i=ase(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=nse(c,o>2?arguments[2]:void 0));var h,f,_,v,y,w,I=use(n),P=0;if(!I||this===fj&&ose(I))for(h=cse(n),f=i?new this(h):fj(h);h>P;P++)w=u?c(n[P],P):n[P],pj(f,P,w);else for(y=(v=lse(n,I)).next,f=i?new this:[];!(_=rse(y,v)).done;P++)w=u?sse(v,c,[_.value,P],!0):_.value,pj(f,P,w);return f.length=P,f},Au=Tk,Sse=_k.codeAt,Tse=function(e){var n,i,o=[],c=fse(pse(mse(e),mj,"."),".");for(n=0;n<c.length;n++)i=c[n],Of(o,hse(dse,i)?"xn--"+_se(i):i);return Ej(o,".")},$h=Zo,bse=Tu,wse=Ns,Tj=Gie,bj=Sl,Rse=bj.set,OC=bj.getterFor("URL"),Cse=Tj.URLSearchParams,Ise=Tj.getState,PT=Uk.URL,jk=Uk.TypeError,PC=Uk.parseInt,Ase=Math.floor,wj=Math.pow,Pl=Al("".charAt),Ou=Al(/./.exec),NT=Al([].join),Ose=Al(1 .toString),Pse=Al([].pop),uE=Al([].push),Bk=Al("".replace),Nse=Al([].shift),kse=Al("".split),kT=Al("".slice),NC=Al("".toLowerCase),Dse=Al([].unshift),Wk="Invalid scheme",Ng="Invalid host",Rj="Invalid port",Cj=/[a-z]/i,Lse=/[\d+-.a-z]/i,Gk=/\d/,xse=/^0x/i,Mse=/^[0-7]+$/,Use=/^\d+$/,Ij=/^[\da-f]+$/i,Vse=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Fse=/[\0\t\n\r #/:<>?@[\\\]^|]/,jse=/^[\u0000-\u0020]+/,Bse=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Wse=/[\t\n\r]/g,DT=function(e){var n,i,o,c;if(typeof e=="number"){for(n=[],i=0;i<4;i++)Dse(n,e%256),e=Ase(e/256);return NT(n,".")}if(typeof e=="object"){for(n="",o=function(u){for(var h=null,f=1,_=null,v=0,y=0;y<8;y++)u[y]!==0?(v>f&&(h=_,f=v),_=null,v=0):(_===null&&(_=y),++v);return v>f&&(h=_,f=v),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(n+=i?":":"::",c=!0):(n+=Ose(e[i],16),i<7&&(n+=":")));return"["+n+"]"}return e},kC={},Aj=Fk({},kC,{" ":1,'"':1,"<":1,">":1,"`":1}),Oj=Fk({},Aj,{"#":1,"?":1,"{":1,"}":1}),zk=Fk({},Oj,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Pf=function(e,n){var i=Sse(e,0);return i>32&&i<127&&!Vk(n,e)?e:encodeURIComponent(e)},DC={ftp:21,file:null,http:80,https:443,ws:80,wss:443},LT=function(e,n){var i;return e.length==2&&Ou(Cj,Pl(e,0))&&((i=Pl(e,1))==":"||!n&&i=="|")},Pj=function(e){var n;return e.length>1&&LT(kT(e,0,2))&&(e.length==2||(n=Pl(e,2))==="/"||n==="\\"||n==="?"||n==="#")},Gse=function(e){return e==="."||NC(e)==="%2e"},Hk={},Nj={},Kk={},kj={},Dj={},$k={},Lj={},xj={},LC={},xC={},qk={},Yk={},Xk={},Jk={},Mj={},Qk={},dE={},Id={},Uj={},kg={},qh={},Zk=function(e,n,i){var o,c,u,h=$h(e);if(n){if(c=this.parse(h))throw jk(c);this.searchParams=null}else{if(i!==void 0&&(o=new Zk(i,!0)),c=this.parse(h,null,o))throw jk(c);(u=Ise(new Cse)).bindURL(this),this.searchParams=u}};Zk.prototype={type:"URL",parse:function(e,n,i){var o,c,u,h,f,_=this,v=n||Hk,y=0,w="",I=!1,P=!1,j=!1;for(e=$h(e),n||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=Bk(e,jse,""),e=Bk(e,Bse,"$1")),e=Bk(e,Wse,""),o=lE(e);y<=o.length;){switch(c=o[y],v){case Hk:if(!c||!Ou(Cj,c)){if(n)return Wk;v=Kk;continue}w+=NC(c),v=Nj;break;case Nj:if(c&&(Ou(Lse,c)||c=="+"||c=="-"||c=="."))w+=NC(c);else{if(c!=":"){if(n)return Wk;w="",v=Kk,y=0;continue}if(n&&(_.isSpecial()!=Vk(DC,w)||w=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=w,n)return void(_.isSpecial()&&DC[_.scheme]==_.port&&(_.port=null));w="",_.scheme=="file"?v=Jk:_.isSpecial()&&i&&i.scheme==_.scheme?v=kj:_.isSpecial()?v=xj:o[y+1]=="/"?(v=Dj,y++):(_.cannotBeABaseURL=!0,uE(_.path,""),v=Uj)}break;case Kk:if(!i||i.cannotBeABaseURL&&c!="#")return Wk;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=Au(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,v=qh;break}v=i.scheme=="file"?Jk:$k;continue;case kj:if(c!="/"||o[y+1]!="/"){v=$k;continue}v=LC,y++;break;case Dj:if(c=="/"){v=xC;break}v=Id;continue;case $k:if(_.scheme=i.scheme,c==Il)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Au(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())v=Lj;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Au(i.path),_.query="",v=kg;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Au(i.path),_.path.length--,v=Id;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Au(i.path),_.query=i.query,_.fragment="",v=qh}break;case Lj:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,v=Id;continue}v=xC}else v=LC;break;case xj:if(v=LC,c!="/"||Pl(w,y+1)!="/")continue;y++;break;case LC:if(c!="/"&&c!="\\"){v=xC;continue}break;case xC:if(c=="@"){I&&(w="%40"+w),I=!0,u=lE(w);for(var x=0;x<u.length;x++){var M=u[x];if(M!=":"||j){var $=Pf(M,zk);j?_.password+=$:_.username+=$}else j=!0}w=""}else if(c==Il||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(I&&w=="")return"Invalid authority";y-=lE(w).length+1,w="",v=qk}else w+=c;break;case qk:case Yk:if(n&&_.scheme=="file"){v=Qk;continue}if(c!=":"||P){if(c==Il||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&w=="")return Ng;if(n&&w==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(w))return h;if(w="",v=dE,n)return;continue}c=="["?P=!0:c=="]"&&(P=!1),w+=c}else{if(w=="")return Ng;if(h=_.parseHost(w))return h;if(w="",v=Xk,n==Yk)return}break;case Xk:if(!Ou(Gk,c)){if(c==Il||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||n){if(w!=""){var q=PC(w,10);if(q>65535)return Rj;_.port=_.isSpecial()&&q===DC[_.scheme]?null:q,w=""}if(n)return;v=dE;continue}return Rj}w+=c;break;case Jk:if(_.scheme="file",c=="/"||c=="\\")v=Mj;else{if(!i||i.scheme!="file"){v=Id;continue}if(c==Il)_.host=i.host,_.path=Au(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=Au(i.path),_.query="",v=kg;else{if(c!="#"){Pj(NT(Au(o,y),""))||(_.host=i.host,_.path=Au(i.path),_.shortenPath()),v=Id;continue}_.host=i.host,_.path=Au(i.path),_.query=i.query,_.fragment="",v=qh}}break;case Mj:if(c=="/"||c=="\\"){v=Qk;break}i&&i.scheme=="file"&&!Pj(NT(Au(o,y),""))&&(LT(i.path[0],!0)?uE(_.path,i.path[0]):_.host=i.host),v=Id;continue;case Qk:if(c==Il||c=="/"||c=="\\"||c=="?"||c=="#"){if(!n&&LT(w))v=Id;else if(w==""){if(_.host="",n)return;v=dE}else{if(h=_.parseHost(w))return h;if(_.host=="localhost"&&(_.host=""),n)return;w="",v=dE}continue}w+=c;break;case dE:if(_.isSpecial()){if(v=Id,c!="/"&&c!="\\")continue}else if(n||c!="?")if(n||c!="#"){if(c!=Il&&(v=Id,c!="/"))continue}else _.fragment="",v=qh;else _.query="",v=kg;break;case Id:if(c==Il||c=="/"||c=="\\"&&_.isSpecial()||!n&&(c=="?"||c=="#")){if((f=NC(f=w))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||uE(_.path,"")):Gse(w)?c=="/"||c=="\\"&&_.isSpecial()||uE(_.path,""):(_.scheme=="file"&&!_.path.length&&LT(w)&&(_.host&&(_.host=""),w=Pl(w,0)+":"),uE(_.path,w)),w="",_.scheme=="file"&&(c==Il||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)Nse(_.path);c=="?"?(_.query="",v=kg):c=="#"&&(_.fragment="",v=qh)}else w+=Pf(c,Oj);break;case Uj:c=="?"?(_.query="",v=kg):c=="#"?(_.fragment="",v=qh):c!=Il&&(_.path[0]+=Pf(c,kC));break;case kg:n||c!="#"?c!=Il&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":Pf(c,kC)):(_.fragment="",v=qh);break;case qh:c!=Il&&(_.fragment+=Pf(c,Aj))}y++}},parseHost:function(e){var n,i,o;if(Pl(e,0)=="["){if(Pl(e,e.length-1)!="]"||(n=function(c){var u,h,f,_,v,y,w,I=[0,0,0,0,0,0,0,0],P=0,j=null,x=0,M=function(){return Pl(c,x)};if(M()==":"){if(Pl(c,1)!=":")return;x+=2,j=++P}for(;M();){if(P==8)return;if(M()!=":"){for(u=h=0;h<4&&Ou(Ij,M());)u=16*u+PC(M(),16),x++,h++;if(M()=="."){if(h==0||(x-=h,P>6))return;for(f=0;M();){if(_=null,f>0){if(!(M()=="."&&f<4))return;x++}if(!Ou(Gk,M()))return;for(;Ou(Gk,M());){if(v=PC(M(),10),_===null)_=v;else{if(_==0)return;_=10*_+v}if(_>255)return;x++}I[P]=256*I[P]+_,++f!=2&&f!=4||P++}if(f!=4)return;break}if(M()==":"){if(x++,!M())return}else if(M())return;I[P++]=u}else{if(j!==null)return;x++,j=++P}}if(j!==null)for(y=P-j,P=7;P!=0&&y>0;)w=I[P],I[P--]=I[j+y-1],I[j+--y]=w;else if(P!=8)return;return I}(kT(e,1,-1)),!n))return Ng;this.host=n}else if(this.isSpecial()){if(e=Tse(e),Ou(Vse,e)||(n=function(c){var u,h,f,_,v,y,w,I=kse(c,".");if(I.length&&I[I.length-1]==""&&I.length--,(u=I.length)>4)return c;for(h=[],f=0;f<u;f++){if((_=I[f])=="")return c;if(v=10,_.length>1&&Pl(_,0)=="0"&&(v=Ou(xse,_)?16:8,_=kT(_,v==8?1:2)),_==="")y=0;else{if(!Ou(v==10?Use:v==8?Mse:Ij,_))return c;y=PC(_,v)}uE(h,y)}for(f=0;f<u;f++)if(y=h[f],f==u-1){if(y>=wj(256,5-u))return null}else if(y>255)return null;for(w=Pse(h),f=0;f<h.length;f++)w+=h[f]*wj(256,3-f);return w}(e),n===null))return Ng;this.host=n}else{if(Ou(Fse,e))return Ng;for(n="",i=lE(e),o=0;o<i.length;o++)n+=Pf(i[o],kC);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return Vk(DC,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;!n||this.scheme=="file"&&n==1&&LT(e[0],!0)||e.length--},serialize:function(){var e=this,n=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,f=e.query,_=e.fragment,v=n+":";return c!==null?(v+="//",e.includesCredentials()&&(v+=i+(o?":"+o:"")+"@"),v+=DT(c),u!==null&&(v+=":"+u)):n=="file"&&(v+="//"),v+=e.cannotBeABaseURL?h[0]:h.length?"/"+NT(h,"/"):"",f!==null&&(v+="?"+f),_!==null&&(v+="#"+_),v},setHref:function(e){var n=this.parse(e);if(n)throw jk(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e=="blob")try{return new hE(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+DT(this.host)+(n!==null?":"+n:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse($h(e)+":",Hk)},getUsername:function(){return this.username},setUsername:function(e){var n=lE($h(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<n.length;i++)this.username+=Pf(n[i],zk)}},getPassword:function(){return this.password},setPassword:function(e){var n=lE($h(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<n.length;i++)this.password+=Pf(n[i],zk)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?DT(e):DT(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,qk)},getHostname:function(){var e=this.host;return e===null?"":DT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Yk)},getPort:function(){var e=this.port;return e===null?"":$h(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=$h(e))==""?this.port=null:this.parse(e,Xk))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+NT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,dE))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=$h(e))==""?this.query=null:(Pl(e,0)=="?"&&(e=kT(e,1)),this.query="",this.parse(e,kg)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=$h(e))!=""?(Pl(e,0)=="#"&&(e=kT(e,1)),this.fragment="",this.parse(e,qh)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var hE=function(e){var n=yse(this,La),i=wse(arguments.length,1)>1?arguments[1]:void 0,o=Rse(n,new Zk(e,!1,i));Mk||(n.href=o.serialize(),n.origin=o.getOrigin(),n.protocol=o.getProtocol(),n.username=o.getUsername(),n.password=o.getPassword(),n.host=o.getHost(),n.hostname=o.getHostname(),n.port=o.getPort(),n.pathname=o.getPathname(),n.search=o.getSearch(),n.searchParams=o.getSearchParams(),n.hash=o.getHash())},La=hE.prototype,Nl=function(e,n){return{get:function(){return OC(this)[e]()},set:n&&function(i){return OC(this)[n](i)},configurable:!0,enumerable:!0}};if(Mk&&(Ol(La,"href",Nl("serialize","setHref")),Ol(La,"origin",Nl("getOrigin")),Ol(La,"protocol",Nl("getProtocol","setProtocol")),Ol(La,"username",Nl("getUsername","setUsername")),Ol(La,"password",Nl("getPassword","setPassword")),Ol(La,"host",Nl("getHost","setHost")),Ol(La,"hostname",Nl("getHostname","setHostname")),Ol(La,"port",Nl("getPort","setPort")),Ol(La,"pathname",Nl("getPathname","setPathname")),Ol(La,"search",Nl("getSearch","setSearch")),Ol(La,"searchParams",Nl("getSearchParams")),Ol(La,"hash",Nl("getHash","setHash"))),AC(La,"toJSON",function(){return OC(this).serialize()},{enumerable:!0}),AC(La,"toString",function(){return OC(this).serialize()},{enumerable:!0}),PT){var Vj=PT.createObjectURL,Fj=PT.revokeObjectURL;Vj&&AC(hE,"createObjectURL",Sj(Vj,PT)),Fj&&AC(hE,"revokeObjectURL",Sj(Fj,PT))}bse(hE,"URL"),vse({global:!0,forced:!Ese,sham:!Mk},{URL:hE});var zse=In,Hse=d,Kse=Ns,jj=Zo,$se=Sk,Bj=tn("URL");zse({target:"URL",stat:!0,forced:!($se&&Hse(function(){Bj.canParse()}))},{canParse:function(e){var n=Kse(arguments.length,1),i=jj(e),o=n<2||arguments[1]===void 0?void 0:jj(arguments[1]);try{return!!new Bj(i,o)}catch{return!1}}});var MC=l(ft.URL);let Wj=!0,Gj=!0;function UC(e,n,i){const o=e.match(n);return o&&o.length>=i&&parseInt(o[i],10)}function Dg(e,n,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,f){if(h!==n)return c.apply(this,arguments);const _=v=>{const y=i(v);y&&(f.handleEvent?f.handleEvent(y):f(y))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(f,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,f){if(h!==n||!this._eventMap||!this._eventMap[n])return u.apply(this,arguments);if(!this._eventMap[n].has(f))return u.apply(this,arguments);const _=this._eventMap[n].get(f);return this._eventMap[n].delete(f),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function qse(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Wj=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Yse(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Gj=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function zj(){if(typeof window=="object"){if(Wj)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function eD(e,n){Gj&&console.warn(e+" is deprecated, please use "+n+" instead.")}function Hj(e){return Object.prototype.toString.call(e)==="[object Object]"}function Kj(e){var n;return Hj(e)?Ia(n=Object.keys(e)).call(n,function(i,o){const c=Hj(e[o]),u=c?Kj(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function tD(e,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(o=>{o.endsWith("Id")?tD(e,e.get(n[o]),i):o.endsWith("Ids")&&n[o].forEach(c=>{tD(e,e.get(c),i)})}))}function $j(e,n,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(n===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===n.id&&u.push(h)}),u.forEach(h=>{e.forEach(f=>{f.type===o&&f.trackId===h.id&&tD(e,f,c)})}),c}const qj=zj;function Yj(e,n){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const v=typeof h[_]=="object"?h[_]:{ideal:h[_]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const y=function(w,I){return w?w+I.charAt(0).toUpperCase()+I.slice(1):I==="deviceId"?"sourceId":I};if(v.ideal!==void 0){f.optional=f.optional||[];let w={};typeof v.ideal=="number"?(w[y("min",_)]=v.ideal,f.optional.push(w),w={},w[y("max",_)]=v.ideal,f.optional.push(w)):(w[y("",_)]=v.ideal,f.optional.push(w))}v.exact!==void 0&&typeof v.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[y("",_)]=v.exact):["min","max"].forEach(w=>{v[w]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[y(w,_)]=v[w])})}),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},c=function(h,f){if(n.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(v,y,w){y in v&&!(w in v)&&(v[w]=v[y],delete v[y])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const v=n.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||v)){let y;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?y=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(y=["front"]),y)return i.mediaDevices.enumerateDevices().then(w=>{let I=(w=w.filter(P=>P.kind==="videoinput")).find(P=>y.some(j=>{var x;return $e(x=P.label.toLowerCase()).call(x,j)}));return!I&&w.length&&$e(y).call(y,"back")&&(I=w[w.length-1]),I&&(h.video.deviceId=_.exact?{exact:I.deviceId}:{ideal:I.deviceId}),h.video=o(h.video),qj("chrome: "+JSON.stringify(h)),f(h)})}h.video=o(h.video)}return qj("chrome: "+JSON.stringify(h)),f(h)},u=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,f,_){c(h,v=>{i.webkitGetUserMedia(v,f,y=>{_&&_(u(y))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(f){return c(f,_=>h(_).then(v=>{if(_.audio&&!v.getAudioTracks().length||_.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return v},v=>Je.reject(u(v))))}}}function Xj(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Jj(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else Dg(e,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function Qj(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const n=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,f){let _=c.apply(this,arguments);return _||(_=n(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const f=this._senders.indexOf(h);f!==-1&&this._senders.splice(f,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(n(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(f=>f.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Zj(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof i!="function"))return n.apply(this,[]);const u=function(f){const _={};return f.result().forEach(v=>{const y={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(w=>{y[w]=v.stat(w)}),_[y.id]=y}),_},h=function(f){return new Map(Object.keys(f).map(_=>[_,f[_]]))};if(arguments.length>=2){const f=function(_){o(h(u(_)))};return n.apply(this,[f,i])}return new Je((f,_)=>{n.apply(this,[function(v){f(h(u(v)))},_])}).then(o,c)}}function eB(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>$j(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),Dg(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>$j(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?Je.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():Je.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function tB(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(f)===-1&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(y=>y.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const f=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(f)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const f=this._shimmedLocalStreams[h].indexOf(u);f!==-1&&this._shimmedLocalStreams[h].splice(f,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function nB(e,n){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return tB(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(v=>this._reverseStreams[v.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(v=>{if(this.getSenders().find(w=>w.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const v=new e.MediaStream(_.getTracks());this._streams[_.id]=v,this._reverseStreams[v.id]=_,_=v}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,v){let y=v.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const I=_._reverseStreams[w],P=_._streams[I.id];y=y.replace(new RegExp(P.id,"g"),I.id)}),new RTCSessionDescription({type:v.type,sdp:y})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(P=>P===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(P=>P.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[v.id];if(I)I.addTrack(_),Je.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const P=new e.MediaStream([_]);this._streams[v.id]=P,this._reverseStreams[P.id]=v,this.addStream(P)}return this.getSenders().find(P=>P.track===_)},["createOffer","createAnswer"].forEach(function(_){const v=e.RTCPeerConnection.prototype[_],y={[_](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[I=>{const P=u(this,I);w[0].apply(null,[P])},I=>{w[1]&&w[1].apply(null,I)},arguments[2]]):v.apply(this,arguments).then(I=>u(this,I))}};e.RTCPeerConnection.prototype[_]=y[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,v){let y=v.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const I=_._reverseStreams[w],P=_._streams[I.id];y=y.replace(new RegExp(I.id,"g"),P.id)}),new RTCSessionDescription({type:v.type,sdp:y})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=f.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(w=>_.track===w)&&(v=this._streams[y])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function nD(e,n){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function rB(e,n){Dg(e,"negotiationneeded",i=>{const o=i.target;if(!(n.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var iB=Object.freeze({__proto__:null,fixNegotiationNeeded:rB,shimAddTrackRemoveTrack:nB,shimAddTrackRemoveTrackWithNative:tB,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof n=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return n(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Qj,shimGetStats:Zj,shimGetUserMedia:Yj,shimMediaStream:Xj,shimOnTrack:Jj,shimPeerConnection:nD,shimSenderReceiverGetStats:eB});function sB(e,n){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){eD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,f,_){f in h&&!(_ in h)&&(h[_]=h[f],delete h[f])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const f=h.apply(this,arguments);return c(f,"mozAutoGainControl","autoGainControl"),c(f,"mozNoiseSuppression","noiseSuppression"),f}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f,"autoGainControl","mozAutoGainControl"),c(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function oB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rD(e,n){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(f=>{if(n.version<53&&!u)try{f.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;f.forEach((v,y)=>{f.set(y,Object.assign({},v,{type:i[v.type]||v.type}))})}return f}).then(u,h)}}function aB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Je.resolve(new Map)}}function cB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),Dg(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function lB(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(n){eD("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&$e(o=n.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function uB(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function dB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function hB(e){if(typeof e!="object"||!e.RTCRtpSender)return;const n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){const i=n.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function pB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Je.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function fB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Je.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var mB=Object.freeze({__proto__:null,shimAddTransceiver:dB,shimCreateAnswer:fB,shimCreateOffer:pB,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Je.reject(o)}return i.video===!0?i.video={mediaSource:n}:i.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:hB,shimGetUserMedia:sB,shimOnTrack:oB,shimPeerConnection:rD,shimRTCDataChannel:uB,shimReceiverGetStats:cB,shimRemoveStream:lB,shimSenderGetStats:aB});function gB(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),$e(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>n.call(this,c,i)),i.getVideoTracks().forEach(c=>n.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var f;this._localStreams?$e(f=this._localStreams).call(f,h)||this._localStreams.push(h):this._localStreams=[h]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const o=n.getTracks();this.getSenders().forEach(c=>{$e(o).call(o,c.track)&&this.removeTrack(c)})})}}function _B(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),$e(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),n.apply(i,arguments)}}}function vB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.createOffer,o=n.createAnswer,c=n.setLocalDescription,u=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(_,v){const y=arguments.length>=2?arguments[2]:arguments[0],w=i.apply(this,[y]);return v?(w.then(_,v),Je.resolve()):w},n.createAnswer=function(_,v){const y=arguments.length>=2?arguments[2]:arguments[0],w=o.apply(this,[y]);return v?(w.then(_,v),Je.resolve()):w};let f=function(_,v,y){const w=c.apply(this,[_]);return y?(w.then(v,y),Je.resolve()):w};n.setLocalDescription=f,f=function(_,v,y){const w=u.apply(this,[_]);return y?(w.then(v,y),Je.resolve()):w},n.setRemoteDescription=f,f=function(_,v,y){const w=h.apply(this,[_]);return y?(w.then(v,y),Je.resolve()):w},n.addIceCandidate=f}function EB(e){const n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const i=n.mediaDevices,o=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=c=>o(yB(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=(function(i,o,c){n.mediaDevices.getUserMedia(i).then(o,c)}).bind(n))}function yB(e){return e&&e.video!==void 0?Object.assign({},e,{video:Kj(e.video)}):e}function SB(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(eD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new n(i,o)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function TB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bB(e){const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function wB(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var RB=Object.freeze({__proto__:null,shimAudioContext:wB,shimCallbacksAPI:vB,shimConstraints:yB,shimCreateOfferLegacy:bB,shimGetUserMedia:EB,shimLocalStreamsAPI:gB,shimRTCIceServerUrls:SB,shimRemoteStreamsAPI:_B,shimTrackEventTransceiver:TB}),CB=`	
\v\f\r \u2028\u2029\uFEFF`,Xse=bt,Jse=Zo,iD=CB,IB=O("".replace),Qse=RegExp("^["+iD+"]+"),Zse=RegExp("(^|[^"+iD+"])["+iD+"]+$"),eoe=function(e){return function(n){var i=Jse(Xse(n));return 1&e&&(i=IB(i,Qse,"")),2&e&&(i=IB(i,Zse,"$1")),i}},toe={trim:eoe(3)},noe=QS.PROPER,roe=d,AB=CB,ioe=toe.trim;In({target:"String",proto:!0,forced:function(e){return roe(function(){return!!AB[e]()||""[e]()!==""||noe&&AB[e].name!==e})}("trim")},{trim:function(){return ioe(this)}});var soe=Ca("String").trim,ooe=N,aoe=soe,sD=String.prototype,coe=function(e){var n=e.trim;return typeof e=="string"||e===sD||ooe(sD,e)&&n===sD.trim?aoe:n},Ws=l(coe),OB={exports:{}};(function(e){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},n.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},n.getDescription=function(i){const o=n.splitSections(i);return o&&o[0]},n.getMediaSections=function(i){const o=n.splitSections(i);return o.shift(),o},n.matchPrefix=function(i,o){return n.splitLines(i).filter(c=>c.indexOf(o)===0)},n.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},n.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},n.parseIceOptions=function(i){return i.substring(14).split(" ")},n.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},n.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},n.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},n.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},n.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},n.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},n.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},n.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},n.getMid=function(i){const o=n.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},n.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},n.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:n.matchPrefix(i+o,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},n.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,o){return n.matchPrefix(i+o,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,o){const c=n.matchPrefix(i+o,"a=ice-ufrag:")[0],u=n.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},n.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},n.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const f=c[h],_=n.matchPrefix(i,"a=rtpmap:"+f+" ")[0];if(_){const v=n.parseRtpMap(_),y=n.matchPrefix(i,"a=fmtp:"+f+" ");switch(v.parameters=y.length?n.parseFmtp(y[0]):{},v.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+f+" ").map(n.parseRtcpFb),o.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(v.name.toUpperCase())}}}n.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(n.parseExtmap(h))});const u=n.matchPrefix(i,"a=rtcp-fb:* ").map(n.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(f=>{h.rtcpFeedback.find(_=>_.type===f.type&&_.parameter===f.parameter)||h.rtcpFeedback.push(f)})}),o},n.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(i){const o=[],c=n.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,f=n.matchPrefix(i,"a=ssrc:").map(I=>n.parseSsrcMedia(I)).filter(I=>I.attribute==="cname"),_=f.length>0&&f[0].ssrc;let v;const y=n.matchPrefix(i,"a=ssrc-group:FID").map(I=>I.substring(17).split(" ").map(P=>parseInt(P,10)));y.length>0&&y[0].length>1&&y[0][0]===_&&(v=y[0][1]),c.codecs.forEach(I=>{if(I.name.toUpperCase()==="RTX"&&I.parameters.apt){let P={ssrc:_,codecPayloadType:parseInt(I.parameters.apt,10)};_&&v&&(P.rtx={ssrc:v}),o.push(P),u&&(P=JSON.parse(JSON.stringify(P)),P.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(P))}}),o.length===0&&_&&o.push({ssrc:_});let w=n.matchPrefix(i,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,o.forEach(I=>{I.maxBitrate=w})),o},n.parseRtcpParameters=function(i){const o={},c=n.matchPrefix(i,"a=ssrc:").map(f=>n.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=n.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=n.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},n.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},n.parseMsid=function(i){let o;const c=n.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=n.matchPrefix(i,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},n.parseSctpDescription=function(i){const o=n.parseMLine(i),c=n.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=n.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const f=n.matchPrefix(i,"a=sctpmap:");if(f.length>0){const _=f[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},n.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||n.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(i,o){const c=n.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?n.getDirection(o):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substring(2)},n.isRejected=function(i){return i.split(" ",2)[1]==="0"},n.parseMLine=function(i){const o=n.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},n.parseOLine=function(i){const o=n.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},n.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=n.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=n})(OB);var PB=OB.exports,pE=l(PB),loe=s({__proto__:null,default:pE},[PB]);function VC(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const n=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new n(i),c=pE.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new n(i)},e.RTCIceCandidate.prototype=n.prototype,Dg(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function oD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Dg(e,"icecandidate",n=>{if(n.candidate){const i=pE.parseCandidate(n.candidate.candidate);i.type==="relay"&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function FC(e,n){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(f){if(!f||!f.sdp)return!1;const _=pE.splitSections(f.sdp);return _.shift(),_.some(v=>{const y=pE.parseMLine(v);return y&&y.kind==="application"&&y.protocol.indexOf("SCTP")!==-1})},o=function(f){const _=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const v=parseInt(_[1],10);return v!=v?-1:v},c=function(f){let _=65536;return n.browser==="firefox"&&(_=n.version<57?f===-1?16384:2147483637:n.version<60?n.version===57?65535:65536:2147483637),_},u=function(f,_){let v=65536;n.browser==="firefox"&&n.version===57&&(v=65535);const y=pE.matchPrefix(f.sdp,"a=max-message-size:");return y.length>0?v=parseInt(y[0].substr(19),10):n.browser==="firefox"&&_!==-1&&(v=2147483637),v},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const f=o(arguments[0]),_=c(f),v=u(arguments[0],f);let y;y=_===0&&v===0?Number.POSITIVE_INFINITY:_===0||v===0?Math.max(_,v):Math.min(_,v);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>y}),this._sctp=w}return h.apply(this,arguments)}}function jC(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function n(o,c){const u=o.send;o.send=function(){const h=arguments[0],f=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&f>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return n(o,this),o},Dg(e,"datachannel",o=>(n(o.channel,o.target),o))}function aD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function cD(e,n){if(!e.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>Ws(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function BC(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Je.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Je.resolve())})}function WC(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var uoe=Object.freeze({__proto__:null,removeExtmapAllowMixed:cD,shimAddIceCandidateNullOrEmpty:BC,shimConnectionState:aD,shimMaxMessageSize:FC,shimParameterlessSetLocalDescription:WC,shimRTCIceCandidate:VC,shimRTCIceCandidateRelayProtocol:oD,shimSendThrowTypeError:jC});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=zj,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:f}=u;if(f.mozGetUserMedia)h.browser="firefox",h.version=UC(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=UC(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=UC(f.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:uoe,extractVersion:UC,disableLog:qse,disableWarnings:Yse,sdp:loe};switch(o.browser){case"chrome":if(!iB||!nD||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=iB,BC(e,o),WC(e),Yj(e,o),Xj(e),nD(e,o),Jj(e),nB(e,o),Qj(e),Zj(e),eB(e),rB(e,o),VC(e),oD(e),aD(e),FC(e,o),jC(e),cD(e,o);break;case"firefox":if(!mB||!rD||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=mB,BC(e,o),WC(e),sB(e,o),rD(e,o),oB(e),lB(e),aB(e),cB(e),uB(e),dB(e),hB(e),pB(e),fB(e),VC(e),aD(e),FC(e,o),jC(e);break;case"safari":if(!RB||!n.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=RB,BC(e,o),WC(e),SB(e),bB(e),vB(e),gB(e),_B(e),TB(e),EB(e),wB(e),VC(e),oD(e),FC(e,o),jC(e),cD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var NB=Ka,doe=TypeError,kB=_r.match(/firefox\/(\d+)/i),hoe=!!kB&&+kB[1],poe=/MSIE|Trident/.test(_r),DB=_r.match(/AppleWebKit\/(\d+)\./),foe=!!DB&&+DB[1],moe=In,LB=O,goe=ts,_oe=go,xB=ei,voe=function(e,n){if(!delete e[n])throw doe("Cannot delete property "+NB(n)+" of "+NB(e))},MB=Zo,lD=d,Eoe=KF,yoe=Ih,UB=hoe,Soe=poe,VB=sr,FB=foe,Nf=[],jB=LB(Nf.sort),Toe=LB(Nf.push),boe=lD(function(){Nf.sort(void 0)}),woe=lD(function(){Nf.sort(null)}),Roe=yoe("sort"),BB=!lD(function(){if(VB)return VB<70;if(!(UB&&UB>3)){if(Soe)return!0;if(FB)return FB<603;var e,n,i,o,c="";for(e=65;e<76;e++){switch(n=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)Nf.push({k:n+o,v:i})}for(Nf.sort(function(u,h){return h.v-u.v}),o=0;o<Nf.length;o++)n=Nf[o].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return c!=="DGBEFHACIJK"}});moe({target:"Array",proto:!0,forced:boe||!woe||!Roe||!BB},{sort:function(e){e!==void 0&&goe(e);var n=_oe(this);if(BB)return e===void 0?jB(n):jB(n,e);var i,o,c=[],u=xB(n);for(o=0;o<u;o++)o in n&&Toe(c,n[o]);for(Eoe(c,function(h){return function(f,_){return _===void 0?-1:f===void 0?1:h!==void 0?+h(f,_)||0:MB(f)>MB(_)?1:-1}}(e)),i=xB(c),o=0;o<i;)n[o]=c[o++];for(;o<u;)voe(n,o++);return n}});var Coe=Ca("Array").sort,Ioe=N,Aoe=Coe,uD=Array.prototype,Ooe=function(e){var n=e.sort;return e===uD||Ioe(uD,e)&&n===uD.sort?Aoe:n},xT=l(Ooe),dD=K;In({global:!0,forced:dD.globalThis!==dD},{globalThis:dD});var WB=l(K),hD={exports:{}};(function(e,n){(function(i,o){var c="function",u="undefined",h="object",f="string",_="major",v="model",y="name",w="type",I="vendor",P="version",j="architecture",x="console",M="mobile",$="tablet",q="smarttv",oe="wearable",me="embedded",ge="Amazon",fe="Apple",Re="ASUS",Ue="BlackBerry",Qe="Browser",rt="Chrome",cn="Firefox",ln="Google",tr="Huawei",Jr="LG",Fr="Microsoft",Uo="Motorola",Pe="Opera",He="Samsung",lt="Sharp",ke="Sony",D="Xiaomi",ee="Zebra",ue="Facebook",Fe="Chromium OS",Ft="Mac OS",Yn=function(mi){for(var ki={},fr=0;fr<mi.length;fr++)ki[mi[fr].toUpperCase()]=mi[fr];return ki},Ni=function(mi,ki){return typeof mi===f&&ua(ki).indexOf(ua(mi))!==-1},ua=function(mi){return mi.toLowerCase()},dp=function(mi,ki){if(typeof mi===f)return mi=mi.replace(/^\s\s*/,""),typeof ki===u?mi:mi.substring(0,350)},u_=function(mi,ki){for(var fr,Ua,Kd,Qr,Pn,da,Zf=0;Zf<ki.length&&!Pn;){var Gu=ki[Zf],m9=ki[Zf+1];for(fr=Ua=0;fr<Gu.length&&!Pn&&Gu[fr];)if(Pn=Gu[fr++].exec(mi))for(Kd=0;Kd<m9.length;Kd++)da=Pn[++Ua],typeof(Qr=m9[Kd])===h&&Qr.length>0?Qr.length===2?typeof Qr[1]==c?this[Qr[0]]=Qr[1].call(this,da):this[Qr[0]]=Qr[1]:Qr.length===3?typeof Qr[1]!==c||Qr[1].exec&&Qr[1].test?this[Qr[0]]=da?da.replace(Qr[1],Qr[2]):o:this[Qr[0]]=da?Qr[1].call(this,da,Qr[2]):o:Qr.length===4&&(this[Qr[0]]=da?Qr[3].call(this,da.replace(Qr[1],Qr[2])):o):this[Qr]=da||o;Zf+=2}},V0=function(mi,ki){for(var fr in ki)if(typeof ki[fr]===h&&ki[fr].length>0){for(var Ua=0;Ua<ki[fr].length;Ua++)if(Ni(ki[fr][Ua],mi))return fr==="?"?o:fr}else if(Ni(ki[fr],mi))return fr==="?"?o:fr;return mi},FA={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},jA={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[P,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[P,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,P],[/opios[\/ ]+([\w\.]+)/i],[P,[y,Pe+" Mini"]],[/\bopr\/([\w\.]+)/i],[P,[y,Pe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[y,P],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[P,[y,"UC"+Qe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[P,[y,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[P,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[P,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[P,[y,"IE"]],[/yabrowser\/([\w\.]+)/i],[P,[y,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+Qe],P],[/\bfocus\/([\w\.]+)/i],[P,[y,cn+" Focus"]],[/\bopt\/([\w\.]+)/i],[P,[y,Pe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[P,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[P,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[P,[y,Pe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[P,[y,"MIUI "+Qe]],[/fxios\/([-\w\.]+)/i],[P,[y,cn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[y,"360 "+Qe]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1 "+Qe],P],[/(comodo_dragon)\/([\w\.]+)/i],[[y,/_/g," "],P],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[y,P],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,ue],P],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[y,P],[/\bgsa\/([\w\.]+) .*safari\//i],[P,[y,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[P,[y,rt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,rt+" WebView"],P],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[P,[y,"Android "+Qe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,P],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[P,[y,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[P,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[P,V0,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[y,P],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],P],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[P,[y,cn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[y,P],[/(cobalt)\/([\w\.]+)/i],[y,[P,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[j,"amd64"]],[/(ia32(?=;))/i],[[j,ua]],[/((?:i[346]|x)86)[;\)]/i],[[j,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[j,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[j,"armhf"]],[/windows (ce|mobile); ppc;/i],[[j,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[j,/ower/,"",ua]],[/(sun4\w)[;\)]/i],[[j,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[j,ua]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[I,He],[w,$]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[I,He],[w,M]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[I,fe],[w,M]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[I,fe],[w,$]],[/(macintosh);/i],[v,[I,fe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[I,lt],[w,M]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[I,tr],[w,$]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[I,tr],[w,M]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[I,D],[w,M]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[I,D],[w,$]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[I,"OPPO"],[w,M]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[I,"Vivo"],[w,M]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[I,"Realme"],[w,M]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[I,Uo],[w,M]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[I,Uo],[w,$]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[I,Jr],[w,$]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[I,Jr],[w,M]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[I,"Lenovo"],[w,$]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[I,"Nokia"],[w,M]],[/(pixel c)\b/i],[v,[I,ln],[w,$]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[I,ln],[w,M]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[I,ke],[w,M]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[I,ke],[w,$]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[I,"OnePlus"],[w,M]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[I,ge],[w,$]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[I,ge],[w,M]],[/(playbook);[-\w\),; ]+(rim)/i],[v,I,[w,$]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[I,Ue],[w,M]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[I,Re],[w,$]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[I,Re],[w,M]],[/(nexus 9)/i],[v,[I,"HTC"],[w,$]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[v,/_/g," "],[w,M]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[I,"Acer"],[w,$]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[I,"Meizu"],[w,M]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,v,[w,M]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,v,[w,$]],[/(surface duo)/i],[v,[I,Fr],[w,$]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[I,"Fairphone"],[w,M]],[/(u304aa)/i],[v,[I,"AT&T"],[w,M]],[/\bsie-(\w*)/i],[v,[I,"Siemens"],[w,M]],[/\b(rct\w+) b/i],[v,[I,"RCA"],[w,$]],[/\b(venue[\d ]{2,7}) b/i],[v,[I,"Dell"],[w,$]],[/\b(q(?:mv|ta)\w+) b/i],[v,[I,"Verizon"],[w,$]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[I,"Barnes & Noble"],[w,$]],[/\b(tm\d{3}\w+) b/i],[v,[I,"NuVision"],[w,$]],[/\b(k88) b/i],[v,[I,"ZTE"],[w,$]],[/\b(nx\d{3}j) b/i],[v,[I,"ZTE"],[w,M]],[/\b(gen\d{3}) b.+49h/i],[v,[I,"Swiss"],[w,M]],[/\b(zur\d{3}) b/i],[v,[I,"Swiss"],[w,$]],[/\b((zeki)?tb.*\b) b/i],[v,[I,"Zeki"],[w,$]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],v,[w,$]],[/\b(ns-?\w{0,9}) b/i],[v,[I,"Insignia"],[w,$]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[I,"NextBook"],[w,$]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],v,[w,M]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],v,[w,M]],[/\b(ph-1) /i],[v,[I,"Essential"],[w,M]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[I,"Envizen"],[w,$]],[/\b(trio[-\w\. ]+) b/i],[v,[I,"MachSpeed"],[w,$]],[/\btu_(1491) b/i],[v,[I,"Rotor"],[w,$]],[/(shield[\w ]+) b/i],[v,[I,"Nvidia"],[w,$]],[/(sprint) (\w+)/i],[I,v,[w,M]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[I,Fr],[w,M]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[I,ee],[w,$]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[I,ee],[w,M]],[/smart-tv.+(samsung)/i],[I,[w,q]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[I,He],[w,q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,Jr],[w,q]],[/(apple) ?tv/i],[I,[v,fe+" TV"],[w,q]],[/crkey/i],[[v,rt+"cast"],[I,ln],[w,q]],[/droid.+aft(\w)( bui|\))/i],[v,[I,ge],[w,q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[I,lt],[w,q]],[/(bravia[\w ]+)( bui|\))/i],[v,[I,ke],[w,q]],[/(mitv-\w{5}) bui/i],[v,[I,D],[w,q]],[/Hbbtv.*(technisat) (.*);/i],[I,v,[w,q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,dp],[v,dp],[w,q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,v,[w,x]],[/droid.+; (shield) bui/i],[v,[I,"Nvidia"],[w,x]],[/(playstation [345portablevi]+)/i],[v,[I,ke],[w,x]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[I,Fr],[w,x]],[/((pebble))app/i],[I,v,[w,oe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[I,fe],[w,oe]],[/droid.+; (glass) \d/i],[v,[I,ln],[w,oe]],[/droid.+; (wt63?0{2,3})\)/i],[v,[I,ee],[w,oe]],[/(quest( 2| pro)?)/i],[v,[I,ue],[w,oe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[w,me]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[w,M]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[w,$]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,$]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,M]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[P,[y,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[P,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[y,P],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[P,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,P],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[y,[P,V0,FA]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,"Windows"],[P,V0,FA]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[P,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,Ft],[P,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[P,y],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[y,P],[/\(bb(10);/i],[P,[y,Ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[P,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[P,[y,cn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[P,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[P,[y,"watchOS"]],[/crkey\/([\d\.]+)/i],[P,[y,rt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,Fe],P],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,P],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],P],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[y,P]]},rl=function(mi,ki){if(typeof mi===h&&(ki=mi,mi=o),!(this instanceof rl))return new rl(mi,ki).getResult();var fr=typeof i!==u&&i.navigator?i.navigator:o,Ua=mi||(fr&&fr.userAgent?fr.userAgent:""),Kd=fr&&fr.userAgentData?fr.userAgentData:o,Qr=ki?function(Pn,da){var Zf={};for(var Gu in Pn)da[Gu]&&da[Gu].length%2==0?Zf[Gu]=da[Gu].concat(Pn[Gu]):Zf[Gu]=Pn[Gu];return Zf}(jA,ki):jA;return this.getBrowser=function(){var Pn={};return Pn[y]=o,Pn[P]=o,u_.call(Pn,Ua,Qr.browser),Pn[_]=function(da){return typeof da===f?da.replace(/[^\d\.]/g,"").split(".")[0]:o}(Pn[P]),fr&&fr.brave&&typeof fr.brave.isBrave==c&&(Pn[y]="Brave"),Pn},this.getCPU=function(){var Pn={};return Pn[j]=o,u_.call(Pn,Ua,Qr.cpu),Pn},this.getDevice=function(){var Pn={};return Pn[I]=o,Pn[v]=o,Pn[w]=o,u_.call(Pn,Ua,Qr.device),!Pn[w]&&Kd&&Kd.mobile&&(Pn[w]=M),Pn[v]=="Macintosh"&&fr&&typeof fr.standalone!==u&&fr.maxTouchPoints&&fr.maxTouchPoints>2&&(Pn[v]="iPad",Pn[w]=$),Pn},this.getEngine=function(){var Pn={};return Pn[y]=o,Pn[P]=o,u_.call(Pn,Ua,Qr.engine),Pn},this.getOS=function(){var Pn={};return Pn[y]=o,Pn[P]=o,u_.call(Pn,Ua,Qr.os),!Pn[y]&&Kd&&Kd.platform!="Unknown"&&(Pn[y]=Kd.platform.replace(/chrome os/i,Fe).replace(/macos/i,Ft)),Pn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ua},this.setUA=function(Pn){return Ua=typeof Pn===f&&Pn.length>350?dp(Pn,350):Pn,this},this.setUA(Ua),this};rl.VERSION="0.7.34",rl.BROWSER=Yn([y,P,_]),rl.CPU=Yn([j]),rl.DEVICE=Yn([v,I,w,x,M,q,$,oe,me]),rl.ENGINE=rl.OS=Yn([y,P]),e.exports&&(n=e.exports=rl),n.UAParser=rl;var Qf=typeof i!==u&&(i.jQuery||i.Zepto);if(Qf&&!Qf.ua){var d_=new rl;Qf.ua=d_.getResult(),Qf.ua.get=function(){return d_.getUA()},Qf.ua.set=function(mi){d_.setUA(mi);var ki=d_.getResult();for(var fr in ki)Qf.ua[fr]=ki[fr]}}})(typeof window=="object"?window:a)})(hD,hD.exports);var Poe=l(hD.exports),Noe=Za,koe=li,Doe=un,Loe=ic,xoe=or("iterator"),Moe=Object,Uoe=function(e){if(Doe(e))return!1;var n=Moe(e);return n[xoe]!==void 0||"@@iterator"in n||koe(Loe,Noe(n))},Voe=l(Uoe),GB=Af.clear;In({global:!0,bind:!0,forced:K.clearImmediate!==GB},{clearImmediate:GB});var Foe=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",zB=K,joe=se,Boe=ut,Woe=Foe,Goe=_r,zoe=Ci,Hoe=Ns,Koe=zB.Function,$oe=/MSIE .\./.test(Goe)||Woe&&function(){var e=zB.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),qoe=In,HB=K,KB=Af.set,Yoe=function(e,n){var i=1;return $oe?function(o,c){var u=Hoe(arguments.length,1)>i,h=Boe(o)?o:Koe(o),f=u?zoe(arguments,i):[],_=u?function(){joe(h,this,f)}:h;return e(_)}:e},$B=HB.setImmediate?Yoe(KB):KB;qoe({global:!0,bind:!0,forced:HB.setImmediate!==$B},{setImmediate:$B});var qB=l(ft.setImmediate),Xoe=In,Joe=vC,Qoe=ts,Zoe=Ns,eae=Ah,tae=K.process;Xoe({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){Zoe(arguments.length,1),Qoe(e);var n=eae&&tae.domain;Joe(n?n.bind(e):e)}});var YB=l(ft.queueMicrotask);function XB(e,n){return function(){return e.apply(n,arguments)}}const{toString:nae}=Object.prototype,{getPrototypeOf:pD}=Object,GC=(fD=Object.create(null),e=>{const n=nae.call(e);return fD[n]||(fD[n]=n.slice(8,-1).toLowerCase())});var fD;const Pu=e=>(e=e.toLowerCase(),n=>GC(n)===e),zC=e=>n=>typeof n===e,{isArray:fE}=Array,MT=zC("undefined"),JB=Pu("ArrayBuffer"),rae=zC("string"),$c=zC("function"),QB=zC("number"),HC=e=>e!==null&&typeof e=="object",KC=e=>{if(GC(e)!=="object")return!1;const n=pD(e);return!(n!==null&&n!==Object.prototype&&Object.getPrototypeOf(n)!==null||Symbol.toStringTag in e||Voe(e))},iae=Pu("Date"),sae=Pu("File"),oae=Pu("Blob"),aae=Pu("FileList"),cae=Pu("URLSearchParams"),[lae,uae,dae,hae]=["ReadableStream","Request","Response","Headers"].map(Pu);function UT(e,n){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),fE(e))for(i=0,o=e.length;i<o;i++)n.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let f;for(i=0;i<h;i++)f=u[i],n.call(null,e[f],f,e)}}function ZB(e,n){n=n.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],n===o.toLowerCase())return o;return null}const Lg=WB!==void 0?WB:typeof self<"u"?self:typeof window<"u"?window:T_,e4=e=>!MT(e)&&e!==Lg,pae=(mD=typeof Uint8Array<"u"&&pD(Uint8Array),e=>mD&&e instanceof mD);var mD;const fae=Pu("HTMLFormElement"),t4=(e=>{let{hasOwnProperty:n}=e;return(i,o)=>n.call(i,o)})(Object.prototype),mae=Pu("RegExp"),n4=(e,n)=>{const i=Object.getOwnPropertyDescriptors(e),o={};UT(i,(c,u)=>{let h;(h=n(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},gD="abcdefghijklmnopqrstuvwxyz",r4="0123456789",i4={DIGIT:r4,ALPHA:gD,ALPHA_DIGIT:gD+gD.toUpperCase()+r4},gae=Pu("AsyncFunction"),s4=(o4=typeof qB=="function",a4=$c(Lg.postMessage),o4?qB:a4?(_D="axios@".concat(Math.random()),$C=[],Lg.addEventListener("message",e=>{let{source:n,data:i}=e;n===Lg&&i===_D&&$C.length&&$C.shift()()},!1),e=>{$C.push(e),Lg.postMessage(_D,"*")}):e=>setTimeout(e));var o4,a4,_D,$C;const _ae=YB!==void 0?YB.bind(Lg):typeof process<"u"&&process.nextTick||s4;var Xe={isArray:fE,isArrayBuffer:JB,isBuffer:function(e){return e!==null&&!MT(e)&&e.constructor!==null&&!MT(e.constructor)&&$c(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||$c(e.append)&&((n=GC(e))==="formdata"||n==="object"&&$c(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let n;return n=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&JB(e.buffer),n},isString:rae,isNumber:QB,isBoolean:e=>e===!0||e===!1,isObject:HC,isPlainObject:KC,isReadableStream:lae,isRequest:uae,isResponse:dae,isHeaders:hae,isUndefined:MT,isDate:iae,isFile:sae,isBlob:oae,isRegExp:mae,isFunction:$c,isStream:e=>HC(e)&&$c(e.pipe),isURLSearchParams:cae,isTypedArray:pae,isFileList:aae,forEach:UT,merge:function e(){const{caseless:n}=e4(this)&&this||{},i={},o=(c,u)=>{const h=n&&ZB(i,u)||u;KC(i[h])&&KC(c)?i[h]=e(i[h],c):KC(c)?i[h]=e({},c):fE(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&UT(arguments[c],o);return i},extend:function(e,n,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return UT(n,(c,u)=>{i&&$c(c)?e[u]=XB(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>Ws(e)?Ws(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,n,i,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,n,i,o)=>{let c,u,h;const f={};if(n=n||{},e==null)return n;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,n)||f[h]||(n[h]=e[h],f[h]=!0);e=i!==!1&&pD(e)}while(e&&(!i||i(e,n))&&e!==Object.prototype);return n},kindOf:GC,kindOfTest:Pu,endsWith:(e,n,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=n.length;const o=e.indexOf(n,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(fE(e))return e;let n=e.length;if(!QB(n))return null;const i=new Array(n);for(;n-- >0;)i[n]=e[n];return i},forEachEntry:(e,n)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;n.call(e,c[0],c[1])}},matchAll:(e,n)=>{let i;const o=[];for(;(i=e.exec(n))!==null;)o.push(i);return o},isHTMLForm:fae,hasOwnProperty:t4,hasOwnProp:t4,reduceDescriptors:n4,freezeMethods:e=>{n4(e,(n,i)=>{if($c(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];$c(o)&&(n.enumerable=!1,"writable"in n?n.writable=!1:n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,n)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return fE(e)?o(e):o(String(e).split(n)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n,findKey:ZB,global:Lg,isContextDefined:e4,ALPHABET:i4,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i4.ALPHA_DIGIT,i="";const{length:o}=n;for(;e--;)i+=n[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&$c(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const n=new Array(10),i=(o,c)=>{if(HC(o)){if(n.indexOf(o)>=0)return;if(!("toJSON"in o)){n[c]=o;const u=fE(o)?[]:{};return UT(o,(h,f)=>{const _=i(h,c+1);!MT(_)&&(u[f]=_)}),n[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:gae,isThenable:e=>e&&(HC(e)||$c(e))&&$c(e.then)&&$c(e.catch),setImmediate:s4,asap:_ae};function $n(e,n,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}Xe.inherits($n,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xe.toJSONObject(this.config),code:this.code,status:this.status}}});const c4=$n.prototype,l4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{l4[e]={value:e}}),Object.defineProperties($n,l4),Object.defineProperty(c4,"isAxiosError",{value:!0}),$n.from=(e,n,i,o,c,u)=>{const h=Object.create(c4);return Xe.toFlatObject(e,h,function(f){return f!==Error.prototype},f=>f!=="isAxiosError"),$n.call(h,e.message,n,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function vD(e){return Xe.isPlainObject(e)||Xe.isArray(e)}function u4(e){return Xe.endsWith(e,"[]")?e.slice(0,-2):e}function d4(e,n,i){return e?e.concat(n).map(function(o,c){return o=u4(o),!i&&c?"["+o+"]":o}).join(i?".":""):n}const vae=Xe.toFlatObject(Xe,{},null,function(e){return/^is[A-Z]/.test(e)});function qC(e,n,i){if(!Xe.isObject(e))throw new TypeError("target must be an object");n=n||new FormData;const o=(i=Xe.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,P){return!Xe.isUndefined(P[I])})).metaTokens,c=i.visitor||v,u=i.dots,h=i.indexes,f=(i.Blob||typeof Blob<"u"&&Blob)&&Xe.isSpecCompliantForm(n);if(!Xe.isFunction(c))throw new TypeError("visitor must be a function");function _(I){if(I===null)return"";if(Xe.isDate(I))return I.toISOString();if(!f&&Xe.isBlob(I))throw new $n("Blob is not supported. Use a Buffer instead.");return Xe.isArrayBuffer(I)||Xe.isTypedArray(I)?f&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function v(I,P,j){let x=I;if(I&&!j&&typeof I=="object"){if(Xe.endsWith(P,"{}"))P=o?P:P.slice(0,-2),I=JSON.stringify(I);else if(Xe.isArray(I)&&function(M){return Xe.isArray(M)&&!M.some(vD)}(I)||(Xe.isFileList(I)||Xe.endsWith(P,"[]"))&&(x=Xe.toArray(I)))return P=u4(P),x.forEach(function(M,$){!Xe.isUndefined(M)&&M!==null&&n.append(h===!0?d4([P],$,u):h===null?P:P+"[]",_(M))}),!1}return!!vD(I)||(n.append(d4(j,P,u),_(I)),!1)}const y=[],w=Object.assign(vae,{defaultVisitor:v,convertValue:_,isVisitable:vD});if(!Xe.isObject(e))throw new TypeError("data must be an object");return function I(P,j){if(!Xe.isUndefined(P)){if(y.indexOf(P)!==-1)throw Error("Circular reference detected in "+j.join("."));y.push(P),Xe.forEach(P,function(x,M){(!(Xe.isUndefined(x)||x===null)&&c.call(n,x,Xe.isString(M)?Ws(M).call(M):M,j,w))===!0&&I(x,j?j.concat(M):[M])}),y.pop()}}(e),n}function h4(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return n[i]})}function ED(e,n){this._pairs=[],e&&qC(e,this,n)}const p4=ED.prototype;function Eae(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function f4(e,n,i){if(!n)return e;const o=i&&i.encode||Eae;Xe.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(n,i):Xe.isURLSearchParams(n)?n.toString():new ED(n,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}p4.append=function(e,n){this._pairs.push([e,n])},p4.toString=function(e){const n=e?function(i){return e.call(this,i,h4)}:h4;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};var m4=class{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Xe.forEach(this.handlers,function(n){n!==null&&e(n)})}},g4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},_4={exports:{}},yae=In,Sae=Ze,v4=Ge.f;yae({target:"Object",stat:!0,forced:Object.defineProperty!==v4,sham:!Sae},{defineProperty:v4});var E4=ft.Object,Tae=_4.exports=function(e,n,i){return E4.defineProperty(e,n,i)};E4.defineProperty.sham&&(Tae.sham=!0);var y4=l(_4.exports),bae=TypeError,S4=zm,wae=fg,Rae=pt,Cae=or("species"),T4=Array,Iae=function(e){var n;return S4(e)&&(n=e.constructor,(wae(n)&&(n===T4||S4(n.prototype))||Rae(n)&&(n=n[Cae])===null)&&(n=void 0)),n===void 0?T4:n},b4=function(e,n){return new(Iae(e))(n===0?0:n)},Aae=d,Oae=sr,Pae=or("species"),w4=function(e){return Oae>=51||!Aae(function(){var n=[];return(n.constructor={})[Pae]=function(){return{foo:1}},n[e](Boolean).foo!==1})},Nae=In,kae=d,Dae=zm,Lae=pt,xae=go,Mae=ei,R4=function(e){if(e>9007199254740991)throw bae("Maximum allowed index exceeded");return e},C4=wC,Uae=b4,Vae=w4,Fae=sr,I4=or("isConcatSpreadable"),jae=Fae>=51||!kae(function(){var e=[];return e[I4]=!1,e.concat()[0]!==e}),Bae=function(e){if(!Lae(e))return!1;var n=e[I4];return n!==void 0?!!n:Dae(e)};Nae({target:"Array",proto:!0,forced:!jae||!Vae("concat")},{concat:function(e){var n,i,o,c,u,h=xae(this),f=Uae(h,0),_=0;for(n=-1,o=arguments.length;n<o;n++)if(Bae(u=n===-1?h:arguments[n]))for(c=Mae(u),R4(_+c),i=0;i<c;i++,_++)i in u&&C4(f,_,u[i]);else R4(_+1),C4(f,_++,u);return f.length=_,f}});var A4={},Wae=Z,Gae=we,O4=dd.f,zae=Tk,P4=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];A4.f=function(e){return P4&&Wae(e)=="Window"?function(n){try{return O4(n)}catch{return zae(P4)}}(e):O4(Gae(e))};var mE={},Hae=or;mE.f=Hae;var N4=ft,Kae=li,$ae=mE,qae=Ge.f,os=function(e){var n=N4.Symbol||(N4.Symbol={});Kae(n,e)||qae(n,e,{value:$ae.f(e)})},Yae=nt,Xae=tn,Jae=or,Qae=Tl,k4=function(){var e=Xae("Symbol"),n=e&&e.prototype,i=n&&n.valueOf,o=Jae("toPrimitive");n&&!n[o]&&Qae(n,o,function(c){return Yae(i,this)},{})},Zae=Ce,ece=Dn,tce=go,nce=ei,rce=b4,D4=O([].push),ice=function(e){var n=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,f=e==5||u;return function(_,v,y,w){for(var I,P,j=tce(_),x=ece(j),M=Zae(v,y),$=nce(x),q=0,oe=w||rce,me=n?oe(_,$):i||h?oe(_,0):void 0;$>q;q++)if((f||q in x)&&(P=M(I=x[q],q,j),e))if(n)me[q]=P;else if(P)switch(e){case 3:return!0;case 5:return I;case 6:return q;case 2:D4(me,I)}else switch(e){case 4:return!1;case 7:D4(me,I)}return u?-1:o||c?c:me}},L4={forEach:ice(0)},YC=In,yD=K,SD=nt,sce=O,gE=Ze,_E=fo,oce=d,ro=li,ace=N,TD=Xt,XC=we,bD=wa,cce=Zo,wD=gt,VT=Ao,x4=nc,lce=dd,M4=A4,uce=tc,U4=mt,V4=Ge,dce=gv,F4=Ee,j4=Tl,hce=gs,RD=Ta,B4=ec,W4=id,pce=or,fce=mE,mce=os,gce=k4,_ce=Tu,G4=Sl,JC=L4.forEach,uc=Km("hidden"),QC="Symbol",FT="prototype",vce=G4.set,z4=G4.getterFor(QC),Nu=Object[FT],xg=yD.Symbol,ZC=xg&&xg[FT],Ece=yD.TypeError,CD=yD.QObject,H4=U4.f,Mg=V4.f,K4=M4.f,yce=F4.f,$4=sce([].push),Yh=RD("symbols"),jT=RD("op-symbols"),Sce=RD("wks"),ID=!CD||!CD[FT]||!CD[FT].findChild,AD=gE&&oce(function(){return VT(Mg({},"a",{get:function(){return Mg(this,"a",{value:7}).a}})).a!=7})?function(e,n,i){var o=H4(Nu,n);o&&delete Nu[n],Mg(e,n,i),o&&e!==Nu&&Mg(Nu,n,o)}:Mg,OD=function(e,n){var i=Yh[e]=VT(ZC);return vce(i,{type:QC,tag:e,description:n}),gE||(i.description=n),i},eI=function(e,n,i){e===Nu&&eI(jT,n,i),TD(e);var o=bD(n);return TD(i),ro(Yh,o)?(i.enumerable?(ro(e,uc)&&e[uc][o]&&(e[uc][o]=!1),i=VT(i,{enumerable:wD(0,!1)})):(ro(e,uc)||Mg(e,uc,wD(1,{})),e[uc][o]=!0),AD(e,o,i)):Mg(e,o,i)},PD=function(e,n){TD(e);var i=XC(n),o=x4(i).concat(J4(i));return JC(o,function(c){gE&&!SD(q4,i,c)||eI(e,c,i[c])}),e},q4=function(e){var n=bD(e),i=SD(yce,this,n);return!(this===Nu&&ro(Yh,n)&&!ro(jT,n))&&(!(i||!ro(this,n)||!ro(Yh,n)||ro(this,uc)&&this[uc][n])||i)},Y4=function(e,n){var i=XC(e),o=bD(n);if(i!==Nu||!ro(Yh,o)||ro(jT,o)){var c=H4(i,o);return!c||!ro(Yh,o)||ro(i,uc)&&i[uc][o]||(c.enumerable=!0),c}},X4=function(e){var n=K4(XC(e)),i=[];return JC(n,function(o){ro(Yh,o)||ro(B4,o)||$4(i,o)}),i},J4=function(e){var n=e===Nu,i=K4(n?jT:XC(e)),o=[];return JC(i,function(c){!ro(Yh,c)||n&&!ro(Nu,c)||$4(o,Yh[c])}),o};_E||(xg=function(){if(ace(ZC,this))throw Ece("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?cce(arguments[0]):void 0,n=W4(e),i=function(o){this===Nu&&SD(i,jT,o),ro(this,uc)&&ro(this[uc],n)&&(this[uc][n]=!1),AD(this,n,wD(1,o))};return gE&&ID&&AD(Nu,n,{configurable:!0,set:i}),OD(n,e)},j4(ZC=xg[FT],"toString",function(){return z4(this).tag}),j4(xg,"withoutSetter",function(e){return OD(W4(e),e)}),F4.f=q4,V4.f=eI,dce.f=PD,U4.f=Y4,lce.f=M4.f=X4,uce.f=J4,fce.f=function(e){return OD(pce(e),e)},gE&&hce(ZC,"description",{configurable:!0,get:function(){return z4(this).description}})),YC({global:!0,wrap:!0,forced:!_E,sham:!_E},{Symbol:xg}),JC(x4(Sce),function(e){mce(e)}),YC({target:QC,stat:!0,forced:!_E},{useSetter:function(){ID=!0},useSimple:function(){ID=!1}}),YC({target:"Object",stat:!0,forced:!_E,sham:!gE},{create:function(e,n){return n===void 0?VT(e):PD(VT(e),n)},defineProperty:eI,defineProperties:PD,getOwnPropertyDescriptor:Y4}),YC({target:"Object",stat:!0,forced:!_E},{getOwnPropertyNames:X4}),gce(),_ce(xg,QC),B4[uc]=!0;var Q4=fo&&!!Symbol.for&&!!Symbol.keyFor,Tce=In,bce=tn,wce=li,Rce=Zo,Z4=Ta,Cce=Q4,ND=Z4("string-to-symbol-registry"),Ice=Z4("symbol-to-string-registry");Tce({target:"Symbol",stat:!0,forced:!Cce},{for:function(e){var n=Rce(e);if(wce(ND,n))return ND[n];var i=bce("Symbol")(n);return ND[n]=i,Ice[i]=n,i}});var Ace=In,Oce=li,Pce=kc,Nce=Ka,kce=Q4,e3=Ta("symbol-to-string-registry");Ace({target:"Symbol",stat:!0,forced:!kce},{keyFor:function(e){if(!Pce(e))throw TypeError(Nce(e)+" is not a symbol");if(Oce(e3,e))return e3[e]}});var t3=zm,Dce=ut,n3=Z,Lce=Zo,r3=O([].push),xce=In,i3=tn,s3=se,Mce=nt,BT=O,o3=d,a3=ut,c3=kc,l3=Ci,Uce=function(e){if(Dce(e))return e;if(t3(e)){for(var n=e.length,i=[],o=0;o<n;o++){var c=e[o];typeof c=="string"?r3(i,c):typeof c!="number"&&n3(c)!="Number"&&n3(c)!="String"||r3(i,Lce(c))}var u=i.length,h=!0;return function(f,_){if(h)return h=!1,_;if(t3(this))return _;for(var v=0;v<u;v++)if(i[v]===f)return _}}},Vce=fo,Fce=String,kf=i3("JSON","stringify"),tI=BT(/./.exec),u3=BT("".charAt),jce=BT("".charCodeAt),Bce=BT("".replace),Wce=BT(1 .toString),Gce=/[\uD800-\uDFFF]/g,d3=/^[\uD800-\uDBFF]$/,h3=/^[\uDC00-\uDFFF]$/,p3=!Vce||o3(function(){var e=i3("Symbol")();return kf([e])!="[null]"||kf({a:e})!="{}"||kf(Object(e))!="{}"}),f3=o3(function(){return kf("\uDF06\uD834")!=='"\\udf06\\ud834"'||kf("\uDEAD")!=='"\\udead"'}),zce=function(e,n){var i=l3(arguments),o=Uce(n);if(a3(o)||e!==void 0&&!c3(e))return i[1]=function(c,u){if(a3(o)&&(u=Mce(o,this,Fce(c),u)),!c3(u))return u},s3(kf,null,i)},Hce=function(e,n,i){var o=u3(i,n-1),c=u3(i,n+1);return tI(d3,e)&&!tI(h3,c)||tI(h3,e)&&!tI(d3,o)?"\\u"+Wce(jce(e,0),16):e};kf&&xce({target:"JSON",stat:!0,forced:p3||f3},{stringify:function(e,n,i){var o=l3(arguments),c=s3(p3?zce:kf,null,o);return f3&&typeof c=="string"?Bce(c,Gce,Hce):c}});var m3=tc,Kce=go;In({target:"Object",stat:!0,forced:!fo||d(function(){m3.f(1)})},{getOwnPropertySymbols:function(e){var n=m3.f;return n?n(Kce(e)):[]}}),os("asyncIterator"),os("hasInstance"),os("isConcatSpreadable"),os("iterator"),os("match"),os("matchAll"),os("replace"),os("search"),os("species"),os("split");var $ce=k4;os("toPrimitive"),$ce();var qce=tn,Yce=Tu;os("toStringTag"),Yce(qce("Symbol"),"Symbol"),os("unscopables"),Tu(K.JSON,"JSON",!0);var Xce=ft.Symbol,Jce=or,Qce=Ge.f,g3=Jce("metadata"),_3=Function.prototype;_3[g3]===void 0&&Qce(_3,g3,{value:null}),os("dispose"),os("metadata");var Zce=Xce;os("asyncDispose");var ele=O,kD=tn("Symbol"),tle=kD.keyFor,nle=ele(kD.prototype.valueOf),v3=kD.isRegisteredSymbol||function(e){try{return tle(nle(e))!==void 0}catch{return!1}};In({target:"Symbol",stat:!0},{isRegisteredSymbol:v3});for(var rle=Ta,E3=tn,ile=O,sle=kc,ole=or,nI=E3("Symbol"),y3=nI.isWellKnownSymbol,S3=E3("Object","getOwnPropertyNames"),ale=ile(nI.prototype.valueOf),T3=rle("wks"),DD=0,b3=S3(nI),cle=b3.length;DD<cle;DD++)try{var w3=b3[DD];sle(nI[w3])&&ole(w3)}catch{}var R3=function(e){if(y3&&y3(e))return!0;try{for(var n=ale(e),i=0,o=S3(T3),c=o.length;i<c;i++)if(T3[o[i]]==n)return!0}catch{}return!1};In({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:R3}),os("matcher"),os("observable"),In({target:"Symbol",stat:!0},{isRegistered:v3}),In({target:"Symbol",stat:!0,forced:!0},{isWellKnown:R3}),os("metadataKey"),os("patternMatch"),os("replaceAll");var vE=l(Zce),C3=l(mE.f("iterator"));function WT(e){return WT=typeof vE=="function"&&typeof C3=="symbol"?function(n){return typeof n}:function(n){return n&&typeof vE=="function"&&n.constructor===vE&&n!==vE.prototype?"symbol":typeof n},WT(e)}var lle=l(mE.f("toPrimitive"));function ule(e){var n=function(i,o){if(WT(i)!=="object"||i===null)return i;var c=i[lle];if(c!==void 0){var u=c.call(i,o);if(WT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return WT(n)==="symbol"?n:String(n)}function G(e,n,i){return(n=ule(n))in e?y4(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}var I3=l(zie),dle={isBrowser:!0,classes:{URLSearchParams:I3!==void 0?I3:ED,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const LD=typeof window<"u"&&typeof document<"u",xD=typeof navigator=="object"&&navigator||void 0,hle=LD&&(!xD||["ReactNative","NativeScript","NS"].indexOf(xD.product)<0),ple=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",fle=LD&&window.location.href||"http://localhost";function A3(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function O3(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?A3(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):A3(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var sa=O3(O3({},Object.freeze({__proto__:null,hasBrowserEnv:LD,hasStandardBrowserEnv:hle,hasStandardBrowserWebWorkerEnv:ple,navigator:xD,origin:fle})),dle),mle=Xt,gle=nt,_le=li,vle=N,Ele=function(){var e=mle(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},P3=RegExp.prototype,N3=function(e){var n=e.flags;return n!==void 0||"flags"in P3||_le(e,"flags")||!vle(P3,e)?n:gle(Ele,e)},yle=_k.charAt,k3=nt,Sle=Xt,Tle=ut,ble=Z,wle=/./.exec,Rle=TypeError,Cle=In,D3=nt,L3=ae,Ile=Vs,rI=dg,x3=bt,M3=At,GT=Zo,Ale=Xt,Ole=un,Ple=Z,Nle=Qw,U3=N3,kle=$a,Dle=d,Lle=is,xle=function(e,n,i){return n+(i?yle(e,n).length:1)},Mle=function(e,n){var i=e.exec;if(Tle(i)){var o=k3(i,e,n);return o!==null&&Sle(o),o}if(ble(e)==="RegExp")return k3(wle,e,n);throw Rle("RegExp#exec called on incompatible receiver")},V3=Sl,Ule=or("matchAll"),F3="RegExp String",j3=F3+" Iterator",Vle=V3.set,Fle=V3.getterFor(j3),jle=TypeError,MD=L3("".indexOf),iI=L3("".matchAll),UD=!!iI&&!Dle(function(){iI("a",/./)}),Ble=Ile(function(e,n,i,o){Vle(this,{type:j3,regexp:e,string:n,global:i,unicode:o,done:!1})},F3,function(){var e=Fle(this);if(e.done)return rI(void 0,!0);var n=e.regexp,i=e.string,o=Mle(n,i);return o===null?(e.done=!0,rI(void 0,!0)):e.global?(GT(o[0])===""&&(n.lastIndex=xle(i,M3(n.lastIndex),e.unicode)),rI(o,!1)):(e.done=!0,rI(o,!1))}),B3=function(e){var n,i,o,c=Ale(this),u=GT(e),h=Lle(c,RegExp),f=GT(U3(c));return n=new h(h===RegExp?c.source:c,f),i=!!~MD(f,"g"),o=!!~MD(f,"u"),n.lastIndex=M3(c.lastIndex),new Ble(n,u,i,o)};Cle({target:"String",proto:!0,forced:UD},{matchAll:function(e){var n,i,o,c,u=x3(this);if(Ole(e)){if(UD)return iI(u,e)}else{if(Nle(e)&&(n=GT(x3(U3(e))),!~MD(n,"g")))throw jle("`.matchAll` does not allow non-global regexes");if(UD)return iI(u,e);if((o=kle(e,Ule))===void 0&&Ple(e)=="RegExp"&&(o=B3),o)return D3(o,e,u)}return i=GT(u),c=new RegExp(e,"g"),D3(B3,c,i)}});var Wle=Ca("String").matchAll,Gle=N,zle=Wle,VD=String.prototype,Hle=function(e){var n=e.matchAll;return typeof e=="string"||e===VD||Gle(VD,e)&&n===VD.matchAll?zle:n},Kle=l(Hle);function W3(e){function n(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const f=Number.isFinite(+h),_=u>=i.length;return h=!h&&Xe.isArray(c)?c.length:h,_?(Xe.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!f):(c[h]&&Xe.isObject(c[h])||(c[h]=[]),n(i,o,c[h],u)&&Xe.isArray(c[h])&&(c[h]=function(v){const y={},w=Object.keys(v);let I;const P=w.length;let j;for(I=0;I<P;I++)j=w[I],y[j]=v[j];return y}(c[h])),!f)}if(Xe.isFormData(e)&&Xe.isFunction(e.entries)){const i={};return Xe.forEachEntry(e,(o,c)=>{n(function(u){return Kle(Xe).call(Xe,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const FD={transitional:g4,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",o=i.indexOf("application/json")>-1,c=Xe.isObject(e);if(c&&Xe.isHTMLForm(e)&&(e=new FormData(e)),Xe.isFormData(e))return o?JSON.stringify(W3(e)):e;if(Xe.isArrayBuffer(e)||Xe.isBuffer(e)||Xe.isStream(e)||Xe.isFile(e)||Xe.isBlob(e)||Xe.isReadableStream(e))return e;if(Xe.isArrayBufferView(e))return e.buffer;if(Xe.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,f){return qC(h,new sa.classes.URLSearchParams,Object.assign({visitor:function(_,v,y,w){return sa.isNode&&Xe.isBuffer(_)?(this.append(v,_.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},f))}(e,this.formSerializer).toString();if((u=Xe.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return qC(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(n.setContentType("application/json",!1),function(h,f,_){if(Xe.isString(h))try{return(f||JSON.parse)(h),Ws(Xe).call(Xe,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const n=this.transitional||FD.transitional,i=n&&n.forcedJSONParsing,o=this.responseType==="json";if(Xe.isResponse(e)||Xe.isReadableStream(e))return e;if(e&&Xe.isString(e)&&(i&&!this.responseType||o)){const c=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?$n.from(u,$n.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:sa.classes.FormData,Blob:sa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xe.forEach(["delete","get","head","post","put","patch"],e=>{FD.headers[e]={}});var jD=FD;const $le=Xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),G3=Symbol("internals");function zT(e){var n;return e&&Ws(n=String(e)).call(n).toLowerCase()}function sI(e){return e===!1||e==null?e:Xe.isArray(e)?e.map(sI):String(e)}function BD(e,n,i,o,c){return Xe.isFunction(o)?o.call(this,n,i):(c&&(n=i),Xe.isString(n)?Xe.isString(o)?n.indexOf(o)!==-1:Xe.isRegExp(o)?o.test(n):void 0:void 0)}class oI{constructor(n){n&&this.set(n)}set(n,i,o){const c=this;function u(_,v,y){const w=zT(v);if(!w)throw new Error("header name must be a non-empty string");const I=Xe.findKey(c,w);(!I||c[I]===void 0||y===!0||y===void 0&&c[I]!==!1)&&(c[I||v]=sI(_))}const h=(_,v)=>Xe.forEach(_,(y,w)=>u(y,w,v));if(Xe.isPlainObject(n)||n instanceof this.constructor)h(n,i);else if(Xe.isString(n)&&(n=Ws(n).call(n))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ws(f=n).call(f)))h((_=>{const v={};let y,w,I;return _&&_.split(`
`).forEach(function(P){var j,x;I=P.indexOf(":"),y=Ws(j=P.substring(0,I)).call(j).toLowerCase(),w=Ws(x=P.substring(I+1)).call(x),!y||v[y]&&$le[y]||(y==="set-cookie"?v[y]?v[y].push(w):v[y]=[w]:v[y]=v[y]?v[y]+", "+w:w)}),v})(n),i);else if(Xe.isHeaders(n))for(const[_,v]of n.entries())u(v,_,o);else n!=null&&u(i,n,o);var f;return this}get(n,i){if(n=zT(n)){const o=Xe.findKey(this,n);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=f.exec(u);)h[_[1]]=_[2];return h}(c);if(Xe.isFunction(i))return i.call(this,c,o);if(Xe.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,i){if(n=zT(n)){const o=Xe.findKey(this,n);return!(!o||this[o]===void 0||i&&!BD(0,this[o],o,i))}return!1}delete(n,i){const o=this;let c=!1;function u(h){if(h=zT(h)){const f=Xe.findKey(o,h);!f||i&&!BD(0,o[f],f,i)||(delete o[f],c=!0)}}return Xe.isArray(n)?n.forEach(u):u(n),c}clear(n){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];n&&!BD(0,this[u],u,n,!0)||(delete this[u],c=!0)}return c}normalize(n){const i=this,o={};return Xe.forEach(this,(c,u)=>{var h;const f=Xe.findKey(o,u);if(f)return i[f]=sI(c),void delete i[u];const _=n?function(v){return Ws(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(y,w,I)=>w.toUpperCase()+I)}(u):Ws(h=String(u)).call(h);_!==u&&delete i[u],i[_]=sI(c),o[_]=!0}),this}concat(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(n){const i=Object.create(null);return Xe.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=n&&Xe.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(n=>{let[i,o]=n;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n){const i=new this(n);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(n){const i=(this[G3]=this[G3]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=zT(u);i[h]||(function(f,_){const v=Xe.toCamelCase(" "+_);["get","set","has"].forEach(y=>{Object.defineProperty(f,y+v,{value:function(w,I,P){return this[y].call(this,_,w,I,P)},configurable:!0})})}(o,u),i[h]=!0)}return Xe.isArray(n)?n.forEach(c):c(n),this}}oI.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Xe.reduceDescriptors(oI.prototype,(e,n)=>{let{value:i}=e,o=n[0].toUpperCase()+n.slice(1);return{get:()=>i,set(c){this[o]=c}}}),Xe.freezeMethods(oI);var ku=oI;function WD(e,n){const i=this||jD,o=n||i,c=ku.from(o.headers);let u=o.data;return Xe.forEach(e,function(h){u=h.call(i,u,c.normalize(),n?n.status:void 0)}),c.normalize(),u}function z3(e){return!(!e||!e.__CANCEL__)}function EE(e,n,i){$n.call(this,e??"canceled",$n.ERR_CANCELED,n,i),this.name="CanceledError"}function H3(e,n,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?n(new $n("Request failed with status code "+i.status,[$n.ERR_BAD_REQUEST,$n.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}Xe.inherits(EE,$n,{__CANCEL__:!0});const aI=function(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const f=new Array(u),_=new Array(u);let v,y=0,w=0;return h=h!==void 0?h:1e3,function(I){const P=Date.now(),j=_[w];v||(v=P),f[y]=I,_[y]=P;let x=w,M=0;for(;x!==y;)M+=f[x++],x%=u;if(y=(y+1)%u,y===w&&(w=(w+1)%u),P-v<h)return;const $=j&&P-j;return $?Math.round(1e3*M/$):void 0}}(50,250);return function(u,h){let f,_,v=0,y=1e3/h;const w=function(I){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),f=null,_&&(clearTimeout(_),_=null),u.apply(null,I)};return[function(){const I=Date.now(),P=I-v;for(var j=arguments.length,x=new Array(j),M=0;M<j;M++)x[M]=arguments[M];P>=y?w(x,I):(f=x,_||(_=setTimeout(()=>{_=null,w(f)},y-P)))},()=>f&&w(f)]}(u=>{const h=u.loaded,f=u.lengthComputable?u.total:void 0,_=h-o,v=c(_);o=h,e({loaded:h,total:f,progress:f?h/f:void 0,bytes:_,rate:v||void 0,estimated:v&&f&&h<=f?(f-h)/v:void 0,event:u,lengthComputable:f!=null,[n?"download":"upload"]:!0})},i)},K3=(e,n)=>{const i=e!=null;return[o=>n[0]({lengthComputable:i,total:e,loaded:o}),n[1]]},$3=e=>function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Xe.asap(()=>e(...i))};var qle=sa.hasStandardBrowserEnv?((e,n)=>i=>(i=new MC(i,sa.origin),e.protocol===i.protocol&&e.host===i.host&&(n||e.port===i.port)))(new MC(sa.origin),sa.navigator&&/(msie|trident)/i.test(sa.navigator.userAgent)):()=>!0,Yle=sa.hasStandardBrowserEnv?{write(e,n,i,o,c,u){const h=[e+"="+encodeURIComponent(n)];Xe.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),Xe.isString(o)&&h.push("path="+o),Xe.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function q3(e,n){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(n)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,n):n}function Y3(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const X3=e=>e instanceof ku?function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?Y3(Object(o),!0).forEach(function(c){G(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Y3(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e):e;function Ug(e,n){n=n||{};const i={};function o(v,y,w,I){return Xe.isPlainObject(v)&&Xe.isPlainObject(y)?Xe.merge.call({caseless:I},v,y):Xe.isPlainObject(y)?Xe.merge({},y):Xe.isArray(y)?y.slice():y}function c(v,y,w,I){return Xe.isUndefined(y)?Xe.isUndefined(v)?void 0:o(void 0,v,0,I):o(v,y,0,I)}function u(v,y){if(!Xe.isUndefined(y))return o(void 0,y)}function h(v,y){return Xe.isUndefined(y)?Xe.isUndefined(v)?void 0:o(void 0,v):o(void 0,y)}function f(v,y,w){return w in n?o(v,y):w in e?o(void 0,v):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f,headers:(v,y,w)=>c(X3(v),X3(y),0,!0)};return Xe.forEach(Object.keys(Object.assign({},e,n)),function(v){const y=_[v]||c,w=y(e[v],n[v],v);Xe.isUndefined(w)&&y!==f||(i[v]=w)}),i}var J3=e=>{const n=Ug({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:f,auth:_}=n;if(n.headers=f=ku.from(f),n.url=f4(q3(n.baseURL,n.url),e.params,e.paramsSerializer),_&&f.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),Xe.isFormData(o)){if(sa.hasStandardBrowserEnv||sa.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if((i=f.getContentType())!==!1){const[v,...y]=i?i.split(";").map(w=>Ws(w).call(w)).filter(Boolean):[];f.setContentType([v||"multipart/form-data",...y].join("; "))}}if(sa.hasStandardBrowserEnv&&(c&&Xe.isFunction(c)&&(c=c(n)),c||c!==!1&&qle(n.url))){const v=u&&h&&Yle.read(h);v&&f.set(u,v)}return n},Xle=typeof XMLHttpRequest<"u"&&function(e){return new Je(function(n,i){const o=J3(e);let c=o.data;const u=ku.from(o.headers).normalize();let h,f,_,v,y,{responseType:w,onUploadProgress:I,onDownloadProgress:P}=o;function j(){v&&v(),y&&y(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let x=new XMLHttpRequest;function M(){if(!x)return;const q=ku.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders());H3(function(oe){n(oe),j()},function(oe){i(oe),j()},{data:w&&w!=="text"&&w!=="json"?x.response:x.responseText,status:x.status,statusText:x.statusText,headers:q,config:e,request:x}),x=null}x.open(o.method.toUpperCase(),o.url,!0),x.timeout=o.timeout,"onloadend"in x?x.onloadend=M:x.onreadystatechange=function(){x&&x.readyState===4&&(x.status!==0||x.responseURL&&x.responseURL.indexOf("file:")===0)&&setTimeout(M)},x.onabort=function(){x&&(i(new $n("Request aborted",$n.ECONNABORTED,e,x)),x=null)},x.onerror=function(){i(new $n("Network Error",$n.ERR_NETWORK,e,x)),x=null},x.ontimeout=function(){let q=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const oe=o.transitional||g4;o.timeoutErrorMessage&&(q=o.timeoutErrorMessage),i(new $n(q,oe.clarifyTimeoutError?$n.ETIMEDOUT:$n.ECONNABORTED,e,x)),x=null},c===void 0&&u.setContentType(null),"setRequestHeader"in x&&Xe.forEach(u.toJSON(),function(q,oe){x.setRequestHeader(oe,q)}),Xe.isUndefined(o.withCredentials)||(x.withCredentials=!!o.withCredentials),w&&w!=="json"&&(x.responseType=o.responseType),P&&([_,y]=aI(P,!0),x.addEventListener("progress",_)),I&&x.upload&&([f,v]=aI(I),x.upload.addEventListener("progress",f),x.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(h=q=>{x&&(i(!q||q.type?new EE(null,e,x):q),x.abort(),x=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const $=function(q){const oe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return oe&&oe[1]||""}(o.url);$&&sa.protocols.indexOf($)===-1?i(new $n("Unsupported protocol "+$+":",$n.ERR_BAD_REQUEST,e)):x.send(c||null)})},Jle=(e,n)=>{const{length:i}=e=e?e.filter(Boolean):[];if(n||i){let o,c=new AbortController;const u=function(v){if(!o){o=!0,f();const y=v instanceof Error?v:this.reason;c.abort(y instanceof $n?y:new EE(y instanceof Error?y.message:y))}};let h=n&&setTimeout(()=>{h=null,u(new $n("timeout ".concat(n," of ms exceeded"),$n.ETIMEDOUT))},n);const f=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),e=null)};e.forEach(v=>v.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>Xe.asap(f),_}},Qle=GF,Zle=Rl;In({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=Zle.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var eue=Rl,tue=Bs;In({target:"Promise",stat:!0,forced:!0},{try:function(e){var n=eue.f(this),i=tue(e);return(i.error?n.reject:n.resolve)(i.value),n.promise}});var GD=l(Qle),Q3=mE.f("asyncIterator"),nue=l(Q3);function zD(e,n){this.v=e,this.k=n}function HT(e){var n,i;function o(u,h){try{var f=e[u](h),_=f.value,v=_ instanceof zD;GD.resolve(v?_.v:_).then(function(y){if(v){var w=u==="return"?"return":"next";if(!_.k||y.done)return o(w,y);y=e[w](y).value}c(f.done?"return":"normal",y)},function(y){o("throw",y)})}catch(y){c("throw",y)}}function c(u,h){switch(u){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?o(n.key,n.arg):i=null}this._invoke=function(u,h){return new GD(function(f,_){var v={key:u,arg:h,resolve:f,reject:_,next:null};i?i=i.next=v:(n=i=v,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function qc(e){return function(){return new HT(e.apply(this,arguments))}}function fn(e){return new zD(e,0)}function cI(e){var n={},i=!1;function o(c,u){return i=!0,{done:!1,value:new zD(u=new GD(function(h){h(e[c](u))}),1)}}return n[vE!==void 0&&C3||"@@iterator"]=function(){return this},n.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(n.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(n.return=function(c){return i?(i=!1,c):o("return",c)}),n}HT.prototype[typeof vE=="function"&&nue||"@@asyncIterator"]=function(){return this},HT.prototype.next=function(e){return this._invoke("next",e)},HT.prototype.throw=function(e){return this._invoke("throw",e)},HT.prototype.return=function(e){return this._invoke("return",e)};var HD=l(Q3);function KD(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=HD,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new lI(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function lI(e){function n(i){if(Object(i)!==i)return Je.reject(new TypeError(i+" is not an object."));var o=i.done;return Je.resolve(i.value).then(function(c){return{value:c,done:o}})}return lI=function(i){this.s=i,this.n=i.next},lI.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?Je.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?Je.reject(i):n(o.apply(this.s,arguments))}},new lI(e)}const rue=function*(e,n){let i=e.byteLength;if(!n||i<n)return void(yield e);let o,c=0;for(;c<i;)o=c+n,yield e.slice(c,o),c=o},iue=function(){var e=qc(function*(n,i){var o,c=!1,u=!1;try{for(var h,f=KD(sue(n));c=!(h=yield fn(f.next())).done;c=!1){const _=h.value;yield*cI(KD(rue(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&f.return!=null&&(yield fn(f.return()))}finally{if(u)throw o}}});return function(n,i){return e.apply(this,arguments)}}(),sue=function(){var e=qc(function*(n){if(n[HD])return void(yield*cI(KD(n)));const i=n.getReader();try{for(;;){const{done:o,value:c}=yield fn(i.read());if(o)break;yield c}}finally{yield fn(i.cancel())}});return function(n){return e.apply(this,arguments)}}(),Z3=(e,n,i,o)=>{const c=iue(e,n);let u,h=0,f=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:v,value:y}=await c.next();if(v)return f(),void _.close();let w=y.byteLength;if(i){let I=h+=w;i(I)}_.enqueue(new Uint8Array(y))}catch(v){throw f(v),v}},cancel:_=>(f(_),c.return())},{highWaterMark:2})};function e5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function t5(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?e5(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):e5(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const uI=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",n5=uI&&typeof ReadableStream=="function",oue=uI&&(typeof TextEncoder=="function"?(r5=new TextEncoder,e=>r5.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var r5;const i5=function(e){try{for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},aue=n5&&i5(()=>{let e=!1;const n=new Request(sa.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!n}),$D=n5&&i5(()=>Xe.isReadableStream(new Response("").body)),dI={stream:$D&&(e=>e.body)};var s5;uI&&(s5=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!dI[e]&&(dI[e]=Xe.isFunction(s5[e])?n=>n[e]():(n,i)=>{throw new $n("Response type '".concat(e,"' is not supported"),$n.ERR_NOT_SUPPORT,i)})}));const cue=async(e,n)=>{const i=Xe.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:Xe.isBlob(o)?o.size:Xe.isSpecCompliantForm(o)?(await new Request(sa.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:Xe.isArrayBufferView(o)||Xe.isArrayBuffer(o)?o.byteLength:(Xe.isURLSearchParams(o)&&(o+=""),Xe.isString(o)?(await oue(o)).byteLength:void 0))(n)};var lue=uI&&(async e=>{let{url:n,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:f,onUploadProgress:_,responseType:v,headers:y,withCredentials:w="same-origin",fetchOptions:I}=J3(e);v=v?(v+"").toLowerCase():"text";let P,j=Jle([c,u&&u.toAbortSignal()],h);const x=j&&j.unsubscribe&&(()=>{j.unsubscribe()});let M;try{if(_&&aue&&i!=="get"&&i!=="head"&&(M=await cue(y,o))!==0){let ge,fe=new Request(n,{method:"POST",body:o,duplex:"half"});if(Xe.isFormData(o)&&(ge=fe.headers.get("content-type"))&&y.setContentType(ge),fe.body){const[Re,Ue]=K3(M,aI($3(_)));o=Z3(fe.body,65536,Re,Ue)}}Xe.isString(w)||(w=w?"include":"omit");const $="credentials"in Request.prototype;P=new Request(n,t5(t5({},I),{},{signal:j,method:i.toUpperCase(),headers:y.normalize().toJSON(),body:o,duplex:"half",credentials:$?w:void 0}));let q=await fetch(P);const oe=$D&&(v==="stream"||v==="response");if($D&&(f||oe&&x)){const ge={};["status","statusText","headers"].forEach(Qe=>{ge[Qe]=q[Qe]});const fe=Xe.toFiniteNumber(q.headers.get("content-length")),[Re,Ue]=f&&K3(fe,aI($3(f),!0))||[];q=new Response(Z3(q.body,65536,Re,()=>{Ue&&Ue(),x&&x()}),ge)}v=v||"text";let me=await dI[Xe.findKey(dI,v)||"text"](q,e);return!oe&&x&&x(),await new Je((ge,fe)=>{H3(ge,fe,{data:me,headers:ku.from(q.headers),status:q.status,statusText:q.statusText,config:e,request:P})})}catch($){throw x&&x(),$&&$.name==="TypeError"&&/fetch/i.test($.message)?Object.assign(new $n("Network Error",$n.ERR_NETWORK,e,P),{cause:$.cause||$}):$n.from($,$&&$.code,e,P)}});const qD={http:null,xhr:Xle,fetch:lue};Xe.forEach(qD,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const o5=e=>"- ".concat(e),uue=e=>Xe.isFunction(e)||e===null||e===!1;var a5={getAdapter:e=>{e=Xe.isArray(e)?e:[e];const{length:n}=e;let i,o;const c={};for(let u=0;u<n;u++){let h;if(i=e[u],o=i,!uue(i)&&(o=qD[(h=String(i)).toLowerCase()],o===void 0))throw new $n("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[f,_]=h;return"adapter ".concat(f," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new $n("There is no suitable adapter to dispatch the request "+(n?u.length>1?`since :
`+u.map(o5).join(`
`):" "+o5(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:qD};function YD(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new EE(null,e)}function c5(e){return YD(e),e.headers=ku.from(e.headers),e.data=WD.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),a5.getAdapter(e.adapter||jD.adapter)(e).then(function(n){return YD(e),n.data=WD.call(e,e.transformResponse,n),n.headers=ku.from(n.headers),n},function(n){return z3(n)||(YD(e),n&&n.response&&(n.response.data=WD.call(e,e.transformResponse,n.response),n.response.headers=ku.from(n.response.headers))),Je.reject(n)})}const l5="1.7.9",hI={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{hI[e]=function(i){return typeof i===e||"a"+(n<1?"n ":" ")+e}});const u5={};hI.transitional=function(e,n,i){function o(c,u){return"[Axios v"+l5+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new $n(o(u," has been removed"+(n?" in "+n:"")),$n.ERR_DEPRECATED);return n&&!u5[u]&&(u5[u]=!0,console.warn(o(u," has been deprecated since v"+n+" and will be removed in the near future"))),!e||e(c,u,h)}},hI.spelling=function(e){return(n,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var pI={assertOptions:function(e,n,i){if(typeof e!="object")throw new $n("options must be an object",$n.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=n[u];if(h){const f=e[u],_=f===void 0||h(f,u,e);if(_!==!0)throw new $n("option "+u+" must be "+_,$n.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new $n("Unknown option "+u,$n.ERR_BAD_OPTION)}},validators:hI};const Ad=pI.validators;let fI=class{constructor(e){this.defaults=e,this.interceptors={request:new m4,response:new m4}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{}).url=e:n=e||{},n=Ug(this.defaults,n);const{transitional:i,paramsSerializer:o,headers:c}=n;i!==void 0&&pI.assertOptions(i,{silentJSONParsing:Ad.transitional(Ad.boolean),forcedJSONParsing:Ad.transitional(Ad.boolean),clarifyTimeoutError:Ad.transitional(Ad.boolean)},!1),o!=null&&(Xe.isFunction(o)?n.paramsSerializer={serialize:o}:pI.assertOptions(o,{encode:Ad.function,serialize:Ad.function},!0)),pI.assertOptions(n,{baseUrl:Ad.spelling("baseURL"),withXsrfToken:Ad.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=c&&Xe.merge(c.common,c[n.method]);c&&Xe.forEach(["delete","get","head","post","put","patch","common"],P=>{delete c[P]}),n.headers=ku.concat(u,c);const h=[];let f=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(n)===!1||(f=f&&P.synchronous,h.unshift(P.fulfilled,P.rejected))});const _=[];let v;this.interceptors.response.forEach(function(P){_.push(P.fulfilled,P.rejected)});let y,w=0;if(!f){const P=[c5.bind(this),void 0];for(P.unshift.apply(P,h),P.push.apply(P,_),y=P.length,v=Je.resolve(n);w<y;)v=v.then(P[w++],P[w++]);return v}y=h.length;let I=n;for(w=0;w<y;){const P=h[w++],j=h[w++];try{I=P(I)}catch(x){j.call(this,x);break}}try{v=c5.call(this,I)}catch(P){return Je.reject(P)}for(w=0,y=_.length;w<y;)v=v.then(_[w++],_[w++]);return v}getUri(e){return f4(q3((e=Ug(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Xe.forEach(["delete","get","head","options"],function(e){fI.prototype[e]=function(n,i){return this.request(Ug(i||{},{method:e,url:n,data:(i||{}).data}))}}),Xe.forEach(["post","put","patch"],function(e){function n(i){return function(o,c,u){return this.request(Ug(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}fI.prototype[e]=n(),fI.prototype[e+"Form"]=n(!0)});var mI=fI;class XD{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Je(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new Je(f=>{o.subscribe(f),u=f}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},n(function(c,u,h){o.reason||(o.reason=new EE(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){this.reason?n(this.reason):this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const n=new AbortController,i=o=>{n.abort(o)};return this.subscribe(i),n.signal.unsubscribe=()=>this.unsubscribe(i),n.signal}static source(){let n;return{token:new XD(function(o){n=o}),cancel:n}}}var due=XD;const JD={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(JD).forEach(e=>{let[n,i]=e;JD[i]=n});var hue=JD;const ks=function e(n){const i=new mI(n),o=XB(mI.prototype.request,i);return Xe.extend(o,mI.prototype,i,{allOwnKeys:!0}),Xe.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(Ug(n,c))},o}(jD);ks.Axios=mI,ks.CanceledError=EE,ks.CancelToken=due,ks.isCancel=z3,ks.VERSION=l5,ks.toFormData=qC,ks.AxiosError=$n,ks.Cancel=ks.CanceledError,ks.all=function(e){return Je.all(e)},ks.spread=function(e){return function(n){return e.apply(null,n)}},ks.isAxiosError=function(e){return Xe.isObject(e)&&e.isAxiosError===!0},ks.mergeConfig=Ug,ks.AxiosHeaders=ku,ks.formToJSON=e=>W3(Xe.isHTMLForm(e)?new FormData(e):e),ks.getAdapter=a5.getAdapter,ks.HttpStatusCode=hue,ks.default=ks;var No=ks;const pue=()=>{};function KT(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:pue};return e.promise=new Je((n,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,n(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const gI=new Map,_I=new Map,Od=new Map;let Ai=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),An=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const d5=new Poe;let Du=d5.getResult(),QD=null;function mn(e){if(!QD){Du=d5.getResult();const n=function(f){if(f.engine.name==="Blink"&&f.browser.name!=="WeChat")return An.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return An.CHROME;case"Safari":case"Mobile Safari":return An.SAFARI;case"Edge":return An.EDGE;case"Firefox":return An.FIREFOX;case"QQ":case"QQBrowser":return An.QQ;case"Opera":return An.OPERA;case"WeChat":return An.WECHAT;default:return f.browser.name||""}}(Du),i=h5(Du),o=function(f){return f.os.name==="Windows"?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||""}(Du),c=Du.os.version,u=h5(Du,!1),h=Du.device.type;if(!(n&&i&&o&&c))return{name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};QD={name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return QD}function h5(e){let n,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return n=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?n.split(".")[0]:n}function vI(){return mn().os}function p5(){const e=mn();return"".concat(e.os," ").concat(e.osVersion)}function EI(){const e=mn();return!!(Du.engine.name==="WebKit"&&e.os===Ai.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==An.SAFARI||io()&&e.name!==An.SAFARI)}function Xh(){return mn().name===An.CHROME}function as(){return mn().name===An.SAFARI}function f5(){return mn().name===An.EDGE}function Nr(){return mn().name===An.FIREFOX}function io(){return mn().os===Ai.IOS}function $T(e){const n=mn();return!(n.name!==An.CHROME||!n.osVersion)&&Number(n.version)>=e}function m5(e){const n=mn();return!(n.name!==An.CHROME||!n.osVersion)&&Number(n.version)<e}function ZD(e,n,i){const o=mn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=n&&Number(o.version)<=i:Number(o.version)===n)}function e1(e){const n=mn();return!(n.name!==An.EDGE||!n.osVersion)&&Number(n.version)>=e}function g5(e){const n=mn();return!(n.name!==An.SAFARI||!n.osVersion)&&Number(n.version)>=e}function _5(e,n,i){const o=mn();if(o.os!==Ai.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e}function v5(e,n,i){const o=mn();if(o.name!==An.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e:n?Number(c[0])===e&&Number(c[1])<=n||Number(c[0])<e:Number(c[0])<=e}function t1(e){const n=mn();return!(n.name!==An.OPERA||!n.osVersion)&&Number(n.version)>=e}function E5(){const e=mn();if(e.os!==Ai.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])<14||Number(n[0])===14&&Number(n[1])<=6}function yE(){const e=mn();if(e.os!==Ai.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15}function n1(){const e=mn();if(e.os!==Ai.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===16}function y5(){const e=mn();if(e.os!==Ai.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15&&Number(n[1])>=1}function kl(){return as()&&navigator.maxTouchPoints>0}function S5(){return mn().name===An.WECHAT}function T5(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function r1(){const e=vI();return function(){const{deviceType:n}=mn();return n==="mobile"||n==="tablet"}()||e===Ai.ANDROID||e===Ai.IOS||e===Ai.HARMONY_OS}function Jh(){const e=mn();return e.name!==An.EDGE&&e.name!==An.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function yI(){return vI()===Ai.ANDROID}function qT(){const e=mn();return yI()&&(e.name===An.CHROME||e.name===An.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function b5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function it(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?b5(Object(i),!0).forEach(function(o){Ut(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):b5(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Ut(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var _=f.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}let Y=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Ie=class extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),Ut(this,"code",void 0),Ut(this,"message",void 0),Ut(this,"data",void 0),Ut(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Qh(e,n){if(typeof e!="boolean")throw new Ie(Y.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function Ti(e,n,i){if(!$e(i).call(i,e))throw new Ie(Y.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(i)))}function qn(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Ie(Y.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function i1(e,n){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ie(Y.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));e.min!==void 0&&qn(e.min,"".concat(n,".min"),0,1/0),e.max!==void 0&&qn(e.max,"".concat(n,".max"),1,1/0),e.exact!==void 0&&qn(e.exact,"".concat(n,".exact"),1,1/0),e.ideal!==void 0&&qn(e.ideal,"".concat(n,".ideal"),1,1/0)}else qn(e,n,1,1/0)}function $i(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ie(Y.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!w5(e,i,o,c))throw new Ie(Y.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Zh(e,n){if(!Array.isArray(e))throw new Ie(Y.INVALID_PARAMS,"".concat(n," should be an array"))}function kr(e){return e==null}function w5(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=n&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var YT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(YT||{}),s1=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(s1||{});const R5=new class{constructor(){Ut(this,"_clientSize",null),Ut(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ut(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ut(this,"getStyle",e=>window.getComputedStyle(e,null)),Ut(this,"checkCssVisibleProperty",e=>{var n;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:f}=o;return(c==="none"||$e(n=["hidden","collapse"]).call(n,u)||Number(h)<.1)&&(i=!1),!!i&&(f&&f.split(" ").filter(_=>{var v;const y=_.split("(")[0];return $e(v=["brightness","blur","opacity"]).call(v,y)}).map(_=>{const[v,y]=_.split(/\(|\)/);return[v,Number(y.match(/^[0-9\.]+/))]}).forEach(_=>{const[v,y]=_;switch(v){case"brightness":(y<.1||y>3)&&(i=!1);break;case"blur":y>3&&(i=!1);break;case"opacity":y<.1&&(i=!1)}}),i)}),Ut(this,"checkPropertyUpToAllParentNodes",(e,n)=>{let i=!0,o=!0;const c=h=>n(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),Ut(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ut(this,"getSizeAboutClient",e=>{const{width:n,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),f=this.getClientWidth(),_=this.getClientHeight();return{width:n,height:i,left:o,right:c,top:u,bottom:h,clientWidth:f,clientHeight:_,clientMin:Math.min(f,_)}}),Ut(this,"checkActualSize",()=>{const{width:e,height:n,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,n,i)}),Ut(this,"elementFromPoint",(e,n)=>document.elementFromPoint?document.elementFromPoint(e,n):null),Ut(this,"checkCoverForAPoint",(e,n,i)=>{const o=this.elementFromPoint(e,n);return o!==null&&o!==i}),Ut(this,"getPointPositionList",()=>{const{width:e,height:n,left:i,top:o}=this._clientSize,c=e/6,u=n/6,h=[],f=10**6;for(let _=0;_<5;_++)for(let v=0;v<5;v++){const y=(i*f+(_===0?.1:_===4?(c*_*f-1e5)/f:c*_)*f)/f,w=(o*f+(v===0?.1:v===4?(u*v*f-1e5)/f:u*v)*f)/f;h.push({x:y,y:w})}return[...h]}),Ut(this,"checkElementCover",e=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,e)).filter(n=>!!n).length>6),Ut(this,"checkSizeIsVisible",(e,n,i)=>(e>50||i/e<=10)&&(n>50||i/n<=10)),Ut(this,"checkSizeOfPartInClient",()=>{const{left:e,right:n,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let f,_,v,y;if(e<0)f=0;else{if(!(e<u))return!1;f=e}if(n<0)return!1;if(_=n<u?n:u,i<0)v=0;else{if(!(i<c))return!1;v=i}if(o<0)return!1;y=o<c?o:c;const w=_-f,I=y-v;return this.checkSizeIsVisible(w,I,h)}),Ut(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ut(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(YT.COVERED);{const n=this.checkActualSize(),i=this.checkSizeOfPartInClient();return n&&!i?this.returnHiddenResult(YT.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(YT.SIZE)}}return this.returnHiddenResult(YT.STYLE)}return this.returnHiddenResult(s1.UNMOUNTED)}return this.returnHiddenResult(s1.INVALID_HTML_ELEMENT)}),Ut(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,n=>n.nodeName.toUpperCase()!=="HTML"?n.parentElement!==null:!!document.documentElement))}};function o1(e){return new TextEncoder().encode(e)}const C5=function(e,n){const i=new Uint8Array(e.byteLength+n.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(n),e.byteLength),i},a1=async e=>function(n,i){let o="";return new Uint8Array(n).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",o1(e)),16);let Rr=class{constructor(){Ut(this,"_events",{}),Ut(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<n.length;u+=1){const h=n[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,n){let i=e.length;for(;i--;)if(e[i].listener===n)return i;return-1}},XT=null;function I5(){if(XT)return XT;if(window.electron)return XT=window.electron;if(!window.require)return null;try{return XT=window.require("electron"),XT}catch{return null}}let hi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Dr=function(e){return e.TRACER="tracer",e}({});function A5(e){return qn(e.timeout,"config.timeout",0,1e5),qn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),qn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),qn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let fue=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ln=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function JT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function O5(e){return $i(e.turnServerURL,"turnServerURL"),$i(e.username,"username"),$i(e.password,"password"),e.udpport&&qn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Qh(e.forceturn,"forceturn"),e.security&&Qh(e.security,"security"),e.tcpport&&qn(e.tcpport,"tcpport",1,99999,!0),!0}function c1(e){return e.level!==void 0&&Ti(e.level,"level",[1,2,3]),e.delay!==void 0&&qn(e.delay,"delay",0,3e3,!0),!0}let rn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),cs=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),xa=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),SE=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ls(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(n).length===0?Je.reject(new Ie(Y.UNEXPECTED_ERROR,"can not emit promise")):new Je((u,h)=>{e.emit(n,...o,u,h)})}function Qn(e,n){if(e.getListeners(n).length===0)return Je.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return ls(e,n,...o)}function dc(e,n){if(e.getListeners(n).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return QT(e,n,...o)}function QT(e,n){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(n,...u,f=>{i=f},f=>{o=f}),o!==null)throw o;if(i===null)throw new Ie(Y.UNEXPECTED_ERROR,"handler is not sync");return i}const ni=new class extends Rr{set networkState(e){this.emit(SE.NETWORK_STATE_CHANGE,e,this._networkState),e===xa.ONLINE?this.emit(SE.ONLINE):e===xa.OFFLINE&&(this.onlineWaiter=new Je(n=>{this.once(SE.ONLINE,()=>{this.onlineWaiter=void 0,n(xa.ONLINE)})}),this.emit(SE.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===xa.ONLINE}constructor(){super(),Ut(this,"_moduleName","network-indicator"),Ut(this,"_networkState",xa.ONLINE),Ut(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=xa.ONLINE}),window.addEventListener("offline",()=>{this.networkState=xa.OFFLINE})}};function SI(e,n){const i=e.indexOf(n);i!==-1&&e.splice(i,1)}function TE(e){const n=[];return e.forEach(i=>{n.indexOf(i)===-1&&n.push(i)}),n}function TI(e){Je!==void 0?Je.resolve().then(e):setTimeout(e,0)}function Lr(e){return JSON.parse(JSON.stringify(e))}function Vg(e){try{return Lr(e)}catch{return e}}const P5={};function Df(e,n){P5[n]||(P5[n]=!0,e())}function Fg(e){const n=window.atob(e),i=new Uint8Array(new ArrayBuffer(n.length));for(let o=0;o<n.length;o+=1)i[o]=n.charCodeAt(o);return i}function Lf(e){let n="";for(let i=0;i<e.length;i+=1)n+=String.fromCharCode(e[i]);return window.btoa(n)}function N5(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>n)i=i.slice(0,n);else if(i.length<n){const o=new Uint8Array(n);o.set(i),i=o}return i}function k5(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=Ia(n).call(n,(h,f)=>h+f.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return n.forEach(h=>{c.set(h,u),u+=h.length}),c}function Pd(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function D5(e){let n=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{n+=typeof i=="string"?Pd(i):i.size}),n+138}function mue(e){const n=new Ie(Y.TIMEOUT,"timeout");return new Je((i,o)=>{window.setTimeout(()=>o(n),e)})}function qi(e){return new Je(n=>{window.setTimeout(n,e)})}function Zn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(n).concat(i):"".concat(n).concat(i)+Zn(e-i.length,"")}function jg(){return Zn(32,"").toUpperCase()}const bI=()=>{},L5=new class{constructor(){Ut(this,"fnMap",new Map)}throttleByKey(e,n,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(n)){const f=this.fnMap.get(n);if(f.threshold!==i){f.fn(...f.args),clearTimeout(f.timer);const _=window.setTimeout(()=>{const v=this.fnMap.get(n);v&&v.fn(...v.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(n,it(it({},f),{},{fn:e,args:u,skipFn:o}))}else{const f=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:f,args:u,skipFn:o})}}},x5=L5.throttleByKey.bind(L5);function M5(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function l1(e,n){if(!M5(e)||!M5(n)||Array.isArray(e)&&!Array.isArray(n)||!Array.isArray(e)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(e)){const i=[...e];for(let o=0;o<n.length;o++)i[o]=l1(e[o],n[o]);return i}{const i=it({},e);for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=l1(e[o],n[o]):i[o]=n[o]);return i}}function U5(e,n){let i=[0];if(i=new Array(n).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==n););return i}function u1(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function V5(e){const n="0123456789abcdef";function i(oe){let me,ge="";for(me=0;me<=3;me++)ge+=n.charAt(oe>>8*me+4&15)+n.charAt(oe>>8*me&15);return ge}function o(oe,me){const ge=(65535&oe)+(65535&me);return(oe>>16)+(me>>16)+(ge>>16)<<16|65535&ge}function c(oe,me,ge,fe,Re,Ue){return o(function(Qe,rt){return Qe<<rt|Qe>>>32-rt}(o(o(me,oe),o(fe,Ue)),Re),ge)}function u(oe,me,ge,fe,Re,Ue,Qe){return c(me&ge|~me&fe,oe,me,Re,Ue,Qe)}function h(oe,me,ge,fe,Re,Ue,Qe){return c(me&fe|ge&~fe,oe,me,Re,Ue,Qe)}function f(oe,me,ge,fe,Re,Ue,Qe){return c(me^ge^fe,oe,me,Re,Ue,Qe)}function _(oe,me,ge,fe,Re,Ue,Qe){return c(ge^(me|~fe),oe,me,Re,Ue,Qe)}const v=function(oe){let me;const ge=1+(oe.length+8>>6),fe=new Array(16*ge);for(me=0;me<16*ge;me++)fe[me]=0;for(me=0;me<oe.length;me++)fe[me>>2]|=oe.charCodeAt(me)<<me%4*8;return fe[me>>2]|=128<<me%4*8,fe[16*ge-2]=8*oe.length,fe}(e);let y,w,I,P,j,x=1732584193,M=-271733879,$=-1732584194,q=271733878;for(y=0;y<v.length;y+=16)w=x,I=M,P=$,j=q,x=u(x,M,$,q,v[y+0],7,-680876936),q=u(q,x,M,$,v[y+1],12,-389564586),$=u($,q,x,M,v[y+2],17,606105819),M=u(M,$,q,x,v[y+3],22,-1044525330),x=u(x,M,$,q,v[y+4],7,-176418897),q=u(q,x,M,$,v[y+5],12,1200080426),$=u($,q,x,M,v[y+6],17,-1473231341),M=u(M,$,q,x,v[y+7],22,-45705983),x=u(x,M,$,q,v[y+8],7,1770035416),q=u(q,x,M,$,v[y+9],12,-1958414417),$=u($,q,x,M,v[y+10],17,-42063),M=u(M,$,q,x,v[y+11],22,-1990404162),x=u(x,M,$,q,v[y+12],7,1804603682),q=u(q,x,M,$,v[y+13],12,-40341101),$=u($,q,x,M,v[y+14],17,-1502002290),M=u(M,$,q,x,v[y+15],22,1236535329),x=h(x,M,$,q,v[y+1],5,-165796510),q=h(q,x,M,$,v[y+6],9,-1069501632),$=h($,q,x,M,v[y+11],14,643717713),M=h(M,$,q,x,v[y+0],20,-373897302),x=h(x,M,$,q,v[y+5],5,-701558691),q=h(q,x,M,$,v[y+10],9,38016083),$=h($,q,x,M,v[y+15],14,-660478335),M=h(M,$,q,x,v[y+4],20,-405537848),x=h(x,M,$,q,v[y+9],5,568446438),q=h(q,x,M,$,v[y+14],9,-1019803690),$=h($,q,x,M,v[y+3],14,-187363961),M=h(M,$,q,x,v[y+8],20,1163531501),x=h(x,M,$,q,v[y+13],5,-1444681467),q=h(q,x,M,$,v[y+2],9,-51403784),$=h($,q,x,M,v[y+7],14,1735328473),M=h(M,$,q,x,v[y+12],20,-1926607734),x=f(x,M,$,q,v[y+5],4,-378558),q=f(q,x,M,$,v[y+8],11,-2022574463),$=f($,q,x,M,v[y+11],16,1839030562),M=f(M,$,q,x,v[y+14],23,-35309556),x=f(x,M,$,q,v[y+1],4,-1530992060),q=f(q,x,M,$,v[y+4],11,1272893353),$=f($,q,x,M,v[y+7],16,-155497632),M=f(M,$,q,x,v[y+10],23,-1094730640),x=f(x,M,$,q,v[y+13],4,681279174),q=f(q,x,M,$,v[y+0],11,-358537222),$=f($,q,x,M,v[y+3],16,-722521979),M=f(M,$,q,x,v[y+6],23,76029189),x=f(x,M,$,q,v[y+9],4,-640364487),q=f(q,x,M,$,v[y+12],11,-421815835),$=f($,q,x,M,v[y+15],16,530742520),M=f(M,$,q,x,v[y+2],23,-995338651),x=_(x,M,$,q,v[y+0],6,-198630844),q=_(q,x,M,$,v[y+7],10,1126891415),$=_($,q,x,M,v[y+14],15,-1416354905),M=_(M,$,q,x,v[y+5],21,-57434055),x=_(x,M,$,q,v[y+12],6,1700485571),q=_(q,x,M,$,v[y+3],10,-1894986606),$=_($,q,x,M,v[y+10],15,-1051523),M=_(M,$,q,x,v[y+1],21,-2054922799),x=_(x,M,$,q,v[y+8],6,1873313359),q=_(q,x,M,$,v[y+15],10,-30611744),$=_($,q,x,M,v[y+6],15,-1560198380),M=_(M,$,q,x,v[y+13],21,1309151649),x=_(x,M,$,q,v[y+4],6,-145523070),q=_(q,x,M,$,v[y+11],10,-1120210379),$=_($,q,x,M,v[y+2],15,718787259),M=_(M,$,q,x,v[y+9],21,-343485551),x=o(x,w),M=o(M,I),$=o($,P),q=o(q,j);return i(x)+i(M)+i($)+i(q)}let gue=1,F5=console,vs=class{static setLogger(e){F5=e}constructor(e,n){Ut(this,"id",void 0),Ut(this,"lockingPromise",Je.resolve()),Ut(this,"locks",0),Ut(this,"name",""),Ut(this,"lockId",void 0),this.lockId=gue++,e&&(this.name=e),n&&(this.id=n),this.logger("created")}logger(e,n){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(n??"");F5.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let n;this.locks+=1,this.logger("locked",e);const i=new Je(c=>{n=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function bE(e,n){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(e));const f=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,v=new Array(_),y=0;y<_;y++)v[y]=arguments[y];return await u.apply(this,v)}finally{f()}},c}}const pi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function d1(e,n){const i=Math.floor(n.timeout*Math.pow(n.timeoutFactor,e));return Math.min(n.maxRetryTimeout,i)}function Lu(e,n,i,o){const c=Object.assign({},pi,o);let u=c.timeout;const h=async()=>{await function(v){return new Je(y=>{window.setTimeout(y,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let f=!1;const _=new Je(async(v,y)=>{n=n||(()=>!1),i=i||(()=>!0);for(let w=0;w<c.maxRetryCount;w+=1){if(f)return y(new Ie(Y.OPERATION_ABORTED));try{const I=await e();if(!n(I,w)||w+1===c.maxRetryCount)return v(I);await h()}catch(I){if(!i(I,w)||w+1===c.maxRetryCount)return y(I);await h()}}});return _.cancel=()=>f=!0,_}let wI,j5=class{constructor(e){Ut(this,"input",[]),Ut(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ia(e=this.input).call(e,(n,i)=>n+i)/this.input.length}},RI=0,h1=0;function p1(e,n,i,o){return new Je((c,u)=>{n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),RI+=Pd(n.data)):i&&(n.data.size?RI+=n.data.size:n.data instanceof FormData?RI+=D5(n.data):RI+=Pd(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,No.request(n).then(h=>{typeof h.data=="string"?h1+=Pd(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?h1+=h.data.byteLength:h1+=Pd(JSON.stringify(h.data)),c(h.data)}).catch(h=>{No.isCancel(h)?u(new Ie(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Ie(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new Ie(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Ie(Y.NETWORK_ERROR,h.message))})})}async function _ue(e,n){const i=new Blob([n.data],{type:"buffer"});return await p1(e,it(it({},n),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const B5=()=>window.isSecureContext!==void 0;function Dl(e){if(Array.isArray(e))return e.map(i=>i);if(!W5(e))return e;const n={};for(const i in e){const o=e[i];W5(o)||Array.isArray(o)?n[i]=Dl(o):n[i]=o}return n}function W5(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let f1=class{constructor(e){Ut(this,"input",[]),Ut(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Nd={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},ZT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Nd,remoteCandidate:Nd},updateInterval:0},G5={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},z5={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},H5={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},K5={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let m1=class{constructor(e,n){Ut(this,"onFirstVideoReceived",void 0),Ut(this,"onFirstVideoDecoded",void 0),Ut(this,"onFirstAudioReceived",void 0),Ut(this,"onFirstVideoDecodedTimeout",void 0),Ut(this,"onFirstAudioDecoded",void 0),Ut(this,"onSelectedLocalCandidateChanged",void 0),Ut(this,"onSelectedRemoteCandidateChanged",void 0),Ut(this,"videoIsReady",!1),Ut(this,"videoIsReady2",{}),Ut(this,"pc",void 0),Ut(this,"options",void 0),Ut(this,"intervalTimer",void 0),Ut(this,"stats",Dl(ZT)),Ut(this,"isFirstVideoReceived",{}),Ut(this,"isFirstVideoDecoded",{}),Ut(this,"isFirstAudioReceived",{}),Ut(this,"isFirstAudioDecoded",{}),Ut(this,"isFirstVideoDecodedTimeout",{}),Ut(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Je(e=>{e({local:it({},Nd),remote:it({},Nd)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const f of i)e[f].forEach((_,v)=>{if(!this.lossRateWindowStats[n-1][f][v]||!this.lossRateWindowStats[0][f][v])return;const y=this.lossRateWindowStats[n-1][f][v].packets-this.lossRateWindowStats[0][f][v].packets,w=this.lossRateWindowStats[n-1][f][v].packetsLost-this.lossRateWindowStats[0][f][v].packetsLost;f==="videoSend"||f==="audioSend"?(o+=y,u+=w):(c+=y,h+=w),Number.isNaN(y)||Number.isNaN(y)?_.packetLostRate=0:_.packetLostRate=y<=0||w<=0?0:w/(y+w)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},vue=class extends m1{constructor(){super(...arguments),Ut(this,"_stats",ZT),Ut(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=Dl(ZT);const i=n.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=n.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var i;const o=$e(i=n.id).call(i,"send");switch("".concat(n.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=Dl(z5);c.codec=n.googCodecName,c.adaptionChangeReason="none",n.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(n.googAvgEncodeMs),c.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.firsCount=Number(n.googFirReceived),c.nacksCount=Number(n.googNacksReceived),c.plisCount=Number(n.googPlisReceived),c.frameCount=Number(n.framesEncoded),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Dl(G5),u=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(c.codec=n.googCodecName,c.targetDelayMs=Number(n.googTargetDelayMs),c.renderDelayMs=Number(n.googRenderDelayMs),c.currentDelayMs=Number(n.googCurrentDelayMs),c.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),c.decodeMs=Number(n.googDecodeMs),c.maxDecodeMs=Number(n.googMaxDecodeMs),c.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},c.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},c.decodeFrameRate=Number(n.googFrameRateDecoded),c.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},c.jitterBufferMs=Number(n.googJitterBufferMs),c.firsCount=Number(n.googFirsSent),c.nacksCount=Number(n.googNacksSent),c.plisCount=Number(n.googPlisSent),c.framesDecodeCount=Number(n.framesDecoded),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,f=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=f,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:it({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Dl(K5);c.codec=n.googCodecName,c.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,c.decodingCNG=Number(n.googDecodingCNG),c.decodingCTN=Number(n.googDecodingCTN),c.decodingCTSG=Number(n.googDecodingCTSG),c.decodingNormal=Number(n.googDecodingNormal),c.decodingPLC=Number(n.googDecodingPLC),c.decodingPLCCNG=Number(n.googDecodingPLCCNG),c.expandRate=Number(n.googExpandRate),c.accelerateRate=Number(n.googAccelerateRate),c.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),c.speechExpandRate=Number(n.googSpeechExpandRate),c.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),c.jitterBufferMs=Number(n.googJitterBufferMs),c.jitterMs=Number(n.googJitterReceived),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),c.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Dl(H5);c.codec=n.googCodecName,c.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,c.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new Je((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),n.push(o)}),n}},e0=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),CI=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),g1=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),hc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var wE=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(wE||{});function t0(e,n,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:wE.kNone;if(!n)return;const u=Number(n[i]);if(typeof u!="number")return;const h=Number(n[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const f=Number(e[i]);if(typeof f!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const v=h-_;return v?(u-f)/v*c:void 0}let $5=class extends m1{constructor(){super(...arguments),Ut(this,"_stats",ZT),Ut(this,"report",void 0),Ut(this,"lastDecodeVideoReceiverStats",new Map),Ut(this,"lastVideoFramesRecv",new Map),Ut(this,"lastVideoFramesSent",new Map),Ut(this,"lastVideoFramesDecode",new Map),Ut(this,"lastVideoFramesOutput",new Map),Ut(this,"lastVideoJBDelay",new Map),Ut(this,"lastAudioJBDelay",new Map),Ut(this,"mediaBytesSent",new Map),Ut(this,"mediaBytesRetransmit",new Map),Ut(this,"mediaBytesTargetEncode",new Map),Ut(this,"lastDecodeAudioReceiverStats",new Map),Ut(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Dl(ZT),this.report.forEach(e=>{switch(e.type){case hc.OUTBOUND:case hc.INBOUND:{const n=e.mediaType||e.kind,i=!n&&"frameWidth"in e,o=!n&&!("frameWidth"in e);e.type===hc.OUTBOUND?n==="audio"||o?this.processAudioOutboundStats(e):(n==="video"||i)&&this.processVideoOutboundStats(e):e.type===hc.INBOUND&&(n==="audio"||o?this.processAudioInboundStats(e):(n==="video"||i)&&this.processVideoInboundStats(e));break}case hc.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case hc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:it({},Nd),remote:it({},Nd)};return e.forEach(i=>{let o;if(i.type===hc.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===hc.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(n.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(n.remote,u)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===hc.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===hc.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===hc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(it({},n),it({},this.stats.selectedCandidatePair.localCandidate)),e.type===hc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(it({},n),it({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);n||(n=Dl(K5),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived,n.totalProcessingDelay=e.totalProcessingDelay,n.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(n.ssrc);n.avgProcessingDelayMs=t0(i,n,"totalProcessingDelay","jitterBufferEmittedCount",wE.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(n.ssrc,it({},n))}processVideoInboundStats(e){let n=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);n||(n=Dl(G5),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration,n.totalProcessingDelay=e.totalProcessingDelay,n.packetsDiscarded=e.packetsDiscarded,n.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,n.totalAssemblyTime=e.totalAssemblyTime,n.keyFramesDecoded=e.keyFramesDecoded,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),c=this.lastVideoFramesOutput.get(n.ssrc),u=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const h=n.decodedFrame?n.decodedFrame.width:0,f=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,h,f),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const h=i.stats,f=u-i.lts;n.framesDecodeFreezeTime=h.framesDecodeFreezeTime,n.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=f,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<h.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime,n.avgDecodeMs=t0(i==null?void 0:i.stats,n,"decodeMs","framesDecodeCount")),n.avgProcessingDelayMs=t0(i==null?void 0:i.stats,n,"totalProcessingDelay","framesDecodeCount",wE.kMillisecondsFromSeconds),n.avgFramesAssembledFromMultiplePacketsMs=t0(i==null?void 0:i.stats,n,"totalAssemblyTime","framesAssembledFromMultiplePackets",wE.kMillisecondsFromSeconds),n.avgInterFrameDelayMs=t0(i==null?void 0:i.stats,n,"totalInterFrameDelay","framesDecodeCount",wE.kMillisecondsFromSeconds),o&&u-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:0}),n.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:Math.max(n.outputFrameRate,0)})):c?n.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:it({},n),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);n||(n=Dl(z5),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new f1(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new f1(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new f1(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,n.hugeFramesSent=e.hugeFramesSent,n.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const o=this.findRemoteStatsId(e.ssrc,hc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(n||(n=Dl(H5),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,hc.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(e,n){var i;const o=Array.from(lc(i=this.report).call(i)).find(c=>c.type===n&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,n){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,n){const i=this.report.get(e);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,n,i){var o,c,u,h;const f=n?this.report.get(n):void 0,_=(o=f==null?void 0:f.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let v=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:e.frameWidth,y=(u=f==null?void 0:f.frameHeight)!==null&&u!==void 0?u:e.frameHeight,w=(h=f==null?void 0:f.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof v=="number"&&typeof y=="number"||(v=0,y=0),w==null){const I=Date.now(),P=this.lastVideoFramesSent.get(i.ssrc);P&&I-P.lts>=800?(w=Math.round((_-P.count)/((I-P.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:I,rate:w})):P?w=P.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:I,rate:0})}i.sentFrame={width:v,height:y,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(e,n,i){var o,c,u,h,f;const _=n?this.report.get(n):void 0,v=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,y=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,w=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,I=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,P=(f=_==null?void 0:_.jitterBufferEmittedCount)!==null&&f!==void 0?f:e.jitterBufferEmittedCount;if(typeof v=="number"){const j=this.lastVideoFramesRecv.get(i.ssrc),x=Date.now();i.framesReceivedCount=v;let M=0;j&&x-j.lts>=800?(M=Math.round((v-j.count)/((x-j.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:x,rate:M})):j?M=j.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:x,rate:0}),i.receivedFrame={width:y||0,height:w||0,frameRate:M||0},i.decodedFrame={width:y||0,height:w||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:y||0,height:w||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(I&&P){const j=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let x=j.jitterBufferMs;const M=P-j.jitterBufferEmittedCount;M>0&&(x=1e3*(I-j.jitterBufferDelay)/M),i.jitterBufferMs=x,i.currentDelayMs=Math.round(x),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:P,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,n,i){var o,c,u,h;const f=n?this.report.get(n):void 0,_=(o=(c=f==null?void 0:f.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,v=(u=(h=f==null?void 0:f.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(e,n,i){var o,c,u,h,f,_,v;const y=n?this.report.get(n):void 0,w=(o=y==null?void 0:y.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,I=(c=y==null?void 0:y.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,P=(u=y==null?void 0:y.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,j=(h=y==null?void 0:y.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,x=(f=y==null?void 0:y.audioLevel)!==null&&f!==void 0?f:e==null?void 0:e.audioLevel,M=(_=y==null?void 0:y.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,$=(v=y==null?void 0:y.concealedSamples)!==null&&v!==void 0?v:e.concealedSamples;if(typeof I=="number"&&(i.totalSamplesReceived=I),w&&I&&(i.accelerateRate=w/I),P&&j){const oe=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let me=oe.jitterBufferMs;const ge=j-oe.jitterBufferEmittedCount;ge>0&&(me=1e3*(P-oe.jitterBufferDelay)/ge),i.jitterBufferMs=Math.round(me),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:j,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=x;let q=1920;M&&I&&(q=I/M/50,i.receivedFrames=Math.round(I/q)),$&&(i.droppedFrames=Math.round($/q))}processRemoteInboundStats(e,n){const i=this.report.get(e);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime),i.jitter&&(n.jitterMs=1e3*i.jitter),i.timestamp&&(n.timestamp=i.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,n=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{n=n===null?c.diffMean():n+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Eue=class extends m1{updateStats(){return Je.resolve()}};function _1(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new vue(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new $5(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const f=h.getStats();return!!(f instanceof Je||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(f))}(e)?new $5(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Eue(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const q5="websdk_ng_install_id";function v1(){try{if(Q("INSTALL_ID"))return Q("INSTALL_ID");let e=window.localStorage.getItem(q5);return e||(e=jg(),window.localStorage.setItem(q5,e)),Hn("INSTALL_ID",e),e}catch{return}}const Yc=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],o=n[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),E1=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Bg=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const us=function(){const e="us".concat("erna","me"),n="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let f=0;f<6;f++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[n]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=us;const II={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},y1={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},S1="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",T1={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},lr=it(it(it({},T1),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:y1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},II),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Hn(e,n,i){var o,c,u;$e(o=Object.keys(lr)).call(o,e)&&(!i&&$e(c=Object.keys(xu)).call(c,e)||(lr[e]=n,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||n!==!0||(lr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(lr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&n&&(u=!!n,lr.USE_NEW_NETWORK_CONFIG=u,u&&(lr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],lr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],lr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],lr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],lr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",lr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",lr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&n&&(lr.ENABLE_INSTANT_VIDEO=!0,lr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&n&&(lr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&n&&(lr.NEW_TURN_MODE||(lr.NEW_TURN_MODE=4))))}function Q(e){return lr[e]}E1||(lr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],lr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],lr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],lr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],lr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],lr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],lr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",lr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",lr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",lr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",lr.AREAS=["NORTH_AMERICA","OVERSEA"]);let Y5=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const xu={};var sn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(sn||{});let AI=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const X5=128,yue=96,J5=1e3,RE=10;let Sue=0;var Q5=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>Qe,Printer:()=>Jr,parse:()=>He,print:()=>lt});const h=`
`,f="".concat("\r").concat(h),_=" ";let v;function y(ke){return ke>="0"&&ke<="9"}function w(ke){return ke>="!"&&ke<="~"}function I(ke){return w(ke)||ke>=""&&ke<=""}function P(ke){return ke==="!"||ke>="#"&&ke<="'"||ke>="*"&&ke<="+"||ke>="-"&&ke<="."||ke>="0"&&ke<="9"||ke>="A"&&ke<="Z"||ke>="^"&&ke<="~"}function j(ke){return ke>="1"&&ke<="9"}function x(ke){return ke>="A"&&ke<="Z"||ke>="a"&&ke<="z"}function M(ke){return ke==="d"||ke==="h"||ke==="m"||ke==="s"}function $(ke){return ke>""&&ke<"	"||ke>"\v"&&ke<"\f"||ke>""&&ke<""}function q(ke){return x(ke)||y(ke)||ke==="+"||ke==="/"}function oe(ke){return y(ke)||x(ke)||ke==="+"||ke==="/"||ke==="-"||ke==="_"}function me(ke){return x(ke)||y(ke)||ke==="+"||ke==="/"}function ge(ke,D){var ee=Object.keys(ke);if(Object.getOwnPropertySymbols){var ue=Object.getOwnPropertySymbols(ke);D&&(ue=ue.filter(function(Fe){return Object.getOwnPropertyDescriptor(ke,Fe).enumerable})),ee.push.apply(ee,ue)}return ee}function fe(ke){for(var D=1;D<arguments.length;D++){var ee=arguments[D]!=null?arguments[D]:{};D%2?ge(Object(ee),!0).forEach(function(ue){Re(ke,ue,ee[ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ke,Object.getOwnPropertyDescriptors(ee)):ge(Object(ee)).forEach(function(ue){Object.defineProperty(ke,ue,Object.getOwnPropertyDescriptor(ee,ue))})}return ke}function Re(ke,D,ee){return D in ke?Object.defineProperty(ke,D,{value:ee,enumerable:!0,configurable:!0,writable:!0}):ke[D]=ee,ke}(function(ke){ke.VERSION="v",ke.ORIGIN="o",ke.SESSION_NAME="s",ke.INFORMATION="i",ke.URI="u",ke.EMAIL="e",ke.PHONE="p",ke.CONNECTION="c",ke.BANDWIDTH="b",ke.TIME="t",ke.REPEAT="r",ke.ZONE_ADJUSTMENTS="z",ke.KEY="k",ke.ATTRIBUTE="a",ke.MEDIA="m"})(v||(v={}));class Ue{consumeText(D,ee){let ue=ee;for(;ue<D.length;){const Fe=D[ue];if(Fe==="\0"||Fe==="\r"||Fe===h)break;ue+=1}if(ue-ee==0)throw new Error("Invalid text, at ".concat(D));return ue}consumeUnicastAddress(D,ee,ue){return this.consumeTill(D,ee,_)}consumeOneOrMore(D,ee,ue){let Fe=ee;for(;ue(D[Fe]);)Fe++;if(Fe-ee==0)throw new Error("Invalid rule at ".concat(ee,"."));return Fe}consumeSpace(D,ee){if(D[ee]===_)return ee+1;throw new Error("Invalid space at ".concat(ee,"."))}consumeIP4Address(D,ee){let ue=ee;for(let Fe=0;Fe<4;Fe++)if(ue=this.consumeDecimalUChar(D,ue),Fe!==3){if(D[ue]!==".")throw new Error("Invalid IP4 address.");ue++}return ue}consumeDecimalUChar(D,ee){let ue=ee;for(let Ft=0;Ft<3&&y(D[ue]);Ft++,ue++);if(ue-ee==0)throw new Error("Invalid decimal uchar.");const Fe=parseInt(D.slice(ee,ue));if(Fe>=0&&Fe<=255)return ue;throw new Error("Invalid decimal uchar")}consumeIP6Address(D,ee){let ue=this.consumeHexpart(D,ee);return D[ue]===":"&&(ue+=1,ue=this.consumeIP4Address(D,ue)),ue}consumeHexpart(D,ee){let ue=ee;if(D[ue]===":"&&D[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(D,ue)}catch{}return ue}if(ue=this.consumeHexseq(D,ue),D[ue]===":"&&D[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(D,ue)}catch{}return ue}return ue}consumeHexseq(D,ee){let ue=ee;for(;ue=this.consumeHex4(D,ue),D[ue]===":"&&D[ue+1]!==":";)ue+=1;return ue}consumeHex4(D,ee){let ue=0;for(;ue<4;ue++)if(!((Fe=D[ee+ue])>="0"&&Fe<="9"||Fe>="a"&&Fe<="f"||Fe>="A"&&Fe<="F")){if(ue===0)throw new Error("Invalid hex 4");break}var Fe;return ee+ue}consumeFQDN(D,ee){let ue=ee;for(;y(D[ue])||x(D[ue])||D[ue]==="-"||D[ue]===".";)ue+=1;if(ue-ee<4)throw new Error("Invalid FQDN");return ue}consumeExtnAddr(D,ee){return this.consumeOneOrMore(D,ee,I)}consumeMulticastAddress(D,ee,ue){switch(ue){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(D,ee);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(D,ee);default:try{return this.consumeFQDN(D,ee)}catch{return this.consumeExtnAddr(D,ee)}}}consumeIP6MulticastAddress(D,ee){const ue=this.consumeHexpart(D,ee);return D[ue]==="/"?this.consumeInteger(D,ue+1):ue}consumeIP4MulticastAddress(D,ee){let ue=ee+3;const Fe=D.slice(ee,ue),Ft=parseInt(Fe);if(Ft<224||Ft>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Yn=0;Yn<3;Yn++){if(D[ue]!==".")throw new Error("Invalid IP4 multicast address.");ue+=1,ue=this.consumeDecimalUChar(D,ue)}return D[ue]==="/"&&(ue+=1),ue=this.consumeTTL(D,ue),D[ue]==="/"&&(ue=this.consumeInteger(D,ue)),ue}consumeInteger(D,ee){if(!j(D[ee]))throw new Error("Invalid integer.");for(ee+=1;y(D[ee]);)ee+=1;return ee}consumeTTL(D,ee){if(D[ee]==="0")return ee+1;if(!j(D[ee]))throw new Error("Invalid TTL.");ee+=1;for(let ue=0;ue<2&&y(D[ee]);ue++)ee+=1;return ee}consumeToken(D,ee){return this.consumeOneOrMore(D,ee,P)}consumeTime(D,ee){let ue=ee;if(D[ue]==="0")return ue+1;for(j(D[ue])&&(ue+=1);y(D[ue]);)ue++;if(ue-ee<10)throw new Error("Invalid time");return ue}consumeAddress(D,ee){return this.consumeTill(D,ee,_)}consumeTypedTime(D,ee){let ue=ee;return ue=this.consumeOneOrMore(D,ue,y),M(D[ue])?ue+1:ue}consumeRepeatInterval(D,ee){if(!j(D[ee]))throw new Error("Invalid repeat interval");for(ee+=1;y(D[ee]);)ee+=1;return M(D[ee])&&(ee+=1),ee}consumePort(D,ee){return this.consumeOneOrMore(D,ee,y)}consume(D,ee,ue){for(let Fe=0;Fe<ue.length;Fe++){if(ee+Fe>=D.length)throw new Error("consume exceeding value length");if(D[ee+Fe]!==ue[Fe])throw new Error("consume ".concat(ue," failed at ").concat(Fe))}return ee+ue.length}consumeTill(D,ee,ue){let Fe=ee;for(;Fe<D.length&&(typeof ue!="string"||D[Fe]!==ue)&&(typeof ue!="function"||!ue(D[Fe]));)Fe++;return Fe}}class Qe extends Ue{constructor(){super(),Re(this,"records",[]),Re(this,"currentLine",0)}parse(D){const ee=this.probeEOL(D);this.records=D.split(ee).filter(d_=>!!Ws(d_).call(d_)).map(this.parseLine),this.currentLine=0;const ue=this.parseVersion(),Fe=this.parseOrigin(),Ft=this.parseSessionName(),Yn=this.parseInformation(),Ni=this.parseUri(),ua=this.parseEmail(),dp=this.parsePhone(),u_=this.parseConnection(),V0=this.parseBandWidth(),FA=this.parseTimeFields(),jA=this.parseKey(),rl=this.parseSessionAttribute(),Qf=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ue,origin:Fe,sessionName:Ft,information:Yn,uri:Ni,emails:ua,phones:dp,connection:u_,bandwidths:V0,timeFields:FA,key:jA,attributes:rl,mediaDescriptions:Qf}}getCurrentRecord(){const D=this.records[this.currentLine];if(!D)throw new Error("Record doesn't exit.");return D}probeEOL(D){for(let ee=0;ee<D.length;ee++)if(D[ee]===h)return D[ee-1]==="\r"?f:h;throw new Error("Invalid newline character.")}parseLine(D,ee){if(D.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ue=D[0];if(D[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ue,value:D.slice(2),line:ee,cur:0}}parseSessionAttribute(){const D=new cn;for(;this.currentLine<this.records.length;){const ee=this.getCurrentRecord();if(ee.type!==v.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(ee,Fe=>P(Fe)&&Fe!==":"),_cur:0};ee.value[ee.cur]===":"&&(ee.cur+=1,ue.attValue=this.extractOneOrMore(ee,$)),D.parse(ue),this.currentLine++}return D.digest()}parseMediaAttributes(D){const ee=new ln(D);for(;this.currentLine<this.records.length;){const ue=this.getCurrentRecord();if(ue.type!==v.ATTRIBUTE)break;const Fe={attField:this.extractOneOrMore(ue,Ft=>P(Ft)&&Ft!==":"),_cur:0};ue.value[ue.cur]===":"&&(ue.cur+=1,Fe.attValue=this.extractOneOrMore(ue,$)),ee.parse(Fe),this.currentLine++}return ee.digest()}parseKey(){const D=this.getCurrentRecord();if(D.type===v.KEY){if(D.value==="prompt"||D.value==="clear:"||D.value==="base64:"||D.value==="uri:")return D.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const D=this.getCurrentRecord();if(D.type===v.ZONE_ADJUSTMENTS){const ee=[];for(;;)try{const ue=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);let Fe=!1;D.value[D.cur]==="-"&&(Fe=!0,D.cur+=1);const Ft=this.extract(D,this.consumeTypedTime);ee.push({time:ue,typedTime:Ft,back:Fe})}catch{break}if(ee.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ee}return[]}parseRepeat(){const D=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==v.REPEAT)break;{const ue=this.extract(ee,this.consumeRepeatInterval),Fe=this.parseTypedTime(ee);D.push({repeatInterval:ue,typedTimes:Fe}),this.currentLine++}}return D}parseTypedTime(D){const ee=[];for(;;)try{this.consumeSpaceForRecord(D),ee.push(this.extract(D,this.consumeTypedTime))}catch{break}if(ee.length===0)throw new Error("Invalid typed time.");return ee}parseTime(){const D=this.getCurrentRecord(),ee=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);const ue=this.extract(D,this.consumeTime);return this.currentLine++,{startTime:ee,stopTime:ue}}parseBandWidth(){const D=[];for(;this.currentLine<this.records.length;){const ee=this.getCurrentRecord();if(ee.type!==v.BANDWIDTH)break;{const ue=this.extractOneOrMore(ee,P);if(ee.value[ee.cur]!==":")throw new Error("Invalid bandwidth field.");ee.cur++;const Fe=this.extractOneOrMore(ee,y);D.push({bwtype:ue,bandwidth:Fe}),this.currentLine++}}return D}parseVersion(){const D=this.getCurrentRecord();if(D.type!==v.VERSION)throw new Error("first sdp record must be version");const ee=D.value.slice(0,this.consumeOneOrMore(D.value,0,y));if(ee.length!==D.value.length)throw new Error('invalid proto version, "v='.concat(D.value,'"'));return this.currentLine++,ee}parseOrigin(){const D=this.getCurrentRecord();if(D.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ee=this.extractOneOrMore(D,I);this.consumeSpaceForRecord(D);const ue=this.extractOneOrMore(D,y);this.consumeSpaceForRecord(D);const Fe=this.extractOneOrMore(D,y);this.consumeSpaceForRecord(D);const Ft=this.extractOneOrMore(D,P);this.consumeSpaceForRecord(D);const Yn=this.extractOneOrMore(D,P);this.consumeSpaceForRecord(D);const Ni=this.extract(D,this.consumeUnicastAddress);return this.currentLine++,{username:ee,sessId:ue,sessVersion:Fe,nettype:Ft,addrtype:Yn,unicastAddress:Ni}}parseSessionName(){const D=this.getCurrentRecord();if(D.type===v.SESSION_NAME){const ee=this.extract(D,this.consumeText);return this.currentLine++,ee}}parseInformation(){const D=this.getCurrentRecord();if(D.type!==v.INFORMATION)return;const ee=this.extract(D,this.consumeText);return this.currentLine++,ee}parseUri(){const D=this.getCurrentRecord();if(D.type===v.URI)return this.currentLine++,D.value}parseEmail(){const D=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==v.EMAIL)break;D.push(ee.value),this.currentLine++}return D}parsePhone(){const D=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==v.PHONE)break;D.push(ee.value),this.currentLine++}return D}parseConnection(){const D=this.getCurrentRecord();if(D.type===v.CONNECTION){const ee=this.extractOneOrMore(D,P);this.consumeSpaceForRecord(D);const ue=this.extractOneOrMore(D,P);this.consumeSpaceForRecord(D);const Fe=this.extract(D,this.consumeAddress);return this.currentLine++,{nettype:ee,addrtype:ue,address:Fe}}}parseMedia(){const D=this.getCurrentRecord(),ee=this.extract(D,this.consumeToken);this.consumeSpaceForRecord(D);let ue=this.extract(D,this.consumePort);D.value[D.cur]==="/"&&(D.cur+=1,ue+=this.extract(D,this.consumeInteger)),this.consumeSpaceForRecord(D);const Fe=[];for(Fe.push(this.extract(D,this.consumeToken));D.value[D.cur]==="/";)D.cur+=1,Fe.push(this.extract(D,this.consumeToken));if(Fe.length===0)throw new Error("Invalid proto");const Ft=this.parseFmt(D);return this.currentLine++,{mediaType:ee,port:ue,protos:Fe,fmts:Ft}}parseTimeFields(){const D=[];for(;this.getCurrentRecord().type===v.TIME;){const ee=this.parseTime(),ue=this.parseRepeat(),Fe=this.parseZone();D.push({time:ee,repeats:ue,zones:Fe})}return D}parseMediaDescription(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ee=this.parseMedia(),ue=this.parseInformation(),Fe=this.parseConnections(),Ft=this.parseBandWidth(),Yn=this.parseKey(),Ni=this.parseMediaAttributes(ee);D.push({media:ee,information:ue,connections:Fe,bandwidths:Ft,key:Yn,attributes:Ni})}return D}parseConnections(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)D.push(this.parseConnection());return D}parseFmt(D){const ee=[];for(;;)try{this.consumeSpaceForRecord(D),ee.push(this.extract(D,this.consumeToken))}catch{break}if(ee.length===0)throw new Error("Invalid fmts");return ee}extract(D,ee){for(var ue=arguments.length,Fe=new Array(ue>2?ue-2:0),Ft=2;Ft<ue;Ft++)Fe[Ft-2]=arguments[Ft];const Yn=ee.call(this,D.value,D.cur,...Fe),Ni=D.value.slice(D.cur,Yn);return D.cur=Yn,Ni}extractOneOrMore(D,ee){const ue=this.consumeOneOrMore(D.value,D.cur,ee),Fe=D.value.slice(D.cur,ue);return D.cur=ue,Fe}consumeSpaceForRecord(D){if(D.value[D.cur]!==_)throw new Error("Invalid space at ".concat(D.cur,"."));D.cur+=1}}class rt extends Ue{constructor(){super(...arguments),Re(this,"attributes",void 0),Re(this,"digested",!1)}extractOneOrMore(D,ee,ue){const Fe=this.consumeOneOrMore(D.attValue,D._cur,ee),Ft=D.attValue.slice(D._cur,Fe),[Yn,Ni]=ue||[];if(typeof Yn=="number"&&Ft.length<Yn)throw new Error("error in length, should be more or equal than ".concat(Yn," characters."));if(typeof Ni=="number"&&Ft.length>Ni)throw new Error("error in length, should be less or equal than ".concat(Ni," characters."));return D._cur=Fe,Ft}consumeAttributeSpace(D){if(D.attValue[D._cur]!==_)throw new Error("Invalid space at ".concat(D._cur,"."));D._cur+=1}extract(D,ee){if(!D.attValue)throw new Error("Nothing to extract from attValue.");for(var ue=arguments.length,Fe=new Array(ue>2?ue-2:0),Ft=2;Ft<ue;Ft++)Fe[Ft-2]=arguments[Ft];const Yn=ee.call(this,D.attValue,D._cur,...Fe),Ni=D.attValue.slice(D._cur,Yn);return D._cur=Yn,Ni}atEnd(D){if(!D.attValue)throw new Error;return D._cur>=D.attValue.length}peekChar(D){if(!D.attValue)throw new Error;return D.attValue[D._cur]}peek(D,ee){if(!D.attValue)throw new Error;for(let ue=0;ue<ee.length;ue++)if(ee[ue]!==D.attValue[D._cur+ue])return!1;return!0}parseIceUfrag(D){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(D,q,[4,256])}parseIcePwd(D){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(D,q,[22,256])}parseIceOptions(D){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ee=[];for(;!this.atEnd(D);){ee.push(this.extractOneOrMore(D,q));try{this.consumeAttributeSpace(D)}catch(ue){if(this.atEnd(D))break;throw ue}}this.attributes.iceOptions=ee}parseFingerprint(D){const ee=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ue=this.extract(D,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ee,fingerprint:ue})}parseExtmap(D){const ee=this.extractOneOrMore(D,y);let ue;this.peekChar(D)==="/"&&(this.extract(D,this.consume,"/"),ue=this.extract(D,this.consumeToken)),this.consumeAttributeSpace(D);const Fe=this.extract(D,this.consumeTill,_),Ft=fe(fe({entry:parseInt(ee,10)},ue&&{direction:ue}),{},{extensionName:Fe});this.peekChar(D)===_&&(this.consumeAttributeSpace(D),Ft.extensionAttributes=this.extract(D,this.consumeTill)),this.attributes.extmaps.push(Ft)}parseSetup(D){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ee=this.extract(D,this.consumeTill);if(ee!=="active"&&ee!=="passive"&&ee!=="actpass"&&ee!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ee}}class cn extends rt{constructor(){super(...arguments),Re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"group":this.parseGroup(D);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"fingerprint":this.parseFingerprint(D);break;case"setup":this.parseSetup(D);break;case"tls-id":this.parseTlsId(D);break;case"identity":this.parseIdentity(D);break;case"extmap":this.parseExtmap(D);break;case"msid-semantic":this.parseMsidSemantic(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(ee){throw console.error("parsing session attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),ee}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(D){const ee=this.extract(D,this.consumeToken),ue=[];for(;!this.atEnd(D)&&this.peekChar(D)===_;)this.consumeAttributeSpace(D),ue.push(this.extract(D,this.consumeToken));this.attributes.groups.push({semantic:ee,identificationTag:ue})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(D){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(D,oe)}parseIdentity(D){const ee=this.extractOneOrMore(D,me),ue=[];for(;!this.atEnd(D)&&this.peekChar(D)===_;){this.consumeAttributeSpace(D);const Fe=this.extract(D,this.consumeToken);this.extract(D,this.consume,"=");const Ft=this.extractOneOrMore(D,Yn=>Yn!==_&&$(Yn));ue.push({name:Fe,value:Ft})}this.attributes.identities.push({assertionValue:ee,extensions:ue})}parseMsidSemantic(D){this.peekChar(D)===_&&this.consumeAttributeSpace(D);const ee={semantic:this.extract(D,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(D)}catch{break}if(this.peekChar(D)==="*"){this.extract(D,this.consume,"*"),ee.applyForAll=!0;break}{const ue=this.extract(D,this.consumeTill,_);ee.identifierList.push(ue)}}this.attributes.msidSemantic=ee}}class ln extends rt{constructor(D){super(),Re(this,"attributes",void 0),D.protos.indexOf("RTP")!==-1||D.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"extmap":this.parseExtmap(D);break;case"setup":this.parseSetup(D);break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"candidate":this.parseCandidate(D);break;case"remote-candidate":this.parseRemoteCandidate(D);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(D);break;case"rtpmap":this.parseRtpmap(D);break;case"ptime":this.parsePtime(D);break;case"maxptime":this.parseMaxPtime(D);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(D);break;case"ssrc":this.parseSSRC(D);break;case"fmtp":this.parseFmtp(D);break;case"rtcp-fb":this.parseRtcpFb(D);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(D);break;case"mid":this.parseMid(D);break;case"msid":this.parseMsid(D);break;case"imageattr":this.parseImageAttr(D);break;case"rid":this.parseRid(D);break;case"simulcast":this.parseSimulcast(D);break;case"sctp-port":this.parseSctpPort(D);break;case"max-message-size":this.parseMaxMessageSize(D);break;case"ssrc-group":this.parseSSRCGroup(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(ee){throw console.error("parsing media attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),ee}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}parseCandidate(D){const ee=this.extractOneOrMore(D,q,[1,32]);this.consumeAttributeSpace(D);const ue=this.extractOneOrMore(D,y,[1,5]);this.consumeAttributeSpace(D);const Fe=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const Ft=this.extractOneOrMore(D,y,[1,10]);this.consumeAttributeSpace(D);const Yn=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const Ni=this.extract(D,this.consumePort);this.consumeAttributeSpace(D),this.extract(D,this.consume,"typ"),this.consumeAttributeSpace(D);const ua={foundation:ee,componentId:ue,transport:Fe,priority:Ft,connectionAddress:Yn,port:Ni,type:this.extract(D,this.consumeToken),extension:{}};for(this.peek(D," raddr")&&(this.extract(D,this.consume," raddr"),this.consumeAttributeSpace(D),ua.relAddr=this.extract(D,this.consumeAddress)),this.peek(D," rport")&&(this.extract(D,this.consume," rport"),this.consumeAttributeSpace(D),ua.relPort=this.extract(D,this.consumePort));this.peekChar(D)===_;){this.consumeAttributeSpace(D);const dp=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D),ua.extension[dp]=this.extractOneOrMore(D,w)}this.attributes.candidates.push(ua)}parseRemoteCandidate(D){const ee=[];for(;;){const ue=this.extractOneOrMore(D,y,[1,5]);this.consumeAttributeSpace(D);const Fe=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const Ft=this.extract(D,this.consumePort);ee.push({componentId:ue,connectionAddress:Fe,port:Ft});try{this.consumeAttributeSpace(D)}catch{break}}this.attributes.remoteCandidatesList.push(ee)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(D){const ee=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ue=this.extract(D,this.consumeTill,"/");this.extract(D,this.consume,"/");const Fe={encodingName:ue,clockRate:this.extractOneOrMore(D,y)};this.atEnd(D)||this.peekChar(D)!=="/"||(this.extract(D,this.consume,"/"),Fe.encodingParameters=parseInt(this.extract(D,this.consumeTill),10));const Ft=this.attributes.payloads.find(Yn=>Yn.payloadType===parseInt(ee,10));Ft?Ft.rtpMap=Fe:this.attributes.payloads.push({payloadType:parseInt(ee,10),rtpMap:Fe,rtcpFeedbacks:[]})}parsePtime(D){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(D,this.consumeTill)}parseMaxPtime(D){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(D,this.consumeTill)}parseDirection(D){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=D.attField}parseSSRC(D){const ee=this.extractOneOrMore(D,y);this.consumeAttributeSpace(D);const ue=this.extract(D,this.consumeTill,":");let Fe;this.peekChar(D)===":"&&(this.extract(D,this.consume,":"),Fe=this.extract(D,this.consumeTill));const Ft=this.attributes.ssrcs.find(Yn=>Yn.ssrcId===parseInt(ee,10));Ft?Ft.attributes[ue]=Fe:this.attributes.ssrcs.push({ssrcId:parseInt(ee,10),attributes:{[ue]:Fe}})}parseFmtp(D){const ee=this.extract(D,this.consumeTill,_);this.consumeAttributeSpace(D);const ue=this.extract(D,this.consumeTill),Fe={};ue.split(";").forEach(Yn=>{let[Ni,ua]=Yn.split("=");Ni=Ws(Ni).call(Ni);const dp=typeof ua=="string"?Ws(ua).call(ua):null;typeof Ni=="string"&&Ni.length>0&&(Fe[Ni]=dp)});const Ft=this.attributes.payloads.find(Yn=>Yn.payloadType===parseInt(ee,10));Ft?Ft.fmtp={parameters:Fe}:this.attributes.payloads.push({payloadType:parseInt(ee,10),rtcpFeedbacks:[],fmtp:{parameters:Fe}})}parseFmtParameters(D){const ee={},ue=this.extract(D,this.consumeTill,"=");D._cur++;const Fe=this.extract(D,this.consumeTill,";");for(ee[ue]=Fe;D.attValue[D._cur]===";";){const Ft=this.extract(D,this.consumeTill,"=");D._cur++;const Yn=this.extract(D,this.consumeTill,";");ee[Ft]=Yn}return ee}parseRtcpFb(D){let ee="";ee=this.peekChar(D)==="*"?this.extract(D,this.consume,"*"):this.extract(D,this.consumeTill,_),this.consumeAttributeSpace(D);const ue=this.extract(D,this.consumeTill,_);let Fe;if(ue==="trr-int")Fe={type:ue,interval:this.extract(D,this.consumeTill)};else{const Ft={type:ue};this.peekChar(D)===_&&(this.consumeAttributeSpace(D),Ft.parameter=this.extract(D,this.consumeToken),this.peekChar(D)===_&&(Ft.additional=this.extract(D,this.consumeTill))),Fe=Ft}if(ee==="*")this.attributes.rtcpFeedbackWildcards.push(Fe);else{const Ft=this.attributes.payloads.find(Yn=>Yn.payloadType===parseInt(ee,10));Ft?Ft.rtcpFeedbacks.push(Fe):this.attributes.payloads.push({payloadType:parseInt(ee,10),rtcpFeedbacks:[Fe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(D){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ee={port:this.extract(D,this.consumePort)};this.peekChar(D)===_&&(this.consumeAttributeSpace(D),ee.netType=this.extractOneOrMore(D,P),this.consumeAttributeSpace(D),ee.addressType=this.extractOneOrMore(D,P),this.consumeAttributeSpace(D),ee.address=this.extract(D,this.consumeAddress)),this.attributes.rtcp=ee}parseMsid(D){const ee={id:this.extractOneOrMore(D,P,[1,64])};this.peekChar(D)===_&&(this.consumeAttributeSpace(D),ee.appdata=this.extractOneOrMore(D,P,[1,64])),this.attributes.msids.push(ee)}parseImageAttr(D){this.attributes.imageattr.push(D.attValue)}parseRid(D){const ee=this.extractOneOrMore(D,Fe=>x(Fe)||y(Fe)||Fe==="_"||Fe==="-");this.consumeAttributeSpace(D);const ue={id:ee,direction:this.extract(D,this.consumeToken),params:[]};if(this.peekChar(D)===_){if(this.consumeAttributeSpace(D),this.peek(D,"pt=")){this.extract(D,this.consume,"pt=");const Fe=[];for(;;){const Ft=this.extract(D,this.consumeToken);Fe.push(Ft);try{this.extract(D,this.consume,",")}catch{break}}ue.payloads=Fe,this.peekChar(D)===_&&this.extract(D,this.consume,_)}for(;;){const Fe=this.extract(D,this.consumeToken);switch(Fe){case"depend":{const Ft={type:Fe,rids:this.extract(D,this.consume,"=").split(",")};ue.params.push(Ft);break}default:{const Ft={type:Fe};this.peekChar(D)==="="&&(this.extract(D,this.consume,"="),Ft.val=this.extract(D,this.consumeTill,";")),ue.params.push(Ft)}}try{this.extract(D,this.consume,";")}catch{break}}}this.attributes.rids.push(ue)}parseSimulcast(D){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=D.attValue,this.extract(D,this.consumeTill)}parseSctpPort(D){this.attributes.sctpPort=this.extractOneOrMore(D,y,[1,5])}parseMaxMessageSize(D){this.attributes.maxMessageSize=this.extractOneOrMore(D,y,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(D){this.attributes.mid=this.extract(D,this.consumeToken)}parseSSRCGroup(D){const ee=this.extract(D,this.consumeToken),ue=[];for(;;)try{this.consumeAttributeSpace(D);const Fe=this.extract(D,this.consumeInteger);ue.push(parseInt(Fe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ee,ssrcIds:ue})}}function tr(ke,D,ee){return D in ke?Object.defineProperty(ke,D,{value:ee,enumerable:!0,configurable:!0,writable:!0}):ke[D]=ee,ke}class Jr{constructor(){tr(this,"eol",f)}print(D,ee){let ue="";return ee&&(this.eol=ee),ue+=this.printVersion(D.version),ue+=this.printOrigin(D.origin),ue+=this.printSessionName(D.sessionName),ue+=this.printInformation(D.information),ue+=this.printUri(D.uri),ue+=this.printEmail(D.emails),ue+=this.printPhone(D.phones),ue+=this.printConnection(D.connection),ue+=this.printBandwidth(D.bandwidths),ue+=this.printTimeFields(D.timeFields),ue+=this.printKey(D.key),ue+=this.printSessionAttributes(D.attributes),ue+=this.printMediaDescription(D.mediaDescriptions),ue}printVersion(D){return"v=".concat(D).concat(this.eol)}printOrigin(D){return"o=".concat(D.username," ").concat(D.sessId," ").concat(D.sessVersion," ").concat(D.nettype," ").concat(D.addrtype," ").concat(D.unicastAddress).concat(this.eol)}printSessionName(D){return D?"s=".concat(D).concat(this.eol):""}printInformation(D){return D?"i=".concat(D).concat(this.eol):""}printUri(D){return D?"u=".concat(D).concat(this.eol):""}printEmail(D){let ee="";for(const ue of D)ee+="e=".concat(ue).concat(this.eol);return ee}printPhone(D){let ee="";for(const ue of D)ee+="e=".concat(ue).concat(this.eol);return ee}printConnection(D){return D?"c=".concat(D.nettype," ").concat(D.addrtype," ").concat(D.address).concat(this.eol):""}printBandwidth(D){let ee="";for(const ue of D)ee+="b=".concat(ue.bwtype,":").concat(ue.bandwidth).concat(this.eol);return ee}printTimeFields(D){let ee="";for(const ue of D){ee+="t=".concat(ue.time.startTime," ").concat(ue.time.startTime).concat(this.eol);for(const Fe of ue.repeats)ee+="r=".concat(Fe.repeatInterval," ").concat(Fe.typedTimes.join(" ")).concat(this.eol);ue.zoneAdjustments&&(ee+="z=",ee+="z=".concat(ue.zoneAdjustments.map(Fe=>"".concat(Fe.time," ").concat(Fe.back?"-":""," ").concat(Fe.typedTime)).join(" ")).concat(this.eol),ee+=this.eol)}return ee}printKey(D){return D?"k=".concat(D).concat(this.eol):""}printAttributes(D){let ee="";for(const ue of D)ee+="a=".concat(ue.attField).concat(ue.attValue?":".concat(ue.attValue):"").concat(this.eol);return ee}printMediaDescription(D){let ee="";for(const ue of D)ee+=this.printMedia(ue.media),ee+=this.printInformation(ue.information),ee+=this.printConnections(ue.connections),ee+=this.printBandwidth(ue.bandwidths),ee+=this.printKey(ue.key),ee+=this.printMediaAttributes(ue);return ee}printConnections(D){let ee="";for(const ue of D)ee+=this.printConnection(ue);return ee}printMedia(D){return"m=".concat(D.mediaType," ").concat(D.port," ").concat(D.protos.join("/")," ").concat(D.fmts.join(" ")).concat(this.eol)}printSessionAttributes(D){return new Uo(this.eol).print(D)}printMediaAttributes(D){return new Pe(this.eol).print(D)}}class Fr{constructor(D){tr(this,"eol",void 0),this.eol=D}printIceUfrag(D){return D===void 0?"":"a=ice-ufrag:".concat(D).concat(this.eol)}printIcePwd(D){return D===void 0?"":"a=ice-pwd:".concat(D).concat(this.eol)}printIceOptions(D){return D===void 0?"":"a=ice-options:".concat(D.join(_)).concat(this.eol)}printFingerprints(D){return D.length>0?D.map(ee=>"a=fingerprint:".concat(ee.hashFunction).concat(_).concat(ee.fingerprint)).join(this.eol)+this.eol:""}printExtmap(D){return D.map(ee=>"a=extmap:".concat(ee.entry).concat(ee.direction?"/".concat(ee.direction):"").concat(_).concat(ee.extensionName).concat(ee.extensionAttributes?"".concat(_).concat(ee.extensionAttributes):"").concat(this.eol)).join("")}printSetup(D){return D===void 0?"":"a=setup:".concat(D).concat(this.eol)}printUnrecognized(D){return D.map(ee=>"a=".concat(ee.attField).concat(ee.attValue?":".concat(ee.attValue):"").concat(this.eol)).join("")}}class Uo extends Fr{print(D){let ee="";return ee+=this.printGroups(D.groups),ee+=this.printMsidSemantic(D.msidSemantic),ee+=this.printIceLite(D.iceLite),ee+=this.printIceUfrag(D.iceUfrag),ee+=this.printIcePwd(D.icePwd),ee+=this.printIceOptions(D.iceOptions),ee+=this.printFingerprints(D.fingerprints),ee+=this.printSetup(D.setup),ee+=this.printTlsId(D.tlsId),ee+=this.printIdentity(D.identities),ee+=this.printExtmap(D.extmaps),ee+=this.printUnrecognized(D.unrecognized),ee}printGroups(D){let ee="";return D.length>0&&(ee+=D.map(ue=>"a=group:".concat(ue.semantic).concat(ue.identificationTag.map(Fe=>"".concat(_).concat(Fe)).join("")).concat(this.eol)).join("")),ee}printIceLite(D){return D===void 0?"":"a=ice-lite"+this.eol}printTlsId(D){return D?"a=tls-id:".concat(D).concat(this.eol):""}printIdentity(D){return D.length===0?"":D.map(ee=>"a=identity:".concat(ee.assertionValue).concat(ee.extensions.map(ue=>"".concat(_).concat(ue.name).concat(ue.value?"=".concat(ue.value):"")))).join(this.eol)+this.eol}printMsidSemantic(D){if(!D)return"";let ee="a=msid-semantic:".concat(D.semantic);return D.applyForAll?ee+="".concat(_,"*"):D.identifierList.length>0&&(ee+=D.identifierList.map(ue=>"".concat(_).concat(ue))),ee+this.eol}}class Pe extends Fr{print(D){const ee=D.attributes;let ue="";return ue+=this.printRTCP(ee.rtcp),ue+=this.printIceUfrag(ee.iceUfrag),ue+=this.printIcePwd(ee.icePwd),ue+=this.printIceOptions(ee.iceOptions),ue+=this.printCandidates(ee.candidates),ue+=this.printRemoteCandidatesList(ee.remoteCandidatesList),ue+=this.printEndOfCandidates(ee.endOfCandidates),ue+=this.printFingerprints(ee.fingerprints),ue+=this.printSetup(ee.setup),ue+=this.printMid(ee.mid),ue+=this.printExtmap(ee.extmaps),ue+=this.printRTPRelated(ee),ue+=this.printPtime(ee.ptime),ue+=this.printMaxPtime(ee.maxPtime),ue+=this.printDirection(ee.direction),ue+=this.printSSRCGroups(ee.ssrcGroups),ue+=this.printSSRC(ee.ssrcs),ue+=this.printRTCPMux(ee.rtcpMux),ue+=this.printRTCPMuxOnly(ee.rtcpMuxOnly),ue+=this.printRTCPRsize(ee.rtcpRsize),ue+=this.printMSId(ee.msids),ue+=this.printImageattr(ee.imageattr),ue+=this.printRid(ee.rids),ue+=this.printSimulcast(ee.simulcast),ue+=this.printSCTPPort(ee.sctpPort),ue+=this.printMaxMessageSize(ee.maxMessageSize),ue+=this.printUnrecognized(ee.unrecognized),ue}printCandidates(D){return D.map(ee=>"a=candidate:".concat(ee.foundation).concat(_).concat(ee.componentId).concat(_).concat(ee.transport).concat(_).concat(ee.priority).concat(_).concat(ee.connectionAddress).concat(_).concat(ee.port).concat(_,"typ").concat(_).concat(ee.type).concat(ee.relAddr?"".concat(_,"raddr").concat(_).concat(ee.relAddr):"").concat(ee.relPort?"".concat(_,"rport").concat(_).concat(ee.relPort):"").concat(Object.keys(ee.extension).map(ue=>"".concat(_).concat(ue).concat(_).concat(ee.extension[ue])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(D){return D.map(ee=>"a=remote-candidates:".concat(ee.join(_)).concat(this.eol)).join("")}printEndOfCandidates(D){return D===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(D){if(!D.payloads)return"";const ee=D.payloads;let ue="";ue+=D.rtcpFeedbackWildcards.map(Fe=>this.printRTCPFeedback("*",Fe)).join("");for(const Fe of ee)ue+=this.printRtpMap(Fe.payloadType,Fe.rtpMap),ue+=this.printFmtp(Fe.payloadType,Fe.fmtp),ue+=Fe.rtcpFeedbacks.map(Ft=>this.printRTCPFeedback(Fe.payloadType,Ft)).join("");return ue}printFmtp(D,ee){if(!ee)return"";const ue=Object.keys(ee.parameters);return ue.length===1&&ee.parameters[ue[0]]===null?"a=fmtp:".concat(D).concat(_).concat(ue[0]).concat(this.eol):"a=fmtp:".concat(D).concat(_).concat(Object.keys(ee.parameters).map(Fe=>"".concat(Fe,"=").concat(ee.parameters[Fe])).join(";")).concat(this.eol)}printRtpMap(D,ee){return ee?"a=rtpmap:".concat(D).concat(_).concat(ee.encodingName,"/").concat(ee.clockRate).concat(ee.encodingParameters?"/".concat(ee.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(D,ee){let ue="a=rtcp-fb:".concat(D).concat(_),Fe=ee;return Fe.type==="trr-int"?ue+="ttr-int".concat(_).concat(Fe.interval):(ue+="".concat(Fe.type),Fe.parameter&&(ue+="".concat(_).concat(Fe.parameter),Fe.additional&&(ue+="".concat(_).concat(Fe.additional)))),ue+this.eol}printPtime(D){return D===void 0?"":"a=ptime:".concat(D).concat(this.eol)}printMaxPtime(D){return D===void 0?"":"a=maxptime:".concat(D).concat(this.eol)}printDirection(D){return D===void 0?"":"a=".concat(D).concat(this.eol)}printSSRC(D){return D.map(ee=>Object.keys(ee.attributes).map(ue=>"a=ssrc:".concat(ee.ssrcId.toString(10)).concat(_).concat(ue).concat(ee.attributes[ue]?":".concat(ee.attributes[ue]):"").concat(this.eol)).join("")).join("")}printRTCPMux(D){return D===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(D){return D===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(D){return D===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(D){if(D===void 0)return"";let ee="a=rtcp:".concat(D.port);return D.netType&&(ee+="".concat(_).concat(D.netType)),D.addressType&&(ee+="".concat(_).concat(D.addressType)),D.address&&(ee+="".concat(_).concat(D.address)),ee+this.eol}printMSId(D){return D.map(ee=>"a=msid:".concat(ee.id).concat(ee.appdata?"".concat(_).concat(ee.appdata):"").concat(this.eol)).join("")}printImageattr(D){return D.map(ee=>"a=imageattr:".concat(ee).concat(this.eol)).join("")}printRid(D){return D.map(ee=>{let ue="a=rid:".concat(ee.id).concat(_).concat(ee.direction);return ee.payloads&&(ue+="".concat(_,"pt=").concat(ee.payloads.join(","))),ee.params.length>0&&(ue+="".concat(_).concat(ee.params.map(Fe=>Fe.type==="depend"?"depend=".concat(Fe.rids.join(",")):"".concat(Fe.type,"=").concat(Fe.val)).join(";"))),ue+this.eol}).join("")}printSimulcast(D){return D===void 0?"":"a=simulcast:".concat(D).concat(this.eol)}printSCTPPort(D){return D===void 0?"":"a=sctp-port:".concat(D).concat(this.eol)}printMaxMessageSize(D){return D===void 0?"":"a=max-message-size:".concat(D).concat(this.eol)}printMid(D){return D===void 0?"":"a=mid:".concat(D).concat(this.eol)}printSSRCGroups(D){return D.map(ee=>"a=ssrc-group:".concat(ee.semantic).concat(ee.ssrcIds.map(ue=>"".concat(_).concat(ue.toString(10))).join("")).concat(this.eol)).join("")}}function He(ke){return new Qe().parse(ke)}function lt(ke,D){return new Jr().print(ke,D)}}},n={};function i(o){if(n[o])return n[o].exports;var c=n[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function oa(e){return Q5.parse(e)}function xf(e,n){return Q5.print(e,n)}var Tue=Ca("Array").keys,bue=Za,wue=li,Rue=N,Cue=Tue,b1=Array.prototype,Iue={DOMTokenList:!0,NodeList:!0},Aue=function(e){var n=e.keys;return e===b1||Rue(b1,e)&&n===b1.keys||wue(Iue,bue(e))?Cue:n},pc=l(Aue);function Z5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Kt(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Z5(Object(i),!0).forEach(function(o){xr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Z5(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function xr(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var _=f.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const e6=new class extends Rr{constructor(){super(...arguments),xr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:n}=e;n[n.length-1]&&n[n.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=n[n.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Oue{constructor(n){xr(this,"logger",void 0),xr(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function w1(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function t6(){const e=new Date,n=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return n?(n==null?void 0:n[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Xc={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},OI=Date.now(),n0=e=>{for(const n in Xc)if(Object.prototype.hasOwnProperty.call(Xc,n)&&Xc[n]===e)return n;return"DEFAULT"},k=new class{constructor(){xr(this,"proxyServerURL",void 0),xr(this,"logLevel",Xc.DEBUG),xr(this,"uploadState","collecting"),xr(this,"uploadLogWaitingList",[]),xr(this,"uploadLogUploadingList",[]),xr(this,"uploadErrorCount",0),xr(this,"currentLogID",0),xr(this,"url",void 0),xr(this,"extLog",(e,n)=>{this.appendLogToWaitingList(e,...n)})}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Xc.DEBUG].concat(n);this.log.apply(this,o)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Xc.INFO].concat(n);this.log.apply(this,o)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Xc.WARNING].concat(n);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Xc.ERROR].concat(n);this.log.apply(this,o)}upload(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Xc.DEBUG].concat(n);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Hn("UPLOAD_LOG",!0)}disableLogUpload(){Hn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Oue(this).prefix(e)}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-OI<100)return void setTimeout(()=>{this.log(...n)},Date.now()-OI);const o=Math.max(0,Math.min(4,n[0]));if(n[0]=w1()+" Agora-SDK [".concat(n0(o),"]:"),this.appendLogToWaitingList(o,...n),o<this.logLevel)return;const c=w1()+" %cAgora-SDK [".concat(n0(o),"]:");let u=[];if(!Q("USE_NEW_LOG"))switch(o){case Xc.DEBUG:u=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,u);break;case Xc.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,u);break;case Xc.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,u);break;case Xc.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-OI<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-OI);const o=Math.max(0,Math.min(4,n[0]));n[0]=w1()+" Agora-SDK [".concat(n0(o),"]:"),this.appendLogToWaitingList(o,...n)}appendLogToWaitingList(e){if(!Q("UPLOAD_LOG"))return;for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=t6()+" Agora-SDK [".concat(n0(e),"]:"):i[0]=t6()+" Agora-SDK [".concat(n0(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,n={sdk_version:Yc,process_id:Q("PROCESS_ID"),payload:JSON.stringify(e)};return Lu(async()=>{const i=await No.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Q("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Q("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),e6.reportLogUploadError(o),!0},{timeout:Q("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Q("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Q("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var n6;function Pue(e){return $i(e.reportId,"params.reportId",0,100,!1),$i(e.category,"params.category",0,100,!1),$i(e.event,"params.event",0,100,!1),$i(e.label,"params.label",0,100,!1),qn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(n6={}).FREE="free",n6.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Nue={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Oi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Er=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let kue=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ot(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(n,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||n.__className__||(n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name);o.value=function(){for(var h,f=arguments.length,_=new Array(f),v=0;v<f;v++)_[v]=arguments[v];let y=_;if(e.argsMap)try{y=e.argsMap(this,..._)}catch(I){k.warning(I),y=[]}try{JSON.stringify(y)}catch{k.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),y=[]}const w=(e.report||ht).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:y,tag:Dr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const I=c.apply(this,_);return I instanceof Je?I.then(P=>(w.onSuccess(e.reportResult&&P),P)).catch(P=>{throw w.onError(P),P}):(w.onSuccess(e.reportResult&&I),I)}catch(I){throw w.onError(I),I}}}return o}}const ht=new class{constructor(){xr(this,"baseInfoMap",new Map),xr(this,"proxyServer",void 0),xr(this,"eventUploadTimer",void 0),xr(this,"setSessionIdTimer",void 0),xr(this,"url",void 0),xr(this,"sids",new Set),xr(this,"backupUrl",void 0),xr(this,"_appId",void 0),xr(this,"_aid",0),xr(this,"keyEventUploadPendingItems",[]),xr(this,"normalEventUploadPendingItems",[]),xr(this,"apiInvokeUploadPendingItems",[]),xr(this,"apiInvokeCount",0),xr(this,"apiInvokeLoggedCount",0),xr(this,"ltsList",[]),xr(this,"lastSendNormalEventTime",Date.now()),xr(this,"customReportCounterTimer",void 0),xr(this,"customReportCount",0),xr(this,"extApiInvoke",async e=>{for(const n of e){const i=Kt(Kt({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Dr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Q("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Q("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,n=>{let[i,o]=n;return i+o}),16)||0}reportApiInvoke(e,n,i){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!Q("SHOW_REPORT_INVOKER_LOG"),h=!!Q("SHOW_REPORT_USER_INVOKER_LOG"),f=u||h&&n.id;f&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function v(P,j){if(f){let x="[apiInvoke-".concat(_,"]");n.id&&(x+="[".concat(n.id,"]")),n.name&&(x+="[".concat(n.name,"]")),k.info("".concat(x," ").concat(P),P==="start"?n.options:j||"")}}const y=()=>({tag:n.tag,invokeId:c,sid:e,name:n.name,apiInvokeTime:o,options:n.options,states:n.states||null});v("start");let w=!1;qi(n.timeout).then(()=>{w||(this.sendApiInvoke(Kt(Kt({},y()),{},{error:Y.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const I=new Ie(Y.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:P=>{const j=()=>{if(w)throw I;return w=!0,this.sendApiInvoke(Kt(Kt({},y()),{},{success:!0},n.reportResult&&{result:P})),v("onSuccess"),P};return i?x5(j,n.name+"Success",i,()=>w=!0):j()},onError:P=>{const j=()=>{if(w)throw P;w=!0,this.sendApiInvoke(Kt(Kt({},y()),{},{success:!1,error:P})),v("onFailure",P.toString())};return i?x5(j,n.name+"Error",i,()=>w=!0):j()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=n.cname;const c=Object.assign({},{willUploadConsoleLog:Q("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:E1?"global":"oversea",areas:Q("AREAS")&&Q("AREAS").join(",")},n.extend),{stringUid:u,channelProfile:h,channelMode:f,isABTestSuccess:_,lsid:v,clientRole:y}=n,w=Date.now(),I=Kt(Kt({},o),{},{eventType:Oi.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:S1,lts:w,elapse:w-i,extend:JSON.stringify(c),mode:n.mode,process:Q("PROCESS_ID"),appType:Q("APP_TYPE"),success:!0,version:Yc,stringUid:u,channelProfile:h,channelMode:f,isABTestSuccess:_,lsid:v,clientType:$e(P=window.navigator.userAgent).call(P,"AgoraWebView")?42:20,clientRole:y,serviceId:Q("PROCESS_ID"),extensionID:Q("PLUGIN_INFO").join(",")||""});var P;this.send({type:Er.SESSION,data:I},!0)}joinChooseServer(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt({},o),{},{role:n.role,eventType:Oi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:n.elapse||c-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:c-i.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3,corssRegionTagReq:n.corssRegionTagReq||void 0,corssRegionTagRes:n.corssRegionTagRes||void 0});this.send({type:Er.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt({},o),{},{eventType:Oi.REQ_USER_ACCOUNT,lts:c,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||c-i.startTime,eventElapse:c-n.lts,extend:JSON.stringify(n.extend)});this.send({type:Er.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;n.vid&&(o.vid=n.vid),o.uid=n.uid,o.cid=n.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:f,isProxy:_}=n,v=c-(u&&h?h:i.startTime),y=Kt(Kt({},o),{},{eventType:Oi.JOIN_GATEWAY,lts:c,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,errorMsg:n.errorMsg||"",elapse:v,eventElapse:c-n.lts,firstSuccess:u,signalChannel:n.signalChannel,preload:n.preload?1:0,installId:v1(),isABTestSuccess:n.isABTestSuccess?1:0}),w=y.success?1:0;if(n.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:Er.JOIN_GATEWAY,data:y},!0);else{let I;if(f)if(_){const j=f.match(/h=(\d{1,3}-){3}\d{1,3}/g),x=f.match(/p=[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:j&&j.length?j[0].split("=")[1].replace(/-/g,"."):"",port:x&&x.length?x[0].split("=")[1]:"",isProxy:_?1:0}}else{const j=f.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),x=f.match(/(:|p=)[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:j&&j.length?j[0].split("//")[1].replace(/-/g,"."):"",port:x&&x.length?x[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else I={isSuccess:w,gatewayIp:"",port:"",isProxy:_?1:0};delete y.success,delete y.eventType,delete y.firstSuccess,y.vid=Number(y.vid);const P=Object.assign({},y,I,{eventType:Oi.REJOIN_GATEWAY});this.send({type:Er.RE_JOIN_GATEWAY,data:P},!0)}}joinChannelTimeout(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=Kt(Kt({},i.info),{},{lts:o,timeout:n,elapse:o-i.startTime});this.send({type:Er.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt({},o),{},{eventType:Oi.PUBLISH,lts:c,eventElapse:n.eventElapse,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:Er.PUBLISH,data:u},!0)}subscribe(e,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=Kt(Kt({},c),{},{eventType:Oi.SUBSCRIBE,lts:u,eventElapse:n.eventElapse,elapse:u-o.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid,preSsrc:n.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?h.peerSuid=n.peerid:h.peer=n.peerid,this.send({type:Er.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var n;const i=[...pc(n=this.baseInfoMap).call(n)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),f=Kt(Kt({},u),{},{eventType:Oi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:Er.WS_COMPRESSOR_INIT,data:f},!0)}firstRemoteVideoDecode(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),f=Kt(Kt(Kt({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:f},!0)}firstRemoteFrame(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),f=Kt(Kt(Kt({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h});this.send({type:i,data:f},!0)}abTest(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt(Kt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Oi.AB_TEST,lts:c});this.send({type:Er.AB_TEST,data:u},!0)}pcStats(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt(Kt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Oi.PC_STATS,lts:c,preallocation:n.preallocation?1:0});this.send({type:Er.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,n){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt(Kt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Oi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Er.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),f=Kt(Kt(Kt({},u),o),{},{eventType:n,lts:h});this.send({type:i,data:f},!0)}streamSwitch(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt({},o),{},{eventType:Oi.STREAM_SWITCH,lts:c,isDual:n.isdual,elapse:c-i.startTime,success:n.succ});this.send({type:Er.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt({},o),{},{eventType:Oi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Er.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt({},o),{},{eventType:Oi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Er.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt({},o),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:Er.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,f){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const v=Pd(JSON.stringify(u));let y=0;const w=[];let I=0;for(let P=0;P<_.length;P++)I+=_.charCodeAt(P)<=127?1:3,I<=f-v||(w[w.length]=it(it({},u),{},{[h]:_.substring(y,P)}),y=P,I=_.charCodeAt(P)<=127?1:3);return y!==_.length-1&&(w[w.length]=it(it({},u),{},{[h]:_.substring(y)})),w})(Kt(Kt(Kt({},o),n),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Er.WORKER_EVENT,data:u},!0))}apworkerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt(Kt({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:Er.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt(Kt({},o),n),{},{elapse:c-i.startTime,lts:c,extend:n.extend||void 0});this.send({type:Er.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Kt(Kt(Kt({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:Er.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>Q("CUSTOM_REPORT_LIMIT"))throw new Ie(Y.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=n.map(c=>({type:Er.USER_ANALYTICS,data:Kt(Kt({sid:e},c),{},{lts:i})}));try{Q("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw k.error("send custom report message failed",c.toString()),new Ie(Y.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const n=Q("NOT_REPORT_EVENT");if(e.tag&&$e(n)&&$e(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ie){const{code:_,message:v}=e.error;h=_||v||e.error.toString()}else h=e.error.toString();const f={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Er.API_INVOKE,data:f},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const n=Array.from(this.sids).find(i=>i!==null);n&&e.forEach(i=>{i&&(i.sid=n,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Q("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),xT(c=this.ltsList).call(c,(h,f)=>h-f))}return n||(this.lastSendNormalEventTime=Date.now()),Q("ENABLE_EVENT_REPORT")&&i.length&&(Q("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{Q("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>Q("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Q("NORMAL_EVENT_QUEUE_CAPACITY")),k.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){ni.networkState===xa.OFFLINE&&await Je.race([ni.onlineWaiter,qi(2*pi.maxRetryTimeout)]);const n=c=>{let u=new Uint8Array;return c.forEach(h=>{const f=o1(JSON.stringify(h.data)),_=new ArrayBuffer(5),v=(w=>{let I=0;return Object.entries(Er).forEach(P=>{let[j,x]=P;x===w.type&&(I=kue[j])}),I})(h),y=new DataView(_);y.setUint16(0,f.byteLength,!0),y.setUint8(2,255&v),y.setUint8(3,v>>>8&255),y.setUint8(4,v>>>16&255),u=C5(u,new Uint8Array(_)),u=C5(u,f)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(Q("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(Q("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await p1(o,{timeout:1e4,data:n(e),headers:Kt(Kt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(f=>{const _=f&&f.data.sid&&this.baseInfoMap.get(f.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(f=>JSON.stringify(f)),vid:i,aid:o};ni.networkState===xa.OFFLINE&&await Je.race([ni.onlineWaiter,qi(2*pi.maxRetryTimeout)]);const u=n?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("EVENT_REPORT_DOMAIN"),"&p=").concat(Q("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Q("EVENT_REPORT_DOMAIN"),":").concat(Q("STATS_COLLECTOR_PORT")).concat(u));for(let f=0;f<2;f+=1){f===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Q("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Q("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Q("STATS_COLLECTOR_PORT")).concat(u)));try{n?await _ue(h,{timeout:1e4,data:c}):await p1(h,{timeout:1e4,data:c})}catch(_){if(f===1)throw _;continue}return}}createBaseInfo(e,n){const i=Object.assign({},Nue);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:n}),i}reportResourceTiming(e,n){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:o,tag:Dr.TRACER}).onSuccess()}};e6.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ni.networkState,ht.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Dr.TRACER}).onSuccess("logUploadError")});class be extends Ie{constructor(n){super(n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),xr(this,"name","AgoraRTCException")}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(n,k)}throw(){super.throw(k)}}const Yi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function wn(){return Yi}function r6(){return"setSinkId"in HTMLAudioElement.prototype&&(!Q("RESTRICTION_SET_PLAYBACK_DEVICE")||(Xh()||f5())&&!r1())}function i6(){return!Yi.supportUnifiedPlan||Q("CHROME_FORCE_PLAN_B")&&Jh()}let Xi=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function CE(e,n,i){return{sampleRate:e,stereo:n,bitrate:i}}function gn(e,n,i,o,c){return{width:e,height:n,frameRate:i,bitrateMin:o,bitrateMax:c}}function Ll(e,n,i,o,c){return{width:{max:e},height:{max:n},frameRate:i,bitrateMin:o,bitrateMax:c}}function R1(e,n){return{numSpatialLayers:e,numTemporalLayers:n}}const Due={"90p":gn(160,90),"90p_1":gn(160,90),"120p":gn(160,120,15,30,65),"120p_1":gn(160,120,15,30,65),"120p_3":gn(120,120,15,30,50),"120p_4":gn(212,120),"180p":gn(320,180,15,30,140),"180p_1":gn(320,180,15,30,140),"180p_3":gn(180,180,15,30,100),"180p_4":gn(240,180,15,30,120),"240p":gn(320,240,15,40,200),"240p_1":gn(320,240,15,40,200),"240p_3":gn(240,240,15,40,140),"240p_4":gn(424,240,15,40,220),"360p":gn(640,360,15,80,400),"360p_1":gn(640,360,15,80,400),"360p_3":gn(360,360,15,80,260),"360p_4":gn(640,360,30,80,600),"360p_6":gn(360,360,30,80,400),"360p_7":gn(480,360,15,80,320),"360p_8":gn(480,360,30,80,490),"360p_9":gn(640,360,15,80,800),"360p_10":gn(640,360,24,80,800),"360p_11":gn(640,360,24,80,1e3),"480p":gn(640,480,15,100,500),"480p_1":gn(640,480,15,100,500),"480p_2":gn(640,480,30,100,1e3),"480p_3":gn(480,480,15,100,400),"480p_4":gn(640,480,30,100,750),"480p_6":gn(480,480,30,100,600),"480p_8":gn(848,480,15,100,610),"480p_9":gn(848,480,30,100,930),"480p_10":gn(640,480,10,100,400),"720p":gn(1280,720,15,120,1130),"720p_auto":gn(1280,720,30,900,3e3),"720p_1":gn(1280,720,15,120,1130),"720p_2":gn(1280,720,30,120,2e3),"720p_3":gn(1280,720,30,120,1710),"720p_5":gn(960,720,15,120,910),"720p_6":gn(960,720,30,120,1380),"1080p":gn(1920,1080,15,120,2080),"1080p_1":gn(1920,1080,15,120,2080),"1080p_2":gn(1920,1080,30,120,3e3),"1080p_3":gn(1920,1080,30,120,3150),"1080p_5":gn(1920,1080,60,120,4780),"1440p":gn(2560,1440,30,120,4850),"1440p_1":gn(2560,1440,30,120,4850),"1440p_2":gn(2560,1440,60,120,7350),"4k":gn(3840,2160,30,120,8910),"4k_1":gn(3840,2160,30,120,8910),"4k_3":gn(3840,2160,60,120,13500)},Lue={"480p":Ll(640,480,5),"480p_1":Ll(640,480,5),"480p_2":Ll(640,480,30),"480p_3":Ll(640,480,15),"720p":Ll(1280,720,5),"720p_auto":gn(1280,720,30,900,3e3),"720p_1":Ll(1280,720,5),"720p_2":Ll(1280,720,30),"720p_3":Ll(1280,720,15),"1080p":Ll(1920,1080,5),"1080p_1":Ll(1920,1080,5),"1080p_2":Ll(1920,1080,30),"1080p_3":Ll(1920,1080,15)},xue={"1SL1TL":R1(1,1),"3SL3TL":R1(3,3),"2SL3TL":R1(2,3)};function kd(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Due[e]):e}function C1(e){return typeof e=="string"?Object.assign({},Lue[e]):e}function PI(e){return typeof e=="string"?Object.assign({},xue[e]):e}const Mue={speech_low_quality:CE(16e3,!1),speech_standard:CE(32e3,!1,18),music_standard:CE(48e3,!1),standard_stereo:CE(48e3,!0,56),high_quality:CE(48e3,!1,128),high_quality_stereo:CE(48e3,!0,192)};function NI(e){return typeof e=="string"?Object.assign({},Mue[e]):e}const IE=[];function s6(e){return Ti(e,"mediaSource",["screen","window","application"]),!0}let at=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),er=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),AE=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Uue=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Vue=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Wg=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),OE=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),PE=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),NE=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),fc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const I1={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},A1={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},o6={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Fue={uplinkNetworkQuality:0,downlinkNetworkQuality:0},a6={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let so=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),mc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),r0=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Gg=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Gs=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Dd=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const O1={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let kI=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function c6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function yr(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?c6(Object(i),!0).forEach(function(o){Te(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Te(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var _=f.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function _n(e,n,i,o,c){var u,h,f={};return Object.keys(o).forEach(function(_){f[_]=o[_]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=Ia(u=of(h=i.slice()).call(h)).call(u,function(_,v){return v(e,n,_)||_},f),c&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(c):void 0,f.initializer=void 0),f.initializer===void 0&&(Object.defineProperty(e,n,f),f=null),f}class l6 extends Rr{set _mediaStreamTrack(n){n!==this.mediaStreamTrack&&(this.safeEmit(Wg.TRACK_UPDATED,n),this.mediaStreamTrack=n)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(n,i){super(),Te(this,"trackMediaType",void 0),Te(this,"_ID",void 0),Te(this,"_rtpTransceiver",void 0),Te(this,"_lowRtpTransceiver",void 0),Te(this,"_hints",[]),Te(this,"_isClosed",!1),Te(this,"_originMediaStreamTrack",void 0),Te(this,"mediaStreamTrack",void 0),Te(this,"_external",{}),this._ID=i||Zn(8,"track-"),this._originMediaStreamTrack=n,this.mediaStreamTrack=n,function(o){$e(IE).call(IE,o)||IE.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){return n||Df(()=>{var i;ht.reportApiInvoke(null,{name:hi.GET_MEDIA_STREAM_TRACK,options:[],tag:Dr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===AE.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const i=IE.indexOf(n);i!==-1&&IE.splice(i,1)}(this),this.emit(OE.CLOSED),this.removeAllListeners(Wg.SEI_RECEIVED)}_updateRtpTransceiver(n,i){if(i===AE.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(Wg.TRANSCEIVER_UPDATED,n,i)}}class kE extends l6{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(n,i){super(n,i),Te(this,"_enabled",!0),Te(this,"_muted",!1),Te(this,"_isExternalTrack",!1),Te(this,"_isClosed",!1),Te(this,"_enabledMutex",void 0),Te(this,"processor",void 0),Te(this,"_processorContext",void 0),Te(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new vs("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,i;return(n=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&n!==void 0?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,k.debug("[".concat(this.getTrackId(),"] close")),this.emit(at.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,n!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Qn(this,at.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(OE.TRACK_ENDED)}stateCheck(n,i){if(k.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(i,"]")),Qh(i,n),this._enabled&&this._muted&&n==="enabled"&&i===!1)throw new Ie(Y.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",k);if(!this._enabled&&!this._muted&&n==="muted"&&i===!0)throw new Ie(Y.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",k)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Je.resolve([])}}const u6=window.AudioContext||window.webkitAudioContext;let gc=null;const Kn=new class extends Rr{constructor(){super(...arguments),Te(this,"prevState",void 0),Te(this,"curState",void 0),Te(this,"currentTime",void 0),Te(this,"currentTimeStuckAt",void 0),Te(this,"interruptDetectorTrack",void 0),Te(this,"onLocalAudioTrackMute",()=>{k.info("ios15-interruption-start"),this.emit(Xi.IOS_15_16_INTERRUPTION_START)}),Te(this,"onLocalAudioTrackUnmute",async()=>{k.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?k.info("ios15-interruption-end-canceled"):(gc&&await gc.suspend(),this.emit(Xi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){k.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){k.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function DE(){if(!gc){if(function(){if(!u6)return void k.error("your browser is not support web audio");k.info("create audio context");const e=yr({},Q("WEBAUDIO_INIT_OPTIONS"));k.debug("audio context init option:",JSON.stringify(e)),gc=new u6(e),Kn.curState=gc.state,gc.onstatechange=()=>{Kn.prevState=Kn.curState,Kn.curState=gc?gc.state:void 0;const{prevState:n,curState:i}=Kn,o=i==="running",c=i==="interrupted",u=n==="running",h=n==="suspended",f=n==="interrupted",_=mn().osVersion;(io()||kl())&&u&&c&&(k.info("ios".concat(_,"-interruption-start")),Kn.emit(Xi.IOS_INTERRUPTION_START)),(io()||kl())&&(h||f)&&o&&(k.info("ios".concat(_,"-interruption-end")),Kn.emit(Xi.IOS_INTERRUPTION_END)),n!==i&&Kn.emit(Xi.STATE_CHANGE,i,n)},setInterval(()=>{var n;const i=(n=gc)===null||n===void 0?void 0:n.currentTime;Kn.currentTime!==i?(Kn.currentTimeStuckAt&&(k.debug("AudioContext current time resume at ".concat(i)),Kn.currentTimeStuckAt=void 0),Kn.currentTime=i):(i!==Kn.currentTimeStuckAt&&(ht.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Dr.TRACER}).onSuccess(),k.warning("AudioContext current time stuck at ".concat(i))),Kn.currentTimeStuckAt=i)},5e3),async function(n){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function f(x){n.state==="running"?_(!1):io()||kl()?n.state==="suspended"&&(_(!0),x&&n.resume().then(v,v)):n.state!=="closed"&&(_(!0),x&&n.resume().then(v,v))}function _(x){if(c!==x){c=x;for(let M=0,$=i;M<$.length;M+=1){const q=$[M];x?window.addEventListener(q,y,{capture:!0,passive:!0}):window.removeEventListener(q,y,{capture:!0,passive:!0})}}}function v(){f(!1)}function y(){f(!0)}function w(x){if(!h)if(o.paused)if(x){let M;I(!1),h=!0;try{M=o.play(),M?M.then(P,P):(o.addEventListener("playing",P),o.addEventListener("abort",P),o.addEventListener("error",P))}catch{P()}}else I(!0);else I(!1)}function I(x){if(u!==x){u=x;for(let M=0,$=i;M<$.length;M++){const q=$[M];x?window.addEventListener(q,j,{capture:!0,passive:!0}):window.removeEventListener(q,j,{capture:!0,passive:!0})}}}function P(){o.removeEventListener("playing",P),o.removeEventListener("abort",P),o.removeEventListener("error",P),h=!1,w(!1)}function j(){w(!0)}if(io()){const x=n.createMediaStreamDestination(),M=document.createElement("div");M.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=M.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=x.stream,w(!0)}Kn.on(Xi.STATE_CHANGE,function(){f(!0)}),f(!1)}(gc)}(),!gc)throw new Ie(Y.NOT_SUPPORTED,"can not create audio context");return gc}return gc}function zg(e){if(function(){if(P1!==null)return P1;const o=DE(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let f=!1;try{c.disconnect(u)}catch{f=!0}return c.disconnect(),P1=f,f}())return;const n=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),$e(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),n.call(e,o,c,u)):n.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?SI(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)n.call(e,h)}}let P1=null;function N1(e,n){let i=!1;const o=1/n;if(Q("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=DE();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const f=c.createOscillator();f.onended=h,f.connect(u),f.start(0),f.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class d6{constructor(){Te(this,"context",void 0),Te(this,"analyserNode",void 0),Te(this,"sourceNode",void 0),this.context=DE(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n==null||n.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||io()||kl()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<n.length;++c)n[c]=o[c]/128-1}const i=Ia(n).call(n,(o,c)=>o+c*c,0)/n.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,i;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{k.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class h6 extends Rr{get processSourceNode(){return this.sourceNode}set processedNode(n){var i;if(!this.isDestroyed&&this._processedNode!==n){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Te(this,"outputNode",void 0),Te(this,"outputTrack",void 0),Te(this,"isPlayed",!1),Te(this,"sourceNode",void 0),Te(this,"context",void 0),Te(this,"audioBufferNode",void 0),Te(this,"destNode",void 0),Te(this,"audioOutputLevel",0),Te(this,"volumeLevelAnalyser",void 0),Te(this,"_processedNode",void 0),Te(this,"playNode",void 0),Te(this,"isDestroyed",!1),Te(this,"onNoAudioInput",void 0),Te(this,"isNoAudioInput",!1),Te(this,"_noAudioInputCount",0),this.context=DE(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),zg(this.outputNode),this.volumeLevelAnalyser=new d6}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(fc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!wn().webAudioMediaStreamDest)throw new Ie(Y.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){this.context.state!=="running"&&TI(()=>{Kn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(n>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;io()||kl()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await qi(200),await this.checkHasAudioInput(n?n+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,i;(n=this.processedNode)===null||n===void 0||n.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?(n=this.processedNode)===null||n===void 0||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class p6 extends h6{get isFreeze(){return!1}constructor(n,i,o){var c;if(super(),Te(this,"sourceNode",void 0),Te(this,"track",void 0),Te(this,"clonedTrack",void 0),Te(this,"audioElement",void 0),Te(this,"isCurrentTrackCloned",!1),Te(this,"isRemoteTrack",!1),Te(this,"originVolumeLevelAnalyser",void 0),Te(this,"rebuildWebAudio",async()=>{if(k.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>k.info("resume success")),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const f=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?f.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),zg(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),zg(this.outputNode),this.emit(fc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),n.kind!=="audio")throw new Ie(Y.UNEXPECTED_ERROR);this.track=n;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),zg(this.sourceNode),o){const f=o.clone();f.enabled=!0,this.clonedTrack=f,k.debug("create an unmuted track ".concat(f.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([f]));zg(_),this.originVolumeLevelAnalyser=new d6,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=mn();i&&h.os===Ai.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Kn.on(Xi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(f=>{f||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const i=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(i),zg(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(fc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),Kn.off("state-change",this.rebuildWebAudio),(n=this.originVolumeLevelAnalyser)===null||n===void 0||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const i=n.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),k.debug("create an unmuted track ".concat(i.id," from the original track ").concat(n.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));zg(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function f6(e,n,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(n.height,1080),maxWidth:o(n.width,1920)}}};return n.frameRate&&typeof n.frameRate!="number"?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):typeof n.frameRate=="number"&&(c.video.mandatory.maxFrameRate=n.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function jue(e,n){const i=await m6(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Je((f,_)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const I=document.createElement("div");I.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const P=document.createElement("div");P.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const j=document.createElement("button");j.innerHTML="cancel",j.setAttribute("style","width: 85px;"),j.onclick=()=>{document.body.removeChild($);const q=new Error("NotAllowedError");q.name="NotAllowedError",_(q)};let x=h;const M=document.createElement("div");if(h){const q=document.createElement("input");q.setAttribute("type","checkbox");const oe=document.createElement("span");q.setAttribute("style","margin-right: 6px;"),oe.innerText="Share audio",q.checked=x,q.onchange=()=>{x=q.checked},M.appendChild(q),M.appendChild(oe)}P.appendChild(M),P.appendChild(j),y.appendChild(w),y.appendChild(I),y.appendChild(P);const $=document.createElement("div");$.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),$.appendChild(v),$.appendChild(y),document.body.appendChild($),u.map(q=>{if(q.id){const oe=document.createElement("div");oe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let me=q.thumbnail;try{const{width:ge}=me.getSize();ge>1920&&(me=me.resize({width:1920}))}catch(ge){throw ge&&ge.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ge}oe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+me.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+q.name.replace(/[\u00A0-\u9999<>\&]/g,function(ge){return"&#"+ge.charCodeAt(0)+";"})+"</span>",oe.onclick=()=>{document.body.removeChild($),f({sourceId:q.id,audio:x})},I.appendChild(oe)}})})}(i,n);return await f6(o,e,c)}async function m6(e){let n=["window","screen"];e!=="application"&&e!=="window"||(n=["window"]),e==="screen"&&(n=["screen"]);const i=I5();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Ie(Y.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:n}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{o=null}o&&o.then||(o=new Je((u,h)=>{i.desktopCapturer.getSources({types:n},(f,_)=>{f?h(f):u(_)})}));try{return await o}catch(u){throw new Ie(Y.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const k1=new vs("safari");let g6=!1,_6=!1;async function _c(e,n){let i=0,o=null;for(;i<2;)try{o=await Bue(e,n,i>0);break}catch(c){if(c instanceof Ie)throw k.error("[".concat(n,"] ").concat(c.toString())),c;const u=DI(c.name||c.code||c,c.message);if(u.code===Y.MEDIA_OPTION_INVALID){k.debug("[".concat(n,"] detect media option invalid, retry")),i+=1,await qi(500);continue}throw k.error("[".concat(n,"] ").concat(u.toString())),u}if(!o)throw new Ie(Y.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Bue(e,n,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ie(Y.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=wn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(I5())e.screen.sourceId?LE(c,await f6(e.screen.sourceId,e.screen,!!e.screenAudio)):LE(c,await jue(e.screen,!!e.screenAudio));else if(Xh()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Ie(Y.NOT_SUPPORTED,"This browser does not support screen sharing");k.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const I=await(h=e.screen.extensionId,f=n,new Je((P,j)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},x=>{if(!x||!x.streamId)return k.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),x),void j(new Ie(Y.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));P(x.streamId)})}catch(x){k.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),x.toString()),j(new Ie(Y.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=I,LE(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&s6(e.screen.mediaSource);const I={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:P,surfaceSwitching:j,systemAudio:x,preferCurrentTab:M}=e.screen,$={selfBrowserSurface:P,surfaceSwitching:j,systemAudio:x,preferCurrentTab:M};!P&&delete $.selfBrowserSurface,!j&&delete $.surfaceSwitching,!x&&delete $.systemAudio,!M&&delete $.preferCurrentTab,k.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:I,audio:e.screenAudio,controls:$})),LE(c,await navigator.mediaDevices.getDisplayMedia(yr({video:I,audio:e.screenAudio},$)))}else{if(!Nr())throw k.error("[".concat(n,"] This browser does not support screenSharing")),new Ie(Y.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&s6(e.screen.mediaSource);const I={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};k.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(I))),LE(c,await navigator.mediaDevices.getUserMedia(I))}}var h,f;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},v=Q("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),_=l1(_,v)}catch{}k.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(_)),mn();let y,w=null;(as()||io()||EI())&&(w=await k1.lock());try{y=await navigator.mediaDevices.getUserMedia(_)}catch(I){throw w&&w(),I}return _.audio&&(g6=!0),_.video&&(_6=!0),LE(c,y),w&&w(),c}function DI(e,n){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ie(Y.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new Ie(Y.DEVICE_NOT_FOUND,"".concat(e,": ").concat(n));case"NotSupportedError":return new Ie(Y.NOT_SUPPORTED,"".concat(e,": ").concat(n));case"NotReadableError":return new Ie(Y.NOT_READABLE,"".concat(e,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ie(Y.PERMISSION_DENIED,"".concat(e,": ").concat(n));case"ConstraintNotSatisfiedError":return new Ie(Y.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(n));default:return k.error("getUserMedia unexpected error",e),new Ie(Y.UNEXPECTED_ERROR,"".concat(e,": ").concat(n))}}function LE(e,n){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=n.getVideoTracks()[0],u=n.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const vc=new class extends Rr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Gg.STATE_CHANGE,e),this._state=e)}constructor(){super(),Te(this,"_state",r0.IDLE),Te(this,"isAccessMicrophonePermission",!1),Te(this,"isAccessCameraPermission",!1),Te(this,"lastAccessMicrophonePermission",!1),Te(this,"lastAccessCameraPermission",!1),Te(this,"checkdeviceMatched",!1),Te(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Q("ENUMERATE_DEVICES_INTERVAL")||(yI()||vI()===Ai.HARMONY_OS)&&Jh())&&this.updateDevicesInfo()},Q("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>k.error(e.toString()))}async enumerateDevices(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ie(Y.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&n;c.audio&&(u=!1),c.video&&(h=!1);let f=null,_=null,v=null;if(!i&&(u||h)){if(k1.isLocked&&(k.debug("[device manager] wait GUM lock"),(await k1.lock())(),k.debug("[device manager] GUM unlock")),g6&&(u=!1,this.isAccessMicrophonePermission=!0),_6&&(h=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,n,u,h),u&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(y){const w=DI(y.name||y.code||y,y.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{f=await navigator.mediaDevices.getUserMedia({audio:e})}catch(y){const w=DI(y.name||y.code||y,y.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:n})}catch(y){const w=DI(y.name||y.code||y,y.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",n)}try{const y=await navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),v&&v.getTracks().forEach(w=>w.stop()),f=null,_=null,v=null,y}catch(y){return f&&f.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),v&&v.getTracks().forEach(w=>w.stop()),f=null,_=null,v=null,new Ie(Y.ENUMERATE_DEVICES_FAILED,y.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(n=>n.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audiooutput")}searchDeviceIdByName(e){let n=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(n=i.device.deviceId)}),n}async getDeviceById(e){const n=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!n)throw new Ie(Y.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return n}async init(){this.state=r0.INITING;try{await this.updateDevicesInfo(),this.state=r0.INITEND}catch(e){throw k.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=r0.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ie(Y.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),n=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?k.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):k.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):k.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:n,updateAt:n,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=n)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==n&&(c.state="INACTIVE",i.push(c))}),this.state!==r0.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Gg.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Gg.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Gg.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const n=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let D1=!1;const Ec=new class extends Rr{constructor(){super(...arguments),Te(this,"onAutoplayFailed",void 0),Te(this,"onAudioAutoplayFailed",void 0)}};function v6(){if(mn(),!D1){const e=n=>{n.preventDefault(),D1=!1,qT()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};D1=!0,qT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),k.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ec.onAutoplayFailed?Ec.onAutoplayFailed():Ec.onAudioAutoplayFailed?k.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):k.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ec.emit("autoplay-failed")}}function E6(e,n,i,o){if(!e)return;const c=ht.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),f=yr(yr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Ec.onAutoplayFailed||Ec.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:n,trackId:o,extend:void 0});ht.send({type:Er.AUTOPLAY_FAILED,data:f},!0)}const Wue=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ko=new class{constructor(){Te(this,"onAutoplayFailed",void 0),Te(this,"elementMap",new Map),Te(this,"elementStateMap",new Map),Te(this,"elementsNeedToResume",[]),Te(this,"sinkIdMap",new Map),Te(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(n=>{let[i,o]=n;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(k.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(Kn.curState==="running")return yE()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(k.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Kn.on(Xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Kn.on(Xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Kn.on(Xi.STATE_CHANGE,()=>{io()&&Kn.prevState==="suspended"&&Kn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,n){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,n),i)try{await i.setSinkId(n)}catch(o){throw new Ie(Y.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,n,i,o){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,Gs.INIT),this.setVolume(n,i);const u=this.sinkIdMap.get(n);if(u)try{c.setSinkId(u).catch(f=>{k.warning("[".concat(n,"] set sink id failed"),f.toString())})}catch(f){k.warning("[".concat(n,"] set sink id failed"),f.toString())}const h=c.play();h&&h.then&&h.catch(f=>{o&&E6(o,"audio",f.message,n),k.warning("audio element play warning",f.toString()),this.elementMap.has(n)&&f.name==="NotAllowedError"&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),TI(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),v6()}))})}updateTrack(e,n){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([n]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,n){const i=this.elementMap.get(e);i&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(e){const n=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!n)return;const i=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(i,1),n.srcObject=null,n.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,n){Wue.forEach(i=>{n.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(k.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=n==null?void 0:n.error;h&&k.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(i=>{k.debug("Auto resume audio element success")}).catch(i=>{k.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new Je(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{qT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Yr(){return function(e,n,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new Ie(Y.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",k);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const f=o.apply(this,u);return f instanceof Je?new Je((_,v)=>{f.then(_).catch(v)}):f}),i}}class y6 extends Rr{constructor(n){super(),Te(this,"name","VideoProcessorDestination"),Te(this,"ID","0"),Te(this,"_source",void 0),Te(this,"videoContext",void 0),Te(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ie(Y.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ie(Y.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(so.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(so.ON_TRACK,void 0)}}class S6 extends Rr{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i){super(),Te(this,"constraintsMap",new Map),Te(this,"statsRegistry",[]),Te(this,"usageRegistry",[]),Te(this,"trackId",void 0),Te(this,"direction",void 0),Te(this,"_chained",!1),this.trackId=n,this.direction=i}async getConstraints(){return await ls(this,mc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(n,i){var o;return k.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),Qn(this,mc.REQUEST_UPDATE_CONSTRAINTS,Array.from(lc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return k.info("processor ".concat(n.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(n),Qn(this,mc.REQUEST_UPDATE_CONSTRAINTS,Array.from(lc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){k.error(new Ie(Y.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof Je&&(o=await o),n.push(yr(yr({},o),{},{direction:this.direction}))}catch(o){k.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class T6 extends Rr{constructor(n){super(),Te(this,"name","AudioProcessorDestination"),Te(this,"ID","0"),Te(this,"inputTrack",void 0),Te(this,"inputNode",void 0),Te(this,"audioProcessorContext",void 0),Te(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ie(Y.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ie(Y.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(so.ON_TRACK,void 0),this.emit(so.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(so.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(so.ON_NODE,this.inputNode))}}class b6 extends Rr{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i,o){super(),Te(this,"constraintsMap",new Map),Te(this,"statsRegistry",[]),Te(this,"audioContext",void 0),Te(this,"trackId",void 0),Te(this,"direction",void 0),Te(this,"usageRegistry",[]),Te(this,"_chained",!1),this.audioContext=n,this.trackId=i,this.direction=o}async getConstraints(){return ls(this,mc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(n,i){var o;return k.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),Qn(this,mc.REQUEST_UPDATE_CONSTRAINTS,Array.from(lc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return this.constraintsMap.delete(n),Qn(this,mc.REQUEST_UPDATE_CONSTRAINTS,Array.from(lc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){k.error(new Ie(Y.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof Je&&(o=await o),n.push(yr(yr({},o),{},{direction:this.direction}))}catch(o){k.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class L1 extends Rr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Te(this,"context",void 0),Te(this,"processSourceNode",void 0),Te(this,"outputTrack",void 0),Te(this,"processedNode",void 0),Te(this,"clonedTrack",void 0),Te(this,"outputNode",void 0),this.outputNode=new Gue}setVolume(){}createOutputTrack(){throw new Ie(Y.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Gue{disconnect(){}connect(){}}function w6(e){return new Je((n,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=io()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,f=c.videoHeight;!h&&Nr()||(o=!0,c.srcObject=null,c.remove(),n([h,f]))}),c.srcObject=new MediaStream([e]),c.play().catch(bI),setTimeout(()=>{o||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}function LI(e){const n={};e.facingMode&&(n.facingMode=e.facingMode),e.cameraId&&(n.deviceId={exact:e.cameraId});const i=kd(e.encoderConfig);return i.width!=null&&(n.width=i.width),i.height!=null&&(n.height=i.height),!T5()&&i.frameRate&&(n.frameRate=i.frameRate),f5()&&typeof n.frameRate=="object"&&(n.frameRate.max=60),Nr()&&(n.frameRate={ideal:30,max:30}),n}function R6(e){const n={};return T5()||(e.AGC!==void 0&&(n.autoGainControl=e.AGC),e.AEC!==void 0&&(n.echoCancellation=e.AEC),e.ANS!==void 0&&(n.noiseSuppression=e.ANS,Xh()&&e.ANS&&(n.googHighpassFilter=e.ANS))),n}function C6(e){const n=R6(e);if(e.encoderConfig){const i=NI(e.encoderConfig);n.channelCount=i.stereo?2:1,n.sampleRate=i.sampleRate,n.sampleSize=i.sampleSize}return e.microphoneId&&(n.deviceId={exact:e.microphoneId}),yI()&&(n.sampleRate=void 0),n}const zue=e=>{const n=e._encoderConfig;if(!n)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:f=c}=n;if(!u||!h||!f)return;h=u1(h),f=u1(f),u=u1(u);const{max:_,min:v}=function(P,j,x){const M=200*Math.pow(x/15,.6)*Math.pow(P*j/640/360,.75);return{min:Math.floor(M),max:Math.floor(4*M)}}(h,f,u),{bitrateMax:y,bitrateMin:w}=n||{};y||k.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(f,", fps: ").concat(u,"] => [brMax: ").concat(y,", brMin: ").concat(w,"]"));const{maxFramerate:I}=Q("ENCODER_CONFIG_LIMIT");return I&&typeof I=="number"&&(u=Math.min(u,I)),{frameRate:u,bitrateMax:y||_,bitrateMin:w||v,scaleResolutionDownBy:1,scale:0}},I6=async(e,n,i)=>await(async(o,c,u)=>{const h=function(v){const y=[];for(let w=0;w<v.length;w+=2)y.push(parseInt(v.slice(w,w+2),16));return Uint8Array.from(y)}(V5(""+c+u)).slice(0,16),f=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},_,o))})(e.buffer,n,i),x1=e=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new Je((i,o)=>{n.toBlob(async c=>{if(n.remove(),c){const u=await A6(c);i({buffer:u,width:n.width,height:n.height})}else o(new Ie(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},A6=async e=>{const n=await e.arrayBuffer();return new Uint8Array(n)};var O6,P6,N6,k6,D6,L6,x6,M6,U6,V6,F6,j6,B6,W6,G6,z6,H6,K6,Cr,$6,q6,Y6,X6,J6,Q6,Ld,Z6,eW,tW,nW,rW,iW,sW,oW,aW,cW,lW,uW,dW,ds;let Vr=(O6=Ot({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),P6=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),N6=Yr(),k6=bE("LocalAudioTrack","_enabledMutex"),D6=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),L6=Yr(),x6=bE("LocalAudioTrack","_enabledMutex"),M6=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),U6=Yr(),V6=Yr(),F6=Yr(),j6=Ot({argsMap:e=>[e.getTrackId()]}),B6=Yr(),W6=Ot({argsMap:e=>[e.getTrackId()]}),G6=Yr(),z6=Ot({argsMap:e=>[e.getTrackId()]}),H6=Ot({argsMap:(e,n)=>[e.getTrackId(),n.name]}),K6=Ot({argsMap:e=>[e.getTrackId()]}),_n((Cr=class extends kE{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ko.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,n,i,o){super(e,i),Te(this,"trackMediaType",NE.AUDIO),Te(this,"_encoderConfig",void 0),Te(this,"_trackSource",void 0),Te(this,"metadata",[]),Te(this,"_enabled",!0),Te(this,"_volume",100),Te(this,"_useAudioElement",!0),Te(this,"_bypassWebAudio",!1),Te(this,"processor",void 0),Te(this,"_processorContext",void 0),Te(this,"_processorDestination",void 0),Te(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=n,this._getOriginVolumeLevel=!!o,this._trackSource=new L1,Q("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Q("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),as()&&!gc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){qn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ko.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void k.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,Qn(this,at.NEED_REPLACE_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!r6())throw new Ie(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ko.setSinkID(this.getTrackId(),e)}async setEnabled(e,n,i){return this._setEnabled(e,n,i)}async _setEnabled(e,n,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await Qn(this,at.NEED_ENABLE_TRACK,this),k.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await Qn(this,at.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Qn(this,at.NEED_MUTE_TRACK,this):await Qn(this,at.NEED_UNMUTE_TRACK,this))}getStats(){return Df(()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),dc(this,at.GET_STATS)||yr({},I1)}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(fc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(fc.ON_AUDIO_BUFFER),this._source.on(fc.ON_AUDIO_BUFFER,i=>e(i))}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ko.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ko.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ko.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,n){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Qn(this,at.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Je.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ie(Y.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ie(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(e){e.on(so.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n),await Qn(this,at.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Qn(this,at.NEED_REPLACE_TRACK,this))}),e.on(so.ON_NODE,n=>{this._source.processedNode=n})}unbindProcessorDestinationEvents(e){e.removeAllListeners(so.ON_TRACK),e.removeAllListeners(so.ON_NODE)}bindProcessorContextEvents(e){e.on(mc.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(mc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof L1&&(this._trackSource=new p6(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new b6(this._source.context,this.getTrackId(),"local"),n=new T6(e);return this._processorContext=e,this._processorDestination=n,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(n),this._source.on(fc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ko.stop(this.getTrackId()),this._source.play()),Qn(this,at.NEED_REPLACE_MIXING_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{k.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:n}}}).prototype,"setVolume",[O6],Object.getOwnPropertyDescriptor(Cr.prototype,"setVolume"),Cr.prototype),_n(Cr.prototype,"setPlaybackDevice",[P6,N6],Object.getOwnPropertyDescriptor(Cr.prototype,"setPlaybackDevice"),Cr.prototype),_n(Cr.prototype,"setEnabled",[k6,D6,L6],Object.getOwnPropertyDescriptor(Cr.prototype,"setEnabled"),Cr.prototype),_n(Cr.prototype,"setMuted",[x6,M6,U6],Object.getOwnPropertyDescriptor(Cr.prototype,"setMuted"),Cr.prototype),_n(Cr.prototype,"getStats",[V6],Object.getOwnPropertyDescriptor(Cr.prototype,"getStats"),Cr.prototype),_n(Cr.prototype,"setAudioFrameCallback",[F6],Object.getOwnPropertyDescriptor(Cr.prototype,"setAudioFrameCallback"),Cr.prototype),_n(Cr.prototype,"play",[j6,B6],Object.getOwnPropertyDescriptor(Cr.prototype,"play"),Cr.prototype),_n(Cr.prototype,"stop",[W6,G6],Object.getOwnPropertyDescriptor(Cr.prototype,"stop"),Cr.prototype),_n(Cr.prototype,"close",[z6],Object.getOwnPropertyDescriptor(Cr.prototype,"close"),Cr.prototype),_n(Cr.prototype,"pipe",[H6],Object.getOwnPropertyDescriptor(Cr.prototype,"pipe"),Cr.prototype),_n(Cr.prototype,"unpipe",[K6],Object.getOwnPropertyDescriptor(Cr.prototype,"unpipe"),Cr.prototype),Cr),xI=($6=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),q6=Yr(),Y6=bE("MicrophoneAudioTrack","_enabledMutex"),X6=Ot({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),J6=Yr(),Q6=Ot({argsMap:e=>[e.getTrackId()]}),_n((Ld=class extends Vr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,n,i,o){super(e,n.encoderConfig?NI(n.encoderConfig):{},o,Q("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Te(this,"_config",void 0),Te(this,"_deviceName","default"),Te(this,"_constraints",void 0),Te(this,"_originalConstraints",void 0),Te(this,"_enabled",!0),this._config=n,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),(yE()||n1())&&Kn.bindInterruptDetectorTrack(this)}async setDevice(e){if(k.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const n=await vc.getDeviceById(e),i={};i.audio=yr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await _c(i,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await _c({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await vc.getDeviceById(e);this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}k.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,n,i){if(n)return k.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Q("AUTO_RESET_AUDIO_ROUTE")&&(io()||kl())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await Qn(this,at.NEED_DISABLE_TRACK,this)}catch(h){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=yr({},this._constraints),u=vc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await _c({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Qn(this,at.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}k.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(yE()||n1())&&Kn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((io()||kl())&&this._enabled&&!this._isClosed&&Kn.duringInterruption){const e=async()=>{Kn.off(Xi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Kn.on(Xi.IOS_INTERRUPTION_END,e)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(OE.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=vc.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId=i),this._constraints=n,this._enabled){this._originMediaStreamTrack.stop();const o=await _c({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(mc.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(mc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[$6,q6],Object.getOwnPropertyDescriptor(Ld.prototype,"setDevice"),Ld.prototype),_n(Ld.prototype,"setEnabled",[Y6,X6,J6],Object.getOwnPropertyDescriptor(Ld.prototype,"setEnabled"),Ld.prototype),_n(Ld.prototype,"close",[Q6],Object.getOwnPropertyDescriptor(Ld.prototype,"close"),Ld.prototype),Ld),Hue=(Z6=Ot({argsMap:(e,n)=>[e.getTrackId(),n,e.duration]}),eW=Yr(),tW=Ot({argsMap:e=>[e.getTrackId()]}),nW=Yr(),rW=Ot({argsMap:e=>[e.getTrackId()]}),iW=Yr(),sW=Ot({argsMap:e=>[e.getTrackId()]}),oW=Yr(),aW=Ot({argsMap:e=>[e.getTrackId()]}),cW=Yr(),lW=Ot({argsMap:e=>[e.getTrackId()]}),uW=Ot({argsMap:e=>[e.getTrackId()]}),dW=Yr(),_n((ds=class extends Vr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,n,i,o){super(n.createOutputTrack(),i,o),Te(this,"source",void 0),Te(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=n,this._bufferSource.on(fc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(OE.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){qn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Z6,eW],Object.getOwnPropertyDescriptor(ds.prototype,"startProcessAudioBuffer"),ds.prototype),_n(ds.prototype,"pauseProcessAudioBuffer",[tW,nW],Object.getOwnPropertyDescriptor(ds.prototype,"pauseProcessAudioBuffer"),ds.prototype),_n(ds.prototype,"seekAudioBuffer",[rW,iW],Object.getOwnPropertyDescriptor(ds.prototype,"seekAudioBuffer"),ds.prototype),_n(ds.prototype,"resumeProcessAudioBuffer",[sW,oW],Object.getOwnPropertyDescriptor(ds.prototype,"resumeProcessAudioBuffer"),ds.prototype),_n(ds.prototype,"stopProcessAudioBuffer",[aW,cW],Object.getOwnPropertyDescriptor(ds.prototype,"stopProcessAudioBuffer"),ds.prototype),_n(ds.prototype,"close",[lW],Object.getOwnPropertyDescriptor(ds.prototype,"close"),ds.prototype),_n(ds.prototype,"setAudioBufferPlaybackSpeed",[uW,dW],Object.getOwnPropertyDescriptor(ds.prototype,"setAudioBufferPlaybackSpeed"),ds.prototype),ds);class Ei extends Vr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=DE().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,Zn(8,"track-mix-")),Te(this,"trackList",void 0),Te(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return this.trackList.indexOf(n)!==-1}addAudioTrack(n){this.trackList.indexOf(n)===-1?(k.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):k.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(this.trackList.indexOf(n)!==-1){k.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}SI(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(i=>{i instanceof Ei?i.emit(Wg.TRANSCEIVER_UPDATED,n):i._updateRtpTransceiver(n)}))}}class Kue extends h6{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(fc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Te(this,"audioBuffer",void 0),Te(this,"sourceNode",void 0),Te(this,"startPlayTime",0),Te(this,"startPlayOffset",0),Te(this,"pausePlayTime",0),Te(this,"options",void 0),Te(this,"currentLoopCount",0),Te(this,"currentPlaybackSpeed",100),Te(this,"_currentState","stopped"),this.audioBuffer=n,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){this.currentState==="stopped"?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=n,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const hW=new Map;class M1{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const n=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/n;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(k.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}get videoState(){return this._videoState}set videoState(n){var i;n!==this._videoState&&(this._videoState=n,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(n){Te(this,"trackId",void 0),Te(this,"config",void 0),Te(this,"onFirstVideoFrameDecoded",void 0),Te(this,"onVideoStateChanged",void 0),Te(this,"freezeTimeCounterList",[]),Te(this,"renderFreezeAccTime",0),Te(this,"isKeepLastFrame",!1),Te(this,"timeUpdatedCount",0),Te(this,"freezeTime",0),Te(this,"playbackTime",0),Te(this,"lastTimeUpdatedTime",0),Te(this,"autoplayFailed",!1),Te(this,"videoTrack",void 0),Te(this,"videoElement",void 0),Te(this,"cacheVideoElement",void 0),Te(this,"renderStats",void 0),Te(this,"_videoState",Dd.VideoStateStopped),Te(this,"videoElementCheckInterval",void 0),Te(this,"videoElementFreezeTimeout",void 0),Te(this,"_videoElementStatus",Gs.NONE),Te(this,"isGettingVideoDimensions",!1),Te(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Te(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Kn.curState==="running"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(p5())),y5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Te(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Gs.PLAYING;break;case"loadeddata":if(this.videoState=Dd.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Gs.CANPLAY;break;case"stalled":this.videoElementStatus=Gs.STALLED;break;case"suspend":this.videoElementStatus=Gs.SUSPEND;break;case"pause":this.videoElementStatus=Gs.PAUSED,io()||kl()||as()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Gs.WAITING;break;case"abort":this.videoElementStatus=Gs.ABORT;break;case"ended":this.videoElementStatus=Gs.ENDED;break;case"emptied":this.videoElementStatus=Gs.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Gs.ERROR,k.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,ep.lastVisibleTime<ep.lastHiddenTime||u<ep.lastHiddenTime||u<ep.lastVisibleTime)return;for(c>Q("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(p5())),y5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,n.element instanceof HTMLVideoElement?this.videoElement=n.element:this.videoElement=document.createElement("video"),Kn.on(Xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Kn.on(Xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return(n=this.videoElement.parentElement)!==null&&n!==void 0?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{n&&E6(n,"video",c.message,this.trackId),c.name==="NotAllowedError"?(k.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):k.warning("[".concat(this.trackId,"] play warning: "),c)});const o=mn();if((o.name==="Safari"&&Number(o.version)===15||yE())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");if(!i)return k.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,n.width,n.height);const o=i.getImageData(0,0,n.width,n.height);return n.remove(),o}async getCurrentFrameToUint8Array(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new Je((u,h)=>{o.toBlob(async f=>{if(o.remove(),f){const _=await A6(f);u({buffer:_,width:o.width,height:o.height})}else h(new Ie(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,i<0?.1:i>1?1:i)})):await x1(n)}destroy(){this.renderStats=void 0,Kn.off(Xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Kn.off(Xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Dd.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Gs.INIT,!this.videoElementCheckInterval&&(pW.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=Gs.DESTROYED)},1e3),Q("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(f,Q("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Dd.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Dd.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(v,y)=>{if(this.videoElementStatus===Gs.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=y.mediaTime):this.renderStats={lastTs:y.mediaTime,curTs:y.mediaTime,lastRenderNum:0,renderNum:0},u){const P=y.presentationTime-u.presentationTime;this.videoState===Dd.VideoStateStarting&&(this.videoState=Dd.VideoStateDecoding),this.videoState===Dd.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,Q("VIDEO_FREEZE_DURATION"))),P<Q("VIDEO_FREEZE_DURATION")&&this.videoState===Dd.VideoStateFrozen&&(this.videoState=Dd.VideoStateDecoding),P>Q("VIDEO_FREEZE_DURATION")&&ep.lastVisibleTime>=ep.lastHiddenTime&&u.timestamp>ep.lastVisibleTime&&u.timestamp>ep.lastHiddenTime&&(this.renderFreezeAccTime+=P)}u=yr(yr({},y),{},{timestamp:v})}var w,I;Q("ENABLE_VIDEO_FRAME_CALLBACK")&&((w=(I=this.videoElement).requestVideoFrameCallback)===null||w===void 0||w.call(I,_))};(n=(i=this.videoElement).requestVideoFrameCallback)===null||n===void 0||n.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),yI()&&!Q("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=mn();o.name==="Safari"&&Number(o.version)===15||yE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{k.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){pW.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Gs.NONE}handleAutoPlayFailed(){const n=i=>{i.preventDefault(),this.videoElement.play().then(()=>{k.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{k.error(o)}),this.autoplayFailed=!1,qT()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};qT()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),v6()}}const pW=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class fW extends M1{constructor(n){super(n),Te(this,"container",void 0),Te(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const i=n.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(n){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(n,o):await x1(n)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Q("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if((n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var mW,gW,_W,vW,EW,yW,SW,TW,bW,wW,RW,CW,IW,AW,OW,PW,NW,kW,DW,LW,xW,MW,UW,VW,hn,FW,jW,BW,WW,GW,zW,HW,KW,yc;let ur=(mW=Ot({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),gW=Yr(),_W=Ot({argsMap:e=>[e.getTrackId()]}),vW=bE("LocalVideoTrack","_enabledMutex"),EW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),yW=Yr(),SW=bE("LocalVideoTrack","_enabledMutex"),TW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),bW=Yr(),wW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),RW=Yr(),CW=Yr(),IW=Ot({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),AW=Yr(),OW=Yr(),PW=Yr(),NW=Yr(),kW=Yr(),DW=Yr(),LW=Yr(),xW=Ot({argsMap:(e,n)=>[e.getTrackId(),n.name]}),MW=Ot({argsMap:e=>[e.getTrackId()]}),UW=Ot({argsMap:e=>[e.getTrackId()]}),VW=Ot({argsMap:(e,n,i)=>[e.getTrackId(),n.label,i]}),hn=class Une extends kE{get videoHeight(){if(as()){const{height:n}=this._mediaStreamTrack.getSettings();return this._videoHeight=n,this._videoHeight}return this._videoHeight}get videoWidth(){if(as()){const{width:n}=this._mediaStreamTrack.getSettings();return this._videoWidth=n,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Gs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,i,o,c,u,h){if(super(n,u),Te(this,"trackMediaType",NE.VIDEO),Te(this,"_player",void 0),Te(this,"isUseScaleResolutionDownBy",!1),Te(this,"_videoVisibleTimer",null),Te(this,"_previousVideoVisibleStatus",void 0),Te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Te(this,"_encoderConfig",void 0),Te(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Te(this,"_optimizationMode",void 0),Te(this,"_videoHeight",void 0),Te(this,"_videoWidth",void 0),Te(this,"_forceBitrateLimit",void 0),Te(this,"_enabled",!0),Te(this,"_processorDestination",void 0),Te(this,"_processorContext",void 0),as()){const{width:f,height:_}=n.getSettings();this._videoWidth=f,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(er.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(ZD(An.CHROME,115)&&vI().indexOf("Windows")!==-1){const f=function(_,v){if("VideoFrame"in window&&"TransformStream"in window&&wn().supportWebRTCInsertableStream){const y=new MediaStreamTrackProcessor(_),w=new MediaStreamTrackGenerator({kind:"video"});let I,P,j=Date.now();const x=()=>{M&&(clearInterval(M),M=void 0),I&&(I.close(),I=void 0),_.stop(),P=void 0,w.removeEventListener("ended",x)};let M=window.setInterval(()=>{if(P&&I&&Date.now()-j>1e3)try{w.readyState==="live"?P.enqueue(I.clone()):x()}catch{x()}},1e3);const $=new TransformStream({transform:(q,oe)=>{w.readyState==="live"?(P=oe,j=Date.now(),I===void 0?(I=q,oe.enqueue(q.clone())):(oe.enqueue(I),I=q)):q.close()}});return w.addEventListener("ended",x),y.readable.pipeThrough($).pipeTo(w.writable),w}}(n);f&&(k.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}i&&this._hints.indexOf(er.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new S6(this.getTrackId(),"local"),this._processorDestination=new y6(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof n=="string"){const c=document.getElementById(n);c?n=c:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=yr(yr(yr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(o):(n instanceof HTMLVideoElement?this._player=new M1(o):this._player=new fW(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(OE.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},Q("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),n),!n){this._originMediaStreamTrack.enabled=!1;try{await Qn(this,at.NEED_DISABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Qn(this,at.NEED_ENABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await Qn(this,at.NEED_MUTE_TRACK,this):await Qn(this,at.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Ie(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=kd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const o=LI({encoderConfig:n});(as()||io()||kl())&&(o.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Ie(Y.UNEXPECTED_ERROR,c.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=n,this._hints.indexOf(er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Qn(this,at.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(k)}}getStats(){return Df(()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),dc(this,at.GET_STATS)||yr({},A1)}async setBeautyEffect(n){k.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(n,i):await x1(n)}async setBitrateLimit(n){k.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n&&(this._forceBitrateLimit=n,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<n.max_bitrate?this._encoderConfig.bitrateMax:n.max_bitrate:this._encoderConfig.bitrateMax=n.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=n.min_bitrate))}async setOptimizationMode(n){if(n!=="motion"&&n!=="detail"&&n!=="balanced")return void k.error(Y.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=n,await Qn(this,at.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,k.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(n,")"))}setScalabiltyMode(n){if(n.numSpatialLayers===1&&n.numTemporalLayers!==1)return k.error(Y.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,k.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){w6(this._originMediaStreamTrack).then(n=>{let[i,o]=n;this._videoHeight=o,this._videoWidth=i}).catch(bI)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(n){if(!this._enabled)throw new Ie(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");k.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(n)),n=kd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),this._encoderConfig=n,this._hints.indexOf(er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Qn(this,at.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(k)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!n||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:f}=function(_,v,y,w,I){const P=Q("BITRATE_ADAPTER_TYPE");if(P==="DEFAULT_BITRATE")return{min:w,max:I};if(I===void 0){var j;const M=Math.floor(200*Math.pow(y/15,.6)*Math.pow(_*v/640/360,.75));I=P==="STANDARD_BITRATE"?4*M:2*M,w=(j=w)!==null&&j!==void 0?j:M}else{var x;w=(x=w)!==null&&x!==void 0?x:Math.floor(I/10)}return{min:w,max:I}}(n,i,o,u,c);this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=h,k.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(f,"]"))}}getVideoElementVisibleStatus(){try{var n,i;const o=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=R5.checkOneElementVisible(u),_=Object.assign({},f);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const v=ht.reportApiInvoke(null,{tag:Dr.TRACER,name:hi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Ie(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(n){}pipe(n){if(this.processor===n)return n;if(n._source)throw new Ie(Y.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=yr(yr({},o),kd(n))),o=Vg(o);const c=Zn(8,"track-video-cloned-"),u=new Une(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,Vg(this._scalabilityMode),this._optimizationMode,c,Vg(this._hints));return n&&o&&u.setEncoderConfiguration(o),k.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(n,i){if(!(n instanceof MediaStreamTrack))throw new Ie(Y.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(n.kind!=="video")throw new Ie(Y.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(n,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(n){if(Df(()=>{ht.reportApiInvoke(null,{name:hi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Dr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Q("ENABLE_VIDEO_SEI")||!Q("ENABLE_ENCODED_TRANSFORM"))return void k.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(n instanceof Uint8Array==0)return new Ie(Y.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void k.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",n):k.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(so.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(),await Qn(this,at.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Qn(this,at.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(so.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(mc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(mc.REQUEST_CONSTRAINTS)}},_n(hn.prototype,"play",[mW,gW],Object.getOwnPropertyDescriptor(hn.prototype,"play"),hn.prototype),_n(hn.prototype,"stop",[_W],Object.getOwnPropertyDescriptor(hn.prototype,"stop"),hn.prototype),_n(hn.prototype,"setEnabled",[vW,EW,yW],Object.getOwnPropertyDescriptor(hn.prototype,"setEnabled"),hn.prototype),_n(hn.prototype,"setMuted",[SW,TW,bW],Object.getOwnPropertyDescriptor(hn.prototype,"setMuted"),hn.prototype),_n(hn.prototype,"setEncoderConfiguration",[wW,RW],Object.getOwnPropertyDescriptor(hn.prototype,"setEncoderConfiguration"),hn.prototype),_n(hn.prototype,"getStats",[CW],Object.getOwnPropertyDescriptor(hn.prototype,"getStats"),hn.prototype),_n(hn.prototype,"setBeautyEffect",[IW,AW],Object.getOwnPropertyDescriptor(hn.prototype,"setBeautyEffect"),hn.prototype),_n(hn.prototype,"getCurrentFrameData",[OW],Object.getOwnPropertyDescriptor(hn.prototype,"getCurrentFrameData"),hn.prototype),_n(hn.prototype,"getCurrentFrameImage",[PW],Object.getOwnPropertyDescriptor(hn.prototype,"getCurrentFrameImage"),hn.prototype),_n(hn.prototype,"setBitrateLimit",[NW],Object.getOwnPropertyDescriptor(hn.prototype,"setBitrateLimit"),hn.prototype),_n(hn.prototype,"setOptimizationMode",[kW],Object.getOwnPropertyDescriptor(hn.prototype,"setOptimizationMode"),hn.prototype),_n(hn.prototype,"setScalabiltyMode",[DW],Object.getOwnPropertyDescriptor(hn.prototype,"setScalabiltyMode"),hn.prototype),_n(hn.prototype,"updateMediaStreamTrackResolution",[LW],Object.getOwnPropertyDescriptor(hn.prototype,"updateMediaStreamTrackResolution"),hn.prototype),_n(hn.prototype,"pipe",[xW],Object.getOwnPropertyDescriptor(hn.prototype,"pipe"),hn.prototype),_n(hn.prototype,"unpipe",[MW],Object.getOwnPropertyDescriptor(hn.prototype,"unpipe"),hn.prototype),_n(hn.prototype,"close",[UW],Object.getOwnPropertyDescriptor(hn.prototype,"close"),hn.prototype),_n(hn.prototype,"replaceTrack",[VW],Object.getOwnPropertyDescriptor(hn.prototype,"replaceTrack"),hn.prototype),hn),U1=(FW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),jW=Yr(),BW=bE("CameraVideoTrack","_enabledMutex"),WW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),GW=Yr(),zW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),HW=Yr(),KW=Ot({argsMap:e=>[e.getTrackId()]}),yc=class Vne extends ur{get __className__(){return"CameraVideoTrack"}constructor(n,i,o,c,u,h){super(n,kd(i.encoderConfig),c,u,h),Te(this,"_config",void 0),Te(this,"_originalConstraints",void 0),Te(this,"_constraints",void 0),Te(this,"_enabled",!0),Te(this,"_deviceName","default"),Te(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(yE()||n1())&&!function(){const f=mn();if(f.os!==Ai.IOS||!f.osVersion)return!1;const _=f.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&S5()&&this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=n.label,this._encoderConfig=kd(this._config.encoderConfig),Kn.on(Xi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Kn.on(Xi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(n){return typeof n=="string"?this._setDeviceById(n):n.deviceId?this._setDeviceById(n.deviceId):n.facingMode?this._setDeviceByFacingModel(n.facingMode):void 0}async _setDeviceById(n){if(k.info("[".concat(this.getTrackId(),"] set device to ").concat(n)),this._enabled)try{const i=await vc.getDeviceById(n),o={};o.video=yr({},this._constraints),o.video.deviceId={exact:n},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await _c(o,this.getTrackId())}catch(u){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await _c({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await vc.getDeviceById(n);this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}k.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(n){k.info("[".concat(this.getTrackId(),"] set facingMode ").concat(n));const i={video:yr(yr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await _c(i,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await _c({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=n,this._config.cameraId=void 0,this._constraints=yr({},i.video),k.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await _c({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await Qn(this,at.NEED_ENABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await Qn(this,at.NEED_DISABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Ie(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=kd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate||n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate||n.bitrateMin);const o=Lr(this._config);o.encoderConfig=n;const c=LI(o);(as()||io()||kl())&&(c.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Ie(Y.UNEXPECTED_ERROR,u.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=n,this._hints.indexOf(er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Qn(this,at.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(k)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((io()||kl())&&this._enabled&&!this._isClosed&&Kn.duringInterruption){const n=async()=>{Kn.off(Xi.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Kn.on(Xi.IOS_INTERRUPTION_END,n)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(OE.TRACK_ENDED)}async renewMediaStreamTrack(n){const i=n||this._constraints,o=vc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await _c({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Kn.off(Xi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Kn.off(Xi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=yr(yr({},o),kd(n))),o=Vg(o);const c=Zn(8,"track-cam-cloned-"),u=new Vne(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Vg(yr(yr({},this._config),{},{encoderConfig:o})),Vg(this._constraints),Vg(this._scalabilityMode),this._optimizationMode,c);return n&&o&&u.setEncoderConfiguration(o),k.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(mc.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(mc.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}},_n(yc.prototype,"setDevice",[FW,jW],Object.getOwnPropertyDescriptor(yc.prototype,"setDevice"),yc.prototype),_n(yc.prototype,"setEnabled",[BW,WW,GW],Object.getOwnPropertyDescriptor(yc.prototype,"setEnabled"),yc.prototype),_n(yc.prototype,"setEncoderConfiguration",[zW,HW],Object.getOwnPropertyDescriptor(yc.prototype,"setEncoderConfiguration"),yc.prototype),_n(yc.prototype,"close",[KW],Object.getOwnPropertyDescriptor(yc.prototype,"close"),yc.prototype),yc);function V1(e,n,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=yr(yr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(n.contentHint=i.optimizationMode,n.contentHint===i.optimizationMode?k.debug("[".concat(e,"] set content hint to"),i.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))):k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var $W,qW,YW,XW,Jc,JW,QW,ZW,eG,tG,nG,zs;class rG extends l6{getUserId(){return this._userId}constructor(n,i,o,c){super(n,"track-".concat(n.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(Zn(5,""))),Te(this,"_userId",void 0),Te(this,"_uintId",void 0),Te(this,"_isDestroyed",!1),Te(this,"store",void 0),Te(this,"processor",void 0),Te(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,k.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let xE=($W=Ot({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),qW=Ot({argsMap:e=>[e.getTrackId()]}),YW=Ot({argsMap:(e,n)=>[e.getTrackId(),n.name]}),XW=Ot({argsMap:e=>[e.getTrackId()]}),_n((Jc=class extends rG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Gs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,n,i,o){super(e,n,i,o),Te(this,"_videoVisibleTimer",null),Te(this,"_previousVideoVisibleStatus",void 0),Te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Te(this,"trackMediaType",NE.VIDEO),Te(this,"_videoWidth",void 0),Te(this,"_videoHeight",void 0),Te(this,"_player",void 0),Te(this,"processorDestination",void 0),Te(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new S6(this.getTrackId(),"remote"),this.processorDestination=new y6(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Df(()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),dc(this,at.GET_STATS)||yr({},a6)}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=yr(yr({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new M1(i):this._player=new fW(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(PE.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(PE.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(PE.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},Q("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){w6(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(bI)}_updatePlayerSource(){k.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=R5.checkOneElementVisible(c),f=Object.assign({},h);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;const _=ht.reportApiInvoke(null,{tag:Dr.TRACER,name:hi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(i){throw new Ie(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ie(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(so.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(so.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Wg.SEI_RECEIVED,e)}}).prototype,"play",[$W],Object.getOwnPropertyDescriptor(Jc.prototype,"play"),Jc.prototype),_n(Jc.prototype,"stop",[qW],Object.getOwnPropertyDescriptor(Jc.prototype,"stop"),Jc.prototype),_n(Jc.prototype,"pipe",[YW],Object.getOwnPropertyDescriptor(Jc.prototype,"pipe"),Jc.prototype),_n(Jc.prototype,"unpipe",[XW],Object.getOwnPropertyDescriptor(Jc.prototype,"unpipe"),Jc.prototype),Jc),ME=(JW=Ot({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),QW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),ZW=Ot({argsMap:e=>[e.getTrackId()]}),eG=Ot({argsMap:e=>[e.getTrackId()]}),tG=Ot({argsMap:(e,n)=>[e.getTrackId(),n.name]}),nG=Ot({argsMap:e=>[e.getTrackId()]}),_n((zs=class extends rG{get isPlaying(){return this._useAudioElement?ko.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,n,i,o){super(e,n,i,o),Te(this,"trackMediaType",NE.AUDIO),Te(this,"_source",void 0),Te(this,"_useAudioElement",!0),Te(this,"_volume",100),Te(this,"processorContext",void 0),Te(this,"processorDestination",void 0),Te(this,"_played",!1),Te(this,"_bypassWebAudio",!1),Q("DISABLE_WEBAUDIO")?(this._source=new L1,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new p6(e,!0),Q("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(fc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(PE.FIRST_FRAME_DECODED)}),this.processorContext=new b6(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new T6(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(fc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(fc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(fc.ON_AUDIO_BUFFER),this._source.on(fc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?ko.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!r6())throw new Ie(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ko.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Df(()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),dc(this,at.GET_STATS)||yr({},o6)}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] use audio element to play")),ko.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ko.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ko.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ie(Y.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ie(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ie(Y.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(so.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(so.ON_NODE,e=>{this._source.processedNode=e;const n=!e;this._useAudioElement!==n&&(this._played?(this.stop(),this._useAudioElement=n,this.play()):this._useAudioElement=n)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(so.ON_TRACK),this.processorDestination.removeAllListeners(so.ON_NODE)}}).prototype,"setVolume",[JW],Object.getOwnPropertyDescriptor(zs.prototype,"setVolume"),zs.prototype),_n(zs.prototype,"setPlaybackDevice",[QW],Object.getOwnPropertyDescriptor(zs.prototype,"setPlaybackDevice"),zs.prototype),_n(zs.prototype,"play",[ZW],Object.getOwnPropertyDescriptor(zs.prototype,"play"),zs.prototype),_n(zs.prototype,"stop",[eG],Object.getOwnPropertyDescriptor(zs.prototype,"stop"),zs.prototype),_n(zs.prototype,"pipe",[tG],Object.getOwnPropertyDescriptor(zs.prototype,"pipe"),zs.prototype),_n(zs.prototype,"unpipe",[nG],Object.getOwnPropertyDescriptor(zs.prototype,"unpipe"),zs.prototype),zs);const ep=new class extends Rr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Te(this,"_lastHiddenTime",0),Te(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),k.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class iG extends Rr{constructor(n,i){super(),Te(this,"trackMediaType",NE.DATA),Te(this,"_version",1),Te(this,"_type",3),Te(this,"_config",void 0),Te(this,"_originDataChannel",void 0),Te(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Te(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Te(this,"_datachannelEventMap",new Map),this._config=n,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(n){this._dataStreamPacketHandler=n}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Q("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&n!==void 0?n:"connecting"}get _originDataChannelId(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&n!==void 0?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Je((n,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&n();const o=setTimeout(()=>{var c;i(new Ie(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),n()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Ie(Y.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Ie(Y.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[kI.OPEN,kI.CLOSE,kI.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),n.addEventListener(i,o)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;n.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class $ue extends iG{constructor(n){super(n),Te(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(Q("SHOW_DATASTREAM2_LOG")&&k.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(kI.MESSAGE,u)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class que extends iG{send(n){if(this._originDataChannel){let i=n;i=this._dataStreamPacketHandler.serialize(n);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function MI(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>MC.revokeObjectURL(e),0),new Worker(MC.createObjectURL(e))}const sG=71,F1=1,j1=2,B1=1,oG=2;var tp=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(tp||{});function aG(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==sG)return;const o=e.getUint16(1),c=F1+j1+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let f=F1+j1;for(;f<c;){const _=e.getUint8(f),v=e.getUint16(f+B1),y=B1+oG;if(_===tp.AUDIO_LEVEL){let w=e.getUint8(f+y);for(let I=1;I<v;I++)w=w<<8|e.getUint8(f+y+I);h.tlv.push({tag:_,length:v,value:n?127^w>>1:127&w})}else if(_===tp.METADATA||_===tp.AUDIO_64_BIT_PTS){const w=new Uint8Array(v);for(let I=0;I<v;I++)w[I]=e.getUint8(f+y+I);h.tlv.push({tag:_,length:v,value:w})}f+=y+v}return h}const UI=new Map,VI=127,Hg=1e-10,W1=139/13,FI=new Map;function G1(e,n,i){const o="".concat(e,"-").concat(n,"-").concat(i);let c=0;return FI.has(o)?c=FI.get(o):(c=Math.log(function(h,f){const _=h-f;f<_&&(f=_);let v=1;for(let y=h,w=1;y>f;y--,w++)v=v*y/w;return v}(n,e))+e*Math.log(.5)+(n-e)*Math.log(1-.5)-Math.log(i)+i*e,FI.set(o,c)),c<Hg&&(c=Hg),c}function cG(e,n,i){const o=n.length,c=e.length/o;let u=!1;for(let h=0,f=0;h<o;h++){let _=0;for(let v=f+c;f<v;f++)e[f]>i&&_++;n[h]!==_&&(n[h]=_,u=!0)}return u}window.cache=FI;let Yue=0;class lG{constructor(n){Te(this,"id",void 0),Te(this,"immediates",[]),Te(this,"lastNonSilence",-1),Te(this,"immediateSpeechActivityScore",Hg),Te(this,"lastLevelChangedTime",Date.now()),Te(this,"levels",[]),Te(this,"longs",[]),Te(this,"longSpeechActivityScore",Hg),Te(this,"mediums",[]),Te(this,"mediumSpeechActivityScore",Hg),Te(this,"minLevel",0),Te(this,"nextMinLevel",0),Te(this,"nextMinLevelWindowLength",0),Te(this,"energyScore",0),this.id=n||"".concat(Yue++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const n=this.immediates,i=this.levels,o=this.minLevel+W1;let c=!1;for(let u=0;u<n.length;++u){let h=i[u];h<o&&(h=0);const f=Math.floor(h/W1);n[u]!==f&&(n[u]=f,c=!0)}return c}computeLongs(){return cG(this.mediums,this.longs,4)}computeMediums(){return cG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=G1(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(n){this.longSpeechActivityScore=G1(this.longs[0],10,47),this.longSpeechActivityScore>Hg&&(this.lastNonSilence=n)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=G1(this.mediums[0],5,24)}evaluateSpeechActivityScores(n){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(n)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var n;return"[".concat(of(n=[...this.levels]).call(n).join(),"]")}getSpeechActivityScore(n){switch(n){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+n)}}levelChanged(n,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=n;return n<0&&(o=0),n>VI&&(o=VI),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+W1?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(n){if(n!==0){if(this.minLevel===0||this.minLevel>n)return this.minLevel=n,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=n,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>n&&(this.nextMinLevel=n),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>VI&&(i=VI),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Xue{constructor(n){Te(this,"algorithm",void 0),this.algorithm=n}execute(){let n=!this.algorithm;if(!n)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?n=!0:setTimeout(this.execute.bind(this),i)}catch{n=!0}n&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class z1{constructor(n,i,o){Te(this,"isDominant",void 0),Te(this,"energyRanking",void 0),Te(this,"energyScore",void 0),this.isDominant=n,this.energyRanking=i,this.energyScore=o}}class Jue extends Rr{constructor(n){super(),Te(this,"dominantId",null),Te(this,"lastDecisionTime",0),Te(this,"lastLevelChangedTime",0),Te(this,"lastLevelIdleTime",0),Te(this,"relativeSpeechActivities",[]),Te(this,"speakers",new Map),Te(this,"enableSilence",!1),Te(this,"timeoutToSilenceInterval",0),Te(this,"decisionMaker",null),Te(this,"loudest",[]),Te(this,"numLoudestToTrack",3),Te(this,"energyExpireTimeMs",250),Te(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=n,this.enableSilence=n>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=n,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>n&&this.loudest.splice(n)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(n){return this.loudest.some(i=>i.id===n)}levelChanged(n,i){const o=Date.now(),c=this.getOrCreateSpeaker(n);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(n){return this.decisionMaker!==n||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(n){this.decisionMaker===n&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(n){n.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(n){n.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(n){let i=this.speakers.get(n);return i||(i=new lG(n),this.speakers.set(n,i),this.maybeStartDecisionMaker()),i}updateLoudestList(n,i,o){const c=n.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==n;)++_;return new z1(c,_,n.energyScore)}if(n.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*n.energyScore+50)/100),this.numLoudestToTrack===0)return new z1(c,0,n.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==n.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let f=0;for(;f<this.loudest.length&&!(this.loudest[f].energyScore<n.energyScore);)++f;return f<this.numLoudestToTrack&&(this.loudest.splice(f,0,n),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new z1(c,f,n.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Xue(this),this.decisionMaker.execute())}makeDecision(n){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const f=lc(h=this.speakers).call(h).next().value;this.enableSilence&&f&&(u=f.id,f.evaluateSpeechActivityScores(n),n-f.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let f=this.dominantId==null?null:this.speakers.get(this.dominantId);if(f==null){const y=this.speakers.entries().next();y.value&&(u=y.value[0],f=y.value[1])}else u=f.id;f!=null&&f.evaluateSpeechActivityScores(n);const _=this.relativeSpeechActivities;let v=2;for(const y of this.speakers.entries()){const[w,I]=y;if(I===f)continue;I.evaluateSpeechActivityScores(n);for(let M=0;M<_.length;++M){const $=f==null?Hg:f.getSpeechActivityScore(M);_[M]=Math.log(I.getSpeechActivityScore(M)/$)}const P=_[0],j=_[1],x=_[2];P>3&&j>2&&x>0&&j>v&&(v=j,u=w)}this.enableSilence&&f!=null&&u===f.id&&n-f.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const n=Date.now(),i=300-(n-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(n),this.lastLevelIdleTime=n):o=i;let c=300-(n-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=n,this.makeDecision(n),c=300-(Date.now()-n)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(n){const i=[];for(const c of lc(o=this.speakers).call(o)){var o;const u=n-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const UE=new Map;let Mu=null,jI=null;const uG=3;let Kg=[];const Uu=new Map,BI=new Map;class Que{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(n,i){Te(this,"id",void 0),Te(this,"track",void 0),Te(this,"score",0),Te(this,"active",!0),Te(this,"muted",!1),Te(this,"timer",0),Te(this,"actives",0),Te(this,"inactives",0),this.id=n,this.track=i,this.setActive(Uu.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const n=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(lc(Uu).call(Uu)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&n&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(n){this.active=n,this.resetTimer(),this.setMuted(!n)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const n=function(i){let o;return Array.from(lc(Uu).call(Uu)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);n&&this.activeRate-n.activeRate>.4&&(n.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const n=function(i){let o;return Array.from(lc(Uu).call(Uu)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);n&&n.activeRate-this.activeRate>.4&&(n.setActive(!0),this.setActive(!1))}addSample(n){n?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(n){this.track&&(this.track.enabled=!n,this.muted=n)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let WI;function dG(e){const n=Uu.get(e);n&&(Uu.delete(e),n.clearTimer())}const GI=new Map,Zue=new Map;function ede(e,n,i){let o=new Uint8Array(e,n,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const zI=new Map,i0=new Map;(function(){const e=mn();Yi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Yi.getStreamFromExtension=e.name===An.CHROME&&Number(e.version)>34,Yi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let i=!1;try{n.addTransceiver("audio"),i=!0}catch{}return n.close(),i}(),Yi.supportMinBitrate=e.name===An.CHROME||e.name===An.EDGE,Yi.supportSetRtpSenderParameters=function(){const n=mn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Jh()||!(!as()&&!EI())||n.name===An.FIREFOX&&Number(n.version)>=64)}(),e.name===An.SAFARI&&(Number(e.version)>=14?Yi.supportDualStream=!0:Yi.supportDualStream=!1),Yi.webAudioMediaStreamDest=function(){const n=mn();return!(n.name===An.SAFARI&&Number(n.version)<12)}(),Yi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Yi.supportWebGL=typeof WebGLRenderingContext<"u",Yi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Jh()||(Yi.webAudioWithAEC=!0),Yi.supportShareAudio=function(){const n=mn();return(n.os===Ai.WIN_10||n.os===Ai.WIN_81||n.os===Ai.WIN_7||n.os===Ai.LINUX||n.os===Ai.MAC_OS||n.os===Ai.CHROMIUM_OS)&&n.name===An.CHROME&&Number(n.version)>=74}(),Yi.supportDataChannel=!!($T(76)||function(n){const i=mn();return!(i.name!==An.FIREFOX||!i.osVersion)&&Number(i.version)>=n}(68)||g5(14)),Yi.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!Nr()&&!!n&&n.prototype.setConfiguration instanceof Function}(),Yi.supportWebRTCEncodedTransform=function(){const n=mn();return n.name==="Chrome"&&Number(n.version)>=87||n.name==="Safari"&&Number(n.version)>=15}(),Yi.supportWebRTCInsertableStream=function(){const n=mn();return(n.name===An.CHROME||n.name===An.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Yi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Yi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,TI(()=>{Yi.supportDualStreamEncoding=function(){const n=mn();return!!Q("DISABLE_WEBAUDIO")||n.name==="Safari"&&Number(n.version)>=14||!!(n.name==="Chrome"&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&Q("CHROME_DUAL_STREAM_USE_ENCODING"))}(),k.debug("browser ua: ",navigator.userAgent),k.info("browser info: ",e),k.info("browser compatibility: ",Yi)})})();const tde=["CHINA","GLOBAL"],hG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],$g=[],VE=[];function qg(e,n){return!!n&&$g.some(i=>i.uid===e&&i.channelName===n)}function H1(){return VE.length>0}var nde=L4.forEach,pG=Ih("forEach")?[].forEach:function(e){return nde(this,e,arguments.length>1?arguments[1]:void 0)};In({target:"Array",proto:!0,forced:[].forEach!=pG},{forEach:pG});var rde=Ca("Array").forEach,ide=Za,sde=li,ode=N,ade=rde,K1=Array.prototype,cde={DOMTokenList:!0,NodeList:!0},lde=function(e){var n=e.forEach;return e===K1||ode(K1,e)&&n===K1.forEach||sde(cde,ide(e))?ade:n},ude=l(lde),dde=go,fG=nc;In({target:"Object",stat:!0,forced:d(function(){fG(1)})},{keys:function(e){return fG(dde(e))}});var mG=l(ft.Object.keys),hde=l(cv),pde=l(uv),fde=In,gG=zm,mde=fg,gde=pt,_G=he,_de=ei,vde=we,Ede=wC,yde=or,Sde=Ci,Tde=w4("slice"),bde=yde("species"),$1=Array,wde=Math.max;fde({target:"Array",proto:!0,forced:!Tde},{slice:function(e,n){var i,o,c,u=vde(this),h=_de(u),f=_G(e,h),_=_G(n===void 0?h:n,h);if(gG(u)&&(i=u.constructor,(mde(i)&&(i===$1||gG(i.prototype))||gde(i)&&(i=i[bde])===null)&&(i=void 0),i===$1||i===void 0))return Sde(u,f,_);for(o=new(i===void 0?$1:i)(wde(_-f,0)),c=0;f<_;f++,c++)f in u&&Ede(o,c,u[f]);return o.length=c,o}});var Rde=Ca("Array").slice,Cde=N,Ide=Rde,q1=Array.prototype,Ade=function(e){var n=e.slice;return e===q1||Cde(q1,e)&&n===q1.slice?Ide:n},Ode=l(Ade);function ct(e,n,i,o,c){var u,h,f,_={};return ude(u=mG(o)).call(u,function(v){_[v]=o[v]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=hde(h=pde(f=Ode(i).call(i)).call(f)).call(h,function(v,y){return y(e,n,v)||v},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(y4(e,n,_),_=null),_}let HI=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Y1=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),xl=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),oo=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ct=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),rr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),xt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),kt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),s0=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),on=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),ao=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Wt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function KI(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new be(Y.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function $I(e){if(n=e,!(typeof n=="number"&&Math.floor(n)===n&&0<=n&&n<=4294967295||w5(e,1,255)))throw new be(Y.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;typeof e=="string"&&k.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let np=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Pde={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},X1={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function J1(e,n){$i(e.url,"".concat(n,".url"),1,1e3,!1),kr(e.x)||qn(e.x,"".concat(n,".x"),0,1e4),kr(e.y)||qn(e.y,"".concat(n,".y"),0,1e4),kr(e.width)||qn(e.width,"".concat(n,".width"),0,1e4),kr(e.height)||qn(e.height,"".concat(n,".height"),0,1e4),kr(e.zOrder)||qn(e.zOrder,"".concat(n,".zOrder"),0,255),kr(e.alpha)||qn(e.alpha,"".concat(n,".alpha"),0,1,!1)}const Nde={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Mf=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Q1=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),yi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function vG(e){if(!e.channelName)throw new be(Y.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new be(Y.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&$i(e.token,"info.token",1,2047),$I(e.uid),KI(e.channelName),!0}let co=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),rp=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),aa=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),FE=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),jn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Vi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),qI=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Pi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),On=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const EG=[On.AFRICA,On.ASIA,On.CHINA,On.EUROPE,On.GLOBAL,On.INDIA,On.JAPAN,On.NORTH_AMERICA,On.OCEANIA,On.OVERSEA,On.SOUTH_AMERICA];let Es=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const YI={CHINA:{},ASIA:{CODE:Es.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Es.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Es.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Es.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Es.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Es.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Es.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Es.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Es.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Es.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Es.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Es.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Es.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};E1&&(YI.CHINA={CODE:Es.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let o0=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function yG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class SG extends Rr{constructor(n,i){super(),G(this,"onICEConnectionStateChange",void 0),G(this,"onConnectionStateChange",void 0),G(this,"onDTLSTransportStateChange",void 0),G(this,"onDTLSTransportError",void 0),G(this,"onICETransportStateChange",void 0),G(this,"onFirstAudioReceived",void 0),G(this,"onFirstVideoReceived",void 0),G(this,"onFirstAudioDecoded",void 0),G(this,"onFirstVideoDecoded",void 0),G(this,"onFirstVideoDecodedTimeout",void 0),G(this,"onSelectedLocalCandidateChanged",void 0),G(this,"onSelectedRemoteCandidateChanged",void 0),G(this,"onICECandidateError",void 0),G(this,"getLocalVideoStats",void 0)}}class TG extends SG{constructor(n,i){super(n,i),G(this,"establishPromise",void 0)}}let st=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),ys=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),ip=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const bG=["disconnected","failed"];let Le=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),xn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Rt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ml=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ul=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Fi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),wG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),xd=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Qc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Vu=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),jE=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Xr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),BE=function(e){return e.ABORT="abort",e}({}),Uf=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),kde=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Dde={[HI.ACCESS_POINT]:{[oo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[oo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[oo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[oo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[oo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[oo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[oo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[HI.UNILBS]:{[xl.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[xl.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[xl.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[xl.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[xl.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[xl.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[xl.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[xl.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[xl.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[xl.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[xl.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[xl.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[HI.STRING_UID_ALLOCATOR]:{[Y1.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Y1.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Y1.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function WE(e){const n=Dde[Math.floor(e/1e4)];if(!n)return{desc:"unknown error",retry:!1};const i=n[e%1e4];if(!i){if(Math.floor(e/1e4)===HI.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Lde={[Ct.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ct.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ct.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ct.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ct.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ct.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ct.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ct.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ct.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ct.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ct.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ct.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ct.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ct.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ct.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ct.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ct.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ct.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ct.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ct.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ct.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ct.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ct.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ct.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ct.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ct.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ct.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ct.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ct.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ct.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ct.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ct.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ct.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ct.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ct.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ct.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ct.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ct.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ct.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ct.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ct.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ct.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ct.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ct.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ct.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ct.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ct.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ct.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ct.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ct.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ct.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ct.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ct.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ct.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ct.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ct.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ct.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ct.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ct.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ct.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function a0(e){return Lde[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function RG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Z1(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?RG(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):RG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function CG(e,n){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(n){const u=Q("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const xde=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Mde=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Ude=/wss:\/\/(.+):([0-9]+)\/?/,Vde=/wss:\/\/(.[^\/]+)\/?/;let Fde=0;class jde{constructor(n,i){G(this,"id",0),G(this,"store",void 0),G(this,"recordIndex",void 0),G(this,"websockets",[]),G(this,"try443PortDuration",2e3),G(this,"forceCloseWSDuration",5e3),G(this,"try443PortTimeout",null),G(this,"forceCloseTimeout",null),G(this,"isTry443PortFailed",!1),G(this,"isNormalPortFailed",!1),G(this,"useDoubleDomain",!1),G(this,"useProxy",!1),G(this,"startTime",Date.now()),this.id=++Fde,this.try443PortDuration=Q("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var n;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];k.debug("[choose-best-ws ".concat((n=this.store)===null||n===void 0?void 0:n.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(n,i,o){this.logger("createWebSocket:",n,{isTry443Port:i,hasTimeoutDetection:o});const c=Q("GATEWAY_DOMAINS"),u=Date.now(),h=[],f=c.find(I=>{var P;return $e(P=n.host).call(P,I)});f||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(I=>{_.push(CG(Z1(Z1({},n),{},{host:n.host.replace(f,I)}),i))});else{const I=Z1({},n);if(i&&f){const P=c.find(j=>j!==f);P&&(I.host=I.host.replace(f,P))}_.push(CG(I,i))}try{_.forEach(I=>{const P=new WebSocket(I);P.binaryType="arraybuffer",h.push(P),this.logger("ws is connecting:",P.url)})}catch(I){if(this.logger("ws create failed"),h.forEach(P=>P.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,i,o);if(!i&&Number(n.port)!==443)return this.createWebSocket(n,!0,o);throw new be(Y.WS_ERR,"init websocket failed! Error: ".concat(I.toString()))}const v=KT();this.store&&this.store.recordJoinChannelService({urls:h.map(I=>I.url),service:"gateway"},this.recordIndex),h.forEach(I=>{I.onopen=()=>{this.logger("onopen: ws ".concat(I.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(P=>{P!==I&&(P.onopen=null,P.onclose=null,P.onmessage=null,P.close(),this.logger("close backup websocket: ".concat(P.url)))}),this.websockets.length=0,v.resolve(I)},I.onclose=P=>{this.logger("onclose: ws ".concat(I.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(I.readyState));const j=h.every(x=>x.readyState===WebSocket.CLOSED||x.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(j)),j&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(P.reason)),v.reject({code:P.code,reason:qI.A_ROUND_WS_FAILED})):!i&&j&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),i?this.isTry443PortFailed=j:this.isNormalPortFailed=j},I.onmessage=P=>this.logger("".concat(I.url," onmessage: ").concat(P.data))}),this.websockets.push(...h);const y=()=>{this.websockets.forEach(I=>I.readyState!==WebSocket.OPEN&&I.close())},w=()=>{if(v.isResolved)return y();mn().os===Ai.MAC_OS&&Nr()&&y(),this.createWebSocket(n,!0,!0).then(I=>{v.resolve(I)}).catch(I=>{this.isNormalPortFailed&&v.reject(I),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,y()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,y()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(n,i,o,c){return this.useDoubleDomain=!!i,typeof n=="string"&&(n=function(u){let h,f,_;return[,h,f,_]=u.match(xde)||[],h||([,f,_]=u.match(Mde)||[]),f&&_||([,f,_]=u.match(Ude)||[]),f&&_||([,f]=u.match(Vde)||[]),f||k.warning("un-destructible url: ",u),{proxy:h,host:f,port:_||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,o&&this.useProxy&&(k.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(n,!!o,!1).finally(()=>this.clearTimeout())}}function IG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class AG extends Rr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;$e(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,this._state==="reconnecting"?this.emit(Wt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Wt.CONNECTED):this._state==="closed"?this.emit(Wt.CLOSED):this._state==="failed"&&this.emit(Wt.FAILED))}resetReconnectCount(n){k.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),G(this,"connectionID",0),G(this,"currentURLIndex",0),G(this,"urls",[]),G(this,"_reconnectMode","tryNext"),G(this,"reconnectReason",void 0),G(this,"_initMutex",void 0),G(this,"name",void 0),G(this,"_state","closed"),G(this,"reconnectInterrupter",void 0),G(this,"websocket",void 0),G(this,"retryConfig",void 0),G(this,"reconnectCount",0),G(this,"forceCloseTimeout",5e3),G(this,"onlineReconnectListener",void 0),G(this,"useCompress",void 0),G(this,"tryDoubleDomain",!1),G(this,"use443PortOnly",!1),G(this,"wsInflateLength",0),G(this,"wsDeflateLength",0),G(this,"closeEstablishingWs",()=>{}),G(this,"store",void 0),G(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(w){for(var I=1;I<arguments.length;I++){var P=arguments[I]!=null?arguments[I]:{};I%2?IG(Object(P),!0).forEach(function(j){G(w,j,P[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(P)):IG(Object(P)).forEach(function(j){Object.defineProperty(w,j,Object.getOwnPropertyDescriptor(P,j))})}return w}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new vs("websocket",h?h.clientId:void 0);const{timeout:f,timeoutFactor:_}=i,v=Math.max(300,Math.floor(3*f/5)),y=Math.max(1.2,Math.floor(8*_)/10);xa.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=y),ni.on(SE.NETWORK_STATE_CHANGE,(w,I)=>{w!==I&&(this.resetReconnectCount("network state change: ".concat(I," -> ").concat(w)),w===xa.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=y):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=n,this.state="connecting";try{const c=KT(),u=this.urls[this.currentURLIndex];Q("ENABLE_PREALLOC_PC")&&this.emit(wG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Wt.CLOSED,()=>{c.reject(new Ie(Y.WS_DISCONNECT))}),this.once(Wt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,i){if(!this.websocket)return void k.warning("[".concat(this.name,"] can not reconnect, no websocket"));n!==void 0&&(this.reconnectMode=n),k.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ie(Y.WS_ABORT,"websocket is not ready");try{i||(n=JSON.stringify(n)),this.websocket.send(n)}catch(o){throw new Ie(Y.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(n){var i;const o=KT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=y=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),k.debug("[".concat(this.name,"] websocket opened:"),y),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async y=>{var w;if(k.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Ie(Y.WS_DISCONNECT,"websocket close: ".concat(y.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=y.reason,this.state="reconnecting");const I=dc(this,Wt.WILL_RECONNECT,this.reconnectMode,y.reason)||this.reconnectMode,P=await this.reconnectWithAction(I);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!P)return o.reject(new Ie(Y.WS_DISCONNECT,"websocket reconnect failed: ".concat(y.code))),this.close(!0);o.resolve()}},h=y=>{this.emit(Wt.ON_MESSAGE,y)},f=y=>{k.warn("[".concat(this.connectionID,"] ws open error ").concat(y))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Q("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(n=Q("GATEWAY_WSS_ADDRESS")),k.debug("[".concat(this.name,"] start connect, url:"),n);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const y=await this.chooseBestWebsocketConnection(n);this.websocket=y,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=f,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(y){const w=this.state==="closed",I=y instanceof Ie,P=I&&y.code===Y.WS_ABORT,j=I&&y.code===Y.WS_ERR,x=I?y.message:y&&(y.reason||y.toString());k.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(x)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:P?"aborted":"error",errors:[y]},_),w||j?(o.reject(w?new Ie(Y.WS_DISCONNECT,"websocket is closed: ".concat(x)):new Ie(Y.WS_ERR,"init websocket failed: ".concat(x))),j&&k.error("[".concat(this.name,"] init websocket failed: ").concat(x))):u&&u(y)}return o.promise}async reconnectWithAction(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;k.warning("[choose-best-ws] action: =>",n),this.onlineReconnectListener||ni.isOnline||!ni.onlineWaiter||(this.onlineReconnectListener=ni.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=d1(this.reconnectCount,this.retryConfig);k.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(n)),await Je.race([qi(h),this.onlineReconnectListener||new Je(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,f)=>{this.emit(Wt.RECONNECT_CREATE_CONNECTION,f),await this.createWebSocketConnection(h)};try{if(n==="retry")await c(this.urls[this.currentURLIndex],n);else if(n==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);k.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],n)}else n==="recover"&&(k.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ls(this,Wt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],n))}catch(h){var u;k.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const f=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(f)&&$e(f).call(f,"dynamic key expired")?(this.emit(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(n,i)}return!0}}class eL extends AG{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){const o=KT(),c=function(h,f){return new jde(h,f)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Ie(Y.WS_ABORT,"choose best websocket aborted"))};const u=Q("GATEWAY_DOMAINS");return k.debug("[choose-best-ws] currentDomain: ",n,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(n,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class c0 extends AG{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){return new Je((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),h.forEach(j=>{j.onclose=null,j.onopen=null,j.onmessage=null,j.close()}),c(new Ie(Y.WS_ABORT,"choose best websocket aborted"))};const f=Q("GATEWAY_DOMAINS");let _;const v=n.indexOf("?h="),y=f.find(j=>v!==-1?$e(n).call(n,j,v):$e(n).call(n,j));k.debug("[choose-best-ws] currentDomain: ",y,", domains: ",f);let w=!this.tryDoubleDomain||!y;if(!w&&y){var I;const j=Date.now();try{f.forEach(x=>{const M=v===-1?n.replace(y,x):n.substr(0,v)+n.substr(v).replace(y,x),$=new WebSocket(M);$.binaryType="arraybuffer",h.push($),k.debug("[choose-best-ws] ws is connecting:",$.url)})}catch{for(k.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(M=>M.close());h.length;)h.pop();w=!0}(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:h.map(x=>x.url),service:"gateway"},i),h.forEach(x=>{x.onopen=()=>{if(u)return;const M=Date.now()-j;k.debug("[choose-best-ws] ws open cost ".concat(M,"ms")),h.filter($=>$!==x).forEach($=>{k.debug("[choose-best-ws]close backup websocket: ".concat($.url)),$.close()}),u=!0,o(x)},x.onclose=M=>{_=M,!u&&(h.find($=>!($.readyState===WebSocket.CLOSED||$.readyState===WebSocket.CLOSING))||(k.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},x.onmessage=M=>{k.debug("[choose-best-ws]".concat(x.url," onmessage: ").concat(M.data))}}),qi(this.forceCloseTimeout).then(()=>{h.forEach(x=>{x.readyState!==WebSocket.OPEN&&x.close()})})}if(w){var P;let j;k.debug("[choose-best-ws] use single url: ",n),(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:[n],service:"gateway"},i);try{j=new WebSocket(n),h.push(j),j.binaryType="arraybuffer"}catch(x){const M=new Ie(Y.WS_ERR,"init websocket failed! Error: ".concat(x.toString()));return k.error("[".concat(this.name,"]").concat(M)),void c(M)}j.onopen=()=>{o(j)},j.onclose=x=>{c(x)},j.onmessage=x=>{k.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(x.data))},qi(this.forceCloseTimeout).then(()=>{j&&j.readyState!==WebSocket.OPEN&&j.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Bde extends Rr{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===rr.CONNECTED?this.emit(xt.WS_CONNECTED):n===rr.RECONNECTING?this.emit(xt.WS_RECONNECTING,this._websocketReconnectReason):n===rr.CLOSED&&this.emit(xt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),G(this,"_disconnectedReason",void 0),G(this,"_websocketReconnectReason",void 0),G(this,"_connectionState",rr.CLOSED),G(this,"reconnectToken",void 0),G(this,"websocket",void 0),G(this,"openConnectionTime",void 0),G(this,"clientId",void 0),G(this,"lastMsgTime",Date.now()),G(this,"uploadCache",[]),G(this,"uploadCacheInterval",void 0),G(this,"rttRolling",new j5(5)),G(this,"pingpongTimer",void 0),G(this,"wsInflateDataTimer",void 0),G(this,"pingpongTimeoutCount",0),G(this,"joinResponse",void 0),G(this,"multiIpOption",void 0),G(this,"initError",void 0),G(this,"spec",void 0),G(this,"store",void 0),G(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(xt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===on.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===on.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Ln.UID_BANNED);break;case 15:this.close(Ln.IP_BANNED);break;case 16:this.close(Ln.CHANNEL_BANNED)}if(c._type===on.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ct.ERR_LICENSE_MISSING:this.close(Ln.LICENSE_MISSING);break;case Ct.ERR_LICENSE_EXPIRED:this.close(Ln.LICENSE_EXPIRED);break;case Ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ln.LICENSE_MINUTES_EXCEEDED);break;case Ct.ERR_LICENSE_PERIOD_INVALID:this.close(Ln.LICENSE_PERIOD_INVALID);break;case Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ln.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ct.ERR_LICENSE_ILLEGAL:this.close(Ln.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new eL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Q("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Q("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===rr.CONNECTED&&this.reconnect("retry",cs.OFFLINE)})}async request(n,i,o,c){const u=Zn(6,""),h={_id:u,_type:n,_message:i},f=this.websocket.connectionID,_=()=>new Je((j,x)=>{if(this.connectionState===rr.CONNECTED)return j();const M=()=>{this.off(xt.WS_CLOSED,$),j()},$=()=>{this.off(xt.WS_CONNECTED,M),x(new be(Y.WS_ABORT))};this.once(xt.WS_CONNECTED,M),this.once(xt.WS_CLOSED,$),n!==kt.PUBLISH&&n!==kt.PUBLISH_DATASTREAM&&n!==kt.SUBSCRIBE&&n!==kt.SUBSCRIBE_DATASTREAM&&n!==kt.UNSUBSCRIBE&&n!==kt.UNSUBSCRIBE_DATASTREAM&&n!==kt.UNPUBLISH&&n!==kt.UNPUBLISH_DATASTREAM&&n!==kt.CONTROL&&n!==kt.RESTART_ICE||this.once(xt.DISCONNECT_P2P,()=>{x(new be(Y.DISCONNECT_P2P))}),n!==kt.PUBLISH&&n!==kt.RESTART_ICE||this.once(xt.ABORT_P2P_EXECUTION,()=>{x(new be(Y.DISCONNECT_P2P))})});if(this.connectionState!==rr.CONNECTING&&this.connectionState!==rr.RECONNECTING||n===kt.JOIN||n===kt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const v=new Je((j,x)=>{let M=!1;const $=(oe,me)=>{M=!0,j({isSuccess:oe==="success",message:me||{}}),this.off(xt.WS_CLOSED,q),this.off(xt.WS_RECONNECTING,q),this.emit(xt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),$);const q=()=>{x(new be(Y.WS_ABORT,"type: ".concat(n))),this.off(xt.WS_CLOSED,q),this.off(xt.WS_RECONNECTING,q),this.off("res-@".concat(u),$)};this.once(xt.WS_CLOSED,q),this.once(xt.WS_RECONNECTING,q),qi(Q("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||M||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(xt.REQUEST_TIMEOUT,n,i))})});let y=null;try{y=await v}catch(j){if(this.connectionState===rr.CLOSED||n===kt.LEAVE)throw new be(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?j.throw():n===kt.JOIN||n===kt.REJOIN?null:(await _(),await this.request(n,i))}if(y.isSuccess)return y.message;const w=Number(y.message.error_code||y.message.code),I=a0(w),P=new be(Y.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(y.message.error_str),{code:w,data:y.message,desc:I.desc});return I.action==="success"?y.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(I.desc,", action: ").concat(I.action)),w===Ct.ERR_TOO_MANY_BROADCASTERS?((n===kt.JOIN||n===kt.REJOIN)&&(this.initError=P,this.close()),P.throw()):I.action==="failed"?P.throw():I.action==="quit"?(this.initError=P,this.close(),P.throw()):(w===Ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",cs.MULTI_IP)):this.reconnect(I.action,cs.SERVER_ERROR),n===kt.JOIN||n===kt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new Je(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(s0.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=Q("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==rr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Q("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Je((i,o)=>{this.once(xt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(xt.WS_CLOSED,c=>o(this.initError||new be(Y.WS_ABORT,c))),this.connectionState=rr.CONNECTING,this.websocket.init(n).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ln.LEAVE,this.connectionState=rr.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(xt.ABORT_P2P_EXECUTION);const n=await ls(this,xt.REQUEST_JOIN_INFO),i=await this.request(kt.JOIN,n);if(!i)return this.emit(xt.REPORT_JOIN_GATEWAY,qI.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(xt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=rr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new be(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const n=QT(this,xt.REQUEST_REJOIN_INFO);n.token=this.reconnectToken;const i=await this.request(kt.REJOIN,n);return!!i&&(this.connectionState=rr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(on.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(on.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(on.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(on.MUTE_AUDIO,{uid:o.uid}):this.emit(on.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(on.MUTE_VIDEO,{uid:o.uid}):this.emit(on.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(on.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(on.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(on.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(on.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(on.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){k.debug("[".concat(this.clientId,"] receive notification: "),n);const i=a0(n.code);if(n.code===28&&"detail"in n&&(k.info("[".concat(this.clientId,"] receive recover notification: "),n.detail),this.emit(xt.RECOVER_NOTIFICATION,n.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ln.UID_BANNED),void this.close()):void this.reconnect(i.action,cs.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=Q("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(k.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>Q("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",cs.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),Q("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();n!==0&&i!==0&&this.upload(s0.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Wt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(xt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Wt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Wt.CLOSED,()=>{this.connectionState=rr.CLOSED}),this.websocket.on(Wt.FAILED,()=>{this._disconnectedReason=Ln.NETWORK_ERROR,this.connectionState=rr.CLOSED}),this.websocket.on(Wt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===rr.CONNECTED?this.connectionState=rr.RECONNECTING:this.connectionState=rr.CONNECTING}),this.websocket.on(Wt.WILL_RECONNECT,(n,i,o)=>{const c=QT(this,xt.IS_P2P_DISCONNECTED),u=c||n!=="retry";c&&n==="retry"&&(k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",i=qI.P2P_DISCONNECTED),u&&(k.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(xt.REPORT_JOIN_GATEWAY,i||qI.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(xt.DISCONNECT_P2P)),o(n)}),this.websocket.on(Wt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",cs.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(xt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof be){if(n.code===Y.UNEXPECTED_RESPONSE&&n.data.code===Ct.ERR_NO_AUTHORIZED)return this.initError=new be(Y.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ln.TOKEN_EXPIRE);k.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",cs.SERVER_ERROR):(this.initError=n,this.close())}})}),this.websocket.on(Wt.REQUEST_NEW_URLS,(n,i)=>{ls(this,xt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(on.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(wG.PRE_CONNECT_PC,()=>{this.emit(xt.PRE_CONNECT_PC)})}}let Wde=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ri=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function OG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function XI(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?OG(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):OG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Vf(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Q("TURN_DOMAIN")):(k.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function tL(e,n){e.addresses||(e.addresses=[]);const i=function(f,_){if(Q("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return f.map(w=>{let{ip:I,port:P}=w;return{address:"".concat(I,":").concat(P)}});const v=Q("GATEWAY_DOMAINS");let y=v[1]&&$e(_).call(_,v[1])?1:0;return f.map(w=>{let{domain_prefix:I,port:P,ip:j}=w;if(I)return{address:"".concat(I,".").concat(v[y++%v.length],":").concat(P)};const x=/^[\.\:\d]+$/.test(j),M=x?"".concat(j.replace(/[^\d]/g,"-"),".").concat(v[y++%v.length],":").concat(P):"".concat(j,":").concat(P);return x||k.debug("Cannot recognized as ip address: ".concat(j,", use as host")),{ip:j,port:P,address:M}})}(e.addresses,n),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const f=o.split(";");for(let _=0;_<f.length;_++){var c;const v=Ws(c=f[_]).call(c);i[_]&&v&&(i[_].ip6=v)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[f,_]=u.split(":");f&&_&&(h={port:Number(_),ip:f,address:"".concat(f,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ma(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function PG(e){const n=e._encoderConfig;if(!n)return{};const i={resolution:n.width&&n.height?"".concat(Ma(n.width),"x").concat(Ma(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return typeof n.frameRate=="number"?(i.maxFrameRate=n.frameRate,i.minFrameRate=n.frameRate):n.frameRate&&(i.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,i.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),i}function NG(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function l0(e,n){let i,o,c;switch(n){case ri.CHOOSE_SERVER:o=4096,c="choose server";break;case ri.CLOUD_PROXY:o=1048576,c="proxy";break;case ri.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case ri.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new be(Y.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>XI(XI({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:XI(XI({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new be(Y.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function kG(e,n){return await Je.all(e.addresses.map(async i=>({address:Q("USE_TURN_IP")?i.ip:Vf(i.ip),tcpport:i.port,udpport:i.port,username:n&&Q("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():us.username,password:n&&Q("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await a1(n.toString()):us.password})))}function nL(e,n){const i=n.getMediaStreamTrack(!0).getSettings(),o=n.videoHeight||i.height,c=n.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Ma(e.height),Ma(e.width)),1):(k.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ff(e){let{candidateType:n,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const f={candidateType:n,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),f.address=_.join("."),f.port=u}return f}function JI(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Q("SVC_MODE");if(Q("ENABLE_SVC"))return function(n){return n in CI}(e)?e:CI.L1T3}const DG={[st.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[st.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function QI(e,n,i){n.forEach(o=>{var c;const u=DG[e].find(f=>{var _;let{key:v}=f;return $e(_=o.extensionName).call(_,v)});if(!u)return;const h=i.find(f=>{let{extensionName:_}=f;return $e(_).call(_,u.key)});h&&$e(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function GE(e,n){n.forEach(i=>{var o;const c=DG[e].find(u=>{var h;let{key:f}=u;return $e(h=i.extensionName).call(h,f)});$e(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function LG(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||$e(e).call(e,"abs-send-time")}function ZI(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||$e(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function xG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function MG(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?xG(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function u0(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:f,filterVideoCodec:_}=n,{useXR:v}=i;let y=[],w=[],I=[],P=[],j=!1,x=!1;if(oa(e).mediaDescriptions.forEach($=>{o&&o!==$.attributes.direction||($.media.mediaType!=="video"||j||(w=$.attributes.payloads,P=$.attributes.extmaps,j=!0),$.media.mediaType!=="audio"||x||(y=$.attributes.payloads,I=$.attributes.extmaps,x=!0))}),!P||w.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||y.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(w.forEach($=>{var q;(q=$.rtpMap)!==null&&q!==void 0&&q.clockRate&&($.rtpMap.clockRate=parseInt($.rtpMap.clockRate)),v&&$.rtcpFeedbacks.push({type:"rrtr"})}),y.forEach($=>{var q;(q=$.rtpMap)!==null&&q!==void 0&&q.clockRate&&($.rtpMap.clockRate=parseInt($.rtpMap.clockRate)),v&&$.rtcpFeedbacks.push({type:"rrtr"})}),c&&(y=y.filter($=>{var q;return((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"}),w=w.filter($=>{var q;return((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"})),u&&(w=w.filter($=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),h&&(y=y.filter($=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),f&&(f==null?void 0:f.length)>0&&(y=y.filter($=>{var q;return $e(f).call(f,((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const $=w.filter(q=>{var oe;return $e(_).call(_,((oe=q.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLowerCase())||"")});w=$.concat(c?[]:sL($,w))}const M=Q("UNSUPPORTED_VIDEO_CODEC");return M&&M.length>0&&(w=w.filter($=>!($.rtpMap&&$e(M).call(M,$.rtpMap.encodingName.toLowerCase())))),{audioCodecs:y,videoCodecs:w,audioExtensions:I,videoExtensions:P}}function jf(e){const n=oa(e);let i,o;for(const c of n.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&n.attributes.fingerprints.length>0&&(o={fingerprints:n.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function UG(e,n){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var f;const _=(f=o.find(v=>v.ssrcIds[0]===h))===null||f===void 0?void 0:f.ssrcIds[1];i.push({ssrcId:h,rtx:n?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],f=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:n?f:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function VG(e,n,i){const{cname:o}=e;let c=[];n&&(c=FG(n)),c.length===0&&(c=e.iceParameters.candidates.map(y=>({foundation:y.foundation,componentId:"1",transport:y.protocol,priority:y.priority.toString(),connectionAddress:y.ip,port:y.port.toString(),type:y.type,extension:{}})),k.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(y=>({hashFunction:y.algorithm,fingerprint:y.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let f;switch(e.dtlsParameters.role){case"server":f="passive";break;case"client":f="active";break;case"auto":f="actpass"}const _=tA(e.rtpCapabilities),v=[];return Array.isArray(i)&&i.length>0&&i.forEach(y=>{v.push({kind:st.VIDEO,ssrcId:y.v,rtx:y.v_rtx,mslabel:"".concat(y.v,"_").concat(y.a)},{kind:st.AUDIO,ssrcId:y.a,mslabel:"".concat(y.v,"_").concat(y.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:f,cname:o,preSSRCs:v}}function FG(e){let n=[];return e.ip&&typeof e.port=="number"&&(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],k.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),k.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),n}function Yg(e,n,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:f}=u;const _=Zn(8,"track-"),v={ssrcId:h,attributes:MG({label:_,mslabel:i=i||Zn(10,""),msid:"".concat(i," ").concat(_)},n&&{cname:n})};if(o.push(v),f!==void 0){const y={ssrcId:f,attributes:MG({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},n&&{cname:n})};o.push(y),c.push({semantic:"FID",ssrcIds:[h,f]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function zE(e,n){n instanceof Vr&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=n._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Nr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function rL(e){const n=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");n!==-1&&e.attributes.unrecognized.splice(n,1)}function iL(e,n){var i;if(!(n instanceof ur&&n._encoderConfig&&n._hints.indexOf(er.SCREEN_TRACK)===-1))return;const o=n._encoderConfig;wn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;$e(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),wn().supportMinBitrate&&!$e(i=n._hints).call(i,er.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;$e(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(Q("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function jG(e){if(e.media.mediaType!=="video")return;const n=mn();if(n.name!==An.SAFARI&&n.os!==Ai.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function eA(e,n,i){if(!n)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),n.twcc===!0){const u=o.find(h=>ZI(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>ZI(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,v){return v.filter(y=>!!_.find(w=>w.payloadType===y.payloadType&&!!w.rtcpFeedbacks.find(I=>I.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(v=>v.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(n.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>ZI(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}if(n.remb===!0){const u=o.find(h=>LG(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,v){return v.filter(y=>!!_.find(w=>w.payloadType===y.payloadType&&!!w.rtcpFeedbacks.find(I=>I.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(v=>v.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(n.remb===!1){const u=e.attributes.extmaps.findIndex(h=>LG(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}}function BG(e,n,i){if(Nr()||e.media.mediaType!=="video"||!(n instanceof ur)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!Q("SIMULCAST")||i==="vp9"&&Q("ENABLE_SVC")||n._scalabilityMode===void 0||n._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:n._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(f=>f.semantic==="FID"&&f.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let f=1;f<o;f++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+f,attributes:Lr(c.attributes)}),h.ssrcIds.push(c.ssrcId+f),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+f,attributes:Lr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+f,u.ssrcIds[1]+f]}));e.attributes.ssrcGroups.unshift(h)}async function WG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const y=u0(v,f,_,"sendonly"),w=u0(v,f,_,"recvonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},j={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Vl(y,w,"videoExtensions",I,P,j),Vl(y,w,"videoCodecs",I,P,j),Vl(y,w,"audioExtensions",I,P,j),Vl(y,w,"audioCodecs",I,P,j),Q("RAISE_H264_BASELINE_PRIORITY")){const x=[],M=[];j.videoCodecs.forEach(($,q)=>{var oe;if(((oe=$.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLocaleLowerCase())==="h264"){var me,ge;const fe=j.videoCodecs[q+1],Re=fe&&$G($,fe),Ue=(me=$.fmtp)===null||me===void 0?void 0:me.parameters["profile-level-id"],Qe=(ge=$.fmtp)===null||ge===void 0?void 0:ge.parameters["packetization-mode"];!Ue||Ue!==Q("FIRST_H264_PROFILE_LEVEL_ID")||Q("FIRST_PACKETIZATION_MODE")&&Qe!==Q("FIRST_PACKETIZATION_MODE")?Re?M.push([$,fe]):M.push([$]):Re?x.push([$,fe]):x.push([$])}}),x.length>0&&M.length>0&&(k.debug("raising H264 baseline profile priority"),j.videoCodecs.forEach(($,q)=>{var oe;if(((oe=$.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLocaleLowerCase())==="h264"){const me=$G($,j.videoCodecs[q+1]),ge=x.shift()||M.shift()||[];ge.length>0&&(me?j.videoCodecs.splice(q,2,...ge):j.videoCodecs.splice(q,1,...ge))}}),P.videoCodecs=P.videoCodecs.filter($=>{var q,oe;return!(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((oe=$.fmtp)===null||oe===void 0?void 0:oe.parameters["profile-level-id"])!==Q("FIRST_H264_PROFILE_LEVEL_ID"))}),Q("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter($=>{var q,oe;return!(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((oe=$.fmtp)===null||oe===void 0?void 0:oe.parameters["profile-level-id"])!==Q("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:I,recv:P,sendrecv:j}}(e,n,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function GG(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},n=u0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Vl(e,n,"videoExtensions",i,o,c),Vl(e,n,"videoCodecs",i,o,c),Vl(e,n,"audioExtensions",i,o,c),Vl(e,n,"audioCodecs",i,o,c),Q("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){k.debug("raising H264 baseline profile priority");const f=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,f)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(f=>!(f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function Vl(e,n,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(f=>{n[i].some((_,v)=>{if(f.entry===_.entry&&f.extensionName===_.extensionName)return h.push(v),!0})?u[i].push(f):o[i].push(f)}),void n[i].forEach((f,_)=>{h.indexOf(_)===-1&&c[i].push(f)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(f=>{n[i].some((_,v)=>{if(f.payloadType===_.payloadType&&JSON.stringify(f)===JSON.stringify(_))return h.push(v),!0})?u[i].push(f):o[i].push(f)}),void n[i].forEach((f,_)=>{h.indexOf(_)===-1&&c[i].push(f)})}}function tA(e){const{send:n,recv:i,sendrecv:o}=e;if(!o){if(!n||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:i}}let c,u;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...o.audioCodecs],c.videoCodecs=[...n.videoCodecs,...o.videoCodecs],c.audioExtensions=[...n.audioExtensions,...o.audioExtensions],c.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function HE(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(n=>{var i;return((i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function d0(e,n,i,o){let c=[];if(e===st.VIDEO){if(Q("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=n.videoCodecs.filter(u=>{var h;return $e(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===Q("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],f=[],_=[];if(i.videoCodecs.forEach(v=>{const y=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";$e(y).call(y,o)?u.push(v):$e(y).call(y,"vp9")?h.push(v):$e(y).call(y,"vp8")?f.push(v):$e(y).call(y,"h264")&&_.push(v)}),u.length===0){let v="";h.length!==0?(u=h,v="vp9"):f.length!==0?(u=f,v="vp8"):_.length!==0&&(u=_,v="h264"),k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=n.videoCodecs.filter(v=>u.some(y=>y.payloadType===v.payloadType)))}if(c.length===0&&(k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(n.videoCodecs[0].rtpMap&&n.videoCodecs[0].rtpMap.encodingName)),c=n.videoCodecs),Q("USE_PUB_RTX")||Q("USE_SUB_RTX")){const u=sL(c,n.videoCodecs);c=[...c,...u]}}else c=n.audioCodecs.filter(u=>{var h;return $e(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=n.audioCodecs.filter(u=>{var h;return $e(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function sL(e,n){const i=e.map(o=>o.payloadType.toString());return n.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&$e(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function h0(e,n,i){const o=n.toString(),c=HG(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=zG(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function zG(e,n,i){const o=oa(e),{useXR:c}=n;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!$e(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&HE(u),c&&$e(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(f=>{f.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&f.rtcpFeedbacks.push({type:"rrtr"})})))}),xf(o)}function HG(e,n,i,o){if(Q("SDP_LOGGING"))return k.upload("exchanging ".concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),e),n==="offer"?c=>{HG(c,"answer",i==="local"?"remote":"local",o)}:void 0}function KG(e){const n=Q("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(n)&&n.length>0)&&n.some(i=>$e(e).call(e,i))}function $G(e,n){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===n.payloadType.toString()}catch{return!1}}function qG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Zc(e,n){return typeof Q(e)===n?Q(e):void 0}function Gde(){try{const e=Q("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?qG(Object(o),!0).forEach(function(c){G(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):qG(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e)}catch(e){return k.debug("handle gateway attributes failed: ",e),{}}}const YG={};function Bf(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&k.debug("install service ".concat(e.name)),YG[e.name]=e}function sp(e){const n=YG[e];if(!n)throw new Ie(Y.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return n}function XG(e,n){return sp("DataStream").create(e,n)}function nA(){return sp("InterceptFrame").create()}function JG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function op(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?JG(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const oL=new Map;class zde extends Rr{get state(){return this._state}set state(n){if(n===this._state)return;const i=this._state;this._state=n,n==="DISCONNECTED"&&this._disconnectedReason?this.emit(Vi.CONNECTION_STATE_CHANGE,n,i,this._disconnectedReason):this.emit(Vi.CONNECTION_STATE_CHANGE,n,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){k.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,i){var o,c,u;super(),G(this,"store",void 0),G(this,"joinInfo",void 0),G(this,"key",void 0),G(this,"ntpOffset",0),G(this,"signal",void 0),G(this,"role",void 0),G(this,"inChannelInfo",{joinAt:null,duration:0}),G(this,"spec",void 0),G(this,"_state","DISCONNECTED"),G(this,"_statsCollector",void 0),G(this,"_disconnectedReason",void 0),G(this,"isSignalRecover",!1),G(this,"hasChangeBGPAddress",!1),G(this,"trafficStatsInterval",void 0),G(this,"networkQualityInterval",void 0),G(this,"_joinGatewayStartTime",0),G(this,"_signalTimeout",!1),G(this,"_clientRoleOptions",void 0),G(this,"_isProactiveJoin",!1),this.store=n,this.spec=i,this.signal=this.store.useP2P?(o={spec:op(op({},i),{},{retryConfig:i.websocketRetryConfig}),store:n},(c=(u=sp("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Bde(op(op({},i),{},{retryConfig:i.websocketRetryConfig}),n),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(n,i,o){this.store.joinGatewayStart(),n.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=oL.get(n.cname);if(u||(u=new Map,oL.set(n.cname,u)),this._isProactiveJoin=!0,u.has(n.uid)){const v=new be(Y.UID_CONFLICT);throw ht.joinGateway(n.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:"0",preload:n.preload}),v}u.set(n.uid,!0),this.joinInfo=n,this.key=i;let h=0;this.joinGatewayStartTime=c;const f=n.proxyServer;try{k.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=n.gatewayAddrs.map(y=>{let{address:w}=y;const[I,P]=w.split(":"),j={host:I,port:P};return n.proxyServer&&(j.proxy=n.proxyServer),j});h=(await this.signal.init(v)).uid,k.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var _;throw k.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),ht.joinGateway(n.sid,{lts:c,succ:!1,ec:((_=v.data)===null||_===void 0?void 0:_.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!f,signalChannel:"0",preload:n.preload}),u.delete(n.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),k.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{k.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Vi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Vi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Vi.NETWORK_QUALITY,{uplinkNetworkQuality:NG(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:NG(this._statsCollector.trafficStats.B_dnq)}):this.emit(Vi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Ln.FALLBACK&&(this.state="DISCONNECTING");try{n||this.signal.connectionState!==rr.CONNECTED||await function(o,c){return c===1/0?o:Je.race([o,mue(c)])}(this.signal.request(kt.LEAVE,void 0,!0),3e3)}catch(o){k.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Ln.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:Q("PUB_EXTEND"),twcc:!!Q("PUBLISH_TWCC"),rtx:!!Q("USE_PUB_RTX")};try{return(await this.signal.request(kt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(n,i),this.publish(n,i,!1);throw u}}async publishDataChannel(n,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(kt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Ct.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(n,i),this.publishDataChannel(n,i,!1);throw h}}async unpublish(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(kt.UNPUBLISH,{stream_id:i,ortc:n},!0)}catch(o){k.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Je.all(n.map(i=>this.signal.request(kt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){k.warning("unpublish datachannels warning: ",i)}}async presubscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Q("SUBSCRIBE_TWCC"),rtx:!!Q("USE_SUB_RTX")||void 0,extend:Q("SUB_EXTEND"),svc:Array.isArray(Q("SVC"))&&Q("SVC").length!==0?Q("SVC"):void 0};try{return await this.signal.request(kt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(n,i,!1);throw u}}async subscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Q("SUBSCRIBE_TWCC"),rtx:!!Q("USE_SUB_RTX"),extend:Q("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(Q("SVC"))&&Q("SVC").length!==0?Q("SVC"):void 0};try{return(await this.signal.request(kt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(n,i),await this.subscribe(n,i,!1);throw u}}async subscribeDataChannel(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:n,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(kt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(n,i),await this.subscribeDataChannel(n,i,!1);throw u}}async subscribeAll(n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:n,dtx:!1,rtx:!!Q("USE_SUB_RTX"),twcc:!!Q("SUBSCRIBE_TWCC"),svc:Array.isArray(Q("SVC"))&&Q("SVC").length!==0?Q("SVC"):void 0};try{return await this.signal.request(kt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(n),await this.subscribeAll(n,!1);throw c}}async setVideoProfile(n){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,f=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(f=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(f=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(f=!1)),f?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(n);if(i)return this.signal.request(kt.SET_VIDEO_PROFILE,i);k.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(n,i){try{await this.signal.request(kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:n,stream_id:i},!0)}catch(o){k.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Je.all(n.map(o=>this.signal.request(kt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){k.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(n){try{await this.signal.request(kt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){k.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(n){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=n;return{gatewayEstablishParams:await this.signal.request(kt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(kt.GATEWAY_INFO)}async renewToken(n){await this.signal.request(kt.RENEW_TOKEN,n),this.key=n.token}updateClientRole(n,i){i&&(this._clientRoleOptions=Object.assign({},i)),Q("CLIENT_ROLE_OPTIONS")&&(k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Q("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Q("CLIENT_ROLE_OPTIONS"))),this.role=n}async setClientRole(n,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),Q("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Q("CLIENT_ROLE_OPTIONS")),k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Q("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=n);let o,c=0;n==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(kt.SET_CLIENT_ROLE,{role:n,level:c,delay:o,client_ts:Date.now()}),this.role=n}async setRemoteVideoStreamType(n,i){await this.signal.request(kt.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:i})}async setDefaultRemoteVideoStreamType(n){await this.signal.request(kt.DEFAULT_VIDEO_STREAM,{stream_type:n})}async setStreamFallbackOption(n,i){await this.signal.request(kt.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:i})}async pickSVCLayer(n,i){await this.signal.request(kt.PICK_SVC_LAYER,{stream_id:n,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(n){await this.signal.request(kt.SET_RTM2_FLAG,{rtm2_flag:n})}async sendExtensionMessage(n,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(n,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),op({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(kt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=oL.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:us.username,password:us.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(op(op({},us),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const n=await this.signal.request(kt.TRAFFIC_STATS,void 0,!0);n.timestamp=Date.now(),n.ntp_offset!=null&&(this.ntpOffset=n.ntp_offset),n.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&TI(()=>{this.emit(Vi.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(n)}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new be(Y.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=Q("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Vi.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,$e(VE).call(VE,c)||VE.push(c);const u=!(Nr()||m5(87)||i6())&&typeof Q("ENABLE_PRE_SUB")=="boolean"&&Q("ENABLE_PRE_SUB"),h=!i6()&&Zc("ENABLE_PREALLOC_PC","boolean"),f=Gde(),_=$T(87)||function(){const y=mn();if(y.name!==An.SAFARI||!y.browserVersion)return!1;const w=y.browserVersion.split(".");return Number(w[0])>15||Number(w[0])===15&&Number(w[1])>=4}(),v=op({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Yc,browser:navigator.userAgent,process_id:Q("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:Q("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:op({enableEncodedTransform:!!Q("ENABLE_AUDIO_METADATA")&&_||!!Q("ENABLE_AUDIO_TOPN")&&ZD(An.CHROME,87,116)||void 0,enableAudioMetadata:!!Q("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!Q("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:Q("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Q("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Q("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Q("TOPN_AUDIO_GAIN"),enablePublishedUserList:Q("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Q("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Zc("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Zc("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Zc("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Q("USE_PUB_RTX")===!0||Q("USE_SUB_RTX")===!0||void 0,disableFEC:Q("DISABLE_FEC"),enableNTPReport:!!Q("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!Q("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!Q("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Zc("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Q("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Q("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Zc("USE_XR","boolean"),enableLossbasedBwe:Zc("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Q("ENABLE_AUT_CC")||void 0,enableCCFallback:Zc("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Zc("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Zc("PUBLISH_TWCC","boolean"),enableSubTWCC:Zc("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Zc("USE_PUB_RTX","boolean"),enableSubRTX:Zc("USE_SUB_RTX","boolean"),enableSubSVC:Q("ENABLE_SVC")?Q("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Q("SVC"))&&Q("SVC").length!==0?Q("SVC"):void 0,enableSvcExtended:Q("ENABLE_SVC")&&Array.isArray(Q("SVC_EXTENDED"))&&Q("SVC_EXTENDED").length!==0?Q("SVC_EXTENDED"):void 0},f)},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,Q("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new be(Y.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(xt.WS_RECONNECT_CREATE_CONNECTION,n=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(xt.WS_RECONNECTING,n=>{this.joinInfo&&ht.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||cs.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ht.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(xt.WS_CLOSED,n=>{let i;switch(n){case Ln.LEAVE:i=cs.LEAVE;break;case Ln.UID_BANNED:case Ln.IP_BANNED:case Ln.CHANNEL_BANNED:case Ln.SERVER_ERROR:i=cs.SERVER_ERROR;break;case Ln.FALLBACK:i=cs.FALLBACK;break;case Ln.LICENSE_MISSING:case Ln.LICENSE_EXPIRED:case Ln.LICENSE_MINUTES_EXCEEDED:case Ln.LICENSE_PERIOD_INVALID:case Ln.LICENSE_MULTIPLE_SDK_SERVICE:case Ln.LICENSE_ILLEGAL:case Ln.TOKEN_EXPIRE:i=n;break;default:i=cs.NETWORK_ERROR}k.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+cs.NETWORK_ERROR)),this.joinInfo&&ht.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:n===Ln.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=n,n!==Ln.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(xt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const n=Q("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;n&&(n.level||n.delay)&&(k.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(n.level,", delay: ").concat(n.delay)),this.setClientRole(this.role,n))}if(ht.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const n=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!n)return void k.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(n));Hn("EVENT_REPORT_DOMAIN",n[1]),Hn("EVENT_REPORT_BACKUP_DOMAIN",n[1]),Hn("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}}),this.signal.on(on.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on(xt.REQUEST_RECOVER,(n,i,o)=>{if(!this.joinInfo)return o(new be(Y.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ls(this,Vi.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(xt.REQUEST_JOIN_INFO,async(n,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void n(this.getJoinMessage({ortc:{}}));const u=Lr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(Q("NEW_TURN_MODE")&&u){let v=u.servers,y=u.serversFromGateway;const w=this.signal.currentURLIndex;v.length>0&&(v=[v[w%v.length]],u.servers=v),Array.isArray(y)&&y.length>0&&(y=[y[0]],u.serversFromGateway=y),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w))}const{iceParameters:h,dtlsParameters:f,rtpCapabilities:_}=await ls(this,Vi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{n(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:f,rtpCapabilities:_,version:"2"}}))}catch(v){i(v)}}),this.signal.on(xt.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on(xt.REPORT_JOIN_GATEWAY,(n,i)=>{if(!this.joinInfo)return;let o,c="";var u;n instanceof be?(o=((u=n.data)===null||u===void 0?void 0:u.desc)||n.code,c=n.message):o=n,ht.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(xt.IS_P2P_DISCONNECTED,n=>{n(QT(this,Vi.IS_P2P_DISCONNECTED))}),this.signal.on(xt.DISCONNECT_P2P,()=>{this.emit(Vi.DISCONNECT_P2P)}),this.signal.on(xt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(xt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(xt.JOIN_RESPONSE,n=>{const i=this.getCurrentGatewayAddress();this.emit(Vi.JOIN_RESPONSE,n,i)}),this.signal.on(xt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const n=this.getCurrentGatewayAddress(),i=Q("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(n&&i){const o=FG(n);this.emit(Vi.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(xt.RECOVER_NOTIFICATION,n=>{this.joinInfo&&typeof Q("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Q("AP_REQUEST_DETAIL"),";").concat(n))})}async tryUnsubBeforeResub(n,i){try{await this.signal.request(kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:n,ortc:[i]},!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(n,i){try{await this.signal.request(kt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw k.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(n,i){try{await this.signal.request(kt.UNPUBLISH,{stream_id:n,ortc:i},!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(n,i){try{await this.signal.request(kt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw k.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(n){const i={users:n.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(kt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(n,i){const o={action:n.find(c=>c.stream_type===jn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(n,i){const o={action:n.find(c=>c.stream_type===jn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(n,i){const o={action:n===st.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(n,i){const o={action:n===st.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(kt.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(n){this.signal.uploadWRTCStats(n)}upload(n,i){this.signal.upload(n,i)}getSignalRTT(){return this.signal.rtt}async restartICE(n){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:n};try{return await this.signal.request(kt.RESTART_ICE,i,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(n,i){this.state==="CONNECTED"&&this.signal.reconnect(n||void 0,i||cs.P2P_FAILED)}getCurrentGatewayAddress(){var n,i;if(!Q("GATEWAY_WSS_ADDRESS"))return Q("USE_CANDIDATE_FROM_AP_DETAIL")&&(n=this.joinInfo)!==null&&n!==void 0&&n.apGatewayAddress?(k.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(n){await this.signal.request(kt.SET_PARAMETER,{enablePublishAudioFilter:n})}}let rA=0,aL=0;function Fu(e,n,i,o){return new Je((c,u)=>{n.timeout=n.timeout||Q("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),rA+=Pd(n.data)):i&&(n.data.size?rA+=n.data.size:n.data instanceof FormData?rA+=D5(n.data):rA+=Pd(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,No.request(n).then(h=>{typeof h.data=="string"?aL+=Pd(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?aL+=h.data.byteLength:aL+=Pd(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{No.isCancel(h)?u(new be(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new be(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new be(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new be(Y.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function n(Pe){var He=0;return function(){return He<Pe.length?{done:!1,value:Pe[He++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(Pe,He,lt){return Pe==Array.prototype||Pe==Object.prototype||(Pe[He]=lt.value),Pe},o,c=function(Pe){Pe=[typeof globalThis=="object"&&globalThis,Pe,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var He=0;He<Pe.length;++He){var lt=Pe[He];if(lt&&lt.Math==Math)return lt}throw Error("Cannot find global object")}(this);function u(Pe,He){if(He)e:{var lt=c;Pe=Pe.split(".");for(var ke=0;ke<Pe.length-1;ke++){var D=Pe[ke];if(!(D in lt))break e;lt=lt[D]}(He=He(ke=lt[Pe=Pe[Pe.length-1]]))!=ke&&He!=null&&i(lt,Pe,{configurable:!0,writable:!0,value:He})}}function h(Pe){return(Pe={next:Pe})[Symbol.iterator]=function(){return this},Pe}function f(Pe){var He=typeof Symbol<"u"&&Symbol.iterator&&Pe[Symbol.iterator];return He?He.call(Pe):{next:n(Pe)}}if(u("Symbol",function(Pe){function He(D,ee){this.A=D,i(this,"description",{configurable:!0,writable:!0,value:ee})}if(Pe)return Pe;He.prototype.toString=function(){return this.A};var lt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ke=0;return function D(ee){if(this instanceof D)throw new TypeError("Symbol is not a constructor");return new He(lt+(ee||"")+"_"+ke++,ee)}}),u("Symbol.iterator",function(Pe){if(Pe)return Pe;Pe=Symbol("Symbol.iterator");for(var He="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),lt=0;lt<He.length;lt++){var ke=c[He[lt]];typeof ke=="function"&&typeof ke.prototype[Pe]!="function"&&i(ke.prototype,Pe,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return Pe}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var v={};try{v.__proto__={a:!0},_=v.a;break e}catch{}_=!1}o=_?function(Pe,He){if(Pe.__proto__=He,Pe.__proto__!==He)throw new TypeError(Pe+" is not extensible");return Pe}:null}var y=o;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function I(Pe){if(Pe.m)throw new TypeError("Generator is already running");Pe.m=!0}function P(Pe,He){return Pe.h=3,{value:He}}function j(Pe){this.g=new w,this.G=Pe}function x(Pe,He,lt,ke){try{var D=He.call(Pe.g.j,lt);if(!(D instanceof Object))throw new TypeError("Iterator result "+D+" is not an object");if(!D.done)return Pe.g.m=!1,D;var ee=D.value}catch(ue){return Pe.g.j=null,Pe.g.s(ue),M(Pe)}return Pe.g.j=null,ke.call(Pe.g,ee),M(Pe)}function M(Pe){for(;Pe.g.h;)try{var He=Pe.G(Pe.g);if(He)return Pe.g.m=!1,{value:He.value,done:!1}}catch(lt){Pe.g.v=void 0,Pe.g.s(lt)}if(Pe.g.m=!1,Pe.g.l){if(He=Pe.g.l,Pe.g.l=null,He.F)throw He.D;return{value:He.return,done:!0}}return{value:void 0,done:!0}}function $(Pe){this.next=function(He){return Pe.o(He)},this.throw=function(He){return Pe.s(He)},this.return=function(He){return function(lt,ke){I(lt.g);var D=lt.g.j;return D?x(lt,"return"in D?D.return:function(ee){return{value:ee,done:!0}},ke,lt.g.return):(lt.g.return(ke),M(lt))}(Pe,He)},this[Symbol.iterator]=function(){return this}}function q(Pe,He){return He=new $(new j(He)),y&&Pe.prototype&&y(He,Pe.prototype),He}if(w.prototype.o=function(Pe){this.v=Pe},w.prototype.s=function(Pe){this.l={D:Pe,F:!0},this.h=this.C||this.u},w.prototype.return=function(Pe){this.l={return:Pe},this.h=this.u},j.prototype.o=function(Pe){return I(this.g),this.g.j?x(this,this.g.j.next,Pe,this.g.o):(this.g.o(Pe),M(this))},j.prototype.s=function(Pe){return I(this.g),this.g.j?x(this,this.g.j.throw,Pe,this.g.o):(this.g.s(Pe),M(this))},u("Array.prototype.entries",function(Pe){return Pe||function(){return function(He,lt){He instanceof String&&(He+="");var ke=0,D=!1,ee={next:function(){if(!D&&ke<He.length){var ue=ke++;return{value:lt(ue,He[ue]),done:!1}}return D=!0,{done:!0,value:void 0}}};return ee[Symbol.iterator]=function(){return ee},ee}(this,function(He,lt){return[He,lt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var oe=function(Pe,He){for(var lt=0;lt<Pe.length;lt++)He(Pe[lt])},me=function(Pe){return Pe.replace(/\r?\n|\r/g,`\r
`)},ge=function(Pe,He,lt){return He instanceof Blob?(lt=lt!==void 0?lt+"":typeof He.name=="string"?He.name:"blob",He.name===lt&&Object.prototype.toString.call(He)!=="[object Blob]"||(He=new File([He],lt)),[String(Pe),He]):[String(Pe),String(He)]},fe=function(Pe,He){if(Pe.length<He)throw new TypeError(He+" argument required, but only "+Pe.length+" present.")},Re=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ue=Re.FormData,Qe=Re.XMLHttpRequest&&Re.XMLHttpRequest.prototype.send,rt=Re.Request&&Re.fetch,cn=Re.navigator&&Re.navigator.sendBeacon,ln=Re.Element&&Re.Element.prototype,tr=Re.Symbol&&Symbol.toStringTag;tr&&(Blob.prototype[tr]||(Blob.prototype[tr]="Blob"),"File"in Re&&!File.prototype[tr]&&(File.prototype[tr]="File"));try{new File([],"")}catch{Re.File=function(He,lt,ke){return He=new Blob(He,ke||{}),Object.defineProperties(He,{name:{value:lt},lastModified:{value:+(ke&&ke.lastModified!==void 0?new Date(ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),tr&&Object.defineProperty(He,tr,{value:"File"}),He}}var Jr=function(Pe){return Pe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Fr=function(Pe){this.i=[];var He=this;Pe&&oe(Pe.elements,function(lt){if(lt.name&&!lt.disabled&&lt.type!=="submit"&&lt.type!=="button"&&!lt.matches("form fieldset[disabled] *"))if(lt.type==="file"){var ke=lt.files&&lt.files.length?lt.files:[new File([],"",{type:"application/octet-stream"})];oe(ke,function(D){He.append(lt.name,D)})}else lt.type==="select-multiple"||lt.type==="select-one"?oe(lt.options,function(D){!D.disabled&&D.selected&&He.append(lt.name,D.value)}):lt.type==="checkbox"||lt.type==="radio"?lt.checked&&He.append(lt.name,lt.value):(ke=lt.type==="textarea"?me(lt.value):lt.value,He.append(lt.name,ke))})};if((e=Fr.prototype).append=function(Pe,He,lt){fe(arguments,2),this.i.push(ge(Pe,He,lt))},e.delete=function(Pe){fe(arguments,1);var He=[];Pe=String(Pe),oe(this.i,function(lt){lt[0]!==Pe&&He.push(lt)}),this.i=He},e.entries=function Pe(){var He,lt=this;return q(Pe,function(ke){if(ke.h==1&&(He=0),ke.h!=3)return He<lt.i.length?ke=P(ke,lt.i[He]):(ke.h=0,ke=void 0),ke;He++,ke.h=2})},e.forEach=function(Pe,He){fe(arguments,1);for(var lt=f(this),ke=lt.next();!ke.done;ke=lt.next()){var D=f(ke.value);ke=D.next().value,D=D.next().value,Pe.call(He,D,ke,this)}},e.get=function(Pe){fe(arguments,1);var He=this.i;Pe=String(Pe);for(var lt=0;lt<He.length;lt++)if(He[lt][0]===Pe)return He[lt][1];return null},e.getAll=function(Pe){fe(arguments,1);var He=[];return Pe=String(Pe),oe(this.i,function(lt){lt[0]===Pe&&He.push(lt[1])}),He},e.has=function(Pe){fe(arguments,1),Pe=String(Pe);for(var He=0;He<this.i.length;He++)if(this.i[He][0]===Pe)return!0;return!1},e.keys=function Pe(){var He,lt,ke,D,ee=this;return q(Pe,function(ue){if(ue.h==1&&(He=f(ee),lt=He.next()),ue.h!=3)return lt.done?void(ue.h=0):(ke=lt.value,D=f(ke),P(ue,D.next().value));lt=He.next(),ue.h=2})},e.set=function(Pe,He,lt){fe(arguments,2),Pe=String(Pe);var ke=[],D=ge(Pe,He,lt),ee=!0;oe(this.i,function(ue){ue[0]===Pe?ee&&(ee=!ke.push(D)):ke.push(ue)}),ee&&ke.push(D),this.i=ke},e.values=function Pe(){var He,lt,ke,D,ee=this;return q(Pe,function(ue){if(ue.h==1&&(He=f(ee),lt=He.next()),ue.h!=3)return lt.done?void(ue.h=0):(ke=lt.value,(D=f(ke)).next(),P(ue,D.next().value));lt=He.next(),ue.h=2})},Fr.prototype._asNative=function(){for(var Pe=new Ue,He=f(this),lt=He.next();!lt.done;lt=He.next()){var ke=f(lt.value);lt=ke.next().value,ke=ke.next().value,Pe.append(lt,ke)}return Pe},Fr.prototype._blob=function(){var Pe="----formdata-polyfill-"+Math.random(),He=[],lt="--"+Pe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ke,D){return typeof ke=="string"?He.push(lt+Jr(me(D))+`"\r
\r
`+me(ke)+`\r
`):He.push(lt+Jr(me(D))+'"; filename="'+Jr(ke.name)+`"\r
Content-Type: `+(ke.type||"application/octet-stream")+`\r
\r
`,ke,`\r
`)}),He.push("--"+Pe+"--"),new Blob(He,{type:"multipart/form-data; boundary="+Pe})},Fr.prototype[Symbol.iterator]=function(){return this.entries()},Fr.prototype.toString=function(){return"[object FormData]"},ln&&!ln.matches&&(ln.matches=ln.matchesSelector||ln.mozMatchesSelector||ln.msMatchesSelector||ln.oMatchesSelector||ln.webkitMatchesSelector||function(Pe){for(var He=(Pe=(this.document||this.ownerDocument).querySelectorAll(Pe)).length;0<=--He&&Pe.item(He)!==this;);return-1<He}),tr&&(Fr.prototype[tr]="FormData"),Qe){var Uo=Re.XMLHttpRequest.prototype.setRequestHeader;Re.XMLHttpRequest.prototype.setRequestHeader=function(Pe,He){Uo.call(this,Pe,He),Pe.toLowerCase()==="content-type"&&(this.B=!0)},Re.XMLHttpRequest.prototype.send=function(Pe){Pe instanceof Fr?(Pe=Pe._blob(),this.B||this.setRequestHeader("Content-Type",Pe.type),Qe.call(this,Pe)):Qe.call(this,Pe)}}rt&&(Re.fetch=function(Pe,He){return He&&He.body&&He.body instanceof Fr&&(He.body=He.body._blob()),rt.call(this,Pe,He)}),cn&&(Re.navigator.sendBeacon=function(Pe,He){return He instanceof Fr&&(He=He._asNative()),cn.call(this,Pe,He)}),Re.FormData=Fr}})();const p0=()=>{const e=Q("AREAS");return e.length===0&&e.push(On.GLOBAL),Ia(e).call(e,(n,i,o)=>{const c=QG(i);return c?o===0?c:"".concat(n,",").concat(c):n},"")},QG=e=>e===On.OVERSEA?"".concat(Es.ASIA,",").concat(Es.EUROPE,",").concat(Es.AFRICA,",").concat(Es.NORTH_AMERICA,",").concat(Es.SOUTH_AMERICA,",").concat(Es.OCEANIA):Es[e],Hde=e=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=YI[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(n[u]=n[u].concat(o[u]))})}),n},iA={GLOBAL:{ASIA:[On.CHINA,On.JAPAN,On.INDIA,On.KOREA,On.HKMC],EUROPE:[],NORTH_AMERICA:[On.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},sA=Object.keys(iA[On.GLOBAL]),cL=[On.CHINA,On.NORTH_AMERICA,On.EUROPE,On.ASIA,On.JAPAN,On.INDIA,On.OCEANIA,On.SOUTH_AMERICA,On.AFRICA,On.KOREA,On.HKMC,On.US],Kde=function(e,n){let i=[];if($e(e).call(e,On.GLOBAL)){const u=[On.GLOBAL,On.OVERSEA],h=Object.keys(YI);if(n===On.GLOBAL)throw new be(Y.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===On.CHINA)i=[On.OVERSEA];else if(c=n,$e(sA).call(sA,c)){const f=(o=n,iA[On.GLOBAL][o]||[]),_=[...u,n,...f];i=h.filter(v=>!$e(_).call(_,v))}else if(function(f){let _=!1;return sA.forEach(v=>{var y;$e(y=iA[On.GLOBAL][v]).call(y,f)&&(_=!0)}),_}(n)){const f=function(v){let y;return sA.forEach(w=>{var I;$e(I=iA[On.GLOBAL][w]).call(I,v)&&(y=w)}),y}(n),_=[...u,f,n];i=h.filter(v=>!$e(_).call(_,v))}else i=e;i=function(f){const _=[];return cL.forEach(v=>{$e(f).call(f,v)&&_.push(v)}),_.concat(f.filter(v=>!$e(cL).call(cL,v)))}(i)}else i=e;var o,c;return i};function ZG(e){var n,i;if(!e&&$e(n=Q("AREAS")).call(n,On.EXTENSIONS))return k.debug("update area from ap : reset"),void lL(tde,!0);if(!$e(i=Q("AREAS")).call(i,On.GLOBAL)||!e)return;let o=YI.EXTENSIONS;o&&(o={CODE:QG(On.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},k.debug("update area from ap success: ".concat(e,",config is "),o),Hn("AREAS",[On.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Hn(c,o[c][0]):Hn(c,o[c])}))}function lL(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=ht.reportApiInvoke(null,{name:hi.SET_AREA,options:e,tag:Dr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!$e(EG).call(EG,u))throw new be(Y.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new be(Y.INVALID_PARAMS,"area code is needed");let f=u;typeof u=="string"&&(f=[u]),o=h?Kde(f,h):f}if(!n){if(xu.AREAS){const u=new be(Y.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void k.warning("setArea is prohibited because of config-distribute")}if($e(o).call(o,On.GLOBAL)&&Q("AREAS")===On.EXTENSIONS){const u=new be(Y.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void k.warning("setArea is prohibited because of ap extensions")}}Hn("AREAS",o,n);const c=Hde(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Hn(u,c[u][0]):Hn(u,c[u])}),k.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function ez(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Md(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?ez(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ez(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let uL=1;function $de(e,n,i,o,c){uL+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:uL,requestId:uL,version:Yc,cname:i.cname},h={service_name:n,json_body:JSON.stringify(u)};let f,_,v=e[0];return Lu(async()=>{f=Date.now();const y=await Fu(v,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-f,y.code!==0){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming ap error, code"+y.code,{retry:!0,responseTime:_});throw k.error(P.toString()),P}const w=JSON.parse(y.json_body);if(w.code!==200){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:_});throw k.error(P.toString()),P}if(!w.servers||w.servers.length===0){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:_});throw k.error(P.toString()),P}const I=function(P,j){return{addressList:P.servers.map(x=>"wss://".concat(x.address.replace(/\./g,"-"),".").concat(Q("WORKER_DOMAIN"),":").concat(x.wss,"?serviceName=").concat(encodeURIComponent(j))),workerToken:P.workerToken,vid:P.vid}}(w,n);return Q("LIVE_STREAMING_ADDRESS")&&(I.addressList=Q("LIVE_STREAMING_ADDRESS")instanceof Array?Q("LIVE_STREAMING_ADDRESS"):[Q("LIVE_STREAMING_ADDRESS")]),Md(Md({},I),{},{responseTime:_})},(y,w)=>(ht.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(y.addressList),firstSuccess:w===0,responseTime:_,serverIp:e[w%e.length]}),!1),(y,w)=>(ht.apworkerEvent(i.sid,{success:!1,sc:y.data&&y.data.code||200,serviceName:n,responseTime:_,serverIp:e[w%e.length]}),!!(y.code!==Y.OPERATION_ABORTED&&y.code!==Y.UNEXPECTED_RESPONSE||y.data&&y.data.retry)&&(v=e[(w+1)%e.length],!0)),c)}let dL=1;function tz(e,n,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:f}=n,_=Date.now();let v;const y=n.role,[w,I]=pL(n,u,[ri.CHOOSE_SERVER]);let P=ni.networkState;return Lu(async()=>{P&&ni.networkState===xa.OFFLINE&&ni.onlineWaiter&&await Je.race([ni.onlineWaiter,qi(o&&o.maxRetryTimeout||pi.maxRetryTimeout)]),P=ni.networkState;const{data:j,headers:x}=await Fu(c,{data:w,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=x.http3==="1"?1:-1,ht.reportResourceTiming(c,f),rz(j,c,n,_,[ri.CHOOSE_SERVER],v);const M=l0(j,ri.CHOOSE_SERVER);return hL(M),tL(M,c)},j=>(j&&ht.joinChooseServer(f,{role:y,lts:_,succ:!0,csAddr:c,opid:I,serverList:j.gatewayAddrs.map(x=>x.address),ec:null,cid:j.cid.toString(),uid:j.uid.toString(),csIp:j.csIp,unilbsServerIds:[ri.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:j.res.detail&&j.res.detail[38]}),!1),j=>j.code!==Y.OPERATION_ABORTED&&(j.code===Y.CAN_NOT_GET_GATEWAY_SERVER?j.data.retry:(ht.joinChooseServer(f,{role:y,lts:_,succ:!1,csAddr:c,serverList:null,opid:I,ec:j.code,csIp:j.data&&j.data.csIp,unilbsServerIds:[ri.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:P}),isHttp3:v,corssRegionTagReq:n.apRequestDetail}),k.warning("[".concat(h||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),j),!0)),o)}function nz(e,n,i,o){let c,{url:u,areaCode:h,serviceIds:f}=e;const _=Date.now(),v=n.role,[y,w]=pL(n,h,f);let I;return Lu(async()=>{I&&ni.networkState===xa.OFFLINE&&ni.onlineWaiter&&await Je.race([ni.onlineWaiter,qi(o&&o.maxRetryTimeout||pi.maxRetryTimeout)]),I=ni.networkState;const{data:P,headers:j}=await Fu(u,{data:y,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=j.http3==="1"?1:-1,ht.reportResourceTiming(u,n.sid),rz(P,u,n,_,f,c);const x=l0(P,ri.CHOOSE_SERVER),M=l0(P,n.cloudProxyServer==="proxy5"?ri.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK);return hL(x),{gatewayInfo:tL(x,u),proxyInfo:M,url:u}},P=>(P.gatewayInfo&&ht.joinChooseServer(n.sid,{role:v,lts:_,succ:!0,csAddr:u,serverList:P.gatewayInfo.gatewayAddrs.map(j=>j.address),ec:null,opid:w,cid:P.gatewayInfo.cid.toString(),uid:P.gatewayInfo.uid.toString(),csIp:P.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:P.gatewayInfo.res.detail&&P.gatewayInfo.res.detail[38]}),P.proxyInfo&&ht.joinWebProxyAP(n.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:P.proxyInfo.addresses.map(j=>j.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:f.toString()}),!1),P=>P.code!==Y.OPERATION_ABORTED&&(P.code===Y.CAN_NOT_GET_GATEWAY_SERVER?P.data.retry:(ht.joinWebProxyAP(n.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:P.code,eventType:n.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:I})}),k.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),P),!0)),o)}const rz=(e,n,i,o,c,u)=>{const{sid:h,clientId:f,cloudProxyServer:_}=i,v=[],y=w=>{w.flag===4096?ht.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:n,opid:e.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||ht.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:w.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(w=>{const I=w.buffer.code;if(w.uri===23&&I===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const P={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:w.buffer.flag};v.push(P),y(P)}if(I!==0){const P=WE(I),j={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,P.desc,{desc:P.desc,retry:P.retry,csIp:e.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?k.warning(j.error.toString()):v.push(j),y(j)}}),v.length)throw k.warning("[".concat(f||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(n," failed, ").concat(v.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new be(Y.CAN_NOT_GET_GATEWAY_SERVER,v.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!v.find(w=>w.error.data.retry),csIp:e.detail[502],desc:[...new Set(v.map(w=>{var I;return w==null||(I=w.error)===null||I===void 0||(I=I.data)===null||I===void 0?void 0:I.desc}).filter(w=>!!w))]})},hL=e=>{var n,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Q("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?ZG(e.detail[23].toLowerCase()):ZG()),(n=e.detail)!==null&&n!==void 0&&n[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],f=h==null?void 0:h.split(";");for(let _=0;_<f.length;_++){var u;const v=Ws(u=f[_]).call(u);e.addresses[_]&&f&&(e.addresses[_].fingerprint=v)}}if(Q("GATEWAY_ADDRESS")&&Q("GATEWAY_ADDRESS").length>0){k.debug("assign gateway address to",Q("GATEWAY_ADDRESS"));const h=Q("GATEWAY_ADDRESS").map(f=>{var _,v;const y=(_=(v=e.addresses.find(w=>w.ip===f.ip&&w.port===f.port))===null||v===void 0?void 0:v.fingerprint)!==null&&_!==void 0?_:"";return{ip:f.ip,port:f.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:y}});e.addresses=h}},qde=(e,n)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=WE(i.buffer.code);throw new be(Y.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw k.debug("update ticket request received ap response without response body:",n),new be(Y.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},pL=(e,n,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Md(Md(Md({6:e.stringUid,11:n,12:Q("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:n},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(f=>{e.multiIP&&e.multiIP.gateway_ip&&(f.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Yde=(e,n)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:n,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let KE=0;function $E(e){return Je.all(e.map(n=>n.then(i=>{throw i},i=>i))).then(n=>{throw n},n=>n)}const f0=async e=>{let{fragementLength:n,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const f=n;let _,v=0;const y=async()=>{const w=(()=>{const I=h*f,P=I+f;return i.slice(I,P).map(o)})();u&&u.push(...w);try{_=await $E(w)}catch(I){if(v+=f,h++,!(v>=i.length))return void await y();c(I)}w.forEach(I=>I.cancel())};return await y(),_},iz=async e=>{let{referenceList:n,asyncMapHandler:i,closeFn:o}=e;const c=n.length;let u=0;const h=async()=>{const f=i(n.shift());try{return await f}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function fL(e,n,i,o){return{gatewayInfo:await async function(u,h,f,_){let v=null;const y=[],w=async()=>{const P=Q("WEBCS_DOMAIN").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(M=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:p0()})),j=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(M=>M.url)}),x=await f0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:M=>(k.debug("[".concat(u.clientId,"] Connect to choose_server:"),M.url),tz(M,u,h,f)),allFailedhandler:M=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},j),M[0]},promisesCollector:y});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},j),x},I=async()=>{if(await qi(1e3),v!==null)return v;const P=Q("WEBCS_DOMAIN_BACKUP_LIST").map(M=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:p0()})),j=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(M=>M.url)}),x=await f0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:M=>(k.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),M.url),tz(M,u,h,f)),allFailedhandler:M=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},j),M[0]},promisesCollector:y});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},j),x};try{return v=await $E([w(),I()]),y.length&&y.forEach(P=>P.cancel&&typeof P.cancel=="function"&&P.cancel()),v}catch(P){throw P[0]}}(e,n,i,o)}}async function sz(e,n,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await fL(e,n,i,c);if(Q("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:I,proxyInfo:P}=await cz(e,n,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:I};const j=P.map(x=>({turnServerURL:x.address,tcpport:x.tcpport||us.tcpport,udpport:x.udpport||us.udpport,username:x.username||us.username,password:x.password||us.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const x=(h=e.uid)!==null&&h!==void 0?h:I.uid,M="glb:".concat(x.toString()),$=await a1(M),q=P.map(oe=>({turnServerURL:oe.address,tcpport:oe.tcpport||us.tcpport,udpport:oe.udpport||us.udpport,username:M,password:$,forceturn:!1,security:!0}));j.push(...q)}return e.turnServer={mode:"manual",servers:j},{gatewayInfo:I}}return await fL(e,n,i,c)}const{proxyInfo:f,gatewayInfo:_}=await cz(e,n,i,c),v={gatewayInfo:_},y=f.map(I=>({turnServerURL:I.address,tcpport:u==="proxy3"?void 0:I.tcpport?I.tcpport:us.tcpport,udpport:u==="proxy4"?void 0:I.udpport?I.udpport:us.udpport,username:I.username||us.username,password:I.password||us.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var w;const I=(w=e.uid)!==null&&w!==void 0?w:_.uid,P="glb:".concat(I.toString()),j=await a1(P),x=f.map(M=>({turnServerURL:M.address,tcpport:u==="proxy3"?void 0:M.tcpport||us.tcpport,udpport:u==="proxy4"?void 0:M.udpport||us.udpport,username:P,password:j,forceturn:u!=="proxy4",security:u==="proxy5"}));y.push(...x)}return e.turnServer={mode:"manual",servers:y},k.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),v}async function oz(e,n,i,o,c){const u=Q("ACCOUNT_REGISTER").slice(0,Q("AJAX_REQUEST_CONCURRENT"));let h=[];h=n.proxyServer?u.map(_=>"https://".concat(n.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const f=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(v,y,w,I,P){const j=Date.now(),x={sid:w.sid,opid:10,appid:w.appId,string_uid:y};let M=v[0];const $=await Lu(()=>Fu(M+"".concat(M.indexOf("?")===-1?"?":"&","action=stringuid"),{data:x,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(q,oe)=>{if(q.code===0){if(q.uid<=0||q.uid>=Math.pow(2,32))throw k.error("Invalid Uint Uid ".concat(y," => ").concat(q.uid),q),ht.reqUserAccount(x.sid,{lts:j,success:!1,serverAddr:M,stringUid:x.string_uid,uid:q.uid,errorCode:Y.INVALID_UINT_UID_FROM_STRING_UID,extend:x}),new be(Y.INVALID_UINT_UID_FROM_STRING_UID);return ht.reqUserAccount(x.sid,{lts:j,success:!0,serverAddr:M,stringUid:x.string_uid,uid:q.uid,errorCode:null,extend:x}),!1}const me=WE(q.code);return me.retry&&(M=v[(oe+1)%v.length]),ht.reqUserAccount(x.sid,{lts:j,success:!1,serverAddr:M,stringUid:x.string_uid,uid:q.uid,errorCode:me.desc,extend:x}),me.retry},(q,oe)=>q.code!==Y.OPERATION_ABORTED&&(ht.reqUserAccount(x.sid,{lts:j,success:!1,serverAddr:M,stringUid:x.string_uid,uid:null,errorCode:q.code,extend:x}),M=v[(oe+1)%v.length],!0),P);if($.code!==0){const q=WE($.code);throw new be(Y.UNEXPECTED_RESPONSE,q.desc)}return $}(h,e,n,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},f),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},f),_}}async function Xde(e,n,i){const o=Q("ACCOUNT_REGISTER");let c=[];c=n.proxyServer?o.map(u=>"https://".concat(n.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await iz({referenceList:c,asyncMapHandler:h=>async function(f,_,v,y){const w=Date.now(),I={sid:v.sid,opid:10,appid:v.appId,string_uid:_};try{const P=await Fu(f+"".concat(f.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(P.code!==0){const j=WE(P.code);throw new be(Y.UNEXPECTED_RESPONSE,"preload sua error:".concat(j.desc),j)}if(P.uid<=0||P.uid>=Math.pow(2,32))throw new be(Y.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:f,req:I,uid:P.uid,elapse:Date.now()-w}}catch(P){throw P}}(h,e,n,i),closeFn:h=>h.code===Y.OPERATION_ABORTED||h.code===Y.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Jde(e,n,i){const o=Q("CDS_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(v,y,w,I){const P=mn(),j={flag:64,cipher_method:0,features:Md(Md(Md(Md(Md({install_id:v1(),device:P.name,system:P.os,system_general:navigator.userAgent,vendor:y.appId,version:Yc,cname:y.cname,session_id:y.sid,proxyServer:y.proxyServer,sdk_type:Wde.WEB_RTC,browser_name:P.name,browser_version:P.version,user_agent:navigator.userAgent,channel_name:y.cname},y.stringUid&&{string_uid:y.stringUid}),y.uid&&{uid:y.uid+""}),P.os&&{os_name:P.os}),P.osVersion&&{os_version:P.osVersion}),{},{detail:""})};return Lu(()=>Fu(v,{data:j,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,x=>x.code!==Y.OPERATION_ABORTED,I)}(_,e,n,i));let u=null,h=null,f={};try{u=await $E(c)}catch(_){if(_.code===Y.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),ht.reportApiInvoke(e.sid,{name:hi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{f=function(_){if(!_.test_tags)return{};const v=_.test_tags,y=Object.keys(v),w={};return y.forEach(I=>{var P;const j=Ws(P=I.slice(4)).call(P),x=JSON.parse(v[I]),M=x[1];w[j]={tag:x[0]||"",value:M}}),w}(u)}catch{}return f}async function az(e,n){const i=Q("WEBCS_DOMAIN").concat(Q("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:p0(),serviceIds:[ri.CHOOSE_SERVER,ri.CLOUD_PROXY_FALLBACK]}));try{return await iz({referenceList:i,asyncMapHandler:c=>async function(u,h,f){let _,{url:v,areaCode:y,serviceIds:w}=u;const I=Date.now(),[P,j]=pL(h,y,w);let x=ni.networkState;try{x&&ni.networkState===xa.OFFLINE&&ni.onlineWaiter&&await Je.race([ni.onlineWaiter,qi(pi.maxRetryTimeout)]),x=ni.networkState;const{data:M,headers:$}=await Fu(v,{data:P,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=$.http3==="1"?1:-1,(ge=>{const fe=[];if(ge.response_body.forEach(Re=>{const Ue=Re.buffer.code;if(Re.uri===23&&Ue===0&&!Re.buffer.edges_services)if(Re.buffer.flag===4194310)Re.buffer.edges_services=[];else{const Qe={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ge.detail[502]}),flag:Re.buffer.flag};fe.push(Qe)}if(Ue!==0){const Qe=WE(Ue),rt={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,Qe.desc,{desc:Qe.desc,retry:Qe.retry,csIp:ge.detail[502]}),flag:Re.buffer.flag};Re.buffer.flag===4194310?k.warning(rt.error.toString()):fe.push(rt)}}),fe.length)throw new be(Y.CAN_NOT_GET_GATEWAY_SERVER,fe.map(Re=>"flag: ".concat(Re.flag,", message: ").concat(Re.error.message)).join(" | "),{retry:!!fe.find(Re=>Re.error.data.retry),csIp:ge.detail[502],desc:[...new Set(fe.map(Re=>{var Ue;return Re==null||(Ue=Re.error)===null||Ue===void 0||(Ue=Ue.data)===null||Ue===void 0?void 0:Ue.desc}).filter(Re=>!!Re))]})})(M);const oe=l0(M,ri.CHOOSE_SERVER),me=l0(M,ri.CLOUD_PROXY_FALLBACK);return hL(oe),{gatewayInfo:tL(oe,v),proxyInfo:me,opid:j,requestTime:I,url:v,isHttp3:_,elapse:Date.now()-I}}catch(M){throw M}}(c,e,n),closeFn:c=>c.code===Y.OPERATION_ABORTED||c.code===Y.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function cz(e,n,i,o){const c=Q("PROXY_SERVER_TYPE3"),u=(P,j,x)=>{let M=x||c;return Array.isArray(M)&&(M=j%2==0?c[1]:c[0]),"https://".concat(M,"/ap/?url=").concat(P)};let h=null;const f=[],_=async()=>{const P=Q("WEBCS_DOMAIN").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map((M,$)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(M,"/api/v2/transpond/webrtc?v=2"),$,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):u("".concat(M,"/api/v2/transpond/webrtc?v=2"),$),{url:q,areaCode:p0(),serviceIds:[ri.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ri.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK]}}),j=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(M=>M.url)}),x=await f0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:M=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),M.url),nz(M,e,n,i)),allFailedhandler:M=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},j),M[0]},promisesCollector:f});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},j),x},v=async()=>{if(await qi(1e3),h!==null)return h;const P=Q("WEBCS_DOMAIN_BACKUP_LIST").map((M,$)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(M,"/api/v2/transpond/webrtc?v=2"),$,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):u("".concat(M,"/api/v2/transpond/webrtc?v=2"),$),{url:q,areaCode:p0(),serviceIds:[ri.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ri.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK]}}),j=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(M=>M.url)}),x=await f0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:M=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),M.url),nz(M,e,n,i)),allFailedhandler:M=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},j),M[0]},promisesCollector:f});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},j),x};let y,w,I;try{({gatewayInfo:y,proxyInfo:w,url:I}=await $E([_(),v()]))}catch(P){throw P[0]}if(f.length&&f.forEach(P=>P.cancel&&typeof P.cancel=="function"&&P.cancel()),!y||!w)throw new be(Y.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=I,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&I){const P=/^https?:\/\/(.+?)(\/.*)?$/.exec(I)[1];$e(c).call(c,P)&&(e.proxyServer=P,k.setProxyServer(P),ht.setProxyServer(P))}return h={gatewayInfo:y,proxyInfo:await kG(w,y.uid)},h}async function Qde(e,n,i){const o=Q("UAP_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,f,_,v){const y={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:Yc,cname:f.cname,uid:f.uid.toString(),requestId:dL,seq:dL};dL+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(y)};return Lu(async()=>{const I=await Fu(h,{data:w,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(I.code!==0){const j=new be(Y.UNEXPECTED_RESPONSE,"cross channel ap error, code"+I.code,{retry:!0});throw k.error(j.toString()),j}const P=JSON.parse(I.json_body);if(P.code!==200){const j=new be(Y.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(P.code,", reason: ").concat(P.reason));throw k.error(j.toString()),j}if(!P.servers||P.servers.length===0){const j=new be(Y.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw k.error(j.toString()),j}return{vid:P.vid,workerToken:P.workerToken,addressList:(Q("CHANNEL_MEDIA_RELAY_SERVERS")||P.servers).map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(Q("WORKER_DOMAIN"),":").concat(j.wss))}},void 0,I=>!!(I.code!==Y.OPERATION_ABORTED&&I.code!==Y.UNEXPECTED_RESPONSE||I.data&&I.data.retry),v)}(u,e,n,i));try{const u=await $E(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Zde(e,n,i){let o=null;const c=[],u=async h=>{const f=Q(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await qi(1e3),o!==null)?o:await f0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:_=>(k.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(v,y,w,I){const[P]=Yde(y,[ri.CHOOSE_SERVER]);let j=ni.networkState;return Lu(async()=>{j&&ni.networkState===xa.OFFLINE&&ni.onlineWaiter&&await Je.race([ni.onlineWaiter,qi(I&&I.maxRetryTimeout||pi.maxRetryTimeout)]),j=ni.networkState;const x=await Fu(v,{data:P,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return qde(x,v)},()=>!1,x=>x.code!==Y.OPERATION_ABORTED&&(x.code===Y.UPDATE_TICKET_FAILED?x.data.retry:(k.warning("[".concat(y.clientId,"] update ticket network error, retry"),x),!0)),I)}(_,e,n,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await $E([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function lz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function mL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?lz(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):lz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class ehe extends Rr{get isSuccess(){return!!this.configs}constructor(n,i){super(),G(this,"configs",void 0),G(this,"store",void 0),G(this,"joinInfo",void 0),G(this,"cancelToken",void 0),G(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),G(this,"interval",void 0),G(this,"mutex",void 0),G(this,"mutableParamsRead",!1),G(this,"configCache",{}),G(this,"limit_bitrate",void 0),this.mutex=new vs("config-distribute",n),this.store=i}startGetConfigDistribute(n,i){this.joinInfo=n,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),Q("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Q("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ht.reportApiInvoke(null,{options:void 0,name:hi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Dr.TRACER}).onSuccess(JSON.stringify(xu))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void k.debug("[config-distribute] get config distribute interrupted have no joininfo");let n;const i=await this.mutex.lock();try{n=await Jde(this.joinInfo,this.cancelToken,this.retryConfig),k.debug("[config-distribute] get config distribute",JSON.stringify(n));const o=function(c){var u;const h=xT(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<h.length;v++)for(let y=h.length-1;y>v;y--){const w=h[y],I=c[w].value;if(typeof I.__priority=="number"){const P=I.__priority,j=h[y-1],x=c[j].value;if(typeof x.__priority=="number"){if(!(P>x.__priority))continue;{const M=w;h[y]=h[y-1],h[y-1]=M}}else{const M=w;h[y]=h[y-1],h[y-1]=M}}}const f=Date.now();let _={};return h.forEach(v=>{const y=c[v].value.__expires;y&&y<=f||(_[v]=c[v])}),_}(n);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new be(Y.NETWORK_RESPONSE_ERROR,o);k.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(n){yG(n)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==n.id&&this.emit(o0.UPDATE_BITRATE_LIMIT,n):this.emit(o0.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.limit_bitrate&&mL({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(n){try{const i={},o=Object.keys(n),c=[];o.forEach(u=>{const h=n[u].value;i[u]=h;const f=h.__id;if(f&&this.configCache[u]&&this.configCache[u].__id===f)return;const _=h.__type,v=n[u].value,y=n[u].tag;let w=0;_?_===Y5.REALTIME&&(w=1):Object.keys(v).some(I=>Object.prototype.hasOwnProperty.call(T1,I)||!H1()&&Object.prototype.hasOwnProperty.call(II,I)?(w=1,!0):void 0),c.push({tag:y,isApplied:w,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:f,params:_,isApplied:v}=u;this.store.sessionId&&ht.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:f,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){k.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(n){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const f=c[h].value,_=f.__expires,v=f.__type;Object.keys(f).forEach(y=>{y==="__id"||y==="__type"||y==="__priority"||y==="__expires"||Object.prototype.hasOwnProperty.call(u,y)||(u[y]=mL(mL({value:f[y]},_&&{expires:_}),v&&{type:v}))})}),u}(n);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&yG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(n),function(f){try{const _=Date.now();Object.keys(f).forEach(v=>{const{value:y,type:w,expires:I}=f[v];I&&I<=_||((w===Y5.REALTIME||Object.prototype.hasOwnProperty.call(T1,v))&&(xu[v]=y,lr[v]=y,k.debug("Update realtime parameters from config distribute",v,y)),w||H1()||!Object.prototype.hasOwnProperty.call(II,v)||(xu[v]=y,lr[v]=y,k.debug("Update gateway parameters from config distribute",v,y)))})}catch(_){k.error("Error update config immediately: ".concat(f),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),k.debug("Caching global parameters ".concat(u))}catch(c){k.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(n){try{const i=Date.now();Object.keys(n).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(lr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;(function(h,f){try{return typeof h=="object"&&typeof f=="object"&&JSON.stringify(h)===JSON.stringify(f)}catch{return!1}})(lr[o],c)||(xu[o]=c,lr[o]=c,this.emit(o0.UPDATE_CLIENT_ROLE_OPTIONS,c),k.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){k.error("Error handling global parameter config:",i.message)}}}class the extends Rr{constructor(){super(...arguments),G(this,"resultStorage",new Map)}setLocalAudioStats(n,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(n,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(o))}setRemoteAudioStats(n,i){const o=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(n,i){const o=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(n,i,o){if(Q("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=$e(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",uz[n],n,i),!c.isPrevNormal&&h&&this.emit("exception",uz[n]+2e3,n+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&n.receiveLevel===0)}checkAudioInputLevel(n,i){return i instanceof Ei&&!i.isActive||!!i.muted||n.sendVolumeLevel!==0}checkFramerateInput(n,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=Ma(i._encoderConfig.frameRate));const c=n.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,i){return!!i.muted||n.sendBitrate!==0}checkSendAudioBitrate(n,i){return i instanceof Ei&&!i.isActive||!!i.muted||n.sendBitrate!==0}checkVideoDecode(n){return n.receiveBitrate===0||n.decodeFrameRate!==0}}const uz={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ss=new class{markSubscribeStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(n))}markPublishStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(n))}measureFromSubscribeStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function dz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Xg(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?dz(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):dz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class m0{constructor(n){G(this,"store",void 0),G(this,"onStatsException",void 0),G(this,"onUploadPublishDuration",void 0),G(this,"onStatsChanged",void 0),G(this,"localStats",new Map),G(this,"remoteStats",new Map),G(this,"updateStatsInterval",void 0),G(this,"trafficStats",void 0),G(this,"trafficStatsPeerList",[]),G(this,"uplinkStats",void 0),G(this,"exceptionMonitor",void 0),G(this,"p2pChannel",void 0),G(this,"scalabilityMode",CI.L1T1),G(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.exceptionMonitor=new the,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Le.LocalAudioTrack)||Xg({},I1)}getLocalVideoTrackStats(){return this.localStats.get(Le.LocalVideoTrack)||Xg({},A1)}getRemoteAudioTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.audioStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:f}]=u;f&&(o[h]=i(h,f))});return o}getRemoteNetworkQualityStats(n){const i={};if(n){var o;const c=(o=this.remoteStats.get(n))===null||o===void 0?void 0:o.networkStats;c&&(i[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.videoStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:f}]=u;f&&(o[h]=i(h,f))});return o}getRTCStats(){let n=0,i=0,o=0,c=0;const u=this.localStats.get(Le.LocalAudioTrack);u&&(n+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(Le.LocalVideoTrack);h&&(n+=h.sendBytes,i+=h.sendBitrate);const f=this.localStats.get(Le.LocalVideoLowTrack);f&&(n+=f.sendBytes,i+=f.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:y,videoStats:w}=v;y&&(o+=y.receiveBytes,c+=y.receiveBitrate),w&&(o+=w.receiveBytes,c+=w.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:n,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),n.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Ss.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ss.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&k.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,i,o){if(!n)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case Le.LocalVideoTrack:case Le.LocalVideoLowTrack:{const h=c,f=Xg({},A1),_=n.getStats(),v=n.getLocalMedia(o);if(_){const y=_.videoSend.find(w=>w.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(y){const w=n.getLocalVideoSize(),I=n.getEncoderConfig(Le.LocalVideoTrack);y.codec!=="H264"&&y.codec!=="H265"&&y.codec!=="VP8"&&y.codec!=="VP9"&&y.codec!=="AV1X"&&y.codec!=="AV1"||(f.codecType=y.codec),f.sendBytes=y.bytes,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0,y.inputFrame?(f.captureFrameRate=y.inputFrame.frameRate,f.captureResolutionHeight=y.inputFrame.height,f.captureResolutionWidth=y.inputFrame.width):w&&(f.captureResolutionWidth=w.width,f.captureResolutionHeight=w.height),y.sentFrame?(f.sendFrameRate=y.sentFrame.frameRate,f.sendResolutionHeight=y.sentFrame.height,f.sendResolutionWidth=y.sentFrame.width):w&&(f.sendResolutionWidth=w.width,f.sendResolutionHeight=w.height),y.avgEncodeMs&&(f.encodeDelay=y.avgEncodeMs),I&&I.bitrateMax&&(f.targetSendBitrate=1e3*I.bitrateMax),f.sendPackets=y.packets,f.sendPacketsLost=y.packetsLost,f.sendJitterMs=y.jitterMs,f.sendRttMs=y.rttMs,f.totalDuration=h?h.totalDuration+1:1,f.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(y)&&(f.totalFreezeTime+=1),y.scalabilityMode&&this.scalabilityMode!==y.scalabilityMode&&(k.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(y.scalabilityMode)),this.scalabilityMode=y.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,f),((h==null?void 0:h.sendResolutionWidth)!==f.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==f.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,f);break}case Le.LocalAudioTrack:{const h=c,f=Xg({},I1),_=n.getStats(),v=n.getLocalMedia(o);if(_){const y=_.audioSend.find(w=>w.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(y){if(y.codec!=="opus"&&y.codec!=="aac"&&y.codec!=="PCMU"&&y.codec!=="PCMA"&&y.codec!=="G722"||(f.codecType=y.codec),y.inputLevel)f.sendVolumeLevel=Math.round(32767*y.inputLevel);else{const w=n.getLocalAudioVolume();w&&(f.sendVolumeLevel=Math.round(32767*w))}f.sendBytes=y.bytes,f.sendPackets=y.packets,f.sendPacketsLost=y.packetsLost,f.sendJitterMs=y.jitterMs,f.sendRttMs=y.rttMs,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Le.LocalAudioTrack,f),f&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,f);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:f,videoPcStats:_}]=i;const v=f,y=h,w=_,I=Xg({},o6),P=Xg({},a6),j=Xg({},Fue),{audioTrack:x,videoTrack:M,audioSSRC:$,videoSSRC:q}=n.getRemoteMedia(u);let oe;oe=this.store.useP2P?n.getStats(!0):n.getStats();const me=(o=oe)===null||o===void 0?void 0:o.audioRecv.find(Ue=>Ue.ssrc===$),ge=(c=oe)===null||c===void 0?void 0:c.videoRecv.find(Ue=>Ue.ssrc===q),fe=this.trafficStats&&this.trafficStats.peer_delay.find(Ue=>Ue.peer_uid===u);if(me&&(me.codec!=="opus"&&me.codec!=="aac"&&me.codec!=="PCMU"&&me.codec!=="PCMA"&&me.codec!=="G722"||(I.codecType=me.codec),me.outputLevel?I.receiveLevel=Math.round(32767*me.outputLevel):x&&(I.receiveLevel=Math.round(32767*x.getVolumeLevel())),I.receiveBytes=me.bytes,I.receivePackets=me.packets,I.receivePacketsLost=me.packetsLost,I.receivePacketsDiscarded=me.packetsDiscarded,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=v?8*Math.max(0,I.receiveBytes-v.receiveBytes):0,I.totalDuration=v?v.totalDuration+1:1,I.totalFreezeTime=v?v.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=me.jitterBufferMs,I.totalDuration>10&&m0.isRemoteAudioFreeze(x)&&(I.totalFreezeTime+=1)),ge){var Re;ge.codec!=="H264"&&ge.codec!=="H265"&&ge.codec!=="VP8"&&ge.codec!=="VP9"&&ge.codec!=="AV1X"&&ge.codec!=="AV1"||(P.codecType=ge.codec),P.receiveBytes=ge.bytes,P.receiveBitrate=y?8*Math.max(0,P.receiveBytes-y.receiveBytes):0,P.decodeFrameRate=ge.decodeFrameRate<0?0:ge.decodeFrameRate,P.renderFrameRate=ge.decodeFrameRate<0?0:ge.decodeFrameRate,ge.outputFrame&&(P.renderFrameRate=ge.outputFrame.frameRate),ge.receivedFrame?(P.receiveFrameRate=ge.receivedFrame.frameRate,P.receiveResolutionHeight=ge.receivedFrame.height,P.receiveResolutionWidth=ge.receivedFrame.width):M&&(P.receiveResolutionHeight=M._videoHeight||0,P.receiveResolutionWidth=M._videoWidth||0),ge.framesRateFirefox!==void 0&&(P.receiveFrameRate=Math.round(ge.framesRateFirefox)),P.receivePackets=ge.packets,P.receivePacketsLost=ge.packetsLost,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost);const Ue=y?y.totalFreezeTime:0,Qe=y?y.totalDuration:0;P.totalDuration=y?y.totalDuration+1:1,P.totalFreezeTime=(Re=ge.totalFreezesDuration)!==null&&Re!==void 0?Re:Ue||0,P.receiveDelay=ge.jitterBufferMs||0;const rt=!!q&&n.getRemoteVideoIsReady(q);ge.totalFreezesDuration===void 0&&M&&rt&&m0.isRemoteVideoFreeze(M,ge,w)&&(P.totalFreezeTime+=1),P.freezeRate=Math.max(0,Math.min((P.totalFreezeTime-Ue)/(P.totalDuration-Qe),1))}fe&&(I.end2EndDelay=fe.B_ad,P.end2EndDelay=fe.B_vd,I.transportDelay=fe.B_ed,P.transportDelay=fe.B_ed,I.currentPacketLossRate=fe.B_ealr4/100,P.currentPacketLossRate=fe.B_evlr4/100,j.uplinkNetworkQuality=fe.B_punq?fe.B_punq:0,j.downlinkNetworkQuality=fe.B_pdnq?fe.B_pdnq:0),this.remoteStats.set(u,{audioStats:I,videoStats:P,videoPcStats:ge,networkStats:j}),x&&this.exceptionMonitor.setRemoteAudioStats(x,I),M&&this.exceptionMonitor.setRemoteVideoStats(M,P)})}}class hz{constructor(){G(this,"destChannelMediaInfos",new Map),G(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){vG(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){vG(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){KI(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function pz(e){if(!(e instanceof hz))return new be(Y.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!n)return new be(Y.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new be(Y.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Wf{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,i){G(this,"uid",void 0),G(this,"_uintid",void 0),G(this,"_trust_in_room_",!0),G(this,"_trust_audio_enabled_state_",!0),G(this,"_trust_video_enabled_state_",!0),G(this,"_trust_audio_mute_state_",!0),G(this,"_trust_video_mute_state_",!0),G(this,"_audio_muted_",!1),G(this,"_video_muted_",!1),G(this,"_audio_enabled_",!0),G(this,"_video_enabled_",!0),G(this,"_audio_added_",!1),G(this,"_video_added_",!1),G(this,"_is_pre_created",!1),G(this,"_video_pre_subscribed",!1),G(this,"_audio_pre_subscribed",!1),G(this,"_trust_video_stream_added_state_",!0),G(this,"_trust_audio_stream_added_state_",!0),G(this,"_audioTrack",void 0),G(this,"_videoTrack",void 0),G(this,"_dataChannels",[]),G(this,"_audioSSRC",void 0),G(this,"_videoSSRC",void 0),G(this,"_audioOrtc",void 0),G(this,"_videoOrtc",void 0),G(this,"_cname",void 0),G(this,"_rtxSsrcId",void 0),G(this,"_videoMid",void 0),G(this,"_audioMid",void 0),this.uid=n,this._uintid=i}}function fz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function mz(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?fz(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const g0="9",gz=4e4;function _z(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ap(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?_z(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_z(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var qE=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(qE||{});const oA=new Map;function vz(e,n,i,o){let{scale:c}=e;if(c===0&&o===qE.UP||c>=n.length-1&&o===qE.DOWN)return e;let u=ap(ap({},e),{},{scale:o===qE.DOWN?++c:--c});switch(i){case"maintain-framerate":u=ap(ap({},u),n[c].motion);break;case"maintain-resolution":u=ap(ap({},u),n[c].detail);break;case"balanced":u=ap(ap({},u),n[c].balanced)}return u}function Ez(e,n){if(n){const i={overUse:0,underUse:0,adaptationList:yz(n)};oA.set(e,i)}else oA.delete(e)}function yz(e){const n=ap({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=n,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:y,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:I,PERF_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_UP_THRESHOLD:j,BALANCE_BITRATE_FACTOR:x,BALANCE_FRAMERATE_FACTOR:M,BALANCE_RESOLUTION_FACTOR:$,MOTION_RESOLUTION_FACTOR:q,MOTION_BITRATE_FACTOR:oe,DETAIL_FRAMERATE_FACTOR:me,DETAIL_BITRATE_FACTOR:ge}=y1,fe=Math.min(n.frameRate,f),Re=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(I,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(P,1)*fe),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let Ue=1;Ue<=_;Ue++){const Qe={bwe_up:Math.round(Math.pow(w,Ue)*i),bwe_down:Math.round(Math.pow(I,Ue+1)*i),fps_up:Math.round(Math.pow(j,Ue)*fe),fps_down:Math.round(Math.pow(P,Ue+1)*fe)},rt={scaleResolutionDownBy:c/Math.pow($,Ue),frameRate:Math.max(Math.round(Math.pow(M,Ue)*o),h),bitrateMax:Math.max(Math.round(Math.pow(x,Ue)*i),y),bitrateMin:Math.max(Math.round(Math.pow(x,Ue)*u),v)},cn={scaleResolutionDownBy:c/Math.pow(q,Ue),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(oe,Ue)*i),y),bitrateMin:Math.max(Math.round(Math.pow(oe,Ue)*u),v)},ln={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(me,Ue)*o),h),bitrateMax:Math.max(Math.round(Math.pow(ge,Ue)*i),y),bitrateMin:Math.max(Math.round(Math.pow(ge,Ue)*u),v)};Re.push({scale:Ue,threshold:Qe,balanced:rt,motion:cn,detail:ln})}return Re}function nhe(e,n,i,o,c,u){const h=oA.get(e)||{overUse:0,underUse:0,adaptationList:yz(c)},{adaptationList:f}=h;oA.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:v}=y1,{scale:y}=o;let w,I;return typeof n=="number"&&n>0&&function(P,j,x,M){if(j>=x.length)return!1;let{threshold:{fps_down:$}}=x[j];return Q("FORCE_AG_HIGH_FRAMERATE")&&M==="maintain-framerate"&&($=x[0].threshold.fps_down),P<$}(n,y,f,u)&&(h.overUse++,I=e0.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(P,j,x){if(j>=x.length)return!1;const{threshold:{bwe_down:M}}=x[j];return P<M}(i,y,f)&&(h.overUse++,I=e0.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,w=vz(o,f,u,qE.DOWN),[w,I]):(typeof n=="number"&&n>0&&typeof i=="number"&&i>0&&function(P,j,x,M){if(j===0)return;let{threshold:{fps_up:$}}=x[j];return Q("FORCE_AG_HIGH_FRAMERATE")&&M==="maintain-framerate"&&($=x[1].threshold.fps_up),P>$}(n,y,f,u)&&function(P,j,x){if(j===0)return;const{threshold:{bwe_up:M}}=x[j];return P>M}(i,y,f)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,w=vz(o,f,u,qE.UP),w.scale===0&&(I=e0.NONE))),[w,I])}function Sz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function gL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Sz(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Sz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function rhe(e){var n;return!!Q("ENABLE_AG_ADAPTATION")&&!!(e instanceof U1||$e(n=e._hints).call(n,er.CUSTOM_TRACK))&&(!!Q("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=mn();if(o.os!==Ai.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&_5(17,4)||g5(14)&&v5(17,4,!0)))}const aA=new Map;function cA(e,n){const i=aA.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),aA.delete(e)}n.qualityLimitationReason=e0.NONE,Ez(e)}function ihe(e,n){var i;let o;switch(n){case Le.LocalAudioTrack:o=jn.Audio;break;case Le.LocalVideoTrack:o=$e(i=e._hints).call(i,er.SCREEN_TRACK)?jn.Screen:jn.High;break;case Le.LocalVideoLowTrack:o=jn.Low}return o}function _L(e){const n=wn();if(e.some(i=>i._bypassWebAudio))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!n.webAudioMediaStreamDest)throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function vL(e,n){_L(e);const i=new Ei;return e.forEach(o=>i.addAudioTrack(o)),i}const she=!wn().supportUnifiedPlan||Q("CHROME_FORCE_PLAN_B")&&Jh();function lA(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return she?(i={spec:n,store:e},sp("PlanBConnection").create(i)):new Ud(n,e)}function EL(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function Tz(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(JT(e.turnServer.servers))return!1;if(Q("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(n=>n.forceturn))return!0}return!1}catch{return!1}}var pn;function bz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ju(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?bz(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):bz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Ud=(pn=class E_ extends TG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return $e(i=Object.keys(AI)).call(i,n)}))]}constructor(n,i){super(n,i),G(this,"id",Zn(5,"connection-")),G(this,"store",void 0),G(this,"peerConnection",void 0),G(this,"forceTurn",!1),G(this,"remoteSDP",void 0),G(this,"initialOffer",void 0),G(this,"transportEventReceiver",void 0),G(this,"statsFilter",void 0),G(this,"extension",{useXR:Q("USE_XR")}),G(this,"localCapabilities",void 0),G(this,"remoteCodecs",void 0),G(this,"localCandidateCount",0),G(this,"allCandidatesReceived",!1),G(this,"isPreallocation",!1),G(this,"preSSRCMap",new Map),G(this,"dataStreamChannelMap",new Map),G(this,"establishPromise",void 0),G(this,"recoveredDataChannelIds",[]),G(this,"currentDataChannelId",1),G(this,"supportAV1RtpSpec",!1),G(this,"mutex",void 0),G(this,"qualityLimitationReason",e0.NONE),G(this,"isFirstConnected",!1),this.store=i,this.forceTurn=Tz(n),this.mutex=new vs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(E_.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=_1(this.peerConnection,Q("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(n){const i=this.preSSRCMap.get(n);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(n,i){if(this.remoteCodecs=i,!this.remoteSDP)return void k.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(n,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else k.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=jf(o.sdp),u=await WG({filterRTX:!Q("USE_PUB_RTX")&&!Q("USE_SUB_RTX"),filterVideoFec:Q("FILTER_VIDEO_FEC"),filterAudioFec:Q("FILTER_AUDIO_FEC"),filterVideoCodec:Q("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=tA(u),this.initialOffer=o,Q("ENABLE_SVC")&&this.store.codec=="av1"){const f=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:CI.L1T3}]});const v=await _.createOffer();if(!v.sdp)return void _.close();const y=oa(v.sdp).mediaDescriptions[0];if(!y)return;const w=y.attributes.extmaps.find(I=>I.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),w}catch{return}}();var n;f&&(this.supportAV1RtpSpec=!0,(n=u.send)===null||n===void 0||n.videoExtensions.push(f))}let h;return o.sdp&&KG(o.sdp)&&(h=Lr(u),(i=h).send&&(GE(st.VIDEO,i.send.videoExtensions),GE(st.AUDIO,i.send.audioExtensions)),i.recv&&(GE(st.VIDEO,i.recv.videoExtensions),GE(st.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(GE(st.VIDEO,i.sendrecv.videoExtensions),GE(st.AUDIO,i.sendrecv.audioExtensions))),ju(ju({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Ie(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&KG(this.initialOffer.sdp)&&(i=n.rtpCapabilities,o=this.localCapabilities,i.send&&(QI(st.VIDEO,i.send.videoExtensions,o.send.videoExtensions),QI(st.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(QI(st.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),QI(st.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Lr(this._localCapabilities)}get rtpCapabilities(){return Lr(this._rtpCapabilities)}get candidates(){return Lr(this._candidates)}get iceParameters(){return Lr(this._iceParameters)}get dtlsParameters(){return Lr(this._dtlsParameters)}constructor(v){let y=arguments.length>1&&arguments[1]!==void 0&&arguments[1];G(this,"sessionDesc",void 0),G(this,"_localCapabilities",void 0),G(this,"_rtpCapabilities",void 0),G(this,"_candidates",void 0),G(this,"_originCandidates",void 0),G(this,"_iceParameters",void 0),G(this,"_isUseExtmapAllowMixed",void 0),G(this,"_dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname",void 0),G(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=y,v=Lr(v);const{iceParameters:w,dtlsParameters:I,candidates:P,rtpCapabilities:j,setup:x,localCapabilities:M,cname:$}=v;this._rtpCapabilities=j,this._candidates=P,this._originCandidates=Lr(P),this._iceParameters=w,this._dtlsParameters=I,this._localCapabilities=M,this.setup=x,this.cname=$,this.sessionDesc=this.updateRemoteRTPCapabilities(j),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const y=this.candidates,w=this.dtlsParameters,I=this.iceParameters,P=this.rtpCapabilities.send;let j=this.sessionDesc.mediaDescriptions.length-1;for(let x=1;x<v;x++){const M=2*x+2e4,$=2*x+gz,{ssrcs:q,ssrcGroups:oe}=Yg([{ssrcId:M}],this.cname),{ssrcs:me,ssrcGroups:ge}=Yg([{ssrcId:$,rtx:Q("USE_SUB_RTX")?$+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:g0,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.videoCodecs.map(fe=>fe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:y,extmaps:P.videoExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:me,ssrcGroups:ge,rtcpFeedbackWildcards:[],payloads:P.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++j)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:g0,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.audioCodecs.map(fe=>fe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:y,extmaps:P.audioExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:oe,rtcpFeedbackWildcards:[],payloads:P.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++j)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return xf(this.sessionDesc)}send(v,y,w,I){const{ssrcs:P,ssrcGroups:j}=Yg(y,this.cname,Q("SYNC_GROUP")?w:void 0),x=this.findPreloadMediaDesc(P);if(x){if(Nr()&&this.firefoxSsrcMidMap.set(P[0].ssrcId,x.attributes.mid),I&&(I.twcc||I.remb)){const M=this.sessionDesc.mediaDescriptions.indexOf(x);return this.sessionDesc.mediaDescriptions[M]=this.mungSendMediaDesc(x,I),{mid:x.attributes.mid,needExchangeSDP:!0}}return{mid:x.attributes.mid,needExchangeSDP:!1}}{const M=this.findAvailableMediaIndex(v,P);let $;return M===-1||M===1&&(as()||function(){const q=mn();return!(q.name!==An.CHROME||!q.osVersion)&&Number(q.version)<=90}()||Q("ENABLE_ENCODED_TRANSFORM")&&Xh())||M===0&&Q("USE_SUB_RTX")||E5()?($=this.createOrRecycleSendMedia(v,P,j,"sendonly",I),this.updateBundleMids()):($=Lr(this.sessionDesc.mediaDescriptions[M]),$.attributes.direction="sendonly",$.attributes.ssrcs=P,$.attributes.ssrcGroups=j,this.sessionDesc.mediaDescriptions[M]=this.mungSendMediaDesc($,I)),Nr()&&this.firefoxSsrcMidMap.set(P[0].ssrcId,$.attributes.mid),{mid:$.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:y}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:y}}batchSend(v){const y=v.map(P=>{let{kind:j,ssrcMsg:x,mslabel:M}=P;return this.send(j,x,M)}),w=[];let I=!1;return y.forEach(P=>{let{mid:j,needExchangeSDP:x}=P;x&&(I=!0),w.push(j)}),{mids:w,needExchangeSDP:I}}stopSending(v){const y=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&v.indexOf(w.attributes.mid)!==-1);if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");y.forEach(w=>{w.attributes.mid==="0"||Nr()||E5()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")}),this.updateBundleMids()}mute(v){const y=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===v);if(!y)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));y.attributes.direction="inactive"}unmute(v){const y=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===v);if(!y)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));y.attributes.direction="sendonly"}muteRemote(v){const y=this.sessionDesc.mediaDescriptions.filter(w=>$e(v).call(v,w.attributes.mid||""));if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");y.forEach(w=>{w.attributes.direction="inactive"})}unmuteRemote(v){const y=this.sessionDesc.mediaDescriptions.filter(w=>$e(v).call(v,w.attributes.mid||""));if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");y.forEach(w=>{w.attributes.direction="recvonly"})}receive(v,y,w,I){v.forEach((P,j)=>{this.createOrRecycleRecvMedia(P,[],"recvonly",y,w,I[j])}),this.updateBundleMids()}stopReceiving(v){const y=this.sessionDesc.mediaDescriptions.filter(w=>v.indexOf(w.attributes.mid)!==-1);if(y.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");y.forEach(w=>{w.media.port="0",w.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const y=this.sessionDesc||oa((w=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(w?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var w;this._rtpCapabilities=v;const I=this.rtpCapabilities.send,P=this.localCapabilities.send;for(const j of y.mediaDescriptions){if(j.attributes.iceUfrag=this._iceParameters.iceUfrag,j.attributes.icePwd=this._iceParameters.icePwd,j.attributes.fingerprints=this._dtlsParameters.fingerprints,j.attributes.candidates=this._candidates,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video"){if(I.videoCodecs.length===0){const x=P.videoCodecs.filter(M=>{var $,q;return($=M.rtpMap)===null||$===void 0?void 0:$e(q=$.encodingName.toLowerCase()).call(q,"vp8")})||[P.videoCodecs[0]];j.media.fmts=x.map(M=>M.payloadType.toString(10)),j.attributes.payloads=x,j.attributes.extmaps=[]}else if(j.media.fmts=I.videoCodecs.map(x=>x.payloadType.toString(10)),j.attributes.payloads=I.videoCodecs,j.attributes.extmaps=I.videoExtensions,Q("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:x,ssrcGroups:M}=Yg([{ssrcId:gz,rtx:Q("USE_SUB_RTX")?40001:void 0}],this.cname);j.attributes.ssrcs=x,j.attributes.ssrcGroups=M}}if(j.media.mediaType==="audio"){if(I.audioCodecs.length===0){const x=P.audioCodecs.filter(M=>{var $,q;return($=M.rtpMap)===null||$===void 0?void 0:$e(q=$.encodingName.toLowerCase()).call(q,"opus")})||[P.audioCodecs[0]];j.media.fmts=x.map(M=>M.payloadType.toString(10)),j.attributes.payloads=x,j.attributes.extmaps=[]}else if(j.media.fmts=I.audioCodecs.map(x=>x.payloadType.toString(10)),j.attributes.payloads=I.audioCodecs,j.attributes.extmaps=I.audioExtensions,HE(j),Q("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:x,ssrcGroups:M}=Yg([{ssrcId:2e4}],this.cname);j.attributes.ssrcs=x,j.attributes.ssrcGroups=M}}}return this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const y=this._originCandidates.filter(I=>I.transport==="udp"),w=[];if(y.forEach(I=>{w.push(mz(mz({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),y.length!==0){switch(v){case ys.TCP_RELAY:this._candidates=w;break;case ys.UDP_TCP_RELAY:case ys.RELAY:this._candidates=[...y,...w];break;default:this._candidates=y}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(v){v=Lr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(y=>{y.attributes.iceUfrag=v.iceUfrag,y.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const y=[];for(let w=0;w<v;w++)y.push((this.currentMidIndex+w+1).toString(10));return y}findAvailableMediaIndex(v,y){return this.sessionDesc.mediaDescriptions.findIndex(w=>{const I=w.media.mediaType===v&&w.media.port!=="0"&&(w.attributes.direction==="sendonly"||w.attributes.direction==="sendrecv")&&w.attributes.ssrcs.length===0;if(Nr()){if(I){const P=this.firefoxSsrcMidMap.get(y[0].ssrcId);return!(P||w.attributes.mid!=="0"&&w.attributes.mid!=="1")||!(!P||P!==w.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if(w.media.mediaType==="application")return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),y={media:{mediaType:"application",port:g0,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(y),{mediaDesc:y,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,y,w,I,P,j){const x=v._mediaStreamTrack.kind,M=this.rtpCapabilities.recv,$=d0(x,M,this.localCapabilities.send,x===st.VIDEO?I:P),q=x===st.VIDEO?M.videoExtensions:M.audioExtensions;this.currentMidIndex+=1;const oe="".concat(this.currentMidIndex);let me={media:{mediaType:x,port:g0,protos:["UDP","TLS","RTP","SAVPF"],fmts:$.map(fe=>fe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(oe)}};me=this.mungRecvMediaDsec(me,v,j);const ge=this.findFirstClosedMedia(x);if(ge){const fe=this.sessionDesc.mediaDescriptions.indexOf(ge);this.sessionDesc.mediaDescriptions[fe]=me}else this.sessionDesc.mediaDescriptions.push(me);return me}updateRemoteCodec(v,y,w){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(me=>me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||"").filter(me=>{var ge;return $e(ge=Object.keys(AI)).call(ge,me)}))],P=new Set(y);if(I.every(me=>P.has(me)))return k.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(y)),!1;const j=this._rtpCapabilities.recv.videoCodecs.filter(me=>y.some(ge=>{var fe;return $e(fe=me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||"").call(fe,ge)}));if(j.length===0)return k.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(y)),!1;const x=[...new Set(j.map(me=>me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||""))];let M;if(k.debug("updateRemoteCodec, from ".concat(I," to ").concat(x)),v.length===0)M=this.sessionDesc.mediaDescriptions.filter(me=>me.media.mediaType==="video"&&me.attributes.direction==="recvonly");else if(M=this.sessionDesc.mediaDescriptions.filter(me=>me.attributes.mid&&$e(v).call(v,me.attributes.mid)&&me.attributes.direction==="recvonly"),M.length!==v.length)return k.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(y)),!1;if(Q("USE_PUB_RTX")||Q("USE_SUB_RTX")){const me=sL(j,this.rtpCapabilities.recv.videoCodecs);j.push(...me)}this._rtpCapabilities.recv.videoCodecs=j;const $=this.localCapabilities.send,q=this.rtpCapabilities.recv,oe=d0(st.VIDEO,q,$,w);return M.forEach(me=>{const ge=oe.map(fe=>fe.payloadType.toString(10));k.debug("updateRemoteCodec mid: ".concat(me.attributes.mid,", from"),me.attributes.payloads,"to",oe),me.attributes.payloads=oe,me.media.fmts=ge}),!0}createOrRecycleSendMedia(v,y,w,I,P){const j=this.rtpCapabilities.send,x=v===st.VIDEO?j.videoCodecs:j.audioCodecs,M=v===st.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let q={media:{mediaType:v,port:g0,protos:["UDP","TLS","RTP","SAVPF"],fmts:x.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:M,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:x,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};q=this.mungSendMediaDesc(q,P);const oe=this.findFirstClosedMedia(v);if(oe){const me=this.sessionDesc.mediaDescriptions.indexOf(oe);this.sessionDesc.mediaDescriptions[me]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,y,w){const I=Lr(v);return rL(I),zE(I,y),iL(I,y),jG(I),eA(I,w,this.localCapabilities.send),I}mungSendMediaDesc(v,y){const w=Lr(v);return eA(w,y,this.localCapabilities.recv),HE(w),w}updateRecvMedia(v,y){const w=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===v);if(w!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],y);this.sessionDesc.mediaDescriptions[w]=I}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(y=>Nr()?y.media.port==="0"&&y.media.mediaType===v:y.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(y=>{var w;return((w=y.attributes)===null||w===void 0||(w=w.ssrcs[0])===null||w===void 0?void 0:w.ssrcId)===v[0].ssrcId})}getSSRC(v){var y;return(y=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===v))===null||y===void 0?void 0:y.attributes.ssrcs}}(ju(ju({},n),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),n.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=zG(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const f=this.peerConnection.getTransceivers()[0];if(f!=null&&f.receiver&&this.tryBindTransportEvents(f.receiver),Q("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(Q("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const y=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(y)}const{preSSRCs:_}=n;if(Array.isArray(_)&&_.length>0){const{mids:v}=this.remoteSDP.batchSend(_.map(y=>({kind:y.kind,ssrcMsg:[{ssrcId:y.ssrcId,rtx:y.rtx}],mslabel:y.mslabel})));v.forEach((y,w)=>{this.preSSRCMap.set(_[w].ssrcId,y)}),await h0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=n;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=n;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await h0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return qc(function*(){const u=yield fn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=JI();n.forEach(M=>{const $=c.peerConnection.addTransceiver(M._mediaStreamTrack,ju({direction:"sendonly"},M.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));h.push($),M._updateRtpTransceiver($)}),Nr()&&Q("SIMULCAST")===!0&&(yield fn(c.applySimulcastForFirefox(h,n)));const _=yield fn(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(n.length),y=c.mungSendOfferSDP(_.sdp,n,v),w=oa(y),I=v.map(M=>{const $=w.mediaDescriptions.find(q=>q.attributes.mid===M);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return UG($,Q("USE_PUB_RTX"))});let P;try{P=yield I}catch(M){P=[],c.remoteSDP.receive(n,i,o,P);const $=c.remoteSDP.toString();throw yield fn(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield fn(c.stopSending(v,!0)),M}c.remoteSDP.receive(n,i,o,P);const j=c.remoteSDP.toString(),x=c.logSDPExchange(y,"offer","local","send");return yield fn(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield fn(c.applySimulcastEncodings(h,n)),yield fn(c.applySendEncodings(h,n)),x==null||x(j),yield fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:j})),h.map((M,$)=>{const q=v[$];return{localSSRC:I[$],id:q,transceiver:M}})}catch(h){throw h instanceof Ie?h:new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(n);if(o&&o.readyState==="open")k.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:Q("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(n,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),k.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else k.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Ie?o:new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(n){try{const i=this.dataStreamChannelMap.get(n);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(n)}catch(i){throw i instanceof Ie?i:new Ie(Y.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var v;cA(this.id+_.mid,this),_.direction="inactive",(v=_.stop)===null||v===void 0||v.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);h&&(await h0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:u,transceiver:f}}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(n);return o&&(await h0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");n.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[f,_]=h;if(_===u)return this.preSSRCMap.delete(f),!0})}),this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.mute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.unmute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,f)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(n,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return qc(function*(){const o=yield fn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=wn().supportPCSetConfiguration,u=Q("FORCE_TURN_TCP")||i.forceTurn;if(n===ys.RELAY&&!c)return;if(c&&!u){const w=n===ys.RELAY?"relay":"all",I=i.peerConnection.getConfiguration();I.iceTransportPolicy!==w&&(k.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(I.iceTransportPolicy,"] to [").concat(w,"]")),I.iceTransportPolicy=w,i.peerConnection.setConfiguration(I))}i.remoteSDP.updateCandidates(n);const h=yield fn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=jf(h.sdp),{remoteIceParameters:_}=yield f.iceParameters;i.remoteSDP.restartICE(_);const v=i.remoteSDP.toString(),y=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield fn(i.peerConnection.setLocalDescription(h)),y==null||y(v),yield fn(i.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){k.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const n=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(ys.TCP_RELAY),await h0(this.peerConnection,this.remoteSDP,this.extension)}catch(i){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{n()}}close(){var n;this.peerConnection.getTransceivers().forEach(i=>{cA(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return ju(ju({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ie(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?Nr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:ju(ju({},Nd),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:ju(ju({},Nd),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=n=>{if(n&&(n.errorCode||n.errorText)){var i;const o="code: ".concat(n.errorCode,", message: ").concat(n.errorText),c=n.port?"local: ".concat(n.port):"";k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(n.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=n=>{n&&n.target&&"iceGatheringState"in n.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(n.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Q("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&(JT(n.turnServer.servers)?i.iceServers=n.turnServer.servers:Q("NEW_TURN_MODE")&&i.iceServers?(Q("USE_TURN_SERVER_OF_GATEWAY")?n.turnServer.serversFromGateway&&i.iceServers.push(...E_.newTurnServerConfigToIceServers(n.turnServer.serversFromGateway)):i.iceServers.push(...E_.newTurnServerConfigToIceServers(n.turnServer.servers)),Q("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):n.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...E_.turnServerConfigToIceServers(n.turnServer.servers)),Q("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...E_.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),Q("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),Q("ENABLE_ENCODED_TRANSFORM")&&wn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vf(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!Q("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{const c=Q("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vf(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vf(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(M=>M.track===n._mediaStreamTrack)),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wn().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(n._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const f=function(x,M){return x.getTransceivers().find($=>$.sender.track===M||$.receiver.track===M)}(this.peerConnection,n._mediaStreamTrack),_=zue(n);if(rhe(n)&&f&&i&&_&&this.getLocalVideoStats&&$e(o=["vp8","vp9"]).call(o,this.store.codec)){var v;const x=u.degradationPreference||($e(v=n._hints).call(v,er.CUSTOM_TRACK)?Q("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(M,$,q,oe,me,ge){if(cA(M,q),me($),oe!=="balanced"&&oe!=="maintain-framerate"&&oe!=="maintain-resolution")return;let fe=-1;Ez(M,$);const Re=window.setInterval(()=>{const Qe=aA.get(M);if(!Q("ENABLE_AG_ADAPTATION")||!Qe)return cA(M,q),void me($);const rt=ge();if(rt.sendPackets>0&&rt.OutgoingAvailableBandwidth>0){if(fe===-1)return void(fe=Date.now());if(Date.now()-fe<1e3)return;const cn=rt.sendFrameRate,ln=rt.OutgoingAvailableBandwidth,[tr,Jr]=nhe(M,cn,ln,Qe.adaptationConfig,$,oe);Jr&&(q.qualityLimitationReason=Jr),tr&&Qe.adaptationConfig.scale!==tr.scale&&(k.debug("[".concat(M,"] applyAdaptation: ").concat(q.qualityLimitationReason,`
           sendFps `).concat(cn,", bwe ").concat(ln,", switch from ").concat(Qe.adaptationConfig.scale," to ").concat(tr.scale," ")),Qe.adaptationConfig=gL(gL({},Qe.adaptationConfig),tr),me(tr))}},Q("CHECK_LOCAL_STATS_INTERVAL")),Ue=gL({},$);aA.set(M,{timer:Re,adaptationConfig:Ue,originConfig:$,adaptationFunc:me}),k.debug("[".concat(M,"] start adaptation, originConfig: ").concat(JSON.stringify($),", degradationPreference: ").concat(oe))})(this.id+f.mid,_,this,x,M=>{i&&this.updateAdaptation(i,M)},this.getLocalVideoStats.bind(this))}if(n._encoderConfig){var y;const{bitrateMax:x,frameRate:M,scaleResolutionDownBy:$}=n._encoderConfig;x&&(h.maxBitrate=1e3*x),($e(y=n._hints).call(y,er.LOW_STREAM)||n.isUseScaleResolutionDownBy)&&(M&&(h.maxFramerate=Ma(M)),$&&$>=1&&(h.scaleResolutionDownBy=$))}const{maxFramerate:w}=Q("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,w):w),Q("DSCP_TYPE")&&Jh()){var I;const x=Q("DSCP_TYPE");$e(I=["very-low","low","medium","high"]).call(I,x)&&(h.networkPriority=x)}const P=i.getParameters(),j=(c=P.encodings)===null||c===void 0?void 0:c[0];Nr()&&!j&&(u.encodings=[h]),j&&Object.assign(j,h),Object.assign(P,u),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(P.encodings))),await i.setParameters(P),await async function(x,M,$){try{var q;if(!wn().supportSetRtpSenderParameters||!function(Re){return Re==="vp9"||Re==="av1"}(x)||!Q("ENABLE_SVC"))return;const oe={},me={},ge=M.getParameters(),fe=(q=ge.encodings)===null||q===void 0?void 0:q[0];me.scalabilityMode=JI($),fe&&Object.assign(fe,me),Object.assign(ge,oe),await M.setParameters(ge),k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ge.encodings)))}catch(oe){k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",oe)}}(this.store.codec,i,Q("SVC_MODE"))}async updateAdaptation(n,i){var o,c;if(!n)return k.debug("[updateAdaptation] no rtpSender found");if(!wn().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:f,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),f&&(u.maxFramerate=Ma(f)),_&&_>=1&&$e(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const v=n.getParameters(),y=(c=v.encodings)===null||c===void 0?void 0:c[0];y&&Object.assign(y,u),Object.assign(v,{});try{await n.setParameters(v),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(w){!("transport"in n)||n.transport&&n.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(n,i){try{if(!wn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof ur&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=oa(n);return i.forEach((u,h)=>{const f=o[h],_=c.mediaDescriptions.find(v=>v.attributes.mid===f);_&&(zE(_,u),BG(_,u,this.store.codec))}),xf(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,f;const v=n[_],y=i[_];if(y instanceof ur&&!$e(o=y._hints).call(o,er.LOW_STREAM)&&(c=y._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=y._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=y._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=y._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},I={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const P=v.sender.getParameters();await v.sender.setParameters(Object.assign(P,w))}}}async applySimulcastEncodings(n,i){if(!Nr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof ur&&this.isVP8Simulcast(c)){const u=n[o],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof ur&&Q("SIMULCAST")&&this.store.codec==="vp8"&&!$e(i=n._hints).call(i,er.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(Q("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(n){if(wn().supportPCSetConfiguration){const i=E_.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},ct(pn.prototype,"updateRemoteRTPCapabilities",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"updateRemoteRTPCapabilities"),pn.prototype),ct(pn.prototype,"connect",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"connect"),pn.prototype),ct(pn.prototype,"updateRemoteConnect",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"updateRemoteConnect"),pn.prototype),ct(pn.prototype,"createDataChannels",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"createDataChannels"),pn.prototype),ct(pn.prototype,"receive",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"receive"),pn.prototype),ct(pn.prototype,"batchReceive",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"batchReceive"),pn.prototype),ct(pn.prototype,"stopReceiving",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"stopReceiving"),pn.prototype),ct(pn.prototype,"muteRemote",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"muteRemote"),pn.prototype),ct(pn.prototype,"unmuteRemote",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteRemote"),pn.prototype),ct(pn.prototype,"muteLocal",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"muteLocal"),pn.prototype),ct(pn.prototype,"unmuteLocal",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteLocal"),pn.prototype),ct(pn.prototype,"close",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"close"),pn.prototype),ct(pn.prototype,"updateEncoderConfig",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"updateEncoderConfig"),pn.prototype),ct(pn.prototype,"updateSendParameters",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"updateSendParameters"),pn.prototype),ct(pn.prototype,"replaceTrack",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"replaceTrack"),pn.prototype),ct(pn.prototype,"updateAdaptation",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"updateAdaptation"),pn.prototype),ct(pn.prototype,"getRemoteSSRC",[Do],Object.getOwnPropertyDescriptor(pn.prototype,"getRemoteSSRC"),pn.prototype),pn);function Do(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return await o.apply(this,f)}finally{u()}},i}function yL(e,n){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=Ma(n.width),o.height=Ma(n.height);const c=Ma(n.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new be(Y.UNEXPECTED_ERROR,"can not get canvas context");const f=wn(),_=o.captureStream(f.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const y=i.videoWidth,w=i.videoHeight/y,I=o.width*w;Math.abs(I-o.height)>=2&&(k.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(I)),o.height=I)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=N1(()=>o.startCapture&&o.startCapture(),c);const v=_.stop;return _.stop=()=>{v.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),k.debug("clean low stream renderer")},_}var uA=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(uA||{}),ii=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(ii||{}),Jg=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Jg||{}),si=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(si||{}),Qg=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Qg||{}),wz=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(wz||{}),Vd=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Vd||{}),Lo=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Lo||{}),Rz=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(Rz||{}),xo=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(xo||{}),dA=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(dA||{});const Zg=1e3,e_=6,hA=3,ohe=Math.max(e_,hA);function Pt(e,n,i){i!=null&&Number.isFinite(i)&&(e[n]=Math.round(Math.max(0,i)))}function Cz(e){const n={[xo.CONN_TYPE]:0,[xo.RTT]:e.rtt,[xo.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(n[xo.CONN_TYPE]=1),i==="tcp"&&(n[xo.CONN_TYPE]=3),i==="tls"&&(n[xo.CONN_TYPE]=4);break}case"srflx":n[xo.CONN_TYPE]=2;break;case"unknown":n[xo.CONN_TYPE]=5;break;default:n[xo.CONN_TYPE]=0}return n}function Iz(e){let n=0;switch(e){case"none":n=0;break;case"cpu":n=1;break;case"bandwidth":n=2;break;case"other":n=3}return n}class Az extends Rr{constructor(n){super(),G(this,"store",void 0),G(this,"uploadWRTCStatsTimer",void 0),G(this,"uploadOutboundDenoiserStatsTimer",void 0),G(this,"uploadExtStatsTimer",void 0),G(this,"uploadExtUsageStatsTimer",void 0),G(this,"uploadInboundExtStatsTimer",void 0),G(this,"requestStats",void 0),G(this,"requestTransportStats",void 0),G(this,"requestLocalMedia",void 0),G(this,"requestRemoteMedia",void 0),G(this,"requestAllTracks",void 0),G(this,"requestVideoIsReady",void 0),G(this,"requestUploadStats",void 0),G(this,"requestUpload",void 0),G(this,"uploadOutboundStarted",!1),G(this,"uploadInboundStarted",!1),G(this,"uploadTransportStarted",!1),G(this,"uploadBaseStatsStarted",!1),G(this,"uploadExtensionUsageStarted",!1),G(this,"lastRecvStats",void 0),G(this,"lastSendStats",void 0),G(this,"lastRefRecvStats",void 0),G(this,"lastRefSendStats",void 0),G(this,"lastFullRecvStats",void 0),G(this,"lastFullSendStats",void 0),G(this,"needUploadRenderFreezeTime",!0),this.store=n}uploadWRTCStats(n){if(!this.requestStats||!this.requestUploadStats)return;const i=n%hA==0,o=n%e_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const f={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,u,i);v&&(f.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);v&&(f.outbound=[v])}if(this.uploadInboundStarted&&u){const v=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);v&&(f.inbound=v)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(f.misc)?f.misc[0]&&f.misc[0].addition&&(f.misc[0].addition[dA.RTC_PEER_CONNECTION_STATE]=g1[_]):f.misc=[{addition:{[dA.RTC_PEER_CONNECTION_STATE]:g1[_]}}]),this.requestUploadStats(f)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let n=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[dA.RTC_PEER_CONNECTION_STATE]:g1[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(n),++n===ohe+1&&(n=1)},Zg)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(n,i,o){if(!this.requestStats)return;if(!o)return n.rtt==null?void 0:{addition:{[xo.RTT]:n.rtt,[xo.CONN_TYPE]:void 0,[xo.STATS_UPDATE_INTERVAL]:n.updateInterval||void 0}};const c=Cz(n);if(this.store.useP2P){if(i){const u=Cz(i);c[xo.CONN_TYPE]+=u[xo.CONN_TYPE]<<3}c[xo.CONN_TYPE]+=110}else c[xo.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(n,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,f,_;return u.forEach(v=>{let[y,{track:w,ssrcs:I}]=v;switch(y){case Le.LocalVideoLowTrack:case Le.LocalVideoTrack:if(y===Le.LocalVideoTrack){const P=function(M,$,q,oe,me,ge){const fe=$.videoSend.find(rt=>rt.ssrc===M);if(!fe)return;const Re={},{sentFrame:Ue,inputFrame:Qe}=fe;if(ge&&(Pt(Re,ii.QP_SUM,fe.qpSumPerFrame),Qe&&Ue)){const rt=Qe.frameRate,cn=Ue.frameRate;Re[ii.FREEZE]=function(ln,tr){let Jr=!0;return Jr=!(ln<=5)&&(ln<=10?tr<3:ln<=20?tr<4:tr<5),Jr}(rt,cn)?1:0}if(me){switch(Ue&&(Pt(Re,ii.HEIGHT,Ue.height),Pt(Re,ii.WIDTH,Ue.width),Pt(Re,ii.FRAME_RATE,Ue.frameRate)),Re[ii.DISABLED]=oe._originMediaStreamTrack&&!oe._originMediaStreamTrack.enabled||oe._mediaStreamTrack&&!oe._mediaStreamTrack.enabled?1:0,fe.adaptionChangeReason){case"none":Re[ii.ADAPTATION]=0;break;case"cpu":Re[ii.ADAPTATION]=1;break;case"bandwidth":Re[ii.ADAPTATION]=2;break;case"other":Re[ii.ADAPTATION]=3}let rt=0;fe.adaptionChangeReason&&(rt+=Iz(fe.adaptionChangeReason)),$.qualityLimitationReason&&(rt+=Iz($.qualityLimitationReason)<<3),Re[ii.ADAPTATION]=rt,Re[ii.PLAYER_STATUS]=O1[oe._player?oe._player.videoElementStatus:"uninit"],Pt(Re,ii.NACKS,fe.nacksCount),Pt(Re,ii.PLIS,fe.plisCount),Pt(Re,ii.FIRS,fe.firsCount),Pt(Re,ii.AVG_ENCODE,fe.avgEncodeMs),Pt(Re,ii.HUGE_FRAME_SENT,fe.hugeFramesSent),Pt(Re,ii.BYTES_RETRANSMIT,fe.retransmittedBytesSent),Pt(Re,ii.PACKAGES_RETRANSMIT,fe.retransmittedPacketsSent),Pt(Re,ii.KEY_FRAMES_ENCODED,fe.keyFramesEncoded);const cn=q&&q.videoSend.find(ln=>ln.ssrc===M);if(cn){let ln=me?Zg:Zg*e_;cn.timestamp&&fe.timestamp&&(ln=fe.timestamp-cn.timestamp),cn.packets!=null&&fe.packets!=null&&Pt(Re,ii.PACKAGE_RATE,1e3*(fe.packets-cn.packets)/ln),fe.packetsLost!=null&&cn.packetsLost!=null&&Pt(Re,ii.PACKAGE_LOST,fe.packetsLost-cn.packetsLost),cn.bytes!=null&&fe.bytes!=null&&Pt(Re,ii.BITRATE,8*(fe.bytes-cn.bytes)/ln)}}return Re}(I[0].ssrcId,n,i,w,o,c),j=w&&function(M,$,q,oe){const me=$.videoSend.find(fe=>fe.ssrc===M);if(!me)return null;const ge={};if(oe){const fe=me.inputFrame,Re=fe&&fe.height||q.videoHeight||0,Ue=fe&&fe.width||q.videoWidth||0,Qe=fe&&fe.frameRate||0;Pt(ge,uA.HEIGHT,Re),Pt(ge,uA.WIDTH,Ue),Pt(ge,uA.FRAME_RATE,Qe)}return ge}(I[0].ssrcId,n,w,o),x=function(M,$){const q={};return $&&(Pt(q,ii.RETRANSMIT,M.bitrate.retransmit),Pt(q,ii.TARGET_ENCODED,M.bitrate.targetEncoded),Pt(q,ii.ACTUAL_ENCODED,M.bitrate.actualEncoded),Pt(q,ii.TRANSMIT,M.bitrate.transmit),Pt(q,ii.BANDWIDTH,M.sendBandwidth)),q}(n,o);f=Object.assign({},P,j,x)}else _=function(P,j,x,M){const $=j.videoSend.find(oe=>oe.ssrc===P);if(!$)return;const q={};if(M){const oe=$.sentFrame;if(oe&&(Pt(q,Jg.HEIGHT,oe.height),Pt(q,Jg.WIDTH,oe.width),Pt(q,Jg.FRAME_RATE,oe.frameRate)),x){const me=x.videoSend.find(ge=>ge.ssrc===P);if(me){let ge=Zg*e_;me.timestamp&&$.timestamp&&(ge=$.timestamp-me.timestamp),me.packets!=null&&$.packets!=null&&Pt(q,Jg.PACKAGE_RATE,1e3*($.packets-me.packets)/ge),$.packetsLost!=null&&me.packetsLost!=null&&Pt(q,Jg.PACKAGE_LOST,$.packetsLost-me.packetsLost),me.bytes!=null&&$.bytes!=null&&Pt(q,Jg.BITRATE,8*($.bytes-me.bytes)/ge)}}}return q}(I[0].ssrcId,n,i,o);break;case Le.LocalAudioTrack:h=w&&function(P,j,x,M,$){const q=j.audioSend.find(me=>me.ssrc===P);if(!q)return;const oe={};if($){oe[Vd.DISABLED]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0;const me=100*M._source.getAccurateVolumeLevel(),ge=q.inputLevel;if(ge!=null){const Re=Math.ceil(50*Math.log10(100*ge+1));Pt(oe,Vd.LEVEL,Re)}Pt(oe,wz.PCM_LEVEL,me),Pt(oe,Vd.AEC_RETURN_LOSS,q.aecReturnLoss),Pt(oe,Vd.AEC_RETURN_LOSS_ENH,q.aecReturnLossEnhancement),Pt(oe,Vd.BYTES_RETRANSMIT,q.retransmittedBytesSent),Pt(oe,Vd.PACKAGES_RETRANSMIT,q.retransmittedPacketsSent),oe[Vd.FREEZE]=0;const fe=x&&x.audioSend.find(Re=>Re.ssrc===P);if(fe){let Re=Zg*e_;fe.timestamp&&q.timestamp&&(Re=q.timestamp-fe.timestamp),fe.bytes!=null&&q.bytes!=null&&Pt(oe,Vd.BITRATE,8*(q.bytes-fe.bytes)/Re),fe.packets!=null&&q.packets!=null&&Pt(oe,Vd.PACKAGE_RATE,1e3*(q.packets-fe.packets)/Re)}}return oe}(I[0].ssrcId,n,i,w,o)}}),{high:f,low:_,audio:h}}getInboundStats(n,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(f=>{let[_,v]=f;const y={peer:_.uid};if(v.has(st.VIDEO)&&_.videoTrack){const w=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,I=_.videoTrack?function(P,j,x,M,$,q,oe,me){const ge=j.videoRecv.find(ln=>ln.ssrc===P);if(!ge)return;const fe={},{receivedFrame:Re,outputFrame:Ue,decodeFrameRate:Qe}=ge,rt=x&&x.videoRecv.find(ln=>ln.ssrc===P);if(Pt(fe,Qg.FRAME_RATE_DECODE,Qe),ge.framesRateFirefox&&Pt(fe,si.FRAME_RATE,ge.framesRateFirefox),Re&&Pt(fe,si.FRAME_RATE,Re.frameRate),Pt(fe,si.FRAMES_DROPPED,ge.framesDroppedCount),Pt(fe,si.BYTES_RETRANSMIT,ge.retransmittedBytesReceived),Pt(fe,si.PACKAGES_RETRANSMIT,ge.retransmittedPacketsReceived),Pt(fe,si.PACKAGES_DISCARDED,ge.packetsDiscarded),Pt(fe,si.AVG_DECODE,ge.avgDecodeMs),Pt(fe,si.AVG_PROCESSING_DELAY,ge.avgProcessingDelayMs),Pt(fe,si.AVG_ASSEMBLY_TIME,ge.avgFramesAssembledFromMultiplePacketsMs),Pt(fe,si.AVG_INTER_FRAME_DELAY,ge.avgInterFrameDelayMs),Pt(fe,si.KEY_FRAMES_DECODED,ge.keyFramesDecoded),rt){const ln=j.timestamp-x.timestamp||Zg*(me?e_:oe?hA:1);ge.packetsLost!=null&&rt.packetsLost!=null&&Pt(fe,si.PACKAGE_LOST,ge.packetsLost-rt.packetsLost),rt.bytes!=null&&ge.bytes!=null&&Pt(fe,si.BITRATE,8*(ge.bytes-rt.bytes)/ln),rt.packets!=null&&ge.packets!=null&&Pt(fe,si.PACKAGE_RATE,1e3*(ge.packets-rt.packets)/ln)}if(me&&(Pt(fe,si.QP_SUM,ge.qpSumPerFrame),fe[si.FREEZE]=$&&m0.isRemoteVideoFreeze(M,ge,rt)?1:0),oe){var cn;Re?(Pt(fe,si.HEIGHT,Re.height),Pt(fe,si.WIDTH,Re.width)):M&&(Pt(fe,si.HEIGHT,M._videoHeight||0),Pt(fe,si.WIDTH,M._videoWidth||0)),Ue&&Pt(fe,Qg.FRAME_RATE_OUTPUT,Ue.frameRate);const ln=(cn=M._player)===null||cn===void 0?void 0:cn.rendFrameRate.toFixed(0);if(ln&&Pt(fe,Qg.FRAME_RATE_RENDER,+ln),Pt(fe,si.JITTER_BUFFER,ge.jitterBufferMs),Pt(fe,si.CURRENT_DELAY,ge.currentDelayMs),Pt(fe,si.FIRS,ge.firsCount),Pt(fe,si.NACKS,ge.nacksCount),Pt(fe,si.PLIS,ge.plisCount),M){fe[si.DISABLED]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1;const tr=M._player;if(tr){const{freezeTimeCounterList:Jr,renderFreezeAccTime:Fr,videoElementStatus:Uo}=tr;if(Jr&&Jr.length>0&&Pt(fe,Qg.FREEZE_TIME,Jr.splice(0,1)[0]),q&&ep.visibility==="visible"&&Uo===Gs.PLAYING&&wn().supportRequestVideoFrameCallback){const Pe=Math.min(6e3,Fr);tr.renderFreezeAccTime=Math.max(0,Fr-Pe),Pt(fe,Qg.FREEZE_TIME_RENDER,Pe)}if(typeof ge.totalFreezesDuration=="number"){const Pe=rt&&rt.totalFreezesDuration?ge.totalFreezesDuration-rt.totalFreezesDuration:ge.totalFreezesDuration;Pt(fe,Qg.FREEZE_DURATION,1e3*Pe)}}}if(fe[si.PLAYER_STATUS]=O1[M._player?M._player.videoElementStatus:"uninit"],rt&&ge.totalInterFrameDelay!==void 0&&ge.totalSquaredInterFrameDelay!==void 0&&rt.totalInterFrameDelay!==void 0&&rt.totalSquaredInterFrameDelay!==void 0){const tr=ge.totalInterFrameDelay-rt.totalInterFrameDelay,Jr=ge.totalSquaredInterFrameDelay-rt.totalSquaredInterFrameDelay,Fr=ge.framesDecodeCount-rt.framesDecodeCount,Uo=tr/Fr*1e3,Pe=Math.round(1e3*Math.sqrt((Jr-Math.pow(tr,2)/Fr)/Fr));!isNaN(Pe)&&Uo+Pe>Math.max(3*Uo,Uo+150)&&(fe[si.I_FRAME_DELAY]=Pe)}}return fe}(_._videoSSRC,n,i,_.videoTrack,w===!0,this.needUploadRenderFreezeTime,o,c):void 0;I&&(y.video=I)}if(v.has(st.AUDIO)&&_.audioTrack){const w=_.audioTrack?function(I,P,j,x,M,$){const q=P.audioRecv.find(fe=>fe.ssrc===I);if(!q)return;const oe={},me=j&&j.audioRecv.find(fe=>fe.ssrc===I);if(Pt(oe,Lo.JITTER,q.jitterMs),Pt(oe,Lo.BYTES_RETRANSMIT,q.retransmittedBytesReceived),Pt(oe,Lo.PACKAGES_RETRANSMIT,q.retransmittedPacketsReceived),Pt(oe,Lo.PACKAGES_DISCARDED,q.packetsDiscarded),Pt(oe,Lo.AVG_PROCESSING_DELAY,q.avgProcessingDelayMs),me){const fe=P.timestamp-j.timestamp||Zg*($?e_:M?hA:1);q.packets!=null&&me.packets!=null&&Pt(oe,Lo.PACKAGE_RATE,1e3*(q.packets-me.packets)/fe),M&&me.bytes!=null&&q.bytes!=null&&Pt(oe,Lo.BITRATE,8*(q.bytes-me.bytes)/fe),q.packetsLost!=null&&me.packetsLost!=null&&Pt(oe,Lo.PACKAGE_LOST,q.packetsLost-me.packetsLost)}if($){const{receivedFrames:fe,droppedFrames:Re}=q;fe!=null&&Re!=null&&(oe[Lo.FREEZE]=(ge=fe)===0||100*Re/ge>20?1:0)}var ge;if(M){const fe=100*x._source.getAccurateVolumeLevel(),Re=q.outputLevel;if(Re!=null){const Ue=Math.ceil(50*Math.log10(100*Re+1));Pt(oe,Rz.LEVEL,Ue)}if(Pt(oe,Lo.PCM_LEVEL,fe),x&&(oe[Lo.DISABLED]=x._originMediaStreamTrack.enabled&&x._mediaStreamTrack.enabled?0:1),Pt(oe,Lo.JITTER_BUFFER,q.jitterBufferMs),Pt(oe,Lo.CURRENT_DELAY,q.jitterBufferMs),oe[Lo.PLAYER_STATUS]=O1[ko.getPlayerState(x.getTrackId())],me){const Ue=q.concealedSamples-me.concealedSamples;Ue>0&&Pt(oe,Lo.CONCEALED_SAMPLES,Ue);const Qe=q.totalSamplesReceived-me.totalSamplesReceived;Qe>0&&Pt(oe,Lo.TOTAL_SAMPLES_RECEIVED,Qe)}}return oe}(_._audioSSRC,n,i,_.audioTrack,o,c):void 0;w&&(y.audio=w)}(y.video||y.audio)&&h.push(y)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const n=(this.requestAllTracks()||[]).find(i=>i instanceof xI);if(n&&n._external.getDenoiserStats){const i=n._external.getDenoiserStats();i&&this.requestUpload(s0.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(n=>{n.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(n=>{let[i,o]=n;o.has(st.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(st.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const n=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:Q("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,y]of h)y.has(st.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),y.has(st.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(v,y){const w={};for(const{id:x,value:M,level:$,direction:q}of v){var I;const oe=(I=y.get(x))!==null&&I!==void 0?I:0,me=M===2?oe+Q("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:oe;var P,j;y.set(x,me),w[x]?(M===2&&(w[x].value=M),$>w[x].level&&(w[x].level=$),q==="remote"&&(w[x].remoteUidCount+=1),w[x].totalTs=(P=y.get(x))!==null&&P!==void 0?P:0):w[x]={value:M,level:$,remoteUidCount:q==="local"?0:1,totalTs:(j=y.get(x))!==null&&j!==void 0?j:0}}return Object.keys(w).map(x=>{const{level:M,value:$,totalTs:q}=w[x];return{id:x,level:M,value:$,totalTs:q}})}(c,n);const f=Date.now(),_=f>i?f:i+1;this.requestUpload&&this.requestUpload(s0.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},Q("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const ahe=Q("ICE_RESTART_INTERVAL");let pA=new Map,YE=new Map,Gf=[ys.UDP_TCP_RELAY,ys.TCP_RELAY,ys.RELAY],SL=Q("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&wn().supportPCSetConfiguration;function Oz(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=pA.get(e.id);i&&(window.clearTimeout(i),pA.delete(e.id));const o=YE.get(e.id);n&&o&&o.index===Gf.length-1&&(k.debug("[".concat(e.id,"] reset ICE restart policy")),YE.delete(e.id))}function Pz(e,n,i){if(pA.size===0&&YE.size===0&&(Array.isArray(Q("RESTART_SEQUENCE"))&&Q("RESTART_SEQUENCE").length>0&&!function(f,_){if(f.length!==_.length)return!1;for(let v=0;v<f.length;v+=1){const y=f[v];if(f.filter(w=>w===y).length!==_.filter(w=>w===y).length)return!1}return!0}(Gf,Q("RESTART_SEQUENCE"))&&(Gf=Q("RESTART_SEQUENCE").filter(f=>{var _;if($e(_=Object.values(ys)).call(_,f))return!0}),k.debug("use reconnection policy from config distribution, queues: ".concat(Gf.join(" => ")))),SL=Q("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&wn().supportPCSetConfiguration),Gf.length===0)return void i();let o,{index:c=0,type:u}=YE.get(e.id)||{};if(SL&&u===ys.RELAY)return void i();let h=u&&c>=Gf.length-1;if(SL)u=ys.RELAY;else{if(h)return void i();u?(c++,u=Gf[c]):(u=Gf[0],c=0)}k.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),n(u),YE.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>Pz(e,n,i),ahe),pA.set(e.id,o)}var Zt;function Nz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Fd(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Nz(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Nz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function kz(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=HD,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new fA(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function fA(e){function n(i){if(Object(i)!==i)return Je.reject(new TypeError(i+" is not an object."));var o=i.done;return Je.resolve(i.value).then(function(c){return{value:c,done:o}})}return fA=function(i){this.s=i,this.n=i.next},fA.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?Je.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?Je.reject(i):n(o.apply(this.s,arguments))}},new fA(e)}let _0=(Zt=class extends Rr{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(Rt.StateChange,n,this._state)}constructor(e,n){super(),G(this,"isPlanB",void 0),G(this,"store",void 0),G(this,"statsUploader",void 0),G(this,"connection",void 0),G(this,"localTrackMap",new Map),G(this,"remoteUserMap",new Map),G(this,"localDataChannels",[]),G(this,"remoteDataChannelMap",new Map),G(this,"pendingLocalTracks",[]),G(this,"pendingRemoteTracks",[]),G(this,"pendingLocalDataChannels",[]),G(this,"pendingRemoteDataChannels",[]),G(this,"statsCollector",void 0),G(this,"shouldForwardP2PCreation",void 0),G(this,"iceFailedCount",0),G(this,"dtlsFailedCount",0),G(this,"mutex",void 0),G(this,"_state",xn.Disconnected),G(this,"_pcStatsUploadType",Q("NEW_ICE_RESTART")?ip.FIRST_CONNECTION:ip.OLD_FIRST_CONNECTION),G(this,"_isStartRestartIce",!1),G(this,"_restartTimer",void 0),G(this,"_isTryConnecting",!1),G(this,"_iceError",null),G(this,"_forceTurn",!1),G(this,"_isWaitPcToRePub",!1),G(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==xn.Connected)return void c(new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const f=h.find(v=>v[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:y}]=v;return y}));const _=this.createMuteMessage(h);await Qn(this,Rt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),G(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==xn.Connected)return void c(new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const f=h.find(v=>v[0]==="videoLowTrack");if(f){const v=f[1];if(v.track._originMediaStreamTrack.stop(),!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&wn().supportDualStreamEncoding){const y=i._mediaStreamTrack.clone();v.track._mediaStreamTrack=y,v.track._originMediaStreamTrack=y}else{const y=yL(i,QT(this,Rt.RequestLowStreamParameter));v.track._mediaStreamTrack=y,v.track._originMediaStreamTrack=y}await new Je((y,w)=>{this.handleReplaceTrack(v.track,y,w,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:y}]=v;return y}));const _=this.createUnmuteMessage(h);await Qn(this,Rt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),G(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==xn.Connected)return void o();const{id:v,track:y}=_;await this.connection.updateSendParameters(v,y),await this.connection.updateEncoderConfig(v,y),this.emit(Rt.UpdateVideoEncoder,y),o()}catch(_){c(_)}finally{var f;(f=h)===null||f===void 0||f()}}),G(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==xn.Connected)return void o();const{id:f,track:_}=h;await this.connection.updateSendParameters(f,_),o()}catch(h){c(h)}finally{u()}}),G(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==xn.Connected)return void o();const h=vL([i]);let f;k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(f=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(v){c(v)}finally{var _;(_=f)===null||_===void 0||_()}}),G(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(y=>{let[,{track:w}]=y;return i===w});if(!this.connection||!v||this.state!==xn.Connected)return void o();if(await((f=this.connection)===null||f===void 0?void 0:f.replaceTrack(i,v[1].id)),this.isPlanB){const y=v[1];y.id=i._mediaStreamTrack.id,this.localTrackMap.set(v[0],y)}if(v[0]===Le.LocalVideoTrack&&!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&wn().supportDualStreamEncoding){const y=this.localTrackMap.get(Le.LocalVideoLowTrack);if(y){const w=i._mediaStreamTrack.clone();y.track._originMediaStreamTrack.stop(),y.track._mediaStreamTrack=w,y.track._originMediaStreamTrack=w,await new Je((I,P)=>{this.handleReplaceTrack(y.track,I,P,!0)})}}o()}catch(v){c(v)}finally{var _;(_=h)===null||_===void 0||_()}}),G(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),G(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),G(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),G(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),G(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new Az(this.store),this.bindStatsUploaderEvents(),this.mutex=new vs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!wn().supportUnifiedPlan||Q("CHROME_FORCE_PLAN_B")&&Jh(),this.shouldForwardP2PCreation=Q("FORWARD_P2P_CREATION")&&wn().supportPCSetConfiguration&&r1(),this.shouldForwardP2PCreation&&(this.connection=lA(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var n;this.state=xn.New,this._forceTurn=Tz(e),k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=lA(this.store,e),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Q("NEW_ICE_RESTART")?ip.FIRST_CONNECTION:ip.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");Q("ENABLE_PREALLOC_PC")&&this.state===xn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=xn.Connected)}updateRemoteRTPCapabilities(e){const n=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return $e(u=[Le.LocalVideoLowTrack,Le.LocalVideoTrack]).call(u,h)}),i=n.map(c=>{let[,{id:u}]=c;return u}),o=n.map(c=>{let[u]=c;return u});if(this.connection instanceof Ud){if(ht.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!$e(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>$e(e).call(e,u));c&&(this.store.codec=c,k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ud&&this.connection.peerConnectionState!=="closed"&&$e(e=[xn.New,xn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==xn.Connected){if(this.state===xn.Disconnected)throw new Ie(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;$e(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const n=this.filterTobePublishedDataChannels(e);return n.length===0?[]:(n.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,n),n.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,n,i){var o=this;return qc(function*(){const c=yield fn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&$e(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==xn.Connected||h){if(o.state===xn.Disconnected)throw new Ie(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Ss.markPublishStart(o.store.clientId,o.store.pubId);const f=o.filterTobePublishedTracks(e,n,i);if(f.length===0)return void(yield fn(o.tryToUnmuteAudio(e)));yield*cI(kz(o.doPublish(o.connection,f)))}finally{c()}})()}doPublish(e,n){var i=this;return qc(function*(){n.forEach(I=>{let{track:P,type:j}=I;const x=Date.now();i.store.publish(P.getTrackId(),j===Le.LocalAudioTrack?"audio":"video",x)}),i.bindLocalTrackEvents(n);const o=n.map(I=>{let{track:P}=I;return P}),c=yield fn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield fn(c.next())).value,h=i.createGatewayPublishMessage(n,u);let f;try{f=yield h}catch(I){throw c.throw(I),(I==null?void 0:I.code)===Y.WS_ABORT&&n.forEach(P=>{let{track:j}=P;i.pendingLocalTracks.indexOf(j)===-1&&i.pendingLocalTracks.push(j)}),i.unbindLocalTrackEvents(n),I}const _=i.mapPubResToRemoteConfig(h,f,o),v=(yield fn(c.next(_))).value;if(i.state===xn.Disconnected)throw new Ie(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Q("ENABLE_VIDEO_SEI");const y=Q("ENABLE_ENCODED_TRANSFORM"),w=Q("ENABLE_AUDIO_METADATA");o.forEach(async I=>{const P=I.getRTCRtpTransceiver();if(!P||!y)return;const{interceptLocalVideoFrame:j,interceptLocalAudioFrame:x}=nA();I.trackMediaType===st.VIDEO?await j(P.sender,I):I.trackMediaType===st.AUDIO&&await x(P.sender,{metadata:w?()=>{const M=I.metadata.shift();return M&&M.value}:void 0})}),n.forEach(I=>{let{type:P}=I;i.statsCollector.addLocalStats(P)}),i.assignLocalTracks(n,v),i.statsUploader.startUploadOutboundStats(),n.forEach(I=>{let{track:P,type:j}=I;const x=Date.now();i.store.publish(P.getTrackId(),j===Le.LocalAudioTrack?"audio":"video",void 0,x)})})()}async updateVideoStreamParameter(e,n){const i=this.localTrackMap.get(n);if(!i||!this.connection)return;if(!(i.track instanceof ur))return k.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const f={};return u.height&&u.width&&(f.scaleResolutionDownBy=nL(u,h)),f.maxFramerate=u.framerate?Ma(u.framerate):void 0,f.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,f}(e,o);if(o._encoderConfig||(o._encoderConfig={}),n!==Le.LocalVideoLowTrack||!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&wn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return k.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,f){const _=h.canvas;f.width&&(_.width=Ma(f.width)),f.height&&(_.height=Ma(f.height)),f.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=N1(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},Ma(f.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),k.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var n=this;return qc(function*(){if(!n.connection||n.state!==xn.Connected)return;const i=yield fn(n.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=n.localTrackMap.get(Le.LocalVideoTrack);if(!c)throw new Ie(Y.UNEXPECTED_ERROR,"Could not find high stream");if(n.localTrackMap.has(Le.LocalVideoLowTrack))throw new Ie(Y.UNEXPECTED_ERROR,"[".concat(n.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:n.getLowVideoTrack(c.track,e),type:Le.LocalVideoLowTrack}];if(yield*cI(kz(n.doPublish(n.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=n.localTrackMap.get(Le.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield fn(n.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ls(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(k.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ls(this,Rt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let n=this.pendingRemoteTracks.length-1;n>=0;n--){const{user:i,kind:o}=this.pendingRemoteTracks[n];(o!==st.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==st.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1)}if(e)await ls(this,Rt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:n,kind:i}of this.pendingRemoteTracks)await this.subscribe(n,i,i===st.VIDEO?n._videoSSRC:n._audioSSRC);this.pendingRemoteTracks.forEach(n=>{let{user:i}=n;this.emit(Rt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==xn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,n)}async unpublishDataChannel(e){if(!this.connection||this.state!==xn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const n=this.filterTobeUnpublishedDataChannels(e);return n.length!==0?(n.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),n.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==xn.Connected)return;const e=this.localTrackMap.get(Le.LocalVideoLowTrack);if(!e)return;e.track.close();const n=[[Le.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,n)}async doUnpublish(e,n){const i=this.createGatewayUnpublishMessage(n);return await e.stopSending(n.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),n.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,n){if(!this.connection||this.state!==xn.Connected)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=n.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:f,id:_}=h;return f.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,n,i,o,c){var u;if(!this.connection||this.state!==xn.Connected)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(n))return;let h,f,_;const v=this.connection.getPreMedia(i);if(v)k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=v.transceiver,h=v.track,f=v.id;else if(c){const I=c.find(j=>{let{stream_type:x}=j;return x===n});if(!I)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));const P=await this.connection.receive(n,I.ssrcs,String(e._uintid),I.attributes);this.connection instanceof Ud&&(_=P.transceiver),h=P.track,f=P.id}else{const I=await this.connection.receive(n,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof Ud&&(_=I.transceiver),h=I.track,f=I.id}if(n===st.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new ME(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new xE(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&Q("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:P}=nA();n==st.VIDEO?await I(_.receiver,{onSei:Q("ENABLE_VIDEO_SEI")&&(j=>{var x;return(x=e._videoTrack)===null||x===void 0?void 0:x._onSei(j)})}):n==st.AUDIO&&await P(_.receiver,{enableTopn:!!Q("ENABLE_AUDIO_TOPN"),enableMetadata:!!Q("ENABLE_AUDIO_METADATA"),onMetadata:j=>{this.safeEmit(Rt.AudioMetadata,j)}})}const y=this.remoteUserMap.get(e);y?y.set(n,f):this.remoteUserMap.set(e,new Map([[n,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(I=>{let{user:P,kind:j}=I;return P.uid===e.uid&&n===j});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(Rt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==xn.Connected)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:f}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(f))});const n=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):n.push(c)});const o=await this.connection.batchReceive(n.map(c=>{let{user:u,mediaType:h,ssrcId:f,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:f,rtx:_}],mslabel:String(u._uintid)}}));n.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const f=i.get(h);if(!f)return void k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:v,transceiver:y}=f;if(y&&Q("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:j}=nA();u==st.VIDEO?await P(y.receiver,{onSei:Q("ENABLE_VIDEO_SEI")&&(x=>{var M;return(M=c._videoTrack)===null||M===void 0?void 0:M._onSei(x)})}):u==st.AUDIO&&await j(y.receiver,{enableTopn:!!Q("ENABLE_AUDIO_TOPN"),enableMetadata:!!Q("ENABLE_AUDIO_METADATA"),onMetadata:x=>{this.safeEmit(Rt.AudioMetadata,x)}})}if(u===st.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new ME(_,c.uid,c._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),y&&c._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new xE(_,c.uid,c._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),y&&c._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(c,c._videoTrack)),Q("ENABLE_VIDEO_SEI")&&y){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:j}=nA();u==st.VIDEO?await P(y.receiver,{onSei:x=>{var M;(M=c._videoTrack)===null||M===void 0||M._onSei(x)}}):u==st.AUDIO&&await j(y.receiver)}const w=this.remoteUserMap.get(c);w?w.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const I=this.pendingRemoteTracks.findIndex(P=>{let{user:j,kind:x}=P;return j.uid===c.uid&&u===x});I!==-1&&(this.pendingRemoteTracks.splice(I,1),this.emit(Rt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:f,kind:_}=h;return n!==void 0?f.uid===e.uid&&n===_:f.uid===e.uid});if(o.forEach(h=>{const f=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(f,1)}),this.connection&&this.state===xn.Connected||i||o.forEach(h=>{let{kind:f}=h;var _;if(f===st.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(f===st.VIDEO){var v;(v=e._videoTrack)===null||v===void 0||v._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==xn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,n);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:f}]=h;return f}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[f,{kind:_}]=h;var v,y;if(_===st.VIDEO&&f._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),_===st.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),i||((y=f._videoTrack)===null||y===void 0||y._destroy(),f._videoTrack=void 0);else if(_===st.AUDIO){var w;this.unbindRemoteTrackEvents(f._audioTrack),!i&&((w=f._audioTrack)===null||w===void 0||w._destroy(),f._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,n){if(n.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,n);if(i.length===0)return;n.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let n=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(f=>{let{user:_,kind:v}=f;return u!==void 0?_.uid===c.uid&&u===v:_.uid===c.uid});h.forEach(f=>{const _=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(_,1)}),n=n.concat(h)}if(!this.connection||this.state!==xn.Connected)return void n.forEach(c=>{let{user:u,kind:h}=c;var f;if(h===st.AUDIO)(f=u._audioTrack)===null||f===void 0||f._destroy(),u._audioTrack=void 0;else if(h===st.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=Ia(e).call(e,(c,u)=>{let{user:h,mediaType:f}=u;const _=this.filterTobeUnSubscribedTracks(h,f);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var f,_;if(h===st.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===st.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===st.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==xn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===st.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}addAudioMetadata(e){const n=this.localTrackMap.get(Le.LocalAudioTrack),i=n&&n.track;i&&i.metadata.push(e)}getAllTracks(e){const n=this.localTrackMap.get(Le.LocalAudioTrack);if((n==null?void 0:n.track)instanceof Ei){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Le.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Le.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Le.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get(Le.LocalAudioTrack),f=o?this.localTrackMap.get(Le.LocalVideoLowTrack):this.localTrackMap.get(Le.LocalVideoTrack);ht.publish(this.store.sessionId,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(er.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Vr),f=o?(u=this.localTrackMap.get(Le.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof ur);ht.publish(this.store.sessionId,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(er.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===st.VIDEO?i._videoSSRC:i._audioSSRC;c&&ht.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===st.VIDEO,audio:o===st.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ss.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new vs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=lA(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ei){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=xn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.connection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof ur||n&&n.track instanceof Vr?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(pc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(Le.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=xT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=xn.Reconnecting,Q("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=lA(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case Le.LocalVideoTrack:$e(n=o._hints).call(n,er.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Le.LocalAudioTrack:o instanceof Ei?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Le.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(pc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(Rt.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[n,i]=e;Array.from(pc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(n,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,n){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof Wf?e.uid:e)===o.uid&&c===n)return!0}return!1}setPendingRemoteDataChannel(e,n){this.hasPendingRemoteDataChannel(e,n)||this.pendingRemoteDataChannels.push({user:e,id:n})}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Wf?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}restartICE(e){var n=this;return qc(function*(){if(!n.connection||n.state!==xn.Connected)return;const i=yield fn(n.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield fn(n.connection.restartICE(e));const u=yield fn(o.next());if(u.done)return;const h=u.value,f=yield h;switch(EL(n.connection)&&n.reportPCStats(Date.now(),!1,n._pcStatsUploadType),e){case ys.UDP_TCP_RELAY:n._pcStatsUploadType=ip.UDP_TCP_RESTART;break;case ys.TCP_RELAY:n._pcStatsUploadType=ip.TCP_RESTART;break;case ys.RELAY:n._pcStatsUploadType=ip.RELAY_RESTART;break;default:n._pcStatsUploadType=ip.OLD_RESTART}n._isTryConnecting=!0,o.next(f)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),n=this.localTrackMap.get(Le.LocalVideoTrack),i=this.localTrackMap.get(Le.LocalAudioTrack),o=e.videoSend.find(P=>P.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId)),c=e.audioSend.find(P=>P.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=dc(this,Rt.NeedSignalRTT),h=o?o.rttMs:void 0,f=c?c.rttMs:void 0,_=h&&f?(h+f)/2:h||f,v=(_&&u?(_+u)/2:_||u)||0,y=100*e.sendPacketLossRate*.7/50+.3*v/1500,w=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,I=n==null?void 0:n.track;if(I&&I._encoderConfig&&I._hints.indexOf(er.SCREEN_TRACK)===-1){const P=I._encoderConfig.bitrateMax,j=e.bitrate.actualEncoded;if(P&&j){const x=(1e3*P-j)/(1e3*P);return hG[x<.15?0:x<.3?1:x<.45?2:x<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(j=>j.ssrc===c),f=e.videoRecv.find(j=>j.ssrc===u);if(!h&&!f)return void(n+=1);const _=dc(this,Rt.NeedSignalRTT),v=e.rtt,y=(v&&_?(v+_)/2:v||_)||0,w=h?h.jitterMs:void 0,I=e.recvPacketLossRate;let P=.7*I*100/50+.3*y/1500;w&&(P=.6*I*100/50+.2*y/1500+.2*w/400),n+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new Je((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}async replaceTrack(e,n){var i;if(k.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(n.getTrackId(),"]")),!this.connection||this.state!==xn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==n&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:n,type:c}]),o[1].track=n),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(n,o[1].id)),this.isPlanB){const u=o[1];u.id=n._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Le.LocalVideoTrack&&!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&wn().supportDualStreamEncoding){const u=this.localTrackMap.get(Le.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new Je((f,_)=>{this.handleReplaceTrack(u.track,f,_,!0)})}}}filterTobePublishedTracks(e,n,i){const o=[],c=this.getAllTracks();e=TE(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const f=this.localTrackMap.get(Le.LocalAudioTrack);for(const _ of e){if(_ instanceof ur&&(this.localTrackMap.has(Le.LocalVideoTrack)||h?new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Le.LocalVideoTrack}),h=!0),n)){const v=this.getLowVideoTrack(_,i);o.push({track:v,type:Le.LocalVideoLowTrack})}if(_ instanceof Vr)if(f){const v=f.track;if(v instanceof Ei)_L([_]),v.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const y=vL([v,_]);k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(y.getTrackId(),"]")),this.replaceTrack(v,y)}}else u instanceof Ei?(_L([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&wn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=vL(u?[_,u]:[_]):u=_}return u&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Le.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=TE(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Vr){const c=this.localTrackMap.get(Le.LocalAudioTrack);if(!c)continue;c.track instanceof Ei?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([Le.LocalAudioTrack,c]),c.track.close())):n.push([Le.LocalAudioTrack,c])}if(o instanceof ur){const c=this.localTrackMap.get(Le.LocalVideoTrack);if(!c)continue;n.push([Le.LocalVideoTrack,c]);const u=this.localTrackMap.get(Le.LocalVideoLowTrack);u&&n.push([Le.LocalVideoLowTrack,u])}}return n}filterTobePublishedDataChannels(e){return e=(e=TE(e)).filter(n=>this.localDataChannels.findIndex(i=>i.id===n.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=TE(e)).filter(n=>this.localDataChannels.indexOf(n)!==-1)).filter(n=>n._originDataChannel)}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Le.LocalVideoTrack:i.addListener(at.GET_STATS,this.handleGetLocalVideoStats),i.addListener(at.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(at.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(at.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(at.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof Ei?e.trackList.forEach(i=>{i.addListener(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(at.GET_STATS,this.handleGetLocalAudioStats),i.addListener(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(at.GET_STATS,this.handleGetLocalAudioStats),e.addListener(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||(e.addListener(at.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(at.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Le.LocalVideoTrack:i.off(at.GET_STATS,this.handleGetLocalVideoStats),i.off(at.GET_RTC_STATS,this.handleGetRTCStats),i.off(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(at.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(at.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(at.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ei?e.trackList.forEach(n=>{n.off(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(at.GET_STATS,this.handleGetLocalAudioStats),n.off(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(at.GET_STATS,this.handleGetLocalAudioStats),e.off(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(at.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(at.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof xE&&n.addListener(at.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof ME&&n.addListener(at.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(at.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(st.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(st.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,h,{track:f,type:_}=i;switch(_){case Le.LocalAudioTrack:u=jn.Audio,h={dtx:f instanceof xI&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Le.LocalVideoTrack:u=$e(c=f._hints).call(c,er.SCREEN_TRACK)?jn.Screen:jn.High,h=Fd(Fd({},PG(f)),{},{codec:this.store.codec,svc_mode:JI()});break;case Le.LocalVideoLowTrack:u=jn.Low,h=Fd(Fd({},PG(f)),{},{codec:this.store.codec,svc_mode:JI()})}return{stream_type:u,attributes:h,ssrcs:n[o]}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Le.LocalVideoTrack:o=$e(i=u._hints).call(i,er.SCREEN_TRACK)?jn.Screen:jn.High;break;case Le.LocalAudioTrack:o=jn.Audio;break;case Le.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:f}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{if(k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(n,")")),this.emit(Rt.PeerConnectionStateChange,n),n==="connecting"&&e instanceof Ud&&!Nr()&&Q("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{n==="connecting"&&e.extendCandidate()},Q("FIRST_TCP_CANDIDATE_INTERVAL")),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ud&&Oz(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=ip.DISCONNECTED_OR_FAILED,dc(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));ht.reportApiInvoke(this.store.sessionId,{name:hi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:Dr.TRACER}).onSuccess(),this.republish()}if(Q("NEW_ICE_RESTART")&&e instanceof Ud&&!Nr()&&!this._forceTurn){if($e(bG).call(bG,n)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{EL(e)&&(k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),dc(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE,c))},o=()=>{EL(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),k.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{Pz(e,i,o)},800))}}else{if(n==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Q("ICE_RESTART")&&dc(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);n==="failed"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),ht.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:Dr.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(pc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(PE.FIRST_FRAME_DECODED),ht.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_DECODE,Er.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(pc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&ht.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_RECEIVED,Er.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(pc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&ht.firstRemoteFrame(this.store.sessionId,Oi.FIRST_VIDEO_RECEIVED,Er.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(Rt.ConnectionTypeChange,o),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ff(i))," -> ").concat(JSON.stringify(Ff(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ff(i))," -> ").concat(JSON.stringify(Ff(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const n=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Fd(Fd({},n),i)},e.onICECandidateError=n=>{this._iceError=n}}resetConnection(e){e instanceof Ud&&function(n){YE.delete(n.id),Oz(n)}(e),e.close(),this.emit(Rt.PeerConnectionStateChange,"closed"),function(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof Vr&&(i==null?void 0:i.track)instanceof Ei)return i.track.isActive||n.push([Le.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===Le.LocalVideoTrack)){const c=this.localTrackMap.get(Le.LocalVideoLowTrack);c&&n.push([Le.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof Vr&&(i==null?void 0:i.track)instanceof Ei)return i.track.isActive&&n.push([Le.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Le.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get(Le.LocalVideoLowTrack);c&&n.push([Le.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Le.LocalAudioTrack:o=jn.Audio;break;case Le.LocalVideoTrack:o=$e(i=u._hints).call(i,er.SCREEN_TRACK)?jn.Screen:jn.High;break;case Le.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:f}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Le.LocalAudioTrack:o=jn.Audio;break;case Le.LocalVideoTrack:o=$e(i=u._hints).call(i,er.SCREEN_TRACK)?jn.Screen:jn.High;break;case Le.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,n){const i=[];return n.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case st.VIDEO:return void(o._videoSSRC&&n.push({stream_type:st.VIDEO,ssrcId:o._videoSSRC}));case st.AUDIO:return void(o._audioSSRC&&n.push({stream_type:st.AUDIO,ssrcId:o._audioSSRC}))}}),n}createUnsubscribeAllMessage(e){const n=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(n.has(o)){let u=n.get(o);c===st.VIDEO?u|=Pi.Video:u|=Pi.Audio,n.set(o,u)}else c===st.VIDEO?n.set(o,Pi.Video):n.set(o,Pi.Audio)}),{users:Array.from(n.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(Le.LocalVideoTrack),i=this.localTrackMap.get(Le.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new Je((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Je((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,n,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const f=(u=n.find(_=>{let{stream_type:v}=_;return h===v}))===null||u===void 0?void 0:u.attributes;if(f&&Q("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;($e(_).call(_,er.SCREEN_TRACK)||$e(_).call(_,er.SCREEN_LOW_TRACK))&&(f.remb=!1,k.debug("disable remb for screen share, hints:",_))}return f})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Vr){var n;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((n=this.connection)===null||n===void 0?void 0:n.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await Qn(this,Rt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.connection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(Rt.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(Rt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await qi(d1(this.dtlsFailedCount,pi)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),n.length>0&&await ls(this,Rt.RequestUnpublishForReconnectPC,n),this.disconnectForReconnect(),this.emit(Rt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ur)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof ur).length>1)throw new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Vr).length>1&&(e.some(n=>n instanceof Vr&&n._bypassWebAudio)||!wn().webAudioMediaStreamDest))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof ur&&this.pendingLocalTracks.some(i=>i instanceof ur))throw new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Vr&&this.pendingLocalTracks.some(i=>i instanceof Vr)&&(!wn().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Vr&&i._bypassWebAudio)))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){var i;const o=!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&wn().supportDualStreamEncoding,c=Fd(Fd({},{width:160,height:120,framerate:15,bitrate:50}),n);let u;u=o?e._mediaStreamTrack.clone():yL(e,c);const h=Zn(8,"track-low-"),f=new ur(u,Fd(Fd({},o&&{scaleResolutionDownBy:nL(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return f.on(Wg.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,AE.LOW_STREAM)}),f._hints.push(er.LOW_STREAM),$e(i=e._hints).call(i,er.SCREEN_TRACK)&&f._hints.push(er.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{f.emit("sei-to-send",_)}),e.addListener(at.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,n,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ud){var c,u,h,f;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:y,peerConnectionState:w}=this.connection,{local:I,remote:P}=await this.connection.getSelectedCandidatePair();ht.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:v,dtlsstate:y,connectionstate:w,intSucc:n?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=I==null?void 0:I.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=I.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(I.address,":").concat(I.port),selectedRemoteCandidateProtocol:(h=P.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(f=P.candidateType)!==null&&f!==void 0?f:"",selectedRemoteCandidateAddress:"".concat(P.address,":").concat(P.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(pc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");ht.firstRemoteVideoDecode(this.store.sessionId,Oi.FIRST_VIDEO_DECODE,Er.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:o?1:0,firstFrame:(f==null?void 0:f.firstFrame)||0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===Le.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,AE.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ct(Zt.prototype,"startP2PConnection",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"startP2PConnection"),Zt.prototype),ct(Zt.prototype,"connect",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"connect"),Zt.prototype),ct(Zt.prototype,"updateRemoteRTPCapabilities",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"updateRemoteRTPCapabilities"),Zt.prototype),ct(Zt.prototype,"publishDataChannel",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"publishDataChannel"),Zt.prototype),ct(Zt.prototype,"unpublish",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"unpublish"),Zt.prototype),ct(Zt.prototype,"unpublishDataChannel",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"unpublishDataChannel"),Zt.prototype),ct(Zt.prototype,"unpublishLowStream",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"unpublishLowStream"),Zt.prototype),ct(Zt.prototype,"subscribeDataChannel",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"subscribeDataChannel"),Zt.prototype),ct(Zt.prototype,"subscribe",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"subscribe"),Zt.prototype),ct(Zt.prototype,"massSubscribe",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"massSubscribe"),Zt.prototype),ct(Zt.prototype,"unsubscribe",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"unsubscribe"),Zt.prototype),ct(Zt.prototype,"unsubscribeDataChannel",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"unsubscribeDataChannel"),Zt.prototype),ct(Zt.prototype,"massUnsubscribe",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"massUnsubscribe"),Zt.prototype),ct(Zt.prototype,"muteRemote",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"muteRemote"),Zt.prototype),ct(Zt.prototype,"unmuteRemote",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"unmuteRemote"),Zt.prototype),ct(Zt.prototype,"hasRemoteMediaWithLock",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"hasRemoteMediaWithLock"),Zt.prototype),ct(Zt.prototype,"disconnectForReconnect",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"disconnectForReconnect"),Zt.prototype),ct(Zt.prototype,"updateBitrateLimit",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"updateBitrateLimit"),Zt.prototype),ct(Zt.prototype,"remoteMediaSsrcChanged",[Hs],Object.getOwnPropertyDescriptor(Zt.prototype,"remoteMediaSsrcChanged"),Zt.prototype),Zt);function Hs(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return await o.apply(this,f)}finally{u()}},i}function Dz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Lz(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Dz(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Dz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const che=Date.now(),lhe=20,TL=new Map,mA=new Map;async function xz(e){const n=TL.get(e),i=Array.isArray(n)&&n[n.length-1],o=mA.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let f=i.mediaDelay+h;f<=0?(n.pop(),Mz(i.context,c),f=0):f=Math.min(f,lhe),setTimeout(()=>n.length&&xz(e),f)}function Mz(e,n){e.safeEmit(rn.STREAM_MESSAGE,n.uid,n.payload),e.onStreamMessage&&e.onStreamMessage(n)}function uhe(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return Mz(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=TL.get(o)||[],u=c.findIndex(v=>e.sendTs>=v.sendTs),h=Lz(Lz({},e),{},{context:i,mediaDelay:n,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),TL.set(o,c);let f=!1;var _;mA.has(o)?f=!((_=mA.get(o))===null||_===void 0||!_.isSyncing):mA.set(o,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||xz(o)}const dhe=mn().name;function Uz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Vz(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Uz(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Uz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const XE="websdk_ng_cache_parameter",hhe=Q("MAX_PRELOAD_ASYNC_LENGTH"),phe=1e4,t_=new Map,n_=[];let bL=null,wL=0,RL=0;const gA=new Map,fhe=function(e,n){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<n?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];return new Je(async(_,v)=>{i.push(async()=>{try{const y=await e(...h);_(y)}catch(y){v(y)}}),o<n&&(o++,c())})}}(Fz,hhe),CL=No.CancelToken.source();async function Fz(e,n,i,o,c,u){try{if(!Q("ENABLE_PRELOAD"))return;if(!wn().supportWebCrypto)return void Df(()=>{k.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Ie(Y.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&$i(i,"token",1,2047),$i(e,"appid",1,2047),KI(n),o&&$I(o);const h=jg();k.debug("preload channel ".concat(n,", uid is ").concat(o));const f={appId:e,cname:n,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,v;typeof o=="string"?(f.stringUid=o,[v,_]=await Je.all([Xde(o,{sid:h,appId:e},CL.token),az(Vz(Vz({},f),{},{token:i||e,uid:0}),CL.token)]),f.uid=v.uid,_.gatewayInfo.uid=f.uid,_.gatewayInfo.res.uid=f.uid):(u&&(f.stringUid=u),_=await az(f,CL.token));const y={sid:h,appId:e,cname:n,token:i||e,uid:f.stringUid||o,intUid:f.uid||_.gatewayInfo.uid,stringUid:f.stringUid,ts:Date.now(),sua:v,ap:_};await async function(w){let I;try{w.uid&&Bz({appId:w.appId,cname:w.cname,token:w.token,uid:w.uid,stringUid:w.stringUid});const P=Hz(w),j=await async function(M,$){try{const q=await window.crypto.subtle.importKey("raw",N5($),"AES-GCM",!1,["encrypt"]),oe=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},q,Fg(window.btoa(JSON.stringify(M))));return Lf(new Uint8Array(oe))}catch{return}}(w,w.token||w.appId);if(!j)return;I=zz(XE);const x=I?JSON.parse(I):[];x.push({[P]:j}),x.length>Q("AP_CACHE_NUM")&&x.shift(),_A(XE,JSON.stringify(x))}catch(P){k.warn("Error caching server parameters:",P.message),_A(XE,"")}}(y),wL++}catch(h){throw RL++,function(f){bL||(bL=window.setTimeout(()=>{let v="";gA.forEach((y,w)=>{v+="".concat(w,": ").concat(y," ;")}),ht.reportApiInvoke(null,{name:hi.PRELOAD,options:{success:wL,failed:RL,err:v}}).onError(f),wL=0,RL=0,gA.clear(),bL=null},phe));const _=gA.get(f.code)||0;gA.set(f.code,_+1)}(h),h}}async function jz(e){try{if(Q("AP_REQUEST_DETAIL")||Q("ENABLE_ROLE_SELECT_EDGE"))return;const n=Bz(e);if(!n||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",N5(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,Fg(o));return JSON.parse(window.atob(Lf(new Uint8Array(h))))}catch{return}}(n,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<Q("AP_CACHE_LIFETIME"))return i}catch(n){k.warn("Error get preloadInfo",n.message)}}function Bz(e){let n;try{if(n=zz(XE),!n)return;const i=JSON.parse(n),o=Hz(e),c=function(h,f){for(let _=h.length-1;_>=0;_--)if(f(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return _A(XE,JSON.stringify(i)),u[o]}catch(i){k.warn("Error delete preload info: ".concat(n),i.message),_A(XE,"")}}function IL(e){if(e){let n=t_.get(e);n&&(window.clearTimeout(n),n=null,t_.delete(e)),$e(n_).call(n_,e)||e.cloudProxyServer!=="disabled"||n_.push(e)}if(t_.size<Q("AP_CACHE_NUM")&&n_.length>0){const n=n_.shift();t_.set(n,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:f}=n;try{await fhe(i,o,c,h,f,u),t_.has(n)&&IL(n)}catch(_){k.warn("update preload failed",_.message),Wz(n)}},Q("AP_UPDATE_INTERVAL")))}}function Wz(e){const n=n_.indexOf(e);n!==-1&&n_.splice(n,1);let i=t_.get(e);i&&(window.clearTimeout(i),i=null,t_.delete(e),IL())}function Gz(e,n){const i=e.sua,o=e.ap;n&&i&&ht.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:n,uid:e.intUid,errorCode:null,extend:i.req}),ht.reportResourceTiming(e.ap.url,e.sid),ht.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ri.CHOOSE_SERVER,ri.CLOUD_PROXY_FALLBACK].toString()}),ht.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[ri.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function zz(e){return window.atob(window.localStorage.getItem(e)||"")}function _A(e,n){window.localStorage.setItem(e,window.btoa(n))}function Hz(e){let n="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(n+="_s_".concat(e.uid)),typeof e.uid=="number"&&(n+="_".concat(e.uid)),e.token&&(n+="_".concat(e.token)),V5(n)}function mhe(e){let n=function(){const i=vhe.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(oi(o,10),zf(o,c));let u=i.cid;u!==void 0&&(oi(o,16),oi(o,u));let h=i.cname;h!==void 0&&(oi(o,26),zf(o,h));let f=i.deviceId;f!==void 0&&(oi(o,34),zf(o,f));let _=i.elapse;_!==void 0&&(oi(o,40),Hf(o,_));let v=i.fileSize;v!==void 0&&(oi(o,48),Hf(o,JE(v)));let y=i.height;y!==void 0&&(oi(o,56),Hf(o,JE(y)));let w=i.jpg;w!==void 0&&(oi(o,66),oi(o,w.length),$z(o,w));let I=i.networkType;I!==void 0&&(oi(o,72),Hf(o,JE(I)));let P=i.osType;P!==void 0&&(oi(o,80),Hf(o,JE(P)));let j=i.requestId;j!==void 0&&(oi(o,90),zf(o,j));let x=i.sdkVersion;x!==void 0&&(oi(o,98),zf(o,x));let M=i.sequence;M!==void 0&&(oi(o,104),Hf(o,JE(M)));let $=i.sid;$!==void 0&&(oi(o,114),zf(o,$));let q=i.timestamp;q!==void 0&&(oi(o,120),Hf(o,q));let oe=i.uid;oe!==void 0&&(oi(o,128),oi(o,oe));let me=i.vid;me!==void 0&&(oi(o,136),oi(o,me));let ge=i.width;ge!==void 0&&(oi(o,144),Hf(o,JE(ge)));let fe=i.service;fe!==void 0&&(oi(o,152),oi(o,fe));let Re=i.callbackData;Re!==void 0&&(oi(o,162),oi(o,Re.length),$z(o,Re));let Ue=i.ticket;Ue!==void 0&&(oi(o,170),zf(o,Ue));let Qe=i.vendorConfigs;Qe!==void 0&&(oi(o,178),zf(o,Qe))}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function ghe(e){return function(i){let o={};e:for(;!Ehe(i);){let c=v0(i);switch(c>>>3){case 0:break e;case 1:o.code=v0(i);break;case 2:o.msg=qz(i,v0(i));break;case 3:o.requestId=qz(i,v0(i));break;case 4:o.timestamp=yhe(i,!1);break;default:_he(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function _he(e,n){switch(n){case 0:for(;128&Fl(e););break;case 2:AL(e,v0(e));break;case 5:AL(e,4);break;case 1:AL(e,8);break;default:throw new Error("Unimplemented type: "+n)}}function JE(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let vhe=[];function AL(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function Ehe(e){return e.offset>=e.limit}function vA(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function Kz(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function $z(e,n){let i=vA(e,n.length);e.bytes.set(n,i)}function qz(e,n){let i=Kz(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let f=0;f<n;f++){let _,v,y,w,I=c[f+i];(128&I)==0?h+=o(I):(224&I)==192?f+1>=n?h+=u:(_=c[f+i+1],(192&_)!=128?h+=u:(w=(31&I)<<6|63&_,w<128?h+=u:(h+=o(w),f++))):(240&I)==224?f+2>=n?h+=u:(_=c[f+i+1],v=c[f+i+2],(49344&(_|v<<8))!=32896?h+=u:(w=(15&I)<<12|(63&_)<<6|63&v,w<2048||w>=55296&&w<=57343?h+=u:(h+=o(w),f+=2))):(248&I)==240?f+3>=n?h+=u:(_=c[f+i+1],v=c[f+i+2],y=c[f+i+3],(12632256&(_|v<<8|y<<16))!=8421504?h+=u:(w=(7&I)<<18|(63&_)<<12|(63&v)<<6|63&y,w<65536||w>1114111?h+=u:(w-=65536,h+=o(55296+(w>>10),56320+(1023&w)),f+=3))):h+=u}return h}function zf(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let f=n.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+n.charCodeAt(++h)-56613888),o+=f<128?1:f<2048?2:f<65536?3:4}oi(e,o);let c=vA(e,o),u=e.bytes;for(let h=0;h<i;h++){let f=n.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+n.charCodeAt(++h)-56613888),f<128?u[c++]=f:(f<2048?u[c++]=f>>6&31|192:(f<65536?u[c++]=f>>12&15|224:(u[c++]=f>>18&7|240,u[c++]=f>>12&63|128),u[c++]=f>>6&63|128),u[c++]=63&f|128)}}function Fl(e){return e.bytes[Kz(e,1)]}function Yz(e,n){let i=vA(e,1);e.bytes[i]=n}function v0(e){let n,i=0,o=0;do n=Fl(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function oi(e,n){for(n>>>=0;n>=128;)Yz(e,127&n|128),n>>>=7;Yz(e,n)}function yhe(e,n){let i,o=0,c=0,u=0;return i=Fl(e),o=127&i,128&i&&(i=Fl(e),o|=(127&i)<<7,128&i&&(i=Fl(e),o|=(127&i)<<14,128&i&&(i=Fl(e),o|=(127&i)<<21,128&i&&(i=Fl(e),c=127&i,128&i&&(i=Fl(e),c|=(127&i)<<7,128&i&&(i=Fl(e),c|=(127&i)<<14,128&i&&(i=Fl(e),c|=(127&i)<<21,128&i&&(i=Fl(e),u=127&i,128&i&&(i=Fl(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:n}}function Hf(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=vA(e,u),f=e.bytes;switch(u){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=u!==9?128|c:127&c;case 8:f[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:f[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:f[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:f[h+4]=u!==5?128|o:127&o;case 4:f[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:f[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:f[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:f[h]=u!==1?128|i:127&i}}const Xz={},Jz={},EA=4294967296,She=EA*EA,The=She/2;Zz(0,!0);const Qz=Zz(0),bhe=E0(0,-2147483648,!1),whe=E0(-1,2147483647,!1);function Zz(e,n){let i,o,c;return n?(c=0<=(e>>>=0)&&e<256)&&(o=Jz[e],o)?o:(i=E0(e,0,!0),c&&(Jz[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=Xz[e],o)?o:(i=E0(e,e<0?-1:0,!1),c&&(Xz[e]=i),i)}function E0(e,n,i){return{low:0|e,high:0|n,unsigned:!!i}}function e8(e,n){if(isNaN(e))return Qz;{if(e<=-9223372036854776e3)return bhe;if(e+1>=The)return whe}return e<0?Qz:E0(e%EA|0,e/EA|0,n)}function t8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class OL extends Rr{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Vu.CONNECTION_STATE_CHANGE,n,i)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var i;super(),G(this,"name","AgoraRTCImageModeration"),G(this,"_connectionState",Qc.CONNECTING),G(this,"_sequence",0),G(this,"_moderationStartTime",void 0),G(this,"_workerConnection",void 0),G(this,"_workerMessageLengthLimit",void 0),G(this,"_qualityRatio",void 0),G(this,"_connectInfo",void 0),G(this,"_cancelTokenSource",No.CancelToken.source()),G(this,"_retryConfig",void 0),G(this,"_moderationInterval",void 0),G(this,"_moderationTimer",null),G(this,"_moderationMode",1),G(this,"_quality",1),G(this,"_qualityTimer",null),G(this,"_ticket",void 0),G(this,"_moderationIntervalMinimum",void 0),G(this,"_uploadFailedNum",0),G(this,"_uploadNum",0),G(this,"_uploadTimer",null),G(this,"_extraInfo",void 0),G(this,"_vendor",""),G(this,"_encoder",new TextEncoder),G(this,"_moderationId",void 0),G(this,"inspectImage",()=>{if(this.connectionState!==Qc.CONNECTED)throw new be(Y.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Qc.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Zn(5,"image-moderation-"),this._workerMessageLengthLimit=Q("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Q("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),this._qualityRatio=Q("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new c0("worker-"+this._moderationId,pi),this.on(Vu.STATE_CHANGE,(o,c)=>{k.debug("[".concat(this._moderationId,"] Moderation operation :").concat(jE[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(n,i){this.emit(Vu.STATE_CHANGE,jE.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new Je((c,u)=>{this.on(Vu.CONNECTION_STATE_CHANGE,(h,f)=>{h===Qc.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(n){var i;this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),k.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===Qc.CONNECTED&&this.inspectImage()}async requestAP(n,i,o){const c=Q("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,v,y,w){let{appId:I,areaCode:P,cname:j,sid:x,token:M,uid:$}=v;KE++;const q="moderation_plugin",oe={service_name:q,json_body:JSON.stringify({appId:I,areaCode:P,cname:j,command:"allocateEdge",requestId:KE,seq:KE,sid:x,appToken:M,ts:Date.now(),uid:$+""})};let me,ge,fe=_[0];return Lu(async()=>{me=Date.now();const Re=await Fu(fe,{data:oe,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ge=Date.now()-me,Re.code!==0){const rt=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Re.code,{retry:!0,responseTime:ge});throw k.error(rt.toString()),rt}const Ue=JSON.parse(Re.json_body);if(Ue.code!==200){const rt=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ue.code,", reason: ").concat(Ue.reason),{code:Ue.code,responseTime:ge});throw k.error(rt.toString()),rt}if(!Ue.servers||!Array.isArray(Ue.servers)||Ue.servers.length===0){const rt=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ue.code,responseTime:ge});throw k.error(rt.toString()),rt}if(!Ue.servers.some(rt=>!!rt.wss)){const rt=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ue.code,responseTime:ge});throw k.error(rt.toString()),rt}const Qe=Q("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ue.servers.map(rt=>{let{address:cn,wss:ln}=rt;if(cn&&ln)return"wss://".concat(cn.replace(/\./g,"-"),".").concat(Qe,":").concat(ln,"/moderation")}).filter(rt=>!!rt),workerToken:Ue.workerToken,vid:Ue.vid,ticket:Ue.appTicket,responseTime:ge}},(Re,Ue)=>(ht.apworkerEvent(x,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(Re.addressList),firstSuccess:Ue===0,responseTime:ge,serverIp:_[Ue%_.length]}),!1),(Re,Ue)=>(ht.apworkerEvent(x,{success:!1,sc:Re.data&&Re.data.code||200,serviceName:q,responseTime:ge,serverIp:_[Ue%_.length]}),!!(Re.code!==Y.OPERATION_ABORTED&&Re.code!==Y.UNEXPECTED_RESPONSE||Re.data&&Re.data.retry)&&(fe=_[(Ue+1)%_.length],!0)),w)}(c,n,i,o);this.emit(Vu.STATE_CHANGE,jE.AP_CONNECTED);const{addressList:h,ticket:f}=u;return this._ticket=f,h}async connectWorker(n){this.emit(Vu.STATE_CHANGE,jE.CONNECT_WORKER),await this._workerConnection.init(n,1e4)}handleWorkerEvents(){this._workerConnection.on(Wt.CONNECTED,async()=>{this.emit(Vu.STATE_CHANGE,jE.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Qc.CONNECTED}),this._workerConnection.on(Wt.CLOSED,()=>{this.connectionState=Qc.CLOSED}),this._workerConnection.on(Wt.FAILED,()=>{this.connectionState=Qc.CLOSED}),this._workerConnection.on(Wt.RECONNECTING,()=>{this.connectionState=this.connectionState===Qc.CONNECTED?Qc.RECONNECTING:Qc.CONNECTING}),this._workerConnection.on(Wt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const i=ghe(new Uint8Array(n.data));Q("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,k.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{ht.reportApiInvoke(this._connectInfo.sid||null,{name:hi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Dr.TRACER}).onError(new be(Y.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},Q("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else k.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Wt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this._workerConnection.on(Wt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}async requestToInspectImage(){const n=dc(this,Vu.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void(Q("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(n,i);this._workerConnection.sendMessage(o,!0,!0)}else Q("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being published can be inspected")}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:f,uid:_}=i;const v=Date.now(),y=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await I6(y,o,c),I=this._sequence+"-"+u+"-"+_+"-"+v+"-"+Zn(12,""),P={appId:o,cid:u,cname:c,deviceId:"",elapse:OL.intToLong(Number(v-this._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:w,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.2",sequence:this._sequence,sid:f,timestamp:e8(v),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete P.callbackData;const j=mhe(P);if(j.byteLength<this._workerMessageLengthLimit){if(Q("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const x=function(M){for(var $=1;$<arguments.length;$++){var q=arguments[$]!=null?arguments[$]:{};$%2?t8(Object(q),!0).forEach(function(oe){G(M,oe,q[oe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(q)):t8(Object(q)).forEach(function(oe){Object.defineProperty(M,oe,Object.getOwnPropertyDescriptor(q,oe))})}return M}({},P);delete x.jpg,k.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(x))}return j}{const x=this.quality*this._qualityRatio;return this.quality=x,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:f,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=No.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Qc.CLOSED,this.emit(Vu.STATE_CHANGE,jE.CLOSED)}}function n8(e){if(qn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new be(Y.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new be(Y.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Rhe={name:"ImageModeration",create:function(e){let{config:n}=e;return n8(n),new OL(n)}};var r8,i8,s8,o8,a8,c8,l8,u8,d8,h8,p8,f8,m8,g8,_8,v8,E8,y8,S8,T8,b8,w8,R8,C8,I8,A8,O8,P8,N8,k8,D8,L8,x8,M8,U8,V8,F8,j8,B8,W8,G8,tt;function z8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function jl(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?z8(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):z8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}vs.setLogger(k);let Che=(r8=Ot(),i8=Ot({argsMap:(e,n)=>{if(!Array.isArray(n)){if(!(n instanceof kE))return[n];n=[n]}return n.map(i=>i?Object(i).toString():"null")}}),s8=Ot({argsMap:(e,n)=>(n||(n=[]),Array.isArray(n)||n.trackMediaType!==NE.DATA?(Array.isArray(n)||(n=[n]),n.map(i=>i.getTrackId())):[n.getChannelId()])}),o8=Ot({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),a8=Ot({argsMap:(e,n,i)=>[n,i]}),c8=Ot({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),l8=Ot({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),u8=Ot({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),d8=Ot(),h8=Ot(),p8=Ot(),f8=Ot(),m8=Ot(),g8=Ot(),_8=Ot(),v8=Ot(),E8=Ot(),y8=Ot(),S8=Ot(),T8=Ot(),b8=Ot(),w8=Ot(),R8=Ot(),C8=Ot({argsMap:(e,n)=>[n]}),I8=Ot(),A8=Ot(),O8=Ot(),P8=Ot(),N8=Ot(),k8=Ot(),D8=Ot(),L8=Ot(),x8=Ot({argsMap:(e,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),M8=Ot(),U8=Ot(),V8=Ot(),F8=Ot(),j8=Ot(),B8=Ot(),W8=Ot({reportResult:!0}),G8=Ot(),tt=class extends Rr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,n){let i;if(super(),G(this,"store",void 0),G(this,"_uid",void 0),G(this,"_channelName",void 0),G(this,"_uintUid",void 0),G(this,"_users",[]),G(this,"_config",void 0),G(this,"_clientId",void 0),G(this,"_appId",void 0),G(this,"_sessionId",null),G(this,"_key",void 0),G(this,"_rtmConfig",{}),G(this,"_joinInfo",void 0),G(this,"_gateway",void 0),G(this,"_statsCollector",void 0),G(this,"_configDistribute",void 0),G(this,"_leaveMutex",void 0),G(this,"_publishMutex",void 0),G(this,"_renewTokenMutex",void 0),G(this,"_subscribeMutex",void 0),G(this,"_encryptionMode","none"),G(this,"_encryptionSecret",null),G(this,"_encryptionSalt",null),G(this,"_encryptDataStream",!1),G(this,"_encryptDataStreamKey",null),G(this,"_encryptDataStreamIv",null),G(this,"_proxyServer",void 0),G(this,"_turnServer",{servers:[],mode:"auto"}),G(this,"_cloudProxyServerMode","disabled"),G(this,"_isDualStreamEnabled",!1),G(this,"_defaultStreamFallbackType",void 0),G(this,"_lowStreamParameter",void 0),G(this,"_streamFallbackTypeCacheMap",new Map),G(this,"_remoteStreamTypeCacheMap",new Map),G(this,"_axiosCancelSource",No.CancelToken.source()),G(this,"_audioVolumeIndicationInterval",void 0),G(this,"_networkQualityInterval",void 0),G(this,"_userOfflineTimeout",void 0),G(this,"_streamRemovedTimeout",void 0),G(this,"_liveTranscodeStreamingClient",void 0),G(this,"_liveRawStreamingClient",void 0),G(this,"_channelMediaRelayClient",void 0),G(this,"_networkQualitySensitivity","normal"),G(this,"_p2pChannel",void 0),G(this,"_useLocalAccessPoint",!1),G(this,"_setLocalAPVersion",void 0),G(this,"_joinAndNotLeaveYet",!1),G(this,"_numberOfJoinCount",0),G(this,"_remoteDefaultVideoStreamType",void 0),G(this,"_inspect",void 0),G(this,"_moderation",void 0),G(this,"_license",void 0),G(this,"_pendingPublishedUsers",[]),G(this,"ntpAlignErrorCount",0),G(this,"remoteInboundOffset",0),G(this,"_peerConnectionState",void 0),G(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),G(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),G(this,"_handleUserOnline",c=>{if(Q("BLOCK_LOCAL_CLIENT")&&qg(c.uid,this.channelName))return void k.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(rn.USER_JOINED,u));else{const h=new Wf(c.uid,c.uint_id||c.uid);this._users.push(h),k.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(rn.USER_JOINED,h)}}),G(this,"_handleUserOffline",c=>{if(Q("BLOCK_LOCAL_CLIENT")&&qg(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:SI(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),k.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(rn.USER_LEAVED,u,c.reason))}),G(this,"_handleAddAudioOrVideoStream",(c,u,h,f,_,v,y)=>{if(Q("BLOCK_LOCAL_CLIENT")&&qg(u,this.channelName))return;const w=this._users.find(P=>P.uid===u);if(!w)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now());const I=c==="audio"?w.hasAudio:w.hasVideo;w._uintid||(w._uintid=_||u),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,h!==void 0&&(w._audioSSRC=h),f!==void 0&&(w._cname=f),v&&(w._audioOrtc=v)):(w._video_added_=!0,h!==void 0&&(w._videoSSRC=h),f!==void 0&&(w._cname=f),y!==void 0&&(w._rtxSsrcId=y),v&&(w._videoOrtc=v)),(c==="audio"?w.hasAudio:w.hasVideo)&&!I&&(k.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(rn.USER_PUBLISHED,w,c)),c==="video"?ht.onGatewayStream(this._sessionId,Oi.ON_ADD_VIDEO_STREAM,Er.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:w._videoSSRC}):ht.onGatewayStream(this._sessionId,Oi.ON_ADD_AUDIO_STREAM,Er.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,h).then(P=>{if(P&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof _0))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(j=>{k.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(P=>{k.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),G(this,"_handleRemoveStream",c=>{if(Q("BLOCK_LOCAL_CLIENT")&&qg(c.uid,this.channelName))return;const u=this._users.find(f=>f.uid===c.uid);if(!u)return void k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));k.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(rn.USER_UNPUBLISHED,u,"audio"),k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(rn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(rn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(rn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof _0&&this._p2pChannel.unsubscribe(u).then(f=>{if(f)return this._gateway.unsubscribe(f,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),ht.onGatewayStream(this._sessionId,Oi.ON_REMOVE_STREAM,Er.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),G(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(Q("BLOCK_LOCAL_CLIENT")&&qg(u,this.channelName))return;const f=this._users.find(y=>y.uid===u);if(!f)return void k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));k.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?f.hasAudio:f.hasVideo;if(c==="audio"){f._trust_audio_enabled_state_=!0;const y=f._audio_enabled_;if(f._audio_enabled_=h,f._audio_enabled_===y)return;{const w=f._audio_enabled_?"enable-local-audio":"disable-local-audio";k.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(rn.USER_INFO_UPDATED,u,w)}}else{f._trust_video_enabled_state_=!0;const y=f._video_enabled_;if(f._video_enabled_=h,f._video_enabled_===y)return;{const w=f._video_enabled_?"enable-local-video":"disable-local-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(rn.USER_INFO_UPDATED,u,w)}}const v=c==="audio"?f.hasAudio:f.hasVideo;return _!==v?!_&&v?(k.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(rn.USER_PUBLISHED,f,c)):(c==="video"&&f._videoTrack&&f._videoTrack._destroy(),c==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,c),k.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(rn.USER_UNPUBLISHED,f,c)):void 0}),G(this,"_handleMuteStream",(c,u,h)=>{if(Q("BLOCK_LOCAL_CLIENT")&&qg(c,this.channelName))return;k.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const f=this._users.find(y=>y.uid===c);if(!f)return void k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?f.hasAudio:f.hasVideo;if(u==="audio"){f._trust_audio_mute_state_=!0;const y=f._audio_muted_;if(f._audio_muted_=h,f._audio_muted_===y)return;{const w=f._audio_muted_?"mute-audio":"unmute-audio";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(rn.USER_INFO_UPDATED,c,w)}}else{f._trust_video_mute_state_=!0;const y=f._video_muted_;if(f._video_muted_=h,f._video_muted_===y)return;{const w=f._video_muted_?"mute-video":"unmute-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(rn.USER_INFO_UPDATED,c,w)}}const v=u==="audio"?f.hasAudio:f.hasVideo;if(_!==v){if(!_&&v)return(u==="audio"?f._audioSSRC:f._videoSSRC)?(k.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(rn.USER_PUBLISHED,f,u)):void k.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),u==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,u),k.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(rn.USER_UNPUBLISHED,f,u)}}),G(this,"_handleP2PLost",async c=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():k.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),G(this,"_handleTokenWillExpire",()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(rn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),G(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),G(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(rn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(rn.NETWORK_QUALITY,c)}),G(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,f)=>{const _=this._users.find(y=>y.uid===u);if(!_)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),f!==void 0&&(_._audioMid=f)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),f!==void 0&&(_._videoMid=f)),(c==="audio"?_.hasAudio:_.hasVideo)&&!v&&(k.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(rn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(y=>{k.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),this._config=e,this._clientId=n||Zn(5,"client-"),this.store=new class{constructor(c,u,h,f){Ut(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:f,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Bg.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case sn.SET_SESSION_ID:return it(it({},u),{},{sessionId:h.sessionId});case sn.SET_P2P_ID:return it(it({},u),{},{p2pId:h.p2pId});case sn.SET_UID:return it(it({},u),{},{uid:h.uid});case sn.SET_INT_UID:return it(it({},u),{},{intUid:h.intUid});case sn.SET_PUB_ID:return it(it({},u),{},{pubId:h.pubId});case sn.KEY_METRIC_CLIENT_CREATED:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{clientCreated:h.metric})});case sn.KEY_METRIC_JOIN_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{joinStart:h.metric})});case sn.AVOID_JOIN_START:return it(it({},u),{},{avoidJoinStart:h.avoidJoinStart});case sn.KEY_METRIC_JOIN_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{joinEnd:h.metric})});case sn.KEY_METRIC_REQUEST_AP_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{requestAPStart:h.metric})});case sn.KEY_METRIC_REQUEST_AP_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{requestAPEnd:h.metric})});case sn.KEY_METRIC_JOIN_GATEWAY_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case sn.KEY_METRIC_JOIN_GATEWAY_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case sn.KEY_METRIC_PEER_CONNECTION_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case sn.KEY_METRIC_PEER_CONNECTION_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case sn.KEY_METRIC_DESCRIPTION_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{descriptionStart:h.metric})});case sn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case sn.KEY_METRIC_ICE_CONNECTION_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case sn.KEY_METRIC_PUBLISH:{const f=u.keyMetrics.publish,_=f.findIndex(v=>v.trackId===h.metric.trackId);return _!==-1?(f[_]=it(it({},f[_]),h.metric),it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{publish:[...f]})})):it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case sn.KEY_METRIC_SUBSCRIBE:{const f=u.keyMetrics.subscribe,_=f.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return _!==-1?(f[_]=it(it({},f[_]),h.metric),it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{subscribe:[...f]})})):it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case sn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case sn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=it(it({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case sn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case sn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case sn.SET_USE_P2P:return it(it({},u),{},{useP2P:h.val});case sn.SET_TRANSPORT_TYPE:return it(it({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:sn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:sn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:sn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:sn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:sn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:sn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:sn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:sn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:sn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:sn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:sn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:sn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:sn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:sn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:sn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:sn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:sn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:sn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:sn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:sn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:sn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,f){this.dispatch({type:sn.KEY_METRIC_PUBLISH,metric:it(it({trackId:c,type:u},h&&{publishStart:h}),f&&{publishEnd:f})})}subscribe(c,u,h,f,_,v,y){this.dispatch({type:sn.KEY_METRIC_SUBSCRIBE,metric:it(it(it(it(it({userId:c,type:u},h&&{subscribeStart:h}),f&&{subscribeEnd:f}),_&&{firstFrame:_}),v&&{streamAdded:v}),y&&{firstDecoded:y})})}massSubscribe(c,u,h,f){c.forEach(_=>{this.dispatch({type:sn.KEY_METRIC_SUBSCRIBE,metric:it(it(it({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),f&&{firstFrame:f})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:sn.RECORD_JOIN_CHANNEL_SERVICE,record:it(it({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:sn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:sn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:sn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:sn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new vs("client-leave",this._clientId),this._publishMutex=new vs("client-publish",this._clientId),this._renewTokenMutex=new vs("client-renewtoken",this._clientId),this._subscribeMutex=new vs("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),k.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Yc," build: ").concat(S1,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{c1(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){k.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new m0(this.store),this._statsCollector.onStatsException=(c,u,h)=>{k.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(rn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,f)=>{const _=this._users.find(v=>v.uid===c);_&&ht.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new zde(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||pi,httpRetryConfig:e.httpRetryConfig||pi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new ehe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},sp("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new _0(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,n,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Hn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Hn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const f=this._gateway.signal.websocket;return f instanceof eL&&(f.use443PortOnly=u,f.tryDoubleDomain=h),async function(_,v,y){gI.get(_)||gI.set(_,[]),_I.get(_)||_I.set(_,v),Od.get(_)||Od.set(_,0);const w=gI.get(_),I=_I.get(_);if(!w||!I)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Od.get(_)===I){const $=KT();w.push($),await $.promise}Od.set(_,Od.get(_)+1);for(var P=arguments.length,j=new Array(P>3?P-3:0),x=3;x<P;x++)j[x-3]=arguments[x];const M=await y(...j);return Od.set(_,Od.get(_)-1),Od.get(_)===I-1&&w.length>0&&(w[0].resolve(),w.shift()),Od.get(_)===0&&(gI.set(_,[]),_I.set(_,0),Od.set(_,0)),M}("client.join",Q("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,n,i,o,c)}async join(e,n,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(wI||wI||(wI=(window.location.protocol.split(":")[0]||"").toUpperCase(),wI))==="HTTPS",f=B5()?window.isSecureContext:"Browser Not Support";(!B5()&&!h||!window.isSecureContext)&&k.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),k.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),ht.setAppId(e);try{if(!i&&i!==null)throw new be(Y.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&$i(i,"token",1,2047),$i(e,"appid",1,2047),KI(n),o&&$I(o),c&&$i(c,"optionalInfo",1,2047)}catch(x){throw ht.reportApiInvoke(jg(),{name:hi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:f},tag:Dr.TRACER}).onError(x),x}if(this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const x=new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ht.reportApiInvoke(jg(),{name:hi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:f},tag:Dr.TRACER}).onError(x),x}this._gateway.state="CONNECTING";const _=await jz({appId:e,cname:n,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(_==null?void 0:_.sid)||jg();k.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const y=ht.reportApiInvoke(v,{id:this._clientId,name:hi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:f},tag:Dr.TRACER}),w=jl(jl(jl({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:n,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Q("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(w.stringUid=o,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async x=>{const M=function(me){const ge=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),fe=new Uint8Array(new ArrayBuffer(ge.length));for(let Re=0;Re<ge.length;Re+=1)fe[Re]=ge.charCodeAt(Re);return fe}(),$=await window.crypto.subtle.importKey("spki",M,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),q=o1(x),oe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},$,q);return function(me){let ge="";for(let fe=0;fe<me.length;fe+=1)ge+=String.fromCharCode(me[fe]);return window.btoa(ge)}(new Uint8Array(oe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const x=new TextEncoder,M=Q("USE_PURE_ENCRYPTION_MASTER_KEY")?x.encode(w.appId+this._encryptionSecret+this._encryptionSecret):x.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function($,q,oe){const me=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),ge=$==="aes-128-gcm2"?128:256,fe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:J5,hash:"SHA-256",salt:oe},me,ge+yue);return new Uint8Array(fe).subarray(ge/8)}(this._encryptionMode,M,Fg(this._encryptionSalt)),this._encryptDataStreamKey=await async function($,q,oe){const me=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),ge=$==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:J5,hash:"SHA-256",salt:oe},me,{name:"AES-GCM",length:ge},!0,["encrypt","decrypt"])}(this._encryptionMode,M,Fg(this._encryptionSalt))}else f?k.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):k.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,k.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:n,appId:e,stringUid:w.stringUid});const I=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&I===this._sessionId&&ht.joinChannelTimeout(this._sessionId,5)},5e3);try{var P;let x;const M=w.cloudProxyServer;if($e(P=["proxy3","proxy4","proxy5"]).call(P,M)){const ge=Q("PROXY_SERVER_TYPE3");Array.isArray(ge)?w.proxyServer=ge[0]:w.proxyServer=ge}if(ht.setProxyServer(w.proxyServer),k.setProxyServer(w.proxyServer),this.store.requestAPStart(),_){if(k.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(_.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=_.intUid),x={gatewayInfo:_.ap.gatewayInfo},Q("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ge=(await kG(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(fe=>({turnServerURL:fe.address,tcpport:fe.tcpport||us.tcpport,udpport:fe.udpport||us.udpport,username:fe.username||us.username,password:fe.password||us.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:ge}}Gz(_,w.stringUid)}else{if(w.stringUid&&!w.uid){let ge;[ge,x]=await Je.all([oz(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,this.store),sz(w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,!0,this.store)]),k.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(ge)),w.uid=ge,x.gatewayInfo.uid=ge,x.gatewayInfo.res.uid=ge}else x=await sz(w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(o0.UPDATE_BITRATE_LIMIT,ge=>{this._p2pChannel.updateBitrateLimit(ge)}),this._configDistribute.on(o0.UPDATE_CLIENT_ROLE_OPTIONS,ge=>{this._setClientRoleOptions(ge)})},0),this._key=i||e;const $=x.gatewayInfo,q=w.uid?w.uid:$.uid;this._joinInfo=jl(jl({},w),{},{cid:$.cid,uid:q,vid:$.vid,apResponse:$.res,apGatewayAddress:$.apGatewayAddress,uni_lbs_ip:$.uni_lbs_ip,gatewayAddrs:$.gatewayAddrs}),this.store.intUid=q,this.store.cid=$.cid;const oe=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));y.onSuccess(oe),this._appId=e,this._channelName=w.cname,this._uid=oe,this.store.uid=oe,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(as()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const me=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return k.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(me)),setTimeout(()=>{k.startUpload()},5e3),this.store.joinEnd(),j=this,$e($g).call($g,j)||$g.push(j),this._cloudProxyServerMode==="disabled"&&wn().supportWebCrypto&&Q("ENABLE_PRELOAD")&&IL(this._joinInfo),oe}catch(x){const M=Array.isArray(x)?x[0]:x;throw M&&M.code===Y.OPERATION_ABORTED?k.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),M):k.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),M),M.code!==Y.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),y.onError(M),M}var j}_joinGateway(){if(!this._joinInfo||!this._key)throw new be(Y.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Q("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){k.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(as()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=$g.indexOf(n);i!==-1&&$g.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Ln.LEAVE),k.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof kE))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new be(Y.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new be(Y.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof kE))throw new be(Y.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&n)throw new be(Y.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}k.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),n&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof ur&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),k.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw k.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){qn(e.id,"id",0,65535,!0),Qh(e.ordered,"ordered"),$i(e.metadata,"metadata",0,512),k.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const n=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new be(Y.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Q("FORCE_TURN")&&!Q("TURN_ENABLE_TCP")&&!Q("TURN_ENABLE_UDP"))throw new be(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return XG(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new be(Y.CREATE_DATACHANNEL_ERROR);try{await Je.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==Y.DISCONNECT_P2P)throw c}}return k.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw k.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let n=[];if(e)if(Array.isArray(e))n=e;else{if(!(e instanceof kE))return this._unpublishDataChannel([e]);n=[e]}else this.store.useP2P||await this._unpublishDataChannel(),n=this._p2pChannel.getAllTracks(!0);k.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(n.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.sendExtensionMessage(Xr.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.unpublish(o,this._uid),k.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(n.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw k.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),k.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const n=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),k.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw k.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{n&&n()}}async subscribe(e,n,i){if(!(e instanceof Wf)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new be(Y.INVALID_REMOTE_USER,"user is not in the channel");e=o}return n==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,n)}async presubscribe(e,n){if(Ti(n,"mediaType",["audio","video"]),this.store.useP2P)throw new be(Y.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=n===st.AUDIO,o=n===st.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:f,cname:_,uint_id:v}=await this._gateway.presubscribe(e,n,!0);if(u==null)throw new be(Y.UNEXPECTED_RESPONSE,"no ssrc id");let y=this._users.find(I=>I.uid===e);y||(y=new Wf(e,v||e),y._is_pre_created=!0,this._users.push(y)),_&&(y._cname=_),y._uintid||(y._uintid=v||e),i&&(y._audioSSRC=u,y._audio_pre_subscribed=!0,h&&(y._audioOrtc=h)),o&&(y._videoSSRC=u,y._video_pre_subscribed=!0,h&&(y._videoOrtc=h),f!=null&&(y._rtxSsrcId=f)),k.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(y,n,u,f,h);const w=i?y._audioTrack:y._videoTrack;if(!w)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(y._trust_audio_stream_added_state_=!0,y._audio_added_=!0),o&&(y._trust_video_stream_added_state_=!0,y._video_added_=!0),w}catch(u){throw k.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,n){var i;if(qn(n,"channelId",0,65535,!0),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e))throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new be(Y.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new be(Y.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(f=>f.id===n);if(!c)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const f=await this._p2pChannel.subscribeDataChannel(e,[c]);if(f&&$e(f).call(f,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new be(Y.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,n,i){if(Ti(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new be(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(n==="audio"&&!e.hasAudio||n==="video"&&!e.hasVideo)){const u=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),u}const c=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const h=n==="audio"?e._audioSSRC:e._videoSSRC,f=n==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,n,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,n,h,f)}catch(h){throw h}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=n==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,n,i){if(this.store.useP2P)return this._p2pSubscribe(e,n);if(Ti(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===e)){const v=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),v}if(!e.hasAudio&&!e.hasVideo){const v=new be(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),v}if(!(i||(n!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(n!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const v=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),v}let c=n==="audio"?e._audioSSRC:e._videoSSRC,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,f={stream_type:n==="audio"?st.AUDIO:st.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const y=n==="audio"?e._audioSSRC:e._videoSSRC;y!==void 0&&y!==c&&(c=y,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,f={stream_type:n==="audio"?st.AUDIO:st.VIDEO,ssrcId:c}),Ss.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,n,Date.now()),await this._p2pChannel.subscribe(e,n,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,f,!0)}catch(w){if((w==null?void 0:w.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,n),w;await this._p2pChannel.unsubscribe(e,n,!0),this._p2pChannel.setPendingRemoteMedia(e,n)}this.store.subscribe(e.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,n)}catch(y){throw this._p2pChannel.reportSubscribeEvent(!1,y==null?void 0:y.code,e,n),y}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(y=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),y)});const v=n==="audio"?e._audioTrack:e._videoTrack;if(!v)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),v),v}finally{_()}}async massSubscribe(e){if(Zh(e,"subscribeList"),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const n=Date.now(),i=new Map,o=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(f=>{let{user:_,mediaType:v}=f;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(v)}).join("; ")));const c=(e=[...e]).map(f=>{let{user:_,mediaType:v}=f;return{user:_,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const v=e[_],{user:y,mediaType:w}=v;if(Ti(w,"mediaType",["audio","video"]),!y){const x=new be(Y.INVALID_PARAMS,"user property does not exist in subscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),x}if(!this._users.find(x=>x===y)){const x=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");k.error("[".concat(this._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),c[_].error=x,e.splice(_,1);continue}if(w==="audio"&&(!y.hasAudio||y._audioSSRC===void 0)||w==="video"&&(!y.hasVideo||y._videoSSRC===void 0)){const x=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);k.error("[".concat(this._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(w,", remote user is not published")),c[_].error=x,e.splice(_,1);continue}const P=Pi.Video|Pi.LwoVideo,j=i.get(y);if(j){if(w==="video"?j&P:j&Pi.Audio){e.splice(_,1),k.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(w," twice"));continue}i.set(y,j|(w==="video"?P:Pi.Audio))}else i.set(y,w==="video"?P:Pi.Audio)}for(let _=e.length-1;_>=0;_--){const v=e[_],{user:y,mediaType:w}=v,I=Pi.Video|Pi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(y,w)){await this._p2pChannel.unmuteRemoteNoLock(y,w);const P=i.get(y);i.set(y,w==="video"?P^I:P^Pi.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),n);let f=Ia(h=Array.from(i.entries())).call(h,(_,v)=>{let[y,w]=v;if(w===0)return _;const I={stream_id:y.uid,stream_type:w};return w&Pi.Audio&&(I.audio_ssrc=y._audioSSRC),w&Pi.Video&&(I.video_ssrc=y._videoSSRC),_.push(I),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(v=>{let{user:y,mediaType:w}=v;return{user:y,mediaType:w,ssrcId:w===st.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:w===st.VIDEO?y._rtxSsrcId:void 0}}));const _=new Map;if(f=f.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),f.length>0){const v=await this._gateway.subscribeAll(f,!0);((v==null?void 0:v.users)||[]).forEach(y=>{let{stream_id:w,video_error_code:I,audio_error_code:P,error_code:j}=y;(I||P||j)&&_.set(w,{video_error_code:I,audio_error_code:P,error_code:j})})}if(Array.from(_.entries()).length>0){const v=[];Array.from(_.entries()).forEach(y=>{let[w,I]=y;const P=this.remoteUsers.find(j=>j.uid===w);if(P){let j;I.error_code||I.video_error_code&&I.audio_error_code?j=void 0:I.video_error_code?j=st.VIDEO:I.audio_error_code&&(j=st.AUDIO),v.push({user:P,mediaType:j})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const y=_.get(v.user.uid);if(y){const w=y.error_code||v.mediaType==="audio"&&y.audio_error_code||v.mediaType==="video"&&y.video_error_code;if(w){const I=a0(w);k.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(I.desc)),v.error=new be(Y.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(I.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var y;ht.subscribe(this.store.sessionId,{succ:!!v.error,ec:((y=v.error)===null||y===void 0?void 0:y.code)||null,video:v.mediaType===st.VIDEO,audio:v.mediaType===st.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===st.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-n),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),k.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(v=>{let{user:y,mediaType:w}=v;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(w)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,n,i){if(!(e instanceof Wf)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new be(Y.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(n||this.store.useP2P){if(n==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(n&&Ti(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(n));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,n);else{const u=await this._p2pChannel.unsubscribe(e,n);u&&await this._gateway.unsubscribe(u,e.uid),n&&n!=="audio"||(e._audio_pre_subscribed=!1),n&&n!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&SI(this._users,e),k.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(n))}}catch(u){if(u.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,n){if(n&&qn(n,"id",0,65535,!0),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof n=="number"){const c=e._dataChannels.find(u=>u.id===n);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(n,", remote datachannel is not published")),c}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),k.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Zh(e,"unsubscribeList"),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");k.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const n=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const f=new be(Y.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),f}if(Ti(c,"mediaType",["video","audio",void 0]),!this._users.find(f=>f===o)){k.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=Pi.Video|Pi.LwoVideo;if(n.has(o)){const f=n.get(o);let _;switch(c){case"video":_=f&h;break;case"audio":_=f&Pi.Audio;break;default:_=f&(Pi.Audio|h)}if(_){k.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?n.set(o,f|Pi.Audio):c==="video"&&n.set(o,f|h):n.set(o,f|Pi.Audio|h)}else c?c==="audio"?n.set(o,Pi.Audio):c==="video"&&n.set(o,h):n.set(o,Pi.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),k.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===Y.DISCONNECT_P2P)return void k.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw k.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Ie(Y.INVALID_PARAMS);kr(i.width)||i1(i.width,"streamParameter.width"),kr(i.height)||i1(i.height,"streamParameter.height"),kr(i.framerate)||i1(i.framerate,"streamParameter.framerate"),kr(i.bitrate)||qn(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const n=this._configDistribute.getLowStreamConfigDistribute();if(n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Le.LocalVideoLowTrack)}async enableDualStream(){if(!wn().supportDualStream)throw ht.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new be(Y.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new be(Y.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ht.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ht.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Le.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ht.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ht.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,n){if(function(o){Ti(o,"role",["audience","host"])}(e),n&&c1(n),this.mode==="rtc"||this.mode==="p2p")throw k.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new be(Y.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(n&&n.level&&e==="host")throw new be(Y.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new be(Y.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&Q("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,n),this._config.role=e,this._gateway.reconnect("recover",cs.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,n),this._config.role=e),k.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(n&&n.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let n=!1;try{e&&c1(e),await this._gateway.setClientRole(this._config.role,e),n=!0}catch{}finally{k.info("[".concat(this._clientId,"] set client role options ").concat(n?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const n=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!n||!n.timestamp)return 0;const i=n.timestamp-Date.now();return Math.abs(i)>1e3+n.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,n){if($i(e,"proxyServer"),!n){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ht.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),k.info("[".concat(this._clientId,"] Set proxy server ").concat(n?"by initialize call":""," success."))}setTurnServer(e,n){if(Array.isArray(e)||(e=[e]),!n){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy")}if(JT(e))return this._turnServer={servers:e,mode:"original-manual"},void k.info("[".concat(this._clientId,"] Set original turnserver ").concat(n?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>O5(i)),this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver ").concat(n?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"you should set license before join channel");if($i(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new be(Y.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,k.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy");const n=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new be(Y.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new be(Y.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Stop proxy server after leave channel");ht.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new be(Y.INVALID_PARAMS,"accessPoints is required.");Zh(e.accessPoints.serverList,"accessPoints.serverList"),$i(e.accessPoints.domain,"accessPoints.domain");const n=(I,P)=>{qn(I,P,0,65535,!0)};let i=443;if(e.accessPoints.port&&(n(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new be(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Q("CLOSE_AFB_FOR_LOCAL_AP")&&(Hn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Hn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(I=>o.test(I)?"".concat(I.replace(/\./g,"-"),".").concat(c):I),h=u.map(I=>"".concat(I,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Hn("WEBCS_DOMAIN",h),Hn("WEBCS_DOMAIN_BACKUP_LIST",h),Hn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Zh(e.report.hostname,"report.hostname"),Hn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Hn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Hn("EVENT_REPORT_DOMAIN",u[0]),Hn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let f=6443;e.report&&e.report.port&&(n(e.report.port,"report.port"),f=e.report.port),Hn("STATS_COLLECTOR_PORT",f),e.report?Hn("ENABLE_EVENT_REPORT",!0):Hn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Zh(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let v=6444;e.log&&e.log.port&&(n(e.log.port,"log.port"),v=e.log.port),Hn("LOG_UPLOAD_SERVER","".concat(_,":").concat(v));let y=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Zh(e.cds.hostname,"cds.hostname"),y=e.cds.hostname):y=u;let w=443;e.cds&&e.cds.port&&(n(e.cds.port,"cds.port"),w=e.cds.port),Hn("CDS_AP",y.map(I=>"".concat(I,":").concat(w))),e.cds?Hn("ENABLE_CONFIG_DISTRIBUTE",!0):Hn("ENABLE_CONFIG_DISTRIBUTE",!1),k.info("set local access point v2 success")}setLocalAccessPoints(e,n){if(Zh(e,"serverList"),$i(n,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new be(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(n):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Hn("WEBCS_DOMAIN",e),Hn("WEBCS_DOMAIN_BACKUP_LIST",e),Hn("GATEWAY_DOMAINS",[n]),Hn("EVENT_REPORT_DOMAIN",e[0]),Hn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Hn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),k.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ti(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(n){throw k.error("[".concat(this._clientId,"] set default remote video stream type error"),n.toString()),n}else k.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,n){Ti(n,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,n),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw k.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}k.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(e,n)}async setStreamFallbackOption(e,n){Ti(n,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,n)}catch(i){throw k.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}k.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(e,n)}setEncryptionConfig(e,n,i,o){(function(u){Ti(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),$i(n,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if($e(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new be(Y.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new be(Y.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Qh(o,"encryptDataStream"),!$e(c).call(c,e))throw new be(Y.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(n)||k.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=n,i&&(this._encryptionSalt=Lf(i))}async renewToken(e){if($i(e,"token",1,2047),!this._key||!this._joinInfo)throw new be(Y.INVALID_OPERATION,"renewToken should not be called before user join");const n=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(Q("USE_NEW_TOKEN")){k.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Zde(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pi);k.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else k.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});k.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=n,this._joinInfo.token=n,k.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?k.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(rn.VOLUME_INDICATOR,e)},Q("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),n=this._gateway.getInChannelInfo();return e.Duration=Math.round(n.duration/1e3),e}async startLiveStreaming(e,n){if(!n){if(this.codec!=="h264")throw new be(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new be(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new be(Y.LIVE_STREAMING_TASK_CONFLICT);const i=n?np.TRANSCODE:np.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(np.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!n.length)throw new be(Y.INVALID_PARAMS,"can not find live streaming url to stop");await Je.all(n.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){pz(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){pz(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof _0&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var n;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&$e(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var f;const _=Ia(f=Array.from(h)).call(f,(x,M)=>x+M,0),v={serverTs:0,seq:Sue++,length:h.length,checkSum:_},y=new Uint8Array(U5(_,2)),w=new ArrayBuffer(RE),I=new DataView(w);I.setUint32(0,v.serverTs),I.setUint16(4,v.seq),I.setUint16(6,v.length),I.setUint16(8,v.checkSum);const P=16-h.length%16;h=k5(h,new Uint8Array(P));const j=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:X5,additionalData:y},u,h);return k5(new Uint8Array(w),new Uint8Array(j))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new be(Y.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(kt.DATA_STREAM,{payload:Lf(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-che},!i)}sendMetadata(e){if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new be(Y.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(kt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Lf(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Pue),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send custom report, not joined");await ht.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,n){Ti(n.spatialLayer,"spatialLayer",[0,1,2,3]),Ti(n.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,n)}catch(i){throw k.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:n=!1,rtmFlag:i}=e;if(Qh(n,"apRTM"),qn(i,"rtmFlag",0),this._rtmConfig.apRTM=n,this._rtmConfig.rtmFlag=i,k.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=n,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(k.debug("[".concat(this._clientId,"] reset client")),function(e){const n=VE.indexOf(e);n!==-1&&VE.splice(n,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=No.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Wz(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ht.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(n=>n._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new vs("client-publish",this._clientId),this._subscribeMutex=new vs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,n){var i;const o=e||jg();e?k.debug("[".concat(this._clientId,"] new Session ").concat(o)):k.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,ht.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(n==null?void 0:n.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};ht.sessionInit(this._sessionId,jl({cname:n.channel,appid:n.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Q("FORCE_TURN")&&!Q("TURN_ENABLE_TCP")&&!Q("TURN_ENABLE_UDP"))throw new be(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");k.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Xr.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof ur&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{k.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===Y.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));k.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw i.throw(u),u}i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===Y.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const n=()=>{if(!this._joinInfo||!this._appId)return new be(Y.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},sp("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{ht.reportApiInvoke(this._sessionId,{name:hi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Dr.TRACER}).onSuccess(),this.safeEmit(rn.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{ht.reportApiInvoke(this._sessionId,{name:hi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Dr.TRACER}).onSuccess(),this.safeEmit(rn.LIVE_STREAMING_WARNING,c,u)},i.on(Q1.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new be(Y.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(f,_,v,y){const w=Q("UAP_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(I=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(I+"/api/v1?action=uap"):"https://".concat(I,"/api/v1?action=uap"));return await $de(w,f,_,v,y)})(c,this._joinInfo,this._axiosCancelSource.token,pi).then(u).catch(h)}),i};return e===np.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||n(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||n(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new be(Y.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:n,height:i}},sp("ChannelMediaRelay").create(e));o.on("state",c=>{c===aa.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(rn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(rn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,n){const{added:i,deleted:o}=e,c=[];if(n){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(f=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==f.id)&&u.push({uid:h._uintid,stream_id:f.id,ordered:f.ordered,max_retrans_times:f.maxRetransmits,metadata:f.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:f,ordered:_,max_retrans_times:v,metadata:y}=u,w=this._users.find(I=>I._uintid===h);if(!w)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(k.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),$e(c).call(c,w)||c.push(w),w._uintid||(w._uintid=h),w._dataChannels.findIndex(I=>I.id===u.stream_id)===-1){const I={id:f,ordered:!!_,maxRetransmits:v,metadata:y},P=function(j){return XG(j,!0)}(I);w._dataChannels.push(P),k.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),n||this.safeEmit(rn.USER_PUBLISHED,w,"datachannel",I)}this._p2pChannel.hasPendingRemoteDataChannel(w,u.stream_id)&&(k.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,u.stream_id).catch(I=>{k.error("[".concat(this._clientId,"] resubscribe datachannel error"),I.toString())}))}),n&&(this.safeEmit(rn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:f}=u,_=this._users.find(y=>y._uintid===h);if(!_)return void k.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=_._dataChannels.find(y=>y.id===u.stream_id);v&&(k.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[v]).then(y=>{if(_._dataChannels=_._dataChannels.filter(w=>w!==v),y)return this._gateway.unsubscribeDataChannel(y,_.uid)}),k.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(rn.USER_UNPUBLISHED,_,"datachannel",v._config))})}_handleRemoveDataChannels(e){const n=this._users.find(i=>i.uid===e.uid);if(n){if(n._dataChannels!==void 0&&n._dataChannels.length>0){k.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished datachannel")),n._dataChannels.forEach(o=>{this.safeEmit(rn.USER_UNPUBLISHED,n,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(n,n._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,n.uid)}),i()}}else k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Vi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void k.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();Object.keys(n).forEach(o=>{const{value:c,type:u,expires:h}=n[o];h&&h<=i||u||H1()||!Object.prototype.hasOwnProperty.call(II,o)||(xu[o]=c,lr[o]=c,k.debug("Update gateway parameters from config distribute",o,c))})}catch(n){k.error("Error update config from local cache",n.message)}})()}),this._gateway.on(Vi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Vi.CONNECTION_STATE_CHANGE,(e,n,i)=>{var o;if(i===Ln.FALLBACK)return;const c=()=>{this.safeEmit(rn.CONNECTION_STATE_CHANGE,e,n,i)};if(ht.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:hi.CONNECTION_STATE_CHANGE,options:[e,n,i],tag:Dr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:n,reason:i})),k.info("[".concat(this._clientId,"] signal connection state change: ").concat(n," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,f)=>{this._gateway.setStreamFallbackOption(f,h).catch(_=>{k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,f)=>{this._gateway.setRemoteVideoStreamType(f,h).catch(_=>{k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{k.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{k.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{k.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,st.AUDIO,!1)),h._trust_video_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,st.VIDEO,!1)),h._trust_audio_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(k.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(Vi.REQUEST_NEW_GATEWAY_LIST,async(e,n)=>{if(!this._joinInfo)return n(new be(Y.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await jz(jl(jl({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,Gz(o),this._joinInfo.preload=!0):(i=await fL(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[f,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:f,port:_}):c.push({host:f,port:_})}),e(c)}catch(i){n(i)}}),this._gateway.on(Vi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(rn.NETWORK_QUALITY,e)}),this._gateway.on(Vi.STREAM_TYPE_CHANGE,(e,n)=>{this.safeEmit(rn.STREAM_TYPE_CHANGED,e,n),ht.reportApiInvoke(this._sessionId,{name:hi.STREAM_TYPE_CHANGE,options:[e,n],tag:Dr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:n}))}),this._gateway.on(Vi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Vi.REQUEST_P2P_CONNECTION_PARAMS,async(e,n,i)=>{try{let o=await this._p2pChannel.getEstablishParams();Q("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),n(o)}catch(o){i(o)}}),this._gateway.on(Vi.JOIN_RESPONSE,(e,n)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:k.debug("no attributes in joinResponse");const o=VG(e.ortc,n,i);this._p2pChannel.connect(o)}),this._gateway.on(Vi.PRE_CONNECT_PC,async e=>{const{candidates:n,fingerprint:i}=e;if(this._joinInfo&&n.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=Q("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:n,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(on.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(on.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(on.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(on.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(on.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(on.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(on.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(on.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(on.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,st.AUDIO,!0)),this._gateway.signal.on(on.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,st.AUDIO,!1)),this._gateway.signal.on(on.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,st.VIDEO,!0)),this._gateway.signal.on(on.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,st.VIDEO,!1)),this._gateway.signal.on(on.RECEIVE_METADATA,e=>{const n=Fg(e.metadata);this.safeEmit(rn.RECEIVE_METADATA,e.uid,n)}),this._gateway.signal.on(on.ON_DATA_STREAM,async e=>{var n;if(!e)return;let i=Fg(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&$e(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)){if(e.payload.length<RE)throw new be(Y.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(RE));i=await async function(u,h,f){const _=f.subarray(0,RE),v=_.slice(8,RE),y=(v[0]<<8)+v[1],w=(_[6]<<8)+_[7],I=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:X5,additionalData:new Uint8Array(U5(y,2))},h,f.subarray(RE));return new Uint8Array(I).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(f=>f.uid===e.uid),h=c==null?void 0:c.audioRecv.find(f=>f.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),uhe(jl(jl({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(on.ON_CRYPT_ERROR,()=>{Df(()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(rn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(on.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(on.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ln.TOKEN_EXPIRE),this.safeEmit(rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(on.ON_STREAM_FALLBACK_UPDATE,e=>{k.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(rn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(on.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),k.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(on.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(on.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(xt.REQUEST_TIMEOUT,(e,n)=>{if(this._joinInfo)switch(e){case kt.PUBLISH:{if(!n)return;const c=n.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:v}=_;return v===jn.Audio}),h=c.some(_=>{let{stream_type:v}=_;return v!==jn.Audio}),f=c.some(_=>{let{stream_type:v}=_;return v===jn.Screen||v===jn.ScreenLow});n.state==="offer"&&ht.publish(this._joinInfo.sid,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Y.TIMEOUT,audio:u,video:h,p2pid:n.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:u?(i=c.find(_=>{let{stream_type:v}=_;return v===jn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:v}=_;return v!==jn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case kt.SUBSCRIBE:n&&ht.subscribe(this._joinInfo.sid,{succ:!1,ec:Y.TIMEOUT,audio:n.stream_type===st.AUDIO,video:n.stream_type===st.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:this.store.p2pId,eventElapse:Ss.measureFromSubscribeStart(this.store.clientId,n.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(n.ssrcId)})}}),this._gateway.signal.on(on.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(on.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Q("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!qg(o.string_id||o.stream_id,this.channelName)));const n=[],i=[];for(const o of e.users){let c=this._users.find(y=>y._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Wf(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(rn.PUBLISHED_USER_LIST).length===0&&(k.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(rn.USER_JOINED,c)));const u=Pi.Audio&o.stream_type,h=(Pi.Video|Pi.LwoVideo)&o.stream_type,f=(65280&o.stream_type)!=0,_=u&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(rn.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(rn.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(rn.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(rn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!v||f)&&n.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(k.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{k.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(rn.PUBLISHED_USER_LIST).length>0?Q("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=n:(k.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(n.map(o=>o.uid).join(", "))),this.safeEmit(rn.PUBLISHED_USER_LIST,n)):k.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(n.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(on.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:n}=e;this._p2pChannel instanceof _0&&this._p2pChannel.updateRemoteRTPCapabilities(n.map(i=>i.toLowerCase()).filter(i=>{var o;return $e(o=Object.keys(AI)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(on.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Xr.PUBLISH,(e,n,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:f,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,f);const v=this._users.find(y=>y.uid===o);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,h[0].ssrcId,f).then(()=>{n()}).catch(i):n(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(Xr.CALL,async(e,n,i)=>{if(this.store.useP2P)try{var o;n(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(xt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Xr.UNPUBLISH,async(e,n,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void n();try{o.forEach(async h=>{let{stream_type:f}=h;const _=f===jn.Audio?st.AUDIO:st.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),n()}catch(h){i(h)}}}),this._gateway.signal.on(Xr.CONTROL,async(e,n)=>{const{action:i}=e;switch(i){case Uf.MUTE_LOCAL_VIDEO:this._handleMuteStream(n,st.VIDEO,!0);break;case Uf.MUTE_LOCAL_AUDIO:this._handleMuteStream(n,st.AUDIO,!0);break;case Uf.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",n),this._handleMuteStream(n,st.VIDEO,!1);break;case Uf.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",n),this._handleMuteStream(n,st.AUDIO,!1)}}),this._gateway.signal.on(Xr.RESTART_ICE,async(e,n,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==ao.SEND_ONLY||c?n(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),n())}catch(o){i(o)}}),this._gateway.signal.on(Xr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:n,direction:i}=e;this._p2pChannel.addRemoteCandidate(n,i)}}),this._p2pChannel.on(Rt.RequestP2PRestartICE,async(e,n,i)=>{try{const{direction:o}=e;n(await this._gateway.sendExtensionMessage(Xr.RESTART_ICE,e,o===ao.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(Rt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Xr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Rt.RequestP2PMuteLocal,async(e,n,i)=>{try{await this._gateway.sendExtensionMessage(Xr.CONTROL,e,!0),n()}catch(o){i(o)}}),this._p2pChannel.on(Rt.RequestP2PUnmuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Rt.RequestP2PMuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Rt.StateChange,(e,n)=>{n===xn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Rt.PeerConnectionStateChange,e=>{const n=this._peerConnectionState;e!==n&&(this.safeEmit(rn.PEERCONNECTION_STATE_CHANGE,e,n),this._peerConnectionState=e)}),this._p2pChannel.on(Rt.RequestMuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Rt.RequestUnmuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Rt.RequestRePublish,(e,n,i)=>{this.publish(e,!1).then(n).catch(i)}),this._p2pChannel.on(Rt.RequestRePublishDataChannel,(e,n,i)=>{Je.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw u}})).then(n).catch(i)}),this._p2pChannel.on(Rt.RequestReSubscribe,async(e,n,i)=>{try{for(const{user:o,kind:c}of e)c===st.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");n()}catch(o){i(o)}}),this._p2pChannel.on(Rt.RequestUpload,(e,n)=>{this._gateway.upload(e,n)}),this._p2pChannel.on(Rt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Rt.MediaReconnectStart,e=>{this.safeEmit(rn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Rt.MediaReconnectEnd,e=>{this.safeEmit(rn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Rt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Rt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const n=await this._p2pChannel.restartICE(e),i=await n.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void n.throw(h)}const{iceParameters:u}=function(h){const f=h.iceParameters;return{iceParameters:{iceUfrag:f.iceUfrag,icePwd:f.icePwd}}}(c);await n.next({remoteIceParameters:u})}),this._p2pChannel.on(Rt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Rt.RequestReconnectPC,async()=>{var e;const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:n,dtlsParameters:i,rtpCapabilities:o}),h=VG(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Rt.RequestUnpublishForReconnectPC,async(e,n,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),n()):i()}),this._p2pChannel.on(Rt.P2PLost,()=>{this.safeEmit(rn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Rt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Rt.ConnectionTypeChange,e=>{this.safeEmit(rn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Rt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Rt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Rt.AudioMetadata,e=>{this.safeEmit(rn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(n={config:e},sp("ContentInspect").create(n));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:f,cid:_,vid:v}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:f,cid:_,vid:v?Number(v):0},pi)}catch(i){throw Array.isArray(i)?i[0]:i}var n}handleVideoInspectEvents(e){e.on(Fi.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(rn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,i),i===Ml.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(rn.CONTENT_INSPECT_ERROR,new be(Y.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Fi.INSPECT_RESULT,(n,i)=>{var o;if((i==null?void 0:i.code)===Y.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return k.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(rn.CONTENT_INSPECT_RESULT,n,i)}),e.on(Fi.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,n){if(Qh(e,"enabled"),e){if(!n)throw new be(Y.INVALID_PARAMS,"config is required");if(n8(n),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(n);else{const o=(i={config:n},sp("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:f,uid:_,cid:v,vid:y}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:f,uid:_,cid:v,vid:y?Number(y):0},pi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(Vu.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(rn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,n,i),n===Qc.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new be(Y.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Vu.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(n){Ti(n,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new be(Y.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,k.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return k.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Qh(e,"enabled"),Hn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,n){switch(n){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ct(tt.prototype,"leave",[r8],Object.getOwnPropertyDescriptor(tt.prototype,"leave"),tt.prototype),ct(tt.prototype,"publish",[i8],Object.getOwnPropertyDescriptor(tt.prototype,"publish"),tt.prototype),ct(tt.prototype,"unpublish",[s8],Object.getOwnPropertyDescriptor(tt.prototype,"unpublish"),tt.prototype),ct(tt.prototype,"subscribe",[o8],Object.getOwnPropertyDescriptor(tt.prototype,"subscribe"),tt.prototype),ct(tt.prototype,"presubscribe",[a8],Object.getOwnPropertyDescriptor(tt.prototype,"presubscribe"),tt.prototype),ct(tt.prototype,"massSubscribe",[c8],Object.getOwnPropertyDescriptor(tt.prototype,"massSubscribe"),tt.prototype),ct(tt.prototype,"unsubscribe",[l8],Object.getOwnPropertyDescriptor(tt.prototype,"unsubscribe"),tt.prototype),ct(tt.prototype,"massUnsubscribe",[u8],Object.getOwnPropertyDescriptor(tt.prototype,"massUnsubscribe"),tt.prototype),ct(tt.prototype,"setLowStreamParameter",[d8],Object.getOwnPropertyDescriptor(tt.prototype,"setLowStreamParameter"),tt.prototype),ct(tt.prototype,"enableDualStream",[h8],Object.getOwnPropertyDescriptor(tt.prototype,"enableDualStream"),tt.prototype),ct(tt.prototype,"disableDualStream",[p8],Object.getOwnPropertyDescriptor(tt.prototype,"disableDualStream"),tt.prototype),ct(tt.prototype,"setClientRole",[f8],Object.getOwnPropertyDescriptor(tt.prototype,"setClientRole"),tt.prototype),ct(tt.prototype,"_setClientRoleOptions",[m8],Object.getOwnPropertyDescriptor(tt.prototype,"_setClientRoleOptions"),tt.prototype),ct(tt.prototype,"setProxyServer",[g8],Object.getOwnPropertyDescriptor(tt.prototype,"setProxyServer"),tt.prototype),ct(tt.prototype,"setTurnServer",[_8],Object.getOwnPropertyDescriptor(tt.prototype,"setTurnServer"),tt.prototype),ct(tt.prototype,"setLicense",[v8],Object.getOwnPropertyDescriptor(tt.prototype,"setLicense"),tt.prototype),ct(tt.prototype,"startProxyServer",[E8],Object.getOwnPropertyDescriptor(tt.prototype,"startProxyServer"),tt.prototype),ct(tt.prototype,"stopProxyServer",[y8],Object.getOwnPropertyDescriptor(tt.prototype,"stopProxyServer"),tt.prototype),ct(tt.prototype,"setLocalAccessPointsV2",[S8],Object.getOwnPropertyDescriptor(tt.prototype,"setLocalAccessPointsV2"),tt.prototype),ct(tt.prototype,"setLocalAccessPoints",[T8],Object.getOwnPropertyDescriptor(tt.prototype,"setLocalAccessPoints"),tt.prototype),ct(tt.prototype,"setRemoteDefaultVideoStreamType",[b8],Object.getOwnPropertyDescriptor(tt.prototype,"setRemoteDefaultVideoStreamType"),tt.prototype),ct(tt.prototype,"setRemoteVideoStreamType",[w8],Object.getOwnPropertyDescriptor(tt.prototype,"setRemoteVideoStreamType"),tt.prototype),ct(tt.prototype,"setStreamFallbackOption",[R8],Object.getOwnPropertyDescriptor(tt.prototype,"setStreamFallbackOption"),tt.prototype),ct(tt.prototype,"setEncryptionConfig",[C8],Object.getOwnPropertyDescriptor(tt.prototype,"setEncryptionConfig"),tt.prototype),ct(tt.prototype,"renewToken",[I8],Object.getOwnPropertyDescriptor(tt.prototype,"renewToken"),tt.prototype),ct(tt.prototype,"enableAudioVolumeIndicator",[A8],Object.getOwnPropertyDescriptor(tt.prototype,"enableAudioVolumeIndicator"),tt.prototype),ct(tt.prototype,"startLiveStreaming",[O8],Object.getOwnPropertyDescriptor(tt.prototype,"startLiveStreaming"),tt.prototype),ct(tt.prototype,"setLiveTranscoding",[P8],Object.getOwnPropertyDescriptor(tt.prototype,"setLiveTranscoding"),tt.prototype),ct(tt.prototype,"stopLiveStreaming",[N8],Object.getOwnPropertyDescriptor(tt.prototype,"stopLiveStreaming"),tt.prototype),ct(tt.prototype,"startChannelMediaRelay",[k8],Object.getOwnPropertyDescriptor(tt.prototype,"startChannelMediaRelay"),tt.prototype),ct(tt.prototype,"updateChannelMediaRelay",[D8],Object.getOwnPropertyDescriptor(tt.prototype,"updateChannelMediaRelay"),tt.prototype),ct(tt.prototype,"stopChannelMediaRelay",[L8],Object.getOwnPropertyDescriptor(tt.prototype,"stopChannelMediaRelay"),tt.prototype),ct(tt.prototype,"sendCustomReportMessage",[x8],Object.getOwnPropertyDescriptor(tt.prototype,"sendCustomReportMessage"),tt.prototype),ct(tt.prototype,"pickSVCLayer",[M8],Object.getOwnPropertyDescriptor(tt.prototype,"pickSVCLayer"),tt.prototype),ct(tt.prototype,"setRTMConfig",[U8],Object.getOwnPropertyDescriptor(tt.prototype,"setRTMConfig"),tt.prototype),ct(tt.prototype,"enableContentInspect",[V8],Object.getOwnPropertyDescriptor(tt.prototype,"enableContentInspect"),tt.prototype),ct(tt.prototype,"disableContentInspect",[F8],Object.getOwnPropertyDescriptor(tt.prototype,"disableContentInspect"),tt.prototype),ct(tt.prototype,"setImageModeration",[j8],Object.getOwnPropertyDescriptor(tt.prototype,"setImageModeration"),tt.prototype),ct(tt.prototype,"setP2PTransport",[B8],Object.getOwnPropertyDescriptor(tt.prototype,"setP2PTransport"),tt.prototype),ct(tt.prototype,"getJoinChannelServiceRecords",[W8],Object.getOwnPropertyDescriptor(tt.prototype,"getJoinChannelServiceRecords"),tt.prototype),ct(tt.prototype,"setPublishAudioFilterEnabled",[G8],Object.getOwnPropertyDescriptor(tt.prototype,"setPublishAudioFilterEnabled"),tt.prototype),tt);class y0{constructor(n,i){G(this,"id",0),G(this,"element",void 0),G(this,"peerPair",void 0),G(this,"context",void 0),G(this,"audioPlayerElement",void 0),G(this,"audioTrack",void 0),y0.count+=1,this.id=y0.count,this.element=n,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const i=document.createElement("audio");i.srcObject=new MediaStream([n.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const n=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new Je(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await n(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await n(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new be(Y.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(n){if(this.audioTrack)return this.audioTrack;let i;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(n).connect(i)}catch(c){throw new be(Y.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new be(Y.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const n=this.element,i=await this.getTracksFromMediaElement(n);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){k.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var H8,yA;G(y0,"count",0);const Ihe=window.AudioContext||window.webkitAudioContext,Ahe=new(H8=Ot({report:ht}),ct((yA=class{constructor(){G(this,"units",[]),G(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return k.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ihe);let n=this.units.find(i=>i&&i.getElement()===e);return n||(n=new y0(e,this.context),this.units.push(n)),n.startEchoCancellation(),k.debug("start processing local audio echo cancellation, id is",n.id),n.id}_doesEnvironmentNeedAEC(){return mn().name!==An.SAFARI}}).prototype,"processExternalMediaAEC",[H8],Object.getOwnPropertyDescriptor(yA.prototype,"processExternalMediaAEC"),yA.prototype),yA);function K8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function $8(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?K8(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):K8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const PL=window||document;function q8(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!PL)return;const i=fi._cspEventHandlerPointer;if(i&&n)return void console.error(i,n);const o=c=>{if(!(c&&c.blockedURI&&(fi.onSecurityPolicyViolation||fi.getListeners(xd.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;Q("CSP_DETECTED_HOSTNAME_LIST").some(h=>$e(u).call(u,h))&&(fi.onSecurityPolicyViolation&&typeof fi.onSecurityPolicyViolation=="function"&&fi.onSecurityPolicyViolation(c),fi.getListeners(xd.SECURITY_POLICY_VIOLATION).length>0&&fi.safeEmit(xd.SECURITY_POLICY_VIOLATION,c))};i&&PL.removeEventListener("securitypolicyviolation",i),(n||e&&typeof e=="function"||fi.getListeners(xd.SECURITY_POLICY_VIOLATION).length>0)&&PL.addEventListener("securitypolicyviolation",o),fi._cspEventHandlerPointer=o}var Ohe=N,Phe=N3,Y8=RegExp.prototype,Nhe=function(e){return e===Y8||Ohe(Y8,e)?Phe(e):e.flags},Ks=l(Nhe);function QE(e){let n=e.length;for(;--n>=0;)e[n]=0}const NL=256,X8=286,S0=30,T0=15,kL=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),SA=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),khe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),J8=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cp=new Array(576);QE(cp);const b0=new Array(60);QE(b0);const w0=new Array(512);QE(w0);const R0=new Array(256);QE(R0);const DL=new Array(29);QE(DL);const TA=new Array(S0);function LL(e,n,i,o,c){this.static_tree=e,this.extra_bits=n,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let Q8,Z8,eH;function xL(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}QE(TA);const tH=e=>e<256?w0[e]:w0[256+(e>>>7)],C0=(e,n)=>{e.pending_buf[e.pending++]=255&n,e.pending_buf[e.pending++]=n>>>8&255},Sc=(e,n,i)=>{e.bi_valid>16-i?(e.bi_buf|=n<<e.bi_valid&65535,C0(e,e.bi_buf),e.bi_buf=n>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=i)},jd=(e,n,i)=>{Sc(e,i[2*n],i[2*n+1])},nH=(e,n)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--n>0);return i>>>1},rH=(e,n,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=T0;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=n;u++){let f=e[2*u+1];f!==0&&(e[2*u]=nH(o[f]++,f))}},iH=e=>{let n;for(n=0;n<X8;n++)e.dyn_ltree[2*n]=0;for(n=0;n<S0;n++)e.dyn_dtree[2*n]=0;for(n=0;n<19;n++)e.bl_tree[2*n]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},sH=e=>{e.bi_valid>8?C0(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},oH=(e,n,i,o)=>{const c=2*n,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[n]<=o[i]},ML=(e,n,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&oH(n,e.heap[c+1],e.heap[c],e.depth)&&c++,!oH(n,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},aH=(e,n,i)=>{let o,c,u,h,f=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+f++],o+=(255&e.pending_buf[e.sym_buf+f++])<<8,c=e.pending_buf[e.sym_buf+f++],o===0?jd(e,c,n):(u=R0[c],jd(e,u+NL+1,n),h=kL[u],h!==0&&(c-=DL[u],Sc(e,c,h)),o--,u=tH(o),jd(e,u,i),h=SA[u],h!==0&&(o-=TA[u],Sc(e,o,h)));while(f<e.sym_next);jd(e,256,n)},UL=(e,n)=>{const i=n.dyn_tree,o=n.stat_desc.static_tree,c=n.stat_desc.has_stree,u=n.stat_desc.elems;let h,f,_,v=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=v=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=v<2?++v:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(n.max_code=v,h=e.heap_len>>1;h>=1;h--)ML(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ML(e,i,1),f=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=f,i[2*_]=i[2*h]+i[2*f],e.depth[_]=(e.depth[h]>=e.depth[f]?e.depth[h]:e.depth[f])+1,i[2*h+1]=i[2*f+1]=_,e.heap[1]=_++,ML(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((y,w)=>{const I=w.dyn_tree,P=w.max_code,j=w.stat_desc.static_tree,x=w.stat_desc.has_stree,M=w.stat_desc.extra_bits,$=w.stat_desc.extra_base,q=w.stat_desc.max_length;let oe,me,ge,fe,Re,Ue,Qe=0;for(fe=0;fe<=T0;fe++)y.bl_count[fe]=0;for(I[2*y.heap[y.heap_max]+1]=0,oe=y.heap_max+1;oe<573;oe++)me=y.heap[oe],fe=I[2*I[2*me+1]+1]+1,fe>q&&(fe=q,Qe++),I[2*me+1]=fe,me>P||(y.bl_count[fe]++,Re=0,me>=$&&(Re=M[me-$]),Ue=I[2*me],y.opt_len+=Ue*(fe+Re),x&&(y.static_len+=Ue*(j[2*me+1]+Re)));if(Qe!==0){do{for(fe=q-1;y.bl_count[fe]===0;)fe--;y.bl_count[fe]--,y.bl_count[fe+1]+=2,y.bl_count[q]--,Qe-=2}while(Qe>0);for(fe=q;fe!==0;fe--)for(me=y.bl_count[fe];me!==0;)ge=y.heap[--oe],ge>P||(I[2*ge+1]!==fe&&(y.opt_len+=(fe-I[2*ge+1])*I[2*ge],I[2*ge+1]=fe),me--)}})(e,n),rH(i,v,e.bl_count)},cH=(e,n,i)=>{let o,c,u=-1,h=n[1],f=0,_=7,v=4;for(h===0&&(_=138,v=3),n[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=n[2*(o+1)+1],++f<_&&c===h||(f<v?e.bl_tree[2*c]+=f:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):f<=10?e.bl_tree[34]++:e.bl_tree[36]++,f=0,u=c,h===0?(_=138,v=3):c===h?(_=6,v=3):(_=7,v=4))},lH=(e,n,i)=>{let o,c,u=-1,h=n[1],f=0,_=7,v=4;for(h===0&&(_=138,v=3),o=0;o<=i;o++)if(c=h,h=n[2*(o+1)+1],!(++f<_&&c===h)){if(f<v)do jd(e,c,e.bl_tree);while(--f!=0);else c!==0?(c!==u&&(jd(e,c,e.bl_tree),f--),jd(e,16,e.bl_tree),Sc(e,f-3,2)):f<=10?(jd(e,17,e.bl_tree),Sc(e,f-3,3)):(jd(e,18,e.bl_tree),Sc(e,f-11,7));f=0,u=c,h===0?(_=138,v=3):c===h?(_=6,v=3):(_=7,v=4)}};let uH=!1;const dH=(e,n,i,o)=>{Sc(e,0+(o?1:0),3),sH(e),C0(e,i),C0(e,~i),i&&e.pending_buf.set(e.window.subarray(n,n+i),e.pending),e.pending+=i};var Dhe=e=>{uH||((()=>{let n,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(DL[c]=o,n=0;n<1<<kL[c];n++)R0[o++]=c;for(R0[o-1]=c,u=0,c=0;c<16;c++)for(TA[c]=u,n=0;n<1<<SA[c];n++)w0[u++]=c;for(u>>=7;c<S0;c++)for(TA[c]=u<<7,n=0;n<1<<SA[c]-7;n++)w0[256+u++]=c;for(i=0;i<=T0;i++)h[i]=0;for(n=0;n<=143;)cp[2*n+1]=8,n++,h[8]++;for(;n<=255;)cp[2*n+1]=9,n++,h[9]++;for(;n<=279;)cp[2*n+1]=7,n++,h[7]++;for(;n<=287;)cp[2*n+1]=8,n++,h[8]++;for(rH(cp,287,h),n=0;n<S0;n++)b0[2*n+1]=5,b0[2*n]=nH(n,5);Q8=new LL(cp,kL,257,X8,T0),Z8=new LL(b0,SA,0,S0,T0),eH=new LL(new Array(0),khe,0,19,7)})(),uH=!0),e.l_desc=new xL(e.dyn_ltree,Q8),e.d_desc=new xL(e.dyn_dtree,Z8),e.bl_desc=new xL(e.bl_tree,eH),e.bi_buf=0,e.bi_valid=0,iH(e)},Lhe=(e,n,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(f=>{let _,v=4093624447;for(_=0;_<=31;_++,v>>>=1)if(1&v&&f.dyn_ltree[2*_]!==0)return 0;if(f.dyn_ltree[18]!==0||f.dyn_ltree[20]!==0||f.dyn_ltree[26]!==0)return 1;for(_=32;_<NL;_++)if(f.dyn_ltree[2*_]!==0)return 1;return 0})(e)),UL(e,e.l_desc),UL(e,e.d_desc),h=(f=>{let _;for(cH(f,f.dyn_ltree,f.l_desc.max_code),cH(f,f.dyn_dtree,f.d_desc.max_code),UL(f,f.bl_desc),_=18;_>=3&&f.bl_tree[2*J8[_]+1]===0;_--);return f.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&n!==-1?dH(e,n,i,o):e.strategy===4||u===c?(Sc(e,2+(o?1:0),3),aH(e,cp,b0)):(Sc(e,4+(o?1:0),3),((f,_,v,y)=>{let w;for(Sc(f,_-257,5),Sc(f,v-1,5),Sc(f,y-4,4),w=0;w<y;w++)Sc(f,f.bl_tree[2*J8[w]+1],3);lH(f,f.dyn_ltree,_-1),lH(f,f.dyn_dtree,v-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),aH(e,e.dyn_ltree,e.dyn_dtree)),iH(e),o&&sH(e)},xhe=(e,n,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=n,e.pending_buf[e.sym_buf+e.sym_next++]=n>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,n===0?e.dyn_ltree[2*i]++:(e.matches++,n--,e.dyn_ltree[2*(R0[i]+NL+1)]++,e.dyn_dtree[2*tH(n)]++),e.sym_next===e.sym_end),Mhe=e=>{Sc(e,2,3),jd(e,256,cp),(n=>{n.bi_valid===16?(C0(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(e)},Uhe={_tr_init:Dhe,_tr_stored_block:dH,_tr_flush_block:Lhe,_tr_tally:xhe,_tr_align:Mhe},I0=(e,n,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+n[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Vhe=new Uint32Array((()=>{let e,n=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;n[i]=e}return n})());var lo=(e,n,i,o)=>{const c=Vhe,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^n[h])];return-1^e},r_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},bA={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Fhe,_tr_stored_block:VL,_tr_flush_block:jhe,_tr_tally:Kf,_tr_align:Bhe}=Uhe,{Z_NO_FLUSH:$f,Z_PARTIAL_FLUSH:Whe,Z_FULL_FLUSH:Ghe,Z_FINISH:Bl,Z_BLOCK:hH,Z_OK:Mo,Z_STREAM_END:pH,Z_STREAM_ERROR:Bd,Z_DATA_ERROR:zhe,Z_BUF_ERROR:FL,Z_DEFAULT_COMPRESSION:Hhe,Z_FILTERED:Khe,Z_HUFFMAN_ONLY:wA,Z_RLE:$he,Z_FIXED:qhe,Z_DEFAULT_STRATEGY:Yhe,Z_UNKNOWN:Xhe,Z_DEFLATED:RA}=bA,jL=286,Jhe=30,Qhe=19,Zhe=2*jL+1,epe=15,i_=258,Wd=262,ZE=42,s_=113,A0=666,o_=(e,n)=>(e.msg=r_[n],n),fH=e=>2*e-(e>4?9:0),qf=e=>{let n=e.length;for(;--n>=0;)e[n]=0},tpe=e=>{let n,i,o,c=e.w_size;n=e.hash_size,o=n;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--n);n=c,o=n;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--n)};let Yf=(e,n,i)=>(n<<e.hash_shift^i)&e.hash_mask;const el=e=>{const n=e.state;let i=n.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),e.next_out),e.next_out+=i,n.pending_out+=i,e.total_out+=i,e.avail_out-=i,n.pending-=i,n.pending===0&&(n.pending_out=0))},tl=(e,n)=>{jhe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,el(e.strm)},Gr=(e,n)=>{e.pending_buf[e.pending++]=n},O0=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=255&n},BL=(e,n,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,n.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=I0(e.adler,n,c,i):e.state.wrap===2&&(e.adler=lo(e.adler,n,c,i)),e.next_in+=c,e.total_in+=c,c)},mH=(e,n)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,f=e.nice_match;const _=e.strstart>e.w_size-Wd?e.strstart-(e.w_size-Wd):0,v=e.window,y=e.w_mask,w=e.prev,I=e.strstart+i_;let P=v[u+h-1],j=v[u+h];e.prev_length>=e.good_match&&(c>>=2),f>e.lookahead&&(f=e.lookahead);do if(i=n,v[i+h]===j&&v[i+h-1]===P&&v[i]===v[u]&&v[++i]===v[u+1]){u+=2,i++;do;while(v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&u<I);if(o=i_-(I-u),u=I-i_,o>h){if(e.match_start=n,h=o,o>=f)break;P=v[u+h-1],j=v[u+h]}}while((n=w[n&y])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},ey=e=>{const n=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-Wd)&&(e.window.set(e.window.subarray(n,n+n-o),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),tpe(e),o+=n),e.strm.avail_in===0)break;if(i=BL(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Yf(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Yf(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Wd&&e.strm.avail_in!==0)},gH=(e,n)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,f=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&n!==Bl||n===$f||i!==o+e.strm.avail_in)))break;h=n===Bl&&i===o+e.strm.avail_in?1:0,VL(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,el(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(BL(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return f-=e.strm.avail_in,f&&(f>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=f&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-f,e.strm.next_in),e.strstart),e.strstart+=f,e.insert+=f>e.w_size-e.insert?e.w_size-e.insert:f),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:n!==$f&&n!==Bl&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(BL(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||n===Bl)&&n!==$f&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=n===Bl&&e.strm.avail_in===0&&i===o?1:0,VL(e,e.block_start,i,h),e.block_start+=i,el(e.strm)),h?3:1)},WL=(e,n)=>{let i,o;for(;;){if(e.lookahead<Wd){if(ey(e),e.lookahead<Wd&&n===$f)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Yf(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Wd&&(e.match_length=mH(e,i)),e.match_length>=3)if(o=Kf(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Yf(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Yf(e,e.ins_h,e.window[e.strstart+1]);else o=Kf(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(tl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,n===Bl?(tl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(tl(e,!1),e.strm.avail_out===0)?1:2},ty=(e,n)=>{let i,o,c;for(;;){if(e.lookahead<Wd){if(ey(e),e.lookahead<Wd&&n===$f)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Yf(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Wd&&(e.match_length=mH(e,i),e.match_length<=5&&(e.strategy===Khe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Kf(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Yf(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(tl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Kf(e,0,e.window[e.strstart-1]),o&&tl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Kf(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,n===Bl?(tl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(tl(e,!1),e.strm.avail_out===0)?1:2};function Gd(e,n,i,o,c){this.good_length=e,this.max_lazy=n,this.nice_length=i,this.max_chain=o,this.func=c}const P0=[new Gd(0,0,0,0,gH),new Gd(4,4,8,4,WL),new Gd(4,5,16,8,WL),new Gd(4,6,32,32,WL),new Gd(4,4,16,16,ty),new Gd(8,16,32,32,ty),new Gd(8,16,128,128,ty),new Gd(8,32,128,256,ty),new Gd(32,128,258,1024,ty),new Gd(32,258,258,4096,ty)];function npe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=RA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Zhe),this.dyn_dtree=new Uint16Array(2*(2*Jhe+1)),this.bl_tree=new Uint16Array(2*(2*Qhe+1)),qf(this.dyn_ltree),qf(this.dyn_dtree),qf(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(epe+1),this.heap=new Uint16Array(2*jL+1),qf(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jL+1),qf(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const N0=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.status!==ZE&&n.status!==57&&n.status!==69&&n.status!==73&&n.status!==91&&n.status!==103&&n.status!==s_&&n.status!==A0?1:0},_H=e=>{if(N0(e))return o_(e,Bd);e.total_in=e.total_out=0,e.data_type=Xhe;const n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?57:n.wrap?ZE:s_,e.adler=n.wrap===2?0:1,n.last_flush=-2,Fhe(n),Mo},vH=e=>{const n=_H(e);return n===Mo&&(i=>{i.window_size=2*i.w_size,qf(i.head),i.max_lazy_match=P0[i.level].max_lazy,i.good_match=P0[i.level].good_length,i.nice_match=P0[i.level].nice_length,i.max_chain_length=P0[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),n},EH=(e,n,i,o,c,u)=>{if(!e)return Bd;let h=1;if(n===Hhe&&(n=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==RA||o<8||o>15||n<0||n>9||u<0||u>qhe||o===8&&h!==1)return o_(e,Bd);o===8&&(o=9);const f=new npe;return e.state=f,f.strm=e,f.status=ZE,f.wrap=h,f.gzhead=null,f.w_bits=o,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=c+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<c+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=n,f.strategy=u,f.method=i,vH(e)};var rpe=(e,n)=>{if(N0(e)||n>hH||n<0)return e?o_(e,Bd):Bd;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===A0&&n!==Bl)return o_(e,e.avail_out===0?FL:Bd);const o=i.last_flush;if(i.last_flush=n,i.pending!==0){if(el(e),e.avail_out===0)return i.last_flush=-1,Mo}else if(e.avail_in===0&&fH(n)<=fH(o)&&n!==Bl)return o_(e,FL);if(i.status===A0&&e.avail_in!==0)return o_(e,FL);if(i.status===ZE&&i.wrap===0&&(i.status=s_),i.status===ZE){let c=RA+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=wA||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,O0(i,c),i.strstart!==0&&(O0(i,e.adler>>>16),O0(i,65535&e.adler)),e.adler=1,i.status=s_,el(e),i.pending!==0)return i.last_flush=-1,Mo}if(i.status===57){if(e.adler=0,Gr(i,31),Gr(i,139),Gr(i,8),i.gzhead)Gr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Gr(i,255&i.gzhead.time),Gr(i,i.gzhead.time>>8&255),Gr(i,i.gzhead.time>>16&255),Gr(i,i.gzhead.time>>24&255),Gr(i,i.level===9?2:i.strategy>=wA||i.level<2?4:0),Gr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Gr(i,255&i.gzhead.extra.length),Gr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=lo(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,i.level===9?2:i.strategy>=wA||i.level<2?4:0),Gr(i,3),i.status=s_,el(e),i.pending!==0)return i.last_flush=-1,Mo}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let f=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+f),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=lo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=f,el(e),i.pending!==0)return i.last_flush=-1,Mo;c=0,u-=f}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=lo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=lo(e.adler,i.pending_buf,i.pending-u,u)),el(e),i.pending!==0)return i.last_flush=-1,Mo;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Gr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=lo(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=lo(e.adler,i.pending_buf,i.pending-u,u)),el(e),i.pending!==0)return i.last_flush=-1,Mo;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Gr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=lo(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(el(e),i.pending!==0))return i.last_flush=-1,Mo;Gr(i,255&e.adler),Gr(i,e.adler>>8&255),e.adler=0}if(i.status=s_,el(e),i.pending!==0)return i.last_flush=-1,Mo}if(e.avail_in!==0||i.lookahead!==0||n!==$f&&i.status!==A0){let c=i.level===0?gH(i,n):i.strategy===wA?((u,h)=>{let f;for(;;){if(u.lookahead===0&&(ey(u),u.lookahead===0)){if(h===$f)return 1;break}if(u.match_length=0,f=Kf(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,f&&(tl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Bl?(tl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(tl(u,!1),u.strm.avail_out===0)?1:2})(i,n):i.strategy===$he?((u,h)=>{let f,_,v,y;const w=u.window;for(;;){if(u.lookahead<=i_){if(ey(u),u.lookahead<=i_&&h===$f)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,_=w[v],_===w[++v]&&_===w[++v]&&_===w[++v])){y=u.strstart+i_;do;while(_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&v<y);u.match_length=i_-(y-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(f=Kf(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(f=Kf(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),f&&(tl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Bl?(tl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(tl(u,!1),u.strm.avail_out===0)?1:2})(i,n):P0[i.level].func(i,n);if(c!==3&&c!==4||(i.status=A0),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),Mo;if(c===2&&(n===Whe?Bhe(i):n!==hH&&(VL(i,0,0,!1),n===Ghe&&(qf(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),el(e),e.avail_out===0))return i.last_flush=-1,Mo}return n!==Bl?Mo:i.wrap<=0?pH:(i.wrap===2?(Gr(i,255&e.adler),Gr(i,e.adler>>8&255),Gr(i,e.adler>>16&255),Gr(i,e.adler>>24&255),Gr(i,255&e.total_in),Gr(i,e.total_in>>8&255),Gr(i,e.total_in>>16&255),Gr(i,e.total_in>>24&255)):(O0(i,e.adler>>>16),O0(i,65535&e.adler)),el(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Mo:pH)},ipe=(e,n)=>{let i=n.length;if(N0(e))return Bd;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==ZE||o.lookahead)return Bd;if(c===1&&(e.adler=I0(e.adler,n,i,0)),o.wrap=0,i>=o.w_size){c===0&&(qf(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(n.subarray(i-o.w_size,i),0),n=_,i=o.w_size}const u=e.avail_in,h=e.next_in,f=e.input;for(e.avail_in=i,e.next_in=0,e.input=n,ey(o);o.lookahead>=3;){let _=o.strstart,v=o.lookahead-2;do o.ins_h=Yf(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--v);o.strstart=_,o.lookahead=2,ey(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=f,e.avail_in=u,o.wrap=c,Mo},k0={deflateInit:(e,n)=>EH(e,n,RA,15,8,Yhe),deflateInit2:EH,deflateReset:vH,deflateResetKeep:_H,deflateSetHeader:(e,n)=>N0(e)||e.state.wrap!==2?Bd:(e.state.gzhead=n,Mo),deflate:rpe,deflateEnd:e=>{if(N0(e))return Bd;const n=e.state.status;return e.state=null,n===s_?o_(e,zhe):Mo},deflateSetDictionary:ipe,deflateInfo:"pako deflate (from Nodeca project)"};const spe=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var CA={assign:function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)spe(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let n=0;for(let o=0,c=e.length;o<c;o++)n+=e[o].length;const i=new Uint8Array(n);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let yH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{yH=!1}const D0=new Uint8Array(256);for(let e=0;e<256;e++)D0[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;D0[254]=D0[254]=1;var L0={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,i,o,c,u,h=e.length,f=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(f),u=0,c=0;u<f;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?n[u++]=i:i<2048?(n[u++]=192|i>>>6,n[u++]=128|63&i):i<65536?(n[u++]=224|i>>>12,n[u++]=128|i>>>6&63,n[u++]=128|63&i):(n[u++]=240|i>>>18,n[u++]=128|i>>>12&63,n[u++]=128|i>>>6&63,n[u++]=128|63&i);return n},buf2string:(e,n)=>{const i=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let f=D0[h];if(f>4)u[c++]=65533,o+=f-1;else{for(h&=f===2?31:f===3?15:7;f>1&&o<i;)h=h<<6|63&e[o++],f--;f>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,f)=>{if(f<65534&&h.subarray&&yH)return String.fromCharCode.apply(null,h.length===f?h:h.subarray(0,f));let _="";for(let v=0;v<f;v++)_+=String.fromCharCode(h[v]);return _})(u,c)},utf8border:(e,n)=>{(n=n||e.length)>e.length&&(n=e.length);let i=n-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?n:i+D0[e[i]]>n?i:n}},SH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const TH=Object.prototype.toString,{Z_NO_FLUSH:ope,Z_SYNC_FLUSH:ape,Z_FULL_FLUSH:cpe,Z_FINISH:lpe,Z_OK:IA,Z_STREAM_END:upe,Z_DEFAULT_COMPRESSION:dpe,Z_DEFAULT_STRATEGY:hpe,Z_DEFLATED:ppe}=bA;function AA(e){this.options=CA.assign({level:dpe,method:ppe,chunkSize:16384,windowBits:15,memLevel:8,strategy:hpe},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new SH,this.strm.avail_out=0;let i=k0.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==IA)throw new Error(r_[i]);if(n.header&&k0.deflateSetHeader(this.strm,n.header),n.dictionary){let o;if(o=typeof n.dictionary=="string"?L0.string2buf(n.dictionary):TH.call(n.dictionary)==="[object ArrayBuffer]"?new Uint8Array(n.dictionary):n.dictionary,i=k0.deflateSetDictionary(this.strm,o),i!==IA)throw new Error(r_[i]);this._dict_set=!0}}function fpe(e,n){const i=new AA(n);if(i.push(e,!0),i.err)throw i.msg||r_[i.err];return i.result}AA.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=n===~~n?n:n===!0?lpe:ope,typeof e=="string"?i.input=L0.string2buf(e):TH.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===ape||u===cpe)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=k0.deflate(i,u),c===upe)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=k0.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===IA;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},AA.prototype.onData=function(e){this.chunks.push(e)},AA.prototype.onEnd=function(e){e===IA&&(this.result=CA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var mpe={deflate:fpe};const OA=16209;var gpe=function(e,n){let i,o,c,u,h,f,_,v,y,w,I,P,j,x,M,$,q,oe,me,ge,fe,Re,Ue,Qe;const rt=e.state;i=e.next_in,Ue=e.input,o=i+(e.avail_in-5),c=e.next_out,Qe=e.output,u=c-(n-e.avail_out),h=c+(e.avail_out-257),f=rt.dmax,_=rt.wsize,v=rt.whave,y=rt.wnext,w=rt.window,I=rt.hold,P=rt.bits,j=rt.lencode,x=rt.distcode,M=(1<<rt.lenbits)-1,$=(1<<rt.distbits)-1;e:do{P<15&&(I+=Ue[i++]<<P,P+=8,I+=Ue[i++]<<P,P+=8),q=j[I&M];t:for(;;){if(oe=q>>>24,I>>>=oe,P-=oe,oe=q>>>16&255,oe===0)Qe[c++]=65535&q;else{if(!(16&oe)){if((64&oe)==0){q=j[(65535&q)+(I&(1<<oe)-1)];continue t}if(32&oe){rt.mode=16191;break e}e.msg="invalid literal/length code",rt.mode=OA;break e}me=65535&q,oe&=15,oe&&(P<oe&&(I+=Ue[i++]<<P,P+=8),me+=I&(1<<oe)-1,I>>>=oe,P-=oe),P<15&&(I+=Ue[i++]<<P,P+=8,I+=Ue[i++]<<P,P+=8),q=x[I&$];n:for(;;){if(oe=q>>>24,I>>>=oe,P-=oe,oe=q>>>16&255,!(16&oe)){if((64&oe)==0){q=x[(65535&q)+(I&(1<<oe)-1)];continue n}e.msg="invalid distance code",rt.mode=OA;break e}if(ge=65535&q,oe&=15,P<oe&&(I+=Ue[i++]<<P,P+=8,P<oe&&(I+=Ue[i++]<<P,P+=8)),ge+=I&(1<<oe)-1,ge>f){e.msg="invalid distance too far back",rt.mode=OA;break e}if(I>>>=oe,P-=oe,oe=c-u,ge>oe){if(oe=ge-oe,oe>v&&rt.sane){e.msg="invalid distance too far back",rt.mode=OA;break e}if(fe=0,Re=w,y===0){if(fe+=_-oe,oe<me){me-=oe;do Qe[c++]=w[fe++];while(--oe);fe=c-ge,Re=Qe}}else if(y<oe){if(fe+=_+y-oe,oe-=y,oe<me){me-=oe;do Qe[c++]=w[fe++];while(--oe);if(fe=0,y<me){oe=y,me-=oe;do Qe[c++]=w[fe++];while(--oe);fe=c-ge,Re=Qe}}}else if(fe+=y-oe,oe<me){me-=oe;do Qe[c++]=w[fe++];while(--oe);fe=c-ge,Re=Qe}for(;me>2;)Qe[c++]=Re[fe++],Qe[c++]=Re[fe++],Qe[c++]=Re[fe++],me-=3;me&&(Qe[c++]=Re[fe++],me>1&&(Qe[c++]=Re[fe++]))}else{fe=c-ge;do Qe[c++]=Qe[fe++],Qe[c++]=Qe[fe++],Qe[c++]=Qe[fe++],me-=3;while(me>2);me&&(Qe[c++]=Qe[fe++],me>1&&(Qe[c++]=Qe[fe++]))}break}}break}}while(i<o&&c<h);me=P>>3,i-=me,P-=me<<3,I&=(1<<P)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),rt.hold=I,rt.bits=P};const PA=15,_pe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),vpe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Epe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ype=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var x0=(e,n,i,o,c,u,h,f)=>{const _=f.bits;let v,y,w,I,P,j,x=0,M=0,$=0,q=0,oe=0,me=0,ge=0,fe=0,Re=0,Ue=0,Qe=null;const rt=new Uint16Array(16),cn=new Uint16Array(16);let ln,tr,Jr,Fr=null;for(x=0;x<=PA;x++)rt[x]=0;for(M=0;M<o;M++)rt[n[i+M]]++;for(oe=_,q=PA;q>=1&&rt[q]===0;q--);if(oe>q&&(oe=q),q===0)return c[u++]=20971520,c[u++]=20971520,f.bits=1,0;for($=1;$<q&&rt[$]===0;$++);for(oe<$&&(oe=$),fe=1,x=1;x<=PA;x++)if(fe<<=1,fe-=rt[x],fe<0)return-1;if(fe>0&&(e===0||q!==1))return-1;for(cn[1]=0,x=1;x<PA;x++)cn[x+1]=cn[x]+rt[x];for(M=0;M<o;M++)n[i+M]!==0&&(h[cn[n[i+M]]++]=M);if(e===0?(Qe=Fr=h,j=20):e===1?(Qe=_pe,Fr=vpe,j=257):(Qe=Epe,Fr=ype,j=0),Ue=0,M=0,x=$,P=u,me=oe,ge=0,w=-1,Re=1<<oe,I=Re-1,e===1&&Re>852||e===2&&Re>592)return 1;for(;;){ln=x-ge,h[M]+1<j?(tr=0,Jr=h[M]):h[M]>=j?(tr=Fr[h[M]-j],Jr=Qe[h[M]-j]):(tr=96,Jr=0),v=1<<x-ge,y=1<<me,$=y;do y-=v,c[P+(Ue>>ge)+y]=ln<<24|tr<<16|Jr|0;while(y!==0);for(v=1<<x-1;Ue&v;)v>>=1;if(v!==0?(Ue&=v-1,Ue+=v):Ue=0,M++,--rt[x]==0){if(x===q)break;x=n[i+h[M]]}if(x>oe&&(Ue&I)!==w){for(ge===0&&(ge=oe),P+=$,me=x-ge,fe=1<<me;me+ge<q&&(fe-=rt[me+ge],!(fe<=0));)me++,fe<<=1;if(Re+=1<<me,e===1&&Re>852||e===2&&Re>592)return 1;w=Ue&I,c[w]=oe<<24|me<<16|P-u|0}}return Ue!==0&&(c[P+Ue]=x-ge<<24|64<<16|0),f.bits=oe,0};const{Z_FINISH:bH,Z_BLOCK:Spe,Z_TREES:NA,Z_OK:a_,Z_STREAM_END:Tpe,Z_NEED_DICT:bpe,Z_STREAM_ERROR:Wl,Z_DATA_ERROR:wH,Z_MEM_ERROR:RH,Z_BUF_ERROR:wpe,Z_DEFLATED:CH}=bA,kA=16180,DA=16190,lp=16191,GL=16192,zL=16194,LA=16199,xA=16200,HL=16206,ji=16209,IH=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Rpe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const c_=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.mode<kA||n.mode>16211?1:0},AH=e=>{if(c_(e))return Wl;const n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=kA,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,a_},OH=e=>{if(c_(e))return Wl;const n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,AH(e)},PH=(e,n)=>{let i;if(c_(e))return Wl;const o=e.state;return n<0?(i=0,n=-n):(i=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?Wl:(o.window!==null&&o.wbits!==n&&(o.window=null),o.wrap=i,o.wbits=n,OH(e))},NH=(e,n)=>{if(!e)return Wl;const i=new Rpe;e.state=i,i.strm=e,i.window=null,i.mode=kA;const o=PH(e,n);return o!==a_&&(e.state=null),o};let KL,$L,kH=!0;const Cpe=e=>{if(kH){KL=new Int32Array(512),$L=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(x0(1,e.lens,0,288,KL,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;x0(2,e.lens,0,32,$L,0,e.work,{bits:5}),kH=!1}e.lencode=KL,e.lenbits=9,e.distcode=$L,e.distbits=5},DH=(e,n,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(n.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(n.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(n.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Ipe=(e,n)=>{let i,o,c,u,h,f,_,v,y,w,I,P,j,x,M,$,q,oe,me,ge,fe,Re,Ue=0;const Qe=new Uint8Array(4);let rt,cn;const ln=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(c_(e)||!e.output||!e.input&&e.avail_in!==0)return Wl;i=e.state,i.mode===lp&&(i.mode=GL),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,f=e.avail_in,v=i.hold,y=i.bits,w=f,I=_,Re=a_;e:for(;;)switch(i.mode){case kA:if(i.wrap===0){i.mode=GL;break}for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(2&i.wrap&&v===35615){i.wbits===0&&(i.wbits=15),i.check=0,Qe[0]=255&v,Qe[1]=v>>>8&255,i.check=lo(i.check,Qe,2,0),v=0,y=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",i.mode=ji;break}if((15&v)!==CH){e.msg="unknown compression method",i.mode=ji;break}if(v>>>=4,y-=4,fe=8+(15&v),i.wbits===0&&(i.wbits=fe),fe>15||fe>i.wbits){e.msg="invalid window size",i.mode=ji;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&v?16189:lp,v=0,y=0;break;case 16181:for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(i.flags=v,(255&Ks(i))!==CH){e.msg="unknown compression method",i.mode=ji;break}if(57344&Ks(i)){e.msg="unknown header flags set",i.mode=ji;break}i.head&&(i.head.text=v>>8&1),512&Ks(i)&&4&i.wrap&&(Qe[0]=255&v,Qe[1]=v>>>8&255,i.check=lo(i.check,Qe,2,0)),v=0,y=0,i.mode=16182;case 16182:for(;y<32;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.head&&(i.head.time=v),512&Ks(i)&&4&i.wrap&&(Qe[0]=255&v,Qe[1]=v>>>8&255,Qe[2]=v>>>16&255,Qe[3]=v>>>24&255,i.check=lo(i.check,Qe,4,0)),v=0,y=0,i.mode=16183;case 16183:for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.head&&(i.head.xflags=255&v,i.head.os=v>>8),512&Ks(i)&&4&i.wrap&&(Qe[0]=255&v,Qe[1]=v>>>8&255,i.check=lo(i.check,Qe,2,0)),v=0,y=0,i.mode=16184;case 16184:if(1024&Ks(i)){for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.length=v,i.head&&(i.head.extra_len=v),512&Ks(i)&&4&i.wrap&&(Qe[0]=255&v,Qe[1]=v>>>8&255,i.check=lo(i.check,Qe,2,0)),v=0,y=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&Ks(i)&&(P=i.length,P>f&&(P=f),P&&(i.head&&(fe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+P),fe)),512&Ks(i)&&4&i.wrap&&(i.check=lo(i.check,o,P,u)),f-=P,u+=P,i.length-=P),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&Ks(i)){if(f===0)break e;P=0;do fe=o[u+P++],i.head&&fe&&i.length<65536&&(i.head.name+=String.fromCharCode(fe));while(fe&&P<f);if(512&Ks(i)&&4&i.wrap&&(i.check=lo(i.check,o,P,u)),f-=P,u+=P,fe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&Ks(i)){if(f===0)break e;P=0;do fe=o[u+P++],i.head&&fe&&i.length<65536&&(i.head.comment+=String.fromCharCode(fe));while(fe&&P<f);if(512&Ks(i)&&4&i.wrap&&(i.check=lo(i.check,o,P,u)),f-=P,u+=P,fe)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&Ks(i)){for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(4&i.wrap&&v!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ji;break}v=0,y=0}i.head&&(i.head.hcrc=Ks(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=lp;break;case 16189:for(;y<32;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}e.adler=i.check=IH(v),v=0,y=0,i.mode=DA;case DA:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=f,i.hold=v,i.bits=y,bpe;e.adler=i.check=1,i.mode=lp;case lp:if(n===Spe||n===NA)break e;case GL:if(i.last){v>>>=7&y,y-=7&y,i.mode=HL;break}for(;y<3;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}switch(i.last=1&v,v>>>=1,y-=1,3&v){case 0:i.mode=16193;break;case 1:if(Cpe(i),i.mode=LA,n===NA){v>>>=2,y-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=ji}v>>>=2,y-=2;break;case 16193:for(v>>>=7&y,y-=7&y;y<32;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ji;break}if(i.length=65535&v,v=0,y=0,i.mode=zL,n===NA)break e;case zL:i.mode=16195;case 16195:if(P=i.length,P){if(P>f&&(P=f),P>_&&(P=_),P===0)break e;c.set(o.subarray(u,u+P),h),f-=P,u+=P,_-=P,h+=P,i.length-=P;break}i.mode=lp;break;case 16196:for(;y<14;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(i.nlen=257+(31&v),v>>>=5,y-=5,i.ndist=1+(31&v),v>>>=5,y-=5,i.ncode=4+(15&v),v>>>=4,y-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ji;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;y<3;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.lens[ln[i.have++]]=7&v,v>>>=3,y-=3}for(;i.have<19;)i.lens[ln[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,rt={bits:i.lenbits},Re=x0(0,i.lens,0,19,i.lencode,0,i.work,rt),i.lenbits=rt.bits,Re){e.msg="invalid code lengths set",i.mode=ji;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Ue=i.lencode[v&(1<<i.lenbits)-1],M=Ue>>>24,$=Ue>>>16&255,q=65535&Ue,!(M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(q<16)v>>>=M,y-=M,i.lens[i.have++]=q;else{if(q===16){for(cn=M+2;y<cn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(v>>>=M,y-=M,i.have===0){e.msg="invalid bit length repeat",i.mode=ji;break}fe=i.lens[i.have-1],P=3+(3&v),v>>>=2,y-=2}else if(q===17){for(cn=M+3;y<cn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}v>>>=M,y-=M,fe=0,P=3+(7&v),v>>>=3,y-=3}else{for(cn=M+7;y<cn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}v>>>=M,y-=M,fe=0,P=11+(127&v),v>>>=7,y-=7}if(i.have+P>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ji;break}for(;P--;)i.lens[i.have++]=fe}}if(i.mode===ji)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=ji;break}if(i.lenbits=9,rt={bits:i.lenbits},Re=x0(1,i.lens,0,i.nlen,i.lencode,0,i.work,rt),i.lenbits=rt.bits,Re){e.msg="invalid literal/lengths set",i.mode=ji;break}if(i.distbits=6,i.distcode=i.distdyn,rt={bits:i.distbits},Re=x0(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,rt),i.distbits=rt.bits,Re){e.msg="invalid distances set",i.mode=ji;break}if(i.mode=LA,n===NA)break e;case LA:i.mode=xA;case xA:if(f>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=f,i.hold=v,i.bits=y,gpe(e,I),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,f=e.avail_in,v=i.hold,y=i.bits,i.mode===lp&&(i.back=-1);break}for(i.back=0;Ue=i.lencode[v&(1<<i.lenbits)-1],M=Ue>>>24,$=Ue>>>16&255,q=65535&Ue,!(M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if($&&(240&$)==0){for(oe=M,me=$,ge=q;Ue=i.lencode[ge+((v&(1<<oe+me)-1)>>oe)],M=Ue>>>24,$=Ue>>>16&255,q=65535&Ue,!(oe+M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}v>>>=oe,y-=oe,i.back+=oe}if(v>>>=M,y-=M,i.back+=M,i.length=q,$===0){i.mode=16205;break}if(32&$){i.back=-1,i.mode=lp;break}if(64&$){e.msg="invalid literal/length code",i.mode=ji;break}i.extra=15&$,i.mode=16201;case 16201:if(i.extra){for(cn=i.extra;y<cn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.length+=v&(1<<i.extra)-1,v>>>=i.extra,y-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Ue=i.distcode[v&(1<<i.distbits)-1],M=Ue>>>24,$=Ue>>>16&255,q=65535&Ue,!(M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if((240&$)==0){for(oe=M,me=$,ge=q;Ue=i.distcode[ge+((v&(1<<oe+me)-1)>>oe)],M=Ue>>>24,$=Ue>>>16&255,q=65535&Ue,!(oe+M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}v>>>=oe,y-=oe,i.back+=oe}if(v>>>=M,y-=M,i.back+=M,64&$){e.msg="invalid distance code",i.mode=ji;break}i.offset=q,i.extra=15&$,i.mode=16203;case 16203:if(i.extra){for(cn=i.extra;y<cn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.offset+=v&(1<<i.extra)-1,v>>>=i.extra,y-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ji;break}i.mode=16204;case 16204:if(_===0)break e;if(P=I-_,i.offset>P){if(P=i.offset-P,P>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ji;break}P>i.wnext?(P-=i.wnext,j=i.wsize-P):j=i.wnext-P,P>i.length&&(P=i.length),x=i.window}else x=c,j=h-i.offset,P=i.length;P>_&&(P=_),_-=P,i.length-=P;do c[h++]=x[j++];while(--P);i.length===0&&(i.mode=xA);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=xA;break;case HL:if(i.wrap){for(;y<32;){if(f===0)break e;f--,v|=o[u++]<<y,y+=8}if(I-=_,e.total_out+=I,i.total+=I,4&i.wrap&&I&&(e.adler=i.check=Ks(i)?lo(i.check,c,I,h-I):I0(i.check,c,I,h-I)),I=_,4&i.wrap&&(Ks(i)?v:IH(v))!==i.check){e.msg="incorrect data check",i.mode=ji;break}v=0,y=0}i.mode=16207;case 16207:if(i.wrap&&Ks(i)){for(;y<32;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(4&i.wrap&&v!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ji;break}v=0,y=0}i.mode=16208;case 16208:Re=Tpe;break e;case ji:Re=wH;break e;case 16210:return RH;default:return Wl}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=f,i.hold=v,i.bits=y,(i.wsize||I!==e.avail_out&&i.mode<ji&&(i.mode<HL||n!==bH))&&DH(e,e.output,e.next_out,I-e.avail_out),w-=e.avail_in,I-=e.avail_out,e.total_in+=w,e.total_out+=I,i.total+=I,4&i.wrap&&I&&(e.adler=i.check=Ks(i)?lo(i.check,c,I,e.next_out-I):I0(i.check,c,I,e.next_out-I)),e.data_type=i.bits+(i.last?64:0)+(i.mode===lp?128:0)+(i.mode===LA||i.mode===zL?256:0),(w===0&&I===0||n===bH)&&Re===a_&&(Re=wpe),Re},up={inflateReset:OH,inflateReset2:PH,inflateResetKeep:AH,inflateInit:e=>NH(e,15),inflateInit2:NH,inflate:Ipe,inflateEnd:e=>{if(c_(e))return Wl;let n=e.state;return n.window&&(n.window=null),e.state=null,a_},inflateGetHeader:(e,n)=>{if(c_(e))return Wl;const i=e.state;return(2&i.wrap)==0?Wl:(i.head=n,n.done=!1,a_)},inflateSetDictionary:(e,n)=>{const i=n.length;let o,c,u;return c_(e)?Wl:(o=e.state,o.wrap!==0&&o.mode!==DA?Wl:o.mode===DA&&(c=1,c=I0(c,n,i,0),c!==o.check)?wH:(u=DH(e,n,i,i),u?(o.mode=16210,RH):(o.havedict=1,a_)))},inflateInfo:"pako inflate (from Nodeca project)"},Ape=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const LH=Object.prototype.toString,{Z_NO_FLUSH:Ope,Z_FINISH:Ppe,Z_OK:M0,Z_STREAM_END:qL,Z_NEED_DICT:YL,Z_STREAM_ERROR:Npe,Z_DATA_ERROR:xH,Z_MEM_ERROR:kpe}=bA;function MA(e){this.options=CA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||e&&e.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(15&n.windowBits)==0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new SH,this.strm.avail_out=0;let i=up.inflateInit2(this.strm,n.windowBits);if(i!==M0)throw new Error(r_[i]);if(this.header=new Ape,up.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=L0.string2buf(n.dictionary):LH.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=up.inflateSetDictionary(this.strm,n.dictionary),i!==M0)))throw new Error(r_[i])}function Dpe(e,n){const i=new MA(n);if(i.push(e),i.err)throw i.msg||r_[i.err];return i.result}MA.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,f;if(this.ended)return!1;for(h=n===~~n?n:n===!0?Ppe:Ope,LH.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=up.inflate(i,h),u===YL&&c&&(u=up.inflateSetDictionary(i,c),u===M0?u=up.inflate(i,h):u===xH&&(u=YL));i.avail_in>0&&u===qL&&i.state.wrap>0&&e[i.next_in]!==0;)up.inflateReset(i),u=up.inflate(i,h);switch(u){case Npe:case xH:case YL:case kpe:return this.onEnd(u),this.ended=!0,!1}if(f=i.avail_out,i.next_out&&(i.avail_out===0||u===qL))if(this.options.to==="string"){let _=L0.utf8border(i.output,i.next_out),v=i.next_out-_,y=L0.buf2string(i.output,_);i.next_out=v,i.avail_out=o-v,v&&i.output.set(i.output.subarray(_,_+v),0),this.onData(y)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==M0||f!==0){if(u===qL)return u=up.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},MA.prototype.onData=function(e){this.chunks.push(e)},MA.prototype.onEnd=function(e){e===M0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=CA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Lpe={inflate:Dpe};const{deflate:xpe}=mpe,{inflate:Mpe}=Lpe;var Upe=xpe,Vpe=Mpe,MH=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(MH||{});class Fpe{constructor(){G(this,"_sequence",0),G(this,"_startTime",Date.now()),G(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const _={id:0,length:4,data:f.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=v,i.payload=this.compress(n),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;Q("SHOW_DATASTREAM2_LOG")&&k.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const f=this.serializeExtension(i.extension);c.set(new Uint8Array(f),h),h+=f.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const i=new DataView(n);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,f;if(o+=4,Q("SHOW_DATASTREAM2_LOG")&&k.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){f=this.deserializeExtension(n.slice(o)),o+=2+f.length,h=n.slice(o);let _=!1;if(f.datas.length>0){const v=f.datas.find(y=>y.id===0);v&&(_=(1&new DataView(v.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:i,length:o,datas:c}=n,u=new ArrayBuffer(o+2),h=new Uint8Array(u),f=new DataView(u);let _=0;if(f.setUint8(_++,i),f.setUint8(_++,o),c.forEach(v=>{i?(f.setUint8(_++,v.id),f.setUint8(_++,v.length),h.set(new Uint8Array(v.data),_),_+=v.data.byteLength):(f.setUint8(_++,v.id|v.length<<4),h.set(new Uint8Array(v.data),_),_+=v.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(n){const i=new DataView(n);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===MH.TWO_BYTE,f=[],_=new DataView(n,2);let v=0;for(;v<u;){let y=0,w=0,I=new ArrayBuffer(0);h?(y=_.getUint8(v),v++,w=_.getUint8(v),v++):(y=15&_.getUint8(v),w=_.getUint8(v)>>4,v++),w>0&&(I=_.buffer.slice(v+2,v+2+w),v+=I.byteLength),f.push({id:y,length:w,data:I})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:f}}decompress(n){return Vpe(new Uint8Array(n))}compress(n){return Upe(new Uint8Array(n))}}const jpe={name:"DataStream",create:(e,n)=>{const i=n?new $ue(e):new que(e);return i.useDataStream(new Fpe),i}};class Bpe extends Rr{constructor(n,i,o){super(),G(this,"ws",void 0),G(this,"requestId",1),G(this,"heartBeatTimer",void 0),G(this,"joinInfo",void 0),G(this,"clientId",void 0),G(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),G(this,"onClose",c=>{this.emit("close"),this.dispose()}),G(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=n,this.clientId=i,this.ws=new c0("cross-channel-".concat(this.clientId),o),this.ws.on(Wt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Wt.CONNECTED,this.onOpen),this.ws.on(Wt.ON_MESSAGE,this.onMessage),this.ws.on(Wt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(n){const i=this.requestId++;return n.requestId=i,n.seq=i,this.ws.sendMessage(n),i}waitStatus(n){return new Je((i,o)=>{const c=window.setTimeout(()=>{o(new be(Y.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new be(Y.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new be(Y.WS_ABORT))})})}async request(n){if(this.ws.state==="closed")throw new be(Y.WS_DISCONNECT);const i=()=>new Je((h,f)=>{this.ws.once(Wt.CLOSED,()=>f(new be(Y.WS_ABORT))),this.ws.once(Wt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(n),c=new Je((h,f)=>{const _=()=>{f(new be(Y.WS_ABORT))};this.ws.once(Wt.RECONNECTING,_),this.ws.once(Wt.CLOSED,_),this.once("req_".concat(o),h),qi(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Wt.RECONNECTING,_),this.ws.off(Wt.CLOSED,_),f(new be(Y.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new be(Y.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(n){this.ws.removeAllListeners(Wt.REQUEST_NEW_URLS),this.ws.on(Wt.REQUEST_NEW_URLS,i=>{i(n)}),await this.ws.init(n)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const i=this.requestId++;return n.requestId=i,this.ws.sendMessage(n),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Wpe extends Rr{set state(n){n!==this._state&&(n!==aa.RELAY_STATE_FAILURE&&(this.errorCode=FE.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,i,o,c,u){super(),G(this,"joinInfo",void 0),G(this,"sid",void 0),G(this,"clientId",void 0),G(this,"cancelToken",No.CancelToken.source()),G(this,"workerToken",void 0),G(this,"requestId",0),G(this,"signal",void 0),G(this,"prevChannelMediaConfig",void 0),G(this,"httpRetryConfig",void 0),G(this,"_resolution",void 0),G(this,"_state",aa.RELAY_STATE_IDLE),G(this,"errorCode",FE.RELAY_OK),G(this,"onStatus",h=>{k.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",rp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",rp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=FE.SRC_TOKEN_EXPIRED,this.state=aa.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=FE.DEST_TOKEN_EXPIRED,this.state=aa.RELAY_STATE_FAILURE))}),G(this,"onReconnect",async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",rp.NETWORK_DISCONNECTED),this.state=aa.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==aa.RELAY_STATE_IDLE&&(k.error("auto restart channel media relay failed",h.toString()),this.errorCode=FE.SERVER_CONNECTION_LOST,this.state=aa.RELAY_STATE_FAILURE)})}),this.joinInfo=n,this.clientId=i,this.sid=jg(),this.signal=new Bpe(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(n){if(this.state!==aa.RELAY_STATE_IDLE)throw new be(Y.INVALID_OPERATION);this.state=aa.RELAY_STATE_CONNECTING,await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(n)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new be(Y.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new be(Y.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new be(Y.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=n}async updateChannelMediaRelay(n){if(this.state!==aa.RELAY_STATE_RUNNING)throw new be(Y.INVALID_OPERATION);await this.sendUpdateMessage(n),this.prevChannelMediaConfig=n}async setVideoProfile(n){if(this._resolution=n,this.state!==aa.RELAY_STATE_RUNNING)throw new be(Y.INVALID_OPERATION);const i=this.genMessage(co.SetVideoProfile);await this.signal.request(i),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=aa.RELAY_STATE_IDLE,this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=No.CancelToken.source(),this.state=aa.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const n=await Qde(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=n.workerToken,await this.signal.connect(n.addressList),this.emit("event",rp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(n){const i=this.genMessage(co.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(co.SetSdkProfile,n);await this.signal.request(o),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(co.SetSourceChannel,n);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",rp.PACKET_JOINED_SRC_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(co.SetSourceUserId,n);await this.signal.request(u),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(co.SetDestChannel,n);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",rp.PACKET_JOINED_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const f=this.genMessage(co.StartPacketTransfer,n);await this.signal.request(f),this.emit("event",rp.PACKET_SENT_TO_DEST_CHANNEL),this.state=aa.RELAY_STATE_RUNNING,k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(n){const i=this.genMessage(co.UpdateDestChannel,n);await this.signal.request(i),this.emit("event",rp.PACKET_UPDATE_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const n=this.genMessage(co.StopPacketTransfer);await this.signal.request(n),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(n,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Yc,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let f=null,_=null;switch(n){case co.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case co.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new be(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case co.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new be(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case co.SetDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new be(Y.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case co.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case co.Reconnect:return h.clientRequest={command:"Reconnect"},h;case co.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case co.UpdateDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new be(Y.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case co.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Gpe={name:"ChannelMediaRelay",create:function(e){return new Wpe(e.joinInfo,e.clientId,e.websocketRetryConfig||pi,e.httpRetryConfig||pi,e.resolution)}};function UH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function U0(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?UH(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class zpe extends Rr{constructor(n,i,o,c){super(),G(this,"spec",void 0),G(this,"token",void 0),G(this,"websocket",void 0),G(this,"pingpongTimer",void 0),G(this,"reconnectMode","retry"),G(this,"serviceMode",void 0),G(this,"reqId",0),G(this,"commandReqId",0),G(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),G(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(ht.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===np.TRANSCODE?1:2}),this.emit(Mf.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=n,this.serviceMode=c,this.websocket=new c0("live-streaming",o),this.websocket.on(Wt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Wt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Wt.REQUEST_NEW_URLS,(u,h)=>{ls(this,Mf.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Wt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}async request(n,i,o,c){this.reqId+=1,n==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new be(Y.UNEXPECTED_ERROR);const f=U0({command:n,sdkVersion:Yc==="4.23.2"?"0.0.1":Yc,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new be(Y.WS_DISCONNECT);const _=()=>new Je((I,P)=>{this.websocket.once(Wt.CLOSED,()=>P(new be(Y.WS_ABORT))),this.websocket.once(Wt.CONNECTED,I)});this.websocket.state!=="connected"&&await _(),f.clientRequest&&(f.clientRequest.workerToken=this.token);const v=new Je((I,P)=>{const j=()=>{P(new be(Y.WS_ABORT))};this.websocket.once(Wt.RECONNECTING,j),this.websocket.once(Wt.CLOSED,j),this.once("@".concat(h,"-").concat(this.spec.sid),x=>{I(x)})});c&&ht.workerEvent(this.spec.sid,U0(U0({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const y=Date.now();this.websocket.sendMessage(f);let w=null;try{w=await v}catch(I){if(this.websocket.state==="closed")throw I;return await _(),await this.request(n,i,o)}return c&&ht.workerEvent(this.spec.sid,U0(U0({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-y})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n=Yc==="4.23.2"?"0.0.1":Yc;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case yi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case yi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case yi.LIVE_STREAM_RESPONSE_BAD_STREAM:case yi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new be(Y.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case yi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(n.serverResponse.command==="UnpublishStream")return;throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case yi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new be(Y.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case yi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new be(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Mf.WARNING,i,n.serverResponse.url)}case yi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new be(Y.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Mf.WARNING,i,n.serverResponse.url)}case yi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case yi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new be(Y.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case yi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new be(Y.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Mf.WARNING,i,n.serverResponse.url)}case yi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case yi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case yi.LIVE_STREAM_RESPONSE_WORKER_LOST:case yi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(n.serverResponse.command==="UnpublishStream")return;throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case yi.ERROR_FAIL_SEND_MESSAGE:if(n.serverResponse.command==="UnpublishStream")return;if(n.serverResponse.command==="UpdateTranscoding"||n.serverResponse.command==="ControlStream")return new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case yi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case yi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case yi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case yi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new be(Y.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(bI)},6e3)}}function VH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ca(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?VH(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):VH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Hpe extends Rr{constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pi;super(),G(this,"onLiveStreamWarning",void 0),G(this,"onLiveStreamError",void 0),G(this,"spec",void 0),G(this,"retryTimeout",1e4),G(this,"connection",void 0),G(this,"httpRetryConfig",void 0),G(this,"wsRetryConfig",void 0),G(this,"streamingTasks",new Map),G(this,"isStartingStreamingTask",!1),G(this,"taskMutex",new vs("live-streaming")),G(this,"cancelToken",No.CancelToken.source()),G(this,"transcodingConfig",void 0),G(this,"uapResponse",void 0),G(this,"lastTaskId",1),G(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(n){const i=ca(ca({},Nde),n);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(k.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>ca(ca(ca({},Pde),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){kr(h.width)||qn(h.width,"config.width",0,1e4),kr(h.height)||qn(h.height,"config.height",0,1e4),kr(h.videoBitrate)||qn(h.videoBitrate,"config.videoBitrate",1,1e6),kr(h.videoFrameRate)||qn(h.videoFrameRate,"config.videoFrameRate"),kr(h.lowLatency)||Qh(h.lowLatency,"config.lowLatency"),kr(h.audioSampleRate)||Ti(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),kr(h.audioBitrate)||qn(h.audioBitrate,"config.audioBitrate",1,128),kr(h.audioChannels)||Ti(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),kr(h.videoGop)||qn(h.videoGop,"config.videoGop"),kr(h.videoCodecProfile)||Ti(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),kr(h.userCount)||qn(h.userCount,"config.userCount",0,17),kr(h.backgroundColor)||qn(h.backgroundColor,"config.backgroundColor",0,16777215),kr(h.userConfigExtraInfo)||$i(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!kr(h.transcodingUsers)&&(Zh(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((f,_)=>{$I(f.uid),kr(f.x)||qn(f.x,"transcodingUser[".concat(_,"].x"),0,1e4),kr(f.y)||qn(f.y,"transcodingUser[".concat(_,"].y"),0,1e4),kr(f.width)||qn(f.width,"transcodingUser[".concat(_,"].width"),0,1e4),kr(f.height)||qn(f.height,"transcodingUser[".concat(_,"].height"),0,1e4),kr(f.zOrder)||qn(f.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),kr(f.alpha)||qn(f.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),kr(h.watermark)||J1(h.watermark,"watermark"),kr(h.backgroundImage)||J1(h.backgroundImage,"backgroundImage"),h.images&&!kr(h.images)&&(Zh(h.images,"config.images"),h.images.forEach((f,_)=>{J1(f,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>ca(ca(ca({},X1),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(ca(ca(ca({},X1),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(ca(ca(ca({},X1),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>ca({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?Je.resolve(h.uid):oz(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Je.all(c)).forEach((h,f)=>{i.userConfigs&&i.userConfigs[f]&&(i.userConfigs[f].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(lc(u=this.streamingTasks).call(u)).map(f=>f.taskId).join("#")});k.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(f=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,h).then(()=>{k.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(f.url," success"))}).catch(_=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),f.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,_)})})}}async startLiveStreamingTask(n,i,o){if(!this.transcodingConfig&&i===np.TRANSCODE)throw new be(Y.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:n,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};k.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(n)&&!o)return u(),new be(Y.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(f){throw u(),f}switch(i){case np.TRANSCODE:c.transcodingConfig=ca({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const f=new Je((v,y)=>{qi(this.retryTimeout).then(()=>{if(o)return y(o);const w=this.statusError.get(n);return w?(this.statusError.delete(n),y(w)):void 0})}),_=await Je.race([this.connection.request("request",{clientRequest:c},!0,{url:n,command:"PublishStream",workerType:i===np.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),f]);this.isStartingStreamingTask=!1,k.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(n,{clientRequest:c,mode:i,url:n,taskId:h}),u()}catch(f){if(u(),this.isStartingStreamingTask=!1,!f.data||!f.data.retry||o)throw f;return f.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(n,i,f)):await this.startLiveStreamingTask(n,i,f)}}stopLiveStreamingTask(n){return new Je((i,o)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new be(Y.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:u===np.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var n;const i=Array.from(lc(n=this.streamingTasks).call(n));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=No.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(n){if(this.connection)throw new be(Y.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await ls(this,Q1.REQUEST_WORKER_MANAGER_LIST,n);return this.uapResponse=i,this.connection=new zpe(i.workerToken,this.spec,this.wsRetryConfig,n),this.connection.on(Mf.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Mf.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Mf.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new be(Y.UNEXPECTED_ERROR,"can not get new live streaming address list"));ls(this,Q1.REQUEST_WORKER_MANAGER_LIST,n).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(n){const i=n.serverStatus&&n.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=n.reason;switch(n.code){case yi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case yi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case yi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case yi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new be(Y.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(o)return k.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case yi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new be(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case yi.LIVE_STREAM_RESPONSE_WORKER_LOST:case yi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(lc(u=this.streamingTasks).call(u));for(const f of h)f.abortTask?f.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(_=>{k.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,_)}));return}}}hasUrl(n){return this.streamingTasks.has(n)}}const Kpe={name:"LiveStreaming",create:function(e){return new Hpe(e.joinInfo,e.websocketRetryConfig||pi,e.httpRetryConfig||pi)}};function $pe(e){let n=BH();return function(i,o){let c=i.appId;c!==void 0&&(Wn(o,10),zd(o,c));let u=i.cid;u!==void 0&&(Wn(o,16),Wn(o,u));let h=i.cname;h!==void 0&&(Wn(o,26),zd(o,h));let f=i.deviceId;f!==void 0&&(Wn(o,34),zd(o,f));let _=i.elapse;_!==void 0&&(Wn(o,40),Xf(o,_));let v=i.fileSize;v!==void 0&&(Wn(o,48),Xf(o,ny(v)));let y=i.height;y!==void 0&&(Wn(o,56),Xf(o,ny(y)));let w=i.jpg;w!==void 0&&(Wn(o,66),Wn(o,w.length),function(Uo,Pe){let He=ry(Uo,Pe.length);Uo.bytes.set(Pe,He)}(o,w));let I=i.networkType;I!==void 0&&(Wn(o,72),Xf(o,ny(I)));let P=i.osType;P!==void 0&&(Wn(o,80),Xf(o,ny(P)));let j=i.requestId;j!==void 0&&(Wn(o,90),zd(o,j));let x=i.sdkVersion;x!==void 0&&(Wn(o,98),zd(o,x));let M=i.sequence;M!==void 0&&(Wn(o,104),Xf(o,ny(M)));let $=i.sid;$!==void 0&&(Wn(o,114),zd(o,$));let q=i.timestamp;q!==void 0&&(Wn(o,120),Xf(o,q));let oe=i.uid;oe!==void 0&&(Wn(o,128),Wn(o,oe));let me=i.vid;me!==void 0&&(Wn(o,136),Wn(o,me));let ge=i.width;ge!==void 0&&(Wn(o,144),Xf(o,ny(ge)));let fe=i.service;fe!==void 0&&(Wn(o,152),Wn(o,fe));let Re=i.callbackData;Re!==void 0&&(Wn(o,162),zd(o,Re));let Ue=i.jpgEncryption;Ue!==void 0&&(Wn(o,168),Wn(o,Ue));let Qe=i.requestType;Qe!==void 0&&(Wn(o,176),Wn(o,Qe));let rt=i.scorePorn;rt!==void 0&&(Wn(o,185),ex(o,rt));let cn=i.scoreSexy;cn!==void 0&&(Wn(o,193),ex(o,cn));let ln=i.scoreNeutral;ln!==void 0&&(Wn(o,201),ex(o,ln));let tr=i.scene;tr!==void 0&&(Wn(o,208),Wn(o,tr));let Jr=i.ossFilePrefix;Jr!==void 0&&(Wn(o,218),zd(o,Jr));let Fr=i.serviceVendor;if(Fr!==void 0)for(let Uo of Fr){Wn(o,226);let Pe=BH();Xpe(Uo,Pe),Wn(o,Pe.limit),efe(o,Pe),Zpe(Pe)}}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function qpe(e){return function(i){let o={};e:for(;!WH(i);){let c=Hd(i);switch(c>>>3){case 0:break e;case 1:o.code=Hd(i);break;case 2:o.msg=GH(i,Hd(i));break;case 3:{let u=Jpe(i);o.data=Ype(i),i.limit=u;break}default:FH(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function Ype(e){let n={};e:for(;!WH(e);){let i=Hd(e);switch(i>>>3){case 0:break e;case 1:n.requestId=GH(e,Hd(e));break;case 2:n.requestType=Hd(e)>>>0;break;case 3:n.scorePorn=ZL(e);break;case 4:n.scoreSexy=ZL(e);break;case 5:n.scoreNeutral=ZL(e);break;case 6:n.requestScene=Hd(e)>>>0;break;case 7:n.scene=Hd(e)>>>0;break;default:FH(e,7&i)}}return n}function Xpe(e,n){let i=e.service;i!==void 0&&(Wn(n,8),Wn(n,i));let o=e.vendor;o!==void 0&&(Wn(n,16),Wn(n,o));let c=e.token;c!==void 0&&(Wn(n,26),zd(n,c));let u=e.callbackUrl;u!==void 0&&(Wn(n,34),zd(n,u))}function Jpe(e){let n=Hd(e),i=e.limit;return e.limit=e.offset+n,i}function FH(e,n){switch(n){case 0:for(;128&zH(e););break;case 2:JL(e,Hd(e));break;case 5:JL(e,4);break;case 1:JL(e,8);break;default:throw new Error("Unimplemented type: "+n)}}let Qpe=new Float32Array(1);new Uint8Array(Qpe.buffer);let XL=new Float64Array(1),la=new Uint8Array(XL.buffer);function ny(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let jH=[];function BH(){const e=jH.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Zpe(e){jH.push(e)}function JL(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function WH(e){return e.offset>=e.limit}function ry(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function QL(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function GH(e,n){let i=QL(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let f=0;f<n;f++){let _,v,y,w,I=c[f+i];(128&I)==0?h+=o(I):(224&I)==192?f+1>=n?h+=u:(_=c[f+i+1],(192&_)!=128?h+=u:(w=(31&I)<<6|63&_,w<128?h+=u:(h+=o(w),f++))):(240&I)==224?f+2>=n?h+=u:(_=c[f+i+1],v=c[f+i+2],(49344&(_|v<<8))!=32896?h+=u:(w=(15&I)<<12|(63&_)<<6|63&v,w<2048||w>=55296&&w<=57343?h+=u:(h+=o(w),f+=2))):(248&I)==240?f+3>=n?h+=u:(_=c[f+i+1],v=c[f+i+2],y=c[f+i+3],(12632256&(_|v<<8|y<<16))!=8421504?h+=u:(w=(7&I)<<18|(63&_)<<12|(63&v)<<6|63&y,w<65536||w>1114111?h+=u:(w-=65536,h+=o(55296+(w>>10),56320+(1023&w)),f+=3))):h+=u}return h}function zd(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let f=n.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+n.charCodeAt(++h)-56613888),o+=f<128?1:f<2048?2:f<65536?3:4}Wn(e,o);let c=ry(e,o),u=e.bytes;for(let h=0;h<i;h++){let f=n.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+n.charCodeAt(++h)-56613888),f<128?u[c++]=f:(f<2048?u[c++]=f>>6&31|192:(f<65536?u[c++]=f>>12&15|224:(u[c++]=f>>18&7|240,u[c++]=f>>12&63|128),u[c++]=f>>6&63|128),u[c++]=63&f|128)}}function efe(e,n){let i=ry(e,n.limit),o=e.bytes,c=n.bytes;for(let u=0,h=n.limit;u<h;u++)o[u+i]=c[u]}function zH(e){return e.bytes[QL(e,1)]}function HH(e,n){let i=ry(e,1);e.bytes[i]=n}function ZL(e){let n=QL(e,8),i=e.bytes;return la[0]=i[n++],la[1]=i[n++],la[2]=i[n++],la[3]=i[n++],la[4]=i[n++],la[5]=i[n++],la[6]=i[n++],la[7]=i[n++],XL[0]}function ex(e,n){let i=ry(e,8),o=e.bytes;XL[0]=n,o[i++]=la[0],o[i++]=la[1],o[i++]=la[2],o[i++]=la[3],o[i++]=la[4],o[i++]=la[5],o[i++]=la[6],o[i++]=la[7]}function Hd(e){let n,i=0,o=0;do n=zH(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function Wn(e,n){for(n>>>=0;n>=128;)HH(e,127&n|128),n>>>=7;HH(e,n)}function Xf(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=ry(e,u),f=e.bytes;switch(u){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=u!==9?128|c:127&c;case 8:f[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:f[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:f[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:f[h+4]=u!==5?128|o:127&o;case 4:f[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:f[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:f[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:f[h]=u!==1?128|i:127&i}}function KH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const tfe=new Map([["moderation",1],["supervise",2]]);class nfe extends Rr{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Fi.CONNECTION_STATE_CHANGE,i,n)}get inspectType(){return this._inspectType}set inspectType(n){var i;this._inspectMode=Ia(i=n.map(o=>tfe.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),G(this,"name","AgoraRTCVideoContentInspect"),G(this,"_connectionState",Ml.CONNECTING),G(this,"_innerConnectionState",void 0),G(this,"sequence",0),G(this,"inspectStartTime",void 0),G(this,"workerManagerConnection",void 0),G(this,"workerConnection",void 0),G(this,"workerMessageLengthLimit",void 0),G(this,"inspectIntervalMinimum",void 0),G(this,"qualityRatio",void 0),G(this,"_connectInfo",void 0),G(this,"_cancelTokenSource",No.CancelToken.source()),G(this,"_retryConfig",void 0),G(this,"wmSequence",0),G(this,"inspectInterval",void 0),G(this,"inspectTimer",null),G(this,"ossFilePrefix",void 0),G(this,"extraInfo",void 0),G(this,"_inspectType",void 0),G(this,"_inspectMode",void 0),G(this,"_quality",1),G(this,"qualityTimer",null),G(this,"_inspectId",void 0),G(this,"_needWorkUrlOnly",!1),G(this,"inspectImage",()=>{if(this.connectionState!==Ml.CONNECTED)throw new be(Y.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ml.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Zn(5,"inspect-"),this.workerMessageLengthLimit=Q("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Q("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Q("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new c0("worker-manager-"+this._inspectId,pi),this.on(Fi.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,k.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ul[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new c0("worker-"+this._inspectId,pi),this.handleWorkerEvents()}async init(n,i){this.emit(Fi.STATE_CHANGE,Ul.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new Je((c,u)=>{this.on(Fi.CONNECTION_STATE_CHANGE,(h,f)=>{f===Ml.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(n,i,o){const c=Q("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),u=await function(f,_,v,y){let{appId:w,areaCode:I,cname:P,sid:j,token:x,uid:M}=_;KE++;const $="image_moderation_api",q={service_name:$,json_body:JSON.stringify({appId:w,areaCode:I,cname:P,command:"allocateEdge",requestId:KE,seq:KE,sid:j,token:x,ts:Date.now(),uid:M+""})};let oe,me,ge=f[0];return Lu(async()=>{oe=Date.now();const fe=await Fu(ge,{data:q,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(me=Date.now()-oe,fe.code!==0){const rt=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code"+fe.code,{retry:!0,responseTime:me});throw k.error(rt.toString()),rt}const Re=JSON.parse(fe.json_body);if(Re.code!==200){const rt=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Re.code,", reason: ").concat(Re.reason),{code:Re.code,responseTime:me});throw k.error(rt.toString()),rt}if(!Re.servers||!Array.isArray(Re.servers)||Re.servers.length===0){const rt=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Re.code,responseTime:me});throw k.error(rt.toString()),rt}const Ue=Q("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Qe=Q("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Re.servers.map(rt=>{let{address:cn,wss:ln}=rt;if(cn&&ln)return"wss://".concat(cn.replace(/\./g,"-"),".").concat(Ue,":").concat(Qe||ln)}).filter(rt=>!!rt),workerToken:Re.workerToken,vid:Re.vid,responseTime:me}},(fe,Re)=>(ht.apworkerEvent(j,{success:!0,sc:200,serviceName:$,responseDetail:JSON.stringify(fe.addressList),firstSuccess:Re===0,responseTime:me,serverIp:f[Re%f.length]}),!1),(fe,Re)=>(ht.apworkerEvent(j,{success:!1,sc:fe.data&&fe.data.code||200,serviceName:$,responseTime:me,serverIp:f[Re%f.length]}),!!(fe.code!==Y.OPERATION_ABORTED&&fe.code!==Y.UNEXPECTED_RESPONSE||fe.data&&fe.data.retry)&&(ge=f[(Re+1)%f.length],!0)),y)}(c,n,i,o);this.emit(Fi.STATE_CHANGE,Ul.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Fi.STATE_CHANGE,Ul.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(n,1e4)}async connectWorker(n){await this.workerConnection.init([n])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Wt.CONNECTED,async()=>{this.emit(Fi.STATE_CHANGE,Ul.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Wt.CLOSED,()=>{this._innerConnectionState<Ul.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Wt.FAILED,()=>{this._innerConnectionState<Ul.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Wt.RECONNECTING,()=>{this._innerConnectionState<Ul.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Wt.ON_MESSAGE,async n=>{this.emit(Fi.STATE_CHANGE,Ul.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(n.data);if(o.code!==200)throw k.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new be(Y.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw k.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new be(Y.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=Q("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Fi.STATE_CHANGE,Ul.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Fi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Wt.WILL_RECONNECT,(n,i,o)=>{o(n)}),this.workerManagerConnection.on(Wt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Wt.CONNECTED,async()=>{this.emit(Fi.STATE_CHANGE,Ul.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ml.CONNECTED}),this.workerConnection.on(Wt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const o=qpe(new Uint8Array(n.data));if(Q("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&k.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Fi.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Ia(i=Object.keys(c)).call(i,(f,_)=>c[f]>c[_]?f:_,"porn"),h=Object.keys(c).find(f=>f===u);this.emit(Fi.INSPECT_RESULT,h)}else this.emit(Fi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Fi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else k.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Fi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Wt.CLOSED,()=>{this.connectionState=Ml.CLOSED}),this.workerConnection.on(Wt.FAILED,()=>{this.connectionState=Ml.CLOSED}),this.workerConnection.on(Wt.RECONNECTING,()=>{this.connectionState=this.connectionState===Ml.CONNECTED?Ml.RECONNECTING:Ml.CONNECTING}),this.workerConnection.on(Wt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this.workerConnection.on(Wt.REQUEST_NEW_URLS,(n,i)=>{this.workerManagerConnection.close(),this.once(Fi.REQUEST_NEW_WORKER_URL,o=>{n([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const n=dc(this,Fi.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void this.emit(Fi.INSPECT_RESULT,void 0,new be(Y.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(n,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Fi.INSPECT_RESULT,void 0,new be(Y.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:f,uid:_}=i;const v=Date.now(),y=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await I6(y,o,c),I=this.sequence+"-"+u+"-"+_+"-"+v+"-"+Zn(12,""),P={appId:o,cid:u,cname:c,deviceId:"",elapse:(j=Number(v-this.inspectStartTime),{low:j|=0,high:j>>31,unsigned:j>=0}),fileSize:w.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:w,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.2",sequence:this.sequence,sid:f,timestamp:e8(v),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var j;this.extraInfo===void 0&&delete P.callbackData,this.ossFilePrefix===void 0&&delete P.ossFilePrefix;const x=$pe(P);if(x.byteLength<this.workerMessageLengthLimit){if(Q("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const M=function($){for(var q=1;q<arguments.length;q++){var oe=arguments[q]!=null?arguments[q]:{};q%2?KH(Object(oe),!0).forEach(function(me){G($,me,oe[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(oe)):KH(Object(oe)).forEach(function(me){Object.defineProperty($,me,Object.getOwnPropertyDescriptor(oe,me))})}return $}({},P);delete M.jpg,k.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(M))}return x}{const M=this.quality*this.qualityRatio;return this.quality=M,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:f,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=No.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ml.CLOSED,this.emit(Fi.STATE_CHANGE,Ul.CLOSED)}}const rfe={name:"ContentInspect",create:function(e){let{config:n}=e;return function(i){if(!i)throw new be(Y.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new be(Y.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!$e(u=["supervise","moderation"]).call(u,c))throw new be(Y.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new be(Y.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(n),new nfe(n)}};var $H=l(ft.Object.getOwnPropertySymbols),ife=In,sfe=Io.indexOf,ofe=Ih,tx=ae([].indexOf),qH=!!tx&&1/tx([1],1,-0)<0;ife({target:"Array",proto:!0,forced:qH||!ofe("indexOf")},{indexOf:function(e){var n=arguments.length>1?arguments[1]:void 0;return qH?tx(this,e,n)||0:sfe(this,e,n)}});var afe=Ca("Array").indexOf,cfe=N,lfe=afe,nx=Array.prototype,ufe=function(e){var n=e.indexOf;return e===nx||cfe(nx,e)&&n===nx.indexOf?lfe:n},YH=l(ufe);function dfe(e,n){if(e==null)return{};var i,o,c=function(h,f){if(h==null)return{};var _,v,y={},w=mG(h);for(v=0;v<w.length;v++)_=w[v],YH(f).call(f,_)>=0||(y[_]=h[_]);return y}(e,n);if($H){var u=$H(e);for(o=0;o<u.length;o++)i=u[o],YH(n).call(n,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let XH=class{get localCapabilities(){return Lr(this._localCapabilities)}get rtpCapabilities(){return Lr(this._rtpCapabilities)}get candidates(){return Lr(this._candidates)}get iceParameters(){return Lr(this._iceParameters)}get dtlsParameters(){return Lr(this._dtlsParameters)}constructor(e){G(this,"sessionDesc",void 0),G(this,"_localCapabilities",void 0),G(this,"_rtpCapabilities",void 0),G(this,"_candidates",void 0),G(this,"_iceParameters",void 0),G(this,"_dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname","o/i14u9pJrxRKAsu"),G(this,"firefoxSsrcMidMap",new Map),e=Lr(e);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:f,videoCodec:_,audioCodec:v}=e;let y;this.setup=f,y=h===ao.RECEIVE_ONLY?oa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):oa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=u;const w=h===ao.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,I=h===ao.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,P=h===ao.RECEIVE_ONLY?c.send.videoCodecs:d0(st.VIDEO,w,I,_),j=h===ao.RECEIVE_ONLY?c.send.audioCodecs:d0(st.AUDIO,w,I,v);for(const x of y.mediaDescriptions)x.attributes.iceUfrag=n.iceUfrag,x.attributes.icePwd=n.icePwd,x.attributes.fingerprints=i.fingerprints,x.attributes.candidates=o,x.attributes.setup=this.setup,x.media.mediaType==="application"&&(x.attributes.sctpPort="5000"),x.media.mediaType==="video"&&(x.media.fmts=P.map(M=>M.payloadType.toString(10)),x.attributes.payloads=P,x.attributes.extmaps=w.videoExtensions),x.media.mediaType==="audio"&&(x.media.fmts=j.map(M=>M.payloadType.toString(10)),x.attributes.payloads=j,x.attributes.extmaps=w.audioExtensions,HE(x));this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1}toString(){return xf(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(n=>this.hasMid(n)):this.sessionDesc.mediaDescriptions.some(n=>n.attributes.mid===e)}send(e,n,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=Yg(n,this.cname,Q("SYNC_GROUP")?i:void 0),f=this.findPreloadMediaDesc(u);if(f){if(Nr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,f.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(f,c),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let v;return _===-1?(v=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(v=Lr(this.sessionDesc.mediaDescriptions[_]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(v,c)),Nr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,n,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let f,_=!1;h===-1?(_=!0,f=this.createOrRecycleRecvMedia(c,[],"recvonly",n,i),this.updateBundleMids()):(f=Lr(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="recvonly"),o.push({mid:f.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:n,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:f,priority:_}=new RTCIceCandidate(e),v={foundation:n??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:f?f+"":"",extension:{}};this.candidates.some(y=>y.priority===v.priority&&y.connectionAddress===v.connectionAddress&&y.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(y=>{y.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,n,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=d0(u,h,this.localCapabilities.send,u===st.AUDIO?c:o),_=u===st.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let y={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};y=this.mungRecvMediaDsec(y,e);const w=this.findFirstClosedMedia(u);if(w){const I=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[I]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>$e(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>$e(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,n,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Nr()){if(c){const u=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="recvonly"||n.attributes.direction==="sendrecv");return n.attributes.mid!=="0"&&n.attributes.mid!=="1"&&i})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}restartICE(e){e=Lr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,n,i,o,c,u){const h=this.rtpCapabilities.send,f=e===st.VIDEO?h.videoCodecs:h.audioCodecs,_=e===st.VIDEO?h.videoExtensions:h.audioExtensions;Nr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const y=this.findFirstClosedMedia(e);if(y){const w=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[w]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(e,n,i){const o=Lr(e);return rL(o),zE(o,n),iL(o,n),jG(o),eA(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,n){const i=Lr(e);return eA(i,n,this.localCapabilities.recv),HE(i),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var i;return((i=n.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>Nr()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}};const hfe=["sdp"];var ar;function JH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Jf(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?JH(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let QH=(ar=class _y extends SG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[]}set isInRestartIce(n){this._isInRestartIce=n}get isInRestartIce(){return this._isInRestartIce}constructor(n,i,o){super(n,i),G(this,"direction",void 0),G(this,"name",void 0),G(this,"store",void 0),G(this,"spec",void 0),G(this,"peerConnection",void 0),G(this,"initialOffer",void 0),G(this,"transport",void 0),G(this,"statsFilter",void 0),G(this,"localCandidateCount",0),G(this,"_isInRestartIce",!1),G(this,"mutex",void 0),G(this,"onLocalCandidate",void 0),G(this,"remoteSDP",void 0),G(this,"pendingCandidates",[]),G(this,"localCapabilities",void 0),G(this,"isReady",!1),G(this,"restartCnt",0),G(this,"curTurnServerIndex",0),this.store=i,this.spec=n,this.mutex=new vs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(_y.resolvePCConfiguration(n,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??ao.SEND_ONLY,this.name=this.direction===ao.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=_1(this.peerConnection,Q("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(n){try{const i=await WG();if(this.localCapabilities=tA(i),n){const{sdp:o}=n,c=dfe(n,hfe),u=function(){const y={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=u0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},j={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Vl(w,y,"videoExtensions",I,P,j),Vl(w,y,"videoCodecs",I,P,j),Vl(w,y,"audioExtensions",I,P,j),Vl(w,y,"audioCodecs",I,P,j),Q("RAISE_H264_BASELINE_PRIORITY")){const x=j.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]==="42001f");if(x!==-1){const M=j.videoCodecs.findIndex($=>$.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(M<x){k.debug("raising H264 baseline profile priority");const $=j.videoCodecs[x];j.videoCodecs.splice(x,1),j.videoCodecs.splice(M,0,$)}M!==-1&&Q("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter($=>!($.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&$.fmtp&&$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:I,recv:P,sendrecv:j}}({},{},o);this.remoteSDP=new XH({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const f=jf(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await GG({},{},h.sdp);this.localCapabilities=tA(_);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),Jf(Jf({},f),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=jf(o.sdp);return this.initialOffer=o,Jf(Jf({},c),{},{sdp:o.sdp})}}catch(i){throw new Ie(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=n,u=await GG({},{},i);this.remoteSDP=new XH({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(n){try{n&&this.pendingCandidates.push(n),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Ie(Y.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return qc(function*(){const u=yield fn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=c.remoteSDP.receive(n,i,o);n.forEach((M,$)=>{if(f[$].needCreateTransceiver){const q=c.peerConnection.addTransceiver(M._mediaStreamTrack,{direction:"sendonly"});h.push(q),M._updateRtpTransceiver(q)}else{const q=c.peerConnection.getTransceivers().find(oe=>oe.mid===f[$].mid);if(!q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[$].mid));h.push(q),M._updateRtpTransceiver(q)}}),Nr()&&Q("SIMULCAST")===!0&&(yield fn(c.applySimulcastForFirefox(h,n)));const _=f.map(M=>M.mid),v=yield fn(c.peerConnection.createOffer()),y=c.mungSendOfferSDP(v.sdp,n,_),w=oa(y),I=_.map(M=>{const $=w.mediaDescriptions.find(q=>q.attributes.mid===M);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return UG($,Q("USE_PUB_RTX"))}),P=h.map((M,$)=>{const q=_[$];return{localSSRC:I[$],id:q}});yield fn(c.peerConnection.setLocalDescription({type:"offer",sdp:y}));try{yield P}catch(M){const $=c.remoteSDP.toString();throw yield fn(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield fn(c.stopSending(_,!0)),M}yield fn(c.applySimulcastEncodings(h,n)),yield fn(c.applySendEncodings(h,n));const j=c.remoteSDP.toString(),x=c.logSDPExchange(y,"offer","local","send");return x==null||x(j),yield fn(c.setRemoteDescription({type:"answer",sdp:j})),h.map((M,$)=>{const q=_[$];return{localSSRC:I[$],id:q}})}catch(h){throw h instanceof Ie?h:new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var v;_.direction="inactive",(v=_.stop)===null||v===void 0||v.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const f=this.remoteSDP.toString();h==null||h(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const _=this.remoteSDP.toString(),v=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(y.sdp,u,n);v==null||v(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const f=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!f||f.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,transceiver:f}}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const f=this.remoteSDP.toString(),_=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});const v=await this.peerConnection.createAnswer(),y=this.mungReceiveAnswerSDP(v.sdp,u,n);_==null||_(y||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:y}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."))}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(n){try{if(this.store.p2pTransport===Bg.Auto&&(this.store.p2pTransport=Bg.SdRtn,wn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(_y.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,wn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(_y.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!n){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=jf(i.sdp);return this.store.descriptionStart(),this.direction===ao.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(n),this.store.descriptionStart(),this.direction===ao.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=jf(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var n;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ie(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?Nr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Jf(Jf({},Nd),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Jf(Jf({},Nd),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n,i;$e(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=n=>{if(n.candidate){var i;n.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,n.candidate.toJSON())),this.localCandidateCount+=1}else k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return n.iceServers?c.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(JT(n.turnServer.servers)?c.iceServers=n.turnServer.servers:(c.iceServers&&c.iceServers.push(..._y.turnServerConfigToIceServers(n.turnServer.servers,i,o)),Q("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&n.turnServer.serversFromGateway&&c.iceServers.push(..._y.turnServerConfigToIceServers(n.turnServer.serversFromGateway,i,o)),$e(u=[Bg.Relay,Bg.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),Q("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),Q("ENABLE_ENCODED_TRANSFORM")&&wn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),k.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=n.filter(f=>f.tcpport);k.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case Bg.SdRtn:const f=n.filter(v=>{var y;return $e(y=v.username).call(y,"glb:")&&v.turnServerURL==v.turnServerURL}),_=f.length>o?f[o]:f[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Vf(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Vf(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case Bg.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Vf(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Vf(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(n){if(n){this.transport=n,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(y=>y.track===n._mediaStreamTrack)),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wn().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(n._encoderConfig){var h;const{bitrateMax:y,frameRate:w,scaleResolutionDownBy:I}=n._encoderConfig;y&&(u.maxBitrate=1e3*y),$e(h=n._hints).call(h,er.LOW_STREAM)&&(w&&(u.maxFramerate=Ma(w)),I&&I>=1&&(u.scaleResolutionDownBy=I))}if(Q("DSCP_TYPE")&&Jh()){var f;const y=Q("DSCP_TYPE");$e(f=["very-low","low","medium","high"]).call(f,y)&&(u.networkPriority=y)}const _=i.getParameters(),v=(o=_.encodings)===null||o===void 0?void 0:o[0];Nr()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(_,c),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(n,i){try{if(!wn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof ur&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=oa(n);return i.forEach((u,h)=>{const f=o[h],_=c.mediaDescriptions.find(v=>v.attributes.mid===f);_&&(zE(_,u),BG(_,u,this.store.codec))}),xf(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,f;const v=n[_],y=i[_];if(y instanceof ur&&!$e(o=y._hints).call(o,er.LOW_STREAM)&&(c=y._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=y._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=y._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=y._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},I={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const P=v.sender.getParameters();await v.sender.setParameters(Object.assign(P,w))}}}async applySimulcastEncodings(n,i){if(!Nr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof ur&&this.isVP8Simulcast(c)){const u=n[o],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof ur&&Q("SIMULCAST")&&this.store.codec==="vp8"&&!$e(i=n._hints).call(i,er.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(Q("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(n,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=oa(i).mediaDescriptions.find(f=>f.attributes.mid===n))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(n){var i;await this.peerConnection.setRemoteDescription(n),$e(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(n,i,o){const c=oa(n),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===st.AUDIO&&u.media.mediaType==="audio"&&HE(u),xf(c)}},ct(ar.prototype,"establish",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"establish"),ar.prototype),ct(ar.prototype,"connect",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"connect"),ar.prototype),ct(ar.prototype,"receive",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"receive"),ar.prototype),ct(ar.prototype,"mockReceive",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"mockReceive"),ar.prototype),ct(ar.prototype,"stopReceiving",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"stopReceiving"),ar.prototype),ct(ar.prototype,"restartICE",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"restartICE"),ar.prototype),ct(ar.prototype,"close",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"close"),ar.prototype),ct(ar.prototype,"updateEncoderConfig",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"updateEncoderConfig"),ar.prototype),ct(ar.prototype,"updateSendParameters",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"updateSendParameters"),ar.prototype),ct(ar.prototype,"replaceTrack",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"replaceTrack"),ar.prototype),ct(ar.prototype,"muteLocal",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"muteLocal"),ar.prototype),ct(ar.prototype,"unmuteLocal",[Gl],Object.getOwnPropertyDescriptor(ar.prototype,"unmuteLocal"),ar.prototype),ar);function Gl(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return await o.apply(this,f)}finally{u()}},i}let Bu=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var ZH,e9,t9,n9,r9,i9,s9,o9,a9,c9,l9,Sr;function u9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function UA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?u9(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let pfe=(ZH=Wu(Bu.SEND_ONLY),e9=Wu(Bu.SEND_ONLY),t9=Wu(),n9=Wu(Bu.RECEIVE_ONLY),r9=Wu(Bu.RECEIVE_ONLY),i9=Wu(Bu.RECEIVE_ONLY),s9=Wu(Bu.RECEIVE_ONLY),o9=Wu(Bu.RECEIVE_ONLY),a9=Wu(Bu.RECEIVE_ONLY),c9=Wu(),l9=Wu(Bu.RECEIVE_ONLY),Sr=class extends Rr{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(Rt.StateChange,n,this._state)}constructor(e,n){super(),G(this,"isPlanB",!1),G(this,"store",void 0),G(this,"statsUploader",void 0),G(this,"sendConnection",void 0),G(this,"recvConnection",void 0),G(this,"localTrackMap",new Map),G(this,"remoteUserMap",new Map),G(this,"localDataChannels",[]),G(this,"pendingLocalTracks",[]),G(this,"pendingRemoteTracks",[]),G(this,"statsCollector",void 0),G(this,"dtlsFailedCount",0),G(this,"sendMutex",void 0),G(this,"recvMutex",void 0),G(this,"_state",xn.Disconnected),G(this,"_restartStates",["disconnected","failed"]),G(this,"reconnectInterval",void 0),G(this,"uploadUnplinkStarted",!1),G(this,"uploadDownlinkStarted",!1),G(this,"uplinkStateUploadInterval",void 0),G(this,"downlinkStatsUploadInterval",void 0),G(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==xn.Connected)return void c(new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const v=_.find(P=>P[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(P=>{let[,{id:j}]=P;return j}));let y=!1;var h,f;i.trackMediaType==="video"?y=!((h=this.localTrackMap.get(Le.LocalAudioTrack))===null||h===void 0||!h.track._muted):y=((f=this.localTrackMap.get(Le.LocalVideoTrack))===null||f===void 0?void 0:f.id)===void 0;const w=this.createMuteMessage(_);await Qn(this,Rt.RequestMuteLocal,w);const I=i.trackMediaType==="video"?Uf.MUTE_LOCAL_VIDEO:Uf.MUTE_LOCAL_AUDIO;await Qn(this,Rt.RequestP2PMuteLocal,{action:I,message:w,isMuteAll:y}),o()}catch(_){c(_)}finally{u()}}),G(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==xn.Connected)return void c(new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:y}]=v;return y}));const f=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?Uf.UNMUTE_LOCAL_VIDEO:Uf.UNMUTE_LOCAL_AUDIO;await Qn(this,Rt.RequestP2PMuteLocal,{action:_,message:f}),o()}catch(h){c(h)}finally{u()}}),G(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==xn.Connected)return void o();const{id:v,track:y}=_;v&&(await this.sendConnection.updateSendParameters(v,y),await this.sendConnection.updateEncoderConfig(v,y),this.emit(Rt.UpdateVideoEncoder,y)),o()}catch(_){c(_)}finally{var f;(f=h)===null||f===void 0||f()}}),G(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==xn.Connected)return void o();const{id:f,track:_}=h;f&&await this.sendConnection.updateSendParameters(f,_),o()}catch(h){c(h)}finally{u()}}),G(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(y=>{let[,{track:w}]=y;return i===w});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==xn.Connected)return void o();if(await((f=this.sendConnection)===null||f===void 0?void 0:f.replaceTrack(i,v[1].id)),v[0]===Le.LocalVideoTrack&&wn().supportDualStreamEncoding){const y=this.localTrackMap.get(Le.LocalVideoLowTrack);if(y){const w=i._mediaStreamTrack.clone();y.track._originMediaStreamTrack.stop(),y.track._mediaStreamTrack=w,y.track._originMediaStreamTrack=w,await new Je((I,P)=>{this.handleReplaceTrack(y.track,I,P,!0)})}}o()}catch(v){c(v)}finally{var _;(_=h)===null||_===void 0||_()}}),G(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),G(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),G(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),G(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new Az(e),this.bindStatsUploaderEvents(),this.sendMutex=new vs("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new vs("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},Q("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,n){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,n){let i;try{if(n){this.recvConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new QH(e,this.store,ao.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(n);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=xn.New,this.sendConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new QH(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=xn.Connected}async addRemoteCandidate(e,n){if(n===ao.RECEIVE_ONLY){if(!this.sendConnection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,n,i){var o=this;return qc(function*(){const c=yield fn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==xn.Connected){o.throwIfTrackTypeNotMatch(e);const v=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(v))}o.store.pubId=o.store.pubId+1,Ss.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,n,i);if(u.length===0)return void(yield fn(o.tryToUnmuteAudio(e)));u.forEach(v=>{let{track:y,type:w}=v;const I=Date.now();o.store.publish(y.getTrackId(),w===Le.LocalAudioTrack?"audio":"video",I)}),o.bindLocalTrackEvents(u);const h=yield fn(o.sendConnection.send(u.map(v=>{let{track:y}=v;return y}),o.store.codec,o.store.audioCodec)),f=(yield fn(h.next())).value,_=o.createGatewayPublishMessage(u,f);try{yield _}catch(v){throw h.throw(v),(v==null?void 0:v.code)===Y.WS_ABORT&&u.forEach(y=>{let{track:w}=y;o.pendingLocalTracks.indexOf(w)===-1&&o.pendingLocalTracks.push(w)}),o.unbindLocalTrackEvents(u),v}yield fn(h.next()),u.forEach(v=>{let{type:y}=v;o.statsCollector.addLocalStats(y)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,f),u.forEach(v=>{let{track:y,type:w}=v;const I=Date.now();o.store.publish(y.getTrackId(),w===Le.LocalAudioTrack?"audio":"video",void 0,I)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==xn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!$e(e).call(e,c)));const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(n);if(await this.sendConnection.stopSending(n.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),n.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===xn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const n=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const f={stream_type:ihe(u,c),ssrcs:h};u._muted||!u._enabled?n.push(f):i.push(f)}),n.length>0&&n.forEach(o=>{Qn(this,Rt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{Qn(this,Rt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return qc(function*(){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ls(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,n,i,o){var c;if(!this.recvConnection)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(n))return;const{track:u,mid:h,transceiver:f}=await this.recvConnection.receive(n,[{ssrcId:i}],String(e.uid),o);n===st.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new ME(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new xE(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(n,h):this.remoteUserMap.set(e,new Map([[n,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:w,kind:I}=y;return w.uid===e.uid&&n===I});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Rt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,n,i,o){if(!this.recvConnection)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(n,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:f}=u;return n!==void 0?h.uid===e.uid&&n===f:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var f;if(h===st.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(h===st.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,n);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:f}]=u;var _,v;if(f===st.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===st.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(f===st.AUDIO){var y;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((y=h._audioTrack)===null||y===void 0||y._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;Qn(this,Rt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(n=>{let[,i]=n;[st.VIDEO,st.AUDIO].forEach(o=>{i.has(o)?Qn(this,Rt.RequestP2PUnmuteRemote,o):Qn(this,Rt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===st.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}getAllTracks(e){const n=this.localTrackMap.get(Le.LocalAudioTrack);if((n==null?void 0:n.track)instanceof Ei){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Le.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Le.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Le.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get(Le.LocalAudioTrack),f=o?this.localTrackMap.get(Le.LocalVideoLowTrack):this.localTrackMap.get(Le.LocalVideoTrack);ht.publish(this.store.sessionId,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(er.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Vr),f=o?(u=this.localTrackMap.get(Le.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof ur);ht.publish(this.store.sessionId,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(er.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===st.VIDEO?i._videoSSRC:i._audioSSRC;c&&ht.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===st.VIDEO,audio:o===st.AUDIO,peerid:i.uid,subscribeRequestid:o===st.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ss.measureFromSubscribeStart(this.store.clientId,c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new vs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new vs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ei){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=xn.Disconnected}getStats(e){var n,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(n=this.sendConnection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.recvConnection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof ur||n&&n.track instanceof Vr?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(pc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(Le.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=xT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=xn.Reconnecting,Q("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case Le.LocalVideoTrack:$e(n=o._hints).call(n,er.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Le.LocalAudioTrack:o instanceof Ei?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Le.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(pc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(Rt.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Wf?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}async restartICE(e,n){let i,o;if(e===ao.SEND_ONLY){if(!this.sendConnection)throw new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(n){const c=await o.restartICE(n);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await ls(this,Rt.RequestP2PRestartICE,{direction:ao.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),n=this.localTrackMap.get(Le.LocalVideoTrack),i=this.localTrackMap.get(Le.LocalAudioTrack),o=e.videoSend.find(P=>{var j;return P.ssrc===(n==null||(j=n.ssrcs)===null||j===void 0?void 0:j[0].ssrcId)}),c=e.audioSend.find(P=>{var j;return P.ssrc===(i==null||(j=i.ssrcs)===null||j===void 0?void 0:j[0].ssrcId)});if(!o||!c)return 1;const u=dc(this,Rt.NeedSignalRTT),h=o?o.rttMs:void 0,f=c?c.rttMs:void 0,_=h&&f?(h+f)/2:h||f,v=(_&&u?(_+u)/2:_||u)||0,y=100*e.sendPacketLossRate*.7/50+.3*v/1500,w=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,I=n==null?void 0:n.track;if(I&&I._encoderConfig&&I._hints.indexOf(er.SCREEN_TRACK)===-1){const P=I._encoderConfig.bitrateMax,j=e.bitrate.actualEncoded;if(P&&j){const x=(1e3*P-j)/(1e3*P);return hG[x<.15?0:x<.3?1:x<.45?2:x<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(j=>j.ssrc===c),f=e.videoRecv.find(j=>j.ssrc===u);if(!h&&!f)return void(n+=1);const _=dc(this,Rt.NeedSignalRTT),v=e.rtt,y=(v&&_?(v+_)/2:v||_)||0,w=h?h.jitterMs:void 0,I=e.recvPacketLossRate;let P=.7*I*100/50+.3*y/1500;w&&(P=.6*I*100/50+.2*y/1500+.2*w/400),n+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new Je((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}filterTobePublishedTracks(e,n,i){const o=[],c=wn(),u=this.getAllTracks();e=TE(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,f=!1;for(const _ of e){if(_ instanceof ur&&(this.localTrackMap.has(Le.LocalVideoTrack)||h?new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Le.LocalVideoTrack}),h=!0),n)){const v=this.getLowVideoTrack(_,i);o.push({track:v,type:Le.LocalVideoLowTrack})}if(_ instanceof Vr){const v=this.localTrackMap.get(Le.LocalAudioTrack);if(v){if(!(v.track instanceof Ei))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(f){const y=o.find(w=>{let{type:I}=w;return I===Le.LocalAudioTrack});if(!(y.track instanceof Ei))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ei||_._bypassWebAudio)o.push({track:_,type:Le.LocalAudioTrack});else{const y=new Ei;y.addAudioTrack(_),o.push({track:y,type:Le.LocalAudioTrack})}f=!0}}}return o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=TE(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Vr){const c=this.localTrackMap.get(Le.LocalAudioTrack);if(!c)continue;c.track instanceof Ei?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([Le.LocalAudioTrack,c]),c.track.close())):n.push([Le.LocalAudioTrack,c])}if(o instanceof ur){const c=this.localTrackMap.get(Le.LocalVideoTrack);if(!c)continue;n.push([Le.LocalVideoTrack,c]);const u=this.localTrackMap.get(Le.LocalVideoLowTrack);u&&n.push([Le.LocalVideoLowTrack,u])}}return n}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Le.LocalVideoTrack:i.addListener(at.GET_STATS,this.handleGetLocalVideoStats),i.addListener(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(at.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(at.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(at.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof Ei?e.trackList.forEach(i=>{i.addListener(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(at.GET_STATS,this.handleGetLocalAudioStats),i.addListener(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(at.GET_STATS,this.handleGetLocalAudioStats),e.addListener(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||e.addListener(at.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Le.LocalVideoTrack:i.off(at.GET_STATS,this.handleGetLocalVideoStats),i.off(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(at.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(at.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(at.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ei?e.trackList.forEach(n=>{n.off(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(at.GET_STATS,this.handleGetLocalAudioStats),n.off(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(at.GET_STATS,this.handleGetLocalAudioStats),e.off(at.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(at.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(at.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(at.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(at.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof xE&&n.addListener(at.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof ME&&n.addListener(at.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(at.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(st.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(st.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,{track:h,type:f}=i;switch(f){case Le.LocalAudioTrack:u=jn.Audio;break;case Le.LocalVideoTrack:u=$e(c=h._hints).call(c,er.SCREEN_TRACK)?jn.Screen:jn.High;break;case Le.LocalVideoLowTrack:u=jn.Low}return{kind:f===Le.LocalAudioTrack?st.AUDIO:st.VIDEO,stream_type:u,mid:n[o].id,ssrcs:n[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Le.LocalVideoTrack:o=$e(i=u._hints).call(i,er.SCREEN_TRACK)?jn.Screen:jn.High;break;case Le.LocalAudioTrack:o=jn.Audio;break;case Le.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:f}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{var i;k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(n,")")),this.emit(Rt.PeerConnectionStateChange,n),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(e.isInRestartIce=!1),$e(i=this._restartStates).call(i,n)&&!e.isInRestartIce&&(n==="disconnected"&&await qi(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),ht.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:Dr.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(pc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(PE.FIRST_FRAME_DECODED),ht.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_DECODE,Er.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(pc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&ht.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_RECEIVED,Er.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(pc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&ht.firstRemoteFrame(this.store.sessionId,Oi.FIRST_VIDEO_RECEIVED,Er.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(Rt.ConnectionTypeChange,o),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ff(i))," -> ").concat(JSON.stringify(Ff(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ff(i))," -> ").concat(JSON.stringify(Ff(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.onLocalCandidate=n=>{this.emit(Rt.LocalCandidate,{candidate:n,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const n=e===ao.SEND_ONLY?this.sendConnection:this.recvConnection;n&&!n.isInRestartIce&&(n.isInRestartIce=!0,k.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(n.name,"] start use restartICE")),e===ao.SEND_ONLY?this.restartICE(e):ls(this,Rt.RequestP2PRestartICE,{direction:ao.SEND_ONLY}))}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof Vr&&(i==null?void 0:i.track)instanceof Ei)return i.track.isActive||n.push([Le.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===Le.LocalVideoTrack)){const c=this.localTrackMap.get(Le.LocalVideoLowTrack);c&&n.push([Le.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof Vr&&(i==null?void 0:i.track)instanceof Ei)return i.track.isActive&&n.push([Le.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Le.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get(Le.LocalVideoLowTrack);c&&n.push([Le.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Le.LocalAudioTrack:o=jn.Audio;break;case Le.LocalVideoTrack:o=$e(i=u._hints).call(i,er.SCREEN_TRACK)?jn.Screen:jn.High;break;case Le.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:f}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Le.LocalAudioTrack:o=jn.Audio;break;case Le.LocalVideoTrack:o=$e(i=u._hints).call(i,er.SCREEN_TRACK)?jn.Screen:jn.High;break;case Le.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case st.VIDEO:return void(o._videoSSRC&&n.push({stream_type:st.VIDEO,ssrcId:o._videoSSRC}));case st.AUDIO:return void(o._audioSSRC&&n.push({stream_type:st.AUDIO,ssrcId:o._audioSSRC}))}}),n}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(Le.LocalVideoTrack),i=this.localTrackMap.get(Le.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new Je((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Je((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,n=this.recvConnection.peerConnectionState;return e!=="connected"&&n!=="connected"}return!0}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Vr){const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await Qn(this,Rt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:n}]=e;return!!n}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.recvConnection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(Rt.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(Rt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await qi(d1(this.dtlsFailedCount,pi)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ur)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof ur).length>1)throw new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Vr).length>1&&(e.some(n=>n instanceof Vr&&n._bypassWebAudio)||!wn().webAudioMediaStreamDest))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof ur&&this.pendingLocalTracks.some(i=>i instanceof ur))throw new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Vr&&this.pendingLocalTracks.some(i=>i instanceof Vr)&&(!wn().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Vr&&i._bypassWebAudio)))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){const i=!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&wn().supportDualStreamEncoding,o=UA(UA({},{width:160,height:120,framerate:15,bitrate:50}),n);let c;c=i?e._mediaStreamTrack.clone():yL(e,o);const u=Zn(8,"track-low-"),h=new ur(c,UA(UA({},i&&{scaleResolutionDownBy:nL(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(Wg.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,AE.LOW_STREAM)}),h._hints.push(er.LOW_STREAM),e.addListener(at.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(pc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");ht.firstRemoteVideoDecode(this.store.sessionId,Oi.FIRST_VIDEO_DECODE,Er.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ie(Y.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ie(Y.NOT_SUPPORTED)}async subscribeDataChannel(e,n){throw new Ie(Y.NOT_SUPPORTED)}async unsubscribeDataChannel(e,n){throw new Ie(Y.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,n){throw new Ie(Y.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,n){throw new Ie(Y.NOT_SUPPORTED)}async preConnect(e){throw new Ie(Y.NOT_SUPPORTED)}getEstablishParams(){throw new Ie(Y.NOT_SUPPORTED)}async reSubscribe(e){throw new Ie(Y.NOT_SUPPORTED)}async updateVideoStreamParameter(e,n){throw new Ie(Y.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===Le.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,AE.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ct(Sr.prototype,"p2pConnect",[ZH],Object.getOwnPropertyDescriptor(Sr.prototype,"p2pConnect"),Sr.prototype),ct(Sr.prototype,"unpublish",[e9],Object.getOwnPropertyDescriptor(Sr.prototype,"unpublish"),Sr.prototype),ct(Sr.prototype,"unpublishLowStream",[t9],Object.getOwnPropertyDescriptor(Sr.prototype,"unpublishLowStream"),Sr.prototype),ct(Sr.prototype,"subscribe",[n9],Object.getOwnPropertyDescriptor(Sr.prototype,"subscribe"),Sr.prototype),ct(Sr.prototype,"mockSubscribe",[r9],Object.getOwnPropertyDescriptor(Sr.prototype,"mockSubscribe"),Sr.prototype),ct(Sr.prototype,"unsubscribe",[i9],Object.getOwnPropertyDescriptor(Sr.prototype,"unsubscribe"),Sr.prototype),ct(Sr.prototype,"muteRemote",[s9],Object.getOwnPropertyDescriptor(Sr.prototype,"muteRemote"),Sr.prototype),ct(Sr.prototype,"unmuteRemote",[o9],Object.getOwnPropertyDescriptor(Sr.prototype,"unmuteRemote"),Sr.prototype),ct(Sr.prototype,"hasRemoteMediaWithLock",[a9],Object.getOwnPropertyDescriptor(Sr.prototype,"hasRemoteMediaWithLock"),Sr.prototype),ct(Sr.prototype,"disconnectForReconnect",[c9],Object.getOwnPropertyDescriptor(Sr.prototype,"disconnectForReconnect"),Sr.prototype),ct(Sr.prototype,"remoteMediaSsrcChanged",[l9],Object.getOwnPropertyDescriptor(Sr.prototype,"remoteMediaSsrcChanged"),Sr.prototype),Sr);function Wu(e){return function(n,i,o){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];switch(e){case Bu.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case Bu.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),v=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),v()}}}},o}}class l_ extends Rr{constructor(n,i){super(),G(this,"signal",void 0),G(this,"token",void 0),G(this,"tokenTimeout",void 0),G(this,"tokenInterval",void 0),G(this,"_sequence",0),G(this,"userMap",new Map),G(this,"encoder",new TextEncoder),this.signal=n,this.token=i;const o=()=>{this.signal.connectionState===rr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*Q("P2P_TOKEN_INTERVAL"))};o()}async send(n,i,o,c,u){var h,f,_;if(this.userMap.size===0)return;const v=Array.from(lc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(f=c)!==null&&f!==void 0?f:Zn(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const y={_id:c,_type:n,_seq:u,_message:i,token:"".concat(this.token,"_").concat(v)};Q("SHOW_P2P_LOG")&&k.debug("send message",y,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(y)).forEach(I=>{this.signal.request(kt.DATA_STREAM,{payload:Lf(this.encoder.encode(I))})});const w=new Je((I,P)=>{const j=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),x),this.off("res-@".concat(c),$),this.off(BE.ABORT,M),k.debug("[external-signal] request timeout, type: ".concat(n,", requestId: ").concat(c)),this.userMap.size===0?P(new Ie(Y.INVALID_REMOTE_USER)):P(new Ie(Y.TIMEOUT))},Q("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),x=()=>{j&&window.clearTimeout(j),this.off(BE.ABORT,M),o&&I()},M=()=>{j&&window.clearTimeout(j),this.off("res-@".concat(c,"_ack"),x),this.off("res-@".concat(c),$),P(new Ie(Y.EXTERNAL_SIGNAL_ABORT,"type: ".concat(n,", requestId: ").concat(c)))};this.once(BE.ABORT,M),this.once("res-@".concat(c,"_ack"),x);const $=(oe,me)=>{q=!0,j&&window.clearTimeout(j),this.off("res-@".concat(c,"_ack"),x),this.off(BE.ABORT,M),oe==="success"?I(me):P(new Ie(Y.P2P_MESSAGE_FAILED,"request ".concat(n," failed, requestId: ").concat(c)))};let q=!1;o||(this.once("res-@".concat(c),$),qi(Q("SIGNAL_REQUEST_TIMEOUT")).then(()=>{q||k.warning("external_signal request timeout, type: ".concat(n,", requestId: ").concat(c,", ").concat(y))}))});try{return await w}catch(I){if(I.code===Y.TIMEOUT)return await this.send(n,i,o,c,u);throw I}}onMessage(n){var i;const{_uid:o}=n;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in n)||n._type!==Xr.CHECK)return;const{token:v}=n;c=new Map,u={uid:o,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(on.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in n&&"total"in n){var h;const{id:v,total:y}=n,w=(h=c.get(v))!==null&&h!==void 0?h:[];if(w.push(n),c.has(v)||c.set(v,w),w.length!==y)return;{const I=xT(w).call(w,(P,j)=>P.index-j.index).map(P=>P.payload).join("");c.delete(v),(n=JSON.parse(I))._uid=o}}const{_type:f,token:_}=n;if($e(i=[Xr.ACK,Xr.CHECK]).call(i,f))return f===Xr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(n);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(n):k.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),n)}check(){const n={_id:Zn(6,""),token:this.token,_type:Xr.CHECK};Q("SHOW_P2P_LOG")&&k.debug("send message",n),this.signal.request(kt.DATA_STREAM,{payload:Lf(this.encoder.encode(JSON.stringify(n)))})}ack(n){const i={_id:n,_type:Xr.ACK,token:this.token};Q("SHOW_P2P_LOG")&&k.debug("send message",i),this.signal.request(kt.DATA_STREAM,{payload:Lf(this.encoder.encode(JSON.stringify(i)))})}response(n,i,o){this.send(Xr.RESPONSE,JSON.stringify({success:!o,message:i}),!0,n)}handleReceivedMessage(n){const i=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:y,nextExpectedSequenceNumber:w}=v;for(;y.has(w);){const I=y.get(w);y.delete(w),this.receiveMessage(I),v.nextExpectedSequenceNumber++}})};if(!n)return void i();const{_uid:o,_seq:c}=n,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:f,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(n._id),void k.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(n._message));h.set(c,n),f&&c===_&&(this.receiveMessage(n),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(n){const{_id:i,_type:o,_message:c,_uid:u}=n;if(Q("SHOW_P2P_LOG")&&k.debug("receive message",n),i){let h;switch(n._type!==Xr.ACK&&(c&&(h=JSON.parse(c)),this.ack(n._id)),n._type){case Xr.CANDIDATE:case Xr.CONTROL:this.signal.emit(o,h,u);break;case Xr.PUBLISH:case Xr.UNPUBLISH:case Xr.RESTART_ICE:case Xr.CALL:h.uid=u,ls(this.signal,o,h).then(f=>{this.response(n._id,f)}).catch(()=>{this.response(n._id,void 0,!0)});break;case Xr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Xr.RESPONSE:{const{success:f,message:_}=h;this.emit("res-@".concat(i),f?"success":"failed",_);break}}}}splitMessage(n){if(n.length<l_.MAX_MESSAGE_SIZE)return[n];const i=[],{remoteToken:o}=JSON.parse(n),c=Zn(6,"");let u=0,h=800;const f=Math.ceil(n.length/h);for(;n.length>0;){u++;const _={id:c,index:u,total:f,payload:n.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>l_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),n=n.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(n,i){return n.token!==i?(k.debug("token changed, from ".concat(n.token," to ").concat(i)),this.reset(n.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{k.debug("token timeout, ".concat(i)),this.reset(n.uid)},Q("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const n=await ls(this.signal,Xr.CALL,void 0),i=await this.send(Xr.CALL,n);this.signal.emit(xt.P2P_CONNECTION,i,!0)}async reset(n,i){const o=this.userMap.get(n);o&&(this.emit(BE.ABORT),this.signal.emit(on.ON_USER_OFFLINE,{uid:o.uid,reason:kde.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(k.debug("change local token from ".concat(i," to ").concat(i)),this.token=Zn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(BE.ABORT)}}G(l_,"MAX_SIZE",1),G(l_,"MAX_MESSAGE_SIZE",1024);class ffe extends Rr{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===rr.CONNECTED?this.emit(xt.WS_CONNECTED):n===rr.RECONNECTING?this.emit(xt.WS_RECONNECTING,this._websocketReconnectReason):n===rr.CLOSED&&this.emit(xt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),G(this,"_disconnectedReason",void 0),G(this,"_websocketReconnectReason",void 0),G(this,"_connectionState",rr.CLOSED),G(this,"reconnectToken",void 0),G(this,"p2pToken",void 0),G(this,"websocket",void 0),G(this,"openConnectionTime",void 0),G(this,"clientId",void 0),G(this,"lastMsgTime",Date.now()),G(this,"uploadCache",[]),G(this,"uploadCacheInterval",void 0),G(this,"rttRolling",new j5(5)),G(this,"pingpongTimer",void 0),G(this,"pingpongTimeoutCount",0),G(this,"joinResponse",void 0),G(this,"multiIpOption",void 0),G(this,"initError",void 0),G(this,"spec",void 0),G(this,"store",void 0),G(this,"_external_signal",void 0),G(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(xt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case on.ON_DATA_STREAM:return void this.handleDataStream(c._message);case on.MUTE_AUDIO:case on.MUTE_VIDEO:case on.ON_P2P_LOST:case on.ON_USER_ONLINE:return;case on.ON_USER_OFFLINE:const{uid:u}=c._message;return k.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===on.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===on.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Ln.UID_BANNED);break;case 15:this.close(Ln.IP_BANNED);break;case 16:this.close(Ln.CHANNEL_BANNED)}if(c._type===on.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ct.ERR_LICENSE_MISSING:this.close(Ln.LICENSE_MISSING);break;case Ct.ERR_LICENSE_EXPIRED:this.close(Ln.LICENSE_EXPIRED);break;case Ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ln.LICENSE_MINUTES_EXCEEDED);break;case Ct.ERR_LICENSE_PERIOD_INVALID:this.close(Ln.LICENSE_PERIOD_INVALID);break;case Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ln.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ct.ERR_LICENSE_ILLEGAL:this.close(Ln.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new eL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Q("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Q("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===rr.CONNECTED&&this.reconnect("retry",cs.OFFLINE)}),this.p2pToken=Zn(6,""),this._external_signal=new l_(this,this.p2pToken)}async request(n,i,o,c){const u=Zn(6,""),h={_id:u,_type:n,_message:i},f=this.websocket.connectionID,_=()=>new Je((j,x)=>{if(this.connectionState===rr.CONNECTED)return j();const M=()=>{this.off(xt.WS_CLOSED,$),j()},$=()=>{this.off(xt.WS_CONNECTED,M),x(new Ie(Y.WS_ABORT))};this.once(xt.WS_CONNECTED,M),this.once(xt.WS_CLOSED,$)});if(this.connectionState!==rr.CONNECTING&&this.connectionState!==rr.RECONNECTING||n===kt.JOIN||n===kt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const v=new Je((j,x)=>{let M=!1;const $=(oe,me)=>{M=!0,j({isSuccess:oe==="success",message:me||{}}),this.off(xt.WS_CLOSED,q),this.off(xt.WS_RECONNECTING,q),this.emit(xt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),$);const q=()=>{x(new Ie(Y.WS_ABORT,"type: ".concat(n))),this.off(xt.WS_CLOSED,q),this.off(xt.WS_RECONNECTING,q),this.off("res-@".concat(u),$)};this.once(xt.WS_CLOSED,q),this.once(xt.WS_RECONNECTING,q),qi(Q("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||M||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(xt.REQUEST_TIMEOUT,n,i))})});let y=null;try{y=await v}catch(j){if(this.connectionState===rr.CLOSED||n===kt.LEAVE)throw new Ie(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?j.throw():n===kt.JOIN||n===kt.REJOIN?null:(await _(),await this.request(n,i))}if(y.isSuccess)return y.message;const w=Number(y.message.error_code||y.message.code),I=a0(w),P=new Ie(Y.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(y.message.error_str),{code:w,data:y.message,desc:I.desc});return I.action==="success"?y.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(I.desc,", action: ").concat(I.action)),w===Ct.ERR_TOO_MANY_BROADCASTERS?((n===kt.JOIN||n===kt.REJOIN)&&(this.initError=P,this.close()),P.throw()):I.action==="failed"?P.throw():I.action==="quit"?(this.initError=P,this.close(),P.throw()):(w===Ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",cs.MULTI_IP)):this.reconnect(I.action,cs.SERVER_ERROR),n===kt.JOIN||n===kt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new Je(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(s0.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=Q("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==rr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Q("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(n,i,o){return await this._external_signal.send(n,i,o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Je((i,o)=>{this.once(xt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(xt.WS_CLOSED,()=>o(this.initError||new Ie(Y.WS_ABORT))),this.connectionState=rr.CONNECTING,this.websocket.init(n).catch(o)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=n||Ln.LEAVE,this.connectionState=rr.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Zn(6,""),this._external_signal.clear(),this._external_signal=new l_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(xt.ABORT_P2P_EXECUTION);const n=await ls(this,xt.REQUEST_JOIN_INFO),i=await this.request(kt.JOIN,n);if(!i)return this.emit(xt.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(xt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=rr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleDataStream(n){try{var i;const o=Fg(n.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||$e(i=Object.values(Xr)).call(i,u._type)?(u._uid=n.uid,this._external_signal.onMessage(u)):this.emit(on.ON_DATA_STREAM,n)}catch{this.emit(on.ON_DATA_STREAM,n)}}handleNotification(n){k.debug("[".concat(this.clientId,"] receive notification: "),n);const i=a0(n.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ln.UID_BANNED),void this.close()):void this.reconnect(i.action,cs.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=Q("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(k.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>Q("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",cs.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),Q("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Wt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(xt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Wt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Wt.CLOSED,()=>{this.connectionState=rr.CLOSED}),this.websocket.on(Wt.FAILED,()=>{this._disconnectedReason=Ln.NETWORK_ERROR,this.connectionState=rr.CLOSED}),this.websocket.on(Wt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===rr.CONNECTED?this.connectionState=rr.RECONNECTING:this.connectionState=rr.CONNECTING}),this.websocket.on(Wt.WILL_RECONNECT,(n,i,o)=>{n!=="retry"?(k.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0):k.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(n)}),this.websocket.on(Wt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(n=>{if(this.emit(xt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof Ie&&n.code===Y.UNEXPECTED_RESPONSE&&n.data.code===Ct.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",cs.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",cs.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Wt.REQUEST_NEW_URLS,(n,i)=>{ls(this,xt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(on.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const mfe={name:"P2PChannel",create:function(e){let{store:n,statsCollector:i}=e;return new pfe(n,i)},createSubmodule:function(e){let{store:n,spec:i}=e;return new ffe(i,n)}};function d9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function h9(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?d9(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class gfe{constructor(n){G(this,"sessionDesc",void 0),G(this,"localCapabilities",void 0),G(this,"rtpCapabilities",void 0),G(this,"candidates",void 0),G(this,"_originCandidates",void 0),G(this,"iceParameters",void 0),G(this,"dtlsParameters",void 0),G(this,"setup",void 0),G(this,"currentMidIndex",void 0),G(this,"cname",void 0),n=Lr(n);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:f,sdkCodec:_,cname:v}=n,y=oa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Lr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=f,this.cname=v;for(let w=0;w<y.mediaDescriptions.length;w++){const I=y.mediaDescriptions[w];if(I.attributes.iceUfrag=i.iceUfrag,I.attributes.icePwd=i.icePwd,I.attributes.fingerprints=o.fingerprints,I.attributes.candidates=c,I.attributes.setup=h,I.media.mediaType==="video"){I.media.fmts=u.videoCodecs.map(j=>j.payloadType.toString(10));let P=u.videoCodecs.filter(j=>{var x,M;return(x=j.rtpMap)===null||x===void 0?void 0:$e(M=x.encodingName.toLowerCase()).call(M,_)});P.length===0&&(P=u.videoCodecs),I.attributes.payloads=P,I.attributes.extmaps=u.videoExtensions}I.media.mediaType==="audio"&&(I.media.fmts=u.audioCodecs.map(P=>P.payloadType.toString(10)),I.attributes.payloads=u.audioCodecs,I.attributes.extmaps=u.audioExtensions),y.mediaDescriptions[w]=this.mungMediaDesc(I)}this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1}toString(){return xf(this.sessionDesc)}send(n,i,o){const{ssrcs:c,ssrcGroups:u}=Yg(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>n===st.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),f=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:f,mslabel:_}}batchSend(n){return n.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(n){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{$e(n).call(n,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var f;$e(f=u.map(_=>_.ssrcId)).call(f,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(n,i,o){n.forEach((c,u)=>{const h=c._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],c);this.sessionDesc.mediaDescriptions[f]=_})}stopReceiving(n){}updateCandidates(n){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(h9(h9({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(n){case ys.TCP_RELAY:this.candidates=o;break;case ys.UDP_TCP_RELAY:case ys.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(n){n=Lr(n),this.iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let o=0;o<n;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(n,i){const o=Lr(n);return zE(o,i),iL(o,i),o}updateRecvMedia(n,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(n){this.currentMidIndex+=n}updateTrackLabel(n,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>n===st.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(f=>f.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(n){const i=Lr(n);return rL(i),function(o){const c=o.attributes.extmaps.find(u=>ZI(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(n){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===n)return[o]}}var Jn;function p9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function VA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?p9(Object(i),!0).forEach(function(o){G(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let _fe=(Jn=class yb extends TG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return $e(i=Object.keys(AI)).call(i,n)}))]}constructor(n,i){super(n,i),G(this,"store",void 0),G(this,"peerConnection",void 0),G(this,"remoteSDP",void 0),G(this,"initialOffer",void 0),G(this,"statsFilter",void 0),G(this,"useRTX",!1),G(this,"localCapabilities",void 0),G(this,"localCandidateCount",0),G(this,"allCandidatesReceived",!1),G(this,"establishPromise",void 0),G(this,"mutex",void 0),this.store=i,this.mutex=new vs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(yb.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=_1(this.peerConnection,Q("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const n=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=jf(n.sdp),o=u0(n.sdp,{filterRTX:!this.useRTX,filterVideoFec:Q("FILTER_VIDEO_FEC"),filterAudioFec:Q("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=n,VA(VA({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:n.sdp})}catch(n){throw new Ie(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async updateRemoteConnect(){}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new gfe(VA(VA({},n),{},{rtpCapabilities:n.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(n,i){throw new Ie(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(n){}send(n,i){var o=this;return qc(function*(){const c=yield fn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=n.map(I=>o.peerConnection.addTrack(I._mediaStreamTrack)),h=yield fn(o.peerConnection.createOffer()),f=oa(h.sdp),_=n.map(I=>{const P=I._mediaStreamTrack,j=f.mediaDescriptions.find(x=>x.attributes.mid===P.kind);if(!j)throw new Error("Cannot extract ssrc from mediaDescription.");return function(x,M,$){const q=x.attributes.ssrcs.filter(me=>me.attributes.label===M),oe=x.attributes.ssrcGroups;if(q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(oe&&q.length>1){const me=oe.find(ge=>ge.ssrcIds.indexOf(q[0].ssrcId)!==-1);return me?[{ssrcId:me.ssrcIds[0],rtx:$?me.ssrcIds[1]:void 0}]:[{ssrcId:q[0].ssrcId}]}return[{ssrcId:q[0].ssrcId}]}(j,P.id,o.useRTX)});let v;try{v=yield _}catch(I){throw u.forEach(P=>{as()&&P.replaceTrack(null),o.peerConnection.removeTrack(P)}),I}const y=o.mungSendOfferSDP(h.sdp,n);o.remoteSDP.receive(n,i,v);const w=o.remoteSDP.toString();return yield fn(o.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield fn(o.applySendEncodings(u,n)),yield fn(o.peerConnection.setRemoteDescription({type:"answer",sdp:w})),n.map((I,P)=>{const j=I._mediaStreamTrack.id;return{localSSRC:_[P],id:j}})}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{as()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(n);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(n,i,c),f=new Je((y,w)=>{const I=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(u)))},1e4),P=j=>{const x=mn();if((x.name==="Safari"&&Number(x.version)===11||io())&&j.track.id!==u&&j.streams[0].id===h){var M;const $=j.streams[0].getTracks()[0];return(M=this.remoteSDP)===null||M===void 0||M.updateTrackLabel(n,u,j.track.id),this.peerConnection.removeEventListener("track",P),clearTimeout(I),void y($)}if(j.track.id===u)return this.peerConnection.removeEventListener("track",P),clearTimeout(I),void y(j.track)};this.peerConnection.addEventListener("track",P)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await f,id:u}}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){}async unmuteRemote(n){}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return n.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==n.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(as()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(as()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(f=>f.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return qc(function*(){const o=yield fn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=wn().supportPCSetConfiguration;if(n===ys.RELAY&&!c)return;if(c){const v=i.peerConnection.getConfiguration(),y=n===ys.RELAY?"relay":"all";v.iceTransportPolicy!==y&&(k.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(y,"]")),v.iceTransportPolicy=y,i.peerConnection.setConfiguration(v))}n!==ys.RELAY&&i.remoteSDP.updateCandidates(n);const u=yield fn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=jf(u.sdp),{remoteIceParameters:f}=yield h.iceParameters;i.remoteSDP.restartICE(f);const _=i.remoteSDP.toString();yield fn(i.peerConnection.setLocalDescription(u)),yield fn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){k.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var n;this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ie(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===n});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(n._mediaStreamTrack)}createDataChannels(n,i){throw new Ie(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new Ie(Y.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Q("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(JT(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...yb.turnServerConfigToIceServers(n.turnServer.servers)),Q("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...yb.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(v=>{var y;return((y=v.track)===null||y===void 0?void 0:y.id)===n._mediaStreamTrack.id})),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!wn().supportSetRtpSenderParameters)return k.warn("Browser not support set rtp-sender parameters");const c={},u={};if(n instanceof ur)switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(Q("DSCP_TYPE")&&Jh()){var h;const v=Q("DSCP_TYPE");$e(h=["very-low","low","medium","high"]).call(h,v)&&(u.networkPriority=v)}const f=i.getParameters(),_=(o=f.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(f,c),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await i.setParameters(f)}async applySendEncodings(n,i){try{if(!wn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i){const o=oa(n);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,f=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);f&&zE(f,c)}),xf(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(n).map((u,h)=>{let{id:f,mslabel:_}=u;const{kind:v}=n[h];return new Je((y,w)=>{const I=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(f)))},1e4),P=j=>{const x=mn();if(x.name==="Safari"&&Number(x.version)===11&&j.track.id!==f&&j.streams[0].id===_){var M;const $=j.streams[0].getTracks()[0];return(M=this.remoteSDP)===null||M===void 0||M.updateTrackLabel(v,f,j.track.id),this.peerConnection.removeEventListener("track",P),clearTimeout(I),void y({track:$,id:f})}if(j.track.id===f)return this.peerConnection.removeEventListener("track",P),clearTimeout(I),void y({track:j.track,id:f})};this.peerConnection.addEventListener("track",P)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await Je.all(i)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i==null?void 0:i[0].ssrcId}setConfiguration(n){if(wn().supportPCSetConfiguration){const i=yb.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},ct(Jn.prototype,"connect",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"connect"),Jn.prototype),ct(Jn.prototype,"stopSending",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"stopSending"),Jn.prototype),ct(Jn.prototype,"receive",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"receive"),Jn.prototype),ct(Jn.prototype,"stopReceiving",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"stopReceiving"),Jn.prototype),ct(Jn.prototype,"muteRemote",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"muteRemote"),Jn.prototype),ct(Jn.prototype,"unmuteRemote",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"unmuteRemote"),Jn.prototype),ct(Jn.prototype,"muteLocal",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"muteLocal"),Jn.prototype),ct(Jn.prototype,"unmuteLocal",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"unmuteLocal"),Jn.prototype),ct(Jn.prototype,"close",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"close"),Jn.prototype),ct(Jn.prototype,"updateEncoderConfig",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"updateEncoderConfig"),Jn.prototype),ct(Jn.prototype,"updateSendParameters",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"updateSendParameters"),Jn.prototype),ct(Jn.prototype,"replaceTrack",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"replaceTrack"),Jn.prototype),ct(Jn.prototype,"getRemoteSSRC",[nl],Object.getOwnPropertyDescriptor(Jn.prototype,"getRemoteSSRC"),Jn.prototype),Jn);function nl(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return await o.apply(this,f)}finally{u()}},i}const vfe={name:"PlanBConnection",create:function(e){let{store:n,spec:i}=e;return new _fe(i,n)}},Efe={interceptLocalAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wn().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(UI.has(e)||!e.track)return;const i={track:e.track};if(Xh()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){i.controller||(i.controller=f),e.track&&e.track.id!==i.track.id&&(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=n.metadata&&n.metadata();_?function(v,y){const{chunk:w,controller:I}=y,P=Q("ENABLE_AUDIO_PTS_METADATA")?tp.AUDIO_64_BIT_PTS:tp.METADATA;w.data=function(j,x,M){const $=M.byteLength,q=$+B1+oG,oe=F1+j1+q,me=new ArrayBuffer(j.byteLength+oe),ge=new DataView(me);ge.setUint8(0,sG),ge.setUint16(1,q),ge.setUint8(3,x),ge.setUint16(4,$);for(let Re=0;Re<$;Re++)ge.setUint8(6+Re,M[Re]);const fe=new Uint8Array(ge.buffer);return fe.set(new Uint8Array(j),oe),fe.buffer}(w.data,P,v),I.enqueue(w)}(_,{chunk:h,controller:f}):f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(as()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=MI(),u=new MessageChannel;await new Je(f=>c.onmessage=_=>{_.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new Je(f=>c.onmessage=_=>{_.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var _;if(f.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(f.data.getMetadata){const v=n.metadata&&n.metadata();v&&u.port1.postMessage({metadata:v})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=UI.get(e);if(c){UI.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){k.warning(f&&f.message)}}}UI.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wn().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(GI.has(e))return;const i={track:e.track,onMetadata:n.onMetadata};if(Xh()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");ZD(An.CHROME,87,116)||(n.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){i.controller||(i.controller=f),e.track&&e.track.id!==i.track.id&&(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),n.enableTopn?function(_,v,y){var w;const I=aG(new DataView(v.data));if(!I)return y.enqueue(v);const P=_.track.id;Zue.set(P,_.track);const j=(w=I.tlv.find(me=>me.tag===tp.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let x=0;typeof j=="number"&&(x=127-j);const M=Math.round(Math.pow(10,x/60)-1),{selected:$,speaker:q}=function(me,ge){let fe=UE.get(me);if(fe||(fe=function(Re){const Ue=new lG;return UE.set(Re,Ue),Mu||(Mu=new Jue(Q("TOPN_SILENCE_THRESHOLD")||500),Mu.on("ActiveSpeakerChanged",Qe=>{Qe!=null&&(jI=Qe)})),Mu.addSpeakers([Ue]),Ue}(me)),UE.size<=uG)return{selected:!0,speaker:fe};if(!Mu)throw new Error("no active speaker detector");return Mu.levelChanged(fe.id,ge),Kg=Mu.loudest.map(Re=>Re.id),jI&&!$e(Kg).call(Kg,jI)&&Kg.length>=uG&&Kg.pop(),{selected:$e(Kg).call(Kg,fe.id)||fe.id===jI,speaker:fe}}(_,M),oe=function(me,ge,fe){const Re=Uu.get(me)||new Que(me,ge);return Re.score=fe,Uu.set(me,Re),function(Ue){if(BI.set(Ue,!0),!WI)return void(WI=Date.now());const Qe=Date.now();Qe-WI>1e3&&(BI.get(Ue)?BI.set(Ue,!1):(dG(Ue),BI.delete(Ue)),WI=Qe)}(me),Re}(P,_.track,q.energyScore);oe.addSample($),oe.active&&(v.data=I.frame.buffer,y.enqueue(v))}(e,h,f):n.enableMetadata?function(_,v,y){const w=aG(new DataView(_.data));if(!w)return v.enqueue(_);const I=w.tlv.find(P=>P.tag===tp.METADATA||P.tag===tp.AUDIO_64_BIT_PTS);I&&y&&I.value instanceof Uint8Array&&y(I.value),_.data=w.frame.buffer,v.enqueue(_)}(h,f,n.onMetadata):f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(as()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=MI(),u=new MessageChannel;await new Je(f=>c.onmessage=_=>{_.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new Je(f=>c.onmessage=_=>{_.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var _;f.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):f.data.metadata&&i.onMetadata&&i.onMetadata(f.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=GI.get(c);if(u){(function(_){const v=UE.get(_);v&&(UE.delete(_),Mu&&(Mu.removeSpeakers([v]),UE.size===0&&(Mu.destroy(),Mu=null)))})(c),dG(c.track.id),GI.delete(c);try{var h,f;(h=u.controller)===null||h===void 0||h.terminate(),(f=u.worker)===null||f===void 0||f.terminate()}catch(_){k.warning(_&&_.message)}}}(e)}GI.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,n){if(!wn().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(zI.has(e)||!e.track)return;const i={track:e.track};if(Xh()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(f){return void k.error("create video-encoded-streams error",f&&f.message)}const u=[];n.on("sei-to-send",f=>{u.push(f)});const h=new TransformStream({transform(f,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const v=u.shift();v&&(f.data=function(y,w){const I=function(q){const oe=q.length;let me=[],ge=0;for(;ge<oe;)ge+2<oe&&q[ge]===0&&q[ge+1]===0&&(q[ge+2]===0||q[ge+2]===1||q[ge+2]===2||q[ge+2]===3)?(me.push(q[ge],q[ge+1],3,q[ge+2]),ge+=3):(me.push(q[ge]),ge++);return new Uint8Array(me)}(w),P=I.length,j=Math.floor(P/255),x=P%255,M=new Uint8Array(6+j+1+P+y.byteLength);M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=6,M[5]=101;let $=0;for(;$<j;)M[6+$]=255,$++;return M[6+$]=x,$++,M.set(I,6+$),M.set(new Uint8Array(y),6+$+P),M.buffer}(f.data,v)),_.enqueue(f)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!as())return;{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=MI(),u=new MessageChannel;await new Je(f=>c.onmessage=_=>{_.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new Je(f=>c.onmessage=_=>{_.data==="started"&&f(void 0)}),n.on("sei-to-send",f=>{u.port1.postMessage({sei:f})}),u.port1.onmessage=f=>{var _;f.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=zI.get(e);if(c){zI.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){k.warning(f&&f.message)}}}zI.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wn().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(!e.track)return;if(i0.has(e)){const c=i0.get(e);return void(c&&(c.onSei=n.onSei))}const i={track:e.track,onSei:n.onSei};if(Xh()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){i.controller||(i.controller=f),e.track&&e.track.id!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(v){const y=new DataView(v.data);let w=0;for(;w+4<v.data.byteLength;){if(y.getUint8(w+0)===0&&y.getUint8(w+1)===0&&y.getUint8(w+2)===0&&y.getUint8(w+3)===1&&y.getUint8(w+4)===6){let I=w+6,P=0,j=0;for(;(j=y.getUint8(I++))===255;)P+=255;P+=j;const x=ede(v.data,I,P);return new Uint8Array(x)}w++}return null}(h);_&&i.onSei&&i.onSei(_),f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(as()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=MI(),u=new MessageChannel;await new Je(f=>c.onmessage=_=>{_.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new Je(f=>c.onmessage=_=>{_.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var _;f.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):f.data.sei&&i.onSei&&i.onSei(f.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=i0.get(c);if(u){i0.delete(c);try{var h,f;(h=u.controller)===null||h===void 0||h.terminate(),(f=u.worker)===null||f===void 0||f.terminate()}catch(_){k.warning(_&&_.message)}}})(e)}i0.set(e,i),e.track.addEventListener("ended",o)}},yfe={name:"InterceptFrame",create:()=>Efe};v1(),Hn("PROCESS_ID","process-".concat(Zn(8,""),"-").concat(Zn(4,""),"-").concat(Zn(4,""),"-").concat(Zn(4,""),"-").concat(Zn(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void k.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();k.debug("Loading global parameters from cache",n),Object.keys(n).forEach(o=>{if(Object.prototype.hasOwnProperty.call(lr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;xu[o]=c,lr[o]=c}})}catch(n){k.error("Error loading mutableParamsCache: ".concat(e),n.message)}}(),Array.isArray(xu.AREAS)&&xu.AREAS.length>0&&lL(xu.AREAS,!0);const f9=(e,n,i)=>{k.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(n))),Hn(e,n,i)};Bf(Gpe,!1),Bf(Kpe,!1),Bf(Rhe,!1),Bf(rfe,!1),Bf(jpe,!1),Bf(mfe,!1),Bf(vfe,!1),Bf(yfe,!1);const fi=function(e){const n=new Rr,i=e,o={getListeners:n.getListeners.bind(n),on:(c,u)=>(function(h,f){h===xd.SECURITY_POLICY_VIOLATION&&q8(f,!0)}(c,u),n.on.bind(n)(c,u)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return $8($8({},i),o)}({__TRACK_LIST__:IE,VERSION:Yc,BUILD:S1,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:f9,getParameter:Q,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let n=new RTCPeerConnection;const i=await async function(o){let c;return wn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(n);if(!i)return e;n.close(),n=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(n){throw new be(Y.CREATE_OFFER_FAILED,n.toString&&n.toString()).print()}return e},checkSystemRequirements:function(){const e=ht.reportApiInvoke(null,{name:hi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Dr.TRACER});let n=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;n=!!(u&&h&&f),n&&r1()&&m5(75)&&new u().close()}catch(u){return k.error("check system requirement failed: ",u),!1}let i=!1;const o=mn();o.name===An.CHROME&&Number(o.version)>=58&&(Du.engine.name!=="WebKit"||function(){const u=mn();if(EI()){if(u.os===Ai.MAC_OS)return!0;if(u.os===Ai.IOS){const h=Du.os.version&&Du.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===An.FIREFOX&&Number(o.version)>=56||o.name===An.OPERA&&Number(o.version)>=45||o.name===An.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(io()||kl())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||S5()||mn().name===An.QQ)&&(i=!0),k.debug("checkSystemRequirements, api:",n,"browser",i);const c=n&&i;return e.onSuccess(c),c},getDevices:function(e){return vc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return vc.getRecordingDevices(e)},getCameras:function(e){return vc.getCamerasDevices(e)},getElectronScreenSources:m6,getPlaybackDevices:function(e){return vc.getSpeakers(e)},createClient:function(){var e;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=Zn(5,"client-"),o=ht.reportApiInvoke(null,{id:i,name:hi.CREATE_CLIENT,options:[n],tag:Dr.TRACER});try{(function(c){Ti(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ti(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Ti(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&$i(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&O5(c.turnServer),c.httpRetryConfig!==void 0&&A5(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&A5(c.websocketRetryConfig)})(n)}catch(c){throw o.onError(c),c}return(_5(16,0)||v5(16,0,!0))&&(n.codec==="vp9"&&(n.codec="vp8",k.debug("browser not support vp9, force use vp8")),Hn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),n.audioCodec===void 0&&(n.audioCodec="opus"),o.onSuccess(),new Che(jl(jl({forceWaitGatewayResponse:!0},n),{},{role:$e(e=["rtc","p2p"]).call(e,n.mode)?"host":n.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Q("CAMERA_CAPTURE_CONFIG"),i=Zn(8,"track-cam-"),o=ht.reportApiInvoke(null,{id:i,tag:Dr.TRACER,name:hi.CREATE_CAM_VIDEO_TRACK,options:[yr({},e),n]});n&&(e.encoderConfig=n);const c=LI(e);let u=null;k.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await _c({video:c},i)).getVideoTracks()[0]||null}catch(f){throw o.onError(f),f}if(!u){const f=new Ie(Y.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(f),f.throw(k)}e.optimizationMode&&V1(i,u,e,kd(e.encoderConfig));const h=new U1(u,e,c,e.scalabiltyMode?PI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),k.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const n=Zn(8,"track-cus-"),i=ht.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:hi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new ur(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?PI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[er.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),k.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof n=="object"?function(I){return R6(I)}(n):void 0;i&&(n="auto");const o=Zn(8,"track-scr-v-"),c=ht.reportApiInvoke(null,{id:o,tag:Dr.TRACER,name:hi.CREATE_SCREEN_VIDEO_TRACK,options:[yr({},e),n]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(I){const P={};I.screenSourceType&&(P.mediaSource=I.screenSourceType),I.extensionId&&Xh()&&(P.extensionId=I.extensionId);const{displaySurface:j,selfBrowserSurface:x,surfaceSwitching:M,systemAudio:$,preferCurrentTab:q}=I;($T(107)||e1(107)||t1(93))&&(j&&(Ti(j,"displaySurface",["browser","window","monitor"]),P.displaySurface=j),x?(Ti(x,"selfBrowserSurface",["exclude","include"]),P.selfBrowserSurface=x):P.selfBrowserSurface="include",M&&(Ti(M,"surfaceSwitching",["exclude","include"]),P.surfaceSwitching=M)),($T(105)||e1(105)||t1(91))&&$&&(Ti($,"systemAudio",["exclude","include"]),P.systemAudio=$),($T(94)||e1(94)||t1(80))&&q&&(P.preferCurrentTab=!0),I.electronScreenSourceId&&(P.sourceId=I.electronScreenSourceId);const oe=I.encoderConfig?C1(I.encoderConfig):null;return P.mandatory={chromeMediaSource:"desktop",maxWidth:oe?oe.width:void 0,maxHeight:oe?oe.height:void 0},oe&&(oe.frameRate&&(typeof oe.frameRate=="number"?(P.mandatory.maxFrameRate=oe.frameRate,P.mandatory.minFrameRate=oe.frameRate):(P.mandatory.maxFrameRate=oe.frameRate.max||oe.frameRate.ideal||oe.frameRate.exact||void 0,P.mandatory.minFrameRate=oe.frameRate.min||oe.frameRate.ideal||oe.frameRate.exact||void 0),P.frameRate=oe.frameRate),oe.width&&(P.width=oe.width),oe.height&&(P.height=oe.height)),P}(e);let h=null,f=null;const _=wn();if(!_.supportShareAudio&&n==="enable"){const I=new Ie(Y.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(I),I.throw(k)}k.info("start create screen video track with config",e,"withAudio",n,"trackId",o);const v=_.supportShareAudio&&n!=="disable";try{const I=await _c({screen:u,screenAudio:v?i||!0:void 0},o);h=I.getVideoTracks()[0]||null,f=I.getAudioTracks()[0]||null}catch(I){throw c.onError(I),I}if(!h){const I=new Ie(Y.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(I),I.throw(k)}if(!f&&n==="enable"){h&&h.stop();const I=new Ie(Y.SHARE_AUDIO_NOT_ALLOWED);return c.onError(I),I.throw(k)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(V1(o,h,e,e.encoderConfig&&C1(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const y=new ur(h,e.encoderConfig?C1(e.encoderConfig):{},e.scalabiltyMode?PI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[er.SCREEN_TRACK]);if(!f)return c.onSuccess(y.getTrackId()),k.info("create screen video track success","video:",y.getTrackId()),y;const w=new Vr(f,void 0,Zn(8,"track-scr-a-"),!1);return c.onSuccess([y.getTrackId(),w.getTrackId()]),k.info("create screen video track success","video:",y.getTrackId(),"audio:",w.getTrackId()),[y,w]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=Q("CAMERA_CAPTURE_CONFIG"),o=Zn(8,"track-mic-"),c=Zn(8,"track-cam-"),u=ht.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Dr.TRACER,name:hi.CREATE_MIC_AND_CAM_TRACKS,options:[e,n,i]});i&&(n.encoderConfig=i);const h=LI(n),f=C6(e);let _=null,v=null;k.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(n)));try{const I=await _c({audio:f,video:h},"".concat(o,"-").concat(c));_=I.getAudioTracks()[0],v=I.getVideoTracks()[0]}catch(I){throw u.onError(I),I}if(!_||!v){const I=new Ie(Y.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(I),I.throw(k)}n.optimizationMode&&V1(c,v,n,kd(n.encoderConfig));const y=new xI(_,e,f,o),w=new U1(v,n,h,n.scalabiltyMode?PI(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return u.onSuccess([y.getTrackId(),w.getTrackId()]),k.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[y,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Zn(8,"track-mic-"),i=ht.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:hi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=C6(e);let c=null;k.info("start create microphone audio track with config",JSON.stringify(e),"trackId",n);try{c=(await _c({audio:o},n)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Ie(Y.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(k)}const u=new xI(c,e,o,n);return i.onSuccess(u.getTrackId()),k.info("create microphone audio track success, trackId:",n),u},createCustomAudioTrack:function(e){const n=Zn(8,"track-cus-"),i=ht.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:hi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Vr(e.mediaStreamTrack,e.encoderConfig?NI(e.encoderConfig):{},n,!1);return k.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var n;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(n=File.name)!==null&&n!==void 0?n:"File":c,cacheOnlineFile:i,encoderConfig:o},h=Zn(8,"track-buf-"),f=ht.reportApiInvoke(null,{id:h,tag:Dr.TRACER,name:hi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(Q("DISABLE_WEBAUDIO"))throw new Ie(Y.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");k.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(w,I){let P=null;if(typeof w=="string"){const x=hW.get(w);if(x)return k.debug("use cached audio resource: ",w),x;try{P=(await Lu(()=>No.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(M){throw new Ie(Y.FETCH_AUDIO_FILE_FAILED,M.toString())}}else P=await new Je((M,$)=>{const q=new FileReader;q.onload=oe=>{oe.target?M(oe.target.result):$(new Ie(Y.READ_LOCAL_AUDIO_FILE_ERROR))},q.onerror=()=>{$(new Ie(Y.READ_LOCAL_AUDIO_FILE_ERROR))},q.readAsArrayBuffer(w)});const j=await function(x){const M=DE();return new Je(($,q)=>{M.decodeAudioData(x,oe=>{$(oe)},oe=>{q(new Ie(Y.DECODE_AUDIO_FILE_FAILED,oe.toString()))})})}(P);return typeof w=="string"&&I&&hW.set(w,j),j}(c,i)}catch(w){return f.onError(w),w.throw(k)}const v=new Kue(c),y=new Hue(_,v,o?NI(o):{},h);return k.info("create buffer source audio track success, trackId:",h),f.onSuccess(y.getTrackId()),y},setAppType:function(e){if(k.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw k.debug("Invalid appType"),new be(Y.INVALID_PARAMS,"invalid app type",e);Hn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){Q("USE_NEW_LOG")?Hn("UPLOAD_LOG",!0):k.enableLogUpload()},disableLogUpload:function(){Q("USE_NEW_LOG")?Hn("UPLOAD_LOG",!1):k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new hz},checkAudioTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=ht.reportApiInvoke(null,{tag:Dr.TRACER,name:hi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof Vr||e instanceof ME)){const _=new be(Y.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof Vr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const f=Date.now();return new Je(_=>{const v=setInterval(()=>{const y=e.getVolumeLevel();u=y>u?y:u,h=y<h?y:h;const w=u-h>1e-4,I=Date.now()-f;if(w||I>n){clearInterval(v);const P=w,j={duration:I,deviceLabel:o,maxVolumeLevel:u,result:P};k.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(j))),i.onSuccess(j),_(P)}},200)})},checkVideoTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=ht.reportApiInvoke(null,{tag:Dr.TRACER,name:hi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof ur||e instanceof xE)){const w=new be(Y.INVALID_TRACK,"the parameter is not a video track");return i.onError(w),w.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof ur?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(as()||EI())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let f=0,_=0;try{const w=Date.now();f=await function(I,P,j,x){let M,$=0,q=null;return new Je((oe,me)=>{function ge(){$>x&&M&&(M(),oe($));const fe=j.getContext("2d");if(!fe){const Qe=new be(Y.UNEXPECTED_ERROR,"can not get canvas 2d context.");return k.error(Qe.toString()),void me(Qe)}fe.drawImage(I,0,0,160,120);const Re=fe.getImageData(0,0,j.width,j.height),Ue=Math.floor(Re.data.length/3);if(q){for(let Qe=0;Qe<Ue;Qe+=3)if(Re.data[Qe]!==q[Qe])return $+=1,void(q=Re.data);q=Re.data}else q=Re.data}setTimeout(()=>{M&&(M(),oe($))},P),M=N1(()=>{ge()},30)})}(u,n,h,4),_=Date.now()-w}catch(w){throw i.onError(w),w}dhe===An.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=f>4,y={duration:_,changedPicNum:f,deviceLabel:o,result:v};return k.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),i.onSuccess(y),v},setArea:lL,audioElementPlayCenter:ko,resumeAudioContext:function(){ko.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Ahe.processExternalMediaAEC(e)},registerExtensions:function(e){const n=Q("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!$e(n).call(n,i.name)&&n.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=k.extLog,o.reporter.hookApiInvoke=ht.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=Q(c)})}),f9("PLUGIN_INFO",n)},ChannelMediaRelayError:FE,ChannelMediaRelayEvent:rp,ChannelMediaRelayState:aa,RemoteStreamFallbackType:Vue,RemoteStreamType:Uue,ConnectionDisconnectedReason:Ln,AudienceLatencyLevelType:fue,AREAS:On,preload:async function(e,n,i,o){return Fz(e,n,i,o)}});return Object.defineProperties(fi,{onAudioAutoplayFailed:{get:()=>Ec.onAudioAutoplayFailed,set:e=>{Ec.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ec.onAutoplayFailed,set:e=>{Ec.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>fi._onSecurityPolicyViolation,set(e){fi._onSecurityPolicyViolation=e,q8(e)}},__CLIENT_LIST__:{get:()=>Q("SHOW_GLOBAL_CLIENT_LIST")?$g:[]}}),vc.on(Gg.CAMERA_DEVICE_CHANGED,e=>{k.info("camera device changed",JSON.stringify(e)),fi.onCameraChanged&&fi.onCameraChanged(e),fi.safeEmit(xd.CAMERA_CHANGED,e)}),vc.on(Gg.RECORDING_DEVICE_CHANGED,e=>{k.info("microphone device changed",JSON.stringify(e)),fi.onMicrophoneChanged&&fi.onMicrophoneChanged(e),fi.safeEmit(xd.MICROPHONE_CHANGED,e)}),vc.on(Gg.PLAYOUT_DEVICE_CHANGED,e=>{k.debug("playout device changed",JSON.stringify(e)),fi.onPlaybackDeviceChanged&&fi.onPlaybackDeviceChanged(e),fi.safeEmit(xd.PLAYBACK_DEVICE_CHANGED,e)}),ko.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),Ec.onAudioAutoplayFailed&&Ec.onAudioAutoplayFailed()},Kn.on("autoplay-failed",()=>{k.info("detect webaudio autoplay failed"),Ec.onAudioAutoplayFailed&&Ec.onAudioAutoplayFailed(),fi.safeEmit(xd.AUTOPLAY_FAILED)}),Kn.on(Xi.STATE_CHANGE,(e,n)=>{k.info("audio context state changed: ".concat(n," => ").concat(e)),fi.onAudioContextStateChanged&&fi.onAudioContextStateChanged(e,n),fi.safeEmit(xd.AUDIO_CONTEXT_STATE_CHANGED,e,n)}),ni.on(SE.NETWORK_STATE_CHANGE,(e,n)=>{k.info("[network-indicator] network state changed, ".concat(n," => ").concat(e))}),window&&(window.__ARTC__=fi),fi})}(YO)),YO.exports}var e4e=ZBe();const mw=lS(e4e),t4e="130dccf9b3554bda87f8cf577f91c8c4",n4e=mw.createClient({mode:"rtc",codec:"vp8"});let py=null;const Fne=B.createContext(null),jne=({children:r,appId:t=t4e,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:g=!0,onClientReady:E=()=>{}})=>{const[S,b]=B.useState(!1),[R,O]=B.useState(!1),[N,U]=B.useState([]),[K,z]=B.useState(null),[H,ne]=B.useState(null),[J,se]=B.useState(null),[le,ce]=B.useState(!1),[Se,Z]=B.useState(!1),[te,ie]=B.useState(!1),[ae,ve]=B.useState(null),pe=B.useRef(n4e),de=B.useRef({appId:t,channel:s,uid:l,enabled:d}),ut=B.useRef(!1),mt=B.useRef(null);B.useRef(null),B.useEffect(()=>{de.current={appId:t,channel:s,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:s,uid:l,enabled:d})},[t,s,l,d]),B.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:s,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:pe.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,s,l,d]),B.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",s),ne(s)},[s]),B.useEffect(()=>{if(!pe.current)return;const Ve=et=>{console.log(`Connection state changed to: ${et}`),et==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):et==="CONNECTED"&&(b(!0),z(null))};return pe.current.on("connection-state-change",Ve),()=>{pe.current.off("connection-state-change",Ve)}},[]),B.useEffect(()=>{if(!s||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:s,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",s,"with UID",l);const Ve=async(Bt,Vn)=>{console.log("AgoraProvider: User published:",Bt.uid,Vn);try{await pe.current.subscribe(Bt,Vn),console.log("AgoraProvider: Subscribed to user:",Bt.uid,"mediaType:",Vn),Vn==="audio"&&(Bt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Bt.uid)),U(Dn=>Dn.some(un=>un.uid===Bt.uid)?Dn:[...Dn,Bt])}catch(Dn){console.error("AgoraProvider: Error subscribing to user:",Dn)}},et=(Bt,Vn)=>{console.log("AgoraProvider: User unpublished:",Bt.uid,Vn),Vn==="audio"&&Bt.audioTrack&&(Bt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Bt.uid))},gt=Bt=>{console.log("AgoraProvider: User joined:",Bt.uid),U(Vn=>Vn.some(Dn=>Dn.uid===Bt.uid)?Vn:[...Vn,Bt])},Dt=Bt=>{console.log("AgoraProvider: User left:",Bt.uid),U(Vn=>Vn.filter(Dn=>Dn.uid!==Bt.uid))};pe.current.on("user-published",Ve),pe.current.on("user-unpublished",et),pe.current.on("user-joined",gt),pe.current.on("user-left",Dt);const Gt=async()=>{if(ut.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}ut.current=!0;try{console.log("AgoraProvider: Initializing microphone");const Bt=await Ze();if(console.log("AgoraProvider: Microphone initialized:",!!Bt),S&&mt.current===s){console.log("AgoraProvider: Already joined to channel",s),ce(!0),E(pe.current);return}if(pe.current.connectionState==="CONNECTING"||pe.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",pe.current.connectionState),mt.current&&mt.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ke()}catch(Vn){console.error("AgoraProvider: Error leaving channel:",Vn)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),ce(!0),mt.current=s,py=s,E(pe.current);return}console.log("AgoraProvider: Joining channel",s,"current joined channel:",mt.current),await Be(),console.log("AgoraProvider: Join channel completed")}catch(Bt){console.error("AgoraProvider: Error during initialization:",Bt)}finally{ut.current=!1}};return console.log("AgoraProvider: Running initialization"),Gt(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),pe.current.off("user-published",Ve),pe.current.off("user-unpublished",et),pe.current.off("user-joined",gt),pe.current.off("user-left",Dt)}},[s,d,l,E,S]);const Ze=async()=>{if(!d||J)return J;console.log("Initializing microphone");try{const Ve=await mw.createMicrophoneAudioTrack();return await Ve.setMuted(g),se(Ve),console.log("Microphone initialized successfully"),Ve}catch(Ve){return console.error("Error initializing microphone:",Ve),z("Failed to initialize microphone. Please check your permissions."),null}},Be=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(!s)return console.error("AgoraProvider: No channel specified"),z("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",s,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:S,isJoining:Se,connectionState:pe.current.connectionState,joinedChannel:mt.current}),S&&mt.current===s)return console.log("AgoraProvider: Already joined to channel:",s),!0;if(Se)return console.log("AgoraProvider: Already in the process of joining"),!1;if(pe.current.connectionState==="CONNECTED")if(mt.current&&mt.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ke()}catch(Ve){console.error("AgoraProvider: Error leaving channel:",Ve)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),ce(!0),mt.current=s,py=s,E(pe.current),!0;if(pe.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),Z(!0),new Promise(Ve=>{const et=setInterval(()=>{pe.current.connectionState==="CONNECTED"&&(clearInterval(et),b(!0),Z(!1),ce(!0),mt.current=s,py=s,E(pe.current),Ve(!0))},500);setTimeout(()=>{clearInterval(et),console.log("AgoraProvider: Connection timeout, considering join failed"),Z(!1),Ve(!1)},1e4)});try{console.log("AgoraProvider: Joining channel:",s,"with UID:",l||"random"),Z(!0);const Ve=l||Math.floor(Math.random()*1e6);if(await pe.current.join(t,s,a,Ve),console.log("AgoraProvider: Joined channel successfully with UID:",pe.current.uid),J){if(!J.muted&&R)try{await pe.current.publish(J),console.log("AgoraProvider: Published existing microphone track")}catch(et){!et.message||!et.message.includes("already published")?console.error("AgoraProvider: Error publishing microphone track:",et):console.log("AgoraProvider: Microphone track already published")}}else{const et=await Ze();console.log("AgoraProvider: Microphone initialized in joinChannel:",!!et),et&&!g&&(await pe.current.publish(et),console.log("AgoraProvider: Published microphone track"))}return b(!0),Z(!1),ce(!0),mt.current=s,py=s,E(pe.current),!0}catch(Ve){return console.error("AgoraProvider: Error joining channel:",Ve),Ve.message&&(Ve.message.includes("already in connecting/connected state")||Ve.message.includes("INVALID_OPERATION"))?(console.log("AgoraProvider: Client already connected, considering join successful"),b(!0),Z(!1),ce(!0),mt.current=s,py=s,E(pe.current),!0):(z(`Failed to join channel: ${Ve.message}`),Z(!1),!1)}},Ke=async()=>{if(S)try{J&&await pe.current.unpublish(J),await pe.current.leave(),py=null,mt.current=null,console.log("Left channel successfully"),b(!1),U([])}catch(Ve){console.error("Error leaving channel:",Ve),z(Ve.message||"Failed to leave channel")}};B.useEffect(()=>()=>{J&&J.close()},[]),B.useEffect(()=>{d&&s&&(!S||mt.current!==s)&&Ze().then(()=>{Be()})},[d,s,S]);const nt=()=>{if(!J)return!1;try{return J.isActive&&!J.muted}catch(Ve){return console.error("Error checking microphone status:",Ve),!1}};B.useEffect(()=>{const Ve=()=>{const gt=nt();gt!==R&&(console.log("Syncing microphone state:",{actualStatus:gt,currentState:R}),O(gt),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:gt}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=gt,window.agoraClient.microphoneTrack=J))};J&&Ve();const et=setInterval(Ve,1e3);return()=>{clearInterval(et)}},[J,R]);const Ee=async()=>{var Ve;try{const et=R!==void 0?R:J?!J.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:R,currentState:et,hasMicTrack:!!J,trackMuted:J==null?void 0:J.muted}),!J&&(console.log("AgoraProvider: No microphone track, initializing..."),!await Ze()))return console.error("AgoraProvider: Failed to initialize microphone"),et;const gt=!et;if(console.log("AgoraProvider: New voice state will be:",gt),et){if(J)try{console.log("AgoraProvider: Muting microphone track"),await J.setMuted(!0),J.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await J.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",J.muted)}catch(Dt){return console.error("Error muting track:",Dt),et}}else if(J)try{pe.current&&S&&!((Ve=pe.current.localTracks)!=null&&Ve.includes(J))&&(console.log("AgoraProvider: Publishing microphone track"),await pe.current.publish(J),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await J.setMuted(!1),J.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await J.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",J.muted)}catch(Dt){return console.error("Error unmuting track:",Dt),et}return console.log("AgoraProvider: Setting voice enabled state to:",gt),O(gt),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=gt,window.agoraClient.microphoneTrack=J,window.agoraClient.client=pe.current,console.log("AgoraProvider: Updated window.agoraClient with new state:",gt)),typeof window<"u"&&(window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:gt}})),console.log("AgoraProvider: Dispatched VoiceToggled event with enabled:",gt)),await new Promise(Dt=>setTimeout(Dt,100)),gt}catch(et){return console.error("Error toggling voice:",et),R}},Ye=async Ve=>{try{se(Ve),console.log("Microphone track updated successfully")}catch(et){throw console.error("Error updating microphone track:",et),et}},Et=async()=>{if(!pe.current||!s)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(te)return console.log("AgoraProvider: Stopping screen share"),ae&&(Array.isArray(ae)?(await pe.current.unpublish(ae),ae.forEach(Ve=>Ve.close())):(await pe.current.unpublish(ae),ae.close()),ve(null)),ie(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const Ve=await mw.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",Ve),Ve.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),pe.current.unpublish(Ve),Ve.close(),ve(null),ie(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await pe.current.publish(Ve),ve(Ve),ie(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=Ve,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(Ve){return console.error("AgoraProvider: Error creating screen track:",Ve),ie(!1),ve(null),!1}}catch(Ve){return console.error("AgoraProvider: Error toggling screen share:",Ve),ie(!1),ve(null),!1}};B.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:pe.current,isScreenSharing:!1,screenTrack:null};const Ve=gt=>{console.log("AgoraProvider: Received ToggleScreenShare event"),Et().then(Dt=>{gt.detail&&gt.detail.callback&&gt.detail.callback(!0,Dt)}).catch(Dt=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Dt),gt.detail&&gt.detail.callback&&gt.detail.callback(!1,te)})},et=gt=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Be().then(Dt=>{gt.detail&&gt.detail.callback&&gt.detail.callback(Dt)}).catch(Dt=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Dt),gt.detail&&gt.detail.callback&&gt.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",Ve),window.addEventListener("JoinVoiceChat",et),()=>{window.removeEventListener("ToggleScreenShare",Ve),window.removeEventListener("JoinVoiceChat",et),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),B.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",R),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=R,window.agoraClient.microphoneTrack=J,window.agoraClient.client=pe.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:R}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:R}))},[R,J]);const ot={client:pe.current,isJoined:S,isVoiceEnabled:R,users:N,error:K,channel:H,appId:t,toggleVoice:Ee,leaveChannel:Ke,joinChannel:Be,microphoneTrack:J,isReady:le,createMicrophoneTrack:Ye,isScreenSharing:te,screenTrack:ae,toggleScreenShare:Et};return F.jsx(Fne.Provider,{value:ot,children:r})},Bne=()=>{const r=B.useContext(Fne);if(!r)throw new Error("useAgoraContext must be used within an AgoraProvider");return r};jne.propTypes={children:ai.node.isRequired,appId:ai.string.isRequired,channel:ai.string.isRequired,token:ai.string,uid:ai.oneOfType([ai.string,ai.number])};const r4e=()=>{var ut,mt;const{client:r,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:g,channel:E,appId:S,toggleVoice:b,joinChannel:R,leaveChannel:O,createMicrophoneTrack:N,isScreenSharing:U,screenTrack:K,toggleScreenShare:z}=Bne(),[H,ne]=B.useState(t!==void 0?t:((ut=window.agoraClient)==null?void 0:ut.isVoiceEnabled)||!1),[J,se]=B.useState(U!==void 0?U:((mt=window.agoraClient)==null?void 0:mt.isScreenSharing)||!1),[le,ce]=B.useState(!0);B.useEffect(()=>{var Ze;t!==void 0?ne(t):((Ze=window.agoraClient)==null?void 0:Ze.isVoiceEnabled)!==void 0?ne(window.agoraClient.isVoiceEnabled):d&&ne(!d.muted)},[t,d]),B.useEffect(()=>{var Ze;U!==void 0?se(U):((Ze=window.agoraClient)==null?void 0:Ze.isScreenSharing)!==void 0&&se(window.agoraClient.isScreenSharing)},[U]);const Se=B.useRef({isVoiceEnabled:H,isScreenSharing:J,isJoined:s,users:a,error:l,isReady:g,channel:E,appId:S});B.useEffect(()=>{Se.current={isVoiceEnabled:H,isScreenSharing:J,isJoined:s,users:a,error:l,isReady:g,channel:E,appId:S}},[H,J,s,a,l,g,E,S]),B.useEffect(()=>{const Ze=setTimeout(()=>{ce(!1)},5e3);return()=>clearTimeout(Ze)},[]),B.useEffect(()=>{g&&ce(!1)},[g]),B.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:H,contextIsScreenSharing:U,localScreenSharing:J,isJoined:s,users:a.length,error:l,isReady:g,channel:E,appId:S,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!K})},[t,H,U,J,s,a,l,g,E,S,d,K]);const Z=async()=>{try{console.log("useVoiceChat: Toggling voice from:",H);const Ze=await b();if(console.log("useVoiceChat: Toggle result:",Ze),Ze!==void 0)ne(Ze);else{const Be=!H;ne(Be),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Be)}return Ze!==void 0?Ze:!H}catch(Ze){return console.error("useVoiceChat: Error toggling voice:",Ze),H}},te=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",J);const Ze=await z();if(console.log("useVoiceChat: Screen share toggle result:",Ze),Ze!==void 0)se(Ze);else{const Be=!J;se(Be),window.agoraClient&&(window.agoraClient.isScreenSharing=Be)}return Ze!==void 0?Ze:!J}catch(Ze){return console.error("useVoiceChat: Error toggling screen share:",Ze),J}},ie=async()=>{H&&d&&await Z()},ae=async()=>{!H&&d&&await Z()},ve=Ze=>a.some(Be=>{var Ke;return Be.uid===Ze&&((Ke=Be.audioTrack)==null?void 0:Ke.isPlaying)}),pe=B.useCallback(()=>{if(!d||!H)return 0;try{return d.getVolumeLevel()}catch(Ze){return console.error("Error getting volume level:",Ze),0}},[d,H]);return{isVoiceEnabled:H,isScreenSharing:J,isJoined:s,users:a,error:l,toggleVoice:Z,toggleScreenShare:te,mute:ie,unmute:ae,isUserSpeaking:ve,getVolumeLevel:pe,microphoneTrack:d,screenTrack:K,isLoading:le,channel:E,appId:S,joinChannel:R,leaveChannel:O,client:r,setMicrophoneDevice:async Ze=>{try{if(!Ze){console.error("No device ID provided");return}if(!r||!s){console.error("Client not initialized or not joined to a channel");return}d&&(H&&await r.unpublish(d),await d.close());const Be=await mw.createMicrophoneAudioTrack({microphoneId:Ze,encoderConfig:"music_standard"});N&&await N(Be),H&&await r.publish(Be),console.log("Microphone device changed successfully")}catch(Be){throw console.error("Error changing microphone device:",Be),Be}}}},i4e=({size:r="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:g,isJoined:E,joinChannel:S,channel:b,client:R}=r4e(),[O,N]=B.useState(!1),[U,K]=B.useState(!1);B.useEffect(()=>{const ne=()=>{It.log("VoiceButton: Player instantiated, showing button"),K(!0)};return window.addEventListener("PlayerInstantiated",ne),window.isPlayerInstantiated&&(It.log("VoiceButton: Player was already instantiated"),K(!0)),()=>{window.removeEventListener("PlayerInstantiated",ne)}},[]),B.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:b,hasClient:!!R,clientState:R==null?void 0:R.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:U})},[d,E,b,R,U]);const z=async()=>{if(!O){N(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await S(),console.log("VoiceButton: Joined channel successfully")}catch(J){J.message&&J.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",J)}console.log("VoiceButton: Toggling voice state from:",d);const ne=await g();console.log("VoiceButton: Voice toggled, new state:",ne)}catch(ne){console.error("VoiceButton: Error toggling voice:",ne)}finally{N(!1)}}},H=()=>U?O?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return U?F.jsx(Dw,{label:H(),placement:t,hasArrow:!0,children:F.jsxs(Nn,{position:"relative",cursor:"pointer",onClick:z,children:[F.jsx(F_,{size:r,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?F.jsx(tU,{color:"white"}):F.jsx(eU,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&F.jsx(Nn,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:F.jsx(Cw,{size:"sm",color:"white"})})]})}):null},s4e=Bi.createContext({user:null}),o4e=({userNickname:r})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Bne(),[g,E]=B.useState([]),[S,b]=B.useState(!1),[R,O]=B.useState(!0);B.useRef({});const N=B.useRef(null),{user:U}=B.useContext(s4e)||{user:null},[K,z]=B.useState({}),H=B.useRef(a);B.useEffect(()=>{H.current=a},[a]),B.useEffect(()=>{if(!t||!s){b(!1);return}const le=setTimeout(()=>{O(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const ce=t.connectionState;if(console.log("Current connection state:",ce),ce==="CONNECTED")b(!0),O(!1);else{b(!1);const Se=Z=>{console.log("Connection state changed:",Z),Z==="CONNECTED"?(b(!0),O(!1)):b(!1)};return t.on("connection-state-change",Se),()=>{t.off("connection-state-change",Se),clearTimeout(le)}}return()=>{clearTimeout(le)}},[t,s]),B.useEffect(()=>{const le=async()=>{const ce={...K};let Se=!1;for(const Z of g){if(K[Z.uid])continue;let te=null,ie=Z.uid;if(typeof ie=="string"&&(ie.includes("-")?(te=ie.split("-")[0],ie=ie.split("-")[1]):ie.includes("_")&&(te=ie.split("_")[0],ie=ie.split("_")[1])),ie)try{console.log("Trying to fetch nickname for user ID:",ie);const ae=await Im(ie);ae&&ae.Nickname?(console.log("Found nickname in Firebase for user ID:",ie,"Nickname:",ae.Nickname),ce[Z.uid]=ae.Nickname,Se=!0):te?(console.log("Using extracted name for user ID:",ie,"Name:",te),ce[Z.uid]=te,Se=!0):(ce[Z.uid]="User",Se=!0)}catch(ae){console.error("Error fetching user profile:",ae),te?(ce[Z.uid]=te,Se=!0):(ce[Z.uid]="User",Se=!0)}else te?(ce[Z.uid]=te,Se=!0):(ce[Z.uid]="User",Se=!0)}Se&&z(ce)};g.length>0&&le()},[g,K]),B.useEffect(()=>{if(!t||!s||!S)return;console.log("Setting up screen share event handlers");const le=async(Z,te)=>{if(console.log("User published:",Z.uid,te,Z),te==="video"){console.log("Remote video track detected:",Z.uid);try{await t.subscribe(Z,te),console.log("Subscribed to remote video track:",Z.uid),E(ie=>ie.some(ae=>ae.uid===Z.uid)?ie:[...ie,Z])}catch(ie){console.error("Error subscribing to remote video track:",ie)}}},ce=(Z,te)=>{if(console.log("User unpublished:",Z.uid,te),te==="video"){if(console.log("Remote video track unpublished:",Z.uid),Z.videoTrack)try{Z.videoTrack.stop()}catch(ie){console.error("Error stopping video track:",ie)}if(E(ie=>ie.filter(ae=>ae.uid!==Z.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),H.current.play(N.current)}catch(ie){console.error("Error replaying local screen track:",ie)}}},Se=Z=>{console.log("User left:",Z.uid);const te=g.find(ie=>ie.uid===Z.uid);if(te&&te.videoTrack)try{te.videoTrack.stop()}catch(ie){console.error("Error stopping video track:",ie)}if(E(ie=>ie.filter(ae=>ae.uid!==Z.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),H.current.play(N.current)}catch(ie){console.error("Error replaying local screen track:",ie)}};return t.on("user-published",le),t.on("user-unpublished",ce),t.on("user-left",Se),()=>{t.off("user-published",le),t.off("user-unpublished",ce),t.off("user-left",Se)}},[t,s,S,g,l]),B.useEffect(()=>{if(console.log("Remote screens changed:",g.length,g),g.forEach(le=>{if(le.videoTrack)try{console.log("Playing video track for:",le.uid),le.videoTrack.play(`video-container-${le.uid}`)}catch(ce){console.error("Error playing video track:",ce)}}),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),H.current.play(N.current)}catch(le){console.error("Error replaying local screen track:",le)}},[g,l]),B.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(le){console.error("Error playing local screen track:",le)}},[l,a]),B.useEffect(()=>()=>{if(g.forEach(le=>{if(le.videoTrack)try{le.videoTrack.stop()}catch(ce){console.error("Error stopping video track on unmount:",ce)}}),a)try{a.stop()}catch(le){console.error("Error stopping local screen track on unmount:",le)}},[g,a]);const ne=le=>{console.log("Closing screen share for:",le);const ce=g.find(Se=>Se.uid===le);if(ce&&ce.videoTrack)try{ce.videoTrack.stop()}catch(Se){console.error("Error stopping video track:",Se)}if(E(Se=>Se.filter(Z=>Z.uid!==le)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after closing remote screen"),H.current.play(N.current)}catch(Se){console.error("Error replaying local screen track:",Se)}},J=()=>{console.log("Stopping local screen share"),d()},se=le=>(console.log("Getting display name for UID:",le,"type:",typeof le),l&&U&&(le===U.uid||le===(t==null?void 0:t.uid))?r||"You":K[le]?K[le]:typeof le=="string"?le.includes("-")?le.split("-")[0]:le.includes("_")?le.split("_")[0]:le:"User");return!S||R&&g.length===0&&!l||g.length===0&&!l?null:F.jsxs(Nn,{position:"fixed",top:"70px",right:"20px",zIndex:1e4,maxWidth:"80vw",maxHeight:"80vh",overflow:"auto",children:[l&&a&&F.jsxs(Nn,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"640px",height:"360px",children:[F.jsx(Nn,{position:"absolute",top:2,right:2,zIndex:10,children:F.jsx(Zb,{size:"sm",bg:"rgba(0,0,0,0.5)",color:"white",onClick:J})}),F.jsx(Nn,{ref:N,width:"100%",height:"100%",position:"relative",id:"local-screen-container"}),F.jsx(Nn,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:r?`${r}'s Screen`:"Your Screen"})]}),g.map(le=>{const ce=K[le.uid]||se(le.uid);return F.jsxs(Nn,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"640px",height:"360px",children:[F.jsx(Nn,{position:"absolute",top:2,right:2,zIndex:10,children:F.jsx(Zb,{size:"sm",bg:"rgba(0,0,0,0.5)",color:"white",onClick:()=>ne(le.uid)})}),F.jsx(Nn,{id:`video-container-${le.uid}`,width:"100%",height:"100%",position:"relative"}),F.jsx(Nn,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${ce}'s Screen`})]},le.uid)})]})},a4e=({onClose:r})=>{const t=Iw(),[s,a]=B.useState(!1),[l,d]=B.useState(!1);B.useEffect(()=>{const S=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};S();const b=setInterval(S,1e3),R=()=>{S()};return window.addEventListener("ScreenShareToggled",R),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",R)}},[]);const g=async S=>{if(S.preventDefault(),S.stopPropagation(),r&&r(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:R=>{if(!R){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const S=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,R)=>{a(!1),b?(d(R),t(R?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(S)}catch(S){console.error("Error toggling screen share:",S),a(!1),t({title:"Screen sharing error",description:S.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return F.jsx(ir,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:g,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function c4e({open:r,onClose:t}){return F.jsxs(jp,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[F.jsx(Wp,{}),F.jsxs(Bp,{bg:"gray.900",color:"white",borderRadius:"lg",children:[F.jsx(Nm,{children:"Controls"}),F.jsx(zp,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),F.jsx(Gp,{children:F.jsxs(Wa,{spacing:4,children:[F.jsxs(Nn,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[F.jsx(ir,{fontSize:"xl",fontWeight:"bold",children:"Getting Started"}),F.jsxs(Nn,{mt:2,children:[F.jsx(ir,{children:"WASD to move"}),F.jsx(ir,{children:"Shift to run"}),F.jsx(ir,{children:"Spacebar to jump/double jump"}),F.jsx(ir,{children:"Click to move around"})]})]}),F.jsxs(Nn,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[F.jsx(ir,{fontSize:"xl",fontWeight:"bold",children:"Camera Movements"}),F.jsx(Nn,{mt:2,children:F.jsx(ir,{children:"Click & drag to rotate camera"})})]}),F.jsxs(Nn,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[F.jsx(ir,{fontSize:"xl",fontWeight:"bold",children:"##########"}),F.jsx(Nn,{mt:2,children:F.jsx(ir,{children:"Type something here"})})]})]})})]})]})}const l4e=()=>{const[r,t]=B.useState([]),[s,a]=B.useState(""),[l,d]=B.useState(0),[g,E]=B.useState(100),[S,b]=B.useState(100),[R,O]=B.useState(!0),[N,U]=B.useState(!0),[K,z]=B.useState(!1);B.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ce=await mw.getMicrophones();t(ce),ce.length>0&&a(ce[0].deviceId)}catch(ce){console.error("Error getting audio devices:",ce)}})()},[]),B.useEffect(()=>{const le=setInterval(()=>{d(K?Math.random()*50:0)},100);return()=>clearInterval(le)},[K]);const H=le=>{const ce=le.target.value;a(ce),console.log("Microphone changed to:",ce)},ne=le=>{E(le),console.log("Microphone volume set to:",le)},J=le=>{b(le),console.log("Speaker volume set to:",le)},se=()=>{z(!K)};return F.jsxs(Wa,{spacing:6,align:"stretch",children:[F.jsxs(jo,{children:[F.jsxs(__,{children:["Microphone",F.jsx(qQ,{ml:2,colorScheme:K?"green":"red",children:K?"Enabled":"Muted"})]}),F.jsxs(AZ,{value:s,onChange:H,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[r.map(le=>F.jsx("option",{value:le.deviceId,children:le.label||`Microphone ${le.deviceId.slice(0,5)}...`},le.deviceId)),r.length===0&&F.jsx("option",{value:"",children:"No microphones found"})]})]}),F.jsxs(Nn,{children:[F.jsx(ir,{mb:2,children:"Microphone Level"}),F.jsx(RV,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),F.jsxs(jo,{children:[F.jsxs(__,{children:["Microphone Volume: ",g,"%"]}),F.jsxs(S2,{value:g,onChange:ne,min:0,max:100,step:1,colorScheme:"blue",children:[F.jsx(b2,{bg:"gray.700",children:F.jsx(w2,{})}),F.jsx(T2,{boxSize:6})]})]}),F.jsxs(jo,{children:[F.jsxs(__,{children:["Speaker Volume: ",S,"%"]}),F.jsxs(S2,{value:S,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[F.jsx(b2,{bg:"gray.700",children:F.jsx(w2,{})}),F.jsx(T2,{boxSize:6})]})]}),F.jsxs(jo,{display:"flex",alignItems:"center",children:[F.jsx(__,{mb:"0",children:"Microphone Enabled"}),F.jsx(UO,{isChecked:K,onChange:se,colorScheme:"green",size:"lg"})]}),F.jsxs(jo,{display:"flex",alignItems:"center",children:[F.jsx(__,{mb:"0",children:"Echo Cancellation"}),F.jsx(UO,{isChecked:R,onChange:()=>O(!R),colorScheme:"green",size:"lg"})]}),F.jsxs(jo,{display:"flex",alignItems:"center",children:[F.jsx(__,{mb:"0",children:"Noise Suppression"}),F.jsx(UO,{isChecked:N,onChange:()=>U(!N),colorScheme:"green",size:"lg"})]}),F.jsxs(QP,{status:"info",borderRadius:"md",children:[F.jsx(JP,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function u4e({open:r,onClose:t,containerRef:s}){return F.jsx(Ju,{containerRef:s,children:F.jsxs(jp,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[F.jsx(Wp,{}),F.jsxs(Bp,{bg:"gray.900",color:"white",borderRadius:"lg",children:[F.jsx(Nm,{children:"Settings"}),F.jsx(zp,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),F.jsx(Gp,{children:F.jsxs(xZ,{variant:"enclosed",children:[F.jsxs(MZ,{mb:4,children:[F.jsx(C2,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),F.jsx(C2,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),F.jsxs(UZ,{children:[F.jsx(R2,{children:F.jsx(Nn,{p:4,bg:"gray.800",borderRadius:"md",children:F.jsx(l4e,{})})}),F.jsx(R2,{children:F.jsx(Nn,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}const d4e=({onTogglePlayerList:r,spaceID:t})=>{const{fullscreenRef:s}=Hp(),[a,l]=B.useState(!0),[d,g]=B.useState(!1),[E,S]=B.useState(!1),[b,R]=B.useState(!1),[O,N]=B.useState(!1),[U,K]=B.useState(null),{user:z}=B.useContext(tu),H=(z==null?void 0:z.Nickname)||"Unknown",ne=async()=>{if(z!=null&&z.uid)try{const Z=await Im(z.uid);K({rpmURL:Z.rpmURL?Z.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null})}catch(Z){console.error("Error fetching profile data:",Z)}};B.useEffect(()=>{ne()},[z==null?void 0:z.uid]),B.useEffect(()=>{const Z=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",Z),()=>{window.removeEventListener("PlayerInstantiated",Z)}},[]);const J=()=>S(!E),se=()=>R(!b),le=()=>{N(!1),ne()},ce=Z=>{Z.stopPropagation(),typeof r=="function"&&(It.log("CanvasMainMenu: Toggling player list"),r())},Se=()=>{g(!1)};return F.jsxs(F.Fragment,{children:[F.jsxs(lZ,{isOpen:d,onClose:()=>g(!1),children:[F.jsx(dZ,{as:sl,icon:F.jsx(DBe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>g(!d)}),F.jsx(Ju,{containerRef:s,children:F.jsx(uZ,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:F.jsxs(Wa,{align:"stretch",spacing:4,children:[F.jsxs(Xy,{children:[F.jsx(F_,{size:"md",src:U==null?void 0:U.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),F.jsxs(Wa,{align:"start",spacing:0,children:[F.jsx(ir,{fontWeight:"bold",children:H}),F.jsx(ir,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),F.jsxs(Xy,{spacing:4,justify:"center",children:[F.jsx(sl,{icon:F.jsx(WBe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ce}),F.jsx(sl,{icon:F.jsx(Nn,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),F.jsx(sl,{icon:F.jsx(Nn,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),F.jsx(fV,{borderColor:"whiteAlpha.300"}),F.jsxs(Wa,{align:"stretch",spacing:2,children:[z&&t&&F.jsx(a4e,{onClose:Se}),F.jsx(ir,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:J,children:"Settings"}),F.jsx(ir,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:se,children:"Controls"}),F.jsx(ir,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),F.jsx(ir,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&F.jsx(c4e,{open:b,onClose:se}),E&&F.jsx(u4e,{open:E,onClose:J}),O&&F.jsx(Mne,{open:O,onClose:le})]})},h4e="130dccf9b3554bda87f8cf577f91c8c4",bF=B.forwardRef(({settings:r},t)=>{const{unityProvider:s,isLoaded:a}=yS(),l=oBe();cBe();const d=ON(),g=dBe(l),{user:E}=B.useContext(tu),[S,b]=B.useState(!1),[R,O]=B.useState(window.devicePixelRatio),[N,U]=uBe();Sne().find(de=>de.isLocalPlayer);const[z,H]=B.useState(!0),[ne,J]=B.useState(!0),[se,le]=B.useState(!1),ce=r.spaceID||"default",Se=B.useMemo(()=>{const mt=new URLSearchParams(window.location.search).get("sessionId")||ce;return console.log("WebGLRenderer: Using session ID:",mt),mt},[ce]),[Z,te]=B.useState(null);B.useEffect(()=>{E!=null&&E.uid&&Im(E.uid).then(de=>{te(de),console.log("WebGLRenderer: User profile loaded:",(de==null?void 0:de.Nickname)||"Unknown")}).catch(de=>{console.error("Error fetching user profile:",de)})},[E==null?void 0:E.uid]),B.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const de=()=>{console.log("WebGLRenderer: Player instantiated event received"),J(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),J(!0)),Eb.subscribe(vb.playerInstantiated,de);const ut=setTimeout(()=>{ne||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),J(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Eb.unsubscribe(vb.playerInstantiated,de),clearTimeout(ut)}},[ne]),B.useEffect(()=>{a||l?setTimeout(()=>{b(!0),It.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):It.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,l]),B.useEffect(()=>{const de=ut=>{It.log("WebGLRenderer: Received 'sendUserToUnity' event"),d("FirebaseUserFromReact",ut)};return Eb.subscribe(vb.sendUserToUnity,de),()=>Eb.unsubscribe(vb.sendUserToUnity,de)},[d]);const{setFullscreenRef:ie,fullscreenRef:ae}=Hp();B.useEffect(()=>{ie(t.current)},[t,ie]);const ve=()=>{H(!z)},pe=E&&r.enableVoiceChat;return console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:ne,showVoiceChat:pe,sessionId:Se}),F.jsx(Nn,{className:"webgl-renderer",children:F.jsx(oU,{containerRef:ae.current?ae:document.body,children:F.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[F.jsxs(Nn,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[r.showAuthButton&&F.jsx(UBe,{}),pe&&F.jsxs(jne,{appId:h4e,channel:Se,uid:E==null?void 0:E.uid,enabled:!0,children:[F.jsx(i4e,{size:"md",defaultMuted:!0,joinOnClick:!0}),F.jsx(o4e,{userNickname:Z==null?void 0:Z.Nickname})]}),F.jsx(zBe,{}),F.jsx(Nn,{position:"relative",zIndex:"9999",children:F.jsx(d4e,{onTogglePlayerList:ve,spaceID:ce})})]}),F.jsxs(Nn,{position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",bgImage:r.urlLoadingBackground?`url('${r.urlLoadingBackground}')`:"",children:[F.jsx(MBe,{}),F.jsx(Nn,{...g,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:F.jsx(one.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:R})}),F.jsx(qBe,{})]}),F.jsx(Nn,{...g,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:r.showDisruptiveLogo&&F.jsx(YU,{src:r.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),F.jsx(Nn,{...g,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),F.jsxs(Nn,{...g,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[r.showHelpButton&&F.jsx(VBe,{}),F.jsx($Be,{})]}),F.jsx(YBe,{}),F.jsx(XBe,{isOpen:N!==null,onClose:()=>{console.log(" Closing nameplate modal"),U()},playerName:(N==null?void 0:N.playerName)||"Unknown Player",playerId:(N==null?void 0:N.playerId)||"Unknown ID"}),F.jsx(JBe,{isVisible:z,onToggleVisibility:H})]})})})});bF.displayName="WebGLRenderer";bF.propTypes={settings:ai.shape({urlLoadingBackground:ai.string,showAuthButton:ai.bool,showDisruptiveLogo:ai.bool,urlDisruptiveLogo:ai.string,showHelpButton:ai.bool,enableVoiceChat:ai.bool,spaceID:ai.string})};const Wne=({spaceID:r,overrideSettings:t})=>{const s=B.useRef(null),[a,l]=B.useState(!0),[d,g]=B.useState({spaceID:r,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,S]=B.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:r});return B.useEffect(()=>{(async()=>{try{const R=await rBe(r);if(R){g(N=>({...N,spaceID:r,loaderUrl:R.loaderUrl,dataUrl:R.dataUrl,frameworkUrl:R.frameworkUrl,codeUrl:R.codeUrl}));const O=await Ene(E.urlDisruptiveLogo);S(N=>({...N,urlLoadingBackground:R.gsUrlLoadingBackground||"",showAuthButton:R.showAuthButton!==void 0?R.showAuthButton:!0,showDisruptiveLogo:R.showDisruptiveLogo!==void 0?R.showDisruptiveLogo:!0,showHelpButton:R.showHelpButton!==void 0?R.showHelpButton:!0,enableVoiceChat:R.enableVoiceChat!==void 0?R.enableVoiceChat:!0,urlDisruptiveLogo:O,spaceID:r,...t||{}})),l(!1)}else It.error(`WebGLLoader: No configuration found for spaceID: ${r}`)}catch(R){It.error("WebGLLoader: Error fetching space data:",R)}finally{l(!1)}})()},[r,E.urlDisruptiveLogo,t]),B.useEffect(()=>{a||(It.log("WebGLLoader: Unity config from Firebase",d),It.log("WebGLLoader: Space settings from Firebase",E))},[a]),F.jsx(F.Fragment,{children:a?F.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):F.jsx(ZFe,{...d,children:F.jsx(bF,{ref:s,settings:E})})})};Wne.propTypes={spaceID:ai.string.isRequired,overrideSettings:ai.object};const gO=document.getElementById("webgl-root");if(gO){const r=gO.getAttribute("data-space-id"),t=gO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=B.useState(null);return B.useEffect(()=>{j1e(t).then(l)},[]),a?F.jsx(XIe,{theme:a,children:F.jsx(WFe,{children:F.jsx(GFe,{children:F.jsx(Wne,{spaceID:r})})})}):F.jsx("div",{children:"Loading theme..."})};Pfe.createRoot(gO).render(F.jsx(s,{}))}else console.error("Root element 'webgl-root' not found.");export{z_e as a,B_e as b,bi as c,f4e as d,p4e as e,D_e as f,Yu as i,Zd as m,R0e as t};
