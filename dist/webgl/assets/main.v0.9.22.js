function bme(r,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in r)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(r,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var C_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function OS(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var vx={exports:{}},ob={},yx={exports:{}},lr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j9;function wme(){if(j9)return lr;j9=1;var r=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),g=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),O=Symbol.iterator;function k(Ae){return Ae===null||typeof Ae!="object"?null:(Ae=O&&Ae[O]||Ae["@@iterator"],typeof Ae=="function"?Ae:null)}var W={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H=Object.assign,K={};function G(Ae,$e,Ze){this.props=Ae,this.context=$e,this.refs=K,this.updater=Ze||W}G.prototype.isReactComponent={},G.prototype.setState=function(Ae,$e){if(typeof Ae!="object"&&typeof Ae!="function"&&Ae!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ae,$e,"setState")},G.prototype.forceUpdate=function(Ae){this.updater.enqueueForceUpdate(this,Ae,"forceUpdate")};function te(){}te.prototype=G.prototype;function J(Ae,$e,Ze){this.props=Ae,this.context=$e,this.refs=K,this.updater=Ze||W}var re=J.prototype=new te;re.constructor=J,H(re,G.prototype),re.isPureReactComponent=!0;var fe=Array.isArray,oe=Object.prototype.hasOwnProperty,be={current:null},Z={key:!0,ref:!0,__self:!0,__source:!0};function ne(Ae,$e,Ze){var Fe,ct={},_t=null,Pt=null;if($e!=null)for(Fe in $e.ref!==void 0&&(Pt=$e.ref),$e.key!==void 0&&(_t=""+$e.key),$e)oe.call($e,Fe)&&!Z.hasOwnProperty(Fe)&&(ct[Fe]=$e[Fe]);var Ht=arguments.length-2;if(Ht===1)ct.children=Ze;else if(1<Ht){for(var xt=Array(Ht),fn=0;fn<Ht;fn++)xt[fn]=arguments[fn+2];ct.children=xt}if(Ae&&Ae.defaultProps)for(Fe in Ht=Ae.defaultProps,Ht)ct[Fe]===void 0&&(ct[Fe]=Ht[Fe]);return{$$typeof:r,type:Ae,key:_t,ref:Pt,props:ct,_owner:be.current}}function se(Ae,$e){return{$$typeof:r,type:Ae.type,key:$e,ref:Ae.ref,props:Ae.props,_owner:Ae._owner}}function ue(Ae){return typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===r}function Ee(Ae){var $e={"=":"=0",":":"=2"};return"$"+Ae.replace(/[=:]/g,function(Ze){return $e[Ze]})}var he=/\/+/g;function le(Ae,$e){return typeof Ae=="object"&&Ae!==null&&Ae.key!=null?Ee(""+Ae.key):$e.toString(36)}function Me(Ae,$e,Ze,Fe,ct){var _t=typeof Ae;(_t==="undefined"||_t==="boolean")&&(Ae=null);var Pt=!1;if(Ae===null)Pt=!0;else switch(_t){case"string":case"number":Pt=!0;break;case"object":switch(Ae.$$typeof){case r:case t:Pt=!0}}if(Pt)return Pt=Ae,ct=ct(Pt),Ae=Fe===""?"."+le(Pt,0):Fe,fe(ct)?(Ze="",Ae!=null&&(Ze=Ae.replace(he,"$&/")+"/"),Me(ct,$e,Ze,"",function(fn){return fn})):ct!=null&&(ue(ct)&&(ct=se(ct,Ze+(!ct.key||Pt&&Pt.key===ct.key?"":(""+ct.key).replace(he,"$&/")+"/")+Ae)),$e.push(ct)),1;if(Pt=0,Fe=Fe===""?".":Fe+":",fe(Ae))for(var Ht=0;Ht<Ae.length;Ht++){_t=Ae[Ht];var xt=Fe+le(_t,Ht);Pt+=Me(_t,$e,Ze,xt,ct)}else if(xt=k(Ae),typeof xt=="function")for(Ae=xt.call(Ae),Ht=0;!(_t=Ae.next()).done;)_t=_t.value,xt=Fe+le(_t,Ht++),Pt+=Me(_t,$e,Ze,xt,ct);else if(_t==="object")throw $e=String(Ae),Error("Objects are not valid as a React child (found: "+($e==="[object Object]"?"object with keys {"+Object.keys(Ae).join(", ")+"}":$e)+"). If you meant to render a collection of children, use an array instead.");return Pt}function pt(Ae,$e,Ze){if(Ae==null)return Ae;var Fe=[],ct=0;return Me(Ae,Fe,"","",function(_t){return $e.call(Ze,_t,ct++)}),Fe}function et(Ae){if(Ae._status===-1){var $e=Ae._result;$e=$e(),$e.then(function(Ze){(Ae._status===0||Ae._status===-1)&&(Ae._status=1,Ae._result=Ze)},function(Ze){(Ae._status===0||Ae._status===-1)&&(Ae._status=2,Ae._result=Ze)}),Ae._status===-1&&(Ae._status=0,Ae._result=$e)}if(Ae._status===1)return Ae._result.default;throw Ae._result}var Oe={current:null},Ue={transition:null},xe={ReactCurrentDispatcher:Oe,ReactCurrentBatchConfig:Ue,ReactCurrentOwner:be};function it(){throw Error("act(...) is not supported in production builds of React.")}return lr.Children={map:pt,forEach:function(Ae,$e,Ze){pt(Ae,function(){$e.apply(this,arguments)},Ze)},count:function(Ae){var $e=0;return pt(Ae,function(){$e++}),$e},toArray:function(Ae){return pt(Ae,function($e){return $e})||[]},only:function(Ae){if(!ue(Ae))throw Error("React.Children.only expected to receive a single React element child.");return Ae}},lr.Component=G,lr.Fragment=s,lr.Profiler=l,lr.PureComponent=J,lr.StrictMode=a,lr.Suspense=S,lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xe,lr.act=it,lr.cloneElement=function(Ae,$e,Ze){if(Ae==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ae+".");var Fe=H({},Ae.props),ct=Ae.key,_t=Ae.ref,Pt=Ae._owner;if($e!=null){if($e.ref!==void 0&&(_t=$e.ref,Pt=be.current),$e.key!==void 0&&(ct=""+$e.key),Ae.type&&Ae.type.defaultProps)var Ht=Ae.type.defaultProps;for(xt in $e)oe.call($e,xt)&&!Z.hasOwnProperty(xt)&&(Fe[xt]=$e[xt]===void 0&&Ht!==void 0?Ht[xt]:$e[xt])}var xt=arguments.length-2;if(xt===1)Fe.children=Ze;else if(1<xt){Ht=Array(xt);for(var fn=0;fn<xt;fn++)Ht[fn]=arguments[fn+2];Fe.children=Ht}return{$$typeof:r,type:Ae.type,key:ct,ref:_t,props:Fe,_owner:Pt}},lr.createContext=function(Ae){return Ae={$$typeof:g,_currentValue:Ae,_currentValue2:Ae,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ae.Provider={$$typeof:d,_context:Ae},Ae.Consumer=Ae},lr.createElement=ne,lr.createFactory=function(Ae){var $e=ne.bind(null,Ae);return $e.type=Ae,$e},lr.createRef=function(){return{current:null}},lr.forwardRef=function(Ae){return{$$typeof:E,render:Ae}},lr.isValidElement=ue,lr.lazy=function(Ae){return{$$typeof:C,_payload:{_status:-1,_result:Ae},_init:et}},lr.memo=function(Ae,$e){return{$$typeof:b,type:Ae,compare:$e===void 0?null:$e}},lr.startTransition=function(Ae){var $e=Ue.transition;Ue.transition={};try{Ae()}finally{Ue.transition=$e}},lr.unstable_act=it,lr.useCallback=function(Ae,$e){return Oe.current.useCallback(Ae,$e)},lr.useContext=function(Ae){return Oe.current.useContext(Ae)},lr.useDebugValue=function(){},lr.useDeferredValue=function(Ae){return Oe.current.useDeferredValue(Ae)},lr.useEffect=function(Ae,$e){return Oe.current.useEffect(Ae,$e)},lr.useId=function(){return Oe.current.useId()},lr.useImperativeHandle=function(Ae,$e,Ze){return Oe.current.useImperativeHandle(Ae,$e,Ze)},lr.useInsertionEffect=function(Ae,$e){return Oe.current.useInsertionEffect(Ae,$e)},lr.useLayoutEffect=function(Ae,$e){return Oe.current.useLayoutEffect(Ae,$e)},lr.useMemo=function(Ae,$e){return Oe.current.useMemo(Ae,$e)},lr.useReducer=function(Ae,$e,Ze){return Oe.current.useReducer(Ae,$e,Ze)},lr.useRef=function(Ae){return Oe.current.useRef(Ae)},lr.useState=function(Ae){return Oe.current.useState(Ae)},lr.useSyncExternalStore=function(Ae,$e,Ze){return Oe.current.useSyncExternalStore(Ae,$e,Ze)},lr.useTransition=function(){return Oe.current.useTransition()},lr.version="18.3.1",lr}var B9;function iu(){return B9||(B9=1,yx.exports=wme()),yx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W9;function Rme(){if(W9)return ob;W9=1;var r=iu(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function g(E,S,b){var C,O={},k=null,W=null;b!==void 0&&(k=""+b),S.key!==void 0&&(k=""+S.key),S.ref!==void 0&&(W=S.ref);for(C in S)a.call(S,C)&&!d.hasOwnProperty(C)&&(O[C]=S[C]);if(E&&E.defaultProps)for(C in S=E.defaultProps,S)O[C]===void 0&&(O[C]=S[C]);return{$$typeof:t,type:E,key:k,ref:W,props:O,_owner:l.current}}return ob.Fragment=s,ob.jsx=g,ob.jsxs=g,ob}var G9;function Cme(){return G9||(G9=1,vx.exports=Rme()),vx.exports}var U=Cme(),j=iu();const Qr=OS(j),z9=bme({__proto__:null,default:Qr},[j]);var tO={},Sx={exports:{}},bc={},Tx={exports:{}},bx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H9;function Ime(){return H9||(H9=1,function(r){function t(Ue,xe){var it=Ue.length;Ue.push(xe);e:for(;0<it;){var Ae=it-1>>>1,$e=Ue[Ae];if(0<l($e,xe))Ue[Ae]=xe,Ue[it]=$e,it=Ae;else break e}}function s(Ue){return Ue.length===0?null:Ue[0]}function a(Ue){if(Ue.length===0)return null;var xe=Ue[0],it=Ue.pop();if(it!==xe){Ue[0]=it;e:for(var Ae=0,$e=Ue.length,Ze=$e>>>1;Ae<Ze;){var Fe=2*(Ae+1)-1,ct=Ue[Fe],_t=Fe+1,Pt=Ue[_t];if(0>l(ct,it))_t<$e&&0>l(Pt,ct)?(Ue[Ae]=Pt,Ue[_t]=it,Ae=_t):(Ue[Ae]=ct,Ue[Fe]=it,Ae=Fe);else if(_t<$e&&0>l(Pt,it))Ue[Ae]=Pt,Ue[_t]=it,Ae=_t;else break e}}return xe}function l(Ue,xe){var it=Ue.sortIndex-xe.sortIndex;return it!==0?it:Ue.id-xe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;r.unstable_now=function(){return d.now()}}else{var g=Date,E=g.now();r.unstable_now=function(){return g.now()-E}}var S=[],b=[],C=1,O=null,k=3,W=!1,H=!1,K=!1,G=typeof setTimeout=="function"?setTimeout:null,te=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(Ue){for(var xe=s(b);xe!==null;){if(xe.callback===null)a(b);else if(xe.startTime<=Ue)a(b),xe.sortIndex=xe.expirationTime,t(S,xe);else break;xe=s(b)}}function fe(Ue){if(K=!1,re(Ue),!H)if(s(S)!==null)H=!0,et(oe);else{var xe=s(b);xe!==null&&Oe(fe,xe.startTime-Ue)}}function oe(Ue,xe){H=!1,K&&(K=!1,te(ne),ne=-1),W=!0;var it=k;try{for(re(xe),O=s(S);O!==null&&(!(O.expirationTime>xe)||Ue&&!Ee());){var Ae=O.callback;if(typeof Ae=="function"){O.callback=null,k=O.priorityLevel;var $e=Ae(O.expirationTime<=xe);xe=r.unstable_now(),typeof $e=="function"?O.callback=$e:O===s(S)&&a(S),re(xe)}else a(S);O=s(S)}if(O!==null)var Ze=!0;else{var Fe=s(b);Fe!==null&&Oe(fe,Fe.startTime-xe),Ze=!1}return Ze}finally{O=null,k=it,W=!1}}var be=!1,Z=null,ne=-1,se=5,ue=-1;function Ee(){return!(r.unstable_now()-ue<se)}function he(){if(Z!==null){var Ue=r.unstable_now();ue=Ue;var xe=!0;try{xe=Z(!0,Ue)}finally{xe?le():(be=!1,Z=null)}}else be=!1}var le;if(typeof J=="function")le=function(){J(he)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,pt=Me.port2;Me.port1.onmessage=he,le=function(){pt.postMessage(null)}}else le=function(){G(he,0)};function et(Ue){Z=Ue,be||(be=!0,le())}function Oe(Ue,xe){ne=G(function(){Ue(r.unstable_now())},xe)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ue){Ue.callback=null},r.unstable_continueExecution=function(){H||W||(H=!0,et(oe))},r.unstable_forceFrameRate=function(Ue){0>Ue||125<Ue?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<Ue?Math.floor(1e3/Ue):5},r.unstable_getCurrentPriorityLevel=function(){return k},r.unstable_getFirstCallbackNode=function(){return s(S)},r.unstable_next=function(Ue){switch(k){case 1:case 2:case 3:var xe=3;break;default:xe=k}var it=k;k=xe;try{return Ue()}finally{k=it}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Ue,xe){switch(Ue){case 1:case 2:case 3:case 4:case 5:break;default:Ue=3}var it=k;k=Ue;try{return xe()}finally{k=it}},r.unstable_scheduleCallback=function(Ue,xe,it){var Ae=r.unstable_now();switch(typeof it=="object"&&it!==null?(it=it.delay,it=typeof it=="number"&&0<it?Ae+it:Ae):it=Ae,Ue){case 1:var $e=-1;break;case 2:$e=250;break;case 5:$e=1073741823;break;case 4:$e=1e4;break;default:$e=5e3}return $e=it+$e,Ue={id:C++,callback:xe,priorityLevel:Ue,startTime:it,expirationTime:$e,sortIndex:-1},it>Ae?(Ue.sortIndex=it,t(b,Ue),s(S)===null&&Ue===s(b)&&(K?(te(ne),ne=-1):K=!0,Oe(fe,it-Ae))):(Ue.sortIndex=$e,t(S,Ue),H||W||(H=!0,et(oe))),Ue},r.unstable_shouldYield=Ee,r.unstable_wrapCallback=function(Ue){var xe=k;return function(){var it=k;k=xe;try{return Ue.apply(this,arguments)}finally{k=it}}}}(bx)),bx}var K9;function Ame(){return K9||(K9=1,Tx.exports=Ime()),Tx.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $9;function Ome(){if($9)return bc;$9=1;var r=iu(),t=Ame();function s(p){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+p,T=1;T<arguments.length;T++)m+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,m){g(p,m),g(p+"Capture",m)}function g(p,m){for(l[p]=m,p=0;p<m.length;p++)a.add(m[p])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),S=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},O={};function k(p){return S.call(O,p)?!0:S.call(C,p)?!1:b.test(p)?O[p]=!0:(C[p]=!0,!1)}function W(p,m,T,A){if(T!==null&&T.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return A?!1:T!==null?!T.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function H(p,m,T,A){if(m===null||typeof m>"u"||W(p,m,T,A))return!0;if(A)return!1;if(T!==null)switch(T.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function K(p,m,T,A,L,B,ie){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=A,this.attributeNamespace=L,this.mustUseProperty=T,this.propertyName=p,this.type=m,this.sanitizeURL=B,this.removeEmptyString=ie}var G={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){G[p]=new K(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var m=p[0];G[m]=new K(m,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){G[p]=new K(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){G[p]=new K(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){G[p]=new K(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){G[p]=new K(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){G[p]=new K(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){G[p]=new K(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){G[p]=new K(p,5,!1,p.toLowerCase(),null,!1,!1)});var te=/[\-:]([a-z])/g;function J(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var m=p.replace(te,J);G[m]=new K(m,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var m=p.replace(te,J);G[m]=new K(m,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var m=p.replace(te,J);G[m]=new K(m,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){G[p]=new K(p,1,!1,p.toLowerCase(),null,!1,!1)}),G.xlinkHref=new K("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){G[p]=new K(p,1,!1,p.toLowerCase(),null,!0,!0)});function re(p,m,T,A){var L=G.hasOwnProperty(m)?G[m]:null;(L!==null?L.type!==0:A||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(H(m,T,L,A)&&(T=null),A||L===null?k(m)&&(T===null?p.removeAttribute(m):p.setAttribute(m,""+T)):L.mustUseProperty?p[L.propertyName]=T===null?L.type===3?!1:"":T:(m=L.attributeName,A=L.attributeNamespace,T===null?p.removeAttribute(m):(L=L.type,T=L===3||L===4&&T===!0?"":""+T,A?p.setAttributeNS(A,m,T):p.setAttribute(m,T))))}var fe=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oe=Symbol.for("react.element"),be=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),ne=Symbol.for("react.strict_mode"),se=Symbol.for("react.profiler"),ue=Symbol.for("react.provider"),Ee=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),pt=Symbol.for("react.memo"),et=Symbol.for("react.lazy"),Oe=Symbol.for("react.offscreen"),Ue=Symbol.iterator;function xe(p){return p===null||typeof p!="object"?null:(p=Ue&&p[Ue]||p["@@iterator"],typeof p=="function"?p:null)}var it=Object.assign,Ae;function $e(p){if(Ae===void 0)try{throw Error()}catch(T){var m=T.stack.trim().match(/\n( *(at )?)/);Ae=m&&m[1]||""}return`
`+Ae+p}var Ze=!1;function Fe(p,m){if(!p||Ze)return"";Ze=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(qe){var A=qe}Reflect.construct(p,[],m)}else{try{m.call()}catch(qe){A=qe}p.call(m.prototype)}else{try{throw Error()}catch(qe){A=qe}p()}}catch(qe){if(qe&&A&&typeof qe.stack=="string"){for(var L=qe.stack.split(`
`),B=A.stack.split(`
`),ie=L.length-1,ye=B.length-1;1<=ie&&0<=ye&&L[ie]!==B[ye];)ye--;for(;1<=ie&&0<=ye;ie--,ye--)if(L[ie]!==B[ye]){if(ie!==1||ye!==1)do if(ie--,ye--,0>ye||L[ie]!==B[ye]){var Ie=`
`+L[ie].replace(" at new "," at ");return p.displayName&&Ie.includes("<anonymous>")&&(Ie=Ie.replace("<anonymous>",p.displayName)),Ie}while(1<=ie&&0<=ye);break}}}finally{Ze=!1,Error.prepareStackTrace=T}return(p=p?p.displayName||p.name:"")?$e(p):""}function ct(p){switch(p.tag){case 5:return $e(p.type);case 16:return $e("Lazy");case 13:return $e("Suspense");case 19:return $e("SuspenseList");case 0:case 2:case 15:return p=Fe(p.type,!1),p;case 11:return p=Fe(p.type.render,!1),p;case 1:return p=Fe(p.type,!0),p;default:return""}}function _t(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Z:return"Fragment";case be:return"Portal";case se:return"Profiler";case ne:return"StrictMode";case le:return"Suspense";case Me:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case Ee:return(p.displayName||"Context")+".Consumer";case ue:return(p._context.displayName||"Context")+".Provider";case he:var m=p.render;return p=p.displayName,p||(p=m.displayName||m.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case pt:return m=p.displayName||null,m!==null?m:_t(p.type)||"Memo";case et:m=p._payload,p=p._init;try{return _t(p(m))}catch{}}return null}function Pt(p){var m=p.type;switch(p.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=m.render,p=p.displayName||p.name||"",m.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _t(m);case 8:return m===ne?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function Ht(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function xt(p){var m=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function fn(p){var m=xt(p)?"checked":"value",T=Object.getOwnPropertyDescriptor(p.constructor.prototype,m),A=""+p[m];if(!p.hasOwnProperty(m)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var L=T.get,B=T.set;return Object.defineProperty(p,m,{configurable:!0,get:function(){return L.call(this)},set:function(ie){A=""+ie,B.call(this,ie)}}),Object.defineProperty(p,m,{enumerable:T.enumerable}),{getValue:function(){return A},setValue:function(ie){A=""+ie},stopTracking:function(){p._valueTracker=null,delete p[m]}}}}function Rn(p){p._valueTracker||(p._valueTracker=fn(p))}function ln(p){if(!p)return!1;var m=p._valueTracker;if(!m)return!0;var T=m.getValue(),A="";return p&&(A=xt(p)?p.checked?"true":"false":p.value),p=A,p!==T?(m.setValue(p),!0):!1}function Hn(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Ar(p,m){var T=m.checked;return it({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??p._wrapperState.initialChecked})}function Xt(p,m){var T=m.defaultValue==null?"":m.defaultValue,A=m.checked!=null?m.checked:m.defaultChecked;T=Ht(m.value!=null?m.value:T),p._wrapperState={initialChecked:A,initialValue:T,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Qn(p,m){m=m.checked,m!=null&&re(p,"checked",m,!1)}function Wt(p,m){Qn(p,m);var T=Ht(m.value),A=m.type;if(T!=null)A==="number"?(T===0&&p.value===""||p.value!=T)&&(p.value=""+T):p.value!==""+T&&(p.value=""+T);else if(A==="submit"||A==="reset"){p.removeAttribute("value");return}m.hasOwnProperty("value")?Ne(p,m.type,T):m.hasOwnProperty("defaultValue")&&Ne(p,m.type,Ht(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(p.defaultChecked=!!m.defaultChecked)}function ve(p,m,T){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var A=m.type;if(!(A!=="submit"&&A!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+p._wrapperState.initialValue,T||m===p.value||(p.value=m),p.defaultValue=m}T=p.name,T!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,T!==""&&(p.name=T)}function Ne(p,m,T){(m!=="number"||Hn(p.ownerDocument)!==p)&&(T==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+T&&(p.defaultValue=""+T))}var We=Array.isArray;function ut(p,m,T,A){if(p=p.options,m){m={};for(var L=0;L<T.length;L++)m["$"+T[L]]=!0;for(T=0;T<p.length;T++)L=m.hasOwnProperty("$"+p[T].value),p[T].selected!==L&&(p[T].selected=L),L&&A&&(p[T].defaultSelected=!0)}else{for(T=""+Ht(T),m=null,L=0;L<p.length;L++){if(p[L].value===T){p[L].selected=!0,A&&(p[L].defaultSelected=!0);return}m!==null||p[L].disabled||(m=p[L])}m!==null&&(m.selected=!0)}}function ft(p,m){if(m.dangerouslySetInnerHTML!=null)throw Error(s(91));return it({},m,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function mt(p,m){var T=m.value;if(T==null){if(T=m.children,m=m.defaultValue,T!=null){if(m!=null)throw Error(s(92));if(We(T)){if(1<T.length)throw Error(s(93));T=T[0]}m=T}m==null&&(m=""),T=m}p._wrapperState={initialValue:Ht(T)}}function Ut(p,m){var T=Ht(m.value),A=Ht(m.defaultValue);T!=null&&(T=""+T,T!==p.value&&(p.value=T),m.defaultValue==null&&p.defaultValue!==T&&(p.defaultValue=T)),A!=null&&(p.defaultValue=""+A)}function pn(p){var m=p.textContent;m===p._wrapperState.initialValue&&m!==""&&m!==null&&(p.value=m)}function Nn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tn(p,m){return p==null||p==="http://www.w3.org/1999/xhtml"?Nn(m):p==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var ur,Ga=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,T,A,L){MSApp.execUnsafeLocalFunction(function(){return p(m,T,A,L)})}:p}(function(p,m){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=m;else{for(ur=ur||document.createElement("div"),ur.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=ur.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;m.firstChild;)p.appendChild(m.firstChild)}});function Nt(p,m){if(m){var T=p.firstChild;if(T&&T===p.lastChild&&T.nodeType===3){T.nodeValue=m;return}}p.textContent=m}var Zt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Wi=["Webkit","ms","Moz","O"];Object.keys(Zt).forEach(function(p){Wi.forEach(function(m){m=m+p.charAt(0).toUpperCase()+p.substring(1),Zt[m]=Zt[p]})});function bs(p,m,T){return m==null||typeof m=="boolean"||m===""?"":T||typeof m!="number"||m===0||Zt.hasOwnProperty(p)&&Zt[p]?(""+m).trim():m+"px"}function Ls(p,m){p=p.style;for(var T in m)if(m.hasOwnProperty(T)){var A=T.indexOf("--")===0,L=bs(T,m[T],A);T==="float"&&(T="cssFloat"),A?p.setProperty(T,L):p[T]=L}}var ci=it({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sa(p,m){if(m){if(ci[p]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(s(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(s(61))}if(m.style!=null&&typeof m.style!="object")throw Error(s(62))}}function Mc(p,m){if(p.indexOf("-")===-1)return typeof m.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xs=null;function Js(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var fl=null,ws=null,za=null;function Ko(p){if(p=vf(p)){if(typeof fl!="function")throw Error(s(280));var m=p.stateNode;m&&(m=yf(m),fl(p.stateNode,p.type,m))}}function Ha(p){ws?za?za.push(p):za=[p]:ws=p}function Uc(){if(ws){var p=ws,m=za;if(za=ws=null,Ko(p),m)for(p=0;p<m.length;p++)Ko(m[p])}}function cu(p,m){return p(m)}function Ka(){}var Vc=!1;function mo(p,m,T){if(Vc)return p(m,T);Vc=!0;try{return cu(p,m,T)}finally{Vc=!1,(ws!==null||za!==null)&&(Ka(),Uc())}}function bi(p,m){var T=p.stateNode;if(T===null)return null;var A=yf(T);if(A===null)return null;T=A[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(p=p.type,A=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!A;break e;default:p=!1}if(p)return null;if(T&&typeof T!="function")throw Error(s(231,m,typeof T));return T}var Qi=!1;if(E)try{var Ta={};Object.defineProperty(Ta,"passive",{get:function(){Qi=!0}}),window.addEventListener("test",Ta,Ta),window.removeEventListener("test",Ta,Ta)}catch{Qi=!1}function lu(p,m,T,A,L,B,ie,ye,Ie){var qe=Array.prototype.slice.call(arguments,3);try{m.apply(T,qe)}catch(yt){this.onError(yt)}}var $a=!1,$o=null,qo=!1,sd=null,Xm={onError:function(p){$a=!0,$o=p}};function uu(p,m,T,A,L,B,ie,ye,Ie){$a=!1,$o=null,lu.apply(Xm,arguments)}function Ah(p,m,T,A,L,B,ie,ye,Ie){if(uu.apply(this,arguments),$a){if($a){var qe=$o;$a=!1,$o=null}else throw Error(s(198));qo||(qo=!0,sd=qe)}}function Rs(p){var m=p,T=p;if(p.alternate)for(;m.return;)m=m.return;else{p=m;do m=p,(m.flags&4098)!==0&&(T=m.return),p=m.return;while(p)}return m.tag===3?T:null}function du(p){if(p.tag===13){var m=p.memoizedState;if(m===null&&(p=p.alternate,p!==null&&(m=p.memoizedState)),m!==null)return m.dehydrated}return null}function Yo(p){if(Rs(p)!==p)throw Error(s(188))}function od(p){var m=p.alternate;if(!m){if(m=Rs(p),m===null)throw Error(s(188));return m!==p?null:p}for(var T=p,A=m;;){var L=T.return;if(L===null)break;var B=L.alternate;if(B===null){if(A=L.return,A!==null){T=A;continue}break}if(L.child===B.child){for(B=L.child;B;){if(B===T)return Yo(L),p;if(B===A)return Yo(L),m;B=B.sibling}throw Error(s(188))}if(T.return!==A.return)T=L,A=B;else{for(var ie=!1,ye=L.child;ye;){if(ye===T){ie=!0,T=L,A=B;break}if(ye===A){ie=!0,A=L,T=B;break}ye=ye.sibling}if(!ie){for(ye=B.child;ye;){if(ye===T){ie=!0,T=B,A=L;break}if(ye===A){ie=!0,A=B,T=L;break}ye=ye.sibling}if(!ie)throw Error(s(189))}}if(T.alternate!==A)throw Error(s(190))}if(T.tag!==3)throw Error(s(188));return T.stateNode.current===T?p:m}function ad(p){return p=od(p),p!==null?ba(p):null}function ba(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var m=ba(p);if(m!==null)return m;p=p.sibling}return null}var cd=t.unstable_scheduleCallback,hu=t.unstable_cancelCallback,go=t.unstable_shouldYield,ld=t.unstable_requestPaint,xr=t.unstable_now,li=t.unstable_getCurrentPriorityLevel,qa=t.unstable_ImmediatePriority,Fc=t.unstable_UserBlockingPriority,Xo=t.unstable_NormalPriority,Oh=t.unstable_LowPriority,ud=t.unstable_IdlePriority,ml=null,Qs=null;function rf(p){if(Qs&&typeof Qs.onCommitFiberRoot=="function")try{Qs.onCommitFiberRoot(ml,p,void 0,(p.current.flags&128)===128)}catch{}}var xs=Math.clz32?Math.clz32:dd,Ph=Math.log,jc=Math.LN2;function dd(p){return p>>>=0,p===0?32:31-(Ph(p)/jc|0)|0}var hd=64,ar=4194304;function gl(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function _l(p,m){var T=p.pendingLanes;if(T===0)return 0;var A=0,L=p.suspendedLanes,B=p.pingedLanes,ie=T&268435455;if(ie!==0){var ye=ie&~L;ye!==0?A=gl(ye):(B&=ie,B!==0&&(A=gl(B)))}else ie=T&~L,ie!==0?A=gl(ie):B!==0&&(A=gl(B));if(A===0)return 0;if(m!==0&&m!==A&&(m&L)===0&&(L=A&-A,B=m&-m,L>=B||L===16&&(B&4194240)!==0))return m;if((A&4)!==0&&(A|=T&16),m=p.entangledLanes,m!==0)for(p=p.entanglements,m&=A;0<m;)T=31-xs(m),L=1<<T,A|=p[T],m&=~L;return A}function pu(p,m){switch(p){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wa(p,m){for(var T=p.suspendedLanes,A=p.pingedLanes,L=p.expirationTimes,B=p.pendingLanes;0<B;){var ie=31-xs(B),ye=1<<ie,Ie=L[ie];Ie===-1?((ye&T)===0||(ye&A)!==0)&&(L[ie]=pu(ye,m)):Ie<=m&&(p.expiredLanes|=ye),B&=~ye}}function _o(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function fu(){var p=hd;return hd<<=1,(hd&4194240)===0&&(hd=64),p}function Bc(p){for(var m=[],T=0;31>T;T++)m.push(p);return m}function El(p,m,T){p.pendingLanes|=m,m!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,m=31-xs(m),p[m]=T}function Fr(p,m){var T=p.pendingLanes&~m;p.pendingLanes=m,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=m,p.mutableReadLanes&=m,p.entangledLanes&=m,m=p.entanglements;var A=p.eventTimes;for(p=p.expirationTimes;0<T;){var L=31-xs(T),B=1<<L;m[L]=0,A[L]=-1,p[L]=-1,T&=~B}}function Ra(p,m){var T=p.entangledLanes|=m;for(p=p.entanglements;T;){var A=31-xs(T),L=1<<A;L&m|p[A]&m&&(p[A]|=m),T&=~L}}var Zn=0;function Ya(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var sf,vl,pd,Nh,of,kh=!1,Eo=[],Gi=null,vo=null,yo=null,yl=new Map,So=new Map,To=[],af="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xa(p,m){switch(p){case"focusin":case"focusout":Gi=null;break;case"dragenter":case"dragleave":vo=null;break;case"mouseover":case"mouseout":yo=null;break;case"pointerover":case"pointerout":yl.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":So.delete(m.pointerId)}}function Zi(p,m,T,A,L,B){return p===null||p.nativeEvent!==B?(p={blockedOn:m,domEventName:T,eventSystemFlags:A,nativeEvent:B,targetContainers:[L]},m!==null&&(m=vf(m),m!==null&&vl(m)),p):(p.eventSystemFlags|=A,m=p.targetContainers,L!==null&&m.indexOf(L)===-1&&m.push(L),p)}function mu(p,m,T,A,L){switch(m){case"focusin":return Gi=Zi(Gi,p,m,T,A,L),!0;case"dragenter":return vo=Zi(vo,p,m,T,A,L),!0;case"mouseover":return yo=Zi(yo,p,m,T,A,L),!0;case"pointerover":var B=L.pointerId;return yl.set(B,Zi(yl.get(B)||null,p,m,T,A,L)),!0;case"gotpointercapture":return B=L.pointerId,So.set(B,Zi(So.get(B)||null,p,m,T,A,L)),!0}return!1}function Dh(p){var m=Bh(p.target);if(m!==null){var T=Rs(m);if(T!==null){if(m=T.tag,m===13){if(m=du(T),m!==null){p.blockedOn=m,of(p.priority,function(){pd(T)});return}}else if(m===3&&T.stateNode.current.memoizedState.isDehydrated){p.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Wc(p){if(p.blockedOn!==null)return!1;for(var m=p.targetContainers;0<m.length;){var T=pr(p.domEventName,p.eventSystemFlags,m[0],p.nativeEvent);if(T===null){T=p.nativeEvent;var A=new T.constructor(T.type,T);Xs=A,T.target.dispatchEvent(A),Xs=null}else return m=vf(T),m!==null&&vl(m),p.blockedOn=T,!1;m.shift()}return!0}function Sl(p,m,T){Wc(p)&&T.delete(m)}function cf(){kh=!1,Gi!==null&&Wc(Gi)&&(Gi=null),vo!==null&&Wc(vo)&&(vo=null),yo!==null&&Wc(yo)&&(yo=null),yl.forEach(Sl),So.forEach(Sl)}function Jo(p,m){p.blockedOn===m&&(p.blockedOn=null,kh||(kh=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,cf)))}function Qo(p){function m(L){return Jo(L,p)}if(0<Eo.length){Jo(Eo[0],p);for(var T=1;T<Eo.length;T++){var A=Eo[T];A.blockedOn===p&&(A.blockedOn=null)}}for(Gi!==null&&Jo(Gi,p),vo!==null&&Jo(vo,p),yo!==null&&Jo(yo,p),yl.forEach(m),So.forEach(m),T=0;T<To.length;T++)A=To[T],A.blockedOn===p&&(A.blockedOn=null);for(;0<To.length&&(T=To[0],T.blockedOn===null);)Dh(T),T.blockedOn===null&&To.shift()}var Gc=fe.ReactCurrentBatchConfig,_e=!0;function Re(p,m,T,A){var L=Zn,B=Gc.transition;Gc.transition=null;try{Zn=1,jt(p,m,T,A)}finally{Zn=L,Gc.transition=B}}function Ke(p,m,T,A){var L=Zn,B=Gc.transition;Gc.transition=null;try{Zn=4,jt(p,m,T,A)}finally{Zn=L,Gc.transition=B}}function jt(p,m,T,A){if(_e){var L=pr(p,m,T,A);if(L===null)pE(p,m,A,Bn,T),Xa(p,A);else if(mu(L,p,m,T,A))A.stopPropagation();else if(Xa(p,A),m&4&&-1<af.indexOf(p)){for(;L!==null;){var B=vf(L);if(B!==null&&sf(B),B=pr(p,m,T,A),B===null&&pE(p,m,A,Bn,T),B===L)break;L=B}L!==null&&A.stopPropagation()}else pE(p,m,A,null,T)}}var Bn=null;function pr(p,m,T,A){if(Bn=null,p=Js(A),p=Bh(p),p!==null)if(m=Rs(p),m===null)p=null;else if(T=m.tag,T===13){if(p=du(m),p!==null)return p;p=null}else if(T===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;p=null}else m!==p&&(p=null);return Bn=p,null}function Mr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(li()){case qa:return 1;case Fc:return 4;case Xo:case Oh:return 16;case ud:return 536870912;default:return 16}default:return 16}}var en=null,Or=null,ui=null;function fs(){if(ui)return ui;var p,m=Or,T=m.length,A,L="value"in en?en.value:en.textContent,B=L.length;for(p=0;p<T&&m[p]===L[p];p++);var ie=T-p;for(A=1;A<=ie&&m[T-A]===L[B-A];A++);return ui=L.slice(p,1<A?1-A:void 0)}function bo(p){var m=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&m===13&&(p=13)):p=m,p===10&&(p=13),32<=p||p===13?p:0}function wo(){return!0}function gu(){return!1}function xi(p){function m(T,A,L,B,ie){this._reactName=T,this._targetInst=L,this.type=A,this.nativeEvent=B,this.target=ie,this.currentTarget=null;for(var ye in p)p.hasOwnProperty(ye)&&(T=p[ye],this[ye]=T?T(B):B[ye]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?wo:gu,this.isPropagationStopped=gu,this}return it(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=wo)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=wo)},persist:function(){},isPersistent:wo}),m}var zc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fd=xi(zc),Ja=it({},zc,{view:0,detail:0}),Jm=xi(Ja),lf,_u,Ro,Tl=it({},Ja,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qa,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Ro&&(Ro&&p.type==="mousemove"?(lf=p.screenX-Ro.screenX,_u=p.screenY-Ro.screenY):_u=lf=0,Ro=p),lf)},movementY:function(p){return"movementY"in p?p.movementY:_u}}),uf=xi(Tl),Qm=it({},Tl,{dataTransfer:0}),sE=xi(Qm),df=it({},Ja,{relatedTarget:0}),hf=xi(df),Eu=it({},zc,{animationName:0,elapsedTime:0,pseudoElement:0}),vu=xi(Eu),yu=it({},zc,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Zm=xi(yu),oE=it({},zc,{data:0}),kn=xi(oE),pf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Co={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},aE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cE(p){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(p):(p=aE[p])?!!m[p]:!1}function Qa(){return cE}var R=it({},Ja,{key:function(p){if(p.key){var m=pf[p.key]||p.key;if(m!=="Unidentified")return m}return p.type==="keypress"?(p=bo(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Co[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qa,charCode:function(p){return p.type==="keypress"?bo(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?bo(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),V=xi(R),X=it({},Tl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),de=xi(X),je=it({},Ja,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qa}),Je=xi(je),It=it({},zc,{propertyName:0,elapsedTime:0,pseudoElement:0}),jr=xi(It),ei=it({},Tl,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),fr=xi(ei),Cs=[9,13,27,32],es=E&&"CompositionEvent"in window,Ca=null;E&&"documentMode"in document&&(Ca=document.documentMode);var Io=E&&"TextEvent"in window&&!Ca,Lh=E&&(!es||Ca&&8<Ca&&11>=Ca),ff=" ",Ia=!1;function gR(p,m){switch(p){case"keyup":return Cs.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _R(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var mf=!1;function qN(p,m){switch(p){case"compositionend":return _R(m);case"keypress":return m.which!==32?null:(Ia=!0,ff);case"textInput":return p=m.data,p===ff&&Ia?null:p;default:return null}}function ER(p,m){if(mf)return p==="compositionend"||!es&&gR(p,m)?(p=fs(),ui=Or=en=null,mf=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Lh&&m.locale!=="ko"?null:m.data;default:return null}}var YN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vR(p){var m=p&&p.nodeName&&p.nodeName.toLowerCase();return m==="input"?!!YN[p.type]:m==="textarea"}function zS(p,m,T,A){Ha(A),m=fE(m,"onChange"),0<m.length&&(T=new fd("onChange","change",null,T,A),p.push({event:T,listeners:m}))}var xh=null,eg=null;function XN(p){JS(p,0)}function Mh(p){var m=Wh(p);if(ln(m))return p}function JN(p,m){if(p==="change")return m}var yR=!1;if(E){var HS;if(E){var Za="oninput"in document;if(!Za){var SR=document.createElement("div");SR.setAttribute("oninput","return;"),Za=typeof SR.oninput=="function"}HS=Za}else HS=!1;yR=HS&&(!document.documentMode||9<document.documentMode)}function TR(){xh&&(xh.detachEvent("onpropertychange",Zo),eg=xh=null)}function Zo(p){if(p.propertyName==="value"&&Mh(eg)){var m=[];zS(m,eg,p,Js(p)),mo(XN,m)}}function QN(p,m,T){p==="focusin"?(TR(),xh=m,eg=T,xh.attachEvent("onpropertychange",Zo)):p==="focusout"&&TR()}function ZN(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Mh(eg)}function ek(p,m){if(p==="click")return Mh(m)}function tk(p,m){if(p==="input"||p==="change")return Mh(m)}function bR(p,m){return p===m&&(p!==0||1/p===1/m)||p!==p&&m!==m}var Hc=typeof Object.is=="function"?Object.is:bR;function tg(p,m){if(Hc(p,m))return!0;if(typeof p!="object"||p===null||typeof m!="object"||m===null)return!1;var T=Object.keys(p),A=Object.keys(m);if(T.length!==A.length)return!1;for(A=0;A<T.length;A++){var L=T[A];if(!S.call(m,L)||!Hc(p[L],m[L]))return!1}return!0}function wR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function KS(p,m){var T=wR(p);p=0;for(var A;T;){if(T.nodeType===3){if(A=p+T.textContent.length,p<=m&&A>=m)return{node:T,offset:m-p};p=A}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=wR(T)}}function RR(p,m){return p&&m?p===m?!0:p&&p.nodeType===3?!1:m&&m.nodeType===3?RR(p,m.parentNode):"contains"in p?p.contains(m):p.compareDocumentPosition?!!(p.compareDocumentPosition(m)&16):!1:!1}function CR(){for(var p=window,m=Hn();m instanceof p.HTMLIFrameElement;){try{var T=typeof m.contentWindow.location.href=="string"}catch{T=!1}if(T)p=m.contentWindow;else break;m=Hn(p.document)}return m}function ng(p){var m=p&&p.nodeName&&p.nodeName.toLowerCase();return m&&(m==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||m==="textarea"||p.contentEditable==="true")}function $S(p){var m=CR(),T=p.focusedElem,A=p.selectionRange;if(m!==T&&T&&T.ownerDocument&&RR(T.ownerDocument.documentElement,T)){if(A!==null&&ng(T)){if(m=A.start,p=A.end,p===void 0&&(p=m),"selectionStart"in T)T.selectionStart=m,T.selectionEnd=Math.min(p,T.value.length);else if(p=(m=T.ownerDocument||document)&&m.defaultView||window,p.getSelection){p=p.getSelection();var L=T.textContent.length,B=Math.min(A.start,L);A=A.end===void 0?B:Math.min(A.end,L),!p.extend&&B>A&&(L=A,A=B,B=L),L=KS(T,B);var ie=KS(T,A);L&&ie&&(p.rangeCount!==1||p.anchorNode!==L.node||p.anchorOffset!==L.offset||p.focusNode!==ie.node||p.focusOffset!==ie.offset)&&(m=m.createRange(),m.setStart(L.node,L.offset),p.removeAllRanges(),B>A?(p.addRange(m),p.extend(ie.node,ie.offset)):(m.setEnd(ie.node,ie.offset),p.addRange(m)))}}for(m=[],p=T;p=p.parentNode;)p.nodeType===1&&m.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<m.length;T++)p=m[T],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var nk=E&&"documentMode"in document&&11>=document.documentMode,Xe=null,qS=null,rg=null,YS=!1;function IR(p,m,T){var A=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;YS||Xe==null||Xe!==Hn(A)||(A=Xe,"selectionStart"in A&&ng(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),rg&&tg(rg,A)||(rg=A,A=fE(qS,"onSelect"),0<A.length&&(m=new fd("onSelect","select",null,m,T),p.push({event:m,listeners:A}),m.target=Xe)))}function lE(p,m){var T={};return T[p.toLowerCase()]=m.toLowerCase(),T["Webkit"+p]="webkit"+m,T["Moz"+p]="moz"+m,T}var gf={animationend:lE("Animation","AnimationEnd"),animationiteration:lE("Animation","AnimationIteration"),animationstart:lE("Animation","AnimationStart"),transitionend:lE("Transition","TransitionEnd")},XS={},AR={};E&&(AR=document.createElement("div").style,"AnimationEvent"in window||(delete gf.animationend.animation,delete gf.animationiteration.animation,delete gf.animationstart.animation),"TransitionEvent"in window||delete gf.transitionend.transition);function Uh(p){if(XS[p])return XS[p];if(!gf[p])return p;var m=gf[p],T;for(T in m)if(m.hasOwnProperty(T)&&T in AR)return XS[p]=m[T];return p}var Vh=Uh("animationend"),OR=Uh("animationiteration"),PR=Uh("animationstart"),NR=Uh("transitionend"),kR=new Map,uE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function md(p,m){kR.set(p,m),d(m,[p])}for(var dE=0;dE<uE.length;dE++){var Aa=uE[dE],rk=Aa.toLowerCase(),ig=Aa[0].toUpperCase()+Aa.slice(1);md(rk,"on"+ig)}md(Vh,"onAnimationEnd"),md(OR,"onAnimationIteration"),md(PR,"onAnimationStart"),md("dblclick","onDoubleClick"),md("focusin","onFocus"),md("focusout","onBlur"),md(NR,"onTransitionEnd"),g("onMouseEnter",["mouseout","mouseover"]),g("onMouseLeave",["mouseout","mouseover"]),g("onPointerEnter",["pointerout","pointerover"]),g("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ik=new Set("cancel close invalid load scroll toggle".split(" ").concat(sg));function DR(p,m,T){var A=p.type||"unknown-event";p.currentTarget=T,Ah(A,m,void 0,p),p.currentTarget=null}function JS(p,m){m=(m&4)!==0;for(var T=0;T<p.length;T++){var A=p[T],L=A.event;A=A.listeners;e:{var B=void 0;if(m)for(var ie=A.length-1;0<=ie;ie--){var ye=A[ie],Ie=ye.instance,qe=ye.currentTarget;if(ye=ye.listener,Ie!==B&&L.isPropagationStopped())break e;DR(L,ye,qe),B=Ie}else for(ie=0;ie<A.length;ie++){if(ye=A[ie],Ie=ye.instance,qe=ye.currentTarget,ye=ye.listener,Ie!==B&&L.isPropagationStopped())break e;DR(L,ye,qe),B=Ie}}}if(qo)throw p=sd,qo=!1,sd=null,p}function gi(p,m){var T=m[lg];T===void 0&&(T=m[lg]=new Set);var A=p+"__bubble";T.has(A)||(LR(m,p,2,!1),T.add(A))}function QS(p,m,T){var A=0;m&&(A|=4),LR(T,p,A,m)}var hE="_reactListening"+Math.random().toString(36).slice(2);function Fh(p){if(!p[hE]){p[hE]=!0,a.forEach(function(T){T!=="selectionchange"&&(ik.has(T)||QS(T,!1,p),QS(T,!0,p))});var m=p.nodeType===9?p:p.ownerDocument;m===null||m[hE]||(m[hE]=!0,QS("selectionchange",!1,m))}}function LR(p,m,T,A){switch(Mr(m)){case 1:var L=Re;break;case 4:L=Ke;break;default:L=jt}T=L.bind(null,m,T,p),L=void 0,!Qi||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(L=!0),A?L!==void 0?p.addEventListener(m,T,{capture:!0,passive:L}):p.addEventListener(m,T,!0):L!==void 0?p.addEventListener(m,T,{passive:L}):p.addEventListener(m,T,!1)}function pE(p,m,T,A,L){var B=A;if((m&1)===0&&(m&2)===0&&A!==null)e:for(;;){if(A===null)return;var ie=A.tag;if(ie===3||ie===4){var ye=A.stateNode.containerInfo;if(ye===L||ye.nodeType===8&&ye.parentNode===L)break;if(ie===4)for(ie=A.return;ie!==null;){var Ie=ie.tag;if((Ie===3||Ie===4)&&(Ie=ie.stateNode.containerInfo,Ie===L||Ie.nodeType===8&&Ie.parentNode===L))return;ie=ie.return}for(;ye!==null;){if(ie=Bh(ye),ie===null)return;if(Ie=ie.tag,Ie===5||Ie===6){A=B=ie;continue e}ye=ye.parentNode}}A=A.return}mo(function(){var qe=B,yt=Js(T),Tt=[];e:{var vt=kR.get(p);if(vt!==void 0){var Vt=fd,Kt=p;switch(p){case"keypress":if(bo(T)===0)break e;case"keydown":case"keyup":Vt=V;break;case"focusin":Kt="focus",Vt=hf;break;case"focusout":Kt="blur",Vt=hf;break;case"beforeblur":case"afterblur":Vt=hf;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Vt=uf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Vt=sE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Vt=Je;break;case Vh:case OR:case PR:Vt=vu;break;case NR:Vt=jr;break;case"scroll":Vt=Jm;break;case"wheel":Vt=fr;break;case"copy":case"cut":case"paste":Vt=Zm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Vt=de}var $t=(m&4)!==0,Ui=!$t&&p==="scroll",Ge=$t?vt!==null?vt+"Capture":null:vt;$t=[];for(var Pe=qe,He;Pe!==null;){He=Pe;var wt=He.stateNode;if(He.tag===5&&wt!==null&&(He=wt,Ge!==null&&(wt=bi(Pe,Ge),wt!=null&&$t.push(_f(Pe,wt,He)))),Ui)break;Pe=Pe.return}0<$t.length&&(vt=new Vt(vt,Kt,null,T,yt),Tt.push({event:vt,listeners:$t}))}}if((m&7)===0){e:{if(vt=p==="mouseover"||p==="pointerover",Vt=p==="mouseout"||p==="pointerout",vt&&T!==Xs&&(Kt=T.relatedTarget||T.fromElement)&&(Bh(Kt)||Kt[ec]))break e;if((Vt||vt)&&(vt=yt.window===yt?yt:(vt=yt.ownerDocument)?vt.defaultView||vt.parentWindow:window,Vt?(Kt=T.relatedTarget||T.toElement,Vt=qe,Kt=Kt?Bh(Kt):null,Kt!==null&&(Ui=Rs(Kt),Kt!==Ui||Kt.tag!==5&&Kt.tag!==6)&&(Kt=null)):(Vt=null,Kt=qe),Vt!==Kt)){if($t=uf,wt="onMouseLeave",Ge="onMouseEnter",Pe="mouse",(p==="pointerout"||p==="pointerover")&&($t=de,wt="onPointerLeave",Ge="onPointerEnter",Pe="pointer"),Ui=Vt==null?vt:Wh(Vt),He=Kt==null?vt:Wh(Kt),vt=new $t(wt,Pe+"leave",Vt,T,yt),vt.target=Ui,vt.relatedTarget=He,wt=null,Bh(yt)===qe&&($t=new $t(Ge,Pe+"enter",Kt,T,yt),$t.target=He,$t.relatedTarget=Ui,wt=$t),Ui=wt,Vt&&Kt)t:{for($t=Vt,Ge=Kt,Pe=0,He=$t;He;He=jh(He))Pe++;for(He=0,wt=Ge;wt;wt=jh(wt))He++;for(;0<Pe-He;)$t=jh($t),Pe--;for(;0<He-Pe;)Ge=jh(Ge),He--;for(;Pe--;){if($t===Ge||Ge!==null&&$t===Ge.alternate)break t;$t=jh($t),Ge=jh(Ge)}$t=null}else $t=null;Vt!==null&&og(Tt,vt,Vt,$t,!1),Kt!==null&&Ui!==null&&og(Tt,Ui,Kt,$t,!0)}}e:{if(vt=qe?Wh(qe):window,Vt=vt.nodeName&&vt.nodeName.toLowerCase(),Vt==="select"||Vt==="input"&&vt.type==="file")var qt=JN;else if(vR(vt))if(yR)qt=tk;else{qt=ZN;var sn=QN}else(Vt=vt.nodeName)&&Vt.toLowerCase()==="input"&&(vt.type==="checkbox"||vt.type==="radio")&&(qt=ek);if(qt&&(qt=qt(p,qe))){zS(Tt,qt,T,yt);break e}sn&&sn(p,vt,qe),p==="focusout"&&(sn=vt._wrapperState)&&sn.controlled&&vt.type==="number"&&Ne(vt,"number",vt.value)}switch(sn=qe?Wh(qe):window,p){case"focusin":(vR(sn)||sn.contentEditable==="true")&&(Xe=sn,qS=qe,rg=null);break;case"focusout":rg=qS=Xe=null;break;case"mousedown":YS=!0;break;case"contextmenu":case"mouseup":case"dragend":YS=!1,IR(Tt,T,yt);break;case"selectionchange":if(nk)break;case"keydown":case"keyup":IR(Tt,T,yt)}var un;if(es)e:{switch(p){case"compositionstart":var Cn="onCompositionStart";break e;case"compositionend":Cn="onCompositionEnd";break e;case"compositionupdate":Cn="onCompositionUpdate";break e}Cn=void 0}else mf?gR(p,T)&&(Cn="onCompositionEnd"):p==="keydown"&&T.keyCode===229&&(Cn="onCompositionStart");Cn&&(Lh&&T.locale!=="ko"&&(mf||Cn!=="onCompositionStart"?Cn==="onCompositionEnd"&&mf&&(un=fs()):(en=yt,Or="value"in en?en.value:en.textContent,mf=!0)),sn=fE(qe,Cn),0<sn.length&&(Cn=new kn(Cn,p,null,T,yt),Tt.push({event:Cn,listeners:sn}),un?Cn.data=un:(un=_R(T),un!==null&&(Cn.data=un)))),(un=Io?qN(p,T):ER(p,T))&&(qe=fE(qe,"onBeforeInput"),0<qe.length&&(yt=new kn("onBeforeInput","beforeinput",null,T,yt),Tt.push({event:yt,listeners:qe}),yt.data=un))}JS(Tt,m)})}function _f(p,m,T){return{instance:p,listener:m,currentTarget:T}}function fE(p,m){for(var T=m+"Capture",A=[];p!==null;){var L=p,B=L.stateNode;L.tag===5&&B!==null&&(L=B,B=bi(p,T),B!=null&&A.unshift(_f(p,B,L)),B=bi(p,m),B!=null&&A.push(_f(p,B,L))),p=p.return}return A}function jh(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function og(p,m,T,A,L){for(var B=m._reactName,ie=[];T!==null&&T!==A;){var ye=T,Ie=ye.alternate,qe=ye.stateNode;if(Ie!==null&&Ie===A)break;ye.tag===5&&qe!==null&&(ye=qe,L?(Ie=bi(T,B),Ie!=null&&ie.unshift(_f(T,Ie,ye))):L||(Ie=bi(T,B),Ie!=null&&ie.push(_f(T,Ie,ye)))),T=T.return}ie.length!==0&&p.push({event:m,listeners:ie})}var sk=/\r\n?/g,ok=/\u0000|\uFFFD/g;function xR(p){return(typeof p=="string"?p:""+p).replace(sk,`
`).replace(ok,"")}function mE(p,m,T){if(m=xR(m),xR(p)!==m&&T)throw Error(s(425))}function gE(){}var _E=null,ag=null;function ZS(p,m){return p==="textarea"||p==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var cg=typeof setTimeout=="function"?setTimeout:void 0,ak=typeof clearTimeout=="function"?clearTimeout:void 0,MR=typeof Promise=="function"?Promise:void 0,ck=typeof queueMicrotask=="function"?queueMicrotask:typeof MR<"u"?function(p){return MR.resolve(null).then(p).catch(lk)}:cg;function lk(p){setTimeout(function(){throw p})}function eT(p,m){var T=m,A=0;do{var L=T.nextSibling;if(p.removeChild(T),L&&L.nodeType===8)if(T=L.data,T==="/$"){if(A===0){p.removeChild(L),Qo(m);return}A--}else T!=="$"&&T!=="$?"&&T!=="$!"||A++;T=L}while(T);Qo(m)}function gd(p){for(;p!=null;p=p.nextSibling){var m=p.nodeType;if(m===1||m===3)break;if(m===8){if(m=p.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return p}function UR(p){p=p.previousSibling;for(var m=0;p;){if(p.nodeType===8){var T=p.data;if(T==="$"||T==="$!"||T==="$?"){if(m===0)return p;m--}else T==="/$"&&m++}p=p.previousSibling}return null}var Ef=Math.random().toString(36).slice(2),bl="__reactFiber$"+Ef,_d="__reactProps$"+Ef,ec="__reactContainer$"+Ef,lg="__reactEvents$"+Ef,uk="__reactListeners$"+Ef,dk="__reactHandles$"+Ef;function Bh(p){var m=p[bl];if(m)return m;for(var T=p.parentNode;T;){if(m=T[ec]||T[bl]){if(T=m.alternate,m.child!==null||T!==null&&T.child!==null)for(p=UR(p);p!==null;){if(T=p[bl])return T;p=UR(p)}return m}p=T,T=p.parentNode}return null}function vf(p){return p=p[bl]||p[ec],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Wh(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function yf(p){return p[_d]||null}var tT=[],Sf=-1;function tc(p){return{current:p}}function _i(p){0>Sf||(p.current=tT[Sf],tT[Sf]=null,Sf--)}function di(p,m){Sf++,tT[Sf]=p.current,p.current=m}var Ed={},Zs=tc(Ed),ea=tc(!1),Gh=Ed;function zh(p,m){var T=p.type.contextTypes;if(!T)return Ed;var A=p.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===m)return A.__reactInternalMemoizedMaskedChildContext;var L={},B;for(B in T)L[B]=m[B];return A&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=m,p.__reactInternalMemoizedMaskedChildContext=L),L}function ta(p){return p=p.childContextTypes,p!=null}function EE(){_i(ea),_i(Zs)}function VR(p,m,T){if(Zs.current!==Ed)throw Error(s(168));di(Zs,m),di(ea,T)}function vE(p,m,T){var A=p.stateNode;if(m=m.childContextTypes,typeof A.getChildContext!="function")return T;A=A.getChildContext();for(var L in A)if(!(L in m))throw Error(s(108,Pt(p)||"Unknown",L));return it({},T,A)}function yE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Ed,Gh=Zs.current,di(Zs,p),di(ea,ea.current),!0}function FR(p,m,T){var A=p.stateNode;if(!A)throw Error(s(169));T?(p=vE(p,m,Gh),A.__reactInternalMemoizedMergedChildContext=p,_i(ea),_i(Zs),di(Zs,p)):_i(ea),di(ea,T)}var nc=null,SE=!1,nT=!1;function jR(p){nc===null?nc=[p]:nc.push(p)}function hk(p){SE=!0,jR(p)}function vd(){if(!nT&&nc!==null){nT=!0;var p=0,m=Zn;try{var T=nc;for(Zn=1;p<T.length;p++){var A=T[p];do A=A(!0);while(A!==null)}nc=null,SE=!1}catch(L){throw nc!==null&&(nc=nc.slice(p+1)),cd(qa,vd),L}finally{Zn=m,nT=!1}}return null}var Tf=[],Su=0,ug=null,TE=0,rc=[],Oa=0,Hh=null,Tu=1,bu="";function wu(p,m){Tf[Su++]=TE,Tf[Su++]=ug,ug=p,TE=m}function bE(p,m,T){rc[Oa++]=Tu,rc[Oa++]=bu,rc[Oa++]=Hh,Hh=p;var A=Tu;p=bu;var L=32-xs(A)-1;A&=~(1<<L),T+=1;var B=32-xs(m)+L;if(30<B){var ie=L-L%5;B=(A&(1<<ie)-1).toString(32),A>>=ie,L-=ie,Tu=1<<32-xs(m)+L|T<<L|A,bu=B+p}else Tu=1<<B|T<<L|A,bu=p}function wE(p){p.return!==null&&(wu(p,1),bE(p,1,0))}function dg(p){for(;p===ug;)ug=Tf[--Su],Tf[Su]=null,TE=Tf[--Su],Tf[Su]=null;for(;p===Hh;)Hh=rc[--Oa],rc[Oa]=null,bu=rc[--Oa],rc[Oa]=null,Tu=rc[--Oa],rc[Oa]=null}var na=null,ra=null,ti=!1,Ao=null;function BR(p,m){var T=ka(5,null,null,0);T.elementType="DELETED",T.stateNode=m,T.return=p,m=p.deletions,m===null?(p.deletions=[T],p.flags|=16):m.push(T)}function WR(p,m){switch(p.tag){case 5:var T=p.type;return m=m.nodeType!==1||T.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(p.stateNode=m,na=p,ra=gd(m.firstChild),!0):!1;case 6:return m=p.pendingProps===""||m.nodeType!==3?null:m,m!==null?(p.stateNode=m,na=p,ra=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(T=Hh!==null?{id:Tu,overflow:bu}:null,p.memoizedState={dehydrated:m,treeContext:T,retryLane:1073741824},T=ka(18,null,null,0),T.stateNode=m,T.return=p,p.child=T,na=p,ra=null,!0):!1;default:return!1}}function RE(p){return(p.mode&1)!==0&&(p.flags&128)===0}function rT(p){if(ti){var m=ra;if(m){var T=m;if(!WR(p,m)){if(RE(p))throw Error(s(418));m=gd(T.nextSibling);var A=na;m&&WR(p,m)?BR(A,T):(p.flags=p.flags&-4097|2,ti=!1,na=p)}}else{if(RE(p))throw Error(s(418));p.flags=p.flags&-4097|2,ti=!1,na=p}}}function GR(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;na=p}function hg(p){if(p!==na)return!1;if(!ti)return GR(p),ti=!0,!1;var m;if((m=p.tag!==3)&&!(m=p.tag!==5)&&(m=p.type,m=m!=="head"&&m!=="body"&&!ZS(p.type,p.memoizedProps)),m&&(m=ra)){if(RE(p))throw zR(),Error(s(418));for(;m;)BR(p,m),m=gd(m.nextSibling)}if(GR(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,m=0;p;){if(p.nodeType===8){var T=p.data;if(T==="/$"){if(m===0){ra=gd(p.nextSibling);break e}m--}else T!=="$"&&T!=="$!"&&T!=="$?"||m++}p=p.nextSibling}ra=null}}else ra=na?gd(p.stateNode.nextSibling):null;return!0}function zR(){for(var p=ra;p;)p=gd(p.nextSibling)}function bf(){ra=na=null,ti=!1}function iT(p){Ao===null?Ao=[p]:Ao.push(p)}var pk=fe.ReactCurrentBatchConfig;function pg(p,m,T){if(p=T.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(s(309));var A=T.stateNode}if(!A)throw Error(s(147,p));var L=A,B=""+p;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===B?m.ref:(m=function(ie){var ye=L.refs;ie===null?delete ye[B]:ye[B]=ie},m._stringRef=B,m)}if(typeof p!="string")throw Error(s(284));if(!T._owner)throw Error(s(290,p))}return p}function CE(p,m){throw p=Object.prototype.toString.call(m),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":p))}function sT(p){var m=p._init;return m(p._payload)}function yd(p){function m(Ge,Pe){if(p){var He=Ge.deletions;He===null?(Ge.deletions=[Pe],Ge.flags|=16):He.push(Pe)}}function T(Ge,Pe){if(!p)return null;for(;Pe!==null;)m(Ge,Pe),Pe=Pe.sibling;return null}function A(Ge,Pe){for(Ge=new Map;Pe!==null;)Pe.key!==null?Ge.set(Pe.key,Pe):Ge.set(Pe.index,Pe),Pe=Pe.sibling;return Ge}function L(Ge,Pe){return Ge=ku(Ge,Pe),Ge.index=0,Ge.sibling=null,Ge}function B(Ge,Pe,He){return Ge.index=He,p?(He=Ge.alternate,He!==null?(He=He.index,He<Pe?(Ge.flags|=2,Pe):He):(Ge.flags|=2,Pe)):(Ge.flags|=1048576,Pe)}function ie(Ge){return p&&Ge.alternate===null&&(Ge.flags|=2),Ge}function ye(Ge,Pe,He,wt){return Pe===null||Pe.tag!==6?(Pe=WT(He,Ge.mode,wt),Pe.return=Ge,Pe):(Pe=L(Pe,He),Pe.return=Ge,Pe)}function Ie(Ge,Pe,He,wt){var qt=He.type;return qt===Z?yt(Ge,Pe,He.props.children,wt,He.key):Pe!==null&&(Pe.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===et&&sT(qt)===Pe.type)?(wt=L(Pe,He.props),wt.ref=pg(Ge,Pe,He),wt.return=Ge,wt):(wt=hv(He.type,He.key,He.props,null,Ge.mode,wt),wt.ref=pg(Ge,Pe,He),wt.return=Ge,wt)}function qe(Ge,Pe,He,wt){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==He.containerInfo||Pe.stateNode.implementation!==He.implementation?(Pe=GT(He,Ge.mode,wt),Pe.return=Ge,Pe):(Pe=L(Pe,He.children||[]),Pe.return=Ge,Pe)}function yt(Ge,Pe,He,wt,qt){return Pe===null||Pe.tag!==7?(Pe=rp(He,Ge.mode,wt,qt),Pe.return=Ge,Pe):(Pe=L(Pe,He),Pe.return=Ge,Pe)}function Tt(Ge,Pe,He){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=WT(""+Pe,Ge.mode,He),Pe.return=Ge,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case oe:return He=hv(Pe.type,Pe.key,Pe.props,null,Ge.mode,He),He.ref=pg(Ge,null,Pe),He.return=Ge,He;case be:return Pe=GT(Pe,Ge.mode,He),Pe.return=Ge,Pe;case et:var wt=Pe._init;return Tt(Ge,wt(Pe._payload),He)}if(We(Pe)||xe(Pe))return Pe=rp(Pe,Ge.mode,He,null),Pe.return=Ge,Pe;CE(Ge,Pe)}return null}function vt(Ge,Pe,He,wt){var qt=Pe!==null?Pe.key:null;if(typeof He=="string"&&He!==""||typeof He=="number")return qt!==null?null:ye(Ge,Pe,""+He,wt);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case oe:return He.key===qt?Ie(Ge,Pe,He,wt):null;case be:return He.key===qt?qe(Ge,Pe,He,wt):null;case et:return qt=He._init,vt(Ge,Pe,qt(He._payload),wt)}if(We(He)||xe(He))return qt!==null?null:yt(Ge,Pe,He,wt,null);CE(Ge,He)}return null}function Vt(Ge,Pe,He,wt,qt){if(typeof wt=="string"&&wt!==""||typeof wt=="number")return Ge=Ge.get(He)||null,ye(Pe,Ge,""+wt,qt);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case oe:return Ge=Ge.get(wt.key===null?He:wt.key)||null,Ie(Pe,Ge,wt,qt);case be:return Ge=Ge.get(wt.key===null?He:wt.key)||null,qe(Pe,Ge,wt,qt);case et:var sn=wt._init;return Vt(Ge,Pe,He,sn(wt._payload),qt)}if(We(wt)||xe(wt))return Ge=Ge.get(He)||null,yt(Pe,Ge,wt,qt,null);CE(Pe,wt)}return null}function Kt(Ge,Pe,He,wt){for(var qt=null,sn=null,un=Pe,Cn=Pe=0,ss=null;un!==null&&Cn<He.length;Cn++){un.index>Cn?(ss=un,un=null):ss=un.sibling;var mr=vt(Ge,un,He[Cn],wt);if(mr===null){un===null&&(un=ss);break}p&&un&&mr.alternate===null&&m(Ge,un),Pe=B(mr,Pe,Cn),sn===null?qt=mr:sn.sibling=mr,sn=mr,un=ss}if(Cn===He.length)return T(Ge,un),ti&&wu(Ge,Cn),qt;if(un===null){for(;Cn<He.length;Cn++)un=Tt(Ge,He[Cn],wt),un!==null&&(Pe=B(un,Pe,Cn),sn===null?qt=un:sn.sibling=un,sn=un);return ti&&wu(Ge,Cn),qt}for(un=A(Ge,un);Cn<He.length;Cn++)ss=Vt(un,Ge,Cn,He[Cn],wt),ss!==null&&(p&&ss.alternate!==null&&un.delete(ss.key===null?Cn:ss.key),Pe=B(ss,Pe,Cn),sn===null?qt=ss:sn.sibling=ss,sn=ss);return p&&un.forEach(function(Nd){return m(Ge,Nd)}),ti&&wu(Ge,Cn),qt}function $t(Ge,Pe,He,wt){var qt=xe(He);if(typeof qt!="function")throw Error(s(150));if(He=qt.call(He),He==null)throw Error(s(151));for(var sn=qt=null,un=Pe,Cn=Pe=0,ss=null,mr=He.next();un!==null&&!mr.done;Cn++,mr=He.next()){un.index>Cn?(ss=un,un=null):ss=un.sibling;var Nd=vt(Ge,un,mr.value,wt);if(Nd===null){un===null&&(un=ss);break}p&&un&&Nd.alternate===null&&m(Ge,un),Pe=B(Nd,Pe,Cn),sn===null?qt=Nd:sn.sibling=Nd,sn=Nd,un=ss}if(mr.done)return T(Ge,un),ti&&wu(Ge,Cn),qt;if(un===null){for(;!mr.done;Cn++,mr=He.next())mr=Tt(Ge,mr.value,wt),mr!==null&&(Pe=B(mr,Pe,Cn),sn===null?qt=mr:sn.sibling=mr,sn=mr);return ti&&wu(Ge,Cn),qt}for(un=A(Ge,un);!mr.done;Cn++,mr=He.next())mr=Vt(un,Ge,Cn,mr.value,wt),mr!==null&&(p&&mr.alternate!==null&&un.delete(mr.key===null?Cn:mr.key),Pe=B(mr,Pe,Cn),sn===null?qt=mr:sn.sibling=mr,sn=mr);return p&&un.forEach(function(Ok){return m(Ge,Ok)}),ti&&wu(Ge,Cn),qt}function Ui(Ge,Pe,He,wt){if(typeof He=="object"&&He!==null&&He.type===Z&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case oe:e:{for(var qt=He.key,sn=Pe;sn!==null;){if(sn.key===qt){if(qt=He.type,qt===Z){if(sn.tag===7){T(Ge,sn.sibling),Pe=L(sn,He.props.children),Pe.return=Ge,Ge=Pe;break e}}else if(sn.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===et&&sT(qt)===sn.type){T(Ge,sn.sibling),Pe=L(sn,He.props),Pe.ref=pg(Ge,sn,He),Pe.return=Ge,Ge=Pe;break e}T(Ge,sn);break}else m(Ge,sn);sn=sn.sibling}He.type===Z?(Pe=rp(He.props.children,Ge.mode,wt,He.key),Pe.return=Ge,Ge=Pe):(wt=hv(He.type,He.key,He.props,null,Ge.mode,wt),wt.ref=pg(Ge,Pe,He),wt.return=Ge,Ge=wt)}return ie(Ge);case be:e:{for(sn=He.key;Pe!==null;){if(Pe.key===sn)if(Pe.tag===4&&Pe.stateNode.containerInfo===He.containerInfo&&Pe.stateNode.implementation===He.implementation){T(Ge,Pe.sibling),Pe=L(Pe,He.children||[]),Pe.return=Ge,Ge=Pe;break e}else{T(Ge,Pe);break}else m(Ge,Pe);Pe=Pe.sibling}Pe=GT(He,Ge.mode,wt),Pe.return=Ge,Ge=Pe}return ie(Ge);case et:return sn=He._init,Ui(Ge,Pe,sn(He._payload),wt)}if(We(He))return Kt(Ge,Pe,He,wt);if(xe(He))return $t(Ge,Pe,He,wt);CE(Ge,He)}return typeof He=="string"&&He!==""||typeof He=="number"?(He=""+He,Pe!==null&&Pe.tag===6?(T(Ge,Pe.sibling),Pe=L(Pe,He),Pe.return=Ge,Ge=Pe):(T(Ge,Pe),Pe=WT(He,Ge.mode,wt),Pe.return=Ge,Ge=Pe),ie(Ge)):T(Ge,Pe)}return Ui}var wf=yd(!0),HR=yd(!1),IE=tc(null),fg=null,Rf=null,AE=null;function oT(){AE=Rf=fg=null}function aT(p){var m=IE.current;_i(IE),p._currentValue=m}function cT(p,m,T){for(;p!==null;){var A=p.alternate;if((p.childLanes&m)!==m?(p.childLanes|=m,A!==null&&(A.childLanes|=m)):A!==null&&(A.childLanes&m)!==m&&(A.childLanes|=m),p===T)break;p=p.return}}function Ru(p,m){fg=p,AE=Rf=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&m)!==0&&(sa=!0),p.firstContext=null)}function ic(p){var m=p._currentValue;if(AE!==p)if(p={context:p,memoizedValue:m,next:null},Rf===null){if(fg===null)throw Error(s(308));Rf=p,fg.dependencies={lanes:0,firstContext:p}}else Rf=Rf.next=p;return m}var Kh=null;function lT(p){Kh===null?Kh=[p]:Kh.push(p)}function KR(p,m,T,A){var L=m.interleaved;return L===null?(T.next=T,lT(m)):(T.next=L.next,L.next=T),m.interleaved=T,Cu(p,A)}function Cu(p,m){p.lanes|=m;var T=p.alternate;for(T!==null&&(T.lanes|=m),T=p,p=p.return;p!==null;)p.childLanes|=m,T=p.alternate,T!==null&&(T.childLanes|=m),T=p,p=p.return;return T.tag===3?T.stateNode:null}var Sd=!1;function mg(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function $R(p,m){p=p.updateQueue,m.updateQueue===p&&(m.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function wl(p,m){return{eventTime:p,lane:m,tag:0,payload:null,callback:null,next:null}}function Td(p,m,T){var A=p.updateQueue;if(A===null)return null;if(A=A.shared,(vr&2)!==0){var L=A.pending;return L===null?m.next=m:(m.next=L.next,L.next=m),A.pending=m,Cu(p,T)}return L=A.interleaved,L===null?(m.next=m,lT(A)):(m.next=L.next,L.next=m),A.interleaved=m,Cu(p,T)}function gg(p,m,T){if(m=m.updateQueue,m!==null&&(m=m.shared,(T&4194240)!==0)){var A=m.lanes;A&=p.pendingLanes,T|=A,m.lanes=T,Ra(p,T)}}function qR(p,m){var T=p.updateQueue,A=p.alternate;if(A!==null&&(A=A.updateQueue,T===A)){var L=null,B=null;if(T=T.firstBaseUpdate,T!==null){do{var ie={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};B===null?L=B=ie:B=B.next=ie,T=T.next}while(T!==null);B===null?L=B=m:B=B.next=m}else L=B=m;T={baseState:A.baseState,firstBaseUpdate:L,lastBaseUpdate:B,shared:A.shared,effects:A.effects},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=m:p.next=m,T.lastBaseUpdate=m}function OE(p,m,T,A){var L=p.updateQueue;Sd=!1;var B=L.firstBaseUpdate,ie=L.lastBaseUpdate,ye=L.shared.pending;if(ye!==null){L.shared.pending=null;var Ie=ye,qe=Ie.next;Ie.next=null,ie===null?B=qe:ie.next=qe,ie=Ie;var yt=p.alternate;yt!==null&&(yt=yt.updateQueue,ye=yt.lastBaseUpdate,ye!==ie&&(ye===null?yt.firstBaseUpdate=qe:ye.next=qe,yt.lastBaseUpdate=Ie))}if(B!==null){var Tt=L.baseState;ie=0,yt=qe=Ie=null,ye=B;do{var vt=ye.lane,Vt=ye.eventTime;if((A&vt)===vt){yt!==null&&(yt=yt.next={eventTime:Vt,lane:0,tag:ye.tag,payload:ye.payload,callback:ye.callback,next:null});e:{var Kt=p,$t=ye;switch(vt=m,Vt=T,$t.tag){case 1:if(Kt=$t.payload,typeof Kt=="function"){Tt=Kt.call(Vt,Tt,vt);break e}Tt=Kt;break e;case 3:Kt.flags=Kt.flags&-65537|128;case 0:if(Kt=$t.payload,vt=typeof Kt=="function"?Kt.call(Vt,Tt,vt):Kt,vt==null)break e;Tt=it({},Tt,vt);break e;case 2:Sd=!0}}ye.callback!==null&&ye.lane!==0&&(p.flags|=64,vt=L.effects,vt===null?L.effects=[ye]:vt.push(ye))}else Vt={eventTime:Vt,lane:vt,tag:ye.tag,payload:ye.payload,callback:ye.callback,next:null},yt===null?(qe=yt=Vt,Ie=Tt):yt=yt.next=Vt,ie|=vt;if(ye=ye.next,ye===null){if(ye=L.shared.pending,ye===null)break;vt=ye,ye=vt.next,vt.next=null,L.lastBaseUpdate=vt,L.shared.pending=null}}while(!0);if(yt===null&&(Ie=Tt),L.baseState=Ie,L.firstBaseUpdate=qe,L.lastBaseUpdate=yt,m=L.shared.interleaved,m!==null){L=m;do ie|=L.lane,L=L.next;while(L!==m)}else B===null&&(L.shared.lanes=0);Qh|=ie,p.lanes=ie,p.memoizedState=Tt}}function YR(p,m,T){if(p=m.effects,m.effects=null,p!==null)for(m=0;m<p.length;m++){var A=p[m],L=A.callback;if(L!==null){if(A.callback=null,A=T,typeof L!="function")throw Error(s(191,L));L.call(A)}}}var _g={},Rl=tc(_g),Eg=tc(_g),Cf=tc(_g);function $h(p){if(p===_g)throw Error(s(174));return p}function uT(p,m){switch(di(Cf,m),di(Eg,p),di(Rl,_g),p=m.nodeType,p){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:tn(null,"");break;default:p=p===8?m.parentNode:m,m=p.namespaceURI||null,p=p.tagName,m=tn(m,p)}_i(Rl),di(Rl,m)}function qh(){_i(Rl),_i(Eg),_i(Cf)}function XR(p){$h(Cf.current);var m=$h(Rl.current),T=tn(m,p.type);m!==T&&(di(Eg,p),di(Rl,T))}function If(p){Eg.current===p&&(_i(Rl),_i(Eg))}var yi=tc(0);function bd(p){for(var m=p;m!==null;){if(m.tag===13){var T=m.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===p)break;for(;m.sibling===null;){if(m.return===null||m.return===p)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var dT=[];function hT(){for(var p=0;p<dT.length;p++)dT[p]._workInProgressVersionPrimary=null;dT.length=0}var PE=fe.ReactCurrentDispatcher,pT=fe.ReactCurrentBatchConfig,Cl=0,wi=null,ts=null,ns=null,Af=!1,vg=!1,yg=0,fk=0;function eo(){throw Error(s(321))}function fT(p,m){if(m===null)return!1;for(var T=0;T<m.length&&T<p.length;T++)if(!Hc(p[T],m[T]))return!1;return!0}function Of(p,m,T,A,L,B){if(Cl=B,wi=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,PE.current=p===null||p.memoizedState===null?_k:aC,p=T(A,L),vg){B=0;do{if(vg=!1,yg=0,25<=B)throw Error(s(301));B+=1,ns=ts=null,m.updateQueue=null,PE.current=Ek,p=T(A,L)}while(vg)}if(PE.current=LE,m=ts!==null&&ts.next!==null,Cl=0,ns=ts=wi=null,Af=!1,m)throw Error(s(300));return p}function mT(){var p=yg!==0;return yg=0,p}function Oo(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ns===null?wi.memoizedState=ns=p:ns=ns.next=p,ns}function ia(){if(ts===null){var p=wi.alternate;p=p!==null?p.memoizedState:null}else p=ts.next;var m=ns===null?wi.memoizedState:ns.next;if(m!==null)ns=m,ts=p;else{if(p===null)throw Error(s(310));ts=p,p={memoizedState:ts.memoizedState,baseState:ts.baseState,baseQueue:ts.baseQueue,queue:ts.queue,next:null},ns===null?wi.memoizedState=ns=p:ns=ns.next=p}return ns}function wd(p,m){return typeof m=="function"?m(p):m}function Yh(p){var m=ia(),T=m.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var A=ts,L=A.baseQueue,B=T.pending;if(B!==null){if(L!==null){var ie=L.next;L.next=B.next,B.next=ie}A.baseQueue=L=B,T.pending=null}if(L!==null){B=L.next,A=A.baseState;var ye=ie=null,Ie=null,qe=B;do{var yt=qe.lane;if((Cl&yt)===yt)Ie!==null&&(Ie=Ie.next={lane:0,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null}),A=qe.hasEagerState?qe.eagerState:p(A,qe.action);else{var Tt={lane:yt,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null};Ie===null?(ye=Ie=Tt,ie=A):Ie=Ie.next=Tt,wi.lanes|=yt,Qh|=yt}qe=qe.next}while(qe!==null&&qe!==B);Ie===null?ie=A:Ie.next=ye,Hc(A,m.memoizedState)||(sa=!0),m.memoizedState=A,m.baseState=ie,m.baseQueue=Ie,T.lastRenderedState=A}if(p=T.interleaved,p!==null){L=p;do B=L.lane,wi.lanes|=B,Qh|=B,L=L.next;while(L!==p)}else L===null&&(T.lanes=0);return[m.memoizedState,T.dispatch]}function Pf(p){var m=ia(),T=m.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=p;var A=T.dispatch,L=T.pending,B=m.memoizedState;if(L!==null){T.pending=null;var ie=L=L.next;do B=p(B,ie.action),ie=ie.next;while(ie!==L);Hc(B,m.memoizedState)||(sa=!0),m.memoizedState=B,m.baseQueue===null&&(m.baseState=B),T.lastRenderedState=B}return[B,A]}function JR(){}function gT(p,m){var T=wi,A=ia(),L=m(),B=!Hc(A.memoizedState,L);if(B&&(A.memoizedState=L,sa=!0),A=A.queue,sc(ZR.bind(null,T,A,p),[p]),A.getSnapshot!==m||B||ns!==null&&ns.memoizedState.tag&1){if(T.flags|=2048,Sg(9,_T.bind(null,T,A,L,m),void 0,null),Is===null)throw Error(s(349));(Cl&30)!==0||QR(T,m,L)}return L}function QR(p,m,T){p.flags|=16384,p={getSnapshot:m,value:T},m=wi.updateQueue,m===null?(m={lastEffect:null,stores:null},wi.updateQueue=m,m.stores=[p]):(T=m.stores,T===null?m.stores=[p]:T.push(p))}function _T(p,m,T,A){m.value=T,m.getSnapshot=A,eC(m)&&NE(p)}function ZR(p,m,T){return T(function(){eC(m)&&NE(p)})}function eC(p){var m=p.getSnapshot;p=p.value;try{var T=m();return!Hc(p,T)}catch{return!0}}function NE(p){var m=Cu(p,1);m!==null&&lc(m,p,1,-1)}function kE(p){var m=Oo();return typeof p=="function"&&(p=p()),m.memoizedState=m.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wd,lastRenderedState:p},m.queue=p,p=p.dispatch=gk.bind(null,wi,p),[m.memoizedState,p]}function Sg(p,m,T,A){return p={tag:p,create:m,destroy:T,deps:A,next:null},m=wi.updateQueue,m===null?(m={lastEffect:null,stores:null},wi.updateQueue=m,m.lastEffect=p.next=p):(T=m.lastEffect,T===null?m.lastEffect=p.next=p:(A=T.next,T.next=p,p.next=A,m.lastEffect=p)),p}function tC(){return ia().memoizedState}function Tg(p,m,T,A){var L=Oo();wi.flags|=p,L.memoizedState=Sg(1|m,T,void 0,A===void 0?null:A)}function Nf(p,m,T,A){var L=ia();A=A===void 0?null:A;var B=void 0;if(ts!==null){var ie=ts.memoizedState;if(B=ie.destroy,A!==null&&fT(A,ie.deps)){L.memoizedState=Sg(m,T,B,A);return}}wi.flags|=p,L.memoizedState=Sg(1|m,T,B,A)}function nC(p,m){return Tg(8390656,8,p,m)}function sc(p,m){return Nf(2048,8,p,m)}function Xh(p,m){return Nf(4,2,p,m)}function Rd(p,m){return Nf(4,4,p,m)}function ET(p,m){if(typeof m=="function")return p=p(),m(p),function(){m(null)};if(m!=null)return p=p(),m.current=p,function(){m.current=null}}function vT(p,m,T){return T=T!=null?T.concat([p]):null,Nf(4,4,ET.bind(null,m,p),T)}function Iu(){}function DE(p,m){var T=ia();m=m===void 0?null:m;var A=T.memoizedState;return A!==null&&m!==null&&fT(m,A[1])?A[0]:(T.memoizedState=[p,m],p)}function rC(p,m){var T=ia();m=m===void 0?null:m;var A=T.memoizedState;return A!==null&&m!==null&&fT(m,A[1])?A[0]:(p=p(),T.memoizedState=[p,m],p)}function yT(p,m,T){return(Cl&21)===0?(p.baseState&&(p.baseState=!1,sa=!0),p.memoizedState=T):(Hc(T,m)||(T=fu(),wi.lanes|=T,Qh|=T,p.baseState=!0),m)}function mk(p,m){var T=Zn;Zn=T!==0&&4>T?T:4,p(!0);var A=pT.transition;pT.transition={};try{p(!1),m()}finally{Zn=T,pT.transition=A}}function ST(){return ia().memoizedState}function iC(p,m,T){var A=cc(p);if(T={lane:A,action:T,hasEagerState:!1,eagerState:null,next:null},Au(p))sC(m,T);else if(T=KR(p,m,T,A),T!==null){var L=Vs();lc(T,p,A,L),oC(T,m,A)}}function gk(p,m,T){var A=cc(p),L={lane:A,action:T,hasEagerState:!1,eagerState:null,next:null};if(Au(p))sC(m,L);else{var B=p.alternate;if(p.lanes===0&&(B===null||B.lanes===0)&&(B=m.lastRenderedReducer,B!==null))try{var ie=m.lastRenderedState,ye=B(ie,T);if(L.hasEagerState=!0,L.eagerState=ye,Hc(ye,ie)){var Ie=m.interleaved;Ie===null?(L.next=L,lT(m)):(L.next=Ie.next,Ie.next=L),m.interleaved=L;return}}catch{}finally{}T=KR(p,m,L,A),T!==null&&(L=Vs(),lc(T,p,A,L),oC(T,m,A))}}function Au(p){var m=p.alternate;return p===wi||m!==null&&m===wi}function sC(p,m){vg=Af=!0;var T=p.pending;T===null?m.next=m:(m.next=T.next,T.next=m),p.pending=m}function oC(p,m,T){if((T&4194240)!==0){var A=m.lanes;A&=p.pendingLanes,T|=A,m.lanes=T,Ra(p,T)}}var LE={readContext:ic,useCallback:eo,useContext:eo,useEffect:eo,useImperativeHandle:eo,useInsertionEffect:eo,useLayoutEffect:eo,useMemo:eo,useReducer:eo,useRef:eo,useState:eo,useDebugValue:eo,useDeferredValue:eo,useTransition:eo,useMutableSource:eo,useSyncExternalStore:eo,useId:eo,unstable_isNewReconciler:!1},_k={readContext:ic,useCallback:function(p,m){return Oo().memoizedState=[p,m===void 0?null:m],p},useContext:ic,useEffect:nC,useImperativeHandle:function(p,m,T){return T=T!=null?T.concat([p]):null,Tg(4194308,4,ET.bind(null,m,p),T)},useLayoutEffect:function(p,m){return Tg(4194308,4,p,m)},useInsertionEffect:function(p,m){return Tg(4,2,p,m)},useMemo:function(p,m){var T=Oo();return m=m===void 0?null:m,p=p(),T.memoizedState=[p,m],p},useReducer:function(p,m,T){var A=Oo();return m=T!==void 0?T(m):m,A.memoizedState=A.baseState=m,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:m},A.queue=p,p=p.dispatch=iC.bind(null,wi,p),[A.memoizedState,p]},useRef:function(p){var m=Oo();return p={current:p},m.memoizedState=p},useState:kE,useDebugValue:Iu,useDeferredValue:function(p){return Oo().memoizedState=p},useTransition:function(){var p=kE(!1),m=p[0];return p=mk.bind(null,p[1]),Oo().memoizedState=p,[m,p]},useMutableSource:function(){},useSyncExternalStore:function(p,m,T){var A=wi,L=Oo();if(ti){if(T===void 0)throw Error(s(407));T=T()}else{if(T=m(),Is===null)throw Error(s(349));(Cl&30)!==0||QR(A,m,T)}L.memoizedState=T;var B={value:T,getSnapshot:m};return L.queue=B,nC(ZR.bind(null,A,B,p),[p]),A.flags|=2048,Sg(9,_T.bind(null,A,B,T,m),void 0,null),T},useId:function(){var p=Oo(),m=Is.identifierPrefix;if(ti){var T=bu,A=Tu;T=(A&~(1<<32-xs(A)-1)).toString(32)+T,m=":"+m+"R"+T,T=yg++,0<T&&(m+="H"+T.toString(32)),m+=":"}else T=fk++,m=":"+m+"r"+T.toString(32)+":";return p.memoizedState=m},unstable_isNewReconciler:!1},aC={readContext:ic,useCallback:DE,useContext:ic,useEffect:sc,useImperativeHandle:vT,useInsertionEffect:Xh,useLayoutEffect:Rd,useMemo:rC,useReducer:Yh,useRef:tC,useState:function(){return Yh(wd)},useDebugValue:Iu,useDeferredValue:function(p){var m=ia();return yT(m,ts.memoizedState,p)},useTransition:function(){var p=Yh(wd)[0],m=ia().memoizedState;return[p,m]},useMutableSource:JR,useSyncExternalStore:gT,useId:ST,unstable_isNewReconciler:!1},Ek={readContext:ic,useCallback:DE,useContext:ic,useEffect:sc,useImperativeHandle:vT,useInsertionEffect:Xh,useLayoutEffect:Rd,useMemo:rC,useReducer:Pf,useRef:tC,useState:function(){return Pf(wd)},useDebugValue:Iu,useDeferredValue:function(p){var m=ia();return ts===null?m.memoizedState=p:yT(m,ts.memoizedState,p)},useTransition:function(){var p=Pf(wd)[0],m=ia().memoizedState;return[p,m]},useMutableSource:JR,useSyncExternalStore:gT,useId:ST,unstable_isNewReconciler:!1};function Pa(p,m){if(p&&p.defaultProps){m=it({},m),p=p.defaultProps;for(var T in p)m[T]===void 0&&(m[T]=p[T]);return m}return m}function xE(p,m,T,A){m=p.memoizedState,T=T(A,m),T=T==null?m:it({},m,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}var ME={isMounted:function(p){return(p=p._reactInternals)?Rs(p)===p:!1},enqueueSetState:function(p,m,T){p=p._reactInternals;var A=Vs(),L=cc(p),B=wl(A,L);B.payload=m,T!=null&&(B.callback=T),m=Td(p,B,L),m!==null&&(lc(m,p,L,A),gg(m,p,L))},enqueueReplaceState:function(p,m,T){p=p._reactInternals;var A=Vs(),L=cc(p),B=wl(A,L);B.tag=1,B.payload=m,T!=null&&(B.callback=T),m=Td(p,B,L),m!==null&&(lc(m,p,L,A),gg(m,p,L))},enqueueForceUpdate:function(p,m){p=p._reactInternals;var T=Vs(),A=cc(p),L=wl(T,A);L.tag=2,m!=null&&(L.callback=m),m=Td(p,L,A),m!==null&&(lc(m,p,A,T),gg(m,p,A))}};function TT(p,m,T,A,L,B,ie){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(A,B,ie):m.prototype&&m.prototype.isPureReactComponent?!tg(T,A)||!tg(L,B):!0}function cC(p,m,T){var A=!1,L=Ed,B=m.contextType;return typeof B=="object"&&B!==null?B=ic(B):(L=ta(m)?Gh:Zs.current,A=m.contextTypes,B=(A=A!=null)?zh(p,L):Ed),m=new m(T,B),p.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=ME,p.stateNode=m,m._reactInternals=p,A&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=L,p.__reactInternalMemoizedMaskedChildContext=B),m}function lC(p,m,T,A){p=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(T,A),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(T,A),m.state!==p&&ME.enqueueReplaceState(m,m.state,null)}function bT(p,m,T,A){var L=p.stateNode;L.props=T,L.state=p.memoizedState,L.refs={},mg(p);var B=m.contextType;typeof B=="object"&&B!==null?L.context=ic(B):(B=ta(m)?Gh:Zs.current,L.context=zh(p,B)),L.state=p.memoizedState,B=m.getDerivedStateFromProps,typeof B=="function"&&(xE(p,m,B,T),L.state=p.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(m=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),m!==L.state&&ME.enqueueReplaceState(L,L.state,null),OE(p,T,L,A),L.state=p.memoizedState),typeof L.componentDidMount=="function"&&(p.flags|=4194308)}function kf(p,m){try{var T="",A=m;do T+=ct(A),A=A.return;while(A);var L=T}catch(B){L=`
Error generating stack: `+B.message+`
`+B.stack}return{value:p,source:m,stack:L,digest:null}}function wT(p,m,T){return{value:p,source:null,stack:T??null,digest:m??null}}function RT(p,m){try{console.error(m.value)}catch(T){setTimeout(function(){throw T})}}var vk=typeof WeakMap=="function"?WeakMap:Map;function CT(p,m,T){T=wl(-1,T),T.tag=3,T.payload={element:null};var A=m.value;return T.callback=function(){ev||(ev=!0,UT=A),RT(p,m)},T}function Ou(p,m,T){T=wl(-1,T),T.tag=3;var A=p.type.getDerivedStateFromError;if(typeof A=="function"){var L=m.value;T.payload=function(){return A(L)},T.callback=function(){RT(p,m)}}var B=p.stateNode;return B!==null&&typeof B.componentDidCatch=="function"&&(T.callback=function(){RT(p,m),typeof A!="function"&&(Cd===null?Cd=new Set([this]):Cd.add(this));var ie=m.stack;this.componentDidCatch(m.value,{componentStack:ie!==null?ie:""})}),T}function uC(p,m,T){var A=p.pingCache;if(A===null){A=p.pingCache=new vk;var L=new Set;A.set(m,L)}else L=A.get(m),L===void 0&&(L=new Set,A.set(m,L));L.has(T)||(L.add(T),p=LC.bind(null,p,m,T),m.then(p,p))}function dC(p){do{var m;if((m=p.tag===13)&&(m=p.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return p;p=p.return}while(p!==null);return null}function hC(p,m,T,A,L){return(p.mode&1)===0?(p===m?p.flags|=65536:(p.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(m=wl(-1,1),m.tag=2,Td(T,m,1))),T.lanes|=1),p):(p.flags|=65536,p.lanes=L,p)}var yk=fe.ReactCurrentOwner,sa=!1;function Po(p,m,T,A){m.child=p===null?HR(m,null,T,A):wf(m,p.child,T,A)}function UE(p,m,T,A,L){T=T.render;var B=m.ref;return Ru(m,L),A=Of(p,m,T,A,B,L),T=mT(),p!==null&&!sa?(m.updateQueue=p.updateQueue,m.flags&=-2053,p.lanes&=~L,Il(p,m,L)):(ti&&T&&wE(m),m.flags|=1,Po(p,m,A,L),m.child)}function pC(p,m,T,A,L){if(p===null){var B=T.type;return typeof B=="function"&&!Ad(B)&&B.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(m.tag=15,m.type=B,fC(p,m,B,A,L)):(p=hv(T.type,null,A,m,m.mode,L),p.ref=m.ref,p.return=m,m.child=p)}if(B=p.child,(p.lanes&L)===0){var ie=B.memoizedProps;if(T=T.compare,T=T!==null?T:tg,T(ie,A)&&p.ref===m.ref)return Il(p,m,L)}return m.flags|=1,p=ku(B,A),p.ref=m.ref,p.return=m,m.child=p}function fC(p,m,T,A,L){if(p!==null){var B=p.memoizedProps;if(tg(B,A)&&p.ref===m.ref)if(sa=!1,m.pendingProps=A=B,(p.lanes&L)!==0)(p.flags&131072)!==0&&(sa=!0);else return m.lanes=p.lanes,Il(p,m,L)}return IT(p,m,T,A,L)}function mC(p,m,T){var A=m.pendingProps,L=A.children,B=p!==null?p.memoizedState:null;if(A.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},di(Kc,Na),Na|=T;else{if((T&1073741824)===0)return p=B!==null?B.baseLanes|T:T,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:p,cachePool:null,transitions:null},m.updateQueue=null,di(Kc,Na),Na|=p,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=B!==null?B.baseLanes:T,di(Kc,Na),Na|=A}else B!==null?(A=B.baseLanes|T,m.memoizedState=null):A=T,di(Kc,Na),Na|=A;return Po(p,m,L,T),m.child}function gC(p,m){var T=m.ref;(p===null&&T!==null||p!==null&&p.ref!==T)&&(m.flags|=512,m.flags|=2097152)}function IT(p,m,T,A,L){var B=ta(T)?Gh:Zs.current;return B=zh(m,B),Ru(m,L),T=Of(p,m,T,A,B,L),A=mT(),p!==null&&!sa?(m.updateQueue=p.updateQueue,m.flags&=-2053,p.lanes&=~L,Il(p,m,L)):(ti&&A&&wE(m),m.flags|=1,Po(p,m,T,L),m.child)}function _C(p,m,T,A,L){if(ta(T)){var B=!0;yE(m)}else B=!1;if(Ru(m,L),m.stateNode===null)GE(p,m),cC(m,T,A),bT(m,T,A,L),A=!0;else if(p===null){var ie=m.stateNode,ye=m.memoizedProps;ie.props=ye;var Ie=ie.context,qe=T.contextType;typeof qe=="object"&&qe!==null?qe=ic(qe):(qe=ta(T)?Gh:Zs.current,qe=zh(m,qe));var yt=T.getDerivedStateFromProps,Tt=typeof yt=="function"||typeof ie.getSnapshotBeforeUpdate=="function";Tt||typeof ie.UNSAFE_componentWillReceiveProps!="function"&&typeof ie.componentWillReceiveProps!="function"||(ye!==A||Ie!==qe)&&lC(m,ie,A,qe),Sd=!1;var vt=m.memoizedState;ie.state=vt,OE(m,A,ie,L),Ie=m.memoizedState,ye!==A||vt!==Ie||ea.current||Sd?(typeof yt=="function"&&(xE(m,T,yt,A),Ie=m.memoizedState),(ye=Sd||TT(m,T,ye,A,vt,Ie,qe))?(Tt||typeof ie.UNSAFE_componentWillMount!="function"&&typeof ie.componentWillMount!="function"||(typeof ie.componentWillMount=="function"&&ie.componentWillMount(),typeof ie.UNSAFE_componentWillMount=="function"&&ie.UNSAFE_componentWillMount()),typeof ie.componentDidMount=="function"&&(m.flags|=4194308)):(typeof ie.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=A,m.memoizedState=Ie),ie.props=A,ie.state=Ie,ie.context=qe,A=ye):(typeof ie.componentDidMount=="function"&&(m.flags|=4194308),A=!1)}else{ie=m.stateNode,$R(p,m),ye=m.memoizedProps,qe=m.type===m.elementType?ye:Pa(m.type,ye),ie.props=qe,Tt=m.pendingProps,vt=ie.context,Ie=T.contextType,typeof Ie=="object"&&Ie!==null?Ie=ic(Ie):(Ie=ta(T)?Gh:Zs.current,Ie=zh(m,Ie));var Vt=T.getDerivedStateFromProps;(yt=typeof Vt=="function"||typeof ie.getSnapshotBeforeUpdate=="function")||typeof ie.UNSAFE_componentWillReceiveProps!="function"&&typeof ie.componentWillReceiveProps!="function"||(ye!==Tt||vt!==Ie)&&lC(m,ie,A,Ie),Sd=!1,vt=m.memoizedState,ie.state=vt,OE(m,A,ie,L);var Kt=m.memoizedState;ye!==Tt||vt!==Kt||ea.current||Sd?(typeof Vt=="function"&&(xE(m,T,Vt,A),Kt=m.memoizedState),(qe=Sd||TT(m,T,qe,A,vt,Kt,Ie)||!1)?(yt||typeof ie.UNSAFE_componentWillUpdate!="function"&&typeof ie.componentWillUpdate!="function"||(typeof ie.componentWillUpdate=="function"&&ie.componentWillUpdate(A,Kt,Ie),typeof ie.UNSAFE_componentWillUpdate=="function"&&ie.UNSAFE_componentWillUpdate(A,Kt,Ie)),typeof ie.componentDidUpdate=="function"&&(m.flags|=4),typeof ie.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof ie.componentDidUpdate!="function"||ye===p.memoizedProps&&vt===p.memoizedState||(m.flags|=4),typeof ie.getSnapshotBeforeUpdate!="function"||ye===p.memoizedProps&&vt===p.memoizedState||(m.flags|=1024),m.memoizedProps=A,m.memoizedState=Kt),ie.props=A,ie.state=Kt,ie.context=Ie,A=qe):(typeof ie.componentDidUpdate!="function"||ye===p.memoizedProps&&vt===p.memoizedState||(m.flags|=4),typeof ie.getSnapshotBeforeUpdate!="function"||ye===p.memoizedProps&&vt===p.memoizedState||(m.flags|=1024),A=!1)}return VE(p,m,T,A,B,L)}function VE(p,m,T,A,L,B){gC(p,m);var ie=(m.flags&128)!==0;if(!A&&!ie)return L&&FR(m,T,!1),Il(p,m,B);A=m.stateNode,yk.current=m;var ye=ie&&typeof T.getDerivedStateFromError!="function"?null:A.render();return m.flags|=1,p!==null&&ie?(m.child=wf(m,p.child,null,B),m.child=wf(m,null,ye,B)):Po(p,m,ye,B),m.memoizedState=A.state,L&&FR(m,T,!0),m.child}function AT(p){var m=p.stateNode;m.pendingContext?VR(p,m.pendingContext,m.pendingContext!==m.context):m.context&&VR(p,m.context,!1),uT(p,m.containerInfo)}function EC(p,m,T,A,L){return bf(),iT(L),m.flags|=256,Po(p,m,T,A),m.child}var OT={dehydrated:null,treeContext:null,retryLane:0};function Df(p){return{baseLanes:p,cachePool:null,transitions:null}}function FE(p,m,T){var A=m.pendingProps,L=yi.current,B=!1,ie=(m.flags&128)!==0,ye;if((ye=ie)||(ye=p!==null&&p.memoizedState===null?!1:(L&2)!==0),ye?(B=!0,m.flags&=-129):(p===null||p.memoizedState!==null)&&(L|=1),di(yi,L&1),p===null)return rT(m),p=m.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((m.mode&1)===0?m.lanes=1:p.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(ie=A.children,p=A.fallback,B?(A=m.mode,B=m.child,ie={mode:"hidden",children:ie},(A&1)===0&&B!==null?(B.childLanes=0,B.pendingProps=ie):B=Od(ie,A,0,null),p=rp(p,A,T,null),B.return=m,p.return=m,B.sibling=p,m.child=B,m.child.memoizedState=Df(T),m.memoizedState=OT,p):jE(m,ie));if(L=p.memoizedState,L!==null&&(ye=L.dehydrated,ye!==null))return vC(p,m,ie,A,ye,L,T);if(B){B=A.fallback,ie=m.mode,L=p.child,ye=L.sibling;var Ie={mode:"hidden",children:A.children};return(ie&1)===0&&m.child!==L?(A=m.child,A.childLanes=0,A.pendingProps=Ie,m.deletions=null):(A=ku(L,Ie),A.subtreeFlags=L.subtreeFlags&14680064),ye!==null?B=ku(ye,B):(B=rp(B,ie,T,null),B.flags|=2),B.return=m,A.return=m,A.sibling=B,m.child=A,A=B,B=m.child,ie=p.child.memoizedState,ie=ie===null?Df(T):{baseLanes:ie.baseLanes|T,cachePool:null,transitions:ie.transitions},B.memoizedState=ie,B.childLanes=p.childLanes&~T,m.memoizedState=OT,A}return B=p.child,p=B.sibling,A=ku(B,{mode:"visible",children:A.children}),(m.mode&1)===0&&(A.lanes=T),A.return=m,A.sibling=null,p!==null&&(T=m.deletions,T===null?(m.deletions=[p],m.flags|=16):T.push(p)),m.child=A,m.memoizedState=null,A}function jE(p,m){return m=Od({mode:"visible",children:m},p.mode,0,null),m.return=p,p.child=m}function Jh(p,m,T,A){return A!==null&&iT(A),wf(m,p.child,null,T),p=jE(m,m.pendingProps.children),p.flags|=2,m.memoizedState=null,p}function vC(p,m,T,A,L,B,ie){if(T)return m.flags&256?(m.flags&=-257,A=wT(Error(s(422))),Jh(p,m,ie,A)):m.memoizedState!==null?(m.child=p.child,m.flags|=128,null):(B=A.fallback,L=m.mode,A=Od({mode:"visible",children:A.children},L,0,null),B=rp(B,L,ie,null),B.flags|=2,A.return=m,B.return=m,A.sibling=B,m.child=A,(m.mode&1)!==0&&wf(m,p.child,null,ie),m.child.memoizedState=Df(ie),m.memoizedState=OT,B);if((m.mode&1)===0)return Jh(p,m,ie,null);if(L.data==="$!"){if(A=L.nextSibling&&L.nextSibling.dataset,A)var ye=A.dgst;return A=ye,B=Error(s(419)),A=wT(B,A,void 0),Jh(p,m,ie,A)}if(ye=(ie&p.childLanes)!==0,sa||ye){if(A=Is,A!==null){switch(ie&-ie){case 4:L=2;break;case 16:L=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:L=32;break;case 536870912:L=268435456;break;default:L=0}L=(L&(A.suspendedLanes|ie))!==0?0:L,L!==0&&L!==B.retryLane&&(B.retryLane=L,Cu(p,L),lc(A,p,L,-1))}return jT(),A=wT(Error(s(421))),Jh(p,m,ie,A)}return L.data==="$?"?(m.flags|=128,m.child=p.child,m=lv.bind(null,p),L._reactRetry=m,null):(p=B.treeContext,ra=gd(L.nextSibling),na=m,ti=!0,Ao=null,p!==null&&(rc[Oa++]=Tu,rc[Oa++]=bu,rc[Oa++]=Hh,Tu=p.id,bu=p.overflow,Hh=m),m=jE(m,A.children),m.flags|=4096,m)}function yC(p,m,T){p.lanes|=m;var A=p.alternate;A!==null&&(A.lanes|=m),cT(p.return,m,T)}function BE(p,m,T,A,L){var B=p.memoizedState;B===null?p.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:A,tail:T,tailMode:L}:(B.isBackwards=m,B.rendering=null,B.renderingStartTime=0,B.last=A,B.tail=T,B.tailMode=L)}function WE(p,m,T){var A=m.pendingProps,L=A.revealOrder,B=A.tail;if(Po(p,m,A.children,T),A=yi.current,(A&2)!==0)A=A&1|2,m.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=m.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&yC(p,T,m);else if(p.tag===19)yC(p,T,m);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===m)break e;for(;p.sibling===null;){if(p.return===null||p.return===m)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}A&=1}if(di(yi,A),(m.mode&1)===0)m.memoizedState=null;else switch(L){case"forwards":for(T=m.child,L=null;T!==null;)p=T.alternate,p!==null&&bd(p)===null&&(L=T),T=T.sibling;T=L,T===null?(L=m.child,m.child=null):(L=T.sibling,T.sibling=null),BE(m,!1,L,T,B);break;case"backwards":for(T=null,L=m.child,m.child=null;L!==null;){if(p=L.alternate,p!==null&&bd(p)===null){m.child=L;break}p=L.sibling,L.sibling=T,T=L,L=p}BE(m,!0,T,null,B);break;case"together":BE(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function GE(p,m){(m.mode&1)===0&&p!==null&&(p.alternate=null,m.alternate=null,m.flags|=2)}function Il(p,m,T){if(p!==null&&(m.dependencies=p.dependencies),Qh|=m.lanes,(T&m.childLanes)===0)return null;if(p!==null&&m.child!==p.child)throw Error(s(153));if(m.child!==null){for(p=m.child,T=ku(p,p.pendingProps),m.child=T,T.return=m;p.sibling!==null;)p=p.sibling,T=T.sibling=ku(p,p.pendingProps),T.return=m;T.sibling=null}return m.child}function SC(p,m,T){switch(m.tag){case 3:AT(m),bf();break;case 5:XR(m);break;case 1:ta(m.type)&&yE(m);break;case 4:uT(m,m.stateNode.containerInfo);break;case 10:var A=m.type._context,L=m.memoizedProps.value;di(IE,A._currentValue),A._currentValue=L;break;case 13:if(A=m.memoizedState,A!==null)return A.dehydrated!==null?(di(yi,yi.current&1),m.flags|=128,null):(T&m.child.childLanes)!==0?FE(p,m,T):(di(yi,yi.current&1),p=Il(p,m,T),p!==null?p.sibling:null);di(yi,yi.current&1);break;case 19:if(A=(T&m.childLanes)!==0,(p.flags&128)!==0){if(A)return WE(p,m,T);m.flags|=128}if(L=m.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),di(yi,yi.current),A)break;return null;case 22:case 23:return m.lanes=0,mC(p,m,T)}return Il(p,m,T)}var TC,zE,PT,bC;TC=function(p,m){for(var T=m.child;T!==null;){if(T.tag===5||T.tag===6)p.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===m)break;for(;T.sibling===null;){if(T.return===null||T.return===m)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},zE=function(){},PT=function(p,m,T,A){var L=p.memoizedProps;if(L!==A){p=m.stateNode,$h(Rl.current);var B=null;switch(T){case"input":L=Ar(p,L),A=Ar(p,A),B=[];break;case"select":L=it({},L,{value:void 0}),A=it({},A,{value:void 0}),B=[];break;case"textarea":L=ft(p,L),A=ft(p,A),B=[];break;default:typeof L.onClick!="function"&&typeof A.onClick=="function"&&(p.onclick=gE)}Sa(T,A);var ie;T=null;for(qe in L)if(!A.hasOwnProperty(qe)&&L.hasOwnProperty(qe)&&L[qe]!=null)if(qe==="style"){var ye=L[qe];for(ie in ye)ye.hasOwnProperty(ie)&&(T||(T={}),T[ie]="")}else qe!=="dangerouslySetInnerHTML"&&qe!=="children"&&qe!=="suppressContentEditableWarning"&&qe!=="suppressHydrationWarning"&&qe!=="autoFocus"&&(l.hasOwnProperty(qe)?B||(B=[]):(B=B||[]).push(qe,null));for(qe in A){var Ie=A[qe];if(ye=L!=null?L[qe]:void 0,A.hasOwnProperty(qe)&&Ie!==ye&&(Ie!=null||ye!=null))if(qe==="style")if(ye){for(ie in ye)!ye.hasOwnProperty(ie)||Ie&&Ie.hasOwnProperty(ie)||(T||(T={}),T[ie]="");for(ie in Ie)Ie.hasOwnProperty(ie)&&ye[ie]!==Ie[ie]&&(T||(T={}),T[ie]=Ie[ie])}else T||(B||(B=[]),B.push(qe,T)),T=Ie;else qe==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,ye=ye?ye.__html:void 0,Ie!=null&&ye!==Ie&&(B=B||[]).push(qe,Ie)):qe==="children"?typeof Ie!="string"&&typeof Ie!="number"||(B=B||[]).push(qe,""+Ie):qe!=="suppressContentEditableWarning"&&qe!=="suppressHydrationWarning"&&(l.hasOwnProperty(qe)?(Ie!=null&&qe==="onScroll"&&gi("scroll",p),B||ye===Ie||(B=[])):(B=B||[]).push(qe,Ie))}T&&(B=B||[]).push("style",T);var qe=B;(m.updateQueue=qe)&&(m.flags|=4)}},bC=function(p,m,T,A){T!==A&&(m.flags|=4)};function bg(p,m){if(!ti)switch(p.tailMode){case"hidden":m=p.tail;for(var T=null;m!==null;)m.alternate!==null&&(T=m),m=m.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var A=null;T!==null;)T.alternate!==null&&(A=T),T=T.sibling;A===null?m||p.tail===null?p.tail=null:p.tail.sibling=null:A.sibling=null}}function to(p){var m=p.alternate!==null&&p.alternate.child===p.child,T=0,A=0;if(m)for(var L=p.child;L!==null;)T|=L.lanes|L.childLanes,A|=L.subtreeFlags&14680064,A|=L.flags&14680064,L.return=p,L=L.sibling;else for(L=p.child;L!==null;)T|=L.lanes|L.childLanes,A|=L.subtreeFlags,A|=L.flags,L.return=p,L=L.sibling;return p.subtreeFlags|=A,p.childLanes=T,m}function HE(p,m,T){var A=m.pendingProps;switch(dg(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return to(m),null;case 1:return ta(m.type)&&EE(),to(m),null;case 3:return A=m.stateNode,qh(),_i(ea),_i(Zs),hT(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(p===null||p.child===null)&&(hg(m)?m.flags|=4:p===null||p.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Ao!==null&&(sv(Ao),Ao=null))),zE(p,m),to(m),null;case 5:If(m);var L=$h(Cf.current);if(T=m.type,p!==null&&m.stateNode!=null)PT(p,m,T,A,L),p.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!A){if(m.stateNode===null)throw Error(s(166));return to(m),null}if(p=$h(Rl.current),hg(m)){A=m.stateNode,T=m.type;var B=m.memoizedProps;switch(A[bl]=m,A[_d]=B,p=(m.mode&1)!==0,T){case"dialog":gi("cancel",A),gi("close",A);break;case"iframe":case"object":case"embed":gi("load",A);break;case"video":case"audio":for(L=0;L<sg.length;L++)gi(sg[L],A);break;case"source":gi("error",A);break;case"img":case"image":case"link":gi("error",A),gi("load",A);break;case"details":gi("toggle",A);break;case"input":Xt(A,B),gi("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!B.multiple},gi("invalid",A);break;case"textarea":mt(A,B),gi("invalid",A)}Sa(T,B),L=null;for(var ie in B)if(B.hasOwnProperty(ie)){var ye=B[ie];ie==="children"?typeof ye=="string"?A.textContent!==ye&&(B.suppressHydrationWarning!==!0&&mE(A.textContent,ye,p),L=["children",ye]):typeof ye=="number"&&A.textContent!==""+ye&&(B.suppressHydrationWarning!==!0&&mE(A.textContent,ye,p),L=["children",""+ye]):l.hasOwnProperty(ie)&&ye!=null&&ie==="onScroll"&&gi("scroll",A)}switch(T){case"input":Rn(A),ve(A,B,!0);break;case"textarea":Rn(A),pn(A);break;case"select":case"option":break;default:typeof B.onClick=="function"&&(A.onclick=gE)}A=L,m.updateQueue=A,A!==null&&(m.flags|=4)}else{ie=L.nodeType===9?L:L.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Nn(T)),p==="http://www.w3.org/1999/xhtml"?T==="script"?(p=ie.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof A.is=="string"?p=ie.createElement(T,{is:A.is}):(p=ie.createElement(T),T==="select"&&(ie=p,A.multiple?ie.multiple=!0:A.size&&(ie.size=A.size))):p=ie.createElementNS(p,T),p[bl]=m,p[_d]=A,TC(p,m,!1,!1),m.stateNode=p;e:{switch(ie=Mc(T,A),T){case"dialog":gi("cancel",p),gi("close",p),L=A;break;case"iframe":case"object":case"embed":gi("load",p),L=A;break;case"video":case"audio":for(L=0;L<sg.length;L++)gi(sg[L],p);L=A;break;case"source":gi("error",p),L=A;break;case"img":case"image":case"link":gi("error",p),gi("load",p),L=A;break;case"details":gi("toggle",p),L=A;break;case"input":Xt(p,A),L=Ar(p,A),gi("invalid",p);break;case"option":L=A;break;case"select":p._wrapperState={wasMultiple:!!A.multiple},L=it({},A,{value:void 0}),gi("invalid",p);break;case"textarea":mt(p,A),L=ft(p,A),gi("invalid",p);break;default:L=A}Sa(T,L),ye=L;for(B in ye)if(ye.hasOwnProperty(B)){var Ie=ye[B];B==="style"?Ls(p,Ie):B==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Ie!=null&&Ga(p,Ie)):B==="children"?typeof Ie=="string"?(T!=="textarea"||Ie!=="")&&Nt(p,Ie):typeof Ie=="number"&&Nt(p,""+Ie):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(l.hasOwnProperty(B)?Ie!=null&&B==="onScroll"&&gi("scroll",p):Ie!=null&&re(p,B,Ie,ie))}switch(T){case"input":Rn(p),ve(p,A,!1);break;case"textarea":Rn(p),pn(p);break;case"option":A.value!=null&&p.setAttribute("value",""+Ht(A.value));break;case"select":p.multiple=!!A.multiple,B=A.value,B!=null?ut(p,!!A.multiple,B,!1):A.defaultValue!=null&&ut(p,!!A.multiple,A.defaultValue,!0);break;default:typeof L.onClick=="function"&&(p.onclick=gE)}switch(T){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return to(m),null;case 6:if(p&&m.stateNode!=null)bC(p,m,p.memoizedProps,A);else{if(typeof A!="string"&&m.stateNode===null)throw Error(s(166));if(T=$h(Cf.current),$h(Rl.current),hg(m)){if(A=m.stateNode,T=m.memoizedProps,A[bl]=m,(B=A.nodeValue!==T)&&(p=na,p!==null))switch(p.tag){case 3:mE(A.nodeValue,T,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&mE(A.nodeValue,T,(p.mode&1)!==0)}B&&(m.flags|=4)}else A=(T.nodeType===9?T:T.ownerDocument).createTextNode(A),A[bl]=m,m.stateNode=A}return to(m),null;case 13:if(_i(yi),A=m.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(ti&&ra!==null&&(m.mode&1)!==0&&(m.flags&128)===0)zR(),bf(),m.flags|=98560,B=!1;else if(B=hg(m),A!==null&&A.dehydrated!==null){if(p===null){if(!B)throw Error(s(318));if(B=m.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(s(317));B[bl]=m}else bf(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;to(m),B=!1}else Ao!==null&&(sv(Ao),Ao=null),B=!0;if(!B)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=T,m):(A=A!==null,A!==(p!==null&&p.memoizedState!==null)&&A&&(m.child.flags|=8192,(m.mode&1)!==0&&(p===null||(yi.current&1)!==0?is===0&&(is=3):jT())),m.updateQueue!==null&&(m.flags|=4),to(m),null);case 4:return qh(),zE(p,m),p===null&&Fh(m.stateNode.containerInfo),to(m),null;case 10:return aT(m.type._context),to(m),null;case 17:return ta(m.type)&&EE(),to(m),null;case 19:if(_i(yi),B=m.memoizedState,B===null)return to(m),null;if(A=(m.flags&128)!==0,ie=B.rendering,ie===null)if(A)bg(B,!1);else{if(is!==0||p!==null&&(p.flags&128)!==0)for(p=m.child;p!==null;){if(ie=bd(p),ie!==null){for(m.flags|=128,bg(B,!1),A=ie.updateQueue,A!==null&&(m.updateQueue=A,m.flags|=4),m.subtreeFlags=0,A=T,T=m.child;T!==null;)B=T,p=A,B.flags&=14680066,ie=B.alternate,ie===null?(B.childLanes=0,B.lanes=p,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=ie.childLanes,B.lanes=ie.lanes,B.child=ie.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=ie.memoizedProps,B.memoizedState=ie.memoizedState,B.updateQueue=ie.updateQueue,B.type=ie.type,p=ie.dependencies,B.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),T=T.sibling;return di(yi,yi.current&1|2),m.child}p=p.sibling}B.tail!==null&&xr()>Mf&&(m.flags|=128,A=!0,bg(B,!1),m.lanes=4194304)}else{if(!A)if(p=bd(ie),p!==null){if(m.flags|=128,A=!0,T=p.updateQueue,T!==null&&(m.updateQueue=T,m.flags|=4),bg(B,!0),B.tail===null&&B.tailMode==="hidden"&&!ie.alternate&&!ti)return to(m),null}else 2*xr()-B.renderingStartTime>Mf&&T!==1073741824&&(m.flags|=128,A=!0,bg(B,!1),m.lanes=4194304);B.isBackwards?(ie.sibling=m.child,m.child=ie):(T=B.last,T!==null?T.sibling=ie:m.child=ie,B.last=ie)}return B.tail!==null?(m=B.tail,B.rendering=m,B.tail=m.sibling,B.renderingStartTime=xr(),m.sibling=null,T=yi.current,di(yi,A?T&1|2:T&1),m):(to(m),null);case 22:case 23:return Ng(),A=m.memoizedState!==null,p!==null&&p.memoizedState!==null!==A&&(m.flags|=8192),A&&(m.mode&1)!==0?(Na&1073741824)!==0&&(to(m),m.subtreeFlags&6&&(m.flags|=8192)):to(m),null;case 24:return null;case 25:return null}throw Error(s(156,m.tag))}function Sk(p,m){switch(dg(m),m.tag){case 1:return ta(m.type)&&EE(),p=m.flags,p&65536?(m.flags=p&-65537|128,m):null;case 3:return qh(),_i(ea),_i(Zs),hT(),p=m.flags,(p&65536)!==0&&(p&128)===0?(m.flags=p&-65537|128,m):null;case 5:return If(m),null;case 13:if(_i(yi),p=m.memoizedState,p!==null&&p.dehydrated!==null){if(m.alternate===null)throw Error(s(340));bf()}return p=m.flags,p&65536?(m.flags=p&-65537|128,m):null;case 19:return _i(yi),null;case 4:return qh(),null;case 10:return aT(m.type._context),null;case 22:case 23:return Ng(),null;case 24:return null;default:return null}}var KE=!1,no=!1,wC=typeof WeakSet=="function"?WeakSet:Set,Gt=null;function Lf(p,m){var T=p.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(A){Ri(p,m,A)}else T.current=null}function wg(p,m,T){try{T()}catch(A){Ri(p,m,A)}}var RC=!1;function NT(p,m){if(_E=_e,p=CR(),ng(p)){if("selectionStart"in p)var T={start:p.selectionStart,end:p.selectionEnd};else e:{T=(T=p.ownerDocument)&&T.defaultView||window;var A=T.getSelection&&T.getSelection();if(A&&A.rangeCount!==0){T=A.anchorNode;var L=A.anchorOffset,B=A.focusNode;A=A.focusOffset;try{T.nodeType,B.nodeType}catch{T=null;break e}var ie=0,ye=-1,Ie=-1,qe=0,yt=0,Tt=p,vt=null;t:for(;;){for(var Vt;Tt!==T||L!==0&&Tt.nodeType!==3||(ye=ie+L),Tt!==B||A!==0&&Tt.nodeType!==3||(Ie=ie+A),Tt.nodeType===3&&(ie+=Tt.nodeValue.length),(Vt=Tt.firstChild)!==null;)vt=Tt,Tt=Vt;for(;;){if(Tt===p)break t;if(vt===T&&++qe===L&&(ye=ie),vt===B&&++yt===A&&(Ie=ie),(Vt=Tt.nextSibling)!==null)break;Tt=vt,vt=Tt.parentNode}Tt=Vt}T=ye===-1||Ie===-1?null:{start:ye,end:Ie}}else T=null}T=T||{start:0,end:0}}else T=null;for(ag={focusedElem:p,selectionRange:T},_e=!1,Gt=m;Gt!==null;)if(m=Gt,p=m.child,(m.subtreeFlags&1028)!==0&&p!==null)p.return=m,Gt=p;else for(;Gt!==null;){m=Gt;try{var Kt=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(Kt!==null){var $t=Kt.memoizedProps,Ui=Kt.memoizedState,Ge=m.stateNode,Pe=Ge.getSnapshotBeforeUpdate(m.elementType===m.type?$t:Pa(m.type,$t),Ui);Ge.__reactInternalSnapshotBeforeUpdate=Pe}break;case 3:var He=m.stateNode.containerInfo;He.nodeType===1?He.textContent="":He.nodeType===9&&He.documentElement&&He.removeChild(He.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(wt){Ri(m,m.return,wt)}if(p=m.sibling,p!==null){p.return=m.return,Gt=p;break}Gt=m.return}return Kt=RC,RC=!1,Kt}function Rg(p,m,T){var A=m.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var L=A=A.next;do{if((L.tag&p)===p){var B=L.destroy;L.destroy=void 0,B!==void 0&&wg(m,T,B)}L=L.next}while(L!==A)}}function Cg(p,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var T=m=m.next;do{if((T.tag&p)===p){var A=T.create;T.destroy=A()}T=T.next}while(T!==m)}}function kT(p){var m=p.ref;if(m!==null){var T=p.stateNode;switch(p.tag){case 5:p=T;break;default:p=T}typeof m=="function"?m(p):m.current=p}}function CC(p){var m=p.alternate;m!==null&&(p.alternate=null,CC(m)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(m=p.stateNode,m!==null&&(delete m[bl],delete m[_d],delete m[lg],delete m[uk],delete m[dk])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function DT(p){return p.tag===5||p.tag===3||p.tag===4}function IC(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||DT(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function LT(p,m,T){var A=p.tag;if(A===5||A===6)p=p.stateNode,m?T.nodeType===8?T.parentNode.insertBefore(p,m):T.insertBefore(p,m):(T.nodeType===8?(m=T.parentNode,m.insertBefore(p,T)):(m=T,m.appendChild(p)),T=T._reactRootContainer,T!=null||m.onclick!==null||(m.onclick=gE));else if(A!==4&&(p=p.child,p!==null))for(LT(p,m,T),p=p.sibling;p!==null;)LT(p,m,T),p=p.sibling}function $E(p,m,T){var A=p.tag;if(A===5||A===6)p=p.stateNode,m?T.insertBefore(p,m):T.appendChild(p);else if(A!==4&&(p=p.child,p!==null))for($E(p,m,T),p=p.sibling;p!==null;)$E(p,m,T),p=p.sibling}var Ms=null,oc=!1;function Al(p,m,T){for(T=T.child;T!==null;)AC(p,m,T),T=T.sibling}function AC(p,m,T){if(Qs&&typeof Qs.onCommitFiberUnmount=="function")try{Qs.onCommitFiberUnmount(ml,T)}catch{}switch(T.tag){case 5:no||Lf(T,m);case 6:var A=Ms,L=oc;Ms=null,Al(p,m,T),Ms=A,oc=L,Ms!==null&&(oc?(p=Ms,T=T.stateNode,p.nodeType===8?p.parentNode.removeChild(T):p.removeChild(T)):Ms.removeChild(T.stateNode));break;case 18:Ms!==null&&(oc?(p=Ms,T=T.stateNode,p.nodeType===8?eT(p.parentNode,T):p.nodeType===1&&eT(p,T),Qo(p)):eT(Ms,T.stateNode));break;case 4:A=Ms,L=oc,Ms=T.stateNode.containerInfo,oc=!0,Al(p,m,T),Ms=A,oc=L;break;case 0:case 11:case 14:case 15:if(!no&&(A=T.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){L=A=A.next;do{var B=L,ie=B.destroy;B=B.tag,ie!==void 0&&((B&2)!==0||(B&4)!==0)&&wg(T,m,ie),L=L.next}while(L!==A)}Al(p,m,T);break;case 1:if(!no&&(Lf(T,m),A=T.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=T.memoizedProps,A.state=T.memoizedState,A.componentWillUnmount()}catch(ye){Ri(T,m,ye)}Al(p,m,T);break;case 21:Al(p,m,T);break;case 22:T.mode&1?(no=(A=no)||T.memoizedState!==null,Al(p,m,T),no=A):Al(p,m,T);break;default:Al(p,m,T)}}function OC(p){var m=p.updateQueue;if(m!==null){p.updateQueue=null;var T=p.stateNode;T===null&&(T=p.stateNode=new wC),m.forEach(function(A){var L=xC.bind(null,p,A);T.has(A)||(T.add(A),A.then(L,L))})}}function No(p,m){var T=m.deletions;if(T!==null)for(var A=0;A<T.length;A++){var L=T[A];try{var B=p,ie=m,ye=ie;e:for(;ye!==null;){switch(ye.tag){case 5:Ms=ye.stateNode,oc=!1;break e;case 3:Ms=ye.stateNode.containerInfo,oc=!0;break e;case 4:Ms=ye.stateNode.containerInfo,oc=!0;break e}ye=ye.return}if(Ms===null)throw Error(s(160));AC(B,ie,L),Ms=null,oc=!1;var Ie=L.alternate;Ie!==null&&(Ie.return=null),L.return=null}catch(qe){Ri(L,m,qe)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)xT(m,p),m=m.sibling}function xT(p,m){var T=p.alternate,A=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(No(m,p),oa(p),A&4){try{Rg(3,p,p.return),Cg(3,p)}catch($t){Ri(p,p.return,$t)}try{Rg(5,p,p.return)}catch($t){Ri(p,p.return,$t)}}break;case 1:No(m,p),oa(p),A&512&&T!==null&&Lf(T,T.return);break;case 5:if(No(m,p),oa(p),A&512&&T!==null&&Lf(T,T.return),p.flags&32){var L=p.stateNode;try{Nt(L,"")}catch($t){Ri(p,p.return,$t)}}if(A&4&&(L=p.stateNode,L!=null)){var B=p.memoizedProps,ie=T!==null?T.memoizedProps:B,ye=p.type,Ie=p.updateQueue;if(p.updateQueue=null,Ie!==null)try{ye==="input"&&B.type==="radio"&&B.name!=null&&Qn(L,B),Mc(ye,ie);var qe=Mc(ye,B);for(ie=0;ie<Ie.length;ie+=2){var yt=Ie[ie],Tt=Ie[ie+1];yt==="style"?Ls(L,Tt):yt==="dangerouslySetInnerHTML"?Ga(L,Tt):yt==="children"?Nt(L,Tt):re(L,yt,Tt,qe)}switch(ye){case"input":Wt(L,B);break;case"textarea":Ut(L,B);break;case"select":var vt=L._wrapperState.wasMultiple;L._wrapperState.wasMultiple=!!B.multiple;var Vt=B.value;Vt!=null?ut(L,!!B.multiple,Vt,!1):vt!==!!B.multiple&&(B.defaultValue!=null?ut(L,!!B.multiple,B.defaultValue,!0):ut(L,!!B.multiple,B.multiple?[]:"",!1))}L[_d]=B}catch($t){Ri(p,p.return,$t)}}break;case 6:if(No(m,p),oa(p),A&4){if(p.stateNode===null)throw Error(s(162));L=p.stateNode,B=p.memoizedProps;try{L.nodeValue=B}catch($t){Ri(p,p.return,$t)}}break;case 3:if(No(m,p),oa(p),A&4&&T!==null&&T.memoizedState.isDehydrated)try{Qo(m.containerInfo)}catch($t){Ri(p,p.return,$t)}break;case 4:No(m,p),oa(p);break;case 13:No(m,p),oa(p),L=p.child,L.flags&8192&&(B=L.memoizedState!==null,L.stateNode.isHidden=B,!B||L.alternate!==null&&L.alternate.memoizedState!==null||(ZE=xr())),A&4&&OC(p);break;case 22:if(yt=T!==null&&T.memoizedState!==null,p.mode&1?(no=(qe=no)||yt,No(m,p),no=qe):No(m,p),oa(p),A&8192){if(qe=p.memoizedState!==null,(p.stateNode.isHidden=qe)&&!yt&&(p.mode&1)!==0)for(Gt=p,yt=p.child;yt!==null;){for(Tt=Gt=yt;Gt!==null;){switch(vt=Gt,Vt=vt.child,vt.tag){case 0:case 11:case 14:case 15:Rg(4,vt,vt.return);break;case 1:Lf(vt,vt.return);var Kt=vt.stateNode;if(typeof Kt.componentWillUnmount=="function"){A=vt,T=vt.return;try{m=A,Kt.props=m.memoizedProps,Kt.state=m.memoizedState,Kt.componentWillUnmount()}catch($t){Ri(A,T,$t)}}break;case 5:Lf(vt,vt.return);break;case 22:if(vt.memoizedState!==null){Ig(Tt);continue}}Vt!==null?(Vt.return=vt,Gt=Vt):Ig(Tt)}yt=yt.sibling}e:for(yt=null,Tt=p;;){if(Tt.tag===5){if(yt===null){yt=Tt;try{L=Tt.stateNode,qe?(B=L.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none"):(ye=Tt.stateNode,Ie=Tt.memoizedProps.style,ie=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null,ye.style.display=bs("display",ie))}catch($t){Ri(p,p.return,$t)}}}else if(Tt.tag===6){if(yt===null)try{Tt.stateNode.nodeValue=qe?"":Tt.memoizedProps}catch($t){Ri(p,p.return,$t)}}else if((Tt.tag!==22&&Tt.tag!==23||Tt.memoizedState===null||Tt===p)&&Tt.child!==null){Tt.child.return=Tt,Tt=Tt.child;continue}if(Tt===p)break e;for(;Tt.sibling===null;){if(Tt.return===null||Tt.return===p)break e;yt===Tt&&(yt=null),Tt=Tt.return}yt===Tt&&(yt=null),Tt.sibling.return=Tt.return,Tt=Tt.sibling}}break;case 19:No(m,p),oa(p),A&4&&OC(p);break;case 21:break;default:No(m,p),oa(p)}}function oa(p){var m=p.flags;if(m&2){try{e:{for(var T=p.return;T!==null;){if(DT(T)){var A=T;break e}T=T.return}throw Error(s(160))}switch(A.tag){case 5:var L=A.stateNode;A.flags&32&&(Nt(L,""),A.flags&=-33);var B=IC(p);$E(p,B,L);break;case 3:case 4:var ie=A.stateNode.containerInfo,ye=IC(p);LT(p,ye,ie);break;default:throw Error(s(161))}}catch(Ie){Ri(p,p.return,Ie)}p.flags&=-3}m&4096&&(p.flags&=-4097)}function xf(p,m,T){Gt=p,MT(p)}function MT(p,m,T){for(var A=(p.mode&1)!==0;Gt!==null;){var L=Gt,B=L.child;if(L.tag===22&&A){var ie=L.memoizedState!==null||KE;if(!ie){var ye=L.alternate,Ie=ye!==null&&ye.memoizedState!==null||no;ye=KE;var qe=no;if(KE=ie,(no=Ie)&&!qe)for(Gt=L;Gt!==null;)ie=Gt,Ie=ie.child,ie.tag===22&&ie.memoizedState!==null?PC(L):Ie!==null?(Ie.return=ie,Gt=Ie):PC(L);for(;B!==null;)Gt=B,MT(B),B=B.sibling;Gt=L,KE=ye,no=qe}qE(p)}else(L.subtreeFlags&8772)!==0&&B!==null?(B.return=L,Gt=B):qE(p)}}function qE(p){for(;Gt!==null;){var m=Gt;if((m.flags&8772)!==0){var T=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:no||Cg(5,m);break;case 1:var A=m.stateNode;if(m.flags&4&&!no)if(T===null)A.componentDidMount();else{var L=m.elementType===m.type?T.memoizedProps:Pa(m.type,T.memoizedProps);A.componentDidUpdate(L,T.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var B=m.updateQueue;B!==null&&YR(m,B,A);break;case 3:var ie=m.updateQueue;if(ie!==null){if(T=null,m.child!==null)switch(m.child.tag){case 5:T=m.child.stateNode;break;case 1:T=m.child.stateNode}YR(m,ie,T)}break;case 5:var ye=m.stateNode;if(T===null&&m.flags&4){T=ye;var Ie=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":Ie.autoFocus&&T.focus();break;case"img":Ie.src&&(T.src=Ie.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var qe=m.alternate;if(qe!==null){var yt=qe.memoizedState;if(yt!==null){var Tt=yt.dehydrated;Tt!==null&&Qo(Tt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}no||m.flags&512&&kT(m)}catch(vt){Ri(m,m.return,vt)}}if(m===p){Gt=null;break}if(T=m.sibling,T!==null){T.return=m.return,Gt=T;break}Gt=m.return}}function Ig(p){for(;Gt!==null;){var m=Gt;if(m===p){Gt=null;break}var T=m.sibling;if(T!==null){T.return=m.return,Gt=T;break}Gt=m.return}}function PC(p){for(;Gt!==null;){var m=Gt;try{switch(m.tag){case 0:case 11:case 15:var T=m.return;try{Cg(4,m)}catch(Ie){Ri(m,T,Ie)}break;case 1:var A=m.stateNode;if(typeof A.componentDidMount=="function"){var L=m.return;try{A.componentDidMount()}catch(Ie){Ri(m,L,Ie)}}var B=m.return;try{kT(m)}catch(Ie){Ri(m,B,Ie)}break;case 5:var ie=m.return;try{kT(m)}catch(Ie){Ri(m,ie,Ie)}}}catch(Ie){Ri(m,m.return,Ie)}if(m===p){Gt=null;break}var ye=m.sibling;if(ye!==null){ye.return=m.return,Gt=ye;break}Gt=m.return}}var Tk=Math.ceil,YE=fe.ReactCurrentDispatcher,XE=fe.ReactCurrentOwner,ac=fe.ReactCurrentBatchConfig,vr=0,Is=null,Mi=null,rs=0,Na=0,Kc=tc(0),is=0,Us=null,Qh=0,JE=0,QE=0,Ag=null,ko=null,ZE=0,Mf=1/0,Ol=null,ev=!1,UT=null,Cd=null,Uf=!1,Pl=null,tv=0,Zh=0,VT=null,Og=-1,nv=0;function Vs(){return(vr&6)!==0?xr():Og!==-1?Og:Og=xr()}function cc(p){return(p.mode&1)===0?1:(vr&2)!==0&&rs!==0?rs&-rs:pk.transition!==null?(nv===0&&(nv=fu()),nv):(p=Zn,p!==0||(p=window.event,p=p===void 0?16:Mr(p.type)),p)}function lc(p,m,T,A){if(50<Zh)throw Zh=0,VT=null,Error(s(185));El(p,T,A),((vr&2)===0||p!==Is)&&(p===Is&&((vr&2)===0&&(JE|=T),is===4&&Pu(p,rs)),ro(p,A),T===1&&vr===0&&(m.mode&1)===0&&(Mf=xr()+500,SE&&vd()))}function ro(p,m){var T=p.callbackNode;wa(p,m);var A=_l(p,p===Is?rs:0);if(A===0)T!==null&&hu(T),p.callbackNode=null,p.callbackPriority=0;else if(m=A&-A,p.callbackPriority!==m){if(T!=null&&hu(T),m===1)p.tag===0?hk(ep.bind(null,p)):jR(ep.bind(null,p)),ck(function(){(vr&6)===0&&vd()}),T=null;else{switch(Ya(A)){case 1:T=qa;break;case 4:T=Fc;break;case 16:T=Xo;break;case 536870912:T=ud;break;default:T=Xo}T=kg(T,rv.bind(null,p))}p.callbackPriority=m,p.callbackNode=T}}function rv(p,m){if(Og=-1,nv=0,(vr&6)!==0)throw Error(s(327));var T=p.callbackNode;if(Vf()&&p.callbackNode!==T)return null;var A=_l(p,p===Is?rs:0);if(A===0)return null;if((A&30)!==0||(A&p.expiredLanes)!==0||m)m=Nl(p,A);else{m=A;var L=vr;vr|=2;var B=NC();(Is!==p||rs!==m)&&(Ol=null,Mf=xr()+500,Id(p,m));do try{bk();break}catch(ye){FT(p,ye)}while(!0);oT(),YE.current=B,vr=L,Mi!==null?m=0:(Is=null,rs=0,m=is)}if(m!==0){if(m===2&&(L=_o(p),L!==0&&(A=L,m=iv(p,L))),m===1)throw T=Us,Id(p,0),Pu(p,A),ro(p,xr()),T;if(m===6)Pu(p,A);else{if(L=p.current.alternate,(A&30)===0&&!ov(L)&&(m=Nl(p,A),m===2&&(B=_o(p),B!==0&&(A=B,m=iv(p,B))),m===1))throw T=Us,Id(p,0),Pu(p,A),ro(p,xr()),T;switch(p.finishedWork=L,p.finishedLanes=A,m){case 0:case 1:throw Error(s(345));case 2:tp(p,ko,Ol);break;case 3:if(Pu(p,A),(A&130023424)===A&&(m=ZE+500-xr(),10<m)){if(_l(p,0)!==0)break;if(L=p.suspendedLanes,(L&A)!==A){Vs(),p.pingedLanes|=p.suspendedLanes&L;break}p.timeoutHandle=cg(tp.bind(null,p,ko,Ol),m);break}tp(p,ko,Ol);break;case 4:if(Pu(p,A),(A&4194240)===A)break;for(m=p.eventTimes,L=-1;0<A;){var ie=31-xs(A);B=1<<ie,ie=m[ie],ie>L&&(L=ie),A&=~B}if(A=L,A=xr()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*Tk(A/1960))-A,10<A){p.timeoutHandle=cg(tp.bind(null,p,ko,Ol),A);break}tp(p,ko,Ol);break;case 5:tp(p,ko,Ol);break;default:throw Error(s(329))}}}return ro(p,xr()),p.callbackNode===T?rv.bind(null,p):null}function iv(p,m){var T=Ag;return p.current.memoizedState.isDehydrated&&(Id(p,m).flags|=256),p=Nl(p,m),p!==2&&(m=ko,ko=T,m!==null&&sv(m)),p}function sv(p){ko===null?ko=p:ko.push.apply(ko,p)}function ov(p){for(var m=p;;){if(m.flags&16384){var T=m.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var A=0;A<T.length;A++){var L=T[A],B=L.getSnapshot;L=L.value;try{if(!Hc(B(),L))return!1}catch{return!1}}}if(T=m.child,m.subtreeFlags&16384&&T!==null)T.return=m,m=T;else{if(m===p)break;for(;m.sibling===null;){if(m.return===null||m.return===p)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Pu(p,m){for(m&=~QE,m&=~JE,p.suspendedLanes|=m,p.pingedLanes&=~m,p=p.expirationTimes;0<m;){var T=31-xs(m),A=1<<T;p[T]=-1,m&=~A}}function ep(p){if((vr&6)!==0)throw Error(s(327));Vf();var m=_l(p,0);if((m&1)===0)return ro(p,xr()),null;var T=Nl(p,m);if(p.tag!==0&&T===2){var A=_o(p);A!==0&&(m=A,T=iv(p,A))}if(T===1)throw T=Us,Id(p,0),Pu(p,m),ro(p,xr()),T;if(T===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=m,tp(p,ko,Ol),ro(p,xr()),null}function Pg(p,m){var T=vr;vr|=1;try{return p(m)}finally{vr=T,vr===0&&(Mf=xr()+500,SE&&vd())}}function Nu(p){Pl!==null&&Pl.tag===0&&(vr&6)===0&&Vf();var m=vr;vr|=1;var T=ac.transition,A=Zn;try{if(ac.transition=null,Zn=1,p)return p()}finally{Zn=A,ac.transition=T,vr=m,(vr&6)===0&&vd()}}function Ng(){Na=Kc.current,_i(Kc)}function Id(p,m){p.finishedWork=null,p.finishedLanes=0;var T=p.timeoutHandle;if(T!==-1&&(p.timeoutHandle=-1,ak(T)),Mi!==null)for(T=Mi.return;T!==null;){var A=T;switch(dg(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&EE();break;case 3:qh(),_i(ea),_i(Zs),hT();break;case 5:If(A);break;case 4:qh();break;case 13:_i(yi);break;case 19:_i(yi);break;case 10:aT(A.type._context);break;case 22:case 23:Ng()}T=T.return}if(Is=p,Mi=p=ku(p.current,null),rs=Na=m,is=0,Us=null,QE=JE=Qh=0,ko=Ag=null,Kh!==null){for(m=0;m<Kh.length;m++)if(T=Kh[m],A=T.interleaved,A!==null){T.interleaved=null;var L=A.next,B=T.pending;if(B!==null){var ie=B.next;B.next=L,A.next=ie}T.pending=A}Kh=null}return p}function FT(p,m){do{var T=Mi;try{if(oT(),PE.current=LE,Af){for(var A=wi.memoizedState;A!==null;){var L=A.queue;L!==null&&(L.pending=null),A=A.next}Af=!1}if(Cl=0,ns=ts=wi=null,vg=!1,yg=0,XE.current=null,T===null||T.return===null){is=1,Us=m,Mi=null;break}e:{var B=p,ie=T.return,ye=T,Ie=m;if(m=rs,ye.flags|=32768,Ie!==null&&typeof Ie=="object"&&typeof Ie.then=="function"){var qe=Ie,yt=ye,Tt=yt.tag;if((yt.mode&1)===0&&(Tt===0||Tt===11||Tt===15)){var vt=yt.alternate;vt?(yt.updateQueue=vt.updateQueue,yt.memoizedState=vt.memoizedState,yt.lanes=vt.lanes):(yt.updateQueue=null,yt.memoizedState=null)}var Vt=dC(ie);if(Vt!==null){Vt.flags&=-257,hC(Vt,ie,ye,B,m),Vt.mode&1&&uC(B,qe,m),m=Vt,Ie=qe;var Kt=m.updateQueue;if(Kt===null){var $t=new Set;$t.add(Ie),m.updateQueue=$t}else Kt.add(Ie);break e}else{if((m&1)===0){uC(B,qe,m),jT();break e}Ie=Error(s(426))}}else if(ti&&ye.mode&1){var Ui=dC(ie);if(Ui!==null){(Ui.flags&65536)===0&&(Ui.flags|=256),hC(Ui,ie,ye,B,m),iT(kf(Ie,ye));break e}}B=Ie=kf(Ie,ye),is!==4&&(is=2),Ag===null?Ag=[B]:Ag.push(B),B=ie;do{switch(B.tag){case 3:B.flags|=65536,m&=-m,B.lanes|=m;var Ge=CT(B,Ie,m);qR(B,Ge);break e;case 1:ye=Ie;var Pe=B.type,He=B.stateNode;if((B.flags&128)===0&&(typeof Pe.getDerivedStateFromError=="function"||He!==null&&typeof He.componentDidCatch=="function"&&(Cd===null||!Cd.has(He)))){B.flags|=65536,m&=-m,B.lanes|=m;var wt=Ou(B,ye,m);qR(B,wt);break e}}B=B.return}while(B!==null)}DC(T)}catch(qt){m=qt,Mi===T&&T!==null&&(Mi=T=T.return);continue}break}while(!0)}function NC(){var p=YE.current;return YE.current=LE,p===null?LE:p}function jT(){(is===0||is===3||is===2)&&(is=4),Is===null||(Qh&268435455)===0&&(JE&268435455)===0||Pu(Is,rs)}function Nl(p,m){var T=vr;vr|=2;var A=NC();(Is!==p||rs!==m)&&(Ol=null,Id(p,m));do try{kC();break}catch(L){FT(p,L)}while(!0);if(oT(),vr=T,YE.current=A,Mi!==null)throw Error(s(261));return Is=null,rs=0,is}function kC(){for(;Mi!==null;)av(Mi)}function bk(){for(;Mi!==null&&!go();)av(Mi)}function av(p){var m=uv(p.alternate,p,Na);p.memoizedProps=p.pendingProps,m===null?DC(p):Mi=m,XE.current=null}function DC(p){var m=p;do{var T=m.alternate;if(p=m.return,(m.flags&32768)===0){if(T=HE(T,m,Na),T!==null){Mi=T;return}}else{if(T=Sk(T,m),T!==null){T.flags&=32767,Mi=T;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{is=6,Mi=null;return}}if(m=m.sibling,m!==null){Mi=m;return}Mi=m=p}while(m!==null);is===0&&(is=5)}function tp(p,m,T){var A=Zn,L=ac.transition;try{ac.transition=null,Zn=1,wk(p,m,T,A)}finally{ac.transition=L,Zn=A}return null}function wk(p,m,T,A){do Vf();while(Pl!==null);if((vr&6)!==0)throw Error(s(327));T=p.finishedWork;var L=p.finishedLanes;if(T===null)return null;if(p.finishedWork=null,p.finishedLanes=0,T===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var B=T.lanes|T.childLanes;if(Fr(p,B),p===Is&&(Mi=Is=null,rs=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Uf||(Uf=!0,kg(Xo,function(){return Vf(),null})),B=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||B){B=ac.transition,ac.transition=null;var ie=Zn;Zn=1;var ye=vr;vr|=4,XE.current=null,NT(p,T),xT(T,p),$S(ag),_e=!!_E,ag=_E=null,p.current=T,xf(T),ld(),vr=ye,Zn=ie,ac.transition=B}else p.current=T;if(Uf&&(Uf=!1,Pl=p,tv=L),B=p.pendingLanes,B===0&&(Cd=null),rf(T.stateNode),ro(p,xr()),m!==null)for(A=p.onRecoverableError,T=0;T<m.length;T++)L=m[T],A(L.value,{componentStack:L.stack,digest:L.digest});if(ev)throw ev=!1,p=UT,UT=null,p;return(tv&1)!==0&&p.tag!==0&&Vf(),B=p.pendingLanes,(B&1)!==0?p===VT?Zh++:(Zh=0,VT=p):Zh=0,vd(),null}function Vf(){if(Pl!==null){var p=Ya(tv),m=ac.transition,T=Zn;try{if(ac.transition=null,Zn=16>p?16:p,Pl===null)var A=!1;else{if(p=Pl,Pl=null,tv=0,(vr&6)!==0)throw Error(s(331));var L=vr;for(vr|=4,Gt=p.current;Gt!==null;){var B=Gt,ie=B.child;if((Gt.flags&16)!==0){var ye=B.deletions;if(ye!==null){for(var Ie=0;Ie<ye.length;Ie++){var qe=ye[Ie];for(Gt=qe;Gt!==null;){var yt=Gt;switch(yt.tag){case 0:case 11:case 15:Rg(8,yt,B)}var Tt=yt.child;if(Tt!==null)Tt.return=yt,Gt=Tt;else for(;Gt!==null;){yt=Gt;var vt=yt.sibling,Vt=yt.return;if(CC(yt),yt===qe){Gt=null;break}if(vt!==null){vt.return=Vt,Gt=vt;break}Gt=Vt}}}var Kt=B.alternate;if(Kt!==null){var $t=Kt.child;if($t!==null){Kt.child=null;do{var Ui=$t.sibling;$t.sibling=null,$t=Ui}while($t!==null)}}Gt=B}}if((B.subtreeFlags&2064)!==0&&ie!==null)ie.return=B,Gt=ie;else e:for(;Gt!==null;){if(B=Gt,(B.flags&2048)!==0)switch(B.tag){case 0:case 11:case 15:Rg(9,B,B.return)}var Ge=B.sibling;if(Ge!==null){Ge.return=B.return,Gt=Ge;break e}Gt=B.return}}var Pe=p.current;for(Gt=Pe;Gt!==null;){ie=Gt;var He=ie.child;if((ie.subtreeFlags&2064)!==0&&He!==null)He.return=ie,Gt=He;else e:for(ie=Pe;Gt!==null;){if(ye=Gt,(ye.flags&2048)!==0)try{switch(ye.tag){case 0:case 11:case 15:Cg(9,ye)}}catch(qt){Ri(ye,ye.return,qt)}if(ye===ie){Gt=null;break e}var wt=ye.sibling;if(wt!==null){wt.return=ye.return,Gt=wt;break e}Gt=ye.return}}if(vr=L,vd(),Qs&&typeof Qs.onPostCommitFiberRoot=="function")try{Qs.onPostCommitFiberRoot(ml,p)}catch{}A=!0}return A}finally{Zn=T,ac.transition=m}}return!1}function cv(p,m,T){m=kf(T,m),m=CT(p,m,1),p=Td(p,m,1),m=Vs(),p!==null&&(El(p,1,m),ro(p,m))}function Ri(p,m,T){if(p.tag===3)cv(p,p,T);else for(;m!==null;){if(m.tag===3){cv(m,p,T);break}else if(m.tag===1){var A=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(Cd===null||!Cd.has(A))){p=kf(T,p),p=Ou(m,p,1),m=Td(m,p,1),p=Vs(),m!==null&&(El(m,1,p),ro(m,p));break}}m=m.return}}function LC(p,m,T){var A=p.pingCache;A!==null&&A.delete(m),m=Vs(),p.pingedLanes|=p.suspendedLanes&T,Is===p&&(rs&T)===T&&(is===4||is===3&&(rs&130023424)===rs&&500>xr()-ZE?Id(p,0):QE|=T),ro(p,m)}function BT(p,m){m===0&&((p.mode&1)===0?m=1:(m=ar,ar<<=1,(ar&130023424)===0&&(ar=4194304)));var T=Vs();p=Cu(p,m),p!==null&&(El(p,m,T),ro(p,T))}function lv(p){var m=p.memoizedState,T=0;m!==null&&(T=m.retryLane),BT(p,T)}function xC(p,m){var T=0;switch(p.tag){case 13:var A=p.stateNode,L=p.memoizedState;L!==null&&(T=L.retryLane);break;case 19:A=p.stateNode;break;default:throw Error(s(314))}A!==null&&A.delete(m),BT(p,T)}var uv;uv=function(p,m,T){if(p!==null)if(p.memoizedProps!==m.pendingProps||ea.current)sa=!0;else{if((p.lanes&T)===0&&(m.flags&128)===0)return sa=!1,SC(p,m,T);sa=(p.flags&131072)!==0}else sa=!1,ti&&(m.flags&1048576)!==0&&bE(m,TE,m.index);switch(m.lanes=0,m.tag){case 2:var A=m.type;GE(p,m),p=m.pendingProps;var L=zh(m,Zs.current);Ru(m,T),L=Of(null,m,A,p,L,T);var B=mT();return m.flags|=1,typeof L=="object"&&L!==null&&typeof L.render=="function"&&L.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,ta(A)?(B=!0,yE(m)):B=!1,m.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,mg(m),L.updater=ME,m.stateNode=L,L._reactInternals=m,bT(m,A,p,T),m=VE(null,m,A,!0,B,T)):(m.tag=0,ti&&B&&wE(m),Po(null,m,L,T),m=m.child),m;case 16:A=m.elementType;e:{switch(GE(p,m),p=m.pendingProps,L=A._init,A=L(A._payload),m.type=A,L=m.tag=np(A),p=Pa(A,p),L){case 0:m=IT(null,m,A,p,T);break e;case 1:m=_C(null,m,A,p,T);break e;case 11:m=UE(null,m,A,p,T);break e;case 14:m=pC(null,m,A,Pa(A.type,p),T);break e}throw Error(s(306,A,""))}return m;case 0:return A=m.type,L=m.pendingProps,L=m.elementType===A?L:Pa(A,L),IT(p,m,A,L,T);case 1:return A=m.type,L=m.pendingProps,L=m.elementType===A?L:Pa(A,L),_C(p,m,A,L,T);case 3:e:{if(AT(m),p===null)throw Error(s(387));A=m.pendingProps,B=m.memoizedState,L=B.element,$R(p,m),OE(m,A,null,T);var ie=m.memoizedState;if(A=ie.element,B.isDehydrated)if(B={element:A,isDehydrated:!1,cache:ie.cache,pendingSuspenseBoundaries:ie.pendingSuspenseBoundaries,transitions:ie.transitions},m.updateQueue.baseState=B,m.memoizedState=B,m.flags&256){L=kf(Error(s(423)),m),m=EC(p,m,A,T,L);break e}else if(A!==L){L=kf(Error(s(424)),m),m=EC(p,m,A,T,L);break e}else for(ra=gd(m.stateNode.containerInfo.firstChild),na=m,ti=!0,Ao=null,T=HR(m,null,A,T),m.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(bf(),A===L){m=Il(p,m,T);break e}Po(p,m,A,T)}m=m.child}return m;case 5:return XR(m),p===null&&rT(m),A=m.type,L=m.pendingProps,B=p!==null?p.memoizedProps:null,ie=L.children,ZS(A,L)?ie=null:B!==null&&ZS(A,B)&&(m.flags|=32),gC(p,m),Po(p,m,ie,T),m.child;case 6:return p===null&&rT(m),null;case 13:return FE(p,m,T);case 4:return uT(m,m.stateNode.containerInfo),A=m.pendingProps,p===null?m.child=wf(m,null,A,T):Po(p,m,A,T),m.child;case 11:return A=m.type,L=m.pendingProps,L=m.elementType===A?L:Pa(A,L),UE(p,m,A,L,T);case 7:return Po(p,m,m.pendingProps,T),m.child;case 8:return Po(p,m,m.pendingProps.children,T),m.child;case 12:return Po(p,m,m.pendingProps.children,T),m.child;case 10:e:{if(A=m.type._context,L=m.pendingProps,B=m.memoizedProps,ie=L.value,di(IE,A._currentValue),A._currentValue=ie,B!==null)if(Hc(B.value,ie)){if(B.children===L.children&&!ea.current){m=Il(p,m,T);break e}}else for(B=m.child,B!==null&&(B.return=m);B!==null;){var ye=B.dependencies;if(ye!==null){ie=B.child;for(var Ie=ye.firstContext;Ie!==null;){if(Ie.context===A){if(B.tag===1){Ie=wl(-1,T&-T),Ie.tag=2;var qe=B.updateQueue;if(qe!==null){qe=qe.shared;var yt=qe.pending;yt===null?Ie.next=Ie:(Ie.next=yt.next,yt.next=Ie),qe.pending=Ie}}B.lanes|=T,Ie=B.alternate,Ie!==null&&(Ie.lanes|=T),cT(B.return,T,m),ye.lanes|=T;break}Ie=Ie.next}}else if(B.tag===10)ie=B.type===m.type?null:B.child;else if(B.tag===18){if(ie=B.return,ie===null)throw Error(s(341));ie.lanes|=T,ye=ie.alternate,ye!==null&&(ye.lanes|=T),cT(ie,T,m),ie=B.sibling}else ie=B.child;if(ie!==null)ie.return=B;else for(ie=B;ie!==null;){if(ie===m){ie=null;break}if(B=ie.sibling,B!==null){B.return=ie.return,ie=B;break}ie=ie.return}B=ie}Po(p,m,L.children,T),m=m.child}return m;case 9:return L=m.type,A=m.pendingProps.children,Ru(m,T),L=ic(L),A=A(L),m.flags|=1,Po(p,m,A,T),m.child;case 14:return A=m.type,L=Pa(A,m.pendingProps),L=Pa(A.type,L),pC(p,m,A,L,T);case 15:return fC(p,m,m.type,m.pendingProps,T);case 17:return A=m.type,L=m.pendingProps,L=m.elementType===A?L:Pa(A,L),GE(p,m),m.tag=1,ta(A)?(p=!0,yE(m)):p=!1,Ru(m,T),cC(m,A,L),bT(m,A,L,T),VE(null,m,A,!0,p,T);case 19:return WE(p,m,T);case 22:return mC(p,m,T)}throw Error(s(156,m.tag))};function kg(p,m){return cd(p,m)}function dv(p,m,T,A){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ka(p,m,T,A){return new dv(p,m,T,A)}function Ad(p){return p=p.prototype,!(!p||!p.isReactComponent)}function np(p){if(typeof p=="function")return Ad(p)?1:0;if(p!=null){if(p=p.$$typeof,p===he)return 11;if(p===pt)return 14}return 2}function ku(p,m){var T=p.alternate;return T===null?(T=ka(p.tag,m,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=m,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&14680064,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,m=p.dependencies,T.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T}function hv(p,m,T,A,L,B){var ie=2;if(A=p,typeof p=="function")Ad(p)&&(ie=1);else if(typeof p=="string")ie=5;else e:switch(p){case Z:return rp(T.children,L,B,m);case ne:ie=8,L|=8;break;case se:return p=ka(12,T,m,L|2),p.elementType=se,p.lanes=B,p;case le:return p=ka(13,T,m,L),p.elementType=le,p.lanes=B,p;case Me:return p=ka(19,T,m,L),p.elementType=Me,p.lanes=B,p;case Oe:return Od(T,L,B,m);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ue:ie=10;break e;case Ee:ie=9;break e;case he:ie=11;break e;case pt:ie=14;break e;case et:ie=16,A=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return m=ka(ie,T,m,L),m.elementType=p,m.type=A,m.lanes=B,m}function rp(p,m,T,A){return p=ka(7,p,A,m),p.lanes=T,p}function Od(p,m,T,A){return p=ka(22,p,A,m),p.elementType=Oe,p.lanes=T,p.stateNode={isHidden:!1},p}function WT(p,m,T){return p=ka(6,p,null,m),p.lanes=T,p}function GT(p,m,T){return m=ka(4,p.children!==null?p.children:[],p.key,m),m.lanes=T,m.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},m}function Rk(p,m,T,A,L){this.tag=m,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bc(0),this.expirationTimes=Bc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bc(0),this.identifierPrefix=A,this.onRecoverableError=L,this.mutableSourceEagerHydrationData=null}function zT(p,m,T,A,L,B,ie,ye,Ie){return p=new Rk(p,m,T,ye,Ie),m===1?(m=1,B===!0&&(m|=8)):m=0,B=ka(3,null,null,m),p.current=B,B.stateNode=p,B.memoizedState={element:A,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},mg(B),p}function Ck(p,m,T){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:be,key:A==null?null:""+A,children:p,containerInfo:m,implementation:T}}function MC(p){if(!p)return Ed;p=p._reactInternals;e:{if(Rs(p)!==p||p.tag!==1)throw Error(s(170));var m=p;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(ta(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(s(171))}if(p.tag===1){var T=p.type;if(ta(T))return vE(p,T,m)}return m}function pv(p,m,T,A,L,B,ie,ye,Ie){return p=zT(T,A,!0,p,L,B,ie,ye,Ie),p.context=MC(null),T=p.current,A=Vs(),L=cc(T),B=wl(A,L),B.callback=m??null,Td(T,B,L),p.current.lanes=L,El(p,L,A),ro(p,A),p}function Dg(p,m,T,A){var L=m.current,B=Vs(),ie=cc(L);return T=MC(T),m.context===null?m.context=T:m.pendingContext=T,m=wl(B,ie),m.payload={element:p},A=A===void 0?null:A,A!==null&&(m.callback=A),p=Td(L,m,ie),p!==null&&(lc(p,L,ie,B),gg(p,L,ie)),ie}function fv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function HT(p,m){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<m?T:m}}function KT(p,m){HT(p,m),(p=p.alternate)&&HT(p,m)}function Lg(){return null}var $c=typeof reportError=="function"?reportError:function(p){console.error(p)};function mv(p){this._internalRoot=p}gv.prototype.render=mv.prototype.render=function(p){var m=this._internalRoot;if(m===null)throw Error(s(409));Dg(p,m,null,null)},gv.prototype.unmount=mv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var m=p.containerInfo;Nu(function(){Dg(null,p,null,null)}),m[ec]=null}};function gv(p){this._internalRoot=p}gv.prototype.unstable_scheduleHydration=function(p){if(p){var m=Nh();p={blockedOn:null,target:p,priority:m};for(var T=0;T<To.length&&m!==0&&m<To[T].priority;T++);To.splice(T,0,p),T===0&&Dh(p)}};function $T(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Ff(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function qT(){}function Ik(p,m,T,A,L){if(L){if(typeof A=="function"){var B=A;A=function(){var qe=fv(ie);B.call(qe)}}var ie=pv(m,A,p,0,null,!1,!1,"",qT);return p._reactRootContainer=ie,p[ec]=ie.current,Fh(p.nodeType===8?p.parentNode:p),Nu(),ie}for(;L=p.lastChild;)p.removeChild(L);if(typeof A=="function"){var ye=A;A=function(){var qe=fv(Ie);ye.call(qe)}}var Ie=zT(p,0,!1,null,null,!1,!1,"",qT);return p._reactRootContainer=Ie,p[ec]=Ie.current,Fh(p.nodeType===8?p.parentNode:p),Nu(function(){Dg(m,Ie,T,A)}),Ie}function ip(p,m,T,A,L){var B=T._reactRootContainer;if(B){var ie=B;if(typeof L=="function"){var ye=L;L=function(){var Ie=fv(ie);ye.call(Ie)}}Dg(m,ie,p,L)}else ie=Ik(T,m,p,L,A);return fv(ie)}sf=function(p){switch(p.tag){case 3:var m=p.stateNode;if(m.current.memoizedState.isDehydrated){var T=gl(m.pendingLanes);T!==0&&(Ra(m,T|1),ro(m,xr()),(vr&6)===0&&(Mf=xr()+500,vd()))}break;case 13:Nu(function(){var A=Cu(p,1);if(A!==null){var L=Vs();lc(A,p,1,L)}}),KT(p,1)}},vl=function(p){if(p.tag===13){var m=Cu(p,134217728);if(m!==null){var T=Vs();lc(m,p,134217728,T)}KT(p,134217728)}},pd=function(p){if(p.tag===13){var m=cc(p),T=Cu(p,m);if(T!==null){var A=Vs();lc(T,p,m,A)}KT(p,m)}},Nh=function(){return Zn},of=function(p,m){var T=Zn;try{return Zn=p,m()}finally{Zn=T}},fl=function(p,m,T){switch(m){case"input":if(Wt(p,T),m=T.name,T.type==="radio"&&m!=null){for(T=p;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<T.length;m++){var A=T[m];if(A!==p&&A.form===p.form){var L=yf(A);if(!L)throw Error(s(90));ln(A),Wt(A,L)}}}break;case"textarea":Ut(p,T);break;case"select":m=T.value,m!=null&&ut(p,!!T.multiple,m,!1)}},cu=Pg,Ka=Nu;var Pd={usingClientEntryPoint:!1,Events:[vf,Wh,yf,Ha,Uc,Pg]},Du={findFiberByHostInstance:Bh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ak={bundleType:Du.bundleType,version:Du.version,rendererPackageName:Du.rendererPackageName,rendererConfig:Du.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:fe.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=ad(p),p===null?null:p.stateNode},findFiberByHostInstance:Du.findFiberByHostInstance||Lg,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _v=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_v.isDisabled&&_v.supportsFiber)try{ml=_v.inject(Ak),Qs=_v}catch{}}return bc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pd,bc.createPortal=function(p,m){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$T(m))throw Error(s(200));return Ck(p,m,null,T)},bc.createRoot=function(p,m){if(!$T(p))throw Error(s(299));var T=!1,A="",L=$c;return m!=null&&(m.unstable_strictMode===!0&&(T=!0),m.identifierPrefix!==void 0&&(A=m.identifierPrefix),m.onRecoverableError!==void 0&&(L=m.onRecoverableError)),m=zT(p,1,!1,null,null,T,!1,A,L),p[ec]=m.current,Fh(p.nodeType===8?p.parentNode:p),new mv(m)},bc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var m=p._reactInternals;if(m===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=ad(m),p=p===null?null:p.stateNode,p},bc.flushSync=function(p){return Nu(p)},bc.hydrate=function(p,m,T){if(!Ff(m))throw Error(s(200));return ip(null,p,m,!0,T)},bc.hydrateRoot=function(p,m,T){if(!$T(p))throw Error(s(405));var A=T!=null&&T.hydratedSources||null,L=!1,B="",ie=$c;if(T!=null&&(T.unstable_strictMode===!0&&(L=!0),T.identifierPrefix!==void 0&&(B=T.identifierPrefix),T.onRecoverableError!==void 0&&(ie=T.onRecoverableError)),m=pv(m,null,p,1,T??null,L,!1,B,ie),p[ec]=m.current,Fh(p),A)for(p=0;p<A.length;p++)T=A[p],L=T._getVersion,L=L(T._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[T,L]:m.mutableSourceEagerHydrationData.push(T,L);return new gv(m)},bc.render=function(p,m,T){if(!Ff(m))throw Error(s(200));return ip(null,p,m,!1,T)},bc.unmountComponentAtNode=function(p){if(!Ff(p))throw Error(s(40));return p._reactRootContainer?(Nu(function(){ip(null,null,p,!1,function(){p._reactRootContainer=null,p[ec]=null})}),!0):!1},bc.unstable_batchedUpdates=Pg,bc.unstable_renderSubtreeIntoContainer=function(p,m,T,A){if(!Ff(T))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return ip(p,m,T,!1,A)},bc.version="18.3.1-next-f1338f8080-20240426",bc}var q9;function sX(){if(q9)return Sx.exports;q9=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Sx.exports=Ome(),Sx.exports}var Y9;function Pme(){if(Y9)return tO;Y9=1;var r=sX();return tO.createRoot=r.createRoot,tO.hydrateRoot=r.hydrateRoot,tO}var Nme=Pme();const kme=OS(Nme);function Dme(r,t,s,a){return r.addEventListener(t,s,a),()=>{r.removeEventListener(t,s,a)}}function YP(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}function Lme(){return!!(globalThis!=null&&globalThis.document)}function oX(r){return r.parentElement&&oX(r.parentElement)?!0:r.hidden}function xme(r){const t=r.getAttribute("contenteditable");return t!=="false"&&t!=null}function Mme(r){return!!r.getAttribute("disabled")||!!r.getAttribute("aria-disabled")}function Ume(r){var t;return((t=aX(r))==null?void 0:t.defaultView)??window}function aX(r){return YP(r)?r.ownerDocument:document}function Vme(r){return r.view??window}function Fme(r){return aX(r).activeElement}function jme(r){const t=Vme(r);return typeof t.PointerEvent<"u"&&r instanceof t.PointerEvent?r.pointerType==="mouse":r instanceof t.MouseEvent}function cX(r){return!!r.touches}function Bme(r){return cX(r)&&r.touches.length>1}function Wme(r,t="page"){const s=r.touches[0]||r.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function Gme(r,t="page"){return{x:r[`${t}X`],y:r[`${t}Y`]}}function lX(r,t="page"){return cX(r)?Wme(r,t):Gme(r,t)}function zme(r){return t=>{const s=jme(t);(!s||s&&t.button===0)&&r(t)}}function Hme(r,t=!1){function s(l){r(l,{point:lX(l)})}return t?zme(s):s}function NO(r,t,s,a){return Dme(r,t,Hme(s,t==="pointerdown"),a)}function Kme(r,...t){if(r==null)throw new TypeError("Cannot convert undefined or null to object");const s={...r};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const Gn=r=>r?"":void 0,Ky=r=>r?!0:void 0;function $me(r){return Array.isArray(r)}function nu(r){const t=typeof r;return r!=null&&(t==="object"||t==="function")&&!$me(r)}function qme(r){const t=r==null?0:r.length;return t?r[t-1]:void 0}function Yme(r){const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function BM(r){if(r==null)return r;const{unitless:t}=Yme(r);return t||typeof r=="number"?`${r}px`:r}const uX=(r,t)=>parseInt(r[1],10)>parseInt(t[1],10)?1:-1,_U=r=>Object.fromEntries(Object.entries(r).sort(uX));function X9(r){const t=_U(r);return Object.assign(Object.values(t),t)}function Xme(r){const t=Object.keys(_U(r));return new Set(t)}function J9(r){if(!r)return r;r=BM(r)??r;const t=-.02;return typeof r=="number"?`${r+t}`:r.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function Cb(r,t){const s=["@media screen"];return r&&s.push("and",`(min-width: ${BM(r)})`),t&&s.push("and",`(max-width: ${BM(t)})`),s.join(" ")}function Jme(r){if(!r)return null;r.base=r.base??"0px";const t=X9(r),s=Object.entries(r).sort(uX).map(([d,g],E,S)=>{let[,b]=S[E+1]??[];return b=parseFloat(b)>0?J9(b):void 0,{_minW:J9(g),breakpoint:d,minW:g,maxW:b,maxWQuery:Cb(null,b),minWQuery:Cb(g),minMaxQuery:Cb(g,b)}}),a=Xme(r),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const g=Object.keys(d);return g.length>0&&g.every(E=>a.has(E))},asObject:_U(r),asArray:X9(r),details:s,get(d){return s.find(g=>g.breakpoint===d)},media:[null,...t.map(d=>Cb(d)).slice(1)],toArrayValue(d){if(!nu(d))throw new Error("toArrayValue: value must be an object");const g=l.map(E=>d[E]??null);for(;qme(g)===null;)g.pop();return g},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((g,E,S)=>{const b=l[S];return b!=null&&E!=null&&(g[b]=E),g},{})}}}function dX(...r){return function(...s){r.forEach(a=>a==null?void 0:a(...s))}}function qn(...r){return function(s){r.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function EU(r){return j.Children.toArray(r).filter(t=>j.isValidElement(t))}function XP(r){const t=Object.assign({},r);for(let s in t)t[s]===void 0&&delete t[s];return t}function Qme(r,t){return`${r} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Li(r={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:g}=r,E=j.createContext(g);E.displayName=t;function S(){var C;const b=j.useContext(E);if(!b&&s){const O=new Error(d??Qme(a,l));throw O.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,O,S),O}return b}return[E.Provider,S,E]}const An=(...r)=>r.filter(Boolean).join(" "),hX=r=>r.hasAttribute("tabindex"),Zme=r=>hX(r)&&r.tabIndex===-1;function dP(r){if(!YP(r)||oX(r)||Mme(r))return!1;const{localName:t}=r;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>r.hasAttribute("href"),audio:()=>r.hasAttribute("controls"),video:()=>r.hasAttribute("controls")};return t in a?a[t]():xme(r)?!0:hX(r)}function ege(r){return r?YP(r)&&dP(r)&&!Zme(r):!1}const tge=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],nge=tge.join(),rge=r=>r.offsetWidth>0&&r.offsetHeight>0;function pX(r){const t=Array.from(r.querySelectorAll(nge));return t.unshift(r),t.filter(s=>dP(s)&&rge(s))}function ige(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}const sge=r=>{const t=new WeakMap;return(a,l,d,g)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const S=r(a,l,d,g);return E.set(l,S),S}},fX=sge(ige),oge=r=>r.default||r;function vU(r){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=r;return!!(!s||a||l==="keepMounted"&&t)}function age(r){const t=parseFloat(r);return typeof t!="number"||Number.isNaN(t)?0:t}function cge(r,t){let s=age(r);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function lge(r){if(!Number.isFinite(r))return 0;let t=1,s=0;for(;Math.round(r*t)/t!==r;)t*=10,s+=1;return s}function Q9(r,t,s){return(r-t)*100/(s-t)}function uge(r,t,s){return(s-t)*r+t}function Z9(r,t,s){const a=Math.round((r-t)/s)*s+t,l=lge(s);return cge(a,l)}function wx(r,t,s){return r==null?r:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(r,t),s))}function Fw(r,t=[]){const s=Object.assign({},r);for(const a of t)a in s&&delete s[a];return s}function mX(r,t){const s={};for(const a of t)a in r&&(s[a]=r[a]);return s}function yU(r,t){return Array.isArray(r)?r.map(s=>s===null?null:t(s)):nu(r)?Object.keys(r).reduce((s,a)=>(s[a]=t(r[a]),s),{}):r!=null?t(r):null}const dge=r=>typeof r=="function";function Oc(r,...t){return dge(r)?r(...t):r}function hge(r){const t=r.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(r);return/auto|scroll|overlay|hidden/.test(s+l+a)}function pge(r){return r.localName==="html"?r:r.assignedSlot||r.parentElement||r.ownerDocument.documentElement}function gX(r){return["html","body","#document"].includes(r.localName)?r.ownerDocument.body:YP(r)&&hge(r)?r:gX(pge(r))}function fge(r,t){const s={},a={};for(const[l,d]of Object.entries(r))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function mge(r,...t){const s=Object.getOwnPropertyDescriptors(r),a=Object.keys(s),l=g=>{const E={};for(let S=0;S<g.length;S++){const b=g[S];s[b]&&(Object.defineProperty(E,b,s[b]),delete s[b])}return E},d=g=>l(Array.isArray(g)?g:a.filter(g));return t.map(d).concat(l(a))}function eK(r,t,s={}){const{stop:a,getKey:l}=s;function d(g,E=[]){if(nu(g)||Array.isArray(g)){const S={};for(const[b,C]of Object.entries(g)){const O=(l==null?void 0:l(b))??b,k=[...E,O];if(a!=null&&a(g,k))return t(g,E);S[O]=d(C,k)}return S}return t(g,E)}return d(r)}var Ib={exports:{}};Ib.exports;var tK;function gge(){return tK||(tK=1,function(r,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,g=9007199254740991,E="[object Arguments]",S="[object Array]",b="[object AsyncFunction]",C="[object Boolean]",O="[object Date]",k="[object Error]",W="[object Function]",H="[object GeneratorFunction]",K="[object Map]",G="[object Number]",te="[object Null]",J="[object Object]",re="[object Proxy]",fe="[object RegExp]",oe="[object Set]",be="[object String]",Z="[object Undefined]",ne="[object WeakMap]",se="[object ArrayBuffer]",ue="[object DataView]",Ee="[object Float32Array]",he="[object Float64Array]",le="[object Int8Array]",Me="[object Int16Array]",pt="[object Int32Array]",et="[object Uint8Array]",Oe="[object Uint8ClampedArray]",Ue="[object Uint16Array]",xe="[object Uint32Array]",it=/[\\^$.*+?()[\]{}|]/g,Ae=/^\[object .+?Constructor\]$/,$e=/^(?:0|[1-9]\d*)$/,Ze={};Ze[Ee]=Ze[he]=Ze[le]=Ze[Me]=Ze[pt]=Ze[et]=Ze[Oe]=Ze[Ue]=Ze[xe]=!0,Ze[E]=Ze[S]=Ze[se]=Ze[C]=Ze[ue]=Ze[O]=Ze[k]=Ze[W]=Ze[K]=Ze[G]=Ze[J]=Ze[fe]=Ze[oe]=Ze[be]=Ze[ne]=!1;var Fe=typeof C_=="object"&&C_&&C_.Object===Object&&C_,ct=typeof self=="object"&&self&&self.Object===Object&&self,_t=Fe||ct||Function("return this")(),Pt=t&&!t.nodeType&&t,Ht=Pt&&!0&&r&&!r.nodeType&&r,xt=Ht&&Ht.exports===Pt,fn=xt&&Fe.process,Rn=function(){try{var _e=Ht&&Ht.require&&Ht.require("util").types;return _e||fn&&fn.binding&&fn.binding("util")}catch{}}(),ln=Rn&&Rn.isTypedArray;function Hn(_e,Re,Ke){switch(Ke.length){case 0:return _e.call(Re);case 1:return _e.call(Re,Ke[0]);case 2:return _e.call(Re,Ke[0],Ke[1]);case 3:return _e.call(Re,Ke[0],Ke[1],Ke[2])}return _e.apply(Re,Ke)}function Ar(_e,Re){for(var Ke=-1,jt=Array(_e);++Ke<_e;)jt[Ke]=Re(Ke);return jt}function Xt(_e){return function(Re){return _e(Re)}}function Qn(_e,Re){return _e==null?void 0:_e[Re]}function Wt(_e,Re){return function(Ke){return _e(Re(Ke))}}var ve=Array.prototype,Ne=Function.prototype,We=Object.prototype,ut=_t["__core-js_shared__"],ft=Ne.toString,mt=We.hasOwnProperty,Ut=function(){var _e=/[^.]+$/.exec(ut&&ut.keys&&ut.keys.IE_PROTO||"");return _e?"Symbol(src)_1."+_e:""}(),pn=We.toString,Nn=ft.call(Object),tn=RegExp("^"+ft.call(mt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ur=xt?_t.Buffer:void 0,Ga=_t.Symbol,Nt=_t.Uint8Array;ur&&ur.allocUnsafe;var Zt=Wt(Object.getPrototypeOf,Object),Wi=Object.create,bs=We.propertyIsEnumerable,Ls=ve.splice,ci=Ga?Ga.toStringTag:void 0,Sa=function(){try{var _e=wa(Object,"defineProperty");return _e({},"",{}),_e}catch{}}(),Mc=ur?ur.isBuffer:void 0,Xs=Math.max,Js=Date.now,fl=wa(_t,"Map"),ws=wa(Object,"create"),za=function(){function _e(){}return function(Re){if(!Xa(Re))return{};if(Wi)return Wi(Re);_e.prototype=Re;var Ke=new _e;return _e.prototype=void 0,Ke}}();function Ko(_e){var Re=-1,Ke=_e==null?0:_e.length;for(this.clear();++Re<Ke;){var jt=_e[Re];this.set(jt[0],jt[1])}}function Ha(){this.__data__=ws?ws(null):{},this.size=0}function Uc(_e){var Re=this.has(_e)&&delete this.__data__[_e];return this.size-=Re?1:0,Re}function cu(_e){var Re=this.__data__;if(ws){var Ke=Re[_e];return Ke===a?void 0:Ke}return mt.call(Re,_e)?Re[_e]:void 0}function Ka(_e){var Re=this.__data__;return ws?Re[_e]!==void 0:mt.call(Re,_e)}function Vc(_e,Re){var Ke=this.__data__;return this.size+=this.has(_e)?0:1,Ke[_e]=ws&&Re===void 0?a:Re,this}Ko.prototype.clear=Ha,Ko.prototype.delete=Uc,Ko.prototype.get=cu,Ko.prototype.has=Ka,Ko.prototype.set=Vc;function mo(_e){var Re=-1,Ke=_e==null?0:_e.length;for(this.clear();++Re<Ke;){var jt=_e[Re];this.set(jt[0],jt[1])}}function bi(){this.__data__=[],this.size=0}function Qi(_e){var Re=this.__data__,Ke=ld(Re,_e);if(Ke<0)return!1;var jt=Re.length-1;return Ke==jt?Re.pop():Ls.call(Re,Ke,1),--this.size,!0}function Ta(_e){var Re=this.__data__,Ke=ld(Re,_e);return Ke<0?void 0:Re[Ke][1]}function lu(_e){return ld(this.__data__,_e)>-1}function $a(_e,Re){var Ke=this.__data__,jt=ld(Ke,_e);return jt<0?(++this.size,Ke.push([_e,Re])):Ke[jt][1]=Re,this}mo.prototype.clear=bi,mo.prototype.delete=Qi,mo.prototype.get=Ta,mo.prototype.has=lu,mo.prototype.set=$a;function $o(_e){var Re=-1,Ke=_e==null?0:_e.length;for(this.clear();++Re<Ke;){var jt=_e[Re];this.set(jt[0],jt[1])}}function qo(){this.size=0,this.__data__={hash:new Ko,map:new(fl||mo),string:new Ko}}function sd(_e){var Re=pu(this,_e).delete(_e);return this.size-=Re?1:0,Re}function Xm(_e){return pu(this,_e).get(_e)}function uu(_e){return pu(this,_e).has(_e)}function Ah(_e,Re){var Ke=pu(this,_e),jt=Ke.size;return Ke.set(_e,Re),this.size+=Ke.size==jt?0:1,this}$o.prototype.clear=qo,$o.prototype.delete=sd,$o.prototype.get=Xm,$o.prototype.has=uu,$o.prototype.set=Ah;function Rs(_e){var Re=this.__data__=new mo(_e);this.size=Re.size}function du(){this.__data__=new mo,this.size=0}function Yo(_e){var Re=this.__data__,Ke=Re.delete(_e);return this.size=Re.size,Ke}function od(_e){return this.__data__.get(_e)}function ad(_e){return this.__data__.has(_e)}function ba(_e,Re){var Ke=this.__data__;if(Ke instanceof mo){var jt=Ke.__data__;if(!fl||jt.length<s-1)return jt.push([_e,Re]),this.size=++Ke.size,this;Ke=this.__data__=new $o(jt)}return Ke.set(_e,Re),this.size=Ke.size,this}Rs.prototype.clear=du,Rs.prototype.delete=Yo,Rs.prototype.get=od,Rs.prototype.has=ad,Rs.prototype.set=ba;function cd(_e,Re){var Ke=vo(_e),jt=!Ke&&Gi(_e),Bn=!Ke&&!jt&&So(_e),pr=!Ke&&!jt&&!Bn&&Dh(_e),Mr=Ke||jt||Bn||pr,en=Mr?Ar(_e.length,String):[],Or=en.length;for(var ui in _e)Mr&&(ui=="length"||Bn&&(ui=="offset"||ui=="parent")||pr&&(ui=="buffer"||ui=="byteLength"||ui=="byteOffset")||Bc(ui,Or))||en.push(ui);return en}function hu(_e,Re,Ke){(Ke!==void 0&&!Eo(_e[Re],Ke)||Ke===void 0&&!(Re in _e))&&xr(_e,Re,Ke)}function go(_e,Re,Ke){var jt=_e[Re];(!(mt.call(_e,Re)&&Eo(jt,Ke))||Ke===void 0&&!(Re in _e))&&xr(_e,Re,Ke)}function ld(_e,Re){for(var Ke=_e.length;Ke--;)if(Eo(_e[Ke][0],Re))return Ke;return-1}function xr(_e,Re,Ke){Re=="__proto__"&&Sa?Sa(_e,Re,{configurable:!0,enumerable:!0,value:Ke,writable:!0}):_e[Re]=Ke}var li=_l();function qa(_e){return _e==null?_e===void 0?Z:te:ci&&ci in Object(_e)?_o(_e):sf(_e)}function Fc(_e){return Zi(_e)&&qa(_e)==E}function Xo(_e){if(!Xa(_e)||Ra(_e))return!1;var Re=To(_e)?tn:Ae;return Re.test(kh(_e))}function Oh(_e){return Zi(_e)&&af(_e.length)&&!!Ze[qa(_e)]}function ud(_e){if(!Xa(_e))return Ya(_e);var Re=Zn(_e),Ke=[];for(var jt in _e)jt=="constructor"&&(Re||!mt.call(_e,jt))||Ke.push(jt);return Ke}function ml(_e,Re,Ke,jt,Bn){_e!==Re&&li(Re,function(pr,Mr){if(Bn||(Bn=new Rs),Xa(pr))Qs(_e,Re,Mr,Ke,ml,jt,Bn);else{var en=jt?jt(pd(_e,Mr),pr,Mr+"",_e,Re,Bn):void 0;en===void 0&&(en=pr),hu(_e,Mr,en)}},Sl)}function Qs(_e,Re,Ke,jt,Bn,pr,Mr){var en=pd(_e,Ke),Or=pd(Re,Ke),ui=Mr.get(Or);if(ui){hu(_e,Ke,ui);return}var fs=pr?pr(en,Or,Ke+"",_e,Re,Mr):void 0,bo=fs===void 0;if(bo){var wo=vo(Or),gu=!wo&&So(Or),xi=!wo&&!gu&&Dh(Or);fs=Or,wo||gu||xi?vo(en)?fs=en:yl(en)?fs=hd(en):gu?(bo=!1,fs=Ph(Or)):xi?(bo=!1,fs=dd(Or)):fs=[]:mu(Or)||Gi(Or)?(fs=en,Gi(en)?fs=Wc(en):(!Xa(en)||To(en))&&(fs=fu(Or))):bo=!1}bo&&(Mr.set(Or,fs),Bn(fs,Or,jt,pr,Mr),Mr.delete(Or)),hu(_e,Ke,fs)}function rf(_e,Re){return Nh(vl(_e,Re,Qo),_e+"")}var xs=Sa?function(_e,Re){return Sa(_e,"toString",{configurable:!0,enumerable:!1,value:Jo(Re),writable:!0})}:Qo;function Ph(_e,Re){return _e.slice()}function jc(_e){var Re=new _e.constructor(_e.byteLength);return new Nt(Re).set(new Nt(_e)),Re}function dd(_e,Re){var Ke=jc(_e.buffer);return new _e.constructor(Ke,_e.byteOffset,_e.length)}function hd(_e,Re){var Ke=-1,jt=_e.length;for(Re||(Re=Array(jt));++Ke<jt;)Re[Ke]=_e[Ke];return Re}function ar(_e,Re,Ke,jt){var Bn=!Ke;Ke||(Ke={});for(var pr=-1,Mr=Re.length;++pr<Mr;){var en=Re[pr],Or=void 0;Or===void 0&&(Or=_e[en]),Bn?xr(Ke,en,Or):go(Ke,en,Or)}return Ke}function gl(_e){return rf(function(Re,Ke){var jt=-1,Bn=Ke.length,pr=Bn>1?Ke[Bn-1]:void 0,Mr=Bn>2?Ke[2]:void 0;for(pr=_e.length>3&&typeof pr=="function"?(Bn--,pr):void 0,Mr&&El(Ke[0],Ke[1],Mr)&&(pr=Bn<3?void 0:pr,Bn=1),Re=Object(Re);++jt<Bn;){var en=Ke[jt];en&&_e(Re,en,jt,pr)}return Re})}function _l(_e){return function(Re,Ke,jt){for(var Bn=-1,pr=Object(Re),Mr=jt(Re),en=Mr.length;en--;){var Or=Mr[++Bn];if(Ke(pr[Or],Or,pr)===!1)break}return Re}}function pu(_e,Re){var Ke=_e.__data__;return Fr(Re)?Ke[typeof Re=="string"?"string":"hash"]:Ke.map}function wa(_e,Re){var Ke=Qn(_e,Re);return Xo(Ke)?Ke:void 0}function _o(_e){var Re=mt.call(_e,ci),Ke=_e[ci];try{_e[ci]=void 0;var jt=!0}catch{}var Bn=pn.call(_e);return jt&&(Re?_e[ci]=Ke:delete _e[ci]),Bn}function fu(_e){return typeof _e.constructor=="function"&&!Zn(_e)?za(Zt(_e)):{}}function Bc(_e,Re){var Ke=typeof _e;return Re=Re??g,!!Re&&(Ke=="number"||Ke!="symbol"&&$e.test(_e))&&_e>-1&&_e%1==0&&_e<Re}function El(_e,Re,Ke){if(!Xa(Ke))return!1;var jt=typeof Re;return(jt=="number"?yo(Ke)&&Bc(Re,Ke.length):jt=="string"&&Re in Ke)?Eo(Ke[Re],_e):!1}function Fr(_e){var Re=typeof _e;return Re=="string"||Re=="number"||Re=="symbol"||Re=="boolean"?_e!=="__proto__":_e===null}function Ra(_e){return!!Ut&&Ut in _e}function Zn(_e){var Re=_e&&_e.constructor,Ke=typeof Re=="function"&&Re.prototype||We;return _e===Ke}function Ya(_e){var Re=[];if(_e!=null)for(var Ke in Object(_e))Re.push(Ke);return Re}function sf(_e){return pn.call(_e)}function vl(_e,Re,Ke){return Re=Xs(Re===void 0?_e.length-1:Re,0),function(){for(var jt=arguments,Bn=-1,pr=Xs(jt.length-Re,0),Mr=Array(pr);++Bn<pr;)Mr[Bn]=jt[Re+Bn];Bn=-1;for(var en=Array(Re+1);++Bn<Re;)en[Bn]=jt[Bn];return en[Re]=Ke(Mr),Hn(_e,this,en)}}function pd(_e,Re){if(!(Re==="constructor"&&typeof _e[Re]=="function")&&Re!="__proto__")return _e[Re]}var Nh=of(xs);function of(_e){var Re=0,Ke=0;return function(){var jt=Js(),Bn=d-(jt-Ke);if(Ke=jt,Bn>0){if(++Re>=l)return arguments[0]}else Re=0;return _e.apply(void 0,arguments)}}function kh(_e){if(_e!=null){try{return ft.call(_e)}catch{}try{return _e+""}catch{}}return""}function Eo(_e,Re){return _e===Re||_e!==_e&&Re!==Re}var Gi=Fc(function(){return arguments}())?Fc:function(_e){return Zi(_e)&&mt.call(_e,"callee")&&!bs.call(_e,"callee")},vo=Array.isArray;function yo(_e){return _e!=null&&af(_e.length)&&!To(_e)}function yl(_e){return Zi(_e)&&yo(_e)}var So=Mc||Gc;function To(_e){if(!Xa(_e))return!1;var Re=qa(_e);return Re==W||Re==H||Re==b||Re==re}function af(_e){return typeof _e=="number"&&_e>-1&&_e%1==0&&_e<=g}function Xa(_e){var Re=typeof _e;return _e!=null&&(Re=="object"||Re=="function")}function Zi(_e){return _e!=null&&typeof _e=="object"}function mu(_e){if(!Zi(_e)||qa(_e)!=J)return!1;var Re=Zt(_e);if(Re===null)return!0;var Ke=mt.call(Re,"constructor")&&Re.constructor;return typeof Ke=="function"&&Ke instanceof Ke&&ft.call(Ke)==Nn}var Dh=ln?Xt(ln):Oh;function Wc(_e){return ar(_e,Sl(_e))}function Sl(_e){return yo(_e)?cd(_e):ud(_e)}var cf=gl(function(_e,Re,Ke,jt){ml(_e,Re,Ke,jt)});function Jo(_e){return function(){return _e}}function Qo(_e){return _e}function Gc(){return!1}r.exports=cf}(Ib,Ib.exports)),Ib.exports}var _ge=gge();const lh=OS(_ge);function Pc(r,t=[]){const s=j.useRef(r);return j.useEffect(()=>{s.current=r}),j.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function $y(r,t,s,a){const l=Pc(s);return j.useEffect(()=>{const d=typeof r=="function"?r():r??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,r,a,l,s]),()=>{const d=typeof r=="function"?r():r??document;d==null||d.removeEventListener(t,l,a)}}function _X(r){const{isOpen:t,ref:s}=r,[a,l]=j.useState(t),[d,g]=j.useState(!1);return j.useEffect(()=>{d||(l(t),g(!0))},[t,d,a]),$y(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var C;const S=Ume(s.current),b=new S.CustomEvent("animationend",{bubbles:!0});(C=s.current)==null||C.dispatchEvent(b)}}}function EX(r){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(k,W)=>k!==W}=r,d=Pc(a),g=Pc(l),[E,S]=j.useState(s),b=t!==void 0,C=b?t:E,O=Pc(k=>{const H=typeof k=="function"?k(C):k;g(C,H)&&(b||S(H),d(H))},[b,d,C,g]);return[C,O]}function jw(r={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=r,d=Pc(s),g=Pc(t),[E,S]=j.useState(r.defaultIsOpen||!1),b=a!==void 0?a:E,C=a!==void 0,O=j.useId(),k=l??`disclosure-${O}`,W=j.useCallback(()=>{C||S(!1),g==null||g()},[C,g]),H=j.useCallback(()=>{C||S(!0),d==null||d()},[C,d]),K=j.useCallback(()=>{b?W():H()},[b,H,W]);function G(J={}){return{...J,"aria-expanded":b,"aria-controls":k,onClick(re){var fe;(fe=J.onClick)==null||fe.call(J,re),K()}}}function te(J={}){return{...J,hidden:!b,id:k}}return{isOpen:b,onOpen:H,onClose:W,onToggle:K,isControlled:C,getButtonProps:G,getDisclosureProps:te}}const wm=globalThis!=null&&globalThis.document?j.useLayoutEffect:j.useEffect,Pm=(r,t)=>{const s=j.useRef(!1),a=j.useRef(!1);j.useEffect(()=>{if(s.current&&a.current)return r();a.current=!0},t),j.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function Ege(r){const t=r.current;if(!t)return!1;const s=Fme(t);return!s||t.contains(s)?!1:!!ege(s)}function vX(r,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;Pm(()=>{if(!d||Ege(r))return;const g=(l==null?void 0:l.current)||r.current;let E;if(g)return E=requestAnimationFrame(()=>{g.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,r,l])}const vge={preventScroll:!0,shouldFocus:!1};function yge(r,t=vge){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,g=Sge(r)?r.current:r,E=l&&d,S=j.useRef(E),b=j.useRef(d);wm(()=>{!b.current&&d&&(S.current=E),b.current=d},[d,E]);const C=j.useCallback(()=>{if(!(!d||!g||!S.current)&&(S.current=!1,!g.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var O;(O=s.current)==null||O.focus({preventScroll:a})});else{const O=pX(g);O.length>0&&requestAnimationFrame(()=>{O[0].focus({preventScroll:a})})}},[d,a,g,s]);Pm(()=>{C()},[C]),$y(g,"transitionend",C)}function Sge(r){return"current"in r}function Tge(r){return"current"in r}const yX=()=>typeof window<"u";function bge(){const r=navigator.userAgentData;return(r==null?void 0:r.platform)??navigator.platform}const wge=r=>yX()&&r.test(navigator.vendor),Rge=r=>yX()&&r.test(bge()),Cge=()=>Rge(/mac|iphone|ipad|ipod/i),Ige=()=>Cge()&&wge(/apple/i);function Age(r){const{ref:t,elements:s,enabled:a}=r,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};$y(l,"pointerdown",d=>{var b,C;if(!Ige()||!a)return;const g=((C=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:C[0])??d.target,S=(s??[t]).some(O=>{const k=Tge(O)?O.current:O;return(k==null?void 0:k.contains(g))||k===g});l().activeElement!==g&&S&&(d.preventDefault(),g.focus())})}function Oge(r,t){const s=j.useId();return j.useMemo(()=>r||[t,s].filter(Boolean).join("-"),[r,t,s])}function Pge(r,...t){const s=Oge(r);return j.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function SX(r){const t=j.useRef(null);return t.current=r,t}function Nge(r,t){if(r!=null){if(typeof r=="function"){r(t);return}try{r.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${r}'`)}}}function qi(...r){return t=>{r.forEach(s=>{Nge(s,t)})}}function kge(...r){return j.useMemo(()=>qi(...r),r)}function TX(r){const{ref:t,handler:s,enabled:a=!0}=r,l=Pc(s),g=j.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;j.useEffect(()=>{if(!a)return;const E=O=>{Rx(O,t)&&(g.isPointerDown=!0)},S=O=>{if(g.ignoreEmulatedMouseEvents){g.ignoreEmulatedMouseEvents=!1;return}g.isPointerDown&&s&&Rx(O,t)&&(g.isPointerDown=!1,l(O))},b=O=>{g.ignoreEmulatedMouseEvents=!0,s&&g.isPointerDown&&Rx(O,t)&&(g.isPointerDown=!1,l(O))},C=bX(t.current);return C.addEventListener("mousedown",E,!0),C.addEventListener("mouseup",S,!0),C.addEventListener("touchstart",E,!0),C.addEventListener("touchend",b,!0),()=>{C.removeEventListener("mousedown",E,!0),C.removeEventListener("mouseup",S,!0),C.removeEventListener("touchstart",E,!0),C.removeEventListener("touchend",b,!0)}},[s,t,l,g,a])}function Rx(r,t){var a,l;const s=((a=r.composedPath)==null?void 0:a.call(r)[0])??r.target;return s&&!bX(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function bX(r){return(r==null?void 0:r.ownerDocument)??document}function Dge(r,t){const s=Pc(r);j.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const wX=1/60*1e3,Lge=typeof performance<"u"?()=>performance.now():()=>Date.now(),RX=typeof window<"u"?r=>window.requestAnimationFrame(r):r=>setTimeout(()=>r(Lge()),wX);function xge(r){let t=[],s=[],a=0,l=!1,d=!1;const g=new WeakSet,E={schedule:(S,b=!1,C=!1)=>{const O=C&&l,k=O?t:s;return b&&g.add(S),k.indexOf(S)===-1&&(k.push(S),O&&l&&(a=t.length)),S},cancel:S=>{const b=s.indexOf(S);b!==-1&&s.splice(b,1),g.delete(S)},process:S=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let b=0;b<a;b++){const C=t[b];C(S),g.has(C)&&(E.schedule(C),r())}l=!1,d&&(d=!1,E.process(S))}};return E}const Mge=40;let WM=!0,uw=!1,GM=!1;const qy={delta:0,timestamp:0},Bw=["read","update","preRender","render","postRender"],JP=Bw.reduce((r,t)=>(r[t]=xge(()=>uw=!0),r),{}),Uge=Bw.reduce((r,t)=>{const s=JP[t];return r[t]=(a,l=!1,d=!1)=>(uw||jge(),s.schedule(a,l,d)),r},{}),Vge=Bw.reduce((r,t)=>(r[t]=JP[t].cancel,r),{});Bw.reduce((r,t)=>(r[t]=()=>JP[t].process(qy),r),{});const Fge=r=>JP[r].process(qy),CX=r=>{uw=!1,qy.delta=WM?wX:Math.max(Math.min(r-qy.timestamp,Mge),1),qy.timestamp=r,GM=!0,Bw.forEach(Fge),GM=!1,uw&&(WM=!1,RX(CX))},jge=()=>{uw=!0,WM=!0,GM||RX(CX)},nK=()=>qy;var Bge=Object.defineProperty,Wge=(r,t,s)=>t in r?Bge(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Xu=(r,t,s)=>(Wge(r,typeof t!="symbol"?t+"":t,s),s);class Gge{constructor(t,s,a){if(Xu(this,"history",[]),Xu(this,"startEvent",null),Xu(this,"lastEvent",null),Xu(this,"lastEventInfo",null),Xu(this,"handlers",{}),Xu(this,"removeListeners",()=>{}),Xu(this,"threshold",3),Xu(this,"win"),Xu(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=Cx(this.lastEventInfo,this.history),S=this.startEvent!==null,b=$ge(E.offset,{x:0,y:0})>=this.threshold;if(!S&&!b)return;const{timestamp:C}=nK();this.history.push({...E.point,timestamp:C});const{onStart:O,onMove:k}=this.handlers;S||(O==null||O(this.lastEvent,E),this.startEvent=this.lastEvent),k==null||k(this.lastEvent,E)}),Xu(this,"onPointerMove",(E,S)=>{this.lastEvent=E,this.lastEventInfo=S,Uge.update(this.updatePoint,!0)}),Xu(this,"onPointerUp",(E,S)=>{const b=Cx(S,this.history),{onEnd:C,onSessionEnd:O}=this.handlers;O==null||O(E,b),this.end(),!(!C||!this.startEvent)&&(C==null||C(E,b))}),this.win=t.view??window,Bme(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:lX(t)},{timestamp:d}=nK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:g}=s;g==null||g(t,Cx(l,this.history)),this.removeListeners=Kge(NO(this.win,"pointermove",this.onPointerMove),NO(this.win,"pointerup",this.onPointerUp),NO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),Vge.update(this.updatePoint)}}function rK(r,t){return{x:r.x-t.x,y:r.y-t.y}}function Cx(r,t){return{point:r.point,delta:rK(r.point,t[t.length-1]),offset:rK(r.point,t[0]),velocity:Hge(t,.1)}}const zge=r=>r*1e3;function Hge(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=r[r.length-1];for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>zge(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const g={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}function Kge(...r){return t=>r.reduce((s,a)=>a(s),t)}function Ix(r,t){return Math.abs(r-t)}function iK(r){return"x"in r&&"y"in r}function $ge(r,t){if(typeof r=="number"&&typeof t=="number")return Ix(r,t);if(iK(r)&&iK(t)){const s=Ix(r.x,t.x),a=Ix(r.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function qge(r,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:g,threshold:E}=t,S=!!(s||a||l||d||g),b=j.useRef(null),C=SX({onSessionStart:d,onSessionEnd:g,onStart:a,onMove:s,onEnd(O,k){b.current=null,l==null||l(O,k)}});j.useEffect(()=>{var O;(O=b.current)==null||O.updateHandlers(C.current)}),j.useEffect(()=>{const O=r.current;if(!O||!S)return;function k(W){b.current=new Gge(W,C.current,E)}return NO(O,"pointerdown",k)},[r,S,C,E]),j.useEffect(()=>()=>{var O;(O=b.current)==null||O.end(),b.current=null},[])}const zs={open:(r,t)=>`${r}[data-open], ${r}[open], ${r}[data-state=open] ${t}`,closed:(r,t)=>`${r}[data-closed], ${r}[data-state=closed] ${t}`,hover:(r,t)=>`${r}:hover ${t}, ${r}[data-hover] ${t}`,focus:(r,t)=>`${r}:focus ${t}, ${r}[data-focus] ${t}`,focusVisible:(r,t)=>`${r}:focus-visible ${t}`,focusWithin:(r,t)=>`${r}:focus-within ${t}`,active:(r,t)=>`${r}:active ${t}, ${r}[data-active] ${t}`,disabled:(r,t)=>`${r}:disabled ${t}, ${r}[data-disabled] ${t}`,invalid:(r,t)=>`${r}:invalid ${t}, ${r}[data-invalid] ${t}`,checked:(r,t)=>`${r}:checked ${t}, ${r}[data-checked] ${t}`,placeholderShown:(r,t)=>`${r}:placeholder-shown ${t}`},Zd=r=>IX(t=>r(t,"&"),"[role=group]","[data-group]",".group"),wp=r=>IX(t=>r(t,"~ &"),"[data-peer]",".peer"),IX=(r,...t)=>t.map(r).join(", "),Yy={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Zd(zs.open),_groupClosed:Zd(zs.closed),_groupHover:Zd(zs.hover),_peerHover:wp(zs.hover),_groupFocus:Zd(zs.focus),_peerFocus:wp(zs.focus),_groupFocusVisible:Zd(zs.focusVisible),_peerFocusVisible:wp(zs.focusVisible),_groupActive:Zd(zs.active),_peerActive:wp(zs.active),_groupDisabled:Zd(zs.disabled),_peerDisabled:wp(zs.disabled),_groupInvalid:Zd(zs.invalid),_peerInvalid:wp(zs.invalid),_groupChecked:Zd(zs.checked),_peerChecked:wp(zs.checked),_groupFocusWithin:Zd(zs.focusWithin),_peerFocusWithin:wp(zs.focusWithin),_peerPlaceholderShown:wp(zs.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},AX=Object.keys(Yy),Yge=r=>/!(important)?$/.test(r),sK=r=>typeof r=="string"?r.replace(/!(important)?$/,"").trim():r,Xge=(r,t)=>s=>{const a=String(t),l=Yge(a),d=sK(a),g=r?`${r}.${d}`:d;let E=nu(s.__cssMap)&&g in s.__cssMap?s.__cssMap[g].varRef:t;return E=sK(E),l?`${E} !important`:E};function SU(r){const{scale:t,transform:s,compose:a}=r;return(d,g)=>{const E=Xge(t,d)(g);let S=(s==null?void 0:s(E,g))??E;return a&&(S=a(S,g)),S}}const nO=(...r)=>t=>r.reduce((s,a)=>a(s),t);function Xl(r,t){return s=>{const a={property:s,scale:r};return a.transform=SU({scale:r,transform:t}),a}}const Jge=({rtl:r,ltr:t})=>s=>s.direction==="rtl"?r:t;function Qge(r){const{property:t,scale:s,transform:a}=r;return{scale:s,property:Jge(t),transform:s?SU({scale:s,compose:a}):a}}const OX=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function Zge(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...OX].join(" ")}function e_e(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...OX].join(" ")}const t_e={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},n_e={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function r_e(r){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":r,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const i_e={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},zM={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},s_e=new Set(Object.values(zM)),HM=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),o_e=r=>r.trim();function a_e(r,t){if(r==null||HM.has(r))return r;if(!(KM(r)||HM.has(r)))return`url('${r}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(r),d=l==null?void 0:l[1],g=l==null?void 0:l[2];if(!d||!g)return r;const E=d.includes("-gradient")?d:`${d}-gradient`,[S,...b]=g.split(",").map(o_e).filter(Boolean);if((b==null?void 0:b.length)===0)return r;const C=S in zM?zM[S]:S;b.unshift(C);const O=b.map(k=>{if(s_e.has(k))return k;const W=k.indexOf(" "),[H,K]=W!==-1?[k.substr(0,W),k.substr(W+1)]:[k],G=KM(K)?K:K&&K.split(" "),te=`colors.${H}`,J=te in t.__cssMap?t.__cssMap[te].varRef:H;return G?[J,...Array.isArray(G)?G:[G]].join(" "):J});return`${E}(${O.join(", ")})`}const KM=r=>typeof r=="string"&&r.includes("(")&&r.includes(")"),c_e=(r,t)=>a_e(r,t??{});function l_e(r){return/^var\(--.+\)$/.test(r)}const u_e=r=>{const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},eh=r=>t=>`${r}(${t})`,br={filter(r){return r!=="auto"?r:t_e},backdropFilter(r){return r!=="auto"?r:n_e},ring(r){return r_e(br.px(r))},bgClip(r){return r==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:r}},transform(r){return r==="auto"?Zge():r==="auto-gpu"?e_e():r},vh(r){return r==="$100vh"?"var(--chakra-vh)":r},px(r){if(r==null)return r;const{unitless:t}=u_e(r);return t||typeof r=="number"?`${r}px`:r},fraction(r){return typeof r!="number"||r>1?r:`${r*100}%`},float(r,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[r]:r},degree(r){if(l_e(r)||r==null)return r;const t=typeof r=="string"&&!r.endsWith("deg");return typeof r=="number"||t?`${r}deg`:r},gradient:c_e,blur:eh("blur"),opacity:eh("opacity"),brightness:eh("brightness"),contrast:eh("contrast"),dropShadow:eh("drop-shadow"),grayscale:eh("grayscale"),hueRotate:r=>eh("hue-rotate")(br.degree(r)),invert:eh("invert"),saturate:eh("saturate"),sepia:eh("sepia"),bgImage(r){return r==null||KM(r)||HM.has(r)?r:`url(${r})`},outline(r){const t=String(r)==="0"||String(r)==="none";return r!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:r}},flexDirection(r){const{space:t,divide:s}=i_e[r]??{},a={flexDirection:r};return t&&(a[t]=1),s&&(a[s]=1),a}},De={borderWidths:Xl("borderWidths"),borderStyles:Xl("borderStyles"),colors:Xl("colors"),borders:Xl("borders"),gradients:Xl("gradients",br.gradient),radii:Xl("radii",br.px),space:Xl("space",nO(br.vh,br.px)),spaceT:Xl("space",nO(br.vh,br.px)),degreeT(r){return{property:r,transform:br.degree}},prop(r,t,s){return{property:r,scale:t,...t&&{transform:SU({scale:t,transform:s})}}},propT(r,t){return{property:r,transform:t}},sizes:Xl("sizes",nO(br.vh,br.px)),sizesT:Xl("sizes",nO(br.vh,br.fraction)),shadows:Xl("shadows"),logical:Qge,blur:Xl("blur",br.blur)},kO={background:De.colors("background"),backgroundColor:De.colors("backgroundColor"),backgroundImage:De.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:br.bgClip},bgSize:De.prop("backgroundSize"),bgPosition:De.prop("backgroundPosition"),bg:De.colors("background"),bgColor:De.colors("backgroundColor"),bgPos:De.prop("backgroundPosition"),bgRepeat:De.prop("backgroundRepeat"),bgAttachment:De.prop("backgroundAttachment"),bgGradient:De.gradients("backgroundImage"),bgClip:{transform:br.bgClip}};Object.assign(kO,{bgImage:kO.backgroundImage,bgImg:kO.backgroundImage});const Wr={border:De.borders("border"),borderWidth:De.borderWidths("borderWidth"),borderStyle:De.borderStyles("borderStyle"),borderColor:De.colors("borderColor"),borderRadius:De.radii("borderRadius"),borderTop:De.borders("borderTop"),borderBlockStart:De.borders("borderBlockStart"),borderTopLeftRadius:De.radii("borderTopLeftRadius"),borderStartStartRadius:De.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:De.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:De.radii("borderTopRightRadius"),borderStartEndRadius:De.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:De.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:De.borders("borderRight"),borderInlineEnd:De.borders("borderInlineEnd"),borderBottom:De.borders("borderBottom"),borderBlockEnd:De.borders("borderBlockEnd"),borderBottomLeftRadius:De.radii("borderBottomLeftRadius"),borderBottomRightRadius:De.radii("borderBottomRightRadius"),borderLeft:De.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:De.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:De.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:De.borders(["borderLeft","borderRight"]),borderInline:De.borders("borderInline"),borderY:De.borders(["borderTop","borderBottom"]),borderBlock:De.borders("borderBlock"),borderTopWidth:De.borderWidths("borderTopWidth"),borderBlockStartWidth:De.borderWidths("borderBlockStartWidth"),borderTopColor:De.colors("borderTopColor"),borderBlockStartColor:De.colors("borderBlockStartColor"),borderTopStyle:De.borderStyles("borderTopStyle"),borderBlockStartStyle:De.borderStyles("borderBlockStartStyle"),borderBottomWidth:De.borderWidths("borderBottomWidth"),borderBlockEndWidth:De.borderWidths("borderBlockEndWidth"),borderBottomColor:De.colors("borderBottomColor"),borderBlockEndColor:De.colors("borderBlockEndColor"),borderBottomStyle:De.borderStyles("borderBottomStyle"),borderBlockEndStyle:De.borderStyles("borderBlockEndStyle"),borderLeftWidth:De.borderWidths("borderLeftWidth"),borderInlineStartWidth:De.borderWidths("borderInlineStartWidth"),borderLeftColor:De.colors("borderLeftColor"),borderInlineStartColor:De.colors("borderInlineStartColor"),borderLeftStyle:De.borderStyles("borderLeftStyle"),borderInlineStartStyle:De.borderStyles("borderInlineStartStyle"),borderRightWidth:De.borderWidths("borderRightWidth"),borderInlineEndWidth:De.borderWidths("borderInlineEndWidth"),borderRightColor:De.colors("borderRightColor"),borderInlineEndColor:De.colors("borderInlineEndColor"),borderRightStyle:De.borderStyles("borderRightStyle"),borderInlineEndStyle:De.borderStyles("borderInlineEndStyle"),borderTopRadius:De.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:De.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:De.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:De.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Wr,{rounded:Wr.borderRadius,roundedTop:Wr.borderTopRadius,roundedTopLeft:Wr.borderTopLeftRadius,roundedTopRight:Wr.borderTopRightRadius,roundedTopStart:Wr.borderStartStartRadius,roundedTopEnd:Wr.borderStartEndRadius,roundedBottom:Wr.borderBottomRadius,roundedBottomLeft:Wr.borderBottomLeftRadius,roundedBottomRight:Wr.borderBottomRightRadius,roundedBottomStart:Wr.borderEndStartRadius,roundedBottomEnd:Wr.borderEndEndRadius,roundedLeft:Wr.borderLeftRadius,roundedRight:Wr.borderRightRadius,roundedStart:Wr.borderInlineStartRadius,roundedEnd:Wr.borderInlineEndRadius,borderStart:Wr.borderInlineStart,borderEnd:Wr.borderInlineEnd,borderTopStartRadius:Wr.borderStartStartRadius,borderTopEndRadius:Wr.borderStartEndRadius,borderBottomStartRadius:Wr.borderEndStartRadius,borderBottomEndRadius:Wr.borderEndEndRadius,borderStartRadius:Wr.borderInlineStartRadius,borderEndRadius:Wr.borderInlineEndRadius,borderStartWidth:Wr.borderInlineStartWidth,borderEndWidth:Wr.borderInlineEndWidth,borderStartColor:Wr.borderInlineStartColor,borderEndColor:Wr.borderInlineEndColor,borderStartStyle:Wr.borderInlineStartStyle,borderEndStyle:Wr.borderInlineEndStyle});const d_e={color:De.colors("color"),textColor:De.colors("color"),fill:De.colors("fill"),stroke:De.colors("stroke"),accentColor:De.colors("accentColor"),textFillColor:De.colors("textFillColor")},hP={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:br.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:De.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:De.space("gap"),rowGap:De.space("rowGap"),columnGap:De.space("columnGap")};Object.assign(hP,{flexDir:hP.flexDirection});const Zl={width:De.sizesT("width"),inlineSize:De.sizesT("inlineSize"),height:De.sizes("height"),blockSize:De.sizes("blockSize"),boxSize:De.sizes(["width","height"]),minWidth:De.sizes("minWidth"),minInlineSize:De.sizes("minInlineSize"),minHeight:De.sizes("minHeight"),minBlockSize:De.sizes("minBlockSize"),maxWidth:De.sizes("maxWidth"),maxInlineSize:De.sizes("maxInlineSize"),maxHeight:De.sizes("maxHeight"),maxBlockSize:De.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(r,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(r))==null?void 0:d.minW)??r})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(r,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(r))==null?void 0:d._minW)??r})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:De.propT("float",br.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Zl,{w:Zl.width,h:Zl.height,minW:Zl.minWidth,maxW:Zl.maxWidth,minH:Zl.minHeight,maxH:Zl.maxHeight,overscroll:Zl.overscrollBehavior,overscrollX:Zl.overscrollBehaviorX,overscrollY:Zl.overscrollBehaviorY});const h_e={filter:{transform:br.filter},blur:De.blur("--chakra-blur"),brightness:De.propT("--chakra-brightness",br.brightness),contrast:De.propT("--chakra-contrast",br.contrast),hueRotate:De.propT("--chakra-hue-rotate",br.hueRotate),invert:De.propT("--chakra-invert",br.invert),saturate:De.propT("--chakra-saturate",br.saturate),dropShadow:De.propT("--chakra-drop-shadow",br.dropShadow),backdropFilter:{transform:br.backdropFilter},backdropBlur:De.blur("--chakra-backdrop-blur"),backdropBrightness:De.propT("--chakra-backdrop-brightness",br.brightness),backdropContrast:De.propT("--chakra-backdrop-contrast",br.contrast),backdropHueRotate:De.propT("--chakra-backdrop-hue-rotate",br.hueRotate),backdropInvert:De.propT("--chakra-backdrop-invert",br.invert),backdropSaturate:De.propT("--chakra-backdrop-saturate",br.saturate)},p_e={ring:{transform:br.ring},ringColor:De.colors("--chakra-ring-color"),ringOffset:De.prop("--chakra-ring-offset-width"),ringOffsetColor:De.colors("--chakra-ring-offset-color"),ringInset:De.prop("--chakra-ring-inset")},f_e={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:br.outline},outlineOffset:!0,outlineColor:De.colors("outlineColor")},PX={gridGap:De.space("gridGap"),gridColumnGap:De.space("gridColumnGap"),gridRowGap:De.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function m_e(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}const g_e=r=>{const t=new WeakMap;return(a,l,d,g)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const S=r(a,l,d,g);return E.set(l,S),S}},__e=g_e(m_e),E_e={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},v_e={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},Ax=(r,t,s)=>{const a={},l=__e(r,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},y_e={srOnly:{transform(r){return r===!0?E_e:r==="focusable"?v_e:{}}},layerStyle:{processResult:!0,transform:(r,t,s)=>Ax(t,`layerStyles.${r}`,s)},textStyle:{processResult:!0,transform:(r,t,s)=>Ax(t,`textStyles.${r}`,s)},apply:{processResult:!0,transform:(r,t,s)=>Ax(t,r,s)}},Kb={position:!0,pos:De.prop("position"),zIndex:De.prop("zIndex","zIndices"),inset:De.spaceT("inset"),insetX:De.spaceT(["left","right"]),insetInline:De.spaceT("insetInline"),insetY:De.spaceT(["top","bottom"]),insetBlock:De.spaceT("insetBlock"),top:De.spaceT("top"),insetBlockStart:De.spaceT("insetBlockStart"),bottom:De.spaceT("bottom"),insetBlockEnd:De.spaceT("insetBlockEnd"),left:De.spaceT("left"),insetInlineStart:De.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:De.spaceT("right"),insetInlineEnd:De.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Kb,{insetStart:Kb.insetInlineStart,insetEnd:Kb.insetInlineEnd});const $M={boxShadow:De.shadows("boxShadow"),mixBlendMode:!0,blendMode:De.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:De.prop("backgroundBlendMode"),opacity:!0};Object.assign($M,{shadow:$M.boxShadow});const Ni={margin:De.spaceT("margin"),marginTop:De.spaceT("marginTop"),marginBlockStart:De.spaceT("marginBlockStart"),marginRight:De.spaceT("marginRight"),marginInlineEnd:De.spaceT("marginInlineEnd"),marginBottom:De.spaceT("marginBottom"),marginBlockEnd:De.spaceT("marginBlockEnd"),marginLeft:De.spaceT("marginLeft"),marginInlineStart:De.spaceT("marginInlineStart"),marginX:De.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:De.spaceT("marginInline"),marginY:De.spaceT(["marginTop","marginBottom"]),marginBlock:De.spaceT("marginBlock"),padding:De.space("padding"),paddingTop:De.space("paddingTop"),paddingBlockStart:De.space("paddingBlockStart"),paddingRight:De.space("paddingRight"),paddingBottom:De.space("paddingBottom"),paddingBlockEnd:De.space("paddingBlockEnd"),paddingLeft:De.space("paddingLeft"),paddingInlineStart:De.space("paddingInlineStart"),paddingInlineEnd:De.space("paddingInlineEnd"),paddingX:De.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:De.space("paddingInline"),paddingY:De.space(["paddingTop","paddingBottom"]),paddingBlock:De.space("paddingBlock")};Object.assign(Ni,{m:Ni.margin,mt:Ni.marginTop,mr:Ni.marginRight,me:Ni.marginInlineEnd,marginEnd:Ni.marginInlineEnd,mb:Ni.marginBottom,ml:Ni.marginLeft,ms:Ni.marginInlineStart,marginStart:Ni.marginInlineStart,mx:Ni.marginX,my:Ni.marginY,p:Ni.padding,pt:Ni.paddingTop,py:Ni.paddingY,px:Ni.paddingX,pb:Ni.paddingBottom,pl:Ni.paddingLeft,ps:Ni.paddingInlineStart,paddingStart:Ni.paddingInlineStart,pr:Ni.paddingRight,pe:Ni.paddingInlineEnd,paddingEnd:Ni.paddingInlineEnd});const S_e={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:De.spaceT("scrollMargin"),scrollMarginTop:De.spaceT("scrollMarginTop"),scrollMarginBottom:De.spaceT("scrollMarginBottom"),scrollMarginLeft:De.spaceT("scrollMarginLeft"),scrollMarginRight:De.spaceT("scrollMarginRight"),scrollMarginX:De.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:De.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:De.spaceT("scrollPadding"),scrollPaddingTop:De.spaceT("scrollPaddingTop"),scrollPaddingBottom:De.spaceT("scrollPaddingBottom"),scrollPaddingLeft:De.spaceT("scrollPaddingLeft"),scrollPaddingRight:De.spaceT("scrollPaddingRight"),scrollPaddingX:De.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:De.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},T_e={fontFamily:De.prop("fontFamily","fonts"),fontSize:De.prop("fontSize","fontSizes",br.px),fontWeight:De.prop("fontWeight","fontWeights"),lineHeight:De.prop("lineHeight","lineHeights"),letterSpacing:De.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(r){if(r===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},b_e={textDecorationColor:De.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:De.shadows("textShadow")},w_e={clipPath:!0,transform:De.propT("transform",br.transform),transformOrigin:!0,translateX:De.spaceT("--chakra-translate-x"),translateY:De.spaceT("--chakra-translate-y"),skewX:De.degreeT("--chakra-skew-x"),skewY:De.degreeT("--chakra-skew-y"),scaleX:De.prop("--chakra-scale-x"),scaleY:De.prop("--chakra-scale-y"),scale:De.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:De.degreeT("--chakra-rotate")},R_e={listStyleType:!0,listStylePosition:!0,listStylePos:De.prop("listStylePosition"),listStyleImage:!0,listStyleImg:De.prop("listStyleImage")},C_e={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:De.prop("transitionDuration","transition.duration"),transitionProperty:De.prop("transitionProperty","transition.property"),transitionTimingFunction:De.prop("transitionTimingFunction","transition.easing")},TU=lh({},kO,Wr,d_e,hP,Zl,h_e,p_e,f_e,PX,y_e,Kb,$M,Ni,S_e,T_e,b_e,w_e,R_e,C_e),I_e=Object.assign({},Ni,Zl,hP,PX,Kb),A_e=Object.keys(I_e),O_e=[...Object.keys(TU),...AX],P_e={...TU,...Yy},N_e=r=>r in P_e,k_e=r=>t=>{if(!t.__breakpoints)return r;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const g in r){let E=Oc(r[g],t);if(E==null)continue;if(E=nu(E)&&s(E)?a(E):E,!Array.isArray(E)){d[g]=E;continue}const S=E.slice(0,l.length).length;for(let b=0;b<S;b+=1){const C=l==null?void 0:l[b];if(!C){d[g]=E[b];continue}d[C]=d[C]||{},E[b]!=null&&(d[C][g]=E[b])}}return d};function D_e(r){const t=[];let s="",a=!1;for(let l=0;l<r.length;l++){const d=r[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function L_e(r){return/^var\(--.+\)$/.test(r)}const x_e=(r,t)=>r.startsWith("--")&&typeof t=="string"&&!L_e(t),M_e=(r,t)=>{if(t==null)return t;const s=g=>{var E,S;return(S=(E=r.__cssMap)==null?void 0:E[g])==null?void 0:S.varRef},a=g=>s(g)??g,[l,d]=D_e(t);return t=s(l)??a(d)??a(t),t};function U_e(r){const{configs:t={},pseudos:s={},theme:a}=r,l=(d,g=!1)=>{var C;const E=Oc(d,a),S=k_e(E)(a);let b={};for(let O in S){const k=S[O];let W=Oc(k,a);O in s&&(O=s[O]),x_e(O,W)&&(W=M_e(a,W));let H=t[O];if(H===!0&&(H={property:O}),nu(W)){b[O]=b[O]??{},b[O]=lh({},b[O],l(W,!0));continue}let K=((C=H==null?void 0:H.transform)==null?void 0:C.call(H,W,a,E))??W;K=H!=null&&H.processResult?l(K,!0):K;const G=Oc(H==null?void 0:H.property,a);if(!g&&(H!=null&&H.static)){const te=Oc(H.static,a);b=lh({},b,te)}if(G&&Array.isArray(G)){for(const te of G)b[te]=K;continue}if(G){G==="&"&&nu(K)?b=lh({},b,K):b[G]=K;continue}if(nu(K)){b=lh({},b,K);continue}b[O]=K}return b};return l}const NX=r=>t=>U_e({theme:t,pseudos:Yy,configs:TU})(r);function a3e(r){return r}function c3e(r){return r}function Ti(r){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:r,...t}}}}function V_e(r,t,s){var a,l;return((l=(a=r.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function F_e(r,t){if(Array.isArray(r))return r;if(nu(r))return t(r);if(r!=null)return[r]}function j_e(r,t){for(let s=t+1;s<r.length;s++)if(r[s]!=null)return s;return-1}function B_e(r){const t=r.__breakpoints;return function(a,l,d,g){var k,W;if(!t)return;const E={},S=F_e(d,t.toArrayValue);if(!S)return E;const b=S.length,C=b===1,O=!!a.parts;for(let H=0;H<b;H++){const K=t.details[H],G=t.details[j_e(S,H)],te=Cb(K.minW,G==null?void 0:G._minW),J=Oc((k=a[l])==null?void 0:k[S[H]],g);if(J){if(O){(W=a.parts)==null||W.forEach(re=>{lh(E,{[re]:C?J[re]:{[te]:J[re]}})});continue}if(!O){C?lh(E,J):E[te]=J;continue}E[te]=J}}return E}}function W_e(r){return t=>{const{variant:s,size:a,theme:l}=t,d=B_e(l);return lh({},Oc(r.baseStyle??{},t),d(r,"sizes",a,t),d(r,"variants",s,t))}}function Ji(r){return Fw(r,["styleConfig","size","variant","colorScheme"])}function kX(r){return nu(r)&&r.reference?r.reference:String(r)}const QP=(r,...t)=>t.map(kX).join(` ${r} `).replace(/calc/g,""),oK=(...r)=>`calc(${QP("+",...r)})`,aK=(...r)=>`calc(${QP("-",...r)})`,qM=(...r)=>`calc(${QP("*",...r)})`,cK=(...r)=>`calc(${QP("/",...r)})`,lK=r=>{const t=kX(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:qM(t,-1)},Op=Object.assign(r=>({add:(...t)=>Op(oK(r,...t)),subtract:(...t)=>Op(aK(r,...t)),multiply:(...t)=>Op(qM(r,...t)),divide:(...t)=>Op(cK(r,...t)),negate:()=>Op(lK(r)),toString:()=>r.toString()}),{add:oK,subtract:aK,multiply:qM,divide:cK,negate:lK});function G_e(r,t="-"){return r.replace(/\s+/g,t)}function z_e(r){const t=G_e(r.toString());return K_e(H_e(t))}function H_e(r){return r.includes("\\.")?r:!Number.isInteger(parseFloat(r.toString()))?r.replace(".","\\."):r}function K_e(r){return r.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function $_e(r,t=""){return[t,r].filter(Boolean).join("-")}function q_e(r,t){return`var(${r}${t?`, ${t}`:""})`}function Y_e(r,t=""){return z_e(`--${$_e(r,t)}`)}function wn(r,t,s){const a=Y_e(r,s);return{variable:a,reference:q_e(a,t)}}function X_e(r,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=wn(`${r}-${l}`,d);continue}s[a]=wn(`${r}-${a}`)}return s}const J_e=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Q_e(r){return mX(r,J_e)}function Z_e(r){return r.semanticTokens}function eEe(r){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=r;return l}function tEe(r){const t=Q_e(r),s=Z_e(r),a=d=>AX.includes(d)||d==="default",l={};return eK(t,(d,g)=>{d!=null&&(l[g.join(".")]={isSemantic:!1,value:d})}),eK(s,(d,g)=>{d!=null&&(l[g.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function uK(r,t){return wn(String(r).replace(/\./g,"-"),void 0,t)}function nEe(r){var g;const t=tEe(r),s=(g=r.config)==null?void 0:g.cssVarPrefix;let a={};const l={};function d(E,S){const C=[String(E).split(".")[0],S].join(".");if(!t[C])return S;const{reference:k}=uK(C,s);return k}for(const[E,S]of Object.entries(t)){const{isSemantic:b,value:C}=S,{variable:O,reference:k}=uK(E,s);if(!b){if(E.startsWith("space")){const H=E.split("."),[K,...G]=H,te=`${K}.-${G.join(".")}`,J=Op.negate(C),re=Op.negate(k);l[te]={value:J,var:O,varRef:re}}a[O]=C,l[E]={value:C,var:O,varRef:k};continue}const W=nu(C)?C:{default:C};a=lh(a,Object.entries(W).reduce((H,[K,G])=>{if(!G)return H;const te=d(E,`${G}`);if(K==="default")return H[O]=te,H;const J=(Yy==null?void 0:Yy[K])??K;return H[J]={[O]:te},H},{})),l[E]={value:k,var:O,varRef:k}}return{cssVars:a,cssMap:l}}function rEe(r){const t=eEe(r),{cssMap:s,cssVars:a}=nEe(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:Jme(t.breakpoints)}),t}function Kr(r,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){a();for(const O of C)t[O]=S(O);return Kr(r,t)}function d(...C){for(const O of C)O in t||(t[O]=S(O));return Kr(r,t)}function g(){return Object.fromEntries(Object.entries(t).map(([O,k])=>[O,k.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([O,k])=>[O,k.className]))}function S(C){const W=`chakra-${(["container","root"].includes(C??"")?[r]:[r,C]).filter(Boolean).join("__")}`;return{className:W,selector:`.${W}`,toString:()=>C}}return{parts:l,toPart:S,extend:d,selectors:g,classnames:E,get keys(){return Object.keys(t)},__type:{}}}const iEe=Kr("accordion").parts("root","container","button","panel","icon"),sEe=Kr("alert").parts("title","description","container","icon","spinner"),oEe=Kr("avatar").parts("label","badge","container","excessLabel","group"),aEe=Kr("breadcrumb").parts("link","item","container","separator");Kr("button").parts();const cEe=Kr("checkbox").parts("control","icon","container","label");Kr("progress").parts("track","filledTrack","label");const lEe=Kr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),uEe=Kr("editable").parts("preview","input","textarea"),dEe=Kr("form").parts("container","requiredIndicator","helperText"),hEe=Kr("formError").parts("text","icon"),pEe=Kr("input").parts("addon","field","element","group"),fEe=Kr("list").parts("container","item","icon"),mEe=Kr("menu").parts("button","list","item","groupTitle","icon","command","divider"),gEe=Kr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),_Ee=Kr("numberinput").parts("root","field","stepperGroup","stepper");Kr("pininput").parts("field");const EEe=Kr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),vEe=Kr("progress").parts("label","filledTrack","track"),yEe=Kr("radio").parts("container","control","label"),SEe=Kr("select").parts("field","icon"),TEe=Kr("slider").parts("container","track","thumb","filledTrack","mark"),bEe=Kr("stat").parts("container","label","helpText","number","icon"),wEe=Kr("switch").parts("container","track","thumb","label"),REe=Kr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),CEe=Kr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),IEe=Kr("tag").parts("container","label","closeButton"),AEe=Kr("card").parts("container","header","body","footer");Kr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:OEe,defineMultiStyleConfig:PEe}=Ti(iEe.keys),NEe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},kEe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},DEe={pt:"2",px:"4",pb:"5"},LEe={fontSize:"1.25em"},xEe=OEe({container:NEe,button:kEe,panel:DEe,icon:LEe}),MEe=PEe({baseStyle:xEe});function I_(r,t,s){return Math.min(Math.max(r,s),t)}class UEe extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var Ab=UEe;function bU(r){if(typeof r!="string")throw new Ab(r);if(r.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=r.trim();t=HEe.test(r)?jEe(r):r;const s=BEe.exec(t);if(s){const g=Array.from(s).slice(1);return[...g.slice(0,3).map(E=>parseInt(dw(E,2),16)),parseInt(dw(g[3]||"f",2),16)/255]}const a=WEe.exec(t);if(a){const g=Array.from(a).slice(1);return[...g.slice(0,3).map(E=>parseInt(E,16)),parseInt(g[3]||"ff",16)/255]}const l=GEe.exec(t);if(l){const g=Array.from(l).slice(1);return[...g.slice(0,3).map(E=>parseInt(E,10)),parseFloat(g[3]||"1")]}const d=zEe.exec(t);if(d){const[g,E,S,b]=Array.from(d).slice(1).map(parseFloat);if(I_(0,100,E)!==E)throw new Ab(r);if(I_(0,100,S)!==S)throw new Ab(r);return[...KEe(g,E,S),Number.isNaN(b)?1:b]}throw new Ab(r)}function VEe(r){let t=5381,s=r.length;for(;s;)t=t*33^r.charCodeAt(--s);return(t>>>0)%2341}const dK=r=>parseInt(r.replace(/_/g,""),36),FEe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((r,t)=>{const s=dK(t.substring(0,3)),a=dK(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return r[s]=`${l}${a}`,r},{});function jEe(r){const t=r.toLowerCase().trim(),s=FEe[VEe(t)];if(!s)throw new Ab(r);return`#${s}`}const dw=(r,t)=>Array.from(Array(t)).map(()=>r).join(""),BEe=new RegExp(`^#${dw("([a-f0-9])",3)}([a-f0-9])?$`,"i"),WEe=new RegExp(`^#${dw("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),GEe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${dw(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),zEe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,HEe=/^[a-z]+$/i,hK=r=>Math.round(r*255),KEe=(r,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(hK);const l=(r%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),g=d*(1-Math.abs(l%2-1));let E=0,S=0,b=0;l>=0&&l<1?(E=d,S=g):l>=1&&l<2?(E=g,S=d):l>=2&&l<3?(S=d,b=g):l>=3&&l<4?(S=g,b=d):l>=4&&l<5?(E=g,b=d):l>=5&&l<6&&(E=d,b=g);const C=a-d/2,O=E+C,k=S+C,W=b+C;return[O,k,W].map(hK)};function $Ee(r,t,s,a){return`rgba(${I_(0,255,r).toFixed()}, ${I_(0,255,t).toFixed()}, ${I_(0,255,s).toFixed()}, ${parseFloat(I_(0,1,a).toFixed(3))})`}function qEe(r,t){const[s,a,l,d]=bU(r);return $Ee(s,a,l,d-t)}function YEe(r){const[t,s,a,l]=bU(r);let d=g=>{const E=I_(0,255,g).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const XEe=r=>Object.keys(r).length===0;function JEe(r,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)r=r?r[t[a]]:l;return r===l?s:r}const ja=(r,t,s)=>{const a=JEe(r,`colors.${t}`,t);try{return YEe(a),a}catch{return s??"#000000"}},QEe=r=>{const[t,s,a]=bU(r);return(t*299+s*587+a*114)/1e3},ZEe=r=>t=>{const s=ja(t,r);return QEe(s)<128?"dark":"light"},eve=r=>t=>ZEe(r)(t)==="dark",cS=(r,t)=>s=>{const a=ja(s,r);return qEe(a,1-t)};function pK(r="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${r} ${r}`}}const tve=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function nve(r){const t=tve();return!r||XEe(r)?t:r.string&&r.colors?ive(r.string,r.colors):r.string&&!r.colors?rve(r.string):r.colors&&!r.string?sve(r.colors):t}function rve(r){let t=0;if(r.length===0)return t.toString();for(let a=0;a<r.length;a+=1)t=r.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function ive(r,t){let s=0;if(r.length===0)return t[0];for(let a=0;a<r.length;a+=1)s=r.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function sve(r){return r[Math.floor(Math.random()*r.length)]}function Tn(r,t){return s=>s.colorMode==="dark"?t:r}function wU(r){const{orientation:t,vertical:s,horizontal:a}=r;return t?t==="vertical"?s:a:{}}function DX(r){return nu(r)&&r.reference?r.reference:String(r)}const ZP=(r,...t)=>t.map(DX).join(` ${r} `).replace(/calc/g,""),fK=(...r)=>`calc(${ZP("+",...r)})`,mK=(...r)=>`calc(${ZP("-",...r)})`,YM=(...r)=>`calc(${ZP("*",...r)})`,gK=(...r)=>`calc(${ZP("/",...r)})`,_K=r=>{const t=DX(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:YM(t,-1)},Pp=Object.assign(r=>({add:(...t)=>Pp(fK(r,...t)),subtract:(...t)=>Pp(mK(r,...t)),multiply:(...t)=>Pp(YM(r,...t)),divide:(...t)=>Pp(gK(r,...t)),negate:()=>Pp(_K(r)),toString:()=>r.toString()}),{add:fK,subtract:mK,multiply:YM,divide:gK,negate:_K});function ove(r){return!Number.isInteger(parseFloat(r.toString()))}function ave(r,t="-"){return r.replace(/\s+/g,t)}function LX(r){const t=ave(r.toString());return t.includes("\\.")?r:ove(r)?t.replace(".","\\."):r}function cve(r,t=""){return[t,LX(r)].filter(Boolean).join("-")}function lve(r,t){return`var(${LX(r)}${t?`, ${t}`:""})`}function uve(r,t=""){return`--${cve(r,t)}`}function Ys(r,t){const s=uve(r,t==null?void 0:t.prefix);return{variable:s,reference:lve(s,dve(t==null?void 0:t.fallback))}}function dve(r){return r==null?void 0:r.reference}const{definePartsStyle:Ww,defineMultiStyleConfig:hve}=Ti(sEe.keys),ll=wn("alert-fg"),Bp=wn("alert-bg"),pve=Ww({container:{bg:Bp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:ll.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:ll.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function RU(r){const{theme:t,colorScheme:s}=r,a=cS(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const fve=Ww(r=>{const{colorScheme:t}=r,s=RU(r);return{container:{[ll.variable]:`colors.${t}.600`,[Bp.variable]:s.light,_dark:{[ll.variable]:`colors.${t}.200`,[Bp.variable]:s.dark}}}}),mve=Ww(r=>{const{colorScheme:t}=r,s=RU(r);return{container:{[ll.variable]:`colors.${t}.600`,[Bp.variable]:s.light,_dark:{[ll.variable]:`colors.${t}.200`,[Bp.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:ll.reference}}}),gve=Ww(r=>{const{colorScheme:t}=r,s=RU(r);return{container:{[ll.variable]:`colors.${t}.600`,[Bp.variable]:s.light,_dark:{[ll.variable]:`colors.${t}.200`,[Bp.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:ll.reference}}}),_ve=Ww(r=>{const{colorScheme:t}=r;return{container:{[ll.variable]:"colors.white",[Bp.variable]:`colors.${t}.600`,_dark:{[ll.variable]:"colors.gray.900",[Bp.variable]:`colors.${t}.200`},color:ll.reference}}}),Eve={subtle:fve,"left-accent":mve,"top-accent":gve,solid:_ve},vve=hve({baseStyle:pve,variants:Eve,defaultProps:{variant:"subtle",colorScheme:"blue"}}),xX={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},yve={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Sve={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},MX={...xX,...yve,container:Sve},Tve=r=>typeof r=="function";function Ba(r,...t){return Tve(r)?r(...t):r}const{definePartsStyle:UX,defineMultiStyleConfig:bve}=Ti(oEe.keys),Xy=wn("avatar-border-color"),$b=wn("avatar-bg"),hw=wn("avatar-font-size"),lS=wn("avatar-size"),wve={borderRadius:"full",border:"0.2em solid",borderColor:Xy.reference,[Xy.variable]:"white",_dark:{[Xy.variable]:"colors.gray.800"}},Rve={bg:$b.reference,fontSize:hw.reference,width:lS.reference,height:lS.reference,lineHeight:"1",[$b.variable]:"colors.gray.200",_dark:{[$b.variable]:"colors.whiteAlpha.400"}},Cve=r=>{const{name:t,theme:s}=r,a=t?nve({string:t}):"colors.gray.400",l=eve(a)(s);let d="white";return l||(d="gray.800"),{bg:$b.reference,fontSize:hw.reference,color:d,borderColor:Xy.reference,verticalAlign:"top",width:lS.reference,height:lS.reference,"&:not([data-loaded])":{[$b.variable]:a},[Xy.variable]:"colors.white",_dark:{[Xy.variable]:"colors.gray.800"}}},Ive={fontSize:hw.reference,lineHeight:"1"},Ave=UX(r=>({badge:Ba(wve,r),excessLabel:Ba(Rve,r),container:Ba(Cve,r),label:Ive}));function dm(r){const t=r!=="100%"?MX[r]:void 0;return UX({container:{[lS.variable]:t??r,[hw.variable]:`calc(${t??r} / 2.5)`},excessLabel:{[lS.variable]:t??r,[hw.variable]:`calc(${t??r} / 2.5)`}})}const Ove={"2xs":dm(4),xs:dm(6),sm:dm(8),md:dm(12),lg:dm(16),xl:dm(24),"2xl":dm(32),full:dm("100%")},Pve=bve({baseStyle:Ave,sizes:Ove,defaultProps:{size:"md"}}),Ss=X_e("badge",["bg","color","shadow"]),Nve={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Ss.bg.reference,color:Ss.color.reference,boxShadow:Ss.shadow.reference},kve=r=>{const{colorScheme:t,theme:s}=r,a=cS(`${t}.500`,.6)(s);return{[Ss.bg.variable]:`colors.${t}.500`,[Ss.color.variable]:"colors.white",_dark:{[Ss.bg.variable]:a,[Ss.color.variable]:"colors.whiteAlpha.800"}}},Dve=r=>{const{colorScheme:t,theme:s}=r,a=cS(`${t}.200`,.16)(s);return{[Ss.bg.variable]:`colors.${t}.100`,[Ss.color.variable]:`colors.${t}.800`,_dark:{[Ss.bg.variable]:a,[Ss.color.variable]:`colors.${t}.200`}}},Lve=r=>{const{colorScheme:t,theme:s}=r,a=cS(`${t}.200`,.8)(s);return{[Ss.color.variable]:`colors.${t}.500`,_dark:{[Ss.color.variable]:a},[Ss.shadow.variable]:`inset 0 0 0px 1px ${Ss.color.reference}`}},xve={solid:kve,subtle:Dve,outline:Lve},qb={baseStyle:Nve,variants:xve,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:Mve,definePartsStyle:Uve}=Ti(aEe.keys),Ox=wn("breadcrumb-link-decor"),Vve={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:Ox.reference,[Ox.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[Ox.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},Fve=Uve({link:Vve}),jve=Mve({baseStyle:Fve}),Bve={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},VX=r=>{const{colorScheme:t,theme:s}=r;if(t==="gray")return{color:Tn("gray.800","whiteAlpha.900")(r),_hover:{bg:Tn("gray.100","whiteAlpha.200")(r)},_active:{bg:Tn("gray.200","whiteAlpha.300")(r)}};const a=cS(`${t}.200`,.12)(s),l=cS(`${t}.200`,.24)(s);return{color:Tn(`${t}.600`,`${t}.200`)(r),bg:"transparent",_hover:{bg:Tn(`${t}.50`,a)(r)},_active:{bg:Tn(`${t}.100`,l)(r)}}},Wve=r=>{const{colorScheme:t}=r,s=Tn("gray.200","whiteAlpha.300")(r);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Ba(VX,r)}},Gve={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},zve=r=>{const{colorScheme:t}=r;if(t==="gray"){const E=Tn("gray.100","whiteAlpha.200")(r);return{bg:E,color:Tn("gray.800","whiteAlpha.900")(r),_hover:{bg:Tn("gray.200","whiteAlpha.300")(r),_disabled:{bg:E}},_active:{bg:Tn("gray.300","whiteAlpha.400")(r)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=Gve[t]??{},g=Tn(s,`${t}.200`)(r);return{bg:g,color:Tn(a,"gray.800")(r),_hover:{bg:Tn(l,`${t}.300`)(r),_disabled:{bg:g}},_active:{bg:Tn(d,`${t}.400`)(r)}}},Hve=r=>{const{colorScheme:t}=r;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Tn(`${t}.500`,`${t}.200`)(r),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Tn(`${t}.700`,`${t}.500`)(r)}}},Kve={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},$ve={ghost:VX,outline:Wve,solid:zve,link:Hve,unstyled:Kve},qve={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},Yve={baseStyle:Bve,variants:$ve,sizes:qve,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:N_,defineMultiStyleConfig:Xve}=Ti(AEe.keys),pP=wn("card-bg"),Mp=wn("card-padding"),FX=wn("card-shadow"),DO=wn("card-radius"),jX=wn("card-border-width","0"),BX=wn("card-border-color"),Jve=N_({container:{[pP.variable]:"colors.chakra-body-bg",backgroundColor:pP.reference,boxShadow:FX.reference,borderRadius:DO.reference,color:"chakra-body-text",borderWidth:jX.reference,borderColor:BX.reference},body:{padding:Mp.reference,flex:"1 1 0%"},header:{padding:Mp.reference},footer:{padding:Mp.reference}}),Qve={sm:N_({container:{[DO.variable]:"radii.base",[Mp.variable]:"space.3"}}),md:N_({container:{[DO.variable]:"radii.md",[Mp.variable]:"space.5"}}),lg:N_({container:{[DO.variable]:"radii.xl",[Mp.variable]:"space.7"}})},Zve={elevated:N_({container:{[FX.variable]:"shadows.base",_dark:{[pP.variable]:"colors.gray.700"}}}),outline:N_({container:{[jX.variable]:"1px",[BX.variable]:"colors.chakra-border-color"}}),filled:N_({container:{[pP.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Mp.variable]:0},header:{[Mp.variable]:0},footer:{[Mp.variable]:0}}},eye=Xve({baseStyle:Jve,variants:Zve,sizes:Qve,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:LO,defineMultiStyleConfig:tye}=Ti(cEe.keys),Yb=wn("checkbox-size"),nye=r=>{const{colorScheme:t}=r;return{w:Yb.reference,h:Yb.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Tn(`${t}.500`,`${t}.200`)(r),borderColor:Tn(`${t}.500`,`${t}.200`)(r),color:Tn("white","gray.900")(r),_hover:{bg:Tn(`${t}.600`,`${t}.300`)(r),borderColor:Tn(`${t}.600`,`${t}.300`)(r)},_disabled:{borderColor:Tn("gray.200","transparent")(r),bg:Tn("gray.200","whiteAlpha.300")(r),color:Tn("gray.500","whiteAlpha.500")(r)}},_indeterminate:{bg:Tn(`${t}.500`,`${t}.200`)(r),borderColor:Tn(`${t}.500`,`${t}.200`)(r),color:Tn("white","gray.900")(r)},_disabled:{bg:Tn("gray.100","whiteAlpha.100")(r),borderColor:Tn("gray.100","transparent")(r)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Tn("red.500","red.300")(r)}}},rye={_disabled:{cursor:"not-allowed"}},iye={userSelect:"none",_disabled:{opacity:.4}},sye={transitionProperty:"transform",transitionDuration:"normal"},oye=LO(r=>({icon:sye,container:rye,control:Ba(nye,r),label:iye})),aye={sm:LO({control:{[Yb.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:LO({control:{[Yb.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:LO({control:{[Yb.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},gm=tye({baseStyle:oye,sizes:aye,defaultProps:{size:"md",colorScheme:"blue"}}),Xb=Ys("close-button-size"),ab=Ys("close-button-bg"),cye={w:[Xb.reference],h:[Xb.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[ab.variable]:"colors.blackAlpha.100",_dark:{[ab.variable]:"colors.whiteAlpha.100"}},_active:{[ab.variable]:"colors.blackAlpha.200",_dark:{[ab.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:ab.reference},lye={lg:{[Xb.variable]:"sizes.10",fontSize:"md"},md:{[Xb.variable]:"sizes.8",fontSize:"xs"},sm:{[Xb.variable]:"sizes.6",fontSize:"2xs"}},uye={baseStyle:cye,sizes:lye,defaultProps:{size:"md"}},{variants:dye,defaultProps:hye}=qb,pye={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Ss.bg.reference,color:Ss.color.reference,boxShadow:Ss.shadow.reference},fye={baseStyle:pye,variants:dye,defaultProps:hye},mye={w:"100%",mx:"auto",maxW:"prose",px:"4"},gye={baseStyle:mye},_ye={opacity:.6,borderColor:"inherit"},Eye={borderStyle:"solid"},vye={borderStyle:"dashed"},yye={solid:Eye,dashed:vye},Sye={baseStyle:_ye,variants:yye,defaultProps:{variant:"solid"}},{definePartsStyle:XM,defineMultiStyleConfig:Tye}=Ti(lEe.keys),Px=wn("drawer-bg"),Nx=wn("drawer-box-shadow");function Sy(r){return XM(r==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:r}})}const bye={bg:"blackAlpha.600",zIndex:"modal"},wye={display:"flex",zIndex:"modal",justifyContent:"center"},Rye=r=>{const{isFullHeight:t}=r;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[Px.variable]:"colors.white",[Nx.variable]:"shadows.lg",_dark:{[Px.variable]:"colors.gray.700",[Nx.variable]:"shadows.dark-lg"},bg:Px.reference,boxShadow:Nx.reference}},Cye={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Iye={position:"absolute",top:"2",insetEnd:"3"},Aye={px:"6",py:"2",flex:"1",overflow:"auto"},Oye={px:"6",py:"4"},Pye=XM(r=>({overlay:bye,dialogContainer:wye,dialog:Ba(Rye,r),header:Cye,closeButton:Iye,body:Aye,footer:Oye})),Nye={xs:Sy("xs"),sm:Sy("md"),md:Sy("lg"),lg:Sy("2xl"),xl:Sy("4xl"),full:Sy("full")},kye=Tye({baseStyle:Pye,sizes:Nye,defaultProps:{size:"xs"}}),{definePartsStyle:Dye,defineMultiStyleConfig:Lye}=Ti(uEe.keys),xye={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Mye={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Uye={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Vye=Dye({preview:xye,input:Mye,textarea:Uye}),Fye=Lye({baseStyle:Vye}),{definePartsStyle:jye,defineMultiStyleConfig:Bye}=Ti(dEe.keys),Jy=wn("form-control-color"),Wye={marginStart:"1",[Jy.variable]:"colors.red.500",_dark:{[Jy.variable]:"colors.red.300"},color:Jy.reference},Gye={mt:"2",[Jy.variable]:"colors.gray.600",_dark:{[Jy.variable]:"colors.whiteAlpha.600"},color:Jy.reference,lineHeight:"normal",fontSize:"sm"},zye=jye({container:{width:"100%",position:"relative"},requiredIndicator:Wye,helperText:Gye}),Hye=Bye({baseStyle:zye}),{definePartsStyle:Kye,defineMultiStyleConfig:$ye}=Ti(hEe.keys),Qy=wn("form-error-color"),qye={[Qy.variable]:"colors.red.500",_dark:{[Qy.variable]:"colors.red.300"},color:Qy.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Yye={marginEnd:"0.5em",[Qy.variable]:"colors.red.500",_dark:{[Qy.variable]:"colors.red.300"},color:Qy.reference},Xye=Kye({text:qye,icon:Yye}),Jye=$ye({baseStyle:Xye}),Qye={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},Zye={baseStyle:Qye},eSe={fontFamily:"heading",fontWeight:"bold"},tSe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},nSe={baseStyle:eSe,sizes:tSe,defaultProps:{size:"xl"}},{definePartsStyle:kp,defineMultiStyleConfig:rSe}=Ti(pEe.keys),Ly=wn("input-height"),xy=wn("input-font-size"),My=wn("input-padding"),Uy=wn("input-border-radius"),iSe=kp({addon:{height:Ly.reference,fontSize:xy.reference,px:My.reference,borderRadius:Uy.reference},field:{width:"100%",height:Ly.reference,fontSize:xy.reference,px:My.reference,borderRadius:Uy.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),hm={lg:{[xy.variable]:"fontSizes.lg",[My.variable]:"space.4",[Uy.variable]:"radii.md",[Ly.variable]:"sizes.12"},md:{[xy.variable]:"fontSizes.md",[My.variable]:"space.4",[Uy.variable]:"radii.md",[Ly.variable]:"sizes.10"},sm:{[xy.variable]:"fontSizes.sm",[My.variable]:"space.3",[Uy.variable]:"radii.sm",[Ly.variable]:"sizes.8"},xs:{[xy.variable]:"fontSizes.xs",[My.variable]:"space.2",[Uy.variable]:"radii.sm",[Ly.variable]:"sizes.6"}},sSe={lg:kp({field:hm.lg,group:hm.lg}),md:kp({field:hm.md,group:hm.md}),sm:kp({field:hm.sm,group:hm.sm}),xs:kp({field:hm.xs,group:hm.xs})};function CU(r){const{focusBorderColor:t,errorBorderColor:s}=r;return{focusBorderColor:t||Tn("blue.500","blue.300")(r),errorBorderColor:s||Tn("red.500","red.300")(r)}}const oSe=kp(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=CU(r);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Tn("gray.300","whiteAlpha.400")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ja(t,a),boxShadow:`0 0 0 1px ${ja(t,a)}`},_focusVisible:{zIndex:1,borderColor:ja(t,s),boxShadow:`0 0 0 1px ${ja(t,s)}`}},addon:{border:"1px solid",borderColor:Tn("inherit","whiteAlpha.50")(r),bg:Tn("gray.100","whiteAlpha.300")(r)}}}),aSe=kp(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=CU(r);return{field:{border:"2px solid",borderColor:"transparent",bg:Tn("gray.100","whiteAlpha.50")(r),_hover:{bg:Tn("gray.200","whiteAlpha.100")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ja(t,a)},_focusVisible:{bg:"transparent",borderColor:ja(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:Tn("gray.100","whiteAlpha.50")(r)}}}),cSe=kp(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=CU(r);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ja(t,a),boxShadow:`0px 1px 0px 0px ${ja(t,a)}`},_focusVisible:{borderColor:ja(t,s),boxShadow:`0px 1px 0px 0px ${ja(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),lSe=kp({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),uSe={outline:oSe,filled:aSe,flushed:cSe,unstyled:lSe},Hr=rSe({baseStyle:iSe,sizes:sSe,variants:uSe,defaultProps:{size:"md",variant:"outline"}}),kx=wn("kbd-bg"),dSe={[kx.variable]:"colors.gray.100",_dark:{[kx.variable]:"colors.whiteAlpha.100"},bg:kx.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},hSe={baseStyle:dSe},pSe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},fSe={baseStyle:pSe},{defineMultiStyleConfig:mSe,definePartsStyle:gSe}=Ti(fEe.keys),_Se={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},ESe=gSe({icon:_Se}),vSe=mSe({baseStyle:ESe}),{defineMultiStyleConfig:ySe,definePartsStyle:SSe}=Ti(mEe.keys),th=wn("menu-bg"),Dx=wn("menu-shadow"),TSe={[th.variable]:"#fff",[Dx.variable]:"shadows.sm",_dark:{[th.variable]:"colors.gray.700",[Dx.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:th.reference,boxShadow:Dx.reference},bSe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[th.variable]:"colors.gray.100",_dark:{[th.variable]:"colors.whiteAlpha.100"}},_active:{[th.variable]:"colors.gray.200",_dark:{[th.variable]:"colors.whiteAlpha.200"}},_expanded:{[th.variable]:"colors.gray.100",_dark:{[th.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:th.reference},wSe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},RSe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},CSe={opacity:.6},ISe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},ASe={transitionProperty:"common",transitionDuration:"normal"},OSe=SSe({button:ASe,list:TSe,item:bSe,groupTitle:wSe,icon:RSe,command:CSe,divider:ISe}),PSe=ySe({baseStyle:OSe}),{defineMultiStyleConfig:NSe,definePartsStyle:JM}=Ti(gEe.keys),Lx=wn("modal-bg"),xx=wn("modal-shadow"),kSe={bg:"blackAlpha.600",zIndex:"modal"},DSe=r=>{const{isCentered:t,scrollBehavior:s}=r;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},LSe=r=>{const{isCentered:t,scrollBehavior:s}=r;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[Lx.variable]:"colors.white",[xx.variable]:"shadows.lg",_dark:{[Lx.variable]:"colors.gray.700",[xx.variable]:"shadows.dark-lg"},bg:Lx.reference,boxShadow:xx.reference}},xSe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},MSe={position:"absolute",top:"2",insetEnd:"3"},USe=r=>{const{scrollBehavior:t}=r;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},VSe={px:"6",py:"4"},FSe=JM(r=>({overlay:kSe,dialogContainer:Ba(DSe,r),dialog:Ba(LSe,r),header:xSe,closeButton:MSe,body:Ba(USe,r),footer:VSe}));function Ju(r){return JM(r==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:r}})}const jSe={xs:Ju("xs"),sm:Ju("sm"),md:Ju("md"),lg:Ju("lg"),xl:Ju("xl"),"2xl":Ju("2xl"),"3xl":Ju("3xl"),"4xl":Ju("4xl"),"5xl":Ju("5xl"),"6xl":Ju("6xl"),full:Ju("full")},BSe=NSe({baseStyle:FSe,sizes:jSe,defaultProps:{size:"md"}}),WX={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:WSe,definePartsStyle:GX}=Ti(_Ee.keys),IU=Ys("number-input-stepper-width"),zX=Ys("number-input-input-padding"),GSe=Pp(IU).add("0.5rem").toString(),Mx=Ys("number-input-bg"),Ux=Ys("number-input-color"),Vx=Ys("number-input-border-color"),zSe={[IU.variable]:"sizes.6",[zX.variable]:GSe},HSe=r=>{var t;return((t=Ba(Hr.baseStyle,r))==null?void 0:t.field)??{}},KSe={width:IU.reference},$Se={borderStart:"1px solid",borderStartColor:Vx.reference,color:Ux.reference,bg:Mx.reference,[Ux.variable]:"colors.chakra-body-text",[Vx.variable]:"colors.chakra-border-color",_dark:{[Ux.variable]:"colors.whiteAlpha.800",[Vx.variable]:"colors.whiteAlpha.300"},_active:{[Mx.variable]:"colors.gray.200",_dark:{[Mx.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},qSe=GX(r=>({root:zSe,field:Ba(HSe,r)??{},stepperGroup:KSe,stepper:$Se}));function rO(r){var d,g;const t=(d=Hr.sizes)==null?void 0:d[r],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((g=t.field)==null?void 0:g.fontSize)??"md",l=WX.fontSizes[a];return GX({field:{...t.field,paddingInlineEnd:zX.reference,verticalAlign:"top"},stepper:{fontSize:Pp(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[r]},_last:{borderBottomEndRadius:s[r],mt:"-1px",borderTopWidth:1}}})}const YSe={xs:rO("xs"),sm:rO("sm"),md:rO("md"),lg:rO("lg")},XSe=WSe({baseStyle:qSe,sizes:YSe,variants:Hr.variants,defaultProps:Hr.defaultProps});var WY;const JSe={...(WY=Hr.baseStyle)==null?void 0:WY.field,textAlign:"center"},QSe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var GY;const ZSe={outline:r=>{var t,s;return((s=Ba((t=Hr.variants)==null?void 0:t.outline,r))==null?void 0:s.field)??{}},flushed:r=>{var t,s;return((s=Ba((t=Hr.variants)==null?void 0:t.flushed,r))==null?void 0:s.field)??{}},filled:r=>{var t,s;return((s=Ba((t=Hr.variants)==null?void 0:t.filled,r))==null?void 0:s.field)??{}},unstyled:((GY=Hr.variants)==null?void 0:GY.unstyled.field)??{}},eTe={baseStyle:JSe,sizes:QSe,variants:ZSe,defaultProps:Hr.defaultProps},{defineMultiStyleConfig:tTe,definePartsStyle:nTe}=Ti(EEe.keys),iO=Ys("popper-bg"),rTe=Ys("popper-arrow-bg"),EK=Ys("popper-arrow-shadow-color"),iTe={zIndex:"popover"},sTe={[iO.variable]:"colors.white",bg:iO.reference,[rTe.variable]:iO.reference,[EK.variable]:"colors.gray.200",_dark:{[iO.variable]:"colors.gray.700",[EK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},oTe={px:3,py:2,borderBottomWidth:"1px"},aTe={px:3,py:2},cTe={px:3,py:2,borderTopWidth:"1px"},lTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},uTe=nTe({popper:iTe,content:sTe,header:oTe,body:aTe,footer:cTe,closeButton:lTe}),dTe=tTe({baseStyle:uTe}),{defineMultiStyleConfig:hTe,definePartsStyle:Ob}=Ti(vEe.keys),pTe=r=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=r,d=Tn(pK(),pK("1rem","rgba(0,0,0,0.1)"))(r),g=Tn(`${t}.500`,`${t}.200`)(r),E=`linear-gradient(
    to right,
    transparent 0%,
    ${ja(s,g)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:g}}},fTe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},mTe=r=>({bg:Tn("gray.100","whiteAlpha.300")(r)}),gTe=r=>({transitionProperty:"common",transitionDuration:"slow",...pTe(r)}),_Te=Ob(r=>({label:fTe,filledTrack:gTe(r),track:mTe(r)})),ETe={xs:Ob({track:{h:"1"}}),sm:Ob({track:{h:"2"}}),md:Ob({track:{h:"3"}}),lg:Ob({track:{h:"4"}})},vTe=hTe({sizes:ETe,baseStyle:_Te,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:yTe,definePartsStyle:xO}=Ti(yEe.keys),STe=r=>{var s;const t=(s=Ba(gm.baseStyle,r))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},TTe=xO(r=>{var t,s;return{label:(t=gm.baseStyle)==null?void 0:t.call(gm,r).label,container:(s=gm.baseStyle)==null?void 0:s.call(gm,r).container,control:STe(r)}}),bTe={md:xO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:xO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:xO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},wTe=yTe({baseStyle:TTe,sizes:bTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:RTe,definePartsStyle:CTe}=Ti(SEe.keys),sO=wn("select-bg");var zY;const ITe={...(zY=Hr.baseStyle)==null?void 0:zY.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:sO.reference,[sO.variable]:"colors.white",_dark:{[sO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:sO.reference}},ATe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},OTe=CTe({field:ITe,icon:ATe}),oO={paddingInlineEnd:"8"};var HY,KY,$Y,qY,YY,XY,JY,QY;const PTe={lg:{...(HY=Hr.sizes)==null?void 0:HY.lg,field:{...(KY=Hr.sizes)==null?void 0:KY.lg.field,...oO}},md:{...($Y=Hr.sizes)==null?void 0:$Y.md,field:{...(qY=Hr.sizes)==null?void 0:qY.md.field,...oO}},sm:{...(YY=Hr.sizes)==null?void 0:YY.sm,field:{...(XY=Hr.sizes)==null?void 0:XY.sm.field,...oO}},xs:{...(JY=Hr.sizes)==null?void 0:JY.xs,field:{...(QY=Hr.sizes)==null?void 0:QY.xs.field,...oO},icon:{insetEnd:"1"}}},NTe=RTe({baseStyle:OTe,sizes:PTe,variants:Hr.variants,defaultProps:Hr.defaultProps}),Fx=wn("skeleton-start-color"),jx=wn("skeleton-end-color"),kTe={[Fx.variable]:"colors.gray.100",[jx.variable]:"colors.gray.400",_dark:{[Fx.variable]:"colors.gray.800",[jx.variable]:"colors.gray.600"},background:Fx.reference,borderColor:jx.reference,opacity:.7,borderRadius:"sm"},DTe={baseStyle:kTe},Bx=wn("skip-link-bg"),LTe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[Bx.variable]:"colors.white",_dark:{[Bx.variable]:"colors.gray.700"},bg:Bx.reference}},xTe={baseStyle:LTe},{defineMultiStyleConfig:MTe,definePartsStyle:eN}=Ti(TEe.keys),j_=wn("slider-thumb-size"),pw=wn("slider-track-size"),_m=wn("slider-bg"),UTe=r=>{const{orientation:t}=r;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...wU({orientation:t,vertical:{h:"100%",px:Op(j_.reference).divide(2).toString()},horizontal:{w:"100%",py:Op(j_.reference).divide(2).toString()}})}},VTe=r=>({...wU({orientation:r.orientation,horizontal:{h:pw.reference},vertical:{w:pw.reference}}),overflow:"hidden",borderRadius:"sm",[_m.variable]:"colors.gray.200",_dark:{[_m.variable]:"colors.whiteAlpha.200"},_disabled:{[_m.variable]:"colors.gray.300",_dark:{[_m.variable]:"colors.whiteAlpha.300"}},bg:_m.reference}),FTe=r=>{const{orientation:t}=r;return{...wU({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:j_.reference,h:j_.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},jTe=r=>{const{colorScheme:t}=r;return{width:"inherit",height:"inherit",[_m.variable]:`colors.${t}.500`,_dark:{[_m.variable]:`colors.${t}.200`},bg:_m.reference}},BTe=eN(r=>({container:UTe(r),track:VTe(r),thumb:FTe(r),filledTrack:jTe(r)})),WTe=eN({container:{[j_.variable]:"sizes.4",[pw.variable]:"sizes.1"}}),GTe=eN({container:{[j_.variable]:"sizes.3.5",[pw.variable]:"sizes.1"}}),zTe=eN({container:{[j_.variable]:"sizes.2.5",[pw.variable]:"sizes.0.5"}}),HTe={lg:WTe,md:GTe,sm:zTe},KTe=MTe({baseStyle:BTe,sizes:HTe,defaultProps:{size:"md",colorScheme:"blue"}}),R_=Ys("spinner-size"),$Te={width:[R_.reference],height:[R_.reference]},qTe={xs:{[R_.variable]:"sizes.3"},sm:{[R_.variable]:"sizes.4"},md:{[R_.variable]:"sizes.6"},lg:{[R_.variable]:"sizes.8"},xl:{[R_.variable]:"sizes.12"}},YTe={baseStyle:$Te,sizes:qTe,defaultProps:{size:"md"}},{defineMultiStyleConfig:XTe,definePartsStyle:HX}=Ti(bEe.keys),JTe={fontWeight:"medium"},QTe={opacity:.8,marginBottom:"2"},ZTe={verticalAlign:"baseline",fontWeight:"semibold"},e0e={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},t0e=HX({container:{},label:JTe,helpText:QTe,number:ZTe,icon:e0e}),n0e={md:HX({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},r0e=XTe({baseStyle:t0e,sizes:n0e,defaultProps:{size:"md"}}),{defineMultiStyleConfig:i0e,definePartsStyle:Pb}=Ti(["stepper","step","title","description","indicator","separator","icon","number"]),Np=wn("stepper-indicator-size"),Vy=wn("stepper-icon-size"),Fy=wn("stepper-title-font-size"),Nb=wn("stepper-description-font-size"),cb=wn("stepper-accent-color"),s0e=Pb(({colorScheme:r})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[cb.variable]:`colors.${r}.500`,_dark:{[cb.variable]:`colors.${r}.200`}},title:{fontSize:Fy.reference,fontWeight:"medium"},description:{fontSize:Nb.reference,color:"chakra-subtle-text"},number:{fontSize:Fy.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:Vy.reference,height:Vy.reference},indicator:{flexShrink:0,borderRadius:"full",width:Np.reference,height:Np.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:cb.reference},"&[data-status=complete]":{bg:cb.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:cb.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Np.reference} - 8px)`,top:`calc(${Np.reference} + 4px)`,insetStart:`calc(${Np.reference} / 2 - 1px)`}}})),o0e=i0e({baseStyle:s0e,sizes:{xs:Pb({stepper:{[Np.variable]:"sizes.4",[Vy.variable]:"sizes.3",[Fy.variable]:"fontSizes.xs",[Nb.variable]:"fontSizes.xs"}}),sm:Pb({stepper:{[Np.variable]:"sizes.6",[Vy.variable]:"sizes.4",[Fy.variable]:"fontSizes.sm",[Nb.variable]:"fontSizes.xs"}}),md:Pb({stepper:{[Np.variable]:"sizes.8",[Vy.variable]:"sizes.5",[Fy.variable]:"fontSizes.md",[Nb.variable]:"fontSizes.sm"}}),lg:Pb({stepper:{[Np.variable]:"sizes.10",[Vy.variable]:"sizes.6",[Fy.variable]:"fontSizes.lg",[Nb.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:a0e,definePartsStyle:MO}=Ti(wEe.keys),Jb=Ys("switch-track-width"),k_=Ys("switch-track-height"),Wx=Ys("switch-track-diff"),c0e=Pp.subtract(Jb,k_),QM=Ys("switch-thumb-x"),lb=Ys("switch-bg"),l0e=r=>{const{colorScheme:t}=r;return{borderRadius:"full",p:"0.5",width:[Jb.reference],height:[k_.reference],transitionProperty:"common",transitionDuration:"fast",[lb.variable]:"colors.gray.300",_dark:{[lb.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[lb.variable]:`colors.${t}.500`,_dark:{[lb.variable]:`colors.${t}.200`}},bg:lb.reference}},u0e={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[k_.reference],height:[k_.reference],_checked:{transform:`translateX(${QM.reference})`}},d0e=MO(r=>({container:{[Wx.variable]:c0e,[QM.variable]:Wx.reference,_rtl:{[QM.variable]:Pp(Wx).negate().toString()}},track:l0e(r),thumb:u0e})),h0e={sm:MO({container:{[Jb.variable]:"1.375rem",[k_.variable]:"sizes.3"}}),md:MO({container:{[Jb.variable]:"1.875rem",[k_.variable]:"sizes.4"}}),lg:MO({container:{[Jb.variable]:"2.875rem",[k_.variable]:"sizes.6"}})},p0e=a0e({baseStyle:d0e,sizes:h0e,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:f0e,definePartsStyle:Zy}=Ti(REe.keys),m0e=Zy({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),fP={"&[data-is-numeric=true]":{textAlign:"end"}},g0e=Zy(r=>{const{colorScheme:t}=r;return{th:{color:Tn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:Tn(`${t}.100`,`${t}.700`)(r),...fP},td:{borderBottom:"1px",borderColor:Tn(`${t}.100`,`${t}.700`)(r),...fP},caption:{color:Tn("gray.600","gray.100")(r)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),_0e=Zy(r=>{const{colorScheme:t}=r;return{th:{color:Tn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:Tn(`${t}.100`,`${t}.700`)(r),...fP},td:{borderBottom:"1px",borderColor:Tn(`${t}.100`,`${t}.700`)(r),...fP},caption:{color:Tn("gray.600","gray.100")(r)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Tn(`${t}.100`,`${t}.700`)(r)},td:{background:Tn(`${t}.100`,`${t}.700`)(r)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),E0e={simple:g0e,striped:_0e,unstyled:{}},v0e={sm:Zy({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:Zy({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:Zy({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},y0e=f0e({baseStyle:m0e,variants:E0e,sizes:v0e,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Ic=wn("tabs-color"),ed=wn("tabs-bg"),aO=wn("tabs-border-color"),{defineMultiStyleConfig:S0e,definePartsStyle:dh}=Ti(CEe.keys),T0e=r=>{const{orientation:t}=r;return{display:t==="vertical"?"flex":"block"}},b0e=r=>{const{isFitted:t}=r;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},w0e=r=>{const{align:t="start",orientation:s}=r;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},R0e={p:4},C0e=dh(r=>({root:T0e(r),tab:b0e(r),tablist:w0e(r),tabpanel:R0e})),I0e={sm:dh({tab:{py:1,px:4,fontSize:"sm"}}),md:dh({tab:{fontSize:"md",py:2,px:4}}),lg:dh({tab:{fontSize:"lg",py:3,px:4}})},A0e=dh(r=>{const{colorScheme:t,orientation:s}=r,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Ic.variable]:`colors.${t}.600`,_dark:{[Ic.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[ed.variable]:"colors.gray.200",_dark:{[ed.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Ic.reference,bg:ed.reference}}}),O0e=dh(r=>{const{colorScheme:t}=r;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[aO.variable]:"transparent",_selected:{[Ic.variable]:`colors.${t}.600`,[aO.variable]:"colors.white",_dark:{[Ic.variable]:`colors.${t}.300`,[aO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:aO.reference},color:Ic.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),P0e=dh(r=>{const{colorScheme:t}=r;return{tab:{border:"1px solid",borderColor:"inherit",[ed.variable]:"colors.gray.50",_dark:{[ed.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[ed.variable]:"colors.white",[Ic.variable]:`colors.${t}.600`,_dark:{[ed.variable]:"colors.gray.800",[Ic.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Ic.reference,bg:ed.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),N0e=dh(r=>{const{colorScheme:t,theme:s}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:ja(s,`${t}.700`),bg:ja(s,`${t}.100`)}}}}),k0e=dh(r=>{const{colorScheme:t}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",[Ic.variable]:"colors.gray.600",_dark:{[Ic.variable]:"inherit"},_selected:{[Ic.variable]:"colors.white",[ed.variable]:`colors.${t}.600`,_dark:{[Ic.variable]:"colors.gray.800",[ed.variable]:`colors.${t}.300`}},color:Ic.reference,bg:ed.reference}}}),D0e=dh({}),L0e={line:A0e,enclosed:O0e,"enclosed-colored":P0e,"soft-rounded":N0e,"solid-rounded":k0e,unstyled:D0e},x0e=S0e({baseStyle:C0e,sizes:I0e,variants:L0e,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:M0e,definePartsStyle:D_}=Ti(IEe.keys),vK=wn("tag-bg"),yK=wn("tag-color"),Gx=wn("tag-shadow"),UO=wn("tag-min-height"),VO=wn("tag-min-width"),FO=wn("tag-font-size"),jO=wn("tag-padding-inline"),U0e={fontWeight:"medium",lineHeight:1.2,outline:0,[yK.variable]:Ss.color.reference,[vK.variable]:Ss.bg.reference,[Gx.variable]:Ss.shadow.reference,color:yK.reference,bg:vK.reference,boxShadow:Gx.reference,borderRadius:"md",minH:UO.reference,minW:VO.reference,fontSize:FO.reference,px:jO.reference,_focusVisible:{[Gx.variable]:"shadows.outline"}},V0e={lineHeight:1.2,overflow:"visible"},F0e={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},j0e=D_({container:U0e,label:V0e,closeButton:F0e}),B0e={sm:D_({container:{[UO.variable]:"sizes.5",[VO.variable]:"sizes.5",[FO.variable]:"fontSizes.xs",[jO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:D_({container:{[UO.variable]:"sizes.6",[VO.variable]:"sizes.6",[FO.variable]:"fontSizes.sm",[jO.variable]:"space.2"}}),lg:D_({container:{[UO.variable]:"sizes.8",[VO.variable]:"sizes.8",[FO.variable]:"fontSizes.md",[jO.variable]:"space.3"}})},W0e={subtle:D_(r=>{var t;return{container:(t=qb.variants)==null?void 0:t.subtle(r)}}),solid:D_(r=>{var t;return{container:(t=qb.variants)==null?void 0:t.solid(r)}}),outline:D_(r=>{var t;return{container:(t=qb.variants)==null?void 0:t.outline(r)}})},G0e=M0e({variants:W0e,baseStyle:j0e,sizes:B0e,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var ZY;const z0e={...(ZY=Hr.baseStyle)==null?void 0:ZY.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var eX;const H0e={outline:r=>{var t;return((t=Hr.variants)==null?void 0:t.outline(r).field)??{}},flushed:r=>{var t;return((t=Hr.variants)==null?void 0:t.flushed(r).field)??{}},filled:r=>{var t;return((t=Hr.variants)==null?void 0:t.filled(r).field)??{}},unstyled:((eX=Hr.variants)==null?void 0:eX.unstyled.field)??{}};var tX,nX,rX,iX;const K0e={xs:((tX=Hr.sizes)==null?void 0:tX.xs.field)??{},sm:((nX=Hr.sizes)==null?void 0:nX.sm.field)??{},md:((rX=Hr.sizes)==null?void 0:rX.md.field)??{},lg:((iX=Hr.sizes)==null?void 0:iX.lg.field)??{}},$0e={baseStyle:z0e,sizes:K0e,variants:H0e,defaultProps:{size:"md",variant:"outline"}},cO=Ys("tooltip-bg"),zx=Ys("tooltip-fg"),q0e=Ys("popper-arrow-bg"),Y0e={bg:cO.reference,color:zx.reference,[cO.variable]:"colors.gray.700",[zx.variable]:"colors.whiteAlpha.900",_dark:{[cO.variable]:"colors.gray.300",[zx.variable]:"colors.gray.900"},[q0e.variable]:cO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},X0e={baseStyle:Y0e},J0e={Accordion:MEe,Alert:vve,Avatar:Pve,Badge:qb,Breadcrumb:jve,Button:Yve,Checkbox:gm,CloseButton:uye,Code:fye,Container:gye,Divider:Sye,Drawer:kye,Editable:Fye,Form:Hye,FormError:Jye,FormLabel:Zye,Heading:nSe,Input:Hr,Kbd:hSe,Link:fSe,List:vSe,Menu:PSe,Modal:BSe,NumberInput:XSe,PinInput:eTe,Popover:dTe,Progress:vTe,Radio:wTe,Select:NTe,Skeleton:DTe,SkipLink:xTe,Slider:KTe,Spinner:YTe,Stat:r0e,Switch:p0e,Table:y0e,Tabs:x0e,Tag:G0e,Textarea:$0e,Tooltip:X0e,Card:eye,Stepper:o0e},Q0e={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},Z0e={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},ebe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},tbe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},nbe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},rbe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},ibe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},sbe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},obe={property:rbe,easing:ibe,duration:sbe},abe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},cbe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},lbe={breakpoints:Z0e,zIndices:abe,radii:tbe,blur:cbe,colors:ebe,...WX,sizes:MX,shadows:nbe,space:xX,borders:Q0e,transition:obe},ube={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},dbe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},hbe="ltr",pbe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},fbe={semanticTokens:ube,direction:hbe,...lbe,components:J0e,styles:dbe,config:pbe};function mbe(r){if(r.sheet)return r.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===r)return document.styleSheets[t]}function gbe(r){var t=document.createElement("style");return t.setAttribute("data-emotion",r.key),r.nonce!==void 0&&t.setAttribute("nonce",r.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var _be=function(){function r(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=r.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(gbe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=mbe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},r}(),ma="-ms-",mP="-moz-",Gr="-webkit-",KX="comm",AU="rule",OU="decl",Ebe="@import",$X="@keyframes",vbe="@layer",ybe=Math.abs,tN=String.fromCharCode,Sbe=Object.assign;function Tbe(r,t){return Go(r,0)^45?(((t<<2^Go(r,0))<<2^Go(r,1))<<2^Go(r,2))<<2^Go(r,3):0}function qX(r){return r.trim()}function bbe(r,t){return(r=t.exec(r))?r[0]:r}function zr(r,t,s){return r.replace(t,s)}function ZM(r,t){return r.indexOf(t)}function Go(r,t){return r.charCodeAt(t)|0}function fw(r,t,s){return r.slice(t,s)}function ih(r){return r.length}function PU(r){return r.length}function lO(r,t){return t.push(r),r}function wbe(r,t){return r.map(t).join("")}var nN=1,uS=1,YX=0,Lc=0,Ns=0,PS="";function rN(r,t,s,a,l,d,g){return{value:r,root:t,parent:s,type:a,props:l,children:d,line:nN,column:uS,length:g,return:""}}function ub(r,t){return Sbe(rN("",null,null,"",null,null,0),r,{length:-r.length},t)}function Rbe(){return Ns}function Cbe(){return Ns=Lc>0?Go(PS,--Lc):0,uS--,Ns===10&&(uS=1,nN--),Ns}function ul(){return Ns=Lc<YX?Go(PS,Lc++):0,uS++,Ns===10&&(uS=1,nN++),Ns}function hh(){return Go(PS,Lc)}function BO(){return Lc}function Gw(r,t){return fw(PS,r,t)}function mw(r){switch(r){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function XX(r){return nN=uS=1,YX=ih(PS=r),Lc=0,[]}function JX(r){return PS="",r}function WO(r){return qX(Gw(Lc-1,e2(r===91?r+2:r===40?r+1:r)))}function Ibe(r){for(;(Ns=hh())&&Ns<33;)ul();return mw(r)>2||mw(Ns)>3?"":" "}function Abe(r,t){for(;--t&&ul()&&!(Ns<48||Ns>102||Ns>57&&Ns<65||Ns>70&&Ns<97););return Gw(r,BO()+(t<6&&hh()==32&&ul()==32))}function e2(r){for(;ul();)switch(Ns){case r:return Lc;case 34:case 39:r!==34&&r!==39&&e2(Ns);break;case 40:r===41&&e2(r);break;case 92:ul();break}return Lc}function Obe(r,t){for(;ul()&&r+Ns!==57;)if(r+Ns===84&&hh()===47)break;return"/*"+Gw(t,Lc-1)+"*"+tN(r===47?r:ul())}function Pbe(r){for(;!mw(hh());)ul();return Gw(r,Lc)}function Nbe(r){return JX(GO("",null,null,null,[""],r=XX(r),0,[0],r))}function GO(r,t,s,a,l,d,g,E,S){for(var b=0,C=0,O=g,k=0,W=0,H=0,K=1,G=1,te=1,J=0,re="",fe=l,oe=d,be=a,Z=re;G;)switch(H=J,J=ul()){case 40:if(H!=108&&Go(Z,O-1)==58){ZM(Z+=zr(WO(J),"&","&\f"),"&\f")!=-1&&(te=-1);break}case 34:case 39:case 91:Z+=WO(J);break;case 9:case 10:case 13:case 32:Z+=Ibe(H);break;case 92:Z+=Abe(BO()-1,7);continue;case 47:switch(hh()){case 42:case 47:lO(kbe(Obe(ul(),BO()),t,s),S);break;default:Z+="/"}break;case 123*K:E[b++]=ih(Z)*te;case 125*K:case 59:case 0:switch(J){case 0:case 125:G=0;case 59+C:te==-1&&(Z=zr(Z,/\f/g,"")),W>0&&ih(Z)-O&&lO(W>32?TK(Z+";",a,s,O-1):TK(zr(Z," ","")+";",a,s,O-2),S);break;case 59:Z+=";";default:if(lO(be=SK(Z,t,s,b,C,l,E,re,fe=[],oe=[],O),d),J===123)if(C===0)GO(Z,t,be,be,fe,d,O,E,oe);else switch(k===99&&Go(Z,3)===110?100:k){case 100:case 108:case 109:case 115:GO(r,be,be,a&&lO(SK(r,be,be,0,0,l,E,re,l,fe=[],O),oe),l,oe,O,E,a?fe:oe);break;default:GO(Z,be,be,be,[""],oe,0,E,oe)}}b=C=W=0,K=te=1,re=Z="",O=g;break;case 58:O=1+ih(Z),W=H;default:if(K<1){if(J==123)--K;else if(J==125&&K++==0&&Cbe()==125)continue}switch(Z+=tN(J),J*K){case 38:te=C>0?1:(Z+="\f",-1);break;case 44:E[b++]=(ih(Z)-1)*te,te=1;break;case 64:hh()===45&&(Z+=WO(ul())),k=hh(),C=O=ih(re=Z+=Pbe(BO())),J++;break;case 45:H===45&&ih(Z)==2&&(K=0)}}return d}function SK(r,t,s,a,l,d,g,E,S,b,C){for(var O=l-1,k=l===0?d:[""],W=PU(k),H=0,K=0,G=0;H<a;++H)for(var te=0,J=fw(r,O+1,O=ybe(K=g[H])),re=r;te<W;++te)(re=qX(K>0?k[te]+" "+J:zr(J,/&\f/g,k[te])))&&(S[G++]=re);return rN(r,t,s,l===0?AU:E,S,b,C)}function kbe(r,t,s){return rN(r,t,s,KX,tN(Rbe()),fw(r,2,-2),0)}function TK(r,t,s,a){return rN(r,t,s,OU,fw(r,0,a),fw(r,a+1,-1),a)}function eS(r,t){for(var s="",a=PU(r),l=0;l<a;l++)s+=t(r[l],l,r,t)||"";return s}function Dbe(r,t,s,a){switch(r.type){case vbe:if(r.children.length)break;case Ebe:case OU:return r.return=r.return||r.value;case KX:return"";case $X:return r.return=r.value+"{"+eS(r.children,a)+"}";case AU:r.value=r.props.join(",")}return ih(s=eS(r.children,a))?r.return=r.value+"{"+s+"}":""}function Lbe(r){var t=PU(r);return function(s,a,l,d){for(var g="",E=0;E<t;E++)g+=r[E](s,a,l,d)||"";return g}}function xbe(r){return function(t){t.root||(t=t.return)&&r(t)}}var bK=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function QX(r){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=r(s)),t[s]}}var Mbe=function(t,s,a){for(var l=0,d=0;l=d,d=hh(),l===38&&d===12&&(s[a]=1),!mw(d);)ul();return Gw(t,Lc)},Ube=function(t,s){var a=-1,l=44;do switch(mw(l)){case 0:l===38&&hh()===12&&(s[a]=1),t[a]+=Mbe(Lc-1,s,a);break;case 2:t[a]+=WO(l);break;case 4:if(l===44){t[++a]=hh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=tN(l)}while(l=ul());return t},Vbe=function(t,s){return JX(Ube(XX(t),s))},wK=new WeakMap,Fbe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!wK.get(a))&&!l){wK.set(t,!0);for(var d=[],g=Vbe(s,d),E=a.props,S=0,b=0;S<g.length;S++)for(var C=0;C<E.length;C++,b++)t.props[b]=d[S]?g[S].replace(/&\f/g,E[C]):E[C]+" "+g[S]}}},jbe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function ZX(r,t){switch(Tbe(r,t)){case 5103:return Gr+"print-"+r+r;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Gr+r+r;case 5349:case 4246:case 4810:case 6968:case 2756:return Gr+r+mP+r+ma+r+r;case 6828:case 4268:return Gr+r+ma+r+r;case 6165:return Gr+r+ma+"flex-"+r+r;case 5187:return Gr+r+zr(r,/(\w+).+(:[^]+)/,Gr+"box-$1$2"+ma+"flex-$1$2")+r;case 5443:return Gr+r+ma+"flex-item-"+zr(r,/flex-|-self/,"")+r;case 4675:return Gr+r+ma+"flex-line-pack"+zr(r,/align-content|flex-|-self/,"")+r;case 5548:return Gr+r+ma+zr(r,"shrink","negative")+r;case 5292:return Gr+r+ma+zr(r,"basis","preferred-size")+r;case 6060:return Gr+"box-"+zr(r,"-grow","")+Gr+r+ma+zr(r,"grow","positive")+r;case 4554:return Gr+zr(r,/([^-])(transform)/g,"$1"+Gr+"$2")+r;case 6187:return zr(zr(zr(r,/(zoom-|grab)/,Gr+"$1"),/(image-set)/,Gr+"$1"),r,"")+r;case 5495:case 3959:return zr(r,/(image-set\([^]*)/,Gr+"$1$`$1");case 4968:return zr(zr(r,/(.+:)(flex-)?(.*)/,Gr+"box-pack:$3"+ma+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Gr+r+r;case 4095:case 3583:case 4068:case 2532:return zr(r,/(.+)-inline(.+)/,Gr+"$1$2")+r;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(ih(r)-1-t>6)switch(Go(r,t+1)){case 109:if(Go(r,t+4)!==45)break;case 102:return zr(r,/(.+:)(.+)-([^]+)/,"$1"+Gr+"$2-$3$1"+mP+(Go(r,t+3)==108?"$3":"$2-$3"))+r;case 115:return~ZM(r,"stretch")?ZX(zr(r,"stretch","fill-available"),t)+r:r}break;case 4949:if(Go(r,t+1)!==115)break;case 6444:switch(Go(r,ih(r)-3-(~ZM(r,"!important")&&10))){case 107:return zr(r,":",":"+Gr)+r;case 101:return zr(r,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Gr+(Go(r,14)===45?"inline-":"")+"box$3$1"+Gr+"$2$3$1"+ma+"$2box$3")+r}break;case 5936:switch(Go(r,t+11)){case 114:return Gr+r+ma+zr(r,/[svh]\w+-[tblr]{2}/,"tb")+r;case 108:return Gr+r+ma+zr(r,/[svh]\w+-[tblr]{2}/,"tb-rl")+r;case 45:return Gr+r+ma+zr(r,/[svh]\w+-[tblr]{2}/,"lr")+r}return Gr+r+ma+r+r}return r}var Bbe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case OU:t.return=ZX(t.value,t.length);break;case $X:return eS([ub(t,{value:zr(t.value,"@","@"+Gr)})],l);case AU:if(t.length)return wbe(t.props,function(d){switch(bbe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return eS([ub(t,{props:[zr(d,/:(read-\w+)/,":"+mP+"$1")]})],l);case"::placeholder":return eS([ub(t,{props:[zr(d,/:(plac\w+)/,":"+Gr+"input-$1")]}),ub(t,{props:[zr(d,/:(plac\w+)/,":"+mP+"$1")]}),ub(t,{props:[zr(d,/:(plac\w+)/,ma+"input-$1")]})],l)}return""})}},Wbe=[Bbe],Gbe=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(K){var G=K.getAttribute("data-emotion");G.indexOf(" ")!==-1&&(document.head.appendChild(K),K.setAttribute("data-s",""))})}var l=t.stylisPlugins||Wbe,d={},g,E=[];g=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(K){for(var G=K.getAttribute("data-emotion").split(" "),te=1;te<G.length;te++)d[G[te]]=!0;E.push(K)});var S,b=[Fbe,jbe];{var C,O=[Dbe,xbe(function(K){C.insert(K)})],k=Lbe(b.concat(l,O)),W=function(G){return eS(Nbe(G),k)};S=function(G,te,J,re){C=J,W(G?G+"{"+te.styles+"}":te.styles),re&&(H.inserted[te.name]=!0)}}var H={key:s,sheet:new _be({key:s,container:g,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:S};return H.sheet.hydrate(E),H};function B_(){return B_=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},B_.apply(null,arguments)}var Hx={exports:{}},Jr={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RK;function zbe(){if(RK)return Jr;RK=1;var r=typeof Symbol=="function"&&Symbol.for,t=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,d=r?Symbol.for("react.profiler"):60114,g=r?Symbol.for("react.provider"):60109,E=r?Symbol.for("react.context"):60110,S=r?Symbol.for("react.async_mode"):60111,b=r?Symbol.for("react.concurrent_mode"):60111,C=r?Symbol.for("react.forward_ref"):60112,O=r?Symbol.for("react.suspense"):60113,k=r?Symbol.for("react.suspense_list"):60120,W=r?Symbol.for("react.memo"):60115,H=r?Symbol.for("react.lazy"):60116,K=r?Symbol.for("react.block"):60121,G=r?Symbol.for("react.fundamental"):60117,te=r?Symbol.for("react.responder"):60118,J=r?Symbol.for("react.scope"):60119;function re(oe){if(typeof oe=="object"&&oe!==null){var be=oe.$$typeof;switch(be){case t:switch(oe=oe.type,oe){case S:case b:case a:case d:case l:case O:return oe;default:switch(oe=oe&&oe.$$typeof,oe){case E:case C:case H:case W:case g:return oe;default:return be}}case s:return be}}}function fe(oe){return re(oe)===b}return Jr.AsyncMode=S,Jr.ConcurrentMode=b,Jr.ContextConsumer=E,Jr.ContextProvider=g,Jr.Element=t,Jr.ForwardRef=C,Jr.Fragment=a,Jr.Lazy=H,Jr.Memo=W,Jr.Portal=s,Jr.Profiler=d,Jr.StrictMode=l,Jr.Suspense=O,Jr.isAsyncMode=function(oe){return fe(oe)||re(oe)===S},Jr.isConcurrentMode=fe,Jr.isContextConsumer=function(oe){return re(oe)===E},Jr.isContextProvider=function(oe){return re(oe)===g},Jr.isElement=function(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===t},Jr.isForwardRef=function(oe){return re(oe)===C},Jr.isFragment=function(oe){return re(oe)===a},Jr.isLazy=function(oe){return re(oe)===H},Jr.isMemo=function(oe){return re(oe)===W},Jr.isPortal=function(oe){return re(oe)===s},Jr.isProfiler=function(oe){return re(oe)===d},Jr.isStrictMode=function(oe){return re(oe)===l},Jr.isSuspense=function(oe){return re(oe)===O},Jr.isValidElementType=function(oe){return typeof oe=="string"||typeof oe=="function"||oe===a||oe===b||oe===d||oe===l||oe===O||oe===k||typeof oe=="object"&&oe!==null&&(oe.$$typeof===H||oe.$$typeof===W||oe.$$typeof===g||oe.$$typeof===E||oe.$$typeof===C||oe.$$typeof===G||oe.$$typeof===te||oe.$$typeof===J||oe.$$typeof===K)},Jr.typeOf=re,Jr}var CK;function Hbe(){return CK||(CK=1,Hx.exports=zbe()),Hx.exports}var Kx,IK;function Kbe(){if(IK)return Kx;IK=1;var r=Hbe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[r.ForwardRef]=a,d[r.Memo]=l;function g(H){return r.isMemo(H)?l:d[H.$$typeof]||t}var E=Object.defineProperty,S=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,O=Object.getPrototypeOf,k=Object.prototype;function W(H,K,G){if(typeof K!="string"){if(k){var te=O(K);te&&te!==k&&W(H,te,G)}var J=S(K);b&&(J=J.concat(b(K)));for(var re=g(H),fe=g(K),oe=0;oe<J.length;++oe){var be=J[oe];if(!s[be]&&!(G&&G[be])&&!(fe&&fe[be])&&!(re&&re[be])){var Z=C(K,be);try{E(H,be,Z)}catch{}}}}return H}return Kx=W,Kx}Kbe();var $be=!0;function eJ(r,t,s){var a="";return s.split(" ").forEach(function(l){r[l]!==void 0?t.push(r[l]+";"):l&&(a+=l+" ")}),a}var NU=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||$be===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},kU=function(t,s,a){NU(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function qbe(r){for(var t=0,s,a=0,l=r.length;l>=4;++a,l-=4)s=r.charCodeAt(a)&255|(r.charCodeAt(++a)&255)<<8|(r.charCodeAt(++a)&255)<<16|(r.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(r.charCodeAt(a+2)&255)<<16;case 2:t^=(r.charCodeAt(a+1)&255)<<8;case 1:t^=r.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var Ybe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Xbe=/[A-Z]|^ms/g,Jbe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,tJ=function(t){return t.charCodeAt(1)===45},AK=function(t){return t!=null&&typeof t!="boolean"},$x=QX(function(r){return tJ(r)?r:r.replace(Xbe,"-$&").toLowerCase()}),OK=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(Jbe,function(a,l,d){return sh={name:l,styles:d,next:sh},l})}return Ybe[t]!==1&&!tJ(t)&&typeof s=="number"&&s!==0?s+"px":s};function gw(r,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return sh={name:l.name,styles:l.styles,next:sh},l.name;var d=s;if(d.styles!==void 0){var g=d.next;if(g!==void 0)for(;g!==void 0;)sh={name:g.name,styles:g.styles,next:sh},g=g.next;var E=d.styles+";";return E}return Qbe(r,t,s)}case"function":{if(r!==void 0){var S=sh,b=s(r);return sh=S,gw(r,t,b)}break}}var C=s;if(t==null)return C;var O=t[C];return O!==void 0?O:C}function Qbe(r,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=gw(r,t,s[l])+";";else for(var d in s){var g=s[d];if(typeof g!="object"){var E=g;t!=null&&t[E]!==void 0?a+=d+"{"+t[E]+"}":AK(E)&&(a+=$x(d)+":"+OK(d,E)+";")}else if(Array.isArray(g)&&typeof g[0]=="string"&&(t==null||t[g[0]]===void 0))for(var S=0;S<g.length;S++)AK(g[S])&&(a+=$x(d)+":"+OK(d,g[S])+";");else{var b=gw(r,t,g);switch(d){case"animation":case"animationName":{a+=$x(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var PK=/label:\s*([^\s;{]+)\s*(;|$)/g,sh;function iN(r,t,s){if(r.length===1&&typeof r[0]=="object"&&r[0]!==null&&r[0].styles!==void 0)return r[0];var a=!0,l="";sh=void 0;var d=r[0];if(d==null||d.raw===void 0)a=!1,l+=gw(s,t,d);else{var g=d;l+=g[0]}for(var E=1;E<r.length;E++)if(l+=gw(s,t,r[E]),a){var S=d;l+=S[E]}PK.lastIndex=0;for(var b="",C;(C=PK.exec(l))!==null;)b+="-"+C[1];var O=qbe(l)+b;return{name:O,styles:l,next:sh}}var Zbe=function(t){return t()},nJ=z9.useInsertionEffect?z9.useInsertionEffect:!1,rJ=nJ||Zbe,NK=nJ||j.useLayoutEffect,DU=j.createContext(typeof HTMLElement<"u"?Gbe({key:"css"}):null);DU.Provider;var ewe=function(){return j.useContext(DU)},LU=function(t){return j.forwardRef(function(s,a){var l=j.useContext(DU);return t(s,l,a)})},dS=j.createContext({}),twe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return B_({},t,s)},nwe=bK(function(r){return bK(function(t){return twe(r,t)})}),rwe=function(t){var s=j.useContext(dS);return t.theme!==s&&(s=nwe(s)(t.theme)),j.createElement(dS.Provider,{value:s},t.children)},xU={}.hasOwnProperty,t2="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",iwe=function(t,s){var a={};for(var l in s)xU.call(s,l)&&(a[l]=s[l]);return a[t2]=t,a},swe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return NU(s,a,l),rJ(function(){return kU(s,a,l)}),null},owe=LU(function(r,t,s){var a=r.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=r[t2],d=[a],g="";typeof r.className=="string"?g=eJ(t.registered,d,r.className):r.className!=null&&(g=r.className+" ");var E=iN(d,void 0,j.useContext(dS));g+=t.key+"-"+E.name;var S={};for(var b in r)xU.call(r,b)&&b!=="css"&&b!==t2&&(S[b]=r[b]);return S.className=g,s&&(S.ref=s),j.createElement(j.Fragment,null,j.createElement(swe,{cache:t,serialized:E,isStringTag:typeof l=="string"}),j.createElement(l,S))}),awe=owe,kK=function(t,s){var a=arguments;if(s==null||!xU.call(s,"css"))return j.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=awe,d[1]=iwe(t,s);for(var g=2;g<l;g++)d[g]=a[g];return j.createElement.apply(null,d)};(function(r){var t;t||(t=r.JSX||(r.JSX={}))})(kK||(kK={}));var sN=LU(function(r,t){var s=r.styles,a=iN([s],void 0,j.useContext(dS)),l=j.useRef();return NK(function(){var d=t.key+"-global",g=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,S=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(g.before=t.sheet.tags[0]),S!==null&&(E=!0,S.setAttribute("data-emotion",d),g.hydrate([S])),l.current=[g,E],function(){g.flush()}},[t]),NK(function(){var d=l.current,g=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&kU(t,a.next,!0),g.tags.length){var S=g.tags[g.tags.length-1].nextElementSibling;g.before=S,g.flush()}t.insert("",a,g,!1)},[t,a.name]),null});function cwe(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return iN(t)}function zw(){var r=cwe.apply(void 0,arguments),t="animation-"+r.name;return{name:t,styles:"@keyframes "+t+"{"+r.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const MU=j.createContext({});MU.displayName="ColorModeContext";function oN(){const r=j.useContext(MU);if(r===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return r}function lwe(r,t){const{colorMode:s}=oN();return s==="dark"?t:r}const uO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function uwe(r={}){const{preventTransition:t=!0,nonce:s}=r,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?uO.dark:uO.light),document.body.classList.remove(l?uO.light:uO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),g=E=>{l(E.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(g):d.addEventListener("change",g),()=>{typeof d.removeListener=="function"?d.removeListener(g):d.removeEventListener("change",g)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const dwe="chakra-ui-color-mode";function hwe(r){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(r)||t}catch{}return s||t},set(t){try{localStorage.setItem(r,t)}catch{}}}}const pwe=hwe(dwe),DK=()=>{},fwe=Lme()?j.useLayoutEffect:j.useEffect;function LK(r,t){return r.type==="cookie"&&r.ssr?r.get(t):t}const iJ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:g}={},colorModeManager:E=pwe}=t,S=ewe(),b=d==="dark"?"dark":"light",[C,O]=j.useState(()=>LK(E,b)),[k,W]=j.useState(()=>LK(E)),{getSystemTheme:H,setClassName:K,setDataset:G,addListener:te}=j.useMemo(()=>uwe({preventTransition:g,nonce:S==null?void 0:S.nonce}),[g,S==null?void 0:S.nonce]),J=d==="system"&&!C?k:C,re=j.useCallback(be=>{const Z=be==="system"?H():be;O(Z),K(Z==="dark"),G(Z),E.set(Z)},[E,H,K,G]);fwe(()=>{d==="system"&&W(H())},[]),j.useEffect(()=>{const be=E.get();if(be){re(be);return}if(d==="system"){re("system");return}re(b)},[E,b,d,re]);const fe=j.useCallback(()=>{re(J==="dark"?"light":"dark")},[J,re]);j.useEffect(()=>{if(l)return te(re)},[l,te,re]);const oe=j.useMemo(()=>({colorMode:s??J,toggleColorMode:s?DK:fe,setColorMode:s?DK:re,forced:s!==void 0}),[J,fe,re,s]);return U.jsx(MU.Provider,{value:oe,children:a})};iJ.displayName="ColorModeProvider";const sJ=String.raw,oJ=sJ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,mwe=()=>U.jsx(sN,{styles:oJ}),gwe=({scope:r=""})=>U.jsx(sN,{styles:sJ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${r} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${r} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${r} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${r} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${r} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${r} :where(b, strong) {
        font-weight: bold;
      }

      ${r} small {
        font-size: 80%;
      }

      ${r} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${r} sub {
        bottom: -0.25em;
      }

      ${r} sup {
        top: -0.5em;
      }

      ${r} img {
        border-style: none;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${r} :where(button, input) {
        overflow: visible;
      }

      ${r} :where(button, select) {
        text-transform: none;
      }

      ${r} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${r} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${r} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${r} progress {
        vertical-align: baseline;
      }

      ${r} textarea {
        overflow: auto;
      }

      ${r} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${r} input[type="number"]::-webkit-inner-spin-button,
      ${r} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${r} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${r} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${r} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${r} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${r} details {
        display: block;
      }

      ${r} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${r} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${r} button {
        background: transparent;
        padding: 0;
      }

      ${r} fieldset {
        margin: 0;
        padding: 0;
      }

      ${r} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${r} textarea {
        resize: vertical;
      }

      ${r} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${r} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${r} table {
        border-collapse: collapse;
      }

      ${r} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${r} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${r} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${r} select::-ms-expand {
        display: none;
      }

      ${oJ}
    `});function _we(r){const{cssVarsRoot:t,theme:s,children:a}=r,l=j.useMemo(()=>rEe(s),[s]);return U.jsxs(rwe,{theme:l,children:[U.jsx(Ewe,{root:t}),a]})}function Ewe({root:r=":host, :root"}){const t=[r,"[data-theme]"].join(",");return U.jsx(sN,{styles:s=>({[t]:s.__cssVars})})}Li({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function vwe(){const{colorMode:r}=oN();return U.jsx(sN,{styles:t=>{const s=fX(t,"styles.global"),a=Oc(s,{theme:t,colorMode:r});return a?NX(a)(t):void 0}})}const[ywe,Swe]=Li({strict:!1,name:"PortalManagerContext"});function UU(r){const{children:t,zIndex:s}=r;return U.jsx(ywe,{value:{zIndex:s},children:t})}UU.displayName="PortalManager";const aJ=j.createContext({getDocument(){return document},getWindow(){return window}});aJ.displayName="EnvironmentContext";function cJ(r){const{children:t,environment:s,disabled:a}=r,l=j.useRef(null),d=j.useMemo(()=>s||{getDocument:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument)??document},getWindow:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument.defaultView)??window}},[s]),g=!a||!s;return U.jsxs(aJ.Provider,{value:d,children:[t,g&&U.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}cJ.displayName="EnvironmentProvider";const Twe=r=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:g={},environment:E,cssVarsRoot:S,disableEnvironment:b,disableGlobalStyle:C}=r,O=U.jsx(cJ,{environment:E,disabled:b,children:t});return U.jsx(_we,{theme:g,cssVarsRoot:S,children:U.jsxs(iJ,{colorModeManager:s,options:g.config,children:[d?U.jsx(gwe,{scope:l}):U.jsx(mwe,{}),!C&&U.jsx(vwe,{}),a?U.jsx(UU,{zIndex:a,children:O}):O]})})},VU=j.createContext({});function FU(r){const t=j.useRef(null);return t.current===null&&(t.current=r()),t.current}const Hw=j.createContext(null),jU=j.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});class bwe extends j.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function wwe({children:r,isPresent:t}){const s=j.useId(),a=j.useRef(null),l=j.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=j.useContext(jU);return j.useInsertionEffect(()=>{const{width:g,height:E,top:S,left:b}=l.current;if(t||!a.current||!g||!E)return;a.current.dataset.motionPopId=s;const C=document.createElement("style");return d&&(C.nonce=d),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${E}px !important;
            top: ${S}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[t]),U.jsx(bwe,{isPresent:t,childRef:a,sizeRef:l,children:j.cloneElement(r,{ref:a})})}const Rwe=({children:r,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:g})=>{const E=FU(Cwe),S=j.useId(),b=j.useCallback(O=>{E.set(O,!0);for(const k of E.values())if(!k)return;a&&a()},[E,a]),C=j.useMemo(()=>({id:S,initial:t,isPresent:s,custom:l,onExitComplete:b,register:O=>(E.set(O,!1),()=>E.delete(O))}),d?[Math.random(),b]:[s,b]);return j.useMemo(()=>{E.forEach((O,k)=>E.set(k,!1))},[s]),j.useEffect(()=>{!s&&!E.size&&a&&a()},[s]),g==="popLayout"&&(r=U.jsx(wwe,{isPresent:s,children:r})),U.jsx(Hw.Provider,{value:C,children:r})};function Cwe(){return new Map}function BU(r=!0){const t=j.useContext(Hw);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=j.useId();j.useEffect(()=>{r&&l(d)},[r]);const g=j.useCallback(()=>r&&a&&a(d),[d,a,r]);return!s&&a?[!1,g]:[!0]}function Iwe(){return Awe(j.useContext(Hw))}function Awe(r){return r===null?!0:r.isPresent}const dO=r=>r.key||"";function xK(r){const t=[];return j.Children.forEach(r,s=>{j.isValidElement(s)&&t.push(s)}),t}const WU=typeof window<"u",lJ=WU?j.useLayoutEffect:j.useEffect,NS=({children:r,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:g=!1})=>{const[E,S]=BU(g),b=j.useMemo(()=>xK(r),[r]),C=g&&!E?[]:b.map(dO),O=j.useRef(!0),k=j.useRef(b),W=FU(()=>new Map),[H,K]=j.useState(b),[G,te]=j.useState(b);lJ(()=>{O.current=!1,k.current=b;for(let fe=0;fe<G.length;fe++){const oe=dO(G[fe]);C.includes(oe)?W.delete(oe):W.get(oe)!==!0&&W.set(oe,!1)}},[G,C.length,C.join("-")]);const J=[];if(b!==H){let fe=[...b];for(let oe=0;oe<G.length;oe++){const be=G[oe],Z=dO(be);C.includes(Z)||(fe.splice(oe,0,be),J.push(be))}d==="wait"&&J.length&&(fe=J),te(xK(fe)),K(b);return}const{forceRender:re}=j.useContext(VU);return U.jsx(U.Fragment,{children:G.map(fe=>{const oe=dO(fe),be=g&&!E?!1:b===G||C.includes(oe),Z=()=>{if(W.has(oe))W.set(oe,!0);else return;let ne=!0;W.forEach(se=>{se||(ne=!1)}),ne&&(re==null||re(),te(k.current),g&&(S==null||S()),a&&a())};return U.jsx(Rwe,{isPresent:be,initial:!O.current||s?void 0:!1,custom:be?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:be?void 0:Z,children:fe},oe)})})},dl=r=>r;let uJ=dl;function GU(r){let t;return()=>(t===void 0&&(t=r()),t)}const hS=(r,t,s)=>{const a=t-r;return a===0?1:(s-r)/a},Up=r=>r*1e3,Vp=r=>r/1e3,Owe={useManualTiming:!1};function Pwe(r){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let g={delta:0,timestamp:0,isProcessing:!1};function E(b){d.has(b)&&(S.schedule(b),r()),b(g)}const S={schedule:(b,C=!1,O=!1)=>{const W=O&&a?t:s;return C&&d.add(b),W.has(b)||W.add(b),b},cancel:b=>{s.delete(b),d.delete(b)},process:b=>{if(g=b,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(E),t.clear(),a=!1,l&&(l=!1,S.process(b))}};return S}const hO=["read","resolveKeyframes","update","preRender","render","postRender"],Nwe=40;function dJ(r,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,g=hO.reduce((te,J)=>(te[J]=Pwe(d),te),{}),{read:E,resolveKeyframes:S,update:b,preRender:C,render:O,postRender:k}=g,W=()=>{const te=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(te-l.timestamp,Nwe),1),l.timestamp=te,l.isProcessing=!0,E.process(l),S.process(l),b.process(l),C.process(l),O.process(l),k.process(l),l.isProcessing=!1,s&&t&&(a=!1,r(W))},H=()=>{s=!0,a=!0,l.isProcessing||r(W)};return{schedule:hO.reduce((te,J)=>{const re=g[J];return te[J]=(fe,oe=!1,be=!1)=>(s||H(),re.schedule(fe,oe,be)),te},{}),cancel:te=>{for(let J=0;J<hO.length;J++)g[hO[J]].cancel(te)},state:l,steps:g}}const{schedule:Di,cancel:Nm,state:jo,steps:qx}=dJ(typeof requestAnimationFrame<"u"?requestAnimationFrame:dl,!0),hJ=j.createContext({strict:!1}),MK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},pS={};for(const r in MK)pS[r]={isEnabled:t=>MK[r].some(s=>!!t[s])};function kwe(r){for(const t in r)pS[t]={...pS[t],...r[t]}}const Dwe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function gP(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||Dwe.has(r)}let pJ=r=>!gP(r);function Lwe(r){r&&(pJ=t=>t.startsWith("on")?!gP(t):r(t))}try{Lwe(require("@emotion/is-prop-valid").default)}catch{}function xwe(r,t,s){const a={};for(const l in r)l==="values"&&typeof r.values=="object"||(pJ(l)||s===!0&&gP(l)||!t&&!gP(l)||r.draggable&&l.startsWith("onDrag"))&&(a[l]=r[l]);return a}function Mwe(r){if(typeof Proxy>"u")return r;const t=new Map,s=(...a)=>r(...a);return new Proxy(s,{get:(a,l)=>l==="create"?r:(t.has(l)||t.set(l,r(l)),t.get(l))})}const aN=j.createContext({});function _w(r){return typeof r=="string"||Array.isArray(r)}function cN(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}const zU=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],HU=["initial",...zU];function lN(r){return cN(r.animate)||HU.some(t=>_w(r[t]))}function fJ(r){return!!(lN(r)||r.variants)}function Uwe(r,t){if(lN(r)){const{initial:s,animate:a}=r;return{initial:s===!1||_w(s)?s:void 0,animate:_w(a)?a:void 0}}return r.inherit!==!1?t:{}}function Vwe(r){const{initial:t,animate:s}=Uwe(r,j.useContext(aN));return j.useMemo(()=>({initial:t,animate:s}),[UK(t),UK(s)])}function UK(r){return Array.isArray(r)?r.join(" "):r}const Fwe=Symbol.for("motionComponentSymbol");function jy(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function jwe(r,t,s){return j.useCallback(a=>{a&&r.onMount&&r.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):jy(s)&&(s.current=a))},[t])}const KU=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Bwe="framerAppearId",mJ="data-"+KU(Bwe),{schedule:$U}=dJ(queueMicrotask,!1),gJ=j.createContext({});function Wwe(r,t,s,a,l){var d,g;const{visualElement:E}=j.useContext(aN),S=j.useContext(hJ),b=j.useContext(Hw),C=j.useContext(jU).reducedMotion,O=j.useRef(null);a=a||S.renderer,!O.current&&a&&(O.current=a(r,{visualState:t,parent:E,props:s,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:C}));const k=O.current,W=j.useContext(gJ);k&&!k.projection&&l&&(k.type==="html"||k.type==="svg")&&Gwe(O.current,s,l,W);const H=j.useRef(!1);j.useInsertionEffect(()=>{k&&H.current&&k.update(s,b)});const K=s[mJ],G=j.useRef(!!K&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,K))&&((g=window.MotionHasOptimisedAnimation)===null||g===void 0?void 0:g.call(window,K)));return lJ(()=>{k&&(H.current=!0,window.MotionIsMounted=!0,k.updateFeatures(),$U.render(k.render),G.current&&k.animationState&&k.animationState.animateChanges())}),j.useEffect(()=>{k&&(!G.current&&k.animationState&&k.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{var te;(te=window.MotionHandoffMarkAsComplete)===null||te===void 0||te.call(window,K)}),G.current=!1))}),k}function Gwe(r,t,s,a){const{layoutId:l,layout:d,drag:g,dragConstraints:E,layoutScroll:S,layoutRoot:b}=t;r.projection=new s(r.latestValues,t["data-framer-portal-id"]?void 0:_J(r.parent)),r.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!g||E&&jy(E),visualElement:r,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:S,layoutRoot:b})}function _J(r){if(r)return r.options.allowProjection!==!1?r.projection:_J(r.parent)}function zwe({preloadedFeatures:r,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,g;r&&kwe(r);function E(b,C){let O;const k={...j.useContext(jU),...b,layoutId:Hwe(b)},{isStatic:W}=k,H=Vwe(b),K=a(b,W);if(!W&&WU){Kwe();const G=$we(k);O=G.MeasureLayout,H.visualElement=Wwe(l,K,k,t,G.ProjectionNode)}return U.jsxs(aN.Provider,{value:H,children:[O&&H.visualElement?U.jsx(O,{visualElement:H.visualElement,...k}):null,s(l,b,jwe(K,H.visualElement,C),K,W,H.visualElement)]})}E.displayName=`motion.${typeof l=="string"?l:`create(${(g=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&g!==void 0?g:""})`}`;const S=j.forwardRef(E);return S[Fwe]=l,S}function Hwe({layoutId:r}){const t=j.useContext(VU).id;return t&&r!==void 0?t+"-"+r:r}function Kwe(r,t){j.useContext(hJ).strict}function $we(r){const{drag:t,layout:s}=pS;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(r)||s!=null&&s.isEnabled(r)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const qwe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function qU(r){return typeof r!="string"||r.includes("-")?!1:!!(qwe.indexOf(r)>-1||/[A-Z]/u.test(r))}function VK(r){const t=[{},{}];return r==null||r.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function YU(r,t,s,a){if(typeof t=="function"){const[l,d]=VK(a);t=t(s!==void 0?s:r.custom,l,d)}if(typeof t=="string"&&(t=r.variants&&r.variants[t]),typeof t=="function"){const[l,d]=VK(a);t=t(s!==void 0?s:r.custom,l,d)}return t}const n2=r=>Array.isArray(r),Ywe=r=>!!(r&&typeof r=="object"&&r.mix&&r.toValue),Xwe=r=>n2(r)?r[r.length-1]||0:r,va=r=>!!(r&&r.getVelocity);function zO(r){const t=va(r)?r.get():r;return Ywe(t)?t.toValue():t}function Jwe({scrapeMotionValuesFromProps:r,createRenderState:t,onUpdate:s},a,l,d){const g={latestValues:Qwe(a,l,d,r),renderState:t()};return s&&(g.onMount=E=>s({props:a,current:E,...g}),g.onUpdate=E=>s(E)),g}const EJ=r=>(t,s)=>{const a=j.useContext(aN),l=j.useContext(Hw),d=()=>Jwe(r,t,a,l);return s?d():FU(d)};function Qwe(r,t,s,a){const l={},d=a(r,{});for(const k in d)l[k]=zO(d[k]);let{initial:g,animate:E}=r;const S=lN(r),b=fJ(r);t&&b&&!S&&r.inherit!==!1&&(g===void 0&&(g=t.initial),E===void 0&&(E=t.animate));let C=s?s.initial===!1:!1;C=C||g===!1;const O=C?E:g;if(O&&typeof O!="boolean"&&!cN(O)){const k=Array.isArray(O)?O:[O];for(let W=0;W<k.length;W++){const H=YU(r,k[W]);if(H){const{transitionEnd:K,transition:G,...te}=H;for(const J in te){let re=te[J];if(Array.isArray(re)){const fe=C?re.length-1:0;re=re[fe]}re!==null&&(l[J]=re)}for(const J in K)l[J]=K[J]}}}return l}const kS=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],eE=new Set(kS),vJ=r=>t=>typeof t=="string"&&t.startsWith(r),yJ=vJ("--"),Zwe=vJ("var(--"),XU=r=>Zwe(r)?eRe.test(r.split("/*")[0].trim()):!1,eRe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,SJ=(r,t)=>t&&typeof r=="number"?t.transform(r):r,Wp=(r,t,s)=>s>t?t:s<r?r:s,DS={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},Ew={...DS,transform:r=>Wp(0,1,r)},pO={...DS,default:1},Kw=r=>({test:t=>typeof t=="string"&&t.endsWith(r)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${r}`}),fm=Kw("deg"),ph=Kw("%"),On=Kw("px"),tRe=Kw("vh"),nRe=Kw("vw"),FK={...ph,parse:r=>ph.parse(r)/100,transform:r=>ph.transform(r*100)},rRe={borderWidth:On,borderTopWidth:On,borderRightWidth:On,borderBottomWidth:On,borderLeftWidth:On,borderRadius:On,radius:On,borderTopLeftRadius:On,borderTopRightRadius:On,borderBottomRightRadius:On,borderBottomLeftRadius:On,width:On,maxWidth:On,height:On,maxHeight:On,top:On,right:On,bottom:On,left:On,padding:On,paddingTop:On,paddingRight:On,paddingBottom:On,paddingLeft:On,margin:On,marginTop:On,marginRight:On,marginBottom:On,marginLeft:On,backgroundPositionX:On,backgroundPositionY:On},iRe={rotate:fm,rotateX:fm,rotateY:fm,rotateZ:fm,scale:pO,scaleX:pO,scaleY:pO,scaleZ:pO,skew:fm,skewX:fm,skewY:fm,distance:On,translateX:On,translateY:On,translateZ:On,x:On,y:On,z:On,perspective:On,transformPerspective:On,opacity:Ew,originX:FK,originY:FK,originZ:On},jK={...DS,transform:Math.round},JU={...rRe,...iRe,zIndex:jK,size:On,fillOpacity:Ew,strokeOpacity:Ew,numOctaves:jK},sRe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},oRe=kS.length;function aRe(r,t,s){let a="",l=!0;for(let d=0;d<oRe;d++){const g=kS[d],E=r[g];if(E===void 0)continue;let S=!0;if(typeof E=="number"?S=E===(g.startsWith("scale")?1:0):S=parseFloat(E)===0,!S||s){const b=SJ(E,JU[g]);if(!S){l=!1;const C=sRe[g]||g;a+=`${C}(${b}) `}s&&(t[g]=b)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function QU(r,t,s){const{style:a,vars:l,transformOrigin:d}=r;let g=!1,E=!1;for(const S in t){const b=t[S];if(eE.has(S)){g=!0;continue}else if(yJ(S)){l[S]=b;continue}else{const C=SJ(b,JU[S]);S.startsWith("origin")?(E=!0,d[S]=C):a[S]=C}}if(t.transform||(g||s?a.transform=aRe(t,r.transform,s):a.transform&&(a.transform="none")),E){const{originX:S="50%",originY:b="50%",originZ:C=0}=d;a.transformOrigin=`${S} ${b} ${C}`}}const cRe={offset:"stroke-dashoffset",array:"stroke-dasharray"},lRe={offset:"strokeDashoffset",array:"strokeDasharray"};function uRe(r,t,s=1,a=0,l=!0){r.pathLength=1;const d=l?cRe:lRe;r[d.offset]=On.transform(-a);const g=On.transform(t),E=On.transform(s);r[d.array]=`${g} ${E}`}function BK(r,t,s){return typeof r=="string"?r:On.transform(t+s*r)}function dRe(r,t,s){const a=BK(t,r.x,r.width),l=BK(s,r.y,r.height);return`${a} ${l}`}function ZU(r,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:g,pathSpacing:E=1,pathOffset:S=0,...b},C,O){if(QU(r,b,O),C){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:k,style:W,dimensions:H}=r;k.transform&&(H&&(W.transform=k.transform),delete k.transform),H&&(l!==void 0||d!==void 0||W.transform)&&(W.transformOrigin=dRe(H,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(k.x=t),s!==void 0&&(k.y=s),a!==void 0&&(k.scale=a),g!==void 0&&uRe(k,g,E,S,!1)}const eV=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),TJ=()=>({...eV(),attrs:{}}),tV=r=>typeof r=="string"&&r.toLowerCase()==="svg";function bJ(r,{style:t,vars:s},a,l){Object.assign(r.style,t,l&&l.getProjectionStyles(a));for(const d in s)r.style.setProperty(d,s[d])}const wJ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function RJ(r,t,s,a){bJ(r,t,void 0,a);for(const l in t.attrs)r.setAttribute(wJ.has(l)?l:KU(l),t.attrs[l])}const _P={};function hRe(r){Object.assign(_P,r)}function CJ(r,{layout:t,layoutId:s}){return eE.has(r)||r.startsWith("origin")||(t||s!==void 0)&&(!!_P[r]||r==="opacity")}function nV(r,t,s){var a;const{style:l}=r,d={};for(const g in l)(va(l[g])||t.style&&va(t.style[g])||CJ(g,r)||((a=s==null?void 0:s.getValue(g))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[g]=l[g]);return d}function IJ(r,t,s){const a=nV(r,t,s);for(const l in r)if(va(r[l])||va(t[l])){const d=kS.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=r[l]}return a}function pRe(r,t){try{t.dimensions=typeof r.getBBox=="function"?r.getBBox():r.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const WK=["x","y","width","height","cx","cy","r"],fRe={useVisualState:EJ({scrapeMotionValuesFromProps:IJ,createRenderState:TJ,onUpdate:({props:r,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!r.drag;if(!d){for(const E in l)if(eE.has(E)){d=!0;break}}if(!d)return;let g=!t;if(t)for(let E=0;E<WK.length;E++){const S=WK[E];r[S]!==t[S]&&(g=!0)}g&&Di.read(()=>{pRe(s,a),Di.render(()=>{ZU(a,l,tV(s.tagName),r.transformTemplate),RJ(s,a)})})}})},mRe={useVisualState:EJ({scrapeMotionValuesFromProps:nV,createRenderState:eV})};function AJ(r,t,s){for(const a in t)!va(t[a])&&!CJ(a,s)&&(r[a]=t[a])}function gRe({transformTemplate:r},t){return j.useMemo(()=>{const s=eV();return QU(s,t,r),Object.assign({},s.vars,s.style)},[t])}function _Re(r,t){const s=r.style||{},a={};return AJ(a,s,r),Object.assign(a,gRe(r,t)),a}function ERe(r,t){const s={},a=_Re(r,t);return r.drag&&r.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(s.tabIndex=0),s.style=a,s}function vRe(r,t,s,a){const l=j.useMemo(()=>{const d=TJ();return ZU(d,t,tV(a),r.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(r.style){const d={};AJ(d,r.style,r),l.style={...d,...l.style}}return l}function yRe(r=!1){return(s,a,l,{latestValues:d},g)=>{const S=(qU(s)?vRe:ERe)(a,d,g,s),b=xwe(a,typeof s=="string",r),C=s!==j.Fragment?{...b,...S,ref:l}:{},{children:O}=a,k=j.useMemo(()=>va(O)?O.get():O,[O]);return j.createElement(s,{...C,children:k})}}function SRe(r,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const g={...qU(a)?fRe:mRe,preloadedFeatures:r,useRender:yRe(l),createVisualElement:t,Component:a};return zwe(g)}}function OJ(r,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==r.length)return!1;for(let a=0;a<s;a++)if(t[a]!==r[a])return!1;return!0}function uN(r,t,s){const a=r.getProps();return YU(a,t,s!==void 0?s:a.custom,r)}const TRe=GU(()=>window.ScrollTimeline!==void 0);class bRe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(TRe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class wRe extends bRe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function rV(r,t){return r?r[t]||r.default||r:void 0}const r2=2e4;function PJ(r){let t=0;const s=50;let a=r.next(t);for(;!a.done&&t<r2;)t+=s,a=r.next(t);return t>=r2?1/0:t}function iV(r){return typeof r=="function"}function GK(r,t){r.timeline=t,r.onfinish=null}const sV=r=>Array.isArray(r)&&typeof r[0]=="number",RRe={linearEasing:void 0};function CRe(r,t){const s=GU(r);return()=>{var a;return(a=RRe[t])!==null&&a!==void 0?a:s()}}const EP=CRe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),NJ=(r,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=r(hS(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function kJ(r){return!!(typeof r=="function"&&EP()||!r||typeof r=="string"&&(r in i2||EP())||sV(r)||Array.isArray(r)&&r.every(kJ))}const kb=([r,t,s,a])=>`cubic-bezier(${r}, ${t}, ${s}, ${a})`,i2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:kb([0,.65,.55,1]),circOut:kb([.55,0,1,.45]),backIn:kb([.31,.01,.66,-.59]),backOut:kb([.33,1.53,.69,.99])};function DJ(r,t){if(r)return typeof r=="function"&&EP()?NJ(r,t):sV(r)?kb(r):Array.isArray(r)?r.map(s=>DJ(s,t)||i2.easeOut):i2[r]}const Zu={x:!1,y:!1};function LJ(){return Zu.x||Zu.y}function IRe(r,t,s){var a;if(r instanceof Element)return[r];if(typeof r=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(r);return d?Array.from(d):[]}return Array.from(r)}function xJ(r,t){const s=IRe(r),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function zK(r){return t=>{t.pointerType==="touch"||LJ()||r(t)}}function ARe(r,t,s={}){const[a,l,d]=xJ(r,s),g=zK(E=>{const{target:S}=E,b=t(E);if(typeof b!="function"||!S)return;const C=zK(O=>{b(O),S.removeEventListener("pointerleave",C)});S.addEventListener("pointerleave",C,l)});return a.forEach(E=>{E.addEventListener("pointerenter",g,l)}),d}const MJ=(r,t)=>t?r===t?!0:MJ(r,t.parentElement):!1,oV=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,ORe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function PRe(r){return ORe.has(r.tagName)||r.tabIndex!==-1}const Db=new WeakSet;function HK(r){return t=>{t.key==="Enter"&&r(t)}}function Yx(r,t){r.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const NRe=(r,t)=>{const s=r.currentTarget;if(!s)return;const a=HK(()=>{if(Db.has(s))return;Yx(s,"down");const l=HK(()=>{Yx(s,"up")}),d=()=>Yx(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function KK(r){return oV(r)&&!LJ()}function kRe(r,t,s={}){const[a,l,d]=xJ(r,s),g=E=>{const S=E.currentTarget;if(!KK(E)||Db.has(S))return;Db.add(S);const b=t(E),C=(W,H)=>{window.removeEventListener("pointerup",O),window.removeEventListener("pointercancel",k),!(!KK(W)||!Db.has(S))&&(Db.delete(S),typeof b=="function"&&b(W,{success:H}))},O=W=>{C(W,s.useGlobalTarget||MJ(S,W.target))},k=W=>{C(W,!1)};window.addEventListener("pointerup",O,l),window.addEventListener("pointercancel",k,l)};return a.forEach(E=>{!PRe(E)&&E.getAttribute("tabindex")===null&&(E.tabIndex=0),(s.useGlobalTarget?window:E).addEventListener("pointerdown",g,l),E.addEventListener("focus",b=>NRe(b,l),l)}),d}function DRe(r){return r==="x"||r==="y"?Zu[r]?null:(Zu[r]=!0,()=>{Zu[r]=!1}):Zu.x||Zu.y?null:(Zu.x=Zu.y=!0,()=>{Zu.x=Zu.y=!1})}const UJ=new Set(["width","height","top","left","right","bottom",...kS]);let HO;function LRe(){HO=void 0}const fh={now:()=>(HO===void 0&&fh.set(jo.isProcessing||Owe.useManualTiming?jo.timestamp:performance.now()),HO),set:r=>{HO=r,queueMicrotask(LRe)}};function aV(r,t){r.indexOf(t)===-1&&r.push(t)}function cV(r,t){const s=r.indexOf(t);s>-1&&r.splice(s,1)}class lV{constructor(){this.subscriptions=[]}add(t){return aV(this.subscriptions,t),()=>cV(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const g=this.subscriptions[d];g&&g(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function VJ(r,t){return t?r*(1e3/t):0}const $K=30,xRe=r=>!isNaN(parseFloat(r));class MRe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=fh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=fh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=xRe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new lV);const a=this.events[t].add(s);return t==="change"?()=>{a(),Di.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=fh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>$K)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,$K);return VJ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function vw(r,t){return new MRe(r,t)}function URe(r,t,s){r.hasValue(t)?r.getValue(t).set(s):r.addValue(t,vw(s))}function VRe(r,t){const s=uN(r,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const g in d){const E=Xwe(d[g]);URe(r,g,E)}}function FRe(r){return!!(va(r)&&r.add)}function s2(r,t){const s=r.getValue("willChange");if(FRe(s))return s.add(t)}function FJ(r){return r.props[mJ]}const jJ=(r,t,s)=>(((1-3*s+3*t)*r+(3*s-6*t))*r+3*t)*r,jRe=1e-7,BRe=12;function WRe(r,t,s,a,l){let d,g,E=0;do g=t+(s-t)/2,d=jJ(g,a,l)-r,d>0?s=g:t=g;while(Math.abs(d)>jRe&&++E<BRe);return g}function $w(r,t,s,a){if(r===t&&s===a)return dl;const l=d=>WRe(d,0,1,r,s);return d=>d===0||d===1?d:jJ(l(d),t,a)}const BJ=r=>t=>t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2,WJ=r=>t=>1-r(1-t),GJ=$w(.33,1.53,.69,.99),uV=WJ(GJ),zJ=BJ(uV),HJ=r=>(r*=2)<1?.5*uV(r):.5*(2-Math.pow(2,-10*(r-1))),dV=r=>1-Math.sin(Math.acos(r)),KJ=WJ(dV),$J=BJ(dV),qJ=r=>/^0[^.\s]+$/u.test(r);function GRe(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||qJ(r):!0}const Qb=r=>Math.round(r*1e5)/1e5,hV=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function zRe(r){return r==null}const HRe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,pV=(r,t)=>s=>!!(typeof s=="string"&&HRe.test(s)&&s.startsWith(r)||t&&!zRe(s)&&Object.prototype.hasOwnProperty.call(s,t)),YJ=(r,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,g,E]=a.match(hV);return{[r]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(g),alpha:E!==void 0?parseFloat(E):1}},KRe=r=>Wp(0,255,r),Xx={...DS,transform:r=>Math.round(KRe(r))},A_={test:pV("rgb","red"),parse:YJ("red","green","blue"),transform:({red:r,green:t,blue:s,alpha:a=1})=>"rgba("+Xx.transform(r)+", "+Xx.transform(t)+", "+Xx.transform(s)+", "+Qb(Ew.transform(a))+")"};function $Re(r){let t="",s="",a="",l="";return r.length>5?(t=r.substring(1,3),s=r.substring(3,5),a=r.substring(5,7),l=r.substring(7,9)):(t=r.substring(1,2),s=r.substring(2,3),a=r.substring(3,4),l=r.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const o2={test:pV("#"),parse:$Re,transform:A_.transform},By={test:pV("hsl","hue"),parse:YJ("hue","saturation","lightness"),transform:({hue:r,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(r)+", "+ph.transform(Qb(t))+", "+ph.transform(Qb(s))+", "+Qb(Ew.transform(a))+")"},ga={test:r=>A_.test(r)||o2.test(r)||By.test(r),parse:r=>A_.test(r)?A_.parse(r):By.test(r)?By.parse(r):o2.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?A_.transform(r):By.transform(r)},qRe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function YRe(r){var t,s;return isNaN(r)&&typeof r=="string"&&(((t=r.match(hV))===null||t===void 0?void 0:t.length)||0)+(((s=r.match(qRe))===null||s===void 0?void 0:s.length)||0)>0}const XJ="number",JJ="color",XRe="var",JRe="var(",qK="${}",QRe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function yw(r){const t=r.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(QRe,S=>(ga.test(S)?(a.color.push(d),l.push(JJ),s.push(ga.parse(S))):S.startsWith(JRe)?(a.var.push(d),l.push(XRe),s.push(S)):(a.number.push(d),l.push(XJ),s.push(parseFloat(S))),++d,qK)).split(qK);return{values:s,split:E,indexes:a,types:l}}function QJ(r){return yw(r).values}function ZJ(r){const{split:t,types:s}=yw(r),a=t.length;return l=>{let d="";for(let g=0;g<a;g++)if(d+=t[g],l[g]!==void 0){const E=s[g];E===XJ?d+=Qb(l[g]):E===JJ?d+=ga.transform(l[g]):d+=l[g]}return d}}const ZRe=r=>typeof r=="number"?0:r;function eCe(r){const t=QJ(r);return ZJ(r)(t.map(ZRe))}const km={test:YRe,parse:QJ,createTransformer:ZJ,getAnimatableNone:eCe},tCe=new Set(["brightness","contrast","saturate","opacity"]);function nCe(r){const[t,s]=r.slice(0,-1).split("(");if(t==="drop-shadow")return r;const[a]=s.match(hV)||[];if(!a)return r;const l=s.replace(a,"");let d=tCe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const rCe=/\b([a-z-]*)\(.*?\)/gu,a2={...km,getAnimatableNone:r=>{const t=r.match(rCe);return t?t.map(nCe).join(" "):r}},iCe={...JU,color:ga,backgroundColor:ga,outlineColor:ga,fill:ga,stroke:ga,borderColor:ga,borderTopColor:ga,borderRightColor:ga,borderBottomColor:ga,borderLeftColor:ga,filter:a2,WebkitFilter:a2},fV=r=>iCe[r];function eQ(r,t){let s=fV(r);return s!==a2&&(s=km),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const sCe=new Set(["auto","none","0"]);function oCe(r,t,s){let a=0,l;for(;a<r.length&&!l;){const d=r[a];typeof d=="string"&&!sCe.has(d)&&yw(d).values.length&&(l=r[a]),a++}if(l&&s)for(const d of t)r[d]=eQ(s,l)}const YK=r=>r===DS||r===On,XK=(r,t)=>parseFloat(r.split(", ")[t]),JK=(r,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return XK(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?XK(d[1],r):0}},aCe=new Set(["x","y","z"]),cCe=kS.filter(r=>!aCe.has(r));function lCe(r){const t=[];return cCe.forEach(s=>{const a=r.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const fS={width:({x:r},{paddingLeft:t="0",paddingRight:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),height:({y:r},{paddingTop:t="0",paddingBottom:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),top:(r,{top:t})=>parseFloat(t),left:(r,{left:t})=>parseFloat(t),bottom:({y:r},{top:t})=>parseFloat(t)+(r.max-r.min),right:({x:r},{left:t})=>parseFloat(t)+(r.max-r.min),x:JK(4,13),y:JK(5,14)};fS.translateX=fS.x;fS.translateY=fS.y;const L_=new Set;let c2=!1,l2=!1;function tQ(){if(l2){const r=Array.from(L_).filter(a=>a.needsMeasurement),t=new Set(r.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=lCe(a);l.length&&(s.set(a,l),a.render())}),r.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,g])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(g)})}),r.forEach(a=>a.measureEndState()),r.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}l2=!1,c2=!1,L_.forEach(r=>r.complete()),L_.clear()}function nQ(){L_.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(l2=!0)})}function uCe(){nQ(),tQ()}class mV{constructor(t,s,a,l,d,g=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=g}scheduleResolve(){this.isScheduled=!0,this.isAsync?(L_.add(this),c2||(c2=!0,Di.read(nQ),Di.resolveKeyframes(tQ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const g=l==null?void 0:l.get(),E=t[t.length-1];if(g!==void 0)t[0]=g;else if(a&&s){const S=a.readValue(s,E);S!=null&&(t[0]=S)}t[0]===void 0&&(t[0]=E),l&&g===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),L_.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,L_.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const rQ=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r),dCe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function hCe(r){const t=dCe.exec(r);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function iQ(r,t,s=1){const[a,l]=hCe(r);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const g=d.trim();return rQ(g)?parseFloat(g):g}return XU(l)?iQ(l,t,s+1):l}const sQ=r=>t=>t.test(r),pCe={test:r=>r==="auto",parse:r=>r},oQ=[DS,On,ph,fm,nRe,tRe,pCe],QK=r=>oQ.find(sQ(r));class aQ extends mV{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let S=0;S<t.length;S++){let b=t[S];if(typeof b=="string"&&(b=b.trim(),XU(b))){const C=iQ(b,s.current);C!==void 0&&(t[S]=C),S===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!UJ.has(a)||t.length!==2)return;const[l,d]=t,g=QK(l),E=QK(d);if(g!==E)if(YK(g)&&YK(E))for(let S=0;S<t.length;S++){const b=t[S];typeof b=="string"&&(t[S]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)GRe(t[l])&&a.push(l);a.length&&oCe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=fS[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const g=l.length-1,E=l[g];l[g]=fS[a](s.measureViewportBox(),window.getComputedStyle(s.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([S,b])=>{s.getValue(S).set(b)}),this.resolveNoneKeyframes()}}const ZK=(r,t)=>t==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(km.test(r)||r==="0")&&!r.startsWith("url("));function fCe(r){const t=r[0];if(r.length===1)return!0;for(let s=0;s<r.length;s++)if(r[s]!==t)return!0}function mCe(r,t,s,a){const l=r[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=r[r.length-1],g=ZK(l,t),E=ZK(d,t);return!g||!E?!1:fCe(r)||(s==="spring"||iV(s))&&a}const gCe=r=>r!==null;function dN(r,{repeat:t,repeatType:s="loop"},a){const l=r.filter(gCe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const _Ce=40;class cQ{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:g="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=fh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:g,...E},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>_Ce?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&uCe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=fh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:g,onComplete:E,onUpdate:S,isGenerator:b}=this.options;if(!b&&!mCe(t,a,l,d))if(g)this.options.duration=0;else{S&&S(dN(t,this.options,s)),E&&E(),this.resolveFinishedPromise();return}const C=this.initPlayback(t,s);C!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...C},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const Yi=(r,t,s)=>r+(t-r)*s;function Jx(r,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?r+(t-r)*6*s:s<1/2?t:s<2/3?r+(t-r)*(2/3-s)*6:r}function ECe({hue:r,saturation:t,lightness:s,alpha:a}){r/=360,t/=100,s/=100;let l=0,d=0,g=0;if(!t)l=d=g=s;else{const E=s<.5?s*(1+t):s+t-s*t,S=2*s-E;l=Jx(S,E,r+1/3),d=Jx(S,E,r),g=Jx(S,E,r-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(g*255),alpha:a}}function vP(r,t){return s=>s>0?t:r}const Qx=(r,t,s)=>{const a=r*r,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},vCe=[o2,A_,By],yCe=r=>vCe.find(t=>t.test(r));function e$(r){const t=yCe(r);if(!t)return!1;let s=t.parse(r);return t===By&&(s=ECe(s)),s}const t$=(r,t)=>{const s=e$(r),a=e$(t);if(!s||!a)return vP(r,t);const l={...s};return d=>(l.red=Qx(s.red,a.red,d),l.green=Qx(s.green,a.green,d),l.blue=Qx(s.blue,a.blue,d),l.alpha=Yi(s.alpha,a.alpha,d),A_.transform(l))},SCe=(r,t)=>s=>t(r(s)),qw=(...r)=>r.reduce(SCe),u2=new Set(["none","hidden"]);function TCe(r,t){return u2.has(r)?s=>s<=0?r:t:s=>s>=1?t:r}function bCe(r,t){return s=>Yi(r,t,s)}function gV(r){return typeof r=="number"?bCe:typeof r=="string"?XU(r)?vP:ga.test(r)?t$:CCe:Array.isArray(r)?lQ:typeof r=="object"?ga.test(r)?t$:wCe:vP}function lQ(r,t){const s=[...r],a=s.length,l=r.map((d,g)=>gV(d)(d,t[g]));return d=>{for(let g=0;g<a;g++)s[g]=l[g](d);return s}}function wCe(r,t){const s={...r,...t},a={};for(const l in s)r[l]!==void 0&&t[l]!==void 0&&(a[l]=gV(r[l])(r[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function RCe(r,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const g=t.types[d],E=r.indexes[g][l[g]],S=(s=r.values[E])!==null&&s!==void 0?s:0;a[d]=S,l[g]++}return a}const CCe=(r,t)=>{const s=km.createTransformer(t),a=yw(r),l=yw(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?u2.has(r)&&!l.values.length||u2.has(t)&&!a.values.length?TCe(r,t):qw(lQ(RCe(a,l),l.values),s):vP(r,t)};function uQ(r,t,s){return typeof r=="number"&&typeof t=="number"&&typeof s=="number"?Yi(r,t,s):gV(r)(r,t)}const ICe=5;function dQ(r,t,s){const a=Math.max(t-ICe,0);return VJ(s-r(a),t-a)}const ps={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},n$=.001;function ACe({duration:r=ps.duration,bounce:t=ps.bounce,velocity:s=ps.velocity,mass:a=ps.mass}){let l,d,g=1-t;g=Wp(ps.minDamping,ps.maxDamping,g),r=Wp(ps.minDuration,ps.maxDuration,Vp(r)),g<1?(l=b=>{const C=b*g,O=C*r,k=C-s,W=d2(b,g),H=Math.exp(-O);return n$-k/W*H},d=b=>{const O=b*g*r,k=O*s+s,W=Math.pow(g,2)*Math.pow(b,2)*r,H=Math.exp(-O),K=d2(Math.pow(b,2),g);return(-l(b)+n$>0?-1:1)*((k-W)*H)/K}):(l=b=>{const C=Math.exp(-b*r),O=(b-s)*r+1;return-.001+C*O},d=b=>{const C=Math.exp(-b*r),O=(s-b)*(r*r);return C*O});const E=5/r,S=PCe(l,d,E);if(r=Up(r),isNaN(S))return{stiffness:ps.stiffness,damping:ps.damping,duration:r};{const b=Math.pow(S,2)*a;return{stiffness:b,damping:g*2*Math.sqrt(a*b),duration:r}}}const OCe=12;function PCe(r,t,s){let a=s;for(let l=1;l<OCe;l++)a=a-r(a)/t(a);return a}function d2(r,t){return r*Math.sqrt(1-t*t)}const NCe=["duration","bounce"],kCe=["stiffness","damping","mass"];function r$(r,t){return t.some(s=>r[s]!==void 0)}function DCe(r){let t={velocity:ps.velocity,stiffness:ps.stiffness,damping:ps.damping,mass:ps.mass,isResolvedFromDuration:!1,...r};if(!r$(r,kCe)&&r$(r,NCe))if(r.visualDuration){const s=r.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*Wp(.05,1,1-(r.bounce||0))*Math.sqrt(l);t={...t,mass:ps.mass,stiffness:l,damping:d}}else{const s=ACe(r);t={...t,...s,mass:ps.mass},t.isResolvedFromDuration=!0}return t}function hQ(r=ps.visualDuration,t=ps.bounce){const s=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:t}:r;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],g=s.keyframes[s.keyframes.length-1],E={done:!1,value:d},{stiffness:S,damping:b,mass:C,duration:O,velocity:k,isResolvedFromDuration:W}=DCe({...s,velocity:-Vp(s.velocity||0)}),H=k||0,K=b/(2*Math.sqrt(S*C)),G=g-d,te=Vp(Math.sqrt(S/C)),J=Math.abs(G)<5;a||(a=J?ps.restSpeed.granular:ps.restSpeed.default),l||(l=J?ps.restDelta.granular:ps.restDelta.default);let re;if(K<1){const oe=d2(te,K);re=be=>{const Z=Math.exp(-K*te*be);return g-Z*((H+K*te*G)/oe*Math.sin(oe*be)+G*Math.cos(oe*be))}}else if(K===1)re=oe=>g-Math.exp(-te*oe)*(G+(H+te*G)*oe);else{const oe=te*Math.sqrt(K*K-1);re=be=>{const Z=Math.exp(-K*te*be),ne=Math.min(oe*be,300);return g-Z*((H+K*te*G)*Math.sinh(ne)+oe*G*Math.cosh(ne))/oe}}const fe={calculatedDuration:W&&O||null,next:oe=>{const be=re(oe);if(W)E.done=oe>=O;else{let Z=0;K<1&&(Z=oe===0?Up(H):dQ(re,oe,be));const ne=Math.abs(Z)<=a,se=Math.abs(g-be)<=l;E.done=ne&&se}return E.value=E.done?g:be,E},toString:()=>{const oe=Math.min(PJ(fe),r2),be=NJ(Z=>fe.next(oe*Z).value,oe,30);return oe+"ms "+be}};return fe}function i$({keyframes:r,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:g,min:E,max:S,restDelta:b=.5,restSpeed:C}){const O=r[0],k={done:!1,value:O},W=ne=>E!==void 0&&ne<E||S!==void 0&&ne>S,H=ne=>E===void 0?S:S===void 0||Math.abs(E-ne)<Math.abs(S-ne)?E:S;let K=s*t;const G=O+K,te=g===void 0?G:g(G);te!==G&&(K=te-O);const J=ne=>-K*Math.exp(-ne/a),re=ne=>te+J(ne),fe=ne=>{const se=J(ne),ue=re(ne);k.done=Math.abs(se)<=b,k.value=k.done?te:ue};let oe,be;const Z=ne=>{W(k.value)&&(oe=ne,be=hQ({keyframes:[k.value,H(k.value)],velocity:dQ(re,ne,k.value),damping:l,stiffness:d,restDelta:b,restSpeed:C}))};return Z(0),{calculatedDuration:null,next:ne=>{let se=!1;return!be&&oe===void 0&&(se=!0,fe(ne),Z(ne)),oe!==void 0&&ne>=oe?be.next(ne-oe):(!se&&fe(ne),k)}}}const LCe=$w(.42,0,1,1),xCe=$w(0,0,.58,1),pQ=$w(.42,0,.58,1),MCe=r=>Array.isArray(r)&&typeof r[0]!="number",UCe={linear:dl,easeIn:LCe,easeInOut:pQ,easeOut:xCe,circIn:dV,circInOut:$J,circOut:KJ,backIn:uV,backInOut:zJ,backOut:GJ,anticipate:HJ},s$=r=>{if(sV(r)){uJ(r.length===4);const[t,s,a,l]=r;return $w(t,s,a,l)}else if(typeof r=="string")return UCe[r];return r};function VCe(r,t,s){const a=[],l=s||uQ,d=r.length-1;for(let g=0;g<d;g++){let E=l(r[g],r[g+1]);if(t){const S=Array.isArray(t)?t[g]||dl:t;E=qw(S,E)}a.push(E)}return a}function FCe(r,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=r.length;if(uJ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const g=r[0]===r[1];r[0]>r[d-1]&&(r=[...r].reverse(),t=[...t].reverse());const E=VCe(t,a,l),S=E.length,b=C=>{if(g&&C<r[0])return t[0];let O=0;if(S>1)for(;O<r.length-2&&!(C<r[O+1]);O++);const k=hS(r[O],r[O+1],C);return E[O](k)};return s?C=>b(Wp(r[0],r[d-1],C)):b}function jCe(r,t){const s=r[r.length-1];for(let a=1;a<=t;a++){const l=hS(0,t,a);r.push(Yi(s,1,l))}}function BCe(r){const t=[0];return jCe(t,r.length-1),t}function WCe(r,t){return r.map(s=>s*t)}function GCe(r,t){return r.map(()=>t||pQ).splice(0,r.length-1)}function yP({duration:r=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=MCe(a)?a.map(s$):s$(a),d={done:!1,value:t[0]},g=WCe(s&&s.length===t.length?s:BCe(t),r),E=FCe(g,t,{ease:Array.isArray(l)?l:GCe(t,l)});return{calculatedDuration:r,next:S=>(d.value=E(S),d.done=S>=r,d)}}const zCe=r=>{const t=({timestamp:s})=>r(s);return{start:()=>Di.update(t,!0),stop:()=>Nm(t),now:()=>jo.isProcessing?jo.timestamp:fh.now()}},HCe={decay:i$,inertia:i$,tween:yP,keyframes:yP,spring:hQ},KCe=r=>r/100;class _V extends cQ{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:S}=this.options;S&&S()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,g=(l==null?void 0:l.KeyframeResolver)||mV,E=(S,b)=>this.onKeyframesResolved(S,b);this.resolver=new g(d,E,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:g=0}=this.options,E=iV(s)?s:HCe[s]||yP;let S,b;E!==yP&&typeof t[0]!="number"&&(S=qw(KCe,uQ(t[0],t[1])),t=[0,100]);const C=E({...this.options,keyframes:t});d==="mirror"&&(b=E({...this.options,keyframes:[...t].reverse(),velocity:-g})),C.calculatedDuration===null&&(C.calculatedDuration=PJ(C));const{calculatedDuration:O}=C,k=O+l,W=k*(a+1)-l;return{generator:C,mirroredGenerator:b,mapPercentToKeyframes:S,calculatedDuration:O,resolvedDuration:k,totalDuration:W}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:ne}=this.options;return{done:!0,value:ne[ne.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:g,mapPercentToKeyframes:E,keyframes:S,calculatedDuration:b,totalDuration:C,resolvedDuration:O}=a;if(this.startTime===null)return d.next(0);const{delay:k,repeat:W,repeatType:H,repeatDelay:K,onUpdate:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-C/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const te=this.currentTime-k*(this.speed>=0?1:-1),J=this.speed>=0?te<0:te>C;this.currentTime=Math.max(te,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let re=this.currentTime,fe=d;if(W){const ne=Math.min(this.currentTime,C)/O;let se=Math.floor(ne),ue=ne%1;!ue&&ne>=1&&(ue=1),ue===1&&se--,se=Math.min(se,W+1),!!(se%2)&&(H==="reverse"?(ue=1-ue,K&&(ue-=K/O)):H==="mirror"&&(fe=g)),re=Wp(0,1,ue)*O}const oe=J?{done:!1,value:S[0]}:fe.next(re);E&&(oe.value=E(oe.value));let{done:be}=oe;!J&&b!==null&&(be=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const Z=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&be);return Z&&l!==void 0&&(oe.value=dN(S,this.options,l)),G&&G(oe.value),Z&&this.finish(),oe}get duration(){const{resolved:t}=this;return t?Vp(t.calculatedDuration):0}get time(){return Vp(this.currentTime)}set time(t){t=Up(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=Vp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=zCe,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const $Ce=new Set(["opacity","clipPath","filter","transform"]);function qCe(r,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:g="loop",ease:E="easeInOut",times:S}={}){const b={[t]:s};S&&(b.offset=S);const C=DJ(E,l);return Array.isArray(C)&&(b.easing=C),r.animate(b,{delay:a,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:d+1,direction:g==="reverse"?"alternate":"normal"})}const YCe=GU(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),SP=10,XCe=2e4;function JCe(r){return iV(r.type)||r.type==="spring"||!kJ(r.ease)}function QCe(r,t){const s=new _V({...t,keyframes:r,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:r[0]};const l=[];let d=0;for(;!a.done&&d<XCe;)a=s.sample(d),l.push(a.value),d+=SP;return{times:void 0,keyframes:l,duration:d-SP,ease:"linear"}}const fQ={anticipate:HJ,backInOut:zJ,circInOut:$J};function ZCe(r){return r in fQ}class o$ extends cQ{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new aQ(d,(g,E)=>this.onKeyframesResolved(g,E),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:g,motionValue:E,name:S,startTime:b}=this.options;if(!E.owner||!E.owner.current)return!1;if(typeof d=="string"&&EP()&&ZCe(d)&&(d=fQ[d]),JCe(this.options)){const{onComplete:O,onUpdate:k,motionValue:W,element:H,...K}=this.options,G=QCe(t,K);t=G.keyframes,t.length===1&&(t[1]=t[0]),a=G.duration,l=G.times,d=G.ease,g="keyframes"}const C=qCe(E.owner.current,S,t,{...this.options,duration:a,times:l,ease:d});return C.startTime=b??this.calcStartTime(),this.pendingTimeline?(GK(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:O}=this.options;E.set(dN(t,this.options,s)),O&&O(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:a,times:l,type:g,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return Vp(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return Vp(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=Up(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return dl;const{animation:a}=s;GK(a,t)}return dl}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:g,times:E}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:C,onComplete:O,element:k,...W}=this.options,H=new _V({...W,keyframes:a,duration:l,type:d,ease:g,times:E,isGenerator:!0}),K=Up(this.time);b.setWithVelocity(H.sample(K-SP).value,H.sample(K).value,SP)}const{onStop:S}=this.options;S&&S(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:g,type:E}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:S,transformTemplate:b}=s.owner.getProps();return YCe()&&a&&$Ce.has(a)&&!S&&!b&&!l&&d!=="mirror"&&g!==0&&E!=="inertia"}}const eIe={type:"spring",stiffness:500,damping:25,restSpeed:10},tIe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),nIe={type:"keyframes",duration:.8},rIe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},iIe=(r,{keyframes:t})=>t.length>2?nIe:eE.has(r)?r.startsWith("scale")?tIe(t[1]):eIe:rIe;function sIe({when:r,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:g,repeatDelay:E,from:S,elapsed:b,...C}){return!!Object.keys(C).length}const EV=(r,t,s,a={},l,d)=>g=>{const E=rV(a,r)||{},S=E.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Up(S);let C={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-b,onUpdate:k=>{t.set(k),E.onUpdate&&E.onUpdate(k)},onComplete:()=>{g(),E.onComplete&&E.onComplete()},name:r,motionValue:t,element:d?void 0:l};sIe(E)||(C={...C,...iIe(r,C)}),C.duration&&(C.duration=Up(C.duration)),C.repeatDelay&&(C.repeatDelay=Up(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let O=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(O=!0)),O&&!d&&t.get()!==void 0){const k=dN(C.keyframes,E);if(k!==void 0)return Di.update(()=>{C.onUpdate(k),C.onComplete()}),new wRe([])}return!d&&o$.supports(C)?new o$(C):new _V(C)};function oIe({protectedKeys:r,needsAnimating:t},s){const a=r.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function mQ(r,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:g=r.getDefaultTransition(),transitionEnd:E,...S}=t;a&&(g=a);const b=[],C=l&&r.animationState&&r.animationState.getState()[l];for(const O in S){const k=r.getValue(O,(d=r.latestValues[O])!==null&&d!==void 0?d:null),W=S[O];if(W===void 0||C&&oIe(C,O))continue;const H={delay:s,...rV(g||{},O)};let K=!1;if(window.MotionHandoffAnimation){const te=FJ(r);if(te){const J=window.MotionHandoffAnimation(te,O,Di);J!==null&&(H.startTime=J,K=!0)}}s2(r,O),k.start(EV(O,k,W,r.shouldReduceMotion&&UJ.has(O)?{type:!1}:H,r,K));const G=k.animation;G&&b.push(G)}return E&&Promise.all(b).then(()=>{Di.update(()=>{E&&VRe(r,E)})}),b}function h2(r,t,s={}){var a;const l=uN(r,t,s.type==="exit"?(a=r.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=r.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const g=l?()=>Promise.all(mQ(r,l,s)):()=>Promise.resolve(),E=r.variantChildren&&r.variantChildren.size?(b=0)=>{const{delayChildren:C=0,staggerChildren:O,staggerDirection:k}=d;return aIe(r,t,C+b,O,k,s)}:()=>Promise.resolve(),{when:S}=d;if(S){const[b,C]=S==="beforeChildren"?[g,E]:[E,g];return b().then(()=>C())}else return Promise.all([g(),E(s.delay)])}function aIe(r,t,s=0,a=0,l=1,d){const g=[],E=(r.variantChildren.size-1)*a,S=l===1?(b=0)=>b*a:(b=0)=>E-b*a;return Array.from(r.variantChildren).sort(cIe).forEach((b,C)=>{b.notify("AnimationStart",t),g.push(h2(b,t,{...d,delay:s+S(C)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(g)}function cIe(r,t){return r.sortNodePosition(t)}function lIe(r,t,s={}){r.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>h2(r,d,s));a=Promise.all(l)}else if(typeof t=="string")a=h2(r,t,s);else{const l=typeof t=="function"?uN(r,t,s.custom):t;a=Promise.all(mQ(r,l,s))}return a.then(()=>{r.notify("AnimationComplete",t)})}const uIe=HU.length;function gQ(r){if(!r)return;if(!r.isControllingVariants){const s=r.parent?gQ(r.parent)||{}:{};return r.props.initial!==void 0&&(s.initial=r.props.initial),s}const t={};for(let s=0;s<uIe;s++){const a=HU[s],l=r.props[a];(_w(l)||l===!1)&&(t[a]=l)}return t}const dIe=[...zU].reverse(),hIe=zU.length;function pIe(r){return t=>Promise.all(t.map(({animation:s,options:a})=>lIe(r,s,a)))}function fIe(r){let t=pIe(r),s=a$(),a=!0;const l=S=>(b,C)=>{var O;const k=uN(r,C,S==="exit"?(O=r.presenceContext)===null||O===void 0?void 0:O.custom:void 0);if(k){const{transition:W,transitionEnd:H,...K}=k;b={...b,...K,...H}}return b};function d(S){t=S(r)}function g(S){const{props:b}=r,C=gQ(r.parent)||{},O=[],k=new Set;let W={},H=1/0;for(let G=0;G<hIe;G++){const te=dIe[G],J=s[te],re=b[te]!==void 0?b[te]:C[te],fe=_w(re),oe=te===S?J.isActive:null;oe===!1&&(H=G);let be=re===C[te]&&re!==b[te]&&fe;if(be&&a&&r.manuallyAnimateOnMount&&(be=!1),J.protectedKeys={...W},!J.isActive&&oe===null||!re&&!J.prevProp||cN(re)||typeof re=="boolean")continue;const Z=mIe(J.prevProp,re);let ne=Z||te===S&&J.isActive&&!be&&fe||G>H&&fe,se=!1;const ue=Array.isArray(re)?re:[re];let Ee=ue.reduce(l(te),{});oe===!1&&(Ee={});const{prevResolvedValues:he={}}=J,le={...he,...Ee},Me=Oe=>{ne=!0,k.has(Oe)&&(se=!0,k.delete(Oe)),J.needsAnimating[Oe]=!0;const Ue=r.getValue(Oe);Ue&&(Ue.liveStyle=!1)};for(const Oe in le){const Ue=Ee[Oe],xe=he[Oe];if(W.hasOwnProperty(Oe))continue;let it=!1;n2(Ue)&&n2(xe)?it=!OJ(Ue,xe):it=Ue!==xe,it?Ue!=null?Me(Oe):k.add(Oe):Ue!==void 0&&k.has(Oe)?Me(Oe):J.protectedKeys[Oe]=!0}J.prevProp=re,J.prevResolvedValues=Ee,J.isActive&&(W={...W,...Ee}),a&&r.blockInitialAnimation&&(ne=!1),ne&&(!(be&&Z)||se)&&O.push(...ue.map(Oe=>({animation:Oe,options:{type:te}})))}if(k.size){const G={};k.forEach(te=>{const J=r.getBaseTarget(te),re=r.getValue(te);re&&(re.liveStyle=!0),G[te]=J??null}),O.push({animation:G})}let K=!!O.length;return a&&(b.initial===!1||b.initial===b.animate)&&!r.manuallyAnimateOnMount&&(K=!1),a=!1,K?t(O):Promise.resolve()}function E(S,b){var C;if(s[S].isActive===b)return Promise.resolve();(C=r.variantChildren)===null||C===void 0||C.forEach(k=>{var W;return(W=k.animationState)===null||W===void 0?void 0:W.setActive(S,b)}),s[S].isActive=b;const O=g(S);for(const k in s)s[k].protectedKeys={};return O}return{animateChanges:g,setActive:E,setAnimateFunction:d,getState:()=>s,reset:()=>{s=a$(),a=!0}}}function mIe(r,t){return typeof t=="string"?t!==r:Array.isArray(t)?!OJ(t,r):!1}function E_(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function a$(){return{animate:E_(!0),whileInView:E_(),whileHover:E_(),whileTap:E_(),whileDrag:E_(),whileFocus:E_(),exit:E_()}}class Bm{constructor(t){this.isMounted=!1,this.node=t}update(){}}class gIe extends Bm{constructor(t){super(t),t.animationState||(t.animationState=fIe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();cN(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let _Ie=0;class EIe extends Bm{constructor(){super(...arguments),this.id=_Ie++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const vIe={animation:{Feature:gIe},exit:{Feature:EIe}};function Sw(r,t,s,a={passive:!0}){return r.addEventListener(t,s,a),()=>r.removeEventListener(t,s)}function Yw(r){return{point:{x:r.pageX,y:r.pageY}}}const yIe=r=>t=>oV(t)&&r(t,Yw(t));function Zb(r,t,s,a){return Sw(r,t,yIe(s),a)}const c$=(r,t)=>Math.abs(r-t);function SIe(r,t){const s=c$(r.x,t.x),a=c$(r.y,t.y);return Math.sqrt(s**2+a**2)}class _Q{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=eM(this.lastMoveEventInfo,this.history),k=this.startEvent!==null,W=SIe(O.offset,{x:0,y:0})>=3;if(!k&&!W)return;const{point:H}=O,{timestamp:K}=jo;this.history.push({...H,timestamp:K});const{onStart:G,onMove:te}=this.handlers;k||(G&&G(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),te&&te(this.lastMoveEvent,O)},this.handlePointerMove=(O,k)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=Zx(k,this.transformPagePoint),Di.update(this.updatePoint,!0)},this.handlePointerUp=(O,k)=>{this.end();const{onEnd:W,onSessionEnd:H,resumeAnimation:K}=this.handlers;if(this.dragSnapToOrigin&&K&&K(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const G=eM(O.type==="pointercancel"?this.lastMoveEventInfo:Zx(k,this.transformPagePoint),this.history);this.startEvent&&W&&W(O,G),H&&H(O,G)},!oV(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const g=Yw(t),E=Zx(g,this.transformPagePoint),{point:S}=E,{timestamp:b}=jo;this.history=[{...S,timestamp:b}];const{onSessionStart:C}=s;C&&C(t,eM(E,this.history)),this.removeListeners=qw(Zb(this.contextWindow,"pointermove",this.handlePointerMove),Zb(this.contextWindow,"pointerup",this.handlePointerUp),Zb(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Nm(this.updatePoint)}}function Zx(r,t){return t?{point:t(r.point)}:r}function l$(r,t){return{x:r.x-t.x,y:r.y-t.y}}function eM({point:r},t){return{point:r,delta:l$(r,EQ(t)),offset:l$(r,TIe(t)),velocity:bIe(t,.1)}}function TIe(r){return r[0]}function EQ(r){return r[r.length-1]}function bIe(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=EQ(r);for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>Up(t)));)s--;if(!a)return{x:0,y:0};const d=Vp(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const g={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}const vQ=1e-4,wIe=1-vQ,RIe=1+vQ,yQ=.01,CIe=0-yQ,IIe=0+yQ;function hl(r){return r.max-r.min}function AIe(r,t,s){return Math.abs(r-t)<=s}function u$(r,t,s,a=.5){r.origin=a,r.originPoint=Yi(t.min,t.max,r.origin),r.scale=hl(s)/hl(t),r.translate=Yi(s.min,s.max,r.origin)-r.originPoint,(r.scale>=wIe&&r.scale<=RIe||isNaN(r.scale))&&(r.scale=1),(r.translate>=CIe&&r.translate<=IIe||isNaN(r.translate))&&(r.translate=0)}function ew(r,t,s,a){u$(r.x,t.x,s.x,a?a.originX:void 0),u$(r.y,t.y,s.y,a?a.originY:void 0)}function d$(r,t,s){r.min=s.min+t.min,r.max=r.min+hl(t)}function OIe(r,t,s){d$(r.x,t.x,s.x),d$(r.y,t.y,s.y)}function h$(r,t,s){r.min=t.min-s.min,r.max=r.min+hl(t)}function tw(r,t,s){h$(r.x,t.x,s.x),h$(r.y,t.y,s.y)}function PIe(r,{min:t,max:s},a){return t!==void 0&&r<t?r=a?Yi(t,r,a.min):Math.max(r,t):s!==void 0&&r>s&&(r=a?Yi(s,r,a.max):Math.min(r,s)),r}function p$(r,t,s){return{min:t!==void 0?r.min+t:void 0,max:s!==void 0?r.max+s-(r.max-r.min):void 0}}function NIe(r,{top:t,left:s,bottom:a,right:l}){return{x:p$(r.x,s,l),y:p$(r.y,t,a)}}function f$(r,t){let s=t.min-r.min,a=t.max-r.max;return t.max-t.min<r.max-r.min&&([s,a]=[a,s]),{min:s,max:a}}function kIe(r,t){return{x:f$(r.x,t.x),y:f$(r.y,t.y)}}function DIe(r,t){let s=.5;const a=hl(r),l=hl(t);return l>a?s=hS(t.min,t.max-a,r.min):a>l&&(s=hS(r.min,r.max-l,t.min)),Wp(0,1,s)}function LIe(r,t){const s={};return t.min!==void 0&&(s.min=t.min-r.min),t.max!==void 0&&(s.max=t.max-r.min),s}const p2=.35;function xIe(r=p2){return r===!1?r=0:r===!0&&(r=p2),{x:m$(r,"left","right"),y:m$(r,"top","bottom")}}function m$(r,t,s){return{min:g$(r,t),max:g$(r,s)}}function g$(r,t){return typeof r=="number"?r:r[t]||0}const _$=()=>({translate:0,scale:1,origin:0,originPoint:0}),Wy=()=>({x:_$(),y:_$()}),E$=()=>({min:0,max:0}),vs=()=>({x:E$(),y:E$()});function eu(r){return[r("x"),r("y")]}function SQ({top:r,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:r,max:a}}}function MIe({x:r,y:t}){return{top:t.min,right:r.max,bottom:t.max,left:r.min}}function UIe(r,t){if(!t)return r;const s=t({x:r.left,y:r.top}),a=t({x:r.right,y:r.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function tM(r){return r===void 0||r===1}function f2({scale:r,scaleX:t,scaleY:s}){return!tM(r)||!tM(t)||!tM(s)}function y_(r){return f2(r)||TQ(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function TQ(r){return v$(r.x)||v$(r.y)}function v$(r){return r&&r!=="0%"}function TP(r,t,s){const a=r-s,l=t*a;return s+l}function y$(r,t,s,a,l){return l!==void 0&&(r=TP(r,l,a)),TP(r,s,a)+t}function m2(r,t=0,s=1,a,l){r.min=y$(r.min,t,s,a,l),r.max=y$(r.max,t,s,a,l)}function bQ(r,{x:t,y:s}){m2(r.x,t.translate,t.scale,t.originPoint),m2(r.y,s.translate,s.scale,s.originPoint)}const S$=.999999999999,T$=1.0000000000001;function VIe(r,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,g;for(let E=0;E<l;E++){d=s[E],g=d.projectionDelta;const{visualElement:S}=d.options;S&&S.props.style&&S.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&zy(r,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),g&&(t.x*=g.x.scale,t.y*=g.y.scale,bQ(r,g)),a&&y_(d.latestValues)&&zy(r,d.latestValues))}t.x<T$&&t.x>S$&&(t.x=1),t.y<T$&&t.y>S$&&(t.y=1)}function Gy(r,t){r.min=r.min+t,r.max=r.max+t}function b$(r,t,s,a,l=.5){const d=Yi(r.min,r.max,l);m2(r,t,s,d,a)}function zy(r,t){b$(r.x,t.x,t.scaleX,t.scale,t.originX),b$(r.y,t.y,t.scaleY,t.scale,t.originY)}function wQ(r,t){return SQ(UIe(r.getBoundingClientRect(),t))}function FIe(r,t,s){const a=wQ(r,s),{scroll:l}=t;return l&&(Gy(a.x,l.offset.x),Gy(a.y,l.offset.y)),a}const RQ=({current:r})=>r?r.ownerDocument.defaultView:null,jIe=new WeakMap;class BIe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=vs(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(Yw(C).point)},d=(C,O)=>{const{drag:k,dragPropagation:W,onDragStart:H}=this.getProps();if(k&&!W&&(this.openDragLock&&this.openDragLock(),this.openDragLock=DRe(k),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eu(G=>{let te=this.getAxisMotionValue(G).get()||0;if(ph.test(te)){const{projection:J}=this.visualElement;if(J&&J.layout){const re=J.layout.layoutBox[G];re&&(te=hl(re)*(parseFloat(te)/100))}}this.originPoint[G]=te}),H&&Di.postRender(()=>H(C,O)),s2(this.visualElement,"transform");const{animationState:K}=this.visualElement;K&&K.setActive("whileDrag",!0)},g=(C,O)=>{const{dragPropagation:k,dragDirectionLock:W,onDirectionLock:H,onDrag:K}=this.getProps();if(!k&&!this.openDragLock)return;const{offset:G}=O;if(W&&this.currentDirection===null){this.currentDirection=WIe(G),this.currentDirection!==null&&H&&H(this.currentDirection);return}this.updateAxis("x",O.point,G),this.updateAxis("y",O.point,G),this.visualElement.render(),K&&K(C,O)},E=(C,O)=>this.stop(C,O),S=()=>eu(C=>{var O;return this.getAnimationState(C)==="paused"&&((O=this.getAxisMotionValue(C).animation)===null||O===void 0?void 0:O.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new _Q(t,{onSessionStart:l,onStart:d,onMove:g,onSessionEnd:E,resumeAnimation:S},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:RQ(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Di.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!fO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let g=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(g=PIe(g,this.constraints[t],this.elastic[t])),d.set(g)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&jy(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=NIe(l.layoutBox,s):this.constraints=!1,this.elastic=xIe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&eu(g=>{this.constraints!==!1&&this.getAxisMotionValue(g)&&(this.constraints[g]=LIe(l.layoutBox[g],this.constraints[g]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!jy(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=FIe(a,l.root,this.visualElement.getTransformPagePoint());let g=kIe(l.layout.layoutBox,d);if(s){const E=s(MIe(g));this.hasMutatedConstraints=!!E,E&&(g=SQ(E))}return g}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:g,onDragTransitionEnd:E}=this.getProps(),S=this.constraints||{},b=eu(C=>{if(!fO(C,s,this.currentDirection))return;let O=S&&S[C]||{};g&&(O={min:0,max:0});const k=l?200:1e6,W=l?40:1e7,H={type:"inertia",velocity:a?t[C]:0,bounceStiffness:k,bounceDamping:W,timeConstant:750,restDelta:1,restSpeed:10,...d,...O};return this.startAxisValueAnimation(C,H)});return Promise.all(b).then(E)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return s2(this.visualElement,t),a.start(EV(t,a,0,s,this.visualElement,!1))}stopAnimation(){eu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){eu(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){eu(s=>{const{drag:a}=this.getProps();if(!fO(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:g,max:E}=l.layout.layoutBox[s];d.set(t[s]-Yi(g,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!jy(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};eu(g=>{const E=this.getAxisMotionValue(g);if(E&&this.constraints!==!1){const S=E.get();l[g]=DIe({min:S,max:S},this.constraints[g])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),eu(g=>{if(!fO(g,t,null))return;const E=this.getAxisMotionValue(g),{min:S,max:b}=this.constraints[g];E.set(Yi(S,b,l[g]))})}addListeners(){if(!this.visualElement.current)return;jIe.set(this.visualElement,this);const t=this.visualElement.current,s=Zb(t,"pointerdown",S=>{const{drag:b,dragListener:C=!0}=this.getProps();b&&C&&this.start(S)}),a=()=>{const{dragConstraints:S}=this.getProps();jy(S)&&S.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Di.read(a);const g=Sw(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:S,hasLayoutChanged:b})=>{this.isDragging&&b&&(eu(C=>{const O=this.getAxisMotionValue(C);O&&(this.originPoint[C]+=S[C].translate,O.set(O.get()+S[C].translate))}),this.visualElement.render())});return()=>{g(),s(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:g=p2,dragMomentum:E=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:g,dragMomentum:E}}}function fO(r,t,s){return(t===!0||t===r)&&(s===null||s===r)}function WIe(r,t=10){let s=null;return Math.abs(r.y)>t?s="y":Math.abs(r.x)>t&&(s="x"),s}class GIe extends Bm{constructor(t){super(t),this.removeGroupControls=dl,this.removeListeners=dl,this.controls=new BIe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||dl}unmount(){this.removeGroupControls(),this.removeListeners()}}const w$=r=>(t,s)=>{r&&Di.postRender(()=>r(t,s))};class zIe extends Bm{constructor(){super(...arguments),this.removePointerDownListener=dl}onPointerDown(t){this.session=new _Q(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:RQ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:w$(t),onStart:w$(s),onMove:a,onEnd:(d,g)=>{delete this.session,l&&Di.postRender(()=>l(d,g))}}}mount(){this.removePointerDownListener=Zb(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const KO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function R$(r,t){return t.max===t.min?0:r/(t.max-t.min)*100}const db={correct:(r,t)=>{if(!t.target)return r;if(typeof r=="string")if(On.test(r))r=parseFloat(r);else return r;const s=R$(r,t.target.x),a=R$(r,t.target.y);return`${s}% ${a}%`}},HIe={correct:(r,{treeScale:t,projectionDelta:s})=>{const a=r,l=km.parse(r);if(l.length>5)return a;const d=km.createTransformer(r),g=typeof l[0]!="number"?1:0,E=s.x.scale*t.x,S=s.y.scale*t.y;l[0+g]/=E,l[1+g]/=S;const b=Yi(E,S,.5);return typeof l[2+g]=="number"&&(l[2+g]/=b),typeof l[3+g]=="number"&&(l[3+g]/=b),d(l)}};class KIe extends j.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;hRe($Ie),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),KO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,g=a.projection;return g&&(g.isPresent=d,l||t.layoutDependency!==s||s===void 0?g.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?g.promote():g.relegate()||Di.postRender(()=>{const E=g.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),$U.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function CQ(r){const[t,s]=BU(),a=j.useContext(VU);return U.jsx(KIe,{...r,layoutGroup:a,switchLayoutGroup:j.useContext(gJ),isPresent:t,safeToRemove:s})}const $Ie={borderRadius:{...db,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:db,borderTopRightRadius:db,borderBottomLeftRadius:db,borderBottomRightRadius:db,boxShadow:HIe};function qIe(r,t,s){const a=va(r)?r:vw(r);return a.start(EV("",a,t,s)),a.animation}function YIe(r){return r instanceof SVGElement&&r.tagName!=="svg"}const XIe=(r,t)=>r.depth-t.depth;class JIe{constructor(){this.children=[],this.isDirty=!1}add(t){aV(this.children,t),this.isDirty=!0}remove(t){cV(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(XIe),this.isDirty=!1,this.children.forEach(t)}}function QIe(r,t){const s=fh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(Nm(a),r(d-t))};return Di.read(a,!0),()=>Nm(a)}const IQ=["TopLeft","TopRight","BottomLeft","BottomRight"],ZIe=IQ.length,C$=r=>typeof r=="string"?parseFloat(r):r,I$=r=>typeof r=="number"||On.test(r);function eAe(r,t,s,a,l,d){l?(r.opacity=Yi(0,s.opacity!==void 0?s.opacity:1,tAe(a)),r.opacityExit=Yi(t.opacity!==void 0?t.opacity:1,0,nAe(a))):d&&(r.opacity=Yi(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let g=0;g<ZIe;g++){const E=`border${IQ[g]}Radius`;let S=A$(t,E),b=A$(s,E);if(S===void 0&&b===void 0)continue;S||(S=0),b||(b=0),S===0||b===0||I$(S)===I$(b)?(r[E]=Math.max(Yi(C$(S),C$(b),a),0),(ph.test(b)||ph.test(S))&&(r[E]+="%")):r[E]=b}(t.rotate||s.rotate)&&(r.rotate=Yi(t.rotate||0,s.rotate||0,a))}function A$(r,t){return r[t]!==void 0?r[t]:r.borderRadius}const tAe=AQ(0,.5,KJ),nAe=AQ(.5,.95,dl);function AQ(r,t,s){return a=>a<r?0:a>t?1:s(hS(r,t,a))}function O$(r,t){r.min=t.min,r.max=t.max}function Jl(r,t){O$(r.x,t.x),O$(r.y,t.y)}function P$(r,t){r.translate=t.translate,r.scale=t.scale,r.originPoint=t.originPoint,r.origin=t.origin}function N$(r,t,s,a,l){return r-=t,r=TP(r,1/s,a),l!==void 0&&(r=TP(r,1/l,a)),r}function rAe(r,t=0,s=1,a=.5,l,d=r,g=r){if(ph.test(t)&&(t=parseFloat(t),t=Yi(g.min,g.max,t/100)-g.min),typeof t!="number")return;let E=Yi(d.min,d.max,a);r===d&&(E-=t),r.min=N$(r.min,t,s,E,l),r.max=N$(r.max,t,s,E,l)}function k$(r,t,[s,a,l],d,g){rAe(r,t[s],t[a],t[l],t.scale,d,g)}const iAe=["x","scaleX","originX"],sAe=["y","scaleY","originY"];function D$(r,t,s,a){k$(r.x,t,iAe,s?s.x:void 0,a?a.x:void 0),k$(r.y,t,sAe,s?s.y:void 0,a?a.y:void 0)}function L$(r){return r.translate===0&&r.scale===1}function OQ(r){return L$(r.x)&&L$(r.y)}function x$(r,t){return r.min===t.min&&r.max===t.max}function oAe(r,t){return x$(r.x,t.x)&&x$(r.y,t.y)}function M$(r,t){return Math.round(r.min)===Math.round(t.min)&&Math.round(r.max)===Math.round(t.max)}function PQ(r,t){return M$(r.x,t.x)&&M$(r.y,t.y)}function U$(r){return hl(r.x)/hl(r.y)}function V$(r,t){return r.translate===t.translate&&r.scale===t.scale&&r.originPoint===t.originPoint}class aAe{constructor(){this.members=[]}add(t){aV(this.members,t),t.scheduleRender()}remove(t){if(cV(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function cAe(r,t,s){let a="";const l=r.x.translate/t.x,d=r.y.translate/t.y,g=(s==null?void 0:s.z)||0;if((l||d||g)&&(a=`translate3d(${l}px, ${d}px, ${g}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:b,rotate:C,rotateX:O,rotateY:k,skewX:W,skewY:H}=s;b&&(a=`perspective(${b}px) ${a}`),C&&(a+=`rotate(${C}deg) `),O&&(a+=`rotateX(${O}deg) `),k&&(a+=`rotateY(${k}deg) `),W&&(a+=`skewX(${W}deg) `),H&&(a+=`skewY(${H}deg) `)}const E=r.x.scale*t.x,S=r.y.scale*t.y;return(E!==1||S!==1)&&(a+=`scale(${E}, ${S})`),a||"none"}const S_={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Lb=typeof window<"u"&&window.MotionDebug!==void 0,nM=["","X","Y","Z"],lAe={visibility:"hidden"},F$=1e3;let uAe=0;function rM(r,t,s,a){const{latestValues:l}=t;l[r]&&(s[r]=l[r],t.setStaticValue(r,0),a&&(a[r]=0))}function NQ(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:t}=r.options;if(!t)return;const s=FJ(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=r.options;window.MotionCancelOptimisedAnimation(s,"transform",Di,!(l||d))}const{parent:a}=r;a&&!a.hasCheckedOptimisedAppear&&NQ(a)}function kQ({attachResizeListener:r,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(g={},E=t==null?void 0:t()){this.id=uAe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Lb&&(S_.totalNodes=S_.resolvedTargetDeltas=S_.recalculatedProjection=0),this.nodes.forEach(pAe),this.nodes.forEach(EAe),this.nodes.forEach(vAe),this.nodes.forEach(fAe),Lb&&window.MotionDebug.record(S_)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=g,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let S=0;S<this.path.length;S++)this.path[S].shouldResetTransform=!0;this.root===this&&(this.nodes=new JIe)}addEventListener(g,E){return this.eventHandlers.has(g)||this.eventHandlers.set(g,new lV),this.eventHandlers.get(g).add(E)}notifyListeners(g,...E){const S=this.eventHandlers.get(g);S&&S.notify(...E)}hasListeners(g){return this.eventHandlers.has(g)}mount(g,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=YIe(g),this.instance=g;const{layoutId:S,layout:b,visualElement:C}=this.options;if(C&&!C.current&&C.mount(g),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(b||S)&&(this.isLayoutDirty=!0),r){let O;const k=()=>this.root.updateBlockedByResize=!1;r(g,()=>{this.root.updateBlockedByResize=!0,O&&O(),O=QIe(k,250),KO.hasAnimatedSinceResize&&(KO.hasAnimatedSinceResize=!1,this.nodes.forEach(B$))})}S&&this.root.registerSharedNode(S,this),this.options.animate!==!1&&C&&(S||b)&&this.addEventListener("didUpdate",({delta:O,hasLayoutChanged:k,hasRelativeTargetChanged:W,layout:H})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const K=this.options.transition||C.getDefaultTransition()||wAe,{onLayoutAnimationStart:G,onLayoutAnimationComplete:te}=C.getProps(),J=!this.targetLayout||!PQ(this.targetLayout,H)||W,re=!k&&W;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||re||k&&(J||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(O,re);const fe={...rV(K,"layout"),onPlay:G,onComplete:te};(C.shouldReduceMotion||this.options.layoutRoot)&&(fe.delay=0,fe.type=!1),this.startAnimation(fe)}else k||B$(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=H})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const g=this.getStack();g&&g.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Nm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(yAe),this.animationId++)}getTransformTemplate(){const{visualElement:g}=this.options;return g&&g.getProps().transformTemplate}willUpdate(g=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&NQ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const O=this.path[C];O.shouldResetTransform=!0,O.updateScroll("snapshot"),O.options.layoutRoot&&O.willUpdate(!1)}const{layoutId:E,layout:S}=this.options;if(E===void 0&&!S)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),g&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(j$);return}this.isUpdating||this.nodes.forEach(gAe),this.isUpdating=!1,this.nodes.forEach(_Ae),this.nodes.forEach(dAe),this.nodes.forEach(hAe),this.clearAllSnapshots();const E=fh.now();jo.delta=Wp(0,1e3/60,E-jo.timestamp),jo.timestamp=E,jo.isProcessing=!0,qx.update.process(jo),qx.preRender.process(jo),qx.render.process(jo),jo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,$U.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(mAe),this.sharedNodes.forEach(SAe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Di.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Di.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let S=0;S<this.path.length;S++)this.path[S].updateScroll();const g=this.layout;this.layout=this.measure(!1),this.layoutCorrected=vs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,g?g.layoutBox:void 0)}updateScroll(g="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===g&&(E=!1),E){const S=a(this.instance);this.scroll={animationId:this.root.animationId,phase:g,isRoot:S,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:S}}}resetTransform(){if(!l)return;const g=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!OQ(this.projectionDelta),S=this.getTransformTemplate(),b=S?S(this.latestValues,""):void 0,C=b!==this.prevTransformTemplateValue;g&&(E||y_(this.latestValues)||C)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(g=!0){const E=this.measurePageBox();let S=this.removeElementScroll(E);return g&&(S=this.removeTransform(S)),RAe(S),{animationId:this.root.animationId,measuredBox:E,layoutBox:S,latestValues:{},source:this.id}}measurePageBox(){var g;const{visualElement:E}=this.options;if(!E)return vs();const S=E.measureViewportBox();if(!(((g=this.scroll)===null||g===void 0?void 0:g.wasRoot)||this.path.some(CAe))){const{scroll:C}=this.root;C&&(Gy(S.x,C.offset.x),Gy(S.y,C.offset.y))}return S}removeElementScroll(g){var E;const S=vs();if(Jl(S,g),!((E=this.scroll)===null||E===void 0)&&E.wasRoot)return S;for(let b=0;b<this.path.length;b++){const C=this.path[b],{scroll:O,options:k}=C;C!==this.root&&O&&k.layoutScroll&&(O.wasRoot&&Jl(S,g),Gy(S.x,O.offset.x),Gy(S.y,O.offset.y))}return S}applyTransform(g,E=!1){const S=vs();Jl(S,g);for(let b=0;b<this.path.length;b++){const C=this.path[b];!E&&C.options.layoutScroll&&C.scroll&&C!==C.root&&zy(S,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),y_(C.latestValues)&&zy(S,C.latestValues)}return y_(this.latestValues)&&zy(S,this.latestValues),S}removeTransform(g){const E=vs();Jl(E,g);for(let S=0;S<this.path.length;S++){const b=this.path[S];if(!b.instance||!y_(b.latestValues))continue;f2(b.latestValues)&&b.updateSnapshot();const C=vs(),O=b.measurePageBox();Jl(C,O),D$(E,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,C)}return y_(this.latestValues)&&D$(E,this.latestValues),E}setTargetDelta(g){this.targetDelta=g,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(g){this.options={...this.options,...g,crossfade:g.crossfade!==void 0?g.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==jo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(g=!1){var E;const S=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=S.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=S.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=S.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==S;if(!(g||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:O,layoutId:k}=this.options;if(!(!this.layout||!(O||k))){if(this.resolvedRelativeTargetAt=jo.timestamp,!this.targetDelta&&!this.relativeTarget){const W=this.getClosestProjectingParent();W&&W.layout&&this.animationProgress!==1?(this.relativeParent=W,this.forceRelativeParentToResolveTarget(),this.relativeTarget=vs(),this.relativeTargetOrigin=vs(),tw(this.relativeTargetOrigin,this.layout.layoutBox,W.layout.layoutBox),Jl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=vs(),this.targetWithTransforms=vs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),OIe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Jl(this.target,this.layout.layoutBox),bQ(this.target,this.targetDelta)):Jl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const W=this.getClosestProjectingParent();W&&!!W.resumingFrom==!!this.resumingFrom&&!W.options.layoutScroll&&W.target&&this.animationProgress!==1?(this.relativeParent=W,this.forceRelativeParentToResolveTarget(),this.relativeTarget=vs(),this.relativeTargetOrigin=vs(),tw(this.relativeTargetOrigin,this.target,W.target),Jl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Lb&&S_.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||f2(this.parent.latestValues)||TQ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var g;const E=this.getLead(),S=!!this.resumingFrom||this!==E;let b=!0;if((this.isProjectionDirty||!((g=this.parent)===null||g===void 0)&&g.isProjectionDirty)&&(b=!1),S&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===jo.timestamp&&(b=!1),b)return;const{layout:C,layoutId:O}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||O))return;Jl(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,W=this.treeScale.y;VIe(this.layoutCorrected,this.treeScale,this.path,S),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=vs());const{target:H}=E;if(!H){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(P$(this.prevProjectionDelta.x,this.projectionDelta.x),P$(this.prevProjectionDelta.y,this.projectionDelta.y)),ew(this.projectionDelta,this.layoutCorrected,H,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==W||!V$(this.projectionDelta.x,this.prevProjectionDelta.x)||!V$(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",H)),Lb&&S_.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(g=!0){var E;if((E=this.options.visualElement)===null||E===void 0||E.scheduleRender(),g){const S=this.getStack();S&&S.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Wy(),this.projectionDelta=Wy(),this.projectionDeltaWithTransform=Wy()}setAnimationOrigin(g,E=!1){const S=this.snapshot,b=S?S.latestValues:{},C={...this.latestValues},O=Wy();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const k=vs(),W=S?S.source:void 0,H=this.layout?this.layout.source:void 0,K=W!==H,G=this.getStack(),te=!G||G.members.length<=1,J=!!(K&&!te&&this.options.crossfade===!0&&!this.path.some(bAe));this.animationProgress=0;let re;this.mixTargetDelta=fe=>{const oe=fe/1e3;W$(O.x,g.x,oe),W$(O.y,g.y,oe),this.setTargetDelta(O),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(tw(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),TAe(this.relativeTarget,this.relativeTargetOrigin,k,oe),re&&oAe(this.relativeTarget,re)&&(this.isProjectionDirty=!1),re||(re=vs()),Jl(re,this.relativeTarget)),K&&(this.animationValues=C,eAe(C,b,this.latestValues,oe,J,te)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=oe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(g){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Nm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Di.update(()=>{KO.hasAnimatedSinceResize=!0,this.currentAnimation=qIe(0,F$,{...g,onUpdate:E=>{this.mixTargetDelta(E),g.onUpdate&&g.onUpdate(E)},onComplete:()=>{g.onComplete&&g.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const g=this.getStack();g&&g.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(F$),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const g=this.getLead();let{targetWithTransforms:E,target:S,layout:b,latestValues:C}=g;if(!(!E||!S||!b)){if(this!==g&&this.layout&&b&&DQ(this.options.animationType,this.layout.layoutBox,b.layoutBox)){S=this.target||vs();const O=hl(this.layout.layoutBox.x);S.x.min=g.target.x.min,S.x.max=S.x.min+O;const k=hl(this.layout.layoutBox.y);S.y.min=g.target.y.min,S.y.max=S.y.min+k}Jl(E,S),zy(E,C),ew(this.projectionDeltaWithTransform,this.layoutCorrected,E,C)}}registerSharedNode(g,E){this.sharedNodes.has(g)||this.sharedNodes.set(g,new aAe),this.sharedNodes.get(g).add(E);const b=E.options.initialPromotionConfig;E.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(E):void 0})}isLead(){const g=this.getStack();return g?g.lead===this:!0}getLead(){var g;const{layoutId:E}=this.options;return E?((g=this.getStack())===null||g===void 0?void 0:g.lead)||this:this}getPrevLead(){var g;const{layoutId:E}=this.options;return E?(g=this.getStack())===null||g===void 0?void 0:g.prevLead:void 0}getStack(){const{layoutId:g}=this.options;if(g)return this.root.sharedNodes.get(g)}promote({needsReset:g,transition:E,preserveFollowOpacity:S}={}){const b=this.getStack();b&&b.promote(this,S),g&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const g=this.getStack();return g?g.relegate(this):!1}resetSkewAndRotation(){const{visualElement:g}=this.options;if(!g)return;let E=!1;const{latestValues:S}=g;if((S.z||S.rotate||S.rotateX||S.rotateY||S.rotateZ||S.skewX||S.skewY)&&(E=!0),!E)return;const b={};S.z&&rM("z",g,b,this.animationValues);for(let C=0;C<nM.length;C++)rM(`rotate${nM[C]}`,g,b,this.animationValues),rM(`skew${nM[C]}`,g,b,this.animationValues);g.render();for(const C in b)g.setStaticValue(C,b[C]),this.animationValues&&(this.animationValues[C]=b[C]);g.scheduleRender()}getProjectionStyles(g){var E,S;if(!this.instance||this.isSVG)return;if(!this.isVisible)return lAe;const b={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=zO(g==null?void 0:g.pointerEvents)||"",b.transform=C?C(this.latestValues,""):"none",b;const O=this.getLead();if(!this.projectionDelta||!this.layout||!O.target){const K={};return this.options.layoutId&&(K.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,K.pointerEvents=zO(g==null?void 0:g.pointerEvents)||""),this.hasProjected&&!y_(this.latestValues)&&(K.transform=C?C({},""):"none",this.hasProjected=!1),K}const k=O.animationValues||O.latestValues;this.applyTransformsToTarget(),b.transform=cAe(this.projectionDeltaWithTransform,this.treeScale,k),C&&(b.transform=C(k,b.transform));const{x:W,y:H}=this.projectionDelta;b.transformOrigin=`${W.origin*100}% ${H.origin*100}% 0`,O.animationValues?b.opacity=O===this?(S=(E=k.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&S!==void 0?S:1:this.preserveOpacity?this.latestValues.opacity:k.opacityExit:b.opacity=O===this?k.opacity!==void 0?k.opacity:"":k.opacityExit!==void 0?k.opacityExit:0;for(const K in _P){if(k[K]===void 0)continue;const{correct:G,applyTo:te}=_P[K],J=b.transform==="none"?k[K]:G(k[K],O);if(te){const re=te.length;for(let fe=0;fe<re;fe++)b[te[fe]]=J}else b[K]=J}return this.options.layoutId&&(b.pointerEvents=O===this?zO(g==null?void 0:g.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(g=>{var E;return(E=g.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(j$),this.root.sharedNodes.clear()}}}function dAe(r){r.updateLayout()}function hAe(r){var t;const s=((t=r.resumeFrom)===null||t===void 0?void 0:t.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&s&&r.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=r.layout,{animationType:d}=r.options,g=s.source!==r.layout.source;d==="size"?eu(O=>{const k=g?s.measuredBox[O]:s.layoutBox[O],W=hl(k);k.min=a[O].min,k.max=k.min+W}):DQ(d,s.layoutBox,a)&&eu(O=>{const k=g?s.measuredBox[O]:s.layoutBox[O],W=hl(a[O]);k.max=k.min+W,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[O].max=r.relativeTarget[O].min+W)});const E=Wy();ew(E,a,s.layoutBox);const S=Wy();g?ew(S,r.applyTransform(l,!0),s.measuredBox):ew(S,a,s.layoutBox);const b=!OQ(E);let C=!1;if(!r.resumeFrom){const O=r.getClosestProjectingParent();if(O&&!O.resumeFrom){const{snapshot:k,layout:W}=O;if(k&&W){const H=vs();tw(H,s.layoutBox,k.layoutBox);const K=vs();tw(K,a,W.layoutBox),PQ(H,K)||(C=!0),O.options.layoutRoot&&(r.relativeTarget=K,r.relativeTargetOrigin=H,r.relativeParent=O)}}}r.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:S,layoutDelta:E,hasLayoutChanged:b,hasRelativeTargetChanged:C})}else if(r.isLead()){const{onExitComplete:a}=r.options;a&&a()}r.options.transition=void 0}function pAe(r){Lb&&S_.totalNodes++,r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function fAe(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function mAe(r){r.clearSnapshot()}function j$(r){r.clearMeasurements()}function gAe(r){r.isLayoutDirty=!1}function _Ae(r){const{visualElement:t}=r.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),r.resetTransform()}function B$(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function EAe(r){r.resolveTargetDelta()}function vAe(r){r.calcProjection()}function yAe(r){r.resetSkewAndRotation()}function SAe(r){r.removeLeadSnapshot()}function W$(r,t,s){r.translate=Yi(t.translate,0,s),r.scale=Yi(t.scale,1,s),r.origin=t.origin,r.originPoint=t.originPoint}function G$(r,t,s,a){r.min=Yi(t.min,s.min,a),r.max=Yi(t.max,s.max,a)}function TAe(r,t,s,a){G$(r.x,t.x,s.x,a),G$(r.y,t.y,s.y,a)}function bAe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const wAe={duration:.45,ease:[.4,0,.1,1]},z$=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),H$=z$("applewebkit/")&&!z$("chrome/")?Math.round:dl;function K$(r){r.min=H$(r.min),r.max=H$(r.max)}function RAe(r){K$(r.x),K$(r.y)}function DQ(r,t,s){return r==="position"||r==="preserve-aspect"&&!AIe(U$(t),U$(s),.2)}function CAe(r){var t;return r!==r.root&&((t=r.scroll)===null||t===void 0?void 0:t.wasRoot)}const IAe=kQ({attachResizeListener:(r,t)=>Sw(r,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),iM={current:void 0},LQ=kQ({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!iM.current){const r=new IAe({});r.mount(window),r.setOptions({layoutScroll:!0}),iM.current=r}return iM.current},resetTransform:(r,t)=>{r.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),AAe={pan:{Feature:zIe},drag:{Feature:GIe,ProjectionNode:LQ,MeasureLayout:CQ}};function $$(r,t,s){const{props:a}=r;r.animationState&&a.whileHover&&r.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&Di.postRender(()=>d(t,Yw(t)))}class OAe extends Bm{mount(){const{current:t}=this.node;t&&(this.unmount=ARe(t,s=>($$(this.node,s,"Start"),a=>$$(this.node,a,"End"))))}unmount(){}}class PAe extends Bm{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=qw(Sw(this.node.current,"focus",()=>this.onFocus()),Sw(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function q$(r,t,s){const{props:a}=r;r.animationState&&a.whileTap&&r.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&Di.postRender(()=>d(t,Yw(t)))}class NAe extends Bm{mount(){const{current:t}=this.node;t&&(this.unmount=kRe(t,s=>(q$(this.node,s,"Start"),(a,{success:l})=>q$(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const g2=new WeakMap,sM=new WeakMap,kAe=r=>{const t=g2.get(r.target);t&&t(r)},DAe=r=>{r.forEach(kAe)};function LAe({root:r,...t}){const s=r||document;sM.has(s)||sM.set(s,{});const a=sM.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(DAe,{root:r,...t})),a[l]}function xAe(r,t,s){const a=LAe(t);return g2.set(r,s),a.observe(r),()=>{g2.delete(r),a.unobserve(r)}}const MAe={some:0,all:1};class UAe extends Bm{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,g={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:MAe[l]},E=S=>{const{isIntersecting:b}=S;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:C,onViewportLeave:O}=this.node.getProps(),k=b?C:O;k&&k(S)};return xAe(this.node.current,g,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(VAe(t,s))&&this.startObserver()}unmount(){}}function VAe({viewport:r={}},{viewport:t={}}={}){return s=>r[s]!==t[s]}const FAe={inView:{Feature:UAe},tap:{Feature:NAe},focus:{Feature:PAe},hover:{Feature:OAe}},jAe={layout:{ProjectionNode:LQ,MeasureLayout:CQ}},_2={current:null},xQ={current:!1};function BAe(){if(xQ.current=!0,!!WU)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),t=()=>_2.current=r.matches;r.addListener(t),t()}else _2.current=!1}const WAe=[...oQ,ga,km],GAe=r=>WAe.find(sQ(r)),Y$=new WeakMap;function zAe(r,t,s){for(const a in t){const l=t[a],d=s[a];if(va(l))r.addValue(a,l);else if(va(d))r.addValue(a,vw(l,{owner:r}));else if(d!==l)if(r.hasValue(a)){const g=r.getValue(a);g.liveStyle===!0?g.jump(l):g.hasAnimated||g.set(l)}else{const g=r.getStaticValue(a);r.addValue(a,vw(g!==void 0?g:l,{owner:r}))}}for(const a in s)t[a]===void 0&&r.removeValue(a);return t}const X$=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class HAe{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:g},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=mV,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const W=fh.now();this.renderScheduledAt<W&&(this.renderScheduledAt=W,Di.render(this.render,!1,!0))};const{latestValues:S,renderState:b,onUpdate:C}=g;this.onUpdate=C,this.latestValues=S,this.baseTarget={...S},this.initialValues=s.initial?{...S}:{},this.renderState=b,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=lN(s),this.isVariantNode=fJ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:O,...k}=this.scrapeMotionValuesFromProps(s,{},this);for(const W in k){const H=k[W];S[W]!==void 0&&va(H)&&H.set(S[W],!1)}}mount(t){this.current=t,Y$.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),xQ.current||BAe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:_2.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Y$.delete(this.current),this.projection&&this.projection.unmount(),Nm(this.notifyUpdate),Nm(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=eE.has(t),l=s.on("change",E=>{this.latestValues[t]=E,this.props.onUpdate&&Di.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let g;window.MotionCheckAppearSync&&(g=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),g&&g(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in pS){const s=pS[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):vs()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<X$.length;a++){const l=X$[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,g=t[d];g&&(this.propEventSubscriptions[l]=this.on(l,g))}this.prevMotionValues=zAe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=vw(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(rQ(l)||qJ(l))?l=parseFloat(l):!GAe(l)&&km.test(s)&&(l=eQ(t,s)),this.setBaseTarget(t,va(l)?l.get():l)),va(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const g=YU(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);g&&(l=g[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!va(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new lV),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class MQ extends HAe{constructor(){super(...arguments),this.KeyframeResolver=aQ}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;va(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function KAe(r){return window.getComputedStyle(r)}class $Ae extends MQ{constructor(){super(...arguments),this.type="html",this.renderInstance=bJ}readValueFromInstance(t,s){if(eE.has(s)){const a=fV(s);return a&&a.default||0}else{const a=KAe(t),l=(yJ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return wQ(t,s)}build(t,s,a){QU(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return nV(t,s,a)}}class qAe extends MQ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=vs}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(eE.has(s)){const a=fV(s);return a&&a.default||0}return s=wJ.has(s)?s:KU(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return IJ(t,s,a)}build(t,s,a){ZU(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){RJ(t,s,a,l)}mount(t){this.isSVGTag=tV(t.tagName),super.mount(t)}}const YAe=(r,t)=>qU(r)?new qAe(t):new $Ae(t,{allowProjection:r!==j.Fragment}),XAe=SRe({...vIe,...FAe,...AAe,...jAe},YAe),Xp=Mwe(XAe),JAe=(r,t)=>r.find(s=>s.id===t);function J$(r,t){const s=UQ(r,t),a=s?r[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function UQ(r,t){for(const[s,a]of Object.entries(r))if(JAe(a,t))return s}function QAe(r){const t=r.includes("right"),s=r.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function ZAe(r){const s=r==="top"||r==="bottom"?"0 auto":void 0,a=r.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=r.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=r.includes("left")?void 0:"env(safe-area-inset-right, 0px)",g=r.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:g}}var eOe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,tOe=QX(function(r){return eOe.test(r)||r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)<91}),nOe=tOe,rOe=function(t){return t!=="theme"},Q$=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?nOe:rOe},Z$=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(g){return t.__emotion_forwardProp(g)&&d(g)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},iOe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return NU(s,a,l),rJ(function(){return kU(s,a,l)}),null},sOe=function r(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,g;s!==void 0&&(d=s.label,g=s.target);var E=Z$(t,s,a),S=E||Q$(l),b=!S("as");return function(){var C=arguments,O=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&O.push("label:"+d+";"),C[0]==null||C[0].raw===void 0)O.push.apply(O,C);else{var k=C[0];O.push(k[0]);for(var W=C.length,H=1;H<W;H++)O.push(C[H],k[H])}var K=LU(function(G,te,J){var re=b&&G.as||l,fe="",oe=[],be=G;if(G.theme==null){be={};for(var Z in G)be[Z]=G[Z];be.theme=j.useContext(dS)}typeof G.className=="string"?fe=eJ(te.registered,oe,G.className):G.className!=null&&(fe=G.className+" ");var ne=iN(O.concat(oe),te.registered,be);fe+=te.key+"-"+ne.name,g!==void 0&&(fe+=" "+g);var se=b&&E===void 0?Q$(re):S,ue={};for(var Ee in G)b&&Ee==="as"||se(Ee)&&(ue[Ee]=G[Ee]);return ue.className=fe,J&&(ue.ref=J),j.createElement(j.Fragment,null,j.createElement(iOe,{cache:te,serialized:ne,isStringTag:typeof re=="string"}),j.createElement(re,ue))});return K.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",K.defaultProps=t.defaultProps,K.__emotion_real=K,K.__emotion_base=l,K.__emotion_styles=O,K.__emotion_forwardProp=E,Object.defineProperty(K,"toString",{value:function(){return"."+g}}),K.withComponent=function(G,te){var J=r(G,B_({},s,te,{shouldForwardProp:Z$(K,te,!0)}));return J.apply(void 0,O)},K}},oOe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],E2=sOe.bind(null);oOe.forEach(function(r){E2[r]=E2(r)});const aOe=new Set([...O_e,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),cOe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function lOe(r){return(cOe.has(r)||!aOe.has(r))&&r[0]!=="_"}const uOe=oge(E2),dOe=({baseStyle:r})=>t=>{const{theme:s,css:a,__css:l,sx:d,...g}=t,[E]=mge(g,N_e),S=Oc(r,t),b=Kme({},l,S,XP(E),d),C=NX(b)(t.theme);return a?[C,a]:C};function oM(r,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=lOe);const l=dOe({baseStyle:s}),d=uOe(r,a)(l);return j.forwardRef(function(S,b){const{children:C,...O}=S,{colorMode:k,forced:W}=oN(),H=W?k:void 0;return j.createElement(d,{ref:b,"data-theme":H,...O},C)})}function hOe(){const r=new Map;return new Proxy(oM,{apply(t,s,a){return oM(...a)},get(t,s){return r.has(s)||r.set(s,oM(s)),r.get(s)}})}const kt=hOe(),pOe={initial:r=>{const{position:t}=r,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},VQ=j.memo(r=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:g="bottom",duration:E=5e3,containerStyle:S,motionVariants:b=pOe,toastSpacing:C="0.5rem"}=r,[O,k]=j.useState(E),W=Iwe();Pm(()=>{W||a==null||a()},[W]),Pm(()=>{k(E)},[E]);const H=()=>k(null),K=()=>k(E),G=()=>{W&&l()};j.useEffect(()=>{W&&d&&l()},[W,d,l]),Dge(G,O);const te=j.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...S}),[S,C]),J=j.useMemo(()=>QAe(g),[g]);return U.jsx(Xp.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:H,onHoverEnd:K,custom:{position:g},style:J,children:U.jsx(kt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:te,children:Oc(s,{id:t,onClose:G})})})});VQ.displayName="ToastComponent";function Qt(r){return j.forwardRef(r)}var aM,eq;function fOe(){if(eq)return aM;eq=1;var r=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,g){if(d===g)return!0;if(d&&g&&typeof d=="object"&&typeof g=="object"){if(d.constructor!==g.constructor)return!1;var E,S,b;if(Array.isArray(d)){if(E=d.length,E!=g.length)return!1;for(S=E;S--!==0;)if(!l(d[S],g[S]))return!1;return!0}var C;if(t&&d instanceof Map&&g instanceof Map){if(d.size!==g.size)return!1;for(C=d.entries();!(S=C.next()).done;)if(!g.has(S.value[0]))return!1;for(C=d.entries();!(S=C.next()).done;)if(!l(S.value[1],g.get(S.value[0])))return!1;return!0}if(s&&d instanceof Set&&g instanceof Set){if(d.size!==g.size)return!1;for(C=d.entries();!(S=C.next()).done;)if(!g.has(S.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(g)){if(E=d.length,E!=g.length)return!1;for(S=E;S--!==0;)if(d[S]!==g[S])return!1;return!0}if(d.constructor===RegExp)return d.source===g.source&&d.flags===g.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof g.valueOf=="function")return d.valueOf()===g.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof g.toString=="function")return d.toString()===g.toString();if(b=Object.keys(d),E=b.length,E!==Object.keys(g).length)return!1;for(S=E;S--!==0;)if(!Object.prototype.hasOwnProperty.call(g,b[S]))return!1;if(r&&d instanceof Element)return!1;for(S=E;S--!==0;)if(!((b[S]==="_owner"||b[S]==="__v"||b[S]==="__o")&&d.$$typeof)&&!l(d[b[S]],g[b[S]]))return!1;return!0}return d!==d&&g!==g}return aM=function(g,E){try{return l(g,E)}catch(S){if((S.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw S}},aM}var mOe=fOe();const gOe=OS(mOe);function LS(){const r=j.useContext(dS);if(!r)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return r}function FQ(){const r=oN(),t=LS();return{...r,theme:t}}function _Oe(r,t,s){if(t==null)return t;const a=l=>{var d,g;return(g=(d=r.__cssMap)==null?void 0:d[l])==null?void 0:g.value};return a(t)??a(s)??s}function EOe(r,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const g=l.filter(Boolean),E=a.map((S,b)=>{const C=`${r}.${S}`;return _Oe(d,C,g[b]??S)});return Array.isArray(t)?E:E[0]}}function jQ(r,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=FQ(),g=r?fX(l,`components.${r}`):void 0,E=s||g,S=lh({theme:l,colorMode:d},(E==null?void 0:E.defaultProps)??{},XP(Fw(a,["children"])),(C,O)=>C?void 0:O),b=j.useRef({});if(E){const O=W_e(E)(S);gOe(b.current,O)||(b.current=O)}return b.current}function rd(r,t={}){return jQ(r,t)}function xc(r,t={}){return jQ(r,t)}const tq={path:U.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[U.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),U.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),U.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Wm=Qt((r,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:g,className:E,__css:S,...b}=r,C=An("chakra-icon",E),O=rd("Icon",r),k={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...S,...O},W={ref:t,focusable:d,className:C,__css:k},H=a??tq.viewBox;if(s&&typeof s!="string")return U.jsx(kt.svg,{as:s,...W,...b});const K=g??tq.path;return U.jsx(kt.svg,{verticalAlign:"middle",viewBox:H,...W,...b,children:K})});Wm.displayName="Icon";function vOe(r){return U.jsx(Wm,{viewBox:"0 0 24 24",...r,children:U.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function yOe(r){return U.jsx(Wm,{viewBox:"0 0 24 24",...r,children:U.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function nq(r){return U.jsx(Wm,{viewBox:"0 0 24 24",...r,children:U.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const SOe=zw({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),xS=Qt((r,t)=>{const s=rd("Spinner",r),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:g="transparent",className:E,...S}=Ji(r),b=An("chakra-spinner",E),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:g,borderLeftColor:g,animation:`${SOe} ${d} linear infinite`,...s};return U.jsx(kt.div,{ref:t,__css:C,className:b,...S,children:a&&U.jsx(kt.span,{srOnly:!0,children:a})})});xS.displayName="Spinner";const[TOe,vV]=Li({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[bOe,yV]=Li({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),BQ={info:{icon:yOe,colorScheme:"blue"},warning:{icon:nq,colorScheme:"orange"},success:{icon:vOe,colorScheme:"green"},error:{icon:nq,colorScheme:"red"},loading:{icon:xS,colorScheme:"blue"}};function wOe(r){return BQ[r].colorScheme}function ROe(r){return BQ[r].icon}const hN=Qt(function(t,s){const{status:a="info",addRole:l=!0,...d}=Ji(t),g=t.colorScheme??wOe(a),E=xc("Alert",{...t,colorScheme:g}),S={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...E.container};return U.jsx(TOe,{value:{status:a},children:U.jsx(bOe,{value:E,children:U.jsx(kt.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:An("chakra-alert",t.className),__css:S})})})});hN.displayName="Alert";function pN(r){const{status:t}=vV(),s=ROe(t),a=yV(),l=t==="loading"?a.spinner:a.icon;return U.jsx(kt.span,{display:"inherit","data-status":t,...r,className:An("chakra-alert__icon",r.className),__css:l,children:r.children||U.jsx(s,{h:"100%",w:"100%"})})}pN.displayName="AlertIcon";const WQ=Qt(function(t,s){const a=yV(),{status:l}=vV();return U.jsx(kt.div,{ref:s,"data-status":l,...t,className:An("chakra-alert__title",t.className),__css:a.title})});WQ.displayName="AlertTitle";const GQ=Qt(function(t,s){const{status:a}=vV(),l=yV(),d={display:"inline",...l.description};return U.jsx(kt.div,{ref:s,"data-status":a,...t,className:An("chakra-alert__desc",t.className),__css:d})});GQ.displayName="AlertDescription";function COe(r){return U.jsx(Wm,{focusable:"false","aria-hidden":!0,...r,children:U.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const SV=Qt(function(t,s){const a=rd("CloseButton",t),{children:l,isDisabled:d,__css:g,...E}=Ji(t),S={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return U.jsx(kt.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...S,...a,...g},...E,children:l||U.jsx(COe,{width:"1em",height:"1em"})})});SV.displayName="CloseButton";const IOe=r=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:g,description:E,colorScheme:S,icon:b}=r,C=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return U.jsxs(hN,{addRole:!1,status:t,variant:s,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:S,children:[U.jsx(pN,{children:b}),U.jsxs(kt.div,{flex:"1",maxWidth:"100%",children:[l&&U.jsx(WQ,{id:C==null?void 0:C.title,children:l}),E&&U.jsx(GQ,{id:C==null?void 0:C.description,display:"block",children:E})]}),d&&U.jsx(SV,{size:"sm",onClick:g,position:"absolute",insetEnd:1,top:1})]})};function zQ(r={}){const{render:t,toastComponent:s=IOe}=r;return l=>typeof t=="function"?t({...l,...r}):U.jsx(s,{...l,...r})}const AOe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},oh=OOe(AOe);function OOe(r){let t=r;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>r),s.delete(l)}),removeToast:(l,d)=>{a(g=>({...g,[d]:g[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const g=POe(l,d),{position:E,id:S}=g;return a(b=>{const O=E.includes("top")?[g,...b[E]??[]]:[...b[E]??[],g];return{...b,[E]:O}}),S},update:(l,d)=>{l&&a(g=>{const E={...g},{position:S,index:b}=J$(E,l);return S&&b!==-1&&(E[S][b]={...E[S][b],...d,message:zQ(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((S,b)=>(S[b]=d[b].map(C=>({...C,requestClose:!0})),S),{...d}))},close:l=>{a(d=>{const g=UQ(d,l);return g?{...d,[g]:d[g].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!J$(oh.getState(),l).position}}let rq=0;function POe(r,t={}){rq+=1;const s=t.id??rq,a=t.position??"bottom";return{id:s,message:r,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>oh.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var HQ=sX();const[KQ,NOe]=Li({strict:!1,name:"PortalContext"}),TV="chakra-portal",kOe=".chakra-portal",DOe=r=>U.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:r.zIndex,top:0,left:0,right:0},children:r.children}),LOe=r=>{const{appendToParentPortal:t,children:s}=r,[a,l]=j.useState(null),d=j.useRef(null),[,g]=j.useState({});j.useEffect(()=>g({}),[]);const E=NOe(),S=Swe();wm(()=>{if(!a)return;const C=a.ownerDocument,O=t?E??C.body:C.body;if(!O)return;d.current=C.createElement("div"),d.current.className=TV,O.appendChild(d.current),g({});const k=d.current;return()=>{O.contains(k)&&O.removeChild(k)}},[a]);const b=S!=null&&S.zIndex?U.jsx(DOe,{zIndex:S==null?void 0:S.zIndex,children:s}):s;return d.current?HQ.createPortal(U.jsx(KQ,{value:d.current,children:b}),d.current):U.jsx("span",{ref:C=>{C&&l(C)}})},xOe=r=>{const{children:t,containerRef:s,appendToParentPortal:a}=r,l=s.current,d=l??(typeof window<"u"?document.body:void 0),g=j.useMemo(()=>{const S=l==null?void 0:l.ownerDocument.createElement("div");return S&&(S.className=TV),S},[l]),[,E]=j.useState({});return wm(()=>E({}),[]),wm(()=>{if(!(!g||!d))return d.appendChild(g),()=>{d.removeChild(g)}},[g,d]),d&&g?HQ.createPortal(U.jsx(KQ,{value:a?g:null,children:t}),g):null};function id(r){const t={appendToParentPortal:!0,...r},{containerRef:s,...a}=t;return s?U.jsx(xOe,{containerRef:s,...a}):U.jsx(LOe,{...a})}id.className=TV;id.selector=kOe;id.displayName="Portal";const[MOe,UOe]=Li({name:"ToastOptionsContext",strict:!1}),VOe=r=>{const t=j.useSyncExternalStore(oh.subscribe,oh.getState,oh.getState),{motionVariants:s,component:a=VQ,portalProps:l,animatePresenceProps:d}=r,E=Object.keys(t).map(S=>{const b=t[S];return U.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${S}`,id:`chakra-toast-manager-${S}`,style:ZAe(S),children:U.jsx(NS,{...d,initial:!1,children:b.map(C=>U.jsx(a,{motionVariants:s,...C},C.id))})},S)});return U.jsx(id,{...l,children:E})},FOe=r=>function({children:s,theme:a=r,toastOptions:l,...d}){return U.jsxs(Twe,{theme:a,...d,children:[U.jsx(MOe,{value:l==null?void 0:l.defaultOptions,children:s}),U.jsx(VOe,{...l})]})},jOe=FOe(fbe);function iq(r){return r.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const BOe=r=>typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE;function sq(r,t,s){let a=r+1;return s&&a>=t&&(a=0),a}function oq(r,t,s){let a=r-1;return s&&a<0&&(a=t),a}const cM=typeof window<"u"?j.useLayoutEffect:j.useEffect,aq=r=>r;var WOe=Object.defineProperty,GOe=(r,t,s)=>t in r?WOe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,hs=(r,t,s)=>(GOe(r,typeof t!="symbol"?t+"":t,s),s);class zOe{constructor(){hs(this,"descendants",new Map),hs(this,"register",t=>{if(t!=null)return BOe(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),hs(this,"unregister",t=>{this.descendants.delete(t);const s=iq(Array.from(this.descendants.keys()));this.assignIndex(s)}),hs(this,"destroy",()=>{this.descendants.clear()}),hs(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),hs(this,"count",()=>this.descendants.size),hs(this,"enabledCount",()=>this.enabledValues().length),hs(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),hs(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),hs(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),hs(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),hs(this,"first",()=>this.item(0)),hs(this,"firstEnabled",()=>this.enabledItem(0)),hs(this,"last",()=>this.item(this.descendants.size-1)),hs(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),hs(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),hs(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),hs(this,"next",(t,s=!0)=>{const a=sq(t,this.count(),s);return this.item(a)}),hs(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=sq(l,this.enabledCount(),s);return this.enabledItem(d)}),hs(this,"prev",(t,s=!0)=>{const a=oq(t,this.count()-1,s);return this.item(a)}),hs(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=oq(l,this.enabledCount()-1,s);return this.enabledItem(d)}),hs(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=iq(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function $Q(){const[r,t]=Li({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[r,t,()=>{const l=j.useRef(new zOe);return cM(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[g,E]=j.useState(-1),S=j.useRef(null);cM(()=>()=>{S.current&&d.unregister(S.current)},[]),cM(()=>{if(!S.current)return;const C=Number(S.current.dataset.index);g!=C&&!Number.isNaN(C)&&E(C)});const b=aq(l?d.register(l):d.register);return{descendants:d,index:g,enabledIndex:d.enabledIndexOf(S.current),register:qi(b,S)}}]}const cq={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},x_={enter:{duration:.2,ease:cq.easeOut},exit:{duration:.1,ease:cq.easeIn}},M_={enter:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[HOe,KOe]=Li({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function $Oe(r){const t=r.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function qQ(r){const{name:t,getInitials:s,...a}=r,l=KOe();return U.jsx(kt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}qQ.displayName="AvatarName";const YQ=r=>U.jsxs(kt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...r,children:[U.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),U.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function XQ(r){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:g,sizes:E,ignoreFallback:S}=r,[b,C]=j.useState("pending");j.useEffect(()=>{C(s?"loading":"pending")},[s]);const O=j.useRef(null),k=j.useCallback(()=>{if(!s)return;W();const H=new Image;H.src=s,g&&(H.crossOrigin=g),a&&(H.srcset=a),E&&(H.sizes=E),t&&(H.loading=t),H.onload=K=>{W(),C("loaded"),l==null||l(K)},H.onerror=K=>{W(),C("failed"),d==null||d(K)},O.current=H},[s,g,a,E,l,d,t]),W=()=>{O.current&&(O.current.onload=null,O.current.onerror=null,O.current=null)};return wm(()=>{if(!S)return b==="loading"&&k(),()=>{W()}},[b,k,S]),S?"loaded":b}const qOe=(r,t)=>r!=="loaded"&&t==="beforeLoadOrError"||r==="failed"&&t==="onError";function JQ(r){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:g,borderRadius:E,loading:S,iconLabel:b,icon:C=U.jsx(YQ,{}),ignoreFallback:O,referrerPolicy:k,crossOrigin:W}=r,K=XQ({src:t,onError:a,crossOrigin:W,ignoreFallback:O})==="loaded";return!t||!K?g?U.jsx(qQ,{className:"chakra-avatar__initials",getInitials:d,name:g}):j.cloneElement(C,{role:"img","aria-label":b}):U.jsx(kt.img,{src:t,srcSet:s,alt:g??b,onLoad:l,referrerPolicy:k,crossOrigin:W??void 0,className:"chakra-avatar__img",loading:S,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}JQ.displayName="AvatarImage";const YOe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},W_=Qt((r,t)=>{const s=xc("Avatar",r),[a,l]=j.useState(!1),{src:d,srcSet:g,name:E,showBorder:S,borderRadius:b="full",onError:C,onLoad:O,getInitials:k=$Oe,icon:W=U.jsx(YQ,{}),iconLabel:H=" avatar",loading:K,children:G,borderColor:te,ignoreFallback:J,crossOrigin:re,referrerPolicy:fe,...oe}=Ji(r),be={borderRadius:b,borderWidth:S?"2px":void 0,...YOe,...s.container};return te&&(be.borderColor=te),U.jsx(kt.span,{ref:t,...oe,className:An("chakra-avatar",r.className),"data-loaded":Gn(a),__css:be,children:U.jsxs(HOe,{value:s,children:[U.jsx(JQ,{src:d,srcSet:g,loading:K,onLoad:qn(O,()=>{l(!0)}),onError:C,getInitials:k,name:E,borderRadius:b,icon:W,iconLabel:H,ignoreFallback:J,crossOrigin:re,referrerPolicy:fe}),G]})})});W_.displayName="Avatar";const QQ=Qt(function(t,s){const a=rd("Badge",t),{className:l,...d}=Ji(t);return U.jsx(kt.span,{ref:s,className:An("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});QQ.displayName="Badge";const _n=kt("div");_n.displayName="Box";const[u3e,XOe]=Li({strict:!1,name:"ButtonGroupContext"});function xb(r){const{children:t,className:s,...a}=r,l=j.isValidElement(t)?j.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=An("chakra-button__icon",s);return U.jsx(kt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}xb.displayName="ButtonIcon";function v2(r){const{label:t,placement:s,spacing:a="0.5rem",children:l=U.jsx(xS,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:g,...E}=r,S=An("chakra-button__spinner",d),b=s==="start"?"marginEnd":"marginStart",C=j.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...g}),[g,t,b,a]);return U.jsx(kt.div,{className:S,...E,__css:C,children:l})}v2.displayName="ButtonSpinner";function JOe(r){const[t,s]=j.useState(!r);return{ref:j.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const Gp=Qt((r,t)=>{const s=XOe(),a=rd("Button",{...s,...r}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:g,children:E,leftIcon:S,rightIcon:b,loadingText:C,iconSpacing:O="0.5rem",type:k,spinner:W,spinnerPlacement:H="start",className:K,as:G,shouldWrapChildren:te,...J}=Ji(r),re=j.useMemo(()=>{const Z={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:Z}}},[a,s]),{ref:fe,type:oe}=JOe(G),be={rightIcon:b,leftIcon:S,iconSpacing:O,children:E,shouldWrapChildren:te};return U.jsxs(kt.button,{disabled:l||d,ref:kge(t,fe),as:G,type:k??oe,"data-active":Gn(g),"data-loading":Gn(d),__css:re,className:An("chakra-button",K),...J,children:[d&&H==="start"&&U.jsx(v2,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:O,children:W}),d?C||U.jsx(kt.span,{opacity:0,children:U.jsx(lq,{...be})}):U.jsx(lq,{...be}),d&&H==="end"&&U.jsx(v2,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:O,children:W})]})});Gp.displayName="Button";function lq(r){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=r;return d?U.jsxs("span",{style:{display:"contents"},children:[t&&U.jsx(xb,{marginEnd:l,children:t}),a,s&&U.jsx(xb,{marginStart:l,children:s})]}):U.jsxs(U.Fragment,{children:[t&&U.jsx(xb,{marginEnd:l,children:t}),a,s&&U.jsx(xb,{marginStart:l,children:s})]})}const ol=Qt((r,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...g}=r,E=s||a,S=j.isValidElement(E)?j.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return U.jsx(Gp,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...g,children:S})});ol.displayName="IconButton";const ZQ=kt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});ZQ.displayName="Center";const QOe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Qt(function(t,s){const{axis:a="both",...l}=t;return U.jsx(kt.div,{ref:s,__css:QOe[a],...l,position:"absolute"})});var ZOe=()=>typeof document<"u",uq=!1,Xw=null,G_=!1,y2=!1,S2=new Set;function bV(r,t){S2.forEach(s=>s(r,t))}var ePe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function tPe(r){return!(r.metaKey||!ePe&&r.altKey||r.ctrlKey||r.key==="Control"||r.key==="Shift"||r.key==="Meta")}function dq(r){G_=!0,tPe(r)&&(Xw="keyboard",bV("keyboard",r))}function Ty(r){if(Xw="pointer",r.type==="mousedown"||r.type==="pointerdown"){G_=!0;const t=r.composedPath?r.composedPath()[0]:r.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;bV("pointer",r)}}function nPe(r){return r.mozInputSource===0&&r.isTrusted?!0:r.detail===0&&!r.pointerType}function rPe(r){nPe(r)&&(G_=!0,Xw="virtual")}function iPe(r){r.target===window||r.target===document||r.target instanceof Element&&r.target.hasAttribute("tabindex")||(!G_&&!y2&&(Xw="virtual",bV("virtual",r)),G_=!1,y2=!1)}function sPe(){G_=!1,y2=!0}function hq(){return Xw!=="pointer"}function oPe(){if(!ZOe()||uq)return;const{focus:r}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){G_=!0,r.apply(this,s)},document.addEventListener("keydown",dq,!0),document.addEventListener("keyup",dq,!0),document.addEventListener("click",rPe,!0),window.addEventListener("focus",iPe,!0),window.addEventListener("blur",sPe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",Ty,!0),document.addEventListener("pointermove",Ty,!0),document.addEventListener("pointerup",Ty,!0)):(document.addEventListener("mousedown",Ty,!0),document.addEventListener("mousemove",Ty,!0),document.addEventListener("mouseup",Ty,!0)),uq=!0}function aPe(r){oPe(),r(hq());const t=()=>r(hq());return S2.add(t),()=>{S2.delete(t)}}const[cPe,eZ]=Li({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[lPe,MS]=Li({strict:!1,name:"FormControlContext"});function uPe(r){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...g}=r,E=j.useId(),S=t||`field-${E}`,b=`${S}-label`,C=`${S}-feedback`,O=`${S}-helptext`,[k,W]=j.useState(!1),[H,K]=j.useState(!1),[G,te]=j.useState(!1),J=j.useCallback((Z={},ne=null)=>({id:O,...Z,ref:qi(ne,se=>{se&&K(!0)})}),[O]),re=j.useCallback((Z={},ne=null)=>({...Z,ref:ne,"data-focus":Gn(G),"data-disabled":Gn(l),"data-invalid":Gn(a),"data-readonly":Gn(d),id:Z.id!==void 0?Z.id:b,htmlFor:Z.htmlFor!==void 0?Z.htmlFor:S}),[S,l,G,a,d,b]),fe=j.useCallback((Z={},ne=null)=>({id:C,...Z,ref:qi(ne,se=>{se&&W(!0)}),"aria-live":"polite"}),[C]),oe=j.useCallback((Z={},ne=null)=>({...Z,...g,ref:ne,role:"group","data-focus":Gn(G),"data-disabled":Gn(l),"data-invalid":Gn(a),"data-readonly":Gn(d)}),[g,l,G,a,d]),be=j.useCallback((Z={},ne=null)=>({...Z,ref:ne,role:"presentation","aria-hidden":!0,children:Z.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!G,onFocus:()=>te(!0),onBlur:()=>te(!1),hasFeedbackText:k,setHasFeedbackText:W,hasHelpText:H,setHasHelpText:K,id:S,labelId:b,feedbackId:C,helpTextId:O,htmlProps:g,getHelpTextProps:J,getErrorMessageProps:fe,getRootProps:oe,getLabelProps:re,getRequiredIndicatorProps:be}}const Bo=Qt(function(t,s){const a=xc("Form",t),l=Ji(t),{getRootProps:d,htmlProps:g,...E}=uPe(l),S=An("chakra-form-control",t.className);return U.jsx(lPe,{value:E,children:U.jsx(cPe,{value:a,children:U.jsx(kt.div,{...d({},s),className:S,__css:a.container})})})});Bo.displayName="FormControl";const dPe=Qt(function(t,s){const a=MS(),l=eZ(),d=An("chakra-form__helper-text",t.className);return U.jsx(kt.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});dPe.displayName="FormHelperText";function tZ(r){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=nZ(r);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":Ky(s),"aria-required":Ky(l),"aria-readonly":Ky(a)}}function nZ(r){const t=MS(),{id:s,disabled:a,readOnly:l,required:d,isRequired:g,isInvalid:E,isReadOnly:S,isDisabled:b,onFocus:C,onBlur:O,...k}=r,W=r["aria-describedby"]?[r["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&W.push(t.feedbackId),t!=null&&t.hasHelpText&&W.push(t.helpTextId),{...k,"aria-describedby":W.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??b??(t==null?void 0:t.isDisabled),isReadOnly:l??S??(t==null?void 0:t.isReadOnly),isRequired:d??g??(t==null?void 0:t.isRequired),isInvalid:E??(t==null?void 0:t.isInvalid),onFocus:qn(t==null?void 0:t.onFocus,C),onBlur:qn(t==null?void 0:t.onBlur,O)}}const hPe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function pPe(r={}){const t=nZ(r),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:g,onBlur:E,onFocus:S,"aria-describedby":b}=t,{defaultChecked:C,isChecked:O,isFocusable:k,onChange:W,isIndeterminate:H,name:K,value:G,tabIndex:te=void 0,"aria-label":J,"aria-labelledby":re,"aria-invalid":fe,...oe}=r,be=Fw(oe,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Z=Pc(W),ne=Pc(E),se=Pc(S),[ue,Ee]=j.useState(!1),[he,le]=j.useState(!1),[Me,pt]=j.useState(!1),[et,Oe]=j.useState(!1);j.useEffect(()=>aPe(Ee),[]);const Ue=j.useRef(null),[xe,it]=j.useState(!0),[Ae,$e]=j.useState(!!C),Ze=O!==void 0,Fe=Ze?O:Ae,ct=j.useCallback(Xt=>{if(a||s){Xt.preventDefault();return}Ze||$e(Fe?Xt.currentTarget.checked:H?!0:Xt.currentTarget.checked),Z==null||Z(Xt)},[a,s,Fe,Ze,H,Z]);wm(()=>{Ue.current&&(Ue.current.indeterminate=!!H)},[H]),Pm(()=>{s&&le(!1)},[s,le]),wm(()=>{const Xt=Ue.current;if(!(Xt!=null&&Xt.form))return;const Qn=()=>{$e(!!C)};return Xt.form.addEventListener("reset",Qn),()=>{var Wt;return(Wt=Xt.form)==null?void 0:Wt.removeEventListener("reset",Qn)}},[]);const _t=s&&!k,Pt=j.useCallback(Xt=>{Xt.key===" "&&Oe(!0)},[Oe]),Ht=j.useCallback(Xt=>{Xt.key===" "&&Oe(!1)},[Oe]);wm(()=>{if(!Ue.current)return;Ue.current.checked!==Fe&&$e(Ue.current.checked)},[Ue.current]);const xt=j.useCallback((Xt={},Qn=null)=>{const Wt=ve=>{he&&ve.preventDefault(),Oe(!0)};return{...Xt,ref:Qn,"data-active":Gn(et),"data-hover":Gn(Me),"data-checked":Gn(Fe),"data-focus":Gn(he),"data-focus-visible":Gn(he&&ue),"data-indeterminate":Gn(H),"data-disabled":Gn(s),"data-invalid":Gn(d),"data-readonly":Gn(a),"aria-hidden":!0,onMouseDown:qn(Xt.onMouseDown,Wt),onMouseUp:qn(Xt.onMouseUp,()=>Oe(!1)),onMouseEnter:qn(Xt.onMouseEnter,()=>pt(!0)),onMouseLeave:qn(Xt.onMouseLeave,()=>pt(!1))}},[et,Fe,s,he,ue,Me,H,d,a]),fn=j.useCallback((Xt={},Qn=null)=>({...Xt,ref:Qn,"data-active":Gn(et),"data-hover":Gn(Me),"data-checked":Gn(Fe),"data-focus":Gn(he),"data-focus-visible":Gn(he&&ue),"data-indeterminate":Gn(H),"data-disabled":Gn(s),"data-invalid":Gn(d),"data-readonly":Gn(a)}),[et,Fe,s,he,ue,Me,H,d,a]),Rn=j.useCallback((Xt={},Qn=null)=>({...be,htmlFor:xe?g:void 0,...Xt,ref:qi(Qn,Wt=>{Wt&&it(Wt.tagName==="LABEL")}),onClick:qn(Xt.onClick,()=>{var Wt;xe||((Wt=Ue.current)==null||Wt.click(),requestAnimationFrame(()=>{var ve;(ve=Ue.current)==null||ve.focus({preventScroll:!0})}))}),"data-disabled":Gn(s),"data-checked":Gn(Fe),"data-invalid":Gn(d)}),[be,s,Fe,d,xe,g]),ln=j.useCallback((Xt={},Qn=null)=>({...Xt,ref:qi(Ue,Qn),type:"checkbox",name:K,value:G,id:g,tabIndex:te,onChange:qn(Xt.onChange,ct),onBlur:qn(Xt.onBlur,ne,()=>le(!1)),onFocus:qn(Xt.onFocus,se,()=>le(!0)),onKeyDown:qn(Xt.onKeyDown,Pt),onKeyUp:qn(Xt.onKeyUp,Ht),required:l,checked:Fe,disabled:_t,readOnly:a,"aria-label":J,"aria-labelledby":re,"aria-invalid":fe?!!fe:d,"aria-describedby":b,"aria-disabled":s,"aria-checked":H?"mixed":Fe,style:hPe}),[K,G,g,te,ct,ne,se,Pt,Ht,l,Fe,_t,a,J,re,fe,d,b,s,H]),Hn=j.useCallback((Xt={},Qn=null)=>({...Xt,ref:Qn,onMouseDown:qn(Xt.onMouseDown,fPe),"data-disabled":Gn(s),"data-checked":Gn(Fe),"data-invalid":Gn(d)}),[Fe,s,d]);return{state:{isInvalid:d,isFocused:he,isChecked:Fe,isActive:et,isHovered:Me,isIndeterminate:H,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:Rn,getCheckboxProps:xt,getIndicatorProps:fn,getInputProps:ln,getLabelProps:Hn,htmlProps:be}}function fPe(r){r.preventDefault(),r.stopPropagation()}const wV=Qt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:g,borderWidth:E,borderStyle:S,borderColor:b,...C}=rd("Divider",t),{className:O,orientation:k="horizontal",__css:W,...H}=Ji(t),K={vertical:{borderLeftWidth:a||g||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return U.jsx(kt.hr,{ref:s,"aria-orientation":k,...H,__css:{...C,border:"0",borderColor:b,borderStyle:S,...K[k],...W},className:An("chakra-divider",O)})});wV.displayName="Divider";const bP=Qt(function(t,s){const{direction:a,align:l,justify:d,wrap:g,basis:E,grow:S,shrink:b,...C}=t,O={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:g,flexBasis:E,flexGrow:S,flexShrink:b};return U.jsx(kt.div,{ref:s,__css:O,...C})});bP.displayName="Flex";function mPe(r,t){if(r==null)return{};var s={};for(var a in r)if({}.hasOwnProperty.call(r,a)){if(t.indexOf(a)!==-1)continue;s[a]=r[a]}return s}var lM={exports:{}},uM,pq;function gPe(){if(pq)return uM;pq=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return uM=r,uM}var dM,fq;function _Pe(){if(fq)return dM;fq=1;var r=gPe();function t(){}function s(){}return s.resetWarningCache=t,dM=function(){function a(g,E,S,b,C,O){if(O!==r){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},dM}var mq;function EPe(){return mq||(mq=1,lM.exports=_Pe()()),lM.exports}var vPe=EPe();const ai=OS(vPe);var T2="data-focus-lock",rZ="data-focus-lock-disabled",yPe="data-no-focus-lock",SPe="data-autofocus-inside",TPe="data-no-autofocus";function hM(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function bPe(r,t){var s=j.useState(function(){return{value:r,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var wPe=typeof window<"u"?j.useLayoutEffect:j.useEffect,gq=new WeakMap;function iZ(r,t){var s=bPe(null,function(a){return r.forEach(function(l){return hM(l,a)})});return wPe(function(){var a=gq.get(s);if(a){var l=new Set(a),d=new Set(r),g=s.current;l.forEach(function(E){d.has(E)||hM(E,null)}),d.forEach(function(E){l.has(E)||hM(E,g)})}gq.set(s,r)},[r]),s}var pM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},ah=function(){return ah=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},ah.apply(this,arguments)};function Jw(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s}function RPe(r,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return r.concat(d||Array.prototype.slice.call(t))}function sZ(r){return r}function oZ(r,t){t===void 0&&(t=sZ);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:r},useMedium:function(d){var g=t(d,a);return s.push(g),function(){s=s.filter(function(E){return E!==g})}},assignSyncMedium:function(d){for(a=!0;s.length;){var g=s;s=[],g.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var g=[];if(s.length){var E=s;s=[],E.forEach(d),g=s}var S=function(){var C=g;g=[],C.forEach(d)},b=function(){return Promise.resolve().then(S)};b(),s={push:function(C){g.push(C),b()},filter:function(C){return g=g.filter(C),s}}}};return l}function RV(r,t){return t===void 0&&(t=sZ),oZ(r,t)}function aZ(r){r===void 0&&(r={});var t=oZ(null);return t.options=ah({async:!0,ssr:!1},r),t}var cZ=function(r){var t=r.sideCar,s=Jw(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return j.createElement(a,ah({},s))};cZ.isSideCarExport=!0;function CPe(r,t){return r.useMedium(t),cZ}var lZ=RV({},function(r){var t=r.target,s=r.currentTarget;return{target:t,currentTarget:s}}),uZ=RV(),IPe=RV(),APe=aZ({async:!0,ssr:typeof document<"u"}),OPe=j.createContext(void 0),PPe=[],CV=j.forwardRef(function(t,s){var a,l=j.useState(),d=l[0],g=l[1],E=j.useRef(),S=j.useRef(!1),b=j.useRef(null),C=j.useState({}),O=C[1],k=t.children,W=t.disabled,H=W===void 0?!1:W,K=t.noFocusGuards,G=K===void 0?!1:K,te=t.persistentFocus,J=te===void 0?!1:te,re=t.crossFrame,fe=re===void 0?!0:re,oe=t.autoFocus,be=oe===void 0?!0:oe;t.allowTextSelection;var Z=t.group,ne=t.className,se=t.whiteList,ue=t.hasPositiveIndices,Ee=t.shards,he=Ee===void 0?PPe:Ee,le=t.as,Me=le===void 0?"div":le,pt=t.lockProps,et=pt===void 0?{}:pt,Oe=t.sideCar,Ue=t.returnFocus,xe=Ue===void 0?!1:Ue,it=t.focusOptions,Ae=t.onActivation,$e=t.onDeactivation,Ze=j.useState({}),Fe=Ze[0],ct=j.useCallback(function(Qn){var Wt=Qn.captureFocusRestore;if(!b.current){var ve,Ne=(ve=document)==null?void 0:ve.activeElement;b.current=Ne,Ne!==document.body&&(b.current=Wt(Ne))}E.current&&Ae&&Ae(E.current),S.current=!0,O()},[Ae]),_t=j.useCallback(function(){S.current=!1,$e&&$e(E.current),O()},[$e]),Pt=j.useCallback(function(Qn){var Wt=b.current;if(Wt){var ve=(typeof Wt=="function"?Wt():Wt)||document.body,Ne=typeof xe=="function"?xe(ve):xe;if(Ne){var We=typeof Ne=="object"?Ne:void 0;b.current=null,Qn?Promise.resolve().then(function(){return ve.focus(We)}):ve.focus(We)}}},[xe]),Ht=j.useCallback(function(Qn){S.current&&lZ.useMedium(Qn)},[]),xt=uZ.useMedium,fn=j.useCallback(function(Qn){E.current!==Qn&&(E.current=Qn,g(Qn))},[]),Rn=B_((a={},a[rZ]=H&&"disabled",a[T2]=Z,a),et),ln=G!==!0,Hn=ln&&G!=="tail",Ar=iZ([s,fn]),Xt=j.useMemo(function(){return{observed:E,shards:he,enabled:!H,active:S.current}},[H,S.current,he,d]);return Qr.createElement(j.Fragment,null,ln&&[Qr.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:H?-1:0,style:pM}),ue?Qr.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:H?-1:1,style:pM}):null],!H&&Qr.createElement(Oe,{id:Fe,sideCar:APe,observed:d,disabled:H,persistentFocus:J,crossFrame:fe,autoFocus:be,whiteList:se,shards:he,onActivation:ct,onDeactivation:_t,returnFocus:Pt,focusOptions:it,noFocusGuards:G}),Qr.createElement(Me,B_({ref:Ar},Rn,{className:ne,onBlur:xt,onFocus:Ht}),Qr.createElement(OPe.Provider,{value:Xt},k)),Hn&&Qr.createElement("div",{"data-focus-guard":!0,tabIndex:H?-1:0,style:pM}))});CV.propTypes={};function b2(r,t){return b2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},b2(r,t)}function NPe(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,b2(r,t)}function Tw(r){"@babel/helpers - typeof";return Tw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tw(r)}function kPe(r,t){if(Tw(r)!="object"||!r)return r;var s=r[Symbol.toPrimitive];if(s!==void 0){var a=s.call(r,t);if(Tw(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function DPe(r){var t=kPe(r,"string");return Tw(t)=="symbol"?t:t+""}function LPe(r,t,s){return(t=DPe(t))in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function xPe(r,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],g;function E(){g=r(d.map(function(b){return b.props})),t(g)}var S=function(b){NPe(C,b);function C(){return b.apply(this,arguments)||this}C.peek=function(){return g};var O=C.prototype;return O.componentDidMount=function(){d.push(this),E()},O.componentDidUpdate=function(){E()},O.componentWillUnmount=function(){var W=d.indexOf(this);d.splice(W,1),E()},O.render=function(){return Qr.createElement(l,this.props)},C}(j.PureComponent);return LPe(S,"displayName","SideEffect("+s(l)+")"),S}}var Ch=function(r){for(var t=Array(r.length),s=0;s<r.length;++s)t[s]=r[s];return t},z_=function(r){return Array.isArray(r)?r:[r]},dZ=function(r){return Array.isArray(r)?r[0]:r},MPe=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(r,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},hZ=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},pZ=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},UPe=function(r){return r.hasAttribute("inert")},VPe=function(r,t){return!r||pZ(r)||!MPe(r)&&!UPe(r)&&t(hZ(r))},fZ=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=VPe(t,fZ.bind(void 0,r));return r.set(t,a),a},FPe=function(r,t){return r&&!pZ(r)?WPe(r)?t(hZ(r)):!1:!0},mZ=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=FPe(t,mZ.bind(void 0,r));return r.set(t,a),a},gZ=function(r){return r.dataset},jPe=function(r){return r.tagName==="BUTTON"},_Z=function(r){return r.tagName==="INPUT"},EZ=function(r){return _Z(r)&&r.type==="radio"},BPe=function(r){return!((_Z(r)||jPe(r))&&(r.type==="hidden"||r.disabled))},WPe=function(r){var t=r.getAttribute(TPe);return![!0,"true",""].includes(t)},IV=function(r){var t;return!!(r&&(!((t=gZ(r))===null||t===void 0)&&t.focusGuard))},w2=function(r){return!IV(r)},GPe=function(r){return!!r},zPe=function(r,t){var s=Math.max(0,r.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=r.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},HPe=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},AV=function(r,t,s){return Ch(r).map(function(a,l){var d=HPe(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(zPe)},KPe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],OV=KPe.join(","),$Pe="".concat(OV,", [data-focus-guard]"),vZ=function(r,t){return Ch((r.shadowRoot||r).children).reduce(function(s,a){return s.concat(a.matches(t?$Pe:OV)?[a]:[],vZ(a))},[])},qPe=function(r,t){var s;return r instanceof HTMLIFrameElement&&(!((s=r.contentDocument)===null||s===void 0)&&s.body)?mS([r.contentDocument.body],t):[r]},mS=function(r,t){return r.reduce(function(s,a){var l,d=vZ(a,t),g=(l=[]).concat.apply(l,d.map(function(E){return qPe(E,t)}));return s.concat(g,a.parentNode?Ch(a.parentNode.querySelectorAll(OV)).filter(function(E){return E===a}):[])},[])},YPe=function(r){var t=r.querySelectorAll("[".concat(SPe,"]"));return Ch(t).map(function(s){return mS([s])}).reduce(function(s,a){return s.concat(a)},[])},PV=function(r,t){return Ch(r).filter(function(s){return fZ(t,s)}).filter(function(s){return BPe(s)})},_q=function(r,t){return t===void 0&&(t=new Map),Ch(r).filter(function(s){return mZ(t,s)})},NV=function(r,t,s){return AV(PV(mS(r,s),t),!0,s)},bw=function(r,t){return AV(PV(mS(r),t),!1)},XPe=function(r,t){return PV(YPe(r),t)},U_=function(r,t){return r.shadowRoot?U_(r.shadowRoot,t):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,t)?!0:Ch(r.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?U_(l,t):!1}return U_(s,t)})},JPe=function(r){for(var t=new Set,s=r.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=r[a].compareDocumentPosition(r[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return r.filter(function(g,E){return!t.has(E)})},yZ=function(r){return r.parentNode?yZ(r.parentNode):r},kV=function(r){var t=z_(r);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(T2);return s.push.apply(s,l?JPe(Ch(yZ(a).querySelectorAll("[".concat(T2,'="').concat(l,'"]:not([').concat(rZ,'="disabled"])')))):[a]),s},[])},QPe=function(r){try{return r()}catch{return}},ww=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var t=r.activeElement;return t.shadowRoot?ww(t.shadowRoot):t instanceof HTMLIFrameElement&&QPe(function(){return t.contentWindow.document})?ww(t.contentWindow.document):t}},ZPe=function(r,t){return r===t},eNe=function(r,t){return!!Ch(r.querySelectorAll("iframe")).some(function(s){return ZPe(s,t)})},SZ=function(r,t){return t===void 0&&(t=ww(dZ(r).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:kV(r).some(function(s){return U_(s,t)||eNe(s,t)})},tNe=function(r){r===void 0&&(r=document);var t=ww(r);return t?Ch(r.querySelectorAll("[".concat(yPe,"]"))).some(function(s){return U_(s,t)}):!1},nNe=function(r,t){return t.filter(EZ).filter(function(s){return s.name===r.name}).filter(function(s){return s.checked})[0]||r},DV=function(r,t){return EZ(r)&&r.name?nNe(r,t):r},rNe=function(r){var t=new Set;return r.forEach(function(s){return t.add(DV(s,r))}),r.filter(function(s){return t.has(s)})},Eq=function(r){return r[0]&&r.length>1?DV(r[0],r):r[0]},vq=function(r,t){return r.indexOf(DV(t,r))},R2="NEW_FOCUS",iNe=function(r,t,s,a,l){var d=r.length,g=r[0],E=r[d-1],S=IV(a);if(!(a&&r.indexOf(a)>=0)){var b=a!==void 0?s.indexOf(a):-1,C=l?s.indexOf(l):b,O=l?r.indexOf(l):-1;if(b===-1)return O!==-1?O:R2;if(O===-1)return R2;var k=b-C,W=s.indexOf(g),H=s.indexOf(E),K=rNe(s),G=a!==void 0?K.indexOf(a):-1,te=l?K.indexOf(l):G,J=K.filter(function(ne){return ne.tabIndex>=0}),re=a!==void 0?J.indexOf(a):-1,fe=l?J.indexOf(l):re,oe=re>=0&&fe>=0?fe-re:te-G;if(!k&&O>=0||t.length===0)return O;var be=vq(r,t[0]),Z=vq(r,t[t.length-1]);if(b<=W&&S&&Math.abs(k)>1)return Z;if(b>=H&&S&&Math.abs(k)>1)return be;if(k&&Math.abs(oe)>1)return O;if(b<=W)return Z;if(b>H)return be;if(k)return Math.abs(k)>1?O:(d+O+k)%d}},sNe=function(r){return function(t){var s,a=(s=gZ(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||r.indexOf(t)>=0}},yq=function(r,t,s){var a=r.map(function(d){var g=d.node;return g}),l=_q(a.filter(sNe(s)));return l&&l.length?Eq(l):Eq(_q(t))},C2=function(r,t){return t===void 0&&(t=[]),t.push(r),r.parentNode&&C2(r.parentNode.host||r.parentNode,t),t},fM=function(r,t){for(var s=C2(r),a=C2(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},TZ=function(r,t,s){var a=z_(r),l=z_(t),d=a[0],g=!1;return l.filter(Boolean).forEach(function(E){g=fM(g||E,E)||g,s.filter(Boolean).forEach(function(S){var b=fM(d,S);b&&(!g||U_(b,g)?g=b:g=fM(b,g))})}),g},Sq=function(r,t){return r.reduce(function(s,a){return s.concat(XPe(a,t))},[])},oNe=function(r,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),r.map(function(a){return s.get(a)}).filter(GPe)},aNe=function(r,t){var s=ww(z_(r).length>0?document:dZ(r).ownerDocument),a=kV(r).filter(w2),l=TZ(s||r,r,a),d=new Map,g=bw(a,d),E=g.filter(function(H){var K=H.node;return w2(K)});if(E[0]){var S=bw([l],d).map(function(H){var K=H.node;return K}),b=oNe(S,E),C=b.map(function(H){var K=H.node;return K}),O=b.filter(function(H){var K=H.tabIndex;return K>=0}).map(function(H){var K=H.node;return K}),k=iNe(C,O,S,s,t);if(k===R2){var W=yq(g,O,Sq(a,d))||yq(g,C,Sq(a,d));if(W)return{node:W};console.warn("focus-lock: cannot find any node to move focus into");return}return k===void 0?k:b[k]}},cNe=function(r){var t=kV(r).filter(w2),s=TZ(r,r,t),a=AV(mS([s],!0),!0,!0),l=mS(t,!1);return a.map(function(d){var g=d.node,E=d.index;return{node:g,index:E,lockItem:l.indexOf(g)>=0,guard:IV(g)}})},LV=function(r,t){r&&("focus"in r&&r.focus(t),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},mM=0,gM=!1,bZ=function(r,t,s){s===void 0&&(s={});var a=aNe(r,t);if(!gM&&a){if(mM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),gM=!0,setTimeout(function(){gM=!1},1);return}mM++,LV(a.node,s.focusOptions),mM--}};function hb(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var t=r?new WeakRef(r):null;return function(){return(t==null?void 0:t.deref())||null}}var lNe=function(r){if(!r)return null;for(var t=[],s=r;s&&s!==document.body;)t.push({current:hb(s),parent:hb(s.parentElement),left:hb(s.previousElementSibling),right:hb(s.nextElementSibling)}),s=s.parentElement;return{element:hb(r),stack:t,ownerDocument:r.ownerDocument}},uNe=function(r){var t,s,a,l,d;if(r)for(var g=r.stack,E=r.ownerDocument,S=new Map,b=0,C=g;b<C.length;b++){var O=C[b],k=(t=O.parent)===null||t===void 0?void 0:t.call(O);if(k&&E.contains(k)){for(var W=(s=O.left)===null||s===void 0?void 0:s.call(O),H=O.current(),K=k.contains(H)?H:void 0,G=(a=O.right)===null||a===void 0?void 0:a.call(O),te=NV([k],S),J=(d=(l=K??(W==null?void 0:W.nextElementSibling))!==null&&l!==void 0?l:G)!==null&&d!==void 0?d:W;J;){for(var re=0,fe=te;re<fe.length;re++){var oe=fe[re];if(J!=null&&J.contains(oe.node))return oe.node}J=J.nextElementSibling}if(te.length)return te[0].node}}},wZ=function(r){var t=lNe(r);return function(){return uNe(t)}},dNe=function(r,t,s){if(!r||!t)return console.error("no element or scope given"),{};var a=z_(t);if(a.every(function(g){return!U_(g,r)}))return console.error("Active element is not contained in the scope"),{};var l=s?NV(a,new Map):bw(a,new Map),d=l.findIndex(function(g){var E=g.node;return E===r});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},hNe=function(r,t){var s=t?NV(z_(r),new Map):bw(z_(r),new Map);return{first:s[0],last:s[s.length-1]}},pNe=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},RZ=function(r,t,s){t===void 0&&(t={});var a=pNe(t),l=dNe(r,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&LV(d.node,a.focusOptions)}},fNe=function(r,t){t===void 0&&(t={}),RZ(r,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},mNe=function(r,t){t===void 0&&(t={}),RZ(r,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},CZ=function(r,t,s){var a,l=hNe(r,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&LV(d.node,t.focusOptions)},gNe=function(r,t){t===void 0&&(t={}),CZ(r,t,"first")},_Ne=function(r,t){t===void 0&&(t={}),CZ(r,t,"last")};function xV(r){setTimeout(r,1)}var ENe=function(t){return t&&"current"in t?t.current:t},IZ=function(){return document&&document.activeElement===document.body},vNe=function(){return IZ()||tNe()},tS=null,wc=null,Tq=function(){return null},nS=null,Rw=!1,MV=!1,yNe=function(){return!0},SNe=function(t){return(tS.whiteList||yNe)(t)},TNe=function(t,s){nS={observerNode:t,portaledElement:s}},bNe=function(t){return nS&&nS.portaledElement===t};function bq(r,t,s,a){var l=null,d=r;do{var g=a[d];if(g.guard)g.node.dataset.focusAutoGuard&&(l=g);else if(g.lockItem){if(d!==r)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var wNe=function(t){return t?!!Rw:Rw==="meanwhile"},RNe=function r(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&r(t,s.parentNode,a))},CNe=function(t,s){return s.some(function(a){return RNe(t,a,a)})},AZ=function(t){return bw(t,new Map)},INe=function(t){return!AZ([t.parentNode]).some(function(s){return s.node===t})},wP=function(){var t=!1;if(tS){var s=tS,a=s.observed,l=s.persistentFocus,d=s.autoFocus,g=s.shards,E=s.crossFrame,S=s.focusOptions,b=s.noFocusGuards,C=a||nS&&nS.portaledElement;if(IZ()&&wc&&wc!==document.body&&(!document.body.contains(wc)||INe(wc))){var O=Tq();O&&O.focus()}var k=document&&document.activeElement;if(C){var W=[C].concat(g.map(ENe).filter(Boolean)),H=function(){if(!wNe(E)||!b||!wc||MV)return!1;var re=AZ(W),fe=re.findIndex(function(oe){var be=oe.node;return be===wc});return fe===0||fe===re.length-1};if((!k||SNe(k))&&(l||H()||!vNe()||!wc&&d)&&(C&&!(SZ(W)||k&&CNe(k,W)||bNe(k))&&(document&&!wc&&k&&!d?(k.blur&&k.blur(),document.body.focus()):(t=bZ(W,wc,{focusOptions:S}),nS={})),wc=document&&document.activeElement,wc!==document.body&&(Tq=wZ(wc)),Rw=!1),document&&k!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var K=document&&document.activeElement,G=cNe(W),te=G.map(function(J){var re=J.node;return re}).indexOf(K);te>-1&&(G.filter(function(J){var re=J.guard,fe=J.node;return re&&fe.dataset.focusAutoGuard}).forEach(function(J){var re=J.node;return re.removeAttribute("tabIndex")}),bq(te,G.length,1,G),bq(te,-1,-1,G))}}}return t},OZ=function(t){wP()&&t&&(t.stopPropagation(),t.preventDefault())},UV=function(){return xV(wP)},ANe=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||TNe(a,s)},ONe=function(){return null},PZ=function(){MV=!0},NZ=function(){MV=!1,Rw="just",xV(function(){Rw="meanwhile"})},PNe=function(){document.addEventListener("focusin",OZ),document.addEventListener("focusout",UV),window.addEventListener("focus",PZ),window.addEventListener("blur",NZ)},NNe=function(){document.removeEventListener("focusin",OZ),document.removeEventListener("focusout",UV),window.removeEventListener("focus",PZ),window.removeEventListener("blur",NZ)};function kNe(r){return r.filter(function(t){var s=t.disabled;return!s})}var kZ={moveFocusInside:bZ,focusInside:SZ,focusNextElement:fNe,focusPrevElement:mNe,focusFirstElement:gNe,focusLastElement:_Ne,captureFocusRestore:wZ};function DNe(r){var t=r.slice(-1)[0];t&&!tS&&PNe();var s=tS,a=s&&t&&t.id===s.id;tS=t,s&&!a&&(s.onDeactivation(),r.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(wc=null,(!a||s.observed!==t.observed)&&t.onActivation(kZ),wP(),xV(wP)):(NNe(),wc=null)}lZ.assignSyncMedium(ANe);uZ.assignMedium(UV);IPe.assignMedium(function(r){return r(kZ)});const LNe=xPe(kNe,DNe)(ONe);var I2=j.forwardRef(function(t,s){return Qr.createElement(CV,B_({sideCar:LNe,ref:s},t))}),DZ=CV.propTypes||{};DZ.sideCar;mPe(DZ,["sideCar"]);I2.propTypes={};const xNe=I2.default??I2,LZ=r=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:g,autoFocus:E,persistentFocus:S,lockFocusAcrossFrames:b}=r,C=j.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&pX(a.current).length===0&&requestAnimationFrame(()=>{var H;(H=a.current)==null||H.focus()})},[t,a]),O=j.useCallback(()=>{var W;(W=s==null?void 0:s.current)==null||W.focus()},[s]),k=l&&!s;return U.jsx(xNe,{crossFrame:b,persistentFocus:S,autoFocus:E,disabled:g,onActivation:C,onDeactivation:O,returnFocus:k,children:d})};LZ.displayName="FocusLock";const[MNe,UNe]=Li({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Ap=Qt((r,t)=>{const s=xc("FormError",r),a=Ji(r),l=MS();return l!=null&&l.isInvalid?U.jsx(MNe,{value:s,children:U.jsx(kt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:An("chakra-form__error-message",r.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});Ap.displayName="FormErrorMessage";const VNe=Qt((r,t)=>{const s=UNe(),a=MS();if(!(a!=null&&a.isInvalid))return null;const l=An("chakra-form__error-icon",r.className);return U.jsx(Wm,{ref:t,"aria-hidden":!0,...r,__css:s.icon,className:l,children:U.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});VNe.displayName="FormErrorIcon";const T_=Qt(function(t,s){const a=rd("FormLabel",t),l=Ji(t),{className:d,children:g,requiredIndicator:E=U.jsx(xZ,{}),optionalIndicator:S=null,...b}=l,C=MS(),O=(C==null?void 0:C.getLabelProps(b,s))??{ref:s,...b};return U.jsxs(kt.label,{...O,className:An("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[g,C!=null&&C.isRequired?E:S]})});T_.displayName="FormLabel";const xZ=Qt(function(t,s){const a=MS(),l=eZ();if(!(a!=null&&a.isRequired))return null;const d=An("chakra-form__required-indicator",t.className);return U.jsx(kt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});xZ.displayName="RequiredIndicator";const MZ=Qt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:g,column:E,row:S,autoFlow:b,autoRows:C,templateRows:O,autoColumns:k,templateColumns:W,...H}=t,K={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:g,gridAutoColumns:k,gridColumn:E,gridRow:S,gridAutoFlow:b,gridAutoRows:C,gridTemplateRows:O,gridTemplateColumns:W};return U.jsx(kt.div,{ref:s,__css:K,...H})});MZ.displayName="Grid";const UZ=Qt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:g,minChildWidth:E,...S}=t,b=LS(),C=E?jNe(E,b):BNe(a);return U.jsx(MZ,{ref:s,gap:g,columnGap:l,rowGap:d,templateColumns:C,...S})});UZ.displayName="SimpleGrid";function FNe(r){return typeof r=="number"?`${r}px`:r}function jNe(r,t){return yU(r,s=>{const a=EOe("sizes",s,FNe(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function BNe(r){return yU(r,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function Qw(r){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=r,d=j.Children.toArray(r.path),g=Qt((E,S)=>U.jsx(Wm,{ref:S,viewBox:t,...l,...E,children:d.length?d:U.jsx("path",{fill:"currentColor",d:s})}));return g.displayName=a,g}const A2=Qt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...g}=t;return U.jsx("img",{width:a,height:l,ref:s,alt:d,...g})});A2.displayName="NativeImage";const VV=Qt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:g,align:E,fit:S,loading:b,ignoreFallback:C,crossOrigin:O,fallbackStrategy:k="beforeLoadOrError",referrerPolicy:W,...H}=t,K=a!==void 0||l!==void 0,G=b!=null||C||!K,te=XQ({...t,crossOrigin:O,ignoreFallback:G}),J=qOe(te,k),re={ref:s,objectFit:S,objectPosition:E,...G?H:Fw(H,["onError","onLoad"])};return J?l||U.jsx(kt.img,{as:A2,className:"chakra-image__placeholder",src:a,...re}):U.jsx(kt.img,{as:A2,src:d,srcSet:g,crossOrigin:O,loading:b,referrerPolicy:W,className:"chakra-image",...re})});VV.displayName="Image";const tu=Qt(function(t,s){const{htmlSize:a,...l}=t,d=xc("Input",l),g=Ji(l),E=tZ(g),S=An("chakra-input",t.className);return U.jsx(kt.input,{size:a,...E,__css:d.field,ref:s,className:S})});tu.displayName="Input";tu.id="Input";const[WNe,GNe]=Li({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),O2=Qt(function(t,s){const a=xc("Input",t),{children:l,className:d,...g}=Ji(t),E=An("chakra-input__group",d),S={},b=EU(l),C=a.field;b.forEach(k=>{a&&(C&&k.type.id==="InputLeftElement"&&(S.paddingStart=C.height??C.h),C&&k.type.id==="InputRightElement"&&(S.paddingEnd=C.height??C.h),k.type.id==="InputRightAddon"&&(S.borderEndRadius=0),k.type.id==="InputLeftAddon"&&(S.borderStartRadius=0))});const O=b.map(k=>{var H,K;const W=XP({size:((H=k.props)==null?void 0:H.size)||t.size,variant:((K=k.props)==null?void 0:K.variant)||t.variant});return k.type.id!=="Input"?j.cloneElement(k,W):j.cloneElement(k,Object.assign(W,S,k.props))});return U.jsx(kt.div,{className:E,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...g,children:U.jsx(WNe,{value:a,children:O})})});O2.displayName="InputGroup";const zNe=kt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),fN=Qt(function(t,s){const{placement:a="left",...l}=t,d=GNe(),g=d.field,S={[a==="left"?"insetStart":"insetEnd"]:"0",width:(g==null?void 0:g.height)??(g==null?void 0:g.h),height:(g==null?void 0:g.height)??(g==null?void 0:g.h),fontSize:g==null?void 0:g.fontSize,...d.element};return U.jsx(zNe,{ref:s,__css:S,...l})});fN.id="InputElement";fN.displayName="InputElement";const RP=Qt(function(t,s){const{className:a,...l}=t,d=An("chakra-input__left-element",a);return U.jsx(fN,{ref:s,placement:"left",className:d,...l})});RP.id="InputLeftElement";RP.displayName="InputLeftElement";const VZ=Qt(function(t,s){const{className:a,...l}=t,d=An("chakra-input__right-element",a);return U.jsx(fN,{ref:s,placement:"right",className:d,...l})});VZ.id="InputRightElement";VZ.displayName="InputRightElement";const Th=Qt(function(t,s){const a=rd("Link",t),{className:l,isExternal:d,...g}=Ji(t);return U.jsx(kt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:An("chakra-link",l),...g,__css:a})});Th.displayName="Link";function HNe(r,t,s,a){if(t==null)return a;if(!a)return r.find(g=>s(g).toLowerCase().startsWith(t.toLowerCase()));const l=r.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=r.indexOf(l[0]),r[d])}return a}function KNe(r){const{key:t}=r;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function $Ne(r={}){const{timeout:t=300,preventDefault:s=()=>!0}=r,[a,l]=j.useState([]),d=j.useRef(void 0),g=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{g(),d.current=setTimeout(()=>{l([]),d.current=null},t)};j.useEffect(()=>g,[]);function S(b){return C=>{if(C.key==="Backspace"){const O=[...a];O.pop(),l(O);return}if(KNe(C)){const O=a.concat(C.key);s(C)&&(C.preventDefault(),C.stopPropagation()),l(O),b(O.join("")),E()}}}return S}var Nc="top",su="bottom",ou="right",kc="left",FV="auto",Zw=[Nc,su,ou,kc],gS="start",Cw="end",qNe="clippingParents",FZ="viewport",pb="popper",YNe="reference",wq=Zw.reduce(function(r,t){return r.concat([t+"-"+gS,t+"-"+Cw])},[]),jZ=[].concat(Zw,[FV]).reduce(function(r,t){return r.concat([t,t+"-"+gS,t+"-"+Cw])},[]),XNe="beforeRead",JNe="read",QNe="afterRead",ZNe="beforeMain",eke="main",tke="afterMain",nke="beforeWrite",rke="write",ike="afterWrite",ske=[XNe,JNe,QNe,ZNe,eke,tke,nke,rke,ike];function bh(r){return r?(r.nodeName||"").toLowerCase():null}function pl(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var t=r.ownerDocument;return t&&t.defaultView||window}return r}function H_(r){var t=pl(r).Element;return r instanceof t||r instanceof Element}function ru(r){var t=pl(r).HTMLElement;return r instanceof t||r instanceof HTMLElement}function jV(r){if(typeof ShadowRoot>"u")return!1;var t=pl(r).ShadowRoot;return r instanceof t||r instanceof ShadowRoot}function oke(r){var t=r.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!ru(d)||!bh(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(g){var E=l[g];E===!1?d.removeAttribute(g):d.setAttribute(g,E===!0?"":E)}))})}function ake(r){var t=r.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},g=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),E=g.reduce(function(S,b){return S[b]="",S},{});!ru(l)||!bh(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(S){l.removeAttribute(S)}))})}}const cke={name:"applyStyles",enabled:!0,phase:"write",fn:oke,effect:ake,requires:["computeStyles"]};function mh(r){return r.split("-")[0]}var V_=Math.max,CP=Math.min,_S=Math.round;function P2(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function BZ(){return!/^((?!chrome|android).)*safari/i.test(P2())}function ES(r,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=r.getBoundingClientRect(),l=1,d=1;t&&ru(r)&&(l=r.offsetWidth>0&&_S(a.width)/r.offsetWidth||1,d=r.offsetHeight>0&&_S(a.height)/r.offsetHeight||1);var g=H_(r)?pl(r):window,E=g.visualViewport,S=!BZ()&&s,b=(a.left+(S&&E?E.offsetLeft:0))/l,C=(a.top+(S&&E?E.offsetTop:0))/d,O=a.width/l,k=a.height/d;return{width:O,height:k,top:C,right:b+O,bottom:C+k,left:b,x:b,y:C}}function BV(r){var t=ES(r),s=r.offsetWidth,a=r.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:r.offsetLeft,y:r.offsetTop,width:s,height:a}}function WZ(r,t){var s=t.getRootNode&&t.getRootNode();if(r.contains(t))return!0;if(s&&jV(s)){var a=t;do{if(a&&r.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function zp(r){return pl(r).getComputedStyle(r)}function lke(r){return["table","td","th"].indexOf(bh(r))>=0}function Gm(r){return((H_(r)?r.ownerDocument:r.document)||window.document).documentElement}function mN(r){return bh(r)==="html"?r:r.assignedSlot||r.parentNode||(jV(r)?r.host:null)||Gm(r)}function Rq(r){return!ru(r)||zp(r).position==="fixed"?null:r.offsetParent}function uke(r){var t=/firefox/i.test(P2()),s=/Trident/i.test(P2());if(s&&ru(r)){var a=zp(r);if(a.position==="fixed")return null}var l=mN(r);for(jV(l)&&(l=l.host);ru(l)&&["html","body"].indexOf(bh(l))<0;){var d=zp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function eR(r){for(var t=pl(r),s=Rq(r);s&&lke(s)&&zp(s).position==="static";)s=Rq(s);return s&&(bh(s)==="html"||bh(s)==="body"&&zp(s).position==="static")?t:s||uke(r)||t}function WV(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function nw(r,t,s){return V_(r,CP(t,s))}function dke(r,t,s){var a=nw(r,t,s);return a>s?s:a}function GZ(){return{top:0,right:0,bottom:0,left:0}}function zZ(r){return Object.assign({},GZ(),r)}function HZ(r,t){return t.reduce(function(s,a){return s[a]=r,s},{})}var hke=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,zZ(typeof t!="number"?t:HZ(t,Zw))};function pke(r){var t,s=r.state,a=r.name,l=r.options,d=s.elements.arrow,g=s.modifiersData.popperOffsets,E=mh(s.placement),S=WV(E),b=[kc,ou].indexOf(E)>=0,C=b?"height":"width";if(!(!d||!g)){var O=hke(l.padding,s),k=BV(d),W=S==="y"?Nc:kc,H=S==="y"?su:ou,K=s.rects.reference[C]+s.rects.reference[S]-g[S]-s.rects.popper[C],G=g[S]-s.rects.reference[S],te=eR(d),J=te?S==="y"?te.clientHeight||0:te.clientWidth||0:0,re=K/2-G/2,fe=O[W],oe=J-k[C]-O[H],be=J/2-k[C]/2+re,Z=nw(fe,be,oe),ne=S;s.modifiersData[a]=(t={},t[ne]=Z,t.centerOffset=Z-be,t)}}function fke(r){var t=r.state,s=r.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||WZ(t.elements.popper,l)&&(t.elements.arrow=l))}const mke={name:"arrow",enabled:!0,phase:"main",fn:pke,effect:fke,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function vS(r){return r.split("-")[1]}var gke={top:"auto",right:"auto",bottom:"auto",left:"auto"};function _ke(r,t){var s=r.x,a=r.y,l=t.devicePixelRatio||1;return{x:_S(s*l)/l||0,y:_S(a*l)/l||0}}function Cq(r){var t,s=r.popper,a=r.popperRect,l=r.placement,d=r.variation,g=r.offsets,E=r.position,S=r.gpuAcceleration,b=r.adaptive,C=r.roundOffsets,O=r.isFixed,k=g.x,W=k===void 0?0:k,H=g.y,K=H===void 0?0:H,G=typeof C=="function"?C({x:W,y:K}):{x:W,y:K};W=G.x,K=G.y;var te=g.hasOwnProperty("x"),J=g.hasOwnProperty("y"),re=kc,fe=Nc,oe=window;if(b){var be=eR(s),Z="clientHeight",ne="clientWidth";if(be===pl(s)&&(be=Gm(s),zp(be).position!=="static"&&E==="absolute"&&(Z="scrollHeight",ne="scrollWidth")),be=be,l===Nc||(l===kc||l===ou)&&d===Cw){fe=su;var se=O&&be===oe&&oe.visualViewport?oe.visualViewport.height:be[Z];K-=se-a.height,K*=S?1:-1}if(l===kc||(l===Nc||l===su)&&d===Cw){re=ou;var ue=O&&be===oe&&oe.visualViewport?oe.visualViewport.width:be[ne];W-=ue-a.width,W*=S?1:-1}}var Ee=Object.assign({position:E},b&&gke),he=C===!0?_ke({x:W,y:K},pl(s)):{x:W,y:K};if(W=he.x,K=he.y,S){var le;return Object.assign({},Ee,(le={},le[fe]=J?"0":"",le[re]=te?"0":"",le.transform=(oe.devicePixelRatio||1)<=1?"translate("+W+"px, "+K+"px)":"translate3d("+W+"px, "+K+"px, 0)",le))}return Object.assign({},Ee,(t={},t[fe]=J?K+"px":"",t[re]=te?W+"px":"",t.transform="",t))}function Eke(r){var t=r.state,s=r.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,g=d===void 0?!0:d,E=s.roundOffsets,S=E===void 0?!0:E,b={placement:mh(t.placement),variation:vS(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Cq(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:g,roundOffsets:S})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Cq(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:S})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const vke={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Eke,data:{}};var mO={passive:!0};function yke(r){var t=r.state,s=r.instance,a=r.options,l=a.scroll,d=l===void 0?!0:l,g=a.resize,E=g===void 0?!0:g,S=pl(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(C){C.addEventListener("scroll",s.update,mO)}),E&&S.addEventListener("resize",s.update,mO),function(){d&&b.forEach(function(C){C.removeEventListener("scroll",s.update,mO)}),E&&S.removeEventListener("resize",s.update,mO)}}const Ske={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:yke,data:{}};var Tke={left:"right",right:"left",bottom:"top",top:"bottom"};function $O(r){return r.replace(/left|right|bottom|top/g,function(t){return Tke[t]})}var bke={start:"end",end:"start"};function Iq(r){return r.replace(/start|end/g,function(t){return bke[t]})}function GV(r){var t=pl(r),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function zV(r){return ES(Gm(r)).left+GV(r).scrollLeft}function wke(r,t){var s=pl(r),a=Gm(r),l=s.visualViewport,d=a.clientWidth,g=a.clientHeight,E=0,S=0;if(l){d=l.width,g=l.height;var b=BZ();(b||!b&&t==="fixed")&&(E=l.offsetLeft,S=l.offsetTop)}return{width:d,height:g,x:E+zV(r),y:S}}function Rke(r){var t,s=Gm(r),a=GV(r),l=(t=r.ownerDocument)==null?void 0:t.body,d=V_(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),g=V_(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+zV(r),S=-a.scrollTop;return zp(l||s).direction==="rtl"&&(E+=V_(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:g,x:E,y:S}}function HV(r){var t=zp(r),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function KZ(r){return["html","body","#document"].indexOf(bh(r))>=0?r.ownerDocument.body:ru(r)&&HV(r)?r:KZ(mN(r))}function rw(r,t){var s;t===void 0&&(t=[]);var a=KZ(r),l=a===((s=r.ownerDocument)==null?void 0:s.body),d=pl(a),g=l?[d].concat(d.visualViewport||[],HV(a)?a:[]):a,E=t.concat(g);return l?E:E.concat(rw(mN(g)))}function N2(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function Cke(r,t){var s=ES(r,!1,t==="fixed");return s.top=s.top+r.clientTop,s.left=s.left+r.clientLeft,s.bottom=s.top+r.clientHeight,s.right=s.left+r.clientWidth,s.width=r.clientWidth,s.height=r.clientHeight,s.x=s.left,s.y=s.top,s}function Aq(r,t,s){return t===FZ?N2(wke(r,s)):H_(t)?Cke(t,s):N2(Rke(Gm(r)))}function Ike(r){var t=rw(mN(r)),s=["absolute","fixed"].indexOf(zp(r).position)>=0,a=s&&ru(r)?eR(r):r;return H_(a)?t.filter(function(l){return H_(l)&&WZ(l,a)&&bh(l)!=="body"}):[]}function Ake(r,t,s,a){var l=t==="clippingParents"?Ike(r):[].concat(t),d=[].concat(l,[s]),g=d[0],E=d.reduce(function(S,b){var C=Aq(r,b,a);return S.top=V_(C.top,S.top),S.right=CP(C.right,S.right),S.bottom=CP(C.bottom,S.bottom),S.left=V_(C.left,S.left),S},Aq(r,g,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function $Z(r){var t=r.reference,s=r.element,a=r.placement,l=a?mh(a):null,d=a?vS(a):null,g=t.x+t.width/2-s.width/2,E=t.y+t.height/2-s.height/2,S;switch(l){case Nc:S={x:g,y:t.y-s.height};break;case su:S={x:g,y:t.y+t.height};break;case ou:S={x:t.x+t.width,y:E};break;case kc:S={x:t.x-s.width,y:E};break;default:S={x:t.x,y:t.y}}var b=l?WV(l):null;if(b!=null){var C=b==="y"?"height":"width";switch(d){case gS:S[b]=S[b]-(t[C]/2-s[C]/2);break;case Cw:S[b]=S[b]+(t[C]/2-s[C]/2);break}}return S}function Iw(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?r.placement:a,d=s.strategy,g=d===void 0?r.strategy:d,E=s.boundary,S=E===void 0?qNe:E,b=s.rootBoundary,C=b===void 0?FZ:b,O=s.elementContext,k=O===void 0?pb:O,W=s.altBoundary,H=W===void 0?!1:W,K=s.padding,G=K===void 0?0:K,te=zZ(typeof G!="number"?G:HZ(G,Zw)),J=k===pb?YNe:pb,re=r.rects.popper,fe=r.elements[H?J:k],oe=Ake(H_(fe)?fe:fe.contextElement||Gm(r.elements.popper),S,C,g),be=ES(r.elements.reference),Z=$Z({reference:be,element:re,placement:l}),ne=N2(Object.assign({},re,Z)),se=k===pb?ne:be,ue={top:oe.top-se.top+te.top,bottom:se.bottom-oe.bottom+te.bottom,left:oe.left-se.left+te.left,right:se.right-oe.right+te.right},Ee=r.modifiersData.offset;if(k===pb&&Ee){var he=Ee[l];Object.keys(ue).forEach(function(le){var Me=[ou,su].indexOf(le)>=0?1:-1,pt=[Nc,su].indexOf(le)>=0?"y":"x";ue[le]+=he[pt]*Me})}return ue}function Oke(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,g=s.padding,E=s.flipVariations,S=s.allowedAutoPlacements,b=S===void 0?jZ:S,C=vS(a),O=C?E?wq:wq.filter(function(H){return vS(H)===C}):Zw,k=O.filter(function(H){return b.indexOf(H)>=0});k.length===0&&(k=O);var W=k.reduce(function(H,K){return H[K]=Iw(r,{placement:K,boundary:l,rootBoundary:d,padding:g})[mh(K)],H},{});return Object.keys(W).sort(function(H,K){return W[H]-W[K]})}function Pke(r){if(mh(r)===FV)return[];var t=$O(r);return[Iq(r),t,Iq(t)]}function Nke(r){var t=r.state,s=r.options,a=r.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,g=s.altAxis,E=g===void 0?!0:g,S=s.fallbackPlacements,b=s.padding,C=s.boundary,O=s.rootBoundary,k=s.altBoundary,W=s.flipVariations,H=W===void 0?!0:W,K=s.allowedAutoPlacements,G=t.options.placement,te=mh(G),J=te===G,re=S||(J||!H?[$O(G)]:Pke(G)),fe=[G].concat(re).reduce(function(Fe,ct){return Fe.concat(mh(ct)===FV?Oke(t,{placement:ct,boundary:C,rootBoundary:O,padding:b,flipVariations:H,allowedAutoPlacements:K}):ct)},[]),oe=t.rects.reference,be=t.rects.popper,Z=new Map,ne=!0,se=fe[0],ue=0;ue<fe.length;ue++){var Ee=fe[ue],he=mh(Ee),le=vS(Ee)===gS,Me=[Nc,su].indexOf(he)>=0,pt=Me?"width":"height",et=Iw(t,{placement:Ee,boundary:C,rootBoundary:O,altBoundary:k,padding:b}),Oe=Me?le?ou:kc:le?su:Nc;oe[pt]>be[pt]&&(Oe=$O(Oe));var Ue=$O(Oe),xe=[];if(d&&xe.push(et[he]<=0),E&&xe.push(et[Oe]<=0,et[Ue]<=0),xe.every(function(Fe){return Fe})){se=Ee,ne=!1;break}Z.set(Ee,xe)}if(ne)for(var it=H?3:1,Ae=function(ct){var _t=fe.find(function(Pt){var Ht=Z.get(Pt);if(Ht)return Ht.slice(0,ct).every(function(xt){return xt})});if(_t)return se=_t,"break"},$e=it;$e>0;$e--){var Ze=Ae($e);if(Ze==="break")break}t.placement!==se&&(t.modifiersData[a]._skip=!0,t.placement=se,t.reset=!0)}}const kke={name:"flip",enabled:!0,phase:"main",fn:Nke,requiresIfExists:["offset"],data:{_skip:!1}};function Oq(r,t,s){return s===void 0&&(s={x:0,y:0}),{top:r.top-t.height-s.y,right:r.right-t.width+s.x,bottom:r.bottom-t.height+s.y,left:r.left-t.width-s.x}}function Pq(r){return[Nc,ou,su,kc].some(function(t){return r[t]>=0})}function Dke(r){var t=r.state,s=r.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,g=Iw(t,{elementContext:"reference"}),E=Iw(t,{altBoundary:!0}),S=Oq(g,a),b=Oq(E,l,d),C=Pq(S),O=Pq(b);t.modifiersData[s]={referenceClippingOffsets:S,popperEscapeOffsets:b,isReferenceHidden:C,hasPopperEscaped:O},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":O})}const Lke={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Dke};function xke(r,t,s){var a=mh(r),l=[kc,Nc].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:r})):s,g=d[0],E=d[1];return g=g||0,E=(E||0)*l,[kc,ou].indexOf(a)>=0?{x:E,y:g}:{x:g,y:E}}function Mke(r){var t=r.state,s=r.options,a=r.name,l=s.offset,d=l===void 0?[0,0]:l,g=jZ.reduce(function(C,O){return C[O]=xke(O,t.rects,d),C},{}),E=g[t.placement],S=E.x,b=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=S,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=g}const Uke={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Mke};function Vke(r){var t=r.state,s=r.name;t.modifiersData[s]=$Z({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const Fke={name:"popperOffsets",enabled:!0,phase:"read",fn:Vke,data:{}};function jke(r){return r==="x"?"y":"x"}function Bke(r){var t=r.state,s=r.options,a=r.name,l=s.mainAxis,d=l===void 0?!0:l,g=s.altAxis,E=g===void 0?!1:g,S=s.boundary,b=s.rootBoundary,C=s.altBoundary,O=s.padding,k=s.tether,W=k===void 0?!0:k,H=s.tetherOffset,K=H===void 0?0:H,G=Iw(t,{boundary:S,rootBoundary:b,padding:O,altBoundary:C}),te=mh(t.placement),J=vS(t.placement),re=!J,fe=WV(te),oe=jke(fe),be=t.modifiersData.popperOffsets,Z=t.rects.reference,ne=t.rects.popper,se=typeof K=="function"?K(Object.assign({},t.rects,{placement:t.placement})):K,ue=typeof se=="number"?{mainAxis:se,altAxis:se}:Object.assign({mainAxis:0,altAxis:0},se),Ee=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,he={x:0,y:0};if(be){if(d){var le,Me=fe==="y"?Nc:kc,pt=fe==="y"?su:ou,et=fe==="y"?"height":"width",Oe=be[fe],Ue=Oe+G[Me],xe=Oe-G[pt],it=W?-ne[et]/2:0,Ae=J===gS?Z[et]:ne[et],$e=J===gS?-ne[et]:-Z[et],Ze=t.elements.arrow,Fe=W&&Ze?BV(Ze):{width:0,height:0},ct=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:GZ(),_t=ct[Me],Pt=ct[pt],Ht=nw(0,Z[et],Fe[et]),xt=re?Z[et]/2-it-Ht-_t-ue.mainAxis:Ae-Ht-_t-ue.mainAxis,fn=re?-Z[et]/2+it+Ht+Pt+ue.mainAxis:$e+Ht+Pt+ue.mainAxis,Rn=t.elements.arrow&&eR(t.elements.arrow),ln=Rn?fe==="y"?Rn.clientTop||0:Rn.clientLeft||0:0,Hn=(le=Ee==null?void 0:Ee[fe])!=null?le:0,Ar=Oe+xt-Hn-ln,Xt=Oe+fn-Hn,Qn=nw(W?CP(Ue,Ar):Ue,Oe,W?V_(xe,Xt):xe);be[fe]=Qn,he[fe]=Qn-Oe}if(E){var Wt,ve=fe==="x"?Nc:kc,Ne=fe==="x"?su:ou,We=be[oe],ut=oe==="y"?"height":"width",ft=We+G[ve],mt=We-G[Ne],Ut=[Nc,kc].indexOf(te)!==-1,pn=(Wt=Ee==null?void 0:Ee[oe])!=null?Wt:0,Nn=Ut?ft:We-Z[ut]-ne[ut]-pn+ue.altAxis,tn=Ut?We+Z[ut]+ne[ut]-pn-ue.altAxis:mt,ur=W&&Ut?dke(Nn,We,tn):nw(W?Nn:ft,We,W?tn:mt);be[oe]=ur,he[oe]=ur-We}t.modifiersData[a]=he}}const Wke={name:"preventOverflow",enabled:!0,phase:"main",fn:Bke,requiresIfExists:["offset"]};function Gke(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function zke(r){return r===pl(r)||!ru(r)?GV(r):Gke(r)}function Hke(r){var t=r.getBoundingClientRect(),s=_S(t.width)/r.offsetWidth||1,a=_S(t.height)/r.offsetHeight||1;return s!==1||a!==1}function Kke(r,t,s){s===void 0&&(s=!1);var a=ru(t),l=ru(t)&&Hke(t),d=Gm(t),g=ES(r,l,s),E={scrollLeft:0,scrollTop:0},S={x:0,y:0};return(a||!a&&!s)&&((bh(t)!=="body"||HV(d))&&(E=zke(t)),ru(t)?(S=ES(t,!0),S.x+=t.clientLeft,S.y+=t.clientTop):d&&(S.x=zV(d))),{x:g.left+E.scrollLeft-S.x,y:g.top+E.scrollTop-S.y,width:g.width,height:g.height}}function $ke(r){var t=new Map,s=new Set,a=[];r.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var g=[].concat(d.requires||[],d.requiresIfExists||[]);g.forEach(function(E){if(!s.has(E)){var S=t.get(E);S&&l(S)}}),a.push(d)}return r.forEach(function(d){s.has(d.name)||l(d)}),a}function qke(r){var t=$ke(r);return ske.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function Yke(r){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(r())})})),t}}function Xke(r){var t=r.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var Nq={placement:"bottom",modifiers:[],strategy:"absolute"};function kq(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function Jke(r){r===void 0&&(r={});var t=r,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?Nq:l;return function(E,S,b){b===void 0&&(b=d);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},Nq,d),modifiersData:{},elements:{reference:E,popper:S},attributes:{},styles:{}},O=[],k=!1,W={state:C,setOptions:function(te){var J=typeof te=="function"?te(C.options):te;K(),C.options=Object.assign({},d,C.options,J),C.scrollParents={reference:H_(E)?rw(E):E.contextElement?rw(E.contextElement):[],popper:rw(S)};var re=qke(Xke([].concat(a,C.options.modifiers)));return C.orderedModifiers=re.filter(function(fe){return fe.enabled}),H(),W.update()},forceUpdate:function(){if(!k){var te=C.elements,J=te.reference,re=te.popper;if(kq(J,re)){C.rects={reference:Kke(J,eR(re),C.options.strategy==="fixed"),popper:BV(re)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(ue){return C.modifiersData[ue.name]=Object.assign({},ue.data)});for(var fe=0;fe<C.orderedModifiers.length;fe++){if(C.reset===!0){C.reset=!1,fe=-1;continue}var oe=C.orderedModifiers[fe],be=oe.fn,Z=oe.options,ne=Z===void 0?{}:Z,se=oe.name;typeof be=="function"&&(C=be({state:C,options:ne,name:se,instance:W})||C)}}}},update:Yke(function(){return new Promise(function(G){W.forceUpdate(),G(C)})}),destroy:function(){K(),k=!0}};if(!kq(E,S))return W;W.setOptions(b).then(function(G){!k&&b.onFirstUpdate&&b.onFirstUpdate(G)});function H(){C.orderedModifiers.forEach(function(G){var te=G.name,J=G.options,re=J===void 0?{}:J,fe=G.effect;if(typeof fe=="function"){var oe=fe({state:C,name:te,instance:W,options:re}),be=function(){};O.push(oe||be)}})}function K(){O.forEach(function(G){return G()}),O=[]}return W}}var Qke=[Ske,Fke,vke,cke,Uke,kke,Wke,mke,Lke],Zke=Jke({defaultModifiers:Qke});const by=(r,t)=>({var:r,varRef:t?`var(${r}, ${t})`:`var(${r})`}),ks={arrowShadowColor:by("--popper-arrow-shadow-color"),arrowSize:by("--popper-arrow-size","8px"),arrowSizeHalf:by("--popper-arrow-size-half"),arrowBg:by("--popper-arrow-bg"),transformOrigin:by("--popper-transform-origin"),arrowOffset:by("--popper-arrow-offset")};function eDe(r){if(r.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const tDe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},nDe=r=>tDe[r],Dq={scroll:!0,resize:!0};function rDe(r){let t;return typeof r=="object"?t={enabled:!0,options:{...Dq,...r}}:t={enabled:r,options:Dq},t}const iDe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:r})=>{r.styles.popper.width=`${r.rects.reference.width}px`},effect:({state:r})=>()=>{const t=r.elements.reference;r.elements.popper.style.width=`${t.offsetWidth}px`}},sDe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:r})=>{Lq(r)},effect:({state:r})=>()=>{Lq(r)}},Lq=r=>{r.elements.popper.style.setProperty(ks.transformOrigin.var,nDe(r.placement))},oDe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:r})=>{aDe(r)}},aDe=r=>{var s;if(!r.placement)return;const t=cDe(r.placement);if((s=r.elements)!=null&&s.arrow&&t){Object.assign(r.elements.arrow.style,{[t.property]:t.value,width:ks.arrowSize.varRef,height:ks.arrowSize.varRef,zIndex:-1});const a={[ks.arrowSizeHalf.var]:`calc(${ks.arrowSize.varRef} / 2 - 1px)`,[ks.arrowOffset.var]:`calc(${ks.arrowSizeHalf.varRef} * -1)`};for(const l in a)r.elements.arrow.style.setProperty(l,a[l])}},cDe=r=>{if(r.startsWith("top"))return{property:"bottom",value:ks.arrowOffset.varRef};if(r.startsWith("bottom"))return{property:"top",value:ks.arrowOffset.varRef};if(r.startsWith("left"))return{property:"right",value:ks.arrowOffset.varRef};if(r.startsWith("right"))return{property:"left",value:ks.arrowOffset.varRef}},lDe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:r})=>{xq(r)},effect:({state:r})=>()=>{xq(r)}},xq=r=>{if(!r.elements.arrow)return;const t=r.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=eDe(r.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:ks.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},uDe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},dDe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function hDe(r,t="ltr"){var a;const s=((a=uDe[r])==null?void 0:a[t])||r;return t==="ltr"?s:dDe[r]??s}function KV(r={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:g=!0,offset:E,gutter:S=8,flip:b=!0,boundary:C="clippingParents",preventOverflow:O=!0,matchWidth:k,direction:W="ltr"}=r,H=j.useRef(null),K=j.useRef(null),G=j.useRef(null),te=hDe(a,W),J=j.useRef(()=>{}),re=j.useCallback(()=>{var ue;!t||!H.current||!K.current||((ue=J.current)==null||ue.call(J),G.current=Zke(H.current,K.current,{placement:te,modifiers:[lDe,oDe,sDe,{...iDe,enabled:!!k},{name:"eventListeners",...rDe(g)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,S]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!O,options:{boundary:C}},...s??[]],strategy:l}),G.current.forceUpdate(),J.current=G.current.destroy)},[te,t,s,k,g,d,E,S,b,O,C,l]);j.useEffect(()=>()=>{var ue;!H.current&&!K.current&&((ue=G.current)==null||ue.destroy(),G.current=null)},[]);const fe=j.useCallback(ue=>{H.current=ue,re()},[re]),oe=j.useCallback((ue={},Ee=null)=>({...ue,ref:qi(fe,Ee)}),[fe]),be=j.useCallback(ue=>{K.current=ue,re()},[re]),Z=j.useCallback((ue={},Ee=null)=>({...ue,ref:qi(be,Ee),style:{...ue.style,position:l,minWidth:k?void 0:"max-content",inset:"0 auto auto 0"}}),[l,be,k]),ne=j.useCallback((ue={},Ee=null)=>{const{size:he,shadowColor:le,bg:Me,style:pt,...et}=ue;return{...et,ref:Ee,"data-popper-arrow":"",style:pDe(ue)}},[]),se=j.useCallback((ue={},Ee=null)=>({...ue,ref:Ee,"data-popper-arrow-inner":""}),[]);return{update(){var ue;(ue=G.current)==null||ue.update()},forceUpdate(){var ue;(ue=G.current)==null||ue.forceUpdate()},transformOrigin:ks.transformOrigin.varRef,referenceRef:fe,popperRef:be,getPopperProps:Z,getArrowProps:ne,getArrowInnerProps:se,getReferenceProps:oe}}function pDe(r){const{size:t,shadowColor:s,bg:a,style:l}=r,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function fDe(){const r=j.useRef(new Map),t=r.current,s=j.useCallback((l,d,g,E)=>{r.current.set(g,{type:d,el:l,options:E}),l.addEventListener(d,g,E)},[]),a=j.useCallback((l,d,g,E)=>{l.removeEventListener(d,g,E),r.current.delete(g)},[]);return j.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function _M(r){var l,d;const t=((d=(l=r.composedPath)==null?void 0:l.call(r))==null?void 0:d[0])??r.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function mDe(r={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:g,onMouseUp:E,onClick:S,onKeyDown:b,onKeyUp:C,tabIndex:O,onMouseOver:k,onMouseLeave:W,...H}=r,[K,G]=j.useState(!0),[te,J]=j.useState(!1),re=fDe(),fe=Oe=>{Oe&&Oe.tagName!=="BUTTON"&&G(!1)},oe=K?O:O||0,be=s&&!a,Z=j.useCallback(Oe=>{if(s){Oe.stopPropagation(),Oe.preventDefault();return}Oe.currentTarget.focus(),S==null||S(Oe)},[s,S]),ne=j.useCallback(Oe=>{te&&_M(Oe)&&(Oe.preventDefault(),Oe.stopPropagation(),J(!1),re.remove(document,"keyup",ne,!1))},[te,re]),se=j.useCallback(Oe=>{if(b==null||b(Oe),s||Oe.defaultPrevented||Oe.metaKey||!_M(Oe.nativeEvent)||K)return;const Ue=l&&Oe.key==="Enter";d&&Oe.key===" "&&(Oe.preventDefault(),J(!0)),Ue&&(Oe.preventDefault(),Oe.currentTarget.click()),re.add(document,"keyup",ne,!1)},[s,K,b,l,d,re,ne]),ue=j.useCallback(Oe=>{if(C==null||C(Oe),s||Oe.defaultPrevented||Oe.metaKey||!_M(Oe.nativeEvent)||K)return;d&&Oe.key===" "&&(Oe.preventDefault(),J(!1),Oe.currentTarget.click())},[d,K,s,C]),Ee=j.useCallback(Oe=>{Oe.button===0&&(J(!1),re.remove(document,"mouseup",Ee,!1))},[re]),he=j.useCallback(Oe=>{if(Oe.button!==0)return;if(s){Oe.stopPropagation(),Oe.preventDefault();return}K||J(!0),Oe.currentTarget.focus({preventScroll:!0}),re.add(document,"mouseup",Ee,!1),g==null||g(Oe)},[s,K,g,re,Ee]),le=j.useCallback(Oe=>{Oe.button===0&&(K||J(!1),E==null||E(Oe))},[E,K]),Me=j.useCallback(Oe=>{if(s){Oe.preventDefault();return}k==null||k(Oe)},[s,k]),pt=j.useCallback(Oe=>{te&&(Oe.preventDefault(),J(!1)),W==null||W(Oe)},[te,W]),et=qi(t,fe);return K?{...H,ref:et,type:"button","aria-disabled":be?void 0:s,disabled:be,onClick:Z,onMouseDown:g,onMouseUp:E,onKeyUp:C,onKeyDown:b,onMouseOver:k,onMouseLeave:W}:{...H,ref:et,role:"button","data-active":Gn(te),"aria-disabled":s?"true":void 0,tabIndex:be?void 0:oe,onClick:Z,onMouseDown:he,onMouseUp:le,onKeyUp:ue,onKeyDown:se,onMouseOver:Me,onMouseLeave:pt}}const[gDe,_De,EDe,d3e]=$Q(),[vDe,gN]=Li({strict:!1,name:"MenuContext"});function yDe(r){return(r==null?void 0:r.ownerDocument)??document}function SDe(r={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:g,isOpen:E,defaultIsOpen:S,onClose:b,onOpen:C,placement:O="bottom-start",lazyBehavior:k="unmount",direction:W,computePositionOnMount:H=!1,...K}=r,G=j.useRef(null),te=j.useRef(null),J=j.useRef(!0),re=EDe(),fe=j.useCallback(()=>{requestAnimationFrame(()=>{var Ze;(Ze=G.current)==null||Ze.focus({preventScroll:!1})})},[]),oe=j.useCallback(()=>{const Ze=setTimeout(()=>{var Fe,ct;if(l)(Fe=l.current)==null||Fe.focus();else if(!re.count())(ct=G.current)==null||ct.focus({preventScroll:!1});else{const _t=re.firstEnabled();_t&&Me(_t.index)}});xe.current.add(Ze)},[re,l]),be=j.useCallback(()=>{const Ze=setTimeout(()=>{var Fe;if(!re.count())(Fe=G.current)==null||Fe.focus({preventScroll:!1});else{const ct=re.lastEnabled();ct&&Me(ct.index)}});xe.current.add(Ze)},[re]),Z=j.useCallback(()=>{C==null||C(),d?oe():fe()},[d,oe,fe,C]),{isOpen:ne,onOpen:se,onClose:ue,onToggle:Ee}=jw({isOpen:E,defaultIsOpen:S,onClose:b,onOpen:Z});TX({enabled:ne&&a,ref:G,handler:Ze=>{var ct,_t,Pt;const Fe=((_t=(ct=Ze.composedPath)==null?void 0:ct.call(Ze))==null?void 0:_t[0])??Ze.target;(Pt=te.current)!=null&&Pt.contains(Fe)||ue()}});const he=KV({...K,enabled:ne||H,placement:O,direction:W}),[le,Me]=j.useState(-1);vX(G,{focusRef:te,visible:ne,shouldFocus:!0});const pt=_X({isOpen:ne,ref:G}),[et,Oe]=Pge(t,"menu-button","menu-list"),Ue=j.useCallback(()=>{se(),fe()},[se,fe]),xe=j.useRef(new Set([]));j.useEffect(()=>{const Ze=xe.current;return()=>{Ze.forEach(Fe=>clearTimeout(Fe)),Ze.clear()}},[]),Pm(()=>{var Ze;ne||(Me(-1),(Ze=G.current)==null||Ze.scrollTo(0,0))},[ne]),Pm(()=>{ne&&le===-1&&fe()},[le,ne]),j.useEffect(()=>{var Fe;if(!ne)return;const Ze=re.item(le);(Fe=Ze==null?void 0:Ze.node)==null||Fe.focus({preventScroll:!J.current})},[re,le,ne]);const it=j.useCallback(()=>{se(),oe()},[oe,se]),Ae=j.useCallback(()=>{J.current=!0,se(),be()},[se,be]),$e=j.useCallback(()=>{var Pt,Ht;const Ze=yDe(G.current),Fe=(Pt=G.current)==null?void 0:Pt.contains(Ze.activeElement);if(!(ne&&!Fe))return;const _t=(Ht=re.item(le))==null?void 0:Ht.node;_t==null||_t.focus({preventScroll:!J.current})},[ne,le,re]);return{openAndFocusMenu:Ue,openAndFocusFirstItem:it,openAndFocusLastItem:Ae,onTransitionEnd:$e,unstable__animationState:pt,descendants:re,popper:he,buttonId:et,menuId:Oe,forceUpdate:he.forceUpdate,orientation:"vertical",isOpen:ne,onToggle:Ee,onOpen:se,onClose:ue,menuRef:G,buttonRef:te,focusedIndex:le,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:g,lazyBehavior:k,initialFocusRef:l,scrollIntoViewRef:J}}function TDe(r={},t=null){const s=gN(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:g,scrollIntoViewRef:E}=s,S=j.useCallback(b=>{const C=b.key,k={Enter:d,ArrowDown:d,ArrowUp:g}[C];k&&(E.current=!0,b.preventDefault(),b.stopPropagation(),k(b))},[d,g,E]);return{...r,ref:qi(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":Gn(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:qn(r.onClick,a),onKeyDown:qn(r.onKeyDown,S)}}function Mq(r){var t;return RDe(r)&&!!((t=r==null?void 0:r.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function bDe(r={},t=null){const s=gN();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:g,onClose:E,menuId:S,isLazy:b,lazyBehavior:C,scrollIntoViewRef:O,unstable__animationState:k}=s,W=_De(),H=$Ne({preventDefault:J=>J.key!==" "&&Mq(J.target)}),K=j.useCallback(J=>{if(!J.currentTarget.contains(J.target))return;const re=J.key,oe={Tab:Z=>Z.preventDefault(),Escape:Z=>{Z.stopPropagation(),E()},ArrowDown:()=>{O.current=!0;const Z=W.nextEnabled(a)??W.firstEnabled();Z&&l(Z.index)},ArrowUp:()=>{O.current=!0;const Z=W.prevEnabled(a)??W.firstEnabled();Z&&l(Z.index)}}[re];if(oe){J.preventDefault(),oe(J);return}const be=H(Z=>{const ne=HNe(W.values(),Z,se=>{var ue;return((ue=se==null?void 0:se.node)==null?void 0:ue.textContent)??""},W.item(a));if(ne){const se=W.indexOf(ne.node);l(se)}});Mq(J.target)&&be(J)},[W,a,H,E,l,O]),G=j.useRef(!1);g&&(G.current=!0);const te=vU({wasSelected:G.current,enabled:b,mode:C,isSelected:k.present});return{...r,ref:qi(d,t),children:te?r.children:null,tabIndex:-1,role:"menu",id:S,style:{...r.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:qn(r.onKeyDown,K)}}function wDe(r={}){const{popper:t,isOpen:s}=gN();return t.getPopperProps({...r,style:{visibility:s?"visible":"hidden",...r.style}})}function RDe(r){if(!CDe(r))return!1;const t=r.ownerDocument.defaultView??window;return r instanceof t.HTMLElement}function CDe(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}const[IDe,qZ]=Li({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),YZ=r=>{const{children:t}=r,s=xc("Menu",r),a=Ji(r),{direction:l}=LS(),{descendants:d,...g}=SDe({...a,direction:l}),E=j.useMemo(()=>g,[g]),{isOpen:S,onClose:b,forceUpdate:C}=E;return U.jsx(gDe,{value:d,children:U.jsx(vDe,{value:E,children:U.jsx(IDe,{value:s,children:Oc(t,{isOpen:S,onClose:b,forceUpdate:C})})})})};YZ.displayName="Menu";const ADe=Qt((r,t)=>{const s=qZ();return U.jsx(kt.button,{ref:t,...r,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),XZ=Qt((r,t)=>{const{children:s,as:a,...l}=r,d=TDe(l,t),g=a||ADe;return U.jsx(g,{...d,className:An("chakra-menu__menu-button",r.className),children:U.jsx(kt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:r.children})})});XZ.displayName="MenuButton";const ODe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},PDe=kt(Xp.div),JZ=Qt(function(t,s){var k;const{rootProps:a,motionProps:l,...d}=t,{isOpen:g,onTransitionEnd:E,unstable__animationState:S}=gN(),b=bDe(d,s),C=wDe(a),O=qZ();return U.jsx(kt.div,{...C,__css:{zIndex:t.zIndex??((k=O.list)==null?void 0:k.zIndex)},children:U.jsx(PDe,{variants:ODe,initial:!1,animate:g?"enter":"exit",__css:{outline:0,...O.list},...l,...b,className:An("chakra-menu__menu-list",b.className),onUpdate:E,onAnimationComplete:dX(S.onComplete,b.onAnimationComplete)})})});JZ.displayName="MenuList";var NDe=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},wy=new WeakMap,gO=new WeakMap,_O={},EM=0,QZ=function(r){return r&&(r.host||QZ(r.parentNode))},kDe=function(r,t){return t.map(function(s){if(r.contains(s))return s;var a=QZ(s);return a&&r.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",r,". Doing nothing"),null)}).filter(function(s){return!!s})},DDe=function(r,t,s,a){var l=kDe(t,Array.isArray(r)?r:[r]);_O[s]||(_O[s]=new WeakMap);var d=_O[s],g=[],E=new Set,S=new Set(l),b=function(O){!O||E.has(O)||(E.add(O),b(O.parentNode))};l.forEach(b);var C=function(O){!O||S.has(O)||Array.prototype.forEach.call(O.children,function(k){if(E.has(k))C(k);else try{var W=k.getAttribute(a),H=W!==null&&W!=="false",K=(wy.get(k)||0)+1,G=(d.get(k)||0)+1;wy.set(k,K),d.set(k,G),g.push(k),K===1&&H&&gO.set(k,!0),G===1&&k.setAttribute(s,"true"),H||k.setAttribute(a,"true")}catch(te){console.error("aria-hidden: cannot operate on ",k,te)}})};return C(t),E.clear(),EM++,function(){g.forEach(function(O){var k=wy.get(O)-1,W=d.get(O)-1;wy.set(O,k),d.set(O,W),k||(gO.has(O)||O.removeAttribute(a),gO.delete(O)),W||O.removeAttribute(s)}),EM--,EM||(wy=new WeakMap,wy=new WeakMap,gO=new WeakMap,_O={})}},LDe=function(r,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(r)?r:[r]),l=NDe(r);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),DDe(a,l,s,"aria-hidden")):function(){return null}},xDe=Object.defineProperty,MDe=(r,t,s)=>t in r?xDe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,UDe=(r,t,s)=>(MDe(r,t+"",s),s);class VDe{constructor(){UDe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const k2=new VDe;function ZZ(r,t){const[s,a]=j.useState(0);return j.useEffect(()=>{const l=r.current;if(l){if(t){const d=k2.add(l);a(d)}return()=>{k2.remove(l),a(0)}}},[t,r]),s}function FDe(r){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:g=!0,onOverlayClick:E,onEsc:S}=r,b=j.useRef(null),C=j.useRef(null),[O,k,W]=BDe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");jDe(b,t&&g);const H=ZZ(b,t),K=j.useRef(null),G=j.useCallback(se=>{K.current=se.target},[]),te=j.useCallback(se=>{se.key==="Escape"&&(se.stopPropagation(),d&&(s==null||s()),S==null||S())},[d,s,S]),[J,re]=j.useState(!1),[fe,oe]=j.useState(!1),be=j.useCallback((se={},ue=null)=>({role:"dialog",...se,ref:qi(ue,b),id:O,tabIndex:-1,"aria-modal":!0,"aria-labelledby":J?k:void 0,"aria-describedby":fe?W:void 0,onClick:qn(se.onClick,Ee=>Ee.stopPropagation())}),[W,fe,O,k,J]),Z=j.useCallback(se=>{se.stopPropagation(),K.current===se.target&&k2.isTopModal(b.current)&&(l&&(s==null||s()),E==null||E())},[s,l,E]),ne=j.useCallback((se={},ue=null)=>({...se,ref:qi(ue,C),onClick:qn(se.onClick,Z),onKeyDown:qn(se.onKeyDown,te),onMouseDown:qn(se.onMouseDown,G)}),[te,G,Z]);return{isOpen:t,onClose:s,headerId:k,bodyId:W,setBodyMounted:oe,setHeaderMounted:re,dialogRef:b,overlayRef:C,getDialogProps:be,getDialogContainerProps:ne,index:H}}function jDe(r,t){const s=r.current;j.useEffect(()=>{if(!(!r.current||!t))return LDe(r.current)},[t,r,s])}function BDe(r,...t){const s=j.useId(),a=r||s;return j.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[WDe,US]=Li({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[GDe,K_]=Li({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Jp=r=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...r,lockFocusAcrossFrames:r.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:g,finalFocusRef:E,returnFocusOnClose:S,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:O,motionPreset:k,lockFocusAcrossFrames:W,animatePresenceProps:H,onCloseComplete:K}=t,G=xc("Modal",t),J={...FDe(t),autoFocus:l,trapFocus:d,initialFocusRef:g,finalFocusRef:E,returnFocusOnClose:S,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:O,motionPreset:k,lockFocusAcrossFrames:W};return U.jsx(GDe,{value:J,children:U.jsx(WDe,{value:G,children:U.jsx(NS,{...H,onExitComplete:K,children:J.isOpen&&U.jsx(id,{...s,children:a})})})})};Jp.displayName="Modal";var qO="right-scroll-bar-position",YO="width-before-scroll-bar",zDe="with-scroll-bars-hidden",HDe="--removed-body-scroll-bar-size",eee=aZ(),vM=function(){},_N=j.forwardRef(function(r,t){var s=j.useRef(null),a=j.useState({onScrollCapture:vM,onWheelCapture:vM,onTouchMoveCapture:vM}),l=a[0],d=a[1],g=r.forwardProps,E=r.children,S=r.className,b=r.removeScrollBar,C=r.enabled,O=r.shards,k=r.sideCar,W=r.noIsolation,H=r.inert,K=r.allowPinchZoom,G=r.as,te=G===void 0?"div":G,J=r.gapMode,re=Jw(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),fe=k,oe=iZ([s,t]),be=ah(ah({},re),l);return j.createElement(j.Fragment,null,C&&j.createElement(fe,{sideCar:eee,removeScrollBar:b,shards:O,noIsolation:W,inert:H,setCallbacks:d,allowPinchZoom:!!K,lockRef:s,gapMode:J}),g?j.cloneElement(j.Children.only(E),ah(ah({},be),{ref:oe})):j.createElement(te,ah({},be,{className:S,ref:oe}),E))});_N.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};_N.classNames={fullWidth:YO,zeroRight:qO};var KDe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function $De(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=KDe();return t&&r.setAttribute("nonce",t),r}function qDe(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function YDe(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var XDe=function(){var r=0,t=null;return{add:function(s){r==0&&(t=$De())&&(qDe(t,s),YDe(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},JDe=function(){var r=XDe();return function(t,s){j.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&s])}},tee=function(){var r=JDe(),t=function(s){var a=s.styles,l=s.dynamic;return r(a,l),null};return t},QDe={left:0,top:0,right:0,gap:0},yM=function(r){return parseInt(r||"",10)||0},ZDe=function(r){var t=window.getComputedStyle(document.body),s=t[r==="padding"?"paddingLeft":"marginLeft"],a=t[r==="padding"?"paddingTop":"marginTop"],l=t[r==="padding"?"paddingRight":"marginRight"];return[yM(s),yM(a),yM(l)]},e1e=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return QDe;var t=ZDe(r),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},t1e=tee(),rS="data-scroll-locked",n1e=function(r,t,s,a){var l=r.left,d=r.top,g=r.right,E=r.gap;return s===void 0&&(s="margin"),`
  .`.concat(zDe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(rS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(g,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(qO,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(YO,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(qO," .").concat(qO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(YO," .").concat(YO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(rS,`] {
    `).concat(HDe,": ").concat(E,`px;
  }
`)},Uq=function(){var r=parseInt(document.body.getAttribute(rS)||"0",10);return isFinite(r)?r:0},r1e=function(){j.useEffect(function(){return document.body.setAttribute(rS,(Uq()+1).toString()),function(){var r=Uq()-1;r<=0?document.body.removeAttribute(rS):document.body.setAttribute(rS,r.toString())}},[])},i1e=function(r){var t=r.noRelative,s=r.noImportant,a=r.gapMode,l=a===void 0?"margin":a;r1e();var d=j.useMemo(function(){return e1e(l)},[l]);return j.createElement(t1e,{styles:n1e(d,!t,l,s?"":"!important")})},D2=!1;if(typeof window<"u")try{var EO=Object.defineProperty({},"passive",{get:function(){return D2=!0,!0}});window.addEventListener("test",EO,EO),window.removeEventListener("test",EO,EO)}catch{D2=!1}var Ry=D2?{passive:!1}:!1,s1e=function(r){return r.tagName==="TEXTAREA"},nee=function(r,t){if(!(r instanceof Element))return!1;var s=window.getComputedStyle(r);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!s1e(r)&&s[t]==="visible")},o1e=function(r){return nee(r,"overflowY")},a1e=function(r){return nee(r,"overflowX")},Vq=function(r,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=ree(r,a);if(l){var d=iee(r,a),g=d[1],E=d[2];if(g>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},c1e=function(r){var t=r.scrollTop,s=r.scrollHeight,a=r.clientHeight;return[t,s,a]},l1e=function(r){var t=r.scrollLeft,s=r.scrollWidth,a=r.clientWidth;return[t,s,a]},ree=function(r,t){return r==="v"?o1e(t):a1e(t)},iee=function(r,t){return r==="v"?c1e(t):l1e(t)},u1e=function(r,t){return r==="h"&&t==="rtl"?-1:1},d1e=function(r,t,s,a,l){var d=u1e(r,window.getComputedStyle(t).direction),g=d*a,E=s.target,S=t.contains(E),b=!1,C=g>0,O=0,k=0;do{var W=iee(r,E),H=W[0],K=W[1],G=W[2],te=K-G-d*H;(H||te)&&ree(r,E)&&(O+=te,k+=H),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!S&&E!==document.body||S&&(t.contains(E)||t===E));return(C&&Math.abs(O)<1||!C&&Math.abs(k)<1)&&(b=!0),b},vO=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},Fq=function(r){return[r.deltaX,r.deltaY]},jq=function(r){return r&&"current"in r?r.current:r},h1e=function(r,t){return r[0]===t[0]&&r[1]===t[1]},p1e=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},f1e=0,Cy=[];function m1e(r){var t=j.useRef([]),s=j.useRef([0,0]),a=j.useRef(),l=j.useState(f1e++)[0],d=j.useState(tee)[0],g=j.useRef(r);j.useEffect(function(){g.current=r},[r]),j.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(l));var K=RPe([r.lockRef.current],(r.shards||[]).map(jq),!0).filter(Boolean);return K.forEach(function(G){return G.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),K.forEach(function(G){return G.classList.remove("allow-interactivity-".concat(l))})}}},[r.inert,r.lockRef.current,r.shards]);var E=j.useCallback(function(K,G){if("touches"in K&&K.touches.length===2||K.type==="wheel"&&K.ctrlKey)return!g.current.allowPinchZoom;var te=vO(K),J=s.current,re="deltaX"in K?K.deltaX:J[0]-te[0],fe="deltaY"in K?K.deltaY:J[1]-te[1],oe,be=K.target,Z=Math.abs(re)>Math.abs(fe)?"h":"v";if("touches"in K&&Z==="h"&&be.type==="range")return!1;var ne=Vq(Z,be);if(!ne)return!0;if(ne?oe=Z:(oe=Z==="v"?"h":"v",ne=Vq(Z,be)),!ne)return!1;if(!a.current&&"changedTouches"in K&&(re||fe)&&(a.current=oe),!oe)return!0;var se=a.current||oe;return d1e(se,G,K,se==="h"?re:fe)},[]),S=j.useCallback(function(K){var G=K;if(!(!Cy.length||Cy[Cy.length-1]!==d)){var te="deltaY"in G?Fq(G):vO(G),J=t.current.filter(function(oe){return oe.name===G.type&&(oe.target===G.target||G.target===oe.shadowParent)&&h1e(oe.delta,te)})[0];if(J&&J.should){G.cancelable&&G.preventDefault();return}if(!J){var re=(g.current.shards||[]).map(jq).filter(Boolean).filter(function(oe){return oe.contains(G.target)}),fe=re.length>0?E(G,re[0]):!g.current.noIsolation;fe&&G.cancelable&&G.preventDefault()}}},[]),b=j.useCallback(function(K,G,te,J){var re={name:K,delta:G,target:te,should:J,shadowParent:g1e(te)};t.current.push(re),setTimeout(function(){t.current=t.current.filter(function(fe){return fe!==re})},1)},[]),C=j.useCallback(function(K){s.current=vO(K),a.current=void 0},[]),O=j.useCallback(function(K){b(K.type,Fq(K),K.target,E(K,r.lockRef.current))},[]),k=j.useCallback(function(K){b(K.type,vO(K),K.target,E(K,r.lockRef.current))},[]);j.useEffect(function(){return Cy.push(d),r.setCallbacks({onScrollCapture:O,onWheelCapture:O,onTouchMoveCapture:k}),document.addEventListener("wheel",S,Ry),document.addEventListener("touchmove",S,Ry),document.addEventListener("touchstart",C,Ry),function(){Cy=Cy.filter(function(K){return K!==d}),document.removeEventListener("wheel",S,Ry),document.removeEventListener("touchmove",S,Ry),document.removeEventListener("touchstart",C,Ry)}},[]);var W=r.removeScrollBar,H=r.inert;return j.createElement(j.Fragment,null,H?j.createElement(d,{styles:p1e(l)}):null,W?j.createElement(i1e,{gapMode:r.gapMode}):null)}function g1e(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const _1e=CPe(eee,m1e);var see=j.forwardRef(function(r,t){return j.createElement(_N,ah({},r,{ref:t,sideCar:_1e}))});see.classNames=_N.classNames;function E1e(r){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:g,finalFocusRef:E,returnFocusOnClose:S,preserveScrollBarGap:b,lockFocusAcrossFrames:C,isOpen:O}=K_(),[k,W]=BU();j.useEffect(()=>{!k&&W&&setTimeout(W)},[k,W]);const H=ZZ(a,O);return U.jsx(LZ,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:E,restoreFocus:S,contentRef:a,lockFocusAcrossFrames:C,children:U.jsx(see,{removeScrollBar:!b,allowPinchZoom:g,enabled:H===1&&d,forwardProps:!0,children:r.children})})}const v1e={initial:({offsetX:r,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:r,y:t,transition:(s==null?void 0:s.exit)??M_.exit(x_.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:r,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(r==null?void 0:r.enter)??M_.enter(x_.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:r,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const g={x:t,y:r};return{opacity:0,transition:(s==null?void 0:s.exit)??M_.exit(x_.exit,d),...l?{...g,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...g,...a==null?void 0:a.exit}}}}},Mb={initial:"initial",animate:"enter",exit:"exit",variants:v1e},y1e=j.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:g,offsetX:E=0,offsetY:S=8,transition:b,transitionEnd:C,delay:O,animatePresenceProps:k,...W}=t,H=a?l&&a:!0,K=l||a?"enter":"exit",G={offsetX:E,offsetY:S,reverse:d,transition:b,transitionEnd:C,delay:O};return U.jsx(NS,{...k,custom:G,children:H&&U.jsx(Xp.div,{ref:s,className:An("chakra-offset-slide",g),custom:G,...Mb,animate:K,...W})})});y1e.displayName="SlideFade";const S1e={exit:({reverse:r,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...r?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??M_.exit(x_.exit,l)}),enter:({transitionEnd:r,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??M_.enter(x_.enter,s),transitionEnd:r==null?void 0:r.enter})},oee={initial:"exit",animate:"enter",exit:"exit",variants:S1e},T1e=j.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:g=.95,className:E,transition:S,transitionEnd:b,delay:C,animatePresenceProps:O,...k}=t,W=a?l&&a:!0,H=l||a?"enter":"exit",K={initialScale:g,reverse:d,transition:S,transitionEnd:b,delay:C};return U.jsx(NS,{...O,custom:K,children:W&&U.jsx(Xp.div,{ref:s,className:An("chakra-offset-slide",E),...oee,animate:H,custom:K,...k})})});T1e.displayName="ScaleFade";const b1e={slideInBottom:{...Mb,custom:{offsetY:16,reverse:!0}},slideInRight:{...Mb,custom:{offsetX:16,reverse:!0}},slideInTop:{...Mb,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Mb,custom:{offsetX:-16,reverse:!0}},scale:{...oee,custom:{initialScale:.95,reverse:!0}},none:{}},w1e=kt(Xp.section),R1e=r=>b1e[r||"none"],aee=j.forwardRef((r,t)=>{const{preset:s,motionProps:a=R1e(s),...l}=r;return U.jsx(w1e,{ref:t,...a,...l})});aee.displayName="ModalTransition";const Qp=Qt((r,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...g}=r,{getDialogProps:E,getDialogContainerProps:S}=K_(),b=E(g,t),C=S(l),O=An("chakra-modal__content",s),k=US(),W={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...k.dialog},H={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...k.dialogContainer},{motionPreset:K}=K_();return U.jsx(E1e,{children:U.jsx(kt.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:H,children:U.jsx(aee,{preset:K,motionProps:d,className:O,...b,__css:W,children:a})})})});Qp.displayName="ModalContent";const Zp=Qt((r,t)=>{const{className:s,...a}=r,{bodyId:l,setBodyMounted:d}=K_();j.useEffect(()=>(d(!0),()=>d(!1)),[d]);const g=An("chakra-modal__body",s),E=US();return U.jsx(kt.div,{ref:t,className:g,id:l,...a,__css:E.body})});Zp.displayName="ModalBody";const ef=Qt((r,t)=>{const{onClick:s,className:a,...l}=r,{onClose:d}=K_(),g=An("chakra-modal__close-btn",a),E=US();return U.jsx(SV,{ref:t,__css:E.closeButton,className:g,onClick:qn(s,S=>{S.stopPropagation(),d()}),...l})});ef.displayName="ModalCloseButton";const EN=Qt((r,t)=>{const{className:s,...a}=r,l=An("chakra-modal__footer",s),d=US(),g={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return U.jsx(kt.footer,{ref:t,...a,__css:g,className:l})});EN.displayName="ModalFooter";const zm=Qt((r,t)=>{const{className:s,...a}=r,{headerId:l,setHeaderMounted:d}=K_();j.useEffect(()=>(d(!0),()=>d(!1)),[d]);const g=An("chakra-modal__header",s),E=US(),S={flex:0,...E.header};return U.jsx(kt.header,{ref:t,className:g,id:l,...a,__css:S})});zm.displayName="ModalHeader";const C1e={enter:({transition:r,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(r==null?void 0:r.enter)??M_.enter(x_.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:r,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(r==null?void 0:r.exit)??M_.exit(x_.exit,s),transitionEnd:t==null?void 0:t.exit})},cee={initial:"exit",animate:"enter",exit:"exit",variants:C1e},I1e=j.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:g,transitionEnd:E,delay:S,animatePresenceProps:b,...C}=t,O=l||a?"enter":"exit",k=a?l&&a:!0,W={transition:g,transitionEnd:E,delay:S};return U.jsx(NS,{...b,custom:W,children:k&&U.jsx(Xp.div,{ref:s,className:An("chakra-fade",d),custom:W,...cee,animate:O,...C})})});I1e.displayName="Fade";const A1e=kt(Xp.div),tf=Qt((r,t)=>{const{className:s,transition:a,motionProps:l,...d}=r,g=An("chakra-modal__overlay",s),S={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...US().overlay},{motionPreset:b}=K_(),O=l||(b==="none"?{}:cee);return U.jsx(A1e,{...O,__css:S,ref:t,className:g,...d})});tf.displayName="ModalOverlay";const[O1e,vN]=Li({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[P1e,lee]=Li({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),Iy={click:"click",hover:"hover"};function N1e(r={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:g=!0,arrowSize:E,arrowShadowColor:S,trigger:b=Iy.click,openDelay:C=200,closeDelay:O=200,isLazy:k,lazyBehavior:W="unmount",computePositionOnMount:H,...K}=r,{isOpen:G,onClose:te,onOpen:J,onToggle:re}=jw(r),[fe,oe]=j.useState(d);j.useEffect(()=>oe(d),[d]);const be=j.useRef(null),Z=j.useRef(null),ne=j.useRef(null),se=j.useRef(!1),ue=j.useRef(!1);G&&(ue.current=!0);const[Ee,he]=j.useState(!1),[le,Me]=j.useState(!1),pt=j.useId(),et=l??pt,[Oe,Ue,xe,it]=["popover-trigger","popover-content","popover-header","popover-body"].map(Wt=>`${Wt}-${et}`),{referenceRef:Ae,getArrowProps:$e,getPopperProps:Ze,getArrowInnerProps:Fe,forceUpdate:ct}=KV({...K,enabled:G||!!H}),_t=_X({isOpen:G,ref:ne});Age({enabled:G,ref:Z}),vX(ne,{focusRef:Z,visible:G,shouldFocus:fe&&b===Iy.click}),yge(ne,{focusRef:a,visible:G,shouldFocus:g&&b===Iy.click}),TX({enabled:G&&t,ref:ne,handler(Wt){var Ne;const ve=((Ne=Wt.composedPath)==null?void 0:Ne.call(Wt)[0])??[Wt.target];yO(Z.current,ve)||(ve&&oe(!dP(ve)),te())}});const Pt=vU({wasSelected:ue.current,enabled:k,mode:W,isSelected:_t.present}),Ht=j.useCallback((Wt={},ve=null)=>{const Ne={...Wt,style:{...Wt.style,transformOrigin:ks.transformOrigin.varRef,[ks.arrowSize.var]:E?`${E}px`:void 0,[ks.arrowShadowColor.var]:S},ref:qi(ne,ve),children:Pt?Wt.children:null,id:Ue,tabIndex:-1,role:"dialog",onKeyDown:qn(Wt.onKeyDown,We=>{We.nativeEvent.isComposing||s&&We.key==="Escape"&&(We.preventDefault(),We.stopPropagation(),te())}),onBlur:qn(Wt.onBlur,We=>{const ut=Bq(We),ft=yO(ne.current,ut),mt=yO(Z.current,ut),Ut=!ft&&!mt;ut&&oe(!dP(ut)),G&&t&&Ut&&te()}),"aria-labelledby":Ee?xe:void 0,"aria-describedby":le?it:void 0};return b===Iy.hover&&(Ne.role="tooltip",Ne.onMouseEnter=qn(Wt.onMouseEnter,()=>{se.current=!0}),Ne.onMouseLeave=qn(Wt.onMouseLeave,We=>{We.nativeEvent.relatedTarget!==null&&(se.current=!1,setTimeout(()=>te(),O))})),Ne},[Pt,Ue,Ee,xe,le,it,b,s,te,G,t,O,S,E]),xt=j.useCallback((Wt={},ve=null)=>Ze({...Wt,style:{visibility:G?"visible":"hidden",...Wt.style}},ve),[G,Ze]),fn=j.useCallback((Wt,ve=null)=>({...Wt,ref:qi(ve,be,Ae)}),[be,Ae]),Rn=j.useRef(void 0),ln=j.useRef(void 0),Hn=j.useCallback(Wt=>{be.current==null&&Ae(Wt)},[Ae]),Ar=j.useCallback((Wt={},ve=null)=>{const Ne={...Wt,ref:qi(Z,ve,Hn),id:Oe,"aria-haspopup":"dialog","aria-expanded":G,"aria-controls":Ue};return b===Iy.click&&(Ne.onClick=qn(Wt.onClick,re)),b===Iy.hover&&(Ne.onFocus=qn(Wt.onFocus,()=>{Rn.current===void 0&&J()}),Ne.onBlur=qn(Wt.onBlur,We=>{const ut=Bq(We),ft=!yO(ne.current,ut);G&&t&&ft&&te()}),Ne.onKeyDown=qn(Wt.onKeyDown,We=>{We.key==="Escape"&&te()}),Ne.onMouseEnter=qn(Wt.onMouseEnter,()=>{se.current=!0,Rn.current=window.setTimeout(()=>J(),C)}),Ne.onMouseLeave=qn(Wt.onMouseLeave,()=>{se.current=!1,Rn.current&&(clearTimeout(Rn.current),Rn.current=void 0),ln.current=window.setTimeout(()=>{se.current===!1&&te()},O)})),Ne},[Oe,G,Ue,b,Hn,re,J,t,te,C,O]);j.useEffect(()=>()=>{Rn.current&&clearTimeout(Rn.current),ln.current&&clearTimeout(ln.current)},[]);const Xt=j.useCallback((Wt={},ve=null)=>({...Wt,id:xe,ref:qi(ve,Ne=>{he(!!Ne)})}),[xe]),Qn=j.useCallback((Wt={},ve=null)=>({...Wt,id:it,ref:qi(ve,Ne=>{Me(!!Ne)})}),[it]);return{forceUpdate:ct,isOpen:G,onAnimationComplete:_t.onComplete,onClose:te,getAnchorProps:fn,getArrowProps:$e,getArrowInnerProps:Fe,getPopoverPositionerProps:xt,getPopoverProps:Ht,getTriggerProps:Ar,getHeaderProps:Xt,getBodyProps:Qn}}function yO(r,t){return r===t||(r==null?void 0:r.contains(t))}function Bq(r){const t=r.currentTarget.ownerDocument.activeElement;return r.relatedTarget??t}function uee(r){const t=xc("Popover",r),{children:s,...a}=Ji(r),l=LS(),d=N1e({...a,direction:l.direction});return U.jsx(O1e,{value:d,children:U.jsx(P1e,{value:t,children:Oc(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}uee.displayName="Popover";function dee(r){var s;const t=j.version;return typeof t!="string"||t.startsWith("18.")?r==null?void 0:r.ref:(s=r==null?void 0:r.props)==null?void 0:s.ref}const hee=Qt(function(t,s){const{getBodyProps:a}=vN(),l=lee();return U.jsx(kt.div,{...a(t,s),className:An("chakra-popover__body",t.className),__css:l.body})});hee.displayName="PopoverBody";function k1e(r){if(r)return{enter:{...r.enter,visibility:"visible"},exit:{...r.exit,transitionEnd:{visibility:"hidden"}}}}const D1e={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},L1e=kt(Xp.section),pee=Qt(function(t,s){const{variants:a=D1e,...l}=t,{isOpen:d}=vN();return U.jsx(L1e,{ref:s,variants:k1e(a),initial:!1,animate:d?"enter":"exit",...l})});pee.displayName="PopoverTransition";const fee=Qt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:g,getPopoverPositionerProps:E,onAnimationComplete:S}=vN(),b=lee(),C={position:"relative",display:"flex",flexDirection:"column",...b.content};return U.jsx(kt.div,{...E(a),__css:b.popper,className:"chakra-popover__popper",children:U.jsx(pee,{...l,...g(d,s),onAnimationComplete:dX(S,d.onAnimationComplete),className:An("chakra-popover__content",t.className),__css:C})})});fee.displayName="PopoverContent";function mee(r){const t=j.Children.only(r.children),{getTriggerProps:s}=vN();return U.jsx(U.Fragment,{children:j.cloneElement(t,s(t.props,dee(t)))})}mee.displayName="PopoverTrigger";function x1e(r,t,s){return(r-t)*100/(s-t)}zw({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});zw({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const M1e=zw({"0%":{left:"-40%"},"100%":{left:"100%"}}),U1e=zw({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function V1e(r){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:g,role:E="progressbar"}=r,S=x1e(t,s,a);return{bind:{"data-indeterminate":g?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":g?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,S):l})(),role:E},percent:S,value:t}}const[F1e,j1e]=Li({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),B1e=Qt((r,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:g,...E}=r,S=V1e({value:l,min:s,max:a,isIndeterminate:d,role:g}),C={height:"100%",...j1e().filledTrack};return U.jsx(kt.div,{ref:t,style:{width:`${S.percent}%`,...E.style},...S.bind,...E,__css:C})}),$V=Qt((r,t)=>{var Z;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:g,children:E,borderRadius:S,isIndeterminate:b,"aria-label":C,"aria-labelledby":O,"aria-valuetext":k,title:W,role:H,...K}=Ji(r),G=xc("Progress",r),te=S??((Z=G.track)==null?void 0:Z.borderRadius),J={animation:`${U1e} 1s linear infinite`},oe={...!b&&d&&g&&J,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${M1e} 1s ease infinite normal none running`}},be={overflow:"hidden",position:"relative",...G.track};return U.jsx(kt.div,{ref:t,borderRadius:te,__css:be,...K,children:U.jsxs(F1e,{value:G,children:[U.jsx(B1e,{"aria-label":C,"aria-labelledby":O,"aria-valuetext":k,min:a,max:l,value:s,isIndeterminate:b,css:oe,borderRadius:te,title:W,role:H}),E]})})});$V.displayName="Progress";const gee=Qt(function(t,s){const{children:a,placeholder:l,className:d,...g}=t;return U.jsxs(kt.select,{...g,ref:s,className:An("chakra-select",d),children:[l&&U.jsx("option",{value:"",children:l}),a]})});gee.displayName="SelectField";const _ee=Qt((r,t)=>{var re;const s=xc("Select",r),{rootProps:a,placeholder:l,icon:d,color:g,height:E,h:S,minH:b,minHeight:C,iconColor:O,iconSize:k,...W}=Ji(r),[H,K]=fge(W,A_e),G=tZ(K),te={width:"100%",height:"fit-content",position:"relative",color:g},J={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(re=s.field)==null?void 0:re._focus}};return U.jsxs(kt.div,{className:"chakra-select__wrapper",__css:te,...H,...a,children:[U.jsx(gee,{ref:t,height:S??E,minH:b??C,placeholder:l,...G,__css:J,children:r.children}),U.jsx(Eee,{"data-disabled":Gn(G.disabled),...(O||g)&&{color:O||g},__css:s.icon,...k&&{fontSize:k},children:d})]})});_ee.displayName="Select";const W1e=r=>U.jsx("svg",{viewBox:"0 0 24 24",...r,children:U.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),G1e=kt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Eee=r=>{const{children:t=U.jsx(W1e,{}),...s}=r,a=j.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return U.jsx(G1e,{...s,className:"chakra-select__icon-wrapper",children:j.isValidElement(t)?a:null})};Eee.displayName="SelectIcon";function SM(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function z1e(r){const{orientation:t,thumbPercents:s,isReversed:a}=r,l=W=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...SM({orientation:t,vertical:{bottom:`calc(${s[W]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[W]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},g={position:"absolute",...SM({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=s.length===1,S=[0,a?100-s[0]:s[0]],b=E?S:s;let C=b[0];!E&&a&&(C=100-C);const O=Math.abs(b[b.length-1]-b[0]),k={...g,...SM({orientation:t,vertical:a?{height:`${O}%`,top:`${C}%`}:{height:`${O}%`,bottom:`${C}%`},horizontal:a?{width:`${O}%`,right:`${C}%`}:{width:`${O}%`,left:`${C}%`}})};return{trackStyle:g,innerTrackStyle:k,rootStyle:d,getThumbStyle:l}}function H1e(r){const{isReversed:t,direction:s,orientation:a}=r;return s==="ltr"||a==="vertical"?t:!t}function K1e(r){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:g,direction:E="ltr",orientation:S="horizontal",id:b,isDisabled:C,isReadOnly:O,onChangeStart:k,onChangeEnd:W,step:H=1,getAriaValueText:K,"aria-valuetext":G,"aria-label":te,"aria-labelledby":J,name:re,focusThumbOnChange:fe=!0,...oe}=r,be=Pc(k),Z=Pc(W),ne=Pc(K),se=H1e({isReversed:g,direction:E,orientation:S}),[ue,Ee]=EX({value:l,defaultValue:d??q1e(t,s),onChange:a}),[he,le]=j.useState(!1),[Me,pt]=j.useState(!1),et=!(C||O),Oe=(s-t)/10,Ue=H||(s-t)/100,xe=wx(ue,t,s),it=s-xe+t,$e=Q9(se?it:xe,t,s),Ze=S==="vertical",Fe=SX({min:t,max:s,step:H,isDisabled:C,value:xe,isInteractive:et,isReversed:se,isVertical:Ze,eventSource:null,focusThumbOnChange:fe,orientation:S}),ct=j.useRef(null),_t=j.useRef(null),Pt=j.useRef(null),Ht=j.useId(),xt=b??Ht,[fn,Rn]=[`slider-thumb-${xt}`,`slider-track-${xt}`],ln=j.useCallback(Nt=>{var Js;if(!ct.current)return;const Zt=Fe.current;Zt.eventSource="pointer";const Wi=ct.current.getBoundingClientRect(),{clientX:bs,clientY:Ls}=((Js=Nt.touches)==null?void 0:Js[0])??Nt,ci=Ze?Wi.bottom-Ls:bs-Wi.left,Sa=Ze?Wi.height:Wi.width;let Mc=ci/Sa;se&&(Mc=1-Mc);let Xs=uge(Mc,Zt.min,Zt.max);return Zt.step&&(Xs=parseFloat(Z9(Xs,Zt.min,Zt.step))),Xs=wx(Xs,Zt.min,Zt.max),Xs},[Ze,se,Fe]),Hn=j.useCallback(Nt=>{const Zt=Fe.current;Zt.isInteractive&&(Nt=parseFloat(Z9(Nt,Zt.min,Ue)),Nt=wx(Nt,Zt.min,Zt.max),Ee(Nt))},[Ue,Ee,Fe]),Ar=j.useMemo(()=>({stepUp(Nt=Ue){const Zt=se?xe-Nt:xe+Nt;Hn(Zt)},stepDown(Nt=Ue){const Zt=se?xe+Nt:xe-Nt;Hn(Zt)},reset(){Hn(d||0)},stepTo(Nt){Hn(Nt)}}),[Hn,se,xe,Ue,d]),Xt=j.useCallback(Nt=>{const Zt=Fe.current,bs={ArrowRight:()=>Ar.stepUp(),ArrowUp:()=>Ar.stepUp(),ArrowLeft:()=>Ar.stepDown(),ArrowDown:()=>Ar.stepDown(),PageUp:()=>Ar.stepUp(Oe),PageDown:()=>Ar.stepDown(Oe),Home:()=>Hn(Zt.min),End:()=>Hn(Zt.max)}[Nt.key];bs&&(Nt.preventDefault(),Nt.stopPropagation(),bs(Nt),Zt.eventSource="keyboard")},[Ar,Hn,Oe,Fe]),Qn=(ne==null?void 0:ne(xe))??G,{getThumbStyle:Wt,rootStyle:ve,trackStyle:Ne,innerTrackStyle:We}=j.useMemo(()=>{const Nt=Fe.current;return z1e({isReversed:se,orientation:Nt.orientation,thumbPercents:[$e]})},[se,$e,Fe]),ut=j.useCallback(()=>{Fe.current.focusThumbOnChange&&setTimeout(()=>{var Zt;return(Zt=_t.current)==null?void 0:Zt.focus()})},[Fe]);Pm(()=>{const Nt=Fe.current;ut(),Nt.eventSource==="keyboard"&&(Z==null||Z(Nt.value))},[xe,Z]);function ft(Nt){const Zt=ln(Nt);Zt!=null&&Zt!==Fe.current.value&&Ee(Zt)}qge(Pt,{onPanSessionStart(Nt){const Zt=Fe.current;Zt.isInteractive&&(le(!0),ut(),ft(Nt),be==null||be(Zt.value))},onPanSessionEnd(){const Nt=Fe.current;Nt.isInteractive&&(le(!1),Z==null||Z(Nt.value))},onPan(Nt){Fe.current.isInteractive&&ft(Nt)}});const mt=j.useCallback((Nt={},Zt=null)=>({...Nt,...oe,ref:qi(Zt,Pt),tabIndex:-1,"aria-disabled":Ky(C),"data-focused":Gn(Me),style:{...Nt.style,...ve}}),[oe,C,Me,ve]),Ut=j.useCallback((Nt={},Zt=null)=>({...Nt,ref:qi(Zt,ct),id:Rn,"data-disabled":Gn(C),style:{...Nt.style,...Ne}}),[C,Rn,Ne]),pn=j.useCallback((Nt={},Zt=null)=>({...Nt,ref:Zt,style:{...Nt.style,...We}}),[We]),Nn=j.useCallback((Nt={},Zt=null)=>({...Nt,ref:qi(Zt,_t),role:"slider",tabIndex:et?0:void 0,id:fn,"data-active":Gn(he),"aria-valuetext":Qn,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":xe,"aria-orientation":S,"aria-disabled":Ky(C),"aria-readonly":Ky(O),"aria-label":te,"aria-labelledby":te?void 0:J,style:{...Nt.style,...Wt(0)},onKeyDown:qn(Nt.onKeyDown,Xt),onFocus:qn(Nt.onFocus,()=>pt(!0)),onBlur:qn(Nt.onBlur,()=>pt(!1))}),[et,fn,he,Qn,t,s,xe,S,C,O,te,J,Wt,Xt]),tn=j.useCallback((Nt,Zt=null)=>{const Wi=!(Nt.value<t||Nt.value>s),bs=xe>=Nt.value,Ls=Q9(Nt.value,t,s),ci={position:"absolute",pointerEvents:"none",...$1e({orientation:S,vertical:{bottom:se?`${100-Ls}%`:`${Ls}%`},horizontal:{left:se?`${100-Ls}%`:`${Ls}%`}})};return{...Nt,ref:Zt,role:"presentation","aria-hidden":!0,"data-disabled":Gn(C),"data-invalid":Gn(!Wi),"data-highlighted":Gn(bs),style:{...Nt.style,...ci}}},[C,se,s,t,S,xe]),ur=j.useCallback((Nt={},Zt=null)=>({...Nt,ref:Zt,type:"hidden",value:xe,name:re}),[re,xe]);return{state:{value:xe,isFocused:Me,isDragging:he},actions:Ar,getRootProps:mt,getTrackProps:Ut,getInnerTrackProps:pn,getThumbProps:Nn,getMarkerProps:tn,getInputProps:ur}}function $1e(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function q1e(r,t){return t<r?r:r+(t-r)/2}const[Y1e,yN]=Li({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[X1e,SN]=Li({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),L2=Qt((r,t)=>{const s={...r,orientation:(r==null?void 0:r.orientation)??"horizontal"},a=xc("Slider",s),l=Ji(s),{direction:d}=LS();l.direction=d;const{getInputProps:g,getRootProps:E,...S}=K1e(l),b=E(),C=g({},t);return U.jsx(Y1e,{value:S,children:U.jsx(X1e,{value:a,children:U.jsxs(kt.div,{...b,className:An("chakra-slider",s.className),__css:a.container,children:[s.children,U.jsx("input",{...C})]})})})});L2.displayName="Slider";const x2=Qt((r,t)=>{const{getThumbProps:s}=yN(),a=SN(),l=s(r,t);return U.jsx(kt.div,{...l,className:An("chakra-slider__thumb",r.className),__css:a.thumb})});x2.displayName="SliderThumb";const M2=Qt((r,t)=>{const{getTrackProps:s}=yN(),a=SN(),l=s(r,t);return U.jsx(kt.div,{...l,className:An("chakra-slider__track",r.className),__css:a.track})});M2.displayName="SliderTrack";const U2=Qt((r,t)=>{const{getInnerTrackProps:s}=yN(),a=SN(),l=s(r,t);return U.jsx(kt.div,{...l,className:An("chakra-slider__filled-track",r.className),__css:a.filledTrack})});U2.displayName="SliderFilledTrack";const J1e=Qt((r,t)=>{const{getMarkerProps:s}=yN(),a=SN(),l=s(r,t);return U.jsx(kt.div,{...l,className:An("chakra-slider__marker",r.className),__css:a.mark})});J1e.displayName="SliderMark";const vee=kt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});vee.displayName="Spacer";const yee=r=>U.jsx(kt.div,{className:"chakra-stack__item",...r,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...r.__css}});yee.displayName="StackItem";function Q1e(r){const{spacing:t,direction:s}=r,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":yU(s,l=>a[l])}}const qV=Qt((r,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:g="0.5rem",wrap:E,children:S,divider:b,className:C,shouldWrapChildren:O,...k}=r,W=s?"row":a??"column",H=j.useMemo(()=>Q1e({spacing:g,direction:W}),[g,W]),K=!!b,G=!O&&!K,te=j.useMemo(()=>{const re=EU(S);return G?re:re.map((fe,oe)=>{const be=typeof fe.key<"u"?fe.key:oe,Z=oe+1===re.length,se=O?U.jsx(yee,{children:fe},be):fe;if(!K)return se;const ue=j.cloneElement(b,{__css:H}),Ee=Z?null:ue;return U.jsxs(j.Fragment,{children:[se,Ee]},be)})},[b,H,K,G,O,S]),J=An("chakra-stack",C);return U.jsx(kt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:W,flexWrap:E,gap:K?void 0:g,className:J,...k,children:te})});qV.displayName="Stack";const yS=Qt((r,t)=>U.jsx(qV,{align:"center",...r,direction:"row",ref:t}));yS.displayName="HStack";const Wa=Qt((r,t)=>U.jsx(qV,{align:"center",...r,direction:"column",ref:t}));Wa.displayName="VStack";const XO=Qt(function(t,s){const a=xc("Switch",t),{spacing:l="0.5rem",children:d,...g}=Ji(t),{getIndicatorProps:E,getInputProps:S,getCheckboxProps:b,getRootProps:C,getLabelProps:O}=pPe(g),k=j.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),W=j.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),H=j.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return U.jsxs(kt.label,{...C(),className:An("chakra-switch",t.className),__css:k,children:[U.jsx("input",{className:"chakra-switch__input",...S({},s)}),U.jsx(kt.span,{...b(),className:"chakra-switch__track",__css:W,children:U.jsx(kt.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&U.jsx(kt.span,{className:"chakra-switch__label",...O(),__css:H,children:d})]})});XO.displayName="Switch";const[Z1e,eLe,tLe,nLe]=$Q();function rLe(r){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:g="unmount",orientation:E="horizontal",direction:S="ltr",...b}=r,[C,O]=j.useState(t??0),[k,W]=EX({defaultValue:t??0,value:a,onChange:s});j.useEffect(()=>{a!=null&&O(a)},[a]);const H=tLe(),K=j.useId();return{id:`tabs-${r.id??K}`,selectedIndex:k,focusedIndex:C,setSelectedIndex:W,setFocusedIndex:O,isManual:l,isLazy:d,lazyBehavior:g,orientation:E,descendants:H,direction:S,htmlProps:b}}const[iLe,TN]=Li({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function sLe(r){const{focusedIndex:t,orientation:s,direction:a}=TN(),l=eLe(),d=j.useCallback(g=>{const E=()=>{var re;const J=l.nextEnabled(t);J&&((re=J.node)==null||re.focus())},S=()=>{var re;const J=l.prevEnabled(t);J&&((re=J.node)==null||re.focus())},b=()=>{var re;const J=l.firstEnabled();J&&((re=J.node)==null||re.focus())},C=()=>{var re;const J=l.lastEnabled();J&&((re=J.node)==null||re.focus())},O=s==="horizontal",k=s==="vertical",W=g.key,H=a==="ltr"?"ArrowLeft":"ArrowRight",K=a==="ltr"?"ArrowRight":"ArrowLeft",te={[H]:()=>O&&S(),[K]:()=>O&&E(),ArrowDown:()=>k&&E(),ArrowUp:()=>k&&S(),Home:b,End:C}[W];te&&(g.preventDefault(),te(g))},[l,t,s,a]);return{...r,role:"tablist","aria-orientation":s,onKeyDown:qn(r.onKeyDown,d)}}function oLe(r){const{isDisabled:t=!1,isFocusable:s=!1,...a}=r,{setSelectedIndex:l,isManual:d,id:g,setFocusedIndex:E,selectedIndex:S}=TN(),{index:b,register:C}=nLe({disabled:t&&!s}),O=b===S,k=()=>{l(b)},W=()=>{E(b),!d&&!(t&&s)&&l(b)};return{...mDe({...a,ref:qi(C,r.ref),isDisabled:t,isFocusable:s,onClick:qn(r.onClick,k)}),id:See(g,b),role:"tab",tabIndex:O?0:-1,type:"button","aria-selected":O,"aria-controls":Tee(g,b),onFocus:t?void 0:qn(r.onFocus,W)}}const[aLe,cLe]=Li({});function lLe(r){const t=TN(),{id:s,selectedIndex:a}=t,d=EU(r.children).map((g,E)=>j.createElement(aLe,{key:g.key??E,value:{isSelected:E===a,id:Tee(s,E),tabId:See(s,E),selectedIndex:a}},g));return{...r,children:d}}function uLe(r){const{children:t,...s}=r,{isLazy:a,lazyBehavior:l}=TN(),{isSelected:d,id:g,tabId:E}=cLe(),S=j.useRef(!1);d&&(S.current=!0);const b=vU({wasSelected:S.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:b?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:g}}function See(r,t){return`${r}--tab-${t}`}function Tee(r,t){return`${r}--tabpanel-${t}`}const[dLe,bN]=Li({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),bee=Qt(function(t,s){const a=xc("Tabs",t),{children:l,className:d,...g}=Ji(t),{htmlProps:E,descendants:S,...b}=rLe(g),C=j.useMemo(()=>b,[b]),{isFitted:O,...k}=E,W={position:"relative",...a.root};return U.jsx(Z1e,{value:S,children:U.jsx(iLe,{value:C,children:U.jsx(dLe,{value:a,children:U.jsx(kt.div,{className:An("chakra-tabs",d),ref:s,...k,__css:W,children:l})})})})});bee.displayName="Tabs";const V2=Qt(function(t,s){const a=bN(),l=oLe({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return U.jsx(kt.button,{...l,className:An("chakra-tabs__tab",t.className),__css:d})});V2.displayName="Tab";const wee=Qt(function(t,s){const a=sLe({...t,ref:s}),l=bN(),d={display:"flex",...l.tablist};return U.jsx(kt.div,{...a,className:An("chakra-tabs__tablist",t.className),__css:d})});wee.displayName="TabList";const F2=Qt(function(t,s){const a=uLe({...t,ref:s}),l=bN();return U.jsx(kt.div,{outline:"0",...a,className:An("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});F2.displayName="TabPanel";const Ree=Qt(function(t,s){const a=lLe(t),l=bN();return U.jsx(kt.div,{...a,width:"100%",ref:s,className:An("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});Ree.displayName="TabPanels";function hLe(r,t){const s=r??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function pLe(r,t){const s=l=>({...t,...l,position:hLe((l==null?void 0:l.position)??(t==null?void 0:t.position),r)}),a=l=>{const d=s(l),g=zQ(d);return oh.notify(g,d)};return a.update=(l,d)=>{oh.update(l,s(d))},a.promise=(l,d)=>{const g=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(g,{status:"success",duration:5e3,...Oc(d.success,E)})).catch(E=>a.update(g,{status:"error",duration:5e3,...Oc(d.error,E)}))},a.closeAll=oh.closeAll,a.close=oh.close,a.isActive=oh.isActive,a}function tR(r){const{theme:t}=FQ(),s=UOe();return j.useMemo(()=>pLe(t.direction,{...s,...r}),[r,t.direction,s])}const fLe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},j2=r=>{var t;return((t=r.current)==null?void 0:t.ownerDocument)||document},JO=r=>{var t,s;return((s=(t=r.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function mLe(r={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:g=l,closeOnEsc:E=!0,onOpen:S,onClose:b,placement:C,id:O,isOpen:k,defaultIsOpen:W,arrowSize:H=10,arrowShadowColor:K,arrowPadding:G,modifiers:te,isDisabled:J,gutter:re,offset:fe,direction:oe,...be}=r,{isOpen:Z,onOpen:ne,onClose:se}=jw({isOpen:k,defaultIsOpen:W,onOpen:S,onClose:b}),{referenceRef:ue,getPopperProps:Ee,getArrowInnerProps:he,getArrowProps:le}=KV({enabled:Z,placement:C,arrowPadding:G,modifiers:te,gutter:re,offset:fe,direction:oe}),Me=j.useId(),et=`tooltip-${O??Me}`,Oe=j.useRef(null),Ue=j.useRef(void 0),xe=j.useCallback(()=>{Ue.current&&(clearTimeout(Ue.current),Ue.current=void 0)},[]),it=j.useRef(void 0),Ae=j.useCallback(()=>{it.current&&(clearTimeout(it.current),it.current=void 0)},[]),$e=j.useCallback(()=>{Ae(),se()},[se,Ae]),Ze=gLe(Oe,$e),Fe=j.useCallback(()=>{if(!J&&!Ue.current){Z&&Ze();const ln=JO(Oe);Ue.current=ln.setTimeout(ne,t)}},[Ze,J,Z,ne,t]),ct=j.useCallback(()=>{xe();const ln=JO(Oe);it.current=ln.setTimeout($e,s)},[s,$e,xe]),_t=j.useCallback(()=>{Z&&a&&ct()},[a,ct,Z]),Pt=j.useCallback(()=>{Z&&g&&ct()},[g,ct,Z]),Ht=j.useCallback(ln=>{Z&&ln.key==="Escape"&&ct()},[Z,ct]);$y(()=>j2(Oe),"keydown",E?Ht:void 0),$y(()=>{if(!d)return null;const ln=Oe.current;if(!ln)return null;const Hn=gX(ln);return Hn.localName==="body"?JO(Oe):Hn},"scroll",()=>{Z&&d&&$e()},{passive:!0,capture:!0}),j.useEffect(()=>{J&&(xe(),Z&&se())},[J,Z,se,xe]),j.useEffect(()=>()=>{xe(),Ae()},[xe,Ae]),$y(()=>Oe.current,"pointerleave",ct);const xt=j.useCallback((ln={},Hn=null)=>({...ln,ref:qi(Oe,Hn,ue),onPointerEnter:qn(ln.onPointerEnter,Xt=>{Xt.pointerType!=="touch"&&Fe()}),onClick:qn(ln.onClick,_t),onPointerDown:qn(ln.onPointerDown,Pt),onFocus:qn(ln.onFocus,Fe),onBlur:qn(ln.onBlur,ct),"aria-describedby":Z?et:void 0}),[Fe,ct,Pt,Z,et,_t,ue]),fn=j.useCallback((ln={},Hn=null)=>Ee({...ln,style:{...ln.style,[ks.arrowSize.var]:H?`${H}px`:void 0,[ks.arrowShadowColor.var]:K}},Hn),[Ee,H,K]),Rn=j.useCallback((ln={},Hn=null)=>{const Ar={...ln.style,position:"relative",transformOrigin:ks.transformOrigin.varRef};return{ref:Hn,...be,...ln,id:et,role:"tooltip",style:Ar}},[be,et]);return{isOpen:Z,show:Fe,hide:ct,getTriggerProps:xt,getTooltipProps:Rn,getTooltipPositionerProps:fn,getArrowProps:le,getArrowInnerProps:he}}const TM="chakra-ui:close-tooltip";function gLe(r,t){return j.useEffect(()=>{const s=j2(r);return s.addEventListener(TM,t),()=>s.removeEventListener(TM,t)},[t,r]),()=>{const s=j2(r),a=JO(r);s.dispatchEvent(new a.CustomEvent(TM))}}const _Le=kt(Xp.div),nR=Qt((r,t)=>{const s=rd("Tooltip",r),a=Ji(r),l=LS(),{children:d,label:g,shouldWrapChildren:E,"aria-label":S,hasArrow:b,bg:C,portalProps:O,background:k,backgroundColor:W,bgColor:H,motionProps:K,animatePresenceProps:G,...te}=a,J=k??W??C??H;if(J){s.bg=J;const ue=V_e(l,"colors",J);s[ks.arrowBg.var]=ue}const re=mLe({...te,direction:l.direction}),fe=!j.isValidElement(d)||E;let oe;if(fe)oe=U.jsx(kt.span,{display:"inline-block",tabIndex:0,...re.getTriggerProps(),children:d});else{const ue=j.Children.only(d);oe=j.cloneElement(ue,re.getTriggerProps(ue.props,dee(ue)))}const be=!!S,Z=re.getTooltipProps({},t),ne=be?Fw(Z,["role","id"]):Z,se=mX(Z,["role","id"]);return g?U.jsxs(U.Fragment,{children:[oe,U.jsx(NS,{...G,children:re.isOpen&&U.jsx(id,{...O,children:U.jsx(kt.div,{...re.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:U.jsxs(_Le,{variants:fLe,initial:"exit",animate:"enter",exit:"exit",...K,...ne,__css:s,children:[g,be&&U.jsx(kt.span,{srOnly:!0,...se,children:S}),b&&U.jsx(kt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:U.jsx(kt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):U.jsx(U.Fragment,{children:d})});nR.displayName="Tooltip";const YV=Qt(function(t,s){const a=rd("Heading",t),{className:l,...d}=Ji(t);return U.jsx(kt.h2,{ref:s,className:An("chakra-heading",t.className),...d,__css:a})});YV.displayName="Heading";const sr=Qt(function(t,s){const a=rd("Text",t),{className:l,align:d,decoration:g,casing:E,...S}=Ji(t),b=XP({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return U.jsx(kt.p,{ref:s,className:An("chakra-text",t.className),...b,...S,__css:a})});sr.displayName="Text";const ELe="modulepreload",vLe=function(r,t){return new URL(r,t).href},Wq={},bM=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const g=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),S=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(s.map(b=>{if(b=vLe(b,a),b in Wq)return;Wq[b]=!0;const C=b.endsWith(".css"),O=C?'[rel="stylesheet"]':"";if(!!a)for(let H=g.length-1;H>=0;H--){const K=g[H];if(K.href===b&&(!C||K.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${O}`))return;const W=document.createElement("link");if(W.rel=C?"stylesheet":ELe,C||(W.as="script"),W.crossOrigin="",W.href=b,S&&W.setAttribute("nonce",S),document.head.appendChild(W),C)return new Promise((H,K)=>{W.addEventListener("load",H),W.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(g){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=g,window.dispatchEvent(E),!E.defaultPrevented)throw g}return l.then(g=>{for(const E of g||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},SO=()=>{const r=new Date,t=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0"),a=r.getSeconds().toString().padStart(2,"0"),l=r.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},Ct={log:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${SO()}] `,...t)}},error:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${SO()}] `,...t)}},warn:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${SO()}]`,...t)}},trace:r=>{console.trace(`[TRACE] [${SO()}] ${r}`)}};async function yLe(r){let t;try{switch(r){case"default":t=await bM(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await bM(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(s){return Ct.error("Failed to load theme:",s),t=await bM(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const SLe=()=>{};var Gq={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cee=function(r){const t=[];let s=0;for(let a=0;a<r.length;a++){let l=r.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<r.length&&(r.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(r.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},TLe=function(r){const t=[];let s=0,a=0;for(;s<r.length;){const l=r[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=r[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=r[s++],g=r[s++],E=r[s++],S=((l&7)<<18|(d&63)<<12|(g&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(S>>10)),t[a++]=String.fromCharCode(56320+(S&1023))}else{const d=r[s++],g=r[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|g&63)}}return t.join("")},Iee={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<r.length;l+=3){const d=r[l],g=l+1<r.length,E=g?r[l+1]:0,S=l+2<r.length,b=S?r[l+2]:0,C=d>>2,O=(d&3)<<4|E>>4;let k=(E&15)<<2|b>>6,W=b&63;S||(W=64,g||(k=64)),a.push(s[C],s[O],s[k],s[W])}return a.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Cee(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):TLe(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<r.length;){const d=s[r.charAt(l++)],E=l<r.length?s[r.charAt(l)]:0;++l;const b=l<r.length?s[r.charAt(l)]:64;++l;const O=l<r.length?s[r.charAt(l)]:64;if(++l,d==null||E==null||b==null||O==null)throw new bLe;const k=d<<2|E>>4;if(a.push(k),b!==64){const W=E<<4&240|b>>2;if(a.push(W),O!==64){const H=b<<6&192|O;a.push(H)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class bLe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const wLe=function(r){const t=Cee(r);return Iee.encodeByteArray(t,!0)},IP=function(r){return wLe(r).replace(/\./g,"")},Aee=function(r){try{return Iee.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RLe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CLe=()=>RLe().__FIREBASE_DEFAULTS__,ILe=()=>{if(typeof process>"u"||typeof Gq>"u")return;const r=Gq.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},ALe=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&Aee(r[1]);return t&&JSON.parse(t)},wN=()=>{try{return SLe()||CLe()||ILe()||ALe()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Oee=r=>{var t,s;return(s=(t=wN())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[r]},Pee=r=>{const t=Oee(r);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},Nee=()=>{var r;return(r=wN())===null||r===void 0?void 0:r.config},kee=r=>{var t;return(t=wN())===null||t===void 0?void 0:t[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OLe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dee(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=r.iat||0,d=r.sub||r.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const g=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},r);return[IP(JSON.stringify(s)),IP(JSON.stringify(g)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ya(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function PLe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ya())}function NLe(){var r;const t=(r=wN())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kLe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function DLe(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function LLe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function xLe(){const r=ya();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function MLe(){return!NLe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ULe(){try{return typeof indexedDB=="object"}catch{return!1}}function VLe(){return new Promise((r,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),r(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FLe="FirebaseError";class Ih extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=FLe,Object.setPrototypeOf(this,Ih.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,rR.prototype.create)}}class rR{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],g=d?jLe(d,a):"Error",E=`${this.serviceName}: ${g} (${l}).`;return new Ih(l,E,a)}}function jLe(r,t){return r.replace(BLe,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const BLe=/\{\$([^}]+)}/g;function WLe(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function $_(r,t){if(r===t)return!0;const s=Object.keys(r),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=r[l],g=t[l];if(zq(d)&&zq(g)){if(!$_(d,g))return!1}else if(d!==g)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function zq(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iR(r){const t=[];for(const[s,a]of Object.entries(r))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function Ub(r){const t={};return r.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function Vb(r){const t=r.indexOf("?");if(!t)return"";const s=r.indexOf("#",t);return r.substring(t,s>0?s:void 0)}function GLe(r,t){const s=new zLe(r,t);return s.subscribe.bind(s)}class zLe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");HLe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=wM),l.error===void 0&&(l.error=wM),l.complete===void 0&&(l.complete=wM);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function HLe(r,t){if(typeof r!="object"||r===null)return!1;for(const s of t)if(s in r&&typeof r[s]=="function")return!0;return!1}function wM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ds(r){return r&&r._delegate?r._delegate:r}class Dm{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KLe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new OLe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(qLe(t))try{this.getOrInitializeService({instanceIdentifier:b_})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=b_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=b_){return this.instances.has(t)}getOptions(t=b_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,g]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&g.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const g=this.instances.get(l);return g&&t(g,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:$Le(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=b_){return this.component?this.component.multipleInstances?t:b_:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function $Le(r){return r===b_?void 0:r}function qLe(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YLe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new KLe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _r;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(_r||(_r={}));const XLe={debug:_r.DEBUG,verbose:_r.VERBOSE,info:_r.INFO,warn:_r.WARN,error:_r.ERROR,silent:_r.SILENT},JLe=_r.INFO,QLe={[_r.DEBUG]:"log",[_r.VERBOSE]:"log",[_r.INFO]:"info",[_r.WARN]:"warn",[_r.ERROR]:"error"},ZLe=(r,t,...s)=>{if(t<r.logLevel)return;const a=new Date().toISOString(),l=QLe[t];if(l)console[l](`[${a}]  ${r.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class XV{constructor(t){this.name=t,this._logLevel=JLe,this._logHandler=ZLe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in _r))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?XLe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,_r.DEBUG,...t),this._logHandler(this,_r.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,_r.VERBOSE,...t),this._logHandler(this,_r.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,_r.INFO,...t),this._logHandler(this,_r.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,_r.WARN,...t),this._logHandler(this,_r.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,_r.ERROR,...t),this._logHandler(this,_r.ERROR,...t)}}const exe=(r,t)=>t.some(s=>r instanceof s);let Hq,Kq;function txe(){return Hq||(Hq=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nxe(){return Kq||(Kq=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Lee=new WeakMap,B2=new WeakMap,xee=new WeakMap,RM=new WeakMap,JV=new WeakMap;function rxe(r){const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("success",d),r.removeEventListener("error",g)},d=()=>{s(Rm(r.result)),l()},g=()=>{a(r.error),l()};r.addEventListener("success",d),r.addEventListener("error",g)});return t.then(s=>{s instanceof IDBCursor&&Lee.set(s,r)}).catch(()=>{}),JV.set(t,r),t}function ixe(r){if(B2.has(r))return;const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("complete",d),r.removeEventListener("error",g),r.removeEventListener("abort",g)},d=()=>{s(),l()},g=()=>{a(r.error||new DOMException("AbortError","AbortError")),l()};r.addEventListener("complete",d),r.addEventListener("error",g),r.addEventListener("abort",g)});B2.set(r,t)}let W2={get(r,t,s){if(r instanceof IDBTransaction){if(t==="done")return B2.get(r);if(t==="objectStoreNames")return r.objectStoreNames||xee.get(r);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Rm(r[t])},set(r,t,s){return r[t]=s,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function sxe(r){W2=r(W2)}function oxe(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=r.call(CM(this),t,...s);return xee.set(a,t.sort?t.sort():[t]),Rm(a)}:nxe().includes(r)?function(...t){return r.apply(CM(this),t),Rm(Lee.get(this))}:function(...t){return Rm(r.apply(CM(this),t))}}function axe(r){return typeof r=="function"?oxe(r):(r instanceof IDBTransaction&&ixe(r),exe(r,txe())?new Proxy(r,W2):r)}function Rm(r){if(r instanceof IDBRequest)return rxe(r);if(RM.has(r))return RM.get(r);const t=axe(r);return t!==r&&(RM.set(r,t),JV.set(t,r)),t}const CM=r=>JV.get(r);function cxe(r,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const g=indexedDB.open(r,t),E=Rm(g);return a&&g.addEventListener("upgradeneeded",S=>{a(Rm(g.result),S.oldVersion,S.newVersion,Rm(g.transaction),S)}),s&&g.addEventListener("blocked",S=>s(S.oldVersion,S.newVersion,S)),E.then(S=>{d&&S.addEventListener("close",()=>d()),l&&S.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),E}const lxe=["get","getKey","getAll","getAllKeys","count"],uxe=["put","add","delete","clear"],IM=new Map;function $q(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(IM.get(t))return IM.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=uxe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||lxe.includes(s)))return;const d=async function(g,...E){const S=this.transaction(g,l?"readwrite":"readonly");let b=S.store;return a&&(b=b.index(E.shift())),(await Promise.all([b[s](...E),l&&S.done]))[0]};return IM.set(t,d),d}sxe(r=>({...r,get:(t,s,a)=>$q(t,s)||r.get(t,s,a),has:(t,s)=>!!$q(t,s)||r.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dxe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(hxe(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function hxe(r){const t=r.getComponent();return(t==null?void 0:t.type)==="VERSION"}const G2="@firebase/app",qq="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hp=new XV("@firebase/app"),pxe="@firebase/app-compat",fxe="@firebase/analytics-compat",mxe="@firebase/analytics",gxe="@firebase/app-check-compat",_xe="@firebase/app-check",Exe="@firebase/auth",vxe="@firebase/auth-compat",yxe="@firebase/database",Sxe="@firebase/data-connect",Txe="@firebase/database-compat",bxe="@firebase/functions",wxe="@firebase/functions-compat",Rxe="@firebase/installations",Cxe="@firebase/installations-compat",Ixe="@firebase/messaging",Axe="@firebase/messaging-compat",Oxe="@firebase/performance",Pxe="@firebase/performance-compat",Nxe="@firebase/remote-config",kxe="@firebase/remote-config-compat",Dxe="@firebase/storage",Lxe="@firebase/storage-compat",xxe="@firebase/firestore",Mxe="@firebase/vertexai",Uxe="@firebase/firestore-compat",Vxe="firebase",Fxe="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2="[DEFAULT]",jxe={[G2]:"fire-core",[pxe]:"fire-core-compat",[mxe]:"fire-analytics",[fxe]:"fire-analytics-compat",[_xe]:"fire-app-check",[gxe]:"fire-app-check-compat",[Exe]:"fire-auth",[vxe]:"fire-auth-compat",[yxe]:"fire-rtdb",[Sxe]:"fire-data-connect",[Txe]:"fire-rtdb-compat",[bxe]:"fire-fn",[wxe]:"fire-fn-compat",[Rxe]:"fire-iid",[Cxe]:"fire-iid-compat",[Ixe]:"fire-fcm",[Axe]:"fire-fcm-compat",[Oxe]:"fire-perf",[Pxe]:"fire-perf-compat",[Nxe]:"fire-rc",[kxe]:"fire-rc-compat",[Dxe]:"fire-gcs",[Lxe]:"fire-gcs-compat",[xxe]:"fire-fst",[Uxe]:"fire-fst-compat",[Mxe]:"fire-vertex","fire-js":"fire-js",[Vxe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AP=new Map,Bxe=new Map,H2=new Map;function Yq(r,t){try{r.container.addComponent(t)}catch(s){Hp.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,s)}}function q_(r){const t=r.name;if(H2.has(t))return Hp.debug(`There were multiple attempts to register component ${t}.`),!1;H2.set(t,r);for(const s of AP.values())Yq(s,r);for(const s of Bxe.values())Yq(s,r);return!0}function RN(r,t){const s=r.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),r.container.getProvider(t)}function sl(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wxe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Cm=new rR("app","Firebase",Wxe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gxe{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Dm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Cm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE=Fxe;function Mee(r,t={}){let s=r;typeof t!="object"&&(t={name:t});const a=Object.assign({name:z2,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw Cm.create("bad-app-name",{appName:String(l)});if(s||(s=Nee()),!s)throw Cm.create("no-options");const d=AP.get(l);if(d){if($_(s,d.options)&&$_(a,d.config))return d;throw Cm.create("duplicate-app",{appName:l})}const g=new YLe(l);for(const S of H2.values())g.addComponent(S);const E=new Gxe(s,a,g);return AP.set(l,E),E}function QV(r=z2){const t=AP.get(r);if(!t&&r===z2&&Nee())return Mee();if(!t)throw Cm.create("no-app",{appName:r});return t}function gh(r,t,s){var a;let l=(a=jxe[r])!==null&&a!==void 0?a:r;s&&(l+=`-${s}`);const d=l.match(/\s|\//),g=t.match(/\s|\//);if(d||g){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&g&&E.push("and"),g&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Hp.warn(E.join(" "));return}q_(new Dm(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zxe="firebase-heartbeat-database",Hxe=1,Aw="firebase-heartbeat-store";let AM=null;function Uee(){return AM||(AM=cxe(zxe,Hxe,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Aw)}catch(s){console.warn(s)}}}}).catch(r=>{throw Cm.create("idb-open",{originalErrorMessage:r.message})})),AM}async function Kxe(r){try{const s=(await Uee()).transaction(Aw),a=await s.objectStore(Aw).get(Vee(r));return await s.done,a}catch(t){if(t instanceof Ih)Hp.warn(t.message);else{const s=Cm.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Hp.warn(s.message)}}}async function Xq(r,t){try{const a=(await Uee()).transaction(Aw,"readwrite");await a.objectStore(Aw).put(t,Vee(r)),await a.done}catch(s){if(s instanceof Ih)Hp.warn(s.message);else{const a=Cm.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Hp.warn(a.message)}}}function Vee(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $xe=1024,qxe=30;class Yxe{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new Jxe(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=Jq();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(g=>g.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>qxe){const g=Qxe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(g,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Hp.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=Jq(),{heartbeatsToSend:a,unsentEntries:l}=Xxe(this._heartbeatsCache.heartbeats),d=IP(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return Hp.warn(s),""}}}function Jq(){return new Date().toISOString().substring(0,10)}function Xxe(r,t=$xe){const s=[];let a=r.slice();for(const l of r){const d=s.find(g=>g.agent===l.agent);if(d){if(d.dates.push(l.date),Qq(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),Qq(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class Jxe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ULe()?VLe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await Kxe(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return Xq(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return Xq(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function Qq(r){return IP(JSON.stringify({version:2,heartbeats:r})).length}function Qxe(r){if(r.length===0)return-1;let t=0,s=r[0].date;for(let a=1;a<r.length;a++)r[a].date<s&&(s=r[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zxe(r){q_(new Dm("platform-logger",t=>new dxe(t),"PRIVATE")),q_(new Dm("heartbeat",t=>new Yxe(t),"PRIVATE")),gh(G2,qq,r),gh(G2,qq,"esm2017"),gh("fire-js","")}Zxe("");function Fee(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const eMe=Fee,jee=new rR("auth","Firebase",Fee());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OP=new XV("@firebase/auth");function tMe(r,...t){OP.logLevel<=_r.WARN&&OP.warn(`Auth (${tE}): ${r}`,...t)}function QO(r,...t){OP.logLevel<=_r.ERROR&&OP.error(`Auth (${tE}): ${r}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nd(r,...t){throw ZV(r,...t)}function _h(r,...t){return ZV(r,...t)}function Bee(r,t,s){const a=Object.assign(Object.assign({},eMe()),{[t]:s});return new rR("auth","Firebase",a).create(t,{appName:r.name})}function Fp(r){return Bee(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ZV(r,...t){if(typeof r!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=r.name),r._errorFactory.create(s,...a)}return jee.create(r,...t)}function Pn(r,t,...s){if(!r)throw ZV(t,...s)}function Dp(r){const t="INTERNAL ASSERTION FAILED: "+r;throw QO(t),new Error(t)}function Kp(r,t){r||Dp(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K2(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function nMe(){return Zq()==="http:"||Zq()==="https:"}function Zq(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rMe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nMe()||DLe()||"connection"in navigator)?navigator.onLine:!0}function iMe(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(t,s){this.shortDelay=t,this.longDelay=s,Kp(s>t,"Short delay should be less than long delay!"),this.isMobile=PLe()||LLe()}get(){return rMe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eF(r,t){Kp(r.emulator,"Emulator should always be set here");const{url:s}=r.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wee{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Dp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Dp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Dp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sMe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oMe=new sR(3e4,6e4);function Hm(r,t){return r.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:r.tenantId}):t}async function Km(r,t,s,a,l={}){return Gee(r,l,async()=>{let d={},g={};a&&(t==="GET"?g=a:d={body:JSON.stringify(a)});const E=iR(Object.assign({key:r.config.apiKey},g)).slice(1),S=await r._getAdditionalHeaders();S["Content-Type"]="application/json",r.languageCode&&(S["X-Firebase-Locale"]=r.languageCode);const b=Object.assign({method:t,headers:S},d);return kLe()||(b.referrerPolicy="no-referrer"),Wee.fetch()(zee(r,r.config.apiHost,s,E),b)})}async function Gee(r,t,s){r._canInitEmulator=!1;const a=Object.assign(Object.assign({},sMe),t);try{const l=new cMe(r),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const g=await d.json();if("needConfirmation"in g)throw TO(r,"account-exists-with-different-credential",g);if(d.ok&&!("errorMessage"in g))return g;{const E=d.ok?g.errorMessage:g.error.message,[S,b]=E.split(" : ");if(S==="FEDERATED_USER_ID_ALREADY_LINKED")throw TO(r,"credential-already-in-use",g);if(S==="EMAIL_EXISTS")throw TO(r,"email-already-in-use",g);if(S==="USER_DISABLED")throw TO(r,"user-disabled",g);const C=a[S]||S.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw Bee(r,C,b);nd(r,C)}}catch(l){if(l instanceof Ih)throw l;nd(r,"network-request-failed",{message:String(l)})}}async function oR(r,t,s,a,l={}){const d=await Km(r,t,s,a,l);return"mfaPendingCredential"in d&&nd(r,"multi-factor-auth-required",{_serverResponse:d}),d}function zee(r,t,s,a){const l=`${t}${s}?${a}`;return r.config.emulator?eF(r.config,l):`${r.config.apiScheme}://${l}`}function aMe(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class cMe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(_h(this.auth,"network-request-failed")),oMe.get())})}}function TO(r,t,s){const a={appName:r.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=_h(r,t,a);return l.customData._tokenResponse=s,l}function e7(r){return r!==void 0&&r.enterprise!==void 0}class lMe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return aMe(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function uMe(r,t){return Km(r,"GET","/v2/recaptchaConfig",Hm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dMe(r,t){return Km(r,"POST","/v1/accounts:delete",t)}async function Hee(r,t){return Km(r,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iw(r){if(r)try{const t=new Date(Number(r));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function hMe(r,t=!1){const s=Ds(r),a=await s.getIdToken(t),l=tF(a);Pn(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,g=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:iw(OM(l.auth_time)),issuedAtTime:iw(OM(l.iat)),expirationTime:iw(OM(l.exp)),signInProvider:g||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function OM(r){return Number(r)*1e3}function tF(r){const[t,s,a]=r.split(".");if(t===void 0||s===void 0||a===void 0)return QO("JWT malformed, contained fewer than 3 sections"),null;try{const l=Aee(s);return l?JSON.parse(l):(QO("Failed to decode base64 JWT payload"),null)}catch(l){return QO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function t7(r){const t=tF(r);return Pn(t,"internal-error"),Pn(typeof t.exp<"u","internal-error"),Pn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ow(r,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof Ih&&pMe(a)&&r.auth.currentUser===r&&await r.auth.signOut(),a}}function pMe({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fMe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=iw(this.lastLoginAt),this.creationTime=iw(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PP(r){var t;const s=r.auth,a=await r.getIdToken(),l=await Ow(r,Hee(s,{idToken:a}));Pn(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];r._notifyReloadListener(d);const g=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?Kee(d.providerUserInfo):[],E=gMe(r.providerData,g),S=r.isAnonymous,b=!(r.email&&d.passwordHash)&&!(E!=null&&E.length),C=S?b:!1,O={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new $2(d.createdAt,d.lastLoginAt),isAnonymous:C};Object.assign(r,O)}async function mMe(r){const t=Ds(r);await PP(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function gMe(r,t){return[...r.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function Kee(r){return r.map(t=>{var{providerId:s}=t,a=Jw(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _Me(r,t){const s=await Gee(r,{},async()=>{const a=iR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=r.config,g=zee(r,l,"/v1/token",`key=${d}`),E=await r._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",Wee.fetch()(g,{method:"POST",headers:E,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function EMe(r,t){return Km(r,"POST","/v2/accounts:revokeToken",Hm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Pn(t.idToken,"internal-error"),Pn(typeof t.idToken<"u","internal-error"),Pn(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):t7(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Pn(t.length!==0,"internal-error");const s=t7(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Pn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await _Me(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,g=new iS;return a&&(Pn(typeof a=="string","internal-error",{appName:t}),g.refreshToken=a),l&&(Pn(typeof l=="string","internal-error",{appName:t}),g.accessToken=l),d&&(Pn(typeof d=="number","internal-error",{appName:t}),g.expirationTime=d),g}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new iS,this.toJSON())}_performRefresh(){return Dp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pm(r,t){Pn(typeof r=="string"||typeof r>"u","internal-error",{appName:t})}class Lp{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=Jw(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fMe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new $2(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await Ow(this,this.stsTokenManager.getToken(this.auth,t));return Pn(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return hMe(this,t)}reload(){return mMe(this)}_assign(t){this!==t&&(Pn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new Lp(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Pn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await PP(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(sl(this.auth.app))return Promise.reject(Fp(this.auth));const t=await this.getIdToken();return await Ow(this,dMe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,g,E,S,b,C;const O=(a=s.displayName)!==null&&a!==void 0?a:void 0,k=(l=s.email)!==null&&l!==void 0?l:void 0,W=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,H=(g=s.photoURL)!==null&&g!==void 0?g:void 0,K=(E=s.tenantId)!==null&&E!==void 0?E:void 0,G=(S=s._redirectEventId)!==null&&S!==void 0?S:void 0,te=(b=s.createdAt)!==null&&b!==void 0?b:void 0,J=(C=s.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:re,emailVerified:fe,isAnonymous:oe,providerData:be,stsTokenManager:Z}=s;Pn(re&&Z,t,"internal-error");const ne=iS.fromJSON(this.name,Z);Pn(typeof re=="string",t,"internal-error"),pm(O,t.name),pm(k,t.name),Pn(typeof fe=="boolean",t,"internal-error"),Pn(typeof oe=="boolean",t,"internal-error"),pm(W,t.name),pm(H,t.name),pm(K,t.name),pm(G,t.name),pm(te,t.name),pm(J,t.name);const se=new Lp({uid:re,auth:t,email:k,emailVerified:fe,displayName:O,isAnonymous:oe,photoURL:H,phoneNumber:W,tenantId:K,stsTokenManager:ne,createdAt:te,lastLoginAt:J});return be&&Array.isArray(be)&&(se.providerData=be.map(ue=>Object.assign({},ue))),G&&(se._redirectEventId=G),se}static async _fromIdTokenResponse(t,s,a=!1){const l=new iS;l.updateFromServerResponse(s);const d=new Lp({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await PP(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Pn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Kee(l.providerUserInfo):[],g=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new iS;E.updateFromIdToken(a);const S=new Lp({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:g}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new $2(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(S,b),S}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n7=new Map;function xp(r){Kp(r instanceof Function,"Expected a class definition");let t=n7.get(r);return t?(Kp(t instanceof r,"Instance stored in cache mismatched with class"),t):(t=new r,n7.set(r,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ee{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}$ee.type="NONE";const r7=$ee;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZO(r,t,s){return`firebase:${r}:${t}:${s}`}class sS{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=ZO(this.userKey,l.apiKey,d),this.fullPersistenceKey=ZO("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Lp._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new sS(xp(r7),t,a);const l=(await Promise.all(s.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||xp(r7);const g=ZO(a,t.config.apiKey,t.name);let E=null;for(const b of s)try{const C=await b._get(g);if(C){const O=Lp._fromJSON(t,C);b!==d&&(E=O),d=b;break}}catch{}const S=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!S.length?new sS(d,t,a):(d=S[0],E&&await d._set(g,E.toJSON()),await Promise.all(s.map(async b=>{if(b!==d)try{await b._remove(g)}catch{}})),new sS(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i7(r){const t=r.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Jee(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(qee(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Zee(t))return"Blackberry";if(ete(t))return"Webos";if(Yee(t))return"Safari";if((t.includes("chrome/")||Xee(t))&&!t.includes("edge/"))return"Chrome";if(Qee(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=r.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function qee(r=ya()){return/firefox\//i.test(r)}function Yee(r=ya()){const t=r.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Xee(r=ya()){return/crios\//i.test(r)}function Jee(r=ya()){return/iemobile/i.test(r)}function Qee(r=ya()){return/android/i.test(r)}function Zee(r=ya()){return/blackberry/i.test(r)}function ete(r=ya()){return/webos/i.test(r)}function nF(r=ya()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function vMe(r=ya()){var t;return nF(r)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function yMe(){return xLe()&&document.documentMode===10}function tte(r=ya()){return nF(r)||Qee(r)||ete(r)||Zee(r)||/windows phone/i.test(r)||Jee(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nte(r,t=[]){let s;switch(r){case"Browser":s=i7(ya());break;case"Worker":s=`${i7(ya())}-${r}`;break;default:s=r}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${tE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SMe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((g,E)=>{try{const S=t(d);g(S)}catch(S){E(S)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TMe(r,t={}){return Km(r,"GET","/v2/passwordPolicy",Hm(r,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bMe=6;class wMe{constructor(t){var s,a,l,d;const g=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=g.minPasswordLength)!==null&&s!==void 0?s:bMe,g.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=g.maxPasswordLength),g.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=g.containsLowercaseCharacter),g.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=g.containsUppercaseCharacter),g.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=g.containsNumericCharacter),g.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=g.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,g,E;const S={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,S),this.validatePasswordCharacterOptions(t,S),S.isValid&&(S.isValid=(s=S.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),S.isValid&&(S.isValid=(a=S.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),S.isValid&&(S.isValid=(l=S.containsLowercaseLetter)!==null&&l!==void 0?l:!0),S.isValid&&(S.isValid=(d=S.containsUppercaseLetter)!==null&&d!==void 0?d:!0),S.isValid&&(S.isValid=(g=S.containsNumericCharacter)!==null&&g!==void 0?g:!0),S.isValid&&(S.isValid=(E=S.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),S}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RMe{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new s7(this),this.idTokenSubscription=new s7(this),this.beforeStateQueue=new SMe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jee,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=xp(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await sS.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await Hee(this,{idToken:t}),a=await Lp._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(sl(this.app)){const g=this.app.settings.authIdToken;return g?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(g).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const g=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,E=l==null?void 0:l._redirectEventId,S=await this.tryRedirectSignIn(t);(!g||g===E)&&(S!=null&&S.user)&&(l=S.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(g){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(g))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Pn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await PP(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=iMe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(sl(this.app))return Promise.reject(Fp(this));const s=t?Ds(t):null;return s&&Pn(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Pn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return sl(this.app)?Promise.reject(Fp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return sl(this.app)?Promise.reject(Fp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(xp(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await TMe(this),s=new wMe(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new rR("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await EMe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&xp(t)||this._popupRedirectResolver;Pn(s,this,"argument-error"),this.redirectPersistenceManager=await sS.create(this,[xp(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let g=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Pn(E,this,"internal-error"),E.then(()=>{g||d(this.currentUser)}),typeof s=="function"){const S=t.addObserver(s,a,l);return()=>{g=!0,S()}}else{const S=t.addObserver(s);return()=>{g=!0,S()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Pn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=nte(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(sl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&tMe(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function nE(r){return Ds(r)}class s7{constructor(t){this.auth=t,this.observer=null,this.addObserver=GLe(s=>this.observer=s)}get next(){return Pn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let CN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function CMe(r){CN=r}function rte(r){return CN.loadJS(r)}function IMe(){return CN.recaptchaEnterpriseScript}function AMe(){return CN.gapiScript}function OMe(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class PMe{constructor(){this.enterprise=new NMe}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class NMe{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const kMe="recaptcha-enterprise",ite="NO_RECAPTCHA";class DMe{constructor(t){this.type=kMe,this.auth=nE(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(g,E)=>{uMe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(S=>{if(S.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const b=new lMe(S);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,g(b.siteKey)}}).catch(S=>{E(S)})})}function l(d,g,E){const S=window.grecaptcha;e7(S)?S.enterprise.ready(()=>{S.enterprise.execute(d,{action:t}).then(b=>{g(b)}).catch(()=>{g(ite)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new PMe().execute("siteKey",{action:"verify"}):new Promise((d,g)=>{a(this.auth).then(E=>{if(!s&&e7(window.grecaptcha))l(E,d,g);else{if(typeof window>"u"){g(new Error("RecaptchaVerifier is only supported in browser"));return}let S=IMe();S.length!==0&&(S+=E),rte(S).then(()=>{l(E,d,g)}).catch(b=>{g(b)})}}).catch(E=>{g(E)})})}}async function o7(r,t,s,a=!1,l=!1){const d=new DMe(r);let g;if(l)g=ite;else try{g=await d.verify(s)}catch{g=await d.verify(s,!0)}const E=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const S=E.phoneEnrollmentInfo.phoneNumber,b=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:S,recaptchaToken:b,captchaResponse:g,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const S=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:S,captchaResponse:g,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:g}):Object.assign(E,{captchaResponse:g}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function q2(r,t,s,a,l){var d;if(!((d=r._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const g=await o7(r,t,s,s==="getOobCode");return a(r,g)}else return a(r,t).catch(async g=>{if(g.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await o7(r,t,s,s==="getOobCode");return a(r,E)}else return Promise.reject(g)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LMe(r,t){const s=RN(r,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if($_(d,t??{}))return l;nd(l,"already-initialized")}return s.initialize({options:t})}function xMe(r,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(xp);t!=null&&t.errorMap&&r._updateErrorMap(t.errorMap),r._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function MMe(r,t,s){const a=nE(r);Pn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=ste(t),{host:g,port:E}=UMe(t),S=E===null?"":`:${E}`,b={url:`${d}//${g}${S}/`},C=Object.freeze({host:g,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Pn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Pn($_(b,a.config.emulator)&&$_(C,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=C,a.settings.appVerificationDisabledForTesting=!0,VMe()}function ste(r){const t=r.indexOf(":");return t<0?"":r.substr(0,t+1)}function UMe(r){const t=ste(r),s=/(\/\/)?([^?#/]+)/.exec(r.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:a7(a.substr(d.length+1))}}else{const[d,g]=a.split(":");return{host:d,port:a7(g)}}}function a7(r){if(!r)return null;const t=Number(r);return isNaN(t)?null:t}function VMe(){function r(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rF{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return Dp("not implemented")}_getIdTokenResponse(t){return Dp("not implemented")}_linkToIdToken(t,s){return Dp("not implemented")}_getReauthenticationResolver(t){return Dp("not implemented")}}async function FMe(r,t){return Km(r,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jMe(r,t){return oR(r,"POST","/v1/accounts:signInWithPassword",Hm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BMe(r,t){return oR(r,"POST","/v1/accounts:signInWithEmailLink",Hm(r,t))}async function WMe(r,t){return oR(r,"POST","/v1/accounts:signInWithEmailLink",Hm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw extends rF{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new Pw(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new Pw(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return q2(t,s,"signInWithPassword",jMe);case"emailLink":return BMe(t,{email:this._email,oobCode:this._password});default:nd(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return q2(t,a,"signUpPassword",FMe);case"emailLink":return WMe(t,{idToken:s,email:this._email,oobCode:this._password});default:nd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oS(r,t){return oR(r,"POST","/v1/accounts:signInWithIdp",Hm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GMe="http://localhost";class Y_ extends rF{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new Y_(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):nd("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=Jw(s,["providerId","signInMethod"]);if(!a||!l)return null;const g=new Y_(a,l);return g.idToken=d.idToken||void 0,g.accessToken=d.accessToken||void 0,g.secret=d.secret,g.nonce=d.nonce,g.pendingToken=d.pendingToken||null,g}_getIdTokenResponse(t){const s=this.buildRequest();return oS(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,oS(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,oS(t,s)}buildRequest(){const t={requestUri:GMe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=iR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zMe(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function HMe(r){const t=Ub(Vb(r)).link,s=t?Ub(Vb(t)).deep_link_id:null,a=Ub(Vb(r)).deep_link_id;return(a?Ub(Vb(a)).link:null)||a||s||t||r}class iF{constructor(t){var s,a,l,d,g,E;const S=Ub(Vb(t)),b=(s=S.apiKey)!==null&&s!==void 0?s:null,C=(a=S.oobCode)!==null&&a!==void 0?a:null,O=zMe((l=S.mode)!==null&&l!==void 0?l:null);Pn(b&&C&&O,"argument-error"),this.apiKey=b,this.operation=O,this.code=C,this.continueUrl=(d=S.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(g=S.languageCode)!==null&&g!==void 0?g:null,this.tenantId=(E=S.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const s=HMe(t);try{return new iF(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VS{constructor(){this.providerId=VS.PROVIDER_ID}static credential(t,s){return Pw._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=iF.parseLink(s);return Pn(a,"argument-error"),Pw._fromEmailAndCode(t,a.code,a.tenantId)}}VS.PROVIDER_ID="password";VS.EMAIL_PASSWORD_SIGN_IN_METHOD="password";VS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ote{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR extends ote{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em extends aR{constructor(){super("facebook.com")}static credential(t){return Y_._fromParams({providerId:Em.PROVIDER_ID,signInMethod:Em.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Em.credentialFromTaggedObject(t)}static credentialFromError(t){return Em.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Em.credential(t.oauthAccessToken)}catch{return null}}}Em.FACEBOOK_SIGN_IN_METHOD="facebook.com";Em.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vm extends aR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return Y_._fromParams({providerId:vm.PROVIDER_ID,signInMethod:vm.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return vm.credentialFromTaggedObject(t)}static credentialFromError(t){return vm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return vm.credential(s,a)}catch{return null}}}vm.GOOGLE_SIGN_IN_METHOD="google.com";vm.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym extends aR{constructor(){super("github.com")}static credential(t){return Y_._fromParams({providerId:ym.PROVIDER_ID,signInMethod:ym.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ym.credentialFromTaggedObject(t)}static credentialFromError(t){return ym.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ym.credential(t.oauthAccessToken)}catch{return null}}}ym.GITHUB_SIGN_IN_METHOD="github.com";ym.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm extends aR{constructor(){super("twitter.com")}static credential(t,s){return Y_._fromParams({providerId:Sm.PROVIDER_ID,signInMethod:Sm.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return Sm.credentialFromTaggedObject(t)}static credentialFromError(t){return Sm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return Sm.credential(s,a)}catch{return null}}}Sm.TWITTER_SIGN_IN_METHOD="twitter.com";Sm.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KMe(r,t){return oR(r,"POST","/v1/accounts:signUp",Hm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await Lp._fromIdTokenResponse(t,a,l),g=c7(a);return new X_({user:d,providerId:g,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=c7(a);return new X_({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function c7(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP extends Ih{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,NP.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new NP(t,s,a,l)}}function ate(r,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(r):s._getIdTokenResponse(r)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?NP._fromErrorAndOperation(r,d,t,a):d})}async function $Me(r,t,s=!1){const a=await Ow(r,t._linkToIdToken(r.auth,await r.getIdToken()),s);return X_._forOperation(r,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qMe(r,t,s=!1){const{auth:a}=r;if(sl(a.app))return Promise.reject(Fp(a));const l="reauthenticate";try{const d=await Ow(r,ate(a,l,t,r),s);Pn(d.idToken,a,"internal-error");const g=tF(d.idToken);Pn(g,a,"internal-error");const{sub:E}=g;return Pn(r.uid===E,a,"user-mismatch"),X_._forOperation(r,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&nd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cte(r,t,s=!1){if(sl(r.app))return Promise.reject(Fp(r));const a="signIn",l=await ate(r,a,t),d=await X_._fromIdTokenResponse(r,a,l);return s||await r._updateCurrentUser(d.user),d}async function YMe(r,t){return cte(nE(r),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lte(r){const t=nE(r);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function XMe(r,t,s){if(sl(r.app))return Promise.reject(Fp(r));const a=nE(r),g=await q2(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",KMe).catch(S=>{throw S.code==="auth/password-does-not-meet-requirements"&&lte(r),S}),E=await X_._fromIdTokenResponse(a,"signIn",g);return await a._updateCurrentUser(E.user),E}function JMe(r,t,s){return sl(r.app)?Promise.reject(Fp(r)):YMe(Ds(r),VS.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&lte(r),a})}function QMe(r,t,s,a){return Ds(r).onIdTokenChanged(t,s,a)}function ZMe(r,t,s){return Ds(r).beforeAuthStateChanged(t,s)}function e2e(r,t,s,a){return Ds(r).onAuthStateChanged(t,s,a)}function t2e(r){return Ds(r).signOut()}const kP="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ute{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(kP,"1"),this.storage.removeItem(kP),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n2e=1e3,r2e=10;class dte extends ute{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=tte(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((g,E,S)=>{this.notifyListeners(g,S)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const g=this.storage.getItem(a);!s&&this.localCache[a]===g||this.notifyListeners(a,g)},d=this.storage.getItem(a);yMe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,r2e):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},n2e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}dte.type="LOCAL";const i2e=dte;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hte extends ute{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}hte.type="SESSION";const pte=hte;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2e(r){return Promise.all(r.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new IN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,g=this.handlersMap[l];if(!(g!=null&&g.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(g).map(async b=>b(s.origin,d)),S=await s2e(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:S})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}IN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sF(r="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return r+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o2e{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,g;return new Promise((E,S)=>{const b=sF("",20);l.port1.start();const C=setTimeout(()=>{S(new Error("unsupported_event"))},a);g={messageChannel:l,onMessage(O){const k=O;if(k.data.eventId===b)switch(k.data.status){case"ack":clearTimeout(C),d=setTimeout(()=>{S(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(k.data.response);break;default:clearTimeout(C),clearTimeout(d),S(new Error("invalid_response"));break}}},this.handlers.add(g),l.port1.addEventListener("message",g.onMessage),this.target.postMessage({eventType:t,eventId:b,data:s},[l.port2])}).finally(()=>{g&&this.removeMessageHandler(g)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eh(){return window}function a2e(r){Eh().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fte(){return typeof Eh().WorkerGlobalScope<"u"&&typeof Eh().importScripts=="function"}async function c2e(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function l2e(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function u2e(){return fte()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mte="firebaseLocalStorageDb",d2e=1,DP="firebaseLocalStorage",gte="fbase_key";class cR{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function AN(r,t){return r.transaction([DP],t?"readwrite":"readonly").objectStore(DP)}function h2e(){const r=indexedDB.deleteDatabase(mte);return new cR(r).toPromise()}function Y2(){const r=indexedDB.open(mte,d2e);return new Promise((t,s)=>{r.addEventListener("error",()=>{s(r.error)}),r.addEventListener("upgradeneeded",()=>{const a=r.result;try{a.createObjectStore(DP,{keyPath:gte})}catch(l){s(l)}}),r.addEventListener("success",async()=>{const a=r.result;a.objectStoreNames.contains(DP)?t(a):(a.close(),await h2e(),t(await Y2()))})})}async function l7(r,t,s){const a=AN(r,!0).put({[gte]:t,value:s});return new cR(a).toPromise()}async function p2e(r,t){const s=AN(r,!1).get(t),a=await new cR(s).toPromise();return a===void 0?null:a.value}function u7(r,t){const s=AN(r,!0).delete(t);return new cR(s).toPromise()}const f2e=800,m2e=3;class _te{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Y2(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>m2e)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fte()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=IN._getInstance(u2e()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await c2e(),!this.activeServiceWorker)return;this.sender=new o2e(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||l2e()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Y2();return await l7(t,kP,"1"),await u7(t,kP),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>l7(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>p2e(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>u7(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=AN(l,!1).getAll();return new cR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),f2e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_te.type="LOCAL";const g2e=_te;new sR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _2e(r,t){return t?xp(t):(Pn(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oF extends rF{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return oS(t,this._buildIdpRequest())}_linkToIdToken(t,s){return oS(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return oS(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function E2e(r){return cte(r.auth,new oF(r),r.bypassAuthState)}function v2e(r){const{auth:t,user:s}=r;return Pn(s,t,"internal-error"),qMe(s,new oF(r),r.bypassAuthState)}async function y2e(r){const{auth:t,user:s}=r;return Pn(s,t,"internal-error"),$Me(s,new oF(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ete{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:g,type:E}=t;if(g){this.reject(g);return}const S={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(S))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return E2e;case"linkViaPopup":case"linkViaRedirect":return y2e;case"reauthViaPopup":case"reauthViaRedirect":return v2e;default:nd(this.auth,"internal-error")}}resolve(t){Kp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Kp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S2e=new sR(2e3,1e4);class Hy extends Ete{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,Hy.currentPopupAction&&Hy.currentPopupAction.cancel(),Hy.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Pn(t,this.auth,"internal-error"),t}async onExecution(){Kp(this.filter.length===1,"Popup operations only handle one event");const t=sF();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(_h(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(_h(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hy.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_h(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,S2e.get())};t()}}Hy.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T2e="pendingRedirect",eP=new Map;class b2e extends Ete{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=eP.get(this.auth._key());if(!t){try{const a=await w2e(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}eP.set(this.auth._key(),t)}return this.bypassAuthState||eP.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function w2e(r,t){const s=I2e(t),a=C2e(r);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function R2e(r,t){eP.set(r._key(),t)}function C2e(r){return xp(r._redirectPersistence)}function I2e(r){return ZO(T2e,r.config.apiKey,r.name)}async function A2e(r,t,s=!1){if(sl(r.app))return Promise.reject(Fp(r));const a=nE(r),l=_2e(a,t),g=await new b2e(a,l,s).execute();return g&&!s&&(delete g.user._redirectEventId,await a._persistUserIfCurrent(g.user),await a._setRedirectUser(null,t)),g}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2e=10*60*1e3;class P2e{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!N2e(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!vte(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(_h(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=O2e&&this.cachedEventUids.clear(),this.cachedEventUids.has(d7(t))}saveEventToCache(t){this.cachedEventUids.add(d7(t)),this.lastProcessedEventTime=Date.now()}}function d7(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(t=>t).join("-")}function vte({type:r,error:t}){return r==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function N2e(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return vte(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k2e(r,t={}){return Km(r,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D2e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,L2e=/^https?/;async function x2e(r){if(r.config.emulator)return;const{authorizedDomains:t}=await k2e(r);for(const s of t)try{if(M2e(s))return}catch{}nd(r,"unauthorized-domain")}function M2e(r){const t=K2(),{protocol:s,hostname:a}=new URL(t);if(r.startsWith("chrome-extension://")){const g=new URL(r);return g.hostname===""&&a===""?s==="chrome-extension:"&&r.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&g.hostname===a}if(!L2e.test(s))return!1;if(D2e.test(r))return a===r;const l=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U2e=new sR(3e4,6e4);function h7(){const r=Eh().___jsl;if(r!=null&&r.H){for(const t of Object.keys(r.H))if(r.H[t].r=r.H[t].r||[],r.H[t].L=r.H[t].L||[],r.H[t].r=[...r.H[t].L],r.CP)for(let s=0;s<r.CP.length;s++)r.CP[s]=null}}function V2e(r){return new Promise((t,s)=>{var a,l,d;function g(){h7(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{h7(),s(_h(r,"network-request-failed"))},timeout:U2e.get()})}if(!((l=(a=Eh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=Eh().gapi)===null||d===void 0)&&d.load)g();else{const E=OMe("iframefcb");return Eh()[E]=()=>{gapi.load?g():s(_h(r,"network-request-failed"))},rte(`${AMe()}?onload=${E}`).catch(S=>s(S))}}).catch(t=>{throw tP=null,t})}let tP=null;function F2e(r){return tP=tP||V2e(r),tP}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j2e=new sR(5e3,15e3),B2e="__/auth/iframe",W2e="emulator/auth/iframe",G2e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},z2e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function H2e(r){const t=r.config;Pn(t.authDomain,r,"auth-domain-config-required");const s=t.emulator?eF(t,W2e):`https://${r.config.authDomain}/${B2e}`,a={apiKey:t.apiKey,appName:r.name,v:tE},l=z2e.get(r.config.apiHost);l&&(a.eid=l);const d=r._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${iR(a).slice(1)}`}async function K2e(r){const t=await F2e(r),s=Eh().gapi;return Pn(s,r,"internal-error"),t.open({where:document.body,url:H2e(r),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:G2e,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const g=_h(r,"network-request-failed"),E=Eh().setTimeout(()=>{d(g)},j2e.get());function S(){Eh().clearTimeout(E),l(a)}a.ping(S).then(S,()=>{d(g)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},q2e=500,Y2e=600,X2e="_blank",J2e="http://localhost";class p7{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Q2e(r,t,s,a=q2e,l=Y2e){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),g=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const S=Object.assign(Object.assign({},$2e),{width:a.toString(),height:l.toString(),top:d,left:g}),b=ya().toLowerCase();s&&(E=Xee(b)?X2e:s),qee(b)&&(t=t||J2e,S.scrollbars="yes");const C=Object.entries(S).reduce((k,[W,H])=>`${k}${W}=${H},`,"");if(vMe(b)&&E!=="_self")return Z2e(t||"",E),new p7(null);const O=window.open(t||"",E,C);Pn(O,r,"popup-blocked");try{O.focus()}catch{}return new p7(O)}function Z2e(r,t){const s=document.createElement("a");s.href=r,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eUe="__/auth/handler",tUe="emulator/auth/handler",nUe=encodeURIComponent("fac");async function f7(r,t,s,a,l,d){Pn(r.config.authDomain,r,"auth-domain-config-required"),Pn(r.config.apiKey,r,"invalid-api-key");const g={apiKey:r.config.apiKey,appName:r.name,authType:s,redirectUrl:a,v:tE,eventId:l};if(t instanceof ote){t.setDefaultLanguage(r.languageCode),g.providerId=t.providerId||"",WLe(t.getCustomParameters())||(g.customParameters=JSON.stringify(t.getCustomParameters()));for(const[C,O]of Object.entries({}))g[C]=O}if(t instanceof aR){const C=t.getScopes().filter(O=>O!=="");C.length>0&&(g.scopes=C.join(","))}r.tenantId&&(g.tid=r.tenantId);const E=g;for(const C of Object.keys(E))E[C]===void 0&&delete E[C];const S=await r._getAppCheckToken(),b=S?`#${nUe}=${encodeURIComponent(S)}`:"";return`${rUe(r)}?${iR(E).slice(1)}${b}`}function rUe({config:r}){return r.emulator?eF(r,tUe):`https://${r.authDomain}/${eUe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM="webStorageSupport";class iUe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=pte,this._completeRedirectFn=A2e,this._overrideRedirectResult=R2e}async _openPopup(t,s,a,l){var d;Kp((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const g=await f7(t,s,a,K2(),l);return Q2e(t,g,sF())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await f7(t,s,a,K2(),l);return a2e(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(Kp(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await K2e(t),a=new P2e(t);return s.register("authEvent",l=>(Pn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(PM,{type:PM},l=>{var d;const g=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[PM];g!==void 0&&s(!!g),nd(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=x2e(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return tte()||Yee()||nF()}}const sUe=iUe;var m7="@firebase/auth",g7="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oUe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Pn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aUe(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function cUe(r){q_(new Dm("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:g,authDomain:E}=a.options;Pn(g&&!g.includes(":"),"invalid-api-key",{appName:a.name});const S={apiKey:g,authDomain:E,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nte(r)},b=new RMe(a,l,d,S);return xMe(b,s),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),q_(new Dm("auth-internal",t=>{const s=nE(t.getProvider("auth").getImmediate());return(a=>new oUe(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),gh(m7,g7,aUe(r)),gh(m7,g7,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lUe=5*60,uUe=kee("authIdTokenMaxAge")||lUe;let _7=null;const dUe=r=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>uUe)return;const l=s==null?void 0:s.token;_7!==l&&(_7=l,await fetch(r,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function yte(r=QV()){const t=RN(r,"auth");if(t.isInitialized())return t.getImmediate();const s=LMe(r,{popupRedirectResolver:sUe,persistence:[g2e,i2e,pte]}),a=kee("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const g=dUe(d.toString());ZMe(s,g,()=>g(s.currentUser)),QMe(s,E=>g(E))}}const l=Oee("auth");return l&&MMe(s,`http://${l}`),s}function hUe(){var r,t;return(t=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&t!==void 0?t:document}CMe({loadJS(r){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",r),a.onload=t,a.onerror=l=>{const d=_h("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",hUe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});cUe("Browser");var E7=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Im,Ste;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Z,ne){function se(){}se.prototype=ne.prototype,Z.D=ne.prototype,Z.prototype=new se,Z.prototype.constructor=Z,Z.C=function(ue,Ee,he){for(var le=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)le[Me-2]=arguments[Me];return ne.prototype[Ee].apply(ue,le)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Z,ne,se){se||(se=0);var ue=Array(16);if(typeof ne=="string")for(var Ee=0;16>Ee;++Ee)ue[Ee]=ne.charCodeAt(se++)|ne.charCodeAt(se++)<<8|ne.charCodeAt(se++)<<16|ne.charCodeAt(se++)<<24;else for(Ee=0;16>Ee;++Ee)ue[Ee]=ne[se++]|ne[se++]<<8|ne[se++]<<16|ne[se++]<<24;ne=Z.g[0],se=Z.g[1],Ee=Z.g[2];var he=Z.g[3],le=ne+(he^se&(Ee^he))+ue[0]+3614090360&4294967295;ne=se+(le<<7&4294967295|le>>>25),le=he+(Ee^ne&(se^Ee))+ue[1]+3905402710&4294967295,he=ne+(le<<12&4294967295|le>>>20),le=Ee+(se^he&(ne^se))+ue[2]+606105819&4294967295,Ee=he+(le<<17&4294967295|le>>>15),le=se+(ne^Ee&(he^ne))+ue[3]+3250441966&4294967295,se=Ee+(le<<22&4294967295|le>>>10),le=ne+(he^se&(Ee^he))+ue[4]+4118548399&4294967295,ne=se+(le<<7&4294967295|le>>>25),le=he+(Ee^ne&(se^Ee))+ue[5]+1200080426&4294967295,he=ne+(le<<12&4294967295|le>>>20),le=Ee+(se^he&(ne^se))+ue[6]+2821735955&4294967295,Ee=he+(le<<17&4294967295|le>>>15),le=se+(ne^Ee&(he^ne))+ue[7]+4249261313&4294967295,se=Ee+(le<<22&4294967295|le>>>10),le=ne+(he^se&(Ee^he))+ue[8]+1770035416&4294967295,ne=se+(le<<7&4294967295|le>>>25),le=he+(Ee^ne&(se^Ee))+ue[9]+2336552879&4294967295,he=ne+(le<<12&4294967295|le>>>20),le=Ee+(se^he&(ne^se))+ue[10]+4294925233&4294967295,Ee=he+(le<<17&4294967295|le>>>15),le=se+(ne^Ee&(he^ne))+ue[11]+2304563134&4294967295,se=Ee+(le<<22&4294967295|le>>>10),le=ne+(he^se&(Ee^he))+ue[12]+1804603682&4294967295,ne=se+(le<<7&4294967295|le>>>25),le=he+(Ee^ne&(se^Ee))+ue[13]+4254626195&4294967295,he=ne+(le<<12&4294967295|le>>>20),le=Ee+(se^he&(ne^se))+ue[14]+2792965006&4294967295,Ee=he+(le<<17&4294967295|le>>>15),le=se+(ne^Ee&(he^ne))+ue[15]+1236535329&4294967295,se=Ee+(le<<22&4294967295|le>>>10),le=ne+(Ee^he&(se^Ee))+ue[1]+4129170786&4294967295,ne=se+(le<<5&4294967295|le>>>27),le=he+(se^Ee&(ne^se))+ue[6]+3225465664&4294967295,he=ne+(le<<9&4294967295|le>>>23),le=Ee+(ne^se&(he^ne))+ue[11]+643717713&4294967295,Ee=he+(le<<14&4294967295|le>>>18),le=se+(he^ne&(Ee^he))+ue[0]+3921069994&4294967295,se=Ee+(le<<20&4294967295|le>>>12),le=ne+(Ee^he&(se^Ee))+ue[5]+3593408605&4294967295,ne=se+(le<<5&4294967295|le>>>27),le=he+(se^Ee&(ne^se))+ue[10]+38016083&4294967295,he=ne+(le<<9&4294967295|le>>>23),le=Ee+(ne^se&(he^ne))+ue[15]+3634488961&4294967295,Ee=he+(le<<14&4294967295|le>>>18),le=se+(he^ne&(Ee^he))+ue[4]+3889429448&4294967295,se=Ee+(le<<20&4294967295|le>>>12),le=ne+(Ee^he&(se^Ee))+ue[9]+568446438&4294967295,ne=se+(le<<5&4294967295|le>>>27),le=he+(se^Ee&(ne^se))+ue[14]+3275163606&4294967295,he=ne+(le<<9&4294967295|le>>>23),le=Ee+(ne^se&(he^ne))+ue[3]+4107603335&4294967295,Ee=he+(le<<14&4294967295|le>>>18),le=se+(he^ne&(Ee^he))+ue[8]+1163531501&4294967295,se=Ee+(le<<20&4294967295|le>>>12),le=ne+(Ee^he&(se^Ee))+ue[13]+2850285829&4294967295,ne=se+(le<<5&4294967295|le>>>27),le=he+(se^Ee&(ne^se))+ue[2]+4243563512&4294967295,he=ne+(le<<9&4294967295|le>>>23),le=Ee+(ne^se&(he^ne))+ue[7]+1735328473&4294967295,Ee=he+(le<<14&4294967295|le>>>18),le=se+(he^ne&(Ee^he))+ue[12]+2368359562&4294967295,se=Ee+(le<<20&4294967295|le>>>12),le=ne+(se^Ee^he)+ue[5]+4294588738&4294967295,ne=se+(le<<4&4294967295|le>>>28),le=he+(ne^se^Ee)+ue[8]+2272392833&4294967295,he=ne+(le<<11&4294967295|le>>>21),le=Ee+(he^ne^se)+ue[11]+1839030562&4294967295,Ee=he+(le<<16&4294967295|le>>>16),le=se+(Ee^he^ne)+ue[14]+4259657740&4294967295,se=Ee+(le<<23&4294967295|le>>>9),le=ne+(se^Ee^he)+ue[1]+2763975236&4294967295,ne=se+(le<<4&4294967295|le>>>28),le=he+(ne^se^Ee)+ue[4]+1272893353&4294967295,he=ne+(le<<11&4294967295|le>>>21),le=Ee+(he^ne^se)+ue[7]+4139469664&4294967295,Ee=he+(le<<16&4294967295|le>>>16),le=se+(Ee^he^ne)+ue[10]+3200236656&4294967295,se=Ee+(le<<23&4294967295|le>>>9),le=ne+(se^Ee^he)+ue[13]+681279174&4294967295,ne=se+(le<<4&4294967295|le>>>28),le=he+(ne^se^Ee)+ue[0]+3936430074&4294967295,he=ne+(le<<11&4294967295|le>>>21),le=Ee+(he^ne^se)+ue[3]+3572445317&4294967295,Ee=he+(le<<16&4294967295|le>>>16),le=se+(Ee^he^ne)+ue[6]+76029189&4294967295,se=Ee+(le<<23&4294967295|le>>>9),le=ne+(se^Ee^he)+ue[9]+3654602809&4294967295,ne=se+(le<<4&4294967295|le>>>28),le=he+(ne^se^Ee)+ue[12]+3873151461&4294967295,he=ne+(le<<11&4294967295|le>>>21),le=Ee+(he^ne^se)+ue[15]+530742520&4294967295,Ee=he+(le<<16&4294967295|le>>>16),le=se+(Ee^he^ne)+ue[2]+3299628645&4294967295,se=Ee+(le<<23&4294967295|le>>>9),le=ne+(Ee^(se|~he))+ue[0]+4096336452&4294967295,ne=se+(le<<6&4294967295|le>>>26),le=he+(se^(ne|~Ee))+ue[7]+1126891415&4294967295,he=ne+(le<<10&4294967295|le>>>22),le=Ee+(ne^(he|~se))+ue[14]+2878612391&4294967295,Ee=he+(le<<15&4294967295|le>>>17),le=se+(he^(Ee|~ne))+ue[5]+4237533241&4294967295,se=Ee+(le<<21&4294967295|le>>>11),le=ne+(Ee^(se|~he))+ue[12]+1700485571&4294967295,ne=se+(le<<6&4294967295|le>>>26),le=he+(se^(ne|~Ee))+ue[3]+2399980690&4294967295,he=ne+(le<<10&4294967295|le>>>22),le=Ee+(ne^(he|~se))+ue[10]+4293915773&4294967295,Ee=he+(le<<15&4294967295|le>>>17),le=se+(he^(Ee|~ne))+ue[1]+2240044497&4294967295,se=Ee+(le<<21&4294967295|le>>>11),le=ne+(Ee^(se|~he))+ue[8]+1873313359&4294967295,ne=se+(le<<6&4294967295|le>>>26),le=he+(se^(ne|~Ee))+ue[15]+4264355552&4294967295,he=ne+(le<<10&4294967295|le>>>22),le=Ee+(ne^(he|~se))+ue[6]+2734768916&4294967295,Ee=he+(le<<15&4294967295|le>>>17),le=se+(he^(Ee|~ne))+ue[13]+1309151649&4294967295,se=Ee+(le<<21&4294967295|le>>>11),le=ne+(Ee^(se|~he))+ue[4]+4149444226&4294967295,ne=se+(le<<6&4294967295|le>>>26),le=he+(se^(ne|~Ee))+ue[11]+3174756917&4294967295,he=ne+(le<<10&4294967295|le>>>22),le=Ee+(ne^(he|~se))+ue[2]+718787259&4294967295,Ee=he+(le<<15&4294967295|le>>>17),le=se+(he^(Ee|~ne))+ue[9]+3951481745&4294967295,Z.g[0]=Z.g[0]+ne&4294967295,Z.g[1]=Z.g[1]+(Ee+(le<<21&4294967295|le>>>11))&4294967295,Z.g[2]=Z.g[2]+Ee&4294967295,Z.g[3]=Z.g[3]+he&4294967295}a.prototype.u=function(Z,ne){ne===void 0&&(ne=Z.length);for(var se=ne-this.blockSize,ue=this.B,Ee=this.h,he=0;he<ne;){if(Ee==0)for(;he<=se;)l(this,Z,he),he+=this.blockSize;if(typeof Z=="string"){for(;he<ne;)if(ue[Ee++]=Z.charCodeAt(he++),Ee==this.blockSize){l(this,ue),Ee=0;break}}else for(;he<ne;)if(ue[Ee++]=Z[he++],Ee==this.blockSize){l(this,ue),Ee=0;break}}this.h=Ee,this.o+=ne},a.prototype.v=function(){var Z=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Z[0]=128;for(var ne=1;ne<Z.length-8;++ne)Z[ne]=0;var se=8*this.o;for(ne=Z.length-8;ne<Z.length;++ne)Z[ne]=se&255,se/=256;for(this.u(Z),Z=Array(16),ne=se=0;4>ne;++ne)for(var ue=0;32>ue;ue+=8)Z[se++]=this.g[ne]>>>ue&255;return Z};function d(Z,ne){var se=E;return Object.prototype.hasOwnProperty.call(se,Z)?se[Z]:se[Z]=ne(Z)}function g(Z,ne){this.h=ne;for(var se=[],ue=!0,Ee=Z.length-1;0<=Ee;Ee--){var he=Z[Ee]|0;ue&&he==ne||(se[Ee]=he,ue=!1)}this.g=se}var E={};function S(Z){return-128<=Z&&128>Z?d(Z,function(ne){return new g([ne|0],0>ne?-1:0)}):new g([Z|0],0>Z?-1:0)}function b(Z){if(isNaN(Z)||!isFinite(Z))return O;if(0>Z)return G(b(-Z));for(var ne=[],se=1,ue=0;Z>=se;ue++)ne[ue]=Z/se|0,se*=4294967296;return new g(ne,0)}function C(Z,ne){if(Z.length==0)throw Error("number format error: empty string");if(ne=ne||10,2>ne||36<ne)throw Error("radix out of range: "+ne);if(Z.charAt(0)=="-")return G(C(Z.substring(1),ne));if(0<=Z.indexOf("-"))throw Error('number format error: interior "-" character');for(var se=b(Math.pow(ne,8)),ue=O,Ee=0;Ee<Z.length;Ee+=8){var he=Math.min(8,Z.length-Ee),le=parseInt(Z.substring(Ee,Ee+he),ne);8>he?(he=b(Math.pow(ne,he)),ue=ue.j(he).add(b(le))):(ue=ue.j(se),ue=ue.add(b(le)))}return ue}var O=S(0),k=S(1),W=S(16777216);r=g.prototype,r.m=function(){if(K(this))return-G(this).m();for(var Z=0,ne=1,se=0;se<this.g.length;se++){var ue=this.i(se);Z+=(0<=ue?ue:4294967296+ue)*ne,ne*=4294967296}return Z},r.toString=function(Z){if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(H(this))return"0";if(K(this))return"-"+G(this).toString(Z);for(var ne=b(Math.pow(Z,6)),se=this,ue="";;){var Ee=fe(se,ne).g;se=te(se,Ee.j(ne));var he=((0<se.g.length?se.g[0]:se.h)>>>0).toString(Z);if(se=Ee,H(se))return he+ue;for(;6>he.length;)he="0"+he;ue=he+ue}},r.i=function(Z){return 0>Z?0:Z<this.g.length?this.g[Z]:this.h};function H(Z){if(Z.h!=0)return!1;for(var ne=0;ne<Z.g.length;ne++)if(Z.g[ne]!=0)return!1;return!0}function K(Z){return Z.h==-1}r.l=function(Z){return Z=te(this,Z),K(Z)?-1:H(Z)?0:1};function G(Z){for(var ne=Z.g.length,se=[],ue=0;ue<ne;ue++)se[ue]=~Z.g[ue];return new g(se,~Z.h).add(k)}r.abs=function(){return K(this)?G(this):this},r.add=function(Z){for(var ne=Math.max(this.g.length,Z.g.length),se=[],ue=0,Ee=0;Ee<=ne;Ee++){var he=ue+(this.i(Ee)&65535)+(Z.i(Ee)&65535),le=(he>>>16)+(this.i(Ee)>>>16)+(Z.i(Ee)>>>16);ue=le>>>16,he&=65535,le&=65535,se[Ee]=le<<16|he}return new g(se,se[se.length-1]&-2147483648?-1:0)};function te(Z,ne){return Z.add(G(ne))}r.j=function(Z){if(H(this)||H(Z))return O;if(K(this))return K(Z)?G(this).j(G(Z)):G(G(this).j(Z));if(K(Z))return G(this.j(G(Z)));if(0>this.l(W)&&0>Z.l(W))return b(this.m()*Z.m());for(var ne=this.g.length+Z.g.length,se=[],ue=0;ue<2*ne;ue++)se[ue]=0;for(ue=0;ue<this.g.length;ue++)for(var Ee=0;Ee<Z.g.length;Ee++){var he=this.i(ue)>>>16,le=this.i(ue)&65535,Me=Z.i(Ee)>>>16,pt=Z.i(Ee)&65535;se[2*ue+2*Ee]+=le*pt,J(se,2*ue+2*Ee),se[2*ue+2*Ee+1]+=he*pt,J(se,2*ue+2*Ee+1),se[2*ue+2*Ee+1]+=le*Me,J(se,2*ue+2*Ee+1),se[2*ue+2*Ee+2]+=he*Me,J(se,2*ue+2*Ee+2)}for(ue=0;ue<ne;ue++)se[ue]=se[2*ue+1]<<16|se[2*ue];for(ue=ne;ue<2*ne;ue++)se[ue]=0;return new g(se,0)};function J(Z,ne){for(;(Z[ne]&65535)!=Z[ne];)Z[ne+1]+=Z[ne]>>>16,Z[ne]&=65535,ne++}function re(Z,ne){this.g=Z,this.h=ne}function fe(Z,ne){if(H(ne))throw Error("division by zero");if(H(Z))return new re(O,O);if(K(Z))return ne=fe(G(Z),ne),new re(G(ne.g),G(ne.h));if(K(ne))return ne=fe(Z,G(ne)),new re(G(ne.g),ne.h);if(30<Z.g.length){if(K(Z)||K(ne))throw Error("slowDivide_ only works with positive integers.");for(var se=k,ue=ne;0>=ue.l(Z);)se=oe(se),ue=oe(ue);var Ee=be(se,1),he=be(ue,1);for(ue=be(ue,2),se=be(se,2);!H(ue);){var le=he.add(ue);0>=le.l(Z)&&(Ee=Ee.add(se),he=le),ue=be(ue,1),se=be(se,1)}return ne=te(Z,Ee.j(ne)),new re(Ee,ne)}for(Ee=O;0<=Z.l(ne);){for(se=Math.max(1,Math.floor(Z.m()/ne.m())),ue=Math.ceil(Math.log(se)/Math.LN2),ue=48>=ue?1:Math.pow(2,ue-48),he=b(se),le=he.j(ne);K(le)||0<le.l(Z);)se-=ue,he=b(se),le=he.j(ne);H(he)&&(he=k),Ee=Ee.add(he),Z=te(Z,le)}return new re(Ee,Z)}r.A=function(Z){return fe(this,Z).h},r.and=function(Z){for(var ne=Math.max(this.g.length,Z.g.length),se=[],ue=0;ue<ne;ue++)se[ue]=this.i(ue)&Z.i(ue);return new g(se,this.h&Z.h)},r.or=function(Z){for(var ne=Math.max(this.g.length,Z.g.length),se=[],ue=0;ue<ne;ue++)se[ue]=this.i(ue)|Z.i(ue);return new g(se,this.h|Z.h)},r.xor=function(Z){for(var ne=Math.max(this.g.length,Z.g.length),se=[],ue=0;ue<ne;ue++)se[ue]=this.i(ue)^Z.i(ue);return new g(se,this.h^Z.h)};function oe(Z){for(var ne=Z.g.length+1,se=[],ue=0;ue<ne;ue++)se[ue]=Z.i(ue)<<1|Z.i(ue-1)>>>31;return new g(se,Z.h)}function be(Z,ne){var se=ne>>5;ne%=32;for(var ue=Z.g.length-se,Ee=[],he=0;he<ue;he++)Ee[he]=0<ne?Z.i(he+se)>>>ne|Z.i(he+se+1)<<32-ne:Z.i(he+se);return new g(Ee,Z.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Ste=a,g.prototype.add=g.prototype.add,g.prototype.multiply=g.prototype.j,g.prototype.modulo=g.prototype.A,g.prototype.compare=g.prototype.l,g.prototype.toNumber=g.prototype.m,g.prototype.toString=g.prototype.toString,g.prototype.getBits=g.prototype.i,g.fromNumber=b,g.fromString=C,Im=g}).apply(typeof E7<"u"?E7:typeof self<"u"?self:typeof window<"u"?window:{});var bO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Tte,Fb,bte,nP,X2,wte,Rte,Cte;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(R,V,X){return R==Array.prototype||R==Object.prototype||(R[V]=X.value),R};function s(R){R=[typeof globalThis=="object"&&globalThis,R,typeof window=="object"&&window,typeof self=="object"&&self,typeof bO=="object"&&bO];for(var V=0;V<R.length;++V){var X=R[V];if(X&&X.Math==Math)return X}throw Error("Cannot find global object")}var a=s(this);function l(R,V){if(V)e:{var X=a;R=R.split(".");for(var de=0;de<R.length-1;de++){var je=R[de];if(!(je in X))break e;X=X[je]}R=R[R.length-1],de=X[R],V=V(de),V!=de&&V!=null&&t(X,R,{configurable:!0,writable:!0,value:V})}}function d(R,V){R instanceof String&&(R+="");var X=0,de=!1,je={next:function(){if(!de&&X<R.length){var Je=X++;return{value:V(Je,R[Je]),done:!1}}return de=!0,{done:!0,value:void 0}}};return je[Symbol.iterator]=function(){return je},je}l("Array.prototype.values",function(R){return R||function(){return d(this,function(V,X){return X})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var g=g||{},E=this||self;function S(R){var V=typeof R;return V=V!="object"?V:R?Array.isArray(R)?"array":V:"null",V=="array"||V=="object"&&typeof R.length=="number"}function b(R){var V=typeof R;return V=="object"&&R!=null||V=="function"}function C(R,V,X){return R.call.apply(R.bind,arguments)}function O(R,V,X){if(!R)throw Error();if(2<arguments.length){var de=Array.prototype.slice.call(arguments,2);return function(){var je=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(je,de),R.apply(V,je)}}return function(){return R.apply(V,arguments)}}function k(R,V,X){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:O,k.apply(null,arguments)}function W(R,V){var X=Array.prototype.slice.call(arguments,1);return function(){var de=X.slice();return de.push.apply(de,arguments),R.apply(this,de)}}function H(R,V){function X(){}X.prototype=V.prototype,R.aa=V.prototype,R.prototype=new X,R.prototype.constructor=R,R.Qb=function(de,je,Je){for(var It=Array(arguments.length-2),jr=2;jr<arguments.length;jr++)It[jr-2]=arguments[jr];return V.prototype[je].apply(de,It)}}function K(R){const V=R.length;if(0<V){const X=Array(V);for(let de=0;de<V;de++)X[de]=R[de];return X}return[]}function G(R,V){for(let X=1;X<arguments.length;X++){const de=arguments[X];if(S(de)){const je=R.length||0,Je=de.length||0;R.length=je+Je;for(let It=0;It<Je;It++)R[je+It]=de[It]}else R.push(de)}}class te{constructor(V,X){this.i=V,this.j=X,this.h=0,this.g=null}get(){let V;return 0<this.h?(this.h--,V=this.g,this.g=V.next,V.next=null):V=this.i(),V}}function J(R){return/^[\s\xa0]*$/.test(R)}function re(){var R=E.navigator;return R&&(R=R.userAgent)?R:""}function fe(R){return fe[" "](R),R}fe[" "]=function(){};var oe=re().indexOf("Gecko")!=-1&&!(re().toLowerCase().indexOf("webkit")!=-1&&re().indexOf("Edge")==-1)&&!(re().indexOf("Trident")!=-1||re().indexOf("MSIE")!=-1)&&re().indexOf("Edge")==-1;function be(R,V,X){for(const de in R)V.call(X,R[de],de,R)}function Z(R,V){for(const X in R)V.call(void 0,R[X],X,R)}function ne(R){const V={};for(const X in R)V[X]=R[X];return V}const se="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(R,V){let X,de;for(let je=1;je<arguments.length;je++){de=arguments[je];for(X in de)R[X]=de[X];for(let Je=0;Je<se.length;Je++)X=se[Je],Object.prototype.hasOwnProperty.call(de,X)&&(R[X]=de[X])}}function Ee(R){var V=1;R=R.split(":");const X=[];for(;0<V&&R.length;)X.push(R.shift()),V--;return R.length&&X.push(R.join(":")),X}function he(R){E.setTimeout(()=>{throw R},0)}function le(){var R=xe;let V=null;return R.g&&(V=R.g,R.g=R.g.next,R.g||(R.h=null),V.next=null),V}class Me{constructor(){this.h=this.g=null}add(V,X){const de=pt.get();de.set(V,X),this.h?this.h.next=de:this.g=de,this.h=de}}var pt=new te(()=>new et,R=>R.reset());class et{constructor(){this.next=this.g=this.h=null}set(V,X){this.h=V,this.g=X,this.next=null}reset(){this.next=this.g=this.h=null}}let Oe,Ue=!1,xe=new Me,it=()=>{const R=E.Promise.resolve(void 0);Oe=()=>{R.then(Ae)}};var Ae=()=>{for(var R;R=le();){try{R.h.call(R.g)}catch(X){he(X)}var V=pt;V.j(R),100>V.h&&(V.h++,R.next=V.g,V.g=R)}Ue=!1};function $e(){this.s=this.s,this.C=this.C}$e.prototype.s=!1,$e.prototype.ma=function(){this.s||(this.s=!0,this.N())},$e.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ze(R,V){this.type=R,this.g=this.target=V,this.defaultPrevented=!1}Ze.prototype.h=function(){this.defaultPrevented=!0};var Fe=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var R=!1,V=Object.defineProperty({},"passive",{get:function(){R=!0}});try{const X=()=>{};E.addEventListener("test",X,V),E.removeEventListener("test",X,V)}catch{}return R}();function ct(R,V){if(Ze.call(this,R?R.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,R){var X=this.type=R.type,de=R.changedTouches&&R.changedTouches.length?R.changedTouches[0]:null;if(this.target=R.target||R.srcElement,this.g=V,V=R.relatedTarget){if(oe){e:{try{fe(V.nodeName);var je=!0;break e}catch{}je=!1}je||(V=null)}}else X=="mouseover"?V=R.fromElement:X=="mouseout"&&(V=R.toElement);this.relatedTarget=V,de?(this.clientX=de.clientX!==void 0?de.clientX:de.pageX,this.clientY=de.clientY!==void 0?de.clientY:de.pageY,this.screenX=de.screenX||0,this.screenY=de.screenY||0):(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0),this.button=R.button,this.key=R.key||"",this.ctrlKey=R.ctrlKey,this.altKey=R.altKey,this.shiftKey=R.shiftKey,this.metaKey=R.metaKey,this.pointerId=R.pointerId||0,this.pointerType=typeof R.pointerType=="string"?R.pointerType:_t[R.pointerType]||"",this.state=R.state,this.i=R,R.defaultPrevented&&ct.aa.h.call(this)}}H(ct,Ze);var _t={2:"touch",3:"pen",4:"mouse"};ct.prototype.h=function(){ct.aa.h.call(this);var R=this.i;R.preventDefault?R.preventDefault():R.returnValue=!1};var Pt="closure_listenable_"+(1e6*Math.random()|0),Ht=0;function xt(R,V,X,de,je){this.listener=R,this.proxy=null,this.src=V,this.type=X,this.capture=!!de,this.ha=je,this.key=++Ht,this.da=this.fa=!1}function fn(R){R.da=!0,R.listener=null,R.proxy=null,R.src=null,R.ha=null}function Rn(R){this.src=R,this.g={},this.h=0}Rn.prototype.add=function(R,V,X,de,je){var Je=R.toString();R=this.g[Je],R||(R=this.g[Je]=[],this.h++);var It=Hn(R,V,de,je);return-1<It?(V=R[It],X||(V.fa=!1)):(V=new xt(V,this.src,Je,!!de,je),V.fa=X,R.push(V)),V};function ln(R,V){var X=V.type;if(X in R.g){var de=R.g[X],je=Array.prototype.indexOf.call(de,V,void 0),Je;(Je=0<=je)&&Array.prototype.splice.call(de,je,1),Je&&(fn(V),R.g[X].length==0&&(delete R.g[X],R.h--))}}function Hn(R,V,X,de){for(var je=0;je<R.length;++je){var Je=R[je];if(!Je.da&&Je.listener==V&&Je.capture==!!X&&Je.ha==de)return je}return-1}var Ar="closure_lm_"+(1e6*Math.random()|0),Xt={};function Qn(R,V,X,de,je){if(Array.isArray(V)){for(var Je=0;Je<V.length;Je++)Qn(R,V[Je],X,de,je);return null}return X=pn(X),R&&R[Pt]?R.K(V,X,b(de)?!!de.capture:!1,je):Wt(R,V,X,!1,de,je)}function Wt(R,V,X,de,je,Je){if(!V)throw Error("Invalid event type");var It=b(je)?!!je.capture:!!je,jr=mt(R);if(jr||(R[Ar]=jr=new Rn(R)),X=jr.add(V,X,de,It,Je),X.proxy)return X;if(de=ve(),X.proxy=de,de.src=R,de.listener=X,R.addEventListener)Fe||(je=It),je===void 0&&(je=!1),R.addEventListener(V.toString(),de,je);else if(R.attachEvent)R.attachEvent(ut(V.toString()),de);else if(R.addListener&&R.removeListener)R.addListener(de);else throw Error("addEventListener and attachEvent are unavailable.");return X}function ve(){function R(X){return V.call(R.src,R.listener,X)}const V=ft;return R}function Ne(R,V,X,de,je){if(Array.isArray(V))for(var Je=0;Je<V.length;Je++)Ne(R,V[Je],X,de,je);else de=b(de)?!!de.capture:!!de,X=pn(X),R&&R[Pt]?(R=R.i,V=String(V).toString(),V in R.g&&(Je=R.g[V],X=Hn(Je,X,de,je),-1<X&&(fn(Je[X]),Array.prototype.splice.call(Je,X,1),Je.length==0&&(delete R.g[V],R.h--)))):R&&(R=mt(R))&&(V=R.g[V.toString()],R=-1,V&&(R=Hn(V,X,de,je)),(X=-1<R?V[R]:null)&&We(X))}function We(R){if(typeof R!="number"&&R&&!R.da){var V=R.src;if(V&&V[Pt])ln(V.i,R);else{var X=R.type,de=R.proxy;V.removeEventListener?V.removeEventListener(X,de,R.capture):V.detachEvent?V.detachEvent(ut(X),de):V.addListener&&V.removeListener&&V.removeListener(de),(X=mt(V))?(ln(X,R),X.h==0&&(X.src=null,V[Ar]=null)):fn(R)}}}function ut(R){return R in Xt?Xt[R]:Xt[R]="on"+R}function ft(R,V){if(R.da)R=!0;else{V=new ct(V,this);var X=R.listener,de=R.ha||R.src;R.fa&&We(R),R=X.call(de,V)}return R}function mt(R){return R=R[Ar],R instanceof Rn?R:null}var Ut="__closure_events_fn_"+(1e9*Math.random()>>>0);function pn(R){return typeof R=="function"?R:(R[Ut]||(R[Ut]=function(V){return R.handleEvent(V)}),R[Ut])}function Nn(){$e.call(this),this.i=new Rn(this),this.M=this,this.F=null}H(Nn,$e),Nn.prototype[Pt]=!0,Nn.prototype.removeEventListener=function(R,V,X,de){Ne(this,R,V,X,de)};function tn(R,V){var X,de=R.F;if(de)for(X=[];de;de=de.F)X.push(de);if(R=R.M,de=V.type||V,typeof V=="string")V=new Ze(V,R);else if(V instanceof Ze)V.target=V.target||R;else{var je=V;V=new Ze(de,R),ue(V,je)}if(je=!0,X)for(var Je=X.length-1;0<=Je;Je--){var It=V.g=X[Je];je=ur(It,de,!0,V)&&je}if(It=V.g=R,je=ur(It,de,!0,V)&&je,je=ur(It,de,!1,V)&&je,X)for(Je=0;Je<X.length;Je++)It=V.g=X[Je],je=ur(It,de,!1,V)&&je}Nn.prototype.N=function(){if(Nn.aa.N.call(this),this.i){var R=this.i,V;for(V in R.g){for(var X=R.g[V],de=0;de<X.length;de++)fn(X[de]);delete R.g[V],R.h--}}this.F=null},Nn.prototype.K=function(R,V,X,de){return this.i.add(String(R),V,!1,X,de)},Nn.prototype.L=function(R,V,X,de){return this.i.add(String(R),V,!0,X,de)};function ur(R,V,X,de){if(V=R.i.g[String(V)],!V)return!0;V=V.concat();for(var je=!0,Je=0;Je<V.length;++Je){var It=V[Je];if(It&&!It.da&&It.capture==X){var jr=It.listener,ei=It.ha||It.src;It.fa&&ln(R.i,It),je=jr.call(ei,de)!==!1&&je}}return je&&!de.defaultPrevented}function Ga(R,V,X){if(typeof R=="function")X&&(R=k(R,X));else if(R&&typeof R.handleEvent=="function")R=k(R.handleEvent,R);else throw Error("Invalid listener argument");return 2147483647<Number(V)?-1:E.setTimeout(R,V||0)}function Nt(R){R.g=Ga(()=>{R.g=null,R.i&&(R.i=!1,Nt(R))},R.l);const V=R.h;R.h=null,R.m.apply(null,V)}class Zt extends $e{constructor(V,X){super(),this.m=V,this.l=X,this.h=null,this.i=!1,this.g=null}j(V){this.h=arguments,this.g?this.i=!0:Nt(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wi(R){$e.call(this),this.h=R,this.g={}}H(Wi,$e);var bs=[];function Ls(R){be(R.g,function(V,X){this.g.hasOwnProperty(X)&&We(V)},R),R.g={}}Wi.prototype.N=function(){Wi.aa.N.call(this),Ls(this)},Wi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ci=E.JSON.stringify,Sa=E.JSON.parse,Mc=class{stringify(R){return E.JSON.stringify(R,void 0)}parse(R){return E.JSON.parse(R,void 0)}};function Xs(){}Xs.prototype.h=null;function Js(R){return R.h||(R.h=R.i())}function fl(){}var ws={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function za(){Ze.call(this,"d")}H(za,Ze);function Ko(){Ze.call(this,"c")}H(Ko,Ze);var Ha={},Uc=null;function cu(){return Uc=Uc||new Nn}Ha.La="serverreachability";function Ka(R){Ze.call(this,Ha.La,R)}H(Ka,Ze);function Vc(R){const V=cu();tn(V,new Ka(V))}Ha.STAT_EVENT="statevent";function mo(R,V){Ze.call(this,Ha.STAT_EVENT,R),this.stat=V}H(mo,Ze);function bi(R){const V=cu();tn(V,new mo(V,R))}Ha.Ma="timingevent";function Qi(R,V){Ze.call(this,Ha.Ma,R),this.size=V}H(Qi,Ze);function Ta(R,V){if(typeof R!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){R()},V)}function lu(){this.g=!0}lu.prototype.xa=function(){this.g=!1};function $a(R,V,X,de,je,Je){R.info(function(){if(R.g)if(Je)for(var It="",jr=Je.split("&"),ei=0;ei<jr.length;ei++){var fr=jr[ei].split("=");if(1<fr.length){var Cs=fr[0];fr=fr[1];var es=Cs.split("_");It=2<=es.length&&es[1]=="type"?It+(Cs+"="+fr+"&"):It+(Cs+"=redacted&")}}else It=null;else It=Je;return"XMLHTTP REQ ("+de+") [attempt "+je+"]: "+V+`
`+X+`
`+It})}function $o(R,V,X,de,je,Je,It){R.info(function(){return"XMLHTTP RESP ("+de+") [ attempt "+je+"]: "+V+`
`+X+`
`+Je+" "+It})}function qo(R,V,X,de){R.info(function(){return"XMLHTTP TEXT ("+V+"): "+Xm(R,X)+(de?" "+de:"")})}function sd(R,V){R.info(function(){return"TIMEOUT: "+V})}lu.prototype.info=function(){};function Xm(R,V){if(!R.g)return V;if(!V)return null;try{var X=JSON.parse(V);if(X){for(R=0;R<X.length;R++)if(Array.isArray(X[R])){var de=X[R];if(!(2>de.length)){var je=de[1];if(Array.isArray(je)&&!(1>je.length)){var Je=je[0];if(Je!="noop"&&Je!="stop"&&Je!="close")for(var It=1;It<je.length;It++)je[It]=""}}}}return ci(X)}catch{return V}}var uu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ah={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Rs;function du(){}H(du,Xs),du.prototype.g=function(){return new XMLHttpRequest},du.prototype.i=function(){return{}},Rs=new du;function Yo(R,V,X,de){this.j=R,this.i=V,this.l=X,this.R=de||1,this.U=new Wi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new od}function od(){this.i=null,this.g="",this.h=!1}var ad={},ba={};function cd(R,V,X){R.L=1,R.v=Ra(_o(V)),R.m=X,R.P=!0,hu(R,null)}function hu(R,V){R.F=Date.now(),xr(R),R.A=_o(R.v);var X=R.A,de=R.R;Array.isArray(de)||(de=[String(de)]),yl(X.i,"t",de),R.C=0,X=R.j.J,R.h=new od,R.g=oE(R.j,X?V:null,!R.m),0<R.O&&(R.M=new Zt(k(R.Y,R,R.g),R.O)),V=R.U,X=R.g,de=R.ca;var je="readystatechange";Array.isArray(je)||(je&&(bs[0]=je.toString()),je=bs);for(var Je=0;Je<je.length;Je++){var It=Qn(X,je[Je],de||V.handleEvent,!1,V.h||V);if(!It)break;V.g[It.key]=It}V=R.H?ne(R.H):{},R.m?(R.u||(R.u="POST"),V["Content-Type"]="application/x-www-form-urlencoded",R.g.ea(R.A,R.u,R.m,V)):(R.u="GET",R.g.ea(R.A,R.u,null,V)),Vc(),$a(R.i,R.u,R.A,R.l,R.R,R.m)}Yo.prototype.ca=function(R){R=R.target;const V=this.M;V&&ui(R)==3?V.j():this.Y(R)},Yo.prototype.Y=function(R){try{if(R==this.g)e:{const es=ui(this.g);var V=this.g.Ba();const Ca=this.g.Z();if(!(3>es)&&(es!=3||this.g&&(this.h.h||this.g.oa()||fs(this.g)))){this.J||es!=4||V==7||(V==8||0>=Ca?Vc(3):Vc(2)),qa(this);var X=this.g.Z();this.X=X;t:if(go(this)){var de=fs(this.g);R="";var je=de.length,Je=ui(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Xo(this),Fc(this);var It="";break t}this.h.i=new E.TextDecoder}for(V=0;V<je;V++)this.h.h=!0,R+=this.h.i.decode(de[V],{stream:!(Je&&V==je-1)});de.length=0,this.h.g+=R,this.C=0,It=this.h.g}else It=this.g.oa();if(this.o=X==200,$o(this.i,this.u,this.A,this.l,this.R,es,X),this.o){if(this.T&&!this.K){t:{if(this.g){var jr,ei=this.g;if((jr=ei.g?ei.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!J(jr)){var fr=jr;break t}}fr=null}if(X=fr)qo(this.i,this.l,X,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Oh(this,X);else{this.o=!1,this.s=3,bi(12),Xo(this),Fc(this);break e}}if(this.P){X=!0;let Io;for(;!this.J&&this.C<It.length;)if(Io=ld(this,It),Io==ba){es==4&&(this.s=4,bi(14),X=!1),qo(this.i,this.l,null,"[Incomplete Response]");break}else if(Io==ad){this.s=4,bi(15),qo(this.i,this.l,It,"[Invalid Chunk]"),X=!1;break}else qo(this.i,this.l,Io,null),Oh(this,Io);if(go(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),es!=4||It.length!=0||this.h.h||(this.s=1,bi(16),X=!1),this.o=this.o&&X,!X)qo(this.i,this.l,It,"[Invalid Chunked Response]"),Xo(this),Fc(this);else if(0<It.length&&!this.W){this.W=!0;var Cs=this.j;Cs.g==this&&Cs.ba&&!Cs.M&&(Cs.j.info("Great, no buffering proxy detected. Bytes received: "+It.length),Qm(Cs),Cs.M=!0,bi(11))}}else qo(this.i,this.l,It,null),Oh(this,It);es==4&&Xo(this),this.o&&!this.J&&(es==4?hf(this.j,this):(this.o=!1,xr(this)))}else bo(this.g),X==400&&0<It.indexOf("Unknown SID")?(this.s=3,bi(12)):(this.s=0,bi(13)),Xo(this),Fc(this)}}}catch{}finally{}};function go(R){return R.g?R.u=="GET"&&R.L!=2&&R.j.Ca:!1}function ld(R,V){var X=R.C,de=V.indexOf(`
`,X);return de==-1?ba:(X=Number(V.substring(X,de)),isNaN(X)?ad:(de+=1,de+X>V.length?ba:(V=V.slice(de,de+X),R.C=de+X,V)))}Yo.prototype.cancel=function(){this.J=!0,Xo(this)};function xr(R){R.S=Date.now()+R.I,li(R,R.I)}function li(R,V){if(R.B!=null)throw Error("WatchDog timer not null");R.B=Ta(k(R.ba,R),V)}function qa(R){R.B&&(E.clearTimeout(R.B),R.B=null)}Yo.prototype.ba=function(){this.B=null;const R=Date.now();0<=R-this.S?(sd(this.i,this.A),this.L!=2&&(Vc(),bi(17)),Xo(this),this.s=2,Fc(this)):li(this,this.S-R)};function Fc(R){R.j.G==0||R.J||hf(R.j,R)}function Xo(R){qa(R);var V=R.M;V&&typeof V.ma=="function"&&V.ma(),R.M=null,Ls(R.U),R.g&&(V=R.g,R.g=null,V.abort(),V.ma())}function Oh(R,V){try{var X=R.j;if(X.G!=0&&(X.g==R||xs(X.h,R))){if(!R.K&&xs(X.h,R)&&X.G==3){try{var de=X.Da.g.parse(V)}catch{de=null}if(Array.isArray(de)&&de.length==3){var je=de;if(je[0]==0){e:if(!X.u){if(X.g)if(X.g.F+3e3<R.F)df(X),zc(X);else break e;uf(X),bi(18)}}else X.za=je[1],0<X.za-X.T&&37500>je[2]&&X.F&&X.v==0&&!X.C&&(X.C=Ta(k(X.Za,X),6e3));if(1>=rf(X.h)&&X.ca){try{X.ca()}catch{}X.ca=void 0}}else vu(X,11)}else if((R.K||X.g==R)&&df(X),!J(V))for(je=X.Da.g.parse(V),V=0;V<je.length;V++){let fr=je[V];if(X.T=fr[0],fr=fr[1],X.G==2)if(fr[0]=="c"){X.K=fr[1],X.ia=fr[2];const Cs=fr[3];Cs!=null&&(X.la=Cs,X.j.info("VER="+X.la));const es=fr[4];es!=null&&(X.Aa=es,X.j.info("SVER="+X.Aa));const Ca=fr[5];Ca!=null&&typeof Ca=="number"&&0<Ca&&(de=1.5*Ca,X.L=de,X.j.info("backChannelRequestTimeoutMs_="+de)),de=X;const Io=R.g;if(Io){const Lh=Io.g?Io.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Lh){var Je=de.h;Je.g||Lh.indexOf("spdy")==-1&&Lh.indexOf("quic")==-1&&Lh.indexOf("h2")==-1||(Je.j=Je.l,Je.g=new Set,Je.h&&(Ph(Je,Je.h),Je.h=null))}if(de.D){const ff=Io.g?Io.g.getResponseHeader("X-HTTP-Session-Id"):null;ff&&(de.ya=ff,Fr(de.I,de.D,ff))}}X.G=3,X.l&&X.l.ua(),X.ba&&(X.R=Date.now()-R.F,X.j.info("Handshake RTT: "+X.R+"ms")),de=X;var It=R;if(de.qa=Zm(de,de.J?de.ia:null,de.W),It.K){jc(de.h,It);var jr=It,ei=de.L;ei&&(jr.I=ei),jr.B&&(qa(jr),xr(jr)),de.g=It}else Tl(de);0<X.i.length&&Ja(X)}else fr[0]!="stop"&&fr[0]!="close"||vu(X,7);else X.G==3&&(fr[0]=="stop"||fr[0]=="close"?fr[0]=="stop"?vu(X,7):xi(X):fr[0]!="noop"&&X.l&&X.l.ta(fr),X.v=0)}}Vc(4)}catch{}}var ud=class{constructor(R,V){this.g=R,this.map=V}};function ml(R){this.l=R||10,E.PerformanceNavigationTiming?(R=E.performance.getEntriesByType("navigation"),R=0<R.length&&(R[0].nextHopProtocol=="hq"||R[0].nextHopProtocol=="h2")):R=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=R?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qs(R){return R.h?!0:R.g?R.g.size>=R.j:!1}function rf(R){return R.h?1:R.g?R.g.size:0}function xs(R,V){return R.h?R.h==V:R.g?R.g.has(V):!1}function Ph(R,V){R.g?R.g.add(V):R.h=V}function jc(R,V){R.h&&R.h==V?R.h=null:R.g&&R.g.has(V)&&R.g.delete(V)}ml.prototype.cancel=function(){if(this.i=dd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const R of this.g.values())R.cancel();this.g.clear()}};function dd(R){if(R.h!=null)return R.i.concat(R.h.D);if(R.g!=null&&R.g.size!==0){let V=R.i;for(const X of R.g.values())V=V.concat(X.D);return V}return K(R.i)}function hd(R){if(R.V&&typeof R.V=="function")return R.V();if(typeof Map<"u"&&R instanceof Map||typeof Set<"u"&&R instanceof Set)return Array.from(R.values());if(typeof R=="string")return R.split("");if(S(R)){for(var V=[],X=R.length,de=0;de<X;de++)V.push(R[de]);return V}V=[],X=0;for(de in R)V[X++]=R[de];return V}function ar(R){if(R.na&&typeof R.na=="function")return R.na();if(!R.V||typeof R.V!="function"){if(typeof Map<"u"&&R instanceof Map)return Array.from(R.keys());if(!(typeof Set<"u"&&R instanceof Set)){if(S(R)||typeof R=="string"){var V=[];R=R.length;for(var X=0;X<R;X++)V.push(X);return V}V=[],X=0;for(const de in R)V[X++]=de;return V}}}function gl(R,V){if(R.forEach&&typeof R.forEach=="function")R.forEach(V,void 0);else if(S(R)||typeof R=="string")Array.prototype.forEach.call(R,V,void 0);else for(var X=ar(R),de=hd(R),je=de.length,Je=0;Je<je;Je++)V.call(void 0,de[Je],X&&X[Je],R)}var _l=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pu(R,V){if(R){R=R.split("&");for(var X=0;X<R.length;X++){var de=R[X].indexOf("="),je=null;if(0<=de){var Je=R[X].substring(0,de);je=R[X].substring(de+1)}else Je=R[X];V(Je,je?decodeURIComponent(je.replace(/\+/g," ")):"")}}}function wa(R){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,R instanceof wa){this.h=R.h,fu(this,R.j),this.o=R.o,this.g=R.g,Bc(this,R.s),this.l=R.l;var V=R.i,X=new Eo;X.i=V.i,V.g&&(X.g=new Map(V.g),X.h=V.h),El(this,X),this.m=R.m}else R&&(V=String(R).match(_l))?(this.h=!1,fu(this,V[1]||"",!0),this.o=Zn(V[2]||""),this.g=Zn(V[3]||"",!0),Bc(this,V[4]),this.l=Zn(V[5]||"",!0),El(this,V[6]||"",!0),this.m=Zn(V[7]||"")):(this.h=!1,this.i=new Eo(null,this.h))}wa.prototype.toString=function(){var R=[],V=this.j;V&&R.push(Ya(V,vl,!0),":");var X=this.g;return(X||V=="file")&&(R.push("//"),(V=this.o)&&R.push(Ya(V,vl,!0),"@"),R.push(encodeURIComponent(String(X)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),X=this.s,X!=null&&R.push(":",String(X))),(X=this.l)&&(this.g&&X.charAt(0)!="/"&&R.push("/"),R.push(Ya(X,X.charAt(0)=="/"?Nh:pd,!0))),(X=this.i.toString())&&R.push("?",X),(X=this.m)&&R.push("#",Ya(X,kh)),R.join("")};function _o(R){return new wa(R)}function fu(R,V,X){R.j=X?Zn(V,!0):V,R.j&&(R.j=R.j.replace(/:$/,""))}function Bc(R,V){if(V){if(V=Number(V),isNaN(V)||0>V)throw Error("Bad port number "+V);R.s=V}else R.s=null}function El(R,V,X){V instanceof Eo?(R.i=V,To(R.i,R.h)):(X||(V=Ya(V,of)),R.i=new Eo(V,R.h))}function Fr(R,V,X){R.i.set(V,X)}function Ra(R){return Fr(R,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),R}function Zn(R,V){return R?V?decodeURI(R.replace(/%25/g,"%2525")):decodeURIComponent(R):""}function Ya(R,V,X){return typeof R=="string"?(R=encodeURI(R).replace(V,sf),X&&(R=R.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R):null}function sf(R){return R=R.charCodeAt(0),"%"+(R>>4&15).toString(16)+(R&15).toString(16)}var vl=/[#\/\?@]/g,pd=/[#\?:]/g,Nh=/[#\?]/g,of=/[#\?@]/g,kh=/#/g;function Eo(R,V){this.h=this.g=null,this.i=R||null,this.j=!!V}function Gi(R){R.g||(R.g=new Map,R.h=0,R.i&&pu(R.i,function(V,X){R.add(decodeURIComponent(V.replace(/\+/g," ")),X)}))}r=Eo.prototype,r.add=function(R,V){Gi(this),this.i=null,R=So(this,R);var X=this.g.get(R);return X||this.g.set(R,X=[]),X.push(V),this.h+=1,this};function vo(R,V){Gi(R),V=So(R,V),R.g.has(V)&&(R.i=null,R.h-=R.g.get(V).length,R.g.delete(V))}function yo(R,V){return Gi(R),V=So(R,V),R.g.has(V)}r.forEach=function(R,V){Gi(this),this.g.forEach(function(X,de){X.forEach(function(je){R.call(V,je,de,this)},this)},this)},r.na=function(){Gi(this);const R=Array.from(this.g.values()),V=Array.from(this.g.keys()),X=[];for(let de=0;de<V.length;de++){const je=R[de];for(let Je=0;Je<je.length;Je++)X.push(V[de])}return X},r.V=function(R){Gi(this);let V=[];if(typeof R=="string")yo(this,R)&&(V=V.concat(this.g.get(So(this,R))));else{R=Array.from(this.g.values());for(let X=0;X<R.length;X++)V=V.concat(R[X])}return V},r.set=function(R,V){return Gi(this),this.i=null,R=So(this,R),yo(this,R)&&(this.h-=this.g.get(R).length),this.g.set(R,[V]),this.h+=1,this},r.get=function(R,V){return R?(R=this.V(R),0<R.length?String(R[0]):V):V};function yl(R,V,X){vo(R,V),0<X.length&&(R.i=null,R.g.set(So(R,V),K(X)),R.h+=X.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const R=[],V=Array.from(this.g.keys());for(var X=0;X<V.length;X++){var de=V[X];const Je=encodeURIComponent(String(de)),It=this.V(de);for(de=0;de<It.length;de++){var je=Je;It[de]!==""&&(je+="="+encodeURIComponent(String(It[de]))),R.push(je)}}return this.i=R.join("&")};function So(R,V){return V=String(V),R.j&&(V=V.toLowerCase()),V}function To(R,V){V&&!R.j&&(Gi(R),R.i=null,R.g.forEach(function(X,de){var je=de.toLowerCase();de!=je&&(vo(this,de),yl(this,je,X))},R)),R.j=V}function af(R,V){const X=new lu;if(E.Image){const de=new Image;de.onload=W(Zi,X,"TestLoadImage: loaded",!0,V,de),de.onerror=W(Zi,X,"TestLoadImage: error",!1,V,de),de.onabort=W(Zi,X,"TestLoadImage: abort",!1,V,de),de.ontimeout=W(Zi,X,"TestLoadImage: timeout",!1,V,de),E.setTimeout(function(){de.ontimeout&&de.ontimeout()},1e4),de.src=R}else V(!1)}function Xa(R,V){const X=new lu,de=new AbortController,je=setTimeout(()=>{de.abort(),Zi(X,"TestPingServer: timeout",!1,V)},1e4);fetch(R,{signal:de.signal}).then(Je=>{clearTimeout(je),Je.ok?Zi(X,"TestPingServer: ok",!0,V):Zi(X,"TestPingServer: server error",!1,V)}).catch(()=>{clearTimeout(je),Zi(X,"TestPingServer: error",!1,V)})}function Zi(R,V,X,de,je){try{je&&(je.onload=null,je.onerror=null,je.onabort=null,je.ontimeout=null),de(X)}catch{}}function mu(){this.g=new Mc}function Dh(R,V,X){const de=X||"";try{gl(R,function(je,Je){let It=je;b(je)&&(It=ci(je)),V.push(de+Je+"="+encodeURIComponent(It))})}catch(je){throw V.push(de+"type="+encodeURIComponent("_badmap")),je}}function Wc(R){this.l=R.Ub||null,this.j=R.eb||!1}H(Wc,Xs),Wc.prototype.g=function(){return new Sl(this.l,this.j)},Wc.prototype.i=function(R){return function(){return R}}({});function Sl(R,V){Nn.call(this),this.D=R,this.o=V,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}H(Sl,Nn),r=Sl.prototype,r.open=function(R,V){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=R,this.A=V,this.readyState=1,Qo(this)},r.send=function(R){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const V={headers:this.u,method:this.B,credentials:this.m,cache:void 0};R&&(V.body=R),(this.D||E).fetch(new Request(this.A,V)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Jo(this)),this.readyState=0},r.Sa=function(R){if(this.g&&(this.l=R,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=R.headers,this.readyState=2,Qo(this)),this.g&&(this.readyState=3,Qo(this),this.g)))if(this.responseType==="arraybuffer")R.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in R){if(this.j=R.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cf(this)}else R.text().then(this.Ra.bind(this),this.ga.bind(this))};function cf(R){R.j.read().then(R.Pa.bind(R)).catch(R.ga.bind(R))}r.Pa=function(R){if(this.g){if(this.o&&R.value)this.response.push(R.value);else if(!this.o){var V=R.value?R.value:new Uint8Array(0);(V=this.v.decode(V,{stream:!R.done}))&&(this.response=this.responseText+=V)}R.done?Jo(this):Qo(this),this.readyState==3&&cf(this)}},r.Ra=function(R){this.g&&(this.response=this.responseText=R,Jo(this))},r.Qa=function(R){this.g&&(this.response=R,Jo(this))},r.ga=function(){this.g&&Jo(this)};function Jo(R){R.readyState=4,R.l=null,R.j=null,R.v=null,Qo(R)}r.setRequestHeader=function(R,V){this.u.append(R,V)},r.getResponseHeader=function(R){return this.h&&this.h.get(R.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const R=[],V=this.h.entries();for(var X=V.next();!X.done;)X=X.value,R.push(X[0]+": "+X[1]),X=V.next();return R.join(`\r
`)};function Qo(R){R.onreadystatechange&&R.onreadystatechange.call(R)}Object.defineProperty(Sl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(R){this.m=R?"include":"same-origin"}});function Gc(R){let V="";return be(R,function(X,de){V+=de,V+=":",V+=X,V+=`\r
`}),V}function _e(R,V,X){e:{for(de in X){var de=!1;break e}de=!0}de||(X=Gc(X),typeof R=="string"?X!=null&&encodeURIComponent(String(X)):Fr(R,V,X))}function Re(R){Nn.call(this),this.headers=new Map,this.o=R||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}H(Re,Nn);var Ke=/^https?$/i,jt=["POST","PUT"];r=Re.prototype,r.Ha=function(R){this.J=R},r.ea=function(R,V,X,de){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+R);V=V?V.toUpperCase():"GET",this.D=R,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Rs.g(),this.v=this.o?Js(this.o):Js(Rs),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(V,String(R),!0),this.B=!1}catch(Je){Bn(this,Je);return}if(R=X||"",X=new Map(this.headers),de)if(Object.getPrototypeOf(de)===Object.prototype)for(var je in de)X.set(je,de[je]);else if(typeof de.keys=="function"&&typeof de.get=="function")for(const Je of de.keys())X.set(Je,de.get(Je));else throw Error("Unknown input type for opt_headers: "+String(de));de=Array.from(X.keys()).find(Je=>Je.toLowerCase()=="content-type"),je=E.FormData&&R instanceof E.FormData,!(0<=Array.prototype.indexOf.call(jt,V,void 0))||de||je||X.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Je,It]of X)this.g.setRequestHeader(Je,It);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Or(this),this.u=!0,this.g.send(R),this.u=!1}catch(Je){Bn(this,Je)}};function Bn(R,V){R.h=!1,R.g&&(R.j=!0,R.g.abort(),R.j=!1),R.l=V,R.m=5,pr(R),en(R)}function pr(R){R.A||(R.A=!0,tn(R,"complete"),tn(R,"error"))}r.abort=function(R){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=R||7,tn(this,"complete"),tn(this,"abort"),en(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),en(this,!0)),Re.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Mr(this):this.bb())},r.bb=function(){Mr(this)};function Mr(R){if(R.h&&typeof g<"u"&&(!R.v[1]||ui(R)!=4||R.Z()!=2)){if(R.u&&ui(R)==4)Ga(R.Ea,0,R);else if(tn(R,"readystatechange"),ui(R)==4){R.h=!1;try{const It=R.Z();e:switch(It){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var V=!0;break e;default:V=!1}var X;if(!(X=V)){var de;if(de=It===0){var je=String(R.D).match(_l)[1]||null;!je&&E.self&&E.self.location&&(je=E.self.location.protocol.slice(0,-1)),de=!Ke.test(je?je.toLowerCase():"")}X=de}if(X)tn(R,"complete"),tn(R,"success");else{R.m=6;try{var Je=2<ui(R)?R.g.statusText:""}catch{Je=""}R.l=Je+" ["+R.Z()+"]",pr(R)}}finally{en(R)}}}}function en(R,V){if(R.g){Or(R);const X=R.g,de=R.v[0]?()=>{}:null;R.g=null,R.v=null,V||tn(R,"ready");try{X.onreadystatechange=de}catch{}}}function Or(R){R.I&&(E.clearTimeout(R.I),R.I=null)}r.isActive=function(){return!!this.g};function ui(R){return R.g?R.g.readyState:0}r.Z=function(){try{return 2<ui(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(R){if(this.g){var V=this.g.responseText;return R&&V.indexOf(R)==0&&(V=V.substring(R.length)),Sa(V)}};function fs(R){try{if(!R.g)return null;if("response"in R.g)return R.g.response;switch(R.H){case"":case"text":return R.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in R.g)return R.g.mozResponseArrayBuffer}return null}catch{return null}}function bo(R){const V={};R=(R.g&&2<=ui(R)&&R.g.getAllResponseHeaders()||"").split(`\r
`);for(let de=0;de<R.length;de++){if(J(R[de]))continue;var X=Ee(R[de]);const je=X[0];if(X=X[1],typeof X!="string")continue;X=X.trim();const Je=V[je]||[];V[je]=Je,Je.push(X)}Z(V,function(de){return de.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function wo(R,V,X){return X&&X.internalChannelParams&&X.internalChannelParams[R]||V}function gu(R){this.Aa=0,this.i=[],this.j=new lu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=wo("failFast",!1,R),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=wo("baseRetryDelayMs",5e3,R),this.cb=wo("retryDelaySeedMs",1e4,R),this.Wa=wo("forwardChannelMaxRetries",2,R),this.wa=wo("forwardChannelRequestTimeoutMs",2e4,R),this.pa=R&&R.xmlHttpFactory||void 0,this.Xa=R&&R.Tb||void 0,this.Ca=R&&R.useFetchStreams||!1,this.L=void 0,this.J=R&&R.supportsCrossDomainXhr||!1,this.K="",this.h=new ml(R&&R.concurrentRequestLimit),this.Da=new mu,this.P=R&&R.fastHandshake||!1,this.O=R&&R.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=R&&R.Rb||!1,R&&R.xa&&this.j.xa(),R&&R.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&R&&R.detectBufferingProxy||!1,this.ja=void 0,R&&R.longPollingTimeout&&0<R.longPollingTimeout&&(this.ja=R.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=gu.prototype,r.la=8,r.G=1,r.connect=function(R,V,X,de){bi(0),this.W=R,this.H=V||{},X&&de!==void 0&&(this.H.OSID=X,this.H.OAID=de),this.F=this.X,this.I=Zm(this,null,this.W),Ja(this)};function xi(R){if(fd(R),R.G==3){var V=R.U++,X=_o(R.I);if(Fr(X,"SID",R.K),Fr(X,"RID",V),Fr(X,"TYPE","terminate"),_u(R,X),V=new Yo(R,R.j,V),V.L=2,V.v=Ra(_o(X)),X=!1,E.navigator&&E.navigator.sendBeacon)try{X=E.navigator.sendBeacon(V.v.toString(),"")}catch{}!X&&E.Image&&(new Image().src=V.v,X=!0),X||(V.g=oE(V.j,null),V.g.ea(V.v)),V.F=Date.now(),xr(V)}yu(R)}function zc(R){R.g&&(Qm(R),R.g.cancel(),R.g=null)}function fd(R){zc(R),R.u&&(E.clearTimeout(R.u),R.u=null),df(R),R.h.cancel(),R.s&&(typeof R.s=="number"&&E.clearTimeout(R.s),R.s=null)}function Ja(R){if(!Qs(R.h)&&!R.s){R.s=!0;var V=R.Ga;Oe||it(),Ue||(Oe(),Ue=!0),xe.add(V,R),R.B=0}}function Jm(R,V){return rf(R.h)>=R.h.j-(R.s?1:0)?!1:R.s?(R.i=V.D.concat(R.i),!0):R.G==1||R.G==2||R.B>=(R.Va?0:R.Wa)?!1:(R.s=Ta(k(R.Ga,R,V),Eu(R,R.B)),R.B++,!0)}r.Ga=function(R){if(this.s)if(this.s=null,this.G==1){if(!R){this.U=Math.floor(1e5*Math.random()),R=this.U++;const je=new Yo(this,this.j,R);let Je=this.o;if(this.S&&(Je?(Je=ne(Je),ue(Je,this.S)):Je=this.S),this.m!==null||this.O||(je.H=Je,Je=null),this.P)e:{for(var V=0,X=0;X<this.i.length;X++){t:{var de=this.i[X];if("__data__"in de.map&&(de=de.map.__data__,typeof de=="string")){de=de.length;break t}de=void 0}if(de===void 0)break;if(V+=de,4096<V){V=X;break e}if(V===4096||X===this.i.length-1){V=X+1;break e}}V=1e3}else V=1e3;V=Ro(this,je,V),X=_o(this.I),Fr(X,"RID",R),Fr(X,"CVER",22),this.D&&Fr(X,"X-HTTP-Session-Id",this.D),_u(this,X),Je&&(this.O?V="headers="+encodeURIComponent(String(Gc(Je)))+"&"+V:this.m&&_e(X,this.m,Je)),Ph(this.h,je),this.Ua&&Fr(X,"TYPE","init"),this.P?(Fr(X,"$req",V),Fr(X,"SID","null"),je.T=!0,cd(je,X,null)):cd(je,X,V),this.G=2}}else this.G==3&&(R?lf(this,R):this.i.length==0||Qs(this.h)||lf(this))};function lf(R,V){var X;V?X=V.l:X=R.U++;const de=_o(R.I);Fr(de,"SID",R.K),Fr(de,"RID",X),Fr(de,"AID",R.T),_u(R,de),R.m&&R.o&&_e(de,R.m,R.o),X=new Yo(R,R.j,X,R.B+1),R.m===null&&(X.H=R.o),V&&(R.i=V.D.concat(R.i)),V=Ro(R,X,1e3),X.I=Math.round(.5*R.wa)+Math.round(.5*R.wa*Math.random()),Ph(R.h,X),cd(X,de,V)}function _u(R,V){R.H&&be(R.H,function(X,de){Fr(V,de,X)}),R.l&&gl({},function(X,de){Fr(V,de,X)})}function Ro(R,V,X){X=Math.min(R.i.length,X);var de=R.l?k(R.l.Na,R.l,R):null;e:{var je=R.i;let Je=-1;for(;;){const It=["count="+X];Je==-1?0<X?(Je=je[0].g,It.push("ofs="+Je)):Je=0:It.push("ofs="+Je);let jr=!0;for(let ei=0;ei<X;ei++){let fr=je[ei].g;const Cs=je[ei].map;if(fr-=Je,0>fr)Je=Math.max(0,je[ei].g-100),jr=!1;else try{Dh(Cs,It,"req"+fr+"_")}catch{de&&de(Cs)}}if(jr){de=It.join("&");break e}}}return R=R.i.splice(0,X),V.D=R,de}function Tl(R){if(!R.g&&!R.u){R.Y=1;var V=R.Fa;Oe||it(),Ue||(Oe(),Ue=!0),xe.add(V,R),R.v=0}}function uf(R){return R.g||R.u||3<=R.v?!1:(R.Y++,R.u=Ta(k(R.Fa,R),Eu(R,R.v)),R.v++,!0)}r.Fa=function(){if(this.u=null,sE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var R=2*this.R;this.j.info("BP detection timer enabled: "+R),this.A=Ta(k(this.ab,this),R)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,bi(10),zc(this),sE(this))};function Qm(R){R.A!=null&&(E.clearTimeout(R.A),R.A=null)}function sE(R){R.g=new Yo(R,R.j,"rpc",R.Y),R.m===null&&(R.g.H=R.o),R.g.O=0;var V=_o(R.qa);Fr(V,"RID","rpc"),Fr(V,"SID",R.K),Fr(V,"AID",R.T),Fr(V,"CI",R.F?"0":"1"),!R.F&&R.ja&&Fr(V,"TO",R.ja),Fr(V,"TYPE","xmlhttp"),_u(R,V),R.m&&R.o&&_e(V,R.m,R.o),R.L&&(R.g.I=R.L);var X=R.g;R=R.ia,X.L=1,X.v=Ra(_o(V)),X.m=null,X.P=!0,hu(X,R)}r.Za=function(){this.C!=null&&(this.C=null,zc(this),uf(this),bi(19))};function df(R){R.C!=null&&(E.clearTimeout(R.C),R.C=null)}function hf(R,V){var X=null;if(R.g==V){df(R),Qm(R),R.g=null;var de=2}else if(xs(R.h,V))X=V.D,jc(R.h,V),de=1;else return;if(R.G!=0){if(V.o)if(de==1){X=V.m?V.m.length:0,V=Date.now()-V.F;var je=R.B;de=cu(),tn(de,new Qi(de,X)),Ja(R)}else Tl(R);else if(je=V.s,je==3||je==0&&0<V.X||!(de==1&&Jm(R,V)||de==2&&uf(R)))switch(X&&0<X.length&&(V=R.h,V.i=V.i.concat(X)),je){case 1:vu(R,5);break;case 4:vu(R,10);break;case 3:vu(R,6);break;default:vu(R,2)}}}function Eu(R,V){let X=R.Ta+Math.floor(Math.random()*R.cb);return R.isActive()||(X*=2),X*V}function vu(R,V){if(R.j.info("Error code "+V),V==2){var X=k(R.fb,R),de=R.Xa;const je=!de;de=new wa(de||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||fu(de,"https"),Ra(de),je?af(de.toString(),X):Xa(de.toString(),X)}else bi(2);R.G=0,R.l&&R.l.sa(V),yu(R),fd(R)}r.fb=function(R){R?(this.j.info("Successfully pinged google.com"),bi(2)):(this.j.info("Failed to ping google.com"),bi(1))};function yu(R){if(R.G=0,R.ka=[],R.l){const V=dd(R.h);(V.length!=0||R.i.length!=0)&&(G(R.ka,V),G(R.ka,R.i),R.h.i.length=0,K(R.i),R.i.length=0),R.l.ra()}}function Zm(R,V,X){var de=X instanceof wa?_o(X):new wa(X);if(de.g!="")V&&(de.g=V+"."+de.g),Bc(de,de.s);else{var je=E.location;de=je.protocol,V=V?V+"."+je.hostname:je.hostname,je=+je.port;var Je=new wa(null);de&&fu(Je,de),V&&(Je.g=V),je&&Bc(Je,je),X&&(Je.l=X),de=Je}return X=R.D,V=R.ya,X&&V&&Fr(de,X,V),Fr(de,"VER",R.la),_u(R,de),de}function oE(R,V,X){if(V&&!R.J)throw Error("Can't create secondary domain capable XhrIo object.");return V=R.Ca&&!R.pa?new Re(new Wc({eb:X})):new Re(R.pa),V.Ha(R.J),V}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function kn(){}r=kn.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function pf(){}pf.prototype.g=function(R,V){return new Co(R,V)};function Co(R,V){Nn.call(this),this.g=new gu(V),this.l=R,this.h=V&&V.messageUrlParams||null,R=V&&V.messageHeaders||null,V&&V.clientProtocolHeaderRequired&&(R?R["X-Client-Protocol"]="webchannel":R={"X-Client-Protocol":"webchannel"}),this.g.o=R,R=V&&V.initMessageHeaders||null,V&&V.messageContentType&&(R?R["X-WebChannel-Content-Type"]=V.messageContentType:R={"X-WebChannel-Content-Type":V.messageContentType}),V&&V.va&&(R?R["X-WebChannel-Client-Profile"]=V.va:R={"X-WebChannel-Client-Profile":V.va}),this.g.S=R,(R=V&&V.Sb)&&!J(R)&&(this.g.m=R),this.v=V&&V.supportsCrossDomainXhr||!1,this.u=V&&V.sendRawJson||!1,(V=V&&V.httpSessionIdParam)&&!J(V)&&(this.g.D=V,R=this.h,R!==null&&V in R&&(R=this.h,V in R&&delete R[V])),this.j=new Qa(this)}H(Co,Nn),Co.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Co.prototype.close=function(){xi(this.g)},Co.prototype.o=function(R){var V=this.g;if(typeof R=="string"){var X={};X.__data__=R,R=X}else this.u&&(X={},X.__data__=ci(R),R=X);V.i.push(new ud(V.Ya++,R)),V.G==3&&Ja(V)},Co.prototype.N=function(){this.g.l=null,delete this.j,xi(this.g),delete this.g,Co.aa.N.call(this)};function aE(R){za.call(this),R.__headers__&&(this.headers=R.__headers__,this.statusCode=R.__status__,delete R.__headers__,delete R.__status__);var V=R.__sm__;if(V){e:{for(const X in V){R=X;break e}R=void 0}(this.i=R)&&(R=this.i,V=V!==null&&R in V?V[R]:void 0),this.data=V}else this.data=R}H(aE,za);function cE(){Ko.call(this),this.status=1}H(cE,Ko);function Qa(R){this.g=R}H(Qa,kn),Qa.prototype.ua=function(){tn(this.g,"a")},Qa.prototype.ta=function(R){tn(this.g,new aE(R))},Qa.prototype.sa=function(R){tn(this.g,new cE)},Qa.prototype.ra=function(){tn(this.g,"b")},pf.prototype.createWebChannel=pf.prototype.g,Co.prototype.send=Co.prototype.o,Co.prototype.open=Co.prototype.m,Co.prototype.close=Co.prototype.close,Cte=function(){return new pf},Rte=function(){return cu()},wte=Ha,X2={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},uu.NO_ERROR=0,uu.TIMEOUT=8,uu.HTTP_ERROR=6,nP=uu,Ah.COMPLETE="complete",bte=Ah,fl.EventType=ws,ws.OPEN="a",ws.CLOSE="b",ws.ERROR="c",ws.MESSAGE="d",Nn.prototype.listen=Nn.prototype.K,Fb=fl,Re.prototype.listenOnce=Re.prototype.L,Re.prototype.getLastError=Re.prototype.Ka,Re.prototype.getLastErrorCode=Re.prototype.Ba,Re.prototype.getStatus=Re.prototype.Z,Re.prototype.getResponseJson=Re.prototype.Oa,Re.prototype.getResponseText=Re.prototype.oa,Re.prototype.send=Re.prototype.ea,Re.prototype.setWithCredentials=Re.prototype.Ha,Tte=Re}).apply(typeof bO<"u"?bO:typeof self<"u"?self:typeof window<"u"?window:{});const v7="@firebase/firestore",y7="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}_a.UNAUTHENTICATED=new _a(null),_a.GOOGLE_CREDENTIALS=new _a("google-credentials-uid"),_a.FIRST_PARTY=new _a("first-party-uid"),_a.MOCK_USER=new _a("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FS="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J_=new XV("@firebase/firestore");function Oy(){return J_.logLevel}function zt(r,...t){if(J_.logLevel<=_r.DEBUG){const s=t.map(aF);J_.debug(`Firestore (${FS}): ${r}`,...s)}}function $p(r,...t){if(J_.logLevel<=_r.ERROR){const s=t.map(aF);J_.error(`Firestore (${FS}): ${r}`,...s)}}function SS(r,...t){if(J_.logLevel<=_r.WARN){const s=t.map(aF);J_.warn(`Firestore (${FS}): ${r}`,...s)}}function aF(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(r="Unexpected state"){const t=`FIRESTORE (${FS}) INTERNAL ASSERTION FAILED: `+r;throw $p(t),new Error(t)}function Zr(r,t){r||Mn()}function zn(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const St={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rn extends Ih{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ite{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class pUe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(_a.UNAUTHENTICATED))}shutdown(){}}class fUe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class mUe{constructor(t){this.t=t,this.currentUser=_a.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){Zr(this.o===void 0);let a=this.i;const l=S=>this.i!==a?(a=this.i,s(S)):Promise.resolve();let d=new jp;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new jp,t.enqueueRetryable(()=>l(this.currentUser))};const g=()=>{const S=d;t.enqueueRetryable(async()=>{await S.promise,await l(this.currentUser)})},E=S=>{zt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=S,this.o&&(this.auth.addAuthTokenListener(this.o),g())};this.t.onInit(S=>E(S)),setTimeout(()=>{if(!this.auth){const S=this.t.getImmediate({optional:!0});S?E(S):(zt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new jp)}},0),g()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(zt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(Zr(typeof a.accessToken=="string"),new Ite(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Zr(t===null||typeof t=="string"),new _a(t)}}class gUe{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=_a.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class _Ue{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new gUe(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(_a.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class S7{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class EUe{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,sl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){Zr(this.o===void 0);const a=d=>{d.error!=null&&zt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const g=d.token!==this.R;return this.R=d.token,zt("FirebaseAppCheckTokenProvider",`Received ${g?"new":"existing"} token.`),g?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{zt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):zt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new S7(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(Zr(typeof s.token=="string"),this.R=s.token,new S7(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vUe(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<r;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ate{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=vUe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function wr(r,t){return r<t?-1:r>t?1:0}function TS(r,t,s){return r.length===t.length&&r.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T7=-62135596800,b7=1e6;class $s{static now(){return $s.fromMillis(Date.now())}static fromDate(t){return $s.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*b7);return new $s(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new rn(St.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new rn(St.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<T7)throw new rn(St.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new rn(St.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/b7}_compareTo(t){return this.seconds===t.seconds?wr(this.nanoseconds,t.nanoseconds):wr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-T7;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{static fromTimestamp(t){return new jn(t)}static min(){return new jn(new $s(0,0))}static max(){return new jn(new $s(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w7="__name__";class nh{constructor(t,s,a){s===void 0?s=0:s>t.length&&Mn(),a===void 0?a=t.length-s:a>t.length-s&&Mn(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return nh.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof nh?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=nh.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return Math.sign(t.length-s.length)}static compareSegments(t,s){const a=nh.isNumericId(t),l=nh.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?nh.extractNumericId(t).compare(nh.extractNumericId(s)):t<s?-1:t>s?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Im.fromString(t.substring(4,t.length-2))}}class Bi extends nh{construct(t,s,a){return new Bi(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new rn(St.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new Bi(s)}static emptyPath(){return new Bi([])}}const yUe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class zo extends nh{construct(t,s,a){return new zo(t,s,a)}static isValidIdentifier(t){return yUe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),zo.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===w7}static keyField(){return new zo([w7])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new rn(St.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let g=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new rn(St.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const S=t[l+1];if(S!=="\\"&&S!=="."&&S!=="`")throw new rn(St.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=S,l+=2}else E==="`"?(g=!g,l++):E!=="."||g?(a+=E,l++):(d(),l++)}if(d(),g)throw new rn(St.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new zo(s)}static emptyPath(){return new zo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(t){this.path=t}static fromPath(t){return new bn(Bi.fromString(t))}static fromName(t){return new bn(Bi.fromString(t).popFirst(5))}static empty(){return new bn(Bi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Bi.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return Bi.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new bn(new Bi(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nw=-1;function SUe(r,t){const s=r.toTimestamp().seconds,a=r.toTimestamp().nanoseconds+1,l=jn.fromTimestamp(a===1e9?new $s(s+1,0):new $s(s,a));return new Lm(l,bn.empty(),t)}function TUe(r){return new Lm(r.readTime,r.key,Nw)}class Lm{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new Lm(jn.min(),bn.empty(),Nw)}static max(){return new Lm(jn.max(),bn.empty(),Nw)}}function bUe(r,t){let s=r.readTime.compareTo(t.readTime);return s!==0?s:(s=bn.comparator(r.documentKey,t.documentKey),s!==0?s:wr(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wUe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class RUe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jS(r){if(r.code!==St.FAILED_PRECONDITION||r.message!==wUe)throw r;zt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&Mn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new gt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof gt?s:gt.resolve(s)}catch(s){return gt.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):gt.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):gt.reject(s)}static resolve(t){return new gt((s,a)=>{s(t)})}static reject(t){return new gt((s,a)=>{a(t)})}static waitFor(t){return new gt((s,a)=>{let l=0,d=0,g=!1;t.forEach(E=>{++l,E.next(()=>{++d,g&&d===l&&s()},S=>a(S))}),g=!0,d===l&&s()})}static or(t){let s=gt.resolve(!1);for(const a of t)s=s.next(l=>l?gt.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new gt((a,l)=>{const d=t.length,g=new Array(d);let E=0;for(let S=0;S<d;S++){const b=S;s(t[b]).next(C=>{g[b]=C,++E,E===d&&a(g)},C=>l(C))}})}static doWhile(t,s){return new gt((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function CUe(r){const t=r.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function BS(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}ON.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cF=-1;function PN(r){return r==null}function LP(r){return r===0&&1/r==-1/0}function IUe(r){return typeof r=="number"&&Number.isInteger(r)&&!LP(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ote="";function AUe(r){let t="";for(let s=0;s<r.length;s++)t.length>0&&(t=R7(t)),t=OUe(r.get(s),t);return R7(t)}function OUe(r,t){let s=t;const a=r.length;for(let l=0;l<a;l++){const d=r.charAt(l);switch(d){case"\0":s+="";break;case Ote:s+="";break;default:s+=d}}return s}function R7(r){return r+Ote+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C7(r){let t=0;for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t++;return t}function $m(r,t){for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t(s,r[s])}function Pte(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(t,s){this.comparator=t,this.root=s||Wo.EMPTY}insert(t,s){return new Xi(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,Wo.BLACK,null,null))}remove(t){return new Xi(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Wo.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new wO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new wO(this.root,t,this.comparator,!1)}getReverseIterator(){return new wO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new wO(this.root,t,this.comparator,!0)}}class wO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Wo{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??Wo.RED,this.left=l??Wo.EMPTY,this.right=d??Wo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new Wo(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Wo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return Wo.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Wo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Wo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Mn();const t=this.left.check();if(t!==this.right.check())throw Mn();return t+(this.isRed()?0:1)}}Wo.EMPTY=null,Wo.RED=!0,Wo.BLACK=!1;Wo.EMPTY=new class{constructor(){this.size=0}get key(){throw Mn()}get value(){throw Mn()}get color(){throw Mn()}get left(){throw Mn()}get right(){throw Mn()}copy(t,s,a,l,d){return this}insert(t,s,a){return new Wo(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(t){this.comparator=t,this.data=new Xi(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new I7(this.data.getIterator())}getIteratorFrom(t){return new I7(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof qs)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new qs(this.comparator);return s.data=t,s}}class I7{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(t){this.fields=t,t.sort(zo.comparator)}static empty(){return new al([])}unionWith(t){let s=new qs(zo.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new al(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return TS(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nte extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Nte("Invalid base64 string: "+d):d}}(t);return new Ho(s)}static fromUint8Array(t){const s=function(l){let d="";for(let g=0;g<l.length;++g)d+=String.fromCharCode(l[g]);return d}(t);return new Ho(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return wr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ho.EMPTY_BYTE_STRING=new Ho("");const PUe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xm(r){if(Zr(!!r),typeof r=="string"){let t=0;const s=PUe.exec(r);if(Zr(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(r);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:ys(r.seconds),nanos:ys(r.nanos)}}function ys(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Mm(r){return typeof r=="string"?Ho.fromBase64String(r):Ho.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kte="server_timestamp",Dte="__type__",Lte="__previous_value__",xte="__local_write_time__";function lF(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{})[Dte])===null||s===void 0?void 0:s.stringValue)===kte}function NN(r){const t=r.mapValue.fields[Lte];return lF(t)?NN(t):t}function kw(r){const t=xm(r.mapValue.fields[xte].timestampValue);return new $s(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NUe{constructor(t,s,a,l,d,g,E,S,b){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=g,this.autoDetectLongPolling=E,this.longPollingOptions=S,this.useFetchStreams=b}}const xP="(default)";class Dw{constructor(t,s){this.projectId=t,this.database=s||xP}static empty(){return new Dw("","")}get isDefaultDatabase(){return this.database===xP}isEqual(t){return t instanceof Dw&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mte="__type__",kUe="__max__",RO={mapValue:{}},Ute="__vector__",MP="value";function Um(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?lF(r)?4:LUe(r)?9007199254740991:DUe(r)?10:11:Mn()}function wh(r,t){if(r===t)return!0;const s=Um(r);if(s!==Um(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return kw(r).isEqual(kw(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const g=xm(l.timestampValue),E=xm(d.timestampValue);return g.seconds===E.seconds&&g.nanos===E.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(l,d){return Mm(l.bytesValue).isEqual(Mm(d.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(l,d){return ys(l.geoPointValue.latitude)===ys(d.geoPointValue.latitude)&&ys(l.geoPointValue.longitude)===ys(d.geoPointValue.longitude)}(r,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return ys(l.integerValue)===ys(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const g=ys(l.doubleValue),E=ys(d.doubleValue);return g===E?LP(g)===LP(E):isNaN(g)&&isNaN(E)}return!1}(r,t);case 9:return TS(r.arrayValue.values||[],t.arrayValue.values||[],wh);case 10:case 11:return function(l,d){const g=l.mapValue.fields||{},E=d.mapValue.fields||{};if(C7(g)!==C7(E))return!1;for(const S in g)if(g.hasOwnProperty(S)&&(E[S]===void 0||!wh(g[S],E[S])))return!1;return!0}(r,t);default:return Mn()}}function Lw(r,t){return(r.values||[]).find(s=>wh(s,t))!==void 0}function bS(r,t){if(r===t)return 0;const s=Um(r),a=Um(t);if(s!==a)return wr(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return wr(r.booleanValue,t.booleanValue);case 2:return function(d,g){const E=ys(d.integerValue||d.doubleValue),S=ys(g.integerValue||g.doubleValue);return E<S?-1:E>S?1:E===S?0:isNaN(E)?isNaN(S)?0:-1:1}(r,t);case 3:return A7(r.timestampValue,t.timestampValue);case 4:return A7(kw(r),kw(t));case 5:return wr(r.stringValue,t.stringValue);case 6:return function(d,g){const E=Mm(d),S=Mm(g);return E.compareTo(S)}(r.bytesValue,t.bytesValue);case 7:return function(d,g){const E=d.split("/"),S=g.split("/");for(let b=0;b<E.length&&b<S.length;b++){const C=wr(E[b],S[b]);if(C!==0)return C}return wr(E.length,S.length)}(r.referenceValue,t.referenceValue);case 8:return function(d,g){const E=wr(ys(d.latitude),ys(g.latitude));return E!==0?E:wr(ys(d.longitude),ys(g.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return O7(r.arrayValue,t.arrayValue);case 10:return function(d,g){var E,S,b,C;const O=d.fields||{},k=g.fields||{},W=(E=O[MP])===null||E===void 0?void 0:E.arrayValue,H=(S=k[MP])===null||S===void 0?void 0:S.arrayValue,K=wr(((b=W==null?void 0:W.values)===null||b===void 0?void 0:b.length)||0,((C=H==null?void 0:H.values)===null||C===void 0?void 0:C.length)||0);return K!==0?K:O7(W,H)}(r.mapValue,t.mapValue);case 11:return function(d,g){if(d===RO.mapValue&&g===RO.mapValue)return 0;if(d===RO.mapValue)return 1;if(g===RO.mapValue)return-1;const E=d.fields||{},S=Object.keys(E),b=g.fields||{},C=Object.keys(b);S.sort(),C.sort();for(let O=0;O<S.length&&O<C.length;++O){const k=wr(S[O],C[O]);if(k!==0)return k;const W=bS(E[S[O]],b[C[O]]);if(W!==0)return W}return wr(S.length,C.length)}(r.mapValue,t.mapValue);default:throw Mn()}}function A7(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return wr(r,t);const s=xm(r),a=xm(t),l=wr(s.seconds,a.seconds);return l!==0?l:wr(s.nanos,a.nanos)}function O7(r,t){const s=r.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=bS(s[l],a[l]);if(d)return d}return wr(s.length,a.length)}function wS(r){return J2(r)}function J2(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(s){const a=xm(s);return`time(${a.seconds},${a.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(s){return Mm(s).toBase64()}(r.bytesValue):"referenceValue"in r?function(s){return bn.fromName(s).toString()}(r.referenceValue):"geoPointValue"in r?function(s){return`geo(${s.latitude},${s.longitude})`}(r.geoPointValue):"arrayValue"in r?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=J2(d);return a+"]"}(r.arrayValue):"mapValue"in r?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const g of a)d?d=!1:l+=",",l+=`${g}:${J2(s.fields[g])}`;return l+"}"}(r.mapValue):Mn()}function rP(r){switch(Um(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=NN(r);return t?16+rP(t):16;case 5:return 2*r.stringValue.length;case 6:return Mm(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+rP(d),0)}(r.arrayValue);case 10:case 11:return function(a){let l=0;return $m(a.fields,(d,g)=>{l+=d.length+rP(g)}),l}(r.mapValue);default:throw Mn()}}function Q2(r){return!!r&&"integerValue"in r}function uF(r){return!!r&&"arrayValue"in r}function P7(r){return!!r&&"nullValue"in r}function N7(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function iP(r){return!!r&&"mapValue"in r}function DUe(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{})[Mte])===null||s===void 0?void 0:s.stringValue)===Ute}function sw(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return $m(r.mapValue.fields,(s,a)=>t.mapValue.fields[s]=sw(a)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(r.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=sw(r.arrayValue.values[s]);return t}return Object.assign({},r)}function LUe(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===kUe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(t){this.value=t}static empty(){return new Ac({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!iP(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=sw(s)}setAll(t){let s=zo.emptyPath(),a={},l=[];t.forEach((g,E)=>{if(!s.isImmediateParentOf(E)){const S=this.getFieldsMap(s);this.applyChanges(S,a,l),a={},l=[],s=E.popLast()}g?a[E.lastSegment()]=sw(g):l.push(E.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());iP(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return wh(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];iP(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){$m(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new Ac(sw(this.value))}}function Vte(r){const t=[];return $m(r.fields,(s,a)=>{const l=new zo([s]);if(iP(a)){const d=Vte(a.mapValue).fields;if(d.length===0)t.push(l);else for(const g of d)t.push(l.child(g))}else t.push(l)}),new al(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(t,s,a,l,d,g,E){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=g,this.documentState=E}static newInvalidDocument(t){return new Ea(t,0,jn.min(),jn.min(),jn.min(),Ac.empty(),0)}static newFoundDocument(t,s,a,l){return new Ea(t,1,s,jn.min(),a,l,0)}static newNoDocument(t,s){return new Ea(t,2,s,jn.min(),jn.min(),Ac.empty(),0)}static newUnknownDocument(t,s){return new Ea(t,3,s,jn.min(),jn.min(),Ac.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual(jn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ac.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ac.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=jn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Ea&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ea(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(t,s){this.position=t,this.inclusive=s}}function k7(r,t,s){let a=0;for(let l=0;l<r.position.length;l++){const d=t[l],g=r.position[l];if(d.field.isKeyField()?a=bn.comparator(bn.fromName(g.referenceValue),s.key):a=bS(g,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function D7(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let s=0;s<r.position.length;s++)if(!wh(r.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(t,s="asc"){this.field=t,this.dir=s}}function xUe(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fte{}class Ks extends Fte{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new UUe(t,s,a):s==="array-contains"?new jUe(t,a):s==="in"?new BUe(t,a):s==="not-in"?new WUe(t,a):s==="array-contains-any"?new GUe(t,a):new Ks(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new VUe(t,a):new FUe(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(bS(s,this.value)):s!==null&&Um(this.value)===Um(s)&&this.matchesComparison(bS(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Mn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Rh extends Fte{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new Rh(t,s)}matches(t){return jte(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function jte(r){return r.op==="and"}function Bte(r){return MUe(r)&&jte(r)}function MUe(r){for(const t of r.filters)if(t instanceof Rh)return!1;return!0}function Z2(r){if(r instanceof Ks)return r.field.canonicalString()+r.op.toString()+wS(r.value);if(Bte(r))return r.filters.map(t=>Z2(t)).join(",");{const t=r.filters.map(s=>Z2(s)).join(",");return`${r.op}(${t})`}}function Wte(r,t){return r instanceof Ks?function(a,l){return l instanceof Ks&&a.op===l.op&&a.field.isEqual(l.field)&&wh(a.value,l.value)}(r,t):r instanceof Rh?function(a,l){return l instanceof Rh&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,g,E)=>d&&Wte(g,l.filters[E]),!0):!1}(r,t):void Mn()}function Gte(r){return r instanceof Ks?function(s){return`${s.field.canonicalString()} ${s.op} ${wS(s.value)}`}(r):r instanceof Rh?function(s){return s.op.toString()+" {"+s.getFilters().map(Gte).join(" ,")+"}"}(r):"Filter"}class UUe extends Ks{constructor(t,s,a){super(t,s,a),this.key=bn.fromName(a.referenceValue)}matches(t){const s=bn.comparator(t.key,this.key);return this.matchesComparison(s)}}class VUe extends Ks{constructor(t,s){super(t,"in",s),this.keys=zte("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class FUe extends Ks{constructor(t,s){super(t,"not-in",s),this.keys=zte("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function zte(r,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>bn.fromName(a.referenceValue))}class jUe extends Ks{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return uF(s)&&Lw(s.arrayValue,this.value)}}class BUe extends Ks{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&Lw(this.value.arrayValue,s)}}class WUe extends Ks{constructor(t,s){super(t,"not-in",s)}matches(t){if(Lw(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!Lw(this.value.arrayValue,s)}}class GUe extends Ks{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!uF(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>Lw(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zUe{constructor(t,s=null,a=[],l=[],d=null,g=null,E=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=g,this.endAt=E,this.le=null}}function L7(r,t=null,s=[],a=[],l=null,d=null,g=null){return new zUe(r,t,s,a,l,d,g)}function dF(r){const t=zn(r);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>Z2(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),PN(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>wS(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>wS(a)).join(",")),t.le=s}return t.le}function hF(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<r.orderBy.length;s++)if(!xUe(r.orderBy[s],t.orderBy[s]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let s=0;s<r.filters.length;s++)if(!Wte(r.filters[s],t.filters[s]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!D7(r.startAt,t.startAt)&&D7(r.endAt,t.endAt)}function eU(r){return bn.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(t,s=null,a=[],l=[],d=null,g="F",E=null,S=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=g,this.startAt=E,this.endAt=S,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function HUe(r,t,s,a,l,d,g,E){return new kN(r,t,s,a,l,d,g,E)}function pF(r){return new kN(r)}function x7(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function KUe(r){return r.collectionGroup!==null}function ow(r){const t=zn(r);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(g){let E=new qs(zo.comparator);return g.filters.forEach(S=>{S.getFlattenedFilters().forEach(b=>{b.isInequality()&&(E=E.add(b.field))})}),E})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new VP(d,a))}),s.has(zo.keyField().canonicalString())||t.he.push(new VP(zo.keyField(),a))}return t.he}function vh(r){const t=zn(r);return t.Pe||(t.Pe=$Ue(t,ow(r))),t.Pe}function $Ue(r,t){if(r.limitType==="F")return L7(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new VP(l.field,d)});const s=r.endAt?new UP(r.endAt.position,r.endAt.inclusive):null,a=r.startAt?new UP(r.startAt.position,r.startAt.inclusive):null;return L7(r.path,r.collectionGroup,t,r.filters,r.limit,s,a)}}function tU(r,t,s){return new kN(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,s,r.startAt,r.endAt)}function DN(r,t){return hF(vh(r),vh(t))&&r.limitType===t.limitType}function Hte(r){return`${dF(vh(r))}|lt:${r.limitType}`}function Py(r){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>Gte(l)).join(", ")}]`),PN(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(g){return`${g.field.canonicalString()} (${g.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>wS(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>wS(l)).join(",")),`Target(${a})`}(vh(r))}; limitType=${r.limitType})`}function LN(r,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):bn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(r,t)&&function(a,l){for(const d of ow(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(r,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(r,t)&&function(a,l){return!(a.startAt&&!function(g,E,S){const b=k7(g,E,S);return g.inclusive?b<=0:b<0}(a.startAt,ow(a),l)||a.endAt&&!function(g,E,S){const b=k7(g,E,S);return g.inclusive?b>=0:b>0}(a.endAt,ow(a),l))}(r,t)}function qUe(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Kte(r){return(t,s)=>{let a=!1;for(const l of ow(r)){const d=YUe(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function YUe(r,t,s){const a=r.field.isKeyField()?bn.comparator(t.key,s.key):function(d,g,E){const S=g.data.field(d),b=E.data.field(d);return S!==null&&b!==null?bS(S,b):Mn()}(r.field,t,s);switch(r.dir){case"asc":return a;case"desc":return-1*a;default:return Mn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){$m(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return Pte(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XUe=new Xi(bn.comparator);function qp(){return XUe}const $te=new Xi(bn.comparator);function jb(...r){let t=$te;for(const s of r)t=t.insert(s.key,s);return t}function qte(r){let t=$te;return r.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function O_(){return aw()}function Yte(){return aw()}function aw(){return new rE(r=>r.toString(),(r,t)=>r.isEqual(t))}const JUe=new Xi(bn.comparator),QUe=new qs(bn.comparator);function Er(...r){let t=QUe;for(const s of r)t=t.add(s);return t}const ZUe=new qs(wr);function eVe(){return ZUe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fF(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:LP(t)?"-0":t}}function Xte(r){return{integerValue:""+r}}function tVe(r,t){return IUe(t)?Xte(t):fF(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(){this._=void 0}}function nVe(r,t,s){return r instanceof FP?function(l,d){const g={fields:{[Dte]:{stringValue:kte},[xte]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&lF(d)&&(d=NN(d)),d&&(g.fields[Lte]=d),{mapValue:g}}(s,t):r instanceof xw?Qte(r,t):r instanceof Mw?Zte(r,t):function(l,d){const g=Jte(l,d),E=M7(g)+M7(l.Ie);return Q2(g)&&Q2(l.Ie)?Xte(E):fF(l.serializer,E)}(r,t)}function rVe(r,t,s){return r instanceof xw?Qte(r,t):r instanceof Mw?Zte(r,t):s}function Jte(r,t){return r instanceof jP?function(a){return Q2(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class FP extends xN{}class xw extends xN{constructor(t){super(),this.elements=t}}function Qte(r,t){const s=ene(t);for(const a of r.elements)s.some(l=>wh(l,a))||s.push(a);return{arrayValue:{values:s}}}class Mw extends xN{constructor(t){super(),this.elements=t}}function Zte(r,t){let s=ene(t);for(const a of r.elements)s=s.filter(l=>!wh(l,a));return{arrayValue:{values:s}}}class jP extends xN{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function M7(r){return ys(r.integerValue||r.doubleValue)}function ene(r){return uF(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function iVe(r,t){return r.field.isEqual(t.field)&&function(a,l){return a instanceof xw&&l instanceof xw||a instanceof Mw&&l instanceof Mw?TS(a.elements,l.elements,wh):a instanceof jP&&l instanceof jP?wh(a.Ie,l.Ie):a instanceof FP&&l instanceof FP}(r.transform,t.transform)}class sVe{constructor(t,s){this.version=t,this.transformResults=s}}class yh{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new yh}static exists(t){return new yh(void 0,t)}static updateTime(t){return new yh(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function sP(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class MN{}function tne(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new rne(r.key,yh.none()):new lR(r.key,r.data,yh.none());{const s=r.data,a=Ac.empty();let l=new qs(zo.comparator);for(let d of t.fields)if(!l.has(d)){let g=s.field(d);g===null&&d.length>1&&(d=d.popLast(),g=s.field(d)),g===null?a.delete(d):a.set(d,g),l=l.add(d)}return new qm(r.key,a,new al(l.toArray()),yh.none())}}function oVe(r,t,s){r instanceof lR?function(l,d,g){const E=l.value.clone(),S=V7(l.fieldTransforms,d,g.transformResults);E.setAll(S),d.convertToFoundDocument(g.version,E).setHasCommittedMutations()}(r,t,s):r instanceof qm?function(l,d,g){if(!sP(l.precondition,d))return void d.convertToUnknownDocument(g.version);const E=V7(l.fieldTransforms,d,g.transformResults),S=d.data;S.setAll(nne(l)),S.setAll(E),d.convertToFoundDocument(g.version,S).setHasCommittedMutations()}(r,t,s):function(l,d,g){d.convertToNoDocument(g.version).setHasCommittedMutations()}(0,t,s)}function cw(r,t,s,a){return r instanceof lR?function(d,g,E,S){if(!sP(d.precondition,g))return E;const b=d.value.clone(),C=F7(d.fieldTransforms,S,g);return b.setAll(C),g.convertToFoundDocument(g.version,b).setHasLocalMutations(),null}(r,t,s,a):r instanceof qm?function(d,g,E,S){if(!sP(d.precondition,g))return E;const b=F7(d.fieldTransforms,S,g),C=g.data;return C.setAll(nne(d)),C.setAll(b),g.convertToFoundDocument(g.version,C).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(O=>O.field))}(r,t,s,a):function(d,g,E){return sP(d.precondition,g)?(g.convertToNoDocument(g.version).setHasLocalMutations(),null):E}(r,t,s)}function aVe(r,t){let s=null;for(const a of r.fieldTransforms){const l=t.data.field(a.field),d=Jte(a.transform,l||null);d!=null&&(s===null&&(s=Ac.empty()),s.set(a.field,d))}return s||null}function U7(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&TS(a,l,(d,g)=>iVe(d,g))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class lR extends MN{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class qm extends MN{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function nne(r){const t=new Map;return r.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=r.data.field(s);t.set(s,a)}}),t}function V7(r,t,s){const a=new Map;Zr(r.length===s.length);for(let l=0;l<s.length;l++){const d=r[l],g=d.transform,E=t.data.field(d.field);a.set(d.field,rVe(g,E,s[l]))}return a}function F7(r,t,s){const a=new Map;for(const l of r){const d=l.transform,g=s.data.field(l.field);a.set(l.field,nVe(d,g,t))}return a}class rne extends MN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cVe extends MN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lVe{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&oVe(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=cw(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=cw(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=Yte();return this.mutations.forEach(l=>{const d=t.get(l.key),g=d.overlayedDocument;let E=this.applyToLocalView(g,d.mutatedFields);E=s.has(l.key)?null:E;const S=tne(g,E);S!==null&&a.set(l.key,S),g.isValidDocument()||g.convertToNoDocument(jn.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),Er())}isEqual(t){return this.batchId===t.batchId&&TS(this.mutations,t.mutations,(s,a)=>U7(s,a))&&TS(this.baseMutations,t.baseMutations,(s,a)=>U7(s,a))}}class mF{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){Zr(t.mutations.length===a.length);let l=function(){return JUe}();const d=t.mutations;for(let g=0;g<d.length;g++)l=l.insert(d[g].key,a[g].version);return new mF(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uVe{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dVe{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Os,Ir;function hVe(r){switch(r){case St.OK:return Mn();case St.CANCELLED:case St.UNKNOWN:case St.DEADLINE_EXCEEDED:case St.RESOURCE_EXHAUSTED:case St.INTERNAL:case St.UNAVAILABLE:case St.UNAUTHENTICATED:return!1;case St.INVALID_ARGUMENT:case St.NOT_FOUND:case St.ALREADY_EXISTS:case St.PERMISSION_DENIED:case St.FAILED_PRECONDITION:case St.ABORTED:case St.OUT_OF_RANGE:case St.UNIMPLEMENTED:case St.DATA_LOSS:return!0;default:return Mn()}}function ine(r){if(r===void 0)return $p("GRPC error has no .code"),St.UNKNOWN;switch(r){case Os.OK:return St.OK;case Os.CANCELLED:return St.CANCELLED;case Os.UNKNOWN:return St.UNKNOWN;case Os.DEADLINE_EXCEEDED:return St.DEADLINE_EXCEEDED;case Os.RESOURCE_EXHAUSTED:return St.RESOURCE_EXHAUSTED;case Os.INTERNAL:return St.INTERNAL;case Os.UNAVAILABLE:return St.UNAVAILABLE;case Os.UNAUTHENTICATED:return St.UNAUTHENTICATED;case Os.INVALID_ARGUMENT:return St.INVALID_ARGUMENT;case Os.NOT_FOUND:return St.NOT_FOUND;case Os.ALREADY_EXISTS:return St.ALREADY_EXISTS;case Os.PERMISSION_DENIED:return St.PERMISSION_DENIED;case Os.FAILED_PRECONDITION:return St.FAILED_PRECONDITION;case Os.ABORTED:return St.ABORTED;case Os.OUT_OF_RANGE:return St.OUT_OF_RANGE;case Os.UNIMPLEMENTED:return St.UNIMPLEMENTED;case Os.DATA_LOSS:return St.DATA_LOSS;default:return Mn()}}(Ir=Os||(Os={}))[Ir.OK=0]="OK",Ir[Ir.CANCELLED=1]="CANCELLED",Ir[Ir.UNKNOWN=2]="UNKNOWN",Ir[Ir.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ir[Ir.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ir[Ir.NOT_FOUND=5]="NOT_FOUND",Ir[Ir.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ir[Ir.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ir[Ir.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ir[Ir.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ir[Ir.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ir[Ir.ABORTED=10]="ABORTED",Ir[Ir.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ir[Ir.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ir[Ir.INTERNAL=13]="INTERNAL",Ir[Ir.UNAVAILABLE=14]="UNAVAILABLE",Ir[Ir.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pVe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fVe=new Im([4294967295,4294967295],0);function j7(r){const t=pVe().encode(r),s=new Ste;return s.update(t),new Uint8Array(s.digest())}function B7(r){const t=new DataView(r.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new Im([s,a],0),new Im([l,d],0)]}class gF{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new Bb(`Invalid padding: ${s}`);if(a<0)throw new Bb(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new Bb(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new Bb(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=Im.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(Im.fromNumber(a)));return l.compare(fVe)===1&&(l=new Im([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=j7(t),[a,l]=B7(s);for(let d=0;d<this.hashCount;d++){const g=this.Ae(a,l,d);if(!this.Re(g))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),g=new gF(d,l,s);return a.forEach(E=>g.insert(E)),g}insert(t){if(this.Ee===0)return;const s=j7(t),[a,l]=B7(s);for(let d=0;d<this.hashCount;d++){const g=this.Ae(a,l,d);this.Ve(g)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class Bb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UN{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,uR.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new UN(jn.min(),l,new Xi(wr),qp(),Er())}}class uR{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new uR(a,s,Er(),Er(),Er())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class sne{constructor(t,s){this.targetId=t,this.ge=s}}class one{constructor(t,s,a=Ho.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class W7{constructor(){this.pe=0,this.ye=G7(),this.we=Ho.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.we=t)}Fe(){let t=Er(),s=Er(),a=Er();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:Mn()}}),new uR(this.we,this.be,t,s,a)}Me(){this.Se=!1,this.ye=G7()}xe(t,s){this.Se=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.Se=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,Zr(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class mVe{constructor(t){this.ke=t,this.qe=new Map,this.Qe=qp(),this.$e=CO(),this.Ke=CO(),this.Ue=new Xi(wr)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:Mn()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(eU(d))if(a===0){const g=new bn(d.path);this.ze(s,g,Ea.newNoDocument(g,jn.min()))}else Zr(a===1);else{const g=this.et(s);if(g!==a){const E=this.tt(t),S=E?this.nt(E,t,g):1;if(S!==0){this.Ye(s);const b=S===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(s,b)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let g,E;try{g=Mm(a).toUint8Array()}catch(S){if(S instanceof Nte)return SS("Decoding the base64 bloom filter in existence filter failed ("+S.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw S}try{E=new gF(g,l,d)}catch(S){return SS(S instanceof Bb?"BloomFilter error: ":"Applying bloom filter failed: ",S),null}return E.Ee===0?null:E}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const g=this.ke.it(),E=`projects/${g.projectId}/databases/${g.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,g)=>{const E=this.Xe(g);if(E){if(d.current&&eU(E.target)){const S=new bn(E.target.path);this._t(S).has(g)||this.ut(g,S)||this.ze(g,S,Ea.newNoDocument(S,t))}d.ve&&(s.set(g,d.Fe()),d.Me())}});let a=Er();this.Ke.forEach((d,g)=>{let E=!0;g.forEachWhile(S=>{const b=this.Xe(S);return!b||b.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.Qe.forEach((d,g)=>g.setReadTime(t));const l=new UN(t,s,this.Ue,this.Qe,a);return this.Qe=qp(),this.$e=CO(),this.Ke=CO(),this.Ue=new Xi(wr),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ke=this.Ke.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ke=this.Ke.insert(s,this.ct(s).delete(t)),this.Ke=this.Ke.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new W7,this.qe.set(t,s)),s}ct(t){let s=this.Ke.get(t);return s||(s=new qs(wr),this.Ke=this.Ke.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new qs(wr),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||zt("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new W7),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function CO(){return new Xi(bn.comparator)}function G7(){return new Xi(bn.comparator)}const gVe={asc:"ASCENDING",desc:"DESCENDING"},_Ve={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},EVe={and:"AND",or:"OR"};class vVe{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function nU(r,t){return r.useProto3Json||PN(t)?t:{value:t}}function BP(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ane(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function yVe(r,t){return BP(r,t.toTimestamp())}function Sh(r){return Zr(!!r),jn.fromTimestamp(function(s){const a=xm(s);return new $s(a.seconds,a.nanos)}(r))}function _F(r,t){return rU(r,t).canonicalString()}function rU(r,t){const s=function(l){return new Bi(["projects",l.projectId,"databases",l.database])}(r).child("documents");return t===void 0?s:s.child(t)}function cne(r){const t=Bi.fromString(r);return Zr(pne(t)),t}function iU(r,t){return _F(r.databaseId,t.path)}function NM(r,t){const s=cne(t);if(s.get(1)!==r.databaseId.projectId)throw new rn(St.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+r.databaseId.projectId);if(s.get(3)!==r.databaseId.database)throw new rn(St.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+r.databaseId.database);return new bn(une(s))}function lne(r,t){return _F(r.databaseId,t)}function SVe(r){const t=cne(r);return t.length===4?Bi.emptyPath():une(t)}function sU(r){return new Bi(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function une(r){return Zr(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function z7(r,t,s){return{name:iU(r,t),fields:s.value.mapValue.fields}}function TVe(r,t){let s;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Mn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,C){return b.useProto3Json?(Zr(C===void 0||typeof C=="string"),Ho.fromBase64String(C||"")):(Zr(C===void 0||C instanceof Buffer||C instanceof Uint8Array),Ho.fromUint8Array(C||new Uint8Array))}(r,t.targetChange.resumeToken),g=t.targetChange.cause,E=g&&function(b){const C=b.code===void 0?St.UNKNOWN:ine(b.code);return new rn(C,b.message||"")}(g);s=new one(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=NM(r,a.document.name),d=Sh(a.document.updateTime),g=a.document.createTime?Sh(a.document.createTime):jn.min(),E=new Ac({mapValue:{fields:a.document.fields}}),S=Ea.newFoundDocument(l,d,g,E),b=a.targetIds||[],C=a.removedTargetIds||[];s=new oP(b,C,S.key,S)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=NM(r,a.document),d=a.readTime?Sh(a.readTime):jn.min(),g=Ea.newNoDocument(l,d),E=a.removedTargetIds||[];s=new oP([],E,g.key,g)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=NM(r,a.document),d=a.removedTargetIds||[];s=new oP([],d,l,null)}else{if(!("filter"in t))return Mn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,g=new dVe(l,d),E=a.targetId;s=new sne(E,g)}}return s}function bVe(r,t){let s;if(t instanceof lR)s={update:z7(r,t.key,t.value)};else if(t instanceof rne)s={delete:iU(r,t.key)};else if(t instanceof qm)s={update:z7(r,t.key,t.data),updateMask:kVe(t.fieldMask)};else{if(!(t instanceof cVe))return Mn();s={verify:iU(r,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,g){const E=g.transform;if(E instanceof FP)return{fieldPath:g.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof xw)return{fieldPath:g.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof Mw)return{fieldPath:g.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof jP)return{fieldPath:g.field.canonicalString(),increment:E.Ie};throw Mn()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:yVe(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Mn()}(r,t.precondition)),s}function wVe(r,t){return r&&r.length>0?(Zr(t!==void 0),r.map(s=>function(l,d){let g=l.updateTime?Sh(l.updateTime):Sh(d);return g.isEqual(jn.min())&&(g=Sh(d)),new sVe(g,l.transformResults||[])}(s,t))):[]}function RVe(r,t){return{documents:[lne(r,t.path)]}}function CVe(r,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=lne(r,l);const d=function(b){if(b.length!==0)return hne(Rh.create(b,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const g=function(b){if(b.length!==0)return b.map(C=>function(k){return{field:Ny(k.field),direction:OVe(k.dir)}}(C))}(t.orderBy);g&&(s.structuredQuery.orderBy=g);const E=nU(r,t.limit);return E!==null&&(s.structuredQuery.limit=E),t.startAt&&(s.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{ht:s,parent:l}}function IVe(r){let t=SVe(r.parent);const s=r.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){Zr(a===1);const C=s.from[0];C.allDescendants?l=C.collectionId:t=t.child(C.collectionId)}let d=[];s.where&&(d=function(O){const k=dne(O);return k instanceof Rh&&Bte(k)?k.getFilters():[k]}(s.where));let g=[];s.orderBy&&(g=function(O){return O.map(k=>function(H){return new VP(ky(H.field),function(G){switch(G){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(H.direction))}(k))}(s.orderBy));let E=null;s.limit&&(E=function(O){let k;return k=typeof O=="object"?O.value:O,PN(k)?null:k}(s.limit));let S=null;s.startAt&&(S=function(O){const k=!!O.before,W=O.values||[];return new UP(W,k)}(s.startAt));let b=null;return s.endAt&&(b=function(O){const k=!O.before,W=O.values||[];return new UP(W,k)}(s.endAt)),HUe(t,l,g,d,E,"F",S,b)}function AVe(r,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Mn()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function dne(r){return r.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=ky(s.unaryFilter.field);return Ks.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=ky(s.unaryFilter.field);return Ks.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=ky(s.unaryFilter.field);return Ks.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const g=ky(s.unaryFilter.field);return Ks.create(g,"!=",{nullValue:"NULL_VALUE"});default:return Mn()}}(r):r.fieldFilter!==void 0?function(s){return Ks.create(ky(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Mn()}}(s.fieldFilter.op),s.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(s){return Rh.create(s.compositeFilter.filters.map(a=>dne(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Mn()}}(s.compositeFilter.op))}(r):Mn()}function OVe(r){return gVe[r]}function PVe(r){return _Ve[r]}function NVe(r){return EVe[r]}function Ny(r){return{fieldPath:r.canonicalString()}}function ky(r){return zo.fromServerFormat(r.fieldPath)}function hne(r){return r instanceof Ks?function(s){if(s.op==="=="){if(N7(s.value))return{unaryFilter:{field:Ny(s.field),op:"IS_NAN"}};if(P7(s.value))return{unaryFilter:{field:Ny(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(N7(s.value))return{unaryFilter:{field:Ny(s.field),op:"IS_NOT_NAN"}};if(P7(s.value))return{unaryFilter:{field:Ny(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ny(s.field),op:PVe(s.op),value:s.value}}}(r):r instanceof Rh?function(s){const a=s.getFilters().map(l=>hne(l));return a.length===1?a[0]:{compositeFilter:{op:NVe(s.op),filters:a}}}(r):Mn()}function kVe(r){const t=[];return r.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function pne(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bm{constructor(t,s,a,l,d=jn.min(),g=jn.min(),E=Ho.EMPTY_BYTE_STRING,S=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=g,this.resumeToken=E,this.expectedCount=S}withSequenceNumber(t){return new bm(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new bm(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new bm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new bm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DVe{constructor(t){this.Tt=t}}function LVe(r){const t=IVe({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?tU(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xVe{constructor(){this.Tn=new MVe}addToCollectionParentIndex(t,s){return this.Tn.add(s),gt.resolve()}getCollectionParents(t,s){return gt.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return gt.resolve()}deleteFieldIndex(t,s){return gt.resolve()}deleteAllFieldIndexes(t){return gt.resolve()}createTargetIndexes(t,s){return gt.resolve()}getDocumentsMatchingTarget(t,s){return gt.resolve(null)}getIndexType(t,s){return gt.resolve(0)}getFieldIndexes(t,s){return gt.resolve([])}getNextCollectionGroupToUpdate(t){return gt.resolve(null)}getMinOffset(t,s){return gt.resolve(Lm.min())}getMinOffsetFromCollectionGroup(t,s){return gt.resolve(Lm.min())}updateCollectionGroup(t,s,a){return gt.resolve()}updateIndexEntries(t,s){return gt.resolve()}}class MVe{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new qs(Bi.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new qs(Bi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H7={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},fne=41943040;class Cc{static withCacheSize(t){return new Cc(t,Cc.DEFAULT_COLLECTION_PERCENTILE,Cc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Cc.DEFAULT_COLLECTION_PERCENTILE=10,Cc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Cc.DEFAULT=new Cc(fne,Cc.DEFAULT_COLLECTION_PERCENTILE,Cc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Cc.DISABLED=new Cc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RS{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Kn(){return new RS(0)}static Un(){return new RS(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K7="LruGarbageCollector",UVe=1048576;function $7([r,t],[s,a]){const l=wr(r,s);return l===0?wr(t,a):l}class VVe{constructor(t){this.Hn=t,this.buffer=new qs($7),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();$7(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class FVe{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){zt(K7,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){BS(s)?zt(K7,"Ignoring IndexedDB error during garbage collection: ",s):await jS(s)}await this.er(3e5)})}}class jVe{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return gt.resolve(ON.ae);const a=new VVe(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(zt("LruGarbageCollector","Garbage collection skipped; disabled"),gt.resolve(H7)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(zt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),H7):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,g,E,S,b;const C=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(O=>(O>this.params.maximumSequenceNumbersToCollect?(zt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${O}`),l=this.params.maximumSequenceNumbersToCollect):l=O,g=Date.now(),this.nthSequenceNumber(t,l))).next(O=>(a=O,E=Date.now(),this.removeTargets(t,a,s))).next(O=>(d=O,S=Date.now(),this.removeOrphanedDocuments(t,a))).next(O=>(b=Date.now(),Oy()<=_r.DEBUG&&zt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${g-C}ms
	Determined least recently used ${l} in `+(E-g)+`ms
	Removed ${d} targets in `+(S-E)+`ms
	Removed ${O} documents in `+(b-S)+`ms
Total Duration: ${b-C}ms`),gt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:O})))}}function BVe(r,t){return new jVe(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WVe{constructor(){this.changes=new rE(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,Ea.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?gt.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GVe{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zVe{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&cw(a.mutation,l,al.empty(),$s.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,Er()).next(()=>a))}getLocalViewOfDocuments(t,s,a=Er()){const l=O_();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let g=jb();return d.forEach((E,S)=>{g=g.insert(E,S.overlayedDocument)}),g}))}getOverlayedDocuments(t,s){const a=O_();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,Er()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((g,E)=>{s.set(g,E)})})}computeViews(t,s,a,l){let d=qp();const g=aw(),E=function(){return aw()}();return s.forEach((S,b)=>{const C=a.get(b.key);l.has(b.key)&&(C===void 0||C.mutation instanceof qm)?d=d.insert(b.key,b):C!==void 0?(g.set(b.key,C.mutation.getFieldMask()),cw(C.mutation,b,C.mutation.getFieldMask(),$s.now())):g.set(b.key,al.empty())}),this.recalculateAndSaveOverlays(t,d).next(S=>(S.forEach((b,C)=>g.set(b,C)),s.forEach((b,C)=>{var O;return E.set(b,new GVe(C,(O=g.get(b))!==null&&O!==void 0?O:null))}),E))}recalculateAndSaveOverlays(t,s){const a=aw();let l=new Xi((g,E)=>g-E),d=Er();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(g=>{for(const E of g)E.keys().forEach(S=>{const b=s.get(S);if(b===null)return;let C=a.get(S)||al.empty();C=E.applyToLocalView(b,C),a.set(S,C);const O=(l.get(E.batchId)||Er()).add(S);l=l.insert(E.batchId,O)})}).next(()=>{const g=[],E=l.getReverseIterator();for(;E.hasNext();){const S=E.getNext(),b=S.key,C=S.value,O=Yte();C.forEach(k=>{if(!d.has(k)){const W=tne(s.get(k),a.get(k));W!==null&&O.set(k,W),d=d.add(k)}}),g.push(this.documentOverlayCache.saveOverlays(t,b,O))}return gt.waitFor(g)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(g){return bn.isDocumentKey(g.path)&&g.collectionGroup===null&&g.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):KUe(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const g=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):gt.resolve(O_());let E=Nw,S=d;return g.next(b=>gt.forEach(b,(C,O)=>(E<O.largestBatchId&&(E=O.largestBatchId),d.get(C)?gt.resolve():this.remoteDocumentCache.getEntry(t,C).next(k=>{S=S.insert(C,k)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,S,b,Er())).next(C=>({batchId:E,changes:qte(C)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new bn(s)).next(a=>{let l=jb();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let g=jb();return this.indexManager.getCollectionParents(t,d).next(E=>gt.forEach(E,S=>{const b=function(O,k){return new kN(k,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(s,S.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(C=>{C.forEach((O,k)=>{g=g.insert(O,k)})})}).next(()=>g))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(g=>(d=g,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(g=>{d.forEach((S,b)=>{const C=b.getKey();g.get(C)===null&&(g=g.insert(C,Ea.newInvalidDocument(C)))});let E=jb();return g.forEach((S,b)=>{const C=d.get(S);C!==void 0&&cw(C.mutation,b,al.empty(),$s.now()),LN(s,b)&&(E=E.insert(S,b))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HVe{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return gt.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:Sh(l.createTime)}}(s)),gt.resolve()}getNamedQuery(t,s){return gt.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:LVe(l.bundledQuery),readTime:Sh(l.readTime)}}(s)),gt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KVe{constructor(){this.overlays=new Xi(bn.comparator),this.Rr=new Map}getOverlay(t,s){return gt.resolve(this.overlays.get(s))}getOverlays(t,s){const a=O_();return gt.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),gt.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),gt.resolve()}getOverlaysForCollection(t,s,a){const l=O_(),d=s.length+1,g=new bn(s.child("")),E=this.overlays.getIteratorFrom(g);for(;E.hasNext();){const S=E.getNext().value,b=S.getKey();if(!s.isPrefixOf(b.path))break;b.path.length===d&&S.largestBatchId>a&&l.set(S.getKey(),S)}return gt.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new Xi((b,C)=>b-C);const g=this.overlays.getIterator();for(;g.hasNext();){const b=g.getNext().value;if(b.getKey().getCollectionGroup()===s&&b.largestBatchId>a){let C=d.get(b.largestBatchId);C===null&&(C=O_(),d=d.insert(b.largestBatchId,C)),C.set(b.getKey(),b)}}const E=O_(),S=d.getIterator();for(;S.hasNext()&&(S.getNext().value.forEach((b,C)=>E.set(b,C)),!(E.size()>=l)););return gt.resolve(E)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const g=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,g)}this.overlays=this.overlays.insert(a.key,new uVe(s,a));let d=this.Rr.get(s);d===void 0&&(d=Er(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Ve{constructor(){this.sessionToken=Ho.EMPTY_BYTE_STRING}getSessionToken(t){return gt.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,gt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(){this.Vr=new qs(ho.mr),this.gr=new qs(ho.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new ho(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new ho(t,s))}br(t,s){t.forEach(a=>this.removeReference(a,s))}Sr(t){const s=new bn(new Bi([])),a=new ho(s,t),l=new ho(s,t+1),d=[];return this.gr.forEachInRange([a,l],g=>{this.wr(g),d.push(g.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new bn(new Bi([])),a=new ho(s,t),l=new ho(s,t+1);let d=Er();return this.gr.forEachInRange([a,l],g=>{d=d.add(g.key)}),d}containsKey(t){const s=new ho(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class ho{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return bn.comparator(t.key,s.key)||wr(t.Cr,s.Cr)}static pr(t,s){return wr(t.Cr,s.Cr)||bn.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qVe{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new qs(ho.mr)}checkEmpty(t){return gt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const g=new lVe(d,s,a,l);this.mutationQueue.push(g);for(const E of l)this.Mr=this.Mr.add(new ho(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return gt.resolve(g)}lookupMutationBatch(t,s){return gt.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return gt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return gt.resolve(this.mutationQueue.length===0?cF:this.Fr-1)}getAllMutationBatches(t){return gt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new ho(s,0),l=new ho(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],g=>{const E=this.Or(g.Cr);d.push(E)}),gt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new qs(wr);return s.forEach(l=>{const d=new ho(l,0),g=new ho(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,g],E=>{a=a.add(E.Cr)})}),gt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;bn.isDocumentKey(d)||(d=d.child(""));const g=new ho(new bn(d),0);let E=new qs(wr);return this.Mr.forEachWhile(S=>{const b=S.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(E=E.add(S.Cr)),!0)},g),gt.resolve(this.Br(E))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){Zr(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return gt.forEach(s.mutations,l=>{const d=new ho(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new ho(s,0),l=this.Mr.firstAfterOrEqual(a);return gt.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,gt.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YVe{constructor(t){this.kr=t,this.docs=function(){return new Xi(bn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,g=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:g}),this.size+=g-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return gt.resolve(a?a.document.mutableCopy():Ea.newInvalidDocument(s))}getEntries(t,s){let a=qp();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Ea.newInvalidDocument(l))}),gt.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=qp();const g=s.path,E=new bn(g.child("__id-9223372036854775808__")),S=this.docs.getIteratorFrom(E);for(;S.hasNext();){const{key:b,value:{document:C}}=S.getNext();if(!g.isPrefixOf(b.path))break;b.path.length>g.length+1||bUe(TUe(C),a)<=0||(l.has(C.key)||LN(s,C))&&(d=d.insert(C.key,C.mutableCopy()))}return gt.resolve(d)}getAllFromCollectionGroup(t,s,a,l){Mn()}qr(t,s){return gt.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new XVe(this)}getSize(t){return gt.resolve(this.size)}}class XVe extends WVe{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),gt.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JVe{constructor(t){this.persistence=t,this.Qr=new rE(s=>dF(s),hF),this.lastRemoteSnapshotVersion=jn.min(),this.highestTargetId=0,this.$r=0,this.Kr=new EF,this.targetCount=0,this.Ur=RS.Kn()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),gt.resolve()}getLastRemoteSnapshotVersion(t){return gt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return gt.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Ur.next(),gt.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),gt.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Ur=new RS(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,gt.resolve()}updateTargetData(t,s){return this.zn(s),gt.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Kr.Sr(s.targetId),this.targetCount-=1,gt.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((g,E)=>{E.sequenceNumber<=s&&a.get(E.targetId)===null&&(this.Qr.delete(g),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),gt.waitFor(d).next(()=>l)}getTargetCount(t){return gt.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return gt.resolve(a)}addMatchingKeys(t,s,a){return this.Kr.yr(s,a),gt.resolve()}removeMatchingKeys(t,s,a){this.Kr.br(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(g=>{d.push(l.markPotentiallyOrphaned(t,g))}),gt.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Kr.Sr(s),gt.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Kr.vr(s);return gt.resolve(a)}containsKey(t,s){return gt.resolve(this.Kr.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mne{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new ON(0),this.zr=!1,this.zr=!0,this.jr=new $Ve,this.referenceDelegate=t(this),this.Hr=new JVe(this),this.indexManager=new xVe,this.remoteDocumentCache=function(l){return new YVe(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new DVe(s),this.Yr=new HVe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new KVe,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new qVe(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){zt("MemoryPersistence","Starting transaction:",t);const l=new QVe(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return gt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class QVe extends RUe{constructor(t){super(),this.currentSequenceNumber=t}}class vF{constructor(t){this.persistence=t,this.ti=new EF,this.ni=null}static ri(t){return new vF(t)}get ii(){if(this.ni)return this.ni;throw Mn()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),gt.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),gt.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),gt.resolve()}removeTarget(t,s){this.ti.Sr(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return gt.forEach(this.ii,a=>{const l=bn.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,jn.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return gt.or([()=>gt.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class WP{constructor(t,s){this.persistence=t,this.oi=new rE(a=>AUe(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=BVe(this,s)}static ri(t,s){return new WP(t,s)}Zr(){}Xr(t){return gt.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return gt.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?gt.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,g=>this.ar(t,g,s).next(E=>{E||(a++,d.removeEntry(g,jn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),gt.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),gt.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),gt.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),gt.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=rP(t.data.value)),s}ar(t,s,a){return gt.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return gt.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=Er(),l=Er();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new yF(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZVe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eFe{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return MLe()?8:CUe(ya())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(g=>{d.result=g}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(g=>{d.result=g})}).next(()=>{if(d.result)return;const g=new ZVe;return this._s(t,s,g).next(E=>{if(d.result=E,this.Xi)return this.us(t,s,g,E.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(Oy()<=_r.DEBUG&&zt("QueryEngine","SDK will not create cache indexes for query:",Py(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),gt.resolve()):(Oy()<=_r.DEBUG&&zt("QueryEngine","Query:",Py(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(Oy()<=_r.DEBUG&&zt("QueryEngine","The SDK decides to create cache indexes for query:",Py(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,vh(s))):gt.resolve())}rs(t,s){if(x7(s))return gt.resolve(null);let a=vh(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=tU(s,null,"F"),a=vh(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const g=Er(...d);return this.ns.getDocuments(t,g).next(E=>this.indexManager.getMinOffset(t,a).next(S=>{const b=this.cs(s,E);return this.ls(s,b,g,S.readTime)?this.rs(t,tU(s,null,"F")):this.hs(t,b,s,S)}))})))}ss(t,s,a,l){return x7(s)||l.isEqual(jn.min())?gt.resolve(null):this.ns.getDocuments(t,a).next(d=>{const g=this.cs(s,d);return this.ls(s,g,a,l)?gt.resolve(null):(Oy()<=_r.DEBUG&&zt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),Py(s)),this.hs(t,g,s,SUe(l,Nw)).next(E=>E))})}cs(t,s){let a=new qs(Kte(t));return s.forEach((l,d)=>{LN(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return Oy()<=_r.DEBUG&&zt("QueryEngine","Using full collection scan to execute query:",Py(s)),this.ns.getDocumentsMatchingQuery(t,s,Lm.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(g=>{d=d.insert(g.key,g)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SF="LocalStore",tFe=3e8;class nFe{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new Xi(wr),this.Is=new rE(d=>dF(d),hF),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new zVe(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function rFe(r,t,s,a){return new nFe(r,t,s,a)}async function gne(r,t){const s=zn(r);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const g=[],E=[];let S=Er();for(const b of l){g.push(b.batchId);for(const C of b.mutations)S=S.add(C.key)}for(const b of d){E.push(b.batchId);for(const C of b.mutations)S=S.add(C.key)}return s.localDocuments.getDocuments(a,S).next(b=>({Rs:b,removedBatchIds:g,addedBatchIds:E}))})})}function iFe(r,t){const s=zn(r);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(E,S,b,C){const O=b.batch,k=O.keys();let W=gt.resolve();return k.forEach(H=>{W=W.next(()=>C.getEntry(S,H)).next(K=>{const G=b.docVersions.get(H);Zr(G!==null),K.version.compareTo(G)<0&&(O.applyToRemoteDocument(K,b),K.isValidDocument()&&(K.setReadTime(b.commitVersion),C.addEntry(K)))})}),W.next(()=>E.mutationQueue.removeMutationBatch(S,O))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let S=Er();for(let b=0;b<E.mutationResults.length;++b)E.mutationResults[b].transformResults.length>0&&(S=S.add(E.batch.mutations[b].key));return S}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function _ne(r){const t=zn(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function sFe(r,t){const s=zn(r),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const g=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const E=[];t.targetChanges.forEach((C,O)=>{const k=l.get(O);if(!k)return;E.push(s.Hr.removeMatchingKeys(d,C.removedDocuments,O).next(()=>s.Hr.addMatchingKeys(d,C.addedDocuments,O)));let W=k.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(O)!==null?W=W.withResumeToken(Ho.EMPTY_BYTE_STRING,jn.min()).withLastLimboFreeSnapshotVersion(jn.min()):C.resumeToken.approximateByteSize()>0&&(W=W.withResumeToken(C.resumeToken,a)),l=l.insert(O,W),function(K,G,te){return K.resumeToken.approximateByteSize()===0||G.snapshotVersion.toMicroseconds()-K.snapshotVersion.toMicroseconds()>=tFe?!0:te.addedDocuments.size+te.modifiedDocuments.size+te.removedDocuments.size>0}(k,W,C)&&E.push(s.Hr.updateTargetData(d,W))});let S=qp(),b=Er();if(t.documentUpdates.forEach(C=>{t.resolvedLimboDocuments.has(C)&&E.push(s.persistence.referenceDelegate.updateLimboDocument(d,C))}),E.push(oFe(d,g,t.documentUpdates).next(C=>{S=C.Vs,b=C.fs})),!a.isEqual(jn.min())){const C=s.Hr.getLastRemoteSnapshotVersion(d).next(O=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(C)}return gt.waitFor(E).next(()=>g.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,S,b)).next(()=>S)}).then(d=>(s.Ts=l,d))}function oFe(r,t,s){let a=Er(),l=Er();return s.forEach(d=>a=a.add(d)),t.getEntries(r,a).next(d=>{let g=qp();return s.forEach((E,S)=>{const b=d.get(E);S.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(E)),S.isNoDocument()&&S.version.isEqual(jn.min())?(t.removeEntry(E,S.readTime),g=g.insert(E,S)):!b.isValidDocument()||S.version.compareTo(b.version)>0||S.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(S),g=g.insert(E,S)):zt(SF,"Ignoring outdated watch update for ",E,". Current version:",b.version," Watch version:",S.version)}),{Vs:g,fs:l}})}function aFe(r,t){const s=zn(r);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=cF),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function cFe(r,t){const s=zn(r);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,gt.resolve(l)):s.Hr.allocateTargetId(a).next(g=>(l=new bm(t,g,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function oU(r,t,s){const a=zn(r),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,g=>a.persistence.referenceDelegate.removeTarget(g,l))}catch(g){if(!BS(g))throw g;zt(SF,`Failed to update sequence numbers for target ${t}: ${g}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function q7(r,t,s){const a=zn(r);let l=jn.min(),d=Er();return a.persistence.runTransaction("Execute query","readwrite",g=>function(S,b,C){const O=zn(S),k=O.Is.get(C);return k!==void 0?gt.resolve(O.Ts.get(k)):O.Hr.getTargetData(b,C)}(a,g,vh(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(g,E.targetId).next(S=>{d=S})}).next(()=>a.Ps.getDocumentsMatchingQuery(g,t,s?l:jn.min(),s?d:Er())).next(E=>(lFe(a,qUe(t),E),{documents:E,gs:d})))}function lFe(r,t,s){let a=r.Es.get(t)||jn.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),r.Es.set(t,a)}class Y7{constructor(){this.activeTargetIds=eVe()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class uFe{constructor(){this.ho=new Y7,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new Y7,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dFe{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X7="ConnectivityMonitor";class J7{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){zt(X7,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){zt(X7,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IO=null;function aU(){return IO===null?IO=function(){return 268435456+Math.round(2147483648*Math.random())}():IO++,"0x"+IO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kM="RestConnection",hFe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pFe{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===xP?`project_id=${a}`:`project_id=${a}&database_id=${l}`}bo(t,s,a,l,d){const g=aU(),E=this.So(t,s.toUriEncodedString());zt(kM,`Sending RPC '${t}' ${g}:`,E,a);const S={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(S,l,d),this.vo(t,E,S,a).then(b=>(zt(kM,`Received RPC '${t}' ${g}: `,b),b),b=>{throw SS(kM,`RPC '${t}' ${g} failed with error: `,b,"url: ",E,"request:",a),b})}Co(t,s,a,l,d,g){return this.bo(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+FS}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}So(t,s){const a=hFe[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fFe{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Ko(t){this.ko(t)}Uo(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fa="WebChannelConnection";class mFe extends pFe{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=aU();return new Promise((g,E)=>{const S=new Tte;S.setWithCredentials(!0),S.listenOnce(bte.COMPLETE,()=>{try{switch(S.getLastErrorCode()){case nP.NO_ERROR:const C=S.getResponseJson();zt(fa,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(C)),g(C);break;case nP.TIMEOUT:zt(fa,`RPC '${t}' ${d} timed out`),E(new rn(St.DEADLINE_EXCEEDED,"Request time out"));break;case nP.HTTP_ERROR:const O=S.getStatus();if(zt(fa,`RPC '${t}' ${d} failed with status:`,O,"response text:",S.getResponseText()),O>0){let k=S.getResponseJson();Array.isArray(k)&&(k=k[0]);const W=k==null?void 0:k.error;if(W&&W.status&&W.message){const H=function(G){const te=G.toLowerCase().replace(/_/g,"-");return Object.values(St).indexOf(te)>=0?te:St.UNKNOWN}(W.status);E(new rn(H,W.message))}else E(new rn(St.UNKNOWN,"Server responded with status "+S.getStatus()))}else E(new rn(St.UNAVAILABLE,"Connection failed."));break;default:Mn()}}finally{zt(fa,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);zt(fa,`RPC '${t}' ${d} sending request:`,l),S.send(s,"POST",b,a,15)})}Wo(t,s,a){const l=aU(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],g=Cte(),E=Rte(),S={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(S.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(S.useFetchStreams=!0),this.Do(S.initMessageHeaders,s,a),S.encodeInitMessageHeaders=!0;const C=d.join("");zt(fa,`Creating RPC '${t}' stream ${l}: ${C}`,S);const O=g.createWebChannel(C,S);let k=!1,W=!1;const H=new fFe({Fo:G=>{W?zt(fa,`Not sending because RPC '${t}' stream ${l} is closed:`,G):(k||(zt(fa,`Opening RPC '${t}' stream ${l} transport.`),O.open(),k=!0),zt(fa,`RPC '${t}' stream ${l} sending:`,G),O.send(G))},Mo:()=>O.close()}),K=(G,te,J)=>{G.listen(te,re=>{try{J(re)}catch(fe){setTimeout(()=>{throw fe},0)}})};return K(O,Fb.EventType.OPEN,()=>{W||(zt(fa,`RPC '${t}' stream ${l} transport opened.`),H.Qo())}),K(O,Fb.EventType.CLOSE,()=>{W||(W=!0,zt(fa,`RPC '${t}' stream ${l} transport closed`),H.Ko())}),K(O,Fb.EventType.ERROR,G=>{W||(W=!0,SS(fa,`RPC '${t}' stream ${l} transport errored:`,G),H.Ko(new rn(St.UNAVAILABLE,"The operation could not be completed")))}),K(O,Fb.EventType.MESSAGE,G=>{var te;if(!W){const J=G.data[0];Zr(!!J);const re=J,fe=(re==null?void 0:re.error)||((te=re[0])===null||te===void 0?void 0:te.error);if(fe){zt(fa,`RPC '${t}' stream ${l} received error:`,fe);const oe=fe.status;let be=function(se){const ue=Os[se];if(ue!==void 0)return ine(ue)}(oe),Z=fe.message;be===void 0&&(be=St.INTERNAL,Z="Unknown error status: "+oe+" with message "+fe.message),W=!0,H.Ko(new rn(be,Z)),O.close()}else zt(fa,`RPC '${t}' stream ${l} received:`,J),H.Uo(J)}}),K(E,wte.STAT_EVENT,G=>{G.stat===X2.PROXY?zt(fa,`RPC '${t}' stream ${l} detected buffering proxy`):G.stat===X2.NOPROXY&&zt(fa,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{H.$o()},0),H}}function DM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VN(r){return new vVe(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ene{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&zt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q7="PersistentStream";class vne{constructor(t,s,a,l,d,g,E,S){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=g,this.appCheckCredentialsProvider=E,this.listener=S,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Ene(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===St.RESOURCE_EXHAUSTED?($p(s.toString()),$p("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===St.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new rn(St.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return zt(Q7,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(zt(Q7,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gFe extends vne{constructor(t,s,a,l,d,g){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,g),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=TVe(this.serializer,t),a=function(d){if(!("targetChange"in d))return jn.min();const g=d.targetChange;return g.targetIds&&g.targetIds.length?jn.min():g.readTime?Sh(g.readTime):jn.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=sU(this.serializer),s.addTarget=function(d,g){let E;const S=g.target;if(E=eU(S)?{documents:RVe(d,S)}:{query:CVe(d,S).ht},E.targetId=g.targetId,g.resumeToken.approximateByteSize()>0){E.resumeToken=ane(d,g.resumeToken);const b=nU(d,g.expectedCount);b!==null&&(E.expectedCount=b)}else if(g.snapshotVersion.compareTo(jn.min())>0){E.readTime=BP(d,g.snapshotVersion.toTimestamp());const b=nU(d,g.expectedCount);b!==null&&(E.expectedCount=b)}return E}(this.serializer,t);const a=AVe(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=sU(this.serializer),s.removeTarget=t,this.I_(s)}}class _Fe extends vne{constructor(t,s,a,l,d,g){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,g),this.serializer=d}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return Zr(!!t.streamToken),this.lastStreamToken=t.streamToken,Zr(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){Zr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=wVe(t.writeResults,t.commitTime),a=Sh(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=sU(this.serializer),this.I_(t)}S_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>bVe(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EFe{}class vFe extends EFe{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new rn(St.FAILED_PRECONDITION,"The client has already been terminated.")}bo(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,g])=>this.connection.bo(t,rU(s,a),l,d,g)).catch(d=>{throw d.name==="FirebaseError"?(d.code===St.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new rn(St.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([g,E])=>this.connection.Co(t,rU(s,a),l,g,E,d)).catch(g=>{throw g.name==="FirebaseError"?(g.code===St.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new rn(St.UNKNOWN,g.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class yFe{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?($p(s),this.N_=!1):zt("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q_="RemoteStore";class SFe{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(g=>{a.enqueueAndForget(async()=>{iE(this)&&(zt(Q_,"Restarting streams for network reachability change."),await async function(S){const b=zn(S);b.W_.add(4),await dR(b),b.j_.set("Unknown"),b.W_.delete(4),await FN(b)}(this))})}),this.j_=new yFe(a,l)}}async function FN(r){if(iE(r))for(const t of r.G_)await t(!0)}async function dR(r){for(const t of r.G_)await t(!1)}function yne(r,t){const s=zn(r);s.U_.has(t.targetId)||(s.U_.set(t.targetId,t),RF(s)?wF(s):WS(s).c_()&&bF(s,t))}function TF(r,t){const s=zn(r),a=WS(s);s.U_.delete(t),a.c_()&&Sne(s,t),s.U_.size===0&&(a.c_()?a.P_():iE(s)&&s.j_.set("Unknown"))}function bF(r,t){if(r.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(jn.min())>0){const s=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}WS(r).y_(t)}function Sne(r,t){r.H_.Ne(t),WS(r).w_(t)}function wF(r){r.H_=new mVe({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>r.U_.get(t)||null,it:()=>r.datastore.serializer.databaseId}),WS(r).start(),r.j_.B_()}function RF(r){return iE(r)&&!WS(r).u_()&&r.U_.size>0}function iE(r){return zn(r).W_.size===0}function Tne(r){r.H_=void 0}async function TFe(r){r.j_.set("Online")}async function bFe(r){r.U_.forEach((t,s)=>{bF(r,t)})}async function wFe(r,t){Tne(r),RF(r)?(r.j_.q_(t),wF(r)):r.j_.set("Unknown")}async function RFe(r,t,s){if(r.j_.set("Online"),t instanceof one&&t.state===2&&t.cause)try{await async function(l,d){const g=d.cause;for(const E of d.targetIds)l.U_.has(E)&&(await l.remoteSyncer.rejectListen(E,g),l.U_.delete(E),l.H_.removeTarget(E))}(r,t)}catch(a){zt(Q_,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await GP(r,a)}else if(t instanceof oP?r.H_.We(t):t instanceof sne?r.H_.Ze(t):r.H_.je(t),!s.isEqual(jn.min()))try{const a=await _ne(r.localStore);s.compareTo(a)>=0&&await function(d,g){const E=d.H_.ot(g);return E.targetChanges.forEach((S,b)=>{if(S.resumeToken.approximateByteSize()>0){const C=d.U_.get(b);C&&d.U_.set(b,C.withResumeToken(S.resumeToken,g))}}),E.targetMismatches.forEach((S,b)=>{const C=d.U_.get(S);if(!C)return;d.U_.set(S,C.withResumeToken(Ho.EMPTY_BYTE_STRING,C.snapshotVersion)),Sne(d,S);const O=new bm(C.target,S,b,C.sequenceNumber);bF(d,O)}),d.remoteSyncer.applyRemoteEvent(E)}(r,s)}catch(a){zt(Q_,"Failed to raise snapshot:",a),await GP(r,a)}}async function GP(r,t,s){if(!BS(t))throw t;r.W_.add(1),await dR(r),r.j_.set("Offline"),s||(s=()=>_ne(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{zt(Q_,"Retrying IndexedDB access"),await s(),r.W_.delete(1),await FN(r)})}function bne(r,t){return t().catch(s=>GP(r,s,t))}async function jN(r){const t=zn(r),s=Vm(t);let a=t.K_.length>0?t.K_[t.K_.length-1].batchId:cF;for(;CFe(t);)try{const l=await aFe(t.localStore,a);if(l===null){t.K_.length===0&&s.P_();break}a=l.batchId,IFe(t,l)}catch(l){await GP(t,l)}wne(t)&&Rne(t)}function CFe(r){return iE(r)&&r.K_.length<10}function IFe(r,t){r.K_.push(t);const s=Vm(r);s.c_()&&s.b_&&s.S_(t.mutations)}function wne(r){return iE(r)&&!Vm(r).u_()&&r.K_.length>0}function Rne(r){Vm(r).start()}async function AFe(r){Vm(r).C_()}async function OFe(r){const t=Vm(r);for(const s of r.K_)t.S_(s.mutations)}async function PFe(r,t,s){const a=r.K_.shift(),l=mF.from(a,t,s);await bne(r,()=>r.remoteSyncer.applySuccessfulWrite(l)),await jN(r)}async function NFe(r,t){t&&Vm(r).b_&&await async function(a,l){if(function(g){return hVe(g)&&g!==St.ABORTED}(l.code)){const d=a.K_.shift();Vm(a).h_(),await bne(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await jN(a)}}(r,t),wne(r)&&Rne(r)}async function Z7(r,t){const s=zn(r);s.asyncQueue.verifyOperationInProgress(),zt(Q_,"RemoteStore received new credentials");const a=iE(s);s.W_.add(3),await dR(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await FN(s)}async function kFe(r,t){const s=zn(r);t?(s.W_.delete(2),await FN(s)):t||(s.W_.add(2),await dR(s),s.j_.set("Unknown"))}function WS(r){return r.J_||(r.J_=function(s,a,l){const d=zn(s);return d.M_(),new gFe(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{xo:TFe.bind(null,r),No:bFe.bind(null,r),Lo:wFe.bind(null,r),p_:RFe.bind(null,r)}),r.G_.push(async t=>{t?(r.J_.h_(),RF(r)?wF(r):r.j_.set("Unknown")):(await r.J_.stop(),Tne(r))})),r.J_}function Vm(r){return r.Y_||(r.Y_=function(s,a,l){const d=zn(s);return d.M_(),new _Fe(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:AFe.bind(null,r),Lo:NFe.bind(null,r),D_:OFe.bind(null,r),v_:PFe.bind(null,r)}),r.G_.push(async t=>{t?(r.Y_.h_(),await jN(r)):(await r.Y_.stop(),r.K_.length>0&&(zt(Q_,`Stopping write stream with ${r.K_.length} pending writes`),r.K_=[]))})),r.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CF{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new jp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(g=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const g=Date.now()+a,E=new CF(t,s,g,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new rn(St.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function IF(r,t){if($p("AsyncQueue",`${t}: ${r}`),BS(r))return new rn(St.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{static emptySet(t){return new aS(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||bn.comparator(s.key,a.key):(s,a)=>bn.comparator(s.key,a.key),this.keyedMap=jb(),this.sortedSet=new Xi(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof aS)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new aS;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eY{constructor(){this.Z_=new Xi(bn.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):Mn():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class CS{constructor(t,s,a,l,d,g,E,S,b){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=g,this.syncStateChanged=E,this.excludesMetadataChanges=S,this.hasCachedResults=b}static fromInitialDocuments(t,s,a,l,d){const g=[];return s.forEach(E=>{g.push({type:0,doc:E})}),new CS(t,s,aS.emptySet(s),g,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&DN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DFe{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class LFe{constructor(){this.queries=tY(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=zn(s),d=l.queries;l.queries=tY(),d.forEach((g,E)=>{for(const S of E.ta)S.onError(a)})})(this,new rn(St.ABORTED,"Firestore shutting down"))}}function tY(){return new rE(r=>Hte(r),DN)}async function Cne(r,t){const s=zn(r);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new DFe,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(g){const E=IF(g,`Initialization of query '${Py(t.query)}' failed`);return void t.onError(E)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&AF(s)}async function Ine(r,t){const s=zn(r),a=t.query;let l=3;const d=s.queries.get(a);if(d){const g=d.ta.indexOf(t);g>=0&&(d.ta.splice(g,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function xFe(r,t){const s=zn(r);let a=!1;for(const l of t){const d=l.query,g=s.queries.get(d);if(g){for(const E of g.ta)E.oa(l)&&(a=!0);g.ea=l}}a&&AF(s)}function MFe(r,t,s){const a=zn(r),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function AF(r){r.ia.forEach(t=>{t.next()})}var cU,nY;(nY=cU||(cU={}))._a="default",nY.Cache="cache";class Ane{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new CS(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=CS.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==cU.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class One{constructor(t){this.key=t}}class Pne{constructor(t){this.key=t}}class UFe{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Er(),this.mutatedKeys=Er(),this.ya=Kte(t),this.wa=new aS(this.ya)}get ba(){return this.fa}Sa(t,s){const a=s?s.Da:new eY,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,g=l,E=!1;const S=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((C,O)=>{const k=l.get(C),W=LN(this.query,O)?O:null,H=!!k&&this.mutatedKeys.has(k.key),K=!!W&&(W.hasLocalMutations||this.mutatedKeys.has(W.key)&&W.hasCommittedMutations);let G=!1;k&&W?k.data.isEqual(W.data)?H!==K&&(a.track({type:3,doc:W}),G=!0):this.va(k,W)||(a.track({type:2,doc:W}),G=!0,(S&&this.ya(W,S)>0||b&&this.ya(W,b)<0)&&(E=!0)):!k&&W?(a.track({type:0,doc:W}),G=!0):k&&!W&&(a.track({type:1,doc:k}),G=!0,(S||b)&&(E=!0)),G&&(W?(g=g.add(W),d=K?d.add(C):d.delete(C)):(g=g.delete(C),d=d.delete(C)))}),this.query.limit!==null)for(;g.size>this.query.limit;){const C=this.query.limitType==="F"?g.last():g.first();g=g.delete(C.key),d=d.delete(C.key),a.track({type:1,doc:C})}return{wa:g,Da:a,ls:E,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const g=t.Da.X_();g.sort((C,O)=>function(W,H){const K=G=>{switch(G){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Mn()}};return K(W)-K(H)}(C.type,O.type)||this.ya(C.doc,O.doc)),this.Ca(a),l=l!=null&&l;const E=s&&!l?this.Fa():[],S=this.pa.size===0&&this.current&&!l?1:0,b=S!==this.ga;return this.ga=S,g.length!==0||b?{snapshot:new CS(this.query,t.wa,d,g,t.mutatedKeys,S===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:E}:{Ma:E}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new eY,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Er(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new Pne(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new One(a))}),s}Oa(t){this.fa=t.gs,this.pa=Er();const s=this.Sa(t.documents);return this.applyChanges(s,!0)}Na(){return CS.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const OF="SyncEngine";class VFe{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class FFe{constructor(t){this.key=t,this.Ba=!1}}class jFe{constructor(t,s,a,l,d,g){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=g,this.La={},this.ka=new rE(E=>Hte(E),DN),this.qa=new Map,this.Qa=new Set,this.$a=new Xi(bn.comparator),this.Ka=new Map,this.Ua=new EF,this.Wa={},this.Ga=new Map,this.za=RS.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function BFe(r,t,s=!0){const a=Mne(r);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await Nne(a,t,s,!0),l}async function WFe(r,t){const s=Mne(r);await Nne(s,t,!0,!1)}async function Nne(r,t,s,a){const l=await cFe(r.localStore,vh(t)),d=l.targetId,g=r.sharedClientState.addLocalQueryTarget(d,s);let E;return a&&(E=await GFe(r,t,d,g==="current",l.resumeToken)),r.isPrimaryClient&&s&&yne(r.remoteStore,l),E}async function GFe(r,t,s,a,l){r.Ha=(O,k,W)=>async function(K,G,te,J){let re=G.view.Sa(te);re.ls&&(re=await q7(K.localStore,G.query,!1).then(({documents:Z})=>G.view.Sa(Z,re)));const fe=J&&J.targetChanges.get(G.targetId),oe=J&&J.targetMismatches.get(G.targetId)!=null,be=G.view.applyChanges(re,K.isPrimaryClient,fe,oe);return iY(K,G.targetId,be.Ma),be.snapshot}(r,O,k,W);const d=await q7(r.localStore,t,!0),g=new UFe(t,d.gs),E=g.Sa(d.documents),S=uR.createSynthesizedTargetChangeForCurrentChange(s,a&&r.onlineState!=="Offline",l),b=g.applyChanges(E,r.isPrimaryClient,S);iY(r,s,b.Ma);const C=new VFe(t,s,g);return r.ka.set(t,C),r.qa.has(s)?r.qa.get(s).push(t):r.qa.set(s,[t]),b.snapshot}async function zFe(r,t,s){const a=zn(r),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(g=>!DN(g,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await oU(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&TF(a.remoteStore,l.targetId),lU(a,l.targetId)}).catch(jS)):(lU(a,l.targetId),await oU(a.localStore,l.targetId,!0))}async function HFe(r,t){const s=zn(r),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),TF(s.remoteStore,a.targetId))}async function KFe(r,t,s){const a=ZFe(r);try{const l=await function(g,E){const S=zn(g),b=$s.now(),C=E.reduce((W,H)=>W.add(H.key),Er());let O,k;return S.persistence.runTransaction("Locally write mutations","readwrite",W=>{let H=qp(),K=Er();return S.ds.getEntries(W,C).next(G=>{H=G,H.forEach((te,J)=>{J.isValidDocument()||(K=K.add(te))})}).next(()=>S.localDocuments.getOverlayedDocuments(W,H)).next(G=>{O=G;const te=[];for(const J of E){const re=aVe(J,O.get(J.key).overlayedDocument);re!=null&&te.push(new qm(J.key,re,Vte(re.value.mapValue),yh.exists(!0)))}return S.mutationQueue.addMutationBatch(W,b,te,E)}).next(G=>{k=G;const te=G.applyToLocalDocumentSet(O,K);return S.documentOverlayCache.saveOverlays(W,G.batchId,te)})}).then(()=>({batchId:k.batchId,changes:qte(O)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(g,E,S){let b=g.Wa[g.currentUser.toKey()];b||(b=new Xi(wr)),b=b.insert(E,S),g.Wa[g.currentUser.toKey()]=b}(a,l.batchId,s),await hR(a,l.changes),await jN(a.remoteStore)}catch(l){const d=IF(l,"Failed to persist write");s.reject(d)}}async function kne(r,t){const s=zn(r);try{const a=await sFe(s.localStore,t);t.targetChanges.forEach((l,d)=>{const g=s.Ka.get(d);g&&(Zr(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?g.Ba=!0:l.modifiedDocuments.size>0?Zr(g.Ba):l.removedDocuments.size>0&&(Zr(g.Ba),g.Ba=!1))}),await hR(s,a,t)}catch(a){await jS(a)}}function rY(r,t,s){const a=zn(r);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,g)=>{const E=g.view.sa(t);E.snapshot&&l.push(E.snapshot)}),function(g,E){const S=zn(g);S.onlineState=E;let b=!1;S.queries.forEach((C,O)=>{for(const k of O.ta)k.sa(E)&&(b=!0)}),b&&AF(S)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function $Fe(r,t,s){const a=zn(r);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ka.get(t),d=l&&l.key;if(d){let g=new Xi(bn.comparator);g=g.insert(d,Ea.newNoDocument(d,jn.min()));const E=Er().add(d),S=new UN(jn.min(),new Map,new Xi(wr),g,E);await kne(a,S),a.$a=a.$a.remove(d),a.Ka.delete(t),PF(a)}else await oU(a.localStore,t,!1).then(()=>lU(a,t,s)).catch(jS)}async function qFe(r,t){const s=zn(r),a=t.batch.batchId;try{const l=await iFe(s.localStore,t);Lne(s,a,null),Dne(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await hR(s,l)}catch(l){await jS(l)}}async function YFe(r,t,s){const a=zn(r);try{const l=await function(g,E){const S=zn(g);return S.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let C;return S.mutationQueue.lookupMutationBatch(b,E).next(O=>(Zr(O!==null),C=O.keys(),S.mutationQueue.removeMutationBatch(b,O))).next(()=>S.mutationQueue.performConsistencyCheck(b)).next(()=>S.documentOverlayCache.removeOverlaysForBatchId(b,C,E)).next(()=>S.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,C)).next(()=>S.localDocuments.getDocuments(b,C))})}(a.localStore,t);Lne(a,t,s),Dne(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await hR(a,l)}catch(l){await jS(l)}}function Dne(r,t){(r.Ga.get(t)||[]).forEach(s=>{s.resolve()}),r.Ga.delete(t)}function Lne(r,t,s){const a=zn(r);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function lU(r,t,s=null){r.sharedClientState.removeLocalQueryTarget(t);for(const a of r.qa.get(t))r.ka.delete(a),s&&r.La.Ja(a,s);r.qa.delete(t),r.isPrimaryClient&&r.Ua.Sr(t).forEach(a=>{r.Ua.containsKey(a)||xne(r,a)})}function xne(r,t){r.Qa.delete(t.path.canonicalString());const s=r.$a.get(t);s!==null&&(TF(r.remoteStore,s),r.$a=r.$a.remove(t),r.Ka.delete(s),PF(r))}function iY(r,t,s){for(const a of s)a instanceof One?(r.Ua.addReference(a.key,t),XFe(r,a)):a instanceof Pne?(zt(OF,"Document no longer in limbo: "+a.key),r.Ua.removeReference(a.key,t),r.Ua.containsKey(a.key)||xne(r,a.key)):Mn()}function XFe(r,t){const s=t.key,a=s.path.canonicalString();r.$a.get(s)||r.Qa.has(a)||(zt(OF,"New document in limbo: "+s),r.Qa.add(a),PF(r))}function PF(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){const t=r.Qa.values().next().value;r.Qa.delete(t);const s=new bn(Bi.fromString(t)),a=r.za.next();r.Ka.set(a,new FFe(s)),r.$a=r.$a.insert(s,a),yne(r.remoteStore,new bm(vh(pF(s.path)),a,"TargetPurposeLimboResolution",ON.ae))}}async function hR(r,t,s){const a=zn(r),l=[],d=[],g=[];a.ka.isEmpty()||(a.ka.forEach((E,S)=>{g.push(a.Ha(S,t,s).then(b=>{var C;if((b||s)&&a.isPrimaryClient){const O=b?!b.fromCache:(C=s==null?void 0:s.targetChanges.get(S.targetId))===null||C===void 0?void 0:C.current;a.sharedClientState.updateQueryState(S.targetId,O?"current":"not-current")}if(b){l.push(b);const O=yF.Yi(S.targetId,b);d.push(O)}}))}),await Promise.all(g),a.La.p_(l),await async function(S,b){const C=zn(S);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>gt.forEach(b,k=>gt.forEach(k.Hi,W=>C.persistence.referenceDelegate.addReference(O,k.targetId,W)).next(()=>gt.forEach(k.Ji,W=>C.persistence.referenceDelegate.removeReference(O,k.targetId,W)))))}catch(O){if(!BS(O))throw O;zt(SF,"Failed to update sequence numbers: "+O)}for(const O of b){const k=O.targetId;if(!O.fromCache){const W=C.Ts.get(k),H=W.snapshotVersion,K=W.withLastLimboFreeSnapshotVersion(H);C.Ts=C.Ts.insert(k,K)}}}(a.localStore,d))}async function JFe(r,t){const s=zn(r);if(!s.currentUser.isEqual(t)){zt(OF,"User change. New user:",t.toKey());const a=await gne(s.localStore,t);s.currentUser=t,function(d,g){d.Ga.forEach(E=>{E.forEach(S=>{S.reject(new rn(St.CANCELLED,g))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await hR(s,a.Rs)}}function QFe(r,t){const s=zn(r),a=s.Ka.get(t);if(a&&a.Ba)return Er().add(a.key);{let l=Er();const d=s.qa.get(t);if(!d)return l;for(const g of d){const E=s.ka.get(g);l=l.unionWith(E.view.ba)}return l}}function Mne(r){const t=zn(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=kne.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=QFe.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=$Fe.bind(null,t),t.La.p_=xFe.bind(null,t.eventManager),t.La.Ja=MFe.bind(null,t.eventManager),t}function ZFe(r){const t=zn(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=qFe.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=YFe.bind(null,t),t}class zP{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=VN(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return rFe(this.persistence,new eFe,t.initialUser,this.serializer)}Xa(t){return new mne(vF.ri,this.serializer)}Za(t){return new uFe}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}zP.provider={build:()=>new zP};class eje extends zP{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){Zr(this.persistence.referenceDelegate instanceof WP);const a=this.persistence.referenceDelegate.garbageCollector;return new FVe(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?Cc.withCacheSize(this.cacheSizeBytes):Cc.DEFAULT;return new mne(a=>WP.ri(a,s),this.serializer)}}class uU{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>rY(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=JFe.bind(null,this.syncEngine),await kFe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new LFe}()}createDatastore(t){const s=VN(t.databaseInfo.databaseId),a=function(d){return new mFe(d)}(t.databaseInfo);return function(d,g,E,S){return new vFe(d,g,E,S)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,g,E){return new SFe(a,l,d,g,E)}(this.localStore,this.datastore,t.asyncQueue,s=>rY(this.syncEngine,s,0),function(){return J7.D()?new J7:new dFe}())}createSyncEngine(t,s){return function(l,d,g,E,S,b,C){const O=new jFe(l,d,g,E,S,b);return C&&(O.ja=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=zn(l);zt(Q_,"RemoteStore shutting down."),d.W_.add(5),await dR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}uU.provider={build:()=>new uU};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Une{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):$p("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fm="FirestoreClient";class tje{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=_a.UNAUTHENTICATED,this.clientId=Ate.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async g=>{zt(Fm,"Received user=",g.uid),await this.authCredentialListener(g),this.user=g}),this.appCheckCredentials.start(a,g=>(zt(Fm,"Received new app check token=",g),this.appCheckCredentialListener(g,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new jp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=IF(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function LM(r,t){r.asyncQueue.verifyOperationInProgress(),zt(Fm,"Initializing OfflineComponentProvider");const s=r.configuration;await t.initialize(s);let a=s.initialUser;r.setCredentialChangeListener(async l=>{a.isEqual(l)||(await gne(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function sY(r,t){r.asyncQueue.verifyOperationInProgress();const s=await nje(r);zt(Fm,"Initializing OnlineComponentProvider"),await t.initialize(s,r.configuration),r.setCredentialChangeListener(a=>Z7(t.remoteStore,a)),r.setAppCheckTokenChangeListener((a,l)=>Z7(t.remoteStore,l)),r._onlineComponents=t}async function nje(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){zt(Fm,"Using user provided OfflineComponentProvider");try{await LM(r,r._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===St.FAILED_PRECONDITION||l.code===St.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;SS("Error using user provided cache. Falling back to memory cache: "+s),await LM(r,new zP)}}else zt(Fm,"Using default OfflineComponentProvider"),await LM(r,new eje(void 0));return r._offlineComponents}async function Vne(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(zt(Fm,"Using user provided OnlineComponentProvider"),await sY(r,r._uninitializedComponentsProvider._online)):(zt(Fm,"Using default OnlineComponentProvider"),await sY(r,new uU))),r._onlineComponents}function rje(r){return Vne(r).then(t=>t.syncEngine)}async function Fne(r){const t=await Vne(r),s=t.eventManager;return s.onListen=BFe.bind(null,t.syncEngine),s.onUnlisten=zFe.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=WFe.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=HFe.bind(null,t.syncEngine),s}function ije(r,t,s={}){const a=new jp;return r.asyncQueue.enqueueAndForget(async()=>function(d,g,E,S,b){const C=new Une({next:k=>{C.su(),g.enqueueAndForget(()=>Ine(d,O));const W=k.docs.has(E);!W&&k.fromCache?b.reject(new rn(St.UNAVAILABLE,"Failed to get document because the client is offline.")):W&&k.fromCache&&S&&S.source==="server"?b.reject(new rn(St.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(k)},error:k=>b.reject(k)}),O=new Ane(pF(E.path),C,{includeMetadataChanges:!0,Ta:!0});return Cne(d,O)}(await Fne(r),r.asyncQueue,t,s,a)),a.promise}function sje(r,t,s={}){const a=new jp;return r.asyncQueue.enqueueAndForget(async()=>function(d,g,E,S,b){const C=new Une({next:k=>{C.su(),g.enqueueAndForget(()=>Ine(d,O)),k.fromCache&&S.source==="server"?b.reject(new rn(St.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(k)},error:k=>b.reject(k)}),O=new Ane(E,C,{includeMetadataChanges:!0,Ta:!0});return Cne(d,O)}(await Fne(r),r.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jne(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oY=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bne(r,t,s){if(!s)throw new rn(St.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function oje(r,t,s,a){if(t===!0&&a===!0)throw new rn(St.INVALID_ARGUMENT,`${r} and ${s} cannot be used together.`)}function aY(r){if(!bn.isDocumentKey(r))throw new rn(St.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function cY(r){if(bn.isDocumentKey(r))throw new rn(St.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function NF(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":Mn()}function Yp(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new rn(St.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=NF(r);throw new rn(St.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wne="firestore.googleapis.com",lY=!0;class uY{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new rn(St.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Wne,this.ssl=lY}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:lY;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=fne;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<UVe)throw new rn(St.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}oje("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jne((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new rn(St.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new rn(St.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new rn(St.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class BN{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uY({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rn(St.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new rn(St.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uY(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new pUe;switch(a.type){case"firstParty":return new _Ue(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new rn(St.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=oY.get(s);a&&(zt("ComponentProvider","Removing Datastore"),oY.delete(s),a.terminate())}(this),Promise.resolve()}}function aje(r,t,s,a={}){var l;const d=(r=Yp(r,BN))._getSettings(),g=Object.assign(Object.assign({},d),{emulatorOptions:r._getEmulatorOptions()}),E=`${t}:${s}`;d.host!==Wne&&d.host!==E&&SS("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const S=Object.assign(Object.assign({},d),{host:E,ssl:!1,emulatorOptions:a});if(!$_(S,g)&&(r._setSettings(S),a.mockUserToken)){let b,C;if(typeof a.mockUserToken=="string")b=a.mockUserToken,C=_a.MOCK_USER;else{b=Dee(a.mockUserToken,(l=r._app)===null||l===void 0?void 0:l.options.projectId);const O=a.mockUserToken.sub||a.mockUserToken.user_id;if(!O)throw new rn(St.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new _a(O)}r._authCredentials=new fUe(new Ite(b,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new WN(this.firestore,t,this._query)}}class Dc{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Am(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Dc(this.firestore,t,this._key)}}class Am extends WN{constructor(t,s,a){super(t,s,pF(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Dc(this.firestore,null,new bn(t))}withConverter(t){return new Am(this.firestore,t,this._path)}}function cje(r,t,...s){if(r=Ds(r),Bne("collection","path",t),r instanceof BN){const a=Bi.fromString(t,...s);return cY(a),new Am(r,null,a)}{if(!(r instanceof Dc||r instanceof Am))throw new rn(St.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(Bi.fromString(t,...s));return cY(a),new Am(r.firestore,null,a)}}function Uw(r,t,...s){if(r=Ds(r),arguments.length===1&&(t=Ate.newId()),Bne("doc","path",t),r instanceof BN){const a=Bi.fromString(t,...s);return aY(a),new Dc(r,null,new bn(a))}{if(!(r instanceof Dc||r instanceof Am))throw new rn(St.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(Bi.fromString(t,...s));return aY(a),new Dc(r.firestore,r instanceof Am?r.converter:null,new bn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dY="AsyncQueue";class hY{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Ene(this,"async_queue_retry"),this.bu=()=>{const a=DM();a&&zt(dY,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.Su=t;const s=DM();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=DM();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.bu)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new jp;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!BS(t))throw t;zt(dY,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.Su.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(g){let E=g.message||"";return g.stack&&(E=g.stack.includes(g.message)?g.stack:g.message+`
`+g.stack),E}(a);throw $p("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.Su=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=CF.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Mn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.Su,await t;while(t!==this.Su)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}class pR extends BN{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new hY,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new hY(t),this._firestoreClient=void 0,await t}}}function lje(r,t){const s=typeof r=="object"?r:QV(),a=typeof r=="string"?r:xP,l=RN(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=Pee("firestore");d&&aje(l,...d)}return l}function kF(r){if(r._terminated)throw new rn(St.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||uje(r),r._firestoreClient}function uje(r){var t,s,a;const l=r._freezeSettings(),d=function(E,S,b,C){return new NUe(E,S,b,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,jne(C.experimentalLongPollingOptions),C.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,l);r._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(r._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),r._firestoreClient=new tje(r._authCredentials,r._appCheckCredentials,r._queue,d,r._componentsProvider&&function(E){const S=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(S),_online:S}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(t){this._byteString=t}static fromBase64String(t){try{return new IS(Ho.fromBase64String(t))}catch(s){throw new rn(St.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new IS(Ho.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new rn(St.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zo(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DF{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new rn(St.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new rn(St.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return wr(this._lat,t._lat)||wr(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dje=/^__.*__$/;class hje{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new qm(t,this.data,this.fieldMask,s,this.fieldTransforms):new lR(t,this.data,s,this.fieldTransforms)}}class Gne{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new qm(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function zne(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Mn()}}class MF{constructor(t,s,a,l,d,g){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=g||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new MF(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Ku(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Uu(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return HP(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(zne(this.Lu)&&dje.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class pje{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||VN(t)}ju(t,s,a,l=!1){return new MF({Lu:t,methodName:s,zu:a,path:zo.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Hne(r){const t=r._freezeSettings(),s=VN(r._databaseId);return new pje(r._databaseId,!!t.ignoreUndefinedProperties,s)}function fje(r,t,s,a,l,d={}){const g=r.ju(d.merge||d.mergeFields?2:0,t,s,l);UF("Data must be an object, but it was:",g,a);const E=Kne(a,g);let S,b;if(d.merge)S=new al(g.fieldMask),b=g.fieldTransforms;else if(d.mergeFields){const C=[];for(const O of d.mergeFields){const k=dU(t,O,s);if(!g.contains(k))throw new rn(St.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);qne(C,k)||C.push(k)}S=new al(C),b=g.fieldTransforms.filter(O=>S.covers(O.field))}else S=null,b=g.fieldTransforms;return new hje(new Ac(E),S,b)}class zN extends DF{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof zN}}function mje(r,t,s,a){const l=r.ju(1,t,s);UF("Data must be an object, but it was:",l,a);const d=[],g=Ac.empty();$m(a,(S,b)=>{const C=VF(t,S,s);b=Ds(b);const O=l.Ku(C);if(b instanceof zN)d.push(C);else{const k=HN(b,O);k!=null&&(d.push(C),g.set(C,k))}});const E=new al(d);return new Gne(g,E,l.fieldTransforms)}function gje(r,t,s,a,l,d){const g=r.ju(1,t,s),E=[dU(t,a,s)],S=[l];if(d.length%2!=0)throw new rn(St.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let k=0;k<d.length;k+=2)E.push(dU(t,d[k])),S.push(d[k+1]);const b=[],C=Ac.empty();for(let k=E.length-1;k>=0;--k)if(!qne(b,E[k])){const W=E[k];let H=S[k];H=Ds(H);const K=g.Ku(W);if(H instanceof zN)b.push(W);else{const G=HN(H,K);G!=null&&(b.push(W),C.set(W,G))}}const O=new al(b);return new Gne(C,O,g.fieldTransforms)}function HN(r,t){if($ne(r=Ds(r)))return UF("Unsupported field value:",t,r),Kne(r,t);if(r instanceof DF)return function(a,l){if(!zne(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let g=0;for(const E of a){let S=HN(E,l.Uu(g));S==null&&(S={nullValue:"NULL_VALUE"}),d.push(S),g++}return{arrayValue:{values:d}}}(r,t)}return function(a,l){if((a=Ds(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return tVe(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=$s.fromDate(a);return{timestampValue:BP(l.serializer,d)}}if(a instanceof $s){const d=new $s(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:BP(l.serializer,d)}}if(a instanceof LF)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof IS)return{bytesValue:ane(l.serializer,a._byteString)};if(a instanceof Dc){const d=l.databaseId,g=a.firestore._databaseId;if(!g.isEqual(d))throw l.Wu(`Document reference is for database ${g.projectId}/${g.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:_F(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof xF)return function(g,E){return{mapValue:{fields:{[Mte]:{stringValue:Ute},[MP]:{arrayValue:{values:g.toArray().map(b=>{if(typeof b!="number")throw E.Wu("VectorValues must only contain numeric values.");return fF(E.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${NF(a)}`)}(r,t)}function Kne(r,t){const s={};return Pte(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):$m(r,(a,l)=>{const d=HN(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function $ne(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof $s||r instanceof LF||r instanceof IS||r instanceof Dc||r instanceof DF||r instanceof xF)}function UF(r,t,s){if(!$ne(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=NF(s);throw a==="an object"?t.Wu(r+" a custom object"):t.Wu(r+" "+a)}}function dU(r,t,s){if((t=Ds(t))instanceof GN)return t._internalPath;if(typeof t=="string")return VF(r,t);throw HP("Field path arguments must be of type string or ",r,!1,void 0,s)}const _je=new RegExp("[~\\*/\\[\\]]");function VF(r,t,s){if(t.search(_je)>=0)throw HP(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,s);try{return new GN(...t.split("."))._internalPath}catch{throw HP(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,s)}}function HP(r,t,s,a,l){const d=a&&!a.isEmpty(),g=l!==void 0;let E=`Function ${t}() called with invalid data`;s&&(E+=" (via `toFirestore()`)"),E+=". ";let S="";return(d||g)&&(S+=" (found",d&&(S+=` in field ${a}`),g&&(S+=` in document ${l}`),S+=")"),new rn(St.INVALID_ARGUMENT,E+r+S)}function qne(r,t){return r.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yne{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Dc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Eje(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(Xne("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class Eje extends Yne{data(){return super.data()}}function Xne(r,t){return typeof t=="string"?VF(r,t):t instanceof GN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vje(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new rn(St.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yje{convertValue(t,s="none"){switch(Um(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ys(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(Mm(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw Mn()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return $m(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[MP].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(g=>ys(g.doubleValue));return new xF(d)}convertGeoPoint(t){return new LF(ys(t.latitude),ys(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=NN(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(kw(t));default:return null}}convertTimestamp(t){const s=xm(t);return new $s(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=Bi.fromString(t);Zr(pne(a));const l=new Dw(a.get(1),a.get(3)),d=new bn(a.popFirst(5));return l.isEqual(s)||$p(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sje(r,t,s){let a;return a=r?r.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Jne extends Yne{constructor(t,s,a,l,d,g){super(t,s,a,l,g),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new aP(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(Xne("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class aP extends Jne{data(t={}){return super.data(t)}}class Tje{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new Wb(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new aP(this._firestore,this._userDataWriter,a.key,a,new Wb(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new rn(St.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let g=0;return l._snapshot.docChanges.map(E=>{const S=new aP(l._firestore,l._userDataWriter,E.doc.key,E.doc,new Wb(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:S,oldIndex:-1,newIndex:g++}})}{let g=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const S=new aP(l._firestore,l._userDataWriter,E.doc.key,E.doc,new Wb(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,C=-1;return E.type!==0&&(b=g.indexOf(E.doc.key),g=g.delete(E.doc.key)),E.type!==1&&(g=g.add(E.doc),C=g.indexOf(E.doc.key)),{type:bje(E.type),doc:S,oldIndex:b,newIndex:C}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function bje(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Mn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hU(r){r=Yp(r,Dc);const t=Yp(r.firestore,pR);return ije(kF(t),r._key).then(s=>Ije(t,r,s))}class Qne extends yje{constructor(t){super(),this.firestore=t}convertBytes(t){return new IS(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new Dc(this.firestore,null,s)}}function wje(r){r=Yp(r,WN);const t=Yp(r.firestore,pR),s=kF(t),a=new Qne(t);return vje(r._query),sje(s,r._query).then(l=>new Tje(t,a,r,l))}function Rje(r,t,s){r=Yp(r,Dc);const a=Yp(r.firestore,pR),l=Sje(r.converter,t);return Zne(a,[fje(Hne(a),"setDoc",r._key,l,r.converter!==null,s).toMutation(r._key,yh.none())])}function Cje(r,t,s,...a){r=Yp(r,Dc);const l=Yp(r.firestore,pR),d=Hne(l);let g;return g=typeof(t=Ds(t))=="string"||t instanceof GN?gje(d,"updateDoc",r._key,t,s,a):mje(d,"updateDoc",r._key,t),Zne(l,[g.toMutation(r._key,yh.exists(!0))])}function Zne(r,t){return function(a,l){const d=new jp;return a.asyncQueue.enqueueAndForget(async()=>KFe(await rje(a),l,d)),d.promise}(kF(r),t)}function Ije(r,t,s){const a=s.docs.get(t._key),l=new Qne(r);return new Jne(r,l,t._key,a,new Wb(s.hasPendingWrites,s.fromCache),t.converter)}(function(t,s=!0){(function(l){FS=l})(tE),q_(new Dm("firestore",(a,{instanceIdentifier:l,options:d})=>{const g=a.getProvider("app").getImmediate(),E=new pR(new mUe(a.getProvider("auth-internal")),new EUe(g,a.getProvider("app-check-internal")),function(b,C){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new rn(St.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dw(b.options.projectId,C)}(g,l),g);return d=Object.assign({useFetchStreams:s},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),gh(v7,y7,t),gh(v7,y7,"esm2017")})();var Aje="firebase",Oje="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gh(Aje,Oje,"app");const Pje={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!0);console.log("import.meta.env:",Pje);const mm={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:mm.apiKey?`${mm.apiKey.substring(0,5)}...`:"missing",authDomain:mm.authDomain,projectId:mm.projectId,storageBucket:mm.storageBucket,messagingSenderId:mm.messagingSenderId?"present":"missing",appId:mm.appId?"present":"missing"});const ere=Mee(mm),Nje=yte(ere),AS=lje(ere),jm=async r=>{try{Ct.log("userFirestore: Get user Profile data for user ID: "+r);const t=Uw(AS,"users",r),s=await hU(t);return s.exists()?(Ct.log("userFirestore: Found Profile for : "+s.data().Nickname),s.data()):(Ct.error("userFirestore: user profile document not found"),null)}catch(t){throw Ct.error("userFirestore: Error fetching user profile data:",t),t}},kje=async(r,t,s)=>{try{const l=(await XMe(Nje,r,t)).user,d=Uw(AS,"users",l.uid);return await Rje(d,{email:l.email,createdAt:new Date,...s}),Ct.log("userFirestore: User created successfully."),l}catch(a){throw Ct.error("userFirestore: Error creating user:",a),a}},tre=async(r,t)=>{try{Ct.log(`userFirestore: Updating rpmURL for user ID: ${r}`);const s=Uw(AS,"users",r);await Cje(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),Ct.log("userFirestore: rpmURL updated successfully.")}catch(s){throw Ct.error("userFirestore: Error updating rpmURL:",s),s}},Dje=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile"],Gb={sendUserToUnity:"sendUserToUnity"};class Lje{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),Ct.log(`EventBus: Published event '${t}'`)):Ct.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const zb=new Lje,au=j.createContext(null),xje=({children:r})=>{const[t,s]=j.useState(null),a=j.useRef(null),[l,d]=j.useState(!0),g=yte(),E=G=>G?G.Nickname?G.Nickname:`${G.firstName} ${G.lastName}`:"Anon";j.useEffect(()=>{const G=e2e(g,async te=>{if(Ct.log("UserProvider: Firebase onAuthStateChanged() fired"),te)try{const J=await jm(te.uid),re=E(J),fe={uid:te.uid,email:te.email,...J,displayName:re};console.log(fe),s(fe),a.current=fe,O(fe)}catch(J){Ct.error("UserProvider: Error fetching user profile data:",J)}else s(null),a.current=null;d(!1)});return()=>{G&&G()}},[]);const S=async(G,te,J)=>{try{const{firstName:re,lastName:fe}=J,oe=`${re}${fe.charAt(0).toUpperCase()}`,be={...J,Nickname:oe,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"},Z=await kje(G,te,be);s(Z),a.current=Z}catch(re){throw Ct.error("UserProvider: Error creating user:",re),re}},b=async(G,te)=>{try{const J=await JMe(g,G,te),re=await jm(J.user.uid),fe=E(re),oe={uid:J.user.uid,email:J.user.email,...re,displayName:fe};s(oe),O(oe)}catch(J){throw Ct.error("UserProvider: Error signing in:",J),J}},C=async()=>{try{await t2e(g),s(null),Ct.log("UserProvider: User signed out.")}catch(G){throw Ct.error("UserProvider: Error signing out:",G),G}},O=()=>{const G=a.current;if(G){const te=k(G);Ct.log("UserProvider: sendUserToUnity() using the eventBus",te),zb.publish(Gb.sendUserToUnity,te)}else Ct.log("UserProvider: No current user to send to Unity.")},k=G=>{const te={};return[...Dje,"uid"].forEach(re=>{G.hasOwnProperty(re)&&(te[re]=G[re])}),te},W=async G=>{if(!t||!t.uid)return!1;try{const te=await getSpaceItem(G);return te.usersAllowed.includes(t.uid)||te.userAdmin.includes(t.uid)||te.usersModerators.includes(t.uid)}catch(te){return Ct.error("UserProvider: Error verifying user access to space:",te),!1}},H=async G=>{if(!t||!t.uid)return!1;try{return(await getSpaceItem(G)).userAdmin.includes(t.uid)}catch(te){return Ct.error("UserProvider: Error verifying user admin status for space:",te),!1}},K=async G=>{if(!t||!t.uid)return!1;try{return(await getSpaceItem(G)).usersModerators.includes(t.uid)}catch(te){return Ct.error("UserProvider: Error verifying user moderator status for space:",te),!1}};return U.jsx(au.Provider,{value:{user:t,loading:l,register:S,signIn:b,signOut:C,sendUserToUnity:O,userHasAccessToSpace:W,userIsAdminOfSpace:H,userIsModeratorOfSpace:K},children:r})},nre=j.createContext(),nf=()=>j.useContext(nre),Mje=({children:r})=>{const[t,s]=j.useState(!1),a=j.useRef(null),[l,d]=j.useState(!1);j.useEffect(()=>{const S=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const g=j.useCallback(S=>{a.current=S},[]),E=j.useCallback(()=>{const S=a.current;if(!S)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=S.querySelector("video")||S;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),s(!0);return}catch(O){console.error("iOS fullscreen error:",O)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),s(!0);return}}catch(O){console.error("iOS fallback fullscreen error:",O)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(S.requestFullscreen?S.requestFullscreen():S.webkitRequestFullscreen?S.webkitRequestFullscreen():S.mozRequestFullScreen?S.mozRequestFullScreen():S.msRequestFullscreen&&S.msRequestFullscreen(),s(!0));return}catch(O){console.error("Android fullscreen error:",O)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):S.requestFullscreen?S.requestFullscreen().then(()=>{s(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):S.webkitRequestFullscreen?(S.webkitRequestFullscreen(),s(!0)):S.mozRequestFullScreen?(S.mozRequestFullScreen(),s(!0)):S.msRequestFullscreen&&(S.msRequestFullscreen(),s(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return j.useEffect(()=>{const S=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!b)};return document.addEventListener("fullscreenchange",S),document.addEventListener("webkitfullscreenchange",S),document.addEventListener("mozfullscreenchange",S),document.addEventListener("MSFullscreenChange",S),()=>{document.removeEventListener("fullscreenchange",S),document.removeEventListener("webkitfullscreenchange",S),document.removeEventListener("mozfullscreenchange",S),document.removeEventListener("MSFullscreenChange",S)}},[]),U.jsx(nre.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:g,isMobile:l},children:U.jsx("div",{ref:g,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:r})})};var xM={},fb={},mb={},pY;function Uje(){if(pY)return mb;pY=1,Object.defineProperty(mb,"__esModule",{value:!0}),mb.useUnityCanvasId=void 0;var r=iu(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,r.useMemo)(function(){return[s,++t].join("-")},[]);return d};return mb.useUnityCanvasId=a,mb}var Rp={},gb={},fY;function rre(){if(fY)return gb;fY=1,Object.defineProperty(gb,"__esModule",{value:!0}),gb.UnityLoaderStatus=void 0;var r;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(r||(gb.UnityLoaderStatus=r={})),gb}var _b={},mY;function FF(){return mY||(mY=1,Object.defineProperty(_b,"__esModule",{value:!0}),_b.isBrowserEnvironment=void 0,_b.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),_b}var gY;function Vje(){if(gY)return Rp;gY=1;var r=Rp&&Rp.__awaiter||function(g,E,S,b){function C(O){return O instanceof S?O:new S(function(k){k(O)})}return new(S||(S=Promise))(function(O,k){function W(G){try{K(b.next(G))}catch(te){k(te)}}function H(G){try{K(b.throw(G))}catch(te){k(te)}}function K(G){G.done?O(G.value):C(G.value).then(W,H)}K((b=b.apply(g,E||[])).next())})},t=Rp&&Rp.__generator||function(g,E){var S={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},b,C,O,k=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return k.next=W(0),k.throw=W(1),k.return=W(2),typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function W(K){return function(G){return H([K,G])}}function H(K){if(b)throw new TypeError("Generator is already executing.");for(;k&&(k=0,K[0]&&(S=0)),S;)try{if(b=1,C&&(O=K[0]&2?C.return:K[0]?C.throw||((O=C.return)&&O.call(C),0):C.next)&&!(O=O.call(C,K[1])).done)return O;switch(C=0,O&&(K=[K[0]&2,O.value]),K[0]){case 0:case 1:O=K;break;case 4:return S.label++,{value:K[1],done:!1};case 5:S.label++,C=K[1],K=[0];continue;case 7:K=S.ops.pop(),S.trys.pop();continue;default:if(O=S.trys,!(O=O.length>0&&O[O.length-1])&&(K[0]===6||K[0]===2)){S=0;continue}if(K[0]===3&&(!O||K[1]>O[0]&&K[1]<O[3])){S.label=K[1];break}if(K[0]===6&&S.label<O[1]){S.label=O[1],O=K;break}if(O&&S.label<O[2]){S.label=O[2],S.ops.push(K);break}O[2]&&S.ops.pop(),S.trys.pop();continue}K=E.call(g,S)}catch(G){K=[6,G],C=0}finally{b=O=0}if(K[0]&5)throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(Rp,"__esModule",{value:!0}),Rp.useUnityInstance=void 0;var s=iu(),a=rre(),l=FF(),d=function(g,E,S,b){(0,s.useEffect)(function(){(function(){return r(void 0,void 0,void 0,function(){var C,O;return t(this,function(k){switch(k.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(g!==a.UnityLoaderStatus.Loaded||E===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];k.label=1;case 1:return k.trys.push([1,3,,4]),[4,window.createUnityInstance(E,S,b.setLoadingProgression)];case 2:return C=k.sent(),b.setUnityInstance(C),b.setInitialisationError(null),[3,4];case 3:return O=k.sent(),b.setUnityInstance(null),b.setInitialisationError(O),[3,4];case 4:return[2]}})})})()},[g,E,S,b])};return Rp.useUnityInstance=d,Rp}var Eb={},_Y;function Fje(){if(_Y)return Eb;_Y=1,Object.defineProperty(Eb,"__esModule",{value:!0}),Eb.useUnityArguments=void 0;var r=iu(),t=function(s){return(0,r.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return Eb.useUnityArguments=t,Eb}var vb={},EY;function jje(){if(EY)return vb;EY=1,Object.defineProperty(vb,"__esModule",{value:!0}),vb.useUnityLoader=void 0;var r=iu(),t=FF(),s=rre(),a=function(l){var d=(0,r.useState)(s.UnityLoaderStatus.Loading),g=d[0],E=d[1];return(0,r.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(s.UnityLoaderStatus.Idle);return}var S=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));S===null?(S=window.document.createElement("script"),S.type="text/javascript",S.src=l.loaderUrl,S.async=!0,S.setAttribute("data-status","loading"),window.document.body.appendChild(S),S.addEventListener("load",function(){return S==null?void 0:S.setAttribute("data-status","loaded")}),S.addEventListener("error",function(){return S==null?void 0:S.setAttribute("data-status","error")})):E(S.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var b=function(C){return E(C.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return S.addEventListener("load",b),S.addEventListener("error",b),function(){S!==null&&(S.removeEventListener("load",b),S.removeEventListener("error",b),window.document.body.removeChild(S))}}},[l.loaderUrl]),g};return vb.useUnityLoader=a,vb}var vY;function Bje(){if(vY)return fb;vY=1,Object.defineProperty(fb,"__esModule",{value:!0}),fb.Unity=void 0;var r=iu(),t=iu(),s=Uje(),a=Vje(),l=Fje(),d=jje(),g=(0,t.forwardRef)(function(E,S){var b=(0,t.useRef)(null),C=(0,s.useUnityCanvasId)(E),O=(0,l.useUnityArguments)(E),k=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(k,b.current,O,E.unityProvider),(0,r.useImperativeHandle)(S,function(){return b.current}),(0,r.createElement)("canvas",{ref:b,id:C,style:E.style,className:E.className,tabIndex:E.tabIndex})});return fb.Unity=g,fb}var Cp={},yb={},yY;function ire(){if(yY)return yb;yY=1,Object.defineProperty(yb,"__esModule",{value:!0}),yb.errorMessages=void 0;var r={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return yb.errorMessages=r,yb}var v_={},SY;function Wje(){if(SY)return v_;SY=1;var r=v_&&v_.__spreadArray||function(E,S,b){if(b||arguments.length===2)for(var C=0,O=S.length,k;C<O;C++)(k||!(C in S))&&(k||(k=Array.prototype.slice.call(S,0,C)),k[C]=S[C]);return E.concat(k||Array.prototype.slice.call(S))};Object.defineProperty(v_,"__esModule",{value:!0}),v_.useEventSystem=void 0;var t=iu(),s=ire(),a=FF(),l=[],d=function(E){for(var S=[],b=1;b<arguments.length;b++)S[b-1]=arguments[b];var C=void 0;return l.forEach(function(O){C=O.apply(void 0,r([E],S,!1))}),C};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var g=function(){var E=(0,t.useRef)([]),S=(0,t.useCallback)(function(O,k){E.current=r(r([],E.current,!0),[{eventName:O,callback:k}],!1)},[E]),b=(0,t.useCallback)(function(O,k){E.current=E.current.filter(function(W){return W.eventName!==O&&W.callback!==k})},[E]),C=(0,t.useCallback)(function(O){for(var k=[],W=1;W<arguments.length;W++)k[W-1]=arguments[W];var H=E.current.find(function(K){return K.eventName===O});if(typeof H>"u"){console.warn(s.errorMessages.noEventListener,{eventName:O});return}return H.callback.apply(H,k)},[E]);return(0,t.useEffect)(function(){return l.push(C),function(){l.splice(l.indexOf(C),1)}},[C]),{addEventListener:S,removeEventListener:b}};return v_.useEventSystem=g,v_}var Sb={},TY;function Gje(){if(TY)return Sb;TY=1,Object.defineProperty(Sb,"__esModule",{value:!0}),Sb.useNullableState=void 0;var r=iu(),t=function(s){return(0,r.useState)(s||null)};return Sb.useNullableState=t,Sb}var bY;function zje(){if(bY)return Cp;bY=1;var r=Cp&&Cp.__awaiter||function(E,S,b,C){function O(k){return k instanceof b?k:new b(function(W){W(k)})}return new(b||(b=Promise))(function(k,W){function H(te){try{G(C.next(te))}catch(J){W(J)}}function K(te){try{G(C.throw(te))}catch(J){W(J)}}function G(te){te.done?k(te.value):O(te.value).then(H,K)}G((C=C.apply(E,S||[])).next())})},t=Cp&&Cp.__generator||function(E,S){var b={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},C,O,k,W=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return W.next=H(0),W.throw=H(1),W.return=H(2),typeof Symbol=="function"&&(W[Symbol.iterator]=function(){return this}),W;function H(G){return function(te){return K([G,te])}}function K(G){if(C)throw new TypeError("Generator is already executing.");for(;W&&(W=0,G[0]&&(b=0)),b;)try{if(C=1,O&&(k=G[0]&2?O.return:G[0]?O.throw||((k=O.return)&&k.call(O),0):O.next)&&!(k=k.call(O,G[1])).done)return k;switch(O=0,k&&(G=[G[0]&2,k.value]),G[0]){case 0:case 1:k=G;break;case 4:return b.label++,{value:G[1],done:!1};case 5:b.label++,O=G[1],G=[0];continue;case 7:G=b.ops.pop(),b.trys.pop();continue;default:if(k=b.trys,!(k=k.length>0&&k[k.length-1])&&(G[0]===6||G[0]===2)){b=0;continue}if(G[0]===3&&(!k||G[1]>k[0]&&G[1]<k[3])){b.label=G[1];break}if(G[0]===6&&b.label<k[1]){b.label=k[1],k=G;break}if(k&&b.label<k[2]){b.label=k[2],b.ops.push(G);break}k[2]&&b.ops.pop(),b.trys.pop();continue}G=S.call(E,b)}catch(te){G=[6,te],O=0}finally{C=k=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}};Object.defineProperty(Cp,"__esModule",{value:!0}),Cp.useUnityContext=void 0;var s=iu(),a=ire(),l=Wje(),d=Gje(),g=function(E){var S=(0,d.useNullableState)(),b=S[0],C=S[1],O=(0,s.useState)(0),k=O[0],W=O[1],H=(0,s.useState)(!1),K=H[0],G=H[1],te=(0,d.useNullableState)(),J=te[0],re=te[1],fe=(0,l.useEventSystem)(),oe=(0,s.useRef)({setLoadingProgression:W,setInitialisationError:re,setUnityInstance:C,setIsLoaded:G,unityConfig:E}),be=(0,s.useCallback)(function(he){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(he===!0?1:0)},[b]),Z=(0,s.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),ne=(0,s.useCallback)(function(he,le,Me){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(he,le,Me)},[b]),se=(0,s.useCallback)(function(he,le){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(he,le)},[b]),ue=(0,s.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),Ee=(0,s.useCallback)(function(){return r(void 0,void 0,void 0,function(){var he;return t(this,function(le){switch(le.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(he=b.Module.canvas,document.body.appendChild(he),he.style.display="none",[4,ue()]);case 1:return le.sent(),he.remove(),[2]}})})},[b]);return(0,s.useEffect)(function(){G(k===1)},[k]),{unityProvider:oe.current,loadingProgression:k,initialisationError:J,isLoaded:K,UNSAFE__unityInstance:b,requestFullscreen:be,requestPointerLock:Z,sendMessage:ne,takeScreenshot:se,unload:ue,UNSAFE__detachAndUnloadImmediate:Ee,addEventListener:fe.addEventListener,removeEventListener:fe.removeEventListener}};return Cp.useUnityContext=g,Cp}var wY;function Hje(){return wY||(wY=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.useUnityContext=r.Unity=void 0;var t=Bje();Object.defineProperty(r,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=zje();Object.defineProperty(r,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(xM)),xM}var sre=Hje();const Qu="[UnityProvider]",ore=j.createContext(),Kje=({spaceID:r,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:g,showLoginButton:E,showDisruptiveLogo:S})=>{Ct.log(`${Qu} Initializing with spaceID:`,r),Ct.log(`${Qu} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:C,isLoaded:O,sendMessage:k,addEventListener:W,removeEventListener:H,error:K}=sre.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),G=j.useRef(null),te=j.useRef(Date.now());j.useEffect(()=>{const oe=()=>{document.hidden?(Ct.log(`${Qu} Page hidden, starting keep-alive`),J()):(Ct.log(`${Qu} Page visible, stopping keep-alive`),re())};return document.addEventListener("visibilitychange",oe),()=>{document.removeEventListener("visibilitychange",oe),re()}},[]),j.useEffect(()=>{const oe=()=>{te.current=Date.now(),document.hidden&&k("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",oe),window.addEventListener("keydown",oe),window.addEventListener("touchstart",oe),()=>{window.removeEventListener("mousemove",oe),window.removeEventListener("keydown",oe),window.removeEventListener("touchstart",oe)}},[k]);const J=()=>{G.current||(G.current=setInterval(()=>{O&&document.hidden&&(k("WebGLInputManager","KeepAlive"),Ct.debug(`${Qu} Sent keep-alive message`))},1e4))},re=()=>{G.current&&(clearInterval(G.current),G.current=null)};j.useEffect(()=>(Ct.log(`${Qu} Component mounted`),()=>{Ct.log(`${Qu} Component unmounting`),re()}),[]),j.useEffect(()=>{Ct.log(`${Qu} Loading progress:`,C)},[C]),j.useEffect(()=>{O&&(Ct.log(`${Qu} Unity instance loaded for:`,r),document.hidden&&J())},[O,r]),j.useEffect(()=>{K&&Ct.error(`${Qu} Unity error:`,K)},[K]);const fe={spaceID:r,unityProvider:b,loadingProgression:C,isLoaded:O,sendMessage:k,addEventListener:W,removeEventListener:H};return Ct.log(`${Qu} Rendering provider with instance:`,fe),U.jsx(ore.Provider,{value:fe,children:t})},GS=()=>j.useContext(ore);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const are="firebasestorage.googleapis.com",cre="storageBucket",$je=2*60*1e3,qje=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fo extends Ih{constructor(t,s,a=0){super(MM(t),`Firebase Storage: ${s} (${MM(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,fo.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return MM(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var po;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(po||(po={}));function MM(r){return"storage/"+r}function lre(){const r="An unknown error occurred, please check the error payload for server response.";return new fo(po.UNKNOWN,r)}function Yje(r){return new fo(po.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function Xje(r){return new fo(po.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Jje(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new fo(po.UNAUTHENTICATED,r)}function Qje(){return new fo(po.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Zje(r){return new fo(po.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function eBe(){return new fo(po.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function tBe(){return new fo(po.CANCELED,"User canceled the upload/download.")}function nBe(r){return new fo(po.INVALID_URL,"Invalid URL '"+r+"'.")}function rBe(r){return new fo(po.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function iBe(){return new fo(po.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+cre+"' property when initializing the app?")}function sBe(){return new fo(po.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function pU(r){return new fo(po.INVALID_ARGUMENT,r)}function ure(){return new fo(po.APP_DELETED,"The Firebase app was deleted.")}function oBe(r){return new fo(po.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Tb(r){throw new fo(po.INTERNAL_ERROR,"Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=cl.makeFromUrl(t,s)}catch{return new cl(t,"")}if(a.path==="")return a;throw rBe(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(fe){fe.path.charAt(fe.path.length-1)==="/"&&(fe.path_=fe.path_.slice(0,-1))}const g="(/(.*))?$",E=new RegExp("^gs://"+l+g,"i"),S={bucket:1,path:3};function b(fe){fe.path_=decodeURIComponent(fe.path)}const C="v[A-Za-z0-9_]+",O=s.replace(/[.]/g,"\\."),k="(/([^?#]*).*)?$",W=new RegExp(`^https?://${O}/${C}/b/${l}/o${k}`,"i"),H={bucket:1,path:3},K=s===are?"(?:storage.googleapis.com|storage.cloud.google.com)":s,G="([^?#]*)",te=new RegExp(`^https?://${K}/${l}/${G}`,"i"),re=[{regex:E,indices:S,postModify:d},{regex:W,indices:H,postModify:b},{regex:te,indices:{bucket:1,path:2},postModify:b}];for(let fe=0;fe<re.length;fe++){const oe=re[fe],be=oe.regex.exec(t);if(be){const Z=be[oe.indices.bucket];let ne=be[oe.indices.path];ne||(ne=""),a=new cl(Z,ne),oe.postModify(a);break}}if(a==null)throw nBe(t);return a}}class aBe{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cBe(r,t,s){let a=1,l=null,d=null,g=!1,E=0;function S(){return E===2}let b=!1;function C(...G){b||(b=!0,t.apply(null,G))}function O(G){l=setTimeout(()=>{l=null,r(W,S())},G)}function k(){d&&clearTimeout(d)}function W(G,...te){if(b){k();return}if(G){k(),C.call(null,G,...te);return}if(S()||g){k(),C.call(null,G,...te);return}a<64&&(a*=2);let re;E===1?(E=2,re=0):re=(a+Math.random())*1e3,O(re)}let H=!1;function K(G){H||(H=!0,k(),!b&&(l!==null?(G||(E=2),clearTimeout(l),O(0)):G||(E=1)))}return O(0),d=setTimeout(()=>{g=!0,K(!0)},s),K}function lBe(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uBe(r){return r!==void 0}function dBe(r){return typeof r=="object"&&!Array.isArray(r)}function dre(r){return typeof r=="string"||r instanceof String}function RY(r,t,s,a){if(a<t)throw pU(`Invalid value for '${r}'. Expected ${t} or greater.`);if(a>s)throw pU(`Invalid value for '${r}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hre(r,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${r}`}function pre(r){const t=encodeURIComponent;let s="?";for(const a in r)if(r.hasOwnProperty(a)){const l=t(a)+"="+t(r[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var F_;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(F_||(F_={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hBe(r,t){const s=r>=500&&r<600,l=[408,429].indexOf(r)!==-1,d=t.indexOf(r)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pBe{constructor(t,s,a,l,d,g,E,S,b,C,O,k=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=g,this.callback_=E,this.errorCallback_=S,this.timeout_=b,this.progressCallback_=C,this.connectionFactory_=O,this.retry=k,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((W,H)=>{this.resolve_=W,this.reject_=H,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new AO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const g=E=>{const S=E.loaded,b=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(S,b)};this.progressCallback_!==null&&d.addUploadProgressListener(g),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(g),this.pendingConnection_=null;const E=d.getErrorCode()===F_.NO_ERROR,S=d.getStatus();if(!E||hBe(S,this.additionalRetryCodes_)&&this.retry){const C=d.getErrorCode()===F_.ABORT;a(!1,new AO(!1,null,C));return}const b=this.successCodes_.indexOf(S)!==-1;a(!0,new AO(b,d))})},s=(a,l)=>{const d=this.resolve_,g=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const S=this.callback_(E,E.getResponse());uBe(S)?d(S):d()}catch(S){g(S)}else if(E!==null){const S=lre();S.serverResponse=E.getErrorText(),this.errorCallback_?g(this.errorCallback_(E,S)):g(S)}else if(l.canceled){const S=this.appDelete_?ure():tBe();g(S)}else{const S=eBe();g(S)}};this.canceled_?s(!1,new AO(!1,null,!0)):this.backoffId_=cBe(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&lBe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class AO{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function fBe(r,t){t!==null&&t.length>0&&(r.Authorization="Firebase "+t)}function mBe(r,t){r["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function gBe(r,t){t&&(r["X-Firebase-GMPID"]=t)}function _Be(r,t){t!==null&&(r["X-Firebase-AppCheck"]=t)}function EBe(r,t,s,a,l,d,g=!0){const E=pre(r.urlParams),S=r.url+E,b=Object.assign({},r.headers);return gBe(b,t),fBe(b,s),mBe(b,d),_Be(b,a),new pBe(S,r.method,b,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,l,g)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fre(r){let t;try{t=JSON.parse(r)}catch{return null}return dBe(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vBe(r){if(r.length===0)return null;const t=r.lastIndexOf("/");return t===-1?"":r.slice(0,t)}function yBe(r,t){const s=t.split("/").filter(a=>a.length>0).join("/");return r.length===0?s:r+"/"+s}function mre(r){const t=r.lastIndexOf("/",r.length-2);return t===-1?r:r.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SBe(r,t){return t}class Va{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||SBe}}let OO=null;function TBe(r){return!dre(r)||r.length<2?r:mre(r)}function bBe(){if(OO)return OO;const r=[];r.push(new Va("bucket")),r.push(new Va("generation")),r.push(new Va("metageneration")),r.push(new Va("name","fullPath",!0));function t(d,g){return TBe(g)}const s=new Va("name");s.xform=t,r.push(s);function a(d,g){return g!==void 0?Number(g):g}const l=new Va("size");return l.xform=a,r.push(l),r.push(new Va("timeCreated")),r.push(new Va("updated")),r.push(new Va("md5Hash",null,!0)),r.push(new Va("cacheControl",null,!0)),r.push(new Va("contentDisposition",null,!0)),r.push(new Va("contentEncoding",null,!0)),r.push(new Va("contentLanguage",null,!0)),r.push(new Va("contentType",null,!0)),r.push(new Va("metadata","customMetadata",!0)),OO=r,OO}function wBe(r,t){function s(){const a=r.bucket,l=r.fullPath,d=new cl(a,l);return t._makeStorageReference(d)}Object.defineProperty(r,"ref",{get:s})}function RBe(r,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const g=s[d];a[g.local]=g.xform(a,t[g.server])}return wBe(a,r),a}function CBe(r,t,s){const a=fre(t);return a===null?null:RBe(r,a,s)}function IBe(r,t,s,a){const l=fre(t);if(l===null||!dre(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const g=encodeURIComponent;return d.split(",").map(b=>{const C=r.bucket,O=r.fullPath,k="/b/"+g(C)+"/o/"+g(O),W=hre(k,s,a),H=pre({alt:"media",token:b});return W+H})[0]}class ABe{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OBe(r){if(!r)throw lre()}function PBe(r,t){function s(a,l){const d=CBe(r,l,t);return OBe(d!==null),IBe(d,l,r.host,r._protocol)}return s}function NBe(r){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=Qje():l=Jje():s.getStatus()===402?l=Xje(r.bucket):s.getStatus()===403?l=Zje(r.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function kBe(r){const t=NBe(r);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=Yje(r.path)),d.serverResponse=l.serverResponse,d}return s}function DBe(r,t,s){const a=t.fullServerUrl(),l=hre(a,r.host,r._protocol),d="GET",g=r.maxOperationRetryTime,E=new ABe(l,d,PBe(r,s),g);return E.errorHandler=kBe(t),E}class LBe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=F_.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=F_.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=F_.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw Tb("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Tb("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Tb("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Tb("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Tb("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class xBe extends LBe{initXhr(){this.xhr_.responseType="text"}}function MBe(){return new xBe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z_{constructor(t,s){this._service=t,s instanceof cl?this._location=s:this._location=cl.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new Z_(t,s)}get root(){const t=new cl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return mre(this._location.path)}get storage(){return this._service}get parent(){const t=vBe(this._location.path);if(t===null)return null;const s=new cl(this._location.bucket,t);return new Z_(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw oBe(t)}}function UBe(r){r._throwIfRoot("getDownloadURL");const t=DBe(r.storage,r._location,bBe());return r.storage.makeRequestWithTokens(t,MBe).then(s=>{if(s===null)throw sBe();return s})}function VBe(r,t){const s=yBe(r._location.path,t),a=new cl(r._location.bucket,s);return new Z_(r.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FBe(r){return/^[A-Za-z]+:\/\//.test(r)}function jBe(r,t){return new Z_(r,t)}function gre(r,t){if(r instanceof jF){const s=r;if(s._bucket==null)throw iBe();const a=new Z_(s,s._bucket);return t!=null?gre(a,t):a}else return t!==void 0?VBe(r,t):r}function BBe(r,t){if(t&&FBe(t)){if(r instanceof jF)return jBe(r,t);throw pU("To use ref(service, url), the first argument must be a Storage instance.")}else return gre(r,t)}function CY(r,t){const s=t==null?void 0:t[cre];return s==null?null:cl.makeFromBucketSpec(s,r)}function WBe(r,t,s,a={}){r.host=`${t}:${s}`,r._protocol="http";const{mockUserToken:l}=a;l&&(r._overrideAuthToken=typeof l=="string"?l:Dee(l,r.app.options.projectId))}class jF{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=are,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=$je,this._maxUploadRetryTime=qje,this._requests=new Set,l!=null?this._bucket=cl.makeFromBucketSpec(l,this._host):this._bucket=CY(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=cl.makeFromBucketSpec(this._url,t):this._bucket=CY(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){RY("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){RY("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(sl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Z_(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new aBe(ure());{const g=EBe(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(g),g.getPromise().then(()=>this._requests.delete(g),()=>this._requests.delete(g)),g}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const IY="@firebase/storage",AY="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _re="storage";function GBe(r){return r=Ds(r),UBe(r)}function zBe(r,t){return r=Ds(r),BBe(r,t)}function HBe(r=QV(),t){r=Ds(r);const a=RN(r,_re).getImmediate({identifier:t}),l=Pee("storage");return l&&KBe(a,...l),a}function KBe(r,t,s,a={}){WBe(r,t,s,a)}function $Be(r,{instanceIdentifier:t}){const s=r.getProvider("app").getImmediate(),a=r.getProvider("auth-internal"),l=r.getProvider("app-check-internal");return new jF(s,a,l,t,tE)}function qBe(){q_(new Dm(_re,$Be,"PUBLIC").setMultipleInstances(!0)),gh(IY,AY,""),gh(IY,AY,"esm2017")}qBe();const Ere=async r=>{const t=HBe(),s=zBe(t,r);try{return await GBe(s)}catch(a){throw Ct.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let YBe={};const XBe=async r=>{try{const t=Uw(AS,"spaces",r),s=await hU(t);if(s.exists()){let a=s.data();if(a.webglBuildId){const l=Uw(AS,"webglBuilds",a.webglBuildId),d=await hU(l);if(d.exists()){const g=d.data();a={...a,...g}}else Ct.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await JBe(a),a=QBe(a),console.log("Space data:",a),Ct.log(`spacesFirestore: Caching space data for: ${r}`),YBe[r]=a,a}else return Ct.warn(`spacesFirestore: No document found for item ID: ${r}`),null}catch(t){throw Ct.error("spacesFirestore: Error fetching item data:",t),t}},JBe=async r=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=r[a];l&&l.startsWith("gs://")&&(r[a]=await Ere(l))});return await Promise.all(s),r},QBe=r=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=r;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let UM={};const vre=async r=>{Ct.log("spacesFirestore: Get Videos from Firestore for space: ",r);try{if(UM[r])return Ct.log("spacesFirestore: Returning cached videos for space:",r),UM[r];const t=cje(AS,`spaces/${r}/videos`),s=await wje(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),UM[r]=a,a}catch(t){throw Ct.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},KN=()=>{const{sendMessage:r,isLoaded:t}=GS(),s=j.useRef([]),a=j.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:g}=s.current.shift();Ct.log("useSendUnityEvent: Processing queued event to Unity:",d,g);try{r("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(g)}))}catch(E){Ct.error("useSendUnityEvent: Error sending event to Unity:",E),s.current.unshift({eventName:d,data:g});break}}},[r,t]);return j.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),j.useCallback((d,g)=>{Ct.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:g}),a()},[a])},fR=()=>{const{addEventListener:r,removeEventListener:t}=GS();return j.useCallback((s,a)=>{const l=d=>{Ct.log(s+" unity message received.");let g=null;if(d)try{g=JSON.parse(d)}catch(E){Ct.warn("Failed to parse JSON data from Unity message:",E)}a(g)};return r(s,l),()=>{t(s,l)}},[r,t])},ZBe=()=>{const[r,t]=j.useState(!1),s=fR();return j.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{Ct.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),r},e4e=r=>{const[t,s]=j.useState(null),a=fR(),{spaceID:l}=GS();return j.useEffect(()=>{let g=!0;const S=a("PlayVideo",async b=>{try{const{gameObjectName:C}=b;if(!C){Ct.error("Game object name is missing in Unity event data.");return}const O=await vre(l);Ct.log("SPACES VIDEOS",O);const k=O.find(W=>W.id===C);k&&g?(s(k.url),Ct.log("Video URL set to:",k.url)):console.error("Video not found for game object:",C)}catch(C){console.error("Error fetching space videos:",C)}});return()=>{g=!1,S()}},[a,l,r]),[t,()=>{s(null)}]},t4e=()=>{const r=fR(),{sendUserToUnity:t}=j.useContext(au);return j.useEffect(()=>{const a=r("RequestUserForUnity",()=>{Ct.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[r,t]),!0},n4e=()=>{const{spaceID:r}=GS(),t=KN();j.useEffect(()=>{(async()=>{try{if(!r)throw new Error("spaceID is not defined.");const a=await vre(r),l=async E=>{const S=`https://vimeo.com/api/oembed.json?url=${E}`,b=await fetch(S);if(!b.ok)throw new Error(`Failed to fetch thumbnail: ${b.statusText}`);const C=await b.json(),O=C.thumbnail_url.replace(/_\d+x\d+/,""),k=["640x360","295x166"];let W=null;for(let H of k){const K=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${O}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(K,{method:"HEAD"})).ok){W=K;break}}catch(G){console.warn(`Failed to validate thumbnail URL: ${K}`,G)}}return W||C.thumbnail_url},d=a.map(async E=>{const S=await l(E.url);return{gameObjectName:E.id,thumbnailUrl:S}}),g=await Promise.all(d);Ct.log("Fetched Thumbnails",g),g.forEach(({gameObjectName:E,thumbnailUrl:S})=>{t("SetThumbnail",{gameObjectName:E,thumbnailUrl:S})})}catch(a){Ct.error("Error fetching thumbnails:",a)}})()},[t,r])},r4e=()=>{const[r,t]=j.useState(null),s=fR();return console.log(" Nameplate click hook initialized"),j.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",g=>{if(console.log(" Nameplate click detected!",g),!g){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof g=="string"?JSON.parse(g):g;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[r,()=>{console.log(" Resetting nameplate data"),t(null)}]},yre=()=>{const[r,t]=j.useState([]),s=fR();return j.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(Ct.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},g=W=>{if(a){Ct.log("UpdatePlayerList unity message received.");try{let H=[];if(typeof W=="object"&&W!==null?H=W.players||[]:H=JSON.parse(W).players||[],Array.isArray(H)){const K=Array.from(new Map(H.map(G=>[G.playerId,G])).values());t(K),l&&(clearTimeout(l),l=null)}}catch(H){Ct.error("Error handling player list data:",H),l||(l=setTimeout(d,1e3))}}},E=()=>{Ct.log("Player disconnected, requesting fresh player list"),d()},S=()=>{Ct.log("Player left, requesting fresh player list"),d()};d();const b=s("UpdatePlayerList",g),C=s("PlayerDisconnected",E),O=s("PlayerLeft",S),k=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof C=="function"&&C(),typeof O=="function"&&O(),clearInterval(k)}},[s]),r},i4e=r=>({opacity:1});ai.string.isRequired,ai.func.isRequired;var mR=r=>r.type==="checkbox",P_=r=>r instanceof Date,Fa=r=>r==null;const Sre=r=>typeof r=="object";var Ts=r=>!Fa(r)&&!Array.isArray(r)&&Sre(r)&&!P_(r),s4e=r=>Ts(r)&&r.target?mR(r.target)?r.target.checked:r.target.value:r,o4e=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,a4e=(r,t)=>r.has(o4e(t)),c4e=r=>{const t=r.constructor&&r.constructor.prototype;return Ts(t)&&t.hasOwnProperty("isPrototypeOf")},BF=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ql(r){let t;const s=Array.isArray(r),a=typeof FileList<"u"?r instanceof FileList:!1;if(r instanceof Date)t=new Date(r);else if(r instanceof Set)t=new Set(r);else if(!(BF&&(r instanceof Blob||a))&&(s||Ts(r)))if(t=s?[]:{},!s&&!c4e(r))t=r;else for(const l in r)r.hasOwnProperty(l)&&(t[l]=Ql(r[l]));else return r;return t}var $N=r=>Array.isArray(r)?r.filter(Boolean):[],Ps=r=>r===void 0,Jt=(r,t,s)=>{if(!t||!Ts(r))return s;const a=$N(t.split(/[,[\].]+?/)).reduce((l,d)=>Fa(l)?l:l[d],r);return Ps(a)||a===r?Ps(r[t])?s:r[t]:a},rh=r=>typeof r=="boolean",WF=r=>/^\w*$/.test(r),Tre=r=>$N(r.replace(/["|']|\]/g,"").split(/\.|\[/)),ki=(r,t,s)=>{let a=-1;const l=WF(t)?[t]:Tre(t),d=l.length,g=d-1;for(;++a<d;){const E=l[a];let S=s;if(a!==g){const b=r[E];S=Ts(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(E==="__proto__"||E==="constructor"||E==="prototype")return;r[E]=S,r=r[E]}return r};const OY={BLUR:"blur",FOCUS_OUT:"focusout"},td={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Ip={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};Qr.createContext(null);var l4e=(r,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in r)Object.defineProperty(l,d,{get:()=>{const g=d;return t._proxyFormState[g]!==td.all&&(t._proxyFormState[g]=!a||td.all),r[g]}});return l},Rc=r=>Ts(r)&&!Object.keys(r).length,u4e=(r,t,s,a)=>{s(r);const{name:l,...d}=r;return Rc(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(g=>t[g]===td.all)},cP=r=>Array.isArray(r)?r:[r];function d4e(r){const t=Qr.useRef(r);t.current=r,Qr.useEffect(()=>{const s=!r.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[r.disabled])}var uh=r=>typeof r=="string",h4e=(r,t,s,a,l)=>uh(r)?(a&&t.watch.add(r),Jt(s,r,l)):Array.isArray(r)?r.map(d=>(a&&t.watch.add(d),Jt(s,d))):(a&&(t.watchAll=!0),s),p4e=(r,t,s,a,l)=>t?{...s[r],types:{...s[r]&&s[r].types?s[r].types:{},[a]:l||!0}}:{},PY=r=>({isOnSubmit:!r||r===td.onSubmit,isOnBlur:r===td.onBlur,isOnChange:r===td.onChange,isOnAll:r===td.all,isOnTouch:r===td.onTouched}),NY=(r,t,s)=>!s&&(t.watchAll||t.watch.has(r)||[...t.watch].some(a=>r.startsWith(a)&&/^\.\w+/.test(r.slice(a.length))));const lw=(r,t,s,a)=>{for(const l of s||Object.keys(r)){const d=Jt(r,l);if(d){const{_f:g,...E}=d;if(g){if(g.refs&&g.refs[0]&&t(g.refs[0],l)&&!a)return!0;if(g.ref&&t(g.ref,g.name)&&!a)return!0;if(lw(E,t))break}else if(Ts(E)&&lw(E,t))break}}};var f4e=(r,t,s)=>{const a=cP(Jt(r,s));return ki(a,"root",t[s]),ki(r,s,a),r},GF=r=>r.type==="file",ch=r=>typeof r=="function",KP=r=>{if(!BF)return!1;const t=r?r.ownerDocument:0;return r instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},lP=r=>uh(r),zF=r=>r.type==="radio",$P=r=>r instanceof RegExp;const kY={value:!1,isValid:!1},DY={value:!0,isValid:!0};var bre=r=>{if(Array.isArray(r)){if(r.length>1){const t=r.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!Ps(r[0].attributes.value)?Ps(r[0].value)||r[0].value===""?DY:{value:r[0].value,isValid:!0}:DY:kY}return kY};const LY={isValid:!1,value:null};var wre=r=>Array.isArray(r)?r.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,LY):LY;function xY(r,t,s="validate"){if(lP(r)||Array.isArray(r)&&r.every(lP)||rh(r)&&!r)return{type:s,message:lP(r)?r:"",ref:t}}var Ay=r=>Ts(r)&&!$P(r)?r:{value:r,message:""},MY=async(r,t,s,a,l,d)=>{const{ref:g,refs:E,required:S,maxLength:b,minLength:C,min:O,max:k,pattern:W,validate:H,name:K,valueAsNumber:G,mount:te}=r._f,J=Jt(s,K);if(!te||t.has(K))return{};const re=E?E[0]:g,fe=he=>{l&&re.reportValidity&&(re.setCustomValidity(rh(he)?"":he||""),re.reportValidity())},oe={},be=zF(g),Z=mR(g),ne=be||Z,se=(G||GF(g))&&Ps(g.value)&&Ps(J)||KP(g)&&g.value===""||J===""||Array.isArray(J)&&!J.length,ue=p4e.bind(null,K,a,oe),Ee=(he,le,Me,pt=Ip.maxLength,et=Ip.minLength)=>{const Oe=he?le:Me;oe[K]={type:he?pt:et,message:Oe,ref:g,...ue(he?pt:et,Oe)}};if(d?!Array.isArray(J)||!J.length:S&&(!ne&&(se||Fa(J))||rh(J)&&!J||Z&&!bre(E).isValid||be&&!wre(E).isValid)){const{value:he,message:le}=lP(S)?{value:!!S,message:S}:Ay(S);if(he&&(oe[K]={type:Ip.required,message:le,ref:re,...ue(Ip.required,le)},!a))return fe(le),oe}if(!se&&(!Fa(O)||!Fa(k))){let he,le;const Me=Ay(k),pt=Ay(O);if(!Fa(J)&&!isNaN(J)){const et=g.valueAsNumber||J&&+J;Fa(Me.value)||(he=et>Me.value),Fa(pt.value)||(le=et<pt.value)}else{const et=g.valueAsDate||new Date(J),Oe=it=>new Date(new Date().toDateString()+" "+it),Ue=g.type=="time",xe=g.type=="week";uh(Me.value)&&J&&(he=Ue?Oe(J)>Oe(Me.value):xe?J>Me.value:et>new Date(Me.value)),uh(pt.value)&&J&&(le=Ue?Oe(J)<Oe(pt.value):xe?J<pt.value:et<new Date(pt.value))}if((he||le)&&(Ee(!!he,Me.message,pt.message,Ip.max,Ip.min),!a))return fe(oe[K].message),oe}if((b||C)&&!se&&(uh(J)||d&&Array.isArray(J))){const he=Ay(b),le=Ay(C),Me=!Fa(he.value)&&J.length>+he.value,pt=!Fa(le.value)&&J.length<+le.value;if((Me||pt)&&(Ee(Me,he.message,le.message),!a))return fe(oe[K].message),oe}if(W&&!se&&uh(J)){const{value:he,message:le}=Ay(W);if($P(he)&&!J.match(he)&&(oe[K]={type:Ip.pattern,message:le,ref:g,...ue(Ip.pattern,le)},!a))return fe(le),oe}if(H){if(ch(H)){const he=await H(J,s),le=xY(he,re);if(le&&(oe[K]={...le,...ue(Ip.validate,le.message)},!a))return fe(le.message),oe}else if(Ts(H)){let he={};for(const le in H){if(!Rc(he)&&!a)break;const Me=xY(await H[le](J,s),re,le);Me&&(he={...Me,...ue(le,Me.message)},fe(Me.message),a&&(oe[K]=he))}if(!Rc(he)&&(oe[K]={ref:re,...he},!a))return oe}}return fe(!0),oe};function m4e(r,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)r=Ps(r)?a++:r[t[a++]];return r}function g4e(r){for(const t in r)if(r.hasOwnProperty(t)&&!Ps(r[t]))return!1;return!0}function Hs(r,t){const s=Array.isArray(t)?t:WF(t)?[t]:Tre(t),a=s.length===1?r:m4e(r,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(Ts(a)&&Rc(a)||Array.isArray(a)&&g4e(a))&&Hs(r,s.slice(0,-1)),r}var VM=()=>{let r=[];return{get observers(){return r},next:l=>{for(const d of r)d.next&&d.next(l)},subscribe:l=>(r.push(l),{unsubscribe:()=>{r=r.filter(d=>d!==l)}}),unsubscribe:()=>{r=[]}}},fU=r=>Fa(r)||!Sre(r);function Tm(r,t){if(fU(r)||fU(t))return r===t;if(P_(r)&&P_(t))return r.getTime()===t.getTime();const s=Object.keys(r),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=r[l];if(!a.includes(l))return!1;if(l!=="ref"){const g=t[l];if(P_(d)&&P_(g)||Ts(d)&&Ts(g)||Array.isArray(d)&&Array.isArray(g)?!Tm(d,g):d!==g)return!1}}return!0}var Rre=r=>r.type==="select-multiple",_4e=r=>zF(r)||mR(r),FM=r=>KP(r)&&r.isConnected,Cre=r=>{for(const t in r)if(ch(r[t]))return!0;return!1};function qP(r,t={}){const s=Array.isArray(r);if(Ts(r)||s)for(const a in r)Array.isArray(r[a])||Ts(r[a])&&!Cre(r[a])?(t[a]=Array.isArray(r[a])?[]:{},qP(r[a],t[a])):Fa(r[a])||(t[a]=!0);return t}function Ire(r,t,s){const a=Array.isArray(r);if(Ts(r)||a)for(const l in r)Array.isArray(r[l])||Ts(r[l])&&!Cre(r[l])?Ps(t)||fU(s[l])?s[l]=Array.isArray(r[l])?qP(r[l],[]):{...qP(r[l])}:Ire(r[l],Fa(t)?{}:t[l],s[l]):s[l]=!Tm(r[l],t[l]);return s}var bb=(r,t)=>Ire(r,t,qP(t)),Are=(r,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>Ps(r)?r:t?r===""?NaN:r&&+r:s&&uh(r)?new Date(r):a?a(r):r;function jM(r){const t=r.ref;return GF(t)?t.files:zF(t)?wre(r.refs).value:Rre(t)?[...t.selectedOptions].map(({value:s})=>s):mR(t)?bre(r.refs).value:Are(Ps(t.value)?r.ref.value:t.value,r)}var E4e=(r,t,s,a)=>{const l={};for(const d of r){const g=Jt(t,d);g&&ki(l,d,g._f)}return{criteriaMode:s,names:[...r],fields:l,shouldUseNativeValidation:a}},wb=r=>Ps(r)?r:$P(r)?r.source:Ts(r)?$P(r.value)?r.value.source:r.value:r;const UY="AsyncFunction";var v4e=r=>!!r&&!!r.validate&&!!(ch(r.validate)&&r.validate.constructor.name===UY||Ts(r.validate)&&Object.values(r.validate).find(t=>t.constructor.name===UY)),y4e=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate);function VY(r,t,s){const a=Jt(r,s);if(a||WF(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),g=Jt(t,d),E=Jt(r,d);if(g&&!Array.isArray(g)&&s!==d)return{name:s};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:s}}var S4e=(r,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||r):(s?a.isOnBlur:l.isOnBlur)?!r:(s?a.isOnChange:l.isOnChange)?r:!0,T4e=(r,t)=>!$N(Jt(r,t)).length&&Hs(r,t);const b4e={mode:td.onSubmit,reValidateMode:td.onChange,shouldFocusError:!0};function w4e(r={}){let t={...b4e,...r},s={submitCount:0,isDirty:!1,isLoading:ch(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=Ts(t.defaultValues)||Ts(t.values)?Ql(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Ql(l),g={action:!1,mount:!1,watch:!1},E={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},S,b=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},O={values:VM(),array:VM(),state:VM()},k=PY(t.mode),W=PY(t.reValidateMode),H=t.criteriaMode===td.all,K=ve=>Ne=>{clearTimeout(b),b=setTimeout(ve,Ne)},G=async ve=>{if(!t.disabled&&(C.isValid||ve)){const Ne=t.resolver?Rc((await ne()).errors):await ue(a,!0);Ne!==s.isValid&&O.state.next({isValid:Ne})}},te=(ve,Ne)=>{!t.disabled&&(C.isValidating||C.validatingFields)&&((ve||Array.from(E.mount)).forEach(We=>{We&&(Ne?ki(s.validatingFields,We,Ne):Hs(s.validatingFields,We))}),O.state.next({validatingFields:s.validatingFields,isValidating:!Rc(s.validatingFields)}))},J=(ve,Ne=[],We,ut,ft=!0,mt=!0)=>{if(ut&&We&&!t.disabled){if(g.action=!0,mt&&Array.isArray(Jt(a,ve))){const Ut=We(Jt(a,ve),ut.argA,ut.argB);ft&&ki(a,ve,Ut)}if(mt&&Array.isArray(Jt(s.errors,ve))){const Ut=We(Jt(s.errors,ve),ut.argA,ut.argB);ft&&ki(s.errors,ve,Ut),T4e(s.errors,ve)}if(C.touchedFields&&mt&&Array.isArray(Jt(s.touchedFields,ve))){const Ut=We(Jt(s.touchedFields,ve),ut.argA,ut.argB);ft&&ki(s.touchedFields,ve,Ut)}C.dirtyFields&&(s.dirtyFields=bb(l,d)),O.state.next({name:ve,isDirty:he(ve,Ne),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else ki(d,ve,Ne)},re=(ve,Ne)=>{ki(s.errors,ve,Ne),O.state.next({errors:s.errors})},fe=ve=>{s.errors=ve,O.state.next({errors:s.errors,isValid:!1})},oe=(ve,Ne,We,ut)=>{const ft=Jt(a,ve);if(ft){const mt=Jt(d,ve,Ps(We)?Jt(l,ve):We);Ps(mt)||ut&&ut.defaultChecked||Ne?ki(d,ve,Ne?mt:jM(ft._f)):pt(ve,mt),g.mount&&G()}},be=(ve,Ne,We,ut,ft)=>{let mt=!1,Ut=!1;const pn={name:ve};if(!t.disabled){const Nn=!!(Jt(a,ve)&&Jt(a,ve)._f&&Jt(a,ve)._f.disabled);if(!We||ut){C.isDirty&&(Ut=s.isDirty,s.isDirty=pn.isDirty=he(),mt=Ut!==pn.isDirty);const tn=Nn||Tm(Jt(l,ve),Ne);Ut=!!(!Nn&&Jt(s.dirtyFields,ve)),tn||Nn?Hs(s.dirtyFields,ve):ki(s.dirtyFields,ve,!0),pn.dirtyFields=s.dirtyFields,mt=mt||C.dirtyFields&&Ut!==!tn}if(We){const tn=Jt(s.touchedFields,ve);tn||(ki(s.touchedFields,ve,We),pn.touchedFields=s.touchedFields,mt=mt||C.touchedFields&&tn!==We)}mt&&ft&&O.state.next(pn)}return mt?pn:{}},Z=(ve,Ne,We,ut)=>{const ft=Jt(s.errors,ve),mt=C.isValid&&rh(Ne)&&s.isValid!==Ne;if(t.delayError&&We?(S=K(()=>re(ve,We)),S(t.delayError)):(clearTimeout(b),S=null,We?ki(s.errors,ve,We):Hs(s.errors,ve)),(We?!Tm(ft,We):ft)||!Rc(ut)||mt){const Ut={...ut,...mt&&rh(Ne)?{isValid:Ne}:{},errors:s.errors,name:ve};s={...s,...Ut},O.state.next(Ut)}},ne=async ve=>{te(ve,!0);const Ne=await t.resolver(d,t.context,E4e(ve||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return te(ve),Ne},se=async ve=>{const{errors:Ne}=await ne(ve);if(ve)for(const We of ve){const ut=Jt(Ne,We);ut?ki(s.errors,We,ut):Hs(s.errors,We)}else s.errors=Ne;return Ne},ue=async(ve,Ne,We={valid:!0})=>{for(const ut in ve){const ft=ve[ut];if(ft){const{_f:mt,...Ut}=ft;if(mt){const pn=E.array.has(mt.name),Nn=ft._f&&v4e(ft._f);Nn&&C.validatingFields&&te([ut],!0);const tn=await MY(ft,E.disabled,d,H,t.shouldUseNativeValidation&&!Ne,pn);if(Nn&&C.validatingFields&&te([ut]),tn[mt.name]&&(We.valid=!1,Ne))break;!Ne&&(Jt(tn,mt.name)?pn?f4e(s.errors,tn,mt.name):ki(s.errors,mt.name,tn[mt.name]):Hs(s.errors,mt.name))}!Rc(Ut)&&await ue(Ut,Ne,We)}}return We.valid},Ee=()=>{for(const ve of E.unMount){const Ne=Jt(a,ve);Ne&&(Ne._f.refs?Ne._f.refs.every(We=>!FM(We)):!FM(Ne._f.ref))&&_t(ve)}E.unMount=new Set},he=(ve,Ne)=>!t.disabled&&(ve&&Ne&&ki(d,ve,Ne),!Tm(Ae(),l)),le=(ve,Ne,We)=>h4e(ve,E,{...g.mount?d:Ps(Ne)?l:uh(ve)?{[ve]:Ne}:Ne},We,Ne),Me=ve=>$N(Jt(g.mount?d:l,ve,t.shouldUnregister?Jt(l,ve,[]):[])),pt=(ve,Ne,We={})=>{const ut=Jt(a,ve);let ft=Ne;if(ut){const mt=ut._f;mt&&(!mt.disabled&&ki(d,ve,Are(Ne,mt)),ft=KP(mt.ref)&&Fa(Ne)?"":Ne,Rre(mt.ref)?[...mt.ref.options].forEach(Ut=>Ut.selected=ft.includes(Ut.value)):mt.refs?mR(mt.ref)?mt.refs.length>1?mt.refs.forEach(Ut=>(!Ut.defaultChecked||!Ut.disabled)&&(Ut.checked=Array.isArray(ft)?!!ft.find(pn=>pn===Ut.value):ft===Ut.value)):mt.refs[0]&&(mt.refs[0].checked=!!ft):mt.refs.forEach(Ut=>Ut.checked=Ut.value===ft):GF(mt.ref)?mt.ref.value="":(mt.ref.value=ft,mt.ref.type||O.values.next({name:ve,values:{...d}})))}(We.shouldDirty||We.shouldTouch)&&be(ve,ft,We.shouldTouch,We.shouldDirty,!0),We.shouldValidate&&it(ve)},et=(ve,Ne,We)=>{for(const ut in Ne){const ft=Ne[ut],mt=`${ve}.${ut}`,Ut=Jt(a,mt);(E.array.has(ve)||Ts(ft)||Ut&&!Ut._f)&&!P_(ft)?et(mt,ft,We):pt(mt,ft,We)}},Oe=(ve,Ne,We={})=>{const ut=Jt(a,ve),ft=E.array.has(ve),mt=Ql(Ne);ki(d,ve,mt),ft?(O.array.next({name:ve,values:{...d}}),(C.isDirty||C.dirtyFields)&&We.shouldDirty&&O.state.next({name:ve,dirtyFields:bb(l,d),isDirty:he(ve,mt)})):ut&&!ut._f&&!Fa(mt)?et(ve,mt,We):pt(ve,mt,We),NY(ve,E)&&O.state.next({...s}),O.values.next({name:g.mount?ve:void 0,values:{...d}})},Ue=async ve=>{g.mount=!0;const Ne=ve.target;let We=Ne.name,ut=!0;const ft=Jt(a,We),mt=()=>Ne.type?jM(ft._f):s4e(ve),Ut=pn=>{ut=Number.isNaN(pn)||P_(pn)&&isNaN(pn.getTime())||Tm(pn,Jt(d,We,pn))};if(ft){let pn,Nn;const tn=mt(),ur=ve.type===OY.BLUR||ve.type===OY.FOCUS_OUT,Ga=!y4e(ft._f)&&!t.resolver&&!Jt(s.errors,We)&&!ft._f.deps||S4e(ur,Jt(s.touchedFields,We),s.isSubmitted,W,k),Nt=NY(We,E,ur);ki(d,We,tn),ur?(ft._f.onBlur&&ft._f.onBlur(ve),S&&S(0)):ft._f.onChange&&ft._f.onChange(ve);const Zt=be(We,tn,ur,!1),Wi=!Rc(Zt)||Nt;if(!ur&&O.values.next({name:We,type:ve.type,values:{...d}}),Ga)return C.isValid&&(t.mode==="onBlur"&&ur?G():ur||G()),Wi&&O.state.next({name:We,...Nt?{}:Zt});if(!ur&&Nt&&O.state.next({...s}),t.resolver){const{errors:bs}=await ne([We]);if(Ut(tn),ut){const Ls=VY(s.errors,a,We),ci=VY(bs,a,Ls.name||We);pn=ci.error,We=ci.name,Nn=Rc(bs)}}else te([We],!0),pn=(await MY(ft,E.disabled,d,H,t.shouldUseNativeValidation))[We],te([We]),Ut(tn),ut&&(pn?Nn=!1:C.isValid&&(Nn=await ue(a,!0)));ut&&(ft._f.deps&&it(ft._f.deps),Z(We,Nn,pn,Zt))}},xe=(ve,Ne)=>{if(Jt(s.errors,Ne)&&ve.focus)return ve.focus(),1},it=async(ve,Ne={})=>{let We,ut;const ft=cP(ve);if(t.resolver){const mt=await se(Ps(ve)?ve:ft);We=Rc(mt),ut=ve?!ft.some(Ut=>Jt(mt,Ut)):We}else ve?(ut=(await Promise.all(ft.map(async mt=>{const Ut=Jt(a,mt);return await ue(Ut&&Ut._f?{[mt]:Ut}:Ut)}))).every(Boolean),!(!ut&&!s.isValid)&&G()):ut=We=await ue(a);return O.state.next({...!uh(ve)||C.isValid&&We!==s.isValid?{}:{name:ve},...t.resolver||!ve?{isValid:We}:{},errors:s.errors}),Ne.shouldFocus&&!ut&&lw(a,xe,ve?ft:E.mount),ut},Ae=ve=>{const Ne={...g.mount?d:l};return Ps(ve)?Ne:uh(ve)?Jt(Ne,ve):ve.map(We=>Jt(Ne,We))},$e=(ve,Ne)=>({invalid:!!Jt((Ne||s).errors,ve),isDirty:!!Jt((Ne||s).dirtyFields,ve),error:Jt((Ne||s).errors,ve),isValidating:!!Jt(s.validatingFields,ve),isTouched:!!Jt((Ne||s).touchedFields,ve)}),Ze=ve=>{ve&&cP(ve).forEach(Ne=>Hs(s.errors,Ne)),O.state.next({errors:ve?s.errors:{}})},Fe=(ve,Ne,We)=>{const ut=(Jt(a,ve,{_f:{}})._f||{}).ref,ft=Jt(s.errors,ve)||{},{ref:mt,message:Ut,type:pn,...Nn}=ft;ki(s.errors,ve,{...Nn,...Ne,ref:ut}),O.state.next({name:ve,errors:s.errors,isValid:!1}),We&&We.shouldFocus&&ut&&ut.focus&&ut.focus()},ct=(ve,Ne)=>ch(ve)?O.values.subscribe({next:We=>ve(le(void 0,Ne),We)}):le(ve,Ne,!0),_t=(ve,Ne={})=>{for(const We of ve?cP(ve):E.mount)E.mount.delete(We),E.array.delete(We),Ne.keepValue||(Hs(a,We),Hs(d,We)),!Ne.keepError&&Hs(s.errors,We),!Ne.keepDirty&&Hs(s.dirtyFields,We),!Ne.keepTouched&&Hs(s.touchedFields,We),!Ne.keepIsValidating&&Hs(s.validatingFields,We),!t.shouldUnregister&&!Ne.keepDefaultValue&&Hs(l,We);O.values.next({values:{...d}}),O.state.next({...s,...Ne.keepDirty?{isDirty:he()}:{}}),!Ne.keepIsValid&&G()},Pt=({disabled:ve,name:Ne,field:We,fields:ut})=>{(rh(ve)&&g.mount||ve||E.disabled.has(Ne))&&(ve?E.disabled.add(Ne):E.disabled.delete(Ne),be(Ne,jM(We?We._f:Jt(ut,Ne)._f),!1,!1,!0))},Ht=(ve,Ne={})=>{let We=Jt(a,ve);const ut=rh(Ne.disabled)||rh(t.disabled);return ki(a,ve,{...We||{},_f:{...We&&We._f?We._f:{ref:{name:ve}},name:ve,mount:!0,...Ne}}),E.mount.add(ve),We?Pt({field:We,disabled:rh(Ne.disabled)?Ne.disabled:t.disabled,name:ve}):oe(ve,!0,Ne.value),{...ut?{disabled:Ne.disabled||t.disabled}:{},...t.progressive?{required:!!Ne.required,min:wb(Ne.min),max:wb(Ne.max),minLength:wb(Ne.minLength),maxLength:wb(Ne.maxLength),pattern:wb(Ne.pattern)}:{},name:ve,onChange:Ue,onBlur:Ue,ref:ft=>{if(ft){Ht(ve,Ne),We=Jt(a,ve);const mt=Ps(ft.value)&&ft.querySelectorAll&&ft.querySelectorAll("input,select,textarea")[0]||ft,Ut=_4e(mt),pn=We._f.refs||[];if(Ut?pn.find(Nn=>Nn===mt):mt===We._f.ref)return;ki(a,ve,{_f:{...We._f,...Ut?{refs:[...pn.filter(FM),mt,...Array.isArray(Jt(l,ve))?[{}]:[]],ref:{type:mt.type,name:ve}}:{ref:mt}}}),oe(ve,!1,void 0,mt)}else We=Jt(a,ve,{}),We._f&&(We._f.mount=!1),(t.shouldUnregister||Ne.shouldUnregister)&&!(a4e(E.array,ve)&&g.action)&&E.unMount.add(ve)}}},xt=()=>t.shouldFocusError&&lw(a,xe,E.mount),fn=ve=>{rh(ve)&&(O.state.next({disabled:ve}),lw(a,(Ne,We)=>{const ut=Jt(a,We);ut&&(Ne.disabled=ut._f.disabled||ve,Array.isArray(ut._f.refs)&&ut._f.refs.forEach(ft=>{ft.disabled=ut._f.disabled||ve}))},0,!1))},Rn=(ve,Ne)=>async We=>{let ut;We&&(We.preventDefault&&We.preventDefault(),We.persist&&We.persist());let ft=Ql(d);if(E.disabled.size)for(const mt of E.disabled)ki(ft,mt,void 0);if(O.state.next({isSubmitting:!0}),t.resolver){const{errors:mt,values:Ut}=await ne();s.errors=mt,ft=Ut}else await ue(a);if(Hs(s.errors,"root"),Rc(s.errors)){O.state.next({errors:{}});try{await ve(ft,We)}catch(mt){ut=mt}}else Ne&&await Ne({...s.errors},We),xt(),setTimeout(xt);if(O.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Rc(s.errors)&&!ut,submitCount:s.submitCount+1,errors:s.errors}),ut)throw ut},ln=(ve,Ne={})=>{Jt(a,ve)&&(Ps(Ne.defaultValue)?Oe(ve,Ql(Jt(l,ve))):(Oe(ve,Ne.defaultValue),ki(l,ve,Ql(Ne.defaultValue))),Ne.keepTouched||Hs(s.touchedFields,ve),Ne.keepDirty||(Hs(s.dirtyFields,ve),s.isDirty=Ne.defaultValue?he(ve,Ql(Jt(l,ve))):he()),Ne.keepError||(Hs(s.errors,ve),C.isValid&&G()),O.state.next({...s}))},Hn=(ve,Ne={})=>{const We=ve?Ql(ve):l,ut=Ql(We),ft=Rc(ve),mt=ft?l:ut;if(Ne.keepDefaultValues||(l=We),!Ne.keepValues){if(Ne.keepDirtyValues){const Ut=new Set([...E.mount,...Object.keys(bb(l,d))]);for(const pn of Array.from(Ut))Jt(s.dirtyFields,pn)?ki(mt,pn,Jt(d,pn)):Oe(pn,Jt(mt,pn))}else{if(BF&&Ps(ve))for(const Ut of E.mount){const pn=Jt(a,Ut);if(pn&&pn._f){const Nn=Array.isArray(pn._f.refs)?pn._f.refs[0]:pn._f.ref;if(KP(Nn)){const tn=Nn.closest("form");if(tn){tn.reset();break}}}}a={}}d=t.shouldUnregister?Ne.keepDefaultValues?Ql(l):{}:Ql(mt),O.array.next({values:{...mt}}),O.values.next({values:{...mt}})}E={mount:Ne.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},g.mount=!C.isValid||!!Ne.keepIsValid||!!Ne.keepDirtyValues,g.watch=!!t.shouldUnregister,O.state.next({submitCount:Ne.keepSubmitCount?s.submitCount:0,isDirty:ft?!1:Ne.keepDirty?s.isDirty:!!(Ne.keepDefaultValues&&!Tm(ve,l)),isSubmitted:Ne.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:ft?{}:Ne.keepDirtyValues?Ne.keepDefaultValues&&d?bb(l,d):s.dirtyFields:Ne.keepDefaultValues&&ve?bb(l,ve):Ne.keepDirty?s.dirtyFields:{},touchedFields:Ne.keepTouched?s.touchedFields:{},errors:Ne.keepErrors?s.errors:{},isSubmitSuccessful:Ne.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},Ar=(ve,Ne)=>Hn(ch(ve)?ve(d):ve,Ne);return{control:{register:Ht,unregister:_t,getFieldState:$e,handleSubmit:Rn,setError:Fe,_executeSchema:ne,_getWatch:le,_getDirty:he,_updateValid:G,_removeUnmounted:Ee,_updateFieldArray:J,_updateDisabledField:Pt,_getFieldArray:Me,_reset:Hn,_resetDefaultValues:()=>ch(t.defaultValues)&&t.defaultValues().then(ve=>{Ar(ve,t.resetOptions),O.state.next({isLoading:!1})}),_updateFormState:ve=>{s={...s,...ve}},_disableForm:fn,_subjects:O,_proxyFormState:C,_setErrors:fe,get _fields(){return a},get _formValues(){return d},get _state(){return g},set _state(ve){g=ve},get _defaultValues(){return l},get _names(){return E},set _names(ve){E=ve},get _formState(){return s},set _formState(ve){s=ve},get _options(){return t},set _options(ve){t={...t,...ve}}},trigger:it,register:Ht,handleSubmit:Rn,watch:ct,setValue:Oe,getValues:Ae,reset:Ar,resetField:ln,clearErrors:Ze,unregister:_t,setError:Fe,setFocus:(ve,Ne={})=>{const We=Jt(a,ve),ut=We&&We._f;if(ut){const ft=ut.refs?ut.refs[0]:ut.ref;ft.focus&&(ft.focus(),Ne.shouldSelect&&ch(ft.select)&&ft.select())}},getFieldState:$e}}function Ore(r={}){const t=Qr.useRef(void 0),s=Qr.useRef(void 0),[a,l]=Qr.useState({isDirty:!1,isValidating:!1,isLoading:ch(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,defaultValues:ch(r.defaultValues)?void 0:r.defaultValues});t.current||(t.current={...w4e(r),formState:a});const d=t.current.control;return d._options=r,d4e({subject:d._subjects.state,next:g=>{u4e(g,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),Qr.useEffect(()=>d._disableForm(r.disabled),[d,r.disabled]),Qr.useEffect(()=>{if(d._proxyFormState.isDirty){const g=d._getDirty();g!==a.isDirty&&d._subjects.state.next({isDirty:g})}},[d,a.isDirty]),Qr.useEffect(()=>{r.values&&!Tm(r.values,s.current)?(d._reset(r.values,d._options.resetOptions),s.current=r.values,l(g=>({...g}))):d._resetDefaultValues()},[r.values,d]),Qr.useEffect(()=>{r.errors&&d._setErrors(r.errors)},[r.errors,d]),Qr.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),Qr.useEffect(()=>{r.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[r.shouldUnregister,d]),t.current.formState=l4e(a,d),t.current}const Pre=r=>{j.useEffect(()=>{if(!window.unityInstance)return;const t=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Ct.log("Unity input disabled")}catch(a){Ct.error("Failed to disable Unity input:",a)}},s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),Ct.log("Unity input enabled")}catch(a){Ct.error("Failed to enable Unity input:",a)}};return r?t():s(),()=>{r&&s()}},[r])};function HF({mode:r,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:g,formState:{errors:E}}=Ore(),{register:S}=j.useContext(au),b=tR(),{fullscreenRef:C}=nf(),[O,k]=j.useState(!1),[W,H]=j.useState(!1),K=a!==void 0?a:O,G=l||(()=>k(!1));Pre(K);const te=async fe=>{const{email:oe,password:be,confirmPassword:Z,...ne}=fe;if(be!==Z){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}H(!0);try{await S(oe,be,ne),Ct.log("User: Registration process complete."),G(),b({title:"Registration Successful",description:"Your account has been created.",status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(se){Ct.error("User: Registration Error:",se),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{H(!1)}},J=()=>{l?l():k(!O)},re=r==="link"?U.jsx(Th,{variant:"header",onClick:J,children:t}):U.jsx(Gp,{onClick:J,...s,children:t});return U.jsxs(U.Fragment,{children:[!a&&re,U.jsxs(Jp,{isOpen:K,onClose:G,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[U.jsx(tf,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),U.jsxs(Qp,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:fe=>{fe.stopPropagation()},children:[U.jsxs(zm,{p:8,textAlign:"center",children:[U.jsx(YV,{size:"lg",mb:2,children:"Create Account"}),U.jsx(sr,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),U.jsx(ef,{color:"gray.400"}),U.jsx(Zp,{px:8,children:U.jsx("form",{onSubmit:g(te),children:U.jsxs(Wa,{spacing:4,children:[U.jsxs(Bo,{isInvalid:E.companyName,isRequired:!0,children:[U.jsx(tu,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),U.jsx(Ap,{children:E.companyName&&E.companyName.message})]}),U.jsxs(bP,{gap:4,w:"100%",children:[U.jsxs(Bo,{isInvalid:E.firstName,isRequired:!0,children:[U.jsx(tu,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),U.jsx(Ap,{children:E.firstName&&E.firstName.message})]}),U.jsxs(Bo,{isInvalid:E.lastName,isRequired:!0,children:[U.jsx(tu,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),U.jsx(Ap,{children:E.lastName&&E.lastName.message})]})]}),U.jsxs(Bo,{isInvalid:E.email,isRequired:!0,children:[U.jsx(tu,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),U.jsx(Ap,{children:E.email&&E.email.message})]}),U.jsxs(bP,{gap:4,w:"100%",children:[U.jsxs(Bo,{isInvalid:E.password,isRequired:!0,children:[U.jsx(tu,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),U.jsx(Ap,{children:E.password&&E.password.message})]}),U.jsxs(Bo,{isInvalid:E.confirmPassword,isRequired:!0,children:[U.jsx(tu,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),U.jsx(Ap,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),U.jsx(Bo,{children:U.jsx(tu,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),U.jsx(Bo,{children:U.jsx(tu,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),U.jsxs(EN,{px:8,pb:8,flexDirection:"column",gap:4,children:[U.jsx(Gp,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:g(te),isLoading:W,loadingText:"Creating Account",children:"Create Account"}),U.jsxs(sr,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",U.jsx(Th,{color:"blue.400",onClick:G,children:"Sign In"})]})]})]})]})]})}HF.propTypes={mode:ai.oneOf(["button","link"]),label:ai.string,buttonProps:ai.object,isOpen:ai.bool,onClose:ai.func};const R4e=Qw({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),C4e=Qw({displayName:"EmailIcon",path:U.jsxs("g",{fill:"currentColor",children:[U.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),U.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),I4e=Qw({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),A4e=Qw({displayName:"QuestionOutlineIcon",path:U.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[U.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),U.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),U.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),O4e=Qw({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});function Nre({mode:r="button",label:t="Sign In",buttonProps:s={}}){const{signIn:a}=j.useContext(au),{fullscreenRef:l}=nf(),d=tR(),{register:g,handleSubmit:E,formState:{errors:S,isSubmitting:b}}=Ore({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[C,O]=j.useState(!1),[k,W]=j.useState(!1);Pre(C);const H=async J=>{try{await a(J.email,J.password),Ct.log("User: Sign-in process complete."),O(!1),window.location.reload()}catch(re){Ct.error("User: SignIn Error:",re),d({title:"Error",description:"An error occurred while logging in. Please check your credentials.",status:"error",duration:1e4,isClosable:!0,position:"top",container:l.current})}},K=()=>O(J=>!J),G=()=>{O(!1),W(!0)},te=r==="link"?U.jsx(Th,{variant:"header",onClick:K,children:t}):U.jsx(Gp,{onClick:K,...s,children:t});return U.jsxs(U.Fragment,{children:[te,U.jsxs(Jp,{isOpen:C,onClose:K,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[U.jsx(tf,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),U.jsx("form",{onSubmit:E(H),children:U.jsxs(Qp,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:J=>{J.stopPropagation()},children:[U.jsxs(zm,{p:8,textAlign:"center",children:[U.jsx(YV,{size:"lg",mb:2,children:"Welcome Back"}),U.jsx(sr,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),U.jsx(ef,{color:"gray.400"}),U.jsx(Zp,{px:8,pb:8,children:U.jsxs(Wa,{spacing:4,children:[U.jsxs(Bo,{isInvalid:S.email,children:[U.jsxs(O2,{children:[U.jsx(RP,{pointerEvents:"none",children:U.jsx(C4e,{color:"gray.500"})}),U.jsx(tu,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...g("email",{required:"Email is required."})})]}),U.jsx(Ap,{children:S.email&&S.email.message})]}),U.jsxs(Bo,{isInvalid:S.password,children:[U.jsxs(O2,{children:[U.jsx(RP,{pointerEvents:"none",children:U.jsx(R4e,{color:"gray.500"})}),U.jsx(tu,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...g("password",{required:"Password is required."})})]}),U.jsx(Ap,{children:S.password&&S.password.message})]})]})}),U.jsxs(EN,{px:8,pb:8,flexDirection:"column",gap:4,children:[U.jsx(Gp,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:b,loadingText:"Signing In",children:"Sign In"}),U.jsxs(sr,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",U.jsx(Th,{color:"blue.400",onClick:G,children:"Sign Up"})]})]})]})})]}),U.jsx(HF,{mode:"link",isOpen:k,onClose:()=>W(!1)})]})}Nre.propTypes={mode:ai.oneOf(["button","link"]),label:ai.string,buttonProps:ai.object};function P4e(){const{loadingProgression:r,isLoaded:t,error:s}=GS(),{user:a}=j.useContext(au),[l,d]=j.useState(!1),[g,E]=j.useState(!1);return j.useEffect(()=>{d(!a&&r===0)},[a,r]),U.jsx(U.Fragment,{children:l?U.jsx(_n,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:U.jsxs(Wa,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[U.jsx(sr,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),U.jsx(sr,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),U.jsx(Gp,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):U.jsx(_n,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 3s ease-in-out",opacity:t?0:1,children:U.jsxs(bP,{flexDirection:"column",alignItems:"center",padding:4,marginY:4,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",zIndex:"1",children:[U.jsx(sr,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),U.jsxs(sr,{fontSize:"sm",children:[t?"World Initialising":"World loading","."]}),U.jsx($V,{value:r*100,size:"lg",width:"100%",marginY:2})]})})})}function kre({mode:r="button",label:t="Sign Out"}){const s=tR(),{signOut:a}=j.useContext(au),{fullscreenRef:l}=nf(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},g=r==="link"?U.jsx(Th,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return U.jsx(U.Fragment,{children:g})}kre.propTypes={mode:ai.oneOf(["button","link"]),label:ai.string};function N4e(){const{user:r}=j.useContext(au);return U.jsx("div",{children:r!==null?U.jsx("div",{children:U.jsx(kre,{})}):U.jsxs("div",{children:[U.jsx(HF,{}),U.jsx(Nre,{})]})})}function k4e(){const{fullscreenRef:r}=nf(),[t,s]=j.useState(!1),a=()=>{s(!t)};return U.jsxs(U.Fragment,{children:[U.jsx(nR,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:r},children:U.jsx(ol,{"aria-label":"Controller Help",icon:U.jsx(A4e,{}),onClick:a,variant:"iconButton"})}),U.jsxs(Jp,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:r},children:[U.jsx(tf,{}),U.jsxs(Qp,{children:[U.jsx(zm,{children:"Notes"}),U.jsx(ef,{}),U.jsx(Zp,{children:U.jsx(sr,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),U.jsx(EN,{children:U.jsx(Gp,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Dre={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},FY=Qr.createContext&&Qr.createContext(Dre),Om=function(){return Om=Object.assign||function(r){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(r[l]=t[l])}return r},Om.apply(this,arguments)},D4e=function(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s};function Lre(r){return r&&r.map(function(t,s){return Qr.createElement(t.tag,Om({key:s},t.attr),Lre(t.child))})}function Ym(r){return function(t){return Qr.createElement(L4e,Om({attr:Om({},r.attr)},t),Lre(r.child))}}function L4e(r){var t=function(s){var a=r.attr,l=r.size,d=r.title,g=D4e(r,["attr","size","title"]),E=l||s.size||"1em",S;return s.className&&(S=s.className),r.className&&(S=(S?S+" ":"")+r.className),Qr.createElement("svg",Om({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,g,{className:S,style:Om(Om({color:r.color||s.color},s.style),r.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&Qr.createElement("title",null,d),r.children)};return FY!==void 0?Qr.createElement(FY.Consumer,null,function(s){return t(s)}):t(Dre)}function xre(r){return Ym({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(r)}function Mre(r){return Ym({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(r)}function mU(r){return Ym({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(r)}function gU(r){return Ym({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(r)}function x4e(r){return Ym({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(r)}function M4e(r){return Ym({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(r)}function Ure({open:r,onClose:t}){const s=j.useRef(null),a=KN(),{user:l}=j.useContext(au),d=S=>{s.current&&!s.current.contains(S.target)&&t()},g=async S=>{const b=E(S);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const C=b.data.url;if(console.log(`Avatar URL: ${C}`),a("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await tre(l.uid,C),t()}catch(O){console.error("Error updating RPM URL:",O)}else console.error("No authenticated user found to update rpmURL.")}},E=S=>{try{return JSON.parse(S.data)}catch{return null}};return j.useEffect(()=>(r&&(document.addEventListener("mousedown",d),window.addEventListener("message",g)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",g)}),[r]),r&&U.jsx(id,{children:U.jsx(_n,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:S=>S.stopPropagation(),children:U.jsx(_n,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:U.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function U4e({isOpen:r,onClose:t}){const[s,a]=j.useState(!1),[l,d]=j.useState(null),{user:g}=j.useContext(au),E=KN(),S=H=>{H.stopPropagation(),a(!0)},b=()=>{a(!1),t()},C=async H=>{if(d(H),g&&g.uid)try{await tre(g.uid,H.url),E("AvatarUrlFromReact",{url:H.url}),t()}catch(K){console.error("Error updating RPM URL:",K)}else console.error("No authenticated user found to update rpmURL.")},O=lwe("gray.200","whiteAlpha.300"),k="rgba(0, 0, 0, 0.3)",W=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return U.jsxs(U.Fragment,{children:[U.jsx(id,{children:U.jsxs(Jp,{isOpen:r,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[U.jsx(tf,{bg:"rgba(0, 0, 0, 0.7)"}),U.jsxs(Qp,{bg:"gray.800",color:"white",maxW:"900px",children:[U.jsx(zm,{fontSize:"lg",children:"Customise Your Avatar"}),U.jsx(ef,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),U.jsx(Zp,{pb:4,children:U.jsxs(Wa,{spacing:4,align:"stretch",children:[U.jsx(sr,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),U.jsxs(UZ,{columns:5,spacing:2,children:[U.jsx(_n,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:O,borderRadius:"lg",overflow:"hidden",onClick:S,_hover:{bg:k},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:U.jsxs(Wa,{spacing:1,children:[U.jsx(Wm,{as:x4e,boxSize:4}),U.jsx(sr,{fontSize:"xs",children:"Create Custom Avatar"})]})}),W.map(H=>U.jsxs(_n,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===H.id?"blue.400":O,borderRadius:"lg",overflow:"hidden",onClick:()=>C(H),_hover:{bg:k},transition:"all 0.2s",aspectRatio:"1",children:[U.jsx(VV,{src:H.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:H.name,width:"100%",height:"100%",objectFit:"cover"}),U.jsx(_n,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:U.jsx(sr,{fontSize:"xs",children:H.name})})]},H.id))]})]})})]})]})}),s&&U.jsx(Ure,{open:s,onClose:b})]})}function V4e(){const{fullscreenRef:r}=nf(),[t,s]=j.useState(!1),[a,l]=j.useState(!1),[d,g]=j.useState(!1),[E,S]=j.useState(!1),{user:b}=j.useContext(au),[C,O]=j.useState(null),[k,W]=j.useState(!0),H=(J,re)=>!J||!re?"?":`${J.charAt(0)}${re.charAt(0)}`.toUpperCase(),K=async()=>{if(b!=null&&b.uid){W(!0);try{const J=await jm(b.uid);O({rpmURL:J.rpmURL?J.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:J.firstName,lastName:J.lastName})}catch(J){console.error("Error fetching profile data:",J)}finally{W(!1)}}};j.useEffect(()=>{K()},[b==null?void 0:b.uid]),j.useEffect(()=>{const J=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",J),()=>{window.removeEventListener("PlayerInstantiated",J)}},[]);const G=()=>l(!a),te=()=>{l(!1),K()};return t?U.jsxs(U.Fragment,{children:[U.jsx(nR,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:r},children:U.jsxs(_n,{position:"relative",onMouseEnter:()=>{g(!0),S(!0)},onMouseLeave:()=>{g(!1),S(!1)},cursor:"pointer",onClick:G,children:[U.jsx(W_,{src:k||C==null?void 0:C.rpmURL,size:"md",borderRadius:"full",bg:"white",name:k?H(C==null?void 0:C.firstName,C==null?void 0:C.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&U.jsx(_n,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:U.jsx(sr,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),U.jsx(U4e,{isOpen:a,onClose:te})]}):null}function F4e(r){return Ym({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(r)}function j4e(r){return Ym({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(r)}function B4e(){const{isFullscreen:r,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=nf(),l=tR();j.useEffect(()=>{const g=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",g),document.addEventListener("webkitfullscreenerror",g),document.addEventListener("mozfullscreenerror",g),document.addEventListener("MSFullscreenError",g),()=>{document.removeEventListener("fullscreenerror",g),document.removeEventListener("webkitfullscreenerror",g),document.removeEventListener("mozfullscreenerror",g),document.removeEventListener("MSFullscreenError",g)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!r&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return U.jsx(nR,{label:r?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:U.jsx(ol,{"aria-label":r?"Exit Fullscreen":"Enter Fullscreen",icon:r?U.jsx(F4e,{}):U.jsx(j4e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const W4e=()=>(n4e(),null),jY={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function G4e(){const{isOpen:r,onOpen:t,onClose:s}=jw(),{fullscreenRef:a}=nf(),[l,d]=e4e(!1);j.useEffect(()=>{Ct.log("VideoPlayer: Current video URL:",l),l&&(Ct.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const g=()=>{Ct.log("VideoPlayer: Closing modal"),d(),s()};return U.jsx(id,{containerRef:a,children:U.jsxs(Jp,{isOpen:r,onClose:g,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[U.jsx(tf,{bg:"rgba(0, 0, 0, 0.8)"}),U.jsxs(Qp,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[U.jsx(ef,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),U.jsx(Zp,{p:0,width:"100%",children:l&&U.jsx(_n,{style:jY.iframeContainer,children:U.jsx("iframe",{src:l,style:jY.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function z4e({isOpen:r,onClose:t,playerName:s,playerId:a,uid:l}){const[d,g]=j.useState(null),[E,S]=j.useState(!0),[b,C]=j.useState(null);return j.useEffect(()=>{r&&(async()=>{if(S(!0),C(null),!l){Ct.warn("NameplateModal: No UID provided for player:",s),C("No user ID available for this player"),S(!1);return}try{Ct.log("NameplateModal: Fetching profile for UID:",l);const k=await jm(l);k?g({firstName:k.firstName,lastName:k.lastName,linkedinUrl:k.linkedinUrl,websiteUrl:k.websiteUrl,rpmURL:k.rpmURL?k.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(k){Ct.error("Error fetching profile data:",k),C("Error loading profile data")}finally{S(!1)}})()},[l,r,s]),U.jsxs(Jp,{isOpen:r,onClose:t,isCentered:!0,size:"md",children:[U.jsx(tf,{backdropFilter:"blur(10px)"}),U.jsxs(Qp,{bg:"gray.900",color:"white",borderRadius:"xl",children:[U.jsx(zm,{children:"Player Info"}),U.jsx(ef,{}),U.jsx(Zp,{pb:6,children:E?U.jsx(ZQ,{py:8,children:U.jsx(xS,{size:"xl",color:"blue.400"})}):b?U.jsxs(hN,{status:"warning",variant:"solid",borderRadius:"md",children:[U.jsx(pN,{}),b]}):U.jsxs(Wa,{spacing:4,align:"center",children:[U.jsx(W_,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),U.jsxs(Wa,{spacing:1,children:[U.jsx(sr,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&U.jsxs(sr,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),U.jsxs(sr,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&U.jsxs(U.Fragment,{children:[U.jsx(wV,{borderColor:"whiteAlpha.300"}),U.jsxs(yS,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&U.jsx(Th,{href:d.linkedinUrl,isExternal:!0,children:U.jsx(ol,{icon:U.jsx(xre,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&U.jsx(Th,{href:d.websiteUrl,isExternal:!0,children:U.jsx(ol,{icon:U.jsx(Mre,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const H4e=({isVisible:r,onToggleVisibility:t})=>{const s=yre(),[a,l]=j.useState(!1),[d,g]=j.useState([]),[E,S]=j.useState(!1),[b,C]=j.useState({}),[O,k]=j.useState({}),W=window.currentUser||{};j.useEffect(()=>{const re={};s.forEach(fe=>{if(fe.uid){if(fe.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)re[fe.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const oe=window.agoraClient.client.remoteUsers,be=oe.find(Z=>String(Z.uid)===String(fe.uid));if(be)re[fe.uid]=be.uid;else{const Z=oe.find(ne=>typeof ne.uid=="string"&&ne.uid.includes(fe.uid));if(Z)re[fe.uid]=Z.uid;else{const ne=oe.find(se=>typeof fe.uid=="string"&&fe.uid.includes(String(se.uid)));if(ne)re[fe.uid]=ne.uid;else{const se=oe.filter(ue=>!(typeof ue.uid=="string"&&ue.uid.startsWith("screen-")));se.length===1&&!fe.isLocalPlayer&&(console.log(`Special case: Mapping player ${fe.playerName} (${fe.uid}) to the only remote user: ${se[0].uid}`),re[fe.uid]=se[0].uid)}}}}}}),k(re)},[s]);const H=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const re=window.agoraClient.isVoiceEnabled;re!==E&&(console.log("UnityPlayerList: Updating mic state from window.agoraClient:",re),S(re))}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const re=window.agoraClient.client.remoteUsers,fe={};re.forEach(oe=>{typeof oe.uid=="string"&&oe.uid.startsWith("screen-")||(fe[oe.uid]=!!oe.audioTrack&&!oe.audioTrack.muted)}),JSON.stringify(fe)!==JSON.stringify(b)&&(console.log("UnityPlayerList: Updating active mics:",fe),C(fe))}};j.useEffect(()=>{const re=setInterval(H,500),fe=oe=>{console.log("UnityPlayerList: Voice toggle event received:",oe.detail),oe.detail&&typeof oe.detail.enabled=="boolean"&&S(oe.detail.enabled)};return window.addEventListener("VoiceToggled",fe),H(),()=>{clearInterval(re),window.removeEventListener("VoiceToggled",fe)}},[]),j.useEffect(()=>{const re=()=>{Ct.log("UnityPlayerList: Player instantiated, showing list"),l(!0)};return window.addEventListener("PlayerInstantiated",re),window.isPlayerInstantiated&&(Ct.log("UnityPlayerList: Player was already instantiated"),l(!0)),()=>{window.removeEventListener("PlayerInstantiated",re)}},[]),j.useEffect(()=>{(async()=>{const fe=await Promise.all(s.map(async oe=>{if(oe.uid)try{const be=await jm(oe.uid);return{...oe,firstName:be.firstName,lastName:be.lastName,linkedInProfile:be.linkedInProfile,websiteUrl:be.websiteUrl,rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}}catch(be){return Ct.error(`Error fetching data for player ${oe.playerName}:`,be),oe}return oe}));g(fe)})()},[s]);const K=[...d].sort((re,fe)=>re.isLocalPlayer?-1:fe.isLocalPlayer?1:0),G=()=>{Ct.log("UnityPlayerList: Toggling visibility"),t&&t()},te=re=>!!(re.isLocalPlayer||W&&W.uid&&re.uid===W.uid),J=re=>{try{if(te(re))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:E;if(re.uid){if(b[re.uid])return!0;const fe=O[re.uid];if(fe&&b[fe])return!0;const oe=parseInt(re.uid);if(!isNaN(oe)&&b[oe])return!0}return!1}catch(fe){return console.error("Error in hasActiveMic:",fe),!1}};return U.jsxs(_n,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:a&&r?"visible":"hidden",role:"group",children:[U.jsx(_n,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:U.jsx(ol,{icon:U.jsx(I4e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:G,_hover:{opacity:.8}})}),U.jsxs(sr,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",s.length]}),U.jsx(_n,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:U.jsx(Wa,{align:"stretch",spacing:1,width:"100%",children:K.map((re,fe)=>{const oe=te(re),be=J(re);return U.jsx(_n,{children:U.jsxs(uee,{placement:"left",trigger:"hover",children:[U.jsx(mee,{children:U.jsxs(yS,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[U.jsx(W_,{size:"xs",src:re.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),U.jsx(sr,{fontSize:"xs",children:re.playerName}),U.jsx(vee,{}),be?U.jsx(_n,{color:"green.400",children:U.jsx(gU,{})}):U.jsx(_n,{color:"red.400",children:U.jsx(mU,{})}),oe&&U.jsx(sr,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),U.jsx(fee,{bg:"rgba(0,0,0,0.4)",border:"none",boxShadow:"lg",color:"white",p:3,width:"auto",minWidth:"200px",ml:"-20px",position:"absolute",left:"-220px",top:"-100px",transform:"none !important",children:U.jsx(hee,{children:U.jsxs(Wa,{align:"center",spacing:2,children:[U.jsx(W_,{size:"lg",src:re.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),U.jsx(sr,{fontSize:"lg",fontWeight:"bold",children:re.playerName}),re.firstName&&U.jsxs(sr,{fontSize:"sm",color:"gray.300",children:[re.firstName," ",re.lastName]}),U.jsxs(yS,{spacing:4,pt:2,children:[re.linkedInProfile&&U.jsx(Th,{href:re.linkedInProfile,isExternal:!0,children:U.jsx(ol,{icon:U.jsx(xre,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),re.websiteUrl&&U.jsx(Th,{href:re.websiteUrl,isExternal:!0,children:U.jsx(ol,{icon:U.jsx(Mre,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),U.jsx(ol,{icon:be?U.jsx(gU,{}):U.jsx(mU,{}),variant:"ghost",colorScheme:be?"green":"red",size:"sm","aria-label":"Microphone status",isDisabled:!0})]})]})})})]})},fe)})})})]})};var uP={exports:{}},K4e=uP.exports,BY;function $4e(){return BY||(BY=1,function(r,t){(function(s,a){r.exports=a()})(K4e,function(){function s(e,n){return n.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof C_<"u"?C_:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},g=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=g,S=Function.prototype,b=S.call,C=E&&S.bind.bind(b,b),O=E?C:function(e){return function(){return b.apply(e,arguments)}},k=O({}.isPrototypeOf),W=function(e){return e&&e.Math==Math&&e},H=W(typeof globalThis=="object"&&globalThis)||W(typeof window=="object"&&window)||W(typeof self=="object"&&self)||W(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),K=g,G=Function.prototype,te=G.apply,J=G.call,re=typeof Reflect=="object"&&Reflect.apply||(K?J.bind(te):function(){return J.apply(te,arguments)}),fe=O,oe=fe({}.toString),be=fe("".slice),Z=function(e){return be(oe(e),8,-1)},ne=Z,se=O,ue=function(e){if(ne(e)==="Function")return se(e)},Ee=typeof document=="object"&&document.all,he={all:Ee,IS_HTMLDDA:Ee===void 0&&Ee!==void 0},le=he.all,Me=he.IS_HTMLDDA?function(e){return typeof e=="function"||e===le}:function(e){return typeof e=="function"},pt={},et=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Oe=g,Ue=Function.prototype.call,xe=Oe?Ue.bind(Ue):function(){return Ue.apply(Ue,arguments)},it={},Ae={}.propertyIsEnumerable,$e=Object.getOwnPropertyDescriptor,Ze=$e&&!Ae.call({1:2},1);it.f=Ze?function(e){var n=$e(this,e);return!!n&&n.enumerable}:Ae;var Fe,ct,_t=function(e,n){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:n}},Pt=d,Ht=Z,xt=Object,fn=O("".split),Rn=Pt(function(){return!xt("z").propertyIsEnumerable(0)})?function(e){return Ht(e)=="String"?fn(e,""):xt(e)}:xt,ln=function(e){return e==null},Hn=ln,Ar=TypeError,Xt=function(e){if(Hn(e))throw Ar("Can't call method on "+e);return e},Qn=Rn,Wt=Xt,ve=function(e){return Qn(Wt(e))},Ne=Me,We=he.all,ut=he.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Ne(e)||e===We}:function(e){return typeof e=="object"?e!==null:Ne(e)},ft={},mt=ft,Ut=H,pn=Me,Nn=function(e){return pn(e)?e:void 0},tn=function(e,n){return arguments.length<2?Nn(mt[e])||Nn(Ut[e]):mt[e]&&mt[e][n]||Ut[e]&&Ut[e][n]},ur=typeof navigator<"u"&&String(navigator.userAgent)||"",Ga=H,Nt=ur,Zt=Ga.process,Wi=Ga.Deno,bs=Zt&&Zt.versions||Wi&&Wi.version,Ls=bs&&bs.v8;Ls&&(ct=(Fe=Ls.split("."))[0]>0&&Fe[0]<4?1:+(Fe[0]+Fe[1])),!ct&&Nt&&(!(Fe=Nt.match(/Edge\/(\d+)/))||Fe[1]>=74)&&(Fe=Nt.match(/Chrome\/(\d+)/))&&(ct=+Fe[1]);var ci=ct,Sa=ci,Mc=d,Xs=H.String,Js=!!Object.getOwnPropertySymbols&&!Mc(function(){var e=Symbol();return!Xs(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Sa&&Sa<41}),fl=Js&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ws=tn,za=Me,Ko=k,Ha=Object,Uc=fl?function(e){return typeof e=="symbol"}:function(e){var n=ws("Symbol");return za(n)&&Ko(n.prototype,Ha(e))},cu=String,Ka=function(e){try{return cu(e)}catch{return"Object"}},Vc=Me,mo=Ka,bi=TypeError,Qi=function(e){if(Vc(e))return e;throw bi(mo(e)+" is not a function")},Ta=Qi,lu=ln,$a=function(e,n){var i=e[n];return lu(i)?void 0:Ta(i)},$o=xe,qo=Me,sd=ut,Xm=TypeError,uu={exports:{}},Ah=H,Rs=Object.defineProperty,du=function(e,n){try{Rs(Ah,e,{value:n,configurable:!0,writable:!0})}catch{Ah[e]=n}return n},Yo="__core-js_shared__",od=H[Yo]||du(Yo,{}),ad=od;(uu.exports=function(e,n){return ad[e]||(ad[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var ba=uu.exports,cd=Xt,hu=Object,go=function(e){return hu(cd(e))},ld=go,xr=O({}.hasOwnProperty),li=Object.hasOwn||function(e,n){return xr(ld(e),n)},qa=O,Fc=0,Xo=Math.random(),Oh=qa(1 .toString),ud=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Oh(++Fc+Xo,36)},ml=ba,Qs=li,rf=ud,xs=Js,Ph=fl,jc=H.Symbol,dd=ml("wks"),hd=Ph?jc.for||jc:jc&&jc.withoutSetter||rf,ar=function(e){return Qs(dd,e)||(dd[e]=xs&&Qs(jc,e)?jc[e]:hd("Symbol."+e)),dd[e]},gl=xe,_l=ut,pu=Uc,wa=$a,_o=function(e,n){var i,o;if(qo(i=e.toString)&&!sd(o=$o(i,e))||qo(i=e.valueOf)&&!sd(o=$o(i,e)))return o;throw Xm("Can't convert object to primitive value")},fu=TypeError,Bc=ar("toPrimitive"),El=function(e,n){if(!_l(e)||pu(e))return e;var i,o=wa(e,Bc);if(o){if(i=gl(o,e,n),!_l(i)||pu(i))return i;throw fu("Can't convert object to primitive value")}return _o(e)},Fr=Uc,Ra=function(e){var n=El(e,"string");return Fr(n)?n:n+""},Zn=ut,Ya=H.document,sf=Zn(Ya)&&Zn(Ya.createElement),vl=function(e){return sf?Ya.createElement(e):{}},pd=vl,Nh=!et&&!d(function(){return Object.defineProperty(pd("div"),"a",{get:function(){return 7}}).a!=7}),of=et,kh=xe,Eo=it,Gi=_t,vo=ve,yo=Ra,yl=li,So=Nh,To=Object.getOwnPropertyDescriptor;pt.f=of?To:function(e,n){if(e=vo(e),n=yo(n),So)try{return To(e,n)}catch{}if(yl(e,n))return Gi(!kh(Eo.f,e,n),e[n])};var af=d,Xa=Me,Zi=/#|\.prototype\./,mu=function(e,n){var i=Wc[Dh(e)];return i==cf||i!=Sl&&(Xa(n)?af(n):!!n)},Dh=mu.normalize=function(e){return String(e).replace(Zi,".").toLowerCase()},Wc=mu.data={},Sl=mu.NATIVE="N",cf=mu.POLYFILL="P",Jo=mu,Qo=Qi,Gc=g,_e=ue(ue.bind),Re=function(e,n){return Qo(e),n===void 0?e:Gc?_e(e,n):function(){return e.apply(n,arguments)}},Ke={},jt=et&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Bn=ut,pr=String,Mr=TypeError,en=function(e){if(Bn(e))return e;throw Mr(pr(e)+" is not an object")},Or=et,ui=Nh,fs=jt,bo=en,wo=Ra,gu=TypeError,xi=Object.defineProperty,zc=Object.getOwnPropertyDescriptor,fd="enumerable",Ja="configurable",Jm="writable";Ke.f=Or?fs?function(e,n,i){if(bo(e),n=wo(n),bo(i),typeof e=="function"&&n==="prototype"&&"value"in i&&Jm in i&&!i[Jm]){var o=zc(e,n);o&&o[Jm]&&(e[n]=i.value,i={configurable:Ja in i?i[Ja]:o[Ja],enumerable:fd in i?i[fd]:o[fd],writable:!1})}return xi(e,n,i)}:xi:function(e,n,i){if(bo(e),n=wo(n),bo(i),ui)try{return xi(e,n,i)}catch{}if("get"in i||"set"in i)throw gu("Accessors not supported");return"value"in i&&(e[n]=i.value),e};var lf=Ke,_u=_t,Ro=et?function(e,n,i){return lf.f(e,n,_u(1,i))}:function(e,n,i){return e[n]=i,e},Tl=H,uf=re,Qm=ue,sE=Me,df=pt.f,hf=Jo,Eu=ft,vu=Re,yu=Ro,Zm=li,oE=function(e){var n=function(i,o,c){if(this instanceof n){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return uf(e,this,arguments)};return n.prototype=e.prototype,n},kn=function(e,n){var i,o,c,u,h,f,_,v,y,w=e.target,I=e.global,P=e.stat,F=e.proto,x=I?Tl:P?Tl[w]:(Tl[w]||{}).prototype,M=I?Eu:Eu[w]||yu(Eu,w,{})[w],$=M.prototype;for(u in n)o=!(i=hf(I?u:w+(P?".":"#")+u,e.forced))&&x&&Zm(x,u),f=M[u],o&&(_=e.dontCallGetSet?(y=df(x,u))&&y.value:x[u]),h=o&&_?_:n[u],o&&typeof f==typeof h||(v=e.bind&&o?vu(h,Tl):e.wrap&&o?oE(h):F&&sE(h)?Qm(h):h,(e.sham||h&&h.sham||f&&f.sham)&&yu(v,"sham",!0),yu(M,u,v),F&&(Zm(Eu,c=w+"Prototype")||yu(Eu,c,{}),yu(Eu[c],u,h),e.real&&$&&(i||!$[u])&&yu($,u,h)))},pf=Math.ceil,Co=Math.floor,aE=Math.trunc||function(e){var n=+e;return(n>0?Co:pf)(n)},cE=aE,Qa=function(e){var n=+e;return n!=n||n===0?0:cE(n)},R=Qa,V=Math.max,X=Math.min,de=function(e,n){var i=R(e);return i<0?V(i+n,0):X(i,n)},je=Qa,Je=Math.min,It=function(e){return e>0?Je(je(e),9007199254740991):0},jr=It,ei=function(e){return jr(e.length)},fr=ve,Cs=de,es=ei,Ca=function(e){return function(n,i,o){var c,u=fr(n),h=es(u),f=Cs(o,h);if(e&&i!=i){for(;h>f;)if((c=u[f++])!=c)return!0}else for(;h>f;f++)if((e||f in u)&&u[f]===i)return e||f||0;return!e&&-1}},Io={includes:Ca(!0),indexOf:Ca(!1)},Lh=Io.includes;kn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return Lh(this,e,arguments.length>1?arguments[1]:void 0)}});var ff=ft,Ia=function(e){return ff[e+"Prototype"]},gR=Ia("Array").includes,_R=ut,mf=Z,qN=ar("match"),ER=function(e){var n;return _R(e)&&((n=e[qN])!==void 0?!!n:mf(e)=="RegExp")},YN=ER,vR=TypeError,zS={};zS[ar("toStringTag")]="z";var xh=String(zS)==="[object z]",eg=xh,XN=Me,Mh=Z,JN=ar("toStringTag"),yR=Object,HS=Mh(function(){return arguments}())=="Arguments",Za=eg?Mh:function(e){var n,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(n=yR(e),JN))=="string"?i:HS?Mh(n):(o=Mh(n))=="Object"&&XN(n.callee)?"Arguments":o},SR=Za,TR=String,Zo=function(e){if(SR(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return TR(e)},QN=ar("match"),ZN=kn,ek=function(e){if(YN(e))throw vR("The method doesn't accept regular expressions");return e},tk=Xt,bR=Zo,Hc=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[QN]=!1,"/./"[e](n)}catch{}}return!1},tg=O("".indexOf);ZN({target:"String",proto:!0,forced:!Hc("includes")},{includes:function(e){return!!~tg(bR(tk(this)),bR(ek(e)),arguments.length>1?arguments[1]:void 0)}});var wR=Ia("String").includes,KS=k,RR=gR,CR=wR,ng=Array.prototype,$S=String.prototype,nk=function(e){var n=e.includes;return e===ng||KS(ng,e)&&n===ng.includes?RR:typeof e=="string"||e===$S||KS($S,e)&&n===$S.includes?CR:n},Xe=l(nk),qS=Qi,rg=go,YS=Rn,IR=ei,lE=TypeError,gf=function(e){return function(n,i,o,c){qS(i);var u=rg(n),h=YS(u),f=IR(u),_=e?f-1:0,v=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=v;break}if(_+=v,e?_<0:f<=_)throw lE("Reduce of empty array with no initial value")}for(;e?_>=0:f>_;_+=v)_ in h&&(c=i(c,h[_],_,u));return c}},XS={left:gf(!1)},AR=d,Uh=function(e,n){var i=[][e];return!!i&&AR(function(){i.call(null,n||function(){return 1},1)})},Vh=typeof process<"u"&&Z(process)=="process",OR=XS.left;kn({target:"Array",proto:!0,forced:!Vh&&ci>79&&ci<83||!Uh("reduce")},{reduce:function(e){var n=arguments.length;return OR(this,e,n,n>1?arguments[1]:void 0)}});var PR=Ia("Array").reduce,NR=k,kR=PR,uE=Array.prototype,md=function(e){var n=e.reduce;return e===uE||NR(uE,e)&&n===uE.reduce?kR:n},dE=md,Aa=l(dE),rk=Z,ig=Array.isArray||function(e){return rk(e)=="Array"},sg=kn,ik=ig,DR=O([].reverse),JS=[1,2];sg({target:"Array",proto:!0,forced:String(JS)===String(JS.reverse())},{reverse:function(){return ik(this)&&(this.length=this.length),DR(this)}});var gi=Ia("Array").reverse,QS=k,hE=gi,Fh=Array.prototype,LR=function(e){var n=e.reverse;return e===Fh||QS(Fh,e)&&n===Fh.reverse?hE:n},pE=LR,_f=l(pE),fE=ud,jh=ba("keys"),og=function(e){return jh[e]||(jh[e]=fE(e))},sk=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),ok=li,xR=Me,mE=go,gE=sk,_E=og("IE_PROTO"),ag=Object,ZS=ag.prototype,cg=gE?ag.getPrototypeOf:function(e){var n=mE(e);if(ok(n,_E))return n[_E];var i=n.constructor;return xR(i)&&n instanceof i?i.prototype:n instanceof ag?ZS:null},ak=O,MR=Qi,ck=Me,lk=String,eT=TypeError,gd=function(e,n,i){try{return ak(MR(Object.getOwnPropertyDescriptor(e,n)[i]))}catch{}},UR=en,Ef=function(e){if(typeof e=="object"||ck(e))return e;throw eT("Can't set "+lk(e)+" as a prototype")},bl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,n=!1,i={};try{(e=gd(Object.prototype,"__proto__","set"))(i,[]),n=i instanceof Array}catch{}return function(o,c){return UR(o),Ef(c),n?e(o,c):o.__proto__=c,o}}():void 0),_d={},ec={},lg=li,uk=ve,dk=Io.indexOf,Bh=ec,vf=O([].push),Wh=function(e,n){var i,o=uk(e),c=0,u=[];for(i in o)!lg(Bh,i)&&lg(o,i)&&vf(u,i);for(;n.length>c;)lg(o,i=n[c++])&&(~dk(u,i)||vf(u,i));return u},yf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],tT=Wh,Sf=yf.concat("length","prototype");_d.f=Object.getOwnPropertyNames||function(e){return tT(e,Sf)};var tc={};tc.f=Object.getOwnPropertySymbols;var _i=tn,di=_d,Ed=tc,Zs=en,ea=O([].concat),Gh=_i("Reflect","ownKeys")||function(e){var n=di.f(Zs(e)),i=Ed.f;return i?ea(n,i(e)):n},zh=li,ta=Gh,EE=pt,VR=Ke,vE={},yE=Wh,FR=yf,nc=Object.keys||function(e){return yE(e,FR)},SE=et,nT=jt,jR=Ke,hk=en,vd=ve,Tf=nc;vE.f=SE&&!nT?Object.defineProperties:function(e,n){hk(e);for(var i,o=vd(n),c=Tf(n),u=c.length,h=0;u>h;)jR.f(e,i=c[h++],o[i]);return e};var Su,ug=tn("document","documentElement"),TE=en,rc=vE,Oa=yf,Hh=ec,Tu=ug,bu=vl,wu="prototype",bE="script",wE=og("IE_PROTO"),dg=function(){},na=function(e){return"<"+bE+">"+e+"</"+bE+">"},ra=function(e){e.write(na("")),e.close();var n=e.parentWindow.Object;return e=null,n},ti=function(){try{Su=new ActiveXObject("htmlfile")}catch{}var e,n,i;ti=typeof document<"u"?document.domain&&Su?ra(Su):(n=bu("iframe"),i="java"+bE+":",n.style.display="none",Tu.appendChild(n),n.src=String(i),(e=n.contentWindow.document).open(),e.write(na("document.F=Object")),e.close(),e.F):ra(Su);for(var o=Oa.length;o--;)delete ti[wu][Oa[o]];return ti()};Hh[wE]=!0;var Ao=Object.create||function(e,n){var i;return e!==null?(dg[wu]=TE(e),i=new dg,dg[wu]=null,i[wE]=e):i=ti(),n===void 0?i:rc.f(i,n)},BR=ut,WR=Ro,RE=Error,rT=O("".replace),GR=String(RE("zxcasd").stack),hg=/\n\s*at [^:]*:[^\n]*/,zR=hg.test(GR),bf=_t,iT=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",bf(1,7)),e.stack!==7)}),pk=Ro,pg=function(e,n){if(zR&&typeof e=="string"&&!RE.prepareStackTrace)for(;n--;)e=rT(e,hg,"");return e},CE=iT,sT=Error.captureStackTrace,yd={},wf=yd,HR=ar("iterator"),IE=Array.prototype,fg=function(e){return e!==void 0&&(wf.Array===e||IE[HR]===e)},Rf=Za,AE=$a,oT=ln,aT=yd,cT=ar("iterator"),Ru=function(e){if(!oT(e))return AE(e,cT)||AE(e,"@@iterator")||aT[Rf(e)]},ic=xe,Kh=Qi,lT=en,KR=Ka,Cu=Ru,Sd=TypeError,mg=function(e,n){var i=arguments.length<2?Cu(e):n;if(Kh(i))return lT(ic(i,e));throw Sd(KR(e)+" is not iterable")},$R=xe,wl=en,Td=$a,gg=function(e,n,i){var o,c;wl(e);try{if(!(o=Td(e,"return"))){if(n==="throw")throw i;return i}o=$R(o,e)}catch(u){c=!0,o=u}if(n==="throw")throw i;if(c)throw o;return wl(o),i},qR=Re,OE=xe,YR=en,_g=Ka,Rl=fg,Eg=ei,Cf=k,$h=mg,uT=Ru,qh=gg,XR=TypeError,If=function(e,n){this.stopped=e,this.result=n},yi=If.prototype,bd=function(e,n,i){var o,c,u,h,f,_,v,y=i&&i.that,w=!(!i||!i.AS_ENTRIES),I=!(!i||!i.IS_RECORD),P=!(!i||!i.IS_ITERATOR),F=!(!i||!i.INTERRUPTED),x=qR(n,y),M=function(q){return o&&qh(o,"normal",q),new If(!0,q)},$=function(q){return w?(YR(q),F?x(q[0],q[1],M):x(q[0],q[1])):F?x(q,M):x(q)};if(I)o=e.iterator;else if(P)o=e;else{if(!(c=uT(e)))throw XR(_g(e)+" is not iterable");if(Rl(c)){for(u=0,h=Eg(e);h>u;u++)if((f=$(e[u]))&&Cf(yi,f))return f;return new If(!1)}o=$h(e,c)}for(_=I?e.next:o.next;!(v=OE(_,o)).done;){try{f=$(v.value)}catch(q){qh(o,"throw",q)}if(typeof f=="object"&&f&&Cf(yi,f))return f}return new If(!1)},dT=Zo,hT=kn,PE=k,pT=cg,Cl=bl,wi=function(e,n,i){for(var o=ta(n),c=VR.f,u=EE.f,h=0;h<o.length;h++){var f=o[h];zh(e,f)||i&&zh(i,f)||c(e,f,u(n,f))}},ts=Ao,ns=Ro,Af=_t,vg=function(e,n){BR(n)&&"cause"in n&&WR(e,"cause",n.cause)},yg=function(e,n,i,o){CE&&(sT?sT(e,n):pk(e,"stack",pg(i,o)))},fk=bd,eo=function(e,n){return e===void 0?arguments.length<2?"":n:dT(e)},fT=ar("toStringTag"),Of=Error,mT=[].push,Oo=function(e,n){var i,o=PE(ia,this);Cl?i=Cl(Of(),o?pT(this):ia):(i=o?this:ts(ia),ns(i,fT,"Error")),n!==void 0&&ns(i,"message",eo(n)),yg(i,Oo,i.stack,1),arguments.length>2&&vg(i,arguments[2]);var c=[];return fk(e,mT,{that:c}),ns(i,"errors",c),i};Cl?Cl(Oo,Of):wi(Oo,Of,{name:!0});var ia=Oo.prototype=ts(Of.prototype,{constructor:Af(1,Oo),message:Af(1,""),name:Af(1,"AggregateError")});hT({global:!0},{AggregateError:Oo});var wd,Yh,Pf,JR=Me,gT=H.WeakMap,QR=JR(gT)&&/native code/.test(String(gT)),_T=H,ZR=ut,eC=Ro,NE=li,kE=od,Sg=og,tC=ec,Tg="Object already initialized",Nf=_T.TypeError,nC=_T.WeakMap;if(QR||kE.state){var sc=kE.state||(kE.state=new nC);sc.get=sc.get,sc.has=sc.has,sc.set=sc.set,wd=function(e,n){if(sc.has(e))throw Nf(Tg);return n.facade=e,sc.set(e,n),n},Yh=function(e){return sc.get(e)||{}},Pf=function(e){return sc.has(e)}}else{var Xh=Sg("state");tC[Xh]=!0,wd=function(e,n){if(NE(e,Xh))throw Nf(Tg);return n.facade=e,eC(e,Xh,n),n},Yh=function(e){return NE(e,Xh)?e[Xh]:{}},Pf=function(e){return NE(e,Xh)}}var Rd,ET,vT,Iu={set:wd,get:Yh,has:Pf,enforce:function(e){return Pf(e)?Yh(e):wd(e,{})},getterFor:function(e){return function(n){var i;if(!ZR(n)||(i=Yh(n)).type!==e)throw Nf("Incompatible receiver, "+e+" required");return i}}},DE=et,rC=li,yT=Function.prototype,mk=DE&&Object.getOwnPropertyDescriptor,ST=rC(yT,"name"),iC={PROPER:ST&&(function(){}).name==="something",CONFIGURABLE:ST&&(!DE||DE&&mk(yT,"name").configurable)},gk=Ro,Au=function(e,n,i,o){return o&&o.enumerable?e[n]=i:gk(e,n,i),e},sC=d,oC=Me,LE=ut,_k=Ao,aC=cg,Ek=Au,Pa=ar("iterator"),xE=!1;[].keys&&("next"in(vT=[].keys())?(ET=aC(aC(vT)))!==Object.prototype&&(Rd=ET):xE=!0);var ME=!LE(Rd)||sC(function(){var e={};return Rd[Pa].call(e)!==e});oC((Rd=ME?{}:_k(Rd))[Pa])||Ek(Rd,Pa,function(){return this});var TT={IteratorPrototype:Rd,BUGGY_SAFARI_ITERATORS:xE},cC=Za,lC=xh?{}.toString:function(){return"[object "+cC(this)+"]"},bT=xh,kf=Ke.f,wT=Ro,RT=li,vk=lC,CT=ar("toStringTag"),Ou=function(e,n,i,o){if(e){var c=i?e:e.prototype;RT(c,CT)||kf(c,CT,{configurable:!0,value:n}),o&&!bT&&wT(c,"toString",vk)}},uC=TT.IteratorPrototype,dC=Ao,hC=_t,yk=Ou,sa=yd,Po=function(){return this},UE=function(e,n,i,o){var c=n+" Iterator";return e.prototype=dC(uC,{next:hC(+!o,i)}),yk(e,c,!1,!0),sa[c]=Po,e},pC=kn,fC=xe,mC=iC,gC=UE,IT=cg,_C=Ou,VE=Au,AT=yd,EC=TT,OT=mC.PROPER,Df=EC.BUGGY_SAFARI_ITERATORS,FE=ar("iterator"),jE="keys",Jh="values",vC="entries",yC=function(){return this},BE=function(e,n,i,o,c,u,h){gC(i,n,o);var f,_,v,y=function($){if($===c&&x)return x;if(!Df&&$ in P)return P[$];switch($){case jE:case Jh:case vC:return function(){return new i(this,$)}}return function(){return new i(this)}},w=n+" Iterator",I=!1,P=e.prototype,F=P[FE]||P["@@iterator"]||c&&P[c],x=!Df&&F||y(c),M=n=="Array"&&P.entries||F;if(M&&(f=IT(M.call(new e)))!==Object.prototype&&f.next&&(_C(f,w,!0,!0),AT[w]=yC),OT&&c==Jh&&F&&F.name!==Jh&&(I=!0,x=function(){return fC(F,this)}),c)if(_={values:y(Jh),keys:u?x:y(jE),entries:y(vC)},h)for(v in _)(Df||I||!(v in P))&&VE(P,v,_[v]);else pC({target:n,proto:!0,forced:Df||I},_);return h&&P[FE]!==x&&VE(P,FE,x,{}),AT[n]=x,_},WE=function(e,n){return{value:e,done:n}},GE=ve,Il=yd,SC=Iu;Ke.f;var TC=BE,zE=WE,PT="Array Iterator",bC=SC.set,bg=SC.getterFor(PT);TC(Array,"Array",function(e,n){bC(this,{type:PT,target:GE(e),index:0,kind:n})},function(){var e=bg(this),n=e.target,i=e.kind,o=e.index++;return!n||o>=n.length?(e.target=void 0,zE(void 0,!0)):zE(i=="keys"?o:i=="values"?n[o]:[o,n[o]],!1)},"values"),Il.Arguments=Il.Array;var to=Ke,HE=function(e,n,i){return to.f(e,n,i)},Sk=tn,KE=HE,no=et,wC=ar("species"),Gt=k,Lf=TypeError,wg=function(e,n){if(Gt(n,e))return e;throw Lf("Incorrect invocation")},RC=Me,NT=od,Rg=O(Function.toString);RC(NT.inspectSource)||(NT.inspectSource=function(e){return Rg(e)});var Cg=NT.inspectSource,kT=O,CC=d,DT=Me,IC=Za,LT=Cg,$E=function(){},Ms=[],oc=tn("Reflect","construct"),Al=/^\s*(?:class|function)\b/,AC=kT(Al.exec),OC=!Al.exec($E),No=function(e){if(!DT(e))return!1;try{return oc($E,Ms,e),!0}catch{return!1}},xT=function(e){if(!DT(e))return!1;switch(IC(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return OC||!!AC(Al,LT(e))}catch{return!0}};xT.sham=!0;var oa,xf,MT,qE,Ig=!oc||CC(function(){var e;return No(No.call)||!No(Object)||!No(function(){e=!0})||e})?xT:No,PC=Ig,Tk=Ka,YE=TypeError,XE=en,ac=function(e){if(PC(e))return e;throw YE(Tk(e)+" is not a constructor")},vr=ln,Is=ar("species"),Mi=function(e,n){var i,o=XE(e).constructor;return o===void 0||vr(i=XE(o)[Is])?n:ac(i)},rs=O([].slice),Na=TypeError,Kc=function(e,n){if(e<n)throw Na("Not enough arguments");return e},is=/(?:ipad|iphone|ipod).*applewebkit/i.test(ur),Us=H,Qh=re,JE=Re,QE=Me,Ag=li,ko=d,ZE=ug,Mf=rs,Ol=vl,ev=Kc,UT=is,Cd=Vh,Uf=Us.setImmediate,Pl=Us.clearImmediate,tv=Us.process,Zh=Us.Dispatch,VT=Us.Function,Og=Us.MessageChannel,nv=Us.String,Vs=0,cc={},lc="onreadystatechange";ko(function(){oa=Us.location});var ro=function(e){if(Ag(cc,e)){var n=cc[e];delete cc[e],n()}},rv=function(e){return function(){ro(e)}},iv=function(e){ro(e.data)},sv=function(e){Us.postMessage(nv(e),oa.protocol+"//"+oa.host)};Uf&&Pl||(Uf=function(e){ev(arguments.length,1);var n=QE(e)?e:VT(e),i=Mf(arguments,1);return cc[++Vs]=function(){Qh(n,void 0,i)},xf(Vs),Vs},Pl=function(e){delete cc[e]},Cd?xf=function(e){tv.nextTick(rv(e))}:Zh&&Zh.now?xf=function(e){Zh.now(rv(e))}:Og&&!UT?(qE=(MT=new Og).port2,MT.port1.onmessage=iv,xf=JE(qE.postMessage,qE)):Us.addEventListener&&QE(Us.postMessage)&&!Us.importScripts&&oa&&oa.protocol!=="file:"&&!ko(sv)?(xf=sv,Us.addEventListener("message",iv,!1)):xf=lc in Ol("script")?function(e){ZE.appendChild(Ol("script"))[lc]=function(){ZE.removeChild(this),ro(e)}}:function(e){setTimeout(rv(e),0)});var ov={set:Uf,clear:Pl},Pu=function(){this.head=null,this.tail=null};Pu.prototype={add:function(e){var n={item:e,next:null},i=this.tail;i?i.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var ep,Pg,Nu,Ng,Id,FT=Pu,NC=/ipad|iphone|ipod/i.test(ur)&&typeof Pebble<"u",jT=/web0s(?!.*chrome)/i.test(ur),Nl=H,kC=Re,bk=pt.f,av=ov.set,DC=FT,tp=is,wk=NC,Vf=jT,cv=Vh,Ri=Nl.MutationObserver||Nl.WebKitMutationObserver,LC=Nl.document,BT=Nl.process,lv=Nl.Promise,xC=bk(Nl,"queueMicrotask"),uv=xC&&xC.value;if(!uv){var kg=new DC,dv=function(){var e,n;for(cv&&(e=BT.domain)&&e.exit();n=kg.get();)try{n()}catch(i){throw kg.head&&ep(),i}e&&e.enter()};tp||cv||Vf||!Ri||!LC?!wk&&lv&&lv.resolve?((Ng=lv.resolve(void 0)).constructor=lv,Id=kC(Ng.then,Ng),ep=function(){Id(dv)}):cv?ep=function(){BT.nextTick(dv)}:(av=kC(av,Nl),ep=function(){av(dv)}):(Pg=!0,Nu=LC.createTextNode(""),new Ri(dv).observe(Nu,{characterData:!0}),ep=function(){Nu.data=Pg=!Pg}),uv=function(e){kg.head||ep(),kg.add(e)}}var ka=uv,Ad=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},np=H.Promise,ku=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",hv=!ku&&!Vh&&typeof window=="object"&&typeof document=="object",rp=H,Od=np,WT=Me,GT=Jo,Rk=Cg,zT=ar,Ck=hv,MC=ku,pv=ci,Dg=Od&&Od.prototype,fv=zT("species"),HT=WT(rp.PromiseRejectionEvent),KT=GT("Promise",function(){var e=Rk(Od),n=e!==String(Od);if(!n&&pv===66||!Dg.catch||!Dg.finally)return!0;if(!pv||pv<51||!/native code/.test(e)){var i=new Od(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[fv]=o,!(i.then(function(){})instanceof o))return!0}return!n&&(Ck||MC)&&!HT}),Lg={CONSTRUCTOR:KT,REJECTION_EVENT:HT},$c={},mv=Qi,gv=TypeError,$T=function(e){var n,i;this.promise=new e(function(o,c){if(n!==void 0||i!==void 0)throw gv("Bad Promise constructor");n=o,i=c}),this.resolve=mv(n),this.reject=mv(i)};$c.f=function(e){return new $T(e)};var Ff,qT,Ik=kn,ip=Vh,Pd=H,Du=xe,Ak=Au,_v=Ou,p=function(e){var n=Sk(e);no&&n&&!n[wC]&&KE(n,wC,{configurable:!0,get:function(){return this}})},m=Qi,T=Me,A=ut,L=wg,B=Mi,ie=ov.set,ye=ka,Ie=function(e,n){try{arguments.length==1?console.error(e):console.error(e,n)}catch{}},qe=Ad,yt=FT,Tt=Iu,vt=np,Vt=Lg,Kt=$c,$t="Promise",Ui=Vt.CONSTRUCTOR,Ge=Vt.REJECTION_EVENT,Pe=Tt.getterFor($t),He=Tt.set,wt=vt&&vt.prototype,qt=vt,sn=wt,un=Pd.TypeError,Cn=Pd.document,ss=Pd.process,mr=Kt.f,Nd=mr,Ok=!!(Cn&&Cn.createEvent&&Pd.dispatchEvent),$F="unhandledrejection",qF=function(e){var n;return!(!A(e)||!T(n=e.then))&&n},YF=function(e,n){var i,o,c,u=n.value,h=n.state==1,f=h?e.ok:e.fail,_=e.resolve,v=e.reject,y=e.domain;try{f?(h||(n.rejection===2&&Kre(n),n.rejection=1),f===!0?i=u:(y&&y.enter(),i=f(u),y&&(y.exit(),c=!0)),i===e.promise?v(un("Promise-chain cycle")):(o=qF(i))?Du(o,i,_,v):_(i)):v(u)}catch(w){y&&!c&&y.exit(),v(w)}},XF=function(e,n){e.notified||(e.notified=!0,ye(function(){for(var i,o=e.reactions;i=o.get();)YF(i,e);e.notified=!1,n&&!e.rejection&&Hre(e)}))},JF=function(e,n,i){var o,c;Ok?((o=Cn.createEvent("Event")).promise=n,o.reason=i,o.initEvent(e,!1,!0),Pd.dispatchEvent(o)):o={promise:n,reason:i},!Ge&&(c=Pd["on"+e])?c(o):e===$F&&Ie("Unhandled promise rejection",i)},Hre=function(e){Du(ie,Pd,function(){var n,i=e.facade,o=e.value;if(QF(e)&&(n=qe(function(){ip?ss.emit("unhandledRejection",o,i):JF($F,i,o)}),e.rejection=ip||QF(e)?2:1,n.error))throw n.value})},QF=function(e){return e.rejection!==1&&!e.parent},Kre=function(e){Du(ie,Pd,function(){var n=e.facade;ip?ss.emit("rejectionHandled",n):JF("rejectionhandled",n,e.value)})},Ev=function(e,n,i){return function(o){e(n,o,i)}},vv=function(e,n,i){e.done||(e.done=!0,i&&(e=i),e.value=n,e.state=2,XF(e,!0))},Pk=function(e,n,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===n)throw un("Promise can't be resolved itself");var o=qF(n);o?ye(function(){var c={done:!1};try{Du(o,n,Ev(Pk,c,e),Ev(vv,c,e))}catch(u){vv(c,u,e)}}):(e.value=n,e.state=1,XF(e,!1))}catch(c){vv({done:!1},c,e)}}};Ui&&(sn=(qt=function(e){L(this,sn),m(e),Du(Ff,this);var n=Pe(this);try{e(Ev(Pk,n),Ev(vv,n))}catch(i){vv(n,i)}}).prototype,(Ff=function(e){He(this,{type:$t,done:!1,notified:!1,parent:!1,reactions:new yt,rejection:!1,state:0,value:void 0})}).prototype=Ak(sn,"then",function(e,n){var i=Pe(this),o=mr(B(this,qt));return i.parent=!0,o.ok=!T(e)||e,o.fail=T(n)&&n,o.domain=ip?ss.domain:void 0,i.state==0?i.reactions.add(o):ye(function(){YF(o,i)}),o.promise}),qT=function(){var e=new Ff,n=Pe(e);this.promise=e,this.resolve=Ev(Pk,n),this.reject=Ev(vv,n)},Kt.f=mr=function(e){return e===qt||e===void 0?new qT(e):Nd(e)}),Ik({global:!0,wrap:!0,forced:Ui},{Promise:qt}),_v(qt,$t,!1,!0),p($t);var ZF=ar("iterator"),ej=!1;try{var $re=0,tj={next:function(){return{done:!!$re++}},return:function(){ej=!0}};tj[ZF]=function(){return this},Array.from(tj,function(){throw 2})}catch{}var qre=np,Yre=function(e,n){if(!ej)return!1;var i=!1;try{var o={};o[ZF]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},UC=Lg.CONSTRUCTOR||!Yre(function(e){qre.all(e).then(void 0,function(){})}),Xre=xe,Jre=Qi,Qre=$c,Zre=Ad,eie=bd;kn({target:"Promise",stat:!0,forced:UC},{all:function(e){var n=this,i=Qre.f(n),o=i.resolve,c=i.reject,u=Zre(function(){var h=Jre(n.resolve),f=[],_=0,v=1;eie(e,function(y){var w=_++,I=!1;v++,Xre(h,n,y).then(function(P){I||(I=!0,f[w]=P,--v||o(f))},c)}),--v||o(f)});return u.error&&c(u.value),i.promise}});var tie=kn,nie=Lg.CONSTRUCTOR;np&&np.prototype,tie({target:"Promise",proto:!0,forced:nie,real:!0},{catch:function(e){return this.then(void 0,e)}});var rie=xe,iie=Qi,sie=$c,oie=Ad,aie=bd;kn({target:"Promise",stat:!0,forced:UC},{race:function(e){var n=this,i=sie.f(n),o=i.reject,c=oie(function(){var u=iie(n.resolve);aie(e,function(h){rie(u,n,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var cie=xe,lie=$c;kn({target:"Promise",stat:!0,forced:Lg.CONSTRUCTOR},{reject:function(e){var n=lie.f(this);return cie(n.reject,void 0,e),n.promise}});var uie=en,die=ut,hie=$c,nj=function(e,n){if(uie(e),die(n)&&n.constructor===e)return n;var i=hie.f(e);return(0,i.resolve)(n),i.promise},pie=kn,fie=np,mie=Lg.CONSTRUCTOR,gie=nj,_ie=tn("Promise"),Eie=!mie;pie({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return gie(Eie&&this===_ie?fie:this,e)}});var vie=xe,yie=Qi,Sie=$c,Tie=Ad,bie=bd;kn({target:"Promise",stat:!0,forced:UC},{allSettled:function(e){var n=this,i=Sie.f(n),o=i.resolve,c=i.reject,u=Tie(function(){var h=yie(n.resolve),f=[],_=0,v=1;bie(e,function(y){var w=_++,I=!1;v++,vie(h,n,y).then(function(P){I||(I=!0,f[w]={status:"fulfilled",value:P},--v||o(f))},function(P){I||(I=!0,f[w]={status:"rejected",reason:P},--v||o(f))})}),--v||o(f)});return u.error&&c(u.value),i.promise}});var wie=xe,Rie=Qi,Cie=tn,Iie=$c,Aie=Ad,Oie=bd,rj="No one promise resolved";kn({target:"Promise",stat:!0,forced:UC},{any:function(e){var n=this,i=Cie("AggregateError"),o=Iie.f(n),c=o.resolve,u=o.reject,h=Aie(function(){var f=Rie(n.resolve),_=[],v=0,y=1,w=!1;Oie(e,function(I){var P=v++,F=!1;y++,wie(f,n,I).then(function(x){F||w||(w=!0,c(x))},function(x){F||w||(F=!0,_[P]=x,--y||u(new i(_,rj)))})}),--y||u(new i(_,rj))});return h.error&&u(h.value),o.promise}});var Pie=kn,Nk=np,Nie=d,kie=tn,Die=Me,Lie=Mi,ij=nj,xie=Nk&&Nk.prototype;Pie({target:"Promise",proto:!0,real:!0,forced:!!Nk&&Nie(function(){xie.finally.call({then:function(){}},function(){})})},{finally:function(e){var n=Lie(this,kie("Promise")),i=Die(e);return this.then(i?function(o){return ij(n,e()).then(function(){return o})}:e,i?function(o){return ij(n,e()).then(function(){throw o})}:e)}});var kk=O,Mie=Qa,Uie=Zo,Vie=Xt,Fie=kk("".charAt),sj=kk("".charCodeAt),jie=kk("".slice),oj=function(e){return function(n,i){var o,c,u=Uie(Vie(n)),h=Mie(i),f=u.length;return h<0||h>=f?e?"":void 0:(o=sj(u,h))<55296||o>56319||h+1===f||(c=sj(u,h+1))<56320||c>57343?e?Fie(u,h):o:e?jie(u,h,h+2):c-56320+(o-55296<<10)+65536}},Dk={codeAt:oj(!1),charAt:oj(!0)},Bie=Dk.charAt,Wie=Zo,aj=Iu,Gie=BE,cj=WE,lj="String Iterator",zie=aj.set,Hie=aj.getterFor(lj);Gie(String,"String",function(e){zie(this,{type:lj,string:Wie(e),index:0})},function(){var e,n=Hie(this),i=n.string,o=n.index;return o>=i.length?cj(void 0,!0):(e=Bie(i,o),n.index+=e.length,cj(e,!1))});var Kie=ft.Promise,$ie={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},qie=H,Yie=Za,Xie=Ro,uj=yd,dj=ar("toStringTag");for(var Lk in $ie){var hj=qie[Lk],xk=hj&&hj.prototype;xk&&Yie(xk)!==dj&&Xie(xk,dj,Lk),uj[Lk]=uj.Array}var pj=Kie,tt=l(pj),Jie=Ia("Array").values,Qie=Za,Zie=li,ese=k,tse=Jie,Mk=Array.prototype,nse={DOMTokenList:!0,NodeList:!0},rse=function(e){var n=e.values;return e===Mk||ese(Mk,e)&&n===Mk.values||Zie(nse,Qie(e))?tse:n},uc=l(rse),ise=d,sse=ar("iterator"),Uk=!ise(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),n=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",n.forEach(function(c,u){n.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!n.size&&!0||!n.sort||e.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[sse]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),ose=Au,ase=Ra,cse=Ke,lse=_t,VC=function(e,n,i){var o=ase(n);o in e?cse.f(e,o,lse(0,i)):e[o]=i},fj=de,use=ei,dse=VC,hse=Array,pse=Math.max,Vk=function(e,n,i){for(var o=use(e),c=fj(n,o),u=fj(i===void 0?o:i,o),h=hse(pse(u-c,0)),f=0;c<u;c++,f++)dse(h,f,e[c]);return h.length=f,h},mj=Vk,fse=Math.floor,Fk=function(e,n){var i=e.length,o=fse(i/2);return i<8?mse(e,n):gse(e,Fk(mj(e,0,o),n),Fk(mj(e,o),n),n)},mse=function(e,n){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&n(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},gse=function(e,n,i,o){for(var c=n.length,u=i.length,h=0,f=0;h<c||f<u;)e[h+f]=h<c&&f<u?o(n[h],i[f])<=0?n[h++]:i[f++]:h<c?n[h++]:i[f++];return e},gj=Fk,jk=kn,yv=H,FC=xe,kd=O,Sv=et,_j=Uk,Ej=Au,_se=HE,Ese=function(e,n,i){for(var o in n)i&&i.unsafe&&e[o]?e[o]=n[o]:ose(e,o,n[o],i);return e},vse=Ou,yse=UE,Bk=Iu,vj=wg,Wk=Me,Sse=li,Tse=Re,bse=Za,wse=en,yj=ut,Da=Zo,Rse=Ao,Sj=_t,Gk=mg,Cse=Ru,Tv=Kc,Ise=gj,Ase=ar("iterator"),YT="URLSearchParams",Tj=YT+"Iterator",bj=Bk.set,kl=Bk.getterFor(YT),Ose=Bk.getterFor(Tj),Pse=Object.getOwnPropertyDescriptor,zk=function(e){if(!Sv)return yv[e];var n=Pse(yv,e);return n&&n.value},wj=zk("fetch"),jC=zk("Request"),XT=zk("Headers"),Hk=jC&&jC.prototype,Rj=XT&&XT.prototype,Nse=yv.RegExp,kse=yv.TypeError,Cj=yv.decodeURIComponent,Dse=yv.encodeURIComponent,Lse=kd("".charAt),Ij=kd([].join),xg=kd([].push),Kk=kd("".replace),xse=kd([].shift),Aj=kd([].splice),Oj=kd("".split),Mse=kd("".slice),Use=/\+/g,Pj=Array(4),Vse=function(e){return Pj[e-1]||(Pj[e-1]=Nse("((?:%[\\da-f]{2}){"+e+"})","gi"))},Fse=function(e){try{return Cj(e)}catch{return e}},Nj=function(e){var n=Kk(e,Use," "),i=4;try{return Cj(n)}catch{for(;i;)n=Kk(n,Vse(i--),Fse);return n}},jse=/[!'()~]|%20/g,Bse={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Wse=function(e){return Bse[e]},kj=function(e){return Kk(Dse(e),jse,Wse)},$k=yse(function(e,n){bj(this,{type:Tj,iterator:Gk(kl(e).entries),kind:n})},"Iterator",function(){var e=Ose(this),n=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=n==="keys"?o.key:n==="values"?o.value:[o.key,o.value]),i},!0),Dj=function(e){this.entries=[],this.url=null,e!==void 0&&(yj(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Lse(e,0)==="?"?Mse(e,1):e:Da(e)))};Dj.prototype={type:YT,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n,i,o,c,u,h,f,_=Cse(e);if(_)for(i=(n=Gk(e,_)).next;!(o=FC(i,n)).done;){if(u=(c=Gk(wse(o.value))).next,(h=FC(u,c)).done||(f=FC(u,c)).done||!FC(u,c).done)throw kse("Expected sequence with length 2");xg(this.entries,{key:Da(h.value),value:Da(f.value)})}else for(var v in e)Sse(e,v)&&xg(this.entries,{key:v,value:Da(e[v])})},parseQuery:function(e){if(e)for(var n,i,o=Oj(e,"&"),c=0;c<o.length;)(n=o[c++]).length&&(i=Oj(n,"="),xg(this.entries,{key:Nj(xse(i)),value:Nj(Ij(i,"="))}))},serialize:function(){for(var e,n=this.entries,i=[],o=0;o<n.length;)e=n[o++],xg(i,kj(e.key)+"="+kj(e.value));return Ij(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var BC=function(){vj(this,bv);var e=bj(this,new Dj(arguments.length>0?arguments[0]:void 0));Sv||(this.size=e.entries.length)},bv=BC.prototype;if(Ese(bv,{append:function(e,n){var i=kl(this);Tv(arguments.length,2),xg(i.entries,{key:Da(e),value:Da(n)}),Sv||this.length++,i.updateURL()},delete:function(e){for(var n=kl(this),i=Tv(arguments.length,1),o=n.entries,c=Da(e),u=i<2?void 0:arguments[1],h=u===void 0?u:Da(u),f=0;f<o.length;){var _=o[f];if(_.key!==c||h!==void 0&&_.value!==h)f++;else if(Aj(o,f,1),h!==void 0)break}Sv||(this.size=o.length),n.updateURL()},get:function(e){var n=kl(this).entries;Tv(arguments.length,1);for(var i=Da(e),o=0;o<n.length;o++)if(n[o].key===i)return n[o].value;return null},getAll:function(e){var n=kl(this).entries;Tv(arguments.length,1);for(var i=Da(e),o=[],c=0;c<n.length;c++)n[c].key===i&&xg(o,n[c].value);return o},has:function(e){for(var n=kl(this).entries,i=Tv(arguments.length,1),o=Da(e),c=i<2?void 0:arguments[1],u=c===void 0?c:Da(c),h=0;h<n.length;){var f=n[h++];if(f.key===o&&(u===void 0||f.value===u))return!0}return!1},set:function(e,n){var i=kl(this);Tv(arguments.length,1);for(var o,c=i.entries,u=!1,h=Da(e),f=Da(n),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?Aj(c,_--,1):(u=!0,o.value=f));u||xg(c,{key:h,value:f}),Sv||(this.size=c.length),i.updateURL()},sort:function(){var e=kl(this);Ise(e.entries,function(n,i){return n.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var n,i=kl(this).entries,o=Tse(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((n=i[c++]).value,n.key,this)},keys:function(){return new $k(this,"keys")},values:function(){return new $k(this,"values")},entries:function(){return new $k(this,"entries")}},{enumerable:!0}),Ej(bv,Ase,bv.entries,{}),Ej(bv,"toString",function(){return kl(this).serialize()},{enumerable:!0}),Sv&&_se(bv,"size",{get:function(){return kl(this).entries.length},configurable:!0,enumerable:!0}),vse(BC,YT),jk({global:!0,forced:!_j},{URLSearchParams:BC}),!_j&&Wk(XT)){var Gse=kd(Rj.has),zse=kd(Rj.set),Lj=function(e){if(yj(e)){var n,i=e.body;if(bse(i)===YT)return n=e.headers?new XT(e.headers):new XT,Gse(n,"content-type")||zse(n,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Rse(e,{body:Sj(0,Da(i)),headers:Sj(0,n)})}return e};if(Wk(wj)&&jk({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return wj(e,arguments.length>1?Lj(arguments[1]):{})}}),Wk(jC)){var qk=function(e){return vj(this,Hk),new jC(e,arguments.length>1?Lj(arguments[1]):{})};Hk.constructor=qk,qk.prototype=Hk,jk({global:!0,dontCallGetSet:!0,forced:!0},{Request:qk})}}var Dl,Hse={URLSearchParams:BC,getState:kl},Kse=ft.URLSearchParams,xj=et,$se=O,qse=xe,Yse=d,Yk=nc,Xse=tc,Jse=it,Qse=go,Zse=Rn,wv=Object.assign,Mj=Object.defineProperty,eoe=$se([].concat),toe=!wv||Yse(function(){if(xj&&wv({b:1},wv(Mj({},"a",{enumerable:!0,get:function(){Mj(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){n[c]=c}),wv({},e)[i]!=7||Yk(wv({},n)).join("")!=o})?function(e,n){for(var i=Qse(e),o=arguments.length,c=1,u=Xse.f,h=Jse.f;o>c;)for(var f,_=Zse(arguments[c++]),v=u?eoe(Yk(_),u(_)):Yk(_),y=v.length,w=0;y>w;)f=v[w++],xj&&!qse(h,_,f)||(i[f]=_[f]);return i}:wv,noe=en,roe=gg,ioe=Re,soe=xe,ooe=go,aoe=function(e,n,i,o){try{return o?n(noe(i)[0],i[1]):n(i)}catch(c){roe(e,"throw",c)}},coe=fg,loe=Ig,uoe=ei,Uj=VC,doe=mg,hoe=Ru,Vj=Array,Mg=O,Xk=2147483647,poe=/[^\0-\u007E]/,Fj=/[.\u3002\uFF0E\uFF61]/g,jj="Overflow: input needs wider integers to process",Bj=RangeError,foe=Mg(Fj.exec),Rv=Math.floor,Jk=String.fromCharCode,Wj=Mg("".charCodeAt),Gj=Mg([].join),jf=Mg([].push),moe=Mg("".replace),goe=Mg("".split),_oe=Mg("".toLowerCase),zj=function(e){return e+22+75*(e<26)},Eoe=function(e,n,i){var o=0;for(e=i?Rv(e/700):e>>1,e+=Rv(e/n);e>455;)e=Rv(e/35),o+=36;return Rv(o+36*e/(e+38))},voe=function(e){var n=[];e=function($){for(var q=[],ae=0,me=$.length;ae<me;){var ge=Wj($,ae++);if(ge>=55296&&ge<=56319&&ae<me){var pe=Wj($,ae++);(64512&pe)==56320?jf(q,((1023&ge)<<10)+(1023&pe)+65536):(jf(q,ge),ae--)}else jf(q,ge)}return q}(e);var i,o,c=e.length,u=128,h=0,f=72;for(i=0;i<e.length;i++)(o=e[i])<128&&jf(n,Jk(o));var _=n.length,v=_;for(_&&jf(n,"-");v<c;){var y=Xk;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<y&&(y=o);var w=v+1;if(y-u>Rv((Xk-h)/w))throw Bj(jj);for(h+=(y-u)*w,u=y,i=0;i<e.length;i++){if((o=e[i])<u&&++h>Xk)throw Bj(jj);if(o==u){for(var I=h,P=36;;){var F=P<=f?1:P>=f+26?26:P-f;if(I<F)break;var x=I-F,M=36-F;jf(n,Jk(zj(F+x%M))),I=Rv(x/M),P+=36}jf(n,Jk(zj(I))),f=Eoe(h,w,v==_),h=0,v++}}h++,u++}return Gj(n,"")},yoe=kn,Qk=et,Soe=Uk,Zk=H,Hj=Re,Ll=O,WC=Au,xl=HE,Toe=wg,eD=li,tD=toe,Cv=function(e){var n=ooe(e),i=loe(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=ioe(c,o>2?arguments[2]:void 0));var h,f,_,v,y,w,I=hoe(n),P=0;if(!I||this===Vj&&coe(I))for(h=uoe(n),f=i?new this(h):Vj(h);h>P;P++)w=u?c(n[P],P):n[P],Uj(f,P,w);else for(y=(v=doe(n,I)).next,f=i?new this:[];!(_=soe(y,v)).done;P++)w=u?aoe(v,c,[_.value,P],!0):_.value,Uj(f,P,w);return f.length=P,f},Lu=Vk,boe=Dk.codeAt,woe=function(e){var n,i,o=[],c=goe(moe(_oe(e),Fj,"."),".");for(n=0;n<c.length;n++)i=c[n],jf(o,foe(poe,i)?"xn--"+voe(i):i);return Gj(o,".")},sp=Zo,Roe=Ou,Coe=Kc,Kj=Hse,$j=Iu,Ioe=$j.set,GC=$j.getterFor("URL"),Aoe=Kj.URLSearchParams,Ooe=Kj.getState,JT=Zk.URL,nD=Zk.TypeError,zC=Zk.parseInt,Poe=Math.floor,qj=Math.pow,Ml=Ll("".charAt),xu=Ll(/./.exec),QT=Ll([].join),Noe=Ll(1 .toString),koe=Ll([].pop),Iv=Ll([].push),rD=Ll("".replace),Doe=Ll([].shift),Loe=Ll("".split),ZT=Ll("".slice),HC=Ll("".toLowerCase),xoe=Ll([].unshift),iD="Invalid scheme",Ug="Invalid host",Yj="Invalid port",Xj=/[a-z]/i,Moe=/[\d+-.a-z]/i,sD=/\d/,Uoe=/^0x/i,Voe=/^[0-7]+$/,Foe=/^\d+$/,Jj=/^[\da-f]+$/i,joe=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Boe=/[\0\t\n\r #/:<>?@[\\\]^|]/,Woe=/^[\u0000-\u0020]+/,Goe=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,zoe=/[\t\n\r]/g,e0=function(e){var n,i,o,c;if(typeof e=="number"){for(n=[],i=0;i<4;i++)xoe(n,e%256),e=Poe(e/256);return QT(n,".")}if(typeof e=="object"){for(n="",o=function(u){for(var h=null,f=1,_=null,v=0,y=0;y<8;y++)u[y]!==0?(v>f&&(h=_,f=v),_=null,v=0):(_===null&&(_=y),++v);return v>f&&(h=_,f=v),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(n+=i?":":"::",c=!0):(n+=Noe(e[i],16),i<7&&(n+=":")));return"["+n+"]"}return e},KC={},Qj=tD({},KC,{" ":1,'"':1,"<":1,">":1,"`":1}),Zj=tD({},Qj,{"#":1,"?":1,"{":1,"}":1}),oD=tD({},Zj,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Bf=function(e,n){var i=boe(e,0);return i>32&&i<127&&!eD(n,e)?e:encodeURIComponent(e)},$C={ftp:21,file:null,http:80,https:443,ws:80,wss:443},t0=function(e,n){var i;return e.length==2&&xu(Xj,Ml(e,0))&&((i=Ml(e,1))==":"||!n&&i=="|")},eB=function(e){var n;return e.length>1&&t0(ZT(e,0,2))&&(e.length==2||(n=Ml(e,2))==="/"||n==="\\"||n==="?"||n==="#")},Hoe=function(e){return e==="."||HC(e)==="%2e"},aD={},tB={},cD={},nB={},rB={},lD={},iB={},sB={},qC={},YC={},uD={},dD={},hD={},pD={},oB={},fD={},Av={},Dd={},aB={},Vg={},op={},mD=function(e,n,i){var o,c,u,h=sp(e);if(n){if(c=this.parse(h))throw nD(c);this.searchParams=null}else{if(i!==void 0&&(o=new mD(i,!0)),c=this.parse(h,null,o))throw nD(c);(u=Ooe(new Aoe)).bindURL(this),this.searchParams=u}};mD.prototype={type:"URL",parse:function(e,n,i){var o,c,u,h,f,_=this,v=n||aD,y=0,w="",I=!1,P=!1,F=!1;for(e=sp(e),n||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=rD(e,Woe,""),e=rD(e,Goe,"$1")),e=rD(e,zoe,""),o=Cv(e);y<=o.length;){switch(c=o[y],v){case aD:if(!c||!xu(Xj,c)){if(n)return iD;v=cD;continue}w+=HC(c),v=tB;break;case tB:if(c&&(xu(Moe,c)||c=="+"||c=="-"||c=="."))w+=HC(c);else{if(c!=":"){if(n)return iD;w="",v=cD,y=0;continue}if(n&&(_.isSpecial()!=eD($C,w)||w=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=w,n)return void(_.isSpecial()&&$C[_.scheme]==_.port&&(_.port=null));w="",_.scheme=="file"?v=pD:_.isSpecial()&&i&&i.scheme==_.scheme?v=nB:_.isSpecial()?v=sB:o[y+1]=="/"?(v=rB,y++):(_.cannotBeABaseURL=!0,Iv(_.path,""),v=aB)}break;case cD:if(!i||i.cannotBeABaseURL&&c!="#")return iD;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=Lu(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,v=op;break}v=i.scheme=="file"?pD:lD;continue;case nB:if(c!="/"||o[y+1]!="/"){v=lD;continue}v=qC,y++;break;case rB:if(c=="/"){v=YC;break}v=Dd;continue;case lD:if(_.scheme=i.scheme,c==Dl)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Lu(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())v=iB;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Lu(i.path),_.query="",v=Vg;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Lu(i.path),_.path.length--,v=Dd;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Lu(i.path),_.query=i.query,_.fragment="",v=op}break;case iB:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,v=Dd;continue}v=YC}else v=qC;break;case sB:if(v=qC,c!="/"||Ml(w,y+1)!="/")continue;y++;break;case qC:if(c!="/"&&c!="\\"){v=YC;continue}break;case YC:if(c=="@"){I&&(w="%40"+w),I=!0,u=Cv(w);for(var x=0;x<u.length;x++){var M=u[x];if(M!=":"||F){var $=Bf(M,oD);F?_.password+=$:_.username+=$}else F=!0}w=""}else if(c==Dl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(I&&w=="")return"Invalid authority";y-=Cv(w).length+1,w="",v=uD}else w+=c;break;case uD:case dD:if(n&&_.scheme=="file"){v=fD;continue}if(c!=":"||P){if(c==Dl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&w=="")return Ug;if(n&&w==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(w))return h;if(w="",v=Av,n)return;continue}c=="["?P=!0:c=="]"&&(P=!1),w+=c}else{if(w=="")return Ug;if(h=_.parseHost(w))return h;if(w="",v=hD,n==dD)return}break;case hD:if(!xu(sD,c)){if(c==Dl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||n){if(w!=""){var q=zC(w,10);if(q>65535)return Yj;_.port=_.isSpecial()&&q===$C[_.scheme]?null:q,w=""}if(n)return;v=Av;continue}return Yj}w+=c;break;case pD:if(_.scheme="file",c=="/"||c=="\\")v=oB;else{if(!i||i.scheme!="file"){v=Dd;continue}if(c==Dl)_.host=i.host,_.path=Lu(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=Lu(i.path),_.query="",v=Vg;else{if(c!="#"){eB(QT(Lu(o,y),""))||(_.host=i.host,_.path=Lu(i.path),_.shortenPath()),v=Dd;continue}_.host=i.host,_.path=Lu(i.path),_.query=i.query,_.fragment="",v=op}}break;case oB:if(c=="/"||c=="\\"){v=fD;break}i&&i.scheme=="file"&&!eB(QT(Lu(o,y),""))&&(t0(i.path[0],!0)?Iv(_.path,i.path[0]):_.host=i.host),v=Dd;continue;case fD:if(c==Dl||c=="/"||c=="\\"||c=="?"||c=="#"){if(!n&&t0(w))v=Dd;else if(w==""){if(_.host="",n)return;v=Av}else{if(h=_.parseHost(w))return h;if(_.host=="localhost"&&(_.host=""),n)return;w="",v=Av}continue}w+=c;break;case Av:if(_.isSpecial()){if(v=Dd,c!="/"&&c!="\\")continue}else if(n||c!="?")if(n||c!="#"){if(c!=Dl&&(v=Dd,c!="/"))continue}else _.fragment="",v=op;else _.query="",v=Vg;break;case Dd:if(c==Dl||c=="/"||c=="\\"&&_.isSpecial()||!n&&(c=="?"||c=="#")){if((f=HC(f=w))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||Iv(_.path,"")):Hoe(w)?c=="/"||c=="\\"&&_.isSpecial()||Iv(_.path,""):(_.scheme=="file"&&!_.path.length&&t0(w)&&(_.host&&(_.host=""),w=Ml(w,0)+":"),Iv(_.path,w)),w="",_.scheme=="file"&&(c==Dl||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)Doe(_.path);c=="?"?(_.query="",v=Vg):c=="#"&&(_.fragment="",v=op)}else w+=Bf(c,Zj);break;case aB:c=="?"?(_.query="",v=Vg):c=="#"?(_.fragment="",v=op):c!=Dl&&(_.path[0]+=Bf(c,KC));break;case Vg:n||c!="#"?c!=Dl&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":Bf(c,KC)):(_.fragment="",v=op);break;case op:c!=Dl&&(_.fragment+=Bf(c,Qj))}y++}},parseHost:function(e){var n,i,o;if(Ml(e,0)=="["){if(Ml(e,e.length-1)!="]"||(n=function(c){var u,h,f,_,v,y,w,I=[0,0,0,0,0,0,0,0],P=0,F=null,x=0,M=function(){return Ml(c,x)};if(M()==":"){if(Ml(c,1)!=":")return;x+=2,F=++P}for(;M();){if(P==8)return;if(M()!=":"){for(u=h=0;h<4&&xu(Jj,M());)u=16*u+zC(M(),16),x++,h++;if(M()=="."){if(h==0||(x-=h,P>6))return;for(f=0;M();){if(_=null,f>0){if(!(M()=="."&&f<4))return;x++}if(!xu(sD,M()))return;for(;xu(sD,M());){if(v=zC(M(),10),_===null)_=v;else{if(_==0)return;_=10*_+v}if(_>255)return;x++}I[P]=256*I[P]+_,++f!=2&&f!=4||P++}if(f!=4)return;break}if(M()==":"){if(x++,!M())return}else if(M())return;I[P++]=u}else{if(F!==null)return;x++,F=++P}}if(F!==null)for(y=P-F,P=7;P!=0&&y>0;)w=I[P],I[P--]=I[F+y-1],I[F+--y]=w;else if(P!=8)return;return I}(ZT(e,1,-1)),!n))return Ug;this.host=n}else if(this.isSpecial()){if(e=woe(e),xu(joe,e)||(n=function(c){var u,h,f,_,v,y,w,I=Loe(c,".");if(I.length&&I[I.length-1]==""&&I.length--,(u=I.length)>4)return c;for(h=[],f=0;f<u;f++){if((_=I[f])=="")return c;if(v=10,_.length>1&&Ml(_,0)=="0"&&(v=xu(Uoe,_)?16:8,_=ZT(_,v==8?1:2)),_==="")y=0;else{if(!xu(v==10?Foe:v==8?Voe:Jj,_))return c;y=zC(_,v)}Iv(h,y)}for(f=0;f<u;f++)if(y=h[f],f==u-1){if(y>=qj(256,5-u))return null}else if(y>255)return null;for(w=koe(h),f=0;f<h.length;f++)w+=h[f]*qj(256,3-f);return w}(e),n===null))return Ug;this.host=n}else{if(xu(Boe,e))return Ug;for(n="",i=Cv(e),o=0;o<i.length;o++)n+=Bf(i[o],KC);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return eD($C,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;!n||this.scheme=="file"&&n==1&&t0(e[0],!0)||e.length--},serialize:function(){var e=this,n=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,f=e.query,_=e.fragment,v=n+":";return c!==null?(v+="//",e.includesCredentials()&&(v+=i+(o?":"+o:"")+"@"),v+=e0(c),u!==null&&(v+=":"+u)):n=="file"&&(v+="//"),v+=e.cannotBeABaseURL?h[0]:h.length?"/"+QT(h,"/"):"",f!==null&&(v+="?"+f),_!==null&&(v+="#"+_),v},setHref:function(e){var n=this.parse(e);if(n)throw nD(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e=="blob")try{return new Ov(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+e0(this.host)+(n!==null?":"+n:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(sp(e)+":",aD)},getUsername:function(){return this.username},setUsername:function(e){var n=Cv(sp(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<n.length;i++)this.username+=Bf(n[i],oD)}},getPassword:function(){return this.password},setPassword:function(e){var n=Cv(sp(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<n.length;i++)this.password+=Bf(n[i],oD)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?e0(e):e0(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,uD)},getHostname:function(){var e=this.host;return e===null?"":e0(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,dD)},getPort:function(){var e=this.port;return e===null?"":sp(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=sp(e))==""?this.port=null:this.parse(e,hD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+QT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Av))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=sp(e))==""?this.query=null:(Ml(e,0)=="?"&&(e=ZT(e,1)),this.query="",this.parse(e,Vg)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=sp(e))!=""?(Ml(e,0)=="#"&&(e=ZT(e,1)),this.fragment="",this.parse(e,op)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ov=function(e){var n=Toe(this,La),i=Coe(arguments.length,1)>1?arguments[1]:void 0,o=Ioe(n,new mD(e,!1,i));Qk||(n.href=o.serialize(),n.origin=o.getOrigin(),n.protocol=o.getProtocol(),n.username=o.getUsername(),n.password=o.getPassword(),n.host=o.getHost(),n.hostname=o.getHostname(),n.port=o.getPort(),n.pathname=o.getPathname(),n.search=o.getSearch(),n.searchParams=o.getSearchParams(),n.hash=o.getHash())},La=Ov.prototype,Ul=function(e,n){return{get:function(){return GC(this)[e]()},set:n&&function(i){return GC(this)[n](i)},configurable:!0,enumerable:!0}};if(Qk&&(xl(La,"href",Ul("serialize","setHref")),xl(La,"origin",Ul("getOrigin")),xl(La,"protocol",Ul("getProtocol","setProtocol")),xl(La,"username",Ul("getUsername","setUsername")),xl(La,"password",Ul("getPassword","setPassword")),xl(La,"host",Ul("getHost","setHost")),xl(La,"hostname",Ul("getHostname","setHostname")),xl(La,"port",Ul("getPort","setPort")),xl(La,"pathname",Ul("getPathname","setPathname")),xl(La,"search",Ul("getSearch","setSearch")),xl(La,"searchParams",Ul("getSearchParams")),xl(La,"hash",Ul("getHash","setHash"))),WC(La,"toJSON",function(){return GC(this).serialize()},{enumerable:!0}),WC(La,"toString",function(){return GC(this).serialize()},{enumerable:!0}),JT){var cB=JT.createObjectURL,lB=JT.revokeObjectURL;cB&&WC(Ov,"createObjectURL",Hj(cB,JT)),lB&&WC(Ov,"revokeObjectURL",Hj(lB,JT))}Roe(Ov,"URL"),yoe({global:!0,forced:!Soe,sham:!Qk},{URL:Ov});var Koe=kn,$oe=d,qoe=Kc,uB=Zo,Yoe=Uk,dB=tn("URL");Koe({target:"URL",stat:!0,forced:!(Yoe&&$oe(function(){dB.canParse()}))},{canParse:function(e){var n=qoe(arguments.length,1),i=uB(e),o=n<2||arguments[1]===void 0?void 0:uB(arguments[1]);try{return!!new dB(i,o)}catch{return!1}}});var XC=l(ft.URL);let hB=!0,pB=!0;function JC(e,n,i){const o=e.match(n);return o&&o.length>=i&&parseInt(o[i],10)}function Fg(e,n,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,f){if(h!==n)return c.apply(this,arguments);const _=v=>{const y=i(v);y&&(f.handleEvent?f.handleEvent(y):f(y))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(f,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,f){if(h!==n||!this._eventMap||!this._eventMap[n])return u.apply(this,arguments);if(!this._eventMap[n].has(f))return u.apply(this,arguments);const _=this._eventMap[n].get(f);return this._eventMap[n].delete(f),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function Xoe(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(hB=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Joe(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(pB=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function fB(){if(typeof window=="object"){if(hB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function gD(e,n){pB&&console.warn(e+" is deprecated, please use "+n+" instead.")}function mB(e){return Object.prototype.toString.call(e)==="[object Object]"}function gB(e){var n;return mB(e)?Aa(n=Object.keys(e)).call(n,function(i,o){const c=mB(e[o]),u=c?gB(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function _D(e,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(o=>{o.endsWith("Id")?_D(e,e.get(n[o]),i):o.endsWith("Ids")&&n[o].forEach(c=>{_D(e,e.get(c),i)})}))}function _B(e,n,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(n===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===n.id&&u.push(h)}),u.forEach(h=>{e.forEach(f=>{f.type===o&&f.trackId===h.id&&_D(e,f,c)})}),c}const EB=fB;function vB(e,n){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const v=typeof h[_]=="object"?h[_]:{ideal:h[_]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const y=function(w,I){return w?w+I.charAt(0).toUpperCase()+I.slice(1):I==="deviceId"?"sourceId":I};if(v.ideal!==void 0){f.optional=f.optional||[];let w={};typeof v.ideal=="number"?(w[y("min",_)]=v.ideal,f.optional.push(w),w={},w[y("max",_)]=v.ideal,f.optional.push(w)):(w[y("",_)]=v.ideal,f.optional.push(w))}v.exact!==void 0&&typeof v.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[y("",_)]=v.exact):["min","max"].forEach(w=>{v[w]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[y(w,_)]=v[w])})}),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},c=function(h,f){if(n.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(v,y,w){y in v&&!(w in v)&&(v[w]=v[y],delete v[y])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const v=n.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||v)){let y;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?y=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(y=["front"]),y)return i.mediaDevices.enumerateDevices().then(w=>{let I=(w=w.filter(P=>P.kind==="videoinput")).find(P=>y.some(F=>{var x;return Xe(x=P.label.toLowerCase()).call(x,F)}));return!I&&w.length&&Xe(y).call(y,"back")&&(I=w[w.length-1]),I&&(h.video.deviceId=_.exact?{exact:I.deviceId}:{ideal:I.deviceId}),h.video=o(h.video),EB("chrome: "+JSON.stringify(h)),f(h)})}h.video=o(h.video)}return EB("chrome: "+JSON.stringify(h)),f(h)},u=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,f,_){c(h,v=>{i.webkitGetUserMedia(v,f,y=>{_&&_(u(y))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(f){return c(f,_=>h(_).then(v=>{if(_.audio&&!v.getAudioTracks().length||_.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return v},v=>tt.reject(u(v))))}}}function yB(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function SB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else Fg(e,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function TB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const n=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,f){let _=c.apply(this,arguments);return _||(_=n(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const f=this._senders.indexOf(h);f!==-1&&this._senders.splice(f,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(n(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(f=>f.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function bB(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof i!="function"))return n.apply(this,[]);const u=function(f){const _={};return f.result().forEach(v=>{const y={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(w=>{y[w]=v.stat(w)}),_[y.id]=y}),_},h=function(f){return new Map(Object.keys(f).map(_=>[_,f[_]]))};if(arguments.length>=2){const f=function(_){o(h(u(_)))};return n.apply(this,[f,i])}return new tt((f,_)=>{n.apply(this,[function(v){f(h(u(v)))},_])}).then(o,c)}}function wB(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>_B(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),Fg(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>_B(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?tt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():tt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function RB(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(f)===-1&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(y=>y.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const f=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(f)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const f=this._shimmedLocalStreams[h].indexOf(u);f!==-1&&this._shimmedLocalStreams[h].splice(f,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function CB(e,n){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return RB(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(v=>this._reverseStreams[v.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(v=>{if(this.getSenders().find(w=>w.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const v=new e.MediaStream(_.getTracks());this._streams[_.id]=v,this._reverseStreams[v.id]=_,_=v}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,v){let y=v.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const I=_._reverseStreams[w],P=_._streams[I.id];y=y.replace(new RegExp(P.id,"g"),I.id)}),new RTCSessionDescription({type:v.type,sdp:y})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(P=>P===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(P=>P.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[v.id];if(I)I.addTrack(_),tt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const P=new e.MediaStream([_]);this._streams[v.id]=P,this._reverseStreams[P.id]=v,this.addStream(P)}return this.getSenders().find(P=>P.track===_)},["createOffer","createAnswer"].forEach(function(_){const v=e.RTCPeerConnection.prototype[_],y={[_](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[I=>{const P=u(this,I);w[0].apply(null,[P])},I=>{w[1]&&w[1].apply(null,I)},arguments[2]]):v.apply(this,arguments).then(I=>u(this,I))}};e.RTCPeerConnection.prototype[_]=y[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,v){let y=v.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const I=_._reverseStreams[w],P=_._streams[I.id];y=y.replace(new RegExp(I.id,"g"),P.id)}),new RTCSessionDescription({type:v.type,sdp:y})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=f.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(w=>_.track===w)&&(v=this._streams[y])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ED(e,n){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function IB(e,n){Fg(e,"negotiationneeded",i=>{const o=i.target;if(!(n.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var AB=Object.freeze({__proto__:null,fixNegotiationNeeded:IB,shimAddTrackRemoveTrack:CB,shimAddTrackRemoveTrackWithNative:RB,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof n=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return n(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:TB,shimGetStats:bB,shimGetUserMedia:vB,shimMediaStream:yB,shimOnTrack:SB,shimPeerConnection:ED,shimSenderReceiverGetStats:wB});function OB(e,n){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){gD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,f,_){f in h&&!(_ in h)&&(h[_]=h[f],delete h[f])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const f=h.apply(this,arguments);return c(f,"mozAutoGainControl","autoGainControl"),c(f,"mozNoiseSuppression","noiseSuppression"),f}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f,"autoGainControl","mozAutoGainControl"),c(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function PB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function vD(e,n){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(f=>{if(n.version<53&&!u)try{f.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;f.forEach((v,y)=>{f.set(y,Object.assign({},v,{type:i[v.type]||v.type}))})}return f}).then(u,h)}}function NB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):tt.resolve(new Map)}}function kB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),Fg(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function DB(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(n){gD("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&Xe(o=n.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function LB(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function xB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function MB(e){if(typeof e!="object"||!e.RTCRtpSender)return;const n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){const i=n.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function UB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?tt.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function VB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?tt.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var FB=Object.freeze({__proto__:null,shimAddTransceiver:xB,shimCreateAnswer:VB,shimCreateOffer:UB,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,tt.reject(o)}return i.video===!0?i.video={mediaSource:n}:i.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:MB,shimGetUserMedia:OB,shimOnTrack:PB,shimPeerConnection:vD,shimRTCDataChannel:LB,shimReceiverGetStats:kB,shimRemoveStream:DB,shimSenderGetStats:NB});function jB(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),Xe(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>n.call(this,c,i)),i.getVideoTracks().forEach(c=>n.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var f;this._localStreams?Xe(f=this._localStreams).call(f,h)||this._localStreams.push(h):this._localStreams=[h]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const o=n.getTracks();this.getSenders().forEach(c=>{Xe(o).call(o,c.track)&&this.removeTrack(c)})})}}function BB(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),Xe(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),n.apply(i,arguments)}}}function WB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.createOffer,o=n.createAnswer,c=n.setLocalDescription,u=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(_,v){const y=arguments.length>=2?arguments[2]:arguments[0],w=i.apply(this,[y]);return v?(w.then(_,v),tt.resolve()):w},n.createAnswer=function(_,v){const y=arguments.length>=2?arguments[2]:arguments[0],w=o.apply(this,[y]);return v?(w.then(_,v),tt.resolve()):w};let f=function(_,v,y){const w=c.apply(this,[_]);return y?(w.then(v,y),tt.resolve()):w};n.setLocalDescription=f,f=function(_,v,y){const w=u.apply(this,[_]);return y?(w.then(v,y),tt.resolve()):w},n.setRemoteDescription=f,f=function(_,v,y){const w=h.apply(this,[_]);return y?(w.then(v,y),tt.resolve()):w},n.addIceCandidate=f}function GB(e){const n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const i=n.mediaDevices,o=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=c=>o(zB(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=(function(i,o,c){n.mediaDevices.getUserMedia(i).then(o,c)}).bind(n))}function zB(e){return e&&e.video!==void 0?Object.assign({},e,{video:gB(e.video)}):e}function HB(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(gD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new n(i,o)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function KB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $B(e){const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function qB(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var YB=Object.freeze({__proto__:null,shimAudioContext:qB,shimCallbacksAPI:WB,shimConstraints:zB,shimCreateOfferLegacy:$B,shimGetUserMedia:GB,shimLocalStreamsAPI:jB,shimRTCIceServerUrls:HB,shimRemoteStreamsAPI:BB,shimTrackEventTransceiver:KB}),XB=`	
\v\f\r \u2028\u2029\uFEFF`,Qoe=Xt,Zoe=Zo,yD=XB,JB=O("".replace),eae=RegExp("^["+yD+"]+"),tae=RegExp("(^|[^"+yD+"])["+yD+"]+$"),nae=function(e){return function(n){var i=Zoe(Qoe(n));return 1&e&&(i=JB(i,eae,"")),2&e&&(i=JB(i,tae,"$1")),i}},rae={trim:nae(3)},iae=iC.PROPER,sae=d,QB=XB,oae=rae.trim;kn({target:"String",proto:!0,forced:function(e){return sae(function(){return!!QB[e]()||""[e]()!==""||iae&&QB[e].name!==e})}("trim")},{trim:function(){return oae(this)}});var aae=Ia("String").trim,cae=k,lae=aae,SD=String.prototype,uae=function(e){var n=e.trim;return typeof e=="string"||e===SD||cae(SD,e)&&n===SD.trim?lae:n},Fs=l(uae),ZB={exports:{}};(function(e){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},n.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},n.getDescription=function(i){const o=n.splitSections(i);return o&&o[0]},n.getMediaSections=function(i){const o=n.splitSections(i);return o.shift(),o},n.matchPrefix=function(i,o){return n.splitLines(i).filter(c=>c.indexOf(o)===0)},n.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},n.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},n.parseIceOptions=function(i){return i.substring(14).split(" ")},n.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},n.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},n.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},n.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},n.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},n.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},n.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},n.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},n.getMid=function(i){const o=n.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},n.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},n.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:n.matchPrefix(i+o,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},n.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,o){return n.matchPrefix(i+o,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,o){const c=n.matchPrefix(i+o,"a=ice-ufrag:")[0],u=n.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},n.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},n.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const f=c[h],_=n.matchPrefix(i,"a=rtpmap:"+f+" ")[0];if(_){const v=n.parseRtpMap(_),y=n.matchPrefix(i,"a=fmtp:"+f+" ");switch(v.parameters=y.length?n.parseFmtp(y[0]):{},v.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+f+" ").map(n.parseRtcpFb),o.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(v.name.toUpperCase())}}}n.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(n.parseExtmap(h))});const u=n.matchPrefix(i,"a=rtcp-fb:* ").map(n.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(f=>{h.rtcpFeedback.find(_=>_.type===f.type&&_.parameter===f.parameter)||h.rtcpFeedback.push(f)})}),o},n.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(i){const o=[],c=n.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,f=n.matchPrefix(i,"a=ssrc:").map(I=>n.parseSsrcMedia(I)).filter(I=>I.attribute==="cname"),_=f.length>0&&f[0].ssrc;let v;const y=n.matchPrefix(i,"a=ssrc-group:FID").map(I=>I.substring(17).split(" ").map(P=>parseInt(P,10)));y.length>0&&y[0].length>1&&y[0][0]===_&&(v=y[0][1]),c.codecs.forEach(I=>{if(I.name.toUpperCase()==="RTX"&&I.parameters.apt){let P={ssrc:_,codecPayloadType:parseInt(I.parameters.apt,10)};_&&v&&(P.rtx={ssrc:v}),o.push(P),u&&(P=JSON.parse(JSON.stringify(P)),P.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(P))}}),o.length===0&&_&&o.push({ssrc:_});let w=n.matchPrefix(i,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,o.forEach(I=>{I.maxBitrate=w})),o},n.parseRtcpParameters=function(i){const o={},c=n.matchPrefix(i,"a=ssrc:").map(f=>n.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=n.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=n.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},n.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},n.parseMsid=function(i){let o;const c=n.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=n.matchPrefix(i,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},n.parseSctpDescription=function(i){const o=n.parseMLine(i),c=n.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=n.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const f=n.matchPrefix(i,"a=sctpmap:");if(f.length>0){const _=f[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},n.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||n.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(i,o){const c=n.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?n.getDirection(o):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substring(2)},n.isRejected=function(i){return i.split(" ",2)[1]==="0"},n.parseMLine=function(i){const o=n.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},n.parseOLine=function(i){const o=n.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},n.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=n.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=n})(ZB);var e4=ZB.exports,Pv=l(e4),dae=s({__proto__:null,default:Pv},[e4]);function QC(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const n=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new n(i),c=Pv.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new n(i)},e.RTCIceCandidate.prototype=n.prototype,Fg(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function TD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Fg(e,"icecandidate",n=>{if(n.candidate){const i=Pv.parseCandidate(n.candidate.candidate);i.type==="relay"&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function ZC(e,n){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(f){if(!f||!f.sdp)return!1;const _=Pv.splitSections(f.sdp);return _.shift(),_.some(v=>{const y=Pv.parseMLine(v);return y&&y.kind==="application"&&y.protocol.indexOf("SCTP")!==-1})},o=function(f){const _=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const v=parseInt(_[1],10);return v!=v?-1:v},c=function(f){let _=65536;return n.browser==="firefox"&&(_=n.version<57?f===-1?16384:2147483637:n.version<60?n.version===57?65535:65536:2147483637),_},u=function(f,_){let v=65536;n.browser==="firefox"&&n.version===57&&(v=65535);const y=Pv.matchPrefix(f.sdp,"a=max-message-size:");return y.length>0?v=parseInt(y[0].substr(19),10):n.browser==="firefox"&&_!==-1&&(v=2147483637),v},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const f=o(arguments[0]),_=c(f),v=u(arguments[0],f);let y;y=_===0&&v===0?Number.POSITIVE_INFINITY:_===0||v===0?Math.max(_,v):Math.min(_,v);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>y}),this._sctp=w}return h.apply(this,arguments)}}function eI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function n(o,c){const u=o.send;o.send=function(){const h=arguments[0],f=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&f>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return n(o,this),o},Fg(e,"datachannel",o=>(n(o.channel,o.target),o))}function bD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function wD(e,n){if(!e.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>Fs(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function tI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?tt.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),tt.resolve())})}function nI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var hae=Object.freeze({__proto__:null,removeExtmapAllowMixed:wD,shimAddIceCandidateNullOrEmpty:tI,shimConnectionState:bD,shimMaxMessageSize:ZC,shimParameterlessSetLocalDescription:nI,shimRTCIceCandidate:QC,shimRTCIceCandidateRelayProtocol:TD,shimSendThrowTypeError:eI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=fB,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:f}=u;if(f.mozGetUserMedia)h.browser="firefox",h.version=JC(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=JC(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=JC(f.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:hae,extractVersion:JC,disableLog:Xoe,disableWarnings:Joe,sdp:dae};switch(o.browser){case"chrome":if(!AB||!ED||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=AB,tI(e,o),nI(e),vB(e,o),yB(e),ED(e,o),SB(e),CB(e,o),TB(e),bB(e),wB(e),IB(e,o),QC(e),TD(e),bD(e),ZC(e,o),eI(e),wD(e,o);break;case"firefox":if(!FB||!vD||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=FB,tI(e,o),nI(e),OB(e,o),vD(e,o),PB(e),DB(e),NB(e),kB(e),LB(e),xB(e),MB(e),UB(e),VB(e),QC(e),bD(e),ZC(e,o),eI(e);break;case"safari":if(!YB||!n.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=YB,tI(e,o),nI(e),HB(e),$B(e),WB(e),jB(e),BB(e),KB(e),GB(e),qB(e),QC(e),TD(e),ZC(e,o),eI(e),wD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var t4=Ka,pae=TypeError,n4=ur.match(/firefox\/(\d+)/i),fae=!!n4&&+n4[1],mae=/MSIE|Trident/.test(ur),r4=ur.match(/AppleWebKit\/(\d+)\./),gae=!!r4&&+r4[1],_ae=kn,i4=O,Eae=Qi,vae=go,s4=ei,yae=function(e,n){if(!delete e[n])throw pae("Cannot delete property "+t4(n)+" of "+t4(e))},o4=Zo,RD=d,Sae=gj,Tae=Uh,a4=fae,bae=mae,c4=ci,l4=gae,Wf=[],u4=i4(Wf.sort),wae=i4(Wf.push),Rae=RD(function(){Wf.sort(void 0)}),Cae=RD(function(){Wf.sort(null)}),Iae=Tae("sort"),d4=!RD(function(){if(c4)return c4<70;if(!(a4&&a4>3)){if(bae)return!0;if(l4)return l4<603;var e,n,i,o,c="";for(e=65;e<76;e++){switch(n=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)Wf.push({k:n+o,v:i})}for(Wf.sort(function(u,h){return h.v-u.v}),o=0;o<Wf.length;o++)n=Wf[o].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return c!=="DGBEFHACIJK"}});_ae({target:"Array",proto:!0,forced:Rae||!Cae||!Iae||!d4},{sort:function(e){e!==void 0&&Eae(e);var n=vae(this);if(d4)return e===void 0?u4(n):u4(n,e);var i,o,c=[],u=s4(n);for(o=0;o<u;o++)o in n&&wae(c,n[o]);for(Sae(c,function(h){return function(f,_){return _===void 0?-1:f===void 0?1:h!==void 0?+h(f,_)||0:o4(f)>o4(_)?1:-1}}(e)),i=s4(c),o=0;o<i;)n[o]=c[o++];for(;o<u;)yae(n,o++);return n}});var Aae=Ia("Array").sort,Oae=k,Pae=Aae,CD=Array.prototype,Nae=function(e){var n=e.sort;return e===CD||Oae(CD,e)&&n===CD.sort?Pae:n},n0=l(Nae),ID=H;kn({global:!0,forced:ID.globalThis!==ID},{globalThis:ID});var h4=l(H),AD={exports:{}};(function(e,n){(function(i,o){var c="function",u="undefined",h="object",f="string",_="major",v="model",y="name",w="type",I="vendor",P="version",F="architecture",x="console",M="mobile",$="tablet",q="smarttv",ae="wearable",me="embedded",ge="Amazon",pe="Apple",we="ASUS",Be="BlackBerry",nt="Browser",st="Chrome",dn="Firefox",hn="Google",ir="Huawei",Yr="LG",Vr="Microsoft",Fo="Motorola",ke="Opera",Ye="Samsung",ht="Sharp",Le="Sony",D="Xiaomi",ee="Zebra",ce="Facebook",ze="Chromium OS",Ft="Mac OS",Jn=function(mi){for(var Pi={},gr=0;gr<mi.length;gr++)Pi[mi[gr].toUpperCase()]=mi[gr];return Pi},Oi=function(mi,Pi){return typeof mi===f&&ha(Pi).indexOf(ha(mi))!==-1},ha=function(mi){return mi.toLowerCase()},bp=function(mi,Pi){if(typeof mi===f)return mi=mi.replace(/^\s\s*/,""),typeof Pi===u?mi:mi.substring(0,350)},g_=function(mi,Pi){for(var gr,Ua,Qd,Xr,xn,pa,um=0;um<Pi.length&&!xn;){var Yu=Pi[um],F9=Pi[um+1];for(gr=Ua=0;gr<Yu.length&&!xn&&Yu[gr];)if(xn=Yu[gr++].exec(mi))for(Qd=0;Qd<F9.length;Qd++)pa=xn[++Ua],typeof(Xr=F9[Qd])===h&&Xr.length>0?Xr.length===2?typeof Xr[1]==c?this[Xr[0]]=Xr[1].call(this,pa):this[Xr[0]]=Xr[1]:Xr.length===3?typeof Xr[1]!==c||Xr[1].exec&&Xr[1].test?this[Xr[0]]=pa?pa.replace(Xr[1],Xr[2]):o:this[Xr[0]]=pa?Xr[1].call(this,pa,Xr[2]):o:Xr.length===4&&(this[Xr[0]]=pa?Xr[3].call(this,pa.replace(Xr[1],Xr[2])):o):this[Xr]=pa||o;um+=2}},sb=function(mi,Pi){for(var gr in Pi)if(typeof Pi[gr]===h&&Pi[gr].length>0){for(var Ua=0;Ua<Pi[gr].length;Ua++)if(Oi(Pi[gr][Ua],mi))return gr==="?"?o:gr}else if(Oi(Pi[gr],mi))return gr==="?"?o:gr;return mi},ZA={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},eO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[P,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[P,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,P],[/opios[\/ ]+([\w\.]+)/i],[P,[y,ke+" Mini"]],[/\bopr\/([\w\.]+)/i],[P,[y,ke]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[y,P],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[P,[y,"UC"+nt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[P,[y,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[P,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[P,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[P,[y,"IE"]],[/yabrowser\/([\w\.]+)/i],[P,[y,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+nt],P],[/\bfocus\/([\w\.]+)/i],[P,[y,dn+" Focus"]],[/\bopt\/([\w\.]+)/i],[P,[y,ke+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[P,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[P,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[P,[y,ke+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[P,[y,"MIUI "+nt]],[/fxios\/([-\w\.]+)/i],[P,[y,dn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[y,"360 "+nt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1 "+nt],P],[/(comodo_dragon)\/([\w\.]+)/i],[[y,/_/g," "],P],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[y,P],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,ce],P],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[y,P],[/\bgsa\/([\w\.]+) .*safari\//i],[P,[y,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[P,[y,st+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,st+" WebView"],P],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[P,[y,"Android "+nt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,P],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[P,[y,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[P,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[P,sb,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[y,P],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],P],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[P,[y,dn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[y,P],[/(cobalt)\/([\w\.]+)/i],[y,[P,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[F,"amd64"]],[/(ia32(?=;))/i],[[F,ha]],[/((?:i[346]|x)86)[;\)]/i],[[F,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[F,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[F,"armhf"]],[/windows (ce|mobile); ppc;/i],[[F,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[F,/ower/,"",ha]],[/(sun4\w)[;\)]/i],[[F,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[F,ha]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[I,Ye],[w,$]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[I,Ye],[w,M]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[I,pe],[w,M]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[I,pe],[w,$]],[/(macintosh);/i],[v,[I,pe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[I,ht],[w,M]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[I,ir],[w,$]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[I,ir],[w,M]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[I,D],[w,M]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[I,D],[w,$]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[I,"OPPO"],[w,M]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[I,"Vivo"],[w,M]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[I,"Realme"],[w,M]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[I,Fo],[w,M]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[I,Fo],[w,$]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[I,Yr],[w,$]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[I,Yr],[w,M]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[I,"Lenovo"],[w,$]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[I,"Nokia"],[w,M]],[/(pixel c)\b/i],[v,[I,hn],[w,$]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[I,hn],[w,M]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[I,Le],[w,M]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[I,Le],[w,$]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[I,"OnePlus"],[w,M]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[I,ge],[w,$]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[I,ge],[w,M]],[/(playbook);[-\w\),; ]+(rim)/i],[v,I,[w,$]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[I,Be],[w,M]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[I,we],[w,$]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[I,we],[w,M]],[/(nexus 9)/i],[v,[I,"HTC"],[w,$]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[v,/_/g," "],[w,M]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[I,"Acer"],[w,$]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[I,"Meizu"],[w,M]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,v,[w,M]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,v,[w,$]],[/(surface duo)/i],[v,[I,Vr],[w,$]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[I,"Fairphone"],[w,M]],[/(u304aa)/i],[v,[I,"AT&T"],[w,M]],[/\bsie-(\w*)/i],[v,[I,"Siemens"],[w,M]],[/\b(rct\w+) b/i],[v,[I,"RCA"],[w,$]],[/\b(venue[\d ]{2,7}) b/i],[v,[I,"Dell"],[w,$]],[/\b(q(?:mv|ta)\w+) b/i],[v,[I,"Verizon"],[w,$]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[I,"Barnes & Noble"],[w,$]],[/\b(tm\d{3}\w+) b/i],[v,[I,"NuVision"],[w,$]],[/\b(k88) b/i],[v,[I,"ZTE"],[w,$]],[/\b(nx\d{3}j) b/i],[v,[I,"ZTE"],[w,M]],[/\b(gen\d{3}) b.+49h/i],[v,[I,"Swiss"],[w,M]],[/\b(zur\d{3}) b/i],[v,[I,"Swiss"],[w,$]],[/\b((zeki)?tb.*\b) b/i],[v,[I,"Zeki"],[w,$]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],v,[w,$]],[/\b(ns-?\w{0,9}) b/i],[v,[I,"Insignia"],[w,$]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[I,"NextBook"],[w,$]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],v,[w,M]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],v,[w,M]],[/\b(ph-1) /i],[v,[I,"Essential"],[w,M]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[I,"Envizen"],[w,$]],[/\b(trio[-\w\. ]+) b/i],[v,[I,"MachSpeed"],[w,$]],[/\btu_(1491) b/i],[v,[I,"Rotor"],[w,$]],[/(shield[\w ]+) b/i],[v,[I,"Nvidia"],[w,$]],[/(sprint) (\w+)/i],[I,v,[w,M]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[I,Vr],[w,M]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[I,ee],[w,$]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[I,ee],[w,M]],[/smart-tv.+(samsung)/i],[I,[w,q]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[I,Ye],[w,q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,Yr],[w,q]],[/(apple) ?tv/i],[I,[v,pe+" TV"],[w,q]],[/crkey/i],[[v,st+"cast"],[I,hn],[w,q]],[/droid.+aft(\w)( bui|\))/i],[v,[I,ge],[w,q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[I,ht],[w,q]],[/(bravia[\w ]+)( bui|\))/i],[v,[I,Le],[w,q]],[/(mitv-\w{5}) bui/i],[v,[I,D],[w,q]],[/Hbbtv.*(technisat) (.*);/i],[I,v,[w,q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,bp],[v,bp],[w,q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,v,[w,x]],[/droid.+; (shield) bui/i],[v,[I,"Nvidia"],[w,x]],[/(playstation [345portablevi]+)/i],[v,[I,Le],[w,x]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[I,Vr],[w,x]],[/((pebble))app/i],[I,v,[w,ae]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[I,pe],[w,ae]],[/droid.+; (glass) \d/i],[v,[I,hn],[w,ae]],[/droid.+; (wt63?0{2,3})\)/i],[v,[I,ee],[w,ae]],[/(quest( 2| pro)?)/i],[v,[I,ce],[w,ae]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[w,me]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[w,M]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[w,$]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,$]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,M]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[P,[y,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[P,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[y,P],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[P,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,P],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[y,[P,sb,ZA]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,"Windows"],[P,sb,ZA]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[P,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,Ft],[P,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[P,y],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[y,P],[/\(bb(10);/i],[P,[y,Be]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[P,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[P,[y,dn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[P,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[P,[y,"watchOS"]],[/crkey\/([\d\.]+)/i],[P,[y,st+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,ze],P],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,P],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],P],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[y,P]]},il=function(mi,Pi){if(typeof mi===h&&(Pi=mi,mi=o),!(this instanceof il))return new il(mi,Pi).getResult();var gr=typeof i!==u&&i.navigator?i.navigator:o,Ua=mi||(gr&&gr.userAgent?gr.userAgent:""),Qd=gr&&gr.userAgentData?gr.userAgentData:o,Xr=Pi?function(xn,pa){var um={};for(var Yu in xn)pa[Yu]&&pa[Yu].length%2==0?um[Yu]=pa[Yu].concat(xn[Yu]):um[Yu]=xn[Yu];return um}(eO,Pi):eO;return this.getBrowser=function(){var xn={};return xn[y]=o,xn[P]=o,g_.call(xn,Ua,Xr.browser),xn[_]=function(pa){return typeof pa===f?pa.replace(/[^\d\.]/g,"").split(".")[0]:o}(xn[P]),gr&&gr.brave&&typeof gr.brave.isBrave==c&&(xn[y]="Brave"),xn},this.getCPU=function(){var xn={};return xn[F]=o,g_.call(xn,Ua,Xr.cpu),xn},this.getDevice=function(){var xn={};return xn[I]=o,xn[v]=o,xn[w]=o,g_.call(xn,Ua,Xr.device),!xn[w]&&Qd&&Qd.mobile&&(xn[w]=M),xn[v]=="Macintosh"&&gr&&typeof gr.standalone!==u&&gr.maxTouchPoints&&gr.maxTouchPoints>2&&(xn[v]="iPad",xn[w]=$),xn},this.getEngine=function(){var xn={};return xn[y]=o,xn[P]=o,g_.call(xn,Ua,Xr.engine),xn},this.getOS=function(){var xn={};return xn[y]=o,xn[P]=o,g_.call(xn,Ua,Xr.os),!xn[y]&&Qd&&Qd.platform!="Unknown"&&(xn[y]=Qd.platform.replace(/chrome os/i,ze).replace(/macos/i,Ft)),xn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ua},this.setUA=function(xn){return Ua=typeof xn===f&&xn.length>350?bp(xn,350):xn,this},this.setUA(Ua),this};il.VERSION="0.7.34",il.BROWSER=Jn([y,P,_]),il.CPU=Jn([F]),il.DEVICE=Jn([v,I,w,x,M,q,$,ae,me]),il.ENGINE=il.OS=Jn([y,P]),e.exports&&(n=e.exports=il),n.UAParser=il;var lm=typeof i!==u&&(i.jQuery||i.Zepto);if(lm&&!lm.ua){var __=new il;lm.ua=__.getResult(),lm.ua.get=function(){return __.getUA()},lm.ua.set=function(mi){__.setUA(mi);var Pi=__.getResult();for(var gr in Pi)lm.ua[gr]=Pi[gr]}}})(typeof window=="object"?window:a)})(AD,AD.exports);var kae=l(AD.exports),Dae=Za,Lae=li,xae=ln,Mae=yd,Uae=ar("iterator"),Vae=Object,Fae=function(e){if(xae(e))return!1;var n=Vae(e);return n[Uae]!==void 0||"@@iterator"in n||Lae(Mae,Dae(n))},jae=l(Fae),p4=ov.clear;kn({global:!0,bind:!0,forced:H.clearImmediate!==p4},{clearImmediate:p4});var Bae=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",f4=H,Wae=re,Gae=Me,zae=Bae,Hae=ur,Kae=rs,$ae=Kc,qae=f4.Function,Yae=/MSIE .\./.test(Hae)||zae&&function(){var e=f4.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),Xae=kn,m4=H,g4=ov.set,Jae=function(e,n){var i=1;return Yae?function(o,c){var u=$ae(arguments.length,1)>i,h=Gae(o)?o:qae(o),f=u?Kae(arguments,i):[],_=u?function(){Wae(h,this,f)}:h;return e(_)}:e},_4=m4.setImmediate?Jae(g4):g4;Xae({global:!0,bind:!0,forced:m4.setImmediate!==_4},{setImmediate:_4});var E4=l(ft.setImmediate),Qae=kn,Zae=ka,ece=Qi,tce=Kc,nce=Vh,rce=H.process;Qae({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){tce(arguments.length,1),ece(e);var n=nce&&rce.domain;Zae(n?n.bind(e):e)}});var v4=l(ft.queueMicrotask);function y4(e,n){return function(){return e.apply(n,arguments)}}const{toString:ice}=Object.prototype,{getPrototypeOf:OD}=Object,rI=(PD=Object.create(null),e=>{const n=ice.call(e);return PD[n]||(PD[n]=n.slice(8,-1).toLowerCase())});var PD;const Mu=e=>(e=e.toLowerCase(),n=>rI(n)===e),iI=e=>n=>typeof n===e,{isArray:Nv}=Array,r0=iI("undefined"),S4=Mu("ArrayBuffer"),sce=iI("string"),qc=iI("function"),T4=iI("number"),sI=e=>e!==null&&typeof e=="object",oI=e=>{if(rI(e)!=="object")return!1;const n=OD(e);return!(n!==null&&n!==Object.prototype&&Object.getPrototypeOf(n)!==null||Symbol.toStringTag in e||jae(e))},oce=Mu("Date"),ace=Mu("File"),cce=Mu("Blob"),lce=Mu("FileList"),uce=Mu("URLSearchParams"),[dce,hce,pce,fce]=["ReadableStream","Request","Response","Headers"].map(Mu);function i0(e,n){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Nv(e))for(i=0,o=e.length;i<o;i++)n.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let f;for(i=0;i<h;i++)f=u[i],n.call(null,e[f],f,e)}}function b4(e,n){n=n.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],n===o.toLowerCase())return o;return null}const jg=h4!==void 0?h4:typeof self<"u"?self:typeof window<"u"?window:C_,w4=e=>!r0(e)&&e!==jg,mce=(ND=typeof Uint8Array<"u"&&OD(Uint8Array),e=>ND&&e instanceof ND);var ND;const gce=Mu("HTMLFormElement"),R4=(e=>{let{hasOwnProperty:n}=e;return(i,o)=>n.call(i,o)})(Object.prototype),_ce=Mu("RegExp"),C4=(e,n)=>{const i=Object.getOwnPropertyDescriptors(e),o={};i0(i,(c,u)=>{let h;(h=n(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},kD="abcdefghijklmnopqrstuvwxyz",I4="0123456789",A4={DIGIT:I4,ALPHA:kD,ALPHA_DIGIT:kD+kD.toUpperCase()+I4},Ece=Mu("AsyncFunction"),O4=(P4=typeof E4=="function",N4=qc(jg.postMessage),P4?E4:N4?(DD="axios@".concat(Math.random()),aI=[],jg.addEventListener("message",e=>{let{source:n,data:i}=e;n===jg&&i===DD&&aI.length&&aI.shift()()},!1),e=>{aI.push(e),jg.postMessage(DD,"*")}):e=>setTimeout(e));var P4,N4,DD,aI;const vce=v4!==void 0?v4.bind(jg):typeof process<"u"&&process.nextTick||O4;var Qe={isArray:Nv,isArrayBuffer:S4,isBuffer:function(e){return e!==null&&!r0(e)&&e.constructor!==null&&!r0(e.constructor)&&qc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||qc(e.append)&&((n=rI(e))==="formdata"||n==="object"&&qc(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let n;return n=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&S4(e.buffer),n},isString:sce,isNumber:T4,isBoolean:e=>e===!0||e===!1,isObject:sI,isPlainObject:oI,isReadableStream:dce,isRequest:hce,isResponse:pce,isHeaders:fce,isUndefined:r0,isDate:oce,isFile:ace,isBlob:cce,isRegExp:_ce,isFunction:qc,isStream:e=>sI(e)&&qc(e.pipe),isURLSearchParams:uce,isTypedArray:mce,isFileList:lce,forEach:i0,merge:function e(){const{caseless:n}=w4(this)&&this||{},i={},o=(c,u)=>{const h=n&&b4(i,u)||u;oI(i[h])&&oI(c)?i[h]=e(i[h],c):oI(c)?i[h]=e({},c):Nv(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&i0(arguments[c],o);return i},extend:function(e,n,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return i0(n,(c,u)=>{i&&qc(c)?e[u]=y4(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>Fs(e)?Fs(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,n,i,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,n,i,o)=>{let c,u,h;const f={};if(n=n||{},e==null)return n;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,n)||f[h]||(n[h]=e[h],f[h]=!0);e=i!==!1&&OD(e)}while(e&&(!i||i(e,n))&&e!==Object.prototype);return n},kindOf:rI,kindOfTest:Mu,endsWith:(e,n,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=n.length;const o=e.indexOf(n,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(Nv(e))return e;let n=e.length;if(!T4(n))return null;const i=new Array(n);for(;n-- >0;)i[n]=e[n];return i},forEachEntry:(e,n)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;n.call(e,c[0],c[1])}},matchAll:(e,n)=>{let i;const o=[];for(;(i=e.exec(n))!==null;)o.push(i);return o},isHTMLForm:gce,hasOwnProperty:R4,hasOwnProp:R4,reduceDescriptors:C4,freezeMethods:e=>{C4(e,(n,i)=>{if(qc(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];qc(o)&&(n.enumerable=!1,"writable"in n?n.writable=!1:n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,n)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return Nv(e)?o(e):o(String(e).split(n)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n,findKey:b4,global:jg,isContextDefined:w4,ALPHABET:A4,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A4.ALPHA_DIGIT,i="";const{length:o}=n;for(;e--;)i+=n[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&qc(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const n=new Array(10),i=(o,c)=>{if(sI(o)){if(n.indexOf(o)>=0)return;if(!("toJSON"in o)){n[c]=o;const u=Nv(o)?[]:{};return i0(o,(h,f)=>{const _=i(h,c+1);!r0(_)&&(u[f]=_)}),n[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:Ece,isThenable:e=>e&&(sI(e)||qc(e))&&qc(e.then)&&qc(e.catch),setImmediate:O4,asap:vce};function Yn(e,n,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}Qe.inherits(Yn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Qe.toJSONObject(this.config),code:this.code,status:this.status}}});const k4=Yn.prototype,D4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{D4[e]={value:e}}),Object.defineProperties(Yn,D4),Object.defineProperty(k4,"isAxiosError",{value:!0}),Yn.from=(e,n,i,o,c,u)=>{const h=Object.create(k4);return Qe.toFlatObject(e,h,function(f){return f!==Error.prototype},f=>f!=="isAxiosError"),Yn.call(h,e.message,n,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function LD(e){return Qe.isPlainObject(e)||Qe.isArray(e)}function L4(e){return Qe.endsWith(e,"[]")?e.slice(0,-2):e}function x4(e,n,i){return e?e.concat(n).map(function(o,c){return o=L4(o),!i&&c?"["+o+"]":o}).join(i?".":""):n}const yce=Qe.toFlatObject(Qe,{},null,function(e){return/^is[A-Z]/.test(e)});function cI(e,n,i){if(!Qe.isObject(e))throw new TypeError("target must be an object");n=n||new FormData;const o=(i=Qe.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,P){return!Qe.isUndefined(P[I])})).metaTokens,c=i.visitor||v,u=i.dots,h=i.indexes,f=(i.Blob||typeof Blob<"u"&&Blob)&&Qe.isSpecCompliantForm(n);if(!Qe.isFunction(c))throw new TypeError("visitor must be a function");function _(I){if(I===null)return"";if(Qe.isDate(I))return I.toISOString();if(!f&&Qe.isBlob(I))throw new Yn("Blob is not supported. Use a Buffer instead.");return Qe.isArrayBuffer(I)||Qe.isTypedArray(I)?f&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function v(I,P,F){let x=I;if(I&&!F&&typeof I=="object"){if(Qe.endsWith(P,"{}"))P=o?P:P.slice(0,-2),I=JSON.stringify(I);else if(Qe.isArray(I)&&function(M){return Qe.isArray(M)&&!M.some(LD)}(I)||(Qe.isFileList(I)||Qe.endsWith(P,"[]"))&&(x=Qe.toArray(I)))return P=L4(P),x.forEach(function(M,$){!Qe.isUndefined(M)&&M!==null&&n.append(h===!0?x4([P],$,u):h===null?P:P+"[]",_(M))}),!1}return!!LD(I)||(n.append(x4(F,P,u),_(I)),!1)}const y=[],w=Object.assign(yce,{defaultVisitor:v,convertValue:_,isVisitable:LD});if(!Qe.isObject(e))throw new TypeError("data must be an object");return function I(P,F){if(!Qe.isUndefined(P)){if(y.indexOf(P)!==-1)throw Error("Circular reference detected in "+F.join("."));y.push(P),Qe.forEach(P,function(x,M){(!(Qe.isUndefined(x)||x===null)&&c.call(n,x,Qe.isString(M)?Fs(M).call(M):M,F,w))===!0&&I(x,F?F.concat(M):[M])}),y.pop()}}(e),n}function M4(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return n[i]})}function xD(e,n){this._pairs=[],e&&cI(e,this,n)}const U4=xD.prototype;function Sce(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function V4(e,n,i){if(!n)return e;const o=i&&i.encode||Sce;Qe.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(n,i):Qe.isURLSearchParams(n)?n.toString():new xD(n,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}U4.append=function(e,n){this._pairs.push([e,n])},U4.toString=function(e){const n=e?function(i){return e.call(this,i,M4)}:M4;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};var F4=class{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Qe.forEach(this.handlers,function(n){n!==null&&e(n)})}},j4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},B4={exports:{}},Tce=kn,bce=et,W4=Ke.f;Tce({target:"Object",stat:!0,forced:Object.defineProperty!==W4,sham:!bce},{defineProperty:W4});var G4=ft.Object,wce=B4.exports=function(e,n,i){return G4.defineProperty(e,n,i)};G4.defineProperty.sham&&(wce.sham=!0);var z4=l(B4.exports),Rce=TypeError,H4=ig,Cce=Ig,Ice=ut,Ace=ar("species"),K4=Array,Oce=function(e){var n;return H4(e)&&(n=e.constructor,(Cce(n)&&(n===K4||H4(n.prototype))||Ice(n)&&(n=n[Ace])===null)&&(n=void 0)),n===void 0?K4:n},$4=function(e,n){return new(Oce(e))(n===0?0:n)},Pce=d,Nce=ci,kce=ar("species"),q4=function(e){return Nce>=51||!Pce(function(){var n=[];return(n.constructor={})[kce]=function(){return{foo:1}},n[e](Boolean).foo!==1})},Dce=kn,Lce=d,xce=ig,Mce=ut,Uce=go,Vce=ei,Y4=function(e){if(e>9007199254740991)throw Rce("Maximum allowed index exceeded");return e},X4=VC,Fce=$4,jce=q4,Bce=ci,J4=ar("isConcatSpreadable"),Wce=Bce>=51||!Lce(function(){var e=[];return e[J4]=!1,e.concat()[0]!==e}),Gce=function(e){if(!Mce(e))return!1;var n=e[J4];return n!==void 0?!!n:xce(e)};Dce({target:"Array",proto:!0,forced:!Wce||!jce("concat")},{concat:function(e){var n,i,o,c,u,h=Uce(this),f=Fce(h,0),_=0;for(n=-1,o=arguments.length;n<o;n++)if(Gce(u=n===-1?h:arguments[n]))for(c=Vce(u),Y4(_+c),i=0;i<c;i++,_++)i in u&&X4(f,_,u[i]);else Y4(_+1),X4(f,_++,u);return f.length=_,f}});var Q4={},zce=Z,Hce=ve,Z4=_d.f,Kce=Vk,e3=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Q4.f=function(e){return e3&&zce(e)=="Window"?function(n){try{return Z4(n)}catch{return Kce(e3)}}(e):Z4(Hce(e))};var kv={},$ce=ar;kv.f=$ce;var t3=ft,qce=li,Yce=kv,Xce=Ke.f,os=function(e){var n=t3.Symbol||(t3.Symbol={});qce(n,e)||Xce(n,e,{value:Yce.f(e)})},Jce=xe,Qce=tn,Zce=ar,ele=Au,n3=function(){var e=Qce("Symbol"),n=e&&e.prototype,i=n&&n.valueOf,o=Zce("toPrimitive");n&&!n[o]&&ele(n,o,function(c){return Jce(i,this)},{})},tle=Re,nle=Rn,rle=go,ile=ei,sle=$4,r3=O([].push),ole=function(e){var n=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,f=e==5||u;return function(_,v,y,w){for(var I,P,F=rle(_),x=nle(F),M=tle(v,y),$=ile(x),q=0,ae=w||sle,me=n?ae(_,$):i||h?ae(_,0):void 0;$>q;q++)if((f||q in x)&&(P=M(I=x[q],q,F),e))if(n)me[q]=P;else if(P)switch(e){case 3:return!0;case 5:return I;case 6:return q;case 2:r3(me,I)}else switch(e){case 4:return!1;case 7:r3(me,I)}return u?-1:o||c?c:me}},i3={forEach:ole(0)},lI=kn,MD=H,UD=xe,ale=O,Dv=et,Lv=Js,cle=d,io=li,lle=k,VD=en,uI=ve,FD=Ra,ule=Zo,jD=_t,s0=Ao,s3=nc,dle=_d,o3=Q4,hle=tc,a3=pt,c3=Ke,ple=vE,l3=it,u3=Au,fle=HE,BD=ba,d3=ec,h3=ud,mle=ar,gle=kv,_le=os,Ele=n3,vle=Ou,p3=Iu,dI=i3.forEach,dc=og("hidden"),hI="Symbol",o0="prototype",yle=p3.set,f3=p3.getterFor(hI),Uu=Object[o0],Bg=MD.Symbol,pI=Bg&&Bg[o0],Sle=MD.TypeError,WD=MD.QObject,m3=a3.f,Wg=c3.f,g3=o3.f,Tle=l3.f,_3=ale([].push),ap=BD("symbols"),a0=BD("op-symbols"),ble=BD("wks"),GD=!WD||!WD[o0]||!WD[o0].findChild,zD=Dv&&cle(function(){return s0(Wg({},"a",{get:function(){return Wg(this,"a",{value:7}).a}})).a!=7})?function(e,n,i){var o=m3(Uu,n);o&&delete Uu[n],Wg(e,n,i),o&&e!==Uu&&Wg(Uu,n,o)}:Wg,HD=function(e,n){var i=ap[e]=s0(pI);return yle(i,{type:hI,tag:e,description:n}),Dv||(i.description=n),i},fI=function(e,n,i){e===Uu&&fI(a0,n,i),VD(e);var o=FD(n);return VD(i),io(ap,o)?(i.enumerable?(io(e,dc)&&e[dc][o]&&(e[dc][o]=!1),i=s0(i,{enumerable:jD(0,!1)})):(io(e,dc)||Wg(e,dc,jD(1,{})),e[dc][o]=!0),zD(e,o,i)):Wg(e,o,i)},KD=function(e,n){VD(e);var i=uI(n),o=s3(i).concat(S3(i));return dI(o,function(c){Dv&&!UD(E3,i,c)||fI(e,c,i[c])}),e},E3=function(e){var n=FD(e),i=UD(Tle,this,n);return!(this===Uu&&io(ap,n)&&!io(a0,n))&&(!(i||!io(this,n)||!io(ap,n)||io(this,dc)&&this[dc][n])||i)},v3=function(e,n){var i=uI(e),o=FD(n);if(i!==Uu||!io(ap,o)||io(a0,o)){var c=m3(i,o);return!c||!io(ap,o)||io(i,dc)&&i[dc][o]||(c.enumerable=!0),c}},y3=function(e){var n=g3(uI(e)),i=[];return dI(n,function(o){io(ap,o)||io(d3,o)||_3(i,o)}),i},S3=function(e){var n=e===Uu,i=g3(n?a0:uI(e)),o=[];return dI(i,function(c){!io(ap,c)||n&&!io(Uu,c)||_3(o,ap[c])}),o};Lv||(Bg=function(){if(lle(pI,this))throw Sle("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?ule(arguments[0]):void 0,n=h3(e),i=function(o){this===Uu&&UD(i,a0,o),io(this,dc)&&io(this[dc],n)&&(this[dc][n]=!1),zD(this,n,jD(1,o))};return Dv&&GD&&zD(Uu,n,{configurable:!0,set:i}),HD(n,e)},u3(pI=Bg[o0],"toString",function(){return f3(this).tag}),u3(Bg,"withoutSetter",function(e){return HD(h3(e),e)}),l3.f=E3,c3.f=fI,ple.f=KD,a3.f=v3,dle.f=o3.f=y3,hle.f=S3,gle.f=function(e){return HD(mle(e),e)},Dv&&fle(pI,"description",{configurable:!0,get:function(){return f3(this).description}})),lI({global:!0,wrap:!0,forced:!Lv,sham:!Lv},{Symbol:Bg}),dI(s3(ble),function(e){_le(e)}),lI({target:hI,stat:!0,forced:!Lv},{useSetter:function(){GD=!0},useSimple:function(){GD=!1}}),lI({target:"Object",stat:!0,forced:!Lv,sham:!Dv},{create:function(e,n){return n===void 0?s0(e):KD(s0(e),n)},defineProperty:fI,defineProperties:KD,getOwnPropertyDescriptor:v3}),lI({target:"Object",stat:!0,forced:!Lv},{getOwnPropertyNames:y3}),Ele(),vle(Bg,hI),d3[dc]=!0;var T3=Js&&!!Symbol.for&&!!Symbol.keyFor,wle=kn,Rle=tn,Cle=li,Ile=Zo,b3=ba,Ale=T3,$D=b3("string-to-symbol-registry"),Ole=b3("symbol-to-string-registry");wle({target:"Symbol",stat:!0,forced:!Ale},{for:function(e){var n=Ile(e);if(Cle($D,n))return $D[n];var i=Rle("Symbol")(n);return $D[n]=i,Ole[i]=n,i}});var Ple=kn,Nle=li,kle=Uc,Dle=Ka,Lle=T3,w3=ba("symbol-to-string-registry");Ple({target:"Symbol",stat:!0,forced:!Lle},{keyFor:function(e){if(!kle(e))throw TypeError(Dle(e)+" is not a symbol");if(Nle(w3,e))return w3[e]}});var R3=ig,xle=Me,C3=Z,Mle=Zo,I3=O([].push),Ule=kn,A3=tn,O3=re,Vle=xe,c0=O,P3=d,N3=Me,k3=Uc,D3=rs,Fle=function(e){if(xle(e))return e;if(R3(e)){for(var n=e.length,i=[],o=0;o<n;o++){var c=e[o];typeof c=="string"?I3(i,c):typeof c!="number"&&C3(c)!="Number"&&C3(c)!="String"||I3(i,Mle(c))}var u=i.length,h=!0;return function(f,_){if(h)return h=!1,_;if(R3(this))return _;for(var v=0;v<u;v++)if(i[v]===f)return _}}},jle=Js,Ble=String,Gf=A3("JSON","stringify"),mI=c0(/./.exec),L3=c0("".charAt),Wle=c0("".charCodeAt),Gle=c0("".replace),zle=c0(1 .toString),Hle=/[\uD800-\uDFFF]/g,x3=/^[\uD800-\uDBFF]$/,M3=/^[\uDC00-\uDFFF]$/,U3=!jle||P3(function(){var e=A3("Symbol")();return Gf([e])!="[null]"||Gf({a:e})!="{}"||Gf(Object(e))!="{}"}),V3=P3(function(){return Gf("\uDF06\uD834")!=='"\\udf06\\ud834"'||Gf("\uDEAD")!=='"\\udead"'}),Kle=function(e,n){var i=D3(arguments),o=Fle(n);if(N3(o)||e!==void 0&&!k3(e))return i[1]=function(c,u){if(N3(o)&&(u=Vle(o,this,Ble(c),u)),!k3(u))return u},O3(Gf,null,i)},$le=function(e,n,i){var o=L3(i,n-1),c=L3(i,n+1);return mI(x3,e)&&!mI(M3,c)||mI(M3,e)&&!mI(x3,o)?"\\u"+zle(Wle(e,0),16):e};Gf&&Ule({target:"JSON",stat:!0,forced:U3||V3},{stringify:function(e,n,i){var o=D3(arguments),c=O3(U3?Kle:Gf,null,o);return V3&&typeof c=="string"?Gle(c,Hle,$le):c}});var F3=tc,qle=go;kn({target:"Object",stat:!0,forced:!Js||d(function(){F3.f(1)})},{getOwnPropertySymbols:function(e){var n=F3.f;return n?n(qle(e)):[]}}),os("asyncIterator"),os("hasInstance"),os("isConcatSpreadable"),os("iterator"),os("match"),os("matchAll"),os("replace"),os("search"),os("species"),os("split");var Yle=n3;os("toPrimitive"),Yle();var Xle=tn,Jle=Ou;os("toStringTag"),Jle(Xle("Symbol"),"Symbol"),os("unscopables"),Ou(H.JSON,"JSON",!0);var Qle=ft.Symbol,Zle=ar,eue=Ke.f,j3=Zle("metadata"),B3=Function.prototype;B3[j3]===void 0&&eue(B3,j3,{value:null}),os("dispose"),os("metadata");var tue=Qle;os("asyncDispose");var nue=O,qD=tn("Symbol"),rue=qD.keyFor,iue=nue(qD.prototype.valueOf),W3=qD.isRegisteredSymbol||function(e){try{return rue(iue(e))!==void 0}catch{return!1}};kn({target:"Symbol",stat:!0},{isRegisteredSymbol:W3});for(var sue=ba,G3=tn,oue=O,aue=Uc,cue=ar,gI=G3("Symbol"),z3=gI.isWellKnownSymbol,H3=G3("Object","getOwnPropertyNames"),lue=oue(gI.prototype.valueOf),K3=sue("wks"),YD=0,$3=H3(gI),uue=$3.length;YD<uue;YD++)try{var q3=$3[YD];aue(gI[q3])&&cue(q3)}catch{}var Y3=function(e){if(z3&&z3(e))return!0;try{for(var n=lue(e),i=0,o=H3(K3),c=o.length;i<c;i++)if(K3[o[i]]==n)return!0}catch{}return!1};kn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Y3}),os("matcher"),os("observable"),kn({target:"Symbol",stat:!0},{isRegistered:W3}),kn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Y3}),os("metadataKey"),os("patternMatch"),os("replaceAll");var xv=l(tue),X3=l(kv.f("iterator"));function l0(e){return l0=typeof xv=="function"&&typeof X3=="symbol"?function(n){return typeof n}:function(n){return n&&typeof xv=="function"&&n.constructor===xv&&n!==xv.prototype?"symbol":typeof n},l0(e)}var due=l(kv.f("toPrimitive"));function hue(e){var n=function(i,o){if(l0(i)!=="object"||i===null)return i;var c=i[due];if(c!==void 0){var u=c.call(i,o);if(l0(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return l0(n)==="symbol"?n:String(n)}function z(e,n,i){return(n=hue(n))in e?z4(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}var J3=l(Kse),pue={isBrowser:!0,classes:{URLSearchParams:J3!==void 0?J3:xD,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const XD=typeof window<"u"&&typeof document<"u",JD=typeof navigator=="object"&&navigator||void 0,fue=XD&&(!JD||["ReactNative","NativeScript","NS"].indexOf(JD.product)<0),mue=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",gue=XD&&window.location.href||"http://localhost";function Q3(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Z3(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Q3(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q3(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var aa=Z3(Z3({},Object.freeze({__proto__:null,hasBrowserEnv:XD,hasStandardBrowserEnv:fue,hasStandardBrowserWebWorkerEnv:mue,navigator:JD,origin:gue})),pue),_ue=en,Eue=xe,vue=li,yue=k,Sue=function(){var e=_ue(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},e5=RegExp.prototype,t5=function(e){var n=e.flags;return n!==void 0||"flags"in e5||vue(e,"flags")||!yue(e5,e)?n:Eue(Sue,e)},Tue=Dk.charAt,n5=xe,bue=en,wue=Me,Rue=Z,Cue=/./.exec,Iue=TypeError,Aue=kn,r5=xe,i5=ue,Oue=UE,_I=WE,s5=Xt,o5=It,u0=Zo,Pue=en,Nue=ln,kue=Z,Due=ER,a5=t5,Lue=$a,xue=d,Mue=Mi,Uue=function(e,n,i){return n+(i?Tue(e,n).length:1)},Vue=function(e,n){var i=e.exec;if(wue(i)){var o=n5(i,e,n);return o!==null&&bue(o),o}if(Rue(e)==="RegExp")return n5(Cue,e,n);throw Iue("RegExp#exec called on incompatible receiver")},c5=Iu,Fue=ar("matchAll"),l5="RegExp String",u5=l5+" Iterator",jue=c5.set,Bue=c5.getterFor(u5),Wue=TypeError,QD=i5("".indexOf),EI=i5("".matchAll),ZD=!!EI&&!xue(function(){EI("a",/./)}),Gue=Oue(function(e,n,i,o){jue(this,{type:u5,regexp:e,string:n,global:i,unicode:o,done:!1})},l5,function(){var e=Bue(this);if(e.done)return _I(void 0,!0);var n=e.regexp,i=e.string,o=Vue(n,i);return o===null?(e.done=!0,_I(void 0,!0)):e.global?(u0(o[0])===""&&(n.lastIndex=Uue(i,o5(n.lastIndex),e.unicode)),_I(o,!1)):(e.done=!0,_I(o,!1))}),d5=function(e){var n,i,o,c=Pue(this),u=u0(e),h=Mue(c,RegExp),f=u0(a5(c));return n=new h(h===RegExp?c.source:c,f),i=!!~QD(f,"g"),o=!!~QD(f,"u"),n.lastIndex=o5(c.lastIndex),new Gue(n,u,i,o)};Aue({target:"String",proto:!0,forced:ZD},{matchAll:function(e){var n,i,o,c,u=s5(this);if(Nue(e)){if(ZD)return EI(u,e)}else{if(Due(e)&&(n=u0(s5(a5(e))),!~QD(n,"g")))throw Wue("`.matchAll` does not allow non-global regexes");if(ZD)return EI(u,e);if((o=Lue(e,Fue))===void 0&&kue(e)=="RegExp"&&(o=d5),o)return r5(o,e,u)}return i=u0(u),c=new RegExp(e,"g"),r5(d5,c,i)}});var zue=Ia("String").matchAll,Hue=k,Kue=zue,e1=String.prototype,$ue=function(e){var n=e.matchAll;return typeof e=="string"||e===e1||Hue(e1,e)&&n===e1.matchAll?Kue:n},que=l($ue);function h5(e){function n(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const f=Number.isFinite(+h),_=u>=i.length;return h=!h&&Qe.isArray(c)?c.length:h,_?(Qe.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!f):(c[h]&&Qe.isObject(c[h])||(c[h]=[]),n(i,o,c[h],u)&&Qe.isArray(c[h])&&(c[h]=function(v){const y={},w=Object.keys(v);let I;const P=w.length;let F;for(I=0;I<P;I++)F=w[I],y[F]=v[F];return y}(c[h])),!f)}if(Qe.isFormData(e)&&Qe.isFunction(e.entries)){const i={};return Qe.forEachEntry(e,(o,c)=>{n(function(u){return que(Qe).call(Qe,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const t1={transitional:j4,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",o=i.indexOf("application/json")>-1,c=Qe.isObject(e);if(c&&Qe.isHTMLForm(e)&&(e=new FormData(e)),Qe.isFormData(e))return o?JSON.stringify(h5(e)):e;if(Qe.isArrayBuffer(e)||Qe.isBuffer(e)||Qe.isStream(e)||Qe.isFile(e)||Qe.isBlob(e)||Qe.isReadableStream(e))return e;if(Qe.isArrayBufferView(e))return e.buffer;if(Qe.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,f){return cI(h,new aa.classes.URLSearchParams,Object.assign({visitor:function(_,v,y,w){return aa.isNode&&Qe.isBuffer(_)?(this.append(v,_.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},f))}(e,this.formSerializer).toString();if((u=Qe.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return cI(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(n.setContentType("application/json",!1),function(h,f,_){if(Qe.isString(h))try{return(f||JSON.parse)(h),Fs(Qe).call(Qe,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const n=this.transitional||t1.transitional,i=n&&n.forcedJSONParsing,o=this.responseType==="json";if(Qe.isResponse(e)||Qe.isReadableStream(e))return e;if(e&&Qe.isString(e)&&(i&&!this.responseType||o)){const c=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?Yn.from(u,Yn.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:aa.classes.FormData,Blob:aa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Qe.forEach(["delete","get","head","post","put","patch"],e=>{t1.headers[e]={}});var n1=t1;const Yue=Qe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),p5=Symbol("internals");function d0(e){var n;return e&&Fs(n=String(e)).call(n).toLowerCase()}function vI(e){return e===!1||e==null?e:Qe.isArray(e)?e.map(vI):String(e)}function r1(e,n,i,o,c){return Qe.isFunction(o)?o.call(this,n,i):(c&&(n=i),Qe.isString(n)?Qe.isString(o)?n.indexOf(o)!==-1:Qe.isRegExp(o)?o.test(n):void 0:void 0)}class yI{constructor(n){n&&this.set(n)}set(n,i,o){const c=this;function u(_,v,y){const w=d0(v);if(!w)throw new Error("header name must be a non-empty string");const I=Qe.findKey(c,w);(!I||c[I]===void 0||y===!0||y===void 0&&c[I]!==!1)&&(c[I||v]=vI(_))}const h=(_,v)=>Qe.forEach(_,(y,w)=>u(y,w,v));if(Qe.isPlainObject(n)||n instanceof this.constructor)h(n,i);else if(Qe.isString(n)&&(n=Fs(n).call(n))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Fs(f=n).call(f)))h((_=>{const v={};let y,w,I;return _&&_.split(`
`).forEach(function(P){var F,x;I=P.indexOf(":"),y=Fs(F=P.substring(0,I)).call(F).toLowerCase(),w=Fs(x=P.substring(I+1)).call(x),!y||v[y]&&Yue[y]||(y==="set-cookie"?v[y]?v[y].push(w):v[y]=[w]:v[y]=v[y]?v[y]+", "+w:w)}),v})(n),i);else if(Qe.isHeaders(n))for(const[_,v]of n.entries())u(v,_,o);else n!=null&&u(i,n,o);var f;return this}get(n,i){if(n=d0(n)){const o=Qe.findKey(this,n);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=f.exec(u);)h[_[1]]=_[2];return h}(c);if(Qe.isFunction(i))return i.call(this,c,o);if(Qe.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,i){if(n=d0(n)){const o=Qe.findKey(this,n);return!(!o||this[o]===void 0||i&&!r1(0,this[o],o,i))}return!1}delete(n,i){const o=this;let c=!1;function u(h){if(h=d0(h)){const f=Qe.findKey(o,h);!f||i&&!r1(0,o[f],f,i)||(delete o[f],c=!0)}}return Qe.isArray(n)?n.forEach(u):u(n),c}clear(n){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];n&&!r1(0,this[u],u,n,!0)||(delete this[u],c=!0)}return c}normalize(n){const i=this,o={};return Qe.forEach(this,(c,u)=>{var h;const f=Qe.findKey(o,u);if(f)return i[f]=vI(c),void delete i[u];const _=n?function(v){return Fs(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(y,w,I)=>w.toUpperCase()+I)}(u):Fs(h=String(u)).call(h);_!==u&&delete i[u],i[_]=vI(c),o[_]=!0}),this}concat(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(n){const i=Object.create(null);return Qe.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=n&&Qe.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(n=>{let[i,o]=n;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n){const i=new this(n);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(n){const i=(this[p5]=this[p5]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=d0(u);i[h]||(function(f,_){const v=Qe.toCamelCase(" "+_);["get","set","has"].forEach(y=>{Object.defineProperty(f,y+v,{value:function(w,I,P){return this[y].call(this,_,w,I,P)},configurable:!0})})}(o,u),i[h]=!0)}return Qe.isArray(n)?n.forEach(c):c(n),this}}yI.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Qe.reduceDescriptors(yI.prototype,(e,n)=>{let{value:i}=e,o=n[0].toUpperCase()+n.slice(1);return{get:()=>i,set(c){this[o]=c}}}),Qe.freezeMethods(yI);var Vu=yI;function i1(e,n){const i=this||n1,o=n||i,c=Vu.from(o.headers);let u=o.data;return Qe.forEach(e,function(h){u=h.call(i,u,c.normalize(),n?n.status:void 0)}),c.normalize(),u}function f5(e){return!(!e||!e.__CANCEL__)}function Mv(e,n,i){Yn.call(this,e??"canceled",Yn.ERR_CANCELED,n,i),this.name="CanceledError"}function m5(e,n,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?n(new Yn("Request failed with status code "+i.status,[Yn.ERR_BAD_REQUEST,Yn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}Qe.inherits(Mv,Yn,{__CANCEL__:!0});const SI=function(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const f=new Array(u),_=new Array(u);let v,y=0,w=0;return h=h!==void 0?h:1e3,function(I){const P=Date.now(),F=_[w];v||(v=P),f[y]=I,_[y]=P;let x=w,M=0;for(;x!==y;)M+=f[x++],x%=u;if(y=(y+1)%u,y===w&&(w=(w+1)%u),P-v<h)return;const $=F&&P-F;return $?Math.round(1e3*M/$):void 0}}(50,250);return function(u,h){let f,_,v=0,y=1e3/h;const w=function(I){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),f=null,_&&(clearTimeout(_),_=null),u.apply(null,I)};return[function(){const I=Date.now(),P=I-v;for(var F=arguments.length,x=new Array(F),M=0;M<F;M++)x[M]=arguments[M];P>=y?w(x,I):(f=x,_||(_=setTimeout(()=>{_=null,w(f)},y-P)))},()=>f&&w(f)]}(u=>{const h=u.loaded,f=u.lengthComputable?u.total:void 0,_=h-o,v=c(_);o=h,e({loaded:h,total:f,progress:f?h/f:void 0,bytes:_,rate:v||void 0,estimated:v&&f&&h<=f?(f-h)/v:void 0,event:u,lengthComputable:f!=null,[n?"download":"upload"]:!0})},i)},g5=(e,n)=>{const i=e!=null;return[o=>n[0]({lengthComputable:i,total:e,loaded:o}),n[1]]},_5=e=>function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Qe.asap(()=>e(...i))};var Xue=aa.hasStandardBrowserEnv?((e,n)=>i=>(i=new XC(i,aa.origin),e.protocol===i.protocol&&e.host===i.host&&(n||e.port===i.port)))(new XC(aa.origin),aa.navigator&&/(msie|trident)/i.test(aa.navigator.userAgent)):()=>!0,Jue=aa.hasStandardBrowserEnv?{write(e,n,i,o,c,u){const h=[e+"="+encodeURIComponent(n)];Qe.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),Qe.isString(o)&&h.push("path="+o),Qe.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function E5(e,n){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(n)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,n):n}function v5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const y5=e=>e instanceof Vu?function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?v5(Object(o),!0).forEach(function(c){z(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):v5(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e):e;function Gg(e,n){n=n||{};const i={};function o(v,y,w,I){return Qe.isPlainObject(v)&&Qe.isPlainObject(y)?Qe.merge.call({caseless:I},v,y):Qe.isPlainObject(y)?Qe.merge({},y):Qe.isArray(y)?y.slice():y}function c(v,y,w,I){return Qe.isUndefined(y)?Qe.isUndefined(v)?void 0:o(void 0,v,0,I):o(v,y,0,I)}function u(v,y){if(!Qe.isUndefined(y))return o(void 0,y)}function h(v,y){return Qe.isUndefined(y)?Qe.isUndefined(v)?void 0:o(void 0,v):o(void 0,y)}function f(v,y,w){return w in n?o(v,y):w in e?o(void 0,v):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f,headers:(v,y,w)=>c(y5(v),y5(y),0,!0)};return Qe.forEach(Object.keys(Object.assign({},e,n)),function(v){const y=_[v]||c,w=y(e[v],n[v],v);Qe.isUndefined(w)&&y!==f||(i[v]=w)}),i}var S5=e=>{const n=Gg({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:f,auth:_}=n;if(n.headers=f=Vu.from(f),n.url=V4(E5(n.baseURL,n.url),e.params,e.paramsSerializer),_&&f.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),Qe.isFormData(o)){if(aa.hasStandardBrowserEnv||aa.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if((i=f.getContentType())!==!1){const[v,...y]=i?i.split(";").map(w=>Fs(w).call(w)).filter(Boolean):[];f.setContentType([v||"multipart/form-data",...y].join("; "))}}if(aa.hasStandardBrowserEnv&&(c&&Qe.isFunction(c)&&(c=c(n)),c||c!==!1&&Xue(n.url))){const v=u&&h&&Jue.read(h);v&&f.set(u,v)}return n},Que=typeof XMLHttpRequest<"u"&&function(e){return new tt(function(n,i){const o=S5(e);let c=o.data;const u=Vu.from(o.headers).normalize();let h,f,_,v,y,{responseType:w,onUploadProgress:I,onDownloadProgress:P}=o;function F(){v&&v(),y&&y(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let x=new XMLHttpRequest;function M(){if(!x)return;const q=Vu.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders());m5(function(ae){n(ae),F()},function(ae){i(ae),F()},{data:w&&w!=="text"&&w!=="json"?x.response:x.responseText,status:x.status,statusText:x.statusText,headers:q,config:e,request:x}),x=null}x.open(o.method.toUpperCase(),o.url,!0),x.timeout=o.timeout,"onloadend"in x?x.onloadend=M:x.onreadystatechange=function(){x&&x.readyState===4&&(x.status!==0||x.responseURL&&x.responseURL.indexOf("file:")===0)&&setTimeout(M)},x.onabort=function(){x&&(i(new Yn("Request aborted",Yn.ECONNABORTED,e,x)),x=null)},x.onerror=function(){i(new Yn("Network Error",Yn.ERR_NETWORK,e,x)),x=null},x.ontimeout=function(){let q=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const ae=o.transitional||j4;o.timeoutErrorMessage&&(q=o.timeoutErrorMessage),i(new Yn(q,ae.clarifyTimeoutError?Yn.ETIMEDOUT:Yn.ECONNABORTED,e,x)),x=null},c===void 0&&u.setContentType(null),"setRequestHeader"in x&&Qe.forEach(u.toJSON(),function(q,ae){x.setRequestHeader(ae,q)}),Qe.isUndefined(o.withCredentials)||(x.withCredentials=!!o.withCredentials),w&&w!=="json"&&(x.responseType=o.responseType),P&&([_,y]=SI(P,!0),x.addEventListener("progress",_)),I&&x.upload&&([f,v]=SI(I),x.upload.addEventListener("progress",f),x.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(h=q=>{x&&(i(!q||q.type?new Mv(null,e,x):q),x.abort(),x=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const $=function(q){const ae=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return ae&&ae[1]||""}(o.url);$&&aa.protocols.indexOf($)===-1?i(new Yn("Unsupported protocol "+$+":",Yn.ERR_BAD_REQUEST,e)):x.send(c||null)})},Zue=(e,n)=>{const{length:i}=e=e?e.filter(Boolean):[];if(n||i){let o,c=new AbortController;const u=function(v){if(!o){o=!0,f();const y=v instanceof Error?v:this.reason;c.abort(y instanceof Yn?y:new Mv(y instanceof Error?y.message:y))}};let h=n&&setTimeout(()=>{h=null,u(new Yn("timeout ".concat(n," of ms exceeded"),Yn.ETIMEDOUT))},n);const f=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),e=null)};e.forEach(v=>v.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>Qe.asap(f),_}},ede=pj,tde=$c;kn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=tde.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var nde=$c,rde=Ad;kn({target:"Promise",stat:!0,forced:!0},{try:function(e){var n=nde.f(this),i=rde(e);return(i.error?n.reject:n.resolve)(i.value),n.promise}});var s1=l(ede),T5=kv.f("asyncIterator"),ide=l(T5);function o1(e,n){this.v=e,this.k=n}function h0(e){var n,i;function o(u,h){try{var f=e[u](h),_=f.value,v=_ instanceof o1;s1.resolve(v?_.v:_).then(function(y){if(v){var w=u==="return"?"return":"next";if(!_.k||y.done)return o(w,y);y=e[w](y).value}c(f.done?"return":"normal",y)},function(y){o("throw",y)})}catch(y){c("throw",y)}}function c(u,h){switch(u){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?o(n.key,n.arg):i=null}this._invoke=function(u,h){return new s1(function(f,_){var v={key:u,arg:h,resolve:f,reject:_,next:null};i?i=i.next=v:(n=i=v,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function Yc(e){return function(){return new h0(e.apply(this,arguments))}}function En(e){return new o1(e,0)}function TI(e){var n={},i=!1;function o(c,u){return i=!0,{done:!1,value:new o1(u=new s1(function(h){h(e[c](u))}),1)}}return n[xv!==void 0&&X3||"@@iterator"]=function(){return this},n.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(n.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(n.return=function(c){return i?(i=!1,c):o("return",c)}),n}h0.prototype[typeof xv=="function"&&ide||"@@asyncIterator"]=function(){return this},h0.prototype.next=function(e){return this._invoke("next",e)},h0.prototype.throw=function(e){return this._invoke("throw",e)},h0.prototype.return=function(e){return this._invoke("return",e)};var a1=l(T5);function c1(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=a1,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new bI(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function bI(e){function n(i){if(Object(i)!==i)return tt.reject(new TypeError(i+" is not an object."));var o=i.done;return tt.resolve(i.value).then(function(c){return{value:c,done:o}})}return bI=function(i){this.s=i,this.n=i.next},bI.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?tt.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?tt.reject(i):n(o.apply(this.s,arguments))}},new bI(e)}const sde=function*(e,n){let i=e.byteLength;if(!n||i<n)return void(yield e);let o,c=0;for(;c<i;)o=c+n,yield e.slice(c,o),c=o},ode=function(){var e=Yc(function*(n,i){var o,c=!1,u=!1;try{for(var h,f=c1(ade(n));c=!(h=yield En(f.next())).done;c=!1){const _=h.value;yield*TI(c1(sde(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&f.return!=null&&(yield En(f.return()))}finally{if(u)throw o}}});return function(n,i){return e.apply(this,arguments)}}(),ade=function(){var e=Yc(function*(n){if(n[a1])return void(yield*TI(c1(n)));const i=n.getReader();try{for(;;){const{done:o,value:c}=yield En(i.read());if(o)break;yield c}}finally{yield En(i.cancel())}});return function(n){return e.apply(this,arguments)}}(),b5=(e,n,i,o)=>{const c=ode(e,n);let u,h=0,f=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:v,value:y}=await c.next();if(v)return f(),void _.close();let w=y.byteLength;if(i){let I=h+=w;i(I)}_.enqueue(new Uint8Array(y))}catch(v){throw f(v),v}},cancel:_=>(f(_),c.return())},{highWaterMark:2})};function w5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function R5(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?w5(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w5(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const wI=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",C5=wI&&typeof ReadableStream=="function",cde=wI&&(typeof TextEncoder=="function"?(I5=new TextEncoder,e=>I5.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var I5;const A5=function(e){try{for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},lde=C5&&A5(()=>{let e=!1;const n=new Request(aa.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!n}),l1=C5&&A5(()=>Qe.isReadableStream(new Response("").body)),RI={stream:l1&&(e=>e.body)};var O5;wI&&(O5=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!RI[e]&&(RI[e]=Qe.isFunction(O5[e])?n=>n[e]():(n,i)=>{throw new Yn("Response type '".concat(e,"' is not supported"),Yn.ERR_NOT_SUPPORT,i)})}));const ude=async(e,n)=>{const i=Qe.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:Qe.isBlob(o)?o.size:Qe.isSpecCompliantForm(o)?(await new Request(aa.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:Qe.isArrayBufferView(o)||Qe.isArrayBuffer(o)?o.byteLength:(Qe.isURLSearchParams(o)&&(o+=""),Qe.isString(o)?(await cde(o)).byteLength:void 0))(n)};var dde=wI&&(async e=>{let{url:n,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:f,onUploadProgress:_,responseType:v,headers:y,withCredentials:w="same-origin",fetchOptions:I}=S5(e);v=v?(v+"").toLowerCase():"text";let P,F=Zue([c,u&&u.toAbortSignal()],h);const x=F&&F.unsubscribe&&(()=>{F.unsubscribe()});let M;try{if(_&&lde&&i!=="get"&&i!=="head"&&(M=await ude(y,o))!==0){let ge,pe=new Request(n,{method:"POST",body:o,duplex:"half"});if(Qe.isFormData(o)&&(ge=pe.headers.get("content-type"))&&y.setContentType(ge),pe.body){const[we,Be]=g5(M,SI(_5(_)));o=b5(pe.body,65536,we,Be)}}Qe.isString(w)||(w=w?"include":"omit");const $="credentials"in Request.prototype;P=new Request(n,R5(R5({},I),{},{signal:F,method:i.toUpperCase(),headers:y.normalize().toJSON(),body:o,duplex:"half",credentials:$?w:void 0}));let q=await fetch(P);const ae=l1&&(v==="stream"||v==="response");if(l1&&(f||ae&&x)){const ge={};["status","statusText","headers"].forEach(nt=>{ge[nt]=q[nt]});const pe=Qe.toFiniteNumber(q.headers.get("content-length")),[we,Be]=f&&g5(pe,SI(_5(f),!0))||[];q=new Response(b5(q.body,65536,we,()=>{Be&&Be(),x&&x()}),ge)}v=v||"text";let me=await RI[Qe.findKey(RI,v)||"text"](q,e);return!ae&&x&&x(),await new tt((ge,pe)=>{m5(ge,pe,{data:me,headers:Vu.from(q.headers),status:q.status,statusText:q.statusText,config:e,request:P})})}catch($){throw x&&x(),$&&$.name==="TypeError"&&/fetch/i.test($.message)?Object.assign(new Yn("Network Error",Yn.ERR_NETWORK,e,P),{cause:$.cause||$}):Yn.from($,$&&$.code,e,P)}});const u1={http:null,xhr:Que,fetch:dde};Qe.forEach(u1,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const P5=e=>"- ".concat(e),hde=e=>Qe.isFunction(e)||e===null||e===!1;var N5={getAdapter:e=>{e=Qe.isArray(e)?e:[e];const{length:n}=e;let i,o;const c={};for(let u=0;u<n;u++){let h;if(i=e[u],o=i,!hde(i)&&(o=u1[(h=String(i)).toLowerCase()],o===void 0))throw new Yn("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[f,_]=h;return"adapter ".concat(f," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new Yn("There is no suitable adapter to dispatch the request "+(n?u.length>1?`since :
`+u.map(P5).join(`
`):" "+P5(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:u1};function d1(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Mv(null,e)}function k5(e){return d1(e),e.headers=Vu.from(e.headers),e.data=i1.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),N5.getAdapter(e.adapter||n1.adapter)(e).then(function(n){return d1(e),n.data=i1.call(e,e.transformResponse,n),n.headers=Vu.from(n.headers),n},function(n){return f5(n)||(d1(e),n&&n.response&&(n.response.data=i1.call(e,e.transformResponse,n.response),n.response.headers=Vu.from(n.response.headers))),tt.reject(n)})}const D5="1.7.9",CI={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{CI[e]=function(i){return typeof i===e||"a"+(n<1?"n ":" ")+e}});const L5={};CI.transitional=function(e,n,i){function o(c,u){return"[Axios v"+D5+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new Yn(o(u," has been removed"+(n?" in "+n:"")),Yn.ERR_DEPRECATED);return n&&!L5[u]&&(L5[u]=!0,console.warn(o(u," has been deprecated since v"+n+" and will be removed in the near future"))),!e||e(c,u,h)}},CI.spelling=function(e){return(n,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var II={assertOptions:function(e,n,i){if(typeof e!="object")throw new Yn("options must be an object",Yn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=n[u];if(h){const f=e[u],_=f===void 0||h(f,u,e);if(_!==!0)throw new Yn("option "+u+" must be "+_,Yn.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new Yn("Unknown option "+u,Yn.ERR_BAD_OPTION)}},validators:CI};const Ld=II.validators;let AI=class{constructor(e){this.defaults=e,this.interceptors={request:new F4,response:new F4}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{}).url=e:n=e||{},n=Gg(this.defaults,n);const{transitional:i,paramsSerializer:o,headers:c}=n;i!==void 0&&II.assertOptions(i,{silentJSONParsing:Ld.transitional(Ld.boolean),forcedJSONParsing:Ld.transitional(Ld.boolean),clarifyTimeoutError:Ld.transitional(Ld.boolean)},!1),o!=null&&(Qe.isFunction(o)?n.paramsSerializer={serialize:o}:II.assertOptions(o,{encode:Ld.function,serialize:Ld.function},!0)),II.assertOptions(n,{baseUrl:Ld.spelling("baseURL"),withXsrfToken:Ld.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=c&&Qe.merge(c.common,c[n.method]);c&&Qe.forEach(["delete","get","head","post","put","patch","common"],P=>{delete c[P]}),n.headers=Vu.concat(u,c);const h=[];let f=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(n)===!1||(f=f&&P.synchronous,h.unshift(P.fulfilled,P.rejected))});const _=[];let v;this.interceptors.response.forEach(function(P){_.push(P.fulfilled,P.rejected)});let y,w=0;if(!f){const P=[k5.bind(this),void 0];for(P.unshift.apply(P,h),P.push.apply(P,_),y=P.length,v=tt.resolve(n);w<y;)v=v.then(P[w++],P[w++]);return v}y=h.length;let I=n;for(w=0;w<y;){const P=h[w++],F=h[w++];try{I=P(I)}catch(x){F.call(this,x);break}}try{v=k5.call(this,I)}catch(P){return tt.reject(P)}for(w=0,y=_.length;w<y;)v=v.then(_[w++],_[w++]);return v}getUri(e){return V4(E5((e=Gg(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Qe.forEach(["delete","get","head","options"],function(e){AI.prototype[e]=function(n,i){return this.request(Gg(i||{},{method:e,url:n,data:(i||{}).data}))}}),Qe.forEach(["post","put","patch"],function(e){function n(i){return function(o,c,u){return this.request(Gg(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}AI.prototype[e]=n(),AI.prototype[e+"Form"]=n(!0)});var OI=AI;class h1{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let i;this.promise=new tt(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new tt(f=>{o.subscribe(f),u=f}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},n(function(c,u,h){o.reason||(o.reason=new Mv(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){this.reason?n(this.reason):this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const n=new AbortController,i=o=>{n.abort(o)};return this.subscribe(i),n.signal.unsubscribe=()=>this.unsubscribe(i),n.signal}static source(){let n;return{token:new h1(function(o){n=o}),cancel:n}}}var pde=h1;const p1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(p1).forEach(e=>{let[n,i]=e;p1[i]=n});var fde=p1;const As=function e(n){const i=new OI(n),o=y4(OI.prototype.request,i);return Qe.extend(o,OI.prototype,i,{allOwnKeys:!0}),Qe.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(Gg(n,c))},o}(n1);As.Axios=OI,As.CanceledError=Mv,As.CancelToken=pde,As.isCancel=f5,As.VERSION=D5,As.toFormData=cI,As.AxiosError=Yn,As.Cancel=As.CanceledError,As.all=function(e){return tt.all(e)},As.spread=function(e){return function(n){return e.apply(null,n)}},As.isAxiosError=function(e){return Qe.isObject(e)&&e.isAxiosError===!0},As.mergeConfig=Gg,As.AxiosHeaders=Vu,As.formToJSON=e=>h5(Qe.isHTMLForm(e)?new FormData(e):e),As.getAdapter=N5.getAdapter,As.HttpStatusCode=fde,As.default=As;var Do=As;const mde=()=>{};function p0(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:mde};return e.promise=new tt((n,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,n(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const PI=new Map,NI=new Map,xd=new Map;let Ci=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Dn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const x5=new kae;let Fu=x5.getResult(),f1=null;function vn(e){if(!f1){Fu=x5.getResult();const n=function(f){if(f.engine.name==="Blink"&&f.browser.name!=="WeChat")return Dn.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Dn.CHROME;case"Safari":case"Mobile Safari":return Dn.SAFARI;case"Edge":return Dn.EDGE;case"Firefox":return Dn.FIREFOX;case"QQ":case"QQBrowser":return Dn.QQ;case"Opera":return Dn.OPERA;case"WeChat":return Dn.WECHAT;default:return f.browser.name||""}}(Fu),i=M5(Fu),o=function(f){return f.os.name==="Windows"?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||""}(Fu),c=Fu.os.version,u=M5(Fu,!1),h=Fu.device.type;if(!(n&&i&&o&&c))return{name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};f1={name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return f1}function M5(e){let n,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return n=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?n.split(".")[0]:n}function kI(){return vn().os}function U5(){const e=vn();return"".concat(e.os," ").concat(e.osVersion)}function DI(){const e=vn();return!!(Fu.engine.name==="WebKit"&&e.os===Ci.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Dn.SAFARI||so()&&e.name!==Dn.SAFARI)}function cp(){return vn().name===Dn.CHROME}function as(){return vn().name===Dn.SAFARI}function V5(){return vn().name===Dn.EDGE}function Pr(){return vn().name===Dn.FIREFOX}function so(){return vn().os===Ci.IOS}function f0(e){const n=vn();return!(n.name!==Dn.CHROME||!n.osVersion)&&Number(n.version)>=e}function F5(e){const n=vn();return!(n.name!==Dn.CHROME||!n.osVersion)&&Number(n.version)<e}function m1(e,n,i){const o=vn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=n&&Number(o.version)<=i:Number(o.version)===n)}function g1(e){const n=vn();return!(n.name!==Dn.EDGE||!n.osVersion)&&Number(n.version)>=e}function j5(e){const n=vn();return!(n.name!==Dn.SAFARI||!n.osVersion)&&Number(n.version)>=e}function B5(e,n,i){const o=vn();if(o.os!==Ci.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e}function W5(e,n,i){const o=vn();if(o.name!==Dn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e:n?Number(c[0])===e&&Number(c[1])<=n||Number(c[0])<e:Number(c[0])<=e}function _1(e){const n=vn();return!(n.name!==Dn.OPERA||!n.osVersion)&&Number(n.version)>=e}function G5(){const e=vn();if(e.os!==Ci.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])<14||Number(n[0])===14&&Number(n[1])<=6}function Uv(){const e=vn();if(e.os!==Ci.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15}function E1(){const e=vn();if(e.os!==Ci.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===16}function z5(){const e=vn();if(e.os!==Ci.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15&&Number(n[1])>=1}function Vl(){return as()&&navigator.maxTouchPoints>0}function H5(){return vn().name===Dn.WECHAT}function K5(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function v1(){const e=kI();return function(){const{deviceType:n}=vn();return n==="mobile"||n==="tablet"}()||e===Ci.ANDROID||e===Ci.IOS||e===Ci.HARMONY_OS}function lp(){const e=vn();return e.name!==Dn.EDGE&&e.name!==Dn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function LI(){return kI()===Ci.ANDROID}function m0(){const e=vn();return LI()&&(e.name===Dn.CHROME||e.name===Dn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function $5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ot(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?$5(Object(i),!0).forEach(function(o){Mt(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$5(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Mt(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var _=f.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}let Y=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Ce=class extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),Mt(this,"code",void 0),Mt(this,"message",void 0),Mt(this,"data",void 0),Mt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function up(e,n){if(typeof e!="boolean")throw new Ce(Y.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function Si(e,n,i){if(!Xe(i).call(i,e))throw new Ce(Y.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(i)))}function Xn(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Ce(Y.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function y1(e,n){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ce(Y.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));e.min!==void 0&&Xn(e.min,"".concat(n,".min"),0,1/0),e.max!==void 0&&Xn(e.max,"".concat(n,".max"),1,1/0),e.exact!==void 0&&Xn(e.exact,"".concat(n,".exact"),1,1/0),e.ideal!==void 0&&Xn(e.ideal,"".concat(n,".ideal"),1,1/0)}else Xn(e,n,1,1/0)}function zi(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ce(Y.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!q5(e,i,o,c))throw new Ce(Y.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function dp(e,n){if(!Array.isArray(e))throw new Ce(Y.INVALID_PARAMS,"".concat(n," should be an array"))}function Nr(e){return e==null}function q5(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=n&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var g0=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(g0||{}),S1=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(S1||{});const Y5=new class{constructor(){Mt(this,"_clientSize",null),Mt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Mt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Mt(this,"getStyle",e=>window.getComputedStyle(e,null)),Mt(this,"checkCssVisibleProperty",e=>{var n;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:f}=o;return(c==="none"||Xe(n=["hidden","collapse"]).call(n,u)||Number(h)<.1)&&(i=!1),!!i&&(f&&f.split(" ").filter(_=>{var v;const y=_.split("(")[0];return Xe(v=["brightness","blur","opacity"]).call(v,y)}).map(_=>{const[v,y]=_.split(/\(|\)/);return[v,Number(y.match(/^[0-9\.]+/))]}).forEach(_=>{const[v,y]=_;switch(v){case"brightness":(y<.1||y>3)&&(i=!1);break;case"blur":y>3&&(i=!1);break;case"opacity":y<.1&&(i=!1)}}),i)}),Mt(this,"checkPropertyUpToAllParentNodes",(e,n)=>{let i=!0,o=!0;const c=h=>n(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),Mt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Mt(this,"getSizeAboutClient",e=>{const{width:n,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),f=this.getClientWidth(),_=this.getClientHeight();return{width:n,height:i,left:o,right:c,top:u,bottom:h,clientWidth:f,clientHeight:_,clientMin:Math.min(f,_)}}),Mt(this,"checkActualSize",()=>{const{width:e,height:n,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,n,i)}),Mt(this,"elementFromPoint",(e,n)=>document.elementFromPoint?document.elementFromPoint(e,n):null),Mt(this,"checkCoverForAPoint",(e,n,i)=>{const o=this.elementFromPoint(e,n);return o!==null&&o!==i}),Mt(this,"getPointPositionList",()=>{const{width:e,height:n,left:i,top:o}=this._clientSize,c=e/6,u=n/6,h=[],f=10**6;for(let _=0;_<5;_++)for(let v=0;v<5;v++){const y=(i*f+(_===0?.1:_===4?(c*_*f-1e5)/f:c*_)*f)/f,w=(o*f+(v===0?.1:v===4?(u*v*f-1e5)/f:u*v)*f)/f;h.push({x:y,y:w})}return[...h]}),Mt(this,"checkElementCover",e=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,e)).filter(n=>!!n).length>6),Mt(this,"checkSizeIsVisible",(e,n,i)=>(e>50||i/e<=10)&&(n>50||i/n<=10)),Mt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:n,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let f,_,v,y;if(e<0)f=0;else{if(!(e<u))return!1;f=e}if(n<0)return!1;if(_=n<u?n:u,i<0)v=0;else{if(!(i<c))return!1;v=i}if(o<0)return!1;y=o<c?o:c;const w=_-f,I=y-v;return this.checkSizeIsVisible(w,I,h)}),Mt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Mt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(g0.COVERED);{const n=this.checkActualSize(),i=this.checkSizeOfPartInClient();return n&&!i?this.returnHiddenResult(g0.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(g0.SIZE)}}return this.returnHiddenResult(g0.STYLE)}return this.returnHiddenResult(S1.UNMOUNTED)}return this.returnHiddenResult(S1.INVALID_HTML_ELEMENT)}),Mt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,n=>n.nodeName.toUpperCase()!=="HTML"?n.parentElement!==null:!!document.documentElement))}};function T1(e){return new TextEncoder().encode(e)}const X5=function(e,n){const i=new Uint8Array(e.byteLength+n.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(n),e.byteLength),i},b1=async e=>function(n,i){let o="";return new Uint8Array(n).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",T1(e)),16);let Rr=class{constructor(){Mt(this,"_events",{}),Mt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<n.length;u+=1){const h=n[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,n){let i=e.length;for(;i--;)if(e[i].listener===n)return i;return-1}},_0=null;function J5(){if(_0)return _0;if(window.electron)return _0=window.electron;if(!window.require)return null;try{return _0=window.require("electron"),_0}catch{return null}}let hi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),kr=function(e){return e.TRACER="tracer",e}({});function Q5(e){return Xn(e.timeout,"config.timeout",0,1e5),Xn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Xn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Xn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let gde=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Un=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function E0(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function Z5(e){return zi(e.turnServerURL,"turnServerURL"),zi(e.username,"username"),zi(e.password,"password"),e.udpport&&Xn(e.udpport,"udpport",1,99999,!0),e.forceturn&&up(e.forceturn,"forceturn"),e.security&&up(e.security,"security"),e.tcpport&&Xn(e.tcpport,"tcpport",1,99999,!0),!0}function w1(e){return e.level!==void 0&&Si(e.level,"level",[1,2,3]),e.delay!==void 0&&Xn(e.delay,"delay",0,3e3,!0),!0}let on=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),cs=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),xa=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Vv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ls(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(n).length===0?tt.reject(new Ce(Y.UNEXPECTED_ERROR,"can not emit promise")):new tt((u,h)=>{e.emit(n,...o,u,h)})}function tr(e,n){if(e.getListeners(n).length===0)return tt.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return ls(e,n,...o)}function hc(e,n){if(e.getListeners(n).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return v0(e,n,...o)}function v0(e,n){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(n,...u,f=>{i=f},f=>{o=f}),o!==null)throw o;if(i===null)throw new Ce(Y.UNEXPECTED_ERROR,"handler is not sync");return i}const ni=new class extends Rr{set networkState(e){this.emit(Vv.NETWORK_STATE_CHANGE,e,this._networkState),e===xa.ONLINE?this.emit(Vv.ONLINE):e===xa.OFFLINE&&(this.onlineWaiter=new tt(n=>{this.once(Vv.ONLINE,()=>{this.onlineWaiter=void 0,n(xa.ONLINE)})}),this.emit(Vv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===xa.ONLINE}constructor(){super(),Mt(this,"_moduleName","network-indicator"),Mt(this,"_networkState",xa.ONLINE),Mt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=xa.ONLINE}),window.addEventListener("offline",()=>{this.networkState=xa.OFFLINE})}};function xI(e,n){const i=e.indexOf(n);i!==-1&&e.splice(i,1)}function Fv(e){const n=[];return e.forEach(i=>{n.indexOf(i)===-1&&n.push(i)}),n}function MI(e){tt!==void 0?tt.resolve().then(e):setTimeout(e,0)}function Dr(e){return JSON.parse(JSON.stringify(e))}function zg(e){try{return Dr(e)}catch{return e}}const e6={};function zf(e,n){e6[n]||(e6[n]=!0,e())}function Hg(e){const n=window.atob(e),i=new Uint8Array(new ArrayBuffer(n.length));for(let o=0;o<n.length;o+=1)i[o]=n.charCodeAt(o);return i}function Hf(e){let n="";for(let i=0;i<e.length;i+=1)n+=String.fromCharCode(e[i]);return window.btoa(n)}function t6(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>n)i=i.slice(0,n);else if(i.length<n){const o=new Uint8Array(n);o.set(i),i=o}return i}function n6(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=Aa(n).call(n,(h,f)=>h+f.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return n.forEach(h=>{c.set(h,u),u+=h.length}),c}function Md(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function r6(e){let n=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{n+=typeof i=="string"?Md(i):i.size}),n+138}function _de(e){const n=new Ce(Y.TIMEOUT,"timeout");return new tt((i,o)=>{window.setTimeout(()=>o(n),e)})}function Hi(e){return new tt(n=>{window.setTimeout(n,e)})}function nr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(n).concat(i):"".concat(n).concat(i)+nr(e-i.length,"")}function Kg(){return nr(32,"").toUpperCase()}const UI=()=>{},i6=new class{constructor(){Mt(this,"fnMap",new Map)}throttleByKey(e,n,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(n)){const f=this.fnMap.get(n);if(f.threshold!==i){f.fn(...f.args),clearTimeout(f.timer);const _=window.setTimeout(()=>{const v=this.fnMap.get(n);v&&v.fn(...v.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(n,ot(ot({},f),{},{fn:e,args:u,skipFn:o}))}else{const f=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:f,args:u,skipFn:o})}}},s6=i6.throttleByKey.bind(i6);function o6(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function R1(e,n){if(!o6(e)||!o6(n)||Array.isArray(e)&&!Array.isArray(n)||!Array.isArray(e)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(e)){const i=[...e];for(let o=0;o<n.length;o++)i[o]=R1(e[o],n[o]);return i}{const i=ot({},e);for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=R1(e[o],n[o]):i[o]=n[o]);return i}}function a6(e,n){let i=[0];if(i=new Array(n).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==n););return i}function C1(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function c6(e){const n="0123456789abcdef";function i(ae){let me,ge="";for(me=0;me<=3;me++)ge+=n.charAt(ae>>8*me+4&15)+n.charAt(ae>>8*me&15);return ge}function o(ae,me){const ge=(65535&ae)+(65535&me);return(ae>>16)+(me>>16)+(ge>>16)<<16|65535&ge}function c(ae,me,ge,pe,we,Be){return o(function(nt,st){return nt<<st|nt>>>32-st}(o(o(me,ae),o(pe,Be)),we),ge)}function u(ae,me,ge,pe,we,Be,nt){return c(me&ge|~me&pe,ae,me,we,Be,nt)}function h(ae,me,ge,pe,we,Be,nt){return c(me&pe|ge&~pe,ae,me,we,Be,nt)}function f(ae,me,ge,pe,we,Be,nt){return c(me^ge^pe,ae,me,we,Be,nt)}function _(ae,me,ge,pe,we,Be,nt){return c(ge^(me|~pe),ae,me,we,Be,nt)}const v=function(ae){let me;const ge=1+(ae.length+8>>6),pe=new Array(16*ge);for(me=0;me<16*ge;me++)pe[me]=0;for(me=0;me<ae.length;me++)pe[me>>2]|=ae.charCodeAt(me)<<me%4*8;return pe[me>>2]|=128<<me%4*8,pe[16*ge-2]=8*ae.length,pe}(e);let y,w,I,P,F,x=1732584193,M=-271733879,$=-1732584194,q=271733878;for(y=0;y<v.length;y+=16)w=x,I=M,P=$,F=q,x=u(x,M,$,q,v[y+0],7,-680876936),q=u(q,x,M,$,v[y+1],12,-389564586),$=u($,q,x,M,v[y+2],17,606105819),M=u(M,$,q,x,v[y+3],22,-1044525330),x=u(x,M,$,q,v[y+4],7,-176418897),q=u(q,x,M,$,v[y+5],12,1200080426),$=u($,q,x,M,v[y+6],17,-1473231341),M=u(M,$,q,x,v[y+7],22,-45705983),x=u(x,M,$,q,v[y+8],7,1770035416),q=u(q,x,M,$,v[y+9],12,-1958414417),$=u($,q,x,M,v[y+10],17,-42063),M=u(M,$,q,x,v[y+11],22,-1990404162),x=u(x,M,$,q,v[y+12],7,1804603682),q=u(q,x,M,$,v[y+13],12,-40341101),$=u($,q,x,M,v[y+14],17,-1502002290),M=u(M,$,q,x,v[y+15],22,1236535329),x=h(x,M,$,q,v[y+1],5,-165796510),q=h(q,x,M,$,v[y+6],9,-1069501632),$=h($,q,x,M,v[y+11],14,643717713),M=h(M,$,q,x,v[y+0],20,-373897302),x=h(x,M,$,q,v[y+5],5,-701558691),q=h(q,x,M,$,v[y+10],9,38016083),$=h($,q,x,M,v[y+15],14,-660478335),M=h(M,$,q,x,v[y+4],20,-405537848),x=h(x,M,$,q,v[y+9],5,568446438),q=h(q,x,M,$,v[y+14],9,-1019803690),$=h($,q,x,M,v[y+3],14,-187363961),M=h(M,$,q,x,v[y+8],20,1163531501),x=h(x,M,$,q,v[y+13],5,-1444681467),q=h(q,x,M,$,v[y+2],9,-51403784),$=h($,q,x,M,v[y+7],14,1735328473),M=h(M,$,q,x,v[y+12],20,-1926607734),x=f(x,M,$,q,v[y+5],4,-378558),q=f(q,x,M,$,v[y+8],11,-2022574463),$=f($,q,x,M,v[y+11],16,1839030562),M=f(M,$,q,x,v[y+14],23,-35309556),x=f(x,M,$,q,v[y+1],4,-1530992060),q=f(q,x,M,$,v[y+4],11,1272893353),$=f($,q,x,M,v[y+7],16,-155497632),M=f(M,$,q,x,v[y+10],23,-1094730640),x=f(x,M,$,q,v[y+13],4,681279174),q=f(q,x,M,$,v[y+0],11,-358537222),$=f($,q,x,M,v[y+3],16,-722521979),M=f(M,$,q,x,v[y+6],23,76029189),x=f(x,M,$,q,v[y+9],4,-640364487),q=f(q,x,M,$,v[y+12],11,-421815835),$=f($,q,x,M,v[y+15],16,530742520),M=f(M,$,q,x,v[y+2],23,-995338651),x=_(x,M,$,q,v[y+0],6,-198630844),q=_(q,x,M,$,v[y+7],10,1126891415),$=_($,q,x,M,v[y+14],15,-1416354905),M=_(M,$,q,x,v[y+5],21,-57434055),x=_(x,M,$,q,v[y+12],6,1700485571),q=_(q,x,M,$,v[y+3],10,-1894986606),$=_($,q,x,M,v[y+10],15,-1051523),M=_(M,$,q,x,v[y+1],21,-2054922799),x=_(x,M,$,q,v[y+8],6,1873313359),q=_(q,x,M,$,v[y+15],10,-30611744),$=_($,q,x,M,v[y+6],15,-1560198380),M=_(M,$,q,x,v[y+13],21,1309151649),x=_(x,M,$,q,v[y+4],6,-145523070),q=_(q,x,M,$,v[y+11],10,-1120210379),$=_($,q,x,M,v[y+2],15,718787259),M=_(M,$,q,x,v[y+9],21,-343485551),x=o(x,w),M=o(M,I),$=o($,P),q=o(q,F);return i(x)+i(M)+i($)+i(q)}let Ede=1,l6=console,ms=class{static setLogger(e){l6=e}constructor(e,n){Mt(this,"id",void 0),Mt(this,"lockingPromise",tt.resolve()),Mt(this,"locks",0),Mt(this,"name",""),Mt(this,"lockId",void 0),this.lockId=Ede++,e&&(this.name=e),n&&(this.id=n),this.logger("created")}logger(e,n){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(n??"");l6.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let n;this.locks+=1,this.logger("locked",e);const i=new tt(c=>{n=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function jv(e,n){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(e));const f=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,v=new Array(_),y=0;y<_;y++)v[y]=arguments[y];return await u.apply(this,v)}finally{f()}},c}}const pi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function I1(e,n){const i=Math.floor(n.timeout*Math.pow(n.timeoutFactor,e));return Math.min(n.maxRetryTimeout,i)}function ju(e,n,i,o){const c=Object.assign({},pi,o);let u=c.timeout;const h=async()=>{await function(v){return new tt(y=>{window.setTimeout(y,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let f=!1;const _=new tt(async(v,y)=>{n=n||(()=>!1),i=i||(()=>!0);for(let w=0;w<c.maxRetryCount;w+=1){if(f)return y(new Ce(Y.OPERATION_ABORTED));try{const I=await e();if(!n(I,w)||w+1===c.maxRetryCount)return v(I);await h()}catch(I){if(!i(I,w)||w+1===c.maxRetryCount)return y(I);await h()}}});return _.cancel=()=>f=!0,_}let VI,u6=class{constructor(e){Mt(this,"input",[]),Mt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Aa(e=this.input).call(e,(n,i)=>n+i)/this.input.length}},FI=0,A1=0;function O1(e,n,i,o){return new tt((c,u)=>{n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),FI+=Md(n.data)):i&&(n.data.size?FI+=n.data.size:n.data instanceof FormData?FI+=r6(n.data):FI+=Md(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Do.request(n).then(h=>{typeof h.data=="string"?A1+=Md(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?A1+=h.data.byteLength:A1+=Md(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Do.isCancel(h)?u(new Ce(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Ce(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new Ce(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Ce(Y.NETWORK_ERROR,h.message))})})}async function vde(e,n){const i=new Blob([n.data],{type:"buffer"});return await O1(e,ot(ot({},n),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const d6=()=>window.isSecureContext!==void 0;function Fl(e){if(Array.isArray(e))return e.map(i=>i);if(!h6(e))return e;const n={};for(const i in e){const o=e[i];h6(o)||Array.isArray(o)?n[i]=Fl(o):n[i]=o}return n}function h6(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let P1=class{constructor(e){Mt(this,"input",[]),Mt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Ud={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},y0={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ud,remoteCandidate:Ud},updateInterval:0},p6={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},f6={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},m6={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},g6={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let N1=class{constructor(e,n){Mt(this,"onFirstVideoReceived",void 0),Mt(this,"onFirstVideoDecoded",void 0),Mt(this,"onFirstAudioReceived",void 0),Mt(this,"onFirstVideoDecodedTimeout",void 0),Mt(this,"onFirstAudioDecoded",void 0),Mt(this,"onSelectedLocalCandidateChanged",void 0),Mt(this,"onSelectedRemoteCandidateChanged",void 0),Mt(this,"videoIsReady",!1),Mt(this,"videoIsReady2",{}),Mt(this,"pc",void 0),Mt(this,"options",void 0),Mt(this,"intervalTimer",void 0),Mt(this,"stats",Fl(y0)),Mt(this,"isFirstVideoReceived",{}),Mt(this,"isFirstVideoDecoded",{}),Mt(this,"isFirstAudioReceived",{}),Mt(this,"isFirstAudioDecoded",{}),Mt(this,"isFirstVideoDecodedTimeout",{}),Mt(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new tt(e=>{e({local:ot({},Ud),remote:ot({},Ud)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const f of i)e[f].forEach((_,v)=>{if(!this.lossRateWindowStats[n-1][f][v]||!this.lossRateWindowStats[0][f][v])return;const y=this.lossRateWindowStats[n-1][f][v].packets-this.lossRateWindowStats[0][f][v].packets,w=this.lossRateWindowStats[n-1][f][v].packetsLost-this.lossRateWindowStats[0][f][v].packetsLost;f==="videoSend"||f==="audioSend"?(o+=y,u+=w):(c+=y,h+=w),Number.isNaN(y)||Number.isNaN(y)?_.packetLostRate=0:_.packetLostRate=y<=0||w<=0?0:w/(y+w)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},yde=class extends N1{constructor(){super(...arguments),Mt(this,"_stats",y0),Mt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=Fl(y0);const i=n.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=n.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var i;const o=Xe(i=n.id).call(i,"send");switch("".concat(n.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=Fl(f6);c.codec=n.googCodecName,c.adaptionChangeReason="none",n.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(n.googAvgEncodeMs),c.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.firsCount=Number(n.googFirReceived),c.nacksCount=Number(n.googNacksReceived),c.plisCount=Number(n.googPlisReceived),c.frameCount=Number(n.framesEncoded),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Fl(p6),u=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(c.codec=n.googCodecName,c.targetDelayMs=Number(n.googTargetDelayMs),c.renderDelayMs=Number(n.googRenderDelayMs),c.currentDelayMs=Number(n.googCurrentDelayMs),c.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),c.decodeMs=Number(n.googDecodeMs),c.maxDecodeMs=Number(n.googMaxDecodeMs),c.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},c.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},c.decodeFrameRate=Number(n.googFrameRateDecoded),c.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},c.jitterBufferMs=Number(n.googJitterBufferMs),c.firsCount=Number(n.googFirsSent),c.nacksCount=Number(n.googNacksSent),c.plisCount=Number(n.googPlisSent),c.framesDecodeCount=Number(n.framesDecoded),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,f=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=f,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:ot({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Fl(g6);c.codec=n.googCodecName,c.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,c.decodingCNG=Number(n.googDecodingCNG),c.decodingCTN=Number(n.googDecodingCTN),c.decodingCTSG=Number(n.googDecodingCTSG),c.decodingNormal=Number(n.googDecodingNormal),c.decodingPLC=Number(n.googDecodingPLC),c.decodingPLCCNG=Number(n.googDecodingPLCCNG),c.expandRate=Number(n.googExpandRate),c.accelerateRate=Number(n.googAccelerateRate),c.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),c.speechExpandRate=Number(n.googSpeechExpandRate),c.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),c.jitterBufferMs=Number(n.googJitterBufferMs),c.jitterMs=Number(n.googJitterReceived),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),c.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Fl(m6);c.codec=n.googCodecName,c.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,c.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new tt((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),n.push(o)}),n}},S0=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),jI=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),k1=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),pc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Bv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Bv||{});function T0(e,n,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Bv.kNone;if(!n)return;const u=Number(n[i]);if(typeof u!="number")return;const h=Number(n[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const f=Number(e[i]);if(typeof f!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const v=h-_;return v?(u-f)/v*c:void 0}let _6=class extends N1{constructor(){super(...arguments),Mt(this,"_stats",y0),Mt(this,"report",void 0),Mt(this,"lastDecodeVideoReceiverStats",new Map),Mt(this,"lastVideoFramesRecv",new Map),Mt(this,"lastVideoFramesSent",new Map),Mt(this,"lastVideoFramesDecode",new Map),Mt(this,"lastVideoFramesOutput",new Map),Mt(this,"lastVideoJBDelay",new Map),Mt(this,"lastAudioJBDelay",new Map),Mt(this,"mediaBytesSent",new Map),Mt(this,"mediaBytesRetransmit",new Map),Mt(this,"mediaBytesTargetEncode",new Map),Mt(this,"lastDecodeAudioReceiverStats",new Map),Mt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Fl(y0),this.report.forEach(e=>{switch(e.type){case pc.OUTBOUND:case pc.INBOUND:{const n=e.mediaType||e.kind,i=!n&&"frameWidth"in e,o=!n&&!("frameWidth"in e);e.type===pc.OUTBOUND?n==="audio"||o?this.processAudioOutboundStats(e):(n==="video"||i)&&this.processVideoOutboundStats(e):e.type===pc.INBOUND&&(n==="audio"||o?this.processAudioInboundStats(e):(n==="video"||i)&&this.processVideoInboundStats(e));break}case pc.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case pc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:ot({},Ud),remote:ot({},Ud)};return e.forEach(i=>{let o;if(i.type===pc.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===pc.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(n.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(n.remote,u)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===pc.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===pc.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===pc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ot({},n),ot({},this.stats.selectedCandidatePair.localCandidate)),e.type===pc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ot({},n),ot({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);n||(n=Fl(g6),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived,n.totalProcessingDelay=e.totalProcessingDelay,n.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(n.ssrc);n.avgProcessingDelayMs=T0(i,n,"totalProcessingDelay","jitterBufferEmittedCount",Bv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(n.ssrc,ot({},n))}processVideoInboundStats(e){let n=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);n||(n=Fl(p6),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration,n.totalProcessingDelay=e.totalProcessingDelay,n.packetsDiscarded=e.packetsDiscarded,n.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,n.totalAssemblyTime=e.totalAssemblyTime,n.keyFramesDecoded=e.keyFramesDecoded,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),c=this.lastVideoFramesOutput.get(n.ssrc),u=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const h=n.decodedFrame?n.decodedFrame.width:0,f=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,h,f),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const h=i.stats,f=u-i.lts;n.framesDecodeFreezeTime=h.framesDecodeFreezeTime,n.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=f,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<h.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime,n.avgDecodeMs=T0(i==null?void 0:i.stats,n,"decodeMs","framesDecodeCount")),n.avgProcessingDelayMs=T0(i==null?void 0:i.stats,n,"totalProcessingDelay","framesDecodeCount",Bv.kMillisecondsFromSeconds),n.avgFramesAssembledFromMultiplePacketsMs=T0(i==null?void 0:i.stats,n,"totalAssemblyTime","framesAssembledFromMultiplePackets",Bv.kMillisecondsFromSeconds),n.avgInterFrameDelayMs=T0(i==null?void 0:i.stats,n,"totalInterFrameDelay","framesDecodeCount",Bv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:0}),n.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:Math.max(n.outputFrameRate,0)})):c?n.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:ot({},n),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);n||(n=Fl(f6),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new P1(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new P1(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new P1(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,n.hugeFramesSent=e.hugeFramesSent,n.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const o=this.findRemoteStatsId(e.ssrc,pc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(n||(n=Fl(m6),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,pc.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(e,n){var i;const o=Array.from(uc(i=this.report).call(i)).find(c=>c.type===n&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,n){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,n){const i=this.report.get(e);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,n,i){var o,c,u,h;const f=n?this.report.get(n):void 0,_=(o=f==null?void 0:f.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let v=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:e.frameWidth,y=(u=f==null?void 0:f.frameHeight)!==null&&u!==void 0?u:e.frameHeight,w=(h=f==null?void 0:f.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof v=="number"&&typeof y=="number"||(v=0,y=0),w==null){const I=Date.now(),P=this.lastVideoFramesSent.get(i.ssrc);P&&I-P.lts>=800?(w=Math.round((_-P.count)/((I-P.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:I,rate:w})):P?w=P.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:I,rate:0})}i.sentFrame={width:v,height:y,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(e,n,i){var o,c,u,h,f;const _=n?this.report.get(n):void 0,v=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,y=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,w=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,I=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,P=(f=_==null?void 0:_.jitterBufferEmittedCount)!==null&&f!==void 0?f:e.jitterBufferEmittedCount;if(typeof v=="number"){const F=this.lastVideoFramesRecv.get(i.ssrc),x=Date.now();i.framesReceivedCount=v;let M=0;F&&x-F.lts>=800?(M=Math.round((v-F.count)/((x-F.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:x,rate:M})):F?M=F.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:x,rate:0}),i.receivedFrame={width:y||0,height:w||0,frameRate:M||0},i.decodedFrame={width:y||0,height:w||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:y||0,height:w||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(I&&P){const F=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let x=F.jitterBufferMs;const M=P-F.jitterBufferEmittedCount;M>0&&(x=1e3*(I-F.jitterBufferDelay)/M),i.jitterBufferMs=x,i.currentDelayMs=Math.round(x),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:P,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,n,i){var o,c,u,h;const f=n?this.report.get(n):void 0,_=(o=(c=f==null?void 0:f.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,v=(u=(h=f==null?void 0:f.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(e,n,i){var o,c,u,h,f,_,v;const y=n?this.report.get(n):void 0,w=(o=y==null?void 0:y.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,I=(c=y==null?void 0:y.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,P=(u=y==null?void 0:y.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,F=(h=y==null?void 0:y.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,x=(f=y==null?void 0:y.audioLevel)!==null&&f!==void 0?f:e==null?void 0:e.audioLevel,M=(_=y==null?void 0:y.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,$=(v=y==null?void 0:y.concealedSamples)!==null&&v!==void 0?v:e.concealedSamples;if(typeof I=="number"&&(i.totalSamplesReceived=I),w&&I&&(i.accelerateRate=w/I),P&&F){const ae=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let me=ae.jitterBufferMs;const ge=F-ae.jitterBufferEmittedCount;ge>0&&(me=1e3*(P-ae.jitterBufferDelay)/ge),i.jitterBufferMs=Math.round(me),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:F,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=x;let q=1920;M&&I&&(q=I/M/50,i.receivedFrames=Math.round(I/q)),$&&(i.droppedFrames=Math.round($/q))}processRemoteInboundStats(e,n){const i=this.report.get(e);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime),i.jitter&&(n.jitterMs=1e3*i.jitter),i.timestamp&&(n.timestamp=i.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,n=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{n=n===null?c.diffMean():n+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Sde=class extends N1{updateStats(){return tt.resolve()}};function D1(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new yde(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new _6(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const f=h.getStats();return!!(f instanceof tt||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(f))}(e)?new _6(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Sde(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const E6="websdk_ng_install_id";function L1(){try{if(Q("INSTALL_ID"))return Q("INSTALL_ID");let e=window.localStorage.getItem(E6);return e||(e=Kg(),window.localStorage.setItem(E6,e)),Kn("INSTALL_ID",e),e}catch{return}}const Xc=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],o=n[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),x1=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let $g=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const us=function(){const e="us".concat("erna","me"),n="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let f=0;f<6;f++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[n]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=us;const BI={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},M1={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},U1="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",V1={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},dr=ot(ot(ot({},V1),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:M1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},BI),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Kn(e,n,i){var o,c,u;Xe(o=Object.keys(dr)).call(o,e)&&(!i&&Xe(c=Object.keys(Bu)).call(c,e)||(dr[e]=n,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||n!==!0||(dr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(dr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&n&&(u=!!n,dr.USE_NEW_NETWORK_CONFIG=u,u&&(dr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],dr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],dr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],dr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],dr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",dr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",dr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&n&&(dr.ENABLE_INSTANT_VIDEO=!0,dr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&n&&(dr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&n&&(dr.NEW_TURN_MODE||(dr.NEW_TURN_MODE=4))))}function Q(e){return dr[e]}x1||(dr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],dr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],dr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],dr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],dr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],dr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],dr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",dr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",dr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",dr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",dr.AREAS=["NORTH_AMERICA","OVERSEA"]);let v6=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Bu={};var an=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(an||{});let WI=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const y6=128,Tde=96,S6=1e3,Wv=10;let bde=0;var T6=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>nt,Printer:()=>Yr,parse:()=>Ye,print:()=>ht});const h=`
`,f="".concat("\r").concat(h),_=" ";let v;function y(Le){return Le>="0"&&Le<="9"}function w(Le){return Le>="!"&&Le<="~"}function I(Le){return w(Le)||Le>=""&&Le<=""}function P(Le){return Le==="!"||Le>="#"&&Le<="'"||Le>="*"&&Le<="+"||Le>="-"&&Le<="."||Le>="0"&&Le<="9"||Le>="A"&&Le<="Z"||Le>="^"&&Le<="~"}function F(Le){return Le>="1"&&Le<="9"}function x(Le){return Le>="A"&&Le<="Z"||Le>="a"&&Le<="z"}function M(Le){return Le==="d"||Le==="h"||Le==="m"||Le==="s"}function $(Le){return Le>""&&Le<"	"||Le>"\v"&&Le<"\f"||Le>""&&Le<""}function q(Le){return x(Le)||y(Le)||Le==="+"||Le==="/"}function ae(Le){return y(Le)||x(Le)||Le==="+"||Le==="/"||Le==="-"||Le==="_"}function me(Le){return x(Le)||y(Le)||Le==="+"||Le==="/"}function ge(Le,D){var ee=Object.keys(Le);if(Object.getOwnPropertySymbols){var ce=Object.getOwnPropertySymbols(Le);D&&(ce=ce.filter(function(ze){return Object.getOwnPropertyDescriptor(Le,ze).enumerable})),ee.push.apply(ee,ce)}return ee}function pe(Le){for(var D=1;D<arguments.length;D++){var ee=arguments[D]!=null?arguments[D]:{};D%2?ge(Object(ee),!0).forEach(function(ce){we(Le,ce,ee[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Le,Object.getOwnPropertyDescriptors(ee)):ge(Object(ee)).forEach(function(ce){Object.defineProperty(Le,ce,Object.getOwnPropertyDescriptor(ee,ce))})}return Le}function we(Le,D,ee){return D in Le?Object.defineProperty(Le,D,{value:ee,enumerable:!0,configurable:!0,writable:!0}):Le[D]=ee,Le}(function(Le){Le.VERSION="v",Le.ORIGIN="o",Le.SESSION_NAME="s",Le.INFORMATION="i",Le.URI="u",Le.EMAIL="e",Le.PHONE="p",Le.CONNECTION="c",Le.BANDWIDTH="b",Le.TIME="t",Le.REPEAT="r",Le.ZONE_ADJUSTMENTS="z",Le.KEY="k",Le.ATTRIBUTE="a",Le.MEDIA="m"})(v||(v={}));class Be{consumeText(D,ee){let ce=ee;for(;ce<D.length;){const ze=D[ce];if(ze==="\0"||ze==="\r"||ze===h)break;ce+=1}if(ce-ee==0)throw new Error("Invalid text, at ".concat(D));return ce}consumeUnicastAddress(D,ee,ce){return this.consumeTill(D,ee,_)}consumeOneOrMore(D,ee,ce){let ze=ee;for(;ce(D[ze]);)ze++;if(ze-ee==0)throw new Error("Invalid rule at ".concat(ee,"."));return ze}consumeSpace(D,ee){if(D[ee]===_)return ee+1;throw new Error("Invalid space at ".concat(ee,"."))}consumeIP4Address(D,ee){let ce=ee;for(let ze=0;ze<4;ze++)if(ce=this.consumeDecimalUChar(D,ce),ze!==3){if(D[ce]!==".")throw new Error("Invalid IP4 address.");ce++}return ce}consumeDecimalUChar(D,ee){let ce=ee;for(let Ft=0;Ft<3&&y(D[ce]);Ft++,ce++);if(ce-ee==0)throw new Error("Invalid decimal uchar.");const ze=parseInt(D.slice(ee,ce));if(ze>=0&&ze<=255)return ce;throw new Error("Invalid decimal uchar")}consumeIP6Address(D,ee){let ce=this.consumeHexpart(D,ee);return D[ce]===":"&&(ce+=1,ce=this.consumeIP4Address(D,ce)),ce}consumeHexpart(D,ee){let ce=ee;if(D[ce]===":"&&D[ce+1]===":"){ce+=2;try{ce=this.consumeHexseq(D,ce)}catch{}return ce}if(ce=this.consumeHexseq(D,ce),D[ce]===":"&&D[ce+1]===":"){ce+=2;try{ce=this.consumeHexseq(D,ce)}catch{}return ce}return ce}consumeHexseq(D,ee){let ce=ee;for(;ce=this.consumeHex4(D,ce),D[ce]===":"&&D[ce+1]!==":";)ce+=1;return ce}consumeHex4(D,ee){let ce=0;for(;ce<4;ce++)if(!((ze=D[ee+ce])>="0"&&ze<="9"||ze>="a"&&ze<="f"||ze>="A"&&ze<="F")){if(ce===0)throw new Error("Invalid hex 4");break}var ze;return ee+ce}consumeFQDN(D,ee){let ce=ee;for(;y(D[ce])||x(D[ce])||D[ce]==="-"||D[ce]===".";)ce+=1;if(ce-ee<4)throw new Error("Invalid FQDN");return ce}consumeExtnAddr(D,ee){return this.consumeOneOrMore(D,ee,I)}consumeMulticastAddress(D,ee,ce){switch(ce){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(D,ee);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(D,ee);default:try{return this.consumeFQDN(D,ee)}catch{return this.consumeExtnAddr(D,ee)}}}consumeIP6MulticastAddress(D,ee){const ce=this.consumeHexpart(D,ee);return D[ce]==="/"?this.consumeInteger(D,ce+1):ce}consumeIP4MulticastAddress(D,ee){let ce=ee+3;const ze=D.slice(ee,ce),Ft=parseInt(ze);if(Ft<224||Ft>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Jn=0;Jn<3;Jn++){if(D[ce]!==".")throw new Error("Invalid IP4 multicast address.");ce+=1,ce=this.consumeDecimalUChar(D,ce)}return D[ce]==="/"&&(ce+=1),ce=this.consumeTTL(D,ce),D[ce]==="/"&&(ce=this.consumeInteger(D,ce)),ce}consumeInteger(D,ee){if(!F(D[ee]))throw new Error("Invalid integer.");for(ee+=1;y(D[ee]);)ee+=1;return ee}consumeTTL(D,ee){if(D[ee]==="0")return ee+1;if(!F(D[ee]))throw new Error("Invalid TTL.");ee+=1;for(let ce=0;ce<2&&y(D[ee]);ce++)ee+=1;return ee}consumeToken(D,ee){return this.consumeOneOrMore(D,ee,P)}consumeTime(D,ee){let ce=ee;if(D[ce]==="0")return ce+1;for(F(D[ce])&&(ce+=1);y(D[ce]);)ce++;if(ce-ee<10)throw new Error("Invalid time");return ce}consumeAddress(D,ee){return this.consumeTill(D,ee,_)}consumeTypedTime(D,ee){let ce=ee;return ce=this.consumeOneOrMore(D,ce,y),M(D[ce])?ce+1:ce}consumeRepeatInterval(D,ee){if(!F(D[ee]))throw new Error("Invalid repeat interval");for(ee+=1;y(D[ee]);)ee+=1;return M(D[ee])&&(ee+=1),ee}consumePort(D,ee){return this.consumeOneOrMore(D,ee,y)}consume(D,ee,ce){for(let ze=0;ze<ce.length;ze++){if(ee+ze>=D.length)throw new Error("consume exceeding value length");if(D[ee+ze]!==ce[ze])throw new Error("consume ".concat(ce," failed at ").concat(ze))}return ee+ce.length}consumeTill(D,ee,ce){let ze=ee;for(;ze<D.length&&(typeof ce!="string"||D[ze]!==ce)&&(typeof ce!="function"||!ce(D[ze]));)ze++;return ze}}class nt extends Be{constructor(){super(),we(this,"records",[]),we(this,"currentLine",0)}parse(D){const ee=this.probeEOL(D);this.records=D.split(ee).filter(__=>!!Fs(__).call(__)).map(this.parseLine),this.currentLine=0;const ce=this.parseVersion(),ze=this.parseOrigin(),Ft=this.parseSessionName(),Jn=this.parseInformation(),Oi=this.parseUri(),ha=this.parseEmail(),bp=this.parsePhone(),g_=this.parseConnection(),sb=this.parseBandWidth(),ZA=this.parseTimeFields(),eO=this.parseKey(),il=this.parseSessionAttribute(),lm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ce,origin:ze,sessionName:Ft,information:Jn,uri:Oi,emails:ha,phones:bp,connection:g_,bandwidths:sb,timeFields:ZA,key:eO,attributes:il,mediaDescriptions:lm}}getCurrentRecord(){const D=this.records[this.currentLine];if(!D)throw new Error("Record doesn't exit.");return D}probeEOL(D){for(let ee=0;ee<D.length;ee++)if(D[ee]===h)return D[ee-1]==="\r"?f:h;throw new Error("Invalid newline character.")}parseLine(D,ee){if(D.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ce=D[0];if(D[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ce,value:D.slice(2),line:ee,cur:0}}parseSessionAttribute(){const D=new dn;for(;this.currentLine<this.records.length;){const ee=this.getCurrentRecord();if(ee.type!==v.ATTRIBUTE)break;const ce={attField:this.extractOneOrMore(ee,ze=>P(ze)&&ze!==":"),_cur:0};ee.value[ee.cur]===":"&&(ee.cur+=1,ce.attValue=this.extractOneOrMore(ee,$)),D.parse(ce),this.currentLine++}return D.digest()}parseMediaAttributes(D){const ee=new hn(D);for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.ATTRIBUTE)break;const ze={attField:this.extractOneOrMore(ce,Ft=>P(Ft)&&Ft!==":"),_cur:0};ce.value[ce.cur]===":"&&(ce.cur+=1,ze.attValue=this.extractOneOrMore(ce,$)),ee.parse(ze),this.currentLine++}return ee.digest()}parseKey(){const D=this.getCurrentRecord();if(D.type===v.KEY){if(D.value==="prompt"||D.value==="clear:"||D.value==="base64:"||D.value==="uri:")return D.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const D=this.getCurrentRecord();if(D.type===v.ZONE_ADJUSTMENTS){const ee=[];for(;;)try{const ce=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);let ze=!1;D.value[D.cur]==="-"&&(ze=!0,D.cur+=1);const Ft=this.extract(D,this.consumeTypedTime);ee.push({time:ce,typedTime:Ft,back:ze})}catch{break}if(ee.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ee}return[]}parseRepeat(){const D=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==v.REPEAT)break;{const ce=this.extract(ee,this.consumeRepeatInterval),ze=this.parseTypedTime(ee);D.push({repeatInterval:ce,typedTimes:ze}),this.currentLine++}}return D}parseTypedTime(D){const ee=[];for(;;)try{this.consumeSpaceForRecord(D),ee.push(this.extract(D,this.consumeTypedTime))}catch{break}if(ee.length===0)throw new Error("Invalid typed time.");return ee}parseTime(){const D=this.getCurrentRecord(),ee=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);const ce=this.extract(D,this.consumeTime);return this.currentLine++,{startTime:ee,stopTime:ce}}parseBandWidth(){const D=[];for(;this.currentLine<this.records.length;){const ee=this.getCurrentRecord();if(ee.type!==v.BANDWIDTH)break;{const ce=this.extractOneOrMore(ee,P);if(ee.value[ee.cur]!==":")throw new Error("Invalid bandwidth field.");ee.cur++;const ze=this.extractOneOrMore(ee,y);D.push({bwtype:ce,bandwidth:ze}),this.currentLine++}}return D}parseVersion(){const D=this.getCurrentRecord();if(D.type!==v.VERSION)throw new Error("first sdp record must be version");const ee=D.value.slice(0,this.consumeOneOrMore(D.value,0,y));if(ee.length!==D.value.length)throw new Error('invalid proto version, "v='.concat(D.value,'"'));return this.currentLine++,ee}parseOrigin(){const D=this.getCurrentRecord();if(D.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ee=this.extractOneOrMore(D,I);this.consumeSpaceForRecord(D);const ce=this.extractOneOrMore(D,y);this.consumeSpaceForRecord(D);const ze=this.extractOneOrMore(D,y);this.consumeSpaceForRecord(D);const Ft=this.extractOneOrMore(D,P);this.consumeSpaceForRecord(D);const Jn=this.extractOneOrMore(D,P);this.consumeSpaceForRecord(D);const Oi=this.extract(D,this.consumeUnicastAddress);return this.currentLine++,{username:ee,sessId:ce,sessVersion:ze,nettype:Ft,addrtype:Jn,unicastAddress:Oi}}parseSessionName(){const D=this.getCurrentRecord();if(D.type===v.SESSION_NAME){const ee=this.extract(D,this.consumeText);return this.currentLine++,ee}}parseInformation(){const D=this.getCurrentRecord();if(D.type!==v.INFORMATION)return;const ee=this.extract(D,this.consumeText);return this.currentLine++,ee}parseUri(){const D=this.getCurrentRecord();if(D.type===v.URI)return this.currentLine++,D.value}parseEmail(){const D=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==v.EMAIL)break;D.push(ee.value),this.currentLine++}return D}parsePhone(){const D=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==v.PHONE)break;D.push(ee.value),this.currentLine++}return D}parseConnection(){const D=this.getCurrentRecord();if(D.type===v.CONNECTION){const ee=this.extractOneOrMore(D,P);this.consumeSpaceForRecord(D);const ce=this.extractOneOrMore(D,P);this.consumeSpaceForRecord(D);const ze=this.extract(D,this.consumeAddress);return this.currentLine++,{nettype:ee,addrtype:ce,address:ze}}}parseMedia(){const D=this.getCurrentRecord(),ee=this.extract(D,this.consumeToken);this.consumeSpaceForRecord(D);let ce=this.extract(D,this.consumePort);D.value[D.cur]==="/"&&(D.cur+=1,ce+=this.extract(D,this.consumeInteger)),this.consumeSpaceForRecord(D);const ze=[];for(ze.push(this.extract(D,this.consumeToken));D.value[D.cur]==="/";)D.cur+=1,ze.push(this.extract(D,this.consumeToken));if(ze.length===0)throw new Error("Invalid proto");const Ft=this.parseFmt(D);return this.currentLine++,{mediaType:ee,port:ce,protos:ze,fmts:Ft}}parseTimeFields(){const D=[];for(;this.getCurrentRecord().type===v.TIME;){const ee=this.parseTime(),ce=this.parseRepeat(),ze=this.parseZone();D.push({time:ee,repeats:ce,zones:ze})}return D}parseMediaDescription(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ee=this.parseMedia(),ce=this.parseInformation(),ze=this.parseConnections(),Ft=this.parseBandWidth(),Jn=this.parseKey(),Oi=this.parseMediaAttributes(ee);D.push({media:ee,information:ce,connections:ze,bandwidths:Ft,key:Jn,attributes:Oi})}return D}parseConnections(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)D.push(this.parseConnection());return D}parseFmt(D){const ee=[];for(;;)try{this.consumeSpaceForRecord(D),ee.push(this.extract(D,this.consumeToken))}catch{break}if(ee.length===0)throw new Error("Invalid fmts");return ee}extract(D,ee){for(var ce=arguments.length,ze=new Array(ce>2?ce-2:0),Ft=2;Ft<ce;Ft++)ze[Ft-2]=arguments[Ft];const Jn=ee.call(this,D.value,D.cur,...ze),Oi=D.value.slice(D.cur,Jn);return D.cur=Jn,Oi}extractOneOrMore(D,ee){const ce=this.consumeOneOrMore(D.value,D.cur,ee),ze=D.value.slice(D.cur,ce);return D.cur=ce,ze}consumeSpaceForRecord(D){if(D.value[D.cur]!==_)throw new Error("Invalid space at ".concat(D.cur,"."));D.cur+=1}}class st extends Be{constructor(){super(...arguments),we(this,"attributes",void 0),we(this,"digested",!1)}extractOneOrMore(D,ee,ce){const ze=this.consumeOneOrMore(D.attValue,D._cur,ee),Ft=D.attValue.slice(D._cur,ze),[Jn,Oi]=ce||[];if(typeof Jn=="number"&&Ft.length<Jn)throw new Error("error in length, should be more or equal than ".concat(Jn," characters."));if(typeof Oi=="number"&&Ft.length>Oi)throw new Error("error in length, should be less or equal than ".concat(Oi," characters."));return D._cur=ze,Ft}consumeAttributeSpace(D){if(D.attValue[D._cur]!==_)throw new Error("Invalid space at ".concat(D._cur,"."));D._cur+=1}extract(D,ee){if(!D.attValue)throw new Error("Nothing to extract from attValue.");for(var ce=arguments.length,ze=new Array(ce>2?ce-2:0),Ft=2;Ft<ce;Ft++)ze[Ft-2]=arguments[Ft];const Jn=ee.call(this,D.attValue,D._cur,...ze),Oi=D.attValue.slice(D._cur,Jn);return D._cur=Jn,Oi}atEnd(D){if(!D.attValue)throw new Error;return D._cur>=D.attValue.length}peekChar(D){if(!D.attValue)throw new Error;return D.attValue[D._cur]}peek(D,ee){if(!D.attValue)throw new Error;for(let ce=0;ce<ee.length;ce++)if(ee[ce]!==D.attValue[D._cur+ce])return!1;return!0}parseIceUfrag(D){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(D,q,[4,256])}parseIcePwd(D){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(D,q,[22,256])}parseIceOptions(D){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ee=[];for(;!this.atEnd(D);){ee.push(this.extractOneOrMore(D,q));try{this.consumeAttributeSpace(D)}catch(ce){if(this.atEnd(D))break;throw ce}}this.attributes.iceOptions=ee}parseFingerprint(D){const ee=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ce=this.extract(D,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ee,fingerprint:ce})}parseExtmap(D){const ee=this.extractOneOrMore(D,y);let ce;this.peekChar(D)==="/"&&(this.extract(D,this.consume,"/"),ce=this.extract(D,this.consumeToken)),this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeTill,_),Ft=pe(pe({entry:parseInt(ee,10)},ce&&{direction:ce}),{},{extensionName:ze});this.peekChar(D)===_&&(this.consumeAttributeSpace(D),Ft.extensionAttributes=this.extract(D,this.consumeTill)),this.attributes.extmaps.push(Ft)}parseSetup(D){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ee=this.extract(D,this.consumeTill);if(ee!=="active"&&ee!=="passive"&&ee!=="actpass"&&ee!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ee}}class dn extends st{constructor(){super(...arguments),we(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"group":this.parseGroup(D);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"fingerprint":this.parseFingerprint(D);break;case"setup":this.parseSetup(D);break;case"tls-id":this.parseTlsId(D);break;case"identity":this.parseIdentity(D);break;case"extmap":this.parseExtmap(D);break;case"msid-semantic":this.parseMsidSemantic(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(ee){throw console.error("parsing session attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),ee}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(D){const ee=this.extract(D,this.consumeToken),ce=[];for(;!this.atEnd(D)&&this.peekChar(D)===_;)this.consumeAttributeSpace(D),ce.push(this.extract(D,this.consumeToken));this.attributes.groups.push({semantic:ee,identificationTag:ce})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(D){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(D,ae)}parseIdentity(D){const ee=this.extractOneOrMore(D,me),ce=[];for(;!this.atEnd(D)&&this.peekChar(D)===_;){this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeToken);this.extract(D,this.consume,"=");const Ft=this.extractOneOrMore(D,Jn=>Jn!==_&&$(Jn));ce.push({name:ze,value:Ft})}this.attributes.identities.push({assertionValue:ee,extensions:ce})}parseMsidSemantic(D){this.peekChar(D)===_&&this.consumeAttributeSpace(D);const ee={semantic:this.extract(D,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(D)}catch{break}if(this.peekChar(D)==="*"){this.extract(D,this.consume,"*"),ee.applyForAll=!0;break}{const ce=this.extract(D,this.consumeTill,_);ee.identifierList.push(ce)}}this.attributes.msidSemantic=ee}}class hn extends st{constructor(D){super(),we(this,"attributes",void 0),D.protos.indexOf("RTP")!==-1||D.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"extmap":this.parseExtmap(D);break;case"setup":this.parseSetup(D);break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"candidate":this.parseCandidate(D);break;case"remote-candidate":this.parseRemoteCandidate(D);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(D);break;case"rtpmap":this.parseRtpmap(D);break;case"ptime":this.parsePtime(D);break;case"maxptime":this.parseMaxPtime(D);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(D);break;case"ssrc":this.parseSSRC(D);break;case"fmtp":this.parseFmtp(D);break;case"rtcp-fb":this.parseRtcpFb(D);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(D);break;case"mid":this.parseMid(D);break;case"msid":this.parseMsid(D);break;case"imageattr":this.parseImageAttr(D);break;case"rid":this.parseRid(D);break;case"simulcast":this.parseSimulcast(D);break;case"sctp-port":this.parseSctpPort(D);break;case"max-message-size":this.parseMaxMessageSize(D);break;case"ssrc-group":this.parseSSRCGroup(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(ee){throw console.error("parsing media attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),ee}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}parseCandidate(D){const ee=this.extractOneOrMore(D,q,[1,32]);this.consumeAttributeSpace(D);const ce=this.extractOneOrMore(D,y,[1,5]);this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const Ft=this.extractOneOrMore(D,y,[1,10]);this.consumeAttributeSpace(D);const Jn=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const Oi=this.extract(D,this.consumePort);this.consumeAttributeSpace(D),this.extract(D,this.consume,"typ"),this.consumeAttributeSpace(D);const ha={foundation:ee,componentId:ce,transport:ze,priority:Ft,connectionAddress:Jn,port:Oi,type:this.extract(D,this.consumeToken),extension:{}};for(this.peek(D," raddr")&&(this.extract(D,this.consume," raddr"),this.consumeAttributeSpace(D),ha.relAddr=this.extract(D,this.consumeAddress)),this.peek(D," rport")&&(this.extract(D,this.consume," rport"),this.consumeAttributeSpace(D),ha.relPort=this.extract(D,this.consumePort));this.peekChar(D)===_;){this.consumeAttributeSpace(D);const bp=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D),ha.extension[bp]=this.extractOneOrMore(D,w)}this.attributes.candidates.push(ha)}parseRemoteCandidate(D){const ee=[];for(;;){const ce=this.extractOneOrMore(D,y,[1,5]);this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const Ft=this.extract(D,this.consumePort);ee.push({componentId:ce,connectionAddress:ze,port:Ft});try{this.consumeAttributeSpace(D)}catch{break}}this.attributes.remoteCandidatesList.push(ee)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(D){const ee=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ce=this.extract(D,this.consumeTill,"/");this.extract(D,this.consume,"/");const ze={encodingName:ce,clockRate:this.extractOneOrMore(D,y)};this.atEnd(D)||this.peekChar(D)!=="/"||(this.extract(D,this.consume,"/"),ze.encodingParameters=parseInt(this.extract(D,this.consumeTill),10));const Ft=this.attributes.payloads.find(Jn=>Jn.payloadType===parseInt(ee,10));Ft?Ft.rtpMap=ze:this.attributes.payloads.push({payloadType:parseInt(ee,10),rtpMap:ze,rtcpFeedbacks:[]})}parsePtime(D){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(D,this.consumeTill)}parseMaxPtime(D){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(D,this.consumeTill)}parseDirection(D){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=D.attField}parseSSRC(D){const ee=this.extractOneOrMore(D,y);this.consumeAttributeSpace(D);const ce=this.extract(D,this.consumeTill,":");let ze;this.peekChar(D)===":"&&(this.extract(D,this.consume,":"),ze=this.extract(D,this.consumeTill));const Ft=this.attributes.ssrcs.find(Jn=>Jn.ssrcId===parseInt(ee,10));Ft?Ft.attributes[ce]=ze:this.attributes.ssrcs.push({ssrcId:parseInt(ee,10),attributes:{[ce]:ze}})}parseFmtp(D){const ee=this.extract(D,this.consumeTill,_);this.consumeAttributeSpace(D);const ce=this.extract(D,this.consumeTill),ze={};ce.split(";").forEach(Jn=>{let[Oi,ha]=Jn.split("=");Oi=Fs(Oi).call(Oi);const bp=typeof ha=="string"?Fs(ha).call(ha):null;typeof Oi=="string"&&Oi.length>0&&(ze[Oi]=bp)});const Ft=this.attributes.payloads.find(Jn=>Jn.payloadType===parseInt(ee,10));Ft?Ft.fmtp={parameters:ze}:this.attributes.payloads.push({payloadType:parseInt(ee,10),rtcpFeedbacks:[],fmtp:{parameters:ze}})}parseFmtParameters(D){const ee={},ce=this.extract(D,this.consumeTill,"=");D._cur++;const ze=this.extract(D,this.consumeTill,";");for(ee[ce]=ze;D.attValue[D._cur]===";";){const Ft=this.extract(D,this.consumeTill,"=");D._cur++;const Jn=this.extract(D,this.consumeTill,";");ee[Ft]=Jn}return ee}parseRtcpFb(D){let ee="";ee=this.peekChar(D)==="*"?this.extract(D,this.consume,"*"):this.extract(D,this.consumeTill,_),this.consumeAttributeSpace(D);const ce=this.extract(D,this.consumeTill,_);let ze;if(ce==="trr-int")ze={type:ce,interval:this.extract(D,this.consumeTill)};else{const Ft={type:ce};this.peekChar(D)===_&&(this.consumeAttributeSpace(D),Ft.parameter=this.extract(D,this.consumeToken),this.peekChar(D)===_&&(Ft.additional=this.extract(D,this.consumeTill))),ze=Ft}if(ee==="*")this.attributes.rtcpFeedbackWildcards.push(ze);else{const Ft=this.attributes.payloads.find(Jn=>Jn.payloadType===parseInt(ee,10));Ft?Ft.rtcpFeedbacks.push(ze):this.attributes.payloads.push({payloadType:parseInt(ee,10),rtcpFeedbacks:[ze]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(D){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ee={port:this.extract(D,this.consumePort)};this.peekChar(D)===_&&(this.consumeAttributeSpace(D),ee.netType=this.extractOneOrMore(D,P),this.consumeAttributeSpace(D),ee.addressType=this.extractOneOrMore(D,P),this.consumeAttributeSpace(D),ee.address=this.extract(D,this.consumeAddress)),this.attributes.rtcp=ee}parseMsid(D){const ee={id:this.extractOneOrMore(D,P,[1,64])};this.peekChar(D)===_&&(this.consumeAttributeSpace(D),ee.appdata=this.extractOneOrMore(D,P,[1,64])),this.attributes.msids.push(ee)}parseImageAttr(D){this.attributes.imageattr.push(D.attValue)}parseRid(D){const ee=this.extractOneOrMore(D,ze=>x(ze)||y(ze)||ze==="_"||ze==="-");this.consumeAttributeSpace(D);const ce={id:ee,direction:this.extract(D,this.consumeToken),params:[]};if(this.peekChar(D)===_){if(this.consumeAttributeSpace(D),this.peek(D,"pt=")){this.extract(D,this.consume,"pt=");const ze=[];for(;;){const Ft=this.extract(D,this.consumeToken);ze.push(Ft);try{this.extract(D,this.consume,",")}catch{break}}ce.payloads=ze,this.peekChar(D)===_&&this.extract(D,this.consume,_)}for(;;){const ze=this.extract(D,this.consumeToken);switch(ze){case"depend":{const Ft={type:ze,rids:this.extract(D,this.consume,"=").split(",")};ce.params.push(Ft);break}default:{const Ft={type:ze};this.peekChar(D)==="="&&(this.extract(D,this.consume,"="),Ft.val=this.extract(D,this.consumeTill,";")),ce.params.push(Ft)}}try{this.extract(D,this.consume,";")}catch{break}}}this.attributes.rids.push(ce)}parseSimulcast(D){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=D.attValue,this.extract(D,this.consumeTill)}parseSctpPort(D){this.attributes.sctpPort=this.extractOneOrMore(D,y,[1,5])}parseMaxMessageSize(D){this.attributes.maxMessageSize=this.extractOneOrMore(D,y,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(D){this.attributes.mid=this.extract(D,this.consumeToken)}parseSSRCGroup(D){const ee=this.extract(D,this.consumeToken),ce=[];for(;;)try{this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeInteger);ce.push(parseInt(ze,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ee,ssrcIds:ce})}}function ir(Le,D,ee){return D in Le?Object.defineProperty(Le,D,{value:ee,enumerable:!0,configurable:!0,writable:!0}):Le[D]=ee,Le}class Yr{constructor(){ir(this,"eol",f)}print(D,ee){let ce="";return ee&&(this.eol=ee),ce+=this.printVersion(D.version),ce+=this.printOrigin(D.origin),ce+=this.printSessionName(D.sessionName),ce+=this.printInformation(D.information),ce+=this.printUri(D.uri),ce+=this.printEmail(D.emails),ce+=this.printPhone(D.phones),ce+=this.printConnection(D.connection),ce+=this.printBandwidth(D.bandwidths),ce+=this.printTimeFields(D.timeFields),ce+=this.printKey(D.key),ce+=this.printSessionAttributes(D.attributes),ce+=this.printMediaDescription(D.mediaDescriptions),ce}printVersion(D){return"v=".concat(D).concat(this.eol)}printOrigin(D){return"o=".concat(D.username," ").concat(D.sessId," ").concat(D.sessVersion," ").concat(D.nettype," ").concat(D.addrtype," ").concat(D.unicastAddress).concat(this.eol)}printSessionName(D){return D?"s=".concat(D).concat(this.eol):""}printInformation(D){return D?"i=".concat(D).concat(this.eol):""}printUri(D){return D?"u=".concat(D).concat(this.eol):""}printEmail(D){let ee="";for(const ce of D)ee+="e=".concat(ce).concat(this.eol);return ee}printPhone(D){let ee="";for(const ce of D)ee+="e=".concat(ce).concat(this.eol);return ee}printConnection(D){return D?"c=".concat(D.nettype," ").concat(D.addrtype," ").concat(D.address).concat(this.eol):""}printBandwidth(D){let ee="";for(const ce of D)ee+="b=".concat(ce.bwtype,":").concat(ce.bandwidth).concat(this.eol);return ee}printTimeFields(D){let ee="";for(const ce of D){ee+="t=".concat(ce.time.startTime," ").concat(ce.time.startTime).concat(this.eol);for(const ze of ce.repeats)ee+="r=".concat(ze.repeatInterval," ").concat(ze.typedTimes.join(" ")).concat(this.eol);ce.zoneAdjustments&&(ee+="z=",ee+="z=".concat(ce.zoneAdjustments.map(ze=>"".concat(ze.time," ").concat(ze.back?"-":""," ").concat(ze.typedTime)).join(" ")).concat(this.eol),ee+=this.eol)}return ee}printKey(D){return D?"k=".concat(D).concat(this.eol):""}printAttributes(D){let ee="";for(const ce of D)ee+="a=".concat(ce.attField).concat(ce.attValue?":".concat(ce.attValue):"").concat(this.eol);return ee}printMediaDescription(D){let ee="";for(const ce of D)ee+=this.printMedia(ce.media),ee+=this.printInformation(ce.information),ee+=this.printConnections(ce.connections),ee+=this.printBandwidth(ce.bandwidths),ee+=this.printKey(ce.key),ee+=this.printMediaAttributes(ce);return ee}printConnections(D){let ee="";for(const ce of D)ee+=this.printConnection(ce);return ee}printMedia(D){return"m=".concat(D.mediaType," ").concat(D.port," ").concat(D.protos.join("/")," ").concat(D.fmts.join(" ")).concat(this.eol)}printSessionAttributes(D){return new Fo(this.eol).print(D)}printMediaAttributes(D){return new ke(this.eol).print(D)}}class Vr{constructor(D){ir(this,"eol",void 0),this.eol=D}printIceUfrag(D){return D===void 0?"":"a=ice-ufrag:".concat(D).concat(this.eol)}printIcePwd(D){return D===void 0?"":"a=ice-pwd:".concat(D).concat(this.eol)}printIceOptions(D){return D===void 0?"":"a=ice-options:".concat(D.join(_)).concat(this.eol)}printFingerprints(D){return D.length>0?D.map(ee=>"a=fingerprint:".concat(ee.hashFunction).concat(_).concat(ee.fingerprint)).join(this.eol)+this.eol:""}printExtmap(D){return D.map(ee=>"a=extmap:".concat(ee.entry).concat(ee.direction?"/".concat(ee.direction):"").concat(_).concat(ee.extensionName).concat(ee.extensionAttributes?"".concat(_).concat(ee.extensionAttributes):"").concat(this.eol)).join("")}printSetup(D){return D===void 0?"":"a=setup:".concat(D).concat(this.eol)}printUnrecognized(D){return D.map(ee=>"a=".concat(ee.attField).concat(ee.attValue?":".concat(ee.attValue):"").concat(this.eol)).join("")}}class Fo extends Vr{print(D){let ee="";return ee+=this.printGroups(D.groups),ee+=this.printMsidSemantic(D.msidSemantic),ee+=this.printIceLite(D.iceLite),ee+=this.printIceUfrag(D.iceUfrag),ee+=this.printIcePwd(D.icePwd),ee+=this.printIceOptions(D.iceOptions),ee+=this.printFingerprints(D.fingerprints),ee+=this.printSetup(D.setup),ee+=this.printTlsId(D.tlsId),ee+=this.printIdentity(D.identities),ee+=this.printExtmap(D.extmaps),ee+=this.printUnrecognized(D.unrecognized),ee}printGroups(D){let ee="";return D.length>0&&(ee+=D.map(ce=>"a=group:".concat(ce.semantic).concat(ce.identificationTag.map(ze=>"".concat(_).concat(ze)).join("")).concat(this.eol)).join("")),ee}printIceLite(D){return D===void 0?"":"a=ice-lite"+this.eol}printTlsId(D){return D?"a=tls-id:".concat(D).concat(this.eol):""}printIdentity(D){return D.length===0?"":D.map(ee=>"a=identity:".concat(ee.assertionValue).concat(ee.extensions.map(ce=>"".concat(_).concat(ce.name).concat(ce.value?"=".concat(ce.value):"")))).join(this.eol)+this.eol}printMsidSemantic(D){if(!D)return"";let ee="a=msid-semantic:".concat(D.semantic);return D.applyForAll?ee+="".concat(_,"*"):D.identifierList.length>0&&(ee+=D.identifierList.map(ce=>"".concat(_).concat(ce))),ee+this.eol}}class ke extends Vr{print(D){const ee=D.attributes;let ce="";return ce+=this.printRTCP(ee.rtcp),ce+=this.printIceUfrag(ee.iceUfrag),ce+=this.printIcePwd(ee.icePwd),ce+=this.printIceOptions(ee.iceOptions),ce+=this.printCandidates(ee.candidates),ce+=this.printRemoteCandidatesList(ee.remoteCandidatesList),ce+=this.printEndOfCandidates(ee.endOfCandidates),ce+=this.printFingerprints(ee.fingerprints),ce+=this.printSetup(ee.setup),ce+=this.printMid(ee.mid),ce+=this.printExtmap(ee.extmaps),ce+=this.printRTPRelated(ee),ce+=this.printPtime(ee.ptime),ce+=this.printMaxPtime(ee.maxPtime),ce+=this.printDirection(ee.direction),ce+=this.printSSRCGroups(ee.ssrcGroups),ce+=this.printSSRC(ee.ssrcs),ce+=this.printRTCPMux(ee.rtcpMux),ce+=this.printRTCPMuxOnly(ee.rtcpMuxOnly),ce+=this.printRTCPRsize(ee.rtcpRsize),ce+=this.printMSId(ee.msids),ce+=this.printImageattr(ee.imageattr),ce+=this.printRid(ee.rids),ce+=this.printSimulcast(ee.simulcast),ce+=this.printSCTPPort(ee.sctpPort),ce+=this.printMaxMessageSize(ee.maxMessageSize),ce+=this.printUnrecognized(ee.unrecognized),ce}printCandidates(D){return D.map(ee=>"a=candidate:".concat(ee.foundation).concat(_).concat(ee.componentId).concat(_).concat(ee.transport).concat(_).concat(ee.priority).concat(_).concat(ee.connectionAddress).concat(_).concat(ee.port).concat(_,"typ").concat(_).concat(ee.type).concat(ee.relAddr?"".concat(_,"raddr").concat(_).concat(ee.relAddr):"").concat(ee.relPort?"".concat(_,"rport").concat(_).concat(ee.relPort):"").concat(Object.keys(ee.extension).map(ce=>"".concat(_).concat(ce).concat(_).concat(ee.extension[ce])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(D){return D.map(ee=>"a=remote-candidates:".concat(ee.join(_)).concat(this.eol)).join("")}printEndOfCandidates(D){return D===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(D){if(!D.payloads)return"";const ee=D.payloads;let ce="";ce+=D.rtcpFeedbackWildcards.map(ze=>this.printRTCPFeedback("*",ze)).join("");for(const ze of ee)ce+=this.printRtpMap(ze.payloadType,ze.rtpMap),ce+=this.printFmtp(ze.payloadType,ze.fmtp),ce+=ze.rtcpFeedbacks.map(Ft=>this.printRTCPFeedback(ze.payloadType,Ft)).join("");return ce}printFmtp(D,ee){if(!ee)return"";const ce=Object.keys(ee.parameters);return ce.length===1&&ee.parameters[ce[0]]===null?"a=fmtp:".concat(D).concat(_).concat(ce[0]).concat(this.eol):"a=fmtp:".concat(D).concat(_).concat(Object.keys(ee.parameters).map(ze=>"".concat(ze,"=").concat(ee.parameters[ze])).join(";")).concat(this.eol)}printRtpMap(D,ee){return ee?"a=rtpmap:".concat(D).concat(_).concat(ee.encodingName,"/").concat(ee.clockRate).concat(ee.encodingParameters?"/".concat(ee.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(D,ee){let ce="a=rtcp-fb:".concat(D).concat(_),ze=ee;return ze.type==="trr-int"?ce+="ttr-int".concat(_).concat(ze.interval):(ce+="".concat(ze.type),ze.parameter&&(ce+="".concat(_).concat(ze.parameter),ze.additional&&(ce+="".concat(_).concat(ze.additional)))),ce+this.eol}printPtime(D){return D===void 0?"":"a=ptime:".concat(D).concat(this.eol)}printMaxPtime(D){return D===void 0?"":"a=maxptime:".concat(D).concat(this.eol)}printDirection(D){return D===void 0?"":"a=".concat(D).concat(this.eol)}printSSRC(D){return D.map(ee=>Object.keys(ee.attributes).map(ce=>"a=ssrc:".concat(ee.ssrcId.toString(10)).concat(_).concat(ce).concat(ee.attributes[ce]?":".concat(ee.attributes[ce]):"").concat(this.eol)).join("")).join("")}printRTCPMux(D){return D===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(D){return D===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(D){return D===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(D){if(D===void 0)return"";let ee="a=rtcp:".concat(D.port);return D.netType&&(ee+="".concat(_).concat(D.netType)),D.addressType&&(ee+="".concat(_).concat(D.addressType)),D.address&&(ee+="".concat(_).concat(D.address)),ee+this.eol}printMSId(D){return D.map(ee=>"a=msid:".concat(ee.id).concat(ee.appdata?"".concat(_).concat(ee.appdata):"").concat(this.eol)).join("")}printImageattr(D){return D.map(ee=>"a=imageattr:".concat(ee).concat(this.eol)).join("")}printRid(D){return D.map(ee=>{let ce="a=rid:".concat(ee.id).concat(_).concat(ee.direction);return ee.payloads&&(ce+="".concat(_,"pt=").concat(ee.payloads.join(","))),ee.params.length>0&&(ce+="".concat(_).concat(ee.params.map(ze=>ze.type==="depend"?"depend=".concat(ze.rids.join(",")):"".concat(ze.type,"=").concat(ze.val)).join(";"))),ce+this.eol}).join("")}printSimulcast(D){return D===void 0?"":"a=simulcast:".concat(D).concat(this.eol)}printSCTPPort(D){return D===void 0?"":"a=sctp-port:".concat(D).concat(this.eol)}printMaxMessageSize(D){return D===void 0?"":"a=max-message-size:".concat(D).concat(this.eol)}printMid(D){return D===void 0?"":"a=mid:".concat(D).concat(this.eol)}printSSRCGroups(D){return D.map(ee=>"a=ssrc-group:".concat(ee.semantic).concat(ee.ssrcIds.map(ce=>"".concat(_).concat(ce.toString(10))).join("")).concat(this.eol)).join("")}}function Ye(Le){return new nt().parse(Le)}function ht(Le,D){return new Yr().print(Le,D)}}},n={};function i(o){if(n[o])return n[o].exports;var c=n[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function ca(e){return T6.parse(e)}function Kf(e,n){return T6.print(e,n)}var wde=Ia("Array").keys,Rde=Za,Cde=li,Ide=k,Ade=wde,F1=Array.prototype,Ode={DOMTokenList:!0,NodeList:!0},Pde=function(e){var n=e.keys;return e===F1||Ide(F1,e)&&n===F1.keys||Cde(Ode,Rde(e))?Ade:n},fc=l(Pde);function b6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Yt(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?b6(Object(i),!0).forEach(function(o){Lr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):b6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Lr(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var _=f.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const w6=new class extends Rr{constructor(){super(...arguments),Lr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:n}=e;n[n.length-1]&&n[n.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=n[n.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Nde{constructor(n){Lr(this,"logger",void 0),Lr(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function j1(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function R6(){const e=new Date,n=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return n?(n==null?void 0:n[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Jc={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},GI=Date.now(),b0=e=>{for(const n in Jc)if(Object.prototype.hasOwnProperty.call(Jc,n)&&Jc[n]===e)return n;return"DEFAULT"},N=new class{constructor(){Lr(this,"proxyServerURL",void 0),Lr(this,"logLevel",Jc.DEBUG),Lr(this,"uploadState","collecting"),Lr(this,"uploadLogWaitingList",[]),Lr(this,"uploadLogUploadingList",[]),Lr(this,"uploadErrorCount",0),Lr(this,"currentLogID",0),Lr(this,"url",void 0),Lr(this,"extLog",(e,n)=>{this.appendLogToWaitingList(e,...n)})}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Jc.DEBUG].concat(n);this.log.apply(this,o)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Jc.INFO].concat(n);this.log.apply(this,o)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Jc.WARNING].concat(n);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Jc.ERROR].concat(n);this.log.apply(this,o)}upload(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[Jc.DEBUG].concat(n);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Kn("UPLOAD_LOG",!0)}disableLogUpload(){Kn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Nde(this).prefix(e)}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-GI<100)return void setTimeout(()=>{this.log(...n)},Date.now()-GI);const o=Math.max(0,Math.min(4,n[0]));if(n[0]=j1()+" Agora-SDK [".concat(b0(o),"]:"),this.appendLogToWaitingList(o,...n),o<this.logLevel)return;const c=j1()+" %cAgora-SDK [".concat(b0(o),"]:");let u=[];if(!Q("USE_NEW_LOG"))switch(o){case Jc.DEBUG:u=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,u);break;case Jc.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,u);break;case Jc.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,u);break;case Jc.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-GI<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-GI);const o=Math.max(0,Math.min(4,n[0]));n[0]=j1()+" Agora-SDK [".concat(b0(o),"]:"),this.appendLogToWaitingList(o,...n)}appendLogToWaitingList(e){if(!Q("UPLOAD_LOG"))return;for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=R6()+" Agora-SDK [".concat(b0(e),"]:"):i[0]=R6()+" Agora-SDK [".concat(b0(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,n={sdk_version:Xc,process_id:Q("PROCESS_ID"),payload:JSON.stringify(e)};return ju(async()=>{const i=await Do.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Q("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Q("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),w6.reportLogUploadError(o),!0},{timeout:Q("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Q("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Q("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var C6;function kde(e){return zi(e.reportId,"params.reportId",0,100,!1),zi(e.category,"params.category",0,100,!1),zi(e.event,"params.event",0,100,!1),zi(e.label,"params.label",0,100,!1),Xn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(C6={}).FREE="free",C6.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Dde={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Ii=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),yr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Lde=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function At(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(n,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||n.__className__||(n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name);o.value=function(){for(var h,f=arguments.length,_=new Array(f),v=0;v<f;v++)_[v]=arguments[v];let y=_;if(e.argsMap)try{y=e.argsMap(this,..._)}catch(I){N.warning(I),y=[]}try{JSON.stringify(y)}catch{N.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),y=[]}const w=(e.report||Et).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:y,tag:kr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const I=c.apply(this,_);return I instanceof tt?I.then(P=>(w.onSuccess(e.reportResult&&P),P)).catch(P=>{throw w.onError(P),P}):(w.onSuccess(e.reportResult&&I),I)}catch(I){throw w.onError(I),I}}}return o}}const Et=new class{constructor(){Lr(this,"baseInfoMap",new Map),Lr(this,"proxyServer",void 0),Lr(this,"eventUploadTimer",void 0),Lr(this,"setSessionIdTimer",void 0),Lr(this,"url",void 0),Lr(this,"sids",new Set),Lr(this,"backupUrl",void 0),Lr(this,"_appId",void 0),Lr(this,"_aid",0),Lr(this,"keyEventUploadPendingItems",[]),Lr(this,"normalEventUploadPendingItems",[]),Lr(this,"apiInvokeUploadPendingItems",[]),Lr(this,"apiInvokeCount",0),Lr(this,"apiInvokeLoggedCount",0),Lr(this,"ltsList",[]),Lr(this,"lastSendNormalEventTime",Date.now()),Lr(this,"customReportCounterTimer",void 0),Lr(this,"customReportCount",0),Lr(this,"extApiInvoke",async e=>{for(const n of e){const i=Yt(Yt({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:kr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Q("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Q("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,n=>{let[i,o]=n;return i+o}),16)||0}reportApiInvoke(e,n,i){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!Q("SHOW_REPORT_INVOKER_LOG"),h=!!Q("SHOW_REPORT_USER_INVOKER_LOG"),f=u||h&&n.id;f&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function v(P,F){if(f){let x="[apiInvoke-".concat(_,"]");n.id&&(x+="[".concat(n.id,"]")),n.name&&(x+="[".concat(n.name,"]")),N.info("".concat(x," ").concat(P),P==="start"?n.options:F||"")}}const y=()=>({tag:n.tag,invokeId:c,sid:e,name:n.name,apiInvokeTime:o,options:n.options,states:n.states||null});v("start");let w=!1;Hi(n.timeout).then(()=>{w||(this.sendApiInvoke(Yt(Yt({},y()),{},{error:Y.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const I=new Ce(Y.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:P=>{const F=()=>{if(w)throw I;return w=!0,this.sendApiInvoke(Yt(Yt({},y()),{},{success:!0},n.reportResult&&{result:P})),v("onSuccess"),P};return i?s6(F,n.name+"Success",i,()=>w=!0):F()},onError:P=>{const F=()=>{if(w)throw P;w=!0,this.sendApiInvoke(Yt(Yt({},y()),{},{success:!1,error:P})),v("onFailure",P.toString())};return i?s6(F,n.name+"Error",i,()=>w=!0):F()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=n.cname;const c=Object.assign({},{willUploadConsoleLog:Q("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:x1?"global":"oversea",areas:Q("AREAS")&&Q("AREAS").join(",")},n.extend),{stringUid:u,channelProfile:h,channelMode:f,isABTestSuccess:_,lsid:v,clientRole:y}=n,w=Date.now(),I=Yt(Yt({},o),{},{eventType:Ii.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:U1,lts:w,elapse:w-i,extend:JSON.stringify(c),mode:n.mode,process:Q("PROCESS_ID"),appType:Q("APP_TYPE"),success:!0,version:Xc,stringUid:u,channelProfile:h,channelMode:f,isABTestSuccess:_,lsid:v,clientType:Xe(P=window.navigator.userAgent).call(P,"AgoraWebView")?42:20,clientRole:y,serviceId:Q("PROCESS_ID"),extensionID:Q("PLUGIN_INFO").join(",")||""});var P;this.send({type:yr.SESSION,data:I},!0)}joinChooseServer(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt({},o),{},{role:n.role,eventType:Ii.JOIN_CHOOSE_SERVER,lts:c,eventElapse:n.elapse||c-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:c-i.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3,corssRegionTagReq:n.corssRegionTagReq||void 0,corssRegionTagRes:n.corssRegionTagRes||void 0});this.send({type:yr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt({},o),{},{eventType:Ii.REQ_USER_ACCOUNT,lts:c,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||c-i.startTime,eventElapse:c-n.lts,extend:JSON.stringify(n.extend)});this.send({type:yr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;n.vid&&(o.vid=n.vid),o.uid=n.uid,o.cid=n.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:f,isProxy:_}=n,v=c-(u&&h?h:i.startTime),y=Yt(Yt({},o),{},{eventType:Ii.JOIN_GATEWAY,lts:c,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,errorMsg:n.errorMsg||"",elapse:v,eventElapse:c-n.lts,firstSuccess:u,signalChannel:n.signalChannel,preload:n.preload?1:0,installId:L1(),isABTestSuccess:n.isABTestSuccess?1:0}),w=y.success?1:0;if(n.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:yr.JOIN_GATEWAY,data:y},!0);else{let I;if(f)if(_){const F=f.match(/h=(\d{1,3}-){3}\d{1,3}/g),x=f.match(/p=[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:F&&F.length?F[0].split("=")[1].replace(/-/g,"."):"",port:x&&x.length?x[0].split("=")[1]:"",isProxy:_?1:0}}else{const F=f.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),x=f.match(/(:|p=)[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:F&&F.length?F[0].split("//")[1].replace(/-/g,"."):"",port:x&&x.length?x[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else I={isSuccess:w,gatewayIp:"",port:"",isProxy:_?1:0};delete y.success,delete y.eventType,delete y.firstSuccess,y.vid=Number(y.vid);const P=Object.assign({},y,I,{eventType:Ii.REJOIN_GATEWAY});this.send({type:yr.RE_JOIN_GATEWAY,data:P},!0)}}joinChannelTimeout(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=Yt(Yt({},i.info),{},{lts:o,timeout:n,elapse:o-i.startTime});this.send({type:yr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt({},o),{},{eventType:Ii.PUBLISH,lts:c,eventElapse:n.eventElapse,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:yr.PUBLISH,data:u},!0)}subscribe(e,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=Yt(Yt({},c),{},{eventType:Ii.SUBSCRIBE,lts:u,eventElapse:n.eventElapse,elapse:u-o.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid,preSsrc:n.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?h.peerSuid=n.peerid:h.peer=n.peerid,this.send({type:yr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var n;const i=[...fc(n=this.baseInfoMap).call(n)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),f=Yt(Yt({},u),{},{eventType:Ii.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:yr.WS_COMPRESSOR_INIT,data:f},!0)}firstRemoteVideoDecode(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),f=Yt(Yt(Yt({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:f},!0)}firstRemoteFrame(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),f=Yt(Yt(Yt({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h});this.send({type:i,data:f},!0)}abTest(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt(Yt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Ii.AB_TEST,lts:c});this.send({type:yr.AB_TEST,data:u},!0)}pcStats(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt(Yt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Ii.PC_STATS,lts:c,preallocation:n.preallocation?1:0});this.send({type:yr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,n){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt(Yt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Ii.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:yr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),f=Yt(Yt(Yt({},u),o),{},{eventType:n,lts:h});this.send({type:i,data:f},!0)}streamSwitch(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt({},o),{},{eventType:Ii.STREAM_SWITCH,lts:c,isDual:n.isdual,elapse:c-i.startTime,success:n.succ});this.send({type:yr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt({},o),{},{eventType:Ii.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:yr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt({},o),{},{eventType:Ii.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:yr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?N.debug("reportProxyServerurl: ".concat(e)):N.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt({},o),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:yr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,f){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const v=Md(JSON.stringify(u));let y=0;const w=[];let I=0;for(let P=0;P<_.length;P++)I+=_.charCodeAt(P)<=127?1:3,I<=f-v||(w[w.length]=ot(ot({},u),{},{[h]:_.substring(y,P)}),y=P,I=_.charCodeAt(P)<=127?1:3);return y!==_.length-1&&(w[w.length]=ot(ot({},u),{},{[h]:_.substring(y)})),w})(Yt(Yt(Yt({},o),n),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:yr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt(Yt({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:yr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt(Yt({},o),n),{},{elapse:c-i.startTime,lts:c,extend:n.extend||void 0});this.send({type:yr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Yt(Yt(Yt({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:yr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>Q("CUSTOM_REPORT_LIMIT"))throw new Ce(Y.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=n.map(c=>({type:yr.USER_ANALYTICS,data:Yt(Yt({sid:e},c),{},{lts:i})}));try{Q("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw N.error("send custom report message failed",c.toString()),new Ce(Y.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const n=Q("NOT_REPORT_EVENT");if(e.tag&&Xe(n)&&Xe(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ce){const{code:_,message:v}=e.error;h=_||v||e.error.toString()}else h=e.error.toString();const f={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:yr.API_INVOKE,data:f},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const n=Array.from(this.sids).find(i=>i!==null);n&&e.forEach(i=>{i&&(i.sid=n,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Q("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),n0(c=this.ltsList).call(c,(h,f)=>h-f))}return n||(this.lastSendNormalEventTime=Date.now()),Q("ENABLE_EVENT_REPORT")&&i.length&&(Q("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{Q("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>Q("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Q("NORMAL_EVENT_QUEUE_CAPACITY")),N.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){ni.networkState===xa.OFFLINE&&await tt.race([ni.onlineWaiter,Hi(2*pi.maxRetryTimeout)]);const n=c=>{let u=new Uint8Array;return c.forEach(h=>{const f=T1(JSON.stringify(h.data)),_=new ArrayBuffer(5),v=(w=>{let I=0;return Object.entries(yr).forEach(P=>{let[F,x]=P;x===w.type&&(I=Lde[F])}),I})(h),y=new DataView(_);y.setUint16(0,f.byteLength,!0),y.setUint8(2,255&v),y.setUint8(3,v>>>8&255),y.setUint8(4,v>>>16&255),u=X5(u,new Uint8Array(_)),u=X5(u,f)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(Q("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(Q("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await O1(o,{timeout:1e4,data:n(e),headers:Yt(Yt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(f=>{const _=f&&f.data.sid&&this.baseInfoMap.get(f.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(f=>JSON.stringify(f)),vid:i,aid:o};ni.networkState===xa.OFFLINE&&await tt.race([ni.onlineWaiter,Hi(2*pi.maxRetryTimeout)]);const u=n?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("EVENT_REPORT_DOMAIN"),"&p=").concat(Q("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Q("EVENT_REPORT_DOMAIN"),":").concat(Q("STATS_COLLECTOR_PORT")).concat(u));for(let f=0;f<2;f+=1){f===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Q("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Q("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Q("STATS_COLLECTOR_PORT")).concat(u)));try{n?await vde(h,{timeout:1e4,data:c}):await O1(h,{timeout:1e4,data:c})}catch(_){if(f===1)throw _;continue}return}}createBaseInfo(e,n){const i=Object.assign({},Dde);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:n}),i}reportResourceTiming(e,n){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:o,tag:kr.TRACER}).onSuccess()}};w6.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ni.networkState,Et.reportApiInvoke(null,{name:"logUploadError",options:e,tag:kr.TRACER}).onSuccess("logUploadError")});class Te extends Ce{constructor(n){super(n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Lr(this,"name","AgoraRTCException")}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(n,N)}throw(){super.throw(N)}}const Ki={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function In(){return Ki}function I6(){return"setSinkId"in HTMLAudioElement.prototype&&(!Q("RESTRICTION_SET_PLAYBACK_DEVICE")||(cp()||V5())&&!v1())}function A6(){return!Ki.supportUnifiedPlan||Q("CHROME_FORCE_PLAN_B")&&lp()}let $i=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Gv(e,n,i){return{sampleRate:e,stereo:n,bitrate:i}}function yn(e,n,i,o,c){return{width:e,height:n,frameRate:i,bitrateMin:o,bitrateMax:c}}function jl(e,n,i,o,c){return{width:{max:e},height:{max:n},frameRate:i,bitrateMin:o,bitrateMax:c}}function B1(e,n){return{numSpatialLayers:e,numTemporalLayers:n}}const xde={"90p":yn(160,90),"90p_1":yn(160,90),"120p":yn(160,120,15,30,65),"120p_1":yn(160,120,15,30,65),"120p_3":yn(120,120,15,30,50),"120p_4":yn(212,120),"180p":yn(320,180,15,30,140),"180p_1":yn(320,180,15,30,140),"180p_3":yn(180,180,15,30,100),"180p_4":yn(240,180,15,30,120),"240p":yn(320,240,15,40,200),"240p_1":yn(320,240,15,40,200),"240p_3":yn(240,240,15,40,140),"240p_4":yn(424,240,15,40,220),"360p":yn(640,360,15,80,400),"360p_1":yn(640,360,15,80,400),"360p_3":yn(360,360,15,80,260),"360p_4":yn(640,360,30,80,600),"360p_6":yn(360,360,30,80,400),"360p_7":yn(480,360,15,80,320),"360p_8":yn(480,360,30,80,490),"360p_9":yn(640,360,15,80,800),"360p_10":yn(640,360,24,80,800),"360p_11":yn(640,360,24,80,1e3),"480p":yn(640,480,15,100,500),"480p_1":yn(640,480,15,100,500),"480p_2":yn(640,480,30,100,1e3),"480p_3":yn(480,480,15,100,400),"480p_4":yn(640,480,30,100,750),"480p_6":yn(480,480,30,100,600),"480p_8":yn(848,480,15,100,610),"480p_9":yn(848,480,30,100,930),"480p_10":yn(640,480,10,100,400),"720p":yn(1280,720,15,120,1130),"720p_auto":yn(1280,720,30,900,3e3),"720p_1":yn(1280,720,15,120,1130),"720p_2":yn(1280,720,30,120,2e3),"720p_3":yn(1280,720,30,120,1710),"720p_5":yn(960,720,15,120,910),"720p_6":yn(960,720,30,120,1380),"1080p":yn(1920,1080,15,120,2080),"1080p_1":yn(1920,1080,15,120,2080),"1080p_2":yn(1920,1080,30,120,3e3),"1080p_3":yn(1920,1080,30,120,3150),"1080p_5":yn(1920,1080,60,120,4780),"1440p":yn(2560,1440,30,120,4850),"1440p_1":yn(2560,1440,30,120,4850),"1440p_2":yn(2560,1440,60,120,7350),"4k":yn(3840,2160,30,120,8910),"4k_1":yn(3840,2160,30,120,8910),"4k_3":yn(3840,2160,60,120,13500)},Mde={"480p":jl(640,480,5),"480p_1":jl(640,480,5),"480p_2":jl(640,480,30),"480p_3":jl(640,480,15),"720p":jl(1280,720,5),"720p_auto":yn(1280,720,30,900,3e3),"720p_1":jl(1280,720,5),"720p_2":jl(1280,720,30),"720p_3":jl(1280,720,15),"1080p":jl(1920,1080,5),"1080p_1":jl(1920,1080,5),"1080p_2":jl(1920,1080,30),"1080p_3":jl(1920,1080,15)},Ude={"1SL1TL":B1(1,1),"3SL3TL":B1(3,3),"2SL3TL":B1(2,3)};function Vd(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},xde[e]):e}function W1(e){return typeof e=="string"?Object.assign({},Mde[e]):e}function zI(e){return typeof e=="string"?Object.assign({},Ude[e]):e}const Vde={speech_low_quality:Gv(16e3,!1),speech_standard:Gv(32e3,!1,18),music_standard:Gv(48e3,!1),standard_stereo:Gv(48e3,!0,56),high_quality:Gv(48e3,!1,128),high_quality_stereo:Gv(48e3,!0,192)};function HI(e){return typeof e=="string"?Object.assign({},Vde[e]):e}const zv=[];function O6(e){return Si(e,"mediaSource",["screen","window","application"]),!0}let lt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),rr=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Hv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Fde=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),jde=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),qg=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Kv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),$v=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),qv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),mc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const G1={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},z1={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},P6={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Bde={uplinkNetworkQuality:0,downlinkNetworkQuality:0},N6={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let oo=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),gc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),w0=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Yg=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),js=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Fd=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const H1={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let KI=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function k6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Sr(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?k6(Object(i),!0).forEach(function(o){Se(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):k6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Se(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var _=f.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function Sn(e,n,i,o,c){var u,h,f={};return Object.keys(o).forEach(function(_){f[_]=o[_]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=Aa(u=_f(h=i.slice()).call(h)).call(u,function(_,v){return v(e,n,_)||_},f),c&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(c):void 0,f.initializer=void 0),f.initializer===void 0&&(Object.defineProperty(e,n,f),f=null),f}class D6 extends Rr{set _mediaStreamTrack(n){n!==this.mediaStreamTrack&&(this.safeEmit(qg.TRACK_UPDATED,n),this.mediaStreamTrack=n)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(n,i){super(),Se(this,"trackMediaType",void 0),Se(this,"_ID",void 0),Se(this,"_rtpTransceiver",void 0),Se(this,"_lowRtpTransceiver",void 0),Se(this,"_hints",[]),Se(this,"_isClosed",!1),Se(this,"_originMediaStreamTrack",void 0),Se(this,"mediaStreamTrack",void 0),Se(this,"_external",{}),this._ID=i||nr(8,"track-"),this._originMediaStreamTrack=n,this.mediaStreamTrack=n,function(o){Xe(zv).call(zv,o)||zv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){return n||zf(()=>{var i;Et.reportApiInvoke(null,{name:hi.GET_MEDIA_STREAM_TRACK,options:[],tag:kr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===Hv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const i=zv.indexOf(n);i!==-1&&zv.splice(i,1)}(this),this.emit(Kv.CLOSED),this.removeAllListeners(qg.SEI_RECEIVED)}_updateRtpTransceiver(n,i){if(i===Hv.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(qg.TRANSCEIVER_UPDATED,n,i)}}class Yv extends D6{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(n,i){super(n,i),Se(this,"_enabled",!0),Se(this,"_muted",!1),Se(this,"_isExternalTrack",!1),Se(this,"_isClosed",!1),Se(this,"_enabledMutex",void 0),Se(this,"processor",void 0),Se(this,"_processorContext",void 0),Se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ms("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,i;return(n=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&n!==void 0?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,N.debug("[".concat(this.getTrackId(),"] close")),this.emit(lt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,n!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await tr(this,lt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Kv.TRACK_ENDED)}stateCheck(n,i){if(N.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(i,"]")),up(i,n),this._enabled&&this._muted&&n==="enabled"&&i===!1)throw new Ce(Y.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",N);if(!this._enabled&&!this._muted&&n==="muted"&&i===!0)throw new Ce(Y.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",N)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():tt.resolve([])}}const L6=window.AudioContext||window.webkitAudioContext;let _c=null;const $n=new class extends Rr{constructor(){super(...arguments),Se(this,"prevState",void 0),Se(this,"curState",void 0),Se(this,"currentTime",void 0),Se(this,"currentTimeStuckAt",void 0),Se(this,"interruptDetectorTrack",void 0),Se(this,"onLocalAudioTrackMute",()=>{N.info("ios15-interruption-start"),this.emit($i.IOS_15_16_INTERRUPTION_START)}),Se(this,"onLocalAudioTrackUnmute",async()=>{N.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?N.info("ios15-interruption-end-canceled"):(_c&&await _c.suspend(),this.emit($i.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){N.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){N.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Xv(){if(!_c){if(function(){if(!L6)return void N.error("your browser is not support web audio");N.info("create audio context");const e=Sr({},Q("WEBAUDIO_INIT_OPTIONS"));N.debug("audio context init option:",JSON.stringify(e)),_c=new L6(e),$n.curState=_c.state,_c.onstatechange=()=>{$n.prevState=$n.curState,$n.curState=_c?_c.state:void 0;const{prevState:n,curState:i}=$n,o=i==="running",c=i==="interrupted",u=n==="running",h=n==="suspended",f=n==="interrupted",_=vn().osVersion;(so()||Vl())&&u&&c&&(N.info("ios".concat(_,"-interruption-start")),$n.emit($i.IOS_INTERRUPTION_START)),(so()||Vl())&&(h||f)&&o&&(N.info("ios".concat(_,"-interruption-end")),$n.emit($i.IOS_INTERRUPTION_END)),n!==i&&$n.emit($i.STATE_CHANGE,i,n)},setInterval(()=>{var n;const i=(n=_c)===null||n===void 0?void 0:n.currentTime;$n.currentTime!==i?($n.currentTimeStuckAt&&(N.debug("AudioContext current time resume at ".concat(i)),$n.currentTimeStuckAt=void 0),$n.currentTime=i):(i!==$n.currentTimeStuckAt&&(Et.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:kr.TRACER}).onSuccess(),N.warning("AudioContext current time stuck at ".concat(i))),$n.currentTimeStuckAt=i)},5e3),async function(n){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function f(x){n.state==="running"?_(!1):so()||Vl()?n.state==="suspended"&&(_(!0),x&&n.resume().then(v,v)):n.state!=="closed"&&(_(!0),x&&n.resume().then(v,v))}function _(x){if(c!==x){c=x;for(let M=0,$=i;M<$.length;M+=1){const q=$[M];x?window.addEventListener(q,y,{capture:!0,passive:!0}):window.removeEventListener(q,y,{capture:!0,passive:!0})}}}function v(){f(!1)}function y(){f(!0)}function w(x){if(!h)if(o.paused)if(x){let M;I(!1),h=!0;try{M=o.play(),M?M.then(P,P):(o.addEventListener("playing",P),o.addEventListener("abort",P),o.addEventListener("error",P))}catch{P()}}else I(!0);else I(!1)}function I(x){if(u!==x){u=x;for(let M=0,$=i;M<$.length;M++){const q=$[M];x?window.addEventListener(q,F,{capture:!0,passive:!0}):window.removeEventListener(q,F,{capture:!0,passive:!0})}}}function P(){o.removeEventListener("playing",P),o.removeEventListener("abort",P),o.removeEventListener("error",P),h=!1,w(!1)}function F(){w(!0)}if(so()){const x=n.createMediaStreamDestination(),M=document.createElement("div");M.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=M.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=x.stream,w(!0)}$n.on($i.STATE_CHANGE,function(){f(!0)}),f(!1)}(_c)}(),!_c)throw new Ce(Y.NOT_SUPPORTED,"can not create audio context");return _c}return _c}function Xg(e){if(function(){if(K1!==null)return K1;const o=Xv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let f=!1;try{c.disconnect(u)}catch{f=!0}return c.disconnect(),K1=f,f}())return;const n=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),Xe(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),n.call(e,o,c,u)):n.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?xI(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)n.call(e,h)}}let K1=null;function $1(e,n){let i=!1;const o=1/n;if(Q("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Xv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const f=c.createOscillator();f.onended=h,f.connect(u),f.start(0),f.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class x6{constructor(){Se(this,"context",void 0),Se(this,"analyserNode",void 0),Se(this,"sourceNode",void 0),this.context=Xv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n==null||n.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||so()||Vl()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<n.length;++c)n[c]=o[c]/128-1}const i=Aa(n).call(n,(o,c)=>o+c*c,0)/n.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,i;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{N.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class M6 extends Rr{get processSourceNode(){return this.sourceNode}set processedNode(n){var i;if(!this.isDestroyed&&this._processedNode!==n){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Se(this,"outputNode",void 0),Se(this,"outputTrack",void 0),Se(this,"isPlayed",!1),Se(this,"sourceNode",void 0),Se(this,"context",void 0),Se(this,"audioBufferNode",void 0),Se(this,"destNode",void 0),Se(this,"audioOutputLevel",0),Se(this,"volumeLevelAnalyser",void 0),Se(this,"_processedNode",void 0),Se(this,"playNode",void 0),Se(this,"isDestroyed",!1),Se(this,"onNoAudioInput",void 0),Se(this,"isNoAudioInput",!1),Se(this,"_noAudioInputCount",0),this.context=Xv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Xg(this.outputNode),this.volumeLevelAnalyser=new x6}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(mc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!In().webAudioMediaStreamDest)throw new Ce(Y.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){this.context.state!=="running"&&MI(()=>{$n.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(n>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;so()||Vl()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Hi(200),await this.checkHasAudioInput(n?n+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,i;(n=this.processedNode)===null||n===void 0||n.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?(n=this.processedNode)===null||n===void 0||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class U6 extends M6{get isFreeze(){return!1}constructor(n,i,o){var c;if(super(),Se(this,"sourceNode",void 0),Se(this,"track",void 0),Se(this,"clonedTrack",void 0),Se(this,"audioElement",void 0),Se(this,"isCurrentTrackCloned",!1),Se(this,"isRemoteTrack",!1),Se(this,"originVolumeLevelAnalyser",void 0),Se(this,"rebuildWebAudio",async()=>{if(N.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void N.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>N.info("resume success")),N.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const f=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?f.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),Xg(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Xg(this.outputNode),this.emit(mc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),n.kind!=="audio")throw new Ce(Y.UNEXPECTED_ERROR);this.track=n;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),Xg(this.sourceNode),o){const f=o.clone();f.enabled=!0,this.clonedTrack=f,N.debug("create an unmuted track ".concat(f.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([f]));Xg(_),this.originVolumeLevelAnalyser=new x6,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=vn();i&&h.os===Ci.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&($n.on($i.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(f=>{f||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const i=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(i),Xg(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(mc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),$n.off("state-change",this.rebuildWebAudio),(n=this.originVolumeLevelAnalyser)===null||n===void 0||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const i=n.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),N.debug("create an unmuted track ".concat(i.id," from the original track ").concat(n.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));Xg(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function V6(e,n,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(n.height,1080),maxWidth:o(n.width,1920)}}};return n.frameRate&&typeof n.frameRate!="number"?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):typeof n.frameRate=="number"&&(c.video.mandatory.maxFrameRate=n.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Wde(e,n){const i=await F6(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new tt((f,_)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const I=document.createElement("div");I.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const P=document.createElement("div");P.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const F=document.createElement("button");F.innerHTML="cancel",F.setAttribute("style","width: 85px;"),F.onclick=()=>{document.body.removeChild($);const q=new Error("NotAllowedError");q.name="NotAllowedError",_(q)};let x=h;const M=document.createElement("div");if(h){const q=document.createElement("input");q.setAttribute("type","checkbox");const ae=document.createElement("span");q.setAttribute("style","margin-right: 6px;"),ae.innerText="Share audio",q.checked=x,q.onchange=()=>{x=q.checked},M.appendChild(q),M.appendChild(ae)}P.appendChild(M),P.appendChild(F),y.appendChild(w),y.appendChild(I),y.appendChild(P);const $=document.createElement("div");$.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),$.appendChild(v),$.appendChild(y),document.body.appendChild($),u.map(q=>{if(q.id){const ae=document.createElement("div");ae.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let me=q.thumbnail;try{const{width:ge}=me.getSize();ge>1920&&(me=me.resize({width:1920}))}catch(ge){throw ge&&ge.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ge}ae.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+me.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+q.name.replace(/[\u00A0-\u9999<>\&]/g,function(ge){return"&#"+ge.charCodeAt(0)+";"})+"</span>",ae.onclick=()=>{document.body.removeChild($),f({sourceId:q.id,audio:x})},I.appendChild(ae)}})})}(i,n);return await V6(o,e,c)}async function F6(e){let n=["window","screen"];e!=="application"&&e!=="window"||(n=["window"]),e==="screen"&&(n=["screen"]);const i=J5();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Ce(Y.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:n}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{o=null}o&&o.then||(o=new tt((u,h)=>{i.desktopCapturer.getSources({types:n},(f,_)=>{f?h(f):u(_)})}));try{return await o}catch(u){throw new Ce(Y.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const q1=new ms("safari");let j6=!1,B6=!1;async function Ec(e,n){let i=0,o=null;for(;i<2;)try{o=await Gde(e,n,i>0);break}catch(c){if(c instanceof Ce)throw N.error("[".concat(n,"] ").concat(c.toString())),c;const u=$I(c.name||c.code||c,c.message);if(u.code===Y.MEDIA_OPTION_INVALID){N.debug("[".concat(n,"] detect media option invalid, retry")),i+=1,await Hi(500);continue}throw N.error("[".concat(n,"] ").concat(u.toString())),u}if(!o)throw new Ce(Y.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Gde(e,n,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ce(Y.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=In(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return N.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(J5())e.screen.sourceId?Jv(c,await V6(e.screen.sourceId,e.screen,!!e.screenAudio)):Jv(c,await Wde(e.screen,!!e.screenAudio));else if(cp()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Ce(Y.NOT_SUPPORTED,"This browser does not support screen sharing");N.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const I=await(h=e.screen.extensionId,f=n,new tt((P,F)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},x=>{if(!x||!x.streamId)return N.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),x),void F(new Ce(Y.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));P(x.streamId)})}catch(x){N.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),x.toString()),F(new Ce(Y.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=I,Jv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&O6(e.screen.mediaSource);const I={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:P,surfaceSwitching:F,systemAudio:x,preferCurrentTab:M}=e.screen,$={selfBrowserSurface:P,surfaceSwitching:F,systemAudio:x,preferCurrentTab:M};!P&&delete $.selfBrowserSurface,!F&&delete $.surfaceSwitching,!x&&delete $.systemAudio,!M&&delete $.preferCurrentTab,N.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:I,audio:e.screenAudio,controls:$})),Jv(c,await navigator.mediaDevices.getDisplayMedia(Sr({video:I,audio:e.screenAudio},$)))}else{if(!Pr())throw N.error("[".concat(n,"] This browser does not support screenSharing")),new Ce(Y.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&O6(e.screen.mediaSource);const I={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};N.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(I))),Jv(c,await navigator.mediaDevices.getUserMedia(I))}}var h,f;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},v=Q("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),_=R1(_,v)}catch{}N.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(_)),vn();let y,w=null;(as()||so()||DI())&&(w=await q1.lock());try{y=await navigator.mediaDevices.getUserMedia(_)}catch(I){throw w&&w(),I}return _.audio&&(j6=!0),_.video&&(B6=!0),Jv(c,y),w&&w(),c}function $I(e,n){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ce(Y.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new Ce(Y.DEVICE_NOT_FOUND,"".concat(e,": ").concat(n));case"NotSupportedError":return new Ce(Y.NOT_SUPPORTED,"".concat(e,": ").concat(n));case"NotReadableError":return new Ce(Y.NOT_READABLE,"".concat(e,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ce(Y.PERMISSION_DENIED,"".concat(e,": ").concat(n));case"ConstraintNotSatisfiedError":return new Ce(Y.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(n));default:return N.error("getUserMedia unexpected error",e),new Ce(Y.UNEXPECTED_ERROR,"".concat(e,": ").concat(n))}}function Jv(e,n){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=n.getVideoTracks()[0],u=n.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const vc=new class extends Rr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Yg.STATE_CHANGE,e),this._state=e)}constructor(){super(),Se(this,"_state",w0.IDLE),Se(this,"isAccessMicrophonePermission",!1),Se(this,"isAccessCameraPermission",!1),Se(this,"lastAccessMicrophonePermission",!1),Se(this,"lastAccessCameraPermission",!1),Se(this,"checkdeviceMatched",!1),Se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Q("ENUMERATE_DEVICES_INTERVAL")||(LI()||kI()===Ci.HARMONY_OS)&&lp())&&this.updateDevicesInfo()},Q("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>N.error(e.toString()))}async enumerateDevices(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ce(Y.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&n;c.audio&&(u=!1),c.video&&(h=!1);let f=null,_=null,v=null;if(!i&&(u||h)){if(q1.isLocked&&(N.debug("[device manager] wait GUM lock"),(await q1.lock())(),N.debug("[device manager] GUM unlock")),j6&&(u=!1,this.isAccessMicrophonePermission=!0),B6&&(h=!1,this.isAccessCameraPermission=!0),N.debug("[device manager] check media device permissions",e,n,u,h),u&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(y){const w=$I(y.name||y.code||y,y.message);if(w.code===Y.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{f=await navigator.mediaDevices.getUserMedia({audio:e})}catch(y){const w=$I(y.name||y.code||y,y.message);if(w.code===Y.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:n})}catch(y){const w=$I(y.name||y.code||y,y.message);if(w.code===Y.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}N.debug("[device manager] mic permission",e,"cam permission",n)}try{const y=await navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),v&&v.getTracks().forEach(w=>w.stop()),f=null,_=null,v=null,y}catch(y){return f&&f.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),v&&v.getTracks().forEach(w=>w.stop()),f=null,_=null,v=null,new Ce(Y.ENUMERATE_DEVICES_FAILED,y.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(n=>n.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audiooutput")}searchDeviceIdByName(e){let n=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(n=i.device.deviceId)}),n}async getDeviceById(e){const n=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!n)throw new Ce(Y.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return n}async init(){this.state=w0.INITING;try{await this.updateDevicesInfo(),this.state=w0.INITEND}catch(e){throw N.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=w0.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ce(Y.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),n=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?N.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):N.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):N.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:n,updateAt:n,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=n)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==n&&(c.state="INACTIVE",i.push(c))}),this.state!==w0.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Yg.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Yg.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Yg.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const n=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let Y1=!1;const yc=new class extends Rr{constructor(){super(...arguments),Se(this,"onAutoplayFailed",void 0),Se(this,"onAudioAutoplayFailed",void 0)}};function W6(){if(vn(),!Y1){const e=n=>{n.preventDefault(),Y1=!1,m0()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Y1=!0,m0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),N.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),yc.onAutoplayFailed?yc.onAutoplayFailed():yc.onAudioAutoplayFailed?N.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):N.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),yc.emit("autoplay-failed")}}function G6(e,n,i,o){if(!e)return;const c=Et.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),f=Sr(Sr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:yc.onAutoplayFailed||yc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:n,trackId:o,extend:void 0});Et.send({type:yr.AUTOPLAY_FAILED,data:f},!0)}const zde=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Lo=new class{constructor(){Se(this,"onAutoplayFailed",void 0),Se(this,"elementMap",new Map),Se(this,"elementStateMap",new Map),Se(this,"elementsNeedToResume",[]),Se(this,"sinkIdMap",new Map),Se(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(n=>{let[i,o]=n;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(N.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if($n.curState==="running")return Uv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(N.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),$n.on($i.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.on($i.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),$n.on($i.STATE_CHANGE,()=>{so()&&$n.prevState==="suspended"&&$n.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,n){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,n),i)try{await i.setSinkId(n)}catch(o){throw new Ce(Y.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,n,i,o){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,js.INIT),this.setVolume(n,i);const u=this.sinkIdMap.get(n);if(u)try{c.setSinkId(u).catch(f=>{N.warning("[".concat(n,"] set sink id failed"),f.toString())})}catch(f){N.warning("[".concat(n,"] set sink id failed"),f.toString())}const h=c.play();h&&h.then&&h.catch(f=>{o&&G6(o,"audio",f.message,n),N.warning("audio element play warning",f.toString()),this.elementMap.has(n)&&f.name==="NotAllowedError"&&(N.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),MI(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),W6()}))})}updateTrack(e,n){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([n]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,n){const i=this.elementMap.get(e);i&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(e){const n=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!n)return;const i=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(i,1),n.srcObject=null,n.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,n){zde.forEach(i=>{n.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(N.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=n==null?void 0:n.error;h&&N.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(i=>{N.debug("Auto resume audio element success")}).catch(i=>{N.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new tt(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{m0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function $r(){return function(e,n,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new Ce(Y.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",N);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const f=o.apply(this,u);return f instanceof tt?new tt((_,v)=>{f.then(_).catch(v)}):f}),i}}class z6 extends Rr{constructor(n){super(),Se(this,"name","VideoProcessorDestination"),Se(this,"ID","0"),Se(this,"_source",void 0),Se(this,"videoContext",void 0),Se(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ce(Y.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ce(Y.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(oo.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(oo.ON_TRACK,void 0)}}class H6 extends Rr{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i){super(),Se(this,"constraintsMap",new Map),Se(this,"statsRegistry",[]),Se(this,"usageRegistry",[]),Se(this,"trackId",void 0),Se(this,"direction",void 0),Se(this,"_chained",!1),this.trackId=n,this.direction=i}async getConstraints(){return await ls(this,gc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(n,i){var o;return N.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),tr(this,gc.REQUEST_UPDATE_CONSTRAINTS,Array.from(uc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return N.info("processor ".concat(n.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(n),tr(this,gc.REQUEST_UPDATE_CONSTRAINTS,Array.from(uc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){N.error(new Ce(Y.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof tt&&(o=await o),n.push(Sr(Sr({},o),{},{direction:this.direction}))}catch(o){N.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class K6 extends Rr{constructor(n){super(),Se(this,"name","AudioProcessorDestination"),Se(this,"ID","0"),Se(this,"inputTrack",void 0),Se(this,"inputNode",void 0),Se(this,"audioProcessorContext",void 0),Se(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ce(Y.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ce(Y.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(oo.ON_TRACK,void 0),this.emit(oo.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(oo.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(oo.ON_NODE,this.inputNode))}}class $6 extends Rr{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i,o){super(),Se(this,"constraintsMap",new Map),Se(this,"statsRegistry",[]),Se(this,"audioContext",void 0),Se(this,"trackId",void 0),Se(this,"direction",void 0),Se(this,"usageRegistry",[]),Se(this,"_chained",!1),this.audioContext=n,this.trackId=i,this.direction=o}async getConstraints(){return ls(this,gc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(n,i){var o;return N.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),tr(this,gc.REQUEST_UPDATE_CONSTRAINTS,Array.from(uc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return this.constraintsMap.delete(n),tr(this,gc.REQUEST_UPDATE_CONSTRAINTS,Array.from(uc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){N.error(new Ce(Y.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof tt&&(o=await o),n.push(Sr(Sr({},o),{},{direction:this.direction}))}catch(o){N.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class X1 extends Rr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Se(this,"context",void 0),Se(this,"processSourceNode",void 0),Se(this,"outputTrack",void 0),Se(this,"processedNode",void 0),Se(this,"clonedTrack",void 0),Se(this,"outputNode",void 0),this.outputNode=new Hde}setVolume(){}createOutputTrack(){throw new Ce(Y.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Hde{disconnect(){}connect(){}}function q6(e){return new tt((n,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=so()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,f=c.videoHeight;!h&&Pr()||(o=!0,c.srcObject=null,c.remove(),n([h,f]))}),c.srcObject=new MediaStream([e]),c.play().catch(UI),setTimeout(()=>{o||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}function qI(e){const n={};e.facingMode&&(n.facingMode=e.facingMode),e.cameraId&&(n.deviceId={exact:e.cameraId});const i=Vd(e.encoderConfig);return i.width!=null&&(n.width=i.width),i.height!=null&&(n.height=i.height),!K5()&&i.frameRate&&(n.frameRate=i.frameRate),V5()&&typeof n.frameRate=="object"&&(n.frameRate.max=60),Pr()&&(n.frameRate={ideal:30,max:30}),n}function Y6(e){const n={};return K5()||(e.AGC!==void 0&&(n.autoGainControl=e.AGC),e.AEC!==void 0&&(n.echoCancellation=e.AEC),e.ANS!==void 0&&(n.noiseSuppression=e.ANS,cp()&&e.ANS&&(n.googHighpassFilter=e.ANS))),n}function X6(e){const n=Y6(e);if(e.encoderConfig){const i=HI(e.encoderConfig);n.channelCount=i.stereo?2:1,n.sampleRate=i.sampleRate,n.sampleSize=i.sampleSize}return e.microphoneId&&(n.deviceId={exact:e.microphoneId}),LI()&&(n.sampleRate=void 0),n}const Kde=e=>{const n=e._encoderConfig;if(!n)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:f=c}=n;if(!u||!h||!f)return;h=C1(h),f=C1(f),u=C1(u);const{max:_,min:v}=function(P,F,x){const M=200*Math.pow(x/15,.6)*Math.pow(P*F/640/360,.75);return{min:Math.floor(M),max:Math.floor(4*M)}}(h,f,u),{bitrateMax:y,bitrateMin:w}=n||{};y||N.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(f,", fps: ").concat(u,"] => [brMax: ").concat(y,", brMin: ").concat(w,"]"));const{maxFramerate:I}=Q("ENCODER_CONFIG_LIMIT");return I&&typeof I=="number"&&(u=Math.min(u,I)),{frameRate:u,bitrateMax:y||_,bitrateMin:w||v,scaleResolutionDownBy:1,scale:0}},J6=async(e,n,i)=>await(async(o,c,u)=>{const h=function(v){const y=[];for(let w=0;w<v.length;w+=2)y.push(parseInt(v.slice(w,w+2),16));return Uint8Array.from(y)}(c6(""+c+u)).slice(0,16),f=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},_,o))})(e.buffer,n,i),J1=e=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new tt((i,o)=>{n.toBlob(async c=>{if(n.remove(),c){const u=await Q6(c);i({buffer:u,width:n.width,height:n.height})}else o(new Ce(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},Q6=async e=>{const n=await e.arrayBuffer();return new Uint8Array(n)};var Z6,eW,tW,nW,rW,iW,sW,oW,aW,cW,lW,uW,dW,hW,pW,fW,mW,gW,Cr,_W,EW,vW,yW,SW,TW,jd,bW,wW,RW,CW,IW,AW,OW,PW,NW,kW,DW,LW,xW,ds;let Ur=(Z6=At({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),eW=At({argsMap:(e,n)=>[e.getTrackId(),n]}),tW=$r(),nW=jv("LocalAudioTrack","_enabledMutex"),rW=At({argsMap:(e,n)=>[e.getTrackId(),n]}),iW=$r(),sW=jv("LocalAudioTrack","_enabledMutex"),oW=At({argsMap:(e,n)=>[e.getTrackId(),n]}),aW=$r(),cW=$r(),lW=$r(),uW=At({argsMap:e=>[e.getTrackId()]}),dW=$r(),hW=At({argsMap:e=>[e.getTrackId()]}),pW=$r(),fW=At({argsMap:e=>[e.getTrackId()]}),mW=At({argsMap:(e,n)=>[e.getTrackId(),n.name]}),gW=At({argsMap:e=>[e.getTrackId()]}),Sn((Cr=class extends Yv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Lo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,n,i,o){super(e,i),Se(this,"trackMediaType",qv.AUDIO),Se(this,"_encoderConfig",void 0),Se(this,"_trackSource",void 0),Se(this,"metadata",[]),Se(this,"_enabled",!0),Se(this,"_volume",100),Se(this,"_useAudioElement",!0),Se(this,"_bypassWebAudio",!1),Se(this,"processor",void 0),Se(this,"_processorContext",void 0),Se(this,"_processorDestination",void 0),Se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=n,this._getOriginVolumeLevel=!!o,this._trackSource=new X1,Q("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Q("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),as()&&!_c?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Xn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Lo.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void N.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,tr(this,lt.NEED_REPLACE_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{N.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!I6())throw new Ce(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Lo.setSinkID(this.getTrackId(),e)}async setEnabled(e,n,i){return this._setEnabled(e,n,i)}async _setEnabled(e,n,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await tr(this,lt.NEED_ENABLE_TRACK,this),N.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await tr(this,lt.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await tr(this,lt.NEED_MUTE_TRACK,this):await tr(this,lt.NEED_UNMUTE_TRACK,this))}getStats(){return zf(()=>{N.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),hc(this,lt.GET_STATS)||Sr({},G1)}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(mc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(mc.ON_AUDIO_BUFFER),this._source.on(mc.ON_AUDIO_BUFFER,i=>e(i))}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Lo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Lo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Lo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,n){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await tr(this,lt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return tt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ce(Y.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ce(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(e){e.on(oo.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n),await tr(this,lt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await tr(this,lt.NEED_REPLACE_TRACK,this))}),e.on(oo.ON_NODE,n=>{this._source.processedNode=n})}unbindProcessorDestinationEvents(e){e.removeAllListeners(oo.ON_TRACK),e.removeAllListeners(oo.ON_NODE)}bindProcessorContextEvents(e){e.on(gc.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(gc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof X1&&(this._trackSource=new U6(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new $6(this._source.context,this.getTrackId(),"local"),n=new K6(e);return this._processorContext=e,this._processorDestination=n,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(n),this._source.on(mc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Lo.stop(this.getTrackId()),this._source.play()),tr(this,lt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{N.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:n}}}).prototype,"setVolume",[Z6],Object.getOwnPropertyDescriptor(Cr.prototype,"setVolume"),Cr.prototype),Sn(Cr.prototype,"setPlaybackDevice",[eW,tW],Object.getOwnPropertyDescriptor(Cr.prototype,"setPlaybackDevice"),Cr.prototype),Sn(Cr.prototype,"setEnabled",[nW,rW,iW],Object.getOwnPropertyDescriptor(Cr.prototype,"setEnabled"),Cr.prototype),Sn(Cr.prototype,"setMuted",[sW,oW,aW],Object.getOwnPropertyDescriptor(Cr.prototype,"setMuted"),Cr.prototype),Sn(Cr.prototype,"getStats",[cW],Object.getOwnPropertyDescriptor(Cr.prototype,"getStats"),Cr.prototype),Sn(Cr.prototype,"setAudioFrameCallback",[lW],Object.getOwnPropertyDescriptor(Cr.prototype,"setAudioFrameCallback"),Cr.prototype),Sn(Cr.prototype,"play",[uW,dW],Object.getOwnPropertyDescriptor(Cr.prototype,"play"),Cr.prototype),Sn(Cr.prototype,"stop",[hW,pW],Object.getOwnPropertyDescriptor(Cr.prototype,"stop"),Cr.prototype),Sn(Cr.prototype,"close",[fW],Object.getOwnPropertyDescriptor(Cr.prototype,"close"),Cr.prototype),Sn(Cr.prototype,"pipe",[mW],Object.getOwnPropertyDescriptor(Cr.prototype,"pipe"),Cr.prototype),Sn(Cr.prototype,"unpipe",[gW],Object.getOwnPropertyDescriptor(Cr.prototype,"unpipe"),Cr.prototype),Cr),YI=(_W=At({argsMap:(e,n)=>[e.getTrackId(),n]}),EW=$r(),vW=jv("MicrophoneAudioTrack","_enabledMutex"),yW=At({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),SW=$r(),TW=At({argsMap:e=>[e.getTrackId()]}),Sn((jd=class extends Ur{get __className__(){return"MicrophoneAudioTrack"}constructor(e,n,i,o){super(e,n.encoderConfig?HI(n.encoderConfig):{},o,Q("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Se(this,"_config",void 0),Se(this,"_deviceName","default"),Se(this,"_constraints",void 0),Se(this,"_originalConstraints",void 0),Se(this,"_enabled",!0),this._config=n,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),(Uv()||E1())&&$n.bindInterruptDetectorTrack(this)}async setDevice(e){if(N.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const n=await vc.getDeviceById(e),i={};i.audio=Sr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await Ec(i,this.getTrackId())}catch(c){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Ec({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await vc.getDeviceById(e);this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}N.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,n,i){if(n)return N.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Q("AUTO_RESET_AUDIO_ROUTE")&&(so()||Vl())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await tr(this,lt.NEED_DISABLE_TRACK,this)}catch(h){throw N.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Sr({},this._constraints),u=vc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await Ec({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await tr(this,lt.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}N.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Uv()||E1())&&$n.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((so()||Vl())&&this._enabled&&!this._isClosed&&$n.duringInterruption){const e=async()=>{$n.off($i.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};$n.on($i.IOS_INTERRUPTION_END,e)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Kv.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=vc.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId=i),this._constraints=n,this._enabled){this._originMediaStreamTrack.stop();const o=await Ec({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(gc.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(gc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[_W,EW],Object.getOwnPropertyDescriptor(jd.prototype,"setDevice"),jd.prototype),Sn(jd.prototype,"setEnabled",[vW,yW,SW],Object.getOwnPropertyDescriptor(jd.prototype,"setEnabled"),jd.prototype),Sn(jd.prototype,"close",[TW],Object.getOwnPropertyDescriptor(jd.prototype,"close"),jd.prototype),jd),$de=(bW=At({argsMap:(e,n)=>[e.getTrackId(),n,e.duration]}),wW=$r(),RW=At({argsMap:e=>[e.getTrackId()]}),CW=$r(),IW=At({argsMap:e=>[e.getTrackId()]}),AW=$r(),OW=At({argsMap:e=>[e.getTrackId()]}),PW=$r(),NW=At({argsMap:e=>[e.getTrackId()]}),kW=$r(),DW=At({argsMap:e=>[e.getTrackId()]}),LW=At({argsMap:e=>[e.getTrackId()]}),xW=$r(),Sn((ds=class extends Ur{get __className__(){return"BufferSourceAudioTrack"}constructor(e,n,i,o){super(n.createOutputTrack(),i,o),Se(this,"source",void 0),Se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=n,this._bufferSource.on(mc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Kv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Xn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[bW,wW],Object.getOwnPropertyDescriptor(ds.prototype,"startProcessAudioBuffer"),ds.prototype),Sn(ds.prototype,"pauseProcessAudioBuffer",[RW,CW],Object.getOwnPropertyDescriptor(ds.prototype,"pauseProcessAudioBuffer"),ds.prototype),Sn(ds.prototype,"seekAudioBuffer",[IW,AW],Object.getOwnPropertyDescriptor(ds.prototype,"seekAudioBuffer"),ds.prototype),Sn(ds.prototype,"resumeProcessAudioBuffer",[OW,PW],Object.getOwnPropertyDescriptor(ds.prototype,"resumeProcessAudioBuffer"),ds.prototype),Sn(ds.prototype,"stopProcessAudioBuffer",[NW,kW],Object.getOwnPropertyDescriptor(ds.prototype,"stopProcessAudioBuffer"),ds.prototype),Sn(ds.prototype,"close",[DW],Object.getOwnPropertyDescriptor(ds.prototype,"close"),ds.prototype),Sn(ds.prototype,"setAudioBufferPlaybackSpeed",[LW,xW],Object.getOwnPropertyDescriptor(ds.prototype,"setAudioBufferPlaybackSpeed"),ds.prototype),ds);class Ei extends Ur{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=Xv().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,nr(8,"track-mix-")),Se(this,"trackList",void 0),Se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return this.trackList.indexOf(n)!==-1}addAudioTrack(n){this.trackList.indexOf(n)===-1?(N.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):N.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(this.trackList.indexOf(n)!==-1){N.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}xI(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(i=>{i instanceof Ei?i.emit(qg.TRANSCEIVER_UPDATED,n):i._updateRtpTransceiver(n)}))}}class qde extends M6{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(mc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Se(this,"audioBuffer",void 0),Se(this,"sourceNode",void 0),Se(this,"startPlayTime",0),Se(this,"startPlayOffset",0),Se(this,"pausePlayTime",0),Se(this,"options",void 0),Se(this,"currentLoopCount",0),Se(this,"currentPlaybackSpeed",100),Se(this,"_currentState","stopped"),this.audioBuffer=n,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){this.currentState==="stopped"?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):N.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=n,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const MW=new Map;class Q1{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const n=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/n;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(N.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}get videoState(){return this._videoState}set videoState(n){var i;n!==this._videoState&&(this._videoState=n,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(n){Se(this,"trackId",void 0),Se(this,"config",void 0),Se(this,"onFirstVideoFrameDecoded",void 0),Se(this,"onVideoStateChanged",void 0),Se(this,"freezeTimeCounterList",[]),Se(this,"renderFreezeAccTime",0),Se(this,"isKeepLastFrame",!1),Se(this,"timeUpdatedCount",0),Se(this,"freezeTime",0),Se(this,"playbackTime",0),Se(this,"lastTimeUpdatedTime",0),Se(this,"autoplayFailed",!1),Se(this,"videoTrack",void 0),Se(this,"videoElement",void 0),Se(this,"cacheVideoElement",void 0),Se(this,"renderStats",void 0),Se(this,"_videoState",Fd.VideoStateStopped),Se(this,"videoElementCheckInterval",void 0),Se(this,"videoElementFreezeTimeout",void 0),Se(this,"_videoElementStatus",js.NONE),Se(this,"isGettingVideoDimensions",!1),Se(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return N.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&$n.curState==="running"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(U5())),z5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Se(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=js.PLAYING;break;case"loadeddata":if(this.videoState=Fd.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=js.CANPLAY;break;case"stalled":this.videoElementStatus=js.STALLED;break;case"suspend":this.videoElementStatus=js.SUSPEND;break;case"pause":this.videoElementStatus=js.PAUSED,so()||Vl()||as()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=js.WAITING;break;case"abort":this.videoElementStatus=js.ABORT;break;case"ended":this.videoElementStatus=js.ENDED;break;case"emptied":this.videoElementStatus=js.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=js.ERROR,N.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,hp.lastVisibleTime<hp.lastHiddenTime||u<hp.lastHiddenTime||u<hp.lastVisibleTime)return;for(c>Q("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(U5())),z5()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,n.element instanceof HTMLVideoElement?this.videoElement=n.element:this.videoElement=document.createElement("video"),$n.on($i.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.on($i.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return(n=this.videoElement.parentElement)!==null&&n!==void 0?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{n&&G6(n,"video",c.message,this.trackId),c.name==="NotAllowedError"?(N.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):N.warning("[".concat(this.trackId,"] play warning: "),c)});const o=vn();if((o.name==="Safari"&&Number(o.version)===15||Uv())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");if(!i)return N.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,n.width,n.height);const o=i.getImageData(0,0,n.width,n.height);return n.remove(),o}async getCurrentFrameToUint8Array(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new tt((u,h)=>{o.toBlob(async f=>{if(o.remove(),f){const _=await Q6(f);u({buffer:_,width:o.width,height:o.height})}else h(new Ce(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,i<0?.1:i>1?1:i)})):await J1(n)}destroy(){this.renderStats=void 0,$n.off($i.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.off($i.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Fd.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=js.INIT,!this.videoElementCheckInterval&&(UW.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=js.DESTROYED)},1e3),Q("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(f,Q("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Fd.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Fd.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(v,y)=>{if(this.videoElementStatus===js.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=y.mediaTime):this.renderStats={lastTs:y.mediaTime,curTs:y.mediaTime,lastRenderNum:0,renderNum:0},u){const P=y.presentationTime-u.presentationTime;this.videoState===Fd.VideoStateStarting&&(this.videoState=Fd.VideoStateDecoding),this.videoState===Fd.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,Q("VIDEO_FREEZE_DURATION"))),P<Q("VIDEO_FREEZE_DURATION")&&this.videoState===Fd.VideoStateFrozen&&(this.videoState=Fd.VideoStateDecoding),P>Q("VIDEO_FREEZE_DURATION")&&hp.lastVisibleTime>=hp.lastHiddenTime&&u.timestamp>hp.lastVisibleTime&&u.timestamp>hp.lastHiddenTime&&(this.renderFreezeAccTime+=P)}u=Sr(Sr({},y),{},{timestamp:v})}var w,I;Q("ENABLE_VIDEO_FRAME_CALLBACK")&&((w=(I=this.videoElement).requestVideoFrameCallback)===null||w===void 0||w.call(I,_))};(n=(i=this.videoElement).requestVideoFrameCallback)===null||n===void 0||n.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),LI()&&!Q("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=vn();o.name==="Safari"&&Number(o.version)===15||Uv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{N.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){UW.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=js.NONE}handleAutoPlayFailed(){const n=i=>{i.preventDefault(),this.videoElement.play().then(()=>{N.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{N.error(o)}),this.autoplayFailed=!1,m0()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};m0()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),W6()}}const UW=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class VW extends Q1{constructor(n){super(n),Se(this,"container",void 0),Se(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const i=n.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(n){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(n,o):await J1(n)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Q("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if((n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var FW,jW,BW,WW,GW,zW,HW,KW,$W,qW,YW,XW,JW,QW,ZW,eG,tG,nG,rG,iG,sG,oG,aG,cG,mn,lG,uG,dG,hG,pG,fG,mG,gG,Sc;let hr=(FW=At({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),jW=$r(),BW=At({argsMap:e=>[e.getTrackId()]}),WW=jv("LocalVideoTrack","_enabledMutex"),GW=At({argsMap:(e,n)=>[e.getTrackId(),n]}),zW=$r(),HW=jv("LocalVideoTrack","_enabledMutex"),KW=At({argsMap:(e,n)=>[e.getTrackId(),n]}),$W=$r(),qW=At({argsMap:(e,n)=>[e.getTrackId(),n]}),YW=$r(),XW=$r(),JW=At({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),QW=$r(),ZW=$r(),eG=$r(),tG=$r(),nG=$r(),rG=$r(),iG=$r(),sG=At({argsMap:(e,n)=>[e.getTrackId(),n.name]}),oG=At({argsMap:e=>[e.getTrackId()]}),aG=At({argsMap:e=>[e.getTrackId()]}),cG=At({argsMap:(e,n,i)=>[e.getTrackId(),n.label,i]}),mn=class Vre extends Yv{get videoHeight(){if(as()){const{height:n}=this._mediaStreamTrack.getSettings();return this._videoHeight=n,this._videoHeight}return this._videoHeight}get videoWidth(){if(as()){const{width:n}=this._mediaStreamTrack.getSettings();return this._videoWidth=n,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==js.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,i,o,c,u,h){if(super(n,u),Se(this,"trackMediaType",qv.VIDEO),Se(this,"_player",void 0),Se(this,"isUseScaleResolutionDownBy",!1),Se(this,"_videoVisibleTimer",null),Se(this,"_previousVideoVisibleStatus",void 0),Se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Se(this,"_encoderConfig",void 0),Se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Se(this,"_optimizationMode",void 0),Se(this,"_videoHeight",void 0),Se(this,"_videoWidth",void 0),Se(this,"_forceBitrateLimit",void 0),Se(this,"_enabled",!0),Se(this,"_processorDestination",void 0),Se(this,"_processorContext",void 0),as()){const{width:f,height:_}=n.getSettings();this._videoWidth=f,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(rr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(m1(Dn.CHROME,115)&&kI().indexOf("Windows")!==-1){const f=function(_,v){if("VideoFrame"in window&&"TransformStream"in window&&In().supportWebRTCInsertableStream){const y=new MediaStreamTrackProcessor(_),w=new MediaStreamTrackGenerator({kind:"video"});let I,P,F=Date.now();const x=()=>{M&&(clearInterval(M),M=void 0),I&&(I.close(),I=void 0),_.stop(),P=void 0,w.removeEventListener("ended",x)};let M=window.setInterval(()=>{if(P&&I&&Date.now()-F>1e3)try{w.readyState==="live"?P.enqueue(I.clone()):x()}catch{x()}},1e3);const $=new TransformStream({transform:(q,ae)=>{w.readyState==="live"?(P=ae,F=Date.now(),I===void 0?(I=q,ae.enqueue(q.clone())):(ae.enqueue(I),I=q)):q.close()}});return w.addEventListener("ended",x),y.readable.pipeThrough($).pipeTo(w.writable),w}}(n);f&&(N.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}i&&this._hints.indexOf(rr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new H6(this.getTrackId(),"local"),this._processorDestination=new z6(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof n=="string"){const c=document.getElementById(n);c?n=c:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=Sr(Sr(Sr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(o):(n instanceof HTMLVideoElement?this._player=new Q1(o):this._player=new VW(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Kv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},Q("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),n),!n){this._originMediaStreamTrack.enabled=!1;try{await tr(this,lt.NEED_DISABLE_TRACK,this)}catch(o){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await tr(this,lt.NEED_ENABLE_TRACK,this)}catch(o){throw N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await tr(this,lt.NEED_MUTE_TRACK,this):await tr(this,lt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Ce(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=Vd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const o=qI({encoderConfig:n});(as()||so()||Vl())&&(o.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Ce(Y.UNEXPECTED_ERROR,c.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=n,this._hints.indexOf(rr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await tr(this,lt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(N)}}getStats(){return zf(()=>{N.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),hc(this,lt.GET_STATS)||Sr({},z1)}async setBeautyEffect(n){N.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(n,i):await J1(n)}async setBitrateLimit(n){N.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n&&(this._forceBitrateLimit=n,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<n.max_bitrate?this._encoderConfig.bitrateMax:n.max_bitrate:this._encoderConfig.bitrateMax=n.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=n.min_bitrate))}async setOptimizationMode(n){if(n!=="motion"&&n!=="detail"&&n!=="balanced")return void N.error(Y.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=n,await tr(this,lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,N.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}N.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(n,")"))}setScalabiltyMode(n){if(n.numSpatialLayers===1&&n.numTemporalLayers!==1)return N.error(Y.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,N.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){q6(this._originMediaStreamTrack).then(n=>{let[i,o]=n;this._videoHeight=o,this._videoWidth=i}).catch(UI)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(n){if(!this._enabled)throw new Ce(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");N.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(n)),n=Vd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),this._encoderConfig=n,this._hints.indexOf(rr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await tr(this,lt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(N)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!n||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:f}=function(_,v,y,w,I){const P=Q("BITRATE_ADAPTER_TYPE");if(P==="DEFAULT_BITRATE")return{min:w,max:I};if(I===void 0){var F;const M=Math.floor(200*Math.pow(y/15,.6)*Math.pow(_*v/640/360,.75));I=P==="STANDARD_BITRATE"?4*M:2*M,w=(F=w)!==null&&F!==void 0?F:M}else{var x;w=(x=w)!==null&&x!==void 0?x:Math.floor(I/10)}return{min:w,max:I}}(n,i,o,u,c);this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=h,N.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(f,"]"))}}getVideoElementVisibleStatus(){try{var n,i;const o=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=Y5.checkOneElementVisible(u),_=Object.assign({},f);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const v=Et.reportApiInvoke(null,{tag:kr.TRACER,name:hi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Ce(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(n){}pipe(n){if(this.processor===n)return n;if(n._source)throw new Ce(Y.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=Sr(Sr({},o),Vd(n))),o=zg(o);const c=nr(8,"track-video-cloned-"),u=new Vre(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,zg(this._scalabilityMode),this._optimizationMode,c,zg(this._hints));return n&&o&&u.setEncoderConfiguration(o),N.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(n,i){if(!(n instanceof MediaStreamTrack))throw new Ce(Y.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(n.kind!=="video")throw new Ce(Y.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(n,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(n){if(zf(()=>{Et.reportApiInvoke(null,{name:hi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:kr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Q("ENABLE_VIDEO_SEI")||!Q("ENABLE_ENCODED_TRANSFORM"))return void N.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(n instanceof Uint8Array==0)return new Ce(Y.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void N.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",n):N.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(oo.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(),await tr(this,lt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await tr(this,lt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(gc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(gc.REQUEST_CONSTRAINTS)}},Sn(mn.prototype,"play",[FW,jW],Object.getOwnPropertyDescriptor(mn.prototype,"play"),mn.prototype),Sn(mn.prototype,"stop",[BW],Object.getOwnPropertyDescriptor(mn.prototype,"stop"),mn.prototype),Sn(mn.prototype,"setEnabled",[WW,GW,zW],Object.getOwnPropertyDescriptor(mn.prototype,"setEnabled"),mn.prototype),Sn(mn.prototype,"setMuted",[HW,KW,$W],Object.getOwnPropertyDescriptor(mn.prototype,"setMuted"),mn.prototype),Sn(mn.prototype,"setEncoderConfiguration",[qW,YW],Object.getOwnPropertyDescriptor(mn.prototype,"setEncoderConfiguration"),mn.prototype),Sn(mn.prototype,"getStats",[XW],Object.getOwnPropertyDescriptor(mn.prototype,"getStats"),mn.prototype),Sn(mn.prototype,"setBeautyEffect",[JW,QW],Object.getOwnPropertyDescriptor(mn.prototype,"setBeautyEffect"),mn.prototype),Sn(mn.prototype,"getCurrentFrameData",[ZW],Object.getOwnPropertyDescriptor(mn.prototype,"getCurrentFrameData"),mn.prototype),Sn(mn.prototype,"getCurrentFrameImage",[eG],Object.getOwnPropertyDescriptor(mn.prototype,"getCurrentFrameImage"),mn.prototype),Sn(mn.prototype,"setBitrateLimit",[tG],Object.getOwnPropertyDescriptor(mn.prototype,"setBitrateLimit"),mn.prototype),Sn(mn.prototype,"setOptimizationMode",[nG],Object.getOwnPropertyDescriptor(mn.prototype,"setOptimizationMode"),mn.prototype),Sn(mn.prototype,"setScalabiltyMode",[rG],Object.getOwnPropertyDescriptor(mn.prototype,"setScalabiltyMode"),mn.prototype),Sn(mn.prototype,"updateMediaStreamTrackResolution",[iG],Object.getOwnPropertyDescriptor(mn.prototype,"updateMediaStreamTrackResolution"),mn.prototype),Sn(mn.prototype,"pipe",[sG],Object.getOwnPropertyDescriptor(mn.prototype,"pipe"),mn.prototype),Sn(mn.prototype,"unpipe",[oG],Object.getOwnPropertyDescriptor(mn.prototype,"unpipe"),mn.prototype),Sn(mn.prototype,"close",[aG],Object.getOwnPropertyDescriptor(mn.prototype,"close"),mn.prototype),Sn(mn.prototype,"replaceTrack",[cG],Object.getOwnPropertyDescriptor(mn.prototype,"replaceTrack"),mn.prototype),mn),Z1=(lG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),uG=$r(),dG=jv("CameraVideoTrack","_enabledMutex"),hG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),pG=$r(),fG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),mG=$r(),gG=At({argsMap:e=>[e.getTrackId()]}),Sc=class Fre extends hr{get __className__(){return"CameraVideoTrack"}constructor(n,i,o,c,u,h){super(n,Vd(i.encoderConfig),c,u,h),Se(this,"_config",void 0),Se(this,"_originalConstraints",void 0),Se(this,"_constraints",void 0),Se(this,"_enabled",!0),Se(this,"_deviceName","default"),Se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Uv()||E1())&&!function(){const f=vn();if(f.os!==Ci.IOS||!f.osVersion)return!1;const _=f.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&H5()&&this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=n.label,this._encoderConfig=Vd(this._config.encoderConfig),$n.on($i.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),$n.on($i.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(n){return typeof n=="string"?this._setDeviceById(n):n.deviceId?this._setDeviceById(n.deviceId):n.facingMode?this._setDeviceByFacingModel(n.facingMode):void 0}async _setDeviceById(n){if(N.info("[".concat(this.getTrackId(),"] set device to ").concat(n)),this._enabled)try{const i=await vc.getDeviceById(n),o={};o.video=Sr({},this._constraints),o.video.deviceId={exact:n},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Ec(o,this.getTrackId())}catch(u){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Ec({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await vc.getDeviceById(n);this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}N.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(n){N.info("[".concat(this.getTrackId(),"] set facingMode ").concat(n));const i={video:Sr(Sr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Ec(i,this.getTrackId())}catch(c){throw N.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await Ec({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=n,this._config.cameraId=void 0,this._constraints=Sr({},i.video),N.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Ec({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await tr(this,lt.NEED_ENABLE_TRACK,this)}catch(o){throw N.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await tr(this,lt.NEED_DISABLE_TRACK,this)}catch(o){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Ce(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=Vd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate||n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate||n.bitrateMin);const o=Dr(this._config);o.encoderConfig=n;const c=qI(o);(as()||so()||Vl())&&(c.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Ce(Y.UNEXPECTED_ERROR,u.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=n,this._hints.indexOf(rr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await tr(this,lt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(N)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((so()||Vl())&&this._enabled&&!this._isClosed&&$n.duringInterruption){const n=async()=>{$n.off($i.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};$n.on($i.IOS_INTERRUPTION_END,n)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Kv.TRACK_ENDED)}async renewMediaStreamTrack(n){const i=n||this._constraints,o=vc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await Ec({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),$n.off($i.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),$n.off($i.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=Sr(Sr({},o),Vd(n))),o=zg(o);const c=nr(8,"track-cam-cloned-"),u=new Fre(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,zg(Sr(Sr({},this._config),{},{encoderConfig:o})),zg(this._constraints),zg(this._scalabilityMode),this._optimizationMode,c);return n&&o&&u.setEncoderConfiguration(o),N.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(gc.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(gc.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}},Sn(Sc.prototype,"setDevice",[lG,uG],Object.getOwnPropertyDescriptor(Sc.prototype,"setDevice"),Sc.prototype),Sn(Sc.prototype,"setEnabled",[dG,hG,pG],Object.getOwnPropertyDescriptor(Sc.prototype,"setEnabled"),Sc.prototype),Sn(Sc.prototype,"setEncoderConfiguration",[fG,mG],Object.getOwnPropertyDescriptor(Sc.prototype,"setEncoderConfiguration"),Sc.prototype),Sn(Sc.prototype,"close",[gG],Object.getOwnPropertyDescriptor(Sc.prototype,"close"),Sc.prototype),Sc);function eL(e,n,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=Sr(Sr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(n.contentHint=i.optimizationMode,n.contentHint===i.optimizationMode?N.debug("[".concat(e,"] set content hint to"),i.optimizationMode):N.debug("[".concat(e,"] set content hint failed")))):N.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var _G,EG,vG,yG,Qc,SG,TG,bG,wG,RG,CG,Bs;class IG extends D6{getUserId(){return this._userId}constructor(n,i,o,c){super(n,"track-".concat(n.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(nr(5,""))),Se(this,"_userId",void 0),Se(this,"_uintId",void 0),Se(this,"_isDestroyed",!1),Se(this,"store",void 0),Se(this,"processor",void 0),Se(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,N.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Qv=(_G=At({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),EG=At({argsMap:e=>[e.getTrackId()]}),vG=At({argsMap:(e,n)=>[e.getTrackId(),n.name]}),yG=At({argsMap:e=>[e.getTrackId()]}),Sn((Qc=class extends IG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==js.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,n,i,o){super(e,n,i,o),Se(this,"_videoVisibleTimer",null),Se(this,"_previousVideoVisibleStatus",void 0),Se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Se(this,"trackMediaType",qv.VIDEO),Se(this,"_videoWidth",void 0),Se(this,"_videoHeight",void 0),Se(this,"_player",void 0),Se(this,"processorDestination",void 0),Se(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new H6(this.getTrackId(),"remote"),this.processorDestination=new z6(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return zf(()=>{N.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),hc(this,lt.GET_STATS)||Sr({},N6)}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Sr(Sr({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new Q1(i):this._player=new VW(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit($v.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit($v.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit($v.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},Q("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){q6(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(UI)}_updatePlayerSource(){N.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=Y5.checkOneElementVisible(c),f=Object.assign({},h);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;const _=Et.reportApiInvoke(null,{tag:kr.TRACER,name:hi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(i){throw new Ce(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ce(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(oo.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(qg.SEI_RECEIVED,e)}}).prototype,"play",[_G],Object.getOwnPropertyDescriptor(Qc.prototype,"play"),Qc.prototype),Sn(Qc.prototype,"stop",[EG],Object.getOwnPropertyDescriptor(Qc.prototype,"stop"),Qc.prototype),Sn(Qc.prototype,"pipe",[vG],Object.getOwnPropertyDescriptor(Qc.prototype,"pipe"),Qc.prototype),Sn(Qc.prototype,"unpipe",[yG],Object.getOwnPropertyDescriptor(Qc.prototype,"unpipe"),Qc.prototype),Qc),Zv=(SG=At({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),TG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),bG=At({argsMap:e=>[e.getTrackId()]}),wG=At({argsMap:e=>[e.getTrackId()]}),RG=At({argsMap:(e,n)=>[e.getTrackId(),n.name]}),CG=At({argsMap:e=>[e.getTrackId()]}),Sn((Bs=class extends IG{get isPlaying(){return this._useAudioElement?Lo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,n,i,o){super(e,n,i,o),Se(this,"trackMediaType",qv.AUDIO),Se(this,"_source",void 0),Se(this,"_useAudioElement",!0),Se(this,"_volume",100),Se(this,"processorContext",void 0),Se(this,"processorDestination",void 0),Se(this,"_played",!1),Se(this,"_bypassWebAudio",!1),Q("DISABLE_WEBAUDIO")?(this._source=new X1,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new U6(e,!0),Q("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(mc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit($v.FIRST_FRAME_DECODED)}),this.processorContext=new $6(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new K6(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(mc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(mc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(mc.ON_AUDIO_BUFFER),this._source.on(mc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?Lo.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!I6())throw new Ce(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Lo.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return zf(()=>{N.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),hc(this,lt.GET_STATS)||Sr({},P6)}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] use audio element to play")),Lo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Lo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Lo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ce(Y.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ce(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ce(Y.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(oo.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(oo.ON_NODE,e=>{this._source.processedNode=e;const n=!e;this._useAudioElement!==n&&(this._played?(this.stop(),this._useAudioElement=n,this.play()):this._useAudioElement=n)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oo.ON_TRACK),this.processorDestination.removeAllListeners(oo.ON_NODE)}}).prototype,"setVolume",[SG],Object.getOwnPropertyDescriptor(Bs.prototype,"setVolume"),Bs.prototype),Sn(Bs.prototype,"setPlaybackDevice",[TG],Object.getOwnPropertyDescriptor(Bs.prototype,"setPlaybackDevice"),Bs.prototype),Sn(Bs.prototype,"play",[bG],Object.getOwnPropertyDescriptor(Bs.prototype,"play"),Bs.prototype),Sn(Bs.prototype,"stop",[wG],Object.getOwnPropertyDescriptor(Bs.prototype,"stop"),Bs.prototype),Sn(Bs.prototype,"pipe",[RG],Object.getOwnPropertyDescriptor(Bs.prototype,"pipe"),Bs.prototype),Sn(Bs.prototype,"unpipe",[CG],Object.getOwnPropertyDescriptor(Bs.prototype,"unpipe"),Bs.prototype),Bs);const hp=new class extends Rr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Se(this,"_lastHiddenTime",0),Se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),N.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class AG extends Rr{constructor(n,i){super(),Se(this,"trackMediaType",qv.DATA),Se(this,"_version",1),Se(this,"_type",3),Se(this,"_config",void 0),Se(this,"_originDataChannel",void 0),Se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Se(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Se(this,"_datachannelEventMap",new Map),this._config=n,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(n){this._dataStreamPacketHandler=n}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Q("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&n!==void 0?n:"connecting"}get _originDataChannelId(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&n!==void 0?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new tt((n,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&n();const o=setTimeout(()=>{var c;i(new Ce(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),n()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Ce(Y.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Ce(Y.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[KI.OPEN,KI.CLOSE,KI.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),n.addEventListener(i,o)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;n.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Yde extends AG{constructor(n){super(n),Se(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(Q("SHOW_DATASTREAM2_LOG")&&N.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(KI.MESSAGE,u)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Xde extends AG{send(n){if(this._originDataChannel){let i=n;i=this._dataStreamPacketHandler.serialize(n);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function XI(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>XC.revokeObjectURL(e),0),new Worker(XC.createObjectURL(e))}const OG=71,tL=1,nL=2,rL=1,PG=2;var pp=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(pp||{});function NG(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==OG)return;const o=e.getUint16(1),c=tL+nL+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let f=tL+nL;for(;f<c;){const _=e.getUint8(f),v=e.getUint16(f+rL),y=rL+PG;if(_===pp.AUDIO_LEVEL){let w=e.getUint8(f+y);for(let I=1;I<v;I++)w=w<<8|e.getUint8(f+y+I);h.tlv.push({tag:_,length:v,value:n?127^w>>1:127&w})}else if(_===pp.METADATA||_===pp.AUDIO_64_BIT_PTS){const w=new Uint8Array(v);for(let I=0;I<v;I++)w[I]=e.getUint8(f+y+I);h.tlv.push({tag:_,length:v,value:w})}f+=y+v}return h}const JI=new Map,QI=127,Jg=1e-10,iL=139/13,ZI=new Map;function sL(e,n,i){const o="".concat(e,"-").concat(n,"-").concat(i);let c=0;return ZI.has(o)?c=ZI.get(o):(c=Math.log(function(h,f){const _=h-f;f<_&&(f=_);let v=1;for(let y=h,w=1;y>f;y--,w++)v=v*y/w;return v}(n,e))+e*Math.log(.5)+(n-e)*Math.log(1-.5)-Math.log(i)+i*e,ZI.set(o,c)),c<Jg&&(c=Jg),c}function kG(e,n,i){const o=n.length,c=e.length/o;let u=!1;for(let h=0,f=0;h<o;h++){let _=0;for(let v=f+c;f<v;f++)e[f]>i&&_++;n[h]!==_&&(n[h]=_,u=!0)}return u}window.cache=ZI;let Jde=0;class DG{constructor(n){Se(this,"id",void 0),Se(this,"immediates",[]),Se(this,"lastNonSilence",-1),Se(this,"immediateSpeechActivityScore",Jg),Se(this,"lastLevelChangedTime",Date.now()),Se(this,"levels",[]),Se(this,"longs",[]),Se(this,"longSpeechActivityScore",Jg),Se(this,"mediums",[]),Se(this,"mediumSpeechActivityScore",Jg),Se(this,"minLevel",0),Se(this,"nextMinLevel",0),Se(this,"nextMinLevelWindowLength",0),Se(this,"energyScore",0),this.id=n||"".concat(Jde++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const n=this.immediates,i=this.levels,o=this.minLevel+iL;let c=!1;for(let u=0;u<n.length;++u){let h=i[u];h<o&&(h=0);const f=Math.floor(h/iL);n[u]!==f&&(n[u]=f,c=!0)}return c}computeLongs(){return kG(this.mediums,this.longs,4)}computeMediums(){return kG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=sL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(n){this.longSpeechActivityScore=sL(this.longs[0],10,47),this.longSpeechActivityScore>Jg&&(this.lastNonSilence=n)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=sL(this.mediums[0],5,24)}evaluateSpeechActivityScores(n){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(n)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var n;return"[".concat(_f(n=[...this.levels]).call(n).join(),"]")}getSpeechActivityScore(n){switch(n){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+n)}}levelChanged(n,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=n;return n<0&&(o=0),n>QI&&(o=QI),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+iL?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(n){if(n!==0){if(this.minLevel===0||this.minLevel>n)return this.minLevel=n,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=n,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>n&&(this.nextMinLevel=n),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>QI&&(i=QI),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Qde{constructor(n){Se(this,"algorithm",void 0),this.algorithm=n}execute(){let n=!this.algorithm;if(!n)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?n=!0:setTimeout(this.execute.bind(this),i)}catch{n=!0}n&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class oL{constructor(n,i,o){Se(this,"isDominant",void 0),Se(this,"energyRanking",void 0),Se(this,"energyScore",void 0),this.isDominant=n,this.energyRanking=i,this.energyScore=o}}class Zde extends Rr{constructor(n){super(),Se(this,"dominantId",null),Se(this,"lastDecisionTime",0),Se(this,"lastLevelChangedTime",0),Se(this,"lastLevelIdleTime",0),Se(this,"relativeSpeechActivities",[]),Se(this,"speakers",new Map),Se(this,"enableSilence",!1),Se(this,"timeoutToSilenceInterval",0),Se(this,"decisionMaker",null),Se(this,"loudest",[]),Se(this,"numLoudestToTrack",3),Se(this,"energyExpireTimeMs",250),Se(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=n,this.enableSilence=n>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=n,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>n&&this.loudest.splice(n)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(n){return this.loudest.some(i=>i.id===n)}levelChanged(n,i){const o=Date.now(),c=this.getOrCreateSpeaker(n);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(n){return this.decisionMaker!==n||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(n){this.decisionMaker===n&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(n){n.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(n){n.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(n){let i=this.speakers.get(n);return i||(i=new DG(n),this.speakers.set(n,i),this.maybeStartDecisionMaker()),i}updateLoudestList(n,i,o){const c=n.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==n;)++_;return new oL(c,_,n.energyScore)}if(n.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*n.energyScore+50)/100),this.numLoudestToTrack===0)return new oL(c,0,n.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==n.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let f=0;for(;f<this.loudest.length&&!(this.loudest[f].energyScore<n.energyScore);)++f;return f<this.numLoudestToTrack&&(this.loudest.splice(f,0,n),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new oL(c,f,n.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Qde(this),this.decisionMaker.execute())}makeDecision(n){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const f=uc(h=this.speakers).call(h).next().value;this.enableSilence&&f&&(u=f.id,f.evaluateSpeechActivityScores(n),n-f.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let f=this.dominantId==null?null:this.speakers.get(this.dominantId);if(f==null){const y=this.speakers.entries().next();y.value&&(u=y.value[0],f=y.value[1])}else u=f.id;f!=null&&f.evaluateSpeechActivityScores(n);const _=this.relativeSpeechActivities;let v=2;for(const y of this.speakers.entries()){const[w,I]=y;if(I===f)continue;I.evaluateSpeechActivityScores(n);for(let M=0;M<_.length;++M){const $=f==null?Jg:f.getSpeechActivityScore(M);_[M]=Math.log(I.getSpeechActivityScore(M)/$)}const P=_[0],F=_[1],x=_[2];P>3&&F>2&&x>0&&F>v&&(v=F,u=w)}this.enableSilence&&f!=null&&u===f.id&&n-f.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const n=Date.now(),i=300-(n-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(n),this.lastLevelIdleTime=n):o=i;let c=300-(n-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=n,this.makeDecision(n),c=300-(Date.now()-n)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(n){const i=[];for(const c of uc(o=this.speakers).call(o)){var o;const u=n-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const ey=new Map;let Wu=null,eA=null;const LG=3;let Qg=[];const Gu=new Map,tA=new Map;class ehe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(n,i){Se(this,"id",void 0),Se(this,"track",void 0),Se(this,"score",0),Se(this,"active",!0),Se(this,"muted",!1),Se(this,"timer",0),Se(this,"actives",0),Se(this,"inactives",0),this.id=n,this.track=i,this.setActive(Gu.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const n=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(uc(Gu).call(Gu)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&n&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(n){this.active=n,this.resetTimer(),this.setMuted(!n)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const n=function(i){let o;return Array.from(uc(Gu).call(Gu)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);n&&this.activeRate-n.activeRate>.4&&(n.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const n=function(i){let o;return Array.from(uc(Gu).call(Gu)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);n&&n.activeRate-this.activeRate>.4&&(n.setActive(!0),this.setActive(!1))}addSample(n){n?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(n){this.track&&(this.track.enabled=!n,this.muted=n)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let nA;function xG(e){const n=Gu.get(e);n&&(Gu.delete(e),n.clearTimer())}const rA=new Map,the=new Map;function nhe(e,n,i){let o=new Uint8Array(e,n,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const iA=new Map,R0=new Map;(function(){const e=vn();Ki.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ki.getStreamFromExtension=e.name===Dn.CHROME&&Number(e.version)>34,Ki.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let i=!1;try{n.addTransceiver("audio"),i=!0}catch{}return n.close(),i}(),Ki.supportMinBitrate=e.name===Dn.CHROME||e.name===Dn.EDGE,Ki.supportSetRtpSenderParameters=function(){const n=vn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!lp()||!(!as()&&!DI())||n.name===Dn.FIREFOX&&Number(n.version)>=64)}(),e.name===Dn.SAFARI&&(Number(e.version)>=14?Ki.supportDualStream=!0:Ki.supportDualStream=!1),Ki.webAudioMediaStreamDest=function(){const n=vn();return!(n.name===Dn.SAFARI&&Number(n.version)<12)}(),Ki.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ki.supportWebGL=typeof WebGLRenderingContext<"u",Ki.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,lp()||(Ki.webAudioWithAEC=!0),Ki.supportShareAudio=function(){const n=vn();return(n.os===Ci.WIN_10||n.os===Ci.WIN_81||n.os===Ci.WIN_7||n.os===Ci.LINUX||n.os===Ci.MAC_OS||n.os===Ci.CHROMIUM_OS)&&n.name===Dn.CHROME&&Number(n.version)>=74}(),Ki.supportDataChannel=!!(f0(76)||function(n){const i=vn();return!(i.name!==Dn.FIREFOX||!i.osVersion)&&Number(i.version)>=n}(68)||j5(14)),Ki.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!Pr()&&!!n&&n.prototype.setConfiguration instanceof Function}(),Ki.supportWebRTCEncodedTransform=function(){const n=vn();return n.name==="Chrome"&&Number(n.version)>=87||n.name==="Safari"&&Number(n.version)>=15}(),Ki.supportWebRTCInsertableStream=function(){const n=vn();return(n.name===Dn.CHROME||n.name===Dn.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ki.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ki.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,MI(()=>{Ki.supportDualStreamEncoding=function(){const n=vn();return!!Q("DISABLE_WEBAUDIO")||n.name==="Safari"&&Number(n.version)>=14||!!(n.name==="Chrome"&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&Q("CHROME_DUAL_STREAM_USE_ENCODING"))}(),N.debug("browser ua: ",navigator.userAgent),N.info("browser info: ",e),N.info("browser compatibility: ",Ki)})})();const rhe=["CHINA","GLOBAL"],MG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Zg=[],ty=[];function e_(e,n){return!!n&&Zg.some(i=>i.uid===e&&i.channelName===n)}function aL(){return ty.length>0}var ihe=i3.forEach,UG=Uh("forEach")?[].forEach:function(e){return ihe(this,e,arguments.length>1?arguments[1]:void 0)};kn({target:"Array",proto:!0,forced:[].forEach!=UG},{forEach:UG});var she=Ia("Array").forEach,ohe=Za,ahe=li,che=k,lhe=she,cL=Array.prototype,uhe={DOMTokenList:!0,NodeList:!0},dhe=function(e){var n=e.forEach;return e===cL||che(cL,e)&&n===cL.forEach||ahe(uhe,ohe(e))?lhe:n},hhe=l(dhe),phe=go,VG=nc;kn({target:"Object",stat:!0,forced:d(function(){VG(1)})},{keys:function(e){return VG(phe(e))}});var FG=l(ft.Object.keys),fhe=l(dE),mhe=l(pE),ghe=kn,jG=ig,_he=Ig,Ehe=ut,BG=de,vhe=ei,yhe=ve,She=VC,The=ar,bhe=rs,whe=q4("slice"),Rhe=The("species"),lL=Array,Che=Math.max;ghe({target:"Array",proto:!0,forced:!whe},{slice:function(e,n){var i,o,c,u=yhe(this),h=vhe(u),f=BG(e,h),_=BG(n===void 0?h:n,h);if(jG(u)&&(i=u.constructor,(_he(i)&&(i===lL||jG(i.prototype))||Ehe(i)&&(i=i[Rhe])===null)&&(i=void 0),i===lL||i===void 0))return bhe(u,f,_);for(o=new(i===void 0?lL:i)(Che(_-f,0)),c=0;f<_;f++,c++)f in u&&She(o,c,u[f]);return o.length=c,o}});var Ihe=Ia("Array").slice,Ahe=k,Ohe=Ihe,uL=Array.prototype,Phe=function(e){var n=e.slice;return e===uL||Ahe(uL,e)&&n===uL.slice?Ohe:n},Nhe=l(Phe);function dt(e,n,i,o,c){var u,h,f,_={};return hhe(u=FG(o)).call(u,function(v){_[v]=o[v]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=fhe(h=mhe(f=Nhe(i).call(i)).call(f)).call(h,function(v,y){return y(e,n,v)||v},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(z4(e,n,_),_=null),_}let sA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),dL=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Bl=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),ao=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Rt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),or=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Lt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Dt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),C0=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),cn=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),co=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Bt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function oA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw N.error("Invalid Channel Name ".concat(e)),new Te(Y.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function aA(e){if(n=e,!(typeof n=="number"&&Math.floor(n)===n&&0<=n&&n<=4294967295||q5(e,1,255)))throw new Te(Y.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;typeof e=="string"&&N.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let fp=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const khe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},hL={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function pL(e,n){zi(e.url,"".concat(n,".url"),1,1e3,!1),Nr(e.x)||Xn(e.x,"".concat(n,".x"),0,1e4),Nr(e.y)||Xn(e.y,"".concat(n,".y"),0,1e4),Nr(e.width)||Xn(e.width,"".concat(n,".width"),0,1e4),Nr(e.height)||Xn(e.height,"".concat(n,".height"),0,1e4),Nr(e.zOrder)||Xn(e.zOrder,"".concat(n,".zOrder"),0,255),Nr(e.alpha)||Xn(e.alpha,"".concat(n,".alpha"),0,1,!1)}const Dhe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let $f=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),fL=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),vi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function WG(e){if(!e.channelName)throw new Te(Y.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Te(Y.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&zi(e.token,"info.token",1,2047),aA(e.uid),oA(e.channelName),!0}let lo=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),mp=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),la=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),ny=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Fn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Vi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),cA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Ai=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Ln=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const GG=[Ln.AFRICA,Ln.ASIA,Ln.CHINA,Ln.EUROPE,Ln.GLOBAL,Ln.INDIA,Ln.JAPAN,Ln.NORTH_AMERICA,Ln.OCEANIA,Ln.OVERSEA,Ln.SOUTH_AMERICA];let gs=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const lA={CHINA:{},ASIA:{CODE:gs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:gs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:gs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:gs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:gs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:gs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:gs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:gs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:gs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:gs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:gs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:gs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:gs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};x1&&(lA.CHINA={CODE:gs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let I0=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function zG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class HG extends Rr{constructor(n,i){super(),z(this,"onICEConnectionStateChange",void 0),z(this,"onConnectionStateChange",void 0),z(this,"onDTLSTransportStateChange",void 0),z(this,"onDTLSTransportError",void 0),z(this,"onICETransportStateChange",void 0),z(this,"onFirstAudioReceived",void 0),z(this,"onFirstVideoReceived",void 0),z(this,"onFirstAudioDecoded",void 0),z(this,"onFirstVideoDecoded",void 0),z(this,"onFirstVideoDecodedTimeout",void 0),z(this,"onSelectedLocalCandidateChanged",void 0),z(this,"onSelectedRemoteCandidateChanged",void 0),z(this,"onICECandidateError",void 0),z(this,"getLocalVideoStats",void 0)}}class KG extends HG{constructor(n,i){super(n,i),z(this,"establishPromise",void 0)}}let at=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),_s=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),gp=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const $G=["disconnected","failed"];let Ve=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Vn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),bt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Wl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Gl=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Fi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),qG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Bd=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Zc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),zu=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),ry=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),qr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),iy=function(e){return e.ABORT="abort",e}({}),qf=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Lhe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const xhe={[sA.ACCESS_POINT]:{[ao.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ao.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ao.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ao.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ao.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ao.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ao.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[sA.UNILBS]:{[Bl.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Bl.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Bl.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Bl.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Bl.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Bl.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Bl.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Bl.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Bl.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Bl.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Bl.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Bl.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[sA.STRING_UID_ALLOCATOR]:{[dL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[dL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[dL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function sy(e){const n=xhe[Math.floor(e/1e4)];if(!n)return{desc:"unknown error",retry:!1};const i=n[e%1e4];if(!i){if(Math.floor(e/1e4)===sA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Mhe={[Rt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Rt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Rt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Rt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Rt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Rt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Rt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Rt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Rt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Rt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Rt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Rt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Rt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Rt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Rt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Rt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Rt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Rt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Rt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Rt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Rt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Rt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Rt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Rt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Rt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Rt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Rt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Rt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Rt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Rt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Rt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Rt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Rt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Rt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Rt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Rt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Rt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Rt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Rt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Rt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Rt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Rt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Rt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Rt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Rt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Rt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Rt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Rt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Rt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Rt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Rt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Rt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Rt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Rt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Rt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Rt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Rt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Rt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Rt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Rt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Rt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Rt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Rt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function A0(e){return Mhe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function YG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function mL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?YG(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):YG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function XG(e,n){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(n){const u=Q("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Uhe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Vhe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Fhe=/wss:\/\/(.+):([0-9]+)\/?/,jhe=/wss:\/\/(.[^\/]+)\/?/;let Bhe=0;class Whe{constructor(n,i){z(this,"id",0),z(this,"store",void 0),z(this,"recordIndex",void 0),z(this,"websockets",[]),z(this,"try443PortDuration",2e3),z(this,"forceCloseWSDuration",5e3),z(this,"try443PortTimeout",null),z(this,"forceCloseTimeout",null),z(this,"isTry443PortFailed",!1),z(this,"isNormalPortFailed",!1),z(this,"useDoubleDomain",!1),z(this,"useProxy",!1),z(this,"startTime",Date.now()),this.id=++Bhe,this.try443PortDuration=Q("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var n;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];N.debug("[choose-best-ws ".concat((n=this.store)===null||n===void 0?void 0:n.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(n,i,o){this.logger("createWebSocket:",n,{isTry443Port:i,hasTimeoutDetection:o});const c=Q("GATEWAY_DOMAINS"),u=Date.now(),h=[],f=c.find(I=>{var P;return Xe(P=n.host).call(P,I)});f||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(I=>{_.push(XG(mL(mL({},n),{},{host:n.host.replace(f,I)}),i))});else{const I=mL({},n);if(i&&f){const P=c.find(F=>F!==f);P&&(I.host=I.host.replace(f,P))}_.push(XG(I,i))}try{_.forEach(I=>{const P=new WebSocket(I);P.binaryType="arraybuffer",h.push(P),this.logger("ws is connecting:",P.url)})}catch(I){if(this.logger("ws create failed"),h.forEach(P=>P.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,i,o);if(!i&&Number(n.port)!==443)return this.createWebSocket(n,!0,o);throw new Te(Y.WS_ERR,"init websocket failed! Error: ".concat(I.toString()))}const v=p0();this.store&&this.store.recordJoinChannelService({urls:h.map(I=>I.url),service:"gateway"},this.recordIndex),h.forEach(I=>{I.onopen=()=>{this.logger("onopen: ws ".concat(I.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(P=>{P!==I&&(P.onopen=null,P.onclose=null,P.onmessage=null,P.close(),this.logger("close backup websocket: ".concat(P.url)))}),this.websockets.length=0,v.resolve(I)},I.onclose=P=>{this.logger("onclose: ws ".concat(I.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(I.readyState));const F=h.every(x=>x.readyState===WebSocket.CLOSED||x.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(F)),F&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(P.reason)),v.reject({code:P.code,reason:cA.A_ROUND_WS_FAILED})):!i&&F&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),i?this.isTry443PortFailed=F:this.isNormalPortFailed=F},I.onmessage=P=>this.logger("".concat(I.url," onmessage: ").concat(P.data))}),this.websockets.push(...h);const y=()=>{this.websockets.forEach(I=>I.readyState!==WebSocket.OPEN&&I.close())},w=()=>{if(v.isResolved)return y();vn().os===Ci.MAC_OS&&Pr()&&y(),this.createWebSocket(n,!0,!0).then(I=>{v.resolve(I)}).catch(I=>{this.isNormalPortFailed&&v.reject(I),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,y()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,y()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(n,i,o,c){return this.useDoubleDomain=!!i,typeof n=="string"&&(n=function(u){let h,f,_;return[,h,f,_]=u.match(Uhe)||[],h||([,f,_]=u.match(Vhe)||[]),f&&_||([,f,_]=u.match(Fhe)||[]),f&&_||([,f]=u.match(jhe)||[]),f||N.warning("un-destructible url: ",u),{proxy:h,host:f,port:_||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,o&&this.useProxy&&(N.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(n,!!o,!1).finally(()=>this.clearTimeout())}}function JG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class QG extends Rr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;Xe(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,this._state==="reconnecting"?this.emit(Bt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Bt.CONNECTED):this._state==="closed"?this.emit(Bt.CLOSED):this._state==="failed"&&this.emit(Bt.FAILED))}resetReconnectCount(n){N.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),z(this,"connectionID",0),z(this,"currentURLIndex",0),z(this,"urls",[]),z(this,"_reconnectMode","tryNext"),z(this,"reconnectReason",void 0),z(this,"_initMutex",void 0),z(this,"name",void 0),z(this,"_state","closed"),z(this,"reconnectInterrupter",void 0),z(this,"websocket",void 0),z(this,"retryConfig",void 0),z(this,"reconnectCount",0),z(this,"forceCloseTimeout",5e3),z(this,"onlineReconnectListener",void 0),z(this,"useCompress",void 0),z(this,"tryDoubleDomain",!1),z(this,"use443PortOnly",!1),z(this,"wsInflateLength",0),z(this,"wsDeflateLength",0),z(this,"closeEstablishingWs",()=>{}),z(this,"store",void 0),z(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(w){for(var I=1;I<arguments.length;I++){var P=arguments[I]!=null?arguments[I]:{};I%2?JG(Object(P),!0).forEach(function(F){z(w,F,P[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(P)):JG(Object(P)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(P,F))})}return w}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new ms("websocket",h?h.clientId:void 0);const{timeout:f,timeoutFactor:_}=i,v=Math.max(300,Math.floor(3*f/5)),y=Math.max(1.2,Math.floor(8*_)/10);xa.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=y),ni.on(Vv.NETWORK_STATE_CHANGE,(w,I)=>{w!==I&&(this.resetReconnectCount("network state change: ".concat(I," -> ").concat(w)),w===xa.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=y):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=n,this.state="connecting";try{const c=p0(),u=this.urls[this.currentURLIndex];Q("ENABLE_PREALLOC_PC")&&this.emit(qG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Bt.CLOSED,()=>{c.reject(new Ce(Y.WS_DISCONNECT))}),this.once(Bt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,i){if(!this.websocket)return void N.warning("[".concat(this.name,"] can not reconnect, no websocket"));n!==void 0&&(this.reconnectMode=n),N.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ce(Y.WS_ABORT,"websocket is not ready");try{i||(n=JSON.stringify(n)),this.websocket.send(n)}catch(o){throw new Ce(Y.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(n){var i;const o=p0();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=y=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),N.debug("[".concat(this.name,"] websocket opened:"),y),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async y=>{var w;if(N.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Ce(Y.WS_DISCONNECT,"websocket close: ".concat(y.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=y.reason,this.state="reconnecting");const I=hc(this,Bt.WILL_RECONNECT,this.reconnectMode,y.reason)||this.reconnectMode,P=await this.reconnectWithAction(I);if(this.state==="closed")return void N.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!P)return o.reject(new Ce(Y.WS_DISCONNECT,"websocket reconnect failed: ".concat(y.code))),this.close(!0);o.resolve()}},h=y=>{this.emit(Bt.ON_MESSAGE,y)},f=y=>{N.warn("[".concat(this.connectionID,"] ws open error ").concat(y))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Q("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(n=Q("GATEWAY_WSS_ADDRESS")),N.debug("[".concat(this.name,"] start connect, url:"),n);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const y=await this.chooseBestWebsocketConnection(n);this.websocket=y,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=f,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(y){const w=this.state==="closed",I=y instanceof Ce,P=I&&y.code===Y.WS_ABORT,F=I&&y.code===Y.WS_ERR,x=I?y.message:y&&(y.reason||y.toString());N.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(x)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:P?"aborted":"error",errors:[y]},_),w||F?(o.reject(w?new Ce(Y.WS_DISCONNECT,"websocket is closed: ".concat(x)):new Ce(Y.WS_ERR,"init websocket failed: ".concat(x))),F&&N.error("[".concat(this.name,"] init websocket failed: ").concat(x))):u&&u(y)}return o.promise}async reconnectWithAction(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;N.warning("[choose-best-ws] action: =>",n),this.onlineReconnectListener||ni.isOnline||!ni.onlineWaiter||(this.onlineReconnectListener=ni.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=I1(this.reconnectCount,this.retryConfig);N.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(n)),await tt.race([Hi(h),this.onlineReconnectListener||new tt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,f)=>{this.emit(Bt.RECONNECT_CREATE_CONNECTION,f),await this.createWebSocketConnection(h)};try{if(n==="retry")await c(this.urls[this.currentURLIndex],n);else if(n==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);N.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],n)}else n==="recover"&&(N.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ls(this,Bt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],n))}catch(h){var u;N.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const f=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(f)&&Xe(f).call(f,"dynamic key expired")?(this.emit(Bt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(n,i)}return!0}}class gL extends QG{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){const o=p0(),c=function(h,f){return new Whe(h,f)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Ce(Y.WS_ABORT,"choose best websocket aborted"))};const u=Q("GATEWAY_DOMAINS");return N.debug("[choose-best-ws] currentDomain: ",n,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(n,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class O0 extends QG{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){return new tt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),h.forEach(F=>{F.onclose=null,F.onopen=null,F.onmessage=null,F.close()}),c(new Ce(Y.WS_ABORT,"choose best websocket aborted"))};const f=Q("GATEWAY_DOMAINS");let _;const v=n.indexOf("?h="),y=f.find(F=>v!==-1?Xe(n).call(n,F,v):Xe(n).call(n,F));N.debug("[choose-best-ws] currentDomain: ",y,", domains: ",f);let w=!this.tryDoubleDomain||!y;if(!w&&y){var I;const F=Date.now();try{f.forEach(x=>{const M=v===-1?n.replace(y,x):n.substr(0,v)+n.substr(v).replace(y,x),$=new WebSocket(M);$.binaryType="arraybuffer",h.push($),N.debug("[choose-best-ws] ws is connecting:",$.url)})}catch{for(N.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(M=>M.close());h.length;)h.pop();w=!0}(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:h.map(x=>x.url),service:"gateway"},i),h.forEach(x=>{x.onopen=()=>{if(u)return;const M=Date.now()-F;N.debug("[choose-best-ws] ws open cost ".concat(M,"ms")),h.filter($=>$!==x).forEach($=>{N.debug("[choose-best-ws]close backup websocket: ".concat($.url)),$.close()}),u=!0,o(x)},x.onclose=M=>{_=M,!u&&(h.find($=>!($.readyState===WebSocket.CLOSED||$.readyState===WebSocket.CLOSING))||(N.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},x.onmessage=M=>{N.debug("[choose-best-ws]".concat(x.url," onmessage: ").concat(M.data))}}),Hi(this.forceCloseTimeout).then(()=>{h.forEach(x=>{x.readyState!==WebSocket.OPEN&&x.close()})})}if(w){var P;let F;N.debug("[choose-best-ws] use single url: ",n),(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:[n],service:"gateway"},i);try{F=new WebSocket(n),h.push(F),F.binaryType="arraybuffer"}catch(x){const M=new Ce(Y.WS_ERR,"init websocket failed! Error: ".concat(x.toString()));return N.error("[".concat(this.name,"]").concat(M)),void c(M)}F.onopen=()=>{o(F)},F.onclose=x=>{c(x)},F.onmessage=x=>{N.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(x.data))},Hi(this.forceCloseTimeout).then(()=>{F&&F.readyState!==WebSocket.OPEN&&F.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Ghe extends Rr{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===or.CONNECTED?this.emit(Lt.WS_CONNECTED):n===or.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):n===or.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),z(this,"_disconnectedReason",void 0),z(this,"_websocketReconnectReason",void 0),z(this,"_connectionState",or.CLOSED),z(this,"reconnectToken",void 0),z(this,"websocket",void 0),z(this,"openConnectionTime",void 0),z(this,"clientId",void 0),z(this,"lastMsgTime",Date.now()),z(this,"uploadCache",[]),z(this,"uploadCacheInterval",void 0),z(this,"rttRolling",new u6(5)),z(this,"pingpongTimer",void 0),z(this,"wsInflateDataTimer",void 0),z(this,"pingpongTimeoutCount",0),z(this,"joinResponse",void 0),z(this,"multiIpOption",void 0),z(this,"initError",void 0),z(this,"spec",void 0),z(this,"store",void 0),z(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===cn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===cn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Un.UID_BANNED);break;case 15:this.close(Un.IP_BANNED);break;case 16:this.close(Un.CHANNEL_BANNED)}if(c._type===cn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Rt.ERR_LICENSE_MISSING:this.close(Un.LICENSE_MISSING);break;case Rt.ERR_LICENSE_EXPIRED:this.close(Un.LICENSE_EXPIRED);break;case Rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Un.LICENSE_MINUTES_EXCEEDED);break;case Rt.ERR_LICENSE_PERIOD_INVALID:this.close(Un.LICENSE_PERIOD_INVALID);break;case Rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Un.LICENSE_MULTIPLE_SDK_SERVICE);break;case Rt.ERR_LICENSE_ILLEGAL:this.close(Un.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new gL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Q("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Q("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===or.CONNECTED&&this.reconnect("retry",cs.OFFLINE)})}async request(n,i,o,c){const u=nr(6,""),h={_id:u,_type:n,_message:i},f=this.websocket.connectionID,_=()=>new tt((F,x)=>{if(this.connectionState===or.CONNECTED)return F();const M=()=>{this.off(Lt.WS_CLOSED,$),F()},$=()=>{this.off(Lt.WS_CONNECTED,M),x(new Te(Y.WS_ABORT))};this.once(Lt.WS_CONNECTED,M),this.once(Lt.WS_CLOSED,$),n!==Dt.PUBLISH&&n!==Dt.PUBLISH_DATASTREAM&&n!==Dt.SUBSCRIBE&&n!==Dt.SUBSCRIBE_DATASTREAM&&n!==Dt.UNSUBSCRIBE&&n!==Dt.UNSUBSCRIBE_DATASTREAM&&n!==Dt.UNPUBLISH&&n!==Dt.UNPUBLISH_DATASTREAM&&n!==Dt.CONTROL&&n!==Dt.RESTART_ICE||this.once(Lt.DISCONNECT_P2P,()=>{x(new Te(Y.DISCONNECT_P2P))}),n!==Dt.PUBLISH&&n!==Dt.RESTART_ICE||this.once(Lt.ABORT_P2P_EXECUTION,()=>{x(new Te(Y.DISCONNECT_P2P))})});if(this.connectionState!==or.CONNECTING&&this.connectionState!==or.RECONNECTING||n===Dt.JOIN||n===Dt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const v=new tt((F,x)=>{let M=!1;const $=(ae,me)=>{M=!0,F({isSuccess:ae==="success",message:me||{}}),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.emit(Lt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),$);const q=()=>{x(new Te(Y.WS_ABORT,"type: ".concat(n))),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.off("res-@".concat(u),$)};this.once(Lt.WS_CLOSED,q),this.once(Lt.WS_RECONNECTING,q),Hi(Q("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||M||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(Lt.REQUEST_TIMEOUT,n,i))})});let y=null;try{y=await v}catch(F){if(this.connectionState===or.CLOSED||n===Dt.LEAVE)throw new Te(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?F.throw():n===Dt.JOIN||n===Dt.REJOIN?null:(await _(),await this.request(n,i))}if(y.isSuccess)return y.message;const w=Number(y.message.error_code||y.message.code),I=A0(w),P=new Te(Y.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(y.message.error_str),{code:w,data:y.message,desc:I.desc});return I.action==="success"?y.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(I.desc,", action: ").concat(I.action)),w===Rt.ERR_TOO_MANY_BROADCASTERS?((n===Dt.JOIN||n===Dt.REJOIN)&&(this.initError=P,this.close()),P.throw()):I.action==="failed"?P.throw():I.action==="quit"?(this.initError=P,this.close(),P.throw()):(w===Rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",cs.MULTI_IP)):this.reconnect(I.action,cs.SERVER_ERROR),n===Dt.JOIN||n===Dt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new tt(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(C0.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=Q("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==or.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Q("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tt((i,o)=>{this.once(Lt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Lt.WS_CLOSED,c=>o(this.initError||new Te(Y.WS_ABORT,c))),this.connectionState=or.CONNECTING,this.websocket.init(n).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Un.LEAVE,this.connectionState=or.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION);const n=await ls(this,Lt.REQUEST_JOIN_INFO),i=await this.request(Dt.JOIN,n);if(!i)return this.emit(Lt.REPORT_JOIN_GATEWAY,cA.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Te(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const n=v0(this,Lt.REQUEST_REJOIN_INFO);n.token=this.reconnectToken;const i=await this.request(Dt.REJOIN,n);return!!i&&(this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(cn.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(cn.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(cn.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(cn.MUTE_AUDIO,{uid:o.uid}):this.emit(cn.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(cn.MUTE_VIDEO,{uid:o.uid}):this.emit(cn.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(cn.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(cn.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(cn.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(cn.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(cn.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){N.debug("[".concat(this.clientId,"] receive notification: "),n);const i=A0(n.code);if(n.code===28&&"detail"in n&&(N.info("[".concat(this.clientId,"] receive recover notification: "),n.detail),this.emit(Lt.RECOVER_NOTIFICATION,n.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Un.UID_BANNED),void this.close()):void this.reconnect(i.action,cs.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=Q("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(N.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>Q("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",cs.TIMEOUT):this.request(Dt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),Q("REPORT_STATS")&&this.send(Dt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();n!==0&&i!==0&&this.upload(C0.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Bt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Bt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Bt.CLOSED,()=>{this.connectionState=or.CLOSED}),this.websocket.on(Bt.FAILED,()=>{this._disconnectedReason=Un.NETWORK_ERROR,this.connectionState=or.CLOSED}),this.websocket.on(Bt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===or.CONNECTED?this.connectionState=or.RECONNECTING:this.connectionState=or.CONNECTING}),this.websocket.on(Bt.WILL_RECONNECT,(n,i,o)=>{const c=v0(this,Lt.IS_P2P_DISCONNECTED),u=c||n!=="retry";c&&n==="retry"&&(N.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",i=cA.P2P_DISCONNECTED),u&&(N.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(Lt.REPORT_JOIN_GATEWAY,i||cA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Lt.DISCONNECT_P2P)),o(n)}),this.websocket.on(Bt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{N.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",cs.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof Te){if(n.code===Y.UNEXPECTED_RESPONSE&&n.data.code===Rt.ERR_NO_AUTHORIZED)return this.initError=new Te(Y.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Un.TOKEN_EXPIRE);N.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",cs.SERVER_ERROR):(this.initError=n,this.close())}})}),this.websocket.on(Bt.REQUEST_NEW_URLS,(n,i)=>{ls(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Bt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(qG.PRE_CONNECT_PC,()=>{this.emit(Lt.PRE_CONNECT_PC)})}}let zhe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ri=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function ZG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function uA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?ZG(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ZG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Yf(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Q("TURN_DOMAIN")):(N.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function _L(e,n){e.addresses||(e.addresses=[]);const i=function(f,_){if(Q("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return f.map(w=>{let{ip:I,port:P}=w;return{address:"".concat(I,":").concat(P)}});const v=Q("GATEWAY_DOMAINS");let y=v[1]&&Xe(_).call(_,v[1])?1:0;return f.map(w=>{let{domain_prefix:I,port:P,ip:F}=w;if(I)return{address:"".concat(I,".").concat(v[y++%v.length],":").concat(P)};const x=/^[\.\:\d]+$/.test(F),M=x?"".concat(F.replace(/[^\d]/g,"-"),".").concat(v[y++%v.length],":").concat(P):"".concat(F,":").concat(P);return x||N.debug("Cannot recognized as ip address: ".concat(F,", use as host")),{ip:F,port:P,address:M}})}(e.addresses,n),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const f=o.split(";");for(let _=0;_<f.length;_++){var c;const v=Fs(c=f[_]).call(c);i[_]&&v&&(i[_].ip6=v)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[f,_]=u.split(":");f&&_&&(h={port:Number(_),ip:f,address:"".concat(f,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ma(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function ez(e){const n=e._encoderConfig;if(!n)return{};const i={resolution:n.width&&n.height?"".concat(Ma(n.width),"x").concat(Ma(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return typeof n.frameRate=="number"?(i.maxFrameRate=n.frameRate,i.minFrameRate=n.frameRate):n.frameRate&&(i.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,i.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),i}function tz(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function P0(e,n){let i,o,c;switch(n){case ri.CHOOSE_SERVER:o=4096,c="choose server";break;case ri.CLOUD_PROXY:o=1048576,c="proxy";break;case ri.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case ri.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Te(Y.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>uA(uA({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:uA(uA({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new Te(Y.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function nz(e,n){return await tt.all(e.addresses.map(async i=>({address:Q("USE_TURN_IP")?i.ip:Yf(i.ip),tcpport:i.port,udpport:i.port,username:n&&Q("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():us.username,password:n&&Q("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await b1(n.toString()):us.password})))}function EL(e,n){const i=n.getMediaStreamTrack(!0).getSettings(),o=n.videoHeight||i.height,c=n.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Ma(e.height),Ma(e.width)),1):(N.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Xf(e){let{candidateType:n,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const f={candidateType:n,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),f.address=_.join("."),f.port=u}return f}function dA(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Q("SVC_MODE");if(Q("ENABLE_SVC"))return function(n){return n in jI}(e)?e:jI.L1T3}const rz={[at.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[at.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function hA(e,n,i){n.forEach(o=>{var c;const u=rz[e].find(f=>{var _;let{key:v}=f;return Xe(_=o.extensionName).call(_,v)});if(!u)return;const h=i.find(f=>{let{extensionName:_}=f;return Xe(_).call(_,u.key)});h&&Xe(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function oy(e,n){n.forEach(i=>{var o;const c=rz[e].find(u=>{var h;let{key:f}=u;return Xe(h=i.extensionName).call(h,f)});Xe(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function iz(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Xe(e).call(e,"abs-send-time")}function pA(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Xe(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function sz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function oz(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?sz(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function N0(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:f,filterVideoCodec:_}=n,{useXR:v}=i;let y=[],w=[],I=[],P=[],F=!1,x=!1;if(ca(e).mediaDescriptions.forEach($=>{o&&o!==$.attributes.direction||($.media.mediaType!=="video"||F||(w=$.attributes.payloads,P=$.attributes.extmaps,F=!0),$.media.mediaType!=="audio"||x||(y=$.attributes.payloads,I=$.attributes.extmaps,x=!0))}),!P||w.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||y.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(w.forEach($=>{var q;(q=$.rtpMap)!==null&&q!==void 0&&q.clockRate&&($.rtpMap.clockRate=parseInt($.rtpMap.clockRate)),v&&$.rtcpFeedbacks.push({type:"rrtr"})}),y.forEach($=>{var q;(q=$.rtpMap)!==null&&q!==void 0&&q.clockRate&&($.rtpMap.clockRate=parseInt($.rtpMap.clockRate)),v&&$.rtcpFeedbacks.push({type:"rrtr"})}),c&&(y=y.filter($=>{var q;return((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"}),w=w.filter($=>{var q;return((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"})),u&&(w=w.filter($=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),h&&(y=y.filter($=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),f&&(f==null?void 0:f.length)>0&&(y=y.filter($=>{var q;return Xe(f).call(f,((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const $=w.filter(q=>{var ae;return Xe(_).call(_,((ae=q.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLowerCase())||"")});w=$.concat(c?[]:SL($,w))}const M=Q("UNSUPPORTED_VIDEO_CODEC");return M&&M.length>0&&(w=w.filter($=>!($.rtpMap&&Xe(M).call(M,$.rtpMap.encodingName.toLowerCase())))),{audioCodecs:y,videoCodecs:w,audioExtensions:I,videoExtensions:P}}function Jf(e){const n=ca(e);let i,o;for(const c of n.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&n.attributes.fingerprints.length>0&&(o={fingerprints:n.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function az(e,n){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var f;const _=(f=o.find(v=>v.ssrcIds[0]===h))===null||f===void 0?void 0:f.ssrcIds[1];i.push({ssrcId:h,rtx:n?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],f=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:n?f:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function cz(e,n,i){const{cname:o}=e;let c=[];n&&(c=lz(n)),c.length===0&&(c=e.iceParameters.candidates.map(y=>({foundation:y.foundation,componentId:"1",transport:y.protocol,priority:y.priority.toString(),connectionAddress:y.ip,port:y.port.toString(),type:y.type,extension:{}})),N.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(y=>({hashFunction:y.algorithm,fingerprint:y.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let f;switch(e.dtlsParameters.role){case"server":f="passive";break;case"client":f="active";break;case"auto":f="actpass"}const _=mA(e.rtpCapabilities),v=[];return Array.isArray(i)&&i.length>0&&i.forEach(y=>{v.push({kind:at.VIDEO,ssrcId:y.v,rtx:y.v_rtx,mslabel:"".concat(y.v,"_").concat(y.a)},{kind:at.AUDIO,ssrcId:y.a,mslabel:"".concat(y.v,"_").concat(y.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:f,cname:o,preSSRCs:v}}function lz(e){let n=[];return e.ip&&typeof e.port=="number"&&(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],N.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),N.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),n}function t_(e,n,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:f}=u;const _=nr(8,"track-"),v={ssrcId:h,attributes:oz({label:_,mslabel:i=i||nr(10,""),msid:"".concat(i," ").concat(_)},n&&{cname:n})};if(o.push(v),f!==void 0){const y={ssrcId:f,attributes:oz({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},n&&{cname:n})};o.push(y),c.push({semantic:"FID",ssrcIds:[h,f]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function ay(e,n){n instanceof Ur&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=n._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Pr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function vL(e){const n=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");n!==-1&&e.attributes.unrecognized.splice(n,1)}function yL(e,n){var i;if(!(n instanceof hr&&n._encoderConfig&&n._hints.indexOf(rr.SCREEN_TRACK)===-1))return;const o=n._encoderConfig;In().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;Xe(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),In().supportMinBitrate&&!Xe(i=n._hints).call(i,rr.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;Xe(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(Q("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function uz(e){if(e.media.mediaType!=="video")return;const n=vn();if(n.name!==Dn.SAFARI&&n.os!==Ci.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function fA(e,n,i){if(!n)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),n.twcc===!0){const u=o.find(h=>pA(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>pA(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,v){return v.filter(y=>!!_.find(w=>w.payloadType===y.payloadType&&!!w.rtcpFeedbacks.find(I=>I.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(v=>v.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(n.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>pA(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}if(n.remb===!0){const u=o.find(h=>iz(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,v){return v.filter(y=>!!_.find(w=>w.payloadType===y.payloadType&&!!w.rtcpFeedbacks.find(I=>I.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(v=>v.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(n.remb===!1){const u=e.attributes.extmaps.findIndex(h=>iz(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const f=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");f!==-1&&h.rtcpFeedbacks.splice(f,1)})}}function dz(e,n,i){if(Pr()||e.media.mediaType!=="video"||!(n instanceof hr)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!Q("SIMULCAST")||i==="vp9"&&Q("ENABLE_SVC")||n._scalabilityMode===void 0||n._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:n._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(f=>f.semantic==="FID"&&f.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let f=1;f<o;f++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+f,attributes:Dr(c.attributes)}),h.ssrcIds.push(c.ssrcId+f),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+f,attributes:Dr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+f,u.ssrcIds[1]+f]}));e.attributes.ssrcGroups.unshift(h)}async function hz(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const y=N0(v,f,_,"sendonly"),w=N0(v,f,_,"recvonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},F={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zl(y,w,"videoExtensions",I,P,F),zl(y,w,"videoCodecs",I,P,F),zl(y,w,"audioExtensions",I,P,F),zl(y,w,"audioCodecs",I,P,F),Q("RAISE_H264_BASELINE_PRIORITY")){const x=[],M=[];F.videoCodecs.forEach(($,q)=>{var ae;if(((ae=$.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){var me,ge;const pe=F.videoCodecs[q+1],we=pe&&_z($,pe),Be=(me=$.fmtp)===null||me===void 0?void 0:me.parameters["profile-level-id"],nt=(ge=$.fmtp)===null||ge===void 0?void 0:ge.parameters["packetization-mode"];!Be||Be!==Q("FIRST_H264_PROFILE_LEVEL_ID")||Q("FIRST_PACKETIZATION_MODE")&&nt!==Q("FIRST_PACKETIZATION_MODE")?we?M.push([$,pe]):M.push([$]):we?x.push([$,pe]):x.push([$])}}),x.length>0&&M.length>0&&(N.debug("raising H264 baseline profile priority"),F.videoCodecs.forEach(($,q)=>{var ae;if(((ae=$.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){const me=_z($,F.videoCodecs[q+1]),ge=x.shift()||M.shift()||[];ge.length>0&&(me?F.videoCodecs.splice(q,2,...ge):F.videoCodecs.splice(q,1,...ge))}}),P.videoCodecs=P.videoCodecs.filter($=>{var q,ae;return!(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((ae=$.fmtp)===null||ae===void 0?void 0:ae.parameters["profile-level-id"])!==Q("FIRST_H264_PROFILE_LEVEL_ID"))}),Q("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter($=>{var q,ae;return!(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((ae=$.fmtp)===null||ae===void 0?void 0:ae.parameters["profile-level-id"])!==Q("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:I,recv:P,sendrecv:F}}(e,n,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function pz(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},n=N0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zl(e,n,"videoExtensions",i,o,c),zl(e,n,"videoCodecs",i,o,c),zl(e,n,"audioExtensions",i,o,c),zl(e,n,"audioCodecs",i,o,c),Q("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){N.debug("raising H264 baseline profile priority");const f=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,f)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(f=>!(f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function zl(e,n,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(f=>{n[i].some((_,v)=>{if(f.entry===_.entry&&f.extensionName===_.extensionName)return h.push(v),!0})?u[i].push(f):o[i].push(f)}),void n[i].forEach((f,_)=>{h.indexOf(_)===-1&&c[i].push(f)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(f=>{n[i].some((_,v)=>{if(f.payloadType===_.payloadType&&JSON.stringify(f)===JSON.stringify(_))return h.push(v),!0})?u[i].push(f):o[i].push(f)}),void n[i].forEach((f,_)=>{h.indexOf(_)===-1&&c[i].push(f)})}}function mA(e){const{send:n,recv:i,sendrecv:o}=e;if(!o){if(!n||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:i}}let c,u;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...o.audioCodecs],c.videoCodecs=[...n.videoCodecs,...o.videoCodecs],c.audioExtensions=[...n.audioExtensions,...o.audioExtensions],c.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function cy(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(n=>{var i;return((i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function k0(e,n,i,o){let c=[];if(e===at.VIDEO){if(Q("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=n.videoCodecs.filter(u=>{var h;return Xe(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===Q("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],f=[],_=[];if(i.videoCodecs.forEach(v=>{const y=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";Xe(y).call(y,o)?u.push(v):Xe(y).call(y,"vp9")?h.push(v):Xe(y).call(y,"vp8")?f.push(v):Xe(y).call(y,"h264")&&_.push(v)}),u.length===0){let v="";h.length!==0?(u=h,v="vp9"):f.length!==0?(u=f,v="vp8"):_.length!==0&&(u=_,v="h264"),N.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=n.videoCodecs.filter(v=>u.some(y=>y.payloadType===v.payloadType)))}if(c.length===0&&(N.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(n.videoCodecs[0].rtpMap&&n.videoCodecs[0].rtpMap.encodingName)),c=n.videoCodecs),Q("USE_PUB_RTX")||Q("USE_SUB_RTX")){const u=SL(c,n.videoCodecs);c=[...c,...u]}}else c=n.audioCodecs.filter(u=>{var h;return Xe(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(N.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=n.audioCodecs.filter(u=>{var h;return Xe(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function SL(e,n){const i=e.map(o=>o.payloadType.toString());return n.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&Xe(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function D0(e,n,i){const o=n.toString(),c=mz(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=fz(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function fz(e,n,i){const o=ca(e),{useXR:c}=n;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!Xe(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&cy(u),c&&Xe(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(f=>{f.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&f.rtcpFeedbacks.push({type:"rrtr"})})))}),Kf(o)}function mz(e,n,i,o){if(Q("SDP_LOGGING"))return N.upload("exchanging ".concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),e),n==="offer"?c=>{mz(c,"answer",i==="local"?"remote":"local",o)}:void 0}function gz(e){const n=Q("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(n)&&n.length>0)&&n.some(i=>Xe(e).call(e,i))}function _z(e,n){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===n.payloadType.toString()}catch{return!1}}function Ez(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function el(e,n){return typeof Q(e)===n?Q(e):void 0}function Hhe(){try{const e=Q("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?Ez(Object(o),!0).forEach(function(c){z(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Ez(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e)}catch(e){return N.debug("handle gateway attributes failed: ",e),{}}}const vz={};function Qf(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&N.debug("install service ".concat(e.name)),vz[e.name]=e}function _p(e){const n=vz[e];if(!n)throw new Ce(Y.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return n}function yz(e,n){return _p("DataStream").create(e,n)}function gA(){return _p("InterceptFrame").create()}function Sz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ep(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Sz(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Sz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const TL=new Map;class Khe extends Rr{get state(){return this._state}set state(n){if(n===this._state)return;const i=this._state;this._state=n,n==="DISCONNECTED"&&this._disconnectedReason?this.emit(Vi.CONNECTION_STATE_CHANGE,n,i,this._disconnectedReason):this.emit(Vi.CONNECTION_STATE_CHANGE,n,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){N.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,i){var o,c,u;super(),z(this,"store",void 0),z(this,"joinInfo",void 0),z(this,"key",void 0),z(this,"ntpOffset",0),z(this,"signal",void 0),z(this,"role",void 0),z(this,"inChannelInfo",{joinAt:null,duration:0}),z(this,"spec",void 0),z(this,"_state","DISCONNECTED"),z(this,"_statsCollector",void 0),z(this,"_disconnectedReason",void 0),z(this,"isSignalRecover",!1),z(this,"hasChangeBGPAddress",!1),z(this,"trafficStatsInterval",void 0),z(this,"networkQualityInterval",void 0),z(this,"_joinGatewayStartTime",0),z(this,"_signalTimeout",!1),z(this,"_clientRoleOptions",void 0),z(this,"_isProactiveJoin",!1),this.store=n,this.spec=i,this.signal=this.store.useP2P?(o={spec:Ep(Ep({},i),{},{retryConfig:i.websocketRetryConfig}),store:n},(c=(u=_p("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Ghe(Ep(Ep({},i),{},{retryConfig:i.websocketRetryConfig}),n),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(n,i,o){this.store.joinGatewayStart(),n.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=TL.get(n.cname);if(u||(u=new Map,TL.set(n.cname,u)),this._isProactiveJoin=!0,u.has(n.uid)){const v=new Te(Y.UID_CONFLICT);throw Et.joinGateway(n.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:"0",preload:n.preload}),v}u.set(n.uid,!0),this.joinInfo=n,this.key=i;let h=0;this.joinGatewayStartTime=c;const f=n.proxyServer;try{N.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=n.gatewayAddrs.map(y=>{let{address:w}=y;const[I,P]=w.split(":"),F={host:I,port:P};return n.proxyServer&&(F.proxy=n.proxyServer),F});h=(await this.signal.init(v)).uid,N.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var _;throw N.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),Et.joinGateway(n.sid,{lts:c,succ:!1,ec:((_=v.data)===null||_===void 0?void 0:_.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!f,signalChannel:"0",preload:n.preload}),u.delete(n.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),N.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{N.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Vi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Vi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Vi.NETWORK_QUALITY,{uplinkNetworkQuality:tz(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:tz(this._statsCollector.trafficStats.B_dnq)}):this.emit(Vi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Un.FALLBACK&&(this.state="DISCONNECTING");try{n||this.signal.connectionState!==or.CONNECTED||await function(o,c){return c===1/0?o:tt.race([o,_de(c)])}(this.signal.request(Dt.LEAVE,void 0,!0),3e3)}catch(o){N.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Un.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:Q("PUB_EXTEND"),twcc:!!Q("PUBLISH_TWCC"),rtx:!!Q("USE_PUB_RTX")};try{return(await this.signal.request(Dt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Rt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(n,i),this.publish(n,i,!1);throw u}}async publishDataChannel(n,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Dt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Rt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(n,i),this.publishDataChannel(n,i,!1);throw h}}async unpublish(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Dt.UNPUBLISH,{stream_id:i,ortc:n},!0)}catch(o){N.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tt.all(n.map(i=>this.signal.request(Dt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){N.warning("unpublish datachannels warning: ",i)}}async presubscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Q("SUBSCRIBE_TWCC"),rtx:!!Q("USE_SUB_RTX")||void 0,extend:Q("SUB_EXTEND"),svc:Array.isArray(Q("SVC"))&&Q("SVC").length!==0?Q("SVC"):void 0};try{return await this.signal.request(Dt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Rt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(n,i,!1);throw u}}async subscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Q("SUBSCRIBE_TWCC"),rtx:!!Q("USE_SUB_RTX"),extend:Q("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(Q("SVC"))&&Q("SVC").length!==0?Q("SVC"):void 0};try{return(await this.signal.request(Dt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Rt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(n,i),await this.subscribe(n,i,!1);throw u}}async subscribeDataChannel(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:n,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Dt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Rt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(n,i),await this.subscribeDataChannel(n,i,!1);throw u}}async subscribeAll(n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:n,dtx:!1,rtx:!!Q("USE_SUB_RTX"),twcc:!!Q("SUBSCRIBE_TWCC"),svc:Array.isArray(Q("SVC"))&&Q("SVC").length!==0?Q("SVC"):void 0};try{return await this.signal.request(Dt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Rt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(n),await this.subscribeAll(n,!1);throw c}}async setVideoProfile(n){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,f=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(f=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(f=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(f=!1)),f?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(n);if(i)return this.signal.request(Dt.SET_VIDEO_PROFILE,i);N.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(n,i){try{await this.signal.request(Dt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:n,stream_id:i},!0)}catch(o){N.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tt.all(n.map(o=>this.signal.request(Dt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){N.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(n){try{await this.signal.request(Dt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){N.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(n){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=n;return{gatewayEstablishParams:await this.signal.request(Dt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Dt.GATEWAY_INFO)}async renewToken(n){await this.signal.request(Dt.RENEW_TOKEN,n),this.key=n.token}updateClientRole(n,i){i&&(this._clientRoleOptions=Object.assign({},i)),Q("CLIENT_ROLE_OPTIONS")&&(N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Q("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Q("CLIENT_ROLE_OPTIONS"))),this.role=n}async setClientRole(n,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),Q("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Q("CLIENT_ROLE_OPTIONS")),N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Q("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=n);let o,c=0;n==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Dt.SET_CLIENT_ROLE,{role:n,level:c,delay:o,client_ts:Date.now()}),this.role=n}async setRemoteVideoStreamType(n,i){await this.signal.request(Dt.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:i})}async setDefaultRemoteVideoStreamType(n){await this.signal.request(Dt.DEFAULT_VIDEO_STREAM,{stream_type:n})}async setStreamFallbackOption(n,i){await this.signal.request(Dt.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:i})}async pickSVCLayer(n,i){await this.signal.request(Dt.PICK_SVC_LAYER,{stream_id:n,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(n){await this.signal.request(Dt.SET_RTM2_FLAG,{rtm2_flag:n})}async sendExtensionMessage(n,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(n,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Ep({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Dt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=TL.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:us.username,password:us.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ep(Ep({},us),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const n=await this.signal.request(Dt.TRAFFIC_STATS,void 0,!0);n.timestamp=Date.now(),n.ntp_offset!=null&&(this.ntpOffset=n.ntp_offset),n.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&MI(()=>{this.emit(Vi.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(n)}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new Te(Y.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=Q("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Vi.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,Xe(ty).call(ty,c)||ty.push(c);const u=!(Pr()||F5(87)||A6())&&typeof Q("ENABLE_PRE_SUB")=="boolean"&&Q("ENABLE_PRE_SUB"),h=!A6()&&el("ENABLE_PREALLOC_PC","boolean"),f=Hhe(),_=f0(87)||function(){const y=vn();if(y.name!==Dn.SAFARI||!y.browserVersion)return!1;const w=y.browserVersion.split(".");return Number(w[0])>15||Number(w[0])===15&&Number(w[1])>=4}(),v=Ep({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Xc,browser:navigator.userAgent,process_id:Q("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:Q("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:Ep({enableEncodedTransform:!!Q("ENABLE_AUDIO_METADATA")&&_||!!Q("ENABLE_AUDIO_TOPN")&&m1(Dn.CHROME,87,116)||void 0,enableAudioMetadata:!!Q("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!Q("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:Q("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Q("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Q("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Q("TOPN_AUDIO_GAIN"),enablePublishedUserList:Q("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Q("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:el("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:el("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:el("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Q("USE_PUB_RTX")===!0||Q("USE_SUB_RTX")===!0||void 0,disableFEC:Q("DISABLE_FEC"),enableNTPReport:!!Q("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!Q("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!Q("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:el("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Q("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Q("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:el("USE_XR","boolean"),enableLossbasedBwe:el("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Q("ENABLE_AUT_CC")||void 0,enableCCFallback:el("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?el("PRE_SUB_NUM","number"):void 0,enablePubTWCC:el("PUBLISH_TWCC","boolean"),enableSubTWCC:el("SUBSCRIBE_TWCC","boolean"),enablePubRTX:el("USE_PUB_RTX","boolean"),enableSubRTX:el("USE_SUB_RTX","boolean"),enableSubSVC:Q("ENABLE_SVC")?Q("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Q("SVC"))&&Q("SVC").length!==0?Q("SVC"):void 0,enableSvcExtended:Q("ENABLE_SVC")&&Array.isArray(Q("SVC_EXTENDED"))&&Q("SVC_EXTENDED").length!==0?Q("SVC_EXTENDED"):void 0},f)},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,Q("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new Te(Y.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Lt.WS_RECONNECT_CREATE_CONNECTION,n=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Lt.WS_RECONNECTING,n=>{this.joinInfo&&Et.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||cs.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Et.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Lt.WS_CLOSED,n=>{let i;switch(n){case Un.LEAVE:i=cs.LEAVE;break;case Un.UID_BANNED:case Un.IP_BANNED:case Un.CHANNEL_BANNED:case Un.SERVER_ERROR:i=cs.SERVER_ERROR;break;case Un.FALLBACK:i=cs.FALLBACK;break;case Un.LICENSE_MISSING:case Un.LICENSE_EXPIRED:case Un.LICENSE_MINUTES_EXCEEDED:case Un.LICENSE_PERIOD_INVALID:case Un.LICENSE_MULTIPLE_SDK_SERVICE:case Un.LICENSE_ILLEGAL:case Un.TOKEN_EXPIRE:i=n;break;default:i=cs.NETWORK_ERROR}N.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+cs.NETWORK_ERROR)),this.joinInfo&&Et.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:n===Un.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=n,n!==Un.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Lt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const n=Q("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;n&&(n.level||n.delay)&&(N.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(n.level,", delay: ").concat(n.delay)),this.setClientRole(this.role,n))}if(Et.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const n=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!n)return void N.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(n));Kn("EVENT_REPORT_DOMAIN",n[1]),Kn("EVENT_REPORT_BACKUP_DOMAIN",n[1]),Kn("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}}),this.signal.on(cn.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on(Lt.REQUEST_RECOVER,(n,i,o)=>{if(!this.joinInfo)return o(new Te(Y.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ls(this,Vi.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Lt.REQUEST_JOIN_INFO,async(n,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void n(this.getJoinMessage({ortc:{}}));const u=Dr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(Q("NEW_TURN_MODE")&&u){let v=u.servers,y=u.serversFromGateway;const w=this.signal.currentURLIndex;v.length>0&&(v=[v[w%v.length]],u.servers=v),Array.isArray(y)&&y.length>0&&(y=[y[0]],u.serversFromGateway=y),N.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w))}const{iceParameters:h,dtlsParameters:f,rtpCapabilities:_}=await ls(this,Vi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{n(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:f,rtpCapabilities:_,version:"2"}}))}catch(v){i(v)}}),this.signal.on(Lt.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on(Lt.REPORT_JOIN_GATEWAY,(n,i)=>{if(!this.joinInfo)return;let o,c="";var u;n instanceof Te?(o=((u=n.data)===null||u===void 0?void 0:u.desc)||n.code,c=n.message):o=n,Et.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Lt.IS_P2P_DISCONNECTED,n=>{n(v0(this,Vi.IS_P2P_DISCONNECTED))}),this.signal.on(Lt.DISCONNECT_P2P,()=>{this.emit(Vi.DISCONNECT_P2P)}),this.signal.on(Lt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Lt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Lt.JOIN_RESPONSE,n=>{const i=this.getCurrentGatewayAddress();this.emit(Vi.JOIN_RESPONSE,n,i)}),this.signal.on(Lt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const n=this.getCurrentGatewayAddress(),i=Q("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(n&&i){const o=lz(n);this.emit(Vi.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(Lt.RECOVER_NOTIFICATION,n=>{this.joinInfo&&typeof Q("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Q("AP_REQUEST_DETAIL"),";").concat(n))})}async tryUnsubBeforeResub(n,i){try{await this.signal.request(Dt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:n,ortc:[i]},!0)}catch(o){throw N.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(n,i){try{await this.signal.request(Dt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw N.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(n,i){try{await this.signal.request(Dt.UNPUBLISH,{stream_id:n,ortc:i},!0)}catch(o){throw N.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(n,i){try{await this.signal.request(Dt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw N.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(n){const i={users:n.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Dt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw N.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(n,i){const o={action:n.find(c=>c.stream_type===Fn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(Dt.CONTROL,o,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(n,i){const o={action:n.find(c=>c.stream_type===Fn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(Dt.CONTROL,o,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(n,i){const o={action:n===at.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Dt.CONTROL,o,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(n,i){const o={action:n===at.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Dt.CONTROL,o,!0,!0)}catch(c){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(n){this.signal.uploadWRTCStats(n)}upload(n,i){this.signal.upload(n,i)}getSignalRTT(){return this.signal.rtt}async restartICE(n){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:n};try{return await this.signal.request(Dt.RESTART_ICE,i,!0)}catch(o){throw N.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(n,i){this.state==="CONNECTED"&&this.signal.reconnect(n||void 0,i||cs.P2P_FAILED)}getCurrentGatewayAddress(){var n,i;if(!Q("GATEWAY_WSS_ADDRESS"))return Q("USE_CANDIDATE_FROM_AP_DETAIL")&&(n=this.joinInfo)!==null&&n!==void 0&&n.apGatewayAddress?(N.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(n){await this.signal.request(Dt.SET_PARAMETER,{enablePublishAudioFilter:n})}}let _A=0,bL=0;function Hu(e,n,i,o){return new tt((c,u)=>{n.timeout=n.timeout||Q("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),_A+=Md(n.data)):i&&(n.data.size?_A+=n.data.size:n.data instanceof FormData?_A+=r6(n.data):_A+=Md(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Do.request(n).then(h=>{typeof h.data=="string"?bL+=Md(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?bL+=h.data.byteLength:bL+=Md(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Do.isCancel(h)?u(new Te(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Te(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new Te(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Te(Y.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function n(ke){var Ye=0;return function(){return Ye<ke.length?{done:!1,value:ke[Ye++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(ke,Ye,ht){return ke==Array.prototype||ke==Object.prototype||(ke[Ye]=ht.value),ke},o,c=function(ke){ke=[typeof globalThis=="object"&&globalThis,ke,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var Ye=0;Ye<ke.length;++Ye){var ht=ke[Ye];if(ht&&ht.Math==Math)return ht}throw Error("Cannot find global object")}(this);function u(ke,Ye){if(Ye)e:{var ht=c;ke=ke.split(".");for(var Le=0;Le<ke.length-1;Le++){var D=ke[Le];if(!(D in ht))break e;ht=ht[D]}(Ye=Ye(Le=ht[ke=ke[ke.length-1]]))!=Le&&Ye!=null&&i(ht,ke,{configurable:!0,writable:!0,value:Ye})}}function h(ke){return(ke={next:ke})[Symbol.iterator]=function(){return this},ke}function f(ke){var Ye=typeof Symbol<"u"&&Symbol.iterator&&ke[Symbol.iterator];return Ye?Ye.call(ke):{next:n(ke)}}if(u("Symbol",function(ke){function Ye(D,ee){this.A=D,i(this,"description",{configurable:!0,writable:!0,value:ee})}if(ke)return ke;Ye.prototype.toString=function(){return this.A};var ht="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Le=0;return function D(ee){if(this instanceof D)throw new TypeError("Symbol is not a constructor");return new Ye(ht+(ee||"")+"_"+Le++,ee)}}),u("Symbol.iterator",function(ke){if(ke)return ke;ke=Symbol("Symbol.iterator");for(var Ye="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ht=0;ht<Ye.length;ht++){var Le=c[Ye[ht]];typeof Le=="function"&&typeof Le.prototype[ke]!="function"&&i(Le.prototype,ke,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return ke}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var v={};try{v.__proto__={a:!0},_=v.a;break e}catch{}_=!1}o=_?function(ke,Ye){if(ke.__proto__=Ye,ke.__proto__!==Ye)throw new TypeError(ke+" is not extensible");return ke}:null}var y=o;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function I(ke){if(ke.m)throw new TypeError("Generator is already running");ke.m=!0}function P(ke,Ye){return ke.h=3,{value:Ye}}function F(ke){this.g=new w,this.G=ke}function x(ke,Ye,ht,Le){try{var D=Ye.call(ke.g.j,ht);if(!(D instanceof Object))throw new TypeError("Iterator result "+D+" is not an object");if(!D.done)return ke.g.m=!1,D;var ee=D.value}catch(ce){return ke.g.j=null,ke.g.s(ce),M(ke)}return ke.g.j=null,Le.call(ke.g,ee),M(ke)}function M(ke){for(;ke.g.h;)try{var Ye=ke.G(ke.g);if(Ye)return ke.g.m=!1,{value:Ye.value,done:!1}}catch(ht){ke.g.v=void 0,ke.g.s(ht)}if(ke.g.m=!1,ke.g.l){if(Ye=ke.g.l,ke.g.l=null,Ye.F)throw Ye.D;return{value:Ye.return,done:!0}}return{value:void 0,done:!0}}function $(ke){this.next=function(Ye){return ke.o(Ye)},this.throw=function(Ye){return ke.s(Ye)},this.return=function(Ye){return function(ht,Le){I(ht.g);var D=ht.g.j;return D?x(ht,"return"in D?D.return:function(ee){return{value:ee,done:!0}},Le,ht.g.return):(ht.g.return(Le),M(ht))}(ke,Ye)},this[Symbol.iterator]=function(){return this}}function q(ke,Ye){return Ye=new $(new F(Ye)),y&&ke.prototype&&y(Ye,ke.prototype),Ye}if(w.prototype.o=function(ke){this.v=ke},w.prototype.s=function(ke){this.l={D:ke,F:!0},this.h=this.C||this.u},w.prototype.return=function(ke){this.l={return:ke},this.h=this.u},F.prototype.o=function(ke){return I(this.g),this.g.j?x(this,this.g.j.next,ke,this.g.o):(this.g.o(ke),M(this))},F.prototype.s=function(ke){return I(this.g),this.g.j?x(this,this.g.j.throw,ke,this.g.o):(this.g.s(ke),M(this))},u("Array.prototype.entries",function(ke){return ke||function(){return function(Ye,ht){Ye instanceof String&&(Ye+="");var Le=0,D=!1,ee={next:function(){if(!D&&Le<Ye.length){var ce=Le++;return{value:ht(ce,Ye[ce]),done:!1}}return D=!0,{done:!0,value:void 0}}};return ee[Symbol.iterator]=function(){return ee},ee}(this,function(Ye,ht){return[Ye,ht]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ae=function(ke,Ye){for(var ht=0;ht<ke.length;ht++)Ye(ke[ht])},me=function(ke){return ke.replace(/\r?\n|\r/g,`\r
`)},ge=function(ke,Ye,ht){return Ye instanceof Blob?(ht=ht!==void 0?ht+"":typeof Ye.name=="string"?Ye.name:"blob",Ye.name===ht&&Object.prototype.toString.call(Ye)!=="[object Blob]"||(Ye=new File([Ye],ht)),[String(ke),Ye]):[String(ke),String(Ye)]},pe=function(ke,Ye){if(ke.length<Ye)throw new TypeError(Ye+" argument required, but only "+ke.length+" present.")},we=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Be=we.FormData,nt=we.XMLHttpRequest&&we.XMLHttpRequest.prototype.send,st=we.Request&&we.fetch,dn=we.navigator&&we.navigator.sendBeacon,hn=we.Element&&we.Element.prototype,ir=we.Symbol&&Symbol.toStringTag;ir&&(Blob.prototype[ir]||(Blob.prototype[ir]="Blob"),"File"in we&&!File.prototype[ir]&&(File.prototype[ir]="File"));try{new File([],"")}catch{we.File=function(Ye,ht,Le){return Ye=new Blob(Ye,Le||{}),Object.defineProperties(Ye,{name:{value:ht},lastModified:{value:+(Le&&Le.lastModified!==void 0?new Date(Le.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ir&&Object.defineProperty(Ye,ir,{value:"File"}),Ye}}var Yr=function(ke){return ke.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Vr=function(ke){this.i=[];var Ye=this;ke&&ae(ke.elements,function(ht){if(ht.name&&!ht.disabled&&ht.type!=="submit"&&ht.type!=="button"&&!ht.matches("form fieldset[disabled] *"))if(ht.type==="file"){var Le=ht.files&&ht.files.length?ht.files:[new File([],"",{type:"application/octet-stream"})];ae(Le,function(D){Ye.append(ht.name,D)})}else ht.type==="select-multiple"||ht.type==="select-one"?ae(ht.options,function(D){!D.disabled&&D.selected&&Ye.append(ht.name,D.value)}):ht.type==="checkbox"||ht.type==="radio"?ht.checked&&Ye.append(ht.name,ht.value):(Le=ht.type==="textarea"?me(ht.value):ht.value,Ye.append(ht.name,Le))})};if((e=Vr.prototype).append=function(ke,Ye,ht){pe(arguments,2),this.i.push(ge(ke,Ye,ht))},e.delete=function(ke){pe(arguments,1);var Ye=[];ke=String(ke),ae(this.i,function(ht){ht[0]!==ke&&Ye.push(ht)}),this.i=Ye},e.entries=function ke(){var Ye,ht=this;return q(ke,function(Le){if(Le.h==1&&(Ye=0),Le.h!=3)return Ye<ht.i.length?Le=P(Le,ht.i[Ye]):(Le.h=0,Le=void 0),Le;Ye++,Le.h=2})},e.forEach=function(ke,Ye){pe(arguments,1);for(var ht=f(this),Le=ht.next();!Le.done;Le=ht.next()){var D=f(Le.value);Le=D.next().value,D=D.next().value,ke.call(Ye,D,Le,this)}},e.get=function(ke){pe(arguments,1);var Ye=this.i;ke=String(ke);for(var ht=0;ht<Ye.length;ht++)if(Ye[ht][0]===ke)return Ye[ht][1];return null},e.getAll=function(ke){pe(arguments,1);var Ye=[];return ke=String(ke),ae(this.i,function(ht){ht[0]===ke&&Ye.push(ht[1])}),Ye},e.has=function(ke){pe(arguments,1),ke=String(ke);for(var Ye=0;Ye<this.i.length;Ye++)if(this.i[Ye][0]===ke)return!0;return!1},e.keys=function ke(){var Ye,ht,Le,D,ee=this;return q(ke,function(ce){if(ce.h==1&&(Ye=f(ee),ht=Ye.next()),ce.h!=3)return ht.done?void(ce.h=0):(Le=ht.value,D=f(Le),P(ce,D.next().value));ht=Ye.next(),ce.h=2})},e.set=function(ke,Ye,ht){pe(arguments,2),ke=String(ke);var Le=[],D=ge(ke,Ye,ht),ee=!0;ae(this.i,function(ce){ce[0]===ke?ee&&(ee=!Le.push(D)):Le.push(ce)}),ee&&Le.push(D),this.i=Le},e.values=function ke(){var Ye,ht,Le,D,ee=this;return q(ke,function(ce){if(ce.h==1&&(Ye=f(ee),ht=Ye.next()),ce.h!=3)return ht.done?void(ce.h=0):(Le=ht.value,(D=f(Le)).next(),P(ce,D.next().value));ht=Ye.next(),ce.h=2})},Vr.prototype._asNative=function(){for(var ke=new Be,Ye=f(this),ht=Ye.next();!ht.done;ht=Ye.next()){var Le=f(ht.value);ht=Le.next().value,Le=Le.next().value,ke.append(ht,Le)}return ke},Vr.prototype._blob=function(){var ke="----formdata-polyfill-"+Math.random(),Ye=[],ht="--"+ke+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Le,D){return typeof Le=="string"?Ye.push(ht+Yr(me(D))+`"\r
\r
`+me(Le)+`\r
`):Ye.push(ht+Yr(me(D))+'"; filename="'+Yr(Le.name)+`"\r
Content-Type: `+(Le.type||"application/octet-stream")+`\r
\r
`,Le,`\r
`)}),Ye.push("--"+ke+"--"),new Blob(Ye,{type:"multipart/form-data; boundary="+ke})},Vr.prototype[Symbol.iterator]=function(){return this.entries()},Vr.prototype.toString=function(){return"[object FormData]"},hn&&!hn.matches&&(hn.matches=hn.matchesSelector||hn.mozMatchesSelector||hn.msMatchesSelector||hn.oMatchesSelector||hn.webkitMatchesSelector||function(ke){for(var Ye=(ke=(this.document||this.ownerDocument).querySelectorAll(ke)).length;0<=--Ye&&ke.item(Ye)!==this;);return-1<Ye}),ir&&(Vr.prototype[ir]="FormData"),nt){var Fo=we.XMLHttpRequest.prototype.setRequestHeader;we.XMLHttpRequest.prototype.setRequestHeader=function(ke,Ye){Fo.call(this,ke,Ye),ke.toLowerCase()==="content-type"&&(this.B=!0)},we.XMLHttpRequest.prototype.send=function(ke){ke instanceof Vr?(ke=ke._blob(),this.B||this.setRequestHeader("Content-Type",ke.type),nt.call(this,ke)):nt.call(this,ke)}}st&&(we.fetch=function(ke,Ye){return Ye&&Ye.body&&Ye.body instanceof Vr&&(Ye.body=Ye.body._blob()),st.call(this,ke,Ye)}),dn&&(we.navigator.sendBeacon=function(ke,Ye){return Ye instanceof Vr&&(Ye=Ye._asNative()),dn.call(this,ke,Ye)}),we.FormData=Vr}})();const L0=()=>{const e=Q("AREAS");return e.length===0&&e.push(Ln.GLOBAL),Aa(e).call(e,(n,i,o)=>{const c=Tz(i);return c?o===0?c:"".concat(n,",").concat(c):n},"")},Tz=e=>e===Ln.OVERSEA?"".concat(gs.ASIA,",").concat(gs.EUROPE,",").concat(gs.AFRICA,",").concat(gs.NORTH_AMERICA,",").concat(gs.SOUTH_AMERICA,",").concat(gs.OCEANIA):gs[e],$he=e=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=lA[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(n[u]=n[u].concat(o[u]))})}),n},EA={GLOBAL:{ASIA:[Ln.CHINA,Ln.JAPAN,Ln.INDIA,Ln.KOREA,Ln.HKMC],EUROPE:[],NORTH_AMERICA:[Ln.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},vA=Object.keys(EA[Ln.GLOBAL]),wL=[Ln.CHINA,Ln.NORTH_AMERICA,Ln.EUROPE,Ln.ASIA,Ln.JAPAN,Ln.INDIA,Ln.OCEANIA,Ln.SOUTH_AMERICA,Ln.AFRICA,Ln.KOREA,Ln.HKMC,Ln.US],qhe=function(e,n){let i=[];if(Xe(e).call(e,Ln.GLOBAL)){const u=[Ln.GLOBAL,Ln.OVERSEA],h=Object.keys(lA);if(n===Ln.GLOBAL)throw new Te(Y.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===Ln.CHINA)i=[Ln.OVERSEA];else if(c=n,Xe(vA).call(vA,c)){const f=(o=n,EA[Ln.GLOBAL][o]||[]),_=[...u,n,...f];i=h.filter(v=>!Xe(_).call(_,v))}else if(function(f){let _=!1;return vA.forEach(v=>{var y;Xe(y=EA[Ln.GLOBAL][v]).call(y,f)&&(_=!0)}),_}(n)){const f=function(v){let y;return vA.forEach(w=>{var I;Xe(I=EA[Ln.GLOBAL][w]).call(I,v)&&(y=w)}),y}(n),_=[...u,f,n];i=h.filter(v=>!Xe(_).call(_,v))}else i=e;i=function(f){const _=[];return wL.forEach(v=>{Xe(f).call(f,v)&&_.push(v)}),_.concat(f.filter(v=>!Xe(wL).call(wL,v)))}(i)}else i=e;var o,c;return i};function bz(e){var n,i;if(!e&&Xe(n=Q("AREAS")).call(n,Ln.EXTENSIONS))return N.debug("update area from ap : reset"),void RL(rhe,!0);if(!Xe(i=Q("AREAS")).call(i,Ln.GLOBAL)||!e)return;let o=lA.EXTENSIONS;o&&(o={CODE:Tz(Ln.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},N.debug("update area from ap success: ".concat(e,",config is "),o),Kn("AREAS",[Ln.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Kn(c,o[c][0]):Kn(c,o[c])}))}function RL(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=Et.reportApiInvoke(null,{name:hi.SET_AREA,options:e,tag:kr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!Xe(GG).call(GG,u))throw new Te(Y.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Te(Y.INVALID_PARAMS,"area code is needed");let f=u;typeof u=="string"&&(f=[u]),o=h?qhe(f,h):f}if(!n){if(Bu.AREAS){const u=new Te(Y.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void N.warning("setArea is prohibited because of config-distribute")}if(Xe(o).call(o,Ln.GLOBAL)&&Q("AREAS")===Ln.EXTENSIONS){const u=new Te(Y.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void N.warning("setArea is prohibited because of ap extensions")}}Kn("AREAS",o,n);const c=$he(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Kn(u,c[u][0]):Kn(u,c[u])}),N.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function wz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Wd(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?wz(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let CL=1;function Yhe(e,n,i,o,c){CL+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:CL,requestId:CL,version:Xc,cname:i.cname},h={service_name:n,json_body:JSON.stringify(u)};let f,_,v=e[0];return ju(async()=>{f=Date.now();const y=await Hu(v,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-f,y.code!==0){const P=new Te(Y.UNEXPECTED_RESPONSE,"live streaming ap error, code"+y.code,{retry:!0,responseTime:_});throw N.error(P.toString()),P}const w=JSON.parse(y.json_body);if(w.code!==200){const P=new Te(Y.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:_});throw N.error(P.toString()),P}if(!w.servers||w.servers.length===0){const P=new Te(Y.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:_});throw N.error(P.toString()),P}const I=function(P,F){return{addressList:P.servers.map(x=>"wss://".concat(x.address.replace(/\./g,"-"),".").concat(Q("WORKER_DOMAIN"),":").concat(x.wss,"?serviceName=").concat(encodeURIComponent(F))),workerToken:P.workerToken,vid:P.vid}}(w,n);return Q("LIVE_STREAMING_ADDRESS")&&(I.addressList=Q("LIVE_STREAMING_ADDRESS")instanceof Array?Q("LIVE_STREAMING_ADDRESS"):[Q("LIVE_STREAMING_ADDRESS")]),Wd(Wd({},I),{},{responseTime:_})},(y,w)=>(Et.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(y.addressList),firstSuccess:w===0,responseTime:_,serverIp:e[w%e.length]}),!1),(y,w)=>(Et.apworkerEvent(i.sid,{success:!1,sc:y.data&&y.data.code||200,serviceName:n,responseTime:_,serverIp:e[w%e.length]}),!!(y.code!==Y.OPERATION_ABORTED&&y.code!==Y.UNEXPECTED_RESPONSE||y.data&&y.data.retry)&&(v=e[(w+1)%e.length],!0)),c)}let IL=1;function Rz(e,n,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:f}=n,_=Date.now();let v;const y=n.role,[w,I]=OL(n,u,[ri.CHOOSE_SERVER]);let P=ni.networkState;return ju(async()=>{P&&ni.networkState===xa.OFFLINE&&ni.onlineWaiter&&await tt.race([ni.onlineWaiter,Hi(o&&o.maxRetryTimeout||pi.maxRetryTimeout)]),P=ni.networkState;const{data:F,headers:x}=await Hu(c,{data:w,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=x.http3==="1"?1:-1,Et.reportResourceTiming(c,f),Iz(F,c,n,_,[ri.CHOOSE_SERVER],v);const M=P0(F,ri.CHOOSE_SERVER);return AL(M),_L(M,c)},F=>(F&&Et.joinChooseServer(f,{role:y,lts:_,succ:!0,csAddr:c,opid:I,serverList:F.gatewayAddrs.map(x=>x.address),ec:null,cid:F.cid.toString(),uid:F.uid.toString(),csIp:F.csIp,unilbsServerIds:[ri.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:F.res.detail&&F.res.detail[38]}),!1),F=>F.code!==Y.OPERATION_ABORTED&&(F.code===Y.CAN_NOT_GET_GATEWAY_SERVER?F.data.retry:(Et.joinChooseServer(f,{role:y,lts:_,succ:!1,csAddr:c,serverList:null,opid:I,ec:F.code,csIp:F.data&&F.data.csIp,unilbsServerIds:[ri.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:P}),isHttp3:v,corssRegionTagReq:n.apRequestDetail}),N.warning("[".concat(h||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),F),!0)),o)}function Cz(e,n,i,o){let c,{url:u,areaCode:h,serviceIds:f}=e;const _=Date.now(),v=n.role,[y,w]=OL(n,h,f);let I;return ju(async()=>{I&&ni.networkState===xa.OFFLINE&&ni.onlineWaiter&&await tt.race([ni.onlineWaiter,Hi(o&&o.maxRetryTimeout||pi.maxRetryTimeout)]),I=ni.networkState;const{data:P,headers:F}=await Hu(u,{data:y,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=F.http3==="1"?1:-1,Et.reportResourceTiming(u,n.sid),Iz(P,u,n,_,f,c);const x=P0(P,ri.CHOOSE_SERVER),M=P0(P,n.cloudProxyServer==="proxy5"?ri.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK);return AL(x),{gatewayInfo:_L(x,u),proxyInfo:M,url:u}},P=>(P.gatewayInfo&&Et.joinChooseServer(n.sid,{role:v,lts:_,succ:!0,csAddr:u,serverList:P.gatewayInfo.gatewayAddrs.map(F=>F.address),ec:null,opid:w,cid:P.gatewayInfo.cid.toString(),uid:P.gatewayInfo.uid.toString(),csIp:P.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:P.gatewayInfo.res.detail&&P.gatewayInfo.res.detail[38]}),P.proxyInfo&&Et.joinWebProxyAP(n.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:P.proxyInfo.addresses.map(F=>F.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:f.toString()}),!1),P=>P.code!==Y.OPERATION_ABORTED&&(P.code===Y.CAN_NOT_GET_GATEWAY_SERVER?P.data.retry:(Et.joinWebProxyAP(n.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:P.code,eventType:n.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:I})}),N.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),P),!0)),o)}const Iz=(e,n,i,o,c,u)=>{const{sid:h,clientId:f,cloudProxyServer:_}=i,v=[],y=w=>{w.flag===4096?Et.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:n,opid:e.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||Et.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:w.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(w=>{const I=w.buffer.code;if(w.uri===23&&I===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const P={error:new Te(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:w.buffer.flag};v.push(P),y(P)}if(I!==0){const P=sy(I),F={error:new Te(Y.CAN_NOT_GET_GATEWAY_SERVER,P.desc,{desc:P.desc,retry:P.retry,csIp:e.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?N.warning(F.error.toString()):v.push(F),y(F)}}),v.length)throw N.warning("[".concat(f||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(n," failed, ").concat(v.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new Te(Y.CAN_NOT_GET_GATEWAY_SERVER,v.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!v.find(w=>w.error.data.retry),csIp:e.detail[502],desc:[...new Set(v.map(w=>{var I;return w==null||(I=w.error)===null||I===void 0||(I=I.data)===null||I===void 0?void 0:I.desc}).filter(w=>!!w))]})},AL=e=>{var n,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Te(Y.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Q("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?bz(e.detail[23].toLowerCase()):bz()),(n=e.detail)!==null&&n!==void 0&&n[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],f=h==null?void 0:h.split(";");for(let _=0;_<f.length;_++){var u;const v=Fs(u=f[_]).call(u);e.addresses[_]&&f&&(e.addresses[_].fingerprint=v)}}if(Q("GATEWAY_ADDRESS")&&Q("GATEWAY_ADDRESS").length>0){N.debug("assign gateway address to",Q("GATEWAY_ADDRESS"));const h=Q("GATEWAY_ADDRESS").map(f=>{var _,v;const y=(_=(v=e.addresses.find(w=>w.ip===f.ip&&w.port===f.port))===null||v===void 0?void 0:v.fingerprint)!==null&&_!==void 0?_:"";return{ip:f.ip,port:f.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:y}});e.addresses=h}},Xhe=(e,n)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=sy(i.buffer.code);throw new Te(Y.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw N.debug("update ticket request received ap response without response body:",n),new Te(Y.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},OL=(e,n,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Wd(Wd(Wd({6:e.stringUid,11:n,12:Q("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:n},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(f=>{e.multiIP&&e.multiIP.gateway_ip&&(f.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Jhe=(e,n)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:n,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let ly=0;function uy(e){return tt.all(e.map(n=>n.then(i=>{throw i},i=>i))).then(n=>{throw n},n=>n)}const x0=async e=>{let{fragementLength:n,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const f=n;let _,v=0;const y=async()=>{const w=(()=>{const I=h*f,P=I+f;return i.slice(I,P).map(o)})();u&&u.push(...w);try{_=await uy(w)}catch(I){if(v+=f,h++,!(v>=i.length))return void await y();c(I)}w.forEach(I=>I.cancel())};return await y(),_},Az=async e=>{let{referenceList:n,asyncMapHandler:i,closeFn:o}=e;const c=n.length;let u=0;const h=async()=>{const f=i(n.shift());try{return await f}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function PL(e,n,i,o){return{gatewayInfo:await async function(u,h,f,_){let v=null;const y=[],w=async()=>{const P=Q("WEBCS_DOMAIN").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(M=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:L0()})),F=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(M=>M.url)}),x=await x0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:M=>(N.debug("[".concat(u.clientId,"] Connect to choose_server:"),M.url),Rz(M,u,h,f)),allFailedhandler:M=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},F),M[0]},promisesCollector:y});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},F),x},I=async()=>{if(await Hi(1e3),v!==null)return v;const P=Q("WEBCS_DOMAIN_BACKUP_LIST").map(M=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:L0()})),F=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(M=>M.url)}),x=await x0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:M=>(N.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),M.url),Rz(M,u,h,f)),allFailedhandler:M=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},F),M[0]},promisesCollector:y});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},F),x};try{return v=await uy([w(),I()]),y.length&&y.forEach(P=>P.cancel&&typeof P.cancel=="function"&&P.cancel()),v}catch(P){throw P[0]}}(e,n,i,o)}}async function Oz(e,n,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await PL(e,n,i,c);if(Q("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:I,proxyInfo:P}=await kz(e,n,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:I};const F=P.map(x=>({turnServerURL:x.address,tcpport:x.tcpport||us.tcpport,udpport:x.udpport||us.udpport,username:x.username||us.username,password:x.password||us.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const x=(h=e.uid)!==null&&h!==void 0?h:I.uid,M="glb:".concat(x.toString()),$=await b1(M),q=P.map(ae=>({turnServerURL:ae.address,tcpport:ae.tcpport||us.tcpport,udpport:ae.udpport||us.udpport,username:M,password:$,forceturn:!1,security:!0}));F.push(...q)}return e.turnServer={mode:"manual",servers:F},{gatewayInfo:I}}return await PL(e,n,i,c)}const{proxyInfo:f,gatewayInfo:_}=await kz(e,n,i,c),v={gatewayInfo:_},y=f.map(I=>({turnServerURL:I.address,tcpport:u==="proxy3"?void 0:I.tcpport?I.tcpport:us.tcpport,udpport:u==="proxy4"?void 0:I.udpport?I.udpport:us.udpport,username:I.username||us.username,password:I.password||us.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var w;const I=(w=e.uid)!==null&&w!==void 0?w:_.uid,P="glb:".concat(I.toString()),F=await b1(P),x=f.map(M=>({turnServerURL:M.address,tcpport:u==="proxy3"?void 0:M.tcpport||us.tcpport,udpport:u==="proxy4"?void 0:M.udpport||us.udpport,username:P,password:F,forceturn:u!=="proxy4",security:u==="proxy5"}));y.push(...x)}return e.turnServer={mode:"manual",servers:y},N.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),v}async function Pz(e,n,i,o,c){const u=Q("ACCOUNT_REGISTER").slice(0,Q("AJAX_REQUEST_CONCURRENT"));let h=[];h=n.proxyServer?u.map(_=>"https://".concat(n.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const f=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(v,y,w,I,P){const F=Date.now(),x={sid:w.sid,opid:10,appid:w.appId,string_uid:y};let M=v[0];const $=await ju(()=>Hu(M+"".concat(M.indexOf("?")===-1?"?":"&","action=stringuid"),{data:x,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(q,ae)=>{if(q.code===0){if(q.uid<=0||q.uid>=Math.pow(2,32))throw N.error("Invalid Uint Uid ".concat(y," => ").concat(q.uid),q),Et.reqUserAccount(x.sid,{lts:F,success:!1,serverAddr:M,stringUid:x.string_uid,uid:q.uid,errorCode:Y.INVALID_UINT_UID_FROM_STRING_UID,extend:x}),new Te(Y.INVALID_UINT_UID_FROM_STRING_UID);return Et.reqUserAccount(x.sid,{lts:F,success:!0,serverAddr:M,stringUid:x.string_uid,uid:q.uid,errorCode:null,extend:x}),!1}const me=sy(q.code);return me.retry&&(M=v[(ae+1)%v.length]),Et.reqUserAccount(x.sid,{lts:F,success:!1,serverAddr:M,stringUid:x.string_uid,uid:q.uid,errorCode:me.desc,extend:x}),me.retry},(q,ae)=>q.code!==Y.OPERATION_ABORTED&&(Et.reqUserAccount(x.sid,{lts:F,success:!1,serverAddr:M,stringUid:x.string_uid,uid:null,errorCode:q.code,extend:x}),M=v[(ae+1)%v.length],!0),P);if($.code!==0){const q=sy($.code);throw new Te(Y.UNEXPECTED_RESPONSE,q.desc)}return $}(h,e,n,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},f),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},f),_}}async function Qhe(e,n,i){const o=Q("ACCOUNT_REGISTER");let c=[];c=n.proxyServer?o.map(u=>"https://".concat(n.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await Az({referenceList:c,asyncMapHandler:h=>async function(f,_,v,y){const w=Date.now(),I={sid:v.sid,opid:10,appid:v.appId,string_uid:_};try{const P=await Hu(f+"".concat(f.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(P.code!==0){const F=sy(P.code);throw new Te(Y.UNEXPECTED_RESPONSE,"preload sua error:".concat(F.desc),F)}if(P.uid<=0||P.uid>=Math.pow(2,32))throw new Te(Y.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:f,req:I,uid:P.uid,elapse:Date.now()-w}}catch(P){throw P}}(h,e,n,i),closeFn:h=>h.code===Y.OPERATION_ABORTED||h.code===Y.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Zhe(e,n,i){const o=Q("CDS_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(v,y,w,I){const P=vn(),F={flag:64,cipher_method:0,features:Wd(Wd(Wd(Wd(Wd({install_id:L1(),device:P.name,system:P.os,system_general:navigator.userAgent,vendor:y.appId,version:Xc,cname:y.cname,session_id:y.sid,proxyServer:y.proxyServer,sdk_type:zhe.WEB_RTC,browser_name:P.name,browser_version:P.version,user_agent:navigator.userAgent,channel_name:y.cname},y.stringUid&&{string_uid:y.stringUid}),y.uid&&{uid:y.uid+""}),P.os&&{os_name:P.os}),P.osVersion&&{os_version:P.osVersion}),{},{detail:""})};return ju(()=>Hu(v,{data:F,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,x=>x.code!==Y.OPERATION_ABORTED,I)}(_,e,n,i));let u=null,h=null,f={};try{u=await uy(c)}catch(_){if(_.code===Y.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),Et.reportApiInvoke(e.sid,{name:hi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{f=function(_){if(!_.test_tags)return{};const v=_.test_tags,y=Object.keys(v),w={};return y.forEach(I=>{var P;const F=Fs(P=I.slice(4)).call(P),x=JSON.parse(v[I]),M=x[1];w[F]={tag:x[0]||"",value:M}}),w}(u)}catch{}return f}async function Nz(e,n){const i=Q("WEBCS_DOMAIN").concat(Q("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:L0(),serviceIds:[ri.CHOOSE_SERVER,ri.CLOUD_PROXY_FALLBACK]}));try{return await Az({referenceList:i,asyncMapHandler:c=>async function(u,h,f){let _,{url:v,areaCode:y,serviceIds:w}=u;const I=Date.now(),[P,F]=OL(h,y,w);let x=ni.networkState;try{x&&ni.networkState===xa.OFFLINE&&ni.onlineWaiter&&await tt.race([ni.onlineWaiter,Hi(pi.maxRetryTimeout)]),x=ni.networkState;const{data:M,headers:$}=await Hu(v,{data:P,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=$.http3==="1"?1:-1,(ge=>{const pe=[];if(ge.response_body.forEach(we=>{const Be=we.buffer.code;if(we.uri===23&&Be===0&&!we.buffer.edges_services)if(we.buffer.flag===4194310)we.buffer.edges_services=[];else{const nt={error:new Te(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ge.detail[502]}),flag:we.buffer.flag};pe.push(nt)}if(Be!==0){const nt=sy(Be),st={error:new Te(Y.CAN_NOT_GET_GATEWAY_SERVER,nt.desc,{desc:nt.desc,retry:nt.retry,csIp:ge.detail[502]}),flag:we.buffer.flag};we.buffer.flag===4194310?N.warning(st.error.toString()):pe.push(st)}}),pe.length)throw new Te(Y.CAN_NOT_GET_GATEWAY_SERVER,pe.map(we=>"flag: ".concat(we.flag,", message: ").concat(we.error.message)).join(" | "),{retry:!!pe.find(we=>we.error.data.retry),csIp:ge.detail[502],desc:[...new Set(pe.map(we=>{var Be;return we==null||(Be=we.error)===null||Be===void 0||(Be=Be.data)===null||Be===void 0?void 0:Be.desc}).filter(we=>!!we))]})})(M);const ae=P0(M,ri.CHOOSE_SERVER),me=P0(M,ri.CLOUD_PROXY_FALLBACK);return AL(ae),{gatewayInfo:_L(ae,v),proxyInfo:me,opid:F,requestTime:I,url:v,isHttp3:_,elapse:Date.now()-I}}catch(M){throw M}}(c,e,n),closeFn:c=>c.code===Y.OPERATION_ABORTED||c.code===Y.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function kz(e,n,i,o){const c=Q("PROXY_SERVER_TYPE3"),u=(P,F,x)=>{let M=x||c;return Array.isArray(M)&&(M=F%2==0?c[1]:c[0]),"https://".concat(M,"/ap/?url=").concat(P)};let h=null;const f=[],_=async()=>{const P=Q("WEBCS_DOMAIN").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map((M,$)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(M,"/api/v2/transpond/webrtc?v=2"),$,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):u("".concat(M,"/api/v2/transpond/webrtc?v=2"),$),{url:q,areaCode:L0(),serviceIds:[ri.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ri.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK]}}),F=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(M=>M.url)}),x=await x0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:M=>(N.debug("[".concat(e.clientId,"] Connect to choose_server:"),M.url),Cz(M,e,n,i)),allFailedhandler:M=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},F),M[0]},promisesCollector:f});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},F),x},v=async()=>{if(await Hi(1e3),h!==null)return h;const P=Q("WEBCS_DOMAIN_BACKUP_LIST").map((M,$)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(M,"/api/v2/transpond/webrtc?v=2"),$,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):u("".concat(M,"/api/v2/transpond/webrtc?v=2"),$),{url:q,areaCode:L0(),serviceIds:[ri.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ri.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK]}}),F=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(M=>M.url)}),x=await x0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:M=>(N.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),M.url),Cz(M,e,n,i)),allFailedhandler:M=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},F),M[0]},promisesCollector:f});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},F),x};let y,w,I;try{({gatewayInfo:y,proxyInfo:w,url:I}=await uy([_(),v()]))}catch(P){throw P[0]}if(f.length&&f.forEach(P=>P.cancel&&typeof P.cancel=="function"&&P.cancel()),!y||!w)throw new Te(Y.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=I,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&I){const P=/^https?:\/\/(.+?)(\/.*)?$/.exec(I)[1];Xe(c).call(c,P)&&(e.proxyServer=P,N.setProxyServer(P),Et.setProxyServer(P))}return h={gatewayInfo:y,proxyInfo:await nz(w,y.uid)},h}async function epe(e,n,i){const o=Q("UAP_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,f,_,v){const y={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:Xc,cname:f.cname,uid:f.uid.toString(),requestId:IL,seq:IL};IL+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(y)};return ju(async()=>{const I=await Hu(h,{data:w,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(I.code!==0){const F=new Te(Y.UNEXPECTED_RESPONSE,"cross channel ap error, code"+I.code,{retry:!0});throw N.error(F.toString()),F}const P=JSON.parse(I.json_body);if(P.code!==200){const F=new Te(Y.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(P.code,", reason: ").concat(P.reason));throw N.error(F.toString()),F}if(!P.servers||P.servers.length===0){const F=new Te(Y.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw N.error(F.toString()),F}return{vid:P.vid,workerToken:P.workerToken,addressList:(Q("CHANNEL_MEDIA_RELAY_SERVERS")||P.servers).map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(Q("WORKER_DOMAIN"),":").concat(F.wss))}},void 0,I=>!!(I.code!==Y.OPERATION_ABORTED&&I.code!==Y.UNEXPECTED_RESPONSE||I.data&&I.data.retry),v)}(u,e,n,i));try{const u=await uy(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function tpe(e,n,i){let o=null;const c=[],u=async h=>{const f=Q(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await Hi(1e3),o!==null)?o:await x0({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:_=>(N.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(v,y,w,I){const[P]=Jhe(y,[ri.CHOOSE_SERVER]);let F=ni.networkState;return ju(async()=>{F&&ni.networkState===xa.OFFLINE&&ni.onlineWaiter&&await tt.race([ni.onlineWaiter,Hi(I&&I.maxRetryTimeout||pi.maxRetryTimeout)]),F=ni.networkState;const x=await Hu(v,{data:P,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return Xhe(x,v)},()=>!1,x=>x.code!==Y.OPERATION_ABORTED&&(x.code===Y.UPDATE_TICKET_FAILED?x.data.retry:(N.warning("[".concat(y.clientId,"] update ticket network error, retry"),x),!0)),I)}(_,e,n,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await uy([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function Dz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function NL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Dz(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Dz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class npe extends Rr{get isSuccess(){return!!this.configs}constructor(n,i){super(),z(this,"configs",void 0),z(this,"store",void 0),z(this,"joinInfo",void 0),z(this,"cancelToken",void 0),z(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),z(this,"interval",void 0),z(this,"mutex",void 0),z(this,"mutableParamsRead",!1),z(this,"configCache",{}),z(this,"limit_bitrate",void 0),this.mutex=new ms("config-distribute",n),this.store=i}startGetConfigDistribute(n,i){this.joinInfo=n,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),Q("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Q("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Et.reportApiInvoke(null,{options:void 0,name:hi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:kr.TRACER}).onSuccess(JSON.stringify(Bu))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void N.debug("[config-distribute] get config distribute interrupted have no joininfo");let n;const i=await this.mutex.lock();try{n=await Zhe(this.joinInfo,this.cancelToken,this.retryConfig),N.debug("[config-distribute] get config distribute",JSON.stringify(n));const o=function(c){var u;const h=n0(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<h.length;v++)for(let y=h.length-1;y>v;y--){const w=h[y],I=c[w].value;if(typeof I.__priority=="number"){const P=I.__priority,F=h[y-1],x=c[F].value;if(typeof x.__priority=="number"){if(!(P>x.__priority))continue;{const M=w;h[y]=h[y-1],h[y-1]=M}}else{const M=w;h[y]=h[y-1],h[y-1]=M}}}const f=Date.now();let _={};return h.forEach(v=>{const y=c[v].value.__expires;y&&y<=f||(_[v]=c[v])}),_}(n);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Te(Y.NETWORK_RESPONSE_ERROR,o);N.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(n){zG(n)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==n.id&&this.emit(I0.UPDATE_BITRATE_LIMIT,n):this.emit(I0.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.limit_bitrate&&NL({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(n){try{const i={},o=Object.keys(n),c=[];o.forEach(u=>{const h=n[u].value;i[u]=h;const f=h.__id;if(f&&this.configCache[u]&&this.configCache[u].__id===f)return;const _=h.__type,v=n[u].value,y=n[u].tag;let w=0;_?_===v6.REALTIME&&(w=1):Object.keys(v).some(I=>Object.prototype.hasOwnProperty.call(V1,I)||!aL()&&Object.prototype.hasOwnProperty.call(BI,I)?(w=1,!0):void 0),c.push({tag:y,isApplied:w,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:f,params:_,isApplied:v}=u;this.store.sessionId&&Et.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:f,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){N.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(n){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const f=c[h].value,_=f.__expires,v=f.__type;Object.keys(f).forEach(y=>{y==="__id"||y==="__type"||y==="__priority"||y==="__expires"||Object.prototype.hasOwnProperty.call(u,y)||(u[y]=NL(NL({value:f[y]},_&&{expires:_}),v&&{type:v}))})}),u}(n);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&zG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(n),function(f){try{const _=Date.now();Object.keys(f).forEach(v=>{const{value:y,type:w,expires:I}=f[v];I&&I<=_||((w===v6.REALTIME||Object.prototype.hasOwnProperty.call(V1,v))&&(Bu[v]=y,dr[v]=y,N.debug("Update realtime parameters from config distribute",v,y)),w||aL()||!Object.prototype.hasOwnProperty.call(BI,v)||(Bu[v]=y,dr[v]=y,N.debug("Update gateway parameters from config distribute",v,y)))})}catch(_){N.error("Error update config immediately: ".concat(f),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),N.debug("Caching global parameters ".concat(u))}catch(c){N.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(n){try{const i=Date.now();Object.keys(n).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(dr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;(function(h,f){try{return typeof h=="object"&&typeof f=="object"&&JSON.stringify(h)===JSON.stringify(f)}catch{return!1}})(dr[o],c)||(Bu[o]=c,dr[o]=c,this.emit(I0.UPDATE_CLIENT_ROLE_OPTIONS,c),N.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){N.error("Error handling global parameter config:",i.message)}}}class rpe extends Rr{constructor(){super(...arguments),z(this,"resultStorage",new Map)}setLocalAudioStats(n,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(n,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(o))}setRemoteAudioStats(n,i){const o=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(n,i){const o=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(n,i,o){if(Q("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=Xe(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",Lz[n],n,i),!c.isPrevNormal&&h&&this.emit("exception",Lz[n]+2e3,n+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&n.receiveLevel===0)}checkAudioInputLevel(n,i){return i instanceof Ei&&!i.isActive||!!i.muted||n.sendVolumeLevel!==0}checkFramerateInput(n,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=Ma(i._encoderConfig.frameRate));const c=n.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,i){return!!i.muted||n.sendBitrate!==0}checkSendAudioBitrate(n,i){return i instanceof Ei&&!i.isActive||!!i.muted||n.sendBitrate!==0}checkVideoDecode(n){return n.receiveBitrate===0||n.decodeFrameRate!==0}}const Lz={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Es=new class{markSubscribeStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(n))}markPublishStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(n))}measureFromSubscribeStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function xz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function n_(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?xz(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class M0{constructor(n){z(this,"store",void 0),z(this,"onStatsException",void 0),z(this,"onUploadPublishDuration",void 0),z(this,"onStatsChanged",void 0),z(this,"localStats",new Map),z(this,"remoteStats",new Map),z(this,"updateStatsInterval",void 0),z(this,"trafficStats",void 0),z(this,"trafficStatsPeerList",[]),z(this,"uplinkStats",void 0),z(this,"exceptionMonitor",void 0),z(this,"p2pChannel",void 0),z(this,"scalabilityMode",jI.L1T1),z(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.exceptionMonitor=new rpe,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ve.LocalAudioTrack)||n_({},G1)}getLocalVideoTrackStats(){return this.localStats.get(Ve.LocalVideoTrack)||n_({},z1)}getRemoteAudioTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.audioStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:f}]=u;f&&(o[h]=i(h,f))});return o}getRemoteNetworkQualityStats(n){const i={};if(n){var o;const c=(o=this.remoteStats.get(n))===null||o===void 0?void 0:o.networkStats;c&&(i[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.videoStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:f}]=u;f&&(o[h]=i(h,f))});return o}getRTCStats(){let n=0,i=0,o=0,c=0;const u=this.localStats.get(Ve.LocalAudioTrack);u&&(n+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(Ve.LocalVideoTrack);h&&(n+=h.sendBytes,i+=h.sendBitrate);const f=this.localStats.get(Ve.LocalVideoLowTrack);f&&(n+=f.sendBytes,i+=f.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:y,videoStats:w}=v;y&&(o+=y.receiveBytes,c+=y.receiveBitrate),w&&(o+=w.receiveBytes,c+=w.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:n,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),n.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Es.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Es.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&N.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,i,o){if(!n)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case Ve.LocalVideoTrack:case Ve.LocalVideoLowTrack:{const h=c,f=n_({},z1),_=n.getStats(),v=n.getLocalMedia(o);if(_){const y=_.videoSend.find(w=>w.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(y){const w=n.getLocalVideoSize(),I=n.getEncoderConfig(Ve.LocalVideoTrack);y.codec!=="H264"&&y.codec!=="H265"&&y.codec!=="VP8"&&y.codec!=="VP9"&&y.codec!=="AV1X"&&y.codec!=="AV1"||(f.codecType=y.codec),f.sendBytes=y.bytes,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0,y.inputFrame?(f.captureFrameRate=y.inputFrame.frameRate,f.captureResolutionHeight=y.inputFrame.height,f.captureResolutionWidth=y.inputFrame.width):w&&(f.captureResolutionWidth=w.width,f.captureResolutionHeight=w.height),y.sentFrame?(f.sendFrameRate=y.sentFrame.frameRate,f.sendResolutionHeight=y.sentFrame.height,f.sendResolutionWidth=y.sentFrame.width):w&&(f.sendResolutionWidth=w.width,f.sendResolutionHeight=w.height),y.avgEncodeMs&&(f.encodeDelay=y.avgEncodeMs),I&&I.bitrateMax&&(f.targetSendBitrate=1e3*I.bitrateMax),f.sendPackets=y.packets,f.sendPacketsLost=y.packetsLost,f.sendJitterMs=y.jitterMs,f.sendRttMs=y.rttMs,f.totalDuration=h?h.totalDuration+1:1,f.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(y)&&(f.totalFreezeTime+=1),y.scalabilityMode&&this.scalabilityMode!==y.scalabilityMode&&(N.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(y.scalabilityMode)),this.scalabilityMode=y.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,f),((h==null?void 0:h.sendResolutionWidth)!==f.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==f.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,f);break}case Ve.LocalAudioTrack:{const h=c,f=n_({},G1),_=n.getStats(),v=n.getLocalMedia(o);if(_){const y=_.audioSend.find(w=>w.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(y){if(y.codec!=="opus"&&y.codec!=="aac"&&y.codec!=="PCMU"&&y.codec!=="PCMA"&&y.codec!=="G722"||(f.codecType=y.codec),y.inputLevel)f.sendVolumeLevel=Math.round(32767*y.inputLevel);else{const w=n.getLocalAudioVolume();w&&(f.sendVolumeLevel=Math.round(32767*w))}f.sendBytes=y.bytes,f.sendPackets=y.packets,f.sendPacketsLost=y.packetsLost,f.sendJitterMs=y.jitterMs,f.sendRttMs=y.rttMs,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ve.LocalAudioTrack,f),f&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,f);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:f,videoPcStats:_}]=i;const v=f,y=h,w=_,I=n_({},P6),P=n_({},N6),F=n_({},Bde),{audioTrack:x,videoTrack:M,audioSSRC:$,videoSSRC:q}=n.getRemoteMedia(u);let ae;ae=this.store.useP2P?n.getStats(!0):n.getStats();const me=(o=ae)===null||o===void 0?void 0:o.audioRecv.find(Be=>Be.ssrc===$),ge=(c=ae)===null||c===void 0?void 0:c.videoRecv.find(Be=>Be.ssrc===q),pe=this.trafficStats&&this.trafficStats.peer_delay.find(Be=>Be.peer_uid===u);if(me&&(me.codec!=="opus"&&me.codec!=="aac"&&me.codec!=="PCMU"&&me.codec!=="PCMA"&&me.codec!=="G722"||(I.codecType=me.codec),me.outputLevel?I.receiveLevel=Math.round(32767*me.outputLevel):x&&(I.receiveLevel=Math.round(32767*x.getVolumeLevel())),I.receiveBytes=me.bytes,I.receivePackets=me.packets,I.receivePacketsLost=me.packetsLost,I.receivePacketsDiscarded=me.packetsDiscarded,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=v?8*Math.max(0,I.receiveBytes-v.receiveBytes):0,I.totalDuration=v?v.totalDuration+1:1,I.totalFreezeTime=v?v.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=me.jitterBufferMs,I.totalDuration>10&&M0.isRemoteAudioFreeze(x)&&(I.totalFreezeTime+=1)),ge){var we;ge.codec!=="H264"&&ge.codec!=="H265"&&ge.codec!=="VP8"&&ge.codec!=="VP9"&&ge.codec!=="AV1X"&&ge.codec!=="AV1"||(P.codecType=ge.codec),P.receiveBytes=ge.bytes,P.receiveBitrate=y?8*Math.max(0,P.receiveBytes-y.receiveBytes):0,P.decodeFrameRate=ge.decodeFrameRate<0?0:ge.decodeFrameRate,P.renderFrameRate=ge.decodeFrameRate<0?0:ge.decodeFrameRate,ge.outputFrame&&(P.renderFrameRate=ge.outputFrame.frameRate),ge.receivedFrame?(P.receiveFrameRate=ge.receivedFrame.frameRate,P.receiveResolutionHeight=ge.receivedFrame.height,P.receiveResolutionWidth=ge.receivedFrame.width):M&&(P.receiveResolutionHeight=M._videoHeight||0,P.receiveResolutionWidth=M._videoWidth||0),ge.framesRateFirefox!==void 0&&(P.receiveFrameRate=Math.round(ge.framesRateFirefox)),P.receivePackets=ge.packets,P.receivePacketsLost=ge.packetsLost,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost);const Be=y?y.totalFreezeTime:0,nt=y?y.totalDuration:0;P.totalDuration=y?y.totalDuration+1:1,P.totalFreezeTime=(we=ge.totalFreezesDuration)!==null&&we!==void 0?we:Be||0,P.receiveDelay=ge.jitterBufferMs||0;const st=!!q&&n.getRemoteVideoIsReady(q);ge.totalFreezesDuration===void 0&&M&&st&&M0.isRemoteVideoFreeze(M,ge,w)&&(P.totalFreezeTime+=1),P.freezeRate=Math.max(0,Math.min((P.totalFreezeTime-Be)/(P.totalDuration-nt),1))}pe&&(I.end2EndDelay=pe.B_ad,P.end2EndDelay=pe.B_vd,I.transportDelay=pe.B_ed,P.transportDelay=pe.B_ed,I.currentPacketLossRate=pe.B_ealr4/100,P.currentPacketLossRate=pe.B_evlr4/100,F.uplinkNetworkQuality=pe.B_punq?pe.B_punq:0,F.downlinkNetworkQuality=pe.B_pdnq?pe.B_pdnq:0),this.remoteStats.set(u,{audioStats:I,videoStats:P,videoPcStats:ge,networkStats:F}),x&&this.exceptionMonitor.setRemoteAudioStats(x,I),M&&this.exceptionMonitor.setRemoteVideoStats(M,P)})}}class Mz{constructor(){z(this,"destChannelMediaInfos",new Map),z(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){WG(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){WG(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){oA(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Uz(e){if(!(e instanceof Mz))return new Te(Y.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!n)return new Te(Y.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new Te(Y.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Zf{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,i){z(this,"uid",void 0),z(this,"_uintid",void 0),z(this,"_trust_in_room_",!0),z(this,"_trust_audio_enabled_state_",!0),z(this,"_trust_video_enabled_state_",!0),z(this,"_trust_audio_mute_state_",!0),z(this,"_trust_video_mute_state_",!0),z(this,"_audio_muted_",!1),z(this,"_video_muted_",!1),z(this,"_audio_enabled_",!0),z(this,"_video_enabled_",!0),z(this,"_audio_added_",!1),z(this,"_video_added_",!1),z(this,"_is_pre_created",!1),z(this,"_video_pre_subscribed",!1),z(this,"_audio_pre_subscribed",!1),z(this,"_trust_video_stream_added_state_",!0),z(this,"_trust_audio_stream_added_state_",!0),z(this,"_audioTrack",void 0),z(this,"_videoTrack",void 0),z(this,"_dataChannels",[]),z(this,"_audioSSRC",void 0),z(this,"_videoSSRC",void 0),z(this,"_audioOrtc",void 0),z(this,"_videoOrtc",void 0),z(this,"_cname",void 0),z(this,"_rtxSsrcId",void 0),z(this,"_videoMid",void 0),z(this,"_audioMid",void 0),this.uid=n,this._uintid=i}}function Vz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Fz(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Vz(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Vz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const U0="9",jz=4e4;function Bz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function vp(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Bz(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Bz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var dy=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(dy||{});const yA=new Map;function Wz(e,n,i,o){let{scale:c}=e;if(c===0&&o===dy.UP||c>=n.length-1&&o===dy.DOWN)return e;let u=vp(vp({},e),{},{scale:o===dy.DOWN?++c:--c});switch(i){case"maintain-framerate":u=vp(vp({},u),n[c].motion);break;case"maintain-resolution":u=vp(vp({},u),n[c].detail);break;case"balanced":u=vp(vp({},u),n[c].balanced)}return u}function Gz(e,n){if(n){const i={overUse:0,underUse:0,adaptationList:zz(n)};yA.set(e,i)}else yA.delete(e)}function zz(e){const n=vp({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=n,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:y,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:I,PERF_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_UP_THRESHOLD:F,BALANCE_BITRATE_FACTOR:x,BALANCE_FRAMERATE_FACTOR:M,BALANCE_RESOLUTION_FACTOR:$,MOTION_RESOLUTION_FACTOR:q,MOTION_BITRATE_FACTOR:ae,DETAIL_FRAMERATE_FACTOR:me,DETAIL_BITRATE_FACTOR:ge}=M1,pe=Math.min(n.frameRate,f),we=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(I,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(P,1)*pe),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let Be=1;Be<=_;Be++){const nt={bwe_up:Math.round(Math.pow(w,Be)*i),bwe_down:Math.round(Math.pow(I,Be+1)*i),fps_up:Math.round(Math.pow(F,Be)*pe),fps_down:Math.round(Math.pow(P,Be+1)*pe)},st={scaleResolutionDownBy:c/Math.pow($,Be),frameRate:Math.max(Math.round(Math.pow(M,Be)*o),h),bitrateMax:Math.max(Math.round(Math.pow(x,Be)*i),y),bitrateMin:Math.max(Math.round(Math.pow(x,Be)*u),v)},dn={scaleResolutionDownBy:c/Math.pow(q,Be),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ae,Be)*i),y),bitrateMin:Math.max(Math.round(Math.pow(ae,Be)*u),v)},hn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(me,Be)*o),h),bitrateMax:Math.max(Math.round(Math.pow(ge,Be)*i),y),bitrateMin:Math.max(Math.round(Math.pow(ge,Be)*u),v)};we.push({scale:Be,threshold:nt,balanced:st,motion:dn,detail:hn})}return we}function ipe(e,n,i,o,c,u){const h=yA.get(e)||{overUse:0,underUse:0,adaptationList:zz(c)},{adaptationList:f}=h;yA.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:v}=M1,{scale:y}=o;let w,I;return typeof n=="number"&&n>0&&function(P,F,x,M){if(F>=x.length)return!1;let{threshold:{fps_down:$}}=x[F];return Q("FORCE_AG_HIGH_FRAMERATE")&&M==="maintain-framerate"&&($=x[0].threshold.fps_down),P<$}(n,y,f,u)&&(h.overUse++,I=S0.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(P,F,x){if(F>=x.length)return!1;const{threshold:{bwe_down:M}}=x[F];return P<M}(i,y,f)&&(h.overUse++,I=S0.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,w=Wz(o,f,u,dy.DOWN),[w,I]):(typeof n=="number"&&n>0&&typeof i=="number"&&i>0&&function(P,F,x,M){if(F===0)return;let{threshold:{fps_up:$}}=x[F];return Q("FORCE_AG_HIGH_FRAMERATE")&&M==="maintain-framerate"&&($=x[1].threshold.fps_up),P>$}(n,y,f,u)&&function(P,F,x){if(F===0)return;const{threshold:{bwe_up:M}}=x[F];return P>M}(i,y,f)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,w=Wz(o,f,u,dy.UP),w.scale===0&&(I=S0.NONE))),[w,I])}function Hz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function kL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Hz(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Hz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function spe(e){var n;return!!Q("ENABLE_AG_ADAPTATION")&&!!(e instanceof Z1||Xe(n=e._hints).call(n,rr.CUSTOM_TRACK))&&(!!Q("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=vn();if(o.os!==Ci.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&B5(17,4)||j5(14)&&W5(17,4,!0)))}const SA=new Map;function TA(e,n){const i=SA.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),SA.delete(e)}n.qualityLimitationReason=S0.NONE,Gz(e)}function ope(e,n){var i;let o;switch(n){case Ve.LocalAudioTrack:o=Fn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=e._hints).call(i,rr.SCREEN_TRACK)?Fn.Screen:Fn.High;break;case Ve.LocalVideoLowTrack:o=Fn.Low}return o}function DL(e){const n=In();if(e.some(i=>i._bypassWebAudio))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!n.webAudioMediaStreamDest)throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function LL(e,n){DL(e);const i=new Ei;return e.forEach(o=>i.addAudioTrack(o)),i}const ape=!In().supportUnifiedPlan||Q("CHROME_FORCE_PLAN_B")&&lp();function bA(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return ape?(i={spec:n,store:e},_p("PlanBConnection").create(i)):new Gd(n,e)}function xL(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function Kz(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(E0(e.turnServer.servers))return!1;if(Q("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(n=>n.forceturn))return!0}return!1}catch{return!1}}var gn;function $z(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ku(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?$z(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$z(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Gd=(gn=class w_ extends KG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return Xe(i=Object.keys(WI)).call(i,n)}))]}constructor(n,i){super(n,i),z(this,"id",nr(5,"connection-")),z(this,"store",void 0),z(this,"peerConnection",void 0),z(this,"forceTurn",!1),z(this,"remoteSDP",void 0),z(this,"initialOffer",void 0),z(this,"transportEventReceiver",void 0),z(this,"statsFilter",void 0),z(this,"extension",{useXR:Q("USE_XR")}),z(this,"localCapabilities",void 0),z(this,"remoteCodecs",void 0),z(this,"localCandidateCount",0),z(this,"allCandidatesReceived",!1),z(this,"isPreallocation",!1),z(this,"preSSRCMap",new Map),z(this,"dataStreamChannelMap",new Map),z(this,"establishPromise",void 0),z(this,"recoveredDataChannelIds",[]),z(this,"currentDataChannelId",1),z(this,"supportAV1RtpSpec",!1),z(this,"mutex",void 0),z(this,"qualityLimitationReason",S0.NONE),z(this,"isFirstConnected",!1),this.store=i,this.forceTurn=Kz(n),this.mutex=new ms("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(w_.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=D1(this.peerConnection,Q("STATS_UPDATE_INTERVAL"),void 0,Pr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(n){const i=this.preSSRCMap.get(n);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(n,i){if(this.remoteCodecs=i,!this.remoteSDP)return void N.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(n,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else N.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Jf(o.sdp),u=await hz({filterRTX:!Q("USE_PUB_RTX")&&!Q("USE_SUB_RTX"),filterVideoFec:Q("FILTER_VIDEO_FEC"),filterAudioFec:Q("FILTER_AUDIO_FEC"),filterVideoCodec:Q("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=mA(u),this.initialOffer=o,Q("ENABLE_SVC")&&this.store.codec=="av1"){const f=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:jI.L1T3}]});const v=await _.createOffer();if(!v.sdp)return void _.close();const y=ca(v.sdp).mediaDescriptions[0];if(!y)return;const w=y.attributes.extmaps.find(I=>I.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),w}catch{return}}();var n;f&&(this.supportAV1RtpSpec=!0,(n=u.send)===null||n===void 0||n.videoExtensions.push(f))}let h;return o.sdp&&gz(o.sdp)&&(h=Dr(u),(i=h).send&&(oy(at.VIDEO,i.send.videoExtensions),oy(at.AUDIO,i.send.audioExtensions)),i.recv&&(oy(at.VIDEO,i.recv.videoExtensions),oy(at.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(oy(at.VIDEO,i.sendrecv.videoExtensions),oy(at.AUDIO,i.sendrecv.audioExtensions))),Ku(Ku({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Ce(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&gz(this.initialOffer.sdp)&&(i=n.rtpCapabilities,o=this.localCapabilities,i.send&&(hA(at.VIDEO,i.send.videoExtensions,o.send.videoExtensions),hA(at.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(hA(at.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),hA(at.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Dr(this._localCapabilities)}get rtpCapabilities(){return Dr(this._rtpCapabilities)}get candidates(){return Dr(this._candidates)}get iceParameters(){return Dr(this._iceParameters)}get dtlsParameters(){return Dr(this._dtlsParameters)}constructor(v){let y=arguments.length>1&&arguments[1]!==void 0&&arguments[1];z(this,"sessionDesc",void 0),z(this,"_localCapabilities",void 0),z(this,"_rtpCapabilities",void 0),z(this,"_candidates",void 0),z(this,"_originCandidates",void 0),z(this,"_iceParameters",void 0),z(this,"_isUseExtmapAllowMixed",void 0),z(this,"_dtlsParameters",void 0),z(this,"setup",void 0),z(this,"currentMidIndex",void 0),z(this,"cname",void 0),z(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=y,v=Dr(v);const{iceParameters:w,dtlsParameters:I,candidates:P,rtpCapabilities:F,setup:x,localCapabilities:M,cname:$}=v;this._rtpCapabilities=F,this._candidates=P,this._originCandidates=Dr(P),this._iceParameters=w,this._dtlsParameters=I,this._localCapabilities=M,this.setup=x,this.cname=$,this.sessionDesc=this.updateRemoteRTPCapabilities(F),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const y=this.candidates,w=this.dtlsParameters,I=this.iceParameters,P=this.rtpCapabilities.send;let F=this.sessionDesc.mediaDescriptions.length-1;for(let x=1;x<v;x++){const M=2*x+2e4,$=2*x+jz,{ssrcs:q,ssrcGroups:ae}=t_([{ssrcId:M}],this.cname),{ssrcs:me,ssrcGroups:ge}=t_([{ssrcId:$,rtx:Q("USE_SUB_RTX")?$+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:U0,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.videoCodecs.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:y,extmaps:P.videoExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:me,ssrcGroups:ge,rtcpFeedbackWildcards:[],payloads:P.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++F)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:U0,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.audioCodecs.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:y,extmaps:P.audioExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:ae,rtcpFeedbackWildcards:[],payloads:P.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++F)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Kf(this.sessionDesc)}send(v,y,w,I){const{ssrcs:P,ssrcGroups:F}=t_(y,this.cname,Q("SYNC_GROUP")?w:void 0),x=this.findPreloadMediaDesc(P);if(x){if(Pr()&&this.firefoxSsrcMidMap.set(P[0].ssrcId,x.attributes.mid),I&&(I.twcc||I.remb)){const M=this.sessionDesc.mediaDescriptions.indexOf(x);return this.sessionDesc.mediaDescriptions[M]=this.mungSendMediaDesc(x,I),{mid:x.attributes.mid,needExchangeSDP:!0}}return{mid:x.attributes.mid,needExchangeSDP:!1}}{const M=this.findAvailableMediaIndex(v,P);let $;return M===-1||M===1&&(as()||function(){const q=vn();return!(q.name!==Dn.CHROME||!q.osVersion)&&Number(q.version)<=90}()||Q("ENABLE_ENCODED_TRANSFORM")&&cp())||M===0&&Q("USE_SUB_RTX")||G5()?($=this.createOrRecycleSendMedia(v,P,F,"sendonly",I),this.updateBundleMids()):($=Dr(this.sessionDesc.mediaDescriptions[M]),$.attributes.direction="sendonly",$.attributes.ssrcs=P,$.attributes.ssrcGroups=F,this.sessionDesc.mediaDescriptions[M]=this.mungSendMediaDesc($,I)),Pr()&&this.firefoxSsrcMidMap.set(P[0].ssrcId,$.attributes.mid),{mid:$.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:y}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:y}}batchSend(v){const y=v.map(P=>{let{kind:F,ssrcMsg:x,mslabel:M}=P;return this.send(F,x,M)}),w=[];let I=!1;return y.forEach(P=>{let{mid:F,needExchangeSDP:x}=P;x&&(I=!0),w.push(F)}),{mids:w,needExchangeSDP:I}}stopSending(v){const y=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&v.indexOf(w.attributes.mid)!==-1);if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");y.forEach(w=>{w.attributes.mid==="0"||Pr()||G5()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")}),this.updateBundleMids()}mute(v){const y=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===v);if(!y)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));y.attributes.direction="inactive"}unmute(v){const y=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===v);if(!y)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));y.attributes.direction="sendonly"}muteRemote(v){const y=this.sessionDesc.mediaDescriptions.filter(w=>Xe(v).call(v,w.attributes.mid||""));if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");y.forEach(w=>{w.attributes.direction="inactive"})}unmuteRemote(v){const y=this.sessionDesc.mediaDescriptions.filter(w=>Xe(v).call(v,w.attributes.mid||""));if(y.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");y.forEach(w=>{w.attributes.direction="recvonly"})}receive(v,y,w,I){v.forEach((P,F)=>{this.createOrRecycleRecvMedia(P,[],"recvonly",y,w,I[F])}),this.updateBundleMids()}stopReceiving(v){const y=this.sessionDesc.mediaDescriptions.filter(w=>v.indexOf(w.attributes.mid)!==-1);if(y.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");y.forEach(w=>{w.media.port="0",w.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const y=this.sessionDesc||ca((w=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(w?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var w;this._rtpCapabilities=v;const I=this.rtpCapabilities.send,P=this.localCapabilities.send;for(const F of y.mediaDescriptions){if(F.attributes.iceUfrag=this._iceParameters.iceUfrag,F.attributes.icePwd=this._iceParameters.icePwd,F.attributes.fingerprints=this._dtlsParameters.fingerprints,F.attributes.candidates=this._candidates,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video"){if(I.videoCodecs.length===0){const x=P.videoCodecs.filter(M=>{var $,q;return($=M.rtpMap)===null||$===void 0?void 0:Xe(q=$.encodingName.toLowerCase()).call(q,"vp8")})||[P.videoCodecs[0]];F.media.fmts=x.map(M=>M.payloadType.toString(10)),F.attributes.payloads=x,F.attributes.extmaps=[]}else if(F.media.fmts=I.videoCodecs.map(x=>x.payloadType.toString(10)),F.attributes.payloads=I.videoCodecs,F.attributes.extmaps=I.videoExtensions,Q("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:x,ssrcGroups:M}=t_([{ssrcId:jz,rtx:Q("USE_SUB_RTX")?40001:void 0}],this.cname);F.attributes.ssrcs=x,F.attributes.ssrcGroups=M}}if(F.media.mediaType==="audio"){if(I.audioCodecs.length===0){const x=P.audioCodecs.filter(M=>{var $,q;return($=M.rtpMap)===null||$===void 0?void 0:Xe(q=$.encodingName.toLowerCase()).call(q,"opus")})||[P.audioCodecs[0]];F.media.fmts=x.map(M=>M.payloadType.toString(10)),F.attributes.payloads=x,F.attributes.extmaps=[]}else if(F.media.fmts=I.audioCodecs.map(x=>x.payloadType.toString(10)),F.attributes.payloads=I.audioCodecs,F.attributes.extmaps=I.audioExtensions,cy(F),Q("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:x,ssrcGroups:M}=t_([{ssrcId:2e4}],this.cname);F.attributes.ssrcs=x,F.attributes.ssrcGroups=M}}}return this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const y=this._originCandidates.filter(I=>I.transport==="udp"),w=[];if(y.forEach(I=>{w.push(Fz(Fz({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),y.length!==0){switch(v){case _s.TCP_RELAY:this._candidates=w;break;case _s.UDP_TCP_RELAY:case _s.RELAY:this._candidates=[...y,...w];break;default:this._candidates=y}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(v){v=Dr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(y=>{y.attributes.iceUfrag=v.iceUfrag,y.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const y=[];for(let w=0;w<v;w++)y.push((this.currentMidIndex+w+1).toString(10));return y}findAvailableMediaIndex(v,y){return this.sessionDesc.mediaDescriptions.findIndex(w=>{const I=w.media.mediaType===v&&w.media.port!=="0"&&(w.attributes.direction==="sendonly"||w.attributes.direction==="sendrecv")&&w.attributes.ssrcs.length===0;if(Pr()){if(I){const P=this.firefoxSsrcMidMap.get(y[0].ssrcId);return!(P||w.attributes.mid!=="0"&&w.attributes.mid!=="1")||!(!P||P!==w.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if(w.media.mediaType==="application")return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),y={media:{mediaType:"application",port:U0,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(y),{mediaDesc:y,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,y,w,I,P,F){const x=v._mediaStreamTrack.kind,M=this.rtpCapabilities.recv,$=k0(x,M,this.localCapabilities.send,x===at.VIDEO?I:P),q=x===at.VIDEO?M.videoExtensions:M.audioExtensions;this.currentMidIndex+=1;const ae="".concat(this.currentMidIndex);let me={media:{mediaType:x,port:U0,protos:["UDP","TLS","RTP","SAVPF"],fmts:$.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ae)}};me=this.mungRecvMediaDsec(me,v,F);const ge=this.findFirstClosedMedia(x);if(ge){const pe=this.sessionDesc.mediaDescriptions.indexOf(ge);this.sessionDesc.mediaDescriptions[pe]=me}else this.sessionDesc.mediaDescriptions.push(me);return me}updateRemoteCodec(v,y,w){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(me=>me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||"").filter(me=>{var ge;return Xe(ge=Object.keys(WI)).call(ge,me)}))],P=new Set(y);if(I.every(me=>P.has(me)))return N.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(y)),!1;const F=this._rtpCapabilities.recv.videoCodecs.filter(me=>y.some(ge=>{var pe;return Xe(pe=me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||"").call(pe,ge)}));if(F.length===0)return N.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(y)),!1;const x=[...new Set(F.map(me=>me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||""))];let M;if(N.debug("updateRemoteCodec, from ".concat(I," to ").concat(x)),v.length===0)M=this.sessionDesc.mediaDescriptions.filter(me=>me.media.mediaType==="video"&&me.attributes.direction==="recvonly");else if(M=this.sessionDesc.mediaDescriptions.filter(me=>me.attributes.mid&&Xe(v).call(v,me.attributes.mid)&&me.attributes.direction==="recvonly"),M.length!==v.length)return N.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(y)),!1;if(Q("USE_PUB_RTX")||Q("USE_SUB_RTX")){const me=SL(F,this.rtpCapabilities.recv.videoCodecs);F.push(...me)}this._rtpCapabilities.recv.videoCodecs=F;const $=this.localCapabilities.send,q=this.rtpCapabilities.recv,ae=k0(at.VIDEO,q,$,w);return M.forEach(me=>{const ge=ae.map(pe=>pe.payloadType.toString(10));N.debug("updateRemoteCodec mid: ".concat(me.attributes.mid,", from"),me.attributes.payloads,"to",ae),me.attributes.payloads=ae,me.media.fmts=ge}),!0}createOrRecycleSendMedia(v,y,w,I,P){const F=this.rtpCapabilities.send,x=v===at.VIDEO?F.videoCodecs:F.audioCodecs,M=v===at.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let q={media:{mediaType:v,port:U0,protos:["UDP","TLS","RTP","SAVPF"],fmts:x.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:M,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:x,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};q=this.mungSendMediaDesc(q,P);const ae=this.findFirstClosedMedia(v);if(ae){const me=this.sessionDesc.mediaDescriptions.indexOf(ae);this.sessionDesc.mediaDescriptions[me]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,y,w){const I=Dr(v);return vL(I),ay(I,y),yL(I,y),uz(I),fA(I,w,this.localCapabilities.send),I}mungSendMediaDesc(v,y){const w=Dr(v);return fA(w,y,this.localCapabilities.recv),cy(w),w}updateRecvMedia(v,y){const w=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===v);if(w!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],y);this.sessionDesc.mediaDescriptions[w]=I}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(y=>Pr()?y.media.port==="0"&&y.media.mediaType===v:y.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(y=>{var w;return((w=y.attributes)===null||w===void 0||(w=w.ssrcs[0])===null||w===void 0?void 0:w.ssrcId)===v[0].ssrcId})}getSSRC(v){var y;return(y=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===v))===null||y===void 0?void 0:y.attributes.ssrcs}}(Ku(Ku({},n),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),n.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=fz(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const f=this.peerConnection.getTransceivers()[0];if(f!=null&&f.receiver&&this.tryBindTransportEvents(f.receiver),Q("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(Q("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const y=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(y)}const{preSSRCs:_}=n;if(Array.isArray(_)&&_.length>0){const{mids:v}=this.remoteSDP.batchSend(_.map(y=>({kind:y.kind,ssrcMsg:[{ssrcId:y.ssrcId,rtx:y.rtx}],mslabel:y.mslabel})));v.forEach((y,w)=>{this.preSSRCMap.set(_[w].ssrcId,y)}),await D0(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=n;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=n;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await D0(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return Yc(function*(){const u=yield En(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=dA();n.forEach(M=>{const $=c.peerConnection.addTransceiver(M._mediaStreamTrack,Ku({direction:"sendonly"},M.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));h.push($),M._updateRtpTransceiver($)}),Pr()&&Q("SIMULCAST")===!0&&(yield En(c.applySimulcastForFirefox(h,n)));const _=yield En(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(n.length),y=c.mungSendOfferSDP(_.sdp,n,v),w=ca(y),I=v.map(M=>{const $=w.mediaDescriptions.find(q=>q.attributes.mid===M);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return az($,Q("USE_PUB_RTX"))});let P;try{P=yield I}catch(M){P=[],c.remoteSDP.receive(n,i,o,P);const $=c.remoteSDP.toString();throw yield En(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield En(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield En(c.stopSending(v,!0)),M}c.remoteSDP.receive(n,i,o,P);const F=c.remoteSDP.toString(),x=c.logSDPExchange(y,"offer","local","send");return yield En(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield En(c.applySimulcastEncodings(h,n)),yield En(c.applySendEncodings(h,n)),x==null||x(F),yield En(c.peerConnection.setRemoteDescription({type:"answer",sdp:F})),h.map((M,$)=>{const q=v[$];return{localSSRC:I[$],id:q,transceiver:M}})}catch(h){throw h instanceof Ce?h:new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(n);if(o&&o.readyState==="open")N.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:Q("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(n,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),N.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else N.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Ce?o:new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(n){try{const i=this.dataStreamChannelMap.get(n);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(n)}catch(i){throw i instanceof Ce?i:new Ce(Y.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var v;TA(this.id+_.mid,this),_.direction="inactive",(v=_.stop)===null||v===void 0||v.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);h&&(await D0(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:u,transceiver:f}}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(n);return o&&(await D0(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");n.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[f,_]=h;if(_===u)return this.preSSRCMap.delete(f),!0})}),this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.mute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.unmute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,f)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(n,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return Yc(function*(){const o=yield En(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=In().supportPCSetConfiguration,u=Q("FORCE_TURN_TCP")||i.forceTurn;if(n===_s.RELAY&&!c)return;if(c&&!u){const w=n===_s.RELAY?"relay":"all",I=i.peerConnection.getConfiguration();I.iceTransportPolicy!==w&&(N.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(I.iceTransportPolicy,"] to [").concat(w,"]")),I.iceTransportPolicy=w,i.peerConnection.setConfiguration(I))}i.remoteSDP.updateCandidates(n);const h=yield En(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Jf(h.sdp),{remoteIceParameters:_}=yield f.iceParameters;i.remoteSDP.restartICE(_);const v=i.remoteSDP.toString(),y=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield En(i.peerConnection.setLocalDescription(h)),y==null||y(v),yield En(i.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){N.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const n=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(_s.TCP_RELAY),await D0(this.peerConnection,this.remoteSDP,this.extension)}catch(i){N.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{n()}}close(){var n;this.peerConnection.getTransceivers().forEach(i=>{TA(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ku(Ku({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ce(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?Pr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Ku(Ku({},Ud),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Ku(Ku({},Ud),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=n=>{if(n&&(n.errorCode||n.errorText)){var i;const o="code: ".concat(n.errorCode,", message: ").concat(n.errorText),c=n.port?"local: ".concat(n.port):"";N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(n.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=n=>{n&&n.target&&"iceGatheringState"in n.target&&N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(n.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Q("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&(E0(n.turnServer.servers)?i.iceServers=n.turnServer.servers:Q("NEW_TURN_MODE")&&i.iceServers?(Q("USE_TURN_SERVER_OF_GATEWAY")?n.turnServer.serversFromGateway&&i.iceServers.push(...w_.newTurnServerConfigToIceServers(n.turnServer.serversFromGateway)):i.iceServers.push(...w_.newTurnServerConfigToIceServers(n.turnServer.servers)),Q("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):n.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...w_.turnServerConfigToIceServers(n.turnServer.servers)),Q("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...w_.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),Q("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),Q("ENABLE_ENCODED_TRANSFORM")&&In().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Yf(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!Q("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{const c=Q("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Yf(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Yf(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(M=>M.track===n._mediaStreamTrack)),!i)return N.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!In().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(n._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const f=function(x,M){return x.getTransceivers().find($=>$.sender.track===M||$.receiver.track===M)}(this.peerConnection,n._mediaStreamTrack),_=Kde(n);if(spe(n)&&f&&i&&_&&this.getLocalVideoStats&&Xe(o=["vp8","vp9"]).call(o,this.store.codec)){var v;const x=u.degradationPreference||(Xe(v=n._hints).call(v,rr.CUSTOM_TRACK)?Q("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(M,$,q,ae,me,ge){if(TA(M,q),me($),ae!=="balanced"&&ae!=="maintain-framerate"&&ae!=="maintain-resolution")return;let pe=-1;Gz(M,$);const we=window.setInterval(()=>{const nt=SA.get(M);if(!Q("ENABLE_AG_ADAPTATION")||!nt)return TA(M,q),void me($);const st=ge();if(st.sendPackets>0&&st.OutgoingAvailableBandwidth>0){if(pe===-1)return void(pe=Date.now());if(Date.now()-pe<1e3)return;const dn=st.sendFrameRate,hn=st.OutgoingAvailableBandwidth,[ir,Yr]=ipe(M,dn,hn,nt.adaptationConfig,$,ae);Yr&&(q.qualityLimitationReason=Yr),ir&&nt.adaptationConfig.scale!==ir.scale&&(N.debug("[".concat(M,"] applyAdaptation: ").concat(q.qualityLimitationReason,`
           sendFps `).concat(dn,", bwe ").concat(hn,", switch from ").concat(nt.adaptationConfig.scale," to ").concat(ir.scale," ")),nt.adaptationConfig=kL(kL({},nt.adaptationConfig),ir),me(ir))}},Q("CHECK_LOCAL_STATS_INTERVAL")),Be=kL({},$);SA.set(M,{timer:we,adaptationConfig:Be,originConfig:$,adaptationFunc:me}),N.debug("[".concat(M,"] start adaptation, originConfig: ").concat(JSON.stringify($),", degradationPreference: ").concat(ae))})(this.id+f.mid,_,this,x,M=>{i&&this.updateAdaptation(i,M)},this.getLocalVideoStats.bind(this))}if(n._encoderConfig){var y;const{bitrateMax:x,frameRate:M,scaleResolutionDownBy:$}=n._encoderConfig;x&&(h.maxBitrate=1e3*x),(Xe(y=n._hints).call(y,rr.LOW_STREAM)||n.isUseScaleResolutionDownBy)&&(M&&(h.maxFramerate=Ma(M)),$&&$>=1&&(h.scaleResolutionDownBy=$))}const{maxFramerate:w}=Q("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,w):w),Q("DSCP_TYPE")&&lp()){var I;const x=Q("DSCP_TYPE");Xe(I=["very-low","low","medium","high"]).call(I,x)&&(h.networkPriority=x)}const P=i.getParameters(),F=(c=P.encodings)===null||c===void 0?void 0:c[0];Pr()&&!F&&(u.encodings=[h]),F&&Object.assign(F,h),Object.assign(P,u),N.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(P.encodings))),await i.setParameters(P),await async function(x,M,$){try{var q;if(!In().supportSetRtpSenderParameters||!function(we){return we==="vp9"||we==="av1"}(x)||!Q("ENABLE_SVC"))return;const ae={},me={},ge=M.getParameters(),pe=(q=ge.encodings)===null||q===void 0?void 0:q[0];me.scalabilityMode=dA($),pe&&Object.assign(pe,me),Object.assign(ge,ae),await M.setParameters(ge),N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ge.encodings)))}catch(ae){N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ae)}}(this.store.codec,i,Q("SVC_MODE"))}async updateAdaptation(n,i){var o,c;if(!n)return N.debug("[updateAdaptation] no rtpSender found");if(!In().supportSetRtpSenderParameters)return N.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:f,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),f&&(u.maxFramerate=Ma(f)),_&&_>=1&&Xe(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const v=n.getParameters(),y=(c=v.encodings)===null||c===void 0?void 0:c[0];y&&Object.assign(y,u),Object.assign(v,{});try{await n.setParameters(v),N.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(w){!("transport"in n)||n.transport&&n.transport.state==="connected"?this.peerConnectionState!=="connected"?N.debug("[updateAdaptation] peerConnection not connected}"):N.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):N.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(n,i){try{if(!In().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof hr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=ca(n);return i.forEach((u,h)=>{const f=o[h],_=c.mediaDescriptions.find(v=>v.attributes.mid===f);_&&(ay(_,u),dz(_,u,this.store.codec))}),Kf(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,f;const v=n[_],y=i[_];if(y instanceof hr&&!Xe(o=y._hints).call(o,rr.LOW_STREAM)&&(c=y._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=y._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=y._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=y._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},I={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const P=v.sender.getParameters();await v.sender.setParameters(Object.assign(P,w))}}}async applySimulcastEncodings(n,i){if(!Pr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof hr&&this.isVP8Simulcast(c)){const u=n[o],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof hr&&Q("SIMULCAST")&&this.store.codec==="vp8"&&!Xe(i=n._hints).call(i,rr.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(Q("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(n){if(In().supportPCSetConfiguration){const i=w_.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},dt(gn.prototype,"updateRemoteRTPCapabilities",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"updateRemoteRTPCapabilities"),gn.prototype),dt(gn.prototype,"connect",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"connect"),gn.prototype),dt(gn.prototype,"updateRemoteConnect",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"updateRemoteConnect"),gn.prototype),dt(gn.prototype,"createDataChannels",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"createDataChannels"),gn.prototype),dt(gn.prototype,"receive",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"receive"),gn.prototype),dt(gn.prototype,"batchReceive",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"batchReceive"),gn.prototype),dt(gn.prototype,"stopReceiving",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"stopReceiving"),gn.prototype),dt(gn.prototype,"muteRemote",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"muteRemote"),gn.prototype),dt(gn.prototype,"unmuteRemote",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"unmuteRemote"),gn.prototype),dt(gn.prototype,"muteLocal",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"muteLocal"),gn.prototype),dt(gn.prototype,"unmuteLocal",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"unmuteLocal"),gn.prototype),dt(gn.prototype,"close",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"close"),gn.prototype),dt(gn.prototype,"updateEncoderConfig",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"updateEncoderConfig"),gn.prototype),dt(gn.prototype,"updateSendParameters",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"updateSendParameters"),gn.prototype),dt(gn.prototype,"replaceTrack",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"replaceTrack"),gn.prototype),dt(gn.prototype,"updateAdaptation",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"updateAdaptation"),gn.prototype),dt(gn.prototype,"getRemoteSSRC",[xo],Object.getOwnPropertyDescriptor(gn.prototype,"getRemoteSSRC"),gn.prototype),gn);function xo(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return await o.apply(this,f)}finally{u()}},i}function ML(e,n){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=Ma(n.width),o.height=Ma(n.height);const c=Ma(n.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new Te(Y.UNEXPECTED_ERROR,"can not get canvas context");const f=In(),_=o.captureStream(f.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const y=i.videoWidth,w=i.videoHeight/y,I=o.width*w;Math.abs(I-o.height)>=2&&(N.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(I)),o.height=I)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=$1(()=>o.startCapture&&o.startCapture(),c);const v=_.stop;return _.stop=()=>{v.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),N.debug("clean low stream renderer")},_}var wA=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(wA||{}),ii=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(ii||{}),r_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(r_||{}),si=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(si||{}),i_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(i_||{}),qz=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(qz||{}),zd=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(zd||{}),Mo=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Mo||{}),Yz=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(Yz||{}),Uo=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Uo||{}),RA=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(RA||{});const s_=1e3,o_=6,CA=3,cpe=Math.max(o_,CA);function Ot(e,n,i){i!=null&&Number.isFinite(i)&&(e[n]=Math.round(Math.max(0,i)))}function Xz(e){const n={[Uo.CONN_TYPE]:0,[Uo.RTT]:e.rtt,[Uo.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(n[Uo.CONN_TYPE]=1),i==="tcp"&&(n[Uo.CONN_TYPE]=3),i==="tls"&&(n[Uo.CONN_TYPE]=4);break}case"srflx":n[Uo.CONN_TYPE]=2;break;case"unknown":n[Uo.CONN_TYPE]=5;break;default:n[Uo.CONN_TYPE]=0}return n}function Jz(e){let n=0;switch(e){case"none":n=0;break;case"cpu":n=1;break;case"bandwidth":n=2;break;case"other":n=3}return n}class Qz extends Rr{constructor(n){super(),z(this,"store",void 0),z(this,"uploadWRTCStatsTimer",void 0),z(this,"uploadOutboundDenoiserStatsTimer",void 0),z(this,"uploadExtStatsTimer",void 0),z(this,"uploadExtUsageStatsTimer",void 0),z(this,"uploadInboundExtStatsTimer",void 0),z(this,"requestStats",void 0),z(this,"requestTransportStats",void 0),z(this,"requestLocalMedia",void 0),z(this,"requestRemoteMedia",void 0),z(this,"requestAllTracks",void 0),z(this,"requestVideoIsReady",void 0),z(this,"requestUploadStats",void 0),z(this,"requestUpload",void 0),z(this,"uploadOutboundStarted",!1),z(this,"uploadInboundStarted",!1),z(this,"uploadTransportStarted",!1),z(this,"uploadBaseStatsStarted",!1),z(this,"uploadExtensionUsageStarted",!1),z(this,"lastRecvStats",void 0),z(this,"lastSendStats",void 0),z(this,"lastRefRecvStats",void 0),z(this,"lastRefSendStats",void 0),z(this,"lastFullRecvStats",void 0),z(this,"lastFullSendStats",void 0),z(this,"needUploadRenderFreezeTime",!0),this.store=n}uploadWRTCStats(n){if(!this.requestStats||!this.requestUploadStats)return;const i=n%CA==0,o=n%o_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const f={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,u,i);v&&(f.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);v&&(f.outbound=[v])}if(this.uploadInboundStarted&&u){const v=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);v&&(f.inbound=v)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(f.misc)?f.misc[0]&&f.misc[0].addition&&(f.misc[0].addition[RA.RTC_PEER_CONNECTION_STATE]=k1[_]):f.misc=[{addition:{[RA.RTC_PEER_CONNECTION_STATE]:k1[_]}}]),this.requestUploadStats(f)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let n=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[RA.RTC_PEER_CONNECTION_STATE]:k1[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(n),++n===cpe+1&&(n=1)},s_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(n,i,o){if(!this.requestStats)return;if(!o)return n.rtt==null?void 0:{addition:{[Uo.RTT]:n.rtt,[Uo.CONN_TYPE]:void 0,[Uo.STATS_UPDATE_INTERVAL]:n.updateInterval||void 0}};const c=Xz(n);if(this.store.useP2P){if(i){const u=Xz(i);c[Uo.CONN_TYPE]+=u[Uo.CONN_TYPE]<<3}c[Uo.CONN_TYPE]+=110}else c[Uo.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(n,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,f,_;return u.forEach(v=>{let[y,{track:w,ssrcs:I}]=v;switch(y){case Ve.LocalVideoLowTrack:case Ve.LocalVideoTrack:if(y===Ve.LocalVideoTrack){const P=function(M,$,q,ae,me,ge){const pe=$.videoSend.find(st=>st.ssrc===M);if(!pe)return;const we={},{sentFrame:Be,inputFrame:nt}=pe;if(ge&&(Ot(we,ii.QP_SUM,pe.qpSumPerFrame),nt&&Be)){const st=nt.frameRate,dn=Be.frameRate;we[ii.FREEZE]=function(hn,ir){let Yr=!0;return Yr=!(hn<=5)&&(hn<=10?ir<3:hn<=20?ir<4:ir<5),Yr}(st,dn)?1:0}if(me){switch(Be&&(Ot(we,ii.HEIGHT,Be.height),Ot(we,ii.WIDTH,Be.width),Ot(we,ii.FRAME_RATE,Be.frameRate)),we[ii.DISABLED]=ae._originMediaStreamTrack&&!ae._originMediaStreamTrack.enabled||ae._mediaStreamTrack&&!ae._mediaStreamTrack.enabled?1:0,pe.adaptionChangeReason){case"none":we[ii.ADAPTATION]=0;break;case"cpu":we[ii.ADAPTATION]=1;break;case"bandwidth":we[ii.ADAPTATION]=2;break;case"other":we[ii.ADAPTATION]=3}let st=0;pe.adaptionChangeReason&&(st+=Jz(pe.adaptionChangeReason)),$.qualityLimitationReason&&(st+=Jz($.qualityLimitationReason)<<3),we[ii.ADAPTATION]=st,we[ii.PLAYER_STATUS]=H1[ae._player?ae._player.videoElementStatus:"uninit"],Ot(we,ii.NACKS,pe.nacksCount),Ot(we,ii.PLIS,pe.plisCount),Ot(we,ii.FIRS,pe.firsCount),Ot(we,ii.AVG_ENCODE,pe.avgEncodeMs),Ot(we,ii.HUGE_FRAME_SENT,pe.hugeFramesSent),Ot(we,ii.BYTES_RETRANSMIT,pe.retransmittedBytesSent),Ot(we,ii.PACKAGES_RETRANSMIT,pe.retransmittedPacketsSent),Ot(we,ii.KEY_FRAMES_ENCODED,pe.keyFramesEncoded);const dn=q&&q.videoSend.find(hn=>hn.ssrc===M);if(dn){let hn=me?s_:s_*o_;dn.timestamp&&pe.timestamp&&(hn=pe.timestamp-dn.timestamp),dn.packets!=null&&pe.packets!=null&&Ot(we,ii.PACKAGE_RATE,1e3*(pe.packets-dn.packets)/hn),pe.packetsLost!=null&&dn.packetsLost!=null&&Ot(we,ii.PACKAGE_LOST,pe.packetsLost-dn.packetsLost),dn.bytes!=null&&pe.bytes!=null&&Ot(we,ii.BITRATE,8*(pe.bytes-dn.bytes)/hn)}}return we}(I[0].ssrcId,n,i,w,o,c),F=w&&function(M,$,q,ae){const me=$.videoSend.find(pe=>pe.ssrc===M);if(!me)return null;const ge={};if(ae){const pe=me.inputFrame,we=pe&&pe.height||q.videoHeight||0,Be=pe&&pe.width||q.videoWidth||0,nt=pe&&pe.frameRate||0;Ot(ge,wA.HEIGHT,we),Ot(ge,wA.WIDTH,Be),Ot(ge,wA.FRAME_RATE,nt)}return ge}(I[0].ssrcId,n,w,o),x=function(M,$){const q={};return $&&(Ot(q,ii.RETRANSMIT,M.bitrate.retransmit),Ot(q,ii.TARGET_ENCODED,M.bitrate.targetEncoded),Ot(q,ii.ACTUAL_ENCODED,M.bitrate.actualEncoded),Ot(q,ii.TRANSMIT,M.bitrate.transmit),Ot(q,ii.BANDWIDTH,M.sendBandwidth)),q}(n,o);f=Object.assign({},P,F,x)}else _=function(P,F,x,M){const $=F.videoSend.find(ae=>ae.ssrc===P);if(!$)return;const q={};if(M){const ae=$.sentFrame;if(ae&&(Ot(q,r_.HEIGHT,ae.height),Ot(q,r_.WIDTH,ae.width),Ot(q,r_.FRAME_RATE,ae.frameRate)),x){const me=x.videoSend.find(ge=>ge.ssrc===P);if(me){let ge=s_*o_;me.timestamp&&$.timestamp&&(ge=$.timestamp-me.timestamp),me.packets!=null&&$.packets!=null&&Ot(q,r_.PACKAGE_RATE,1e3*($.packets-me.packets)/ge),$.packetsLost!=null&&me.packetsLost!=null&&Ot(q,r_.PACKAGE_LOST,$.packetsLost-me.packetsLost),me.bytes!=null&&$.bytes!=null&&Ot(q,r_.BITRATE,8*($.bytes-me.bytes)/ge)}}}return q}(I[0].ssrcId,n,i,o);break;case Ve.LocalAudioTrack:h=w&&function(P,F,x,M,$){const q=F.audioSend.find(me=>me.ssrc===P);if(!q)return;const ae={};if($){ae[zd.DISABLED]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0;const me=100*M._source.getAccurateVolumeLevel(),ge=q.inputLevel;if(ge!=null){const we=Math.ceil(50*Math.log10(100*ge+1));Ot(ae,zd.LEVEL,we)}Ot(ae,qz.PCM_LEVEL,me),Ot(ae,zd.AEC_RETURN_LOSS,q.aecReturnLoss),Ot(ae,zd.AEC_RETURN_LOSS_ENH,q.aecReturnLossEnhancement),Ot(ae,zd.BYTES_RETRANSMIT,q.retransmittedBytesSent),Ot(ae,zd.PACKAGES_RETRANSMIT,q.retransmittedPacketsSent),ae[zd.FREEZE]=0;const pe=x&&x.audioSend.find(we=>we.ssrc===P);if(pe){let we=s_*o_;pe.timestamp&&q.timestamp&&(we=q.timestamp-pe.timestamp),pe.bytes!=null&&q.bytes!=null&&Ot(ae,zd.BITRATE,8*(q.bytes-pe.bytes)/we),pe.packets!=null&&q.packets!=null&&Ot(ae,zd.PACKAGE_RATE,1e3*(q.packets-pe.packets)/we)}}return ae}(I[0].ssrcId,n,i,w,o)}}),{high:f,low:_,audio:h}}getInboundStats(n,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(f=>{let[_,v]=f;const y={peer:_.uid};if(v.has(at.VIDEO)&&_.videoTrack){const w=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,I=_.videoTrack?function(P,F,x,M,$,q,ae,me){const ge=F.videoRecv.find(hn=>hn.ssrc===P);if(!ge)return;const pe={},{receivedFrame:we,outputFrame:Be,decodeFrameRate:nt}=ge,st=x&&x.videoRecv.find(hn=>hn.ssrc===P);if(Ot(pe,i_.FRAME_RATE_DECODE,nt),ge.framesRateFirefox&&Ot(pe,si.FRAME_RATE,ge.framesRateFirefox),we&&Ot(pe,si.FRAME_RATE,we.frameRate),Ot(pe,si.FRAMES_DROPPED,ge.framesDroppedCount),Ot(pe,si.BYTES_RETRANSMIT,ge.retransmittedBytesReceived),Ot(pe,si.PACKAGES_RETRANSMIT,ge.retransmittedPacketsReceived),Ot(pe,si.PACKAGES_DISCARDED,ge.packetsDiscarded),Ot(pe,si.AVG_DECODE,ge.avgDecodeMs),Ot(pe,si.AVG_PROCESSING_DELAY,ge.avgProcessingDelayMs),Ot(pe,si.AVG_ASSEMBLY_TIME,ge.avgFramesAssembledFromMultiplePacketsMs),Ot(pe,si.AVG_INTER_FRAME_DELAY,ge.avgInterFrameDelayMs),Ot(pe,si.KEY_FRAMES_DECODED,ge.keyFramesDecoded),st){const hn=F.timestamp-x.timestamp||s_*(me?o_:ae?CA:1);ge.packetsLost!=null&&st.packetsLost!=null&&Ot(pe,si.PACKAGE_LOST,ge.packetsLost-st.packetsLost),st.bytes!=null&&ge.bytes!=null&&Ot(pe,si.BITRATE,8*(ge.bytes-st.bytes)/hn),st.packets!=null&&ge.packets!=null&&Ot(pe,si.PACKAGE_RATE,1e3*(ge.packets-st.packets)/hn)}if(me&&(Ot(pe,si.QP_SUM,ge.qpSumPerFrame),pe[si.FREEZE]=$&&M0.isRemoteVideoFreeze(M,ge,st)?1:0),ae){var dn;we?(Ot(pe,si.HEIGHT,we.height),Ot(pe,si.WIDTH,we.width)):M&&(Ot(pe,si.HEIGHT,M._videoHeight||0),Ot(pe,si.WIDTH,M._videoWidth||0)),Be&&Ot(pe,i_.FRAME_RATE_OUTPUT,Be.frameRate);const hn=(dn=M._player)===null||dn===void 0?void 0:dn.rendFrameRate.toFixed(0);if(hn&&Ot(pe,i_.FRAME_RATE_RENDER,+hn),Ot(pe,si.JITTER_BUFFER,ge.jitterBufferMs),Ot(pe,si.CURRENT_DELAY,ge.currentDelayMs),Ot(pe,si.FIRS,ge.firsCount),Ot(pe,si.NACKS,ge.nacksCount),Ot(pe,si.PLIS,ge.plisCount),M){pe[si.DISABLED]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1;const ir=M._player;if(ir){const{freezeTimeCounterList:Yr,renderFreezeAccTime:Vr,videoElementStatus:Fo}=ir;if(Yr&&Yr.length>0&&Ot(pe,i_.FREEZE_TIME,Yr.splice(0,1)[0]),q&&hp.visibility==="visible"&&Fo===js.PLAYING&&In().supportRequestVideoFrameCallback){const ke=Math.min(6e3,Vr);ir.renderFreezeAccTime=Math.max(0,Vr-ke),Ot(pe,i_.FREEZE_TIME_RENDER,ke)}if(typeof ge.totalFreezesDuration=="number"){const ke=st&&st.totalFreezesDuration?ge.totalFreezesDuration-st.totalFreezesDuration:ge.totalFreezesDuration;Ot(pe,i_.FREEZE_DURATION,1e3*ke)}}}if(pe[si.PLAYER_STATUS]=H1[M._player?M._player.videoElementStatus:"uninit"],st&&ge.totalInterFrameDelay!==void 0&&ge.totalSquaredInterFrameDelay!==void 0&&st.totalInterFrameDelay!==void 0&&st.totalSquaredInterFrameDelay!==void 0){const ir=ge.totalInterFrameDelay-st.totalInterFrameDelay,Yr=ge.totalSquaredInterFrameDelay-st.totalSquaredInterFrameDelay,Vr=ge.framesDecodeCount-st.framesDecodeCount,Fo=ir/Vr*1e3,ke=Math.round(1e3*Math.sqrt((Yr-Math.pow(ir,2)/Vr)/Vr));!isNaN(ke)&&Fo+ke>Math.max(3*Fo,Fo+150)&&(pe[si.I_FRAME_DELAY]=ke)}}return pe}(_._videoSSRC,n,i,_.videoTrack,w===!0,this.needUploadRenderFreezeTime,o,c):void 0;I&&(y.video=I)}if(v.has(at.AUDIO)&&_.audioTrack){const w=_.audioTrack?function(I,P,F,x,M,$){const q=P.audioRecv.find(pe=>pe.ssrc===I);if(!q)return;const ae={},me=F&&F.audioRecv.find(pe=>pe.ssrc===I);if(Ot(ae,Mo.JITTER,q.jitterMs),Ot(ae,Mo.BYTES_RETRANSMIT,q.retransmittedBytesReceived),Ot(ae,Mo.PACKAGES_RETRANSMIT,q.retransmittedPacketsReceived),Ot(ae,Mo.PACKAGES_DISCARDED,q.packetsDiscarded),Ot(ae,Mo.AVG_PROCESSING_DELAY,q.avgProcessingDelayMs),me){const pe=P.timestamp-F.timestamp||s_*($?o_:M?CA:1);q.packets!=null&&me.packets!=null&&Ot(ae,Mo.PACKAGE_RATE,1e3*(q.packets-me.packets)/pe),M&&me.bytes!=null&&q.bytes!=null&&Ot(ae,Mo.BITRATE,8*(q.bytes-me.bytes)/pe),q.packetsLost!=null&&me.packetsLost!=null&&Ot(ae,Mo.PACKAGE_LOST,q.packetsLost-me.packetsLost)}if($){const{receivedFrames:pe,droppedFrames:we}=q;pe!=null&&we!=null&&(ae[Mo.FREEZE]=(ge=pe)===0||100*we/ge>20?1:0)}var ge;if(M){const pe=100*x._source.getAccurateVolumeLevel(),we=q.outputLevel;if(we!=null){const Be=Math.ceil(50*Math.log10(100*we+1));Ot(ae,Yz.LEVEL,Be)}if(Ot(ae,Mo.PCM_LEVEL,pe),x&&(ae[Mo.DISABLED]=x._originMediaStreamTrack.enabled&&x._mediaStreamTrack.enabled?0:1),Ot(ae,Mo.JITTER_BUFFER,q.jitterBufferMs),Ot(ae,Mo.CURRENT_DELAY,q.jitterBufferMs),ae[Mo.PLAYER_STATUS]=H1[Lo.getPlayerState(x.getTrackId())],me){const Be=q.concealedSamples-me.concealedSamples;Be>0&&Ot(ae,Mo.CONCEALED_SAMPLES,Be);const nt=q.totalSamplesReceived-me.totalSamplesReceived;nt>0&&Ot(ae,Mo.TOTAL_SAMPLES_RECEIVED,nt)}}return ae}(_._audioSSRC,n,i,_.audioTrack,o,c):void 0;w&&(y.audio=w)}(y.video||y.audio)&&h.push(y)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const n=(this.requestAllTracks()||[]).find(i=>i instanceof YI);if(n&&n._external.getDenoiserStats){const i=n._external.getDenoiserStats();i&&this.requestUpload(C0.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(n=>{n.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(n=>{let[i,o]=n;o.has(at.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(at.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const n=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:Q("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,y]of h)y.has(at.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),y.has(at.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(v,y){const w={};for(const{id:x,value:M,level:$,direction:q}of v){var I;const ae=(I=y.get(x))!==null&&I!==void 0?I:0,me=M===2?ae+Q("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ae;var P,F;y.set(x,me),w[x]?(M===2&&(w[x].value=M),$>w[x].level&&(w[x].level=$),q==="remote"&&(w[x].remoteUidCount+=1),w[x].totalTs=(P=y.get(x))!==null&&P!==void 0?P:0):w[x]={value:M,level:$,remoteUidCount:q==="local"?0:1,totalTs:(F=y.get(x))!==null&&F!==void 0?F:0}}return Object.keys(w).map(x=>{const{level:M,value:$,totalTs:q}=w[x];return{id:x,level:M,value:$,totalTs:q}})}(c,n);const f=Date.now(),_=f>i?f:i+1;this.requestUpload&&this.requestUpload(C0.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},Q("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const lpe=Q("ICE_RESTART_INTERVAL");let IA=new Map,hy=new Map,em=[_s.UDP_TCP_RELAY,_s.TCP_RELAY,_s.RELAY],UL=Q("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&In().supportPCSetConfiguration;function Zz(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=IA.get(e.id);i&&(window.clearTimeout(i),IA.delete(e.id));const o=hy.get(e.id);n&&o&&o.index===em.length-1&&(N.debug("[".concat(e.id,"] reset ICE restart policy")),hy.delete(e.id))}function eH(e,n,i){if(IA.size===0&&hy.size===0&&(Array.isArray(Q("RESTART_SEQUENCE"))&&Q("RESTART_SEQUENCE").length>0&&!function(f,_){if(f.length!==_.length)return!1;for(let v=0;v<f.length;v+=1){const y=f[v];if(f.filter(w=>w===y).length!==_.filter(w=>w===y).length)return!1}return!0}(em,Q("RESTART_SEQUENCE"))&&(em=Q("RESTART_SEQUENCE").filter(f=>{var _;if(Xe(_=Object.values(_s)).call(_,f))return!0}),N.debug("use reconnection policy from config distribution, queues: ".concat(em.join(" => ")))),UL=Q("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&In().supportPCSetConfiguration),em.length===0)return void i();let o,{index:c=0,type:u}=hy.get(e.id)||{};if(UL&&u===_s.RELAY)return void i();let h=u&&c>=em.length-1;if(UL)u=_s.RELAY;else{if(h)return void i();u?(c++,u=em[c]):(u=em[0],c=0)}N.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),n(u),hy.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>eH(e,n,i),lpe),IA.set(e.id,o)}var nn;function tH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Hd(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?tH(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function nH(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=a1,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new AA(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function AA(e){function n(i){if(Object(i)!==i)return tt.reject(new TypeError(i+" is not an object."));var o=i.done;return tt.resolve(i.value).then(function(c){return{value:c,done:o}})}return AA=function(i){this.s=i,this.n=i.next},AA.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?tt.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?tt.reject(i):n(o.apply(this.s,arguments))}},new AA(e)}let V0=(nn=class extends Rr{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(bt.StateChange,n,this._state)}constructor(e,n){super(),z(this,"isPlanB",void 0),z(this,"store",void 0),z(this,"statsUploader",void 0),z(this,"connection",void 0),z(this,"localTrackMap",new Map),z(this,"remoteUserMap",new Map),z(this,"localDataChannels",[]),z(this,"remoteDataChannelMap",new Map),z(this,"pendingLocalTracks",[]),z(this,"pendingRemoteTracks",[]),z(this,"pendingLocalDataChannels",[]),z(this,"pendingRemoteDataChannels",[]),z(this,"statsCollector",void 0),z(this,"shouldForwardP2PCreation",void 0),z(this,"iceFailedCount",0),z(this,"dtlsFailedCount",0),z(this,"mutex",void 0),z(this,"_state",Vn.Disconnected),z(this,"_pcStatsUploadType",Q("NEW_ICE_RESTART")?gp.FIRST_CONNECTION:gp.OLD_FIRST_CONNECTION),z(this,"_isStartRestartIce",!1),z(this,"_restartTimer",void 0),z(this,"_isTryConnecting",!1),z(this,"_iceError",null),z(this,"_forceTurn",!1),z(this,"_isWaitPcToRePub",!1),z(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Vn.Connected)return void c(new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const f=h.find(v=>v[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:y}]=v;return y}));const _=this.createMuteMessage(h);await tr(this,bt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),z(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Vn.Connected)return void c(new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const f=h.find(v=>v[0]==="videoLowTrack");if(f){const v=f[1];if(v.track._originMediaStreamTrack.stop(),!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding){const y=i._mediaStreamTrack.clone();v.track._mediaStreamTrack=y,v.track._originMediaStreamTrack=y}else{const y=ML(i,v0(this,bt.RequestLowStreamParameter));v.track._mediaStreamTrack=y,v.track._originMediaStreamTrack=y}await new tt((y,w)=>{this.handleReplaceTrack(v.track,y,w,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:y}]=v;return y}));const _=this.createUnmuteMessage(h);await tr(this,bt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),z(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==Vn.Connected)return void o();const{id:v,track:y}=_;await this.connection.updateSendParameters(v,y),await this.connection.updateEncoderConfig(v,y),this.emit(bt.UpdateVideoEncoder,y),o()}catch(_){c(_)}finally{var f;(f=h)===null||f===void 0||f()}}),z(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Vn.Connected)return void o();const{id:f,track:_}=h;await this.connection.updateSendParameters(f,_),o()}catch(h){c(h)}finally{u()}}),z(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==Vn.Connected)return void o();const h=LL([i]);let f;N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(f=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(v){c(v)}finally{var _;(_=f)===null||_===void 0||_()}}),z(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;N.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(y=>{let[,{track:w}]=y;return i===w});if(!this.connection||!v||this.state!==Vn.Connected)return void o();if(await((f=this.connection)===null||f===void 0?void 0:f.replaceTrack(i,v[1].id)),this.isPlanB){const y=v[1];y.id=i._mediaStreamTrack.id,this.localTrackMap.set(v[0],y)}if(v[0]===Ve.LocalVideoTrack&&!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding){const y=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(y){const w=i._mediaStreamTrack.clone();y.track._originMediaStreamTrack.stop(),y.track._mediaStreamTrack=w,y.track._originMediaStreamTrack=w,await new tt((I,P)=>{this.handleReplaceTrack(y.track,I,P,!0)})}}o()}catch(v){c(v)}finally{var _;(_=h)===null||_===void 0||_()}}),z(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),z(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),z(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),z(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),z(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new Qz(this.store),this.bindStatsUploaderEvents(),this.mutex=new ms("P2PChannel-mutex",this.store.clientId),this.isPlanB=!In().supportUnifiedPlan||Q("CHROME_FORCE_PLAN_B")&&lp(),this.shouldForwardP2PCreation=Q("FORWARD_P2P_CREATION")&&In().supportPCSetConfiguration&&v1(),this.shouldForwardP2PCreation&&(this.connection=bA(this.store),this.emit(bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var n;this.state=Vn.New,this._forceTurn=Kz(e),N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=bA(this.store,e),this.emit(bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Q("NEW_ICE_RESTART")?gp.FIRST_CONNECTION:gp.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");Q("ENABLE_PREALLOC_PC")&&this.state===Vn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Vn.Connected)}updateRemoteRTPCapabilities(e){const n=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return Xe(u=[Ve.LocalVideoLowTrack,Ve.LocalVideoTrack]).call(u,h)}),i=n.map(c=>{let[,{id:u}]=c;return u}),o=n.map(c=>{let[u]=c;return u});if(this.connection instanceof Gd){if(Et.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Xe(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>Xe(e).call(e,u));c&&(this.store.codec=c,N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof Gd&&this.connection.peerConnectionState!=="closed"&&Xe(e=[Vn.New,Vn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Vn.Connected){if(this.state===Vn.Disconnected)throw new Ce(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;Xe(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const n=this.filterTobePublishedDataChannels(e);return n.length===0?[]:(n.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,n),n.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,n,i){var o=this;return Yc(function*(){const c=yield En(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&Xe(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Vn.Connected||h){if(o.state===Vn.Disconnected)throw new Ce(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Es.markPublishStart(o.store.clientId,o.store.pubId);const f=o.filterTobePublishedTracks(e,n,i);if(f.length===0)return void(yield En(o.tryToUnmuteAudio(e)));yield*TI(nH(o.doPublish(o.connection,f)))}finally{c()}})()}doPublish(e,n){var i=this;return Yc(function*(){n.forEach(I=>{let{track:P,type:F}=I;const x=Date.now();i.store.publish(P.getTrackId(),F===Ve.LocalAudioTrack?"audio":"video",x)}),i.bindLocalTrackEvents(n);const o=n.map(I=>{let{track:P}=I;return P}),c=yield En(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield En(c.next())).value,h=i.createGatewayPublishMessage(n,u);let f;try{f=yield h}catch(I){throw c.throw(I),(I==null?void 0:I.code)===Y.WS_ABORT&&n.forEach(P=>{let{track:F}=P;i.pendingLocalTracks.indexOf(F)===-1&&i.pendingLocalTracks.push(F)}),i.unbindLocalTrackEvents(n),I}const _=i.mapPubResToRemoteConfig(h,f,o),v=(yield En(c.next(_))).value;if(i.state===Vn.Disconnected)throw new Ce(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Q("ENABLE_VIDEO_SEI");const y=Q("ENABLE_ENCODED_TRANSFORM"),w=Q("ENABLE_AUDIO_METADATA");o.forEach(async I=>{const P=I.getRTCRtpTransceiver();if(!P||!y)return;const{interceptLocalVideoFrame:F,interceptLocalAudioFrame:x}=gA();I.trackMediaType===at.VIDEO?await F(P.sender,I):I.trackMediaType===at.AUDIO&&await x(P.sender,{metadata:w?()=>{const M=I.metadata.shift();return M&&M.value}:void 0})}),n.forEach(I=>{let{type:P}=I;i.statsCollector.addLocalStats(P)}),i.assignLocalTracks(n,v),i.statsUploader.startUploadOutboundStats(),n.forEach(I=>{let{track:P,type:F}=I;const x=Date.now();i.store.publish(P.getTrackId(),F===Ve.LocalAudioTrack?"audio":"video",void 0,x)})})()}async updateVideoStreamParameter(e,n){const i=this.localTrackMap.get(n);if(!i||!this.connection)return;if(!(i.track instanceof hr))return N.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const f={};return u.height&&u.width&&(f.scaleResolutionDownBy=EL(u,h)),f.maxFramerate=u.framerate?Ma(u.framerate):void 0,f.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,f}(e,o);if(o._encoderConfig||(o._encoderConfig={}),n!==Ve.LocalVideoLowTrack||!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return N.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,f){const _=h.canvas;f.width&&(_.width=Ma(f.width)),f.height&&(_.height=Ma(f.height)),f.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=$1(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},Ma(f.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),N.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var n=this;return Yc(function*(){if(!n.connection||n.state!==Vn.Connected)return;const i=yield En(n.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=n.localTrackMap.get(Ve.LocalVideoTrack);if(!c)throw new Ce(Y.UNEXPECTED_ERROR,"Could not find high stream");if(n.localTrackMap.has(Ve.LocalVideoLowTrack))throw new Ce(Y.UNEXPECTED_ERROR,"[".concat(n.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:n.getLowVideoTrack(c.track,e),type:Ve.LocalVideoLowTrack}];if(yield*TI(nH(n.doPublish(n.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=n.localTrackMap.get(Ve.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield En(n.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ls(this,bt.RequestRePublish,this.pendingLocalTracks),this.emit(bt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(N.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ls(this,bt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let n=this.pendingRemoteTracks.length-1;n>=0;n--){const{user:i,kind:o}=this.pendingRemoteTracks[n];(o!==at.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==at.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1)}if(e)await ls(this,bt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:n,kind:i}of this.pendingRemoteTracks)await this.subscribe(n,i,i===at.VIDEO?n._videoSSRC:n._audioSSRC);this.pendingRemoteTracks.forEach(n=>{let{user:i}=n;this.emit(bt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Vn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,n)}async unpublishDataChannel(e){if(!this.connection||this.state!==Vn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const n=this.filterTobeUnpublishedDataChannels(e);return n.length!==0?(n.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),n.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Vn.Connected)return;const e=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(!e)return;e.track.close();const n=[[Ve.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,n)}async doUnpublish(e,n){const i=this.createGatewayUnpublishMessage(n);return await e.stopSending(n.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),n.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,n){if(!this.connection||this.state!==Vn.Connected)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=n.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:f,id:_}=h;return f.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,n,i,o,c){var u;if(!this.connection||this.state!==Vn.Connected)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(n))return;let h,f,_;const v=this.connection.getPreMedia(i);if(v)N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=v.transceiver,h=v.track,f=v.id;else if(c){const I=c.find(F=>{let{stream_type:x}=F;return x===n});if(!I)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));const P=await this.connection.receive(n,I.ssrcs,String(e._uintid),I.attributes);this.connection instanceof Gd&&(_=P.transceiver),h=P.track,f=P.id}else{const I=await this.connection.receive(n,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof Gd&&(_=I.transceiver),h=I.track,f=I.id}if(n===at.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Zv(h,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Qv(h,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&Q("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:P}=gA();n==at.VIDEO?await I(_.receiver,{onSei:Q("ENABLE_VIDEO_SEI")&&(F=>{var x;return(x=e._videoTrack)===null||x===void 0?void 0:x._onSei(F)})}):n==at.AUDIO&&await P(_.receiver,{enableTopn:!!Q("ENABLE_AUDIO_TOPN"),enableMetadata:!!Q("ENABLE_AUDIO_METADATA"),onMetadata:F=>{this.safeEmit(bt.AudioMetadata,F)}})}const y=this.remoteUserMap.get(e);y?y.set(n,f):this.remoteUserMap.set(e,new Map([[n,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(I=>{let{user:P,kind:F}=I;return P.uid===e.uid&&n===F});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(bt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Vn.Connected)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:f}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(f))});const n=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):n.push(c)});const o=await this.connection.batchReceive(n.map(c=>{let{user:u,mediaType:h,ssrcId:f,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:f,rtx:_}],mslabel:String(u._uintid)}}));n.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const f=i.get(h);if(!f)return void N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:v,transceiver:y}=f;if(y&&Q("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:F}=gA();u==at.VIDEO?await P(y.receiver,{onSei:Q("ENABLE_VIDEO_SEI")&&(x=>{var M;return(M=c._videoTrack)===null||M===void 0?void 0:M._onSei(x)})}):u==at.AUDIO&&await F(y.receiver,{enableTopn:!!Q("ENABLE_AUDIO_TOPN"),enableMetadata:!!Q("ENABLE_AUDIO_METADATA"),onMetadata:x=>{this.safeEmit(bt.AudioMetadata,x)}})}if(u===at.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new Zv(_,c.uid,c._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),y&&c._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Qv(_,c.uid,c._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),y&&c._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(c,c._videoTrack)),Q("ENABLE_VIDEO_SEI")&&y){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:F}=gA();u==at.VIDEO?await P(y.receiver,{onSei:x=>{var M;(M=c._videoTrack)===null||M===void 0||M._onSei(x)}}):u==at.AUDIO&&await F(y.receiver)}const w=this.remoteUserMap.get(c);w?w.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const I=this.pendingRemoteTracks.findIndex(P=>{let{user:F,kind:x}=P;return F.uid===c.uid&&u===x});I!==-1&&(this.pendingRemoteTracks.splice(I,1),this.emit(bt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:f,kind:_}=h;return n!==void 0?f.uid===e.uid&&n===_:f.uid===e.uid});if(o.forEach(h=>{const f=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(f,1)}),this.connection&&this.state===Vn.Connected||i||o.forEach(h=>{let{kind:f}=h;var _;if(f===at.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(f===at.VIDEO){var v;(v=e._videoTrack)===null||v===void 0||v._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Vn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,n);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:f}]=h;return f}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[f,{kind:_}]=h;var v,y;if(_===at.VIDEO&&f._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),_===at.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),i||((y=f._videoTrack)===null||y===void 0||y._destroy(),f._videoTrack=void 0);else if(_===at.AUDIO){var w;this.unbindRemoteTrackEvents(f._audioTrack),!i&&((w=f._audioTrack)===null||w===void 0||w._destroy(),f._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,n){if(n.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,n);if(i.length===0)return;n.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let n=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(f=>{let{user:_,kind:v}=f;return u!==void 0?_.uid===c.uid&&u===v:_.uid===c.uid});h.forEach(f=>{const _=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(_,1)}),n=n.concat(h)}if(!this.connection||this.state!==Vn.Connected)return void n.forEach(c=>{let{user:u,kind:h}=c;var f;if(h===at.AUDIO)(f=u._audioTrack)===null||f===void 0||f._destroy(),u._audioTrack=void 0;else if(h===at.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=Aa(e).call(e,(c,u)=>{let{user:h,mediaType:f}=u;const _=this.filterTobeUnSubscribedTracks(h,f);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var f,_;if(h===at.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===at.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===at.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Vn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===at.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}addAudioMetadata(e){const n=this.localTrackMap.get(Ve.LocalAudioTrack),i=n&&n.track;i&&i.metadata.push(e)}getAllTracks(e){const n=this.localTrackMap.get(Ve.LocalAudioTrack);if((n==null?void 0:n.track)instanceof Ei){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ve.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ve.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ve.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get(Ve.LocalAudioTrack),f=o?this.localTrackMap.get(Ve.LocalVideoLowTrack):this.localTrackMap.get(Ve.LocalVideoTrack);Et.publish(this.store.sessionId,{eventElapse:Es.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(rr.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Ur),f=o?(u=this.localTrackMap.get(Ve.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof hr);Et.publish(this.store.sessionId,{eventElapse:Es.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(rr.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===at.VIDEO?i._videoSSRC:i._audioSSRC;c&&Et.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===at.VIDEO,audio:o===at.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Es.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ms("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=bA(this.store),this.emit(bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ve.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ei){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Vn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.connection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof hr||n&&n.track instanceof Ur?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(fc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(Ve.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=n0(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Vn.Reconnecting,Q("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=bA(this.store),this.emit(bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case Ve.LocalVideoTrack:Xe(n=o._hints).call(n,rr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ve.LocalAudioTrack:o instanceof Ei?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ve.LocalVideoLowTrack:}}),this.emit(bt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(fc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(bt.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[n,i]=e;Array.from(fc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(n,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,n){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof Zf?e.uid:e)===o.uid&&c===n)return!0}return!1}setPendingRemoteDataChannel(e,n){this.hasPendingRemoteDataChannel(e,n)||this.pendingRemoteDataChannels.push({user:e,id:n})}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Zf?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}restartICE(e){var n=this;return Yc(function*(){if(!n.connection||n.state!==Vn.Connected)return;const i=yield En(n.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield En(n.connection.restartICE(e));const u=yield En(o.next());if(u.done)return;const h=u.value,f=yield h;switch(xL(n.connection)&&n.reportPCStats(Date.now(),!1,n._pcStatsUploadType),e){case _s.UDP_TCP_RELAY:n._pcStatsUploadType=gp.UDP_TCP_RESTART;break;case _s.TCP_RELAY:n._pcStatsUploadType=gp.TCP_RESTART;break;case _s.RELAY:n._pcStatsUploadType=gp.RELAY_RESTART;break;default:n._pcStatsUploadType=gp.OLD_RESTART}n._isTryConnecting=!0,o.next(f)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),n=this.localTrackMap.get(Ve.LocalVideoTrack),i=this.localTrackMap.get(Ve.LocalAudioTrack),o=e.videoSend.find(P=>P.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId)),c=e.audioSend.find(P=>P.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=hc(this,bt.NeedSignalRTT),h=o?o.rttMs:void 0,f=c?c.rttMs:void 0,_=h&&f?(h+f)/2:h||f,v=(_&&u?(_+u)/2:_||u)||0,y=100*e.sendPacketLossRate*.7/50+.3*v/1500,w=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,I=n==null?void 0:n.track;if(I&&I._encoderConfig&&I._hints.indexOf(rr.SCREEN_TRACK)===-1){const P=I._encoderConfig.bitrateMax,F=e.bitrate.actualEncoded;if(P&&F){const x=(1e3*P-F)/(1e3*P);return MG[x<.15?0:x<.3?1:x<.45?2:x<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(F=>F.ssrc===c),f=e.videoRecv.find(F=>F.ssrc===u);if(!h&&!f)return void(n+=1);const _=hc(this,bt.NeedSignalRTT),v=e.rtt,y=(v&&_?(v+_)/2:v||_)||0,w=h?h.jitterMs:void 0,I=e.recvPacketLossRate;let P=.7*I*100/50+.3*y/1500;w&&(P=.6*I*100/50+.2*y/1500+.2*w/400),n+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new tt((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}async replaceTrack(e,n){var i;if(N.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(n.getTrackId(),"]")),!this.connection||this.state!==Vn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==n&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:n,type:c}]),o[1].track=n),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(n,o[1].id)),this.isPlanB){const u=o[1];u.id=n._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ve.LocalVideoTrack&&!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding){const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new tt((f,_)=>{this.handleReplaceTrack(u.track,f,_,!0)})}}}filterTobePublishedTracks(e,n,i){const o=[],c=this.getAllTracks();e=Fv(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const f=this.localTrackMap.get(Ve.LocalAudioTrack);for(const _ of e){if(_ instanceof hr&&(this.localTrackMap.has(Ve.LocalVideoTrack)||h?new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ve.LocalVideoTrack}),h=!0),n)){const v=this.getLowVideoTrack(_,i);o.push({track:v,type:Ve.LocalVideoLowTrack})}if(_ instanceof Ur)if(f){const v=f.track;if(v instanceof Ei)DL([_]),v.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const y=LL([v,_]);N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(y.getTrackId(),"]")),this.replaceTrack(v,y)}}else u instanceof Ei?(DL([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&In().webAudioMediaStreamDest&&!_._bypassWebAudio?u=LL(u?[_,u]:[_]):u=_}return u&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Ve.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=Fv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Ur){const c=this.localTrackMap.get(Ve.LocalAudioTrack);if(!c)continue;c.track instanceof Ei?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([Ve.LocalAudioTrack,c]),c.track.close())):n.push([Ve.LocalAudioTrack,c])}if(o instanceof hr){const c=this.localTrackMap.get(Ve.LocalVideoTrack);if(!c)continue;n.push([Ve.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);u&&n.push([Ve.LocalVideoLowTrack,u])}}return n}filterTobePublishedDataChannels(e){return e=(e=Fv(e)).filter(n=>this.localDataChannels.findIndex(i=>i.id===n.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Fv(e)).filter(n=>this.localDataChannels.indexOf(n)!==-1)).filter(n=>n._originDataChannel)}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Ve.LocalVideoTrack:i.addListener(lt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(lt.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(lt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof Ei?e.trackList.forEach(i=>{i.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(lt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(lt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||(e.addListener(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(lt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Ve.LocalVideoTrack:i.off(lt.GET_STATS,this.handleGetLocalVideoStats),i.off(lt.GET_RTC_STATS,this.handleGetRTCStats),i.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(lt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ei?e.trackList.forEach(n=>{n.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(lt.GET_STATS,this.handleGetLocalAudioStats),n.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(lt.GET_STATS,this.handleGetLocalAudioStats),e.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(lt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof Qv&&n.addListener(lt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof Zv&&n.addListener(lt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(lt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(at.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(at.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,h,{track:f,type:_}=i;switch(_){case Ve.LocalAudioTrack:u=Fn.Audio,h={dtx:f instanceof YI&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ve.LocalVideoTrack:u=Xe(c=f._hints).call(c,rr.SCREEN_TRACK)?Fn.Screen:Fn.High,h=Hd(Hd({},ez(f)),{},{codec:this.store.codec,svc_mode:dA()});break;case Ve.LocalVideoLowTrack:u=Fn.Low,h=Hd(Hd({},ez(f)),{},{codec:this.store.codec,svc_mode:dA()})}return{stream_type:u,attributes:h,ssrcs:n[o]}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,rr.SCREEN_TRACK)?Fn.Screen:Fn.High;break;case Ve.LocalAudioTrack:o=Fn.Audio;break;case Ve.LocalVideoLowTrack:o=Fn.Low}return{stream_type:o,ssrcs:h,mid:f}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{if(N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(n,")")),this.emit(bt.PeerConnectionStateChange,n),n==="connecting"&&e instanceof Gd&&!Pr()&&Q("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{n==="connecting"&&e.extendCandidate()},Q("FIRST_TCP_CANDIDATE_INTERVAL")),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Gd&&Zz(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=gp.DISCONNECTED_OR_FAILED,hc(this,bt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Et.reportApiInvoke(this.store.sessionId,{name:hi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:kr.TRACER}).onSuccess(),this.republish()}if(Q("NEW_ICE_RESTART")&&e instanceof Gd&&!Pr()&&!this._forceTurn){if(Xe($G).call($G,n)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{xL(e)&&(N.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),hc(this,bt.QueryClientConnectionState)==="CONNECTED"&&this.emit(bt.RequestRestartICE,c))},o=()=>{xL(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),N.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(bt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{eH(e,i,o)},800))}}else{if(n==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Q("ICE_RESTART")&&hc(this,bt.QueryClientConnectionState)==="CONNECTED"&&this.emit(bt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(bt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);n==="failed"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(bt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),Et.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:kr.TRACER}).onSuccess(),this.emit(bt.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(fc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit($v.FIRST_FRAME_DECODED),Et.firstRemoteFrame(this.store.sessionId,Ii.FIRST_AUDIO_DECODE,yr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Es.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(fc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&Et.firstRemoteFrame(this.store.sessionId,Ii.FIRST_AUDIO_RECEIVED,yr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Es.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(fc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&Et.firstRemoteFrame(this.store.sessionId,Ii.FIRST_VIDEO_RECEIVED,yr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Es.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(bt.ConnectionTypeChange,o),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xf(i))," -> ").concat(JSON.stringify(Xf(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xf(i))," -> ").concat(JSON.stringify(Xf(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const n=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Hd(Hd({},n),i)},e.onICECandidateError=n=>{this._iceError=n}}resetConnection(e){e instanceof Gd&&function(n){hy.delete(n.id),Zz(n)}(e),e.close(),this.emit(bt.PeerConnectionStateChange,"closed"),function(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof Ur&&(i==null?void 0:i.track)instanceof Ei)return i.track.isActive||n.push([Ve.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===Ve.LocalVideoTrack)){const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&n.push([Ve.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof Ur&&(i==null?void 0:i.track)instanceof Ei)return i.track.isActive&&n.push([Ve.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ve.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&n.push([Ve.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Ve.LocalAudioTrack:o=Fn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,rr.SCREEN_TRACK)?Fn.Screen:Fn.High;break;case Ve.LocalVideoLowTrack:o=Fn.Low}return{stream_type:o,ssrcs:h,mid:f}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Ve.LocalAudioTrack:o=Fn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,rr.SCREEN_TRACK)?Fn.Screen:Fn.High;break;case Ve.LocalVideoLowTrack:o=Fn.Low}return{stream_type:o,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,n){const i=[];return n.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case at.VIDEO:return void(o._videoSSRC&&n.push({stream_type:at.VIDEO,ssrcId:o._videoSSRC}));case at.AUDIO:return void(o._audioSSRC&&n.push({stream_type:at.AUDIO,ssrcId:o._audioSSRC}))}}),n}createUnsubscribeAllMessage(e){const n=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(n.has(o)){let u=n.get(o);c===at.VIDEO?u|=Ai.Video:u|=Ai.Audio,n.set(o,u)}else c===at.VIDEO?n.set(o,Ai.Video):n.set(o,Ai.Audio)}),{users:Array.from(n.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(Ve.LocalVideoTrack),i=this.localTrackMap.get(Ve.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new tt((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new tt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,n,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const f=(u=n.find(_=>{let{stream_type:v}=_;return h===v}))===null||u===void 0?void 0:u.attributes;if(f&&Q("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(Xe(_).call(_,rr.SCREEN_TRACK)||Xe(_).call(_,rr.SCREEN_LOW_TRACK))&&(f.remb=!1,N.debug("disable remb for screen share, hints:",_))}return f})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Ur){var n;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((n=this.connection)===null||n===void 0?void 0:n.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await tr(this,bt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.connection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(bt.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(bt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Hi(I1(this.dtlsFailedCount,pi)),this.emit(bt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),n.length>0&&await ls(this,bt.RequestUnpublishForReconnectPC,n),this.disconnectForReconnect(),this.emit(bt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ve.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof hr)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof hr).length>1)throw new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Ur).length>1&&(e.some(n=>n instanceof Ur&&n._bypassWebAudio)||!In().webAudioMediaStreamDest))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof hr&&this.pendingLocalTracks.some(i=>i instanceof hr))throw new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Ur&&this.pendingLocalTracks.some(i=>i instanceof Ur)&&(!In().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Ur&&i._bypassWebAudio)))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){var i;const o=!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding,c=Hd(Hd({},{width:160,height:120,framerate:15,bitrate:50}),n);let u;u=o?e._mediaStreamTrack.clone():ML(e,c);const h=nr(8,"track-low-"),f=new hr(u,Hd(Hd({},o&&{scaleResolutionDownBy:EL(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return f.on(qg.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,Hv.LOW_STREAM)}),f._hints.push(rr.LOW_STREAM),Xe(i=e._hints).call(i,rr.SCREEN_TRACK)&&f._hints.push(rr.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{f.emit("sei-to-send",_)}),e.addListener(lt.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,n,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Gd){var c,u,h,f;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:y,peerConnectionState:w}=this.connection,{local:I,remote:P}=await this.connection.getSelectedCandidatePair();Et.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:v,dtlsstate:y,connectionstate:w,intSucc:n?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=I==null?void 0:I.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=I.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(I.address,":").concat(I.port),selectedRemoteCandidateProtocol:(h=P.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(f=P.candidateType)!==null&&f!==void 0?f:"",selectedRemoteCandidateAddress:"".concat(P.address,":").concat(P.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(fc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");Et.firstRemoteVideoDecode(this.store.sessionId,Ii.FIRST_VIDEO_DECODE,yr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Es.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:o?1:0,firstFrame:(f==null?void 0:f.firstFrame)||0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===Ve.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Hv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},dt(nn.prototype,"startP2PConnection",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"startP2PConnection"),nn.prototype),dt(nn.prototype,"connect",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"connect"),nn.prototype),dt(nn.prototype,"updateRemoteRTPCapabilities",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"updateRemoteRTPCapabilities"),nn.prototype),dt(nn.prototype,"publishDataChannel",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"publishDataChannel"),nn.prototype),dt(nn.prototype,"unpublish",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"unpublish"),nn.prototype),dt(nn.prototype,"unpublishDataChannel",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"unpublishDataChannel"),nn.prototype),dt(nn.prototype,"unpublishLowStream",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"unpublishLowStream"),nn.prototype),dt(nn.prototype,"subscribeDataChannel",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"subscribeDataChannel"),nn.prototype),dt(nn.prototype,"subscribe",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"subscribe"),nn.prototype),dt(nn.prototype,"massSubscribe",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"massSubscribe"),nn.prototype),dt(nn.prototype,"unsubscribe",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"unsubscribe"),nn.prototype),dt(nn.prototype,"unsubscribeDataChannel",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"unsubscribeDataChannel"),nn.prototype),dt(nn.prototype,"massUnsubscribe",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"massUnsubscribe"),nn.prototype),dt(nn.prototype,"muteRemote",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"muteRemote"),nn.prototype),dt(nn.prototype,"unmuteRemote",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"unmuteRemote"),nn.prototype),dt(nn.prototype,"hasRemoteMediaWithLock",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"hasRemoteMediaWithLock"),nn.prototype),dt(nn.prototype,"disconnectForReconnect",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"disconnectForReconnect"),nn.prototype),dt(nn.prototype,"updateBitrateLimit",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"updateBitrateLimit"),nn.prototype),dt(nn.prototype,"remoteMediaSsrcChanged",[Ws],Object.getOwnPropertyDescriptor(nn.prototype,"remoteMediaSsrcChanged"),nn.prototype),nn);function Ws(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return await o.apply(this,f)}finally{u()}},i}function rH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function iH(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?rH(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const upe=Date.now(),dpe=20,VL=new Map,OA=new Map;async function sH(e){const n=VL.get(e),i=Array.isArray(n)&&n[n.length-1],o=OA.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let f=i.mediaDelay+h;f<=0?(n.pop(),oH(i.context,c),f=0):f=Math.min(f,dpe),setTimeout(()=>n.length&&sH(e),f)}function oH(e,n){e.safeEmit(on.STREAM_MESSAGE,n.uid,n.payload),e.onStreamMessage&&e.onStreamMessage(n)}function hpe(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return oH(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=VL.get(o)||[],u=c.findIndex(v=>e.sendTs>=v.sendTs),h=iH(iH({},e),{},{context:i,mediaDelay:n,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),VL.set(o,c);let f=!1;var _;OA.has(o)?f=!((_=OA.get(o))===null||_===void 0||!_.isSyncing):OA.set(o,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||sH(o)}const ppe=vn().name;function aH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function cH(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?aH(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):aH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const py="websdk_ng_cache_parameter",fpe=Q("MAX_PRELOAD_ASYNC_LENGTH"),mpe=1e4,a_=new Map,c_=[];let FL=null,jL=0,BL=0;const PA=new Map,gpe=function(e,n){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<n?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];return new tt(async(_,v)=>{i.push(async()=>{try{const y=await e(...h);_(y)}catch(y){v(y)}}),o<n&&(o++,c())})}}(lH,fpe),WL=Do.CancelToken.source();async function lH(e,n,i,o,c,u){try{if(!Q("ENABLE_PRELOAD"))return;if(!In().supportWebCrypto)return void zf(()=>{N.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Ce(Y.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&zi(i,"token",1,2047),zi(e,"appid",1,2047),oA(n),o&&aA(o);const h=Kg();N.debug("preload channel ".concat(n,", uid is ").concat(o));const f={appId:e,cname:n,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,v;typeof o=="string"?(f.stringUid=o,[v,_]=await tt.all([Qhe(o,{sid:h,appId:e},WL.token),Nz(cH(cH({},f),{},{token:i||e,uid:0}),WL.token)]),f.uid=v.uid,_.gatewayInfo.uid=f.uid,_.gatewayInfo.res.uid=f.uid):(u&&(f.stringUid=u),_=await Nz(f,WL.token));const y={sid:h,appId:e,cname:n,token:i||e,uid:f.stringUid||o,intUid:f.uid||_.gatewayInfo.uid,stringUid:f.stringUid,ts:Date.now(),sua:v,ap:_};await async function(w){let I;try{w.uid&&dH({appId:w.appId,cname:w.cname,token:w.token,uid:w.uid,stringUid:w.stringUid});const P=mH(w),F=await async function(M,$){try{const q=await window.crypto.subtle.importKey("raw",t6($),"AES-GCM",!1,["encrypt"]),ae=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},q,Hg(window.btoa(JSON.stringify(M))));return Hf(new Uint8Array(ae))}catch{return}}(w,w.token||w.appId);if(!F)return;I=fH(py);const x=I?JSON.parse(I):[];x.push({[P]:F}),x.length>Q("AP_CACHE_NUM")&&x.shift(),NA(py,JSON.stringify(x))}catch(P){N.warn("Error caching server parameters:",P.message),NA(py,"")}}(y),jL++}catch(h){throw BL++,function(f){FL||(FL=window.setTimeout(()=>{let v="";PA.forEach((y,w)=>{v+="".concat(w,": ").concat(y," ;")}),Et.reportApiInvoke(null,{name:hi.PRELOAD,options:{success:jL,failed:BL,err:v}}).onError(f),jL=0,BL=0,PA.clear(),FL=null},mpe));const _=PA.get(f.code)||0;PA.set(f.code,_+1)}(h),h}}async function uH(e){try{if(Q("AP_REQUEST_DETAIL")||Q("ENABLE_ROLE_SELECT_EDGE"))return;const n=dH(e);if(!n||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",t6(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,Hg(o));return JSON.parse(window.atob(Hf(new Uint8Array(h))))}catch{return}}(n,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<Q("AP_CACHE_LIFETIME"))return i}catch(n){N.warn("Error get preloadInfo",n.message)}}function dH(e){let n;try{if(n=fH(py),!n)return;const i=JSON.parse(n),o=mH(e),c=function(h,f){for(let _=h.length-1;_>=0;_--)if(f(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return NA(py,JSON.stringify(i)),u[o]}catch(i){N.warn("Error delete preload info: ".concat(n),i.message),NA(py,"")}}function GL(e){if(e){let n=a_.get(e);n&&(window.clearTimeout(n),n=null,a_.delete(e)),Xe(c_).call(c_,e)||e.cloudProxyServer!=="disabled"||c_.push(e)}if(a_.size<Q("AP_CACHE_NUM")&&c_.length>0){const n=c_.shift();a_.set(n,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:f}=n;try{await gpe(i,o,c,h,f,u),a_.has(n)&&GL(n)}catch(_){N.warn("update preload failed",_.message),hH(n)}},Q("AP_UPDATE_INTERVAL")))}}function hH(e){const n=c_.indexOf(e);n!==-1&&c_.splice(n,1);let i=a_.get(e);i&&(window.clearTimeout(i),i=null,a_.delete(e),GL())}function pH(e,n){const i=e.sua,o=e.ap;n&&i&&Et.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:n,uid:e.intUid,errorCode:null,extend:i.req}),Et.reportResourceTiming(e.ap.url,e.sid),Et.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ri.CHOOSE_SERVER,ri.CLOUD_PROXY_FALLBACK].toString()}),Et.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[ri.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function fH(e){return window.atob(window.localStorage.getItem(e)||"")}function NA(e,n){window.localStorage.setItem(e,window.btoa(n))}function mH(e){let n="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(n+="_s_".concat(e.uid)),typeof e.uid=="number"&&(n+="_".concat(e.uid)),e.token&&(n+="_".concat(e.token)),c6(n)}function _pe(e){let n=function(){const i=ype.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(oi(o,10),tm(o,c));let u=i.cid;u!==void 0&&(oi(o,16),oi(o,u));let h=i.cname;h!==void 0&&(oi(o,26),tm(o,h));let f=i.deviceId;f!==void 0&&(oi(o,34),tm(o,f));let _=i.elapse;_!==void 0&&(oi(o,40),nm(o,_));let v=i.fileSize;v!==void 0&&(oi(o,48),nm(o,fy(v)));let y=i.height;y!==void 0&&(oi(o,56),nm(o,fy(y)));let w=i.jpg;w!==void 0&&(oi(o,66),oi(o,w.length),_H(o,w));let I=i.networkType;I!==void 0&&(oi(o,72),nm(o,fy(I)));let P=i.osType;P!==void 0&&(oi(o,80),nm(o,fy(P)));let F=i.requestId;F!==void 0&&(oi(o,90),tm(o,F));let x=i.sdkVersion;x!==void 0&&(oi(o,98),tm(o,x));let M=i.sequence;M!==void 0&&(oi(o,104),nm(o,fy(M)));let $=i.sid;$!==void 0&&(oi(o,114),tm(o,$));let q=i.timestamp;q!==void 0&&(oi(o,120),nm(o,q));let ae=i.uid;ae!==void 0&&(oi(o,128),oi(o,ae));let me=i.vid;me!==void 0&&(oi(o,136),oi(o,me));let ge=i.width;ge!==void 0&&(oi(o,144),nm(o,fy(ge)));let pe=i.service;pe!==void 0&&(oi(o,152),oi(o,pe));let we=i.callbackData;we!==void 0&&(oi(o,162),oi(o,we.length),_H(o,we));let Be=i.ticket;Be!==void 0&&(oi(o,170),tm(o,Be));let nt=i.vendorConfigs;nt!==void 0&&(oi(o,178),tm(o,nt))}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function Epe(e){return function(i){let o={};e:for(;!Spe(i);){let c=F0(i);switch(c>>>3){case 0:break e;case 1:o.code=F0(i);break;case 2:o.msg=EH(i,F0(i));break;case 3:o.requestId=EH(i,F0(i));break;case 4:o.timestamp=Tpe(i,!1);break;default:vpe(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function vpe(e,n){switch(n){case 0:for(;128&Hl(e););break;case 2:zL(e,F0(e));break;case 5:zL(e,4);break;case 1:zL(e,8);break;default:throw new Error("Unimplemented type: "+n)}}function fy(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let ype=[];function zL(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function Spe(e){return e.offset>=e.limit}function kA(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function gH(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function _H(e,n){let i=kA(e,n.length);e.bytes.set(n,i)}function EH(e,n){let i=gH(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let f=0;f<n;f++){let _,v,y,w,I=c[f+i];(128&I)==0?h+=o(I):(224&I)==192?f+1>=n?h+=u:(_=c[f+i+1],(192&_)!=128?h+=u:(w=(31&I)<<6|63&_,w<128?h+=u:(h+=o(w),f++))):(240&I)==224?f+2>=n?h+=u:(_=c[f+i+1],v=c[f+i+2],(49344&(_|v<<8))!=32896?h+=u:(w=(15&I)<<12|(63&_)<<6|63&v,w<2048||w>=55296&&w<=57343?h+=u:(h+=o(w),f+=2))):(248&I)==240?f+3>=n?h+=u:(_=c[f+i+1],v=c[f+i+2],y=c[f+i+3],(12632256&(_|v<<8|y<<16))!=8421504?h+=u:(w=(7&I)<<18|(63&_)<<12|(63&v)<<6|63&y,w<65536||w>1114111?h+=u:(w-=65536,h+=o(55296+(w>>10),56320+(1023&w)),f+=3))):h+=u}return h}function tm(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let f=n.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+n.charCodeAt(++h)-56613888),o+=f<128?1:f<2048?2:f<65536?3:4}oi(e,o);let c=kA(e,o),u=e.bytes;for(let h=0;h<i;h++){let f=n.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+n.charCodeAt(++h)-56613888),f<128?u[c++]=f:(f<2048?u[c++]=f>>6&31|192:(f<65536?u[c++]=f>>12&15|224:(u[c++]=f>>18&7|240,u[c++]=f>>12&63|128),u[c++]=f>>6&63|128),u[c++]=63&f|128)}}function Hl(e){return e.bytes[gH(e,1)]}function vH(e,n){let i=kA(e,1);e.bytes[i]=n}function F0(e){let n,i=0,o=0;do n=Hl(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function oi(e,n){for(n>>>=0;n>=128;)vH(e,127&n|128),n>>>=7;vH(e,n)}function Tpe(e,n){let i,o=0,c=0,u=0;return i=Hl(e),o=127&i,128&i&&(i=Hl(e),o|=(127&i)<<7,128&i&&(i=Hl(e),o|=(127&i)<<14,128&i&&(i=Hl(e),o|=(127&i)<<21,128&i&&(i=Hl(e),c=127&i,128&i&&(i=Hl(e),c|=(127&i)<<7,128&i&&(i=Hl(e),c|=(127&i)<<14,128&i&&(i=Hl(e),c|=(127&i)<<21,128&i&&(i=Hl(e),u=127&i,128&i&&(i=Hl(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:n}}function nm(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=kA(e,u),f=e.bytes;switch(u){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=u!==9?128|c:127&c;case 8:f[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:f[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:f[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:f[h+4]=u!==5?128|o:127&o;case 4:f[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:f[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:f[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:f[h]=u!==1?128|i:127&i}}const yH={},SH={},DA=4294967296,bpe=DA*DA,wpe=bpe/2;bH(0,!0);const TH=bH(0),Rpe=j0(0,-2147483648,!1),Cpe=j0(-1,2147483647,!1);function bH(e,n){let i,o,c;return n?(c=0<=(e>>>=0)&&e<256)&&(o=SH[e],o)?o:(i=j0(e,0,!0),c&&(SH[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=yH[e],o)?o:(i=j0(e,e<0?-1:0,!1),c&&(yH[e]=i),i)}function j0(e,n,i){return{low:0|e,high:0|n,unsigned:!!i}}function wH(e,n){if(isNaN(e))return TH;{if(e<=-9223372036854776e3)return Rpe;if(e+1>=wpe)return Cpe}return e<0?TH:j0(e%DA|0,e/DA|0,n)}function RH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class HL extends Rr{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(zu.CONNECTION_STATE_CHANGE,n,i)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var i;super(),z(this,"name","AgoraRTCImageModeration"),z(this,"_connectionState",Zc.CONNECTING),z(this,"_sequence",0),z(this,"_moderationStartTime",void 0),z(this,"_workerConnection",void 0),z(this,"_workerMessageLengthLimit",void 0),z(this,"_qualityRatio",void 0),z(this,"_connectInfo",void 0),z(this,"_cancelTokenSource",Do.CancelToken.source()),z(this,"_retryConfig",void 0),z(this,"_moderationInterval",void 0),z(this,"_moderationTimer",null),z(this,"_moderationMode",1),z(this,"_quality",1),z(this,"_qualityTimer",null),z(this,"_ticket",void 0),z(this,"_moderationIntervalMinimum",void 0),z(this,"_uploadFailedNum",0),z(this,"_uploadNum",0),z(this,"_uploadTimer",null),z(this,"_extraInfo",void 0),z(this,"_vendor",""),z(this,"_encoder",new TextEncoder),z(this,"_moderationId",void 0),z(this,"inspectImage",()=>{if(this.connectionState!==Zc.CONNECTED)throw new Te(Y.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Zc.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=nr(5,"image-moderation-"),this._workerMessageLengthLimit=Q("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Q("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),this._qualityRatio=Q("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new O0("worker-"+this._moderationId,pi),this.on(zu.STATE_CHANGE,(o,c)=>{N.debug("[".concat(this._moderationId,"] Moderation operation :").concat(ry[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(n,i){this.emit(zu.STATE_CHANGE,ry.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new tt((c,u)=>{this.on(zu.CONNECTION_STATE_CHANGE,(h,f)=>{h===Zc.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(n){var i;this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),N.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===Zc.CONNECTED&&this.inspectImage()}async requestAP(n,i,o){const c=Q("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,v,y,w){let{appId:I,areaCode:P,cname:F,sid:x,token:M,uid:$}=v;ly++;const q="moderation_plugin",ae={service_name:q,json_body:JSON.stringify({appId:I,areaCode:P,cname:F,command:"allocateEdge",requestId:ly,seq:ly,sid:x,appToken:M,ts:Date.now(),uid:$+""})};let me,ge,pe=_[0];return ju(async()=>{me=Date.now();const we=await Hu(pe,{data:ae,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ge=Date.now()-me,we.code!==0){const st=new Te(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+we.code,{retry:!0,responseTime:ge});throw N.error(st.toString()),st}const Be=JSON.parse(we.json_body);if(Be.code!==200){const st=new Te(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Be.code,", reason: ").concat(Be.reason),{code:Be.code,responseTime:ge});throw N.error(st.toString()),st}if(!Be.servers||!Array.isArray(Be.servers)||Be.servers.length===0){const st=new Te(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Be.code,responseTime:ge});throw N.error(st.toString()),st}if(!Be.servers.some(st=>!!st.wss)){const st=new Te(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Be.code,responseTime:ge});throw N.error(st.toString()),st}const nt=Q("IMAGE_MODERATION_WORKER_HOST");return{addressList:Be.servers.map(st=>{let{address:dn,wss:hn}=st;if(dn&&hn)return"wss://".concat(dn.replace(/\./g,"-"),".").concat(nt,":").concat(hn,"/moderation")}).filter(st=>!!st),workerToken:Be.workerToken,vid:Be.vid,ticket:Be.appTicket,responseTime:ge}},(we,Be)=>(Et.apworkerEvent(x,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(we.addressList),firstSuccess:Be===0,responseTime:ge,serverIp:_[Be%_.length]}),!1),(we,Be)=>(Et.apworkerEvent(x,{success:!1,sc:we.data&&we.data.code||200,serviceName:q,responseTime:ge,serverIp:_[Be%_.length]}),!!(we.code!==Y.OPERATION_ABORTED&&we.code!==Y.UNEXPECTED_RESPONSE||we.data&&we.data.retry)&&(pe=_[(Be+1)%_.length],!0)),w)}(c,n,i,o);this.emit(zu.STATE_CHANGE,ry.AP_CONNECTED);const{addressList:h,ticket:f}=u;return this._ticket=f,h}async connectWorker(n){this.emit(zu.STATE_CHANGE,ry.CONNECT_WORKER),await this._workerConnection.init(n,1e4)}handleWorkerEvents(){this._workerConnection.on(Bt.CONNECTED,async()=>{this.emit(zu.STATE_CHANGE,ry.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Zc.CONNECTED}),this._workerConnection.on(Bt.CLOSED,()=>{this.connectionState=Zc.CLOSED}),this._workerConnection.on(Bt.FAILED,()=>{this.connectionState=Zc.CLOSED}),this._workerConnection.on(Bt.RECONNECTING,()=>{this.connectionState=this.connectionState===Zc.CONNECTED?Zc.RECONNECTING:Zc.CONNECTING}),this._workerConnection.on(Bt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const i=Epe(new Uint8Array(n.data));Q("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,N.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Et.reportApiInvoke(this._connectInfo.sid||null,{name:hi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:kr.TRACER}).onError(new Te(Y.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},Q("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else N.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Bt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this._workerConnection.on(Bt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}async requestToInspectImage(){const n=hc(this,zu.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void(Q("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(n,i);this._workerConnection.sendMessage(o,!0,!0)}else Q("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being published can be inspected")}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:f,uid:_}=i;const v=Date.now(),y=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await J6(y,o,c),I=this._sequence+"-"+u+"-"+_+"-"+v+"-"+nr(12,""),P={appId:o,cid:u,cname:c,deviceId:"",elapse:HL.intToLong(Number(v-this._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:w,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.2",sequence:this._sequence,sid:f,timestamp:wH(v),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete P.callbackData;const F=_pe(P);if(F.byteLength<this._workerMessageLengthLimit){if(Q("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const x=function(M){for(var $=1;$<arguments.length;$++){var q=arguments[$]!=null?arguments[$]:{};$%2?RH(Object(q),!0).forEach(function(ae){z(M,ae,q[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(q)):RH(Object(q)).forEach(function(ae){Object.defineProperty(M,ae,Object.getOwnPropertyDescriptor(q,ae))})}return M}({},P);delete x.jpg,N.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(x))}return F}{const x=this.quality*this._qualityRatio;return this.quality=x,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:f,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Do.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Zc.CLOSED,this.emit(zu.STATE_CHANGE,ry.CLOSED)}}function CH(e){if(Xn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Te(Y.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Te(Y.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Ipe={name:"ImageModeration",create:function(e){let{config:n}=e;return CH(n),new HL(n)}};var IH,AH,OH,PH,NH,kH,DH,LH,xH,MH,UH,VH,FH,jH,BH,WH,GH,zH,HH,KH,$H,qH,YH,XH,JH,QH,ZH,e8,t8,n8,r8,i8,s8,o8,a8,c8,l8,u8,d8,h8,p8,rt;function f8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Kl(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?f8(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}ms.setLogger(N);let Ape=(IH=At(),AH=At({argsMap:(e,n)=>{if(!Array.isArray(n)){if(!(n instanceof Yv))return[n];n=[n]}return n.map(i=>i?Object(i).toString():"null")}}),OH=At({argsMap:(e,n)=>(n||(n=[]),Array.isArray(n)||n.trackMediaType!==qv.DATA?(Array.isArray(n)||(n=[n]),n.map(i=>i.getTrackId())):[n.getChannelId()])}),PH=At({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),NH=At({argsMap:(e,n,i)=>[n,i]}),kH=At({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),DH=At({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),LH=At({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),xH=At(),MH=At(),UH=At(),VH=At(),FH=At(),jH=At(),BH=At(),WH=At(),GH=At(),zH=At(),HH=At(),KH=At(),$H=At(),qH=At(),YH=At(),XH=At({argsMap:(e,n)=>[n]}),JH=At(),QH=At(),ZH=At(),e8=At(),t8=At(),n8=At(),r8=At(),i8=At(),s8=At({argsMap:(e,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),o8=At(),a8=At(),c8=At(),l8=At(),u8=At(),d8=At(),h8=At({reportResult:!0}),p8=At(),rt=class extends Rr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,n){let i;if(super(),z(this,"store",void 0),z(this,"_uid",void 0),z(this,"_channelName",void 0),z(this,"_uintUid",void 0),z(this,"_users",[]),z(this,"_config",void 0),z(this,"_clientId",void 0),z(this,"_appId",void 0),z(this,"_sessionId",null),z(this,"_key",void 0),z(this,"_rtmConfig",{}),z(this,"_joinInfo",void 0),z(this,"_gateway",void 0),z(this,"_statsCollector",void 0),z(this,"_configDistribute",void 0),z(this,"_leaveMutex",void 0),z(this,"_publishMutex",void 0),z(this,"_renewTokenMutex",void 0),z(this,"_subscribeMutex",void 0),z(this,"_encryptionMode","none"),z(this,"_encryptionSecret",null),z(this,"_encryptionSalt",null),z(this,"_encryptDataStream",!1),z(this,"_encryptDataStreamKey",null),z(this,"_encryptDataStreamIv",null),z(this,"_proxyServer",void 0),z(this,"_turnServer",{servers:[],mode:"auto"}),z(this,"_cloudProxyServerMode","disabled"),z(this,"_isDualStreamEnabled",!1),z(this,"_defaultStreamFallbackType",void 0),z(this,"_lowStreamParameter",void 0),z(this,"_streamFallbackTypeCacheMap",new Map),z(this,"_remoteStreamTypeCacheMap",new Map),z(this,"_axiosCancelSource",Do.CancelToken.source()),z(this,"_audioVolumeIndicationInterval",void 0),z(this,"_networkQualityInterval",void 0),z(this,"_userOfflineTimeout",void 0),z(this,"_streamRemovedTimeout",void 0),z(this,"_liveTranscodeStreamingClient",void 0),z(this,"_liveRawStreamingClient",void 0),z(this,"_channelMediaRelayClient",void 0),z(this,"_networkQualitySensitivity","normal"),z(this,"_p2pChannel",void 0),z(this,"_useLocalAccessPoint",!1),z(this,"_setLocalAPVersion",void 0),z(this,"_joinAndNotLeaveYet",!1),z(this,"_numberOfJoinCount",0),z(this,"_remoteDefaultVideoStreamType",void 0),z(this,"_inspect",void 0),z(this,"_moderation",void 0),z(this,"_license",void 0),z(this,"_pendingPublishedUsers",[]),z(this,"ntpAlignErrorCount",0),z(this,"remoteInboundOffset",0),z(this,"_peerConnectionState",void 0),z(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),z(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),z(this,"_handleUserOnline",c=>{if(Q("BLOCK_LOCAL_CLIENT")&&e_(c.uid,this.channelName))return void N.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&N.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(on.USER_JOINED,u));else{const h=new Zf(c.uid,c.uint_id||c.uid);this._users.push(h),N.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(on.USER_JOINED,h)}}),z(this,"_handleUserOffline",c=>{if(Q("BLOCK_LOCAL_CLIENT")&&e_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:xI(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),N.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(on.USER_LEAVED,u,c.reason))}),z(this,"_handleAddAudioOrVideoStream",(c,u,h,f,_,v,y)=>{if(Q("BLOCK_LOCAL_CLIENT")&&e_(u,this.channelName))return;const w=this._users.find(P=>P.uid===u);if(!w)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now());const I=c==="audio"?w.hasAudio:w.hasVideo;w._uintid||(w._uintid=_||u),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,h!==void 0&&(w._audioSSRC=h),f!==void 0&&(w._cname=f),v&&(w._audioOrtc=v)):(w._video_added_=!0,h!==void 0&&(w._videoSSRC=h),f!==void 0&&(w._cname=f),y!==void 0&&(w._rtxSsrcId=y),v&&(w._videoOrtc=v)),(c==="audio"?w.hasAudio:w.hasVideo)&&!I&&(N.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(on.USER_PUBLISHED,w,c)),c==="video"?Et.onGatewayStream(this._sessionId,Ii.ON_ADD_VIDEO_STREAM,yr.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:w._videoSSRC}):Et.onGatewayStream(this._sessionId,Ii.ON_ADD_AUDIO_STREAM,yr.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,h).then(P=>{if(P&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof V0))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(F=>{N.error("[".concat(this._clientId,"] resubscribe error"),F.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(P=>{N.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),z(this,"_handleRemoveStream",c=>{if(Q("BLOCK_LOCAL_CLIENT")&&e_(c.uid,this.channelName))return;const u=this._users.find(f=>f.uid===c.uid);if(!u)return void N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));N.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(on.USER_UNPUBLISHED,u,"audio"),N.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(on.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(on.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(on.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof V0&&this._p2pChannel.unsubscribe(u).then(f=>{if(f)return this._gateway.unsubscribe(f,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),Et.onGatewayStream(this._sessionId,Ii.ON_REMOVE_STREAM,yr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),z(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(Q("BLOCK_LOCAL_CLIENT")&&e_(u,this.channelName))return;const f=this._users.find(y=>y.uid===u);if(!f)return void N.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));N.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?f.hasAudio:f.hasVideo;if(c==="audio"){f._trust_audio_enabled_state_=!0;const y=f._audio_enabled_;if(f._audio_enabled_=h,f._audio_enabled_===y)return;{const w=f._audio_enabled_?"enable-local-audio":"disable-local-audio";N.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(on.USER_INFO_UPDATED,u,w)}}else{f._trust_video_enabled_state_=!0;const y=f._video_enabled_;if(f._video_enabled_=h,f._video_enabled_===y)return;{const w=f._video_enabled_?"enable-local-video":"disable-local-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(on.USER_INFO_UPDATED,u,w)}}const v=c==="audio"?f.hasAudio:f.hasVideo;return _!==v?!_&&v?(N.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(on.USER_PUBLISHED,f,c)):(c==="video"&&f._videoTrack&&f._videoTrack._destroy(),c==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,c),N.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(on.USER_UNPUBLISHED,f,c)):void 0}),z(this,"_handleMuteStream",(c,u,h)=>{if(Q("BLOCK_LOCAL_CLIENT")&&e_(c,this.channelName))return;N.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const f=this._users.find(y=>y.uid===c);if(!f)return void N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?f.hasAudio:f.hasVideo;if(u==="audio"){f._trust_audio_mute_state_=!0;const y=f._audio_muted_;if(f._audio_muted_=h,f._audio_muted_===y)return;{const w=f._audio_muted_?"mute-audio":"unmute-audio";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(on.USER_INFO_UPDATED,c,w)}}else{f._trust_video_mute_state_=!0;const y=f._video_muted_;if(f._video_muted_=h,f._video_muted_===y)return;{const w=f._video_muted_?"mute-video":"unmute-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(on.USER_INFO_UPDATED,c,w)}}const v=u==="audio"?f.hasAudio:f.hasVideo;if(_!==v){if(!_&&v)return(u==="audio"?f._audioSSRC:f._videoSSRC)?(N.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(on.USER_PUBLISHED,f,u)):void N.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),u==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,u),N.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(on.USER_UNPUBLISHED,f,u)}}),z(this,"_handleP2PLost",async c=>{N.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():N.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),z(this,"_handleTokenWillExpire",()=>{N.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(on.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),z(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),N.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),z(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(on.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(on.NETWORK_QUALITY,c)}),z(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,f)=>{const _=this._users.find(y=>y.uid===u);if(!_)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),f!==void 0&&(_._audioMid=f)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),f!==void 0&&(_._videoMid=f)),(c==="audio"?_.hasAudio:_.hasVideo)&&!v&&(N.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(on.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(y=>{N.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),this._config=e,this._clientId=n||nr(5,"client-"),this.store=new class{constructor(c,u,h,f){Mt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:f,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:$g.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case an.SET_SESSION_ID:return ot(ot({},u),{},{sessionId:h.sessionId});case an.SET_P2P_ID:return ot(ot({},u),{},{p2pId:h.p2pId});case an.SET_UID:return ot(ot({},u),{},{uid:h.uid});case an.SET_INT_UID:return ot(ot({},u),{},{intUid:h.intUid});case an.SET_PUB_ID:return ot(ot({},u),{},{pubId:h.pubId});case an.KEY_METRIC_CLIENT_CREATED:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{clientCreated:h.metric})});case an.KEY_METRIC_JOIN_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{joinStart:h.metric})});case an.AVOID_JOIN_START:return ot(ot({},u),{},{avoidJoinStart:h.avoidJoinStart});case an.KEY_METRIC_JOIN_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{joinEnd:h.metric})});case an.KEY_METRIC_REQUEST_AP_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{requestAPStart:h.metric})});case an.KEY_METRIC_REQUEST_AP_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{requestAPEnd:h.metric})});case an.KEY_METRIC_JOIN_GATEWAY_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case an.KEY_METRIC_JOIN_GATEWAY_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case an.KEY_METRIC_PEER_CONNECTION_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case an.KEY_METRIC_PEER_CONNECTION_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case an.KEY_METRIC_DESCRIPTION_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{descriptionStart:h.metric})});case an.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case an.KEY_METRIC_ICE_CONNECTION_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case an.KEY_METRIC_PUBLISH:{const f=u.keyMetrics.publish,_=f.findIndex(v=>v.trackId===h.metric.trackId);return _!==-1?(f[_]=ot(ot({},f[_]),h.metric),ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{publish:[...f]})})):ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case an.KEY_METRIC_SUBSCRIBE:{const f=u.keyMetrics.subscribe,_=f.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return _!==-1?(f[_]=ot(ot({},f[_]),h.metric),ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{subscribe:[...f]})})):ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case an.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case an.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=ot(ot({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case an.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case an.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case an.SET_USE_P2P:return ot(ot({},u),{},{useP2P:h.val});case an.SET_TRANSPORT_TYPE:return ot(ot({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:an.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:an.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:an.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:an.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:an.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:an.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:an.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:an.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:an.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:an.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:an.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:an.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:an.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:an.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:an.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:an.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:an.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:an.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:an.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:an.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:an.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,f){this.dispatch({type:an.KEY_METRIC_PUBLISH,metric:ot(ot({trackId:c,type:u},h&&{publishStart:h}),f&&{publishEnd:f})})}subscribe(c,u,h,f,_,v,y){this.dispatch({type:an.KEY_METRIC_SUBSCRIBE,metric:ot(ot(ot(ot(ot({userId:c,type:u},h&&{subscribeStart:h}),f&&{subscribeEnd:f}),_&&{firstFrame:_}),v&&{streamAdded:v}),y&&{firstDecoded:y})})}massSubscribe(c,u,h,f){c.forEach(_=>{this.dispatch({type:an.KEY_METRIC_SUBSCRIBE,metric:ot(ot(ot({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),f&&{firstFrame:f})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:an.RECORD_JOIN_CHANNEL_SERVICE,record:ot(ot({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:an.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:an.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:an.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:an.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new ms("client-leave",this._clientId),this._publishMutex=new ms("client-publish",this._clientId),this._renewTokenMutex=new ms("client-renewtoken",this._clientId),this._subscribeMutex=new ms("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),N.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Xc," build: ").concat(U1,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{w1(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){N.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new M0(this.store),this._statsCollector.onStatsException=(c,u,h)=>{N.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(on.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,f)=>{const _=this._users.find(v=>v.uid===c);_&&Et.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Khe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||pi,httpRetryConfig:e.httpRetryConfig||pi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new npe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},_p("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new V0(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,n,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Kn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Kn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const f=this._gateway.signal.websocket;return f instanceof gL&&(f.use443PortOnly=u,f.tryDoubleDomain=h),async function(_,v,y){PI.get(_)||PI.set(_,[]),NI.get(_)||NI.set(_,v),xd.get(_)||xd.set(_,0);const w=PI.get(_),I=NI.get(_);if(!w||!I)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(xd.get(_)===I){const $=p0();w.push($),await $.promise}xd.set(_,xd.get(_)+1);for(var P=arguments.length,F=new Array(P>3?P-3:0),x=3;x<P;x++)F[x-3]=arguments[x];const M=await y(...F);return xd.set(_,xd.get(_)-1),xd.get(_)===I-1&&w.length>0&&(w[0].resolve(),w.shift()),xd.get(_)===0&&(PI.set(_,[]),NI.set(_,0),xd.set(_,0)),M}("client.join",Q("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,n,i,o,c)}async join(e,n,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(VI||VI||(VI=(window.location.protocol.split(":")[0]||"").toUpperCase(),VI))==="HTTPS",f=d6()?window.isSecureContext:"Browser Not Support";(!d6()&&!h||!window.isSecureContext)&&N.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),N.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Et.setAppId(e);try{if(!i&&i!==null)throw new Te(Y.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&zi(i,"token",1,2047),zi(e,"appid",1,2047),oA(n),o&&aA(o),c&&zi(c,"optionalInfo",1,2047)}catch(x){throw Et.reportApiInvoke(Kg(),{name:hi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:f},tag:kr.TRACER}).onError(x),x}if(this._leaveMutex.isLocked&&(N.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),N.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const x=new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Et.reportApiInvoke(Kg(),{name:hi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:f},tag:kr.TRACER}).onError(x),x}this._gateway.state="CONNECTING";const _=await uH({appId:e,cname:n,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(_==null?void 0:_.sid)||Kg();N.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const y=Et.reportApiInvoke(v,{id:this._clientId,name:hi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:f},tag:kr.TRACER}),w=Kl(Kl(Kl({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:n,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Q("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(w.stringUid=o,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async x=>{const M=function(me){const ge=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),pe=new Uint8Array(new ArrayBuffer(ge.length));for(let we=0;we<ge.length;we+=1)pe[we]=ge.charCodeAt(we);return pe}(),$=await window.crypto.subtle.importKey("spki",M,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),q=T1(x),ae=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},$,q);return function(me){let ge="";for(let pe=0;pe<me.length;pe+=1)ge+=String.fromCharCode(me[pe]);return window.btoa(ge)}(new Uint8Array(ae))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const x=new TextEncoder,M=Q("USE_PURE_ENCRYPTION_MASTER_KEY")?x.encode(w.appId+this._encryptionSecret+this._encryptionSecret):x.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function($,q,ae){const me=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),ge=$==="aes-128-gcm2"?128:256,pe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:S6,hash:"SHA-256",salt:ae},me,ge+Tde);return new Uint8Array(pe).subarray(ge/8)}(this._encryptionMode,M,Hg(this._encryptionSalt)),this._encryptDataStreamKey=await async function($,q,ae){const me=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),ge=$==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:S6,hash:"SHA-256",salt:ae},me,{name:"AES-GCM",length:ge},!0,["encrypt","decrypt"])}(this._encryptionMode,M,Hg(this._encryptionSalt))}else f?N.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):N.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,N.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:n,appId:e,stringUid:w.stringUid});const I=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&I===this._sessionId&&Et.joinChannelTimeout(this._sessionId,5)},5e3);try{var P;let x;const M=w.cloudProxyServer;if(Xe(P=["proxy3","proxy4","proxy5"]).call(P,M)){const ge=Q("PROXY_SERVER_TYPE3");Array.isArray(ge)?w.proxyServer=ge[0]:w.proxyServer=ge}if(Et.setProxyServer(w.proxyServer),N.setProxyServer(w.proxyServer),this.store.requestAPStart(),_){if(N.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(_.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=_.intUid),x={gatewayInfo:_.ap.gatewayInfo},Q("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ge=(await nz(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(pe=>({turnServerURL:pe.address,tcpport:pe.tcpport||us.tcpport,udpport:pe.udpport||us.udpport,username:pe.username||us.username,password:pe.password||us.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:ge}}pH(_,w.stringUid)}else{if(w.stringUid&&!w.uid){let ge;[ge,x]=await tt.all([Pz(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,this.store),Oz(w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,!0,this.store)]),N.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(ge)),w.uid=ge,x.gatewayInfo.uid=ge,x.gatewayInfo.res.uid=ge}else x=await Oz(w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(I0.UPDATE_BITRATE_LIMIT,ge=>{this._p2pChannel.updateBitrateLimit(ge)}),this._configDistribute.on(I0.UPDATE_CLIENT_ROLE_OPTIONS,ge=>{this._setClientRoleOptions(ge)})},0),this._key=i||e;const $=x.gatewayInfo,q=w.uid?w.uid:$.uid;this._joinInfo=Kl(Kl({},w),{},{cid:$.cid,uid:q,vid:$.vid,apResponse:$.res,apGatewayAddress:$.apGatewayAddress,uni_lbs_ip:$.uni_lbs_ip,gatewayAddrs:$.gatewayAddrs}),this.store.intUid=q,this.store.cid=$.cid;const ae=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));y.onSuccess(ae),this._appId=e,this._channelName=w.cname,this._uid=ae,this.store.uid=ae,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(as()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const me=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return N.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(me)),setTimeout(()=>{N.startUpload()},5e3),this.store.joinEnd(),F=this,Xe(Zg).call(Zg,F)||Zg.push(F),this._cloudProxyServerMode==="disabled"&&In().supportWebCrypto&&Q("ENABLE_PRELOAD")&&GL(this._joinInfo),ae}catch(x){const M=Array.isArray(x)?x[0]:x;throw M&&M.code===Y.OPERATION_ABORTED?N.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),M):N.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),M),M.code!==Y.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),y.onError(M),M}var F}_joinGateway(){if(!this._joinInfo||!this._key)throw new Te(Y.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Q("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){N.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(as()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=Zg.indexOf(n);i!==-1&&Zg.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return N.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Un.LEAVE),N.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Yv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Te(Y.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new Te(Y.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof Yv))throw new Te(Y.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&n)throw new Te(Y.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}N.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),n&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof hr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),N.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw N.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){Xn(e.id,"id",0,65535,!0),up(e.ordered,"ordered"),zi(e.metadata,"metadata",0,512),N.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const n=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Te(Y.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Te(Y.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Q("FORCE_TURN")&&!Q("TURN_ENABLE_TCP")&&!Q("TURN_ENABLE_UDP"))throw new Te(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return yz(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Te(Y.CREATE_DATACHANNEL_ERROR);try{await tt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==Y.DISCONNECT_P2P)throw c}}return N.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw N.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Te(Y.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let n=[];if(e)if(Array.isArray(e))n=e;else{if(!(e instanceof Yv))return this._unpublishDataChannel([e]);n=[e]}else this.store.useP2P||await this._unpublishDataChannel(),n=this._p2pChannel.getAllTracks(!0);N.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(n.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.sendExtensionMessage(qr.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.unpublish(o,this._uid),N.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(n.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw N.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),N.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const n=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),N.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw N.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{n&&n()}}async subscribe(e,n,i){if(!(e instanceof Zf)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Te(Y.INVALID_REMOTE_USER,"user is not in the channel");e=o}return n==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,n)}async presubscribe(e,n){if(Si(n,"mediaType",["audio","video"]),this.store.useP2P)throw new Te(Y.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=n===at.AUDIO,o=n===at.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:f,cname:_,uint_id:v}=await this._gateway.presubscribe(e,n,!0);if(u==null)throw new Te(Y.UNEXPECTED_RESPONSE,"no ssrc id");let y=this._users.find(I=>I.uid===e);y||(y=new Zf(e,v||e),y._is_pre_created=!0,this._users.push(y)),_&&(y._cname=_),y._uintid||(y._uintid=v||e),i&&(y._audioSSRC=u,y._audio_pre_subscribed=!0,h&&(y._audioOrtc=h)),o&&(y._videoSSRC=u,y._video_pre_subscribed=!0,h&&(y._videoOrtc=h),f!=null&&(y._rtxSsrcId=f)),N.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(y,n,u,f,h);const w=i?y._audioTrack:y._videoTrack;if(!w)throw new Te(Y.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(y._trust_audio_stream_added_state_=!0,y._audio_added_=!0),o&&(y._trust_video_stream_added_state_=!0,y._video_added_=!0),w}catch(u){throw N.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,n){var i;if(Xn(n,"channelId",0,65535,!0),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e))throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Te(Y.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Te(Y.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(f=>f.id===n);if(!c)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Te(Y.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const f=await this._p2pChannel.subscribeDataChannel(e,[c]);if(f&&Xe(f).call(f,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Te(Y.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,n,i){if(Si(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Te(Y.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Te(Y.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(n==="audio"&&!e.hasAudio||n==="video"&&!e.hasVideo)){const u=new Te(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),u}const c=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const h=n==="audio"?e._audioSSRC:e._videoSSRC,f=n==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,n,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,n,h,f)}catch(h){throw h}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=n==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Te(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,n,i){if(this.store.useP2P)return this._p2pSubscribe(e,n);if(Si(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===e)){const v=new Te(Y.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),v}if(!e.hasAudio&&!e.hasVideo){const v=new Te(Y.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),v}if(!(i||(n!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(n!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const v=new Te(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),v}let c=n==="audio"?e._audioSSRC:e._videoSSRC,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,f={stream_type:n==="audio"?at.AUDIO:at.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const y=n==="audio"?e._audioSSRC:e._videoSSRC;y!==void 0&&y!==c&&(c=y,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,f={stream_type:n==="audio"?at.AUDIO:at.VIDEO,ssrcId:c}),Es.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,n,Date.now()),await this._p2pChannel.subscribe(e,n,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,f,!0)}catch(w){if((w==null?void 0:w.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,n),w;await this._p2pChannel.unsubscribe(e,n,!0),this._p2pChannel.setPendingRemoteMedia(e,n)}this.store.subscribe(e.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,n)}catch(y){throw this._p2pChannel.reportSubscribeEvent(!1,y==null?void 0:y.code,e,n),y}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(y=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),y)});const v=n==="audio"?e._audioTrack:e._videoTrack;if(!v)throw new Te(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),v),v}finally{_()}}async massSubscribe(e){if(dp(e,"subscribeList"),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const n=Date.now(),i=new Map,o=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(f=>{let{user:_,mediaType:v}=f;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(v)}).join("; ")));const c=(e=[...e]).map(f=>{let{user:_,mediaType:v}=f;return{user:_,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const v=e[_],{user:y,mediaType:w}=v;if(Si(w,"mediaType",["audio","video"]),!y){const x=new Te(Y.INVALID_PARAMS,"user property does not exist in subscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),x}if(!this._users.find(x=>x===y)){const x=new Te(Y.INVALID_REMOTE_USER,"user is not in the channel");N.error("[".concat(this._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),c[_].error=x,e.splice(_,1);continue}if(w==="audio"&&(!y.hasAudio||y._audioSSRC===void 0)||w==="video"&&(!y.hasVideo||y._videoSSRC===void 0)){const x=new Te(Y.REMOTE_USER_IS_NOT_PUBLISHED);N.error("[".concat(this._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(w,", remote user is not published")),c[_].error=x,e.splice(_,1);continue}const P=Ai.Video|Ai.LwoVideo,F=i.get(y);if(F){if(w==="video"?F&P:F&Ai.Audio){e.splice(_,1),N.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(w," twice"));continue}i.set(y,F|(w==="video"?P:Ai.Audio))}else i.set(y,w==="video"?P:Ai.Audio)}for(let _=e.length-1;_>=0;_--){const v=e[_],{user:y,mediaType:w}=v,I=Ai.Video|Ai.LwoVideo;if(this._p2pChannel.hasRemoteMedia(y,w)){await this._p2pChannel.unmuteRemoteNoLock(y,w);const P=i.get(y);i.set(y,w==="video"?P^I:P^Ai.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),n);let f=Aa(h=Array.from(i.entries())).call(h,(_,v)=>{let[y,w]=v;if(w===0)return _;const I={stream_id:y.uid,stream_type:w};return w&Ai.Audio&&(I.audio_ssrc=y._audioSSRC),w&Ai.Video&&(I.video_ssrc=y._videoSSRC),_.push(I),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(v=>{let{user:y,mediaType:w}=v;return{user:y,mediaType:w,ssrcId:w===at.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:w===at.VIDEO?y._rtxSsrcId:void 0}}));const _=new Map;if(f=f.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),f.length>0){const v=await this._gateway.subscribeAll(f,!0);((v==null?void 0:v.users)||[]).forEach(y=>{let{stream_id:w,video_error_code:I,audio_error_code:P,error_code:F}=y;(I||P||F)&&_.set(w,{video_error_code:I,audio_error_code:P,error_code:F})})}if(Array.from(_.entries()).length>0){const v=[];Array.from(_.entries()).forEach(y=>{let[w,I]=y;const P=this.remoteUsers.find(F=>F.uid===w);if(P){let F;I.error_code||I.video_error_code&&I.audio_error_code?F=void 0:I.video_error_code?F=at.VIDEO:I.audio_error_code&&(F=at.AUDIO),v.push({user:P,mediaType:F})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const y=_.get(v.user.uid);if(y){const w=y.error_code||v.mediaType==="audio"&&y.audio_error_code||v.mediaType==="video"&&y.video_error_code;if(w){const I=A0(w);N.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(I.desc)),v.error=new Te(Y.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(I.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var y;Et.subscribe(this.store.sessionId,{succ:!!v.error,ec:((y=v.error)===null||y===void 0?void 0:y.code)||null,video:v.mediaType===at.VIDEO,audio:v.mediaType===at.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===at.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-n),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),N.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(v=>{let{user:y,mediaType:w}=v;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(w)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,n,i){if(!(e instanceof Zf)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Te(Y.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(n||this.store.useP2P){if(n==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(n&&Si(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Te(Y.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(n));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,n);else{const u=await this._p2pChannel.unsubscribe(e,n);u&&await this._gateway.unsubscribe(u,e.uid),n&&n!=="audio"||(e._audio_pre_subscribed=!1),n&&n!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&xI(this._users,e),N.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(n))}}catch(u){if(u.code===Y.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,n){if(n&&Xn(n,"id",0,65535,!0),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Te(Y.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof n=="number"){const c=e._dataChannels.find(u=>u.id===n);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Te(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(n,", remote datachannel is not published")),c}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),N.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===Y.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(dp(e,"unsubscribeList"),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");N.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const n=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const f=new Te(Y.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),f}if(Si(c,"mediaType",["video","audio",void 0]),!this._users.find(f=>f===o)){N.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=Ai.Video|Ai.LwoVideo;if(n.has(o)){const f=n.get(o);let _;switch(c){case"video":_=f&h;break;case"audio":_=f&Ai.Audio;break;default:_=f&(Ai.Audio|h)}if(_){N.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?n.set(o,f|Ai.Audio):c==="video"&&n.set(o,f|h):n.set(o,f|Ai.Audio|h)}else c?c==="audio"?n.set(o,Ai.Audio):c==="video"&&n.set(o,h):n.set(o,Ai.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),N.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===Y.DISCONNECT_P2P)return void N.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw N.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Ce(Y.INVALID_PARAMS);Nr(i.width)||y1(i.width,"streamParameter.width"),Nr(i.height)||y1(i.height,"streamParameter.height"),Nr(i.framerate)||y1(i.framerate,"streamParameter.framerate"),Nr(i.bitrate)||Xn(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&N.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),N.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const n=this._configDistribute.getLowStreamConfigDistribute();if(n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ve.LocalVideoLowTrack)}async enableDualStream(){if(!In().supportDualStream)throw Et.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Te(Y.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Te(Y.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Et.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Et.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),N.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ve.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Et.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Et.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),N.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,n){if(function(o){Si(o,"role",["audience","host"])}(e),n&&w1(n),this.mode==="rtc"||this.mode==="p2p")throw N.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Te(Y.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(n&&n.level&&e==="host")throw new Te(Y.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Te(Y.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&Q("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,n),this._config.role=e,this._gateway.reconnect("recover",cs.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,n),this._config.role=e),N.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(n&&n.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let n=!1;try{e&&w1(e),await this._gateway.setClientRole(this._config.role,e),n=!0}catch{}finally{N.info("[".concat(this._clientId,"] set client role options ").concat(n?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const n=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!n||!n.timestamp)return 0;const i=n.timestamp-Date.now();return Math.abs(i)>1e3+n.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,n){if(zi(e,"proxyServer"),!n){if(this.connectionState!=="DISCONNECTED")throw new Te(Y.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Te(Y.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Et.setProxyServer(this._proxyServer),N.setProxyServer(this._proxyServer),N.info("[".concat(this._clientId,"] Set proxy server ").concat(n?"by initialize call":""," success."))}setTurnServer(e,n){if(Array.isArray(e)||(e=[e]),!n){if(this.connectionState!=="DISCONNECTED")throw new Te(Y.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Te(Y.INVALID_OPERATION,"You have already set the proxy")}if(E0(e))return this._turnServer={servers:e,mode:"original-manual"},void N.info("[".concat(this._clientId,"] Set original turnserver ").concat(n?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>Z5(i)),this._turnServer={servers:e,mode:"manual"},N.info("[".concat(this._clientId,"] Set turnserver ").concat(n?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Te(Y.INVALID_OPERATION,"you should set license before join channel");if(zi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Te(Y.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,N.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Te(Y.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Te(Y.INVALID_OPERATION,"You have already set the proxy");const n=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Te(Y.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new Te(Y.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Te(Y.INVALID_OPERATION,"Stop proxy server after leave channel");Et.setProxyServer(),N.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Te(Y.INVALID_PARAMS,"accessPoints is required.");dp(e.accessPoints.serverList,"accessPoints.serverList"),zi(e.accessPoints.domain,"accessPoints.domain");const n=(I,P)=>{Xn(I,P,0,65535,!0)};let i=443;if(e.accessPoints.port&&(n(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Te(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Q("CLOSE_AFB_FOR_LOCAL_AP")&&(Kn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Kn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(I=>o.test(I)?"".concat(I.replace(/\./g,"-"),".").concat(c):I),h=u.map(I=>"".concat(I,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Kn("WEBCS_DOMAIN",h),Kn("WEBCS_DOMAIN_BACKUP_LIST",h),Kn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(dp(e.report.hostname,"report.hostname"),Kn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Kn("EVENT_REPORT_DOMAIN",u[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let f=6443;e.report&&e.report.port&&(n(e.report.port,"report.port"),f=e.report.port),Kn("STATS_COLLECTOR_PORT",f),e.report?Kn("ENABLE_EVENT_REPORT",!0):Kn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(dp(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let v=6444;e.log&&e.log.port&&(n(e.log.port,"log.port"),v=e.log.port),Kn("LOG_UPLOAD_SERVER","".concat(_,":").concat(v));let y=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(dp(e.cds.hostname,"cds.hostname"),y=e.cds.hostname):y=u;let w=443;e.cds&&e.cds.port&&(n(e.cds.port,"cds.port"),w=e.cds.port),Kn("CDS_AP",y.map(I=>"".concat(I,":").concat(w))),e.cds?Kn("ENABLE_CONFIG_DISTRIBUTE",!0):Kn("ENABLE_CONFIG_DISTRIBUTE",!1),N.info("set local access point v2 success")}setLocalAccessPoints(e,n){if(dp(e,"serverList"),zi(n,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Te(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(n):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Kn("WEBCS_DOMAIN",e),Kn("WEBCS_DOMAIN_BACKUP_LIST",e),Kn("GATEWAY_DOMAINS",[n]),Kn("EVENT_REPORT_DOMAIN",e[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Kn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),N.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Si(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(n){throw N.error("[".concat(this._clientId,"] set default remote video stream type error"),n.toString()),n}else N.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,n){Si(n,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,n),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw N.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}N.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(e,n)}async setStreamFallbackOption(e,n){Si(n,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,n)}catch(i){throw N.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}N.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(e,n)}setEncryptionConfig(e,n,i,o){(function(u){Si(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),zi(n,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Xe(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new Te(Y.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new Te(Y.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(up(o,"encryptDataStream"),!Xe(c).call(c,e))throw new Te(Y.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(n)||N.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=n,i&&(this._encryptionSalt=Hf(i))}async renewToken(e){if(zi(e,"token",1,2047),!this._key||!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"renewToken should not be called before user join");const n=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(Q("USE_NEW_TOKEN")){N.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await tpe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pi);N.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else N.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});N.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=n,this._joinInfo.token=n,N.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?N.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(on.VOLUME_INDICATOR,e)},Q("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),n=this._gateway.getInChannelInfo();return e.Duration=Math.round(n.duration/1e3),e}async startLiveStreaming(e,n){if(!n){if(this.codec!=="h264")throw new Te(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Te(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Te(Y.LIVE_STREAMING_TASK_CONFLICT);const i=n?fp.TRANSCODE:fp.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(fp.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!n.length)throw new Te(Y.INVALID_PARAMS,"can not find live streaming url to stop");await tt.all(n.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){Uz(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){Uz(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof V0&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var n;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Xe(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var f;const _=Aa(f=Array.from(h)).call(f,(x,M)=>x+M,0),v={serverTs:0,seq:bde++,length:h.length,checkSum:_},y=new Uint8Array(a6(_,2)),w=new ArrayBuffer(Wv),I=new DataView(w);I.setUint32(0,v.serverTs),I.setUint16(4,v.seq),I.setUint16(6,v.length),I.setUint16(8,v.checkSum);const P=16-h.length%16;h=n6(h,new Uint8Array(P));const F=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:y6,additionalData:y},u,h);return n6(new Uint8Array(w),new Uint8Array(F))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Te(Y.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Dt.DATA_STREAM,{payload:Hf(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-upe},!i)}sendMetadata(e){if(!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Te(Y.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Dt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Hf(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(kde),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"can not send custom report, not joined");await Et.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,n){Si(n.spatialLayer,"spatialLayer",[0,1,2,3]),Si(n.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,n)}catch(i){throw N.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:n=!1,rtmFlag:i}=e;if(up(n,"apRTM"),Xn(i,"rtmFlag",0),this._rtmConfig.apRTM=n,this._rtmConfig.rtmFlag=i,N.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=n,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(N.debug("[".concat(this._clientId,"] reset client")),function(e){const n=ty.indexOf(e);n!==-1&&ty.splice(n,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Do.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&hH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Et.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(n=>n._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ms("client-publish",this._clientId),this._subscribeMutex=new ms("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,n){var i;const o=e||Kg();e?N.debug("[".concat(this._clientId,"] new Session ").concat(o)):N.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,Et.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(n==null?void 0:n.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Et.sessionInit(this._sessionId,Kl({cname:n.channel,appid:n.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Te(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Q("FORCE_TURN")&&!Q("TURN_ENABLE_TCP")&&!Q("TURN_ENABLE_UDP"))throw new Te(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");N.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(qr.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof hr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{N.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===Y.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Te(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Te(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));N.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw i.throw(u),u}i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===Y.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const n=()=>{if(!this._joinInfo||!this._appId)return new Te(Y.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},_p("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{Et.reportApiInvoke(this._sessionId,{name:hi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:kr.TRACER}).onSuccess(),this.safeEmit(on.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{Et.reportApiInvoke(this._sessionId,{name:hi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:kr.TRACER}).onSuccess(),this.safeEmit(on.LIVE_STREAMING_WARNING,c,u)},i.on(fL.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Te(Y.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(f,_,v,y){const w=Q("UAP_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(I=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(I+"/api/v1?action=uap"):"https://".concat(I,"/api/v1?action=uap"));return await Yhe(w,f,_,v,y)})(c,this._joinInfo,this._axiosCancelSource.token,pi).then(u).catch(h)}),i};return e===fp.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||n(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||n(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Te(Y.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:n,height:i}},_p("ChannelMediaRelay").create(e));o.on("state",c=>{c===la.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(on.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(on.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,n){const{added:i,deleted:o}=e,c=[];if(n){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(f=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==f.id)&&u.push({uid:h._uintid,stream_id:f.id,ordered:f.ordered,max_retrans_times:f.maxRetransmits,metadata:f.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:f,ordered:_,max_retrans_times:v,metadata:y}=u,w=this._users.find(I=>I._uintid===h);if(!w)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(N.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),Xe(c).call(c,w)||c.push(w),w._uintid||(w._uintid=h),w._dataChannels.findIndex(I=>I.id===u.stream_id)===-1){const I={id:f,ordered:!!_,maxRetransmits:v,metadata:y},P=function(F){return yz(F,!0)}(I);w._dataChannels.push(P),N.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),n||this.safeEmit(on.USER_PUBLISHED,w,"datachannel",I)}this._p2pChannel.hasPendingRemoteDataChannel(w,u.stream_id)&&(N.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,u.stream_id).catch(I=>{N.error("[".concat(this._clientId,"] resubscribe datachannel error"),I.toString())}))}),n&&(this.safeEmit(on.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:f}=u,_=this._users.find(y=>y._uintid===h);if(!_)return void N.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=_._dataChannels.find(y=>y.id===u.stream_id);v&&(N.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[v]).then(y=>{if(_._dataChannels=_._dataChannels.filter(w=>w!==v),y)return this._gateway.unsubscribeDataChannel(y,_.uid)}),N.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(on.USER_UNPUBLISHED,_,"datachannel",v._config))})}_handleRemoveDataChannels(e){const n=this._users.find(i=>i.uid===e.uid);if(n){if(n._dataChannels!==void 0&&n._dataChannels.length>0){N.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished datachannel")),n._dataChannels.forEach(o=>{this.safeEmit(on.USER_UNPUBLISHED,n,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(n,n._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,n.uid)}),i()}}else N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Vi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void N.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();Object.keys(n).forEach(o=>{const{value:c,type:u,expires:h}=n[o];h&&h<=i||u||aL()||!Object.prototype.hasOwnProperty.call(BI,o)||(Bu[o]=c,dr[o]=c,N.debug("Update gateway parameters from config distribute",o,c))})}catch(n){N.error("Error update config from local cache",n.message)}})()}),this._gateway.on(Vi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Vi.CONNECTION_STATE_CHANGE,(e,n,i)=>{var o;if(i===Un.FALLBACK)return;const c=()=>{this.safeEmit(on.CONNECTION_STATE_CHANGE,e,n,i)};if(Et.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:hi.CONNECTION_STATE_CHANGE,options:[e,n,i],tag:kr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:n,reason:i})),N.info("[".concat(this._clientId,"] signal connection state change: ").concat(n," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,f)=>{this._gateway.setStreamFallbackOption(f,h).catch(_=>{N.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,f)=>{this._gateway.setRemoteVideoStreamType(f,h).catch(_=>{N.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{N.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{N.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{N.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,at.AUDIO,!1)),h._trust_video_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,at.VIDEO,!1)),h._trust_audio_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(N.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(Vi.REQUEST_NEW_GATEWAY_LIST,async(e,n)=>{if(!this._joinInfo)return n(new Te(Y.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await uH(Kl(Kl({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,pH(o),this._joinInfo.preload=!0):(i=await PL(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[f,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:f,port:_}):c.push({host:f,port:_})}),e(c)}catch(i){n(i)}}),this._gateway.on(Vi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(on.NETWORK_QUALITY,e)}),this._gateway.on(Vi.STREAM_TYPE_CHANGE,(e,n)=>{this.safeEmit(on.STREAM_TYPE_CHANGED,e,n),Et.reportApiInvoke(this._sessionId,{name:hi.STREAM_TYPE_CHANGE,options:[e,n],tag:kr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:n}))}),this._gateway.on(Vi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Vi.REQUEST_P2P_CONNECTION_PARAMS,async(e,n,i)=>{try{let o=await this._p2pChannel.getEstablishParams();Q("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),n(o)}catch(o){i(o)}}),this._gateway.on(Vi.JOIN_RESPONSE,(e,n)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:N.debug("no attributes in joinResponse");const o=cz(e.ortc,n,i);this._p2pChannel.connect(o)}),this._gateway.on(Vi.PRE_CONNECT_PC,async e=>{const{candidates:n,fingerprint:i}=e;if(this._joinInfo&&n.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=Q("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:n,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(cn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(cn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(cn.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(cn.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(cn.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(cn.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(cn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(cn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(cn.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,at.AUDIO,!0)),this._gateway.signal.on(cn.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,at.AUDIO,!1)),this._gateway.signal.on(cn.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,at.VIDEO,!0)),this._gateway.signal.on(cn.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,at.VIDEO,!1)),this._gateway.signal.on(cn.RECEIVE_METADATA,e=>{const n=Hg(e.metadata);this.safeEmit(on.RECEIVE_METADATA,e.uid,n)}),this._gateway.signal.on(cn.ON_DATA_STREAM,async e=>{var n;if(!e)return;let i=Hg(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Xe(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)){if(e.payload.length<Wv)throw new Te(Y.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Wv));i=await async function(u,h,f){const _=f.subarray(0,Wv),v=_.slice(8,Wv),y=(v[0]<<8)+v[1],w=(_[6]<<8)+_[7],I=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:y6,additionalData:new Uint8Array(a6(y,2))},h,f.subarray(Wv));return new Uint8Array(I).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(f=>f.uid===e.uid),h=c==null?void 0:c.audioRecv.find(f=>f.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),hpe(Kl(Kl({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(cn.ON_CRYPT_ERROR,()=>{zf(()=>{N.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(on.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(cn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{N.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Un.TOKEN_EXPIRE),this.safeEmit(on.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(cn.ON_STREAM_FALLBACK_UPDATE,e=>{N.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(on.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(cn.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),N.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(cn.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(cn.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Lt.REQUEST_TIMEOUT,(e,n)=>{if(this._joinInfo)switch(e){case Dt.PUBLISH:{if(!n)return;const c=n.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:v}=_;return v===Fn.Audio}),h=c.some(_=>{let{stream_type:v}=_;return v!==Fn.Audio}),f=c.some(_=>{let{stream_type:v}=_;return v===Fn.Screen||v===Fn.ScreenLow});n.state==="offer"&&Et.publish(this._joinInfo.sid,{eventElapse:Es.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Y.TIMEOUT,audio:u,video:h,p2pid:n.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:u?(i=c.find(_=>{let{stream_type:v}=_;return v===Fn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:v}=_;return v!==Fn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Dt.SUBSCRIBE:n&&Et.subscribe(this._joinInfo.sid,{succ:!1,ec:Y.TIMEOUT,audio:n.stream_type===at.AUDIO,video:n.stream_type===at.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:this.store.p2pId,eventElapse:Es.measureFromSubscribeStart(this.store.clientId,n.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(n.ssrcId)})}}),this._gateway.signal.on(cn.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(cn.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Q("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!e_(o.string_id||o.stream_id,this.channelName)));const n=[],i=[];for(const o of e.users){let c=this._users.find(y=>y._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Zf(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(on.PUBLISHED_USER_LIST).length===0&&(N.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(on.USER_JOINED,c)));const u=Ai.Audio&o.stream_type,h=(Ai.Video|Ai.LwoVideo)&o.stream_type,f=(65280&o.stream_type)!=0,_=u&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(on.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(on.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(on.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(on.USER_PUBLISHED,c,"video")),(u&&!_||h&&!v||f)&&n.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(N.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{N.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(on.PUBLISHED_USER_LIST).length>0?Q("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=n:(N.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(n.map(o=>o.uid).join(", "))),this.safeEmit(on.PUBLISHED_USER_LIST,n)):N.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(n.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(cn.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:n}=e;this._p2pChannel instanceof V0&&this._p2pChannel.updateRemoteRTPCapabilities(n.map(i=>i.toLowerCase()).filter(i=>{var o;return Xe(o=Object.keys(WI)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(cn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(qr.PUBLISH,(e,n,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:f,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,f);const v=this._users.find(y=>y.uid===o);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,h[0].ssrcId,f).then(()=>{n()}).catch(i):n(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(qr.CALL,async(e,n,i)=>{if(this.store.useP2P)try{var o;n(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(Lt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(qr.UNPUBLISH,async(e,n,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void n();try{o.forEach(async h=>{let{stream_type:f}=h;const _=f===Fn.Audio?at.AUDIO:at.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),n()}catch(h){i(h)}}}),this._gateway.signal.on(qr.CONTROL,async(e,n)=>{const{action:i}=e;switch(i){case qf.MUTE_LOCAL_VIDEO:this._handleMuteStream(n,at.VIDEO,!0);break;case qf.MUTE_LOCAL_AUDIO:this._handleMuteStream(n,at.AUDIO,!0);break;case qf.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",n),this._handleMuteStream(n,at.VIDEO,!1);break;case qf.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",n),this._handleMuteStream(n,at.AUDIO,!1)}}),this._gateway.signal.on(qr.RESTART_ICE,async(e,n,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==co.SEND_ONLY||c?n(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),n())}catch(o){i(o)}}),this._gateway.signal.on(qr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:n,direction:i}=e;this._p2pChannel.addRemoteCandidate(n,i)}}),this._p2pChannel.on(bt.RequestP2PRestartICE,async(e,n,i)=>{try{const{direction:o}=e;n(await this._gateway.sendExtensionMessage(qr.RESTART_ICE,e,o===co.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(bt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(qr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(bt.RequestP2PMuteLocal,async(e,n,i)=>{try{await this._gateway.sendExtensionMessage(qr.CONTROL,e,!0),n()}catch(o){i(o)}}),this._p2pChannel.on(bt.RequestP2PUnmuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(bt.RequestP2PMuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(bt.StateChange,(e,n)=>{n===Vn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(bt.PeerConnectionStateChange,e=>{const n=this._peerConnectionState;e!==n&&(this.safeEmit(on.PEERCONNECTION_STATE_CHANGE,e,n),this._peerConnectionState=e)}),this._p2pChannel.on(bt.RequestMuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(bt.RequestUnmuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(bt.RequestRePublish,(e,n,i)=>{this.publish(e,!1).then(n).catch(i)}),this._p2pChannel.on(bt.RequestRePublishDataChannel,(e,n,i)=>{tt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw u}})).then(n).catch(i)}),this._p2pChannel.on(bt.RequestReSubscribe,async(e,n,i)=>{try{for(const{user:o,kind:c}of e)c===at.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");n()}catch(o){i(o)}}),this._p2pChannel.on(bt.RequestUpload,(e,n)=>{this._gateway.upload(e,n)}),this._p2pChannel.on(bt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(bt.MediaReconnectStart,e=>{this.safeEmit(on.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(bt.MediaReconnectEnd,e=>{this.safeEmit(on.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(bt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(bt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const n=await this._p2pChannel.restartICE(e),i=await n.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void n.throw(h)}const{iceParameters:u}=function(h){const f=h.iceParameters;return{iceParameters:{iceUfrag:f.iceUfrag,icePwd:f.icePwd}}}(c);await n.next({remoteIceParameters:u})}),this._p2pChannel.on(bt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(bt.RequestReconnectPC,async()=>{var e;const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:n,dtlsParameters:i,rtpCapabilities:o}),h=cz(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(bt.RequestUnpublishForReconnectPC,async(e,n,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),n()):i()}),this._p2pChannel.on(bt.P2PLost,()=>{this.safeEmit(on.P2P_LOST,this.store.uid)}),this._p2pChannel.on(bt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(bt.ConnectionTypeChange,e=>{this.safeEmit(on.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(bt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(bt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(bt.AudioMetadata,e=>{this.safeEmit(on.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(n={config:e},_p("ContentInspect").create(n));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:f,cid:_,vid:v}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:f,cid:_,vid:v?Number(v):0},pi)}catch(i){throw Array.isArray(i)?i[0]:i}var n}handleVideoInspectEvents(e){e.on(Fi.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(on.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,i),i===Wl.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(on.CONTENT_INSPECT_ERROR,new Te(Y.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Fi.INSPECT_RESULT,(n,i)=>{var o;if((i==null?void 0:i.code)===Y.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return N.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(on.CONTENT_INSPECT_RESULT,n,i)}),e.on(Fi.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,n){if(up(e,"enabled"),e){if(!n)throw new Te(Y.INVALID_PARAMS,"config is required");if(CH(n),!this._joinInfo)throw new Te(Y.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(n);else{const o=(i={config:n},_p("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:f,uid:_,cid:v,vid:y}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:f,uid:_,cid:v,vid:y?Number(y):0},pi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new Te(Y.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(zu.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(on.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,n,i),n===Zc.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Te(Y.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(zu.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(n){Si(n,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Te(Y.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,N.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return N.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){up(e,"enabled"),Kn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,n){switch(n){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},dt(rt.prototype,"leave",[IH],Object.getOwnPropertyDescriptor(rt.prototype,"leave"),rt.prototype),dt(rt.prototype,"publish",[AH],Object.getOwnPropertyDescriptor(rt.prototype,"publish"),rt.prototype),dt(rt.prototype,"unpublish",[OH],Object.getOwnPropertyDescriptor(rt.prototype,"unpublish"),rt.prototype),dt(rt.prototype,"subscribe",[PH],Object.getOwnPropertyDescriptor(rt.prototype,"subscribe"),rt.prototype),dt(rt.prototype,"presubscribe",[NH],Object.getOwnPropertyDescriptor(rt.prototype,"presubscribe"),rt.prototype),dt(rt.prototype,"massSubscribe",[kH],Object.getOwnPropertyDescriptor(rt.prototype,"massSubscribe"),rt.prototype),dt(rt.prototype,"unsubscribe",[DH],Object.getOwnPropertyDescriptor(rt.prototype,"unsubscribe"),rt.prototype),dt(rt.prototype,"massUnsubscribe",[LH],Object.getOwnPropertyDescriptor(rt.prototype,"massUnsubscribe"),rt.prototype),dt(rt.prototype,"setLowStreamParameter",[xH],Object.getOwnPropertyDescriptor(rt.prototype,"setLowStreamParameter"),rt.prototype),dt(rt.prototype,"enableDualStream",[MH],Object.getOwnPropertyDescriptor(rt.prototype,"enableDualStream"),rt.prototype),dt(rt.prototype,"disableDualStream",[UH],Object.getOwnPropertyDescriptor(rt.prototype,"disableDualStream"),rt.prototype),dt(rt.prototype,"setClientRole",[VH],Object.getOwnPropertyDescriptor(rt.prototype,"setClientRole"),rt.prototype),dt(rt.prototype,"_setClientRoleOptions",[FH],Object.getOwnPropertyDescriptor(rt.prototype,"_setClientRoleOptions"),rt.prototype),dt(rt.prototype,"setProxyServer",[jH],Object.getOwnPropertyDescriptor(rt.prototype,"setProxyServer"),rt.prototype),dt(rt.prototype,"setTurnServer",[BH],Object.getOwnPropertyDescriptor(rt.prototype,"setTurnServer"),rt.prototype),dt(rt.prototype,"setLicense",[WH],Object.getOwnPropertyDescriptor(rt.prototype,"setLicense"),rt.prototype),dt(rt.prototype,"startProxyServer",[GH],Object.getOwnPropertyDescriptor(rt.prototype,"startProxyServer"),rt.prototype),dt(rt.prototype,"stopProxyServer",[zH],Object.getOwnPropertyDescriptor(rt.prototype,"stopProxyServer"),rt.prototype),dt(rt.prototype,"setLocalAccessPointsV2",[HH],Object.getOwnPropertyDescriptor(rt.prototype,"setLocalAccessPointsV2"),rt.prototype),dt(rt.prototype,"setLocalAccessPoints",[KH],Object.getOwnPropertyDescriptor(rt.prototype,"setLocalAccessPoints"),rt.prototype),dt(rt.prototype,"setRemoteDefaultVideoStreamType",[$H],Object.getOwnPropertyDescriptor(rt.prototype,"setRemoteDefaultVideoStreamType"),rt.prototype),dt(rt.prototype,"setRemoteVideoStreamType",[qH],Object.getOwnPropertyDescriptor(rt.prototype,"setRemoteVideoStreamType"),rt.prototype),dt(rt.prototype,"setStreamFallbackOption",[YH],Object.getOwnPropertyDescriptor(rt.prototype,"setStreamFallbackOption"),rt.prototype),dt(rt.prototype,"setEncryptionConfig",[XH],Object.getOwnPropertyDescriptor(rt.prototype,"setEncryptionConfig"),rt.prototype),dt(rt.prototype,"renewToken",[JH],Object.getOwnPropertyDescriptor(rt.prototype,"renewToken"),rt.prototype),dt(rt.prototype,"enableAudioVolumeIndicator",[QH],Object.getOwnPropertyDescriptor(rt.prototype,"enableAudioVolumeIndicator"),rt.prototype),dt(rt.prototype,"startLiveStreaming",[ZH],Object.getOwnPropertyDescriptor(rt.prototype,"startLiveStreaming"),rt.prototype),dt(rt.prototype,"setLiveTranscoding",[e8],Object.getOwnPropertyDescriptor(rt.prototype,"setLiveTranscoding"),rt.prototype),dt(rt.prototype,"stopLiveStreaming",[t8],Object.getOwnPropertyDescriptor(rt.prototype,"stopLiveStreaming"),rt.prototype),dt(rt.prototype,"startChannelMediaRelay",[n8],Object.getOwnPropertyDescriptor(rt.prototype,"startChannelMediaRelay"),rt.prototype),dt(rt.prototype,"updateChannelMediaRelay",[r8],Object.getOwnPropertyDescriptor(rt.prototype,"updateChannelMediaRelay"),rt.prototype),dt(rt.prototype,"stopChannelMediaRelay",[i8],Object.getOwnPropertyDescriptor(rt.prototype,"stopChannelMediaRelay"),rt.prototype),dt(rt.prototype,"sendCustomReportMessage",[s8],Object.getOwnPropertyDescriptor(rt.prototype,"sendCustomReportMessage"),rt.prototype),dt(rt.prototype,"pickSVCLayer",[o8],Object.getOwnPropertyDescriptor(rt.prototype,"pickSVCLayer"),rt.prototype),dt(rt.prototype,"setRTMConfig",[a8],Object.getOwnPropertyDescriptor(rt.prototype,"setRTMConfig"),rt.prototype),dt(rt.prototype,"enableContentInspect",[c8],Object.getOwnPropertyDescriptor(rt.prototype,"enableContentInspect"),rt.prototype),dt(rt.prototype,"disableContentInspect",[l8],Object.getOwnPropertyDescriptor(rt.prototype,"disableContentInspect"),rt.prototype),dt(rt.prototype,"setImageModeration",[u8],Object.getOwnPropertyDescriptor(rt.prototype,"setImageModeration"),rt.prototype),dt(rt.prototype,"setP2PTransport",[d8],Object.getOwnPropertyDescriptor(rt.prototype,"setP2PTransport"),rt.prototype),dt(rt.prototype,"getJoinChannelServiceRecords",[h8],Object.getOwnPropertyDescriptor(rt.prototype,"getJoinChannelServiceRecords"),rt.prototype),dt(rt.prototype,"setPublishAudioFilterEnabled",[p8],Object.getOwnPropertyDescriptor(rt.prototype,"setPublishAudioFilterEnabled"),rt.prototype),rt);class B0{constructor(n,i){z(this,"id",0),z(this,"element",void 0),z(this,"peerPair",void 0),z(this,"context",void 0),z(this,"audioPlayerElement",void 0),z(this,"audioTrack",void 0),B0.count+=1,this.id=B0.count,this.element=n,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const i=document.createElement("audio");i.srcObject=new MediaStream([n.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const n=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new tt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await n(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await n(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new Te(Y.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(n){if(this.audioTrack)return this.audioTrack;let i;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(n).connect(i)}catch(c){throw new Te(Y.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new Te(Y.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const n=this.element,i=await this.getTracksFromMediaElement(n);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){N.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var m8,LA;z(B0,"count",0);const Ope=window.AudioContext||window.webkitAudioContext,Ppe=new(m8=At({report:Et}),dt((LA=class{constructor(){z(this,"units",[]),z(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return N.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ope);let n=this.units.find(i=>i&&i.getElement()===e);return n||(n=new B0(e,this.context),this.units.push(n)),n.startEchoCancellation(),N.debug("start processing local audio echo cancellation, id is",n.id),n.id}_doesEnvironmentNeedAEC(){return vn().name!==Dn.SAFARI}}).prototype,"processExternalMediaAEC",[m8],Object.getOwnPropertyDescriptor(LA.prototype,"processExternalMediaAEC"),LA.prototype),LA);function g8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _8(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?g8(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const KL=window||document;function E8(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!KL)return;const i=fi._cspEventHandlerPointer;if(i&&n)return void console.error(i,n);const o=c=>{if(!(c&&c.blockedURI&&(fi.onSecurityPolicyViolation||fi.getListeners(Bd.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;Q("CSP_DETECTED_HOSTNAME_LIST").some(h=>Xe(u).call(u,h))&&(fi.onSecurityPolicyViolation&&typeof fi.onSecurityPolicyViolation=="function"&&fi.onSecurityPolicyViolation(c),fi.getListeners(Bd.SECURITY_POLICY_VIOLATION).length>0&&fi.safeEmit(Bd.SECURITY_POLICY_VIOLATION,c))};i&&KL.removeEventListener("securitypolicyviolation",i),(n||e&&typeof e=="function"||fi.getListeners(Bd.SECURITY_POLICY_VIOLATION).length>0)&&KL.addEventListener("securitypolicyviolation",o),fi._cspEventHandlerPointer=o}var Npe=k,kpe=t5,v8=RegExp.prototype,Dpe=function(e){return e===v8||Npe(v8,e)?kpe(e):e.flags},Gs=l(Dpe);function my(e){let n=e.length;for(;--n>=0;)e[n]=0}const $L=256,y8=286,W0=30,G0=15,qL=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),xA=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Lpe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S8=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yp=new Array(576);my(yp);const z0=new Array(60);my(z0);const H0=new Array(512);my(H0);const K0=new Array(256);my(K0);const YL=new Array(29);my(YL);const MA=new Array(W0);function XL(e,n,i,o,c){this.static_tree=e,this.extra_bits=n,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let T8,b8,w8;function JL(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}my(MA);const R8=e=>e<256?H0[e]:H0[256+(e>>>7)],$0=(e,n)=>{e.pending_buf[e.pending++]=255&n,e.pending_buf[e.pending++]=n>>>8&255},Tc=(e,n,i)=>{e.bi_valid>16-i?(e.bi_buf|=n<<e.bi_valid&65535,$0(e,e.bi_buf),e.bi_buf=n>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=i)},Kd=(e,n,i)=>{Tc(e,i[2*n],i[2*n+1])},C8=(e,n)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--n>0);return i>>>1},I8=(e,n,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=G0;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=n;u++){let f=e[2*u+1];f!==0&&(e[2*u]=C8(o[f]++,f))}},A8=e=>{let n;for(n=0;n<y8;n++)e.dyn_ltree[2*n]=0;for(n=0;n<W0;n++)e.dyn_dtree[2*n]=0;for(n=0;n<19;n++)e.bl_tree[2*n]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},O8=e=>{e.bi_valid>8?$0(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},P8=(e,n,i,o)=>{const c=2*n,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[n]<=o[i]},QL=(e,n,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&P8(n,e.heap[c+1],e.heap[c],e.depth)&&c++,!P8(n,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},N8=(e,n,i)=>{let o,c,u,h,f=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+f++],o+=(255&e.pending_buf[e.sym_buf+f++])<<8,c=e.pending_buf[e.sym_buf+f++],o===0?Kd(e,c,n):(u=K0[c],Kd(e,u+$L+1,n),h=qL[u],h!==0&&(c-=YL[u],Tc(e,c,h)),o--,u=R8(o),Kd(e,u,i),h=xA[u],h!==0&&(o-=MA[u],Tc(e,o,h)));while(f<e.sym_next);Kd(e,256,n)},ZL=(e,n)=>{const i=n.dyn_tree,o=n.stat_desc.static_tree,c=n.stat_desc.has_stree,u=n.stat_desc.elems;let h,f,_,v=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=v=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=v<2?++v:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(n.max_code=v,h=e.heap_len>>1;h>=1;h--)QL(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],QL(e,i,1),f=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=f,i[2*_]=i[2*h]+i[2*f],e.depth[_]=(e.depth[h]>=e.depth[f]?e.depth[h]:e.depth[f])+1,i[2*h+1]=i[2*f+1]=_,e.heap[1]=_++,QL(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((y,w)=>{const I=w.dyn_tree,P=w.max_code,F=w.stat_desc.static_tree,x=w.stat_desc.has_stree,M=w.stat_desc.extra_bits,$=w.stat_desc.extra_base,q=w.stat_desc.max_length;let ae,me,ge,pe,we,Be,nt=0;for(pe=0;pe<=G0;pe++)y.bl_count[pe]=0;for(I[2*y.heap[y.heap_max]+1]=0,ae=y.heap_max+1;ae<573;ae++)me=y.heap[ae],pe=I[2*I[2*me+1]+1]+1,pe>q&&(pe=q,nt++),I[2*me+1]=pe,me>P||(y.bl_count[pe]++,we=0,me>=$&&(we=M[me-$]),Be=I[2*me],y.opt_len+=Be*(pe+we),x&&(y.static_len+=Be*(F[2*me+1]+we)));if(nt!==0){do{for(pe=q-1;y.bl_count[pe]===0;)pe--;y.bl_count[pe]--,y.bl_count[pe+1]+=2,y.bl_count[q]--,nt-=2}while(nt>0);for(pe=q;pe!==0;pe--)for(me=y.bl_count[pe];me!==0;)ge=y.heap[--ae],ge>P||(I[2*ge+1]!==pe&&(y.opt_len+=(pe-I[2*ge+1])*I[2*ge],I[2*ge+1]=pe),me--)}})(e,n),I8(i,v,e.bl_count)},k8=(e,n,i)=>{let o,c,u=-1,h=n[1],f=0,_=7,v=4;for(h===0&&(_=138,v=3),n[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=n[2*(o+1)+1],++f<_&&c===h||(f<v?e.bl_tree[2*c]+=f:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):f<=10?e.bl_tree[34]++:e.bl_tree[36]++,f=0,u=c,h===0?(_=138,v=3):c===h?(_=6,v=3):(_=7,v=4))},D8=(e,n,i)=>{let o,c,u=-1,h=n[1],f=0,_=7,v=4;for(h===0&&(_=138,v=3),o=0;o<=i;o++)if(c=h,h=n[2*(o+1)+1],!(++f<_&&c===h)){if(f<v)do Kd(e,c,e.bl_tree);while(--f!=0);else c!==0?(c!==u&&(Kd(e,c,e.bl_tree),f--),Kd(e,16,e.bl_tree),Tc(e,f-3,2)):f<=10?(Kd(e,17,e.bl_tree),Tc(e,f-3,3)):(Kd(e,18,e.bl_tree),Tc(e,f-11,7));f=0,u=c,h===0?(_=138,v=3):c===h?(_=6,v=3):(_=7,v=4)}};let L8=!1;const x8=(e,n,i,o)=>{Tc(e,0+(o?1:0),3),O8(e),$0(e,i),$0(e,~i),i&&e.pending_buf.set(e.window.subarray(n,n+i),e.pending),e.pending+=i};var xpe=e=>{L8||((()=>{let n,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(YL[c]=o,n=0;n<1<<qL[c];n++)K0[o++]=c;for(K0[o-1]=c,u=0,c=0;c<16;c++)for(MA[c]=u,n=0;n<1<<xA[c];n++)H0[u++]=c;for(u>>=7;c<W0;c++)for(MA[c]=u<<7,n=0;n<1<<xA[c]-7;n++)H0[256+u++]=c;for(i=0;i<=G0;i++)h[i]=0;for(n=0;n<=143;)yp[2*n+1]=8,n++,h[8]++;for(;n<=255;)yp[2*n+1]=9,n++,h[9]++;for(;n<=279;)yp[2*n+1]=7,n++,h[7]++;for(;n<=287;)yp[2*n+1]=8,n++,h[8]++;for(I8(yp,287,h),n=0;n<W0;n++)z0[2*n+1]=5,z0[2*n]=C8(n,5);T8=new XL(yp,qL,257,y8,G0),b8=new XL(z0,xA,0,W0,G0),w8=new XL(new Array(0),Lpe,0,19,7)})(),L8=!0),e.l_desc=new JL(e.dyn_ltree,T8),e.d_desc=new JL(e.dyn_dtree,b8),e.bl_desc=new JL(e.bl_tree,w8),e.bi_buf=0,e.bi_valid=0,A8(e)},Mpe=(e,n,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(f=>{let _,v=4093624447;for(_=0;_<=31;_++,v>>>=1)if(1&v&&f.dyn_ltree[2*_]!==0)return 0;if(f.dyn_ltree[18]!==0||f.dyn_ltree[20]!==0||f.dyn_ltree[26]!==0)return 1;for(_=32;_<$L;_++)if(f.dyn_ltree[2*_]!==0)return 1;return 0})(e)),ZL(e,e.l_desc),ZL(e,e.d_desc),h=(f=>{let _;for(k8(f,f.dyn_ltree,f.l_desc.max_code),k8(f,f.dyn_dtree,f.d_desc.max_code),ZL(f,f.bl_desc),_=18;_>=3&&f.bl_tree[2*S8[_]+1]===0;_--);return f.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&n!==-1?x8(e,n,i,o):e.strategy===4||u===c?(Tc(e,2+(o?1:0),3),N8(e,yp,z0)):(Tc(e,4+(o?1:0),3),((f,_,v,y)=>{let w;for(Tc(f,_-257,5),Tc(f,v-1,5),Tc(f,y-4,4),w=0;w<y;w++)Tc(f,f.bl_tree[2*S8[w]+1],3);D8(f,f.dyn_ltree,_-1),D8(f,f.dyn_dtree,v-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),N8(e,e.dyn_ltree,e.dyn_dtree)),A8(e),o&&O8(e)},Upe=(e,n,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=n,e.pending_buf[e.sym_buf+e.sym_next++]=n>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,n===0?e.dyn_ltree[2*i]++:(e.matches++,n--,e.dyn_ltree[2*(K0[i]+$L+1)]++,e.dyn_dtree[2*R8(n)]++),e.sym_next===e.sym_end),Vpe=e=>{Tc(e,2,3),Kd(e,256,yp),(n=>{n.bi_valid===16?($0(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(e)},Fpe={_tr_init:xpe,_tr_stored_block:x8,_tr_flush_block:Mpe,_tr_tally:Upe,_tr_align:Vpe},q0=(e,n,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+n[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const jpe=new Uint32Array((()=>{let e,n=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;n[i]=e}return n})());var uo=(e,n,i,o)=>{const c=jpe,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^n[h])];return-1^e},l_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},UA={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Bpe,_tr_stored_block:ex,_tr_flush_block:Wpe,_tr_tally:rm,_tr_align:Gpe}=Fpe,{Z_NO_FLUSH:im,Z_PARTIAL_FLUSH:zpe,Z_FULL_FLUSH:Hpe,Z_FINISH:$l,Z_BLOCK:M8,Z_OK:Vo,Z_STREAM_END:U8,Z_STREAM_ERROR:$d,Z_DATA_ERROR:Kpe,Z_BUF_ERROR:tx,Z_DEFAULT_COMPRESSION:$pe,Z_FILTERED:qpe,Z_HUFFMAN_ONLY:VA,Z_RLE:Ype,Z_FIXED:Xpe,Z_DEFAULT_STRATEGY:Jpe,Z_UNKNOWN:Qpe,Z_DEFLATED:FA}=UA,nx=286,Zpe=30,efe=19,tfe=2*nx+1,nfe=15,u_=258,qd=262,gy=42,d_=113,Y0=666,h_=(e,n)=>(e.msg=l_[n],n),V8=e=>2*e-(e>4?9:0),sm=e=>{let n=e.length;for(;--n>=0;)e[n]=0},rfe=e=>{let n,i,o,c=e.w_size;n=e.hash_size,o=n;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--n);n=c,o=n;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--n)};let om=(e,n,i)=>(n<<e.hash_shift^i)&e.hash_mask;const tl=e=>{const n=e.state;let i=n.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),e.next_out),e.next_out+=i,n.pending_out+=i,e.total_out+=i,e.avail_out-=i,n.pending-=i,n.pending===0&&(n.pending_out=0))},nl=(e,n)=>{Wpe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,tl(e.strm)},Br=(e,n)=>{e.pending_buf[e.pending++]=n},X0=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=255&n},rx=(e,n,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,n.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=q0(e.adler,n,c,i):e.state.wrap===2&&(e.adler=uo(e.adler,n,c,i)),e.next_in+=c,e.total_in+=c,c)},F8=(e,n)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,f=e.nice_match;const _=e.strstart>e.w_size-qd?e.strstart-(e.w_size-qd):0,v=e.window,y=e.w_mask,w=e.prev,I=e.strstart+u_;let P=v[u+h-1],F=v[u+h];e.prev_length>=e.good_match&&(c>>=2),f>e.lookahead&&(f=e.lookahead);do if(i=n,v[i+h]===F&&v[i+h-1]===P&&v[i]===v[u]&&v[++i]===v[u+1]){u+=2,i++;do;while(v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&u<I);if(o=u_-(I-u),u=I-u_,o>h){if(e.match_start=n,h=o,o>=f)break;P=v[u+h-1],F=v[u+h]}}while((n=w[n&y])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},_y=e=>{const n=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-qd)&&(e.window.set(e.window.subarray(n,n+n-o),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),rfe(e),o+=n),e.strm.avail_in===0)break;if(i=rx(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=om(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=om(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<qd&&e.strm.avail_in!==0)},j8=(e,n)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,f=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&n!==$l||n===im||i!==o+e.strm.avail_in)))break;h=n===$l&&i===o+e.strm.avail_in?1:0,ex(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,tl(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(rx(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return f-=e.strm.avail_in,f&&(f>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=f&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-f,e.strm.next_in),e.strstart),e.strstart+=f,e.insert+=f>e.w_size-e.insert?e.w_size-e.insert:f),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:n!==im&&n!==$l&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(rx(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||n===$l)&&n!==im&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=n===$l&&e.strm.avail_in===0&&i===o?1:0,ex(e,e.block_start,i,h),e.block_start+=i,tl(e.strm)),h?3:1)},ix=(e,n)=>{let i,o;for(;;){if(e.lookahead<qd){if(_y(e),e.lookahead<qd&&n===im)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=om(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-qd&&(e.match_length=F8(e,i)),e.match_length>=3)if(o=rm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=om(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=om(e,e.ins_h,e.window[e.strstart+1]);else o=rm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(nl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,n===$l?(nl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(nl(e,!1),e.strm.avail_out===0)?1:2},Ey=(e,n)=>{let i,o,c;for(;;){if(e.lookahead<qd){if(_y(e),e.lookahead<qd&&n===im)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=om(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-qd&&(e.match_length=F8(e,i),e.match_length<=5&&(e.strategy===qpe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=rm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=om(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(nl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=rm(e,0,e.window[e.strstart-1]),o&&nl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=rm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,n===$l?(nl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(nl(e,!1),e.strm.avail_out===0)?1:2};function Yd(e,n,i,o,c){this.good_length=e,this.max_lazy=n,this.nice_length=i,this.max_chain=o,this.func=c}const J0=[new Yd(0,0,0,0,j8),new Yd(4,4,8,4,ix),new Yd(4,5,16,8,ix),new Yd(4,6,32,32,ix),new Yd(4,4,16,16,Ey),new Yd(8,16,32,32,Ey),new Yd(8,16,128,128,Ey),new Yd(8,32,128,256,Ey),new Yd(32,128,258,1024,Ey),new Yd(32,258,258,4096,Ey)];function ife(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=FA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*tfe),this.dyn_dtree=new Uint16Array(2*(2*Zpe+1)),this.bl_tree=new Uint16Array(2*(2*efe+1)),sm(this.dyn_ltree),sm(this.dyn_dtree),sm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(nfe+1),this.heap=new Uint16Array(2*nx+1),sm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*nx+1),sm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Q0=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.status!==gy&&n.status!==57&&n.status!==69&&n.status!==73&&n.status!==91&&n.status!==103&&n.status!==d_&&n.status!==Y0?1:0},B8=e=>{if(Q0(e))return h_(e,$d);e.total_in=e.total_out=0,e.data_type=Qpe;const n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?57:n.wrap?gy:d_,e.adler=n.wrap===2?0:1,n.last_flush=-2,Bpe(n),Vo},W8=e=>{const n=B8(e);return n===Vo&&(i=>{i.window_size=2*i.w_size,sm(i.head),i.max_lazy_match=J0[i.level].max_lazy,i.good_match=J0[i.level].good_length,i.nice_match=J0[i.level].nice_length,i.max_chain_length=J0[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),n},G8=(e,n,i,o,c,u)=>{if(!e)return $d;let h=1;if(n===$pe&&(n=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==FA||o<8||o>15||n<0||n>9||u<0||u>Xpe||o===8&&h!==1)return h_(e,$d);o===8&&(o=9);const f=new ife;return e.state=f,f.strm=e,f.status=gy,f.wrap=h,f.gzhead=null,f.w_bits=o,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=c+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<c+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=n,f.strategy=u,f.method=i,W8(e)};var sfe=(e,n)=>{if(Q0(e)||n>M8||n<0)return e?h_(e,$d):$d;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===Y0&&n!==$l)return h_(e,e.avail_out===0?tx:$d);const o=i.last_flush;if(i.last_flush=n,i.pending!==0){if(tl(e),e.avail_out===0)return i.last_flush=-1,Vo}else if(e.avail_in===0&&V8(n)<=V8(o)&&n!==$l)return h_(e,tx);if(i.status===Y0&&e.avail_in!==0)return h_(e,tx);if(i.status===gy&&i.wrap===0&&(i.status=d_),i.status===gy){let c=FA+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=VA||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,X0(i,c),i.strstart!==0&&(X0(i,e.adler>>>16),X0(i,65535&e.adler)),e.adler=1,i.status=d_,tl(e),i.pending!==0)return i.last_flush=-1,Vo}if(i.status===57){if(e.adler=0,Br(i,31),Br(i,139),Br(i,8),i.gzhead)Br(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Br(i,255&i.gzhead.time),Br(i,i.gzhead.time>>8&255),Br(i,i.gzhead.time>>16&255),Br(i,i.gzhead.time>>24&255),Br(i,i.level===9?2:i.strategy>=VA||i.level<2?4:0),Br(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Br(i,255&i.gzhead.extra.length),Br(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=uo(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Br(i,0),Br(i,0),Br(i,0),Br(i,0),Br(i,0),Br(i,i.level===9?2:i.strategy>=VA||i.level<2?4:0),Br(i,3),i.status=d_,tl(e),i.pending!==0)return i.last_flush=-1,Vo}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let f=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+f),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=uo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=f,tl(e),i.pending!==0)return i.last_flush=-1,Vo;c=0,u-=f}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=uo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=uo(e.adler,i.pending_buf,i.pending-u,u)),tl(e),i.pending!==0)return i.last_flush=-1,Vo;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Br(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=uo(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=uo(e.adler,i.pending_buf,i.pending-u,u)),tl(e),i.pending!==0)return i.last_flush=-1,Vo;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Br(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=uo(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(tl(e),i.pending!==0))return i.last_flush=-1,Vo;Br(i,255&e.adler),Br(i,e.adler>>8&255),e.adler=0}if(i.status=d_,tl(e),i.pending!==0)return i.last_flush=-1,Vo}if(e.avail_in!==0||i.lookahead!==0||n!==im&&i.status!==Y0){let c=i.level===0?j8(i,n):i.strategy===VA?((u,h)=>{let f;for(;;){if(u.lookahead===0&&(_y(u),u.lookahead===0)){if(h===im)return 1;break}if(u.match_length=0,f=rm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,f&&(nl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===$l?(nl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(nl(u,!1),u.strm.avail_out===0)?1:2})(i,n):i.strategy===Ype?((u,h)=>{let f,_,v,y;const w=u.window;for(;;){if(u.lookahead<=u_){if(_y(u),u.lookahead<=u_&&h===im)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,_=w[v],_===w[++v]&&_===w[++v]&&_===w[++v])){y=u.strstart+u_;do;while(_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&_===w[++v]&&v<y);u.match_length=u_-(y-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(f=rm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(f=rm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),f&&(nl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===$l?(nl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(nl(u,!1),u.strm.avail_out===0)?1:2})(i,n):J0[i.level].func(i,n);if(c!==3&&c!==4||(i.status=Y0),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),Vo;if(c===2&&(n===zpe?Gpe(i):n!==M8&&(ex(i,0,0,!1),n===Hpe&&(sm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),tl(e),e.avail_out===0))return i.last_flush=-1,Vo}return n!==$l?Vo:i.wrap<=0?U8:(i.wrap===2?(Br(i,255&e.adler),Br(i,e.adler>>8&255),Br(i,e.adler>>16&255),Br(i,e.adler>>24&255),Br(i,255&e.total_in),Br(i,e.total_in>>8&255),Br(i,e.total_in>>16&255),Br(i,e.total_in>>24&255)):(X0(i,e.adler>>>16),X0(i,65535&e.adler)),tl(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Vo:U8)},ofe=(e,n)=>{let i=n.length;if(Q0(e))return $d;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==gy||o.lookahead)return $d;if(c===1&&(e.adler=q0(e.adler,n,i,0)),o.wrap=0,i>=o.w_size){c===0&&(sm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(n.subarray(i-o.w_size,i),0),n=_,i=o.w_size}const u=e.avail_in,h=e.next_in,f=e.input;for(e.avail_in=i,e.next_in=0,e.input=n,_y(o);o.lookahead>=3;){let _=o.strstart,v=o.lookahead-2;do o.ins_h=om(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--v);o.strstart=_,o.lookahead=2,_y(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=f,e.avail_in=u,o.wrap=c,Vo},Z0={deflateInit:(e,n)=>G8(e,n,FA,15,8,Jpe),deflateInit2:G8,deflateReset:W8,deflateResetKeep:B8,deflateSetHeader:(e,n)=>Q0(e)||e.state.wrap!==2?$d:(e.state.gzhead=n,Vo),deflate:sfe,deflateEnd:e=>{if(Q0(e))return $d;const n=e.state.status;return e.state=null,n===d_?h_(e,Kpe):Vo},deflateSetDictionary:ofe,deflateInfo:"pako deflate (from Nodeca project)"};const afe=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var jA={assign:function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)afe(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let n=0;for(let o=0,c=e.length;o<c;o++)n+=e[o].length;const i=new Uint8Array(n);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let z8=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{z8=!1}const eb=new Uint8Array(256);for(let e=0;e<256;e++)eb[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;eb[254]=eb[254]=1;var tb={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,i,o,c,u,h=e.length,f=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(f),u=0,c=0;u<f;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?n[u++]=i:i<2048?(n[u++]=192|i>>>6,n[u++]=128|63&i):i<65536?(n[u++]=224|i>>>12,n[u++]=128|i>>>6&63,n[u++]=128|63&i):(n[u++]=240|i>>>18,n[u++]=128|i>>>12&63,n[u++]=128|i>>>6&63,n[u++]=128|63&i);return n},buf2string:(e,n)=>{const i=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let f=eb[h];if(f>4)u[c++]=65533,o+=f-1;else{for(h&=f===2?31:f===3?15:7;f>1&&o<i;)h=h<<6|63&e[o++],f--;f>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,f)=>{if(f<65534&&h.subarray&&z8)return String.fromCharCode.apply(null,h.length===f?h:h.subarray(0,f));let _="";for(let v=0;v<f;v++)_+=String.fromCharCode(h[v]);return _})(u,c)},utf8border:(e,n)=>{(n=n||e.length)>e.length&&(n=e.length);let i=n-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?n:i+eb[e[i]]>n?i:n}},H8=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const K8=Object.prototype.toString,{Z_NO_FLUSH:cfe,Z_SYNC_FLUSH:lfe,Z_FULL_FLUSH:ufe,Z_FINISH:dfe,Z_OK:BA,Z_STREAM_END:hfe,Z_DEFAULT_COMPRESSION:pfe,Z_DEFAULT_STRATEGY:ffe,Z_DEFLATED:mfe}=UA;function WA(e){this.options=jA.assign({level:pfe,method:mfe,chunkSize:16384,windowBits:15,memLevel:8,strategy:ffe},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H8,this.strm.avail_out=0;let i=Z0.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==BA)throw new Error(l_[i]);if(n.header&&Z0.deflateSetHeader(this.strm,n.header),n.dictionary){let o;if(o=typeof n.dictionary=="string"?tb.string2buf(n.dictionary):K8.call(n.dictionary)==="[object ArrayBuffer]"?new Uint8Array(n.dictionary):n.dictionary,i=Z0.deflateSetDictionary(this.strm,o),i!==BA)throw new Error(l_[i]);this._dict_set=!0}}function gfe(e,n){const i=new WA(n);if(i.push(e,!0),i.err)throw i.msg||l_[i.err];return i.result}WA.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=n===~~n?n:n===!0?dfe:cfe,typeof e=="string"?i.input=tb.string2buf(e):K8.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===lfe||u===ufe)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=Z0.deflate(i,u),c===hfe)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=Z0.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===BA;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},WA.prototype.onData=function(e){this.chunks.push(e)},WA.prototype.onEnd=function(e){e===BA&&(this.result=jA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var _fe={deflate:gfe};const GA=16209;var Efe=function(e,n){let i,o,c,u,h,f,_,v,y,w,I,P,F,x,M,$,q,ae,me,ge,pe,we,Be,nt;const st=e.state;i=e.next_in,Be=e.input,o=i+(e.avail_in-5),c=e.next_out,nt=e.output,u=c-(n-e.avail_out),h=c+(e.avail_out-257),f=st.dmax,_=st.wsize,v=st.whave,y=st.wnext,w=st.window,I=st.hold,P=st.bits,F=st.lencode,x=st.distcode,M=(1<<st.lenbits)-1,$=(1<<st.distbits)-1;e:do{P<15&&(I+=Be[i++]<<P,P+=8,I+=Be[i++]<<P,P+=8),q=F[I&M];t:for(;;){if(ae=q>>>24,I>>>=ae,P-=ae,ae=q>>>16&255,ae===0)nt[c++]=65535&q;else{if(!(16&ae)){if((64&ae)==0){q=F[(65535&q)+(I&(1<<ae)-1)];continue t}if(32&ae){st.mode=16191;break e}e.msg="invalid literal/length code",st.mode=GA;break e}me=65535&q,ae&=15,ae&&(P<ae&&(I+=Be[i++]<<P,P+=8),me+=I&(1<<ae)-1,I>>>=ae,P-=ae),P<15&&(I+=Be[i++]<<P,P+=8,I+=Be[i++]<<P,P+=8),q=x[I&$];n:for(;;){if(ae=q>>>24,I>>>=ae,P-=ae,ae=q>>>16&255,!(16&ae)){if((64&ae)==0){q=x[(65535&q)+(I&(1<<ae)-1)];continue n}e.msg="invalid distance code",st.mode=GA;break e}if(ge=65535&q,ae&=15,P<ae&&(I+=Be[i++]<<P,P+=8,P<ae&&(I+=Be[i++]<<P,P+=8)),ge+=I&(1<<ae)-1,ge>f){e.msg="invalid distance too far back",st.mode=GA;break e}if(I>>>=ae,P-=ae,ae=c-u,ge>ae){if(ae=ge-ae,ae>v&&st.sane){e.msg="invalid distance too far back",st.mode=GA;break e}if(pe=0,we=w,y===0){if(pe+=_-ae,ae<me){me-=ae;do nt[c++]=w[pe++];while(--ae);pe=c-ge,we=nt}}else if(y<ae){if(pe+=_+y-ae,ae-=y,ae<me){me-=ae;do nt[c++]=w[pe++];while(--ae);if(pe=0,y<me){ae=y,me-=ae;do nt[c++]=w[pe++];while(--ae);pe=c-ge,we=nt}}}else if(pe+=y-ae,ae<me){me-=ae;do nt[c++]=w[pe++];while(--ae);pe=c-ge,we=nt}for(;me>2;)nt[c++]=we[pe++],nt[c++]=we[pe++],nt[c++]=we[pe++],me-=3;me&&(nt[c++]=we[pe++],me>1&&(nt[c++]=we[pe++]))}else{pe=c-ge;do nt[c++]=nt[pe++],nt[c++]=nt[pe++],nt[c++]=nt[pe++],me-=3;while(me>2);me&&(nt[c++]=nt[pe++],me>1&&(nt[c++]=nt[pe++]))}break}}break}}while(i<o&&c<h);me=P>>3,i-=me,P-=me<<3,I&=(1<<P)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),st.hold=I,st.bits=P};const zA=15,vfe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),yfe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Sfe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Tfe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var nb=(e,n,i,o,c,u,h,f)=>{const _=f.bits;let v,y,w,I,P,F,x=0,M=0,$=0,q=0,ae=0,me=0,ge=0,pe=0,we=0,Be=0,nt=null;const st=new Uint16Array(16),dn=new Uint16Array(16);let hn,ir,Yr,Vr=null;for(x=0;x<=zA;x++)st[x]=0;for(M=0;M<o;M++)st[n[i+M]]++;for(ae=_,q=zA;q>=1&&st[q]===0;q--);if(ae>q&&(ae=q),q===0)return c[u++]=20971520,c[u++]=20971520,f.bits=1,0;for($=1;$<q&&st[$]===0;$++);for(ae<$&&(ae=$),pe=1,x=1;x<=zA;x++)if(pe<<=1,pe-=st[x],pe<0)return-1;if(pe>0&&(e===0||q!==1))return-1;for(dn[1]=0,x=1;x<zA;x++)dn[x+1]=dn[x]+st[x];for(M=0;M<o;M++)n[i+M]!==0&&(h[dn[n[i+M]]++]=M);if(e===0?(nt=Vr=h,F=20):e===1?(nt=vfe,Vr=yfe,F=257):(nt=Sfe,Vr=Tfe,F=0),Be=0,M=0,x=$,P=u,me=ae,ge=0,w=-1,we=1<<ae,I=we-1,e===1&&we>852||e===2&&we>592)return 1;for(;;){hn=x-ge,h[M]+1<F?(ir=0,Yr=h[M]):h[M]>=F?(ir=Vr[h[M]-F],Yr=nt[h[M]-F]):(ir=96,Yr=0),v=1<<x-ge,y=1<<me,$=y;do y-=v,c[P+(Be>>ge)+y]=hn<<24|ir<<16|Yr|0;while(y!==0);for(v=1<<x-1;Be&v;)v>>=1;if(v!==0?(Be&=v-1,Be+=v):Be=0,M++,--st[x]==0){if(x===q)break;x=n[i+h[M]]}if(x>ae&&(Be&I)!==w){for(ge===0&&(ge=ae),P+=$,me=x-ge,pe=1<<me;me+ge<q&&(pe-=st[me+ge],!(pe<=0));)me++,pe<<=1;if(we+=1<<me,e===1&&we>852||e===2&&we>592)return 1;w=Be&I,c[w]=ae<<24|me<<16|P-u|0}}return Be!==0&&(c[P+Be]=x-ge<<24|64<<16|0),f.bits=ae,0};const{Z_FINISH:$8,Z_BLOCK:bfe,Z_TREES:HA,Z_OK:p_,Z_STREAM_END:wfe,Z_NEED_DICT:Rfe,Z_STREAM_ERROR:ql,Z_DATA_ERROR:q8,Z_MEM_ERROR:Y8,Z_BUF_ERROR:Cfe,Z_DEFLATED:X8}=UA,KA=16180,$A=16190,Sp=16191,sx=16192,ox=16194,qA=16199,YA=16200,ax=16206,ji=16209,J8=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ife(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const f_=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.mode<KA||n.mode>16211?1:0},Q8=e=>{if(f_(e))return ql;const n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=KA,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,p_},Z8=e=>{if(f_(e))return ql;const n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,Q8(e)},e9=(e,n)=>{let i;if(f_(e))return ql;const o=e.state;return n<0?(i=0,n=-n):(i=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?ql:(o.window!==null&&o.wbits!==n&&(o.window=null),o.wrap=i,o.wbits=n,Z8(e))},t9=(e,n)=>{if(!e)return ql;const i=new Ife;e.state=i,i.strm=e,i.window=null,i.mode=KA;const o=e9(e,n);return o!==p_&&(e.state=null),o};let cx,lx,n9=!0;const Afe=e=>{if(n9){cx=new Int32Array(512),lx=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(nb(1,e.lens,0,288,cx,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;nb(2,e.lens,0,32,lx,0,e.work,{bits:5}),n9=!1}e.lencode=cx,e.lenbits=9,e.distcode=lx,e.distbits=5},r9=(e,n,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(n.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(n.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(n.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Ofe=(e,n)=>{let i,o,c,u,h,f,_,v,y,w,I,P,F,x,M,$,q,ae,me,ge,pe,we,Be=0;const nt=new Uint8Array(4);let st,dn;const hn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(f_(e)||!e.output||!e.input&&e.avail_in!==0)return ql;i=e.state,i.mode===Sp&&(i.mode=sx),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,f=e.avail_in,v=i.hold,y=i.bits,w=f,I=_,we=p_;e:for(;;)switch(i.mode){case KA:if(i.wrap===0){i.mode=sx;break}for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(2&i.wrap&&v===35615){i.wbits===0&&(i.wbits=15),i.check=0,nt[0]=255&v,nt[1]=v>>>8&255,i.check=uo(i.check,nt,2,0),v=0,y=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",i.mode=ji;break}if((15&v)!==X8){e.msg="unknown compression method",i.mode=ji;break}if(v>>>=4,y-=4,pe=8+(15&v),i.wbits===0&&(i.wbits=pe),pe>15||pe>i.wbits){e.msg="invalid window size",i.mode=ji;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&v?16189:Sp,v=0,y=0;break;case 16181:for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(i.flags=v,(255&Gs(i))!==X8){e.msg="unknown compression method",i.mode=ji;break}if(57344&Gs(i)){e.msg="unknown header flags set",i.mode=ji;break}i.head&&(i.head.text=v>>8&1),512&Gs(i)&&4&i.wrap&&(nt[0]=255&v,nt[1]=v>>>8&255,i.check=uo(i.check,nt,2,0)),v=0,y=0,i.mode=16182;case 16182:for(;y<32;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.head&&(i.head.time=v),512&Gs(i)&&4&i.wrap&&(nt[0]=255&v,nt[1]=v>>>8&255,nt[2]=v>>>16&255,nt[3]=v>>>24&255,i.check=uo(i.check,nt,4,0)),v=0,y=0,i.mode=16183;case 16183:for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.head&&(i.head.xflags=255&v,i.head.os=v>>8),512&Gs(i)&&4&i.wrap&&(nt[0]=255&v,nt[1]=v>>>8&255,i.check=uo(i.check,nt,2,0)),v=0,y=0,i.mode=16184;case 16184:if(1024&Gs(i)){for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.length=v,i.head&&(i.head.extra_len=v),512&Gs(i)&&4&i.wrap&&(nt[0]=255&v,nt[1]=v>>>8&255,i.check=uo(i.check,nt,2,0)),v=0,y=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&Gs(i)&&(P=i.length,P>f&&(P=f),P&&(i.head&&(pe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+P),pe)),512&Gs(i)&&4&i.wrap&&(i.check=uo(i.check,o,P,u)),f-=P,u+=P,i.length-=P),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&Gs(i)){if(f===0)break e;P=0;do pe=o[u+P++],i.head&&pe&&i.length<65536&&(i.head.name+=String.fromCharCode(pe));while(pe&&P<f);if(512&Gs(i)&&4&i.wrap&&(i.check=uo(i.check,o,P,u)),f-=P,u+=P,pe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&Gs(i)){if(f===0)break e;P=0;do pe=o[u+P++],i.head&&pe&&i.length<65536&&(i.head.comment+=String.fromCharCode(pe));while(pe&&P<f);if(512&Gs(i)&&4&i.wrap&&(i.check=uo(i.check,o,P,u)),f-=P,u+=P,pe)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&Gs(i)){for(;y<16;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(4&i.wrap&&v!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ji;break}v=0,y=0}i.head&&(i.head.hcrc=Gs(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Sp;break;case 16189:for(;y<32;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}e.adler=i.check=J8(v),v=0,y=0,i.mode=$A;case $A:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=f,i.hold=v,i.bits=y,Rfe;e.adler=i.check=1,i.mode=Sp;case Sp:if(n===bfe||n===HA)break e;case sx:if(i.last){v>>>=7&y,y-=7&y,i.mode=ax;break}for(;y<3;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}switch(i.last=1&v,v>>>=1,y-=1,3&v){case 0:i.mode=16193;break;case 1:if(Afe(i),i.mode=qA,n===HA){v>>>=2,y-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=ji}v>>>=2,y-=2;break;case 16193:for(v>>>=7&y,y-=7&y;y<32;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ji;break}if(i.length=65535&v,v=0,y=0,i.mode=ox,n===HA)break e;case ox:i.mode=16195;case 16195:if(P=i.length,P){if(P>f&&(P=f),P>_&&(P=_),P===0)break e;c.set(o.subarray(u,u+P),h),f-=P,u+=P,_-=P,h+=P,i.length-=P;break}i.mode=Sp;break;case 16196:for(;y<14;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(i.nlen=257+(31&v),v>>>=5,y-=5,i.ndist=1+(31&v),v>>>=5,y-=5,i.ncode=4+(15&v),v>>>=4,y-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ji;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;y<3;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.lens[hn[i.have++]]=7&v,v>>>=3,y-=3}for(;i.have<19;)i.lens[hn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,st={bits:i.lenbits},we=nb(0,i.lens,0,19,i.lencode,0,i.work,st),i.lenbits=st.bits,we){e.msg="invalid code lengths set",i.mode=ji;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Be=i.lencode[v&(1<<i.lenbits)-1],M=Be>>>24,$=Be>>>16&255,q=65535&Be,!(M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(q<16)v>>>=M,y-=M,i.lens[i.have++]=q;else{if(q===16){for(dn=M+2;y<dn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(v>>>=M,y-=M,i.have===0){e.msg="invalid bit length repeat",i.mode=ji;break}pe=i.lens[i.have-1],P=3+(3&v),v>>>=2,y-=2}else if(q===17){for(dn=M+3;y<dn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}v>>>=M,y-=M,pe=0,P=3+(7&v),v>>>=3,y-=3}else{for(dn=M+7;y<dn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}v>>>=M,y-=M,pe=0,P=11+(127&v),v>>>=7,y-=7}if(i.have+P>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ji;break}for(;P--;)i.lens[i.have++]=pe}}if(i.mode===ji)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=ji;break}if(i.lenbits=9,st={bits:i.lenbits},we=nb(1,i.lens,0,i.nlen,i.lencode,0,i.work,st),i.lenbits=st.bits,we){e.msg="invalid literal/lengths set",i.mode=ji;break}if(i.distbits=6,i.distcode=i.distdyn,st={bits:i.distbits},we=nb(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,st),i.distbits=st.bits,we){e.msg="invalid distances set",i.mode=ji;break}if(i.mode=qA,n===HA)break e;case qA:i.mode=YA;case YA:if(f>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=f,i.hold=v,i.bits=y,Efe(e,I),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,f=e.avail_in,v=i.hold,y=i.bits,i.mode===Sp&&(i.back=-1);break}for(i.back=0;Be=i.lencode[v&(1<<i.lenbits)-1],M=Be>>>24,$=Be>>>16&255,q=65535&Be,!(M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if($&&(240&$)==0){for(ae=M,me=$,ge=q;Be=i.lencode[ge+((v&(1<<ae+me)-1)>>ae)],M=Be>>>24,$=Be>>>16&255,q=65535&Be,!(ae+M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}v>>>=ae,y-=ae,i.back+=ae}if(v>>>=M,y-=M,i.back+=M,i.length=q,$===0){i.mode=16205;break}if(32&$){i.back=-1,i.mode=Sp;break}if(64&$){e.msg="invalid literal/length code",i.mode=ji;break}i.extra=15&$,i.mode=16201;case 16201:if(i.extra){for(dn=i.extra;y<dn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.length+=v&(1<<i.extra)-1,v>>>=i.extra,y-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Be=i.distcode[v&(1<<i.distbits)-1],M=Be>>>24,$=Be>>>16&255,q=65535&Be,!(M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if((240&$)==0){for(ae=M,me=$,ge=q;Be=i.distcode[ge+((v&(1<<ae+me)-1)>>ae)],M=Be>>>24,$=Be>>>16&255,q=65535&Be,!(ae+M<=y);){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}v>>>=ae,y-=ae,i.back+=ae}if(v>>>=M,y-=M,i.back+=M,64&$){e.msg="invalid distance code",i.mode=ji;break}i.offset=q,i.extra=15&$,i.mode=16203;case 16203:if(i.extra){for(dn=i.extra;y<dn;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}i.offset+=v&(1<<i.extra)-1,v>>>=i.extra,y-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ji;break}i.mode=16204;case 16204:if(_===0)break e;if(P=I-_,i.offset>P){if(P=i.offset-P,P>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ji;break}P>i.wnext?(P-=i.wnext,F=i.wsize-P):F=i.wnext-P,P>i.length&&(P=i.length),x=i.window}else x=c,F=h-i.offset,P=i.length;P>_&&(P=_),_-=P,i.length-=P;do c[h++]=x[F++];while(--P);i.length===0&&(i.mode=YA);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=YA;break;case ax:if(i.wrap){for(;y<32;){if(f===0)break e;f--,v|=o[u++]<<y,y+=8}if(I-=_,e.total_out+=I,i.total+=I,4&i.wrap&&I&&(e.adler=i.check=Gs(i)?uo(i.check,c,I,h-I):q0(i.check,c,I,h-I)),I=_,4&i.wrap&&(Gs(i)?v:J8(v))!==i.check){e.msg="incorrect data check",i.mode=ji;break}v=0,y=0}i.mode=16207;case 16207:if(i.wrap&&Gs(i)){for(;y<32;){if(f===0)break e;f--,v+=o[u++]<<y,y+=8}if(4&i.wrap&&v!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ji;break}v=0,y=0}i.mode=16208;case 16208:we=wfe;break e;case ji:we=q8;break e;case 16210:return Y8;default:return ql}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=f,i.hold=v,i.bits=y,(i.wsize||I!==e.avail_out&&i.mode<ji&&(i.mode<ax||n!==$8))&&r9(e,e.output,e.next_out,I-e.avail_out),w-=e.avail_in,I-=e.avail_out,e.total_in+=w,e.total_out+=I,i.total+=I,4&i.wrap&&I&&(e.adler=i.check=Gs(i)?uo(i.check,c,I,e.next_out-I):q0(i.check,c,I,e.next_out-I)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Sp?128:0)+(i.mode===qA||i.mode===ox?256:0),(w===0&&I===0||n===$8)&&we===p_&&(we=Cfe),we},Tp={inflateReset:Z8,inflateReset2:e9,inflateResetKeep:Q8,inflateInit:e=>t9(e,15),inflateInit2:t9,inflate:Ofe,inflateEnd:e=>{if(f_(e))return ql;let n=e.state;return n.window&&(n.window=null),e.state=null,p_},inflateGetHeader:(e,n)=>{if(f_(e))return ql;const i=e.state;return(2&i.wrap)==0?ql:(i.head=n,n.done=!1,p_)},inflateSetDictionary:(e,n)=>{const i=n.length;let o,c,u;return f_(e)?ql:(o=e.state,o.wrap!==0&&o.mode!==$A?ql:o.mode===$A&&(c=1,c=q0(c,n,i,0),c!==o.check)?q8:(u=r9(e,n,i,i),u?(o.mode=16210,Y8):(o.havedict=1,p_)))},inflateInfo:"pako inflate (from Nodeca project)"},Pfe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const i9=Object.prototype.toString,{Z_NO_FLUSH:Nfe,Z_FINISH:kfe,Z_OK:rb,Z_STREAM_END:ux,Z_NEED_DICT:dx,Z_STREAM_ERROR:Dfe,Z_DATA_ERROR:s9,Z_MEM_ERROR:Lfe}=UA;function XA(e){this.options=jA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||e&&e.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(15&n.windowBits)==0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H8,this.strm.avail_out=0;let i=Tp.inflateInit2(this.strm,n.windowBits);if(i!==rb)throw new Error(l_[i]);if(this.header=new Pfe,Tp.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=tb.string2buf(n.dictionary):i9.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=Tp.inflateSetDictionary(this.strm,n.dictionary),i!==rb)))throw new Error(l_[i])}function xfe(e,n){const i=new XA(n);if(i.push(e),i.err)throw i.msg||l_[i.err];return i.result}XA.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,f;if(this.ended)return!1;for(h=n===~~n?n:n===!0?kfe:Nfe,i9.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=Tp.inflate(i,h),u===dx&&c&&(u=Tp.inflateSetDictionary(i,c),u===rb?u=Tp.inflate(i,h):u===s9&&(u=dx));i.avail_in>0&&u===ux&&i.state.wrap>0&&e[i.next_in]!==0;)Tp.inflateReset(i),u=Tp.inflate(i,h);switch(u){case Dfe:case s9:case dx:case Lfe:return this.onEnd(u),this.ended=!0,!1}if(f=i.avail_out,i.next_out&&(i.avail_out===0||u===ux))if(this.options.to==="string"){let _=tb.utf8border(i.output,i.next_out),v=i.next_out-_,y=tb.buf2string(i.output,_);i.next_out=v,i.avail_out=o-v,v&&i.output.set(i.output.subarray(_,_+v),0),this.onData(y)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==rb||f!==0){if(u===ux)return u=Tp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},XA.prototype.onData=function(e){this.chunks.push(e)},XA.prototype.onEnd=function(e){e===rb&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=jA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Mfe={inflate:xfe};const{deflate:Ufe}=_fe,{inflate:Vfe}=Mfe;var Ffe=Ufe,jfe=Vfe,o9=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(o9||{});class Bfe{constructor(){z(this,"_sequence",0),z(this,"_startTime",Date.now()),z(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const _={id:0,length:4,data:f.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=v,i.payload=this.compress(n),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;Q("SHOW_DATASTREAM2_LOG")&&N.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const f=this.serializeExtension(i.extension);c.set(new Uint8Array(f),h),h+=f.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const i=new DataView(n);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,f;if(o+=4,Q("SHOW_DATASTREAM2_LOG")&&N.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){f=this.deserializeExtension(n.slice(o)),o+=2+f.length,h=n.slice(o);let _=!1;if(f.datas.length>0){const v=f.datas.find(y=>y.id===0);v&&(_=(1&new DataView(v.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:i,length:o,datas:c}=n,u=new ArrayBuffer(o+2),h=new Uint8Array(u),f=new DataView(u);let _=0;if(f.setUint8(_++,i),f.setUint8(_++,o),c.forEach(v=>{i?(f.setUint8(_++,v.id),f.setUint8(_++,v.length),h.set(new Uint8Array(v.data),_),_+=v.data.byteLength):(f.setUint8(_++,v.id|v.length<<4),h.set(new Uint8Array(v.data),_),_+=v.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(n){const i=new DataView(n);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===o9.TWO_BYTE,f=[],_=new DataView(n,2);let v=0;for(;v<u;){let y=0,w=0,I=new ArrayBuffer(0);h?(y=_.getUint8(v),v++,w=_.getUint8(v),v++):(y=15&_.getUint8(v),w=_.getUint8(v)>>4,v++),w>0&&(I=_.buffer.slice(v+2,v+2+w),v+=I.byteLength),f.push({id:y,length:w,data:I})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:f}}decompress(n){return jfe(new Uint8Array(n))}compress(n){return Ffe(new Uint8Array(n))}}const Wfe={name:"DataStream",create:(e,n)=>{const i=n?new Yde(e):new Xde(e);return i.useDataStream(new Bfe),i}};class Gfe extends Rr{constructor(n,i,o){super(),z(this,"ws",void 0),z(this,"requestId",1),z(this,"heartBeatTimer",void 0),z(this,"joinInfo",void 0),z(this,"clientId",void 0),z(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),z(this,"onClose",c=>{this.emit("close"),this.dispose()}),z(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=n,this.clientId=i,this.ws=new O0("cross-channel-".concat(this.clientId),o),this.ws.on(Bt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Bt.CONNECTED,this.onOpen),this.ws.on(Bt.ON_MESSAGE,this.onMessage),this.ws.on(Bt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(n){const i=this.requestId++;return n.requestId=i,n.seq=i,this.ws.sendMessage(n),i}waitStatus(n){return new tt((i,o)=>{const c=window.setTimeout(()=>{o(new Te(Y.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Te(Y.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Te(Y.WS_ABORT))})})}async request(n){if(this.ws.state==="closed")throw new Te(Y.WS_DISCONNECT);const i=()=>new tt((h,f)=>{this.ws.once(Bt.CLOSED,()=>f(new Te(Y.WS_ABORT))),this.ws.once(Bt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(n),c=new tt((h,f)=>{const _=()=>{f(new Te(Y.WS_ABORT))};this.ws.once(Bt.RECONNECTING,_),this.ws.once(Bt.CLOSED,_),this.once("req_".concat(o),h),Hi(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Bt.RECONNECTING,_),this.ws.off(Bt.CLOSED,_),f(new Te(Y.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Te(Y.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(n){this.ws.removeAllListeners(Bt.REQUEST_NEW_URLS),this.ws.on(Bt.REQUEST_NEW_URLS,i=>{i(n)}),await this.ws.init(n)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const i=this.requestId++;return n.requestId=i,this.ws.sendMessage(n),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class zfe extends Rr{set state(n){n!==this._state&&(n!==la.RELAY_STATE_FAILURE&&(this.errorCode=ny.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,i,o,c,u){super(),z(this,"joinInfo",void 0),z(this,"sid",void 0),z(this,"clientId",void 0),z(this,"cancelToken",Do.CancelToken.source()),z(this,"workerToken",void 0),z(this,"requestId",0),z(this,"signal",void 0),z(this,"prevChannelMediaConfig",void 0),z(this,"httpRetryConfig",void 0),z(this,"_resolution",void 0),z(this,"_state",la.RELAY_STATE_IDLE),z(this,"errorCode",ny.RELAY_OK),z(this,"onStatus",h=>{N.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",mp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",mp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=ny.SRC_TOKEN_EXPIRED,this.state=la.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=ny.DEST_TOKEN_EXPIRED,this.state=la.RELAY_STATE_FAILURE))}),z(this,"onReconnect",async()=>{N.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",mp.NETWORK_DISCONNECTED),this.state=la.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==la.RELAY_STATE_IDLE&&(N.error("auto restart channel media relay failed",h.toString()),this.errorCode=ny.SERVER_CONNECTION_LOST,this.state=la.RELAY_STATE_FAILURE)})}),this.joinInfo=n,this.clientId=i,this.sid=Kg(),this.signal=new Gfe(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(n){if(this.state!==la.RELAY_STATE_IDLE)throw new Te(Y.INVALID_OPERATION);this.state=la.RELAY_STATE_CONNECTING,await this.connect(),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(n)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new Te(Y.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new Te(Y.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new Te(Y.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=n}async updateChannelMediaRelay(n){if(this.state!==la.RELAY_STATE_RUNNING)throw new Te(Y.INVALID_OPERATION);await this.sendUpdateMessage(n),this.prevChannelMediaConfig=n}async setVideoProfile(n){if(this._resolution=n,this.state!==la.RELAY_STATE_RUNNING)throw new Te(Y.INVALID_OPERATION);const i=this.genMessage(lo.SetVideoProfile);await this.signal.request(i),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),N.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=la.RELAY_STATE_IDLE,this.dispose()}dispose(){N.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Do.CancelToken.source(),this.state=la.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const n=await epe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=n.workerToken,await this.signal.connect(n.addressList),this.emit("event",mp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(n){const i=this.genMessage(lo.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(lo.SetSdkProfile,n);await this.signal.request(o),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(lo.SetSourceChannel,n);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",mp.PACKET_JOINED_SRC_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(lo.SetSourceUserId,n);await this.signal.request(u),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(lo.SetDestChannel,n);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",mp.PACKET_JOINED_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const f=this.genMessage(lo.StartPacketTransfer,n);await this.signal.request(f),this.emit("event",mp.PACKET_SENT_TO_DEST_CHANNEL),this.state=la.RELAY_STATE_RUNNING,N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(n){const i=this.genMessage(lo.UpdateDestChannel,n);await this.signal.request(i),this.emit("event",mp.PACKET_UPDATE_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const n=this.genMessage(lo.StopPacketTransfer);await this.signal.request(n),N.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(n,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Xc,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let f=null,_=null;switch(n){case lo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case lo.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Te(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case lo.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Te(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case lo.SetDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new Te(Y.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case lo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case lo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case lo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case lo.UpdateDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new Te(Y.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case lo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Hfe={name:"ChannelMediaRelay",create:function(e){return new zfe(e.joinInfo,e.clientId,e.websocketRetryConfig||pi,e.httpRetryConfig||pi,e.resolution)}};function a9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ib(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?a9(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Kfe extends Rr{constructor(n,i,o,c){super(),z(this,"spec",void 0),z(this,"token",void 0),z(this,"websocket",void 0),z(this,"pingpongTimer",void 0),z(this,"reconnectMode","retry"),z(this,"serviceMode",void 0),z(this,"reqId",0),z(this,"commandReqId",0),z(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),z(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Et.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===fp.TRANSCODE?1:2}),this.emit($f.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=n,this.serviceMode=c,this.websocket=new O0("live-streaming",o),this.websocket.on(Bt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Bt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Bt.REQUEST_NEW_URLS,(u,h)=>{ls(this,$f.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Bt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}async request(n,i,o,c){this.reqId+=1,n==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Te(Y.UNEXPECTED_ERROR);const f=ib({command:n,sdkVersion:Xc==="4.23.2"?"0.0.1":Xc,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new Te(Y.WS_DISCONNECT);const _=()=>new tt((I,P)=>{this.websocket.once(Bt.CLOSED,()=>P(new Te(Y.WS_ABORT))),this.websocket.once(Bt.CONNECTED,I)});this.websocket.state!=="connected"&&await _(),f.clientRequest&&(f.clientRequest.workerToken=this.token);const v=new tt((I,P)=>{const F=()=>{P(new Te(Y.WS_ABORT))};this.websocket.once(Bt.RECONNECTING,F),this.websocket.once(Bt.CLOSED,F),this.once("@".concat(h,"-").concat(this.spec.sid),x=>{I(x)})});c&&Et.workerEvent(this.spec.sid,ib(ib({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const y=Date.now();this.websocket.sendMessage(f);let w=null;try{w=await v}catch(I){if(this.websocket.state==="closed")throw I;return await _(),await this.request(n,i,o)}return c&&Et.workerEvent(this.spec.sid,ib(ib({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-y})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n=Xc==="4.23.2"?"0.0.1":Xc;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case vi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void N.warning("live stream response already exists stream");case vi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case vi.LIVE_STREAM_RESPONSE_BAD_STREAM:case vi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Te(Y.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case vi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(n.serverResponse.command==="UnpublishStream")return;throw new Te(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case vi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Te(Y.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case vi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new Te(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit($f.WARNING,i,n.serverResponse.url)}case vi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new Te(Y.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit($f.WARNING,i,n.serverResponse.url)}case vi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Te(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case vi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Te(Y.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case vi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new Te(Y.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit($f.WARNING,i,n.serverResponse.url)}case vi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Te(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case vi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Te(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case vi.LIVE_STREAM_RESPONSE_WORKER_LOST:case vi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(n.serverResponse.command==="UnpublishStream")return;throw new Te(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case vi.ERROR_FAIL_SEND_MESSAGE:if(n.serverResponse.command==="UnpublishStream")return;if(n.serverResponse.command==="UpdateTranscoding"||n.serverResponse.command==="ControlStream")return new Te(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new Te(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case vi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Te(Y.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(UI)},6e3)}}function c9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ua(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?c9(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class $fe extends Rr{constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pi;super(),z(this,"onLiveStreamWarning",void 0),z(this,"onLiveStreamError",void 0),z(this,"spec",void 0),z(this,"retryTimeout",1e4),z(this,"connection",void 0),z(this,"httpRetryConfig",void 0),z(this,"wsRetryConfig",void 0),z(this,"streamingTasks",new Map),z(this,"isStartingStreamingTask",!1),z(this,"taskMutex",new ms("live-streaming")),z(this,"cancelToken",Do.CancelToken.source()),z(this,"transcodingConfig",void 0),z(this,"uapResponse",void 0),z(this,"lastTaskId",1),z(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(n){const i=ua(ua({},Dhe),n);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(N.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>ua(ua(ua({},khe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Nr(h.width)||Xn(h.width,"config.width",0,1e4),Nr(h.height)||Xn(h.height,"config.height",0,1e4),Nr(h.videoBitrate)||Xn(h.videoBitrate,"config.videoBitrate",1,1e6),Nr(h.videoFrameRate)||Xn(h.videoFrameRate,"config.videoFrameRate"),Nr(h.lowLatency)||up(h.lowLatency,"config.lowLatency"),Nr(h.audioSampleRate)||Si(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Nr(h.audioBitrate)||Xn(h.audioBitrate,"config.audioBitrate",1,128),Nr(h.audioChannels)||Si(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Nr(h.videoGop)||Xn(h.videoGop,"config.videoGop"),Nr(h.videoCodecProfile)||Si(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Nr(h.userCount)||Xn(h.userCount,"config.userCount",0,17),Nr(h.backgroundColor)||Xn(h.backgroundColor,"config.backgroundColor",0,16777215),Nr(h.userConfigExtraInfo)||zi(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Nr(h.transcodingUsers)&&(dp(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((f,_)=>{aA(f.uid),Nr(f.x)||Xn(f.x,"transcodingUser[".concat(_,"].x"),0,1e4),Nr(f.y)||Xn(f.y,"transcodingUser[".concat(_,"].y"),0,1e4),Nr(f.width)||Xn(f.width,"transcodingUser[".concat(_,"].width"),0,1e4),Nr(f.height)||Xn(f.height,"transcodingUser[".concat(_,"].height"),0,1e4),Nr(f.zOrder)||Xn(f.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Nr(f.alpha)||Xn(f.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Nr(h.watermark)||pL(h.watermark,"watermark"),Nr(h.backgroundImage)||pL(h.backgroundImage,"backgroundImage"),h.images&&!Nr(h.images)&&(dp(h.images,"config.images"),h.images.forEach((f,_)=>{pL(f,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>ua(ua(ua({},hL),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(ua(ua(ua({},hL),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(ua(ua(ua({},hL),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>ua({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?tt.resolve(h.uid):Pz(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await tt.all(c)).forEach((h,f)=>{i.userConfigs&&i.userConfigs[f]&&(i.userConfigs[f].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(uc(u=this.streamingTasks).call(u)).map(f=>f.taskId).join("#")});N.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(f=>{N.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,h).then(()=>{N.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(f.url," success"))}).catch(_=>{N.error("[".concat(this.spec.clientId,"] live streaming republish failed"),f.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,_)})})}}async startLiveStreamingTask(n,i,o){if(!this.transcodingConfig&&i===fp.TRANSCODE)throw new Te(Y.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:n,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};N.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(n)&&!o)return u(),new Te(Y.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(f){throw u(),f}switch(i){case fp.TRANSCODE:c.transcodingConfig=ua({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const f=new tt((v,y)=>{Hi(this.retryTimeout).then(()=>{if(o)return y(o);const w=this.statusError.get(n);return w?(this.statusError.delete(n),y(w)):void 0})}),_=await tt.race([this.connection.request("request",{clientRequest:c},!0,{url:n,command:"PublishStream",workerType:i===fp.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),f]);this.isStartingStreamingTask=!1,N.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(n,{clientRequest:c,mode:i,url:n,taskId:h}),u()}catch(f){if(u(),this.isStartingStreamingTask=!1,!f.data||!f.data.retry||o)throw f;return f.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(n,i,f)):await this.startLiveStreamingTask(n,i,f)}}stopLiveStreamingTask(n){return new tt((i,o)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new Te(Y.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:u===fp.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var n;const i=Array.from(uc(n=this.streamingTasks).call(n));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Do.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(n){if(this.connection)throw new Te(Y.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await ls(this,fL.REQUEST_WORKER_MANAGER_LIST,n);return this.uapResponse=i,this.connection=new Kfe(i.workerToken,this.spec,this.wsRetryConfig,n),this.connection.on($f.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on($f.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on($f.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Te(Y.UNEXPECTED_ERROR,"can not get new live streaming address list"));ls(this,fL.REQUEST_WORKER_MANAGER_LIST,n).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(n){const i=n.serverStatus&&n.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=n.reason;switch(n.code){case vi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Te(Y.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(o)return N.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case vi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Te(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case vi.LIVE_STREAM_RESPONSE_WORKER_LOST:case vi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(uc(u=this.streamingTasks).call(u));for(const f of h)f.abortTask?f.abortTask():(N.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new Te(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{N.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(_=>{N.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,_)}));return}}}hasUrl(n){return this.streamingTasks.has(n)}}const qfe={name:"LiveStreaming",create:function(e){return new $fe(e.joinInfo,e.websocketRetryConfig||pi,e.httpRetryConfig||pi)}};function Yfe(e){let n=d9();return function(i,o){let c=i.appId;c!==void 0&&(Wn(o,10),Xd(o,c));let u=i.cid;u!==void 0&&(Wn(o,16),Wn(o,u));let h=i.cname;h!==void 0&&(Wn(o,26),Xd(o,h));let f=i.deviceId;f!==void 0&&(Wn(o,34),Xd(o,f));let _=i.elapse;_!==void 0&&(Wn(o,40),am(o,_));let v=i.fileSize;v!==void 0&&(Wn(o,48),am(o,vy(v)));let y=i.height;y!==void 0&&(Wn(o,56),am(o,vy(y)));let w=i.jpg;w!==void 0&&(Wn(o,66),Wn(o,w.length),function(Fo,ke){let Ye=yy(Fo,ke.length);Fo.bytes.set(ke,Ye)}(o,w));let I=i.networkType;I!==void 0&&(Wn(o,72),am(o,vy(I)));let P=i.osType;P!==void 0&&(Wn(o,80),am(o,vy(P)));let F=i.requestId;F!==void 0&&(Wn(o,90),Xd(o,F));let x=i.sdkVersion;x!==void 0&&(Wn(o,98),Xd(o,x));let M=i.sequence;M!==void 0&&(Wn(o,104),am(o,vy(M)));let $=i.sid;$!==void 0&&(Wn(o,114),Xd(o,$));let q=i.timestamp;q!==void 0&&(Wn(o,120),am(o,q));let ae=i.uid;ae!==void 0&&(Wn(o,128),Wn(o,ae));let me=i.vid;me!==void 0&&(Wn(o,136),Wn(o,me));let ge=i.width;ge!==void 0&&(Wn(o,144),am(o,vy(ge)));let pe=i.service;pe!==void 0&&(Wn(o,152),Wn(o,pe));let we=i.callbackData;we!==void 0&&(Wn(o,162),Xd(o,we));let Be=i.jpgEncryption;Be!==void 0&&(Wn(o,168),Wn(o,Be));let nt=i.requestType;nt!==void 0&&(Wn(o,176),Wn(o,nt));let st=i.scorePorn;st!==void 0&&(Wn(o,185),gx(o,st));let dn=i.scoreSexy;dn!==void 0&&(Wn(o,193),gx(o,dn));let hn=i.scoreNeutral;hn!==void 0&&(Wn(o,201),gx(o,hn));let ir=i.scene;ir!==void 0&&(Wn(o,208),Wn(o,ir));let Yr=i.ossFilePrefix;Yr!==void 0&&(Wn(o,218),Xd(o,Yr));let Vr=i.serviceVendor;if(Vr!==void 0)for(let Fo of Vr){Wn(o,226);let ke=d9();Qfe(Fo,ke),Wn(o,ke.limit),nme(o,ke),tme(ke)}}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function Xfe(e){return function(i){let o={};e:for(;!h9(i);){let c=Jd(i);switch(c>>>3){case 0:break e;case 1:o.code=Jd(i);break;case 2:o.msg=p9(i,Jd(i));break;case 3:{let u=Zfe(i);o.data=Jfe(i),i.limit=u;break}default:l9(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function Jfe(e){let n={};e:for(;!h9(e);){let i=Jd(e);switch(i>>>3){case 0:break e;case 1:n.requestId=p9(e,Jd(e));break;case 2:n.requestType=Jd(e)>>>0;break;case 3:n.scorePorn=mx(e);break;case 4:n.scoreSexy=mx(e);break;case 5:n.scoreNeutral=mx(e);break;case 6:n.requestScene=Jd(e)>>>0;break;case 7:n.scene=Jd(e)>>>0;break;default:l9(e,7&i)}}return n}function Qfe(e,n){let i=e.service;i!==void 0&&(Wn(n,8),Wn(n,i));let o=e.vendor;o!==void 0&&(Wn(n,16),Wn(n,o));let c=e.token;c!==void 0&&(Wn(n,26),Xd(n,c));let u=e.callbackUrl;u!==void 0&&(Wn(n,34),Xd(n,u))}function Zfe(e){let n=Jd(e),i=e.limit;return e.limit=e.offset+n,i}function l9(e,n){switch(n){case 0:for(;128&f9(e););break;case 2:px(e,Jd(e));break;case 5:px(e,4);break;case 1:px(e,8);break;default:throw new Error("Unimplemented type: "+n)}}let eme=new Float32Array(1);new Uint8Array(eme.buffer);let hx=new Float64Array(1),da=new Uint8Array(hx.buffer);function vy(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let u9=[];function d9(){const e=u9.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function tme(e){u9.push(e)}function px(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function h9(e){return e.offset>=e.limit}function yy(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function fx(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function p9(e,n){let i=fx(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let f=0;f<n;f++){let _,v,y,w,I=c[f+i];(128&I)==0?h+=o(I):(224&I)==192?f+1>=n?h+=u:(_=c[f+i+1],(192&_)!=128?h+=u:(w=(31&I)<<6|63&_,w<128?h+=u:(h+=o(w),f++))):(240&I)==224?f+2>=n?h+=u:(_=c[f+i+1],v=c[f+i+2],(49344&(_|v<<8))!=32896?h+=u:(w=(15&I)<<12|(63&_)<<6|63&v,w<2048||w>=55296&&w<=57343?h+=u:(h+=o(w),f+=2))):(248&I)==240?f+3>=n?h+=u:(_=c[f+i+1],v=c[f+i+2],y=c[f+i+3],(12632256&(_|v<<8|y<<16))!=8421504?h+=u:(w=(7&I)<<18|(63&_)<<12|(63&v)<<6|63&y,w<65536||w>1114111?h+=u:(w-=65536,h+=o(55296+(w>>10),56320+(1023&w)),f+=3))):h+=u}return h}function Xd(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let f=n.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+n.charCodeAt(++h)-56613888),o+=f<128?1:f<2048?2:f<65536?3:4}Wn(e,o);let c=yy(e,o),u=e.bytes;for(let h=0;h<i;h++){let f=n.charCodeAt(h);f>=55296&&f<=56319&&h+1<i&&(f=(f<<10)+n.charCodeAt(++h)-56613888),f<128?u[c++]=f:(f<2048?u[c++]=f>>6&31|192:(f<65536?u[c++]=f>>12&15|224:(u[c++]=f>>18&7|240,u[c++]=f>>12&63|128),u[c++]=f>>6&63|128),u[c++]=63&f|128)}}function nme(e,n){let i=yy(e,n.limit),o=e.bytes,c=n.bytes;for(let u=0,h=n.limit;u<h;u++)o[u+i]=c[u]}function f9(e){return e.bytes[fx(e,1)]}function m9(e,n){let i=yy(e,1);e.bytes[i]=n}function mx(e){let n=fx(e,8),i=e.bytes;return da[0]=i[n++],da[1]=i[n++],da[2]=i[n++],da[3]=i[n++],da[4]=i[n++],da[5]=i[n++],da[6]=i[n++],da[7]=i[n++],hx[0]}function gx(e,n){let i=yy(e,8),o=e.bytes;hx[0]=n,o[i++]=da[0],o[i++]=da[1],o[i++]=da[2],o[i++]=da[3],o[i++]=da[4],o[i++]=da[5],o[i++]=da[6],o[i++]=da[7]}function Jd(e){let n,i=0,o=0;do n=f9(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function Wn(e,n){for(n>>>=0;n>=128;)m9(e,127&n|128),n>>>=7;m9(e,n)}function am(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=yy(e,u),f=e.bytes;switch(u){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=u!==9?128|c:127&c;case 8:f[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:f[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:f[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:f[h+4]=u!==5?128|o:127&o;case 4:f[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:f[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:f[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:f[h]=u!==1?128|i:127&i}}function g9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const rme=new Map([["moderation",1],["supervise",2]]);class ime extends Rr{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Fi.CONNECTION_STATE_CHANGE,i,n)}get inspectType(){return this._inspectType}set inspectType(n){var i;this._inspectMode=Aa(i=n.map(o=>rme.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),z(this,"name","AgoraRTCVideoContentInspect"),z(this,"_connectionState",Wl.CONNECTING),z(this,"_innerConnectionState",void 0),z(this,"sequence",0),z(this,"inspectStartTime",void 0),z(this,"workerManagerConnection",void 0),z(this,"workerConnection",void 0),z(this,"workerMessageLengthLimit",void 0),z(this,"inspectIntervalMinimum",void 0),z(this,"qualityRatio",void 0),z(this,"_connectInfo",void 0),z(this,"_cancelTokenSource",Do.CancelToken.source()),z(this,"_retryConfig",void 0),z(this,"wmSequence",0),z(this,"inspectInterval",void 0),z(this,"inspectTimer",null),z(this,"ossFilePrefix",void 0),z(this,"extraInfo",void 0),z(this,"_inspectType",void 0),z(this,"_inspectMode",void 0),z(this,"_quality",1),z(this,"qualityTimer",null),z(this,"_inspectId",void 0),z(this,"_needWorkUrlOnly",!1),z(this,"inspectImage",()=>{if(this.connectionState!==Wl.CONNECTED)throw new Te(Y.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Wl.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=nr(5,"inspect-"),this.workerMessageLengthLimit=Q("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Q("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Q("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new O0("worker-manager-"+this._inspectId,pi),this.on(Fi.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,N.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Gl[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new O0("worker-"+this._inspectId,pi),this.handleWorkerEvents()}async init(n,i){this.emit(Fi.STATE_CHANGE,Gl.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new tt((c,u)=>{this.on(Fi.CONNECTION_STATE_CHANGE,(h,f)=>{f===Wl.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(n,i,o){const c=Q("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),u=await function(f,_,v,y){let{appId:w,areaCode:I,cname:P,sid:F,token:x,uid:M}=_;ly++;const $="image_moderation_api",q={service_name:$,json_body:JSON.stringify({appId:w,areaCode:I,cname:P,command:"allocateEdge",requestId:ly,seq:ly,sid:F,token:x,ts:Date.now(),uid:M+""})};let ae,me,ge=f[0];return ju(async()=>{ae=Date.now();const pe=await Hu(ge,{data:q,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(me=Date.now()-ae,pe.code!==0){const st=new Te(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code"+pe.code,{retry:!0,responseTime:me});throw N.error(st.toString()),st}const we=JSON.parse(pe.json_body);if(we.code!==200){const st=new Te(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(we.code,", reason: ").concat(we.reason),{code:we.code,responseTime:me});throw N.error(st.toString()),st}if(!we.servers||!Array.isArray(we.servers)||we.servers.length===0){const st=new Te(Y.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:we.code,responseTime:me});throw N.error(st.toString()),st}const Be=Q("VIDEO_INSPECT_WORKER_MANAGER_HOST"),nt=Q("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:we.servers.map(st=>{let{address:dn,wss:hn}=st;if(dn&&hn)return"wss://".concat(dn.replace(/\./g,"-"),".").concat(Be,":").concat(nt||hn)}).filter(st=>!!st),workerToken:we.workerToken,vid:we.vid,responseTime:me}},(pe,we)=>(Et.apworkerEvent(F,{success:!0,sc:200,serviceName:$,responseDetail:JSON.stringify(pe.addressList),firstSuccess:we===0,responseTime:me,serverIp:f[we%f.length]}),!1),(pe,we)=>(Et.apworkerEvent(F,{success:!1,sc:pe.data&&pe.data.code||200,serviceName:$,responseTime:me,serverIp:f[we%f.length]}),!!(pe.code!==Y.OPERATION_ABORTED&&pe.code!==Y.UNEXPECTED_RESPONSE||pe.data&&pe.data.retry)&&(ge=f[(we+1)%f.length],!0)),y)}(c,n,i,o);this.emit(Fi.STATE_CHANGE,Gl.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Fi.STATE_CHANGE,Gl.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(n,1e4)}async connectWorker(n){await this.workerConnection.init([n])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Bt.CONNECTED,async()=>{this.emit(Fi.STATE_CHANGE,Gl.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Bt.CLOSED,()=>{this._innerConnectionState<Gl.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Bt.FAILED,()=>{this._innerConnectionState<Gl.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Bt.RECONNECTING,()=>{this._innerConnectionState<Gl.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Bt.ON_MESSAGE,async n=>{this.emit(Fi.STATE_CHANGE,Gl.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(n.data);if(o.code!==200)throw N.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Te(Y.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw N.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Te(Y.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=Q("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Fi.STATE_CHANGE,Gl.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Fi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Bt.WILL_RECONNECT,(n,i,o)=>{o(n)}),this.workerManagerConnection.on(Bt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Bt.CONNECTED,async()=>{this.emit(Fi.STATE_CHANGE,Gl.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Wl.CONNECTED}),this.workerConnection.on(Bt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const o=Xfe(new Uint8Array(n.data));if(Q("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&N.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Fi.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Aa(i=Object.keys(c)).call(i,(f,_)=>c[f]>c[_]?f:_,"porn"),h=Object.keys(c).find(f=>f===u);this.emit(Fi.INSPECT_RESULT,h)}else this.emit(Fi.INSPECT_RESULT,void 0,new Te(Y.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Fi.INSPECT_RESULT,void 0,new Te(Y.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else N.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Fi.INSPECT_RESULT,void 0,new Te(Y.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Bt.CLOSED,()=>{this.connectionState=Wl.CLOSED}),this.workerConnection.on(Bt.FAILED,()=>{this.connectionState=Wl.CLOSED}),this.workerConnection.on(Bt.RECONNECTING,()=>{this.connectionState=this.connectionState===Wl.CONNECTED?Wl.RECONNECTING:Wl.CONNECTING}),this.workerConnection.on(Bt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this.workerConnection.on(Bt.REQUEST_NEW_URLS,(n,i)=>{this.workerManagerConnection.close(),this.once(Fi.REQUEST_NEW_WORKER_URL,o=>{n([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const n=hc(this,Fi.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void this.emit(Fi.INSPECT_RESULT,void 0,new Te(Y.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(n,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Fi.INSPECT_RESULT,void 0,new Te(Y.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:f,uid:_}=i;const v=Date.now(),y=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await J6(y,o,c),I=this.sequence+"-"+u+"-"+_+"-"+v+"-"+nr(12,""),P={appId:o,cid:u,cname:c,deviceId:"",elapse:(F=Number(v-this.inspectStartTime),{low:F|=0,high:F>>31,unsigned:F>=0}),fileSize:w.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:w,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.2",sequence:this.sequence,sid:f,timestamp:wH(v),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var F;this.extraInfo===void 0&&delete P.callbackData,this.ossFilePrefix===void 0&&delete P.ossFilePrefix;const x=Yfe(P);if(x.byteLength<this.workerMessageLengthLimit){if(Q("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const M=function($){for(var q=1;q<arguments.length;q++){var ae=arguments[q]!=null?arguments[q]:{};q%2?g9(Object(ae),!0).forEach(function(me){z($,me,ae[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(ae)):g9(Object(ae)).forEach(function(me){Object.defineProperty($,me,Object.getOwnPropertyDescriptor(ae,me))})}return $}({},P);delete M.jpg,N.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(M))}return x}{const M=this.quality*this.qualityRatio;return this.quality=M,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:f,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Do.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Wl.CLOSED,this.emit(Fi.STATE_CHANGE,Gl.CLOSED)}}const sme={name:"ContentInspect",create:function(e){let{config:n}=e;return function(i){if(!i)throw new Te(Y.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new Te(Y.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!Xe(u=["supervise","moderation"]).call(u,c))throw new Te(Y.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new Te(Y.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(n),new ime(n)}};var _9=l(ft.Object.getOwnPropertySymbols),ome=kn,ame=Io.indexOf,cme=Uh,_x=ue([].indexOf),E9=!!_x&&1/_x([1],1,-0)<0;ome({target:"Array",proto:!0,forced:E9||!cme("indexOf")},{indexOf:function(e){var n=arguments.length>1?arguments[1]:void 0;return E9?_x(this,e,n)||0:ame(this,e,n)}});var lme=Ia("Array").indexOf,ume=k,dme=lme,Ex=Array.prototype,hme=function(e){var n=e.indexOf;return e===Ex||ume(Ex,e)&&n===Ex.indexOf?dme:n},v9=l(hme);function pme(e,n){if(e==null)return{};var i,o,c=function(h,f){if(h==null)return{};var _,v,y={},w=FG(h);for(v=0;v<w.length;v++)_=w[v],v9(f).call(f,_)>=0||(y[_]=h[_]);return y}(e,n);if(_9){var u=_9(e);for(o=0;o<u.length;o++)i=u[o],v9(n).call(n,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let y9=class{get localCapabilities(){return Dr(this._localCapabilities)}get rtpCapabilities(){return Dr(this._rtpCapabilities)}get candidates(){return Dr(this._candidates)}get iceParameters(){return Dr(this._iceParameters)}get dtlsParameters(){return Dr(this._dtlsParameters)}constructor(e){z(this,"sessionDesc",void 0),z(this,"_localCapabilities",void 0),z(this,"_rtpCapabilities",void 0),z(this,"_candidates",void 0),z(this,"_iceParameters",void 0),z(this,"_dtlsParameters",void 0),z(this,"setup",void 0),z(this,"currentMidIndex",void 0),z(this,"cname","o/i14u9pJrxRKAsu"),z(this,"firefoxSsrcMidMap",new Map),e=Dr(e);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:f,videoCodec:_,audioCodec:v}=e;let y;this.setup=f,y=h===co.RECEIVE_ONLY?ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=u;const w=h===co.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,I=h===co.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,P=h===co.RECEIVE_ONLY?c.send.videoCodecs:k0(at.VIDEO,w,I,_),F=h===co.RECEIVE_ONLY?c.send.audioCodecs:k0(at.AUDIO,w,I,v);for(const x of y.mediaDescriptions)x.attributes.iceUfrag=n.iceUfrag,x.attributes.icePwd=n.icePwd,x.attributes.fingerprints=i.fingerprints,x.attributes.candidates=o,x.attributes.setup=this.setup,x.media.mediaType==="application"&&(x.attributes.sctpPort="5000"),x.media.mediaType==="video"&&(x.media.fmts=P.map(M=>M.payloadType.toString(10)),x.attributes.payloads=P,x.attributes.extmaps=w.videoExtensions),x.media.mediaType==="audio"&&(x.media.fmts=F.map(M=>M.payloadType.toString(10)),x.attributes.payloads=F,x.attributes.extmaps=w.audioExtensions,cy(x));this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1}toString(){return Kf(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(n=>this.hasMid(n)):this.sessionDesc.mediaDescriptions.some(n=>n.attributes.mid===e)}send(e,n,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=t_(n,this.cname,Q("SYNC_GROUP")?i:void 0),f=this.findPreloadMediaDesc(u);if(f){if(Pr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,f.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(f,c),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let v;return _===-1?(v=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(v=Dr(this.sessionDesc.mediaDescriptions[_]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(v,c)),Pr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,n,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let f,_=!1;h===-1?(_=!0,f=this.createOrRecycleRecvMedia(c,[],"recvonly",n,i),this.updateBundleMids()):(f=Dr(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="recvonly"),o.push({mid:f.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:n,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:f,priority:_}=new RTCIceCandidate(e),v={foundation:n??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:f?f+"":"",extension:{}};this.candidates.some(y=>y.priority===v.priority&&y.connectionAddress===v.connectionAddress&&y.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(y=>{y.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,n,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=k0(u,h,this.localCapabilities.send,u===at.AUDIO?c:o),_=u===at.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let y={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};y=this.mungRecvMediaDsec(y,e);const w=this.findFirstClosedMedia(u);if(w){const I=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[I]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>Xe(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>Xe(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,n,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Pr()){if(c){const u=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="recvonly"||n.attributes.direction==="sendrecv");return n.attributes.mid!=="0"&&n.attributes.mid!=="1"&&i})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}restartICE(e){e=Dr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,n,i,o,c,u){const h=this.rtpCapabilities.send,f=e===at.VIDEO?h.videoCodecs:h.audioCodecs,_=e===at.VIDEO?h.videoExtensions:h.audioExtensions;Pr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const y=this.findFirstClosedMedia(e);if(y){const w=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[w]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(e,n,i){const o=Dr(e);return vL(o),ay(o,n),yL(o,n),uz(o),fA(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,n){const i=Dr(e);return fA(i,n,this.localCapabilities.recv),cy(i),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var i;return((i=n.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>Pr()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}};const fme=["sdp"];var cr;function S9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function cm(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?S9(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let T9=(cr=class Dy extends HG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[]}set isInRestartIce(n){this._isInRestartIce=n}get isInRestartIce(){return this._isInRestartIce}constructor(n,i,o){super(n,i),z(this,"direction",void 0),z(this,"name",void 0),z(this,"store",void 0),z(this,"spec",void 0),z(this,"peerConnection",void 0),z(this,"initialOffer",void 0),z(this,"transport",void 0),z(this,"statsFilter",void 0),z(this,"localCandidateCount",0),z(this,"_isInRestartIce",!1),z(this,"mutex",void 0),z(this,"onLocalCandidate",void 0),z(this,"remoteSDP",void 0),z(this,"pendingCandidates",[]),z(this,"localCapabilities",void 0),z(this,"isReady",!1),z(this,"restartCnt",0),z(this,"curTurnServerIndex",0),this.store=i,this.spec=n,this.mutex=new ms("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Dy.resolvePCConfiguration(n,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??co.SEND_ONLY,this.name=this.direction===co.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=D1(this.peerConnection,Q("STATS_UPDATE_INTERVAL"),void 0,Pr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(n){try{const i=await hz();if(this.localCapabilities=mA(i),n){const{sdp:o}=n,c=pme(n,fme),u=function(){const y={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=N0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},F={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zl(w,y,"videoExtensions",I,P,F),zl(w,y,"videoCodecs",I,P,F),zl(w,y,"audioExtensions",I,P,F),zl(w,y,"audioCodecs",I,P,F),Q("RAISE_H264_BASELINE_PRIORITY")){const x=F.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]==="42001f");if(x!==-1){const M=F.videoCodecs.findIndex($=>$.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(M<x){N.debug("raising H264 baseline profile priority");const $=F.videoCodecs[x];F.videoCodecs.splice(x,1),F.videoCodecs.splice(M,0,$)}M!==-1&&Q("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter($=>!($.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&$.fmtp&&$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:I,recv:P,sendrecv:F}}({},{},o);this.remoteSDP=new y9({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const f=Jf(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await pz({},{},h.sdp);this.localCapabilities=mA(_);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),cm(cm({},f),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Jf(o.sdp);return this.initialOffer=o,cm(cm({},c),{},{sdp:o.sdp})}}catch(i){throw new Ce(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=n,u=await pz({},{},i);this.remoteSDP=new y9({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(n){try{n&&this.pendingCandidates.push(n),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Ce(Y.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return Yc(function*(){const u=yield En(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=c.remoteSDP.receive(n,i,o);n.forEach((M,$)=>{if(f[$].needCreateTransceiver){const q=c.peerConnection.addTransceiver(M._mediaStreamTrack,{direction:"sendonly"});h.push(q),M._updateRtpTransceiver(q)}else{const q=c.peerConnection.getTransceivers().find(ae=>ae.mid===f[$].mid);if(!q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[$].mid));h.push(q),M._updateRtpTransceiver(q)}}),Pr()&&Q("SIMULCAST")===!0&&(yield En(c.applySimulcastForFirefox(h,n)));const _=f.map(M=>M.mid),v=yield En(c.peerConnection.createOffer()),y=c.mungSendOfferSDP(v.sdp,n,_),w=ca(y),I=_.map(M=>{const $=w.mediaDescriptions.find(q=>q.attributes.mid===M);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return az($,Q("USE_PUB_RTX"))}),P=h.map((M,$)=>{const q=_[$];return{localSSRC:I[$],id:q}});yield En(c.peerConnection.setLocalDescription({type:"offer",sdp:y}));try{yield P}catch(M){const $=c.remoteSDP.toString();throw yield En(c.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield En(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield En(c.stopSending(_,!0)),M}yield En(c.applySimulcastEncodings(h,n)),yield En(c.applySendEncodings(h,n));const F=c.remoteSDP.toString(),x=c.logSDPExchange(y,"offer","local","send");return x==null||x(F),yield En(c.setRemoteDescription({type:"answer",sdp:F})),h.map((M,$)=>{const q=_[$];return{localSSRC:I[$],id:q}})}catch(h){throw h instanceof Ce?h:new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var v;_.direction="inactive",(v=_.stop)===null||v===void 0||v.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const f=this.remoteSDP.toString();h==null||h(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const _=this.remoteSDP.toString(),v=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(y.sdp,u,n);v==null||v(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const f=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!f||f.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,transceiver:f}}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const f=this.remoteSDP.toString(),_=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});const v=await this.peerConnection.createAnswer(),y=this.mungReceiveAnswerSDP(v.sdp,u,n);_==null||_(y||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:y}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."))}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(n){try{if(this.store.p2pTransport===$g.Auto&&(this.store.p2pTransport=$g.SdRtn,In().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Dy.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,In().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Dy.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!n){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Jf(i.sdp);return this.store.descriptionStart(),this.direction===co.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(n),this.store.descriptionStart(),this.direction===co.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Jf(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var n;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ce(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?Pr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:cm(cm({},Ud),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:cm(cm({},Ud),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n,i;Xe(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=n=>{if(n.candidate){var i;n.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,n.candidate.toJSON())),this.localCandidateCount+=1}else N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return n.iceServers?c.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(E0(n.turnServer.servers)?c.iceServers=n.turnServer.servers:(c.iceServers&&c.iceServers.push(...Dy.turnServerConfigToIceServers(n.turnServer.servers,i,o)),Q("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&n.turnServer.serversFromGateway&&c.iceServers.push(...Dy.turnServerConfigToIceServers(n.turnServer.serversFromGateway,i,o)),Xe(u=[$g.Relay,$g.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),Q("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),Q("ENABLE_ENCODED_TRANSFORM")&&In().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),N.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=n.filter(f=>f.tcpport);N.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case $g.SdRtn:const f=n.filter(v=>{var y;return Xe(y=v.username).call(y,"glb:")&&v.turnServerURL==v.turnServerURL}),_=f.length>o?f[o]:f[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Yf(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Yf(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case $g.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Yf(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Yf(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(n){if(n){this.transport=n,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(y=>y.track===n._mediaStreamTrack)),!i)return N.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!In().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(n._encoderConfig){var h;const{bitrateMax:y,frameRate:w,scaleResolutionDownBy:I}=n._encoderConfig;y&&(u.maxBitrate=1e3*y),Xe(h=n._hints).call(h,rr.LOW_STREAM)&&(w&&(u.maxFramerate=Ma(w)),I&&I>=1&&(u.scaleResolutionDownBy=I))}if(Q("DSCP_TYPE")&&lp()){var f;const y=Q("DSCP_TYPE");Xe(f=["very-low","low","medium","high"]).call(f,y)&&(u.networkPriority=y)}const _=i.getParameters(),v=(o=_.encodings)===null||o===void 0?void 0:o[0];Pr()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(_,c),N.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(n,i){try{if(!In().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof hr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=ca(n);return i.forEach((u,h)=>{const f=o[h],_=c.mediaDescriptions.find(v=>v.attributes.mid===f);_&&(ay(_,u),dz(_,u,this.store.codec))}),Kf(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,f;const v=n[_],y=i[_];if(y instanceof hr&&!Xe(o=y._hints).call(o,rr.LOW_STREAM)&&(c=y._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=y._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=y._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=y._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},I={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const P=v.sender.getParameters();await v.sender.setParameters(Object.assign(P,w))}}}async applySimulcastEncodings(n,i){if(!Pr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof hr&&this.isVP8Simulcast(c)){const u=n[o],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof hr&&Q("SIMULCAST")&&this.store.codec==="vp8"&&!Xe(i=n._hints).call(i,rr.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(Q("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(n,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=ca(i).mediaDescriptions.find(f=>f.attributes.mid===n))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(n){var i;await this.peerConnection.setRemoteDescription(n),Xe(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(n,i,o){const c=ca(n),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===at.AUDIO&&u.media.mediaType==="audio"&&cy(u),Kf(c)}},dt(cr.prototype,"establish",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"establish"),cr.prototype),dt(cr.prototype,"connect",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"connect"),cr.prototype),dt(cr.prototype,"receive",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"receive"),cr.prototype),dt(cr.prototype,"mockReceive",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"mockReceive"),cr.prototype),dt(cr.prototype,"stopReceiving",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"stopReceiving"),cr.prototype),dt(cr.prototype,"restartICE",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"restartICE"),cr.prototype),dt(cr.prototype,"close",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"close"),cr.prototype),dt(cr.prototype,"updateEncoderConfig",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"updateEncoderConfig"),cr.prototype),dt(cr.prototype,"updateSendParameters",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"updateSendParameters"),cr.prototype),dt(cr.prototype,"replaceTrack",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"replaceTrack"),cr.prototype),dt(cr.prototype,"muteLocal",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"muteLocal"),cr.prototype),dt(cr.prototype,"unmuteLocal",[Yl],Object.getOwnPropertyDescriptor(cr.prototype,"unmuteLocal"),cr.prototype),cr);function Yl(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return await o.apply(this,f)}finally{u()}},i}let $u=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var b9,w9,R9,C9,I9,A9,O9,P9,N9,k9,D9,Tr;function L9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function JA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?L9(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):L9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let mme=(b9=qu($u.SEND_ONLY),w9=qu($u.SEND_ONLY),R9=qu(),C9=qu($u.RECEIVE_ONLY),I9=qu($u.RECEIVE_ONLY),A9=qu($u.RECEIVE_ONLY),O9=qu($u.RECEIVE_ONLY),P9=qu($u.RECEIVE_ONLY),N9=qu($u.RECEIVE_ONLY),k9=qu(),D9=qu($u.RECEIVE_ONLY),Tr=class extends Rr{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(bt.StateChange,n,this._state)}constructor(e,n){super(),z(this,"isPlanB",!1),z(this,"store",void 0),z(this,"statsUploader",void 0),z(this,"sendConnection",void 0),z(this,"recvConnection",void 0),z(this,"localTrackMap",new Map),z(this,"remoteUserMap",new Map),z(this,"localDataChannels",[]),z(this,"pendingLocalTracks",[]),z(this,"pendingRemoteTracks",[]),z(this,"statsCollector",void 0),z(this,"dtlsFailedCount",0),z(this,"sendMutex",void 0),z(this,"recvMutex",void 0),z(this,"_state",Vn.Disconnected),z(this,"_restartStates",["disconnected","failed"]),z(this,"reconnectInterval",void 0),z(this,"uploadUnplinkStarted",!1),z(this,"uploadDownlinkStarted",!1),z(this,"uplinkStateUploadInterval",void 0),z(this,"downlinkStatsUploadInterval",void 0),z(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Vn.Connected)return void c(new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const v=_.find(P=>P[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(P=>{let[,{id:F}]=P;return F}));let y=!1;var h,f;i.trackMediaType==="video"?y=!((h=this.localTrackMap.get(Ve.LocalAudioTrack))===null||h===void 0||!h.track._muted):y=((f=this.localTrackMap.get(Ve.LocalVideoTrack))===null||f===void 0?void 0:f.id)===void 0;const w=this.createMuteMessage(_);await tr(this,bt.RequestMuteLocal,w);const I=i.trackMediaType==="video"?qf.MUTE_LOCAL_VIDEO:qf.MUTE_LOCAL_AUDIO;await tr(this,bt.RequestP2PMuteLocal,{action:I,message:w,isMuteAll:y}),o()}catch(_){c(_)}finally{u()}}),z(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Vn.Connected)return void c(new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:y}]=v;return y}));const f=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?qf.UNMUTE_LOCAL_VIDEO:qf.UNMUTE_LOCAL_AUDIO;await tr(this,bt.RequestP2PMuteLocal,{action:_,message:f}),o()}catch(h){c(h)}finally{u()}}),z(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==Vn.Connected)return void o();const{id:v,track:y}=_;v&&(await this.sendConnection.updateSendParameters(v,y),await this.sendConnection.updateEncoderConfig(v,y),this.emit(bt.UpdateVideoEncoder,y)),o()}catch(_){c(_)}finally{var f;(f=h)===null||f===void 0||f()}}),z(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Vn.Connected)return void o();const{id:f,track:_}=h;f&&await this.sendConnection.updateSendParameters(f,_),o()}catch(h){c(h)}finally{u()}}),z(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;N.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find(y=>{let[,{track:w}]=y;return i===w});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Vn.Connected)return void o();if(await((f=this.sendConnection)===null||f===void 0?void 0:f.replaceTrack(i,v[1].id)),v[0]===Ve.LocalVideoTrack&&In().supportDualStreamEncoding){const y=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(y){const w=i._mediaStreamTrack.clone();y.track._originMediaStreamTrack.stop(),y.track._mediaStreamTrack=w,y.track._originMediaStreamTrack=w,await new tt((I,P)=>{this.handleReplaceTrack(y.track,I,P,!0)})}}o()}catch(v){c(v)}finally{var _;(_=h)===null||_===void 0||_()}}),z(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),z(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),z(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),z(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new Qz(e),this.bindStatsUploaderEvents(),this.sendMutex=new ms("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new ms("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},Q("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,n){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,n){let i;try{if(n){this.recvConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new T9(e,this.store,co.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(n);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Vn.New,this.sendConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new T9(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Vn.Connected}async addRemoteCandidate(e,n){if(n===co.RECEIVE_ONLY){if(!this.sendConnection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,n,i){var o=this;return Yc(function*(){const c=yield En(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Vn.Connected){o.throwIfTrackTypeNotMatch(e);const v=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(v))}o.store.pubId=o.store.pubId+1,Es.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,n,i);if(u.length===0)return void(yield En(o.tryToUnmuteAudio(e)));u.forEach(v=>{let{track:y,type:w}=v;const I=Date.now();o.store.publish(y.getTrackId(),w===Ve.LocalAudioTrack?"audio":"video",I)}),o.bindLocalTrackEvents(u);const h=yield En(o.sendConnection.send(u.map(v=>{let{track:y}=v;return y}),o.store.codec,o.store.audioCodec)),f=(yield En(h.next())).value,_=o.createGatewayPublishMessage(u,f);try{yield _}catch(v){throw h.throw(v),(v==null?void 0:v.code)===Y.WS_ABORT&&u.forEach(y=>{let{track:w}=y;o.pendingLocalTracks.indexOf(w)===-1&&o.pendingLocalTracks.push(w)}),o.unbindLocalTrackEvents(u),v}yield En(h.next()),u.forEach(v=>{let{type:y}=v;o.statsCollector.addLocalStats(y)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,f),u.forEach(v=>{let{track:y,type:w}=v;const I=Date.now();o.store.publish(y.getTrackId(),w===Ve.LocalAudioTrack?"audio":"video",void 0,I)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Vn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!Xe(e).call(e,c)));const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(n);if(await this.sendConnection.stopSending(n.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),n.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Vn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const n=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const f={stream_type:ope(u,c),ssrcs:h};u._muted||!u._enabled?n.push(f):i.push(f)}),n.length>0&&n.forEach(o=>{tr(this,bt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{tr(this,bt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Yc(function*(){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ls(this,bt.RequestRePublish,this.pendingLocalTracks),this.emit(bt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,n,i,o){var c;if(!this.recvConnection)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(n))return;const{track:u,mid:h,transceiver:f}=await this.recvConnection.receive(n,[{ssrcId:i}],String(e.uid),o);n===at.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Zv(u,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Qv(u,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(n,h):this.remoteUserMap.set(e,new Map([[n,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:w,kind:I}=y;return w.uid===e.uid&&n===I});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(bt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,n,i,o){if(!this.recvConnection)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(n,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:f}=u;return n!==void 0?h.uid===e.uid&&n===f:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var f;if(h===at.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(h===at.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,n);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:f}]=u;var _,v;if(f===at.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===at.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(f===at.AUDIO){var y;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((y=h._audioTrack)===null||y===void 0||y._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;tr(this,bt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(n=>{let[,i]=n;[at.VIDEO,at.AUDIO].forEach(o=>{i.has(o)?tr(this,bt.RequestP2PUnmuteRemote,o):tr(this,bt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===at.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}getAllTracks(e){const n=this.localTrackMap.get(Ve.LocalAudioTrack);if((n==null?void 0:n.track)instanceof Ei){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ve.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ve.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ve.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get(Ve.LocalAudioTrack),f=o?this.localTrackMap.get(Ve.LocalVideoLowTrack):this.localTrackMap.get(Ve.LocalVideoTrack);Et.publish(this.store.sessionId,{eventElapse:Es.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(rr.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Ur),f=o?(u=this.localTrackMap.get(Ve.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof hr);Et.publish(this.store.sessionId,{eventElapse:Es.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(rr.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===at.VIDEO?i._videoSSRC:i._audioSSRC;c&&Et.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===at.VIDEO,audio:o===at.AUDIO,peerid:i.uid,subscribeRequestid:o===at.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Es.measureFromSubscribeStart(this.store.clientId,c)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ms("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ms("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ve.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ei){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Vn.Disconnected}getStats(e){var n,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(n=this.sendConnection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.recvConnection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof hr||n&&n.track instanceof Ur?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(fc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(Ve.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=n0(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Vn.Reconnecting,Q("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case Ve.LocalVideoTrack:Xe(n=o._hints).call(n,rr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ve.LocalAudioTrack:o instanceof Ei?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ve.LocalVideoLowTrack:}}),this.emit(bt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(fc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(bt.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Zf?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}async restartICE(e,n){let i,o;if(e===co.SEND_ONLY){if(!this.sendConnection)throw new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(n){const c=await o.restartICE(n);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await ls(this,bt.RequestP2PRestartICE,{direction:co.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),n=this.localTrackMap.get(Ve.LocalVideoTrack),i=this.localTrackMap.get(Ve.LocalAudioTrack),o=e.videoSend.find(P=>{var F;return P.ssrc===(n==null||(F=n.ssrcs)===null||F===void 0?void 0:F[0].ssrcId)}),c=e.audioSend.find(P=>{var F;return P.ssrc===(i==null||(F=i.ssrcs)===null||F===void 0?void 0:F[0].ssrcId)});if(!o||!c)return 1;const u=hc(this,bt.NeedSignalRTT),h=o?o.rttMs:void 0,f=c?c.rttMs:void 0,_=h&&f?(h+f)/2:h||f,v=(_&&u?(_+u)/2:_||u)||0,y=100*e.sendPacketLossRate*.7/50+.3*v/1500,w=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,I=n==null?void 0:n.track;if(I&&I._encoderConfig&&I._hints.indexOf(rr.SCREEN_TRACK)===-1){const P=I._encoderConfig.bitrateMax,F=e.bitrate.actualEncoded;if(P&&F){const x=(1e3*P-F)/(1e3*P);return MG[x<.15?0:x<.3?1:x<.45?2:x<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(F=>F.ssrc===c),f=e.videoRecv.find(F=>F.ssrc===u);if(!h&&!f)return void(n+=1);const _=hc(this,bt.NeedSignalRTT),v=e.rtt,y=(v&&_?(v+_)/2:v||_)||0,w=h?h.jitterMs:void 0,I=e.recvPacketLossRate;let P=.7*I*100/50+.3*y/1500;w&&(P=.6*I*100/50+.2*y/1500+.2*w/400),n+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new tt((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}filterTobePublishedTracks(e,n,i){const o=[],c=In(),u=this.getAllTracks();e=Fv(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,f=!1;for(const _ of e){if(_ instanceof hr&&(this.localTrackMap.has(Ve.LocalVideoTrack)||h?new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ve.LocalVideoTrack}),h=!0),n)){const v=this.getLowVideoTrack(_,i);o.push({track:v,type:Ve.LocalVideoLowTrack})}if(_ instanceof Ur){const v=this.localTrackMap.get(Ve.LocalAudioTrack);if(v){if(!(v.track instanceof Ei))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(f){const y=o.find(w=>{let{type:I}=w;return I===Ve.LocalAudioTrack});if(!(y.track instanceof Ei))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ei||_._bypassWebAudio)o.push({track:_,type:Ve.LocalAudioTrack});else{const y=new Ei;y.addAudioTrack(_),o.push({track:y,type:Ve.LocalAudioTrack})}f=!0}}}return o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=Fv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Ur){const c=this.localTrackMap.get(Ve.LocalAudioTrack);if(!c)continue;c.track instanceof Ei?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([Ve.LocalAudioTrack,c]),c.track.close())):n.push([Ve.LocalAudioTrack,c])}if(o instanceof hr){const c=this.localTrackMap.get(Ve.LocalVideoTrack);if(!c)continue;n.push([Ve.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);u&&n.push([Ve.LocalVideoLowTrack,u])}}return n}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Ve.LocalVideoTrack:i.addListener(lt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(lt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof Ei?e.trackList.forEach(i=>{i.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(lt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(lt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||e.addListener(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Ve.LocalVideoTrack:i.off(lt.GET_STATS,this.handleGetLocalVideoStats),i.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(lt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(lt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ei?e.trackList.forEach(n=>{n.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(lt.GET_STATS,this.handleGetLocalAudioStats),n.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(lt.GET_STATS,this.handleGetLocalAudioStats),e.off(lt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(lt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(lt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(lt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(lt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof Qv&&n.addListener(lt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof Zv&&n.addListener(lt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(lt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(at.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(at.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,{track:h,type:f}=i;switch(f){case Ve.LocalAudioTrack:u=Fn.Audio;break;case Ve.LocalVideoTrack:u=Xe(c=h._hints).call(c,rr.SCREEN_TRACK)?Fn.Screen:Fn.High;break;case Ve.LocalVideoLowTrack:u=Fn.Low}return{kind:f===Ve.LocalAudioTrack?at.AUDIO:at.VIDEO,stream_type:u,mid:n[o].id,ssrcs:n[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,rr.SCREEN_TRACK)?Fn.Screen:Fn.High;break;case Ve.LocalAudioTrack:o=Fn.Audio;break;case Ve.LocalVideoLowTrack:o=Fn.Low}return{stream_type:o,ssrcs:h,mid:f}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{var i;N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(n,")")),this.emit(bt.PeerConnectionStateChange,n),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(e.isInRestartIce=!1),Xe(i=this._restartStates).call(i,n)&&!e.isInRestartIce&&(n==="disconnected"&&await Hi(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),Et.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:kr.TRACER}).onSuccess(),this.emit(bt.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(fc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit($v.FIRST_FRAME_DECODED),Et.firstRemoteFrame(this.store.sessionId,Ii.FIRST_AUDIO_DECODE,yr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Es.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(fc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&Et.firstRemoteFrame(this.store.sessionId,Ii.FIRST_AUDIO_RECEIVED,yr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Es.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(fc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&Et.firstRemoteFrame(this.store.sessionId,Ii.FIRST_VIDEO_RECEIVED,yr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Es.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(bt.ConnectionTypeChange,o),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xf(i))," -> ").concat(JSON.stringify(Xf(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xf(i))," -> ").concat(JSON.stringify(Xf(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.onLocalCandidate=n=>{this.emit(bt.LocalCandidate,{candidate:n,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const n=e===co.SEND_ONLY?this.sendConnection:this.recvConnection;n&&!n.isInRestartIce&&(n.isInRestartIce=!0,N.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(n.name,"] start use restartICE")),e===co.SEND_ONLY?this.restartICE(e):ls(this,bt.RequestP2PRestartICE,{direction:co.SEND_ONLY}))}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof Ur&&(i==null?void 0:i.track)instanceof Ei)return i.track.isActive||n.push([Ve.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===Ve.LocalVideoTrack)){const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&n.push([Ve.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof Ur&&(i==null?void 0:i.track)instanceof Ei)return i.track.isActive&&n.push([Ve.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ve.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&n.push([Ve.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Ve.LocalAudioTrack:o=Fn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,rr.SCREEN_TRACK)?Fn.Screen:Fn.High;break;case Ve.LocalVideoLowTrack:o=Fn.Low}return{stream_type:o,ssrcs:h,mid:f}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:f}]=n;switch(c){case Ve.LocalAudioTrack:o=Fn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,rr.SCREEN_TRACK)?Fn.Screen:Fn.High;break;case Ve.LocalVideoLowTrack:o=Fn.Low}return{stream_type:o,ssrcs:h,mid:f}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case at.VIDEO:return void(o._videoSSRC&&n.push({stream_type:at.VIDEO,ssrcId:o._videoSSRC}));case at.AUDIO:return void(o._audioSSRC&&n.push({stream_type:at.AUDIO,ssrcId:o._audioSSRC}))}}),n}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(Ve.LocalVideoTrack),i=this.localTrackMap.get(Ve.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new tt((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new tt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,n=this.recvConnection.peerConnectionState;return e!=="connected"&&n!=="connected"}return!0}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Ur){const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await tr(this,bt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:n}]=e;return!!n}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.recvConnection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(bt.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(bt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Hi(I1(this.dtlsFailedCount,pi)),this.emit(bt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ve.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof hr)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof hr).length>1)throw new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Ur).length>1&&(e.some(n=>n instanceof Ur&&n._bypassWebAudio)||!In().webAudioMediaStreamDest))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof hr&&this.pendingLocalTracks.some(i=>i instanceof hr))throw new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Ur&&this.pendingLocalTracks.some(i=>i instanceof Ur)&&(!In().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Ur&&i._bypassWebAudio)))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){const i=!Q("DISABLE_DUAL_STREAM_USE_ENCODING")&&In().supportDualStreamEncoding,o=JA(JA({},{width:160,height:120,framerate:15,bitrate:50}),n);let c;c=i?e._mediaStreamTrack.clone():ML(e,o);const u=nr(8,"track-low-"),h=new hr(c,JA(JA({},i&&{scaleResolutionDownBy:EL(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(qg.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,Hv.LOW_STREAM)}),h._hints.push(rr.LOW_STREAM),e.addListener(lt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(fc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");Et.firstRemoteVideoDecode(this.store.sessionId,Ii.FIRST_VIDEO_DECODE,yr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Es.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ce(Y.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ce(Y.NOT_SUPPORTED)}async subscribeDataChannel(e,n){throw new Ce(Y.NOT_SUPPORTED)}async unsubscribeDataChannel(e,n){throw new Ce(Y.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,n){throw new Ce(Y.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,n){throw new Ce(Y.NOT_SUPPORTED)}async preConnect(e){throw new Ce(Y.NOT_SUPPORTED)}getEstablishParams(){throw new Ce(Y.NOT_SUPPORTED)}async reSubscribe(e){throw new Ce(Y.NOT_SUPPORTED)}async updateVideoStreamParameter(e,n){throw new Ce(Y.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===Ve.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Hv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},dt(Tr.prototype,"p2pConnect",[b9],Object.getOwnPropertyDescriptor(Tr.prototype,"p2pConnect"),Tr.prototype),dt(Tr.prototype,"unpublish",[w9],Object.getOwnPropertyDescriptor(Tr.prototype,"unpublish"),Tr.prototype),dt(Tr.prototype,"unpublishLowStream",[R9],Object.getOwnPropertyDescriptor(Tr.prototype,"unpublishLowStream"),Tr.prototype),dt(Tr.prototype,"subscribe",[C9],Object.getOwnPropertyDescriptor(Tr.prototype,"subscribe"),Tr.prototype),dt(Tr.prototype,"mockSubscribe",[I9],Object.getOwnPropertyDescriptor(Tr.prototype,"mockSubscribe"),Tr.prototype),dt(Tr.prototype,"unsubscribe",[A9],Object.getOwnPropertyDescriptor(Tr.prototype,"unsubscribe"),Tr.prototype),dt(Tr.prototype,"muteRemote",[O9],Object.getOwnPropertyDescriptor(Tr.prototype,"muteRemote"),Tr.prototype),dt(Tr.prototype,"unmuteRemote",[P9],Object.getOwnPropertyDescriptor(Tr.prototype,"unmuteRemote"),Tr.prototype),dt(Tr.prototype,"hasRemoteMediaWithLock",[N9],Object.getOwnPropertyDescriptor(Tr.prototype,"hasRemoteMediaWithLock"),Tr.prototype),dt(Tr.prototype,"disconnectForReconnect",[k9],Object.getOwnPropertyDescriptor(Tr.prototype,"disconnectForReconnect"),Tr.prototype),dt(Tr.prototype,"remoteMediaSsrcChanged",[D9],Object.getOwnPropertyDescriptor(Tr.prototype,"remoteMediaSsrcChanged"),Tr.prototype),Tr);function qu(e){return function(n,i,o){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),f=0;f<u;f++)h[f]=arguments[f];switch(e){case $u.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case $u.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),v=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),v()}}}},o}}class m_ extends Rr{constructor(n,i){super(),z(this,"signal",void 0),z(this,"token",void 0),z(this,"tokenTimeout",void 0),z(this,"tokenInterval",void 0),z(this,"_sequence",0),z(this,"userMap",new Map),z(this,"encoder",new TextEncoder),this.signal=n,this.token=i;const o=()=>{this.signal.connectionState===or.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*Q("P2P_TOKEN_INTERVAL"))};o()}async send(n,i,o,c,u){var h,f,_;if(this.userMap.size===0)return;const v=Array.from(uc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(f=c)!==null&&f!==void 0?f:nr(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const y={_id:c,_type:n,_seq:u,_message:i,token:"".concat(this.token,"_").concat(v)};Q("SHOW_P2P_LOG")&&N.debug("send message",y,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(y)).forEach(I=>{this.signal.request(Dt.DATA_STREAM,{payload:Hf(this.encoder.encode(I))})});const w=new tt((I,P)=>{const F=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),x),this.off("res-@".concat(c),$),this.off(iy.ABORT,M),N.debug("[external-signal] request timeout, type: ".concat(n,", requestId: ").concat(c)),this.userMap.size===0?P(new Ce(Y.INVALID_REMOTE_USER)):P(new Ce(Y.TIMEOUT))},Q("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),x=()=>{F&&window.clearTimeout(F),this.off(iy.ABORT,M),o&&I()},M=()=>{F&&window.clearTimeout(F),this.off("res-@".concat(c,"_ack"),x),this.off("res-@".concat(c),$),P(new Ce(Y.EXTERNAL_SIGNAL_ABORT,"type: ".concat(n,", requestId: ").concat(c)))};this.once(iy.ABORT,M),this.once("res-@".concat(c,"_ack"),x);const $=(ae,me)=>{q=!0,F&&window.clearTimeout(F),this.off("res-@".concat(c,"_ack"),x),this.off(iy.ABORT,M),ae==="success"?I(me):P(new Ce(Y.P2P_MESSAGE_FAILED,"request ".concat(n," failed, requestId: ").concat(c)))};let q=!1;o||(this.once("res-@".concat(c),$),Hi(Q("SIGNAL_REQUEST_TIMEOUT")).then(()=>{q||N.warning("external_signal request timeout, type: ".concat(n,", requestId: ").concat(c,", ").concat(y))}))});try{return await w}catch(I){if(I.code===Y.TIMEOUT)return await this.send(n,i,o,c,u);throw I}}onMessage(n){var i;const{_uid:o}=n;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in n)||n._type!==qr.CHECK)return;const{token:v}=n;c=new Map,u={uid:o,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(cn.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in n&&"total"in n){var h;const{id:v,total:y}=n,w=(h=c.get(v))!==null&&h!==void 0?h:[];if(w.push(n),c.has(v)||c.set(v,w),w.length!==y)return;{const I=n0(w).call(w,(P,F)=>P.index-F.index).map(P=>P.payload).join("");c.delete(v),(n=JSON.parse(I))._uid=o}}const{_type:f,token:_}=n;if(Xe(i=[qr.ACK,qr.CHECK]).call(i,f))return f===qr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(n);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(n):N.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),n)}check(){const n={_id:nr(6,""),token:this.token,_type:qr.CHECK};Q("SHOW_P2P_LOG")&&N.debug("send message",n),this.signal.request(Dt.DATA_STREAM,{payload:Hf(this.encoder.encode(JSON.stringify(n)))})}ack(n){const i={_id:n,_type:qr.ACK,token:this.token};Q("SHOW_P2P_LOG")&&N.debug("send message",i),this.signal.request(Dt.DATA_STREAM,{payload:Hf(this.encoder.encode(JSON.stringify(i)))})}response(n,i,o){this.send(qr.RESPONSE,JSON.stringify({success:!o,message:i}),!0,n)}handleReceivedMessage(n){const i=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:y,nextExpectedSequenceNumber:w}=v;for(;y.has(w);){const I=y.get(w);y.delete(w),this.receiveMessage(I),v.nextExpectedSequenceNumber++}})};if(!n)return void i();const{_uid:o,_seq:c}=n,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:f,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(n._id),void N.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(n._message));h.set(c,n),f&&c===_&&(this.receiveMessage(n),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(n){const{_id:i,_type:o,_message:c,_uid:u}=n;if(Q("SHOW_P2P_LOG")&&N.debug("receive message",n),i){let h;switch(n._type!==qr.ACK&&(c&&(h=JSON.parse(c)),this.ack(n._id)),n._type){case qr.CANDIDATE:case qr.CONTROL:this.signal.emit(o,h,u);break;case qr.PUBLISH:case qr.UNPUBLISH:case qr.RESTART_ICE:case qr.CALL:h.uid=u,ls(this.signal,o,h).then(f=>{this.response(n._id,f)}).catch(()=>{this.response(n._id,void 0,!0)});break;case qr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case qr.RESPONSE:{const{success:f,message:_}=h;this.emit("res-@".concat(i),f?"success":"failed",_);break}}}}splitMessage(n){if(n.length<m_.MAX_MESSAGE_SIZE)return[n];const i=[],{remoteToken:o}=JSON.parse(n),c=nr(6,"");let u=0,h=800;const f=Math.ceil(n.length/h);for(;n.length>0;){u++;const _={id:c,index:u,total:f,payload:n.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>m_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),n=n.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(n,i){return n.token!==i?(N.debug("token changed, from ".concat(n.token," to ").concat(i)),this.reset(n.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{N.debug("token timeout, ".concat(i)),this.reset(n.uid)},Q("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const n=await ls(this.signal,qr.CALL,void 0),i=await this.send(qr.CALL,n);this.signal.emit(Lt.P2P_CONNECTION,i,!0)}async reset(n,i){const o=this.userMap.get(n);o&&(this.emit(iy.ABORT),this.signal.emit(cn.ON_USER_OFFLINE,{uid:o.uid,reason:Lhe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(N.debug("change local token from ".concat(i," to ").concat(i)),this.token=nr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(iy.ABORT)}}z(m_,"MAX_SIZE",1),z(m_,"MAX_MESSAGE_SIZE",1024);class gme extends Rr{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===or.CONNECTED?this.emit(Lt.WS_CONNECTED):n===or.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):n===or.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),z(this,"_disconnectedReason",void 0),z(this,"_websocketReconnectReason",void 0),z(this,"_connectionState",or.CLOSED),z(this,"reconnectToken",void 0),z(this,"p2pToken",void 0),z(this,"websocket",void 0),z(this,"openConnectionTime",void 0),z(this,"clientId",void 0),z(this,"lastMsgTime",Date.now()),z(this,"uploadCache",[]),z(this,"uploadCacheInterval",void 0),z(this,"rttRolling",new u6(5)),z(this,"pingpongTimer",void 0),z(this,"pingpongTimeoutCount",0),z(this,"joinResponse",void 0),z(this,"multiIpOption",void 0),z(this,"initError",void 0),z(this,"spec",void 0),z(this,"store",void 0),z(this,"_external_signal",void 0),z(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case cn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case cn.MUTE_AUDIO:case cn.MUTE_VIDEO:case cn.ON_P2P_LOST:case cn.ON_USER_ONLINE:return;case cn.ON_USER_OFFLINE:const{uid:u}=c._message;return N.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===cn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===cn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Un.UID_BANNED);break;case 15:this.close(Un.IP_BANNED);break;case 16:this.close(Un.CHANNEL_BANNED)}if(c._type===cn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Rt.ERR_LICENSE_MISSING:this.close(Un.LICENSE_MISSING);break;case Rt.ERR_LICENSE_EXPIRED:this.close(Un.LICENSE_EXPIRED);break;case Rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Un.LICENSE_MINUTES_EXCEEDED);break;case Rt.ERR_LICENSE_PERIOD_INVALID:this.close(Un.LICENSE_PERIOD_INVALID);break;case Rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Un.LICENSE_MULTIPLE_SDK_SERVICE);break;case Rt.ERR_LICENSE_ILLEGAL:this.close(Un.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new gL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Q("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Q("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===or.CONNECTED&&this.reconnect("retry",cs.OFFLINE)}),this.p2pToken=nr(6,""),this._external_signal=new m_(this,this.p2pToken)}async request(n,i,o,c){const u=nr(6,""),h={_id:u,_type:n,_message:i},f=this.websocket.connectionID,_=()=>new tt((F,x)=>{if(this.connectionState===or.CONNECTED)return F();const M=()=>{this.off(Lt.WS_CLOSED,$),F()},$=()=>{this.off(Lt.WS_CONNECTED,M),x(new Ce(Y.WS_ABORT))};this.once(Lt.WS_CONNECTED,M),this.once(Lt.WS_CLOSED,$)});if(this.connectionState!==or.CONNECTING&&this.connectionState!==or.RECONNECTING||n===Dt.JOIN||n===Dt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const v=new tt((F,x)=>{let M=!1;const $=(ae,me)=>{M=!0,F({isSuccess:ae==="success",message:me||{}}),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.emit(Lt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),$);const q=()=>{x(new Ce(Y.WS_ABORT,"type: ".concat(n))),this.off(Lt.WS_CLOSED,q),this.off(Lt.WS_RECONNECTING,q),this.off("res-@".concat(u),$)};this.once(Lt.WS_CLOSED,q),this.once(Lt.WS_RECONNECTING,q),Hi(Q("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||M||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(Lt.REQUEST_TIMEOUT,n,i))})});let y=null;try{y=await v}catch(F){if(this.connectionState===or.CLOSED||n===Dt.LEAVE)throw new Ce(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?F.throw():n===Dt.JOIN||n===Dt.REJOIN?null:(await _(),await this.request(n,i))}if(y.isSuccess)return y.message;const w=Number(y.message.error_code||y.message.code),I=A0(w),P=new Ce(Y.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(y.message.error_str),{code:w,data:y.message,desc:I.desc});return I.action==="success"?y.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(I.desc,", action: ").concat(I.action)),w===Rt.ERR_TOO_MANY_BROADCASTERS?((n===Dt.JOIN||n===Dt.REJOIN)&&(this.initError=P,this.close()),P.throw()):I.action==="failed"?P.throw():I.action==="quit"?(this.initError=P,this.close(),P.throw()):(w===Rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=y.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",cs.MULTI_IP)):this.reconnect(I.action,cs.SERVER_ERROR),n===Dt.JOIN||n===Dt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new tt(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(C0.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=Q("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==or.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Q("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(n,i,o){return await this._external_signal.send(n,i,o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tt((i,o)=>{this.once(Lt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Lt.WS_CLOSED,()=>o(this.initError||new Ce(Y.WS_ABORT))),this.connectionState=or.CONNECTING,this.websocket.init(n).catch(o)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=n||Un.LEAVE,this.connectionState=or.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=nr(6,""),this._external_signal.clear(),this._external_signal=new m_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION);const n=await ls(this,Lt.REQUEST_JOIN_INFO),i=await this.request(Dt.JOIN,n);if(!i)return this.emit(Lt.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleDataStream(n){try{var i;const o=Hg(n.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||Xe(i=Object.values(qr)).call(i,u._type)?(u._uid=n.uid,this._external_signal.onMessage(u)):this.emit(cn.ON_DATA_STREAM,n)}catch{this.emit(cn.ON_DATA_STREAM,n)}}handleNotification(n){N.debug("[".concat(this.clientId,"] receive notification: "),n);const i=A0(n.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Un.UID_BANNED),void this.close()):void this.reconnect(i.action,cs.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=Q("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(N.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>Q("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",cs.TIMEOUT):this.request(Dt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),Q("REPORT_STATS")&&this.send(Dt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Bt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Bt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Bt.CLOSED,()=>{this.connectionState=or.CLOSED}),this.websocket.on(Bt.FAILED,()=>{this._disconnectedReason=Un.NETWORK_ERROR,this.connectionState=or.CLOSED}),this.websocket.on(Bt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===or.CONNECTED?this.connectionState=or.RECONNECTING:this.connectionState=or.CONNECTING}),this.websocket.on(Bt.WILL_RECONNECT,(n,i,o)=>{n!=="retry"?(N.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0):N.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(n)}),this.websocket.on(Bt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(n=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof Ce&&n.code===Y.UNEXPECTED_RESPONSE&&n.data.code===Rt.ERR_NO_AUTHORIZED)return N.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",cs.SERVER_ERROR);N.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",cs.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Bt.REQUEST_NEW_URLS,(n,i)=>{ls(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Bt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const _me={name:"P2PChannel",create:function(e){let{store:n,statsCollector:i}=e;return new mme(n,i)},createSubmodule:function(e){let{store:n,spec:i}=e;return new gme(i,n)}};function x9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function M9(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?x9(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Eme{constructor(n){z(this,"sessionDesc",void 0),z(this,"localCapabilities",void 0),z(this,"rtpCapabilities",void 0),z(this,"candidates",void 0),z(this,"_originCandidates",void 0),z(this,"iceParameters",void 0),z(this,"dtlsParameters",void 0),z(this,"setup",void 0),z(this,"currentMidIndex",void 0),z(this,"cname",void 0),n=Dr(n);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:f,sdkCodec:_,cname:v}=n,y=ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Dr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=f,this.cname=v;for(let w=0;w<y.mediaDescriptions.length;w++){const I=y.mediaDescriptions[w];if(I.attributes.iceUfrag=i.iceUfrag,I.attributes.icePwd=i.icePwd,I.attributes.fingerprints=o.fingerprints,I.attributes.candidates=c,I.attributes.setup=h,I.media.mediaType==="video"){I.media.fmts=u.videoCodecs.map(F=>F.payloadType.toString(10));let P=u.videoCodecs.filter(F=>{var x,M;return(x=F.rtpMap)===null||x===void 0?void 0:Xe(M=x.encodingName.toLowerCase()).call(M,_)});P.length===0&&(P=u.videoCodecs),I.attributes.payloads=P,I.attributes.extmaps=u.videoExtensions}I.media.mediaType==="audio"&&(I.media.fmts=u.audioCodecs.map(P=>P.payloadType.toString(10)),I.attributes.payloads=u.audioCodecs,I.attributes.extmaps=u.audioExtensions),y.mediaDescriptions[w]=this.mungMediaDesc(I)}this.sessionDesc=y,this.currentMidIndex=y.mediaDescriptions.length-1}toString(){return Kf(this.sessionDesc)}send(n,i,o){const{ssrcs:c,ssrcGroups:u}=t_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>n===at.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),f=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:f,mslabel:_}}batchSend(n){return n.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(n){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{Xe(n).call(n,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var f;Xe(f=u.map(_=>_.ssrcId)).call(f,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(n,i,o){n.forEach((c,u)=>{const h=c._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],c);this.sessionDesc.mediaDescriptions[f]=_})}stopReceiving(n){}updateCandidates(n){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(M9(M9({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(n){case _s.TCP_RELAY:this.candidates=o;break;case _s.UDP_TCP_RELAY:case _s.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(n){n=Dr(n),this.iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let o=0;o<n;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(n,i){const o=Dr(n);return ay(o,i),yL(o,i),o}updateRecvMedia(n,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(n){this.currentMidIndex+=n}updateTrackLabel(n,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>n===at.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(f=>f.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(n){const i=Dr(n);return vL(i),function(o){const c=o.attributes.extmaps.find(u=>pA(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(n){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===n)return[o]}}var er;function U9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function QA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?U9(Object(i),!0).forEach(function(o){z(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):U9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let vme=(er=class Hb extends KG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return Xe(i=Object.keys(WI)).call(i,n)}))]}constructor(n,i){super(n,i),z(this,"store",void 0),z(this,"peerConnection",void 0),z(this,"remoteSDP",void 0),z(this,"initialOffer",void 0),z(this,"statsFilter",void 0),z(this,"useRTX",!1),z(this,"localCapabilities",void 0),z(this,"localCandidateCount",0),z(this,"allCandidatesReceived",!1),z(this,"establishPromise",void 0),z(this,"mutex",void 0),this.store=i,this.mutex=new ms("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Hb.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=D1(this.peerConnection,Q("STATS_UPDATE_INTERVAL"),void 0,Pr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const n=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Jf(n.sdp),o=N0(n.sdp,{filterRTX:!this.useRTX,filterVideoFec:Q("FILTER_VIDEO_FEC"),filterAudioFec:Q("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=n,QA(QA({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:n.sdp})}catch(n){throw new Ce(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async updateRemoteConnect(){}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Eme(QA(QA({},n),{},{rtpCapabilities:n.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(n,i){throw new Ce(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(n){}send(n,i){var o=this;return Yc(function*(){const c=yield En(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=n.map(I=>o.peerConnection.addTrack(I._mediaStreamTrack)),h=yield En(o.peerConnection.createOffer()),f=ca(h.sdp),_=n.map(I=>{const P=I._mediaStreamTrack,F=f.mediaDescriptions.find(x=>x.attributes.mid===P.kind);if(!F)throw new Error("Cannot extract ssrc from mediaDescription.");return function(x,M,$){const q=x.attributes.ssrcs.filter(me=>me.attributes.label===M),ae=x.attributes.ssrcGroups;if(q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ae&&q.length>1){const me=ae.find(ge=>ge.ssrcIds.indexOf(q[0].ssrcId)!==-1);return me?[{ssrcId:me.ssrcIds[0],rtx:$?me.ssrcIds[1]:void 0}]:[{ssrcId:q[0].ssrcId}]}return[{ssrcId:q[0].ssrcId}]}(F,P.id,o.useRTX)});let v;try{v=yield _}catch(I){throw u.forEach(P=>{as()&&P.replaceTrack(null),o.peerConnection.removeTrack(P)}),I}const y=o.mungSendOfferSDP(h.sdp,n);o.remoteSDP.receive(n,i,v);const w=o.remoteSDP.toString();return yield En(o.peerConnection.setLocalDescription({type:"offer",sdp:y})),yield En(o.applySendEncodings(u,n)),yield En(o.peerConnection.setRemoteDescription({type:"answer",sdp:w})),n.map((I,P)=>{const F=I._mediaStreamTrack.id;return{localSSRC:_[P],id:F}})}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{as()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(n);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(n,i,c),f=new tt((y,w)=>{const I=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(u)))},1e4),P=F=>{const x=vn();if((x.name==="Safari"&&Number(x.version)===11||so())&&F.track.id!==u&&F.streams[0].id===h){var M;const $=F.streams[0].getTracks()[0];return(M=this.remoteSDP)===null||M===void 0||M.updateTrackLabel(n,u,F.track.id),this.peerConnection.removeEventListener("track",P),clearTimeout(I),void y($)}if(F.track.id===u)return this.peerConnection.removeEventListener("track",P),clearTimeout(I),void y(F.track)};this.peerConnection.addEventListener("track",P)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await f,id:u}}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){}async unmuteRemote(n){}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return n.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==n.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(as()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(as()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(f=>f.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return Yc(function*(){const o=yield En(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=In().supportPCSetConfiguration;if(n===_s.RELAY&&!c)return;if(c){const v=i.peerConnection.getConfiguration(),y=n===_s.RELAY?"relay":"all";v.iceTransportPolicy!==y&&(N.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(y,"]")),v.iceTransportPolicy=y,i.peerConnection.setConfiguration(v))}n!==_s.RELAY&&i.remoteSDP.updateCandidates(n);const u=yield En(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Jf(u.sdp),{remoteIceParameters:f}=yield h.iceParameters;i.remoteSDP.restartICE(f);const _=i.remoteSDP.toString();yield En(i.peerConnection.setLocalDescription(u)),yield En(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){N.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var n;this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ce(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===n});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(n._mediaStreamTrack)}createDataChannels(n,i){throw new Ce(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new Ce(Y.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Q("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(E0(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Hb.turnServerConfigToIceServers(n.turnServer.servers)),Q("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Hb.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(v=>{var y;return((y=v.track)===null||y===void 0?void 0:y.id)===n._mediaStreamTrack.id})),!i)return N.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!In().supportSetRtpSenderParameters)return N.warn("Browser not support set rtp-sender parameters");const c={},u={};if(n instanceof hr)switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(Q("DSCP_TYPE")&&lp()){var h;const v=Q("DSCP_TYPE");Xe(h=["very-low","low","medium","high"]).call(h,v)&&(u.networkPriority=v)}const f=i.getParameters(),_=(o=f.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(f,c),N.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await i.setParameters(f)}async applySendEncodings(n,i){try{if(!In().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i){const o=ca(n);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,f=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);f&&ay(f,c)}),Kf(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(n).map((u,h)=>{let{id:f,mslabel:_}=u;const{kind:v}=n[h];return new tt((y,w)=>{const I=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(f)))},1e4),P=F=>{const x=vn();if(x.name==="Safari"&&Number(x.version)===11&&F.track.id!==f&&F.streams[0].id===_){var M;const $=F.streams[0].getTracks()[0];return(M=this.remoteSDP)===null||M===void 0||M.updateTrackLabel(v,f,F.track.id),this.peerConnection.removeEventListener("track",P),clearTimeout(I),void y({track:$,id:f})}if(F.track.id===f)return this.peerConnection.removeEventListener("track",P),clearTimeout(I),void y({track:F.track,id:f})};this.peerConnection.addEventListener("track",P)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await tt.all(i)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i==null?void 0:i[0].ssrcId}setConfiguration(n){if(In().supportPCSetConfiguration){const i=Hb.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},dt(er.prototype,"connect",[rl],Object.getOwnPropertyDescriptor(er.prototype,"connect"),er.prototype),dt(er.prototype,"stopSending",[rl],Object.getOwnPropertyDescriptor(er.prototype,"stopSending"),er.prototype),dt(er.prototype,"receive",[rl],Object.getOwnPropertyDescriptor(er.prototype,"receive"),er.prototype),dt(er.prototype,"stopReceiving",[rl],Object.getOwnPropertyDescriptor(er.prototype,"stopReceiving"),er.prototype),dt(er.prototype,"muteRemote",[rl],Object.getOwnPropertyDescriptor(er.prototype,"muteRemote"),er.prototype),dt(er.prototype,"unmuteRemote",[rl],Object.getOwnPropertyDescriptor(er.prototype,"unmuteRemote"),er.prototype),dt(er.prototype,"muteLocal",[rl],Object.getOwnPropertyDescriptor(er.prototype,"muteLocal"),er.prototype),dt(er.prototype,"unmuteLocal",[rl],Object.getOwnPropertyDescriptor(er.prototype,"unmuteLocal"),er.prototype),dt(er.prototype,"close",[rl],Object.getOwnPropertyDescriptor(er.prototype,"close"),er.prototype),dt(er.prototype,"updateEncoderConfig",[rl],Object.getOwnPropertyDescriptor(er.prototype,"updateEncoderConfig"),er.prototype),dt(er.prototype,"updateSendParameters",[rl],Object.getOwnPropertyDescriptor(er.prototype,"updateSendParameters"),er.prototype),dt(er.prototype,"replaceTrack",[rl],Object.getOwnPropertyDescriptor(er.prototype,"replaceTrack"),er.prototype),dt(er.prototype,"getRemoteSSRC",[rl],Object.getOwnPropertyDescriptor(er.prototype,"getRemoteSSRC"),er.prototype),er);function rl(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,f=new Array(h),_=0;_<h;_++)f[_]=arguments[_];return await o.apply(this,f)}finally{u()}},i}const yme={name:"PlanBConnection",create:function(e){let{store:n,spec:i}=e;return new vme(i,n)}},Sme={interceptLocalAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!In().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(JI.has(e)||!e.track)return;const i={track:e.track};if(cp()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void N.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){i.controller||(i.controller=f),e.track&&e.track.id!==i.track.id&&(N.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=n.metadata&&n.metadata();_?function(v,y){const{chunk:w,controller:I}=y,P=Q("ENABLE_AUDIO_PTS_METADATA")?pp.AUDIO_64_BIT_PTS:pp.METADATA;w.data=function(F,x,M){const $=M.byteLength,q=$+rL+PG,ae=tL+nL+q,me=new ArrayBuffer(F.byteLength+ae),ge=new DataView(me);ge.setUint8(0,OG),ge.setUint16(1,q),ge.setUint8(3,x),ge.setUint16(4,$);for(let we=0;we<$;we++)ge.setUint8(6+we,M[we]);const pe=new Uint8Array(ge.buffer);return pe.set(new Uint8Array(F),ae),pe.buffer}(w.data,P,v),I.enqueue(w)}(_,{chunk:h,controller:f}):f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(as()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const c=XI(),u=new MessageChannel;await new tt(f=>c.onmessage=_=>{_.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new tt(f=>c.onmessage=_=>{_.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var _;if(f.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)N.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(f.data.getMetadata){const v=n.metadata&&n.metadata();v&&u.port1.postMessage({metadata:v})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=JI.get(e);if(c){JI.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){N.warning(f&&f.message)}}}JI.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!In().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(rA.has(e))return;const i={track:e.track,onMetadata:n.onMetadata};if(cp()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");m1(Dn.CHROME,87,116)||(n.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void N.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){i.controller||(i.controller=f),e.track&&e.track.id!==i.track.id&&(N.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),n.enableTopn?function(_,v,y){var w;const I=NG(new DataView(v.data));if(!I)return y.enqueue(v);const P=_.track.id;the.set(P,_.track);const F=(w=I.tlv.find(me=>me.tag===pp.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let x=0;typeof F=="number"&&(x=127-F);const M=Math.round(Math.pow(10,x/60)-1),{selected:$,speaker:q}=function(me,ge){let pe=ey.get(me);if(pe||(pe=function(we){const Be=new DG;return ey.set(we,Be),Wu||(Wu=new Zde(Q("TOPN_SILENCE_THRESHOLD")||500),Wu.on("ActiveSpeakerChanged",nt=>{nt!=null&&(eA=nt)})),Wu.addSpeakers([Be]),Be}(me)),ey.size<=LG)return{selected:!0,speaker:pe};if(!Wu)throw new Error("no active speaker detector");return Wu.levelChanged(pe.id,ge),Qg=Wu.loudest.map(we=>we.id),eA&&!Xe(Qg).call(Qg,eA)&&Qg.length>=LG&&Qg.pop(),{selected:Xe(Qg).call(Qg,pe.id)||pe.id===eA,speaker:pe}}(_,M),ae=function(me,ge,pe){const we=Gu.get(me)||new ehe(me,ge);return we.score=pe,Gu.set(me,we),function(Be){if(tA.set(Be,!0),!nA)return void(nA=Date.now());const nt=Date.now();nt-nA>1e3&&(tA.get(Be)?tA.set(Be,!1):(xG(Be),tA.delete(Be)),nA=nt)}(me),we}(P,_.track,q.energyScore);ae.addSample($),ae.active&&(v.data=I.frame.buffer,y.enqueue(v))}(e,h,f):n.enableMetadata?function(_,v,y){const w=NG(new DataView(_.data));if(!w)return v.enqueue(_);const I=w.tlv.find(P=>P.tag===pp.METADATA||P.tag===pp.AUDIO_64_BIT_PTS);I&&y&&I.value instanceof Uint8Array&&y(I.value),_.data=w.frame.buffer,v.enqueue(_)}(h,f,n.onMetadata):f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(as()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const c=XI(),u=new MessageChannel;await new tt(f=>c.onmessage=_=>{_.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new tt(f=>c.onmessage=_=>{_.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var _;f.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(N.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):f.data.metadata&&i.onMetadata&&i.onMetadata(f.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=rA.get(c);if(u){(function(_){const v=ey.get(_);v&&(ey.delete(_),Wu&&(Wu.removeSpeakers([v]),ey.size===0&&(Wu.destroy(),Wu=null)))})(c),xG(c.track.id),rA.delete(c);try{var h,f;(h=u.controller)===null||h===void 0||h.terminate(),(f=u.worker)===null||f===void 0||f.terminate()}catch(_){N.warning(_&&_.message)}}}(e)}rA.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,n){if(!In().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(iA.has(e)||!e.track)return;const i={track:e.track};if(cp()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(f){return void N.error("create video-encoded-streams error",f&&f.message)}const u=[];n.on("sei-to-send",f=>{u.push(f)});const h=new TransformStream({transform(f,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(N.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const v=u.shift();v&&(f.data=function(y,w){const I=function(q){const ae=q.length;let me=[],ge=0;for(;ge<ae;)ge+2<ae&&q[ge]===0&&q[ge+1]===0&&(q[ge+2]===0||q[ge+2]===1||q[ge+2]===2||q[ge+2]===3)?(me.push(q[ge],q[ge+1],3,q[ge+2]),ge+=3):(me.push(q[ge]),ge++);return new Uint8Array(me)}(w),P=I.length,F=Math.floor(P/255),x=P%255,M=new Uint8Array(6+F+1+P+y.byteLength);M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=6,M[5]=101;let $=0;for(;$<F;)M[6+$]=255,$++;return M[6+$]=x,$++,M.set(I,6+$),M.set(new Uint8Array(y),6+$+P),M.buffer}(f.data,v)),_.enqueue(f)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!as())return;{if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const c=XI(),u=new MessageChannel;await new tt(f=>c.onmessage=_=>{_.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new tt(f=>c.onmessage=_=>{_.data==="started"&&f(void 0)}),n.on("sei-to-send",f=>{u.port1.postMessage({sei:f})}),u.port1.onmessage=f=>{var _;f.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(N.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=iA.get(e);if(c){iA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){N.warning(f&&f.message)}}}iA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!In().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(!e.track)return;if(R0.has(e)){const c=R0.get(e);return void(c&&(c.onSei=n.onSei))}const i={track:e.track,onSei:n.onSei};if(cp()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void N.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,f){i.controller||(i.controller=f),e.track&&e.track.id!==i.track.id&&(N.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(v){const y=new DataView(v.data);let w=0;for(;w+4<v.data.byteLength;){if(y.getUint8(w+0)===0&&y.getUint8(w+1)===0&&y.getUint8(w+2)===0&&y.getUint8(w+3)===1&&y.getUint8(w+4)===6){let I=w+6,P=0,F=0;for(;(F=y.getUint8(I++))===255;)P+=255;P+=F;const x=nhe(v.data,I,P);return new Uint8Array(x)}w++}return null}(h);_&&i.onSei&&i.onSei(_),f.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(as()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const c=XI(),u=new MessageChannel;await new tt(f=>c.onmessage=_=>{_.data==="registered"&&f(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new tt(f=>c.onmessage=_=>{_.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var _;f.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(N.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):f.data.sei&&i.onSei&&i.onSei(f.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=R0.get(c);if(u){R0.delete(c);try{var h,f;(h=u.controller)===null||h===void 0||h.terminate(),(f=u.worker)===null||f===void 0||f.terminate()}catch(_){N.warning(_&&_.message)}}})(e)}R0.set(e,i),e.track.addEventListener("ended",o)}},Tme={name:"InterceptFrame",create:()=>Sme};L1(),Kn("PROCESS_ID","process-".concat(nr(8,""),"-").concat(nr(4,""),"-").concat(nr(4,""),"-").concat(nr(4,""),"-").concat(nr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void N.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();N.debug("Loading global parameters from cache",n),Object.keys(n).forEach(o=>{if(Object.prototype.hasOwnProperty.call(dr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;Bu[o]=c,dr[o]=c}})}catch(n){N.error("Error loading mutableParamsCache: ".concat(e),n.message)}}(),Array.isArray(Bu.AREAS)&&Bu.AREAS.length>0&&RL(Bu.AREAS,!0);const V9=(e,n,i)=>{N.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(n))),Kn(e,n,i)};Qf(Hfe,!1),Qf(qfe,!1),Qf(Ipe,!1),Qf(sme,!1),Qf(Wfe,!1),Qf(_me,!1),Qf(yme,!1),Qf(Tme,!1);const fi=function(e){const n=new Rr,i=e,o={getListeners:n.getListeners.bind(n),on:(c,u)=>(function(h,f){h===Bd.SECURITY_POLICY_VIOLATION&&E8(f,!0)}(c,u),n.on.bind(n)(c,u)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return _8(_8({},i),o)}({__TRACK_LIST__:zv,VERSION:Xc,BUILD:U1,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:V9,getParameter:Q,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let n=new RTCPeerConnection;const i=await async function(o){let c;return In().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(n);if(!i)return e;n.close(),n=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(n){throw new Te(Y.CREATE_OFFER_FAILED,n.toString&&n.toString()).print()}return e},checkSystemRequirements:function(){const e=Et.reportApiInvoke(null,{name:hi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:kr.TRACER});let n=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;n=!!(u&&h&&f),n&&v1()&&F5(75)&&new u().close()}catch(u){return N.error("check system requirement failed: ",u),!1}let i=!1;const o=vn();o.name===Dn.CHROME&&Number(o.version)>=58&&(Fu.engine.name!=="WebKit"||function(){const u=vn();if(DI()){if(u.os===Ci.MAC_OS)return!0;if(u.os===Ci.IOS){const h=Fu.os.version&&Fu.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===Dn.FIREFOX&&Number(o.version)>=56||o.name===Dn.OPERA&&Number(o.version)>=45||o.name===Dn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(so()||Vl())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||H5()||vn().name===Dn.QQ)&&(i=!0),N.debug("checkSystemRequirements, api:",n,"browser",i);const c=n&&i;return e.onSuccess(c),c},getDevices:function(e){return vc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return vc.getRecordingDevices(e)},getCameras:function(e){return vc.getCamerasDevices(e)},getElectronScreenSources:F6,getPlaybackDevices:function(e){return vc.getSpeakers(e)},createClient:function(){var e;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=nr(5,"client-"),o=Et.reportApiInvoke(null,{id:i,name:hi.CREATE_CLIENT,options:[n],tag:kr.TRACER});try{(function(c){Si(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Si(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Si(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&zi(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&Z5(c.turnServer),c.httpRetryConfig!==void 0&&Q5(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&Q5(c.websocketRetryConfig)})(n)}catch(c){throw o.onError(c),c}return(B5(16,0)||W5(16,0,!0))&&(n.codec==="vp9"&&(n.codec="vp8",N.debug("browser not support vp9, force use vp8")),Kn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),n.audioCodec===void 0&&(n.audioCodec="opus"),o.onSuccess(),new Ape(Kl(Kl({forceWaitGatewayResponse:!0},n),{},{role:Xe(e=["rtc","p2p"]).call(e,n.mode)?"host":n.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Q("CAMERA_CAPTURE_CONFIG"),i=nr(8,"track-cam-"),o=Et.reportApiInvoke(null,{id:i,tag:kr.TRACER,name:hi.CREATE_CAM_VIDEO_TRACK,options:[Sr({},e),n]});n&&(e.encoderConfig=n);const c=qI(e);let u=null;N.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await Ec({video:c},i)).getVideoTracks()[0]||null}catch(f){throw o.onError(f),f}if(!u){const f=new Ce(Y.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(f),f.throw(N)}e.optimizationMode&&eL(i,u,e,Vd(e.encoderConfig));const h=new Z1(u,e,c,e.scalabiltyMode?zI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),N.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const n=nr(8,"track-cus-"),i=Et.reportApiInvoke(null,{id:n,tag:kr.TRACER,name:hi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new hr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?zI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[rr.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),N.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof n=="object"?function(I){return Y6(I)}(n):void 0;i&&(n="auto");const o=nr(8,"track-scr-v-"),c=Et.reportApiInvoke(null,{id:o,tag:kr.TRACER,name:hi.CREATE_SCREEN_VIDEO_TRACK,options:[Sr({},e),n]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(I){const P={};I.screenSourceType&&(P.mediaSource=I.screenSourceType),I.extensionId&&cp()&&(P.extensionId=I.extensionId);const{displaySurface:F,selfBrowserSurface:x,surfaceSwitching:M,systemAudio:$,preferCurrentTab:q}=I;(f0(107)||g1(107)||_1(93))&&(F&&(Si(F,"displaySurface",["browser","window","monitor"]),P.displaySurface=F),x?(Si(x,"selfBrowserSurface",["exclude","include"]),P.selfBrowserSurface=x):P.selfBrowserSurface="include",M&&(Si(M,"surfaceSwitching",["exclude","include"]),P.surfaceSwitching=M)),(f0(105)||g1(105)||_1(91))&&$&&(Si($,"systemAudio",["exclude","include"]),P.systemAudio=$),(f0(94)||g1(94)||_1(80))&&q&&(P.preferCurrentTab=!0),I.electronScreenSourceId&&(P.sourceId=I.electronScreenSourceId);const ae=I.encoderConfig?W1(I.encoderConfig):null;return P.mandatory={chromeMediaSource:"desktop",maxWidth:ae?ae.width:void 0,maxHeight:ae?ae.height:void 0},ae&&(ae.frameRate&&(typeof ae.frameRate=="number"?(P.mandatory.maxFrameRate=ae.frameRate,P.mandatory.minFrameRate=ae.frameRate):(P.mandatory.maxFrameRate=ae.frameRate.max||ae.frameRate.ideal||ae.frameRate.exact||void 0,P.mandatory.minFrameRate=ae.frameRate.min||ae.frameRate.ideal||ae.frameRate.exact||void 0),P.frameRate=ae.frameRate),ae.width&&(P.width=ae.width),ae.height&&(P.height=ae.height)),P}(e);let h=null,f=null;const _=In();if(!_.supportShareAudio&&n==="enable"){const I=new Ce(Y.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(I),I.throw(N)}N.info("start create screen video track with config",e,"withAudio",n,"trackId",o);const v=_.supportShareAudio&&n!=="disable";try{const I=await Ec({screen:u,screenAudio:v?i||!0:void 0},o);h=I.getVideoTracks()[0]||null,f=I.getAudioTracks()[0]||null}catch(I){throw c.onError(I),I}if(!h){const I=new Ce(Y.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(I),I.throw(N)}if(!f&&n==="enable"){h&&h.stop();const I=new Ce(Y.SHARE_AUDIO_NOT_ALLOWED);return c.onError(I),I.throw(N)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(eL(o,h,e,e.encoderConfig&&W1(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const y=new hr(h,e.encoderConfig?W1(e.encoderConfig):{},e.scalabiltyMode?zI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[rr.SCREEN_TRACK]);if(!f)return c.onSuccess(y.getTrackId()),N.info("create screen video track success","video:",y.getTrackId()),y;const w=new Ur(f,void 0,nr(8,"track-scr-a-"),!1);return c.onSuccess([y.getTrackId(),w.getTrackId()]),N.info("create screen video track success","video:",y.getTrackId(),"audio:",w.getTrackId()),[y,w]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=Q("CAMERA_CAPTURE_CONFIG"),o=nr(8,"track-mic-"),c=nr(8,"track-cam-"),u=Et.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:kr.TRACER,name:hi.CREATE_MIC_AND_CAM_TRACKS,options:[e,n,i]});i&&(n.encoderConfig=i);const h=qI(n),f=X6(e);let _=null,v=null;N.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(n)));try{const I=await Ec({audio:f,video:h},"".concat(o,"-").concat(c));_=I.getAudioTracks()[0],v=I.getVideoTracks()[0]}catch(I){throw u.onError(I),I}if(!_||!v){const I=new Ce(Y.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(I),I.throw(N)}n.optimizationMode&&eL(c,v,n,Vd(n.encoderConfig));const y=new YI(_,e,f,o),w=new Z1(v,n,h,n.scalabiltyMode?zI(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return u.onSuccess([y.getTrackId(),w.getTrackId()]),N.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[y,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=nr(8,"track-mic-"),i=Et.reportApiInvoke(null,{id:n,tag:kr.TRACER,name:hi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=X6(e);let c=null;N.info("start create microphone audio track with config",JSON.stringify(e),"trackId",n);try{c=(await Ec({audio:o},n)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Ce(Y.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(N)}const u=new YI(c,e,o,n);return i.onSuccess(u.getTrackId()),N.info("create microphone audio track success, trackId:",n),u},createCustomAudioTrack:function(e){const n=nr(8,"track-cus-"),i=Et.reportApiInvoke(null,{id:n,tag:kr.TRACER,name:hi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Ur(e.mediaStreamTrack,e.encoderConfig?HI(e.encoderConfig):{},n,!1);return N.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var n;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(n=File.name)!==null&&n!==void 0?n:"File":c,cacheOnlineFile:i,encoderConfig:o},h=nr(8,"track-buf-"),f=Et.reportApiInvoke(null,{id:h,tag:kr.TRACER,name:hi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(Q("DISABLE_WEBAUDIO"))throw new Ce(Y.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");N.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(w,I){let P=null;if(typeof w=="string"){const x=MW.get(w);if(x)return N.debug("use cached audio resource: ",w),x;try{P=(await ju(()=>Do.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(M){throw new Ce(Y.FETCH_AUDIO_FILE_FAILED,M.toString())}}else P=await new tt((M,$)=>{const q=new FileReader;q.onload=ae=>{ae.target?M(ae.target.result):$(new Ce(Y.READ_LOCAL_AUDIO_FILE_ERROR))},q.onerror=()=>{$(new Ce(Y.READ_LOCAL_AUDIO_FILE_ERROR))},q.readAsArrayBuffer(w)});const F=await function(x){const M=Xv();return new tt(($,q)=>{M.decodeAudioData(x,ae=>{$(ae)},ae=>{q(new Ce(Y.DECODE_AUDIO_FILE_FAILED,ae.toString()))})})}(P);return typeof w=="string"&&I&&MW.set(w,F),F}(c,i)}catch(w){return f.onError(w),w.throw(N)}const v=new qde(c),y=new $de(_,v,o?HI(o):{},h);return N.info("create buffer source audio track success, trackId:",h),f.onSuccess(y.getTrackId()),y},setAppType:function(e){if(N.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw N.debug("Invalid appType"),new Te(Y.INVALID_PARAMS,"invalid app type",e);Kn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){N.setLogLevel(e)},enableLogUpload:function(){Q("USE_NEW_LOG")?Kn("UPLOAD_LOG",!0):N.enableLogUpload()},disableLogUpload:function(){Q("USE_NEW_LOG")?Kn("UPLOAD_LOG",!1):N.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Mz},checkAudioTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=Et.reportApiInvoke(null,{tag:kr.TRACER,name:hi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof Ur||e instanceof Zv)){const _=new Te(Y.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof Ur?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const f=Date.now();return new tt(_=>{const v=setInterval(()=>{const y=e.getVolumeLevel();u=y>u?y:u,h=y<h?y:h;const w=u-h>1e-4,I=Date.now()-f;if(w||I>n){clearInterval(v);const P=w,F={duration:I,deviceLabel:o,maxVolumeLevel:u,result:P};N.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(F))),i.onSuccess(F),_(P)}},200)})},checkVideoTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=Et.reportApiInvoke(null,{tag:kr.TRACER,name:hi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof hr||e instanceof Qv)){const w=new Te(Y.INVALID_TRACK,"the parameter is not a video track");return i.onError(w),w.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof hr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(as()||DI())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let f=0,_=0;try{const w=Date.now();f=await function(I,P,F,x){let M,$=0,q=null;return new tt((ae,me)=>{function ge(){$>x&&M&&(M(),ae($));const pe=F.getContext("2d");if(!pe){const nt=new Te(Y.UNEXPECTED_ERROR,"can not get canvas 2d context.");return N.error(nt.toString()),void me(nt)}pe.drawImage(I,0,0,160,120);const we=pe.getImageData(0,0,F.width,F.height),Be=Math.floor(we.data.length/3);if(q){for(let nt=0;nt<Be;nt+=3)if(we.data[nt]!==q[nt])return $+=1,void(q=we.data);q=we.data}else q=we.data}setTimeout(()=>{M&&(M(),ae($))},P),M=$1(()=>{ge()},30)})}(u,n,h,4),_=Date.now()-w}catch(w){throw i.onError(w),w}ppe===Dn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=f>4,y={duration:_,changedPicNum:f,deviceLabel:o,result:v};return N.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),i.onSuccess(y),v},setArea:RL,audioElementPlayCenter:Lo,resumeAudioContext:function(){Lo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Ppe.processExternalMediaAEC(e)},registerExtensions:function(e){const n=Q("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!Xe(n).call(n,i.name)&&n.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=N.extLog,o.reporter.hookApiInvoke=Et.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=Q(c)})}),V9("PLUGIN_INFO",n)},ChannelMediaRelayError:ny,ChannelMediaRelayEvent:mp,ChannelMediaRelayState:la,RemoteStreamFallbackType:jde,RemoteStreamType:Fde,ConnectionDisconnectedReason:Un,AudienceLatencyLevelType:gde,AREAS:Ln,preload:async function(e,n,i,o){return lH(e,n,i,o)}});return Object.defineProperties(fi,{onAudioAutoplayFailed:{get:()=>yc.onAudioAutoplayFailed,set:e=>{yc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>yc.onAutoplayFailed,set:e=>{yc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>fi._onSecurityPolicyViolation,set(e){fi._onSecurityPolicyViolation=e,E8(e)}},__CLIENT_LIST__:{get:()=>Q("SHOW_GLOBAL_CLIENT_LIST")?Zg:[]}}),vc.on(Yg.CAMERA_DEVICE_CHANGED,e=>{N.info("camera device changed",JSON.stringify(e)),fi.onCameraChanged&&fi.onCameraChanged(e),fi.safeEmit(Bd.CAMERA_CHANGED,e)}),vc.on(Yg.RECORDING_DEVICE_CHANGED,e=>{N.info("microphone device changed",JSON.stringify(e)),fi.onMicrophoneChanged&&fi.onMicrophoneChanged(e),fi.safeEmit(Bd.MICROPHONE_CHANGED,e)}),vc.on(Yg.PLAYOUT_DEVICE_CHANGED,e=>{N.debug("playout device changed",JSON.stringify(e)),fi.onPlaybackDeviceChanged&&fi.onPlaybackDeviceChanged(e),fi.safeEmit(Bd.PLAYBACK_DEVICE_CHANGED,e)}),Lo.onAutoplayFailed=()=>{N.info("detect audio element autoplay failed"),yc.onAudioAutoplayFailed&&yc.onAudioAutoplayFailed()},$n.on("autoplay-failed",()=>{N.info("detect webaudio autoplay failed"),yc.onAudioAutoplayFailed&&yc.onAudioAutoplayFailed(),fi.safeEmit(Bd.AUTOPLAY_FAILED)}),$n.on($i.STATE_CHANGE,(e,n)=>{N.info("audio context state changed: ".concat(n," => ").concat(e)),fi.onAudioContextStateChanged&&fi.onAudioContextStateChanged(e,n),fi.safeEmit(Bd.AUDIO_CONTEXT_STATE_CHANGED,e,n)}),ni.on(Vv.NETWORK_STATE_CHANGE,(e,n)=>{N.info("[network-indicator] network state changed, ".concat(n," => ").concat(e))}),window&&(window.__ARTC__=fi),fi})}(uP)),uP.exports}var q4e=$4e();const Vw=OS(q4e),Y4e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"},jre="a2a7f4eb05284449b1063eb71d8301dc";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",jre);console.log("AgoraProvider: import.meta.env:",Y4e);const X4e=Vw.createClient({mode:"rtc",codec:"vp8"});let Rb=null;const Bre=j.createContext(null),Wre=({children:r,appId:t=jre,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:g=!0,onClientReady:E=()=>{}})=>{console.log("AgoraProvider: appId prop:",t);const[S,b]=j.useState(!1),[C,O]=j.useState(!1),[k,W]=j.useState([]),[H,K]=j.useState(null),[G,te]=j.useState(null),[J,re]=j.useState(null),[fe,oe]=j.useState(!1),[be,Z]=j.useState(!1),[ne,se]=j.useState(!1),[ue,Ee]=j.useState(null),he=j.useRef(X4e),le=j.useRef({appId:t,channel:s,uid:l,enabled:d}),Me=j.useRef(!1),pt=j.useRef(null);j.useRef(null),j.useEffect(()=>{le.current={appId:t,channel:s,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:s,uid:l,enabled:d})},[t,s,l,d]),j.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:s,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:he.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,s,l,d]),j.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",s),te(s)},[s]),j.useEffect(()=>{if(!he.current)return;const Fe=ct=>{console.log(`Connection state changed to: ${ct}`),ct==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):ct==="CONNECTED"&&(b(!0),K(null))};return he.current.on("connection-state-change",Fe),()=>{he.current.off("connection-state-change",Fe)}},[]),j.useEffect(()=>{if(!s||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:s,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",s,"with UID",l);const Fe=async(xt,fn)=>{console.log("AgoraProvider: User published:",xt.uid,fn);try{await he.current.subscribe(xt,fn),console.log("AgoraProvider: Subscribed to user:",xt.uid,"mediaType:",fn),fn==="audio"&&(xt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",xt.uid)),W(Rn=>Rn.some(ln=>ln.uid===xt.uid)?Rn:[...Rn,xt])}catch(Rn){console.error("AgoraProvider: Error subscribing to user:",Rn)}},ct=(xt,fn)=>{console.log("AgoraProvider: User unpublished:",xt.uid,fn),fn==="audio"&&xt.audioTrack&&(xt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",xt.uid))},_t=xt=>{console.log("AgoraProvider: User joined:",xt.uid),W(fn=>fn.some(Rn=>Rn.uid===xt.uid)?fn:[...fn,xt])},Pt=xt=>{console.log("AgoraProvider: User left:",xt.uid),W(fn=>fn.filter(Rn=>Rn.uid!==xt.uid))};he.current.on("user-published",Fe),he.current.on("user-unpublished",ct),he.current.on("user-joined",_t),he.current.on("user-left",Pt);const Ht=async()=>{if(Me.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}Me.current=!0;try{if(S&&pt.current===s){console.log("AgoraProvider: Already joined to channel",s),oe(!0),E(he.current);return}if(he.current.connectionState==="CONNECTING"||he.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",he.current.connectionState),pt.current&&pt.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ue()}catch(xt){console.error("AgoraProvider: Error leaving channel:",xt)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),oe(!0),pt.current=s,Rb=s,E(he.current);return}console.log("AgoraProvider: Joining channel",s,"current joined channel:",pt.current),await Oe(),console.log("AgoraProvider: Join channel completed")}catch(xt){console.error("AgoraProvider: Error during initialization:",xt)}finally{Me.current=!1}};return console.log("AgoraProvider: Running initialization"),Ht(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),he.current.off("user-published",Fe),he.current.off("user-unpublished",ct),he.current.off("user-joined",_t),he.current.off("user-left",Pt)}},[s,d,l,E,S]);const et=async()=>{if(!d||J)return J;console.log("Initializing microphone");try{const Fe=await Vw.createMicrophoneAudioTrack();return await Fe.setMuted(g),re(Fe),console.log("Microphone initialized successfully"),Fe}catch(Fe){return console.error("Error initializing microphone:",Fe),K("Failed to initialize microphone. Please check your permissions."),null}},Oe=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(!s)return console.error("AgoraProvider: No channel specified"),K("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",s,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:S,isJoining:be,connectionState:he.current.connectionState,joinedChannel:pt.current}),S&&pt.current===s)return console.log("AgoraProvider: Already joined to channel:",s),!0;if(be)return console.log("AgoraProvider: Already in the process of joining"),!1;if(he.current.connectionState==="CONNECTED")if(pt.current&&pt.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ue()}catch(Fe){console.error("AgoraProvider: Error leaving channel:",Fe)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),oe(!0),pt.current=s,Rb=s,E(he.current),!0;if(he.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),Z(!0),new Promise(Fe=>{const ct=setInterval(()=>{he.current.connectionState==="CONNECTED"&&(clearInterval(ct),b(!0),Z(!1),oe(!0),pt.current=s,Rb=s,E(he.current),Fe(!0))},500);setTimeout(()=>{clearInterval(ct),console.log("AgoraProvider: Connection timeout, considering join failed"),Z(!1),Fe(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",s,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",t,"Type:",typeof t,"Length:",t.length),!t||t.trim()===""){const ct="AgoraProvider: App ID is empty or invalid";return console.error(ct),K(ct),Z(!1),!1}Z(!0);const Fe=l||Math.floor(Math.random()*1e6);return await he.current.join(t,s,a,Fe),console.log("AgoraProvider: Joined channel successfully with UID:",he.current.uid),b(!0),Z(!1),oe(!0),pt.current=s,Rb=s,E(he.current),!0}catch(Fe){return console.error("AgoraProvider: Error joining channel:",Fe),K(`Error joining channel: ${Fe.toString()}`),Z(!1),!1}},Ue=async()=>{if(S)try{J&&await he.current.unpublish(J),await he.current.leave(),Rb=null,pt.current=null,console.log("Left channel successfully"),b(!1),W([])}catch(Fe){console.error("Error leaving channel:",Fe),K(Fe.message||"Failed to leave channel")}};j.useEffect(()=>()=>{J&&J.close()},[]),j.useEffect(()=>{d&&s&&(!S||pt.current!==s)&&Oe()},[d,s,S]);const xe=()=>{if(!J)return!1;try{return J.isActive&&!J.muted}catch(Fe){return console.error("Error checking microphone status:",Fe),!1}};j.useEffect(()=>{const Fe=()=>{const _t=xe();_t!==C&&(console.log("Syncing microphone state:",{actualStatus:_t,currentState:C}),O(_t),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:_t}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=_t,window.agoraClient.microphoneTrack=J))};J&&Fe();const ct=setInterval(Fe,1e3);return()=>{clearInterval(ct)}},[J,C]);const it=async()=>{var Fe;try{const ct=C!==void 0?C:J?!J.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:ct,hasMicTrack:!!J,trackMuted:J==null?void 0:J.muted}),!J&&(console.log("AgoraProvider: No microphone track, initializing..."),!await et()))return console.error("AgoraProvider: Failed to initialize microphone"),ct;const _t=!ct;if(console.log("AgoraProvider: New voice state will be:",_t),ct){if(J)try{console.log("AgoraProvider: Muting microphone track"),await J.setMuted(!0),J.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await J.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",J.muted)}catch(Pt){return console.error("Error muting track:",Pt),ct}}else if(J)try{he.current&&S&&!((Fe=he.current.localTracks)!=null&&Fe.includes(J))&&(console.log("AgoraProvider: Publishing microphone track"),await he.current.publish(J),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await J.setMuted(!1),J.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await J.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",J.muted)}catch(Pt){return console.error("Error unmuting track:",Pt),ct}return O(_t),_t}catch(ct){return console.error("AgoraProvider: Error toggling voice:",ct),C}},Ae=async Fe=>{try{re(Fe),console.log("Microphone track updated successfully")}catch(ct){throw console.error("Error updating microphone track:",ct),ct}},$e=async()=>{if(!he.current||!s)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(ne)return console.log("AgoraProvider: Stopping screen share"),ue&&(Array.isArray(ue)?(await he.current.unpublish(ue),ue.forEach(Fe=>Fe.close())):(await he.current.unpublish(ue),ue.close()),Ee(null)),se(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const Fe=await Vw.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",Fe),Fe.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),he.current.unpublish(Fe),Fe.close(),Ee(null),se(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await he.current.publish(Fe),Ee(Fe),se(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=Fe,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(Fe){return console.error("AgoraProvider: Error creating screen track:",Fe),se(!1),Ee(null),!1}}catch(Fe){return console.error("AgoraProvider: Error toggling screen share:",Fe),se(!1),Ee(null),!1}};j.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:he.current,isScreenSharing:!1,screenTrack:null};const Fe=_t=>{console.log("AgoraProvider: Received ToggleScreenShare event"),$e().then(Pt=>{_t.detail&&_t.detail.callback&&_t.detail.callback(!0,Pt)}).catch(Pt=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Pt),_t.detail&&_t.detail.callback&&_t.detail.callback(!1,ne)})},ct=_t=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Oe().then(Pt=>{_t.detail&&_t.detail.callback&&_t.detail.callback(Pt)}).catch(Pt=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Pt),_t.detail&&_t.detail.callback&&_t.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",Fe),window.addEventListener("JoinVoiceChat",ct),()=>{window.removeEventListener("ToggleScreenShare",Fe),window.removeEventListener("JoinVoiceChat",ct),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),j.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=J,window.agoraClient.client=he.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,J]);const Ze={client:he.current,isJoined:S,isVoiceEnabled:C,users:k,error:H,channel:G,appId:t,toggleVoice:it,leaveChannel:Ue,joinChannel:Oe,microphoneTrack:J,isReady:fe,createMicrophoneTrack:Ae,isScreenSharing:ne,screenTrack:ue,toggleScreenShare:$e};return U.jsx(Bre.Provider,{value:Ze,children:r})},Gre=()=>{const r=j.useContext(Bre);if(!r)throw new Error("useAgoraContext must be used within an AgoraProvider");return r};Wre.propTypes={children:ai.node.isRequired,appId:ai.string.isRequired,channel:ai.string.isRequired,token:ai.string,uid:ai.oneOfType([ai.string,ai.number])};const J4e=()=>{var Me,pt;const{client:r,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:g,channel:E,appId:S,toggleVoice:b,joinChannel:C,leaveChannel:O,createMicrophoneTrack:k,isScreenSharing:W,screenTrack:H,toggleScreenShare:K}=Gre(),[G,te]=j.useState(t!==void 0?t:((Me=window.agoraClient)==null?void 0:Me.isVoiceEnabled)||!1),[J,re]=j.useState(W!==void 0?W:((pt=window.agoraClient)==null?void 0:pt.isScreenSharing)||!1),[fe,oe]=j.useState(!0);j.useEffect(()=>{var et;t!==void 0?te(t):((et=window.agoraClient)==null?void 0:et.isVoiceEnabled)!==void 0?te(window.agoraClient.isVoiceEnabled):d&&te(!d.muted)},[t,d]),j.useEffect(()=>{var et;W!==void 0?re(W):((et=window.agoraClient)==null?void 0:et.isScreenSharing)!==void 0&&re(window.agoraClient.isScreenSharing)},[W]);const be=j.useRef({isVoiceEnabled:G,isScreenSharing:J,isJoined:s,users:a,error:l,isReady:g,channel:E,appId:S});j.useEffect(()=>{be.current={isVoiceEnabled:G,isScreenSharing:J,isJoined:s,users:a,error:l,isReady:g,channel:E,appId:S}},[G,J,s,a,l,g,E,S]),j.useEffect(()=>{const et=setTimeout(()=>{oe(!1)},5e3);return()=>clearTimeout(et)},[]),j.useEffect(()=>{g&&oe(!1)},[g]),j.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:G,contextIsScreenSharing:W,localScreenSharing:J,isJoined:s,users:a.length,error:l,isReady:g,channel:E,appId:S,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!H})},[t,G,W,J,s,a,l,g,E,S,d,H]);const Z=async()=>{try{console.log("useVoiceChat: Toggling voice from:",G);const et=await b();if(console.log("useVoiceChat: Toggle result:",et),et!==void 0)te(et);else{const Oe=!G;te(Oe),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Oe)}return et!==void 0?et:!G}catch(et){return console.error("useVoiceChat: Error toggling voice:",et),G}},ne=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",J);const et=await K();if(console.log("useVoiceChat: Screen share toggle result:",et),et!==void 0)re(et);else{const Oe=!J;re(Oe),window.agoraClient&&(window.agoraClient.isScreenSharing=Oe)}return et!==void 0?et:!J}catch(et){return console.error("useVoiceChat: Error toggling screen share:",et),J}},se=async()=>{G&&d&&await Z()},ue=async()=>{!G&&d&&await Z()},Ee=et=>a.some(Oe=>{var Ue;return Oe.uid===et&&((Ue=Oe.audioTrack)==null?void 0:Ue.isPlaying)}),he=j.useCallback(()=>{if(!d||!G)return 0;try{return d.getVolumeLevel()}catch(et){return console.error("Error getting volume level:",et),0}},[d,G]);return{isVoiceEnabled:G,isScreenSharing:J,isJoined:s,users:a,error:l,toggleVoice:Z,toggleScreenShare:ne,mute:se,unmute:ue,isUserSpeaking:Ee,getVolumeLevel:he,microphoneTrack:d,screenTrack:H,isLoading:fe,channel:E,appId:S,joinChannel:C,leaveChannel:O,client:r,setMicrophoneDevice:async et=>{try{if(!et){console.error("No device ID provided");return}if(!r||!s){console.error("Client not initialized or not joined to a channel");return}d&&(G&&await r.unpublish(d),await d.close());const Oe=await Vw.createMicrophoneAudioTrack({microphoneId:et,encoderConfig:"music_standard"});k&&await k(Oe),G&&await r.publish(Oe),console.log("Microphone device changed successfully")}catch(Oe){throw console.error("Error changing microphone device:",Oe),Oe}}}},Q4e=({size:r="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:g,isJoined:E,joinChannel:S,channel:b,client:C}=J4e(),[O,k]=j.useState(!1),[W,H]=j.useState(!1);j.useEffect(()=>{const te=()=>{Ct.log("VoiceButton: Player instantiated, showing button"),H(!0)};return window.addEventListener("PlayerInstantiated",te),window.isPlayerInstantiated&&(Ct.log("VoiceButton: Player was already instantiated"),H(!0)),()=>{window.removeEventListener("PlayerInstantiated",te)}},[]),j.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:b,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:W})},[d,E,b,C,W]);const K=async()=>{if(!O){k(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await S(),console.log("VoiceButton: Joined channel successfully")}catch(J){J.message&&J.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",J)}console.log("VoiceButton: Toggling voice state from:",d);const te=await g();console.log("VoiceButton: Voice toggled, new state:",te)}catch(te){console.error("VoiceButton: Error toggling voice:",te)}finally{k(!1)}}},G=()=>W?O?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return W?U.jsx(nR,{label:G(),placement:t,hasArrow:!0,children:U.jsxs(_n,{position:"relative",cursor:"pointer",onClick:K,children:[U.jsx(W_,{size:r,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?U.jsx(gU,{color:"white"}):U.jsx(mU,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&U.jsx(_n,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:U.jsx(xS,{size:"sm",color:"white"})})]})}):null},Z4e=Qr.createContext({user:null}),e3e=({userNickname:r})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Gre(),[g,E]=j.useState([]),[S,b]=j.useState(!1),[C,O]=j.useState(!0);j.useRef({});const k=j.useRef(null);j.useRef(null);const{user:W}=j.useContext(Z4e)||{user:null},[H,K]=j.useState({}),G=j.useRef(a),[te,J]=j.useState(null),{isOpen:re,onOpen:fe,onClose:oe}=jw(),[be,Z]=j.useState(!1),ne=j.useRef(null),se=j.useRef(null);j.useEffect(()=>{G.current=a},[a]),j.useEffect(()=>{if(!t||!s){b(!1);return}const Me=setTimeout(()=>{O(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const pt=t.connectionState;if(console.log("Current connection state:",pt),pt==="CONNECTED")b(!0),O(!1);else{b(!1);const et=Oe=>{console.log("Connection state changed:",Oe),Oe==="CONNECTED"?(b(!0),O(!1)):b(!1)};return t.on("connection-state-change",et),()=>{t.off("connection-state-change",et),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[t,s]),j.useEffect(()=>{const Me=async()=>{const pt={...H};let et=!1;for(const Oe of g){if(H[Oe.uid])continue;let Ue=null,xe=Oe.uid;if(typeof xe=="string"&&(xe.includes("-")?(Ue=xe.split("-")[0],xe=xe.split("-")[1]):xe.includes("_")&&(Ue=xe.split("_")[0],xe=xe.split("_")[1])),xe)try{console.log("Trying to fetch nickname for user ID:",xe);const it=await jm(xe);it&&it.Nickname?(console.log("Found nickname in Firebase for user ID:",xe,"Nickname:",it.Nickname),pt[Oe.uid]=it.Nickname,et=!0):Ue?(console.log("Using extracted name for user ID:",xe,"Name:",Ue),pt[Oe.uid]=Ue,et=!0):(pt[Oe.uid]="User",et=!0)}catch(it){console.error("Error fetching user profile:",it),Ue?(pt[Oe.uid]=Ue,et=!0):(pt[Oe.uid]="User",et=!0)}else Ue?(pt[Oe.uid]=Ue,et=!0):(pt[Oe.uid]="User",et=!0)}et&&K(pt)};g.length>0&&Me()},[g,H]),j.useEffect(()=>{if(!t||!s||!S)return;console.log("Setting up screen share event handlers");const Me=async(Oe,Ue)=>{if(console.log("User published:",Oe.uid,Ue,Oe),Ue==="video"){console.log("Remote video track detected:",Oe.uid);try{await t.subscribe(Oe,Ue),console.log("Subscribed to remote video track:",Oe.uid),E(xe=>xe.some(it=>it.uid===Oe.uid)?xe:[...xe,Oe])}catch(xe){console.error("Error subscribing to remote video track:",xe)}}},pt=(Oe,Ue)=>{if(console.log("User unpublished:",Oe.uid,Ue),Ue==="video"){if(console.log("Remote video track unpublished:",Oe.uid),Oe.videoTrack)try{Oe.videoTrack.stop()}catch(xe){console.error("Error stopping video track:",xe)}if(E(xe=>xe.filter(it=>it.uid!==Oe.uid)),l&&G.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),G.current.play(k.current)}catch(xe){console.error("Error replaying local screen track:",xe)}}},et=Oe=>{console.log("User left:",Oe.uid);const Ue=g.find(xe=>xe.uid===Oe.uid);if(Ue&&Ue.videoTrack)try{Ue.videoTrack.stop()}catch(xe){console.error("Error stopping video track:",xe)}if(E(xe=>xe.filter(it=>it.uid!==Oe.uid)),l&&G.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user left"),G.current.play(k.current)}catch(xe){console.error("Error replaying local screen track:",xe)}};return t.on("user-published",Me),t.on("user-unpublished",pt),t.on("user-left",et),()=>{t.off("user-published",Me),t.off("user-unpublished",pt),t.off("user-left",et)}},[t,s,S,g,l]),j.useEffect(()=>{if(console.log("Remote screens changed:",g.length,g),g.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(pt){console.error("Error playing video track:",pt)}}),l&&G.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),G.current.play(k.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[g,l]),j.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&k.current)try{console.log("Playing local screen track"),a.play(k.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),j.useEffect(()=>()=>{if(g.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(pt){console.error("Error stopping video track on unmount:",pt)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[g,a]);const ue=()=>{console.log("Stopping local screen share"),d()},Ee=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&W&&(Me===W.uid||Me===(t==null?void 0:t.uid))?r||"You":H[Me]?H[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),he=Me=>{console.log("Opening modal for remote screen",Me),J(Me),fe()},le=()=>{console.log("Opening modal for local screen"),J({isLocal:!0}),fe()};return j.useEffect(()=>{re&&te?(console.log("Modal opened, activeScreen:",te),setTimeout(()=>{if(te.isLocal&&G.current)try{console.log("Playing local screen in modal"),G.current.play("modal-screen-container"),Z(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(te.videoTrack)try{console.log("Playing remote screen in modal"),te.videoTrack.play("modal-screen-container"),Z(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):re||(Z(!1),J(null),setTimeout(()=>{if(l&&G.current)try{G.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}g.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(pt){console.error(`Error playing remote screen ${Me.uid} in small container:`,pt)}})},500))},[re,te,l,g]),!S||C&&g.length===0&&!l||g.length===0&&!l?null:U.jsxs(U.Fragment,{children:[!re&&U.jsxs(_n,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:ne,children:[l&&a&&U.jsxs(_n,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[U.jsx(_n,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),U.jsx(_n,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:r?`${r}'s Screen`:"Your Screen"})]}),g.map(Me=>{const pt=H[Me.uid]||Ee(Me.uid);return U.jsxs(_n,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>he(Me),children:[U.jsx(_n,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),U.jsx(_n,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${pt}'s Screen`})]},Me.uid)})]}),re&&U.jsx(_n,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:oe,children:U.jsxs(_n,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!be&&U.jsxs(_n,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[U.jsx(xS,{size:"xl"}),U.jsx(sr,{mt:4,children:"Loading screen share..."})]}),U.jsx(_n,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:se}),U.jsx(_n,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:oe,children:""}),U.jsx(_n,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:te!=null&&te.isLocal?r?`${r}'s Screen`:"Your Screen":`${H[te==null?void 0:te.uid]||Ee(te==null?void 0:te.uid)}'s Screen`}),(te==null?void 0:te.isLocal)&&U.jsx(_n,{position:"absolute",bottom:4,right:4,children:U.jsx(Gp,{colorScheme:"red",size:"sm",onClick:ue,children:"Stop Sharing"})})]})})]})},t3e=({onClose:r})=>{const t=tR(),[s,a]=j.useState(!1),[l,d]=j.useState(!1);j.useEffect(()=>{const S=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};S();const b=setInterval(S,1e3),C=()=>{S()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",C)}},[]);const g=async S=>{if(S.preventDefault(),S.stopPropagation(),r&&r(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const S=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,C)=>{a(!1),b?(d(C),t(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(S)}catch(S){console.error("Error toggling screen share:",S),a(!1),t({title:"Screen sharing error",description:S.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return U.jsx(sr,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:g,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function n3e({open:r,onClose:t}){return U.jsxs(Jp,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[U.jsx(tf,{}),U.jsxs(Qp,{bg:"gray.900",color:"white",borderRadius:"lg",children:[U.jsx(zm,{children:"Controls"}),U.jsx(ef,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),U.jsx(Zp,{children:U.jsxs(Wa,{spacing:4,children:[U.jsxs(_n,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[U.jsx(sr,{fontSize:"xl",fontWeight:"bold",children:"Getting Started"}),U.jsxs(_n,{mt:2,children:[U.jsx(sr,{children:"WASD to move"}),U.jsx(sr,{children:"Shift to run"}),U.jsx(sr,{children:"Spacebar to jump/double jump"}),U.jsx(sr,{children:"Click to move around"})]})]}),U.jsxs(_n,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[U.jsx(sr,{fontSize:"xl",fontWeight:"bold",children:"Camera Movements"}),U.jsx(_n,{mt:2,children:U.jsx(sr,{children:"Click & drag to rotate camera"})})]}),U.jsxs(_n,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[U.jsx(sr,{fontSize:"xl",fontWeight:"bold",children:"##########"}),U.jsx(_n,{mt:2,children:U.jsx(sr,{children:"Type something here"})})]})]})})]})]})}const r3e=()=>{const[r,t]=j.useState([]),[s,a]=j.useState(""),[l,d]=j.useState(0),[g,E]=j.useState(100),[S,b]=j.useState(100),[C,O]=j.useState(!0),[k,W]=j.useState(!0),[H,K]=j.useState(!1);j.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const oe=await Vw.getMicrophones();t(oe),oe.length>0&&a(oe[0].deviceId)}catch(oe){console.error("Error getting audio devices:",oe)}})()},[]),j.useEffect(()=>{const fe=setInterval(()=>{d(H?Math.random()*50:0)},100);return()=>clearInterval(fe)},[H]);const G=fe=>{const oe=fe.target.value;a(oe),console.log("Microphone changed to:",oe)},te=fe=>{E(fe),console.log("Microphone volume set to:",fe)},J=fe=>{b(fe),console.log("Speaker volume set to:",fe)},re=()=>{K(!H)};return U.jsxs(Wa,{spacing:6,align:"stretch",children:[U.jsxs(Bo,{children:[U.jsxs(T_,{children:["Microphone",U.jsx(QQ,{ml:2,colorScheme:H?"green":"red",children:H?"Enabled":"Muted"})]}),U.jsxs(_ee,{value:s,onChange:G,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[r.map(fe=>U.jsx("option",{value:fe.deviceId,children:fe.label||`Microphone ${fe.deviceId.slice(0,5)}...`},fe.deviceId)),r.length===0&&U.jsx("option",{value:"",children:"No microphones found"})]})]}),U.jsxs(_n,{children:[U.jsx(sr,{mb:2,children:"Microphone Level"}),U.jsx($V,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),U.jsxs(Bo,{children:[U.jsxs(T_,{children:["Microphone Volume: ",g,"%"]}),U.jsxs(L2,{value:g,onChange:te,min:0,max:100,step:1,colorScheme:"blue",children:[U.jsx(M2,{bg:"gray.700",children:U.jsx(U2,{})}),U.jsx(x2,{boxSize:6})]})]}),U.jsxs(Bo,{children:[U.jsxs(T_,{children:["Speaker Volume: ",S,"%"]}),U.jsxs(L2,{value:S,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[U.jsx(M2,{bg:"gray.700",children:U.jsx(U2,{})}),U.jsx(x2,{boxSize:6})]})]}),U.jsxs(Bo,{display:"flex",alignItems:"center",children:[U.jsx(T_,{mb:"0",children:"Microphone Enabled"}),U.jsx(XO,{isChecked:H,onChange:re,colorScheme:"green",size:"lg"})]}),U.jsxs(Bo,{display:"flex",alignItems:"center",children:[U.jsx(T_,{mb:"0",children:"Echo Cancellation"}),U.jsx(XO,{isChecked:C,onChange:()=>O(!C),colorScheme:"green",size:"lg"})]}),U.jsxs(Bo,{display:"flex",alignItems:"center",children:[U.jsx(T_,{mb:"0",children:"Noise Suppression"}),U.jsx(XO,{isChecked:k,onChange:()=>W(!k),colorScheme:"green",size:"lg"})]}),U.jsxs(hN,{status:"info",borderRadius:"md",children:[U.jsx(pN,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function i3e({open:r,onClose:t,containerRef:s}){return U.jsx(id,{containerRef:s,children:U.jsxs(Jp,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[U.jsx(tf,{}),U.jsxs(Qp,{bg:"gray.900",color:"white",borderRadius:"lg",children:[U.jsx(zm,{children:"Settings"}),U.jsx(ef,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),U.jsx(Zp,{children:U.jsxs(bee,{variant:"enclosed",children:[U.jsxs(wee,{mb:4,children:[U.jsx(V2,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),U.jsx(V2,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),U.jsxs(Ree,{children:[U.jsx(F2,{children:U.jsx(_n,{p:4,bg:"gray.800",borderRadius:"md",children:U.jsx(r3e,{})})}),U.jsx(F2,{children:U.jsx(_n,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}const s3e=({onTogglePlayerList:r,spaceID:t})=>{const{fullscreenRef:s}=nf(),[a,l]=j.useState(!0),[d,g]=j.useState(!1),[E,S]=j.useState(!1),[b,C]=j.useState(!1),[O,k]=j.useState(!1),[W,H]=j.useState(null),{user:K}=j.useContext(au),G=(K==null?void 0:K.Nickname)||"Unknown",te=async()=>{if(K!=null&&K.uid)try{const Z=await jm(K.uid);H({rpmURL:Z.rpmURL?Z.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null})}catch(Z){console.error("Error fetching profile data:",Z)}};j.useEffect(()=>{te()},[K==null?void 0:K.uid]),j.useEffect(()=>{const Z=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",Z),()=>{window.removeEventListener("PlayerInstantiated",Z)}},[]);const J=()=>S(!E),re=()=>C(!b),fe=()=>{k(!1),te()},oe=Z=>{Z.stopPropagation(),typeof r=="function"&&(Ct.log("CanvasMainMenu: Toggling player list"),r())},be=()=>{g(!1)};return U.jsxs(U.Fragment,{children:[U.jsxs(YZ,{isOpen:d,onClose:()=>g(!1),children:[U.jsx(XZ,{as:ol,icon:U.jsx(O4e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>g(!d)}),U.jsx(id,{containerRef:s,children:U.jsx(JZ,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:U.jsxs(Wa,{align:"stretch",spacing:4,children:[U.jsxs(yS,{children:[U.jsx(W_,{size:"md",src:W==null?void 0:W.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),U.jsxs(Wa,{align:"start",spacing:0,children:[U.jsx(sr,{fontWeight:"bold",children:G}),U.jsx(sr,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),U.jsxs(yS,{spacing:4,justify:"center",children:[U.jsx(ol,{icon:U.jsx(M4e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:oe}),U.jsx(ol,{icon:U.jsx(_n,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),U.jsx(ol,{icon:U.jsx(_n,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),U.jsx(wV,{borderColor:"whiteAlpha.300"}),U.jsxs(Wa,{align:"stretch",spacing:2,children:[K&&t&&U.jsx(t3e,{onClose:be}),U.jsx(sr,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:J,children:"Settings"}),U.jsx(sr,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:re,children:"Controls"}),U.jsx(sr,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),U.jsx(sr,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&U.jsx(n3e,{open:b,onClose:re}),E&&U.jsx(i3e,{open:E,onClose:J}),O&&U.jsx(Ure,{open:O,onClose:fe})]})},o3e="a2a7f4eb05284449b1063eb71d8301dc",KF=j.forwardRef(({settings:r},t)=>{const{unityProvider:s,isLoaded:a}=GS(),l=ZBe();t4e();const d=KN(),g=i4e(l),{user:E}=j.useContext(au),[S,b]=j.useState(!1),[C,O]=j.useState(window.devicePixelRatio),[k,W]=r4e();yre().find(le=>le.isLocalPlayer);const[K,G]=j.useState(!0),[te,J]=j.useState(!0),[re,fe]=j.useState(!1),oe=r.spaceID||"default",be=j.useMemo(()=>{const pt=new URLSearchParams(window.location.search).get("sessionId")||oe;return console.log("WebGLRenderer: Using session ID:",pt),pt},[oe]),[Z,ne]=j.useState(null);j.useEffect(()=>{E!=null&&E.uid&&jm(E.uid).then(le=>{ne(le),console.log("WebGLRenderer: User profile loaded:",(le==null?void 0:le.Nickname)||"Unknown")}).catch(le=>{console.error("Error fetching user profile:",le)})},[E==null?void 0:E.uid]),j.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const le=()=>{console.log("WebGLRenderer: Player instantiated event received"),J(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),J(!0)),zb.subscribe(Gb.playerInstantiated,le);const Me=setTimeout(()=>{te||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),J(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{zb.unsubscribe(Gb.playerInstantiated,le),clearTimeout(Me)}},[te]),j.useEffect(()=>{a||l?setTimeout(()=>{b(!0),Ct.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Ct.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,l]),j.useEffect(()=>{const le=Me=>{Ct.log("WebGLRenderer: Received 'sendUserToUnity' event"),d("FirebaseUserFromReact",Me)};return zb.subscribe(Gb.sendUserToUnity,le),()=>zb.unsubscribe(Gb.sendUserToUnity,le)},[d]);const{setFullscreenRef:se,fullscreenRef:ue}=nf();j.useEffect(()=>{se(t.current)},[t,se]);const Ee=()=>{G(!K)},he=E&&r.enableVoiceChat;return console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:te,showVoiceChat:he,sessionId:be}),U.jsx(_n,{className:"webgl-renderer",children:U.jsx(UU,{containerRef:ue.current?ue:document.body,children:U.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[U.jsxs(_n,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[r.showAuthButton&&U.jsx(N4e,{}),he&&U.jsxs(Wre,{appId:o3e,channel:be,uid:E==null?void 0:E.uid,enabled:!0,children:[U.jsx(Q4e,{size:"md",defaultMuted:!0,joinOnClick:!0}),U.jsx(e3e,{userNickname:Z==null?void 0:Z.Nickname})]}),U.jsx(V4e,{}),U.jsx(_n,{position:"relative",zIndex:"9999",children:U.jsx(s3e,{onTogglePlayerList:Ee,spaceID:oe})})]}),U.jsxs(_n,{position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",bgImage:r.urlLoadingBackground?`url('${r.urlLoadingBackground}')`:"",children:[U.jsx(_n,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),U.jsx(P4e,{}),U.jsx(_n,{...g,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:U.jsx(sre.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:C})}),U.jsx(W4e,{})]}),U.jsx(_n,{...g,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:r.showDisruptiveLogo&&U.jsx(VV,{src:r.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),U.jsx(_n,{...g,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),U.jsxs(_n,{...g,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[r.showHelpButton&&U.jsx(k4e,{}),U.jsx(B4e,{})]}),U.jsx(G4e,{}),U.jsx(z4e,{isOpen:k!==null,onClose:()=>{console.log(" Closing nameplate modal"),W()},playerName:(k==null?void 0:k.playerName)||"Unknown Player",playerId:(k==null?void 0:k.playerId)||"Unknown ID"}),U.jsx(H4e,{isVisible:K,onToggleVisibility:G})]})})})});KF.displayName="WebGLRenderer";KF.propTypes={settings:ai.shape({urlLoadingBackground:ai.string,showAuthButton:ai.bool,showDisruptiveLogo:ai.bool,urlDisruptiveLogo:ai.string,showHelpButton:ai.bool,enableVoiceChat:ai.bool,spaceID:ai.string})};const zre=({spaceID:r,overrideSettings:t})=>{const s=j.useRef(null),[a,l]=j.useState(!0),[d,g]=j.useState({spaceID:r,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,S]=j.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:r});return j.useEffect(()=>{(async()=>{try{const C=await XBe(r);if(C){g(k=>({...k,spaceID:r,loaderUrl:C.loaderUrl,dataUrl:C.dataUrl,frameworkUrl:C.frameworkUrl,codeUrl:C.codeUrl}));const O=await Ere(E.urlDisruptiveLogo);S(k=>({...k,urlLoadingBackground:C.gsUrlLoadingBackground||"",showAuthButton:C.showAuthButton!==void 0?C.showAuthButton:!0,showDisruptiveLogo:C.showDisruptiveLogo!==void 0?C.showDisruptiveLogo:!0,showHelpButton:C.showHelpButton!==void 0?C.showHelpButton:!0,enableVoiceChat:C.enableVoiceChat!==void 0?C.enableVoiceChat:!0,urlDisruptiveLogo:O,spaceID:r,...t||{}})),l(!1)}else Ct.error(`WebGLLoader: No configuration found for spaceID: ${r}`)}catch(C){Ct.error("WebGLLoader: Error fetching space data:",C)}finally{l(!1)}})()},[r,E.urlDisruptiveLogo,t]),j.useEffect(()=>{a||(Ct.log("WebGLLoader: Unity config from Firebase",d),Ct.log("WebGLLoader: Space settings from Firebase",E))},[a]),U.jsx(U.Fragment,{children:a?U.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):U.jsx(Kje,{...d,children:U.jsx(KF,{ref:s,settings:E})})})};zre.propTypes={spaceID:ai.string.isRequired,overrideSettings:ai.object};const PO=document.getElementById("webgl-root");if(PO){const r=PO.getAttribute("data-space-id"),t=PO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=j.useState(null);return j.useEffect(()=>{yLe(t).then(l)},[]),a?U.jsx(jOe,{theme:a,children:U.jsx(xje,{children:U.jsx(Mje,{children:U.jsx(zre,{spaceID:r})})})}):U.jsx("div",{children:"Loading theme..."})};kme.createRoot(PO).render(U.jsx(s,{}))}else console.error("Root element 'webgl-root' not found.");export{$me as a,gEe as b,Ti as c,pEe as d,c3e as e,a3e as f,sEe as g,nu as i,lh as m,fbe as t};
