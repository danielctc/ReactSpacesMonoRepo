function xye(n,e){for(var i=0;i<e.length;i++){const a=e[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const u=Object.getOwnPropertyDescriptor(a,l);u&&Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Sy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var K2={exports:{}},dw={},q2={exports:{}},Cr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q7;function Lye(){if(Q7)return Cr;Q7=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),f=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function O(Ee){return Ee===null||typeof Ee!="object"?null:(Ee=I&&Ee[I]||Ee["@@iterator"],typeof Ee=="function"?Ee:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,F={};function z(Ee,Ce,Pe){this.props=Ee,this.context=Ce,this.refs=F,this.updater=Pe||L}z.prototype.isReactComponent={},z.prototype.setState=function(Ee,Ce){if(typeof Ee!="object"&&typeof Ee!="function"&&Ee!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ee,Ce,"setState")},z.prototype.forceUpdate=function(Ee){this.updater.enqueueForceUpdate(this,Ee,"forceUpdate")};function X(){}X.prototype=z.prototype;function K(Ee,Ce,Pe){this.props=Ee,this.context=Ce,this.refs=F,this.updater=Pe||L}var ne=K.prototype=new X;ne.constructor=K,M(ne,z.prototype),ne.isPureReactComponent=!0;var oe=Array.isArray,ae=Object.prototype.hasOwnProperty,le={current:null},Y={key:!0,ref:!0,__self:!0,__source:!0};function Z(Ee,Ce,Pe){var Me,ze={},He=null,qe=null;if(Ce!=null)for(Me in Ce.ref!==void 0&&(qe=Ce.ref),Ce.key!==void 0&&(He=""+Ce.key),Ce)ae.call(Ce,Me)&&!Y.hasOwnProperty(Me)&&(ze[Me]=Ce[Me]);var nt=arguments.length-2;if(nt===1)ze.children=Pe;else if(1<nt){for(var Ze=Array(nt),gt=0;gt<nt;gt++)Ze[gt]=arguments[gt+2];ze.children=Ze}if(Ee&&Ee.defaultProps)for(Me in nt=Ee.defaultProps,nt)ze[Me]===void 0&&(ze[Me]=nt[Me]);return{$$typeof:n,type:Ee,key:He,ref:qe,props:ze,_owner:le.current}}function Q(Ee,Ce){return{$$typeof:n,type:Ee.type,key:Ce,ref:Ee.ref,props:Ee.props,_owner:Ee._owner}}function ie(Ee){return typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===n}function de(Ee){var Ce={"=":"=0",":":"=2"};return"$"+Ee.replace(/[=:]/g,function(Pe){return Ce[Pe]})}var ue=/\/+/g;function pe(Ee,Ce){return typeof Ee=="object"&&Ee!==null&&Ee.key!=null?de(""+Ee.key):Ce.toString(36)}function ke(Ee,Ce,Pe,Me,ze){var He=typeof Ee;(He==="undefined"||He==="boolean")&&(Ee=null);var qe=!1;if(Ee===null)qe=!0;else switch(He){case"string":case"number":qe=!0;break;case"object":switch(Ee.$$typeof){case n:case e:qe=!0}}if(qe)return qe=Ee,ze=ze(qe),Ee=Me===""?"."+pe(qe,0):Me,oe(ze)?(Pe="",Ee!=null&&(Pe=Ee.replace(ue,"$&/")+"/"),ke(ze,Ce,Pe,"",function(gt){return gt})):ze!=null&&(ie(ze)&&(ze=Q(ze,Pe+(!ze.key||qe&&qe.key===ze.key?"":(""+ze.key).replace(ue,"$&/")+"/")+Ee)),Ce.push(ze)),1;if(qe=0,Me=Me===""?".":Me+":",oe(Ee))for(var nt=0;nt<Ee.length;nt++){He=Ee[nt];var Ze=Me+pe(He,nt);qe+=ke(He,Ce,Pe,Ze,ze)}else if(Ze=O(Ee),typeof Ze=="function")for(Ee=Ze.call(Ee),nt=0;!(He=Ee.next()).done;)He=He.value,Ze=Me+pe(He,nt++),qe+=ke(He,Ce,Pe,Ze,ze);else if(He==="object")throw Ce=String(Ee),Error("Objects are not valid as a React child (found: "+(Ce==="[object Object]"?"object with keys {"+Object.keys(Ee).join(", ")+"}":Ce)+"). If you meant to render a collection of children, use an array instead.");return qe}function xe(Ee,Ce,Pe){if(Ee==null)return Ee;var Me=[],ze=0;return ke(Ee,Me,"","",function(He){return Ce.call(Pe,He,ze++)}),Me}function Fe(Ee){if(Ee._status===-1){var Ce=Ee._result;Ce=Ce(),Ce.then(function(Pe){(Ee._status===0||Ee._status===-1)&&(Ee._status=1,Ee._result=Pe)},function(Pe){(Ee._status===0||Ee._status===-1)&&(Ee._status=2,Ee._result=Pe)}),Ee._status===-1&&(Ee._status=0,Ee._result=Ce)}if(Ee._status===1)return Ee._result.default;throw Ee._result}var Oe={current:null},we={transition:null},Se={ReactCurrentDispatcher:Oe,ReactCurrentBatchConfig:we,ReactCurrentOwner:le};function Be(){throw Error("act(...) is not supported in production builds of React.")}return Cr.Children={map:xe,forEach:function(Ee,Ce,Pe){xe(Ee,function(){Ce.apply(this,arguments)},Pe)},count:function(Ee){var Ce=0;return xe(Ee,function(){Ce++}),Ce},toArray:function(Ee){return xe(Ee,function(Ce){return Ce})||[]},only:function(Ee){if(!ie(Ee))throw Error("React.Children.only expected to receive a single React element child.");return Ee}},Cr.Component=z,Cr.Fragment=i,Cr.Profiler=l,Cr.PureComponent=K,Cr.StrictMode=a,Cr.Suspense=E,Cr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Se,Cr.act=Be,Cr.cloneElement=function(Ee,Ce,Pe){if(Ee==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ee+".");var Me=M({},Ee.props),ze=Ee.key,He=Ee.ref,qe=Ee._owner;if(Ce!=null){if(Ce.ref!==void 0&&(He=Ce.ref,qe=le.current),Ce.key!==void 0&&(ze=""+Ce.key),Ee.type&&Ee.type.defaultProps)var nt=Ee.type.defaultProps;for(Ze in Ce)ae.call(Ce,Ze)&&!Y.hasOwnProperty(Ze)&&(Me[Ze]=Ce[Ze]===void 0&&nt!==void 0?nt[Ze]:Ce[Ze])}var Ze=arguments.length-2;if(Ze===1)Me.children=Pe;else if(1<Ze){nt=Array(Ze);for(var gt=0;gt<Ze;gt++)nt[gt]=arguments[gt+2];Me.children=nt}return{$$typeof:n,type:Ee.type,key:ze,ref:He,props:Me,_owner:qe}},Cr.createContext=function(Ee){return Ee={$$typeof:f,_currentValue:Ee,_currentValue2:Ee,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ee.Provider={$$typeof:u,_context:Ee},Ee.Consumer=Ee},Cr.createElement=Z,Cr.createFactory=function(Ee){var Ce=Z.bind(null,Ee);return Ce.type=Ee,Ce},Cr.createRef=function(){return{current:null}},Cr.forwardRef=function(Ee){return{$$typeof:_,render:Ee}},Cr.isValidElement=ie,Cr.lazy=function(Ee){return{$$typeof:C,_payload:{_status:-1,_result:Ee},_init:Fe}},Cr.memo=function(Ee,Ce){return{$$typeof:b,type:Ee,compare:Ce===void 0?null:Ce}},Cr.startTransition=function(Ee){var Ce=we.transition;we.transition={};try{Ee()}finally{we.transition=Ce}},Cr.unstable_act=Be,Cr.useCallback=function(Ee,Ce){return Oe.current.useCallback(Ee,Ce)},Cr.useContext=function(Ee){return Oe.current.useContext(Ee)},Cr.useDebugValue=function(){},Cr.useDeferredValue=function(Ee){return Oe.current.useDeferredValue(Ee)},Cr.useEffect=function(Ee,Ce){return Oe.current.useEffect(Ee,Ce)},Cr.useId=function(){return Oe.current.useId()},Cr.useImperativeHandle=function(Ee,Ce,Pe){return Oe.current.useImperativeHandle(Ee,Ce,Pe)},Cr.useInsertionEffect=function(Ee,Ce){return Oe.current.useInsertionEffect(Ee,Ce)},Cr.useLayoutEffect=function(Ee,Ce){return Oe.current.useLayoutEffect(Ee,Ce)},Cr.useMemo=function(Ee,Ce){return Oe.current.useMemo(Ee,Ce)},Cr.useReducer=function(Ee,Ce,Pe){return Oe.current.useReducer(Ee,Ce,Pe)},Cr.useRef=function(Ee){return Oe.current.useRef(Ee)},Cr.useState=function(Ee){return Oe.current.useState(Ee)},Cr.useSyncExternalStore=function(Ee,Ce,Pe){return Oe.current.useSyncExternalStore(Ee,Ce,Pe)},Cr.useTransition=function(){return Oe.current.useTransition()},Cr.version="18.3.1",Cr}var Z7;function nd(){return Z7||(Z7=1,q2.exports=Lye()),q2.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eK;function Mye(){if(eK)return dw;eK=1;var n=nd(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function f(_,E,b){var C,I={},O=null,L=null;b!==void 0&&(O=""+b),E.key!==void 0&&(O=""+E.key),E.ref!==void 0&&(L=E.ref);for(C in E)a.call(E,C)&&!u.hasOwnProperty(C)&&(I[C]=E[C]);if(_&&_.defaultProps)for(C in E=_.defaultProps,E)I[C]===void 0&&(I[C]=E[C]);return{$$typeof:e,type:_,key:O,ref:L,props:I,_owner:l.current}}return dw.Fragment=i,dw.jsx=f,dw.jsxs=f,dw}var tK;function Uye(){return tK||(tK=1,K2.exports=Mye()),K2.exports}var T=Uye(),N=nd();const fi=jg(N),nK=xye({__proto__:null,default:fi},[N]);var lO={},Y2={exports:{}},fl={},X2={exports:{}},J2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rK;function Vye(){return rK||(rK=1,function(n){function e(we,Se){var Be=we.length;we.push(Se);e:for(;0<Be;){var Ee=Be-1>>>1,Ce=we[Ee];if(0<l(Ce,Se))we[Ee]=Se,we[Be]=Ce,Be=Ee;else break e}}function i(we){return we.length===0?null:we[0]}function a(we){if(we.length===0)return null;var Se=we[0],Be=we.pop();if(Be!==Se){we[0]=Be;e:for(var Ee=0,Ce=we.length,Pe=Ce>>>1;Ee<Pe;){var Me=2*(Ee+1)-1,ze=we[Me],He=Me+1,qe=we[He];if(0>l(ze,Be))He<Ce&&0>l(qe,ze)?(we[Ee]=qe,we[He]=Be,Ee=He):(we[Ee]=ze,we[Me]=Be,Ee=Me);else if(He<Ce&&0>l(qe,Be))we[Ee]=qe,we[He]=Be,Ee=He;else break e}}return Se}function l(we,Se){var Be=we.sortIndex-Se.sortIndex;return Be!==0?Be:we.id-Se.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,_=f.now();n.unstable_now=function(){return f.now()-_}}var E=[],b=[],C=1,I=null,O=3,L=!1,M=!1,F=!1,z=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(we){for(var Se=i(b);Se!==null;){if(Se.callback===null)a(b);else if(Se.startTime<=we)a(b),Se.sortIndex=Se.expirationTime,e(E,Se);else break;Se=i(b)}}function oe(we){if(F=!1,ne(we),!M)if(i(E)!==null)M=!0,Fe(ae);else{var Se=i(b);Se!==null&&Oe(oe,Se.startTime-we)}}function ae(we,Se){M=!1,F&&(F=!1,X(Z),Z=-1),L=!0;var Be=O;try{for(ne(Se),I=i(E);I!==null&&(!(I.expirationTime>Se)||we&&!de());){var Ee=I.callback;if(typeof Ee=="function"){I.callback=null,O=I.priorityLevel;var Ce=Ee(I.expirationTime<=Se);Se=n.unstable_now(),typeof Ce=="function"?I.callback=Ce:I===i(E)&&a(E),ne(Se)}else a(E);I=i(E)}if(I!==null)var Pe=!0;else{var Me=i(b);Me!==null&&Oe(oe,Me.startTime-Se),Pe=!1}return Pe}finally{I=null,O=Be,L=!1}}var le=!1,Y=null,Z=-1,Q=5,ie=-1;function de(){return!(n.unstable_now()-ie<Q)}function ue(){if(Y!==null){var we=n.unstable_now();ie=we;var Se=!0;try{Se=Y(!0,we)}finally{Se?pe():(le=!1,Y=null)}}else le=!1}var pe;if(typeof K=="function")pe=function(){K(ue)};else if(typeof MessageChannel<"u"){var ke=new MessageChannel,xe=ke.port2;ke.port1.onmessage=ue,pe=function(){xe.postMessage(null)}}else pe=function(){z(ue,0)};function Fe(we){Y=we,le||(le=!0,pe())}function Oe(we,Se){Z=z(function(){we(n.unstable_now())},Se)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(we){we.callback=null},n.unstable_continueExecution=function(){M||L||(M=!0,Fe(ae))},n.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<we?Math.floor(1e3/we):5},n.unstable_getCurrentPriorityLevel=function(){return O},n.unstable_getFirstCallbackNode=function(){return i(E)},n.unstable_next=function(we){switch(O){case 1:case 2:case 3:var Se=3;break;default:Se=O}var Be=O;O=Se;try{return we()}finally{O=Be}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(we,Se){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var Be=O;O=we;try{return Se()}finally{O=Be}},n.unstable_scheduleCallback=function(we,Se,Be){var Ee=n.unstable_now();switch(typeof Be=="object"&&Be!==null?(Be=Be.delay,Be=typeof Be=="number"&&0<Be?Ee+Be:Ee):Be=Ee,we){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=Be+Ce,we={id:C++,callback:Se,priorityLevel:we,startTime:Be,expirationTime:Ce,sortIndex:-1},Be>Ee?(we.sortIndex=Be,e(b,we),i(E)===null&&we===i(b)&&(F?(X(Z),Z=-1):F=!0,Oe(oe,Be-Ee))):(we.sortIndex=Ce,e(E,we),M||L||(M=!0,Fe(ae))),we},n.unstable_shouldYield=de,n.unstable_wrapCallback=function(we){var Se=O;return function(){var Be=O;O=Se;try{return we.apply(this,arguments)}finally{O=Be}}}}(J2)),J2}var iK;function Fye(){return iK||(iK=1,X2.exports=Vye()),X2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sK;function jye(){if(sK)return fl;sK=1;var n=nd(),e=Fye();function i(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,w=1;w<arguments.length;w++)g+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function u(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},I={};function O(p){return E.call(I,p)?!0:E.call(C,p)?!1:b.test(p)?I[p]=!0:(C[p]=!0,!1)}function L(p,g,w,k){if(w!==null&&w.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return k?!1:w!==null?!w.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function M(p,g,w,k){if(g===null||typeof g>"u"||L(p,g,w,k))return!0;if(k)return!1;if(w!==null)switch(w.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function F(p,g,w,k,V,H,he){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=k,this.attributeNamespace=V,this.mustUseProperty=w,this.propertyName=p,this.type=g,this.sanitizeURL=H,this.removeEmptyString=he}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){z[p]=new F(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];z[g]=new F(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){z[p]=new F(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){z[p]=new F(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){z[p]=new F(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){z[p]=new F(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){z[p]=new F(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){z[p]=new F(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){z[p]=new F(p,5,!1,p.toLowerCase(),null,!1,!1)});var X=/[\-:]([a-z])/g;function K(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(X,K);z[g]=new F(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(X,K);z[g]=new F(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(X,K);z[g]=new F(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){z[p]=new F(p,1,!1,p.toLowerCase(),null,!1,!1)}),z.xlinkHref=new F("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){z[p]=new F(p,1,!1,p.toLowerCase(),null,!0,!0)});function ne(p,g,w,k){var V=z.hasOwnProperty(g)?z[g]:null;(V!==null?V.type!==0:k||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(M(g,w,V,k)&&(w=null),k||V===null?O(g)&&(w===null?p.removeAttribute(g):p.setAttribute(g,""+w)):V.mustUseProperty?p[V.propertyName]=w===null?V.type===3?!1:"":w:(g=V.attributeName,k=V.attributeNamespace,w===null?p.removeAttribute(g):(V=V.type,w=V===3||V===4&&w===!0?"":""+w,k?p.setAttributeNS(k,g,w):p.setAttribute(g,w))))}var oe=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ae=Symbol.for("react.element"),le=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),de=Symbol.for("react.context"),ue=Symbol.for("react.forward_ref"),pe=Symbol.for("react.suspense"),ke=Symbol.for("react.suspense_list"),xe=Symbol.for("react.memo"),Fe=Symbol.for("react.lazy"),Oe=Symbol.for("react.offscreen"),we=Symbol.iterator;function Se(p){return p===null||typeof p!="object"?null:(p=we&&p[we]||p["@@iterator"],typeof p=="function"?p:null)}var Be=Object.assign,Ee;function Ce(p){if(Ee===void 0)try{throw Error()}catch(w){var g=w.stack.trim().match(/\n( *(at )?)/);Ee=g&&g[1]||""}return`
`+Ee+p}var Pe=!1;function Me(p,g){if(!p||Pe)return"";Pe=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(it){var k=it}Reflect.construct(p,[],g)}else{try{g.call()}catch(it){k=it}p.call(g.prototype)}else{try{throw Error()}catch(it){k=it}p()}}catch(it){if(it&&k&&typeof it.stack=="string"){for(var V=it.stack.split(`
`),H=k.stack.split(`
`),he=V.length-1,Re=H.length-1;1<=he&&0<=Re&&V[he]!==H[Re];)Re--;for(;1<=he&&0<=Re;he--,Re--)if(V[he]!==H[Re]){if(he!==1||Re!==1)do if(he--,Re--,0>Re||V[he]!==H[Re]){var Ue=`
`+V[he].replace(" at new "," at ");return p.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",p.displayName)),Ue}while(1<=he&&0<=Re);break}}}finally{Pe=!1,Error.prepareStackTrace=w}return(p=p?p.displayName||p.name:"")?Ce(p):""}function ze(p){switch(p.tag){case 5:return Ce(p.type);case 16:return Ce("Lazy");case 13:return Ce("Suspense");case 19:return Ce("SuspenseList");case 0:case 2:case 15:return p=Me(p.type,!1),p;case 11:return p=Me(p.type.render,!1),p;case 1:return p=Me(p.type,!0),p;default:return""}}function He(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Y:return"Fragment";case le:return"Portal";case Q:return"Profiler";case Z:return"StrictMode";case pe:return"Suspense";case ke:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case de:return(p.displayName||"Context")+".Consumer";case ie:return(p._context.displayName||"Context")+".Provider";case ue:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case xe:return g=p.displayName||null,g!==null?g:He(p.type)||"Memo";case Fe:g=p._payload,p=p._init;try{return He(p(g))}catch{}}return null}function qe(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return He(g);case 8:return g===Z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function nt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Ze(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function gt(p){var g=Ze(p)?"checked":"value",w=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),k=""+p[g];if(!p.hasOwnProperty(g)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var V=w.get,H=w.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return V.call(this)},set:function(he){k=""+he,H.call(this,he)}}),Object.defineProperty(p,g,{enumerable:w.enumerable}),{getValue:function(){return k},setValue:function(he){k=""+he},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function sn(p){p._valueTracker||(p._valueTracker=gt(p))}function ut(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var w=g.getValue(),k="";return p&&(k=Ze(p)?p.checked?"true":"false":p.value),p=k,p!==w?(g.setValue(p),!0):!1}function kt(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function ct(p,g){var w=g.checked;return Be({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??p._wrapperState.initialChecked})}function Mt(p,g){var w=g.defaultValue==null?"":g.defaultValue,k=g.checked!=null?g.checked:g.defaultChecked;w=nt(g.value!=null?g.value:w),p._wrapperState={initialChecked:k,initialValue:w,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function fn(p,g){g=g.checked,g!=null&&ne(p,"checked",g,!1)}function zt(p,g){fn(p,g);var w=nt(g.value),k=g.type;if(w!=null)k==="number"?(w===0&&p.value===""||p.value!=w)&&(p.value=""+w):p.value!==""+w&&(p.value=""+w);else if(k==="submit"||k==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Ve(p,g.type,w):g.hasOwnProperty("defaultValue")&&Ve(p,g.type,nt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Te(p,g,w){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var k=g.type;if(!(k!=="submit"&&k!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,w||g===p.value||(p.value=g),p.defaultValue=g}w=p.name,w!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,w!==""&&(p.name=w)}function Ve(p,g,w){(g!=="number"||kt(p.ownerDocument)!==p)&&(w==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+w&&(p.defaultValue=""+w))}var $e=Array.isArray;function Et(p,g,w,k){if(p=p.options,g){g={};for(var V=0;V<w.length;V++)g["$"+w[V]]=!0;for(w=0;w<p.length;w++)V=g.hasOwnProperty("$"+p[w].value),p[w].selected!==V&&(p[w].selected=V),V&&k&&(p[w].defaultSelected=!0)}else{for(w=""+nt(w),g=null,V=0;V<p.length;V++){if(p[V].value===w){p[V].selected=!0,k&&(p[V].defaultSelected=!0);return}g!==null||p[V].disabled||(g=p[V])}g!==null&&(g.selected=!0)}}function vt(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return Be({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function St(p,g){var w=g.value;if(w==null){if(w=g.children,g=g.defaultValue,w!=null){if(g!=null)throw Error(i(92));if($e(w)){if(1<w.length)throw Error(i(93));w=w[0]}g=w}g==null&&(g=""),w=g}p._wrapperState={initialValue:nt(w)}}function Wt(p,g){var w=nt(g.value),k=nt(g.defaultValue);w!=null&&(w=""+w,w!==p.value&&(p.value=w),g.defaultValue==null&&p.defaultValue!==w&&(p.defaultValue=w)),k!=null&&(p.defaultValue=""+k)}function dn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function En(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tn(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?En(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var wt,sr=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,w,k,V){MSApp.execUnsafeLocalFunction(function(){return p(g,w,k,V)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(wt=wt||document.createElement("div"),wt.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=wt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function xt(p,g){if(g){var w=p.firstChild;if(w&&w===p.lastChild&&w.nodeType===3){w.nodeValue=g;return}}p.textContent=g}var qt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},br=["Webkit","ms","Moz","O"];Object.keys(qt).forEach(function(p){br.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),qt[g]=qt[p]})});function wi(p,g,w){return g==null||typeof g=="boolean"||g===""?"":w||typeof g!="number"||g===0||qt.hasOwnProperty(p)&&qt[p]?(""+g).trim():g+"px"}function Cs(p,g){p=p.style;for(var w in g)if(g.hasOwnProperty(w)){var k=w.indexOf("--")===0,V=wi(w,g[w],k);w==="float"&&(w="cssFloat"),k?p.setProperty(w,V):p[w]=V}}var cr=Be({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zn(p,g){if(g){if(cr[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function ra(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hs=null;function io(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Vc=null,Rs=null,Ma=null;function Fo(p){if(p=ym(p)){if(typeof Vc!="function")throw Error(i(280));var g=p.stateNode;g&&(g=Em(g),Vc(p.stateNode,p.type,g))}}function Ua(p){Rs?Ma?Ma.push(p):Ma=[p]:Rs=p}function hc(){if(Rs){var p=Rs,g=Ma;if(Ma=Rs=null,Fo(p),g)for(p=0;p<g.length;p++)Fo(g[p])}}function Rl(p,g){return p(g)}function Va(){}var pc=!1;function mo(p,g,w){if(pc)return p(g,w);pc=!0;try{return Rl(p,g,w)}finally{pc=!1,(Rs!==null||Ma!==null)&&(Va(),hc())}}function Di(p,g){var w=p.stateNode;if(w===null)return null;var k=Em(w);if(k===null)return null;w=k[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(p=p.type,k=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!k;break e;default:p=!1}if(p)return null;if(w&&typeof w!="function")throw Error(i(231,g,typeof w));return w}var os=!1;if(_)try{var ia={};Object.defineProperty(ia,"passive",{get:function(){os=!0}}),window.addEventListener("test",ia,ia),window.removeEventListener("test",ia,ia)}catch{os=!1}function Il(p,g,w,k,V,H,he,Re,Ue){var it=Array.prototype.slice.call(arguments,3);try{g.apply(w,it)}catch(Dt){this.onError(Dt)}}var Fa=!1,jo=null,ft=!1,hn=null,Pr={onError:function(p){Fa=!0,jo=p}};function Ci(p,g,w,k,V,H,he,Re,Ue){Fa=!1,jo=null,Il.apply(Pr,arguments)}function Al(p,g,w,k,V,H,he,Re,Ue){if(Ci.apply(this,arguments),Fa){if(Fa){var it=jo;Fa=!1,jo=null}else throw Error(i(198));ft||(ft=!0,hn=it)}}function $i(p){var g=p,w=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(w=g.return),p=g.return;while(p)}return g.tag===3?w:null}function Pl(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function Bo(p){if($i(p)!==p)throw Error(i(188))}function cu(p){var g=p.alternate;if(!g){if(g=$i(p),g===null)throw Error(i(188));return g!==p?null:p}for(var w=p,k=g;;){var V=w.return;if(V===null)break;var H=V.alternate;if(H===null){if(k=V.return,k!==null){w=k;continue}break}if(V.child===H.child){for(H=V.child;H;){if(H===w)return Bo(V),p;if(H===k)return Bo(V),g;H=H.sibling}throw Error(i(188))}if(w.return!==k.return)w=V,k=H;else{for(var he=!1,Re=V.child;Re;){if(Re===w){he=!0,w=V,k=H;break}if(Re===k){he=!0,k=V,w=H;break}Re=Re.sibling}if(!he){for(Re=H.child;Re;){if(Re===w){he=!0,w=H,k=V;break}if(Re===k){he=!0,k=H,w=V;break}Re=Re.sibling}if(!he)throw Error(i(189))}}if(w.alternate!==k)throw Error(i(190))}if(w.tag!==3)throw Error(i(188));return w.stateNode.current===w?p:g}function Ol(p){return p=cu(p),p!==null?sa(p):null}function sa(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=sa(p);if(g!==null)return g;p=p.sibling}return null}var lu=e.unstable_scheduleCallback,fc=e.unstable_cancelCallback,xi=e.unstable_shouldYield,as=e.unstable_requestPaint,vn=e.unstable_now,Ri=e.unstable_getCurrentPriorityLevel,Fc=e.unstable_ImmediatePriority,kl=e.unstable_UserBlockingPriority,ja=e.unstable_NormalPriority,Rp=e.unstable_LowPriority,lh=e.unstable_IdlePriority,uu=null,zo=null;function rm(p){if(zo&&typeof zo.onCommitFiberRoot=="function")try{zo.onCommitFiberRoot(uu,p,void 0,(p.current.flags&128)===128)}catch{}}var go=Math.clz32?Math.clz32:uh,Ip=Math.log,Nl=Math.LN2;function uh(p){return p>>>=0,p===0?32:31-(Ip(p)/Nl|0)|0}var dh=64,Tr=4194304;function du(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function hu(p,g){var w=p.pendingLanes;if(w===0)return 0;var k=0,V=p.suspendedLanes,H=p.pingedLanes,he=w&268435455;if(he!==0){var Re=he&~V;Re!==0?k=du(Re):(H&=he,H!==0&&(k=du(H)))}else he=w&~V,he!==0?k=du(he):H!==0&&(k=du(H));if(k===0)return 0;if(g!==0&&g!==k&&(g&V)===0&&(V=k&-k,H=g&-g,V>=H||V===16&&(H&4194240)!==0))return g;if((k&4)!==0&&(k|=w&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=k;0<g;)w=31-go(g),V=1<<w,k|=p[w],g&=~V;return k}function ad(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mc(p,g){for(var w=p.suspendedLanes,k=p.pingedLanes,V=p.expirationTimes,H=p.pendingLanes;0<H;){var he=31-go(H),Re=1<<he,Ue=V[he];Ue===-1?((Re&w)===0||(Re&k)!==0)&&(V[he]=ad(Re,g)):Ue<=g&&(p.expiredLanes|=Re),H&=~Re}}function oa(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function cd(){var p=dh;return dh<<=1,(dh&4194240)===0&&(dh=64),p}function Dl(p){for(var g=[],w=0;31>w;w++)g.push(p);return g}function pu(p,g,w){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-go(g),p[g]=w}function ei(p,g){var w=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var k=p.eventTimes;for(p=p.expirationTimes;0<w;){var V=31-go(w),H=1<<V;g[V]=0,k[V]=-1,p[V]=-1,w&=~H}}function gc(p,g){var w=p.entangledLanes|=g;for(p=p.entanglements;w;){var k=31-go(w),V=1<<k;V&g|p[k]&g&&(p[k]|=g),w&=~V}}var pr=0;function jc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var im,fu,hh,Ap,sm,Pp=!1,aa=[],fs=null,ca=null,la=null,mu=new Map,ua=new Map,da=[],om="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bc(p,g){switch(p){case"focusin":case"focusout":fs=null;break;case"dragenter":case"dragleave":ca=null;break;case"mouseover":case"mouseout":la=null;break;case"pointerover":case"pointerout":mu.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":ua.delete(g.pointerId)}}function Is(p,g,w,k,V,H){return p===null||p.nativeEvent!==H?(p={blockedOn:g,domEventName:w,eventSystemFlags:k,nativeEvent:H,targetContainers:[V]},g!==null&&(g=ym(g),g!==null&&fu(g)),p):(p.eventSystemFlags|=k,g=p.targetContainers,V!==null&&g.indexOf(V)===-1&&g.push(V),p)}function ld(p,g,w,k,V){switch(g){case"focusin":return fs=Is(fs,p,g,w,k,V),!0;case"dragenter":return ca=Is(ca,p,g,w,k,V),!0;case"mouseover":return la=Is(la,p,g,w,k,V),!0;case"pointerover":var H=V.pointerId;return mu.set(H,Is(mu.get(H)||null,p,g,w,k,V)),!0;case"gotpointercapture":return H=V.pointerId,ua.set(H,Is(ua.get(H)||null,p,g,w,k,V)),!0}return!1}function Op(p){var g=Vp(p.target);if(g!==null){var w=$i(g);if(w!==null){if(g=w.tag,g===13){if(g=Pl(w),g!==null){p.blockedOn=g,sm(p.priority,function(){hh(w)});return}}else if(g===3&&w.stateNode.current.memoizedState.isDehydrated){p.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}p.blockedOn=null}function xl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var w=Or(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(w===null){w=p.nativeEvent;var k=new w.constructor(w.type,w);Hs=k,w.target.dispatchEvent(k),Hs=null}else return g=ym(w),g!==null&&fu(g),p.blockedOn=w,!1;g.shift()}return!0}function gu(p,g,w){xl(p)&&w.delete(g)}function am(){Pp=!1,fs!==null&&xl(fs)&&(fs=null),ca!==null&&xl(ca)&&(ca=null),la!==null&&xl(la)&&(la=null),mu.forEach(gu),ua.forEach(gu)}function Ba(p,g){p.blockedOn===g&&(p.blockedOn=null,Pp||(Pp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,am)))}function za(p){function g(V){return Ba(V,p)}if(0<aa.length){Ba(aa[0],p);for(var w=1;w<aa.length;w++){var k=aa[w];k.blockedOn===p&&(k.blockedOn=null)}}for(fs!==null&&Ba(fs,p),ca!==null&&Ba(ca,p),la!==null&&Ba(la,p),mu.forEach(g),ua.forEach(g),w=0;w<da.length;w++)k=da[w],k.blockedOn===p&&(k.blockedOn=null);for(;0<da.length&&(w=da[0],w.blockedOn===null);)Op(w),w.blockedOn===null&&da.shift()}var Ll=oe.ReactCurrentBatchConfig,be=!0;function De(p,g,w,k){var V=pr,H=Ll.transition;Ll.transition=null;try{pr=1,Zt(p,g,w,k)}finally{pr=V,Ll.transition=H}}function rt(p,g,w,k){var V=pr,H=Ll.transition;Ll.transition=null;try{pr=4,Zt(p,g,w,k)}finally{pr=V,Ll.transition=H}}function Zt(p,g,w,k){if(be){var V=Or(p,g,w,k);if(V===null)fE(p,g,k,tr,w),Bc(p,k);else if(ld(V,p,g,w,k))k.stopPropagation();else if(Bc(p,k),g&4&&-1<om.indexOf(p)){for(;V!==null;){var H=ym(V);if(H!==null&&im(H),H=Or(p,g,w,k),H===null&&fE(p,g,k,tr,w),H===V)break;V=H}V!==null&&k.stopPropagation()}else fE(p,g,k,null,w)}}var tr=null;function Or(p,g,w,k){if(tr=null,p=io(k),p=Vp(p),p!==null)if(g=$i(p),g===null)p=null;else if(w=g.tag,w===13){if(p=Pl(g),p!==null)return p;p=null}else if(w===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return tr=p,null}function Jr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ri()){case Fc:return 1;case kl:return 4;case ja:case Rp:return 16;case lh:return 536870912;default:return 16}default:return 16}}var gn=null,Hr=null,Ii=null;function $s(){if(Ii)return Ii;var p,g=Hr,w=g.length,k,V="value"in gn?gn.value:gn.textContent,H=V.length;for(p=0;p<w&&g[p]===V[p];p++);var he=w-p;for(k=1;k<=he&&g[w-k]===V[H-k];k++);return Ii=V.slice(p,1<k?1-k:void 0)}function ha(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function pa(){return!0}function ud(){return!1}function cs(p){function g(w,k,V,H,he){this._reactName=w,this._targetInst=V,this.type=k,this.nativeEvent=H,this.target=he,this.currentTarget=null;for(var Re in p)p.hasOwnProperty(Re)&&(w=p[Re],this[Re]=w?w(H):H[Re]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?pa:ud,this.isPropagationStopped=ud,this}return Be(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=pa)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=pa)},persist:function(){},isPersistent:pa}),g}var Ml={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ph=cs(Ml),zc=Be({},Ml,{view:0,detail:0}),Kg=cs(zc),cm,dd,fa,_u=Be({},zc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==fa&&(fa&&p.type==="mousemove"?(cm=p.screenX-fa.screenX,dd=p.screenY-fa.screenY):dd=cm=0,fa=p),cm)},movementY:function(p){return"movementY"in p?p.movementY:dd}}),lm=cs(_u),qg=Be({},_u,{dataTransfer:0}),oE=cs(qg),um=Be({},zc,{relatedTarget:0}),dm=cs(um),hd=Be({},Ml,{animationName:0,elapsedTime:0,pseudoElement:0}),pd=cs(hd),fd=Be({},Ml,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Yg=cs(fd),aE=Be({},Ml,{data:0}),Gn=cs(aE),hm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ma={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=cE[p])?!!g[p]:!1}function Wc(){return lE}var A=Be({},zc,{key:function(p){if(p.key){var g=hm[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=ha(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?ma[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wc,charCode:function(p){return p.type==="keypress"?ha(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?ha(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),W=cs(A),re=Be({},_u,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ge=cs(re),Xe=Be({},zc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wc}),lt=cs(Xe),Gt=Be({},Ml,{propertyName:0,elapsedTime:0,pseudoElement:0}),ti=cs(Gt),gi=Be({},_u,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),kr=cs(gi),so=[9,13,27,32],As=_&&"CompositionEvent"in window,_c=null;_&&"documentMode"in document&&(_c=document.documentMode);var ga=_&&"TextEvent"in window&&!_c,kp=_&&(!As||_c&&8<_c&&11>=_c),pm=" ",yc=!1;function wR(p,g){switch(p){case"keyup":return so.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function CR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var fm=!1;function b1(p,g){switch(p){case"compositionend":return CR(g);case"keypress":return g.which!==32?null:(yc=!0,pm);case"textInput":return p=g.data,p===pm&&yc?null:p;default:return null}}function RR(p,g){if(fm)return p==="compositionend"||!As&&wR(p,g)?(p=$s(),Ii=Hr=gn=null,fm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return kp&&g.locale!=="ko"?null:g.data;default:return null}}var T1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function IR(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!T1[p.type]:g==="textarea"}function Y0(p,g,w,k){Ua(k),g=mE(g,"onChange"),0<g.length&&(w=new ph("onChange","change",null,w,k),p.push({event:w,listeners:g}))}var Np=null,Xg=null;function w1(p){nb(p,0)}function Dp(p){var g=Fp(p);if(ut(g))return p}function C1(p,g){if(p==="change")return g}var AR=!1;if(_){var X0;if(_){var Gc="oninput"in document;if(!Gc){var PR=document.createElement("div");PR.setAttribute("oninput","return;"),Gc=typeof PR.oninput=="function"}X0=Gc}else X0=!1;AR=X0&&(!document.documentMode||9<document.documentMode)}function OR(){Np&&(Np.detachEvent("onpropertychange",Wa),Xg=Np=null)}function Wa(p){if(p.propertyName==="value"&&Dp(Xg)){var g=[];Y0(g,Xg,p,io(p)),mo(w1,g)}}function R1(p,g,w){p==="focusin"?(OR(),Np=g,Xg=w,Np.attachEvent("onpropertychange",Wa)):p==="focusout"&&OR()}function I1(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Dp(Xg)}function A1(p,g){if(p==="click")return Dp(g)}function P1(p,g){if(p==="input"||p==="change")return Dp(g)}function kR(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var Ul=typeof Object.is=="function"?Object.is:kR;function Jg(p,g){if(Ul(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var w=Object.keys(p),k=Object.keys(g);if(w.length!==k.length)return!1;for(k=0;k<w.length;k++){var V=w[k];if(!E.call(g,V)||!Ul(p[V],g[V]))return!1}return!0}function NR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function J0(p,g){var w=NR(p);p=0;for(var k;w;){if(w.nodeType===3){if(k=p+w.textContent.length,p<=g&&k>=g)return{node:w,offset:g-p};p=k}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=NR(w)}}function DR(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?DR(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function xR(){for(var p=window,g=kt();g instanceof p.HTMLIFrameElement;){try{var w=typeof g.contentWindow.location.href=="string"}catch{w=!1}if(w)p=g.contentWindow;else break;g=kt(p.document)}return g}function Qg(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function Q0(p){var g=xR(),w=p.focusedElem,k=p.selectionRange;if(g!==w&&w&&w.ownerDocument&&DR(w.ownerDocument.documentElement,w)){if(k!==null&&Qg(w)){if(g=k.start,p=k.end,p===void 0&&(p=g),"selectionStart"in w)w.selectionStart=g,w.selectionEnd=Math.min(p,w.value.length);else if(p=(g=w.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var V=w.textContent.length,H=Math.min(k.start,V);k=k.end===void 0?H:Math.min(k.end,V),!p.extend&&H>k&&(V=k,k=H,H=V),V=J0(w,H);var he=J0(w,k);V&&he&&(p.rangeCount!==1||p.anchorNode!==V.node||p.anchorOffset!==V.offset||p.focusNode!==he.node||p.focusOffset!==he.offset)&&(g=g.createRange(),g.setStart(V.node,V.offset),p.removeAllRanges(),H>k?(p.addRange(g),p.extend(he.node,he.offset)):(g.setEnd(he.node,he.offset),p.addRange(g)))}}for(g=[],p=w;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<g.length;w++)p=g[w],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var O1=_&&"documentMode"in document&&11>=document.documentMode,ot=null,Z0=null,Zg=null,eb=!1;function LR(p,g,w){var k=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;eb||ot==null||ot!==kt(k)||(k=ot,"selectionStart"in k&&Qg(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),Zg&&Jg(Zg,k)||(Zg=k,k=mE(Z0,"onSelect"),0<k.length&&(g=new ph("onSelect","select",null,g,w),p.push({event:g,listeners:k}),g.target=ot)))}function uE(p,g){var w={};return w[p.toLowerCase()]=g.toLowerCase(),w["Webkit"+p]="webkit"+g,w["Moz"+p]="moz"+g,w}var mm={animationend:uE("Animation","AnimationEnd"),animationiteration:uE("Animation","AnimationIteration"),animationstart:uE("Animation","AnimationStart"),transitionend:uE("Transition","TransitionEnd")},tb={},MR={};_&&(MR=document.createElement("div").style,"AnimationEvent"in window||(delete mm.animationend.animation,delete mm.animationiteration.animation,delete mm.animationstart.animation),"TransitionEvent"in window||delete mm.transitionend.transition);function xp(p){if(tb[p])return tb[p];if(!mm[p])return p;var g=mm[p],w;for(w in g)if(g.hasOwnProperty(w)&&w in MR)return tb[p]=g[w];return p}var Lp=xp("animationend"),UR=xp("animationiteration"),VR=xp("animationstart"),FR=xp("transitionend"),jR=new Map,dE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fh(p,g){jR.set(p,g),u(g,[p])}for(var hE=0;hE<dE.length;hE++){var Ec=dE[hE],k1=Ec.toLowerCase(),e_=Ec[0].toUpperCase()+Ec.slice(1);fh(k1,"on"+e_)}fh(Lp,"onAnimationEnd"),fh(UR,"onAnimationIteration"),fh(VR,"onAnimationStart"),fh("dblclick","onDoubleClick"),fh("focusin","onFocus"),fh("focusout","onBlur"),fh(FR,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var t_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),N1=new Set("cancel close invalid load scroll toggle".split(" ").concat(t_));function BR(p,g,w){var k=p.type||"unknown-event";p.currentTarget=w,Al(k,g,void 0,p),p.currentTarget=null}function nb(p,g){g=(g&4)!==0;for(var w=0;w<p.length;w++){var k=p[w],V=k.event;k=k.listeners;e:{var H=void 0;if(g)for(var he=k.length-1;0<=he;he--){var Re=k[he],Ue=Re.instance,it=Re.currentTarget;if(Re=Re.listener,Ue!==H&&V.isPropagationStopped())break e;BR(V,Re,it),H=Ue}else for(he=0;he<k.length;he++){if(Re=k[he],Ue=Re.instance,it=Re.currentTarget,Re=Re.listener,Ue!==H&&V.isPropagationStopped())break e;BR(V,Re,it),H=Ue}}}if(ft)throw p=hn,ft=!1,hn=null,p}function Li(p,g){var w=g[s_];w===void 0&&(w=g[s_]=new Set);var k=p+"__bubble";w.has(k)||(zR(g,p,2,!1),w.add(k))}function rb(p,g,w){var k=0;g&&(k|=4),zR(w,p,k,g)}var pE="_reactListening"+Math.random().toString(36).slice(2);function Mp(p){if(!p[pE]){p[pE]=!0,a.forEach(function(w){w!=="selectionchange"&&(N1.has(w)||rb(w,!1,p),rb(w,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[pE]||(g[pE]=!0,rb("selectionchange",!1,g))}}function zR(p,g,w,k){switch(Jr(g)){case 1:var V=De;break;case 4:V=rt;break;default:V=Zt}w=V.bind(null,g,w,p),V=void 0,!os||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(V=!0),k?V!==void 0?p.addEventListener(g,w,{capture:!0,passive:V}):p.addEventListener(g,w,!0):V!==void 0?p.addEventListener(g,w,{passive:V}):p.addEventListener(g,w,!1)}function fE(p,g,w,k,V){var H=k;if((g&1)===0&&(g&2)===0&&k!==null)e:for(;;){if(k===null)return;var he=k.tag;if(he===3||he===4){var Re=k.stateNode.containerInfo;if(Re===V||Re.nodeType===8&&Re.parentNode===V)break;if(he===4)for(he=k.return;he!==null;){var Ue=he.tag;if((Ue===3||Ue===4)&&(Ue=he.stateNode.containerInfo,Ue===V||Ue.nodeType===8&&Ue.parentNode===V))return;he=he.return}for(;Re!==null;){if(he=Vp(Re),he===null)return;if(Ue=he.tag,Ue===5||Ue===6){k=H=he;continue e}Re=Re.parentNode}}k=k.return}mo(function(){var it=H,Dt=io(w),Lt=[];e:{var Nt=jR.get(p);if(Nt!==void 0){var Jt=ph,on=p;switch(p){case"keypress":if(ha(w)===0)break e;case"keydown":case"keyup":Jt=W;break;case"focusin":on="focus",Jt=dm;break;case"focusout":on="blur",Jt=dm;break;case"beforeblur":case"afterblur":Jt=dm;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Jt=lm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Jt=oE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Jt=lt;break;case Lp:case UR:case VR:Jt=pd;break;case FR:Jt=ti;break;case"scroll":Jt=Kg;break;case"wheel":Jt=kr;break;case"copy":case"cut":case"paste":Jt=Yg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Jt=ge}var an=(g&4)!==0,us=!an&&p==="scroll",Qe=an?Nt!==null?Nt+"Capture":null:Nt;an=[];for(var je=it,tt;je!==null;){tt=je;var Ft=tt.stateNode;if(tt.tag===5&&Ft!==null&&(tt=Ft,Qe!==null&&(Ft=Di(je,Qe),Ft!=null&&an.push(gm(je,Ft,tt)))),us)break;je=je.return}0<an.length&&(Nt=new Jt(Nt,on,null,w,Dt),Lt.push({event:Nt,listeners:an}))}}if((g&7)===0){e:{if(Nt=p==="mouseover"||p==="pointerover",Jt=p==="mouseout"||p==="pointerout",Nt&&w!==Hs&&(on=w.relatedTarget||w.fromElement)&&(Vp(on)||on[Hc]))break e;if((Jt||Nt)&&(Nt=Dt.window===Dt?Dt:(Nt=Dt.ownerDocument)?Nt.defaultView||Nt.parentWindow:window,Jt?(on=w.relatedTarget||w.toElement,Jt=it,on=on?Vp(on):null,on!==null&&(us=$i(on),on!==us||on.tag!==5&&on.tag!==6)&&(on=null)):(Jt=null,on=it),Jt!==on)){if(an=lm,Ft="onMouseLeave",Qe="onMouseEnter",je="mouse",(p==="pointerout"||p==="pointerover")&&(an=ge,Ft="onPointerLeave",Qe="onPointerEnter",je="pointer"),us=Jt==null?Nt:Fp(Jt),tt=on==null?Nt:Fp(on),Nt=new an(Ft,je+"leave",Jt,w,Dt),Nt.target=us,Nt.relatedTarget=tt,Ft=null,Vp(Dt)===it&&(an=new an(Qe,je+"enter",on,w,Dt),an.target=tt,an.relatedTarget=us,Ft=an),us=Ft,Jt&&on)t:{for(an=Jt,Qe=on,je=0,tt=an;tt;tt=Up(tt))je++;for(tt=0,Ft=Qe;Ft;Ft=Up(Ft))tt++;for(;0<je-tt;)an=Up(an),je--;for(;0<tt-je;)Qe=Up(Qe),tt--;for(;je--;){if(an===Qe||Qe!==null&&an===Qe.alternate)break t;an=Up(an),Qe=Up(Qe)}an=null}else an=null;Jt!==null&&n_(Lt,Nt,Jt,an,!1),on!==null&&us!==null&&n_(Lt,us,on,an,!0)}}e:{if(Nt=it?Fp(it):window,Jt=Nt.nodeName&&Nt.nodeName.toLowerCase(),Jt==="select"||Jt==="input"&&Nt.type==="file")var cn=C1;else if(IR(Nt))if(AR)cn=P1;else{cn=I1;var Sn=R1}else(Jt=Nt.nodeName)&&Jt.toLowerCase()==="input"&&(Nt.type==="checkbox"||Nt.type==="radio")&&(cn=A1);if(cn&&(cn=cn(p,it))){Y0(Lt,cn,w,Dt);break e}Sn&&Sn(p,Nt,it),p==="focusout"&&(Sn=Nt._wrapperState)&&Sn.controlled&&Nt.type==="number"&&Ve(Nt,"number",Nt.value)}switch(Sn=it?Fp(it):window,p){case"focusin":(IR(Sn)||Sn.contentEditable==="true")&&(ot=Sn,Z0=it,Zg=null);break;case"focusout":Zg=Z0=ot=null;break;case"mousedown":eb=!0;break;case"contextmenu":case"mouseup":case"dragend":eb=!1,LR(Lt,w,Dt);break;case"selectionchange":if(O1)break;case"keydown":case"keyup":LR(Lt,w,Dt)}var Cn;if(As)e:{switch(p){case"compositionstart":var Fn="onCompositionStart";break e;case"compositionend":Fn="onCompositionEnd";break e;case"compositionupdate":Fn="onCompositionUpdate";break e}Fn=void 0}else fm?wR(p,w)&&(Fn="onCompositionEnd"):p==="keydown"&&w.keyCode===229&&(Fn="onCompositionStart");Fn&&(kp&&w.locale!=="ko"&&(fm||Fn!=="onCompositionStart"?Fn==="onCompositionEnd"&&fm&&(Cn=$s()):(gn=Dt,Hr="value"in gn?gn.value:gn.textContent,fm=!0)),Sn=mE(it,Fn),0<Sn.length&&(Fn=new Gn(Fn,p,null,w,Dt),Lt.push({event:Fn,listeners:Sn}),Cn?Fn.data=Cn:(Cn=CR(w),Cn!==null&&(Fn.data=Cn)))),(Cn=ga?b1(p,w):RR(p,w))&&(it=mE(it,"onBeforeInput"),0<it.length&&(Dt=new Gn("onBeforeInput","beforeinput",null,w,Dt),Lt.push({event:Dt,listeners:it}),Dt.data=Cn))}nb(Lt,g)})}function gm(p,g,w){return{instance:p,listener:g,currentTarget:w}}function mE(p,g){for(var w=g+"Capture",k=[];p!==null;){var V=p,H=V.stateNode;V.tag===5&&H!==null&&(V=H,H=Di(p,w),H!=null&&k.unshift(gm(p,H,V)),H=Di(p,g),H!=null&&k.push(gm(p,H,V))),p=p.return}return k}function Up(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function n_(p,g,w,k,V){for(var H=g._reactName,he=[];w!==null&&w!==k;){var Re=w,Ue=Re.alternate,it=Re.stateNode;if(Ue!==null&&Ue===k)break;Re.tag===5&&it!==null&&(Re=it,V?(Ue=Di(w,H),Ue!=null&&he.unshift(gm(w,Ue,Re))):V||(Ue=Di(w,H),Ue!=null&&he.push(gm(w,Ue,Re)))),w=w.return}he.length!==0&&p.push({event:g,listeners:he})}var D1=/\r\n?/g,x1=/\u0000|\uFFFD/g;function WR(p){return(typeof p=="string"?p:""+p).replace(D1,`
`).replace(x1,"")}function gE(p,g,w){if(g=WR(g),WR(p)!==g&&w)throw Error(i(425))}function _E(){}var yE=null,r_=null;function ib(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var i_=typeof setTimeout=="function"?setTimeout:void 0,L1=typeof clearTimeout=="function"?clearTimeout:void 0,GR=typeof Promise=="function"?Promise:void 0,M1=typeof queueMicrotask=="function"?queueMicrotask:typeof GR<"u"?function(p){return GR.resolve(null).then(p).catch(U1)}:i_;function U1(p){setTimeout(function(){throw p})}function sb(p,g){var w=g,k=0;do{var V=w.nextSibling;if(p.removeChild(w),V&&V.nodeType===8)if(w=V.data,w==="/$"){if(k===0){p.removeChild(V),za(g);return}k--}else w!=="$"&&w!=="$?"&&w!=="$!"||k++;w=V}while(w);za(g)}function mh(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function HR(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var w=p.data;if(w==="$"||w==="$!"||w==="$?"){if(g===0)return p;g--}else w==="/$"&&g++}p=p.previousSibling}return null}var _m=Math.random().toString(36).slice(2),yu="__reactFiber$"+_m,gh="__reactProps$"+_m,Hc="__reactContainer$"+_m,s_="__reactEvents$"+_m,V1="__reactListeners$"+_m,F1="__reactHandles$"+_m;function Vp(p){var g=p[yu];if(g)return g;for(var w=p.parentNode;w;){if(g=w[Hc]||w[yu]){if(w=g.alternate,g.child!==null||w!==null&&w.child!==null)for(p=HR(p);p!==null;){if(w=p[yu])return w;p=HR(p)}return g}p=w,w=p.parentNode}return null}function ym(p){return p=p[yu]||p[Hc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Fp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function Em(p){return p[gh]||null}var ob=[],vm=-1;function $c(p){return{current:p}}function Mi(p){0>vm||(p.current=ob[vm],ob[vm]=null,vm--)}function Ai(p,g){vm++,ob[vm]=p.current,p.current=g}var _h={},Wo=$c(_h),Ga=$c(!1),jp=_h;function Bp(p,g){var w=p.type.contextTypes;if(!w)return _h;var k=p.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===g)return k.__reactInternalMemoizedMaskedChildContext;var V={},H;for(H in w)V[H]=g[H];return k&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=V),V}function Ha(p){return p=p.childContextTypes,p!=null}function EE(){Mi(Ga),Mi(Wo)}function $R(p,g,w){if(Wo.current!==_h)throw Error(i(168));Ai(Wo,g),Ai(Ga,w)}function vE(p,g,w){var k=p.stateNode;if(g=g.childContextTypes,typeof k.getChildContext!="function")return w;k=k.getChildContext();for(var V in k)if(!(V in g))throw Error(i(108,qe(p)||"Unknown",V));return Be({},w,k)}function SE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||_h,jp=Wo.current,Ai(Wo,p),Ai(Ga,Ga.current),!0}function KR(p,g,w){var k=p.stateNode;if(!k)throw Error(i(169));w?(p=vE(p,g,jp),k.__reactInternalMemoizedMergedChildContext=p,Mi(Ga),Mi(Wo),Ai(Wo,p)):Mi(Ga),Ai(Ga,w)}var Kc=null,bE=!1,ab=!1;function qR(p){Kc===null?Kc=[p]:Kc.push(p)}function j1(p){bE=!0,qR(p)}function yh(){if(!ab&&Kc!==null){ab=!0;var p=0,g=pr;try{var w=Kc;for(pr=1;p<w.length;p++){var k=w[p];do k=k(!0);while(k!==null)}Kc=null,bE=!1}catch(V){throw Kc!==null&&(Kc=Kc.slice(p+1)),lu(Fc,yh),V}finally{pr=g,ab=!1}}return null}var Sm=[],md=0,o_=null,TE=0,qc=[],vc=0,zp=null,gd=1,_d="";function yd(p,g){Sm[md++]=TE,Sm[md++]=o_,o_=p,TE=g}function wE(p,g,w){qc[vc++]=gd,qc[vc++]=_d,qc[vc++]=zp,zp=p;var k=gd;p=_d;var V=32-go(k)-1;k&=~(1<<V),w+=1;var H=32-go(g)+V;if(30<H){var he=V-V%5;H=(k&(1<<he)-1).toString(32),k>>=he,V-=he,gd=1<<32-go(g)+V|w<<V|k,_d=H+p}else gd=1<<H|w<<V|k,_d=p}function CE(p){p.return!==null&&(yd(p,1),wE(p,1,0))}function a_(p){for(;p===o_;)o_=Sm[--md],Sm[md]=null,TE=Sm[--md],Sm[md]=null;for(;p===zp;)zp=qc[--vc],qc[vc]=null,_d=qc[--vc],qc[vc]=null,gd=qc[--vc],qc[vc]=null}var $a=null,Ka=null,_i=!1,_a=null;function YR(p,g){var w=Tc(5,null,null,0);w.elementType="DELETED",w.stateNode=g,w.return=p,g=p.deletions,g===null?(p.deletions=[w],p.flags|=16):g.push(w)}function XR(p,g){switch(p.tag){case 5:var w=p.type;return g=g.nodeType!==1||w.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,$a=p,Ka=mh(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,$a=p,Ka=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(w=zp!==null?{id:gd,overflow:_d}:null,p.memoizedState={dehydrated:g,treeContext:w,retryLane:1073741824},w=Tc(18,null,null,0),w.stateNode=g,w.return=p,p.child=w,$a=p,Ka=null,!0):!1;default:return!1}}function RE(p){return(p.mode&1)!==0&&(p.flags&128)===0}function cb(p){if(_i){var g=Ka;if(g){var w=g;if(!XR(p,g)){if(RE(p))throw Error(i(418));g=mh(w.nextSibling);var k=$a;g&&XR(p,g)?YR(k,w):(p.flags=p.flags&-4097|2,_i=!1,$a=p)}}else{if(RE(p))throw Error(i(418));p.flags=p.flags&-4097|2,_i=!1,$a=p}}}function JR(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;$a=p}function c_(p){if(p!==$a)return!1;if(!_i)return JR(p),_i=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!ib(p.type,p.memoizedProps)),g&&(g=Ka)){if(RE(p))throw QR(),Error(i(418));for(;g;)YR(p,g),g=mh(g.nextSibling)}if(JR(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var w=p.data;if(w==="/$"){if(g===0){Ka=mh(p.nextSibling);break e}g--}else w!=="$"&&w!=="$!"&&w!=="$?"||g++}p=p.nextSibling}Ka=null}}else Ka=$a?mh(p.stateNode.nextSibling):null;return!0}function QR(){for(var p=Ka;p;)p=mh(p.nextSibling)}function bm(){Ka=$a=null,_i=!1}function lb(p){_a===null?_a=[p]:_a.push(p)}var B1=oe.ReactCurrentBatchConfig;function l_(p,g,w){if(p=w.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(i(309));var k=w.stateNode}if(!k)throw Error(i(147,p));var V=k,H=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(he){var Re=V.refs;he===null?delete Re[H]:Re[H]=he},g._stringRef=H,g)}if(typeof p!="string")throw Error(i(284));if(!w._owner)throw Error(i(290,p))}return p}function IE(p,g){throw p=Object.prototype.toString.call(g),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function ub(p){var g=p._init;return g(p._payload)}function Eh(p){function g(Qe,je){if(p){var tt=Qe.deletions;tt===null?(Qe.deletions=[je],Qe.flags|=16):tt.push(je)}}function w(Qe,je){if(!p)return null;for(;je!==null;)g(Qe,je),je=je.sibling;return null}function k(Qe,je){for(Qe=new Map;je!==null;)je.key!==null?Qe.set(je.key,je):Qe.set(je.index,je),je=je.sibling;return Qe}function V(Qe,je){return Qe=Rd(Qe,je),Qe.index=0,Qe.sibling=null,Qe}function H(Qe,je,tt){return Qe.index=tt,p?(tt=Qe.alternate,tt!==null?(tt=tt.index,tt<je?(Qe.flags|=2,je):tt):(Qe.flags|=2,je)):(Qe.flags|=1048576,je)}function he(Qe){return p&&Qe.alternate===null&&(Qe.flags|=2),Qe}function Re(Qe,je,tt,Ft){return je===null||je.tag!==6?(je=Kb(tt,Qe.mode,Ft),je.return=Qe,je):(je=V(je,tt),je.return=Qe,je)}function Ue(Qe,je,tt,Ft){var cn=tt.type;return cn===Y?Dt(Qe,je,tt.props.children,Ft,tt.key):je!==null&&(je.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===Fe&&ub(cn)===je.type)?(Ft=V(je,tt.props),Ft.ref=l_(Qe,je,tt),Ft.return=Qe,Ft):(Ft=pv(tt.type,tt.key,tt.props,null,Qe.mode,Ft),Ft.ref=l_(Qe,je,tt),Ft.return=Qe,Ft)}function it(Qe,je,tt,Ft){return je===null||je.tag!==4||je.stateNode.containerInfo!==tt.containerInfo||je.stateNode.implementation!==tt.implementation?(je=qb(tt,Qe.mode,Ft),je.return=Qe,je):(je=V(je,tt.children||[]),je.return=Qe,je)}function Dt(Qe,je,tt,Ft,cn){return je===null||je.tag!==7?(je=ef(tt,Qe.mode,Ft,cn),je.return=Qe,je):(je=V(je,tt),je.return=Qe,je)}function Lt(Qe,je,tt){if(typeof je=="string"&&je!==""||typeof je=="number")return je=Kb(""+je,Qe.mode,tt),je.return=Qe,je;if(typeof je=="object"&&je!==null){switch(je.$$typeof){case ae:return tt=pv(je.type,je.key,je.props,null,Qe.mode,tt),tt.ref=l_(Qe,null,je),tt.return=Qe,tt;case le:return je=qb(je,Qe.mode,tt),je.return=Qe,je;case Fe:var Ft=je._init;return Lt(Qe,Ft(je._payload),tt)}if($e(je)||Se(je))return je=ef(je,Qe.mode,tt,null),je.return=Qe,je;IE(Qe,je)}return null}function Nt(Qe,je,tt,Ft){var cn=je!==null?je.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number")return cn!==null?null:Re(Qe,je,""+tt,Ft);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case ae:return tt.key===cn?Ue(Qe,je,tt,Ft):null;case le:return tt.key===cn?it(Qe,je,tt,Ft):null;case Fe:return cn=tt._init,Nt(Qe,je,cn(tt._payload),Ft)}if($e(tt)||Se(tt))return cn!==null?null:Dt(Qe,je,tt,Ft,null);IE(Qe,tt)}return null}function Jt(Qe,je,tt,Ft,cn){if(typeof Ft=="string"&&Ft!==""||typeof Ft=="number")return Qe=Qe.get(tt)||null,Re(je,Qe,""+Ft,cn);if(typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case ae:return Qe=Qe.get(Ft.key===null?tt:Ft.key)||null,Ue(je,Qe,Ft,cn);case le:return Qe=Qe.get(Ft.key===null?tt:Ft.key)||null,it(je,Qe,Ft,cn);case Fe:var Sn=Ft._init;return Jt(Qe,je,tt,Sn(Ft._payload),cn)}if($e(Ft)||Se(Ft))return Qe=Qe.get(tt)||null,Dt(je,Qe,Ft,cn,null);IE(je,Ft)}return null}function on(Qe,je,tt,Ft){for(var cn=null,Sn=null,Cn=je,Fn=je=0,Ds=null;Cn!==null&&Fn<tt.length;Fn++){Cn.index>Fn?(Ds=Cn,Cn=null):Ds=Cn.sibling;var Nr=Nt(Qe,Cn,tt[Fn],Ft);if(Nr===null){Cn===null&&(Cn=Ds);break}p&&Cn&&Nr.alternate===null&&g(Qe,Cn),je=H(Nr,je,Fn),Sn===null?cn=Nr:Sn.sibling=Nr,Sn=Nr,Cn=Ds}if(Fn===tt.length)return w(Qe,Cn),_i&&yd(Qe,Fn),cn;if(Cn===null){for(;Fn<tt.length;Fn++)Cn=Lt(Qe,tt[Fn],Ft),Cn!==null&&(je=H(Cn,je,Fn),Sn===null?cn=Cn:Sn.sibling=Cn,Sn=Cn);return _i&&yd(Qe,Fn),cn}for(Cn=k(Qe,Cn);Fn<tt.length;Fn++)Ds=Jt(Cn,Qe,Fn,tt[Fn],Ft),Ds!==null&&(p&&Ds.alternate!==null&&Cn.delete(Ds.key===null?Fn:Ds.key),je=H(Ds,je,Fn),Sn===null?cn=Ds:Sn.sibling=Ds,Sn=Ds);return p&&Cn.forEach(function(Oh){return g(Qe,Oh)}),_i&&yd(Qe,Fn),cn}function an(Qe,je,tt,Ft){var cn=Se(tt);if(typeof cn!="function")throw Error(i(150));if(tt=cn.call(tt),tt==null)throw Error(i(151));for(var Sn=cn=null,Cn=je,Fn=je=0,Ds=null,Nr=tt.next();Cn!==null&&!Nr.done;Fn++,Nr=tt.next()){Cn.index>Fn?(Ds=Cn,Cn=null):Ds=Cn.sibling;var Oh=Nt(Qe,Cn,Nr.value,Ft);if(Oh===null){Cn===null&&(Cn=Ds);break}p&&Cn&&Oh.alternate===null&&g(Qe,Cn),je=H(Oh,je,Fn),Sn===null?cn=Oh:Sn.sibling=Oh,Sn=Oh,Cn=Ds}if(Nr.done)return w(Qe,Cn),_i&&yd(Qe,Fn),cn;if(Cn===null){for(;!Nr.done;Fn++,Nr=tt.next())Nr=Lt(Qe,Nr.value,Ft),Nr!==null&&(je=H(Nr,je,Fn),Sn===null?cn=Nr:Sn.sibling=Nr,Sn=Nr);return _i&&yd(Qe,Fn),cn}for(Cn=k(Qe,Cn);!Nr.done;Fn++,Nr=tt.next())Nr=Jt(Cn,Qe,Fn,Nr.value,Ft),Nr!==null&&(p&&Nr.alternate!==null&&Cn.delete(Nr.key===null?Fn:Nr.key),je=H(Nr,je,Fn),Sn===null?cn=Nr:Sn.sibling=Nr,Sn=Nr);return p&&Cn.forEach(function(rD){return g(Qe,rD)}),_i&&yd(Qe,Fn),cn}function us(Qe,je,tt,Ft){if(typeof tt=="object"&&tt!==null&&tt.type===Y&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case ae:e:{for(var cn=tt.key,Sn=je;Sn!==null;){if(Sn.key===cn){if(cn=tt.type,cn===Y){if(Sn.tag===7){w(Qe,Sn.sibling),je=V(Sn,tt.props.children),je.return=Qe,Qe=je;break e}}else if(Sn.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===Fe&&ub(cn)===Sn.type){w(Qe,Sn.sibling),je=V(Sn,tt.props),je.ref=l_(Qe,Sn,tt),je.return=Qe,Qe=je;break e}w(Qe,Sn);break}else g(Qe,Sn);Sn=Sn.sibling}tt.type===Y?(je=ef(tt.props.children,Qe.mode,Ft,tt.key),je.return=Qe,Qe=je):(Ft=pv(tt.type,tt.key,tt.props,null,Qe.mode,Ft),Ft.ref=l_(Qe,je,tt),Ft.return=Qe,Qe=Ft)}return he(Qe);case le:e:{for(Sn=tt.key;je!==null;){if(je.key===Sn)if(je.tag===4&&je.stateNode.containerInfo===tt.containerInfo&&je.stateNode.implementation===tt.implementation){w(Qe,je.sibling),je=V(je,tt.children||[]),je.return=Qe,Qe=je;break e}else{w(Qe,je);break}else g(Qe,je);je=je.sibling}je=qb(tt,Qe.mode,Ft),je.return=Qe,Qe=je}return he(Qe);case Fe:return Sn=tt._init,us(Qe,je,Sn(tt._payload),Ft)}if($e(tt))return on(Qe,je,tt,Ft);if(Se(tt))return an(Qe,je,tt,Ft);IE(Qe,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"?(tt=""+tt,je!==null&&je.tag===6?(w(Qe,je.sibling),je=V(je,tt),je.return=Qe,Qe=je):(w(Qe,je),je=Kb(tt,Qe.mode,Ft),je.return=Qe,Qe=je),he(Qe)):w(Qe,je)}return us}var Tm=Eh(!0),ZR=Eh(!1),AE=$c(null),u_=null,wm=null,PE=null;function db(){PE=wm=u_=null}function hb(p){var g=AE.current;Mi(AE),p._currentValue=g}function pb(p,g,w){for(;p!==null;){var k=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,k!==null&&(k.childLanes|=g)):k!==null&&(k.childLanes&g)!==g&&(k.childLanes|=g),p===w)break;p=p.return}}function Ed(p,g){u_=p,PE=wm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Ya=!0),p.firstContext=null)}function Yc(p){var g=p._currentValue;if(PE!==p)if(p={context:p,memoizedValue:g,next:null},wm===null){if(u_===null)throw Error(i(308));wm=p,u_.dependencies={lanes:0,firstContext:p}}else wm=wm.next=p;return g}var Wp=null;function fb(p){Wp===null?Wp=[p]:Wp.push(p)}function eI(p,g,w,k){var V=g.interleaved;return V===null?(w.next=w,fb(g)):(w.next=V.next,V.next=w),g.interleaved=w,vd(p,k)}function vd(p,g){p.lanes|=g;var w=p.alternate;for(w!==null&&(w.lanes|=g),w=p,p=p.return;p!==null;)p.childLanes|=g,w=p.alternate,w!==null&&(w.childLanes|=g),w=p,p=p.return;return w.tag===3?w.stateNode:null}var vh=!1;function d_(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function tI(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Eu(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function Sh(p,g,w){var k=p.updateQueue;if(k===null)return null;if(k=k.shared,(Mr&2)!==0){var V=k.pending;return V===null?g.next=g:(g.next=V.next,V.next=g),k.pending=g,vd(p,w)}return V=k.interleaved,V===null?(g.next=g,fb(k)):(g.next=V.next,V.next=g),k.interleaved=g,vd(p,w)}function h_(p,g,w){if(g=g.updateQueue,g!==null&&(g=g.shared,(w&4194240)!==0)){var k=g.lanes;k&=p.pendingLanes,w|=k,g.lanes=w,gc(p,w)}}function nI(p,g){var w=p.updateQueue,k=p.alternate;if(k!==null&&(k=k.updateQueue,w===k)){var V=null,H=null;if(w=w.firstBaseUpdate,w!==null){do{var he={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};H===null?V=H=he:H=H.next=he,w=w.next}while(w!==null);H===null?V=H=g:H=H.next=g}else V=H=g;w={baseState:k.baseState,firstBaseUpdate:V,lastBaseUpdate:H,shared:k.shared,effects:k.effects},p.updateQueue=w;return}p=w.lastBaseUpdate,p===null?w.firstBaseUpdate=g:p.next=g,w.lastBaseUpdate=g}function OE(p,g,w,k){var V=p.updateQueue;vh=!1;var H=V.firstBaseUpdate,he=V.lastBaseUpdate,Re=V.shared.pending;if(Re!==null){V.shared.pending=null;var Ue=Re,it=Ue.next;Ue.next=null,he===null?H=it:he.next=it,he=Ue;var Dt=p.alternate;Dt!==null&&(Dt=Dt.updateQueue,Re=Dt.lastBaseUpdate,Re!==he&&(Re===null?Dt.firstBaseUpdate=it:Re.next=it,Dt.lastBaseUpdate=Ue))}if(H!==null){var Lt=V.baseState;he=0,Dt=it=Ue=null,Re=H;do{var Nt=Re.lane,Jt=Re.eventTime;if((k&Nt)===Nt){Dt!==null&&(Dt=Dt.next={eventTime:Jt,lane:0,tag:Re.tag,payload:Re.payload,callback:Re.callback,next:null});e:{var on=p,an=Re;switch(Nt=g,Jt=w,an.tag){case 1:if(on=an.payload,typeof on=="function"){Lt=on.call(Jt,Lt,Nt);break e}Lt=on;break e;case 3:on.flags=on.flags&-65537|128;case 0:if(on=an.payload,Nt=typeof on=="function"?on.call(Jt,Lt,Nt):on,Nt==null)break e;Lt=Be({},Lt,Nt);break e;case 2:vh=!0}}Re.callback!==null&&Re.lane!==0&&(p.flags|=64,Nt=V.effects,Nt===null?V.effects=[Re]:Nt.push(Re))}else Jt={eventTime:Jt,lane:Nt,tag:Re.tag,payload:Re.payload,callback:Re.callback,next:null},Dt===null?(it=Dt=Jt,Ue=Lt):Dt=Dt.next=Jt,he|=Nt;if(Re=Re.next,Re===null){if(Re=V.shared.pending,Re===null)break;Nt=Re,Re=Nt.next,Nt.next=null,V.lastBaseUpdate=Nt,V.shared.pending=null}}while(!0);if(Dt===null&&(Ue=Lt),V.baseState=Ue,V.firstBaseUpdate=it,V.lastBaseUpdate=Dt,g=V.shared.interleaved,g!==null){V=g;do he|=V.lane,V=V.next;while(V!==g)}else H===null&&(V.shared.lanes=0);Yp|=he,p.lanes=he,p.memoizedState=Lt}}function rI(p,g,w){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var k=p[g],V=k.callback;if(V!==null){if(k.callback=null,k=w,typeof V!="function")throw Error(i(191,V));V.call(k)}}}var p_={},vu=$c(p_),f_=$c(p_),Cm=$c(p_);function Gp(p){if(p===p_)throw Error(i(174));return p}function mb(p,g){switch(Ai(Cm,g),Ai(f_,p),Ai(vu,p_),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:tn(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=tn(g,p)}Mi(vu),Ai(vu,g)}function Hp(){Mi(vu),Mi(f_),Mi(Cm)}function iI(p){Gp(Cm.current);var g=Gp(vu.current),w=tn(g,p.type);g!==w&&(Ai(f_,p),Ai(vu,w))}function Rm(p){f_.current===p&&(Mi(vu),Mi(f_))}var zi=$c(0);function bh(p){for(var g=p;g!==null;){if(g.tag===13){var w=g.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var gb=[];function _b(){for(var p=0;p<gb.length;p++)gb[p]._workInProgressVersionPrimary=null;gb.length=0}var kE=oe.ReactCurrentDispatcher,yb=oe.ReactCurrentBatchConfig,Su=0,Ki=null,Ps=null,Os=null,Im=!1,m_=!1,g_=0,z1=0;function Go(){throw Error(i(321))}function Eb(p,g){if(g===null)return!1;for(var w=0;w<g.length&&w<p.length;w++)if(!Ul(p[w],g[w]))return!1;return!0}function Am(p,g,w,k,V,H){if(Su=H,Ki=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,kE.current=p===null||p.memoizedState===null?H1:mI,p=w(k,V),m_){H=0;do{if(m_=!1,g_=0,25<=H)throw Error(i(301));H+=1,Os=Ps=null,g.updateQueue=null,kE.current=$1,p=w(k,V)}while(m_)}if(kE.current=LE,g=Ps!==null&&Ps.next!==null,Su=0,Os=Ps=Ki=null,Im=!1,g)throw Error(i(300));return p}function vb(){var p=g_!==0;return g_=0,p}function ya(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Os===null?Ki.memoizedState=Os=p:Os=Os.next=p,Os}function qa(){if(Ps===null){var p=Ki.alternate;p=p!==null?p.memoizedState:null}else p=Ps.next;var g=Os===null?Ki.memoizedState:Os.next;if(g!==null)Os=g,Ps=p;else{if(p===null)throw Error(i(310));Ps=p,p={memoizedState:Ps.memoizedState,baseState:Ps.baseState,baseQueue:Ps.baseQueue,queue:Ps.queue,next:null},Os===null?Ki.memoizedState=Os=p:Os=Os.next=p}return Os}function Th(p,g){return typeof g=="function"?g(p):g}function $p(p){var g=qa(),w=g.queue;if(w===null)throw Error(i(311));w.lastRenderedReducer=p;var k=Ps,V=k.baseQueue,H=w.pending;if(H!==null){if(V!==null){var he=V.next;V.next=H.next,H.next=he}k.baseQueue=V=H,w.pending=null}if(V!==null){H=V.next,k=k.baseState;var Re=he=null,Ue=null,it=H;do{var Dt=it.lane;if((Su&Dt)===Dt)Ue!==null&&(Ue=Ue.next={lane:0,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null}),k=it.hasEagerState?it.eagerState:p(k,it.action);else{var Lt={lane:Dt,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null};Ue===null?(Re=Ue=Lt,he=k):Ue=Ue.next=Lt,Ki.lanes|=Dt,Yp|=Dt}it=it.next}while(it!==null&&it!==H);Ue===null?he=k:Ue.next=Re,Ul(k,g.memoizedState)||(Ya=!0),g.memoizedState=k,g.baseState=he,g.baseQueue=Ue,w.lastRenderedState=k}if(p=w.interleaved,p!==null){V=p;do H=V.lane,Ki.lanes|=H,Yp|=H,V=V.next;while(V!==p)}else V===null&&(w.lanes=0);return[g.memoizedState,w.dispatch]}function Pm(p){var g=qa(),w=g.queue;if(w===null)throw Error(i(311));w.lastRenderedReducer=p;var k=w.dispatch,V=w.pending,H=g.memoizedState;if(V!==null){w.pending=null;var he=V=V.next;do H=p(H,he.action),he=he.next;while(he!==V);Ul(H,g.memoizedState)||(Ya=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),w.lastRenderedState=H}return[H,k]}function sI(){}function Sb(p,g){var w=Ki,k=qa(),V=g(),H=!Ul(k.memoizedState,V);if(H&&(k.memoizedState=V,Ya=!0),k=k.queue,Xc(aI.bind(null,w,k,p),[p]),k.getSnapshot!==g||H||Os!==null&&Os.memoizedState.tag&1){if(w.flags|=2048,__(9,bb.bind(null,w,k,V,g),void 0,null),oo===null)throw Error(i(349));(Su&30)!==0||oI(w,g,V)}return V}function oI(p,g,w){p.flags|=16384,p={getSnapshot:g,value:w},g=Ki.updateQueue,g===null?(g={lastEffect:null,stores:null},Ki.updateQueue=g,g.stores=[p]):(w=g.stores,w===null?g.stores=[p]:w.push(p))}function bb(p,g,w,k){g.value=w,g.getSnapshot=k,cI(g)&&NE(p)}function aI(p,g,w){return w(function(){cI(g)&&NE(p)})}function cI(p){var g=p.getSnapshot;p=p.value;try{var w=g();return!Ul(p,w)}catch{return!0}}function NE(p){var g=vd(p,1);g!==null&&el(g,p,1,-1)}function DE(p){var g=ya();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Th,lastRenderedState:p},g.queue=p,p=p.dispatch=G1.bind(null,Ki,p),[g.memoizedState,p]}function __(p,g,w,k){return p={tag:p,create:g,destroy:w,deps:k,next:null},g=Ki.updateQueue,g===null?(g={lastEffect:null,stores:null},Ki.updateQueue=g,g.lastEffect=p.next=p):(w=g.lastEffect,w===null?g.lastEffect=p.next=p:(k=w.next,w.next=p,p.next=k,g.lastEffect=p)),p}function lI(){return qa().memoizedState}function y_(p,g,w,k){var V=ya();Ki.flags|=p,V.memoizedState=__(1|g,w,void 0,k===void 0?null:k)}function Om(p,g,w,k){var V=qa();k=k===void 0?null:k;var H=void 0;if(Ps!==null){var he=Ps.memoizedState;if(H=he.destroy,k!==null&&Eb(k,he.deps)){V.memoizedState=__(g,w,H,k);return}}Ki.flags|=p,V.memoizedState=__(1|g,w,H,k)}function uI(p,g){return y_(8390656,8,p,g)}function Xc(p,g){return Om(2048,8,p,g)}function Kp(p,g){return Om(4,2,p,g)}function wh(p,g){return Om(4,4,p,g)}function Tb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function wb(p,g,w){return w=w!=null?w.concat([p]):null,Om(4,4,Tb.bind(null,g,p),w)}function Sd(){}function xE(p,g){var w=qa();g=g===void 0?null:g;var k=w.memoizedState;return k!==null&&g!==null&&Eb(g,k[1])?k[0]:(w.memoizedState=[p,g],p)}function dI(p,g){var w=qa();g=g===void 0?null:g;var k=w.memoizedState;return k!==null&&g!==null&&Eb(g,k[1])?k[0]:(p=p(),w.memoizedState=[p,g],p)}function Cb(p,g,w){return(Su&21)===0?(p.baseState&&(p.baseState=!1,Ya=!0),p.memoizedState=w):(Ul(w,g)||(w=cd(),Ki.lanes|=w,Yp|=w,p.baseState=!0),g)}function W1(p,g){var w=pr;pr=w!==0&&4>w?w:4,p(!0);var k=yb.transition;yb.transition={};try{p(!1),g()}finally{pr=w,yb.transition=k}}function Rb(){return qa().memoizedState}function hI(p,g,w){var k=Zc(p);if(w={lane:k,action:w,hasEagerState:!1,eagerState:null,next:null},bd(p))pI(g,w);else if(w=eI(p,g,w,k),w!==null){var V=Eo();el(w,p,k,V),fI(w,g,k)}}function G1(p,g,w){var k=Zc(p),V={lane:k,action:w,hasEagerState:!1,eagerState:null,next:null};if(bd(p))pI(g,V);else{var H=p.alternate;if(p.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var he=g.lastRenderedState,Re=H(he,w);if(V.hasEagerState=!0,V.eagerState=Re,Ul(Re,he)){var Ue=g.interleaved;Ue===null?(V.next=V,fb(g)):(V.next=Ue.next,Ue.next=V),g.interleaved=V;return}}catch{}finally{}w=eI(p,g,V,k),w!==null&&(V=Eo(),el(w,p,k,V),fI(w,g,k))}}function bd(p){var g=p.alternate;return p===Ki||g!==null&&g===Ki}function pI(p,g){m_=Im=!0;var w=p.pending;w===null?g.next=g:(g.next=w.next,w.next=g),p.pending=g}function fI(p,g,w){if((w&4194240)!==0){var k=g.lanes;k&=p.pendingLanes,w|=k,g.lanes=w,gc(p,w)}}var LE={readContext:Yc,useCallback:Go,useContext:Go,useEffect:Go,useImperativeHandle:Go,useInsertionEffect:Go,useLayoutEffect:Go,useMemo:Go,useReducer:Go,useRef:Go,useState:Go,useDebugValue:Go,useDeferredValue:Go,useTransition:Go,useMutableSource:Go,useSyncExternalStore:Go,useId:Go,unstable_isNewReconciler:!1},H1={readContext:Yc,useCallback:function(p,g){return ya().memoizedState=[p,g===void 0?null:g],p},useContext:Yc,useEffect:uI,useImperativeHandle:function(p,g,w){return w=w!=null?w.concat([p]):null,y_(4194308,4,Tb.bind(null,g,p),w)},useLayoutEffect:function(p,g){return y_(4194308,4,p,g)},useInsertionEffect:function(p,g){return y_(4,2,p,g)},useMemo:function(p,g){var w=ya();return g=g===void 0?null:g,p=p(),w.memoizedState=[p,g],p},useReducer:function(p,g,w){var k=ya();return g=w!==void 0?w(g):g,k.memoizedState=k.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},k.queue=p,p=p.dispatch=hI.bind(null,Ki,p),[k.memoizedState,p]},useRef:function(p){var g=ya();return p={current:p},g.memoizedState=p},useState:DE,useDebugValue:Sd,useDeferredValue:function(p){return ya().memoizedState=p},useTransition:function(){var p=DE(!1),g=p[0];return p=W1.bind(null,p[1]),ya().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,w){var k=Ki,V=ya();if(_i){if(w===void 0)throw Error(i(407));w=w()}else{if(w=g(),oo===null)throw Error(i(349));(Su&30)!==0||oI(k,g,w)}V.memoizedState=w;var H={value:w,getSnapshot:g};return V.queue=H,uI(aI.bind(null,k,H,p),[p]),k.flags|=2048,__(9,bb.bind(null,k,H,w,g),void 0,null),w},useId:function(){var p=ya(),g=oo.identifierPrefix;if(_i){var w=_d,k=gd;w=(k&~(1<<32-go(k)-1)).toString(32)+w,g=":"+g+"R"+w,w=g_++,0<w&&(g+="H"+w.toString(32)),g+=":"}else w=z1++,g=":"+g+"r"+w.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},mI={readContext:Yc,useCallback:xE,useContext:Yc,useEffect:Xc,useImperativeHandle:wb,useInsertionEffect:Kp,useLayoutEffect:wh,useMemo:dI,useReducer:$p,useRef:lI,useState:function(){return $p(Th)},useDebugValue:Sd,useDeferredValue:function(p){var g=qa();return Cb(g,Ps.memoizedState,p)},useTransition:function(){var p=$p(Th)[0],g=qa().memoizedState;return[p,g]},useMutableSource:sI,useSyncExternalStore:Sb,useId:Rb,unstable_isNewReconciler:!1},$1={readContext:Yc,useCallback:xE,useContext:Yc,useEffect:Xc,useImperativeHandle:wb,useInsertionEffect:Kp,useLayoutEffect:wh,useMemo:dI,useReducer:Pm,useRef:lI,useState:function(){return Pm(Th)},useDebugValue:Sd,useDeferredValue:function(p){var g=qa();return Ps===null?g.memoizedState=p:Cb(g,Ps.memoizedState,p)},useTransition:function(){var p=Pm(Th)[0],g=qa().memoizedState;return[p,g]},useMutableSource:sI,useSyncExternalStore:Sb,useId:Rb,unstable_isNewReconciler:!1};function Sc(p,g){if(p&&p.defaultProps){g=Be({},g),p=p.defaultProps;for(var w in p)g[w]===void 0&&(g[w]=p[w]);return g}return g}function ME(p,g,w,k){g=p.memoizedState,w=w(k,g),w=w==null?g:Be({},g,w),p.memoizedState=w,p.lanes===0&&(p.updateQueue.baseState=w)}var UE={isMounted:function(p){return(p=p._reactInternals)?$i(p)===p:!1},enqueueSetState:function(p,g,w){p=p._reactInternals;var k=Eo(),V=Zc(p),H=Eu(k,V);H.payload=g,w!=null&&(H.callback=w),g=Sh(p,H,V),g!==null&&(el(g,p,V,k),h_(g,p,V))},enqueueReplaceState:function(p,g,w){p=p._reactInternals;var k=Eo(),V=Zc(p),H=Eu(k,V);H.tag=1,H.payload=g,w!=null&&(H.callback=w),g=Sh(p,H,V),g!==null&&(el(g,p,V,k),h_(g,p,V))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var w=Eo(),k=Zc(p),V=Eu(w,k);V.tag=2,g!=null&&(V.callback=g),g=Sh(p,V,k),g!==null&&(el(g,p,k,w),h_(g,p,k))}};function Ib(p,g,w,k,V,H,he){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(k,H,he):g.prototype&&g.prototype.isPureReactComponent?!Jg(w,k)||!Jg(V,H):!0}function gI(p,g,w){var k=!1,V=_h,H=g.contextType;return typeof H=="object"&&H!==null?H=Yc(H):(V=Ha(g)?jp:Wo.current,k=g.contextTypes,H=(k=k!=null)?Bp(p,V):_h),g=new g(w,H),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=UE,p.stateNode=g,g._reactInternals=p,k&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=V,p.__reactInternalMemoizedMaskedChildContext=H),g}function _I(p,g,w,k){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(w,k),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(w,k),g.state!==p&&UE.enqueueReplaceState(g,g.state,null)}function Ab(p,g,w,k){var V=p.stateNode;V.props=w,V.state=p.memoizedState,V.refs={},d_(p);var H=g.contextType;typeof H=="object"&&H!==null?V.context=Yc(H):(H=Ha(g)?jp:Wo.current,V.context=Bp(p,H)),V.state=p.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(ME(p,g,H,w),V.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(g=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),g!==V.state&&UE.enqueueReplaceState(V,V.state,null),OE(p,w,V,k),V.state=p.memoizedState),typeof V.componentDidMount=="function"&&(p.flags|=4194308)}function km(p,g){try{var w="",k=g;do w+=ze(k),k=k.return;while(k);var V=w}catch(H){V=`
Error generating stack: `+H.message+`
`+H.stack}return{value:p,source:g,stack:V,digest:null}}function Pb(p,g,w){return{value:p,source:null,stack:w??null,digest:g??null}}function Ob(p,g){try{console.error(g.value)}catch(w){setTimeout(function(){throw w})}}var K1=typeof WeakMap=="function"?WeakMap:Map;function kb(p,g,w){w=Eu(-1,w),w.tag=3,w.payload={element:null};var k=g.value;return w.callback=function(){tv||(tv=!0,zb=k),Ob(p,g)},w}function Td(p,g,w){w=Eu(-1,w),w.tag=3;var k=p.type.getDerivedStateFromError;if(typeof k=="function"){var V=g.value;w.payload=function(){return k(V)},w.callback=function(){Ob(p,g)}}var H=p.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(w.callback=function(){Ob(p,g),typeof k!="function"&&(Ch===null?Ch=new Set([this]):Ch.add(this));var he=g.stack;this.componentDidCatch(g.value,{componentStack:he!==null?he:""})}),w}function yI(p,g,w){var k=p.pingCache;if(k===null){k=p.pingCache=new K1;var V=new Set;k.set(g,V)}else V=k.get(g),V===void 0&&(V=new Set,k.set(g,V));V.has(w)||(V.add(w),p=zI.bind(null,p,g,w),g.then(p,p))}function EI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function vI(p,g,w,k,V){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(g=Eu(-1,1),g.tag=2,Sh(w,g,1))),w.lanes|=1),p):(p.flags|=65536,p.lanes=V,p)}var q1=oe.ReactCurrentOwner,Ya=!1;function Ea(p,g,w,k){g.child=p===null?ZR(g,null,w,k):Tm(g,p.child,w,k)}function VE(p,g,w,k,V){w=w.render;var H=g.ref;return Ed(g,V),k=Am(p,g,w,k,H,V),w=vb(),p!==null&&!Ya?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~V,bu(p,g,V)):(_i&&w&&CE(g),g.flags|=1,Ea(p,g,k,V),g.child)}function SI(p,g,w,k,V){if(p===null){var H=w.type;return typeof H=="function"&&!Ih(H)&&H.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(g.tag=15,g.type=H,bI(p,g,H,k,V)):(p=pv(w.type,null,k,g,g.mode,V),p.ref=g.ref,p.return=g,g.child=p)}if(H=p.child,(p.lanes&V)===0){var he=H.memoizedProps;if(w=w.compare,w=w!==null?w:Jg,w(he,k)&&p.ref===g.ref)return bu(p,g,V)}return g.flags|=1,p=Rd(H,k),p.ref=g.ref,p.return=g,g.child=p}function bI(p,g,w,k,V){if(p!==null){var H=p.memoizedProps;if(Jg(H,k)&&p.ref===g.ref)if(Ya=!1,g.pendingProps=k=H,(p.lanes&V)!==0)(p.flags&131072)!==0&&(Ya=!0);else return g.lanes=p.lanes,bu(p,g,V)}return Nb(p,g,w,k,V)}function TI(p,g,w){var k=g.pendingProps,V=k.children,H=p!==null?p.memoizedState:null;if(k.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ai(Vl,bc),bc|=w;else{if((w&1073741824)===0)return p=H!==null?H.baseLanes|w:w,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,Ai(Vl,bc),bc|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},k=H!==null?H.baseLanes:w,Ai(Vl,bc),bc|=k}else H!==null?(k=H.baseLanes|w,g.memoizedState=null):k=w,Ai(Vl,bc),bc|=k;return Ea(p,g,V,w),g.child}function wI(p,g){var w=g.ref;(p===null&&w!==null||p!==null&&p.ref!==w)&&(g.flags|=512,g.flags|=2097152)}function Nb(p,g,w,k,V){var H=Ha(w)?jp:Wo.current;return H=Bp(g,H),Ed(g,V),w=Am(p,g,w,k,H,V),k=vb(),p!==null&&!Ya?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~V,bu(p,g,V)):(_i&&k&&CE(g),g.flags|=1,Ea(p,g,w,V),g.child)}function CI(p,g,w,k,V){if(Ha(w)){var H=!0;SE(g)}else H=!1;if(Ed(g,V),g.stateNode===null)GE(p,g),gI(g,w,k),Ab(g,w,k,V),k=!0;else if(p===null){var he=g.stateNode,Re=g.memoizedProps;he.props=Re;var Ue=he.context,it=w.contextType;typeof it=="object"&&it!==null?it=Yc(it):(it=Ha(w)?jp:Wo.current,it=Bp(g,it));var Dt=w.getDerivedStateFromProps,Lt=typeof Dt=="function"||typeof he.getSnapshotBeforeUpdate=="function";Lt||typeof he.UNSAFE_componentWillReceiveProps!="function"&&typeof he.componentWillReceiveProps!="function"||(Re!==k||Ue!==it)&&_I(g,he,k,it),vh=!1;var Nt=g.memoizedState;he.state=Nt,OE(g,k,he,V),Ue=g.memoizedState,Re!==k||Nt!==Ue||Ga.current||vh?(typeof Dt=="function"&&(ME(g,w,Dt,k),Ue=g.memoizedState),(Re=vh||Ib(g,w,Re,k,Nt,Ue,it))?(Lt||typeof he.UNSAFE_componentWillMount!="function"&&typeof he.componentWillMount!="function"||(typeof he.componentWillMount=="function"&&he.componentWillMount(),typeof he.UNSAFE_componentWillMount=="function"&&he.UNSAFE_componentWillMount()),typeof he.componentDidMount=="function"&&(g.flags|=4194308)):(typeof he.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=k,g.memoizedState=Ue),he.props=k,he.state=Ue,he.context=it,k=Re):(typeof he.componentDidMount=="function"&&(g.flags|=4194308),k=!1)}else{he=g.stateNode,tI(p,g),Re=g.memoizedProps,it=g.type===g.elementType?Re:Sc(g.type,Re),he.props=it,Lt=g.pendingProps,Nt=he.context,Ue=w.contextType,typeof Ue=="object"&&Ue!==null?Ue=Yc(Ue):(Ue=Ha(w)?jp:Wo.current,Ue=Bp(g,Ue));var Jt=w.getDerivedStateFromProps;(Dt=typeof Jt=="function"||typeof he.getSnapshotBeforeUpdate=="function")||typeof he.UNSAFE_componentWillReceiveProps!="function"&&typeof he.componentWillReceiveProps!="function"||(Re!==Lt||Nt!==Ue)&&_I(g,he,k,Ue),vh=!1,Nt=g.memoizedState,he.state=Nt,OE(g,k,he,V);var on=g.memoizedState;Re!==Lt||Nt!==on||Ga.current||vh?(typeof Jt=="function"&&(ME(g,w,Jt,k),on=g.memoizedState),(it=vh||Ib(g,w,it,k,Nt,on,Ue)||!1)?(Dt||typeof he.UNSAFE_componentWillUpdate!="function"&&typeof he.componentWillUpdate!="function"||(typeof he.componentWillUpdate=="function"&&he.componentWillUpdate(k,on,Ue),typeof he.UNSAFE_componentWillUpdate=="function"&&he.UNSAFE_componentWillUpdate(k,on,Ue)),typeof he.componentDidUpdate=="function"&&(g.flags|=4),typeof he.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof he.componentDidUpdate!="function"||Re===p.memoizedProps&&Nt===p.memoizedState||(g.flags|=4),typeof he.getSnapshotBeforeUpdate!="function"||Re===p.memoizedProps&&Nt===p.memoizedState||(g.flags|=1024),g.memoizedProps=k,g.memoizedState=on),he.props=k,he.state=on,he.context=Ue,k=it):(typeof he.componentDidUpdate!="function"||Re===p.memoizedProps&&Nt===p.memoizedState||(g.flags|=4),typeof he.getSnapshotBeforeUpdate!="function"||Re===p.memoizedProps&&Nt===p.memoizedState||(g.flags|=1024),k=!1)}return FE(p,g,w,k,H,V)}function FE(p,g,w,k,V,H){wI(p,g);var he=(g.flags&128)!==0;if(!k&&!he)return V&&KR(g,w,!1),bu(p,g,H);k=g.stateNode,q1.current=g;var Re=he&&typeof w.getDerivedStateFromError!="function"?null:k.render();return g.flags|=1,p!==null&&he?(g.child=Tm(g,p.child,null,H),g.child=Tm(g,null,Re,H)):Ea(p,g,Re,H),g.memoizedState=k.state,V&&KR(g,w,!0),g.child}function Db(p){var g=p.stateNode;g.pendingContext?$R(p,g.pendingContext,g.pendingContext!==g.context):g.context&&$R(p,g.context,!1),mb(p,g.containerInfo)}function RI(p,g,w,k,V){return bm(),lb(V),g.flags|=256,Ea(p,g,w,k),g.child}var xb={dehydrated:null,treeContext:null,retryLane:0};function Nm(p){return{baseLanes:p,cachePool:null,transitions:null}}function jE(p,g,w){var k=g.pendingProps,V=zi.current,H=!1,he=(g.flags&128)!==0,Re;if((Re=he)||(Re=p!==null&&p.memoizedState===null?!1:(V&2)!==0),Re?(H=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(V|=1),Ai(zi,V&1),p===null)return cb(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(he=k.children,p=k.fallback,H?(k=g.mode,H=g.child,he={mode:"hidden",children:he},(k&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=he):H=Ah(he,k,0,null),p=ef(p,k,w,null),H.return=g,p.return=g,H.sibling=p,g.child=H,g.child.memoizedState=Nm(w),g.memoizedState=xb,p):BE(g,he));if(V=p.memoizedState,V!==null&&(Re=V.dehydrated,Re!==null))return II(p,g,he,k,Re,V,w);if(H){H=k.fallback,he=g.mode,V=p.child,Re=V.sibling;var Ue={mode:"hidden",children:k.children};return(he&1)===0&&g.child!==V?(k=g.child,k.childLanes=0,k.pendingProps=Ue,g.deletions=null):(k=Rd(V,Ue),k.subtreeFlags=V.subtreeFlags&14680064),Re!==null?H=Rd(Re,H):(H=ef(H,he,w,null),H.flags|=2),H.return=g,k.return=g,k.sibling=H,g.child=k,k=H,H=g.child,he=p.child.memoizedState,he=he===null?Nm(w):{baseLanes:he.baseLanes|w,cachePool:null,transitions:he.transitions},H.memoizedState=he,H.childLanes=p.childLanes&~w,g.memoizedState=xb,k}return H=p.child,p=H.sibling,k=Rd(H,{mode:"visible",children:k.children}),(g.mode&1)===0&&(k.lanes=w),k.return=g,k.sibling=null,p!==null&&(w=g.deletions,w===null?(g.deletions=[p],g.flags|=16):w.push(p)),g.child=k,g.memoizedState=null,k}function BE(p,g){return g=Ah({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function qp(p,g,w,k){return k!==null&&lb(k),Tm(g,p.child,null,w),p=BE(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function II(p,g,w,k,V,H,he){if(w)return g.flags&256?(g.flags&=-257,k=Pb(Error(i(422))),qp(p,g,he,k)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(H=k.fallback,V=g.mode,k=Ah({mode:"visible",children:k.children},V,0,null),H=ef(H,V,he,null),H.flags|=2,k.return=g,H.return=g,k.sibling=H,g.child=k,(g.mode&1)!==0&&Tm(g,p.child,null,he),g.child.memoizedState=Nm(he),g.memoizedState=xb,H);if((g.mode&1)===0)return qp(p,g,he,null);if(V.data==="$!"){if(k=V.nextSibling&&V.nextSibling.dataset,k)var Re=k.dgst;return k=Re,H=Error(i(419)),k=Pb(H,k,void 0),qp(p,g,he,k)}if(Re=(he&p.childLanes)!==0,Ya||Re){if(k=oo,k!==null){switch(he&-he){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(k.suspendedLanes|he))!==0?0:V,V!==0&&V!==H.retryLane&&(H.retryLane=V,vd(p,V),el(k,p,V,-1))}return Hb(),k=Pb(Error(i(421))),qp(p,g,he,k)}return V.data==="$?"?(g.flags|=128,g.child=p.child,g=uv.bind(null,p),V._reactRetry=g,null):(p=H.treeContext,Ka=mh(V.nextSibling),$a=g,_i=!0,_a=null,p!==null&&(qc[vc++]=gd,qc[vc++]=_d,qc[vc++]=zp,gd=p.id,_d=p.overflow,zp=g),g=BE(g,k.children),g.flags|=4096,g)}function AI(p,g,w){p.lanes|=g;var k=p.alternate;k!==null&&(k.lanes|=g),pb(p.return,g,w)}function zE(p,g,w,k,V){var H=p.memoizedState;H===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:k,tail:w,tailMode:V}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=k,H.tail=w,H.tailMode=V)}function WE(p,g,w){var k=g.pendingProps,V=k.revealOrder,H=k.tail;if(Ea(p,g,k.children,w),k=zi.current,(k&2)!==0)k=k&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&AI(p,w,g);else if(p.tag===19)AI(p,w,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}k&=1}if(Ai(zi,k),(g.mode&1)===0)g.memoizedState=null;else switch(V){case"forwards":for(w=g.child,V=null;w!==null;)p=w.alternate,p!==null&&bh(p)===null&&(V=w),w=w.sibling;w=V,w===null?(V=g.child,g.child=null):(V=w.sibling,w.sibling=null),zE(g,!1,V,w,H);break;case"backwards":for(w=null,V=g.child,g.child=null;V!==null;){if(p=V.alternate,p!==null&&bh(p)===null){g.child=V;break}p=V.sibling,V.sibling=w,w=V,V=p}zE(g,!0,w,null,H);break;case"together":zE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function GE(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function bu(p,g,w){if(p!==null&&(g.dependencies=p.dependencies),Yp|=g.lanes,(w&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(i(153));if(g.child!==null){for(p=g.child,w=Rd(p,p.pendingProps),g.child=w,w.return=g;p.sibling!==null;)p=p.sibling,w=w.sibling=Rd(p,p.pendingProps),w.return=g;w.sibling=null}return g.child}function PI(p,g,w){switch(g.tag){case 3:Db(g),bm();break;case 5:iI(g);break;case 1:Ha(g.type)&&SE(g);break;case 4:mb(g,g.stateNode.containerInfo);break;case 10:var k=g.type._context,V=g.memoizedProps.value;Ai(AE,k._currentValue),k._currentValue=V;break;case 13:if(k=g.memoizedState,k!==null)return k.dehydrated!==null?(Ai(zi,zi.current&1),g.flags|=128,null):(w&g.child.childLanes)!==0?jE(p,g,w):(Ai(zi,zi.current&1),p=bu(p,g,w),p!==null?p.sibling:null);Ai(zi,zi.current&1);break;case 19:if(k=(w&g.childLanes)!==0,(p.flags&128)!==0){if(k)return WE(p,g,w);g.flags|=128}if(V=g.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),Ai(zi,zi.current),k)break;return null;case 22:case 23:return g.lanes=0,TI(p,g,w)}return bu(p,g,w)}var OI,HE,Lb,kI;OI=function(p,g){for(var w=g.child;w!==null;){if(w.tag===5||w.tag===6)p.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===g)break;for(;w.sibling===null;){if(w.return===null||w.return===g)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},HE=function(){},Lb=function(p,g,w,k){var V=p.memoizedProps;if(V!==k){p=g.stateNode,Gp(vu.current);var H=null;switch(w){case"input":V=ct(p,V),k=ct(p,k),H=[];break;case"select":V=Be({},V,{value:void 0}),k=Be({},k,{value:void 0}),H=[];break;case"textarea":V=vt(p,V),k=vt(p,k),H=[];break;default:typeof V.onClick!="function"&&typeof k.onClick=="function"&&(p.onclick=_E)}zn(w,k);var he;w=null;for(it in V)if(!k.hasOwnProperty(it)&&V.hasOwnProperty(it)&&V[it]!=null)if(it==="style"){var Re=V[it];for(he in Re)Re.hasOwnProperty(he)&&(w||(w={}),w[he]="")}else it!=="dangerouslySetInnerHTML"&&it!=="children"&&it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(l.hasOwnProperty(it)?H||(H=[]):(H=H||[]).push(it,null));for(it in k){var Ue=k[it];if(Re=V!=null?V[it]:void 0,k.hasOwnProperty(it)&&Ue!==Re&&(Ue!=null||Re!=null))if(it==="style")if(Re){for(he in Re)!Re.hasOwnProperty(he)||Ue&&Ue.hasOwnProperty(he)||(w||(w={}),w[he]="");for(he in Ue)Ue.hasOwnProperty(he)&&Re[he]!==Ue[he]&&(w||(w={}),w[he]=Ue[he])}else w||(H||(H=[]),H.push(it,w)),w=Ue;else it==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Re=Re?Re.__html:void 0,Ue!=null&&Re!==Ue&&(H=H||[]).push(it,Ue)):it==="children"?typeof Ue!="string"&&typeof Ue!="number"||(H=H||[]).push(it,""+Ue):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&(l.hasOwnProperty(it)?(Ue!=null&&it==="onScroll"&&Li("scroll",p),H||Re===Ue||(H=[])):(H=H||[]).push(it,Ue))}w&&(H=H||[]).push("style",w);var it=H;(g.updateQueue=it)&&(g.flags|=4)}},kI=function(p,g,w,k){w!==k&&(g.flags|=4)};function E_(p,g){if(!_i)switch(p.tailMode){case"hidden":g=p.tail;for(var w=null;g!==null;)g.alternate!==null&&(w=g),g=g.sibling;w===null?p.tail=null:w.sibling=null;break;case"collapsed":w=p.tail;for(var k=null;w!==null;)w.alternate!==null&&(k=w),w=w.sibling;k===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:k.sibling=null}}function Ho(p){var g=p.alternate!==null&&p.alternate.child===p.child,w=0,k=0;if(g)for(var V=p.child;V!==null;)w|=V.lanes|V.childLanes,k|=V.subtreeFlags&14680064,k|=V.flags&14680064,V.return=p,V=V.sibling;else for(V=p.child;V!==null;)w|=V.lanes|V.childLanes,k|=V.subtreeFlags,k|=V.flags,V.return=p,V=V.sibling;return p.subtreeFlags|=k,p.childLanes=w,g}function $E(p,g,w){var k=g.pendingProps;switch(a_(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ho(g),null;case 1:return Ha(g.type)&&EE(),Ho(g),null;case 3:return k=g.stateNode,Hp(),Mi(Ga),Mi(Wo),_b(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(p===null||p.child===null)&&(c_(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,_a!==null&&(ov(_a),_a=null))),HE(p,g),Ho(g),null;case 5:Rm(g);var V=Gp(Cm.current);if(w=g.type,p!==null&&g.stateNode!=null)Lb(p,g,w,k,V),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!k){if(g.stateNode===null)throw Error(i(166));return Ho(g),null}if(p=Gp(vu.current),c_(g)){k=g.stateNode,w=g.type;var H=g.memoizedProps;switch(k[yu]=g,k[gh]=H,p=(g.mode&1)!==0,w){case"dialog":Li("cancel",k),Li("close",k);break;case"iframe":case"object":case"embed":Li("load",k);break;case"video":case"audio":for(V=0;V<t_.length;V++)Li(t_[V],k);break;case"source":Li("error",k);break;case"img":case"image":case"link":Li("error",k),Li("load",k);break;case"details":Li("toggle",k);break;case"input":Mt(k,H),Li("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!H.multiple},Li("invalid",k);break;case"textarea":St(k,H),Li("invalid",k)}zn(w,H),V=null;for(var he in H)if(H.hasOwnProperty(he)){var Re=H[he];he==="children"?typeof Re=="string"?k.textContent!==Re&&(H.suppressHydrationWarning!==!0&&gE(k.textContent,Re,p),V=["children",Re]):typeof Re=="number"&&k.textContent!==""+Re&&(H.suppressHydrationWarning!==!0&&gE(k.textContent,Re,p),V=["children",""+Re]):l.hasOwnProperty(he)&&Re!=null&&he==="onScroll"&&Li("scroll",k)}switch(w){case"input":sn(k),Te(k,H,!0);break;case"textarea":sn(k),dn(k);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(k.onclick=_E)}k=V,g.updateQueue=k,k!==null&&(g.flags|=4)}else{he=V.nodeType===9?V:V.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=En(w)),p==="http://www.w3.org/1999/xhtml"?w==="script"?(p=he.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof k.is=="string"?p=he.createElement(w,{is:k.is}):(p=he.createElement(w),w==="select"&&(he=p,k.multiple?he.multiple=!0:k.size&&(he.size=k.size))):p=he.createElementNS(p,w),p[yu]=g,p[gh]=k,OI(p,g,!1,!1),g.stateNode=p;e:{switch(he=ra(w,k),w){case"dialog":Li("cancel",p),Li("close",p),V=k;break;case"iframe":case"object":case"embed":Li("load",p),V=k;break;case"video":case"audio":for(V=0;V<t_.length;V++)Li(t_[V],p);V=k;break;case"source":Li("error",p),V=k;break;case"img":case"image":case"link":Li("error",p),Li("load",p),V=k;break;case"details":Li("toggle",p),V=k;break;case"input":Mt(p,k),V=ct(p,k),Li("invalid",p);break;case"option":V=k;break;case"select":p._wrapperState={wasMultiple:!!k.multiple},V=Be({},k,{value:void 0}),Li("invalid",p);break;case"textarea":St(p,k),V=vt(p,k),Li("invalid",p);break;default:V=k}zn(w,V),Re=V;for(H in Re)if(Re.hasOwnProperty(H)){var Ue=Re[H];H==="style"?Cs(p,Ue):H==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ue!=null&&sr(p,Ue)):H==="children"?typeof Ue=="string"?(w!=="textarea"||Ue!=="")&&xt(p,Ue):typeof Ue=="number"&&xt(p,""+Ue):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Ue!=null&&H==="onScroll"&&Li("scroll",p):Ue!=null&&ne(p,H,Ue,he))}switch(w){case"input":sn(p),Te(p,k,!1);break;case"textarea":sn(p),dn(p);break;case"option":k.value!=null&&p.setAttribute("value",""+nt(k.value));break;case"select":p.multiple=!!k.multiple,H=k.value,H!=null?Et(p,!!k.multiple,H,!1):k.defaultValue!=null&&Et(p,!!k.multiple,k.defaultValue,!0);break;default:typeof V.onClick=="function"&&(p.onclick=_E)}switch(w){case"button":case"input":case"select":case"textarea":k=!!k.autoFocus;break e;case"img":k=!0;break e;default:k=!1}}k&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Ho(g),null;case 6:if(p&&g.stateNode!=null)kI(p,g,p.memoizedProps,k);else{if(typeof k!="string"&&g.stateNode===null)throw Error(i(166));if(w=Gp(Cm.current),Gp(vu.current),c_(g)){if(k=g.stateNode,w=g.memoizedProps,k[yu]=g,(H=k.nodeValue!==w)&&(p=$a,p!==null))switch(p.tag){case 3:gE(k.nodeValue,w,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&gE(k.nodeValue,w,(p.mode&1)!==0)}H&&(g.flags|=4)}else k=(w.nodeType===9?w:w.ownerDocument).createTextNode(k),k[yu]=g,g.stateNode=k}return Ho(g),null;case 13:if(Mi(zi),k=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(_i&&Ka!==null&&(g.mode&1)!==0&&(g.flags&128)===0)QR(),bm(),g.flags|=98560,H=!1;else if(H=c_(g),k!==null&&k.dehydrated!==null){if(p===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[yu]=g}else bm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Ho(g),H=!1}else _a!==null&&(ov(_a),_a=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=w,g):(k=k!==null,k!==(p!==null&&p.memoizedState!==null)&&k&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(zi.current&1)!==0?Ns===0&&(Ns=3):Hb())),g.updateQueue!==null&&(g.flags|=4),Ho(g),null);case 4:return Hp(),HE(p,g),p===null&&Mp(g.stateNode.containerInfo),Ho(g),null;case 10:return hb(g.type._context),Ho(g),null;case 17:return Ha(g.type)&&EE(),Ho(g),null;case 19:if(Mi(zi),H=g.memoizedState,H===null)return Ho(g),null;if(k=(g.flags&128)!==0,he=H.rendering,he===null)if(k)E_(H,!1);else{if(Ns!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(he=bh(p),he!==null){for(g.flags|=128,E_(H,!1),k=he.updateQueue,k!==null&&(g.updateQueue=k,g.flags|=4),g.subtreeFlags=0,k=w,w=g.child;w!==null;)H=w,p=k,H.flags&=14680066,he=H.alternate,he===null?(H.childLanes=0,H.lanes=p,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=he.childLanes,H.lanes=he.lanes,H.child=he.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=he.memoizedProps,H.memoizedState=he.memoizedState,H.updateQueue=he.updateQueue,H.type=he.type,p=he.dependencies,H.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),w=w.sibling;return Ai(zi,zi.current&1|2),g.child}p=p.sibling}H.tail!==null&&vn()>Lm&&(g.flags|=128,k=!0,E_(H,!1),g.lanes=4194304)}else{if(!k)if(p=bh(he),p!==null){if(g.flags|=128,k=!0,w=p.updateQueue,w!==null&&(g.updateQueue=w,g.flags|=4),E_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!he.alternate&&!_i)return Ho(g),null}else 2*vn()-H.renderingStartTime>Lm&&w!==1073741824&&(g.flags|=128,k=!0,E_(H,!1),g.lanes=4194304);H.isBackwards?(he.sibling=g.child,g.child=he):(w=H.last,w!==null?w.sibling=he:g.child=he,H.last=he)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=vn(),g.sibling=null,w=zi.current,Ai(zi,k?w&1|2:w&1),g):(Ho(g),null);case 22:case 23:return I_(),k=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==k&&(g.flags|=8192),k&&(g.mode&1)!==0?(bc&1073741824)!==0&&(Ho(g),g.subtreeFlags&6&&(g.flags|=8192)):Ho(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function Y1(p,g){switch(a_(g),g.tag){case 1:return Ha(g.type)&&EE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Hp(),Mi(Ga),Mi(Wo),_b(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return Rm(g),null;case 13:if(Mi(zi),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(i(340));bm()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Mi(zi),null;case 4:return Hp(),null;case 10:return hb(g.type._context),null;case 22:case 23:return I_(),null;case 24:return null;default:return null}}var KE=!1,$o=!1,NI=typeof WeakSet=="function"?WeakSet:Set,nn=null;function Dm(p,g){var w=p.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(k){qi(p,g,k)}else w.current=null}function v_(p,g,w){try{w()}catch(k){qi(p,g,k)}}var DI=!1;function Mb(p,g){if(yE=be,p=xR(),Qg(p)){if("selectionStart"in p)var w={start:p.selectionStart,end:p.selectionEnd};else e:{w=(w=p.ownerDocument)&&w.defaultView||window;var k=w.getSelection&&w.getSelection();if(k&&k.rangeCount!==0){w=k.anchorNode;var V=k.anchorOffset,H=k.focusNode;k=k.focusOffset;try{w.nodeType,H.nodeType}catch{w=null;break e}var he=0,Re=-1,Ue=-1,it=0,Dt=0,Lt=p,Nt=null;t:for(;;){for(var Jt;Lt!==w||V!==0&&Lt.nodeType!==3||(Re=he+V),Lt!==H||k!==0&&Lt.nodeType!==3||(Ue=he+k),Lt.nodeType===3&&(he+=Lt.nodeValue.length),(Jt=Lt.firstChild)!==null;)Nt=Lt,Lt=Jt;for(;;){if(Lt===p)break t;if(Nt===w&&++it===V&&(Re=he),Nt===H&&++Dt===k&&(Ue=he),(Jt=Lt.nextSibling)!==null)break;Lt=Nt,Nt=Lt.parentNode}Lt=Jt}w=Re===-1||Ue===-1?null:{start:Re,end:Ue}}else w=null}w=w||{start:0,end:0}}else w=null;for(r_={focusedElem:p,selectionRange:w},be=!1,nn=g;nn!==null;)if(g=nn,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,nn=p;else for(;nn!==null;){g=nn;try{var on=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(on!==null){var an=on.memoizedProps,us=on.memoizedState,Qe=g.stateNode,je=Qe.getSnapshotBeforeUpdate(g.elementType===g.type?an:Sc(g.type,an),us);Qe.__reactInternalSnapshotBeforeUpdate=je}break;case 3:var tt=g.stateNode.containerInfo;tt.nodeType===1?tt.textContent="":tt.nodeType===9&&tt.documentElement&&tt.removeChild(tt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Ft){qi(g,g.return,Ft)}if(p=g.sibling,p!==null){p.return=g.return,nn=p;break}nn=g.return}return on=DI,DI=!1,on}function S_(p,g,w){var k=g.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var V=k=k.next;do{if((V.tag&p)===p){var H=V.destroy;V.destroy=void 0,H!==void 0&&v_(g,w,H)}V=V.next}while(V!==k)}}function b_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var w=g=g.next;do{if((w.tag&p)===p){var k=w.create;w.destroy=k()}w=w.next}while(w!==g)}}function Ub(p){var g=p.ref;if(g!==null){var w=p.stateNode;switch(p.tag){case 5:p=w;break;default:p=w}typeof g=="function"?g(p):g.current=p}}function xI(p){var g=p.alternate;g!==null&&(p.alternate=null,xI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[yu],delete g[gh],delete g[s_],delete g[V1],delete g[F1])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Vb(p){return p.tag===5||p.tag===3||p.tag===4}function LI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Vb(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Fb(p,g,w){var k=p.tag;if(k===5||k===6)p=p.stateNode,g?w.nodeType===8?w.parentNode.insertBefore(p,g):w.insertBefore(p,g):(w.nodeType===8?(g=w.parentNode,g.insertBefore(p,w)):(g=w,g.appendChild(p)),w=w._reactRootContainer,w!=null||g.onclick!==null||(g.onclick=_E));else if(k!==4&&(p=p.child,p!==null))for(Fb(p,g,w),p=p.sibling;p!==null;)Fb(p,g,w),p=p.sibling}function qE(p,g,w){var k=p.tag;if(k===5||k===6)p=p.stateNode,g?w.insertBefore(p,g):w.appendChild(p);else if(k!==4&&(p=p.child,p!==null))for(qE(p,g,w),p=p.sibling;p!==null;)qE(p,g,w),p=p.sibling}var _o=null,Jc=!1;function Tu(p,g,w){for(w=w.child;w!==null;)MI(p,g,w),w=w.sibling}function MI(p,g,w){if(zo&&typeof zo.onCommitFiberUnmount=="function")try{zo.onCommitFiberUnmount(uu,w)}catch{}switch(w.tag){case 5:$o||Dm(w,g);case 6:var k=_o,V=Jc;_o=null,Tu(p,g,w),_o=k,Jc=V,_o!==null&&(Jc?(p=_o,w=w.stateNode,p.nodeType===8?p.parentNode.removeChild(w):p.removeChild(w)):_o.removeChild(w.stateNode));break;case 18:_o!==null&&(Jc?(p=_o,w=w.stateNode,p.nodeType===8?sb(p.parentNode,w):p.nodeType===1&&sb(p,w),za(p)):sb(_o,w.stateNode));break;case 4:k=_o,V=Jc,_o=w.stateNode.containerInfo,Jc=!0,Tu(p,g,w),_o=k,Jc=V;break;case 0:case 11:case 14:case 15:if(!$o&&(k=w.updateQueue,k!==null&&(k=k.lastEffect,k!==null))){V=k=k.next;do{var H=V,he=H.destroy;H=H.tag,he!==void 0&&((H&2)!==0||(H&4)!==0)&&v_(w,g,he),V=V.next}while(V!==k)}Tu(p,g,w);break;case 1:if(!$o&&(Dm(w,g),k=w.stateNode,typeof k.componentWillUnmount=="function"))try{k.props=w.memoizedProps,k.state=w.memoizedState,k.componentWillUnmount()}catch(Re){qi(w,g,Re)}Tu(p,g,w);break;case 21:Tu(p,g,w);break;case 22:w.mode&1?($o=(k=$o)||w.memoizedState!==null,Tu(p,g,w),$o=k):Tu(p,g,w);break;default:Tu(p,g,w)}}function UI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var w=p.stateNode;w===null&&(w=p.stateNode=new NI),g.forEach(function(k){var V=WI.bind(null,p,k);w.has(k)||(w.add(k),k.then(V,V))})}}function va(p,g){var w=g.deletions;if(w!==null)for(var k=0;k<w.length;k++){var V=w[k];try{var H=p,he=g,Re=he;e:for(;Re!==null;){switch(Re.tag){case 5:_o=Re.stateNode,Jc=!1;break e;case 3:_o=Re.stateNode.containerInfo,Jc=!0;break e;case 4:_o=Re.stateNode.containerInfo,Jc=!0;break e}Re=Re.return}if(_o===null)throw Error(i(160));MI(H,he,V),_o=null,Jc=!1;var Ue=V.alternate;Ue!==null&&(Ue.return=null),V.return=null}catch(it){qi(V,g,it)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)jb(g,p),g=g.sibling}function jb(p,g){var w=p.alternate,k=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(va(g,p),Xa(p),k&4){try{S_(3,p,p.return),b_(3,p)}catch(an){qi(p,p.return,an)}try{S_(5,p,p.return)}catch(an){qi(p,p.return,an)}}break;case 1:va(g,p),Xa(p),k&512&&w!==null&&Dm(w,w.return);break;case 5:if(va(g,p),Xa(p),k&512&&w!==null&&Dm(w,w.return),p.flags&32){var V=p.stateNode;try{xt(V,"")}catch(an){qi(p,p.return,an)}}if(k&4&&(V=p.stateNode,V!=null)){var H=p.memoizedProps,he=w!==null?w.memoizedProps:H,Re=p.type,Ue=p.updateQueue;if(p.updateQueue=null,Ue!==null)try{Re==="input"&&H.type==="radio"&&H.name!=null&&fn(V,H),ra(Re,he);var it=ra(Re,H);for(he=0;he<Ue.length;he+=2){var Dt=Ue[he],Lt=Ue[he+1];Dt==="style"?Cs(V,Lt):Dt==="dangerouslySetInnerHTML"?sr(V,Lt):Dt==="children"?xt(V,Lt):ne(V,Dt,Lt,it)}switch(Re){case"input":zt(V,H);break;case"textarea":Wt(V,H);break;case"select":var Nt=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!H.multiple;var Jt=H.value;Jt!=null?Et(V,!!H.multiple,Jt,!1):Nt!==!!H.multiple&&(H.defaultValue!=null?Et(V,!!H.multiple,H.defaultValue,!0):Et(V,!!H.multiple,H.multiple?[]:"",!1))}V[gh]=H}catch(an){qi(p,p.return,an)}}break;case 6:if(va(g,p),Xa(p),k&4){if(p.stateNode===null)throw Error(i(162));V=p.stateNode,H=p.memoizedProps;try{V.nodeValue=H}catch(an){qi(p,p.return,an)}}break;case 3:if(va(g,p),Xa(p),k&4&&w!==null&&w.memoizedState.isDehydrated)try{za(g.containerInfo)}catch(an){qi(p,p.return,an)}break;case 4:va(g,p),Xa(p);break;case 13:va(g,p),Xa(p),V=p.child,V.flags&8192&&(H=V.memoizedState!==null,V.stateNode.isHidden=H,!H||V.alternate!==null&&V.alternate.memoizedState!==null||(ev=vn())),k&4&&UI(p);break;case 22:if(Dt=w!==null&&w.memoizedState!==null,p.mode&1?($o=(it=$o)||Dt,va(g,p),$o=it):va(g,p),Xa(p),k&8192){if(it=p.memoizedState!==null,(p.stateNode.isHidden=it)&&!Dt&&(p.mode&1)!==0)for(nn=p,Dt=p.child;Dt!==null;){for(Lt=nn=Dt;nn!==null;){switch(Nt=nn,Jt=Nt.child,Nt.tag){case 0:case 11:case 14:case 15:S_(4,Nt,Nt.return);break;case 1:Dm(Nt,Nt.return);var on=Nt.stateNode;if(typeof on.componentWillUnmount=="function"){k=Nt,w=Nt.return;try{g=k,on.props=g.memoizedProps,on.state=g.memoizedState,on.componentWillUnmount()}catch(an){qi(k,w,an)}}break;case 5:Dm(Nt,Nt.return);break;case 22:if(Nt.memoizedState!==null){T_(Lt);continue}}Jt!==null?(Jt.return=Nt,nn=Jt):T_(Lt)}Dt=Dt.sibling}e:for(Dt=null,Lt=p;;){if(Lt.tag===5){if(Dt===null){Dt=Lt;try{V=Lt.stateNode,it?(H=V.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Re=Lt.stateNode,Ue=Lt.memoizedProps.style,he=Ue!=null&&Ue.hasOwnProperty("display")?Ue.display:null,Re.style.display=wi("display",he))}catch(an){qi(p,p.return,an)}}}else if(Lt.tag===6){if(Dt===null)try{Lt.stateNode.nodeValue=it?"":Lt.memoizedProps}catch(an){qi(p,p.return,an)}}else if((Lt.tag!==22&&Lt.tag!==23||Lt.memoizedState===null||Lt===p)&&Lt.child!==null){Lt.child.return=Lt,Lt=Lt.child;continue}if(Lt===p)break e;for(;Lt.sibling===null;){if(Lt.return===null||Lt.return===p)break e;Dt===Lt&&(Dt=null),Lt=Lt.return}Dt===Lt&&(Dt=null),Lt.sibling.return=Lt.return,Lt=Lt.sibling}}break;case 19:va(g,p),Xa(p),k&4&&UI(p);break;case 21:break;default:va(g,p),Xa(p)}}function Xa(p){var g=p.flags;if(g&2){try{e:{for(var w=p.return;w!==null;){if(Vb(w)){var k=w;break e}w=w.return}throw Error(i(160))}switch(k.tag){case 5:var V=k.stateNode;k.flags&32&&(xt(V,""),k.flags&=-33);var H=LI(p);qE(p,H,V);break;case 3:case 4:var he=k.stateNode.containerInfo,Re=LI(p);Fb(p,Re,he);break;default:throw Error(i(161))}}catch(Ue){qi(p,p.return,Ue)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function xm(p,g,w){nn=p,Bb(p)}function Bb(p,g,w){for(var k=(p.mode&1)!==0;nn!==null;){var V=nn,H=V.child;if(V.tag===22&&k){var he=V.memoizedState!==null||KE;if(!he){var Re=V.alternate,Ue=Re!==null&&Re.memoizedState!==null||$o;Re=KE;var it=$o;if(KE=he,($o=Ue)&&!it)for(nn=V;nn!==null;)he=nn,Ue=he.child,he.tag===22&&he.memoizedState!==null?VI(V):Ue!==null?(Ue.return=he,nn=Ue):VI(V);for(;H!==null;)nn=H,Bb(H),H=H.sibling;nn=V,KE=Re,$o=it}YE(p)}else(V.subtreeFlags&8772)!==0&&H!==null?(H.return=V,nn=H):YE(p)}}function YE(p){for(;nn!==null;){var g=nn;if((g.flags&8772)!==0){var w=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:$o||b_(5,g);break;case 1:var k=g.stateNode;if(g.flags&4&&!$o)if(w===null)k.componentDidMount();else{var V=g.elementType===g.type?w.memoizedProps:Sc(g.type,w.memoizedProps);k.componentDidUpdate(V,w.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&rI(g,H,k);break;case 3:var he=g.updateQueue;if(he!==null){if(w=null,g.child!==null)switch(g.child.tag){case 5:w=g.child.stateNode;break;case 1:w=g.child.stateNode}rI(g,he,w)}break;case 5:var Re=g.stateNode;if(w===null&&g.flags&4){w=Re;var Ue=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ue.autoFocus&&w.focus();break;case"img":Ue.src&&(w.src=Ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var it=g.alternate;if(it!==null){var Dt=it.memoizedState;if(Dt!==null){var Lt=Dt.dehydrated;Lt!==null&&za(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}$o||g.flags&512&&Ub(g)}catch(Nt){qi(g,g.return,Nt)}}if(g===p){nn=null;break}if(w=g.sibling,w!==null){w.return=g.return,nn=w;break}nn=g.return}}function T_(p){for(;nn!==null;){var g=nn;if(g===p){nn=null;break}var w=g.sibling;if(w!==null){w.return=g.return,nn=w;break}nn=g.return}}function VI(p){for(;nn!==null;){var g=nn;try{switch(g.tag){case 0:case 11:case 15:var w=g.return;try{b_(4,g)}catch(Ue){qi(g,w,Ue)}break;case 1:var k=g.stateNode;if(typeof k.componentDidMount=="function"){var V=g.return;try{k.componentDidMount()}catch(Ue){qi(g,V,Ue)}}var H=g.return;try{Ub(g)}catch(Ue){qi(g,H,Ue)}break;case 5:var he=g.return;try{Ub(g)}catch(Ue){qi(g,he,Ue)}}}catch(Ue){qi(g,g.return,Ue)}if(g===p){nn=null;break}var Re=g.sibling;if(Re!==null){Re.return=g.return,nn=Re;break}nn=g.return}}var X1=Math.ceil,XE=oe.ReactCurrentDispatcher,JE=oe.ReactCurrentOwner,Qc=oe.ReactCurrentBatchConfig,Mr=0,oo=null,ls=null,ks=0,bc=0,Vl=$c(0),Ns=0,yo=null,Yp=0,QE=0,ZE=0,w_=null,Sa=null,ev=0,Lm=1/0,wu=null,tv=!1,zb=null,Ch=null,Mm=!1,Cu=null,nv=0,Xp=0,Wb=null,C_=-1,rv=0;function Eo(){return(Mr&6)!==0?vn():C_!==-1?C_:C_=vn()}function Zc(p){return(p.mode&1)===0?1:(Mr&2)!==0&&ks!==0?ks&-ks:B1.transition!==null?(rv===0&&(rv=cd()),rv):(p=pr,p!==0||(p=window.event,p=p===void 0?16:Jr(p.type)),p)}function el(p,g,w,k){if(50<Xp)throw Xp=0,Wb=null,Error(i(185));pu(p,w,k),((Mr&2)===0||p!==oo)&&(p===oo&&((Mr&2)===0&&(QE|=w),Ns===4&&wd(p,ks)),Ko(p,k),w===1&&Mr===0&&(g.mode&1)===0&&(Lm=vn()+500,bE&&yh()))}function Ko(p,g){var w=p.callbackNode;mc(p,g);var k=hu(p,p===oo?ks:0);if(k===0)w!==null&&fc(w),p.callbackNode=null,p.callbackPriority=0;else if(g=k&-k,p.callbackPriority!==g){if(w!=null&&fc(w),g===1)p.tag===0?j1(Jp.bind(null,p)):qR(Jp.bind(null,p)),M1(function(){(Mr&6)===0&&yh()}),w=null;else{switch(jc(k)){case 1:w=Fc;break;case 4:w=kl;break;case 16:w=ja;break;case 536870912:w=lh;break;default:w=ja}w=A_(w,iv.bind(null,p))}p.callbackPriority=g,p.callbackNode=w}}function iv(p,g){if(C_=-1,rv=0,(Mr&6)!==0)throw Error(i(327));var w=p.callbackNode;if(Um()&&p.callbackNode!==w)return null;var k=hu(p,p===oo?ks:0);if(k===0)return null;if((k&30)!==0||(k&p.expiredLanes)!==0||g)g=Ru(p,k);else{g=k;var V=Mr;Mr|=2;var H=FI();(oo!==p||ks!==g)&&(wu=null,Lm=vn()+500,Rh(p,g));do try{J1();break}catch(Re){Gb(p,Re)}while(!0);db(),XE.current=H,Mr=V,ls!==null?g=0:(oo=null,ks=0,g=Ns)}if(g!==0){if(g===2&&(V=oa(p),V!==0&&(k=V,g=sv(p,V))),g===1)throw w=yo,Rh(p,0),wd(p,k),Ko(p,vn()),w;if(g===6)wd(p,k);else{if(V=p.current.alternate,(k&30)===0&&!av(V)&&(g=Ru(p,k),g===2&&(H=oa(p),H!==0&&(k=H,g=sv(p,H))),g===1))throw w=yo,Rh(p,0),wd(p,k),Ko(p,vn()),w;switch(p.finishedWork=V,p.finishedLanes=k,g){case 0:case 1:throw Error(i(345));case 2:Qp(p,Sa,wu);break;case 3:if(wd(p,k),(k&130023424)===k&&(g=ev+500-vn(),10<g)){if(hu(p,0)!==0)break;if(V=p.suspendedLanes,(V&k)!==k){Eo(),p.pingedLanes|=p.suspendedLanes&V;break}p.timeoutHandle=i_(Qp.bind(null,p,Sa,wu),g);break}Qp(p,Sa,wu);break;case 4:if(wd(p,k),(k&4194240)===k)break;for(g=p.eventTimes,V=-1;0<k;){var he=31-go(k);H=1<<he,he=g[he],he>V&&(V=he),k&=~H}if(k=V,k=vn()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*X1(k/1960))-k,10<k){p.timeoutHandle=i_(Qp.bind(null,p,Sa,wu),k);break}Qp(p,Sa,wu);break;case 5:Qp(p,Sa,wu);break;default:throw Error(i(329))}}}return Ko(p,vn()),p.callbackNode===w?iv.bind(null,p):null}function sv(p,g){var w=w_;return p.current.memoizedState.isDehydrated&&(Rh(p,g).flags|=256),p=Ru(p,g),p!==2&&(g=Sa,Sa=w,g!==null&&ov(g)),p}function ov(p){Sa===null?Sa=p:Sa.push.apply(Sa,p)}function av(p){for(var g=p;;){if(g.flags&16384){var w=g.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var k=0;k<w.length;k++){var V=w[k],H=V.getSnapshot;V=V.value;try{if(!Ul(H(),V))return!1}catch{return!1}}}if(w=g.child,g.subtreeFlags&16384&&w!==null)w.return=g,g=w;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function wd(p,g){for(g&=~ZE,g&=~QE,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var w=31-go(g),k=1<<w;p[w]=-1,g&=~k}}function Jp(p){if((Mr&6)!==0)throw Error(i(327));Um();var g=hu(p,0);if((g&1)===0)return Ko(p,vn()),null;var w=Ru(p,g);if(p.tag!==0&&w===2){var k=oa(p);k!==0&&(g=k,w=sv(p,k))}if(w===1)throw w=yo,Rh(p,0),wd(p,g),Ko(p,vn()),w;if(w===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Qp(p,Sa,wu),Ko(p,vn()),null}function R_(p,g){var w=Mr;Mr|=1;try{return p(g)}finally{Mr=w,Mr===0&&(Lm=vn()+500,bE&&yh())}}function Cd(p){Cu!==null&&Cu.tag===0&&(Mr&6)===0&&Um();var g=Mr;Mr|=1;var w=Qc.transition,k=pr;try{if(Qc.transition=null,pr=1,p)return p()}finally{pr=k,Qc.transition=w,Mr=g,(Mr&6)===0&&yh()}}function I_(){bc=Vl.current,Mi(Vl)}function Rh(p,g){p.finishedWork=null,p.finishedLanes=0;var w=p.timeoutHandle;if(w!==-1&&(p.timeoutHandle=-1,L1(w)),ls!==null)for(w=ls.return;w!==null;){var k=w;switch(a_(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&EE();break;case 3:Hp(),Mi(Ga),Mi(Wo),_b();break;case 5:Rm(k);break;case 4:Hp();break;case 13:Mi(zi);break;case 19:Mi(zi);break;case 10:hb(k.type._context);break;case 22:case 23:I_()}w=w.return}if(oo=p,ls=p=Rd(p.current,null),ks=bc=g,Ns=0,yo=null,ZE=QE=Yp=0,Sa=w_=null,Wp!==null){for(g=0;g<Wp.length;g++)if(w=Wp[g],k=w.interleaved,k!==null){w.interleaved=null;var V=k.next,H=w.pending;if(H!==null){var he=H.next;H.next=V,k.next=he}w.pending=k}Wp=null}return p}function Gb(p,g){do{var w=ls;try{if(db(),kE.current=LE,Im){for(var k=Ki.memoizedState;k!==null;){var V=k.queue;V!==null&&(V.pending=null),k=k.next}Im=!1}if(Su=0,Os=Ps=Ki=null,m_=!1,g_=0,JE.current=null,w===null||w.return===null){Ns=1,yo=g,ls=null;break}e:{var H=p,he=w.return,Re=w,Ue=g;if(g=ks,Re.flags|=32768,Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var it=Ue,Dt=Re,Lt=Dt.tag;if((Dt.mode&1)===0&&(Lt===0||Lt===11||Lt===15)){var Nt=Dt.alternate;Nt?(Dt.updateQueue=Nt.updateQueue,Dt.memoizedState=Nt.memoizedState,Dt.lanes=Nt.lanes):(Dt.updateQueue=null,Dt.memoizedState=null)}var Jt=EI(he);if(Jt!==null){Jt.flags&=-257,vI(Jt,he,Re,H,g),Jt.mode&1&&yI(H,it,g),g=Jt,Ue=it;var on=g.updateQueue;if(on===null){var an=new Set;an.add(Ue),g.updateQueue=an}else on.add(Ue);break e}else{if((g&1)===0){yI(H,it,g),Hb();break e}Ue=Error(i(426))}}else if(_i&&Re.mode&1){var us=EI(he);if(us!==null){(us.flags&65536)===0&&(us.flags|=256),vI(us,he,Re,H,g),lb(km(Ue,Re));break e}}H=Ue=km(Ue,Re),Ns!==4&&(Ns=2),w_===null?w_=[H]:w_.push(H),H=he;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Qe=kb(H,Ue,g);nI(H,Qe);break e;case 1:Re=Ue;var je=H.type,tt=H.stateNode;if((H.flags&128)===0&&(typeof je.getDerivedStateFromError=="function"||tt!==null&&typeof tt.componentDidCatch=="function"&&(Ch===null||!Ch.has(tt)))){H.flags|=65536,g&=-g,H.lanes|=g;var Ft=Td(H,Re,g);nI(H,Ft);break e}}H=H.return}while(H!==null)}BI(w)}catch(cn){g=cn,ls===w&&w!==null&&(ls=w=w.return);continue}break}while(!0)}function FI(){var p=XE.current;return XE.current=LE,p===null?LE:p}function Hb(){(Ns===0||Ns===3||Ns===2)&&(Ns=4),oo===null||(Yp&268435455)===0&&(QE&268435455)===0||wd(oo,ks)}function Ru(p,g){var w=Mr;Mr|=2;var k=FI();(oo!==p||ks!==g)&&(wu=null,Rh(p,g));do try{jI();break}catch(V){Gb(p,V)}while(!0);if(db(),Mr=w,XE.current=k,ls!==null)throw Error(i(261));return oo=null,ks=0,Ns}function jI(){for(;ls!==null;)cv(ls)}function J1(){for(;ls!==null&&!xi();)cv(ls)}function cv(p){var g=dv(p.alternate,p,bc);p.memoizedProps=p.pendingProps,g===null?BI(p):ls=g,JE.current=null}function BI(p){var g=p;do{var w=g.alternate;if(p=g.return,(g.flags&32768)===0){if(w=$E(w,g,bc),w!==null){ls=w;return}}else{if(w=Y1(w,g),w!==null){w.flags&=32767,ls=w;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Ns=6,ls=null;return}}if(g=g.sibling,g!==null){ls=g;return}ls=g=p}while(g!==null);Ns===0&&(Ns=5)}function Qp(p,g,w){var k=pr,V=Qc.transition;try{Qc.transition=null,pr=1,Q1(p,g,w,k)}finally{Qc.transition=V,pr=k}return null}function Q1(p,g,w,k){do Um();while(Cu!==null);if((Mr&6)!==0)throw Error(i(327));w=p.finishedWork;var V=p.finishedLanes;if(w===null)return null;if(p.finishedWork=null,p.finishedLanes=0,w===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var H=w.lanes|w.childLanes;if(ei(p,H),p===oo&&(ls=oo=null,ks=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||Mm||(Mm=!0,A_(ja,function(){return Um(),null})),H=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||H){H=Qc.transition,Qc.transition=null;var he=pr;pr=1;var Re=Mr;Mr|=4,JE.current=null,Mb(p,w),jb(w,p),Q0(r_),be=!!yE,r_=yE=null,p.current=w,xm(w),as(),Mr=Re,pr=he,Qc.transition=H}else p.current=w;if(Mm&&(Mm=!1,Cu=p,nv=V),H=p.pendingLanes,H===0&&(Ch=null),rm(w.stateNode),Ko(p,vn()),g!==null)for(k=p.onRecoverableError,w=0;w<g.length;w++)V=g[w],k(V.value,{componentStack:V.stack,digest:V.digest});if(tv)throw tv=!1,p=zb,zb=null,p;return(nv&1)!==0&&p.tag!==0&&Um(),H=p.pendingLanes,(H&1)!==0?p===Wb?Xp++:(Xp=0,Wb=p):Xp=0,yh(),null}function Um(){if(Cu!==null){var p=jc(nv),g=Qc.transition,w=pr;try{if(Qc.transition=null,pr=16>p?16:p,Cu===null)var k=!1;else{if(p=Cu,Cu=null,nv=0,(Mr&6)!==0)throw Error(i(331));var V=Mr;for(Mr|=4,nn=p.current;nn!==null;){var H=nn,he=H.child;if((nn.flags&16)!==0){var Re=H.deletions;if(Re!==null){for(var Ue=0;Ue<Re.length;Ue++){var it=Re[Ue];for(nn=it;nn!==null;){var Dt=nn;switch(Dt.tag){case 0:case 11:case 15:S_(8,Dt,H)}var Lt=Dt.child;if(Lt!==null)Lt.return=Dt,nn=Lt;else for(;nn!==null;){Dt=nn;var Nt=Dt.sibling,Jt=Dt.return;if(xI(Dt),Dt===it){nn=null;break}if(Nt!==null){Nt.return=Jt,nn=Nt;break}nn=Jt}}}var on=H.alternate;if(on!==null){var an=on.child;if(an!==null){on.child=null;do{var us=an.sibling;an.sibling=null,an=us}while(an!==null)}}nn=H}}if((H.subtreeFlags&2064)!==0&&he!==null)he.return=H,nn=he;else e:for(;nn!==null;){if(H=nn,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:S_(9,H,H.return)}var Qe=H.sibling;if(Qe!==null){Qe.return=H.return,nn=Qe;break e}nn=H.return}}var je=p.current;for(nn=je;nn!==null;){he=nn;var tt=he.child;if((he.subtreeFlags&2064)!==0&&tt!==null)tt.return=he,nn=tt;else e:for(he=je;nn!==null;){if(Re=nn,(Re.flags&2048)!==0)try{switch(Re.tag){case 0:case 11:case 15:b_(9,Re)}}catch(cn){qi(Re,Re.return,cn)}if(Re===he){nn=null;break e}var Ft=Re.sibling;if(Ft!==null){Ft.return=Re.return,nn=Ft;break e}nn=Re.return}}if(Mr=V,yh(),zo&&typeof zo.onPostCommitFiberRoot=="function")try{zo.onPostCommitFiberRoot(uu,p)}catch{}k=!0}return k}finally{pr=w,Qc.transition=g}}return!1}function lv(p,g,w){g=km(w,g),g=kb(p,g,1),p=Sh(p,g,1),g=Eo(),p!==null&&(pu(p,1,g),Ko(p,g))}function qi(p,g,w){if(p.tag===3)lv(p,p,w);else for(;g!==null;){if(g.tag===3){lv(g,p,w);break}else if(g.tag===1){var k=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(Ch===null||!Ch.has(k))){p=km(w,p),p=Td(g,p,1),g=Sh(g,p,1),p=Eo(),g!==null&&(pu(g,1,p),Ko(g,p));break}}g=g.return}}function zI(p,g,w){var k=p.pingCache;k!==null&&k.delete(g),g=Eo(),p.pingedLanes|=p.suspendedLanes&w,oo===p&&(ks&w)===w&&(Ns===4||Ns===3&&(ks&130023424)===ks&&500>vn()-ev?Rh(p,0):ZE|=w),Ko(p,g)}function $b(p,g){g===0&&((p.mode&1)===0?g=1:(g=Tr,Tr<<=1,(Tr&130023424)===0&&(Tr=4194304)));var w=Eo();p=vd(p,g),p!==null&&(pu(p,g,w),Ko(p,w))}function uv(p){var g=p.memoizedState,w=0;g!==null&&(w=g.retryLane),$b(p,w)}function WI(p,g){var w=0;switch(p.tag){case 13:var k=p.stateNode,V=p.memoizedState;V!==null&&(w=V.retryLane);break;case 19:k=p.stateNode;break;default:throw Error(i(314))}k!==null&&k.delete(g),$b(p,w)}var dv;dv=function(p,g,w){if(p!==null)if(p.memoizedProps!==g.pendingProps||Ga.current)Ya=!0;else{if((p.lanes&w)===0&&(g.flags&128)===0)return Ya=!1,PI(p,g,w);Ya=(p.flags&131072)!==0}else Ya=!1,_i&&(g.flags&1048576)!==0&&wE(g,TE,g.index);switch(g.lanes=0,g.tag){case 2:var k=g.type;GE(p,g),p=g.pendingProps;var V=Bp(g,Wo.current);Ed(g,w),V=Am(null,g,k,p,V,w);var H=vb();return g.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ha(k)?(H=!0,SE(g)):H=!1,g.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,d_(g),V.updater=UE,g.stateNode=V,V._reactInternals=g,Ab(g,k,p,w),g=FE(null,g,k,!0,H,w)):(g.tag=0,_i&&H&&CE(g),Ea(null,g,V,w),g=g.child),g;case 16:k=g.elementType;e:{switch(GE(p,g),p=g.pendingProps,V=k._init,k=V(k._payload),g.type=k,V=g.tag=Zp(k),p=Sc(k,p),V){case 0:g=Nb(null,g,k,p,w);break e;case 1:g=CI(null,g,k,p,w);break e;case 11:g=VE(null,g,k,p,w);break e;case 14:g=SI(null,g,k,Sc(k.type,p),w);break e}throw Error(i(306,k,""))}return g;case 0:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:Sc(k,V),Nb(p,g,k,V,w);case 1:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:Sc(k,V),CI(p,g,k,V,w);case 3:e:{if(Db(g),p===null)throw Error(i(387));k=g.pendingProps,H=g.memoizedState,V=H.element,tI(p,g),OE(g,k,null,w);var he=g.memoizedState;if(k=he.element,H.isDehydrated)if(H={element:k,isDehydrated:!1,cache:he.cache,pendingSuspenseBoundaries:he.pendingSuspenseBoundaries,transitions:he.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){V=km(Error(i(423)),g),g=RI(p,g,k,w,V);break e}else if(k!==V){V=km(Error(i(424)),g),g=RI(p,g,k,w,V);break e}else for(Ka=mh(g.stateNode.containerInfo.firstChild),$a=g,_i=!0,_a=null,w=ZR(g,null,k,w),g.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(bm(),k===V){g=bu(p,g,w);break e}Ea(p,g,k,w)}g=g.child}return g;case 5:return iI(g),p===null&&cb(g),k=g.type,V=g.pendingProps,H=p!==null?p.memoizedProps:null,he=V.children,ib(k,V)?he=null:H!==null&&ib(k,H)&&(g.flags|=32),wI(p,g),Ea(p,g,he,w),g.child;case 6:return p===null&&cb(g),null;case 13:return jE(p,g,w);case 4:return mb(g,g.stateNode.containerInfo),k=g.pendingProps,p===null?g.child=Tm(g,null,k,w):Ea(p,g,k,w),g.child;case 11:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:Sc(k,V),VE(p,g,k,V,w);case 7:return Ea(p,g,g.pendingProps,w),g.child;case 8:return Ea(p,g,g.pendingProps.children,w),g.child;case 12:return Ea(p,g,g.pendingProps.children,w),g.child;case 10:e:{if(k=g.type._context,V=g.pendingProps,H=g.memoizedProps,he=V.value,Ai(AE,k._currentValue),k._currentValue=he,H!==null)if(Ul(H.value,he)){if(H.children===V.children&&!Ga.current){g=bu(p,g,w);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Re=H.dependencies;if(Re!==null){he=H.child;for(var Ue=Re.firstContext;Ue!==null;){if(Ue.context===k){if(H.tag===1){Ue=Eu(-1,w&-w),Ue.tag=2;var it=H.updateQueue;if(it!==null){it=it.shared;var Dt=it.pending;Dt===null?Ue.next=Ue:(Ue.next=Dt.next,Dt.next=Ue),it.pending=Ue}}H.lanes|=w,Ue=H.alternate,Ue!==null&&(Ue.lanes|=w),pb(H.return,w,g),Re.lanes|=w;break}Ue=Ue.next}}else if(H.tag===10)he=H.type===g.type?null:H.child;else if(H.tag===18){if(he=H.return,he===null)throw Error(i(341));he.lanes|=w,Re=he.alternate,Re!==null&&(Re.lanes|=w),pb(he,w,g),he=H.sibling}else he=H.child;if(he!==null)he.return=H;else for(he=H;he!==null;){if(he===g){he=null;break}if(H=he.sibling,H!==null){H.return=he.return,he=H;break}he=he.return}H=he}Ea(p,g,V.children,w),g=g.child}return g;case 9:return V=g.type,k=g.pendingProps.children,Ed(g,w),V=Yc(V),k=k(V),g.flags|=1,Ea(p,g,k,w),g.child;case 14:return k=g.type,V=Sc(k,g.pendingProps),V=Sc(k.type,V),SI(p,g,k,V,w);case 15:return bI(p,g,g.type,g.pendingProps,w);case 17:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:Sc(k,V),GE(p,g),g.tag=1,Ha(k)?(p=!0,SE(g)):p=!1,Ed(g,w),gI(g,k,V),Ab(g,k,V,w),FE(null,g,k,!0,p,w);case 19:return WE(p,g,w);case 22:return TI(p,g,w)}throw Error(i(156,g.tag))};function A_(p,g){return lu(p,g)}function hv(p,g,w,k){this.tag=p,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tc(p,g,w,k){return new hv(p,g,w,k)}function Ih(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Zp(p){if(typeof p=="function")return Ih(p)?1:0;if(p!=null){if(p=p.$$typeof,p===ue)return 11;if(p===xe)return 14}return 2}function Rd(p,g){var w=p.alternate;return w===null?(w=Tc(p.tag,g,p.key,p.mode),w.elementType=p.elementType,w.type=p.type,w.stateNode=p.stateNode,w.alternate=p,p.alternate=w):(w.pendingProps=g,w.type=p.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=p.flags&14680064,w.childLanes=p.childLanes,w.lanes=p.lanes,w.child=p.child,w.memoizedProps=p.memoizedProps,w.memoizedState=p.memoizedState,w.updateQueue=p.updateQueue,g=p.dependencies,w.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},w.sibling=p.sibling,w.index=p.index,w.ref=p.ref,w}function pv(p,g,w,k,V,H){var he=2;if(k=p,typeof p=="function")Ih(p)&&(he=1);else if(typeof p=="string")he=5;else e:switch(p){case Y:return ef(w.children,V,H,g);case Z:he=8,V|=8;break;case Q:return p=Tc(12,w,g,V|2),p.elementType=Q,p.lanes=H,p;case pe:return p=Tc(13,w,g,V),p.elementType=pe,p.lanes=H,p;case ke:return p=Tc(19,w,g,V),p.elementType=ke,p.lanes=H,p;case Oe:return Ah(w,V,H,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ie:he=10;break e;case de:he=9;break e;case ue:he=11;break e;case xe:he=14;break e;case Fe:he=16,k=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return g=Tc(he,w,g,V),g.elementType=p,g.type=k,g.lanes=H,g}function ef(p,g,w,k){return p=Tc(7,p,k,g),p.lanes=w,p}function Ah(p,g,w,k){return p=Tc(22,p,k,g),p.elementType=Oe,p.lanes=w,p.stateNode={isHidden:!1},p}function Kb(p,g,w){return p=Tc(6,p,null,g),p.lanes=w,p}function qb(p,g,w){return g=Tc(4,p.children!==null?p.children:[],p.key,g),g.lanes=w,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function Z1(p,g,w,k,V){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Dl(0),this.expirationTimes=Dl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dl(0),this.identifierPrefix=k,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function Yb(p,g,w,k,V,H,he,Re,Ue){return p=new Z1(p,g,w,Re,Ue),g===1?(g=1,H===!0&&(g|=8)):g=0,H=Tc(3,null,null,g),p.current=H,H.stateNode=p,H.memoizedState={element:k,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},d_(H),p}function eD(p,g,w){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:le,key:k==null?null:""+k,children:p,containerInfo:g,implementation:w}}function GI(p){if(!p)return _h;p=p._reactInternals;e:{if($i(p)!==p||p.tag!==1)throw Error(i(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ha(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(p.tag===1){var w=p.type;if(Ha(w))return vE(p,w,g)}return g}function fv(p,g,w,k,V,H,he,Re,Ue){return p=Yb(w,k,!0,p,V,H,he,Re,Ue),p.context=GI(null),w=p.current,k=Eo(),V=Zc(w),H=Eu(k,V),H.callback=g??null,Sh(w,H,V),p.current.lanes=V,pu(p,V,k),Ko(p,k),p}function P_(p,g,w,k){var V=g.current,H=Eo(),he=Zc(V);return w=GI(w),g.context===null?g.context=w:g.pendingContext=w,g=Eu(H,he),g.payload={element:p},k=k===void 0?null:k,k!==null&&(g.callback=k),p=Sh(V,g,he),p!==null&&(el(p,V,he,H),h_(p,V,he)),he}function mv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function Xb(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var w=p.retryLane;p.retryLane=w!==0&&w<g?w:g}}function Jb(p,g){Xb(p,g),(p=p.alternate)&&Xb(p,g)}function O_(){return null}var Fl=typeof reportError=="function"?reportError:function(p){console.error(p)};function gv(p){this._internalRoot=p}_v.prototype.render=gv.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(i(409));P_(p,g,null,null)},_v.prototype.unmount=gv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;Cd(function(){P_(null,p,null,null)}),g[Hc]=null}};function _v(p){this._internalRoot=p}_v.prototype.unstable_scheduleHydration=function(p){if(p){var g=Ap();p={blockedOn:null,target:p,priority:g};for(var w=0;w<da.length&&g!==0&&g<da[w].priority;w++);da.splice(w,0,p),w===0&&Op(p)}};function Qb(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Vm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function Zb(){}function tD(p,g,w,k,V){if(V){if(typeof k=="function"){var H=k;k=function(){var it=mv(he);H.call(it)}}var he=fv(g,k,p,0,null,!1,!1,"",Zb);return p._reactRootContainer=he,p[Hc]=he.current,Mp(p.nodeType===8?p.parentNode:p),Cd(),he}for(;V=p.lastChild;)p.removeChild(V);if(typeof k=="function"){var Re=k;k=function(){var it=mv(Ue);Re.call(it)}}var Ue=Yb(p,0,!1,null,null,!1,!1,"",Zb);return p._reactRootContainer=Ue,p[Hc]=Ue.current,Mp(p.nodeType===8?p.parentNode:p),Cd(function(){P_(g,Ue,w,k)}),Ue}function tf(p,g,w,k,V){var H=w._reactRootContainer;if(H){var he=H;if(typeof V=="function"){var Re=V;V=function(){var Ue=mv(he);Re.call(Ue)}}P_(g,he,p,V)}else he=tD(w,g,p,V,k);return mv(he)}im=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var w=du(g.pendingLanes);w!==0&&(gc(g,w|1),Ko(g,vn()),(Mr&6)===0&&(Lm=vn()+500,yh()))}break;case 13:Cd(function(){var k=vd(p,1);if(k!==null){var V=Eo();el(k,p,1,V)}}),Jb(p,1)}},fu=function(p){if(p.tag===13){var g=vd(p,134217728);if(g!==null){var w=Eo();el(g,p,134217728,w)}Jb(p,134217728)}},hh=function(p){if(p.tag===13){var g=Zc(p),w=vd(p,g);if(w!==null){var k=Eo();el(w,p,g,k)}Jb(p,g)}},Ap=function(){return pr},sm=function(p,g){var w=pr;try{return pr=p,g()}finally{pr=w}},Vc=function(p,g,w){switch(g){case"input":if(zt(p,w),g=w.name,w.type==="radio"&&g!=null){for(w=p;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<w.length;g++){var k=w[g];if(k!==p&&k.form===p.form){var V=Em(k);if(!V)throw Error(i(90));ut(k),zt(k,V)}}}break;case"textarea":Wt(p,w);break;case"select":g=w.value,g!=null&&Et(p,!!w.multiple,g,!1)}},Rl=R_,Va=Cd;var Ph={usingClientEntryPoint:!1,Events:[ym,Fp,Em,Ua,hc,R_]},Id={findFiberByHostInstance:Vp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nD={bundleType:Id.bundleType,version:Id.version,rendererPackageName:Id.rendererPackageName,rendererConfig:Id.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:oe.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Ol(p),p===null?null:p.stateNode},findFiberByHostInstance:Id.findFiberByHostInstance||O_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yv.isDisabled&&yv.supportsFiber)try{uu=yv.inject(nD),zo=yv}catch{}}return fl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ph,fl.createPortal=function(p,g){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Qb(g))throw Error(i(200));return eD(p,g,null,w)},fl.createRoot=function(p,g){if(!Qb(p))throw Error(i(299));var w=!1,k="",V=Fl;return g!=null&&(g.unstable_strictMode===!0&&(w=!0),g.identifierPrefix!==void 0&&(k=g.identifierPrefix),g.onRecoverableError!==void 0&&(V=g.onRecoverableError)),g=Yb(p,1,!1,null,null,w,!1,k,V),p[Hc]=g.current,Mp(p.nodeType===8?p.parentNode:p),new gv(g)},fl.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=Ol(g),p=p===null?null:p.stateNode,p},fl.flushSync=function(p){return Cd(p)},fl.hydrate=function(p,g,w){if(!Vm(g))throw Error(i(200));return tf(null,p,g,!0,w)},fl.hydrateRoot=function(p,g,w){if(!Qb(p))throw Error(i(405));var k=w!=null&&w.hydratedSources||null,V=!1,H="",he=Fl;if(w!=null&&(w.unstable_strictMode===!0&&(V=!0),w.identifierPrefix!==void 0&&(H=w.identifierPrefix),w.onRecoverableError!==void 0&&(he=w.onRecoverableError)),g=fv(g,null,p,1,w??null,V,!1,H,he),p[Hc]=g.current,Mp(p),k)for(p=0;p<k.length;p++)w=k[p],V=w._getVersion,V=V(w._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[w,V]:g.mutableSourceEagerHydrationData.push(w,V);return new _v(g)},fl.render=function(p,g,w){if(!Vm(g))throw Error(i(200));return tf(null,p,g,!1,w)},fl.unmountComponentAtNode=function(p){if(!Vm(p))throw Error(i(40));return p._reactRootContainer?(Cd(function(){tf(null,null,p,!1,function(){p._reactRootContainer=null,p[Hc]=null})}),!0):!1},fl.unstable_batchedUpdates=R_,fl.unstable_renderSubtreeIntoContainer=function(p,g,w,k){if(!Vm(w))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return tf(p,g,w,!1,k)},fl.version="18.3.1-next-f1338f8080-20240426",fl}var oK;function WQ(){if(oK)return Y2.exports;oK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Y2.exports=jye(),Y2.exports}var aK;function Bye(){if(aK)return lO;aK=1;var n=WQ();return lO.createRoot=n.createRoot,lO.hydrateRoot=n.hydrateRoot,lO}var zye=Bye();const Wye=jg(zye);function Gye(n,e,i,a){return n.addEventListener(e,i,a),()=>{n.removeEventListener(e,i,a)}}function fN(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function Hye(){return!!(globalThis!=null&&globalThis.document)}function GQ(n){return n.parentElement&&GQ(n.parentElement)?!0:n.hidden}function $ye(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function Kye(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function qye(n){var e;return((e=HQ(n))==null?void 0:e.defaultView)??window}function HQ(n){return fN(n)?n.ownerDocument:document}function Yye(n){return n.view??window}function Xye(n){return HQ(n).activeElement}function Jye(n){const e=Yye(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function $Q(n){return!!n.touches}function Qye(n){return $Q(n)&&n.touches.length>1}function Zye(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function eEe(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function KQ(n,e="page"){return $Q(n)?Zye(n,e):eEe(n,e)}function tEe(n){return e=>{const i=Jye(e);(!i||i&&e.button===0)&&n(e)}}function nEe(n,e=!1){function i(l){n(l,{point:KQ(l)})}return e?tEe(i):i}function BO(n,e,i,a){return Gye(n,e,nEe(i,e==="pointerdown"),a)}function rEe(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const a of e)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in i&&delete i[l],i[l]=a[l]);return i}const rr=n=>n?"":void 0,xf=n=>n?!0:void 0;function iEe(n){return Array.isArray(n)}function Xu(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!iEe(n)}function sEe(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function oEe(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function vU(n){if(n==null)return n;const{unitless:e}=oEe(n);return e||typeof n=="number"?`${n}px`:n}const qQ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,oF=n=>Object.fromEntries(Object.entries(n).sort(qQ));function cK(n){const e=oF(n);return Object.assign(Object.values(e),e)}function aEe(n){const e=Object.keys(oF(n));return new Set(e)}function lK(n){if(!n)return n;n=vU(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function kw(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${vU(n)})`),e&&i.push("and",`(max-width: ${vU(e)})`),i.join(" ")}function cEe(n){if(!n)return null;n.base=n.base??"0px";const e=cK(n),i=Object.entries(n).sort(qQ).map(([u,f],_,E)=>{let[,b]=E[_+1]??[];return b=parseFloat(b)>0?lK(b):void 0,{_minW:lK(f),breakpoint:u,minW:f,maxW:b,maxWQuery:kw(null,b),minWQuery:kw(f),minMaxQuery:kw(f,b)}}),a=aEe(n),l=Array.from(a.values());return{keys:a,normalized:e,isResponsive(u){const f=Object.keys(u);return f.length>0&&f.every(_=>a.has(_))},asObject:oF(n),asArray:cK(n),details:i,get(u){return i.find(f=>f.breakpoint===u)},media:[null,...e.map(u=>kw(u)).slice(1)],toArrayValue(u){if(!Xu(u))throw new Error("toArrayValue: value must be an object");const f=l.map(_=>u[_]??null);for(;sEe(f)===null;)f.pop();return f},toObjectValue(u){if(!Array.isArray(u))throw new Error("toObjectValue: value must be an array");return u.reduce((f,_,E)=>{const b=l[E];return b!=null&&_!=null&&(f[b]=_),f},{})}}}function YQ(...n){return function(...i){n.forEach(a=>a==null?void 0:a(...i))}}function Nn(...n){return function(i){n.some(a=>(a==null||a(i),i==null?void 0:i.defaultPrevented))}}function mN(n){return N.Children.toArray(n).filter(e=>N.isValidElement(e))}function gN(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function lEe(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Ti(n={}){const{name:e,strict:i=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:u,defaultValue:f}=n,_=N.createContext(f);_.displayName=e;function E(){var C;const b=N.useContext(_);if(!b&&i){const I=new Error(u??lEe(a,l));throw I.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,I,E),I}return b}return[_.Provider,E,_]}const _n=(...n)=>n.filter(Boolean).join(" "),XQ=n=>n.hasAttribute("tabindex"),uEe=n=>XQ(n)&&n.tabIndex===-1;function Ck(n){if(!fN(n)||GQ(n)||Kye(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in a?a[e]():$ye(n)?!0:XQ(n)}function dEe(n){return n?fN(n)&&Ck(n)&&!uEe(n):!1}const hEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],pEe=hEe.join(),fEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function JQ(n){const e=Array.from(n.querySelectorAll(pEe));return e.unshift(n),e.filter(i=>Ck(i)&&fEe(i))}function mEe(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const gEe=n=>{const e=new WeakMap;return(a,l,u,f)=>{if(typeof a>"u")return n(a,l,u);e.has(a)||e.set(a,new Map);const _=e.get(a);if(_.has(l))return _.get(l);const E=n(a,l,u,f);return _.set(l,E),E}},QQ=gEe(mEe),_Ee=n=>n.default||n;function aF(n){const{wasSelected:e,enabled:i,isSelected:a,mode:l="unmount"}=n;return!!(!i||a||l==="keepMounted"&&e)}function yEe(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function cF(n,e){let i=yEe(n);const a=10**(e??10);return i=Math.round(i*a)/a,e?i.toFixed(e):i.toString()}function SU(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function uK(n,e,i){return(n-e)*100/(i-e)}function EEe(n,e,i){return(i-e)*n+e}function dK(n,e,i){const a=Math.round((n-e)/i)*i+e,l=SU(i);return cF(a,l)}function zO(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function M0(n,e=[]){const i=Object.assign({},n);for(const a of e)a in i&&delete i[a];return i}function ZQ(n,e){const i={};for(const a of e)a in n&&(i[a]=n[a]);return i}function lF(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):Xu(n)?Object.keys(n).reduce((i,a)=>(i[a]=e(n[a]),i),{}):n!=null?e(n):null}const vEe=n=>typeof n=="function";function Sl(n,...e){return vEe(n)?n(...e):n}function SEe(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:a,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+a)}function bEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function eZ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:fN(n)&&SEe(n)?n:eZ(bEe(n))}function TEe(n,e){const i={},a={};for(const[l,u]of Object.entries(n))e.includes(l)?i[l]=u:a[l]=u;return[i,a]}function wEe(n,...e){const i=Object.getOwnPropertyDescriptors(n),a=Object.keys(i),l=f=>{const _={};for(let E=0;E<f.length;E++){const b=f[E];i[b]&&(Object.defineProperty(_,b,i[b]),delete i[b])}return _},u=f=>l(Array.isArray(f)?f:a.filter(f));return e.map(u).concat(l(a))}function hK(n,e,i={}){const{stop:a,getKey:l}=i;function u(f,_=[]){if(Xu(f)||Array.isArray(f)){const E={};for(const[b,C]of Object.entries(f)){const I=(l==null?void 0:l(b))??b,O=[..._,I];if(a!=null&&a(f,O))return e(f,_);E[I]=u(C,O)}return E}return e(f,_)}return u(n)}var Nw={exports:{}};Nw.exports;var pK;function CEe(){return pK||(pK=1,function(n,e){var i=200,a="__lodash_hash_undefined__",l=800,u=16,f=9007199254740991,_="[object Arguments]",E="[object Array]",b="[object AsyncFunction]",C="[object Boolean]",I="[object Date]",O="[object Error]",L="[object Function]",M="[object GeneratorFunction]",F="[object Map]",z="[object Number]",X="[object Null]",K="[object Object]",ne="[object Proxy]",oe="[object RegExp]",ae="[object Set]",le="[object String]",Y="[object Undefined]",Z="[object WeakMap]",Q="[object ArrayBuffer]",ie="[object DataView]",de="[object Float32Array]",ue="[object Float64Array]",pe="[object Int8Array]",ke="[object Int16Array]",xe="[object Int32Array]",Fe="[object Uint8Array]",Oe="[object Uint8ClampedArray]",we="[object Uint16Array]",Se="[object Uint32Array]",Be=/[\\^$.*+?()[\]{}|]/g,Ee=/^\[object .+?Constructor\]$/,Ce=/^(?:0|[1-9]\d*)$/,Pe={};Pe[de]=Pe[ue]=Pe[pe]=Pe[ke]=Pe[xe]=Pe[Fe]=Pe[Oe]=Pe[we]=Pe[Se]=!0,Pe[_]=Pe[E]=Pe[Q]=Pe[C]=Pe[ie]=Pe[I]=Pe[O]=Pe[L]=Pe[F]=Pe[z]=Pe[K]=Pe[oe]=Pe[ae]=Pe[le]=Pe[Z]=!1;var Me=typeof Sy=="object"&&Sy&&Sy.Object===Object&&Sy,ze=typeof self=="object"&&self&&self.Object===Object&&self,He=Me||ze||Function("return this")(),qe=e&&!e.nodeType&&e,nt=qe&&!0&&n&&!n.nodeType&&n,Ze=nt&&nt.exports===qe,gt=Ze&&Me.process,sn=function(){try{var be=nt&&nt.require&&nt.require("util").types;return be||gt&&gt.binding&&gt.binding("util")}catch{}}(),ut=sn&&sn.isTypedArray;function kt(be,De,rt){switch(rt.length){case 0:return be.call(De);case 1:return be.call(De,rt[0]);case 2:return be.call(De,rt[0],rt[1]);case 3:return be.call(De,rt[0],rt[1],rt[2])}return be.apply(De,rt)}function ct(be,De){for(var rt=-1,Zt=Array(be);++rt<be;)Zt[rt]=De(rt);return Zt}function Mt(be){return function(De){return be(De)}}function fn(be,De){return be==null?void 0:be[De]}function zt(be,De){return function(rt){return be(De(rt))}}var Te=Array.prototype,Ve=Function.prototype,$e=Object.prototype,Et=He["__core-js_shared__"],vt=Ve.toString,St=$e.hasOwnProperty,Wt=function(){var be=/[^.]+$/.exec(Et&&Et.keys&&Et.keys.IE_PROTO||"");return be?"Symbol(src)_1."+be:""}(),dn=$e.toString,En=vt.call(Object),tn=RegExp("^"+vt.call(St).replace(Be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wt=Ze?He.Buffer:void 0,sr=He.Symbol,xt=He.Uint8Array;wt&&wt.allocUnsafe;var qt=zt(Object.getPrototypeOf,Object),br=Object.create,wi=$e.propertyIsEnumerable,Cs=Te.splice,cr=sr?sr.toStringTag:void 0,zn=function(){try{var be=mc(Object,"defineProperty");return be({},"",{}),be}catch{}}(),ra=wt?wt.isBuffer:void 0,Hs=Math.max,io=Date.now,Vc=mc(He,"Map"),Rs=mc(Object,"create"),Ma=function(){function be(){}return function(De){if(!Bc(De))return{};if(br)return br(De);be.prototype=De;var rt=new be;return be.prototype=void 0,rt}}();function Fo(be){var De=-1,rt=be==null?0:be.length;for(this.clear();++De<rt;){var Zt=be[De];this.set(Zt[0],Zt[1])}}function Ua(){this.__data__=Rs?Rs(null):{},this.size=0}function hc(be){var De=this.has(be)&&delete this.__data__[be];return this.size-=De?1:0,De}function Rl(be){var De=this.__data__;if(Rs){var rt=De[be];return rt===a?void 0:rt}return St.call(De,be)?De[be]:void 0}function Va(be){var De=this.__data__;return Rs?De[be]!==void 0:St.call(De,be)}function pc(be,De){var rt=this.__data__;return this.size+=this.has(be)?0:1,rt[be]=Rs&&De===void 0?a:De,this}Fo.prototype.clear=Ua,Fo.prototype.delete=hc,Fo.prototype.get=Rl,Fo.prototype.has=Va,Fo.prototype.set=pc;function mo(be){var De=-1,rt=be==null?0:be.length;for(this.clear();++De<rt;){var Zt=be[De];this.set(Zt[0],Zt[1])}}function Di(){this.__data__=[],this.size=0}function os(be){var De=this.__data__,rt=as(De,be);if(rt<0)return!1;var Zt=De.length-1;return rt==Zt?De.pop():Cs.call(De,rt,1),--this.size,!0}function ia(be){var De=this.__data__,rt=as(De,be);return rt<0?void 0:De[rt][1]}function Il(be){return as(this.__data__,be)>-1}function Fa(be,De){var rt=this.__data__,Zt=as(rt,be);return Zt<0?(++this.size,rt.push([be,De])):rt[Zt][1]=De,this}mo.prototype.clear=Di,mo.prototype.delete=os,mo.prototype.get=ia,mo.prototype.has=Il,mo.prototype.set=Fa;function jo(be){var De=-1,rt=be==null?0:be.length;for(this.clear();++De<rt;){var Zt=be[De];this.set(Zt[0],Zt[1])}}function ft(){this.size=0,this.__data__={hash:new Fo,map:new(Vc||mo),string:new Fo}}function hn(be){var De=ad(this,be).delete(be);return this.size-=De?1:0,De}function Pr(be){return ad(this,be).get(be)}function Ci(be){return ad(this,be).has(be)}function Al(be,De){var rt=ad(this,be),Zt=rt.size;return rt.set(be,De),this.size+=rt.size==Zt?0:1,this}jo.prototype.clear=ft,jo.prototype.delete=hn,jo.prototype.get=Pr,jo.prototype.has=Ci,jo.prototype.set=Al;function $i(be){var De=this.__data__=new mo(be);this.size=De.size}function Pl(){this.__data__=new mo,this.size=0}function Bo(be){var De=this.__data__,rt=De.delete(be);return this.size=De.size,rt}function cu(be){return this.__data__.get(be)}function Ol(be){return this.__data__.has(be)}function sa(be,De){var rt=this.__data__;if(rt instanceof mo){var Zt=rt.__data__;if(!Vc||Zt.length<i-1)return Zt.push([be,De]),this.size=++rt.size,this;rt=this.__data__=new jo(Zt)}return rt.set(be,De),this.size=rt.size,this}$i.prototype.clear=Pl,$i.prototype.delete=Bo,$i.prototype.get=cu,$i.prototype.has=Ol,$i.prototype.set=sa;function lu(be,De){var rt=ca(be),Zt=!rt&&fs(be),tr=!rt&&!Zt&&ua(be),Or=!rt&&!Zt&&!tr&&Op(be),Jr=rt||Zt||tr||Or,gn=Jr?ct(be.length,String):[],Hr=gn.length;for(var Ii in be)Jr&&(Ii=="length"||tr&&(Ii=="offset"||Ii=="parent")||Or&&(Ii=="buffer"||Ii=="byteLength"||Ii=="byteOffset")||Dl(Ii,Hr))||gn.push(Ii);return gn}function fc(be,De,rt){(rt!==void 0&&!aa(be[De],rt)||rt===void 0&&!(De in be))&&vn(be,De,rt)}function xi(be,De,rt){var Zt=be[De];(!(St.call(be,De)&&aa(Zt,rt))||rt===void 0&&!(De in be))&&vn(be,De,rt)}function as(be,De){for(var rt=be.length;rt--;)if(aa(be[rt][0],De))return rt;return-1}function vn(be,De,rt){De=="__proto__"&&zn?zn(be,De,{configurable:!0,enumerable:!0,value:rt,writable:!0}):be[De]=rt}var Ri=hu();function Fc(be){return be==null?be===void 0?Y:X:cr&&cr in Object(be)?oa(be):im(be)}function kl(be){return Is(be)&&Fc(be)==_}function ja(be){if(!Bc(be)||gc(be))return!1;var De=da(be)?tn:Ee;return De.test(Pp(be))}function Rp(be){return Is(be)&&om(be.length)&&!!Pe[Fc(be)]}function lh(be){if(!Bc(be))return jc(be);var De=pr(be),rt=[];for(var Zt in be)Zt=="constructor"&&(De||!St.call(be,Zt))||rt.push(Zt);return rt}function uu(be,De,rt,Zt,tr){be!==De&&Ri(De,function(Or,Jr){if(tr||(tr=new $i),Bc(Or))zo(be,De,Jr,rt,uu,Zt,tr);else{var gn=Zt?Zt(hh(be,Jr),Or,Jr+"",be,De,tr):void 0;gn===void 0&&(gn=Or),fc(be,Jr,gn)}},gu)}function zo(be,De,rt,Zt,tr,Or,Jr){var gn=hh(be,rt),Hr=hh(De,rt),Ii=Jr.get(Hr);if(Ii){fc(be,rt,Ii);return}var $s=Or?Or(gn,Hr,rt+"",be,De,Jr):void 0,ha=$s===void 0;if(ha){var pa=ca(Hr),ud=!pa&&ua(Hr),cs=!pa&&!ud&&Op(Hr);$s=Hr,pa||ud||cs?ca(gn)?$s=gn:mu(gn)?$s=dh(gn):ud?(ha=!1,$s=Ip(Hr)):cs?(ha=!1,$s=uh(Hr)):$s=[]:ld(Hr)||fs(Hr)?($s=gn,fs(gn)?$s=xl(gn):(!Bc(gn)||da(gn))&&($s=cd(Hr))):ha=!1}ha&&(Jr.set(Hr,$s),tr($s,Hr,Zt,Or,Jr),Jr.delete(Hr)),fc(be,rt,$s)}function rm(be,De){return Ap(fu(be,De,za),be+"")}var go=zn?function(be,De){return zn(be,"toString",{configurable:!0,enumerable:!1,value:Ba(De),writable:!0})}:za;function Ip(be,De){return be.slice()}function Nl(be){var De=new be.constructor(be.byteLength);return new xt(De).set(new xt(be)),De}function uh(be,De){var rt=Nl(be.buffer);return new be.constructor(rt,be.byteOffset,be.length)}function dh(be,De){var rt=-1,Zt=be.length;for(De||(De=Array(Zt));++rt<Zt;)De[rt]=be[rt];return De}function Tr(be,De,rt,Zt){var tr=!rt;rt||(rt={});for(var Or=-1,Jr=De.length;++Or<Jr;){var gn=De[Or],Hr=void 0;Hr===void 0&&(Hr=be[gn]),tr?vn(rt,gn,Hr):xi(rt,gn,Hr)}return rt}function du(be){return rm(function(De,rt){var Zt=-1,tr=rt.length,Or=tr>1?rt[tr-1]:void 0,Jr=tr>2?rt[2]:void 0;for(Or=be.length>3&&typeof Or=="function"?(tr--,Or):void 0,Jr&&pu(rt[0],rt[1],Jr)&&(Or=tr<3?void 0:Or,tr=1),De=Object(De);++Zt<tr;){var gn=rt[Zt];gn&&be(De,gn,Zt,Or)}return De})}function hu(be){return function(De,rt,Zt){for(var tr=-1,Or=Object(De),Jr=Zt(De),gn=Jr.length;gn--;){var Hr=Jr[++tr];if(rt(Or[Hr],Hr,Or)===!1)break}return De}}function ad(be,De){var rt=be.__data__;return ei(De)?rt[typeof De=="string"?"string":"hash"]:rt.map}function mc(be,De){var rt=fn(be,De);return ja(rt)?rt:void 0}function oa(be){var De=St.call(be,cr),rt=be[cr];try{be[cr]=void 0;var Zt=!0}catch{}var tr=dn.call(be);return Zt&&(De?be[cr]=rt:delete be[cr]),tr}function cd(be){return typeof be.constructor=="function"&&!pr(be)?Ma(qt(be)):{}}function Dl(be,De){var rt=typeof be;return De=De??f,!!De&&(rt=="number"||rt!="symbol"&&Ce.test(be))&&be>-1&&be%1==0&&be<De}function pu(be,De,rt){if(!Bc(rt))return!1;var Zt=typeof De;return(Zt=="number"?la(rt)&&Dl(De,rt.length):Zt=="string"&&De in rt)?aa(rt[De],be):!1}function ei(be){var De=typeof be;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?be!=="__proto__":be===null}function gc(be){return!!Wt&&Wt in be}function pr(be){var De=be&&be.constructor,rt=typeof De=="function"&&De.prototype||$e;return be===rt}function jc(be){var De=[];if(be!=null)for(var rt in Object(be))De.push(rt);return De}function im(be){return dn.call(be)}function fu(be,De,rt){return De=Hs(De===void 0?be.length-1:De,0),function(){for(var Zt=arguments,tr=-1,Or=Hs(Zt.length-De,0),Jr=Array(Or);++tr<Or;)Jr[tr]=Zt[De+tr];tr=-1;for(var gn=Array(De+1);++tr<De;)gn[tr]=Zt[tr];return gn[De]=rt(Jr),kt(be,this,gn)}}function hh(be,De){if(!(De==="constructor"&&typeof be[De]=="function")&&De!="__proto__")return be[De]}var Ap=sm(go);function sm(be){var De=0,rt=0;return function(){var Zt=io(),tr=u-(Zt-rt);if(rt=Zt,tr>0){if(++De>=l)return arguments[0]}else De=0;return be.apply(void 0,arguments)}}function Pp(be){if(be!=null){try{return vt.call(be)}catch{}try{return be+""}catch{}}return""}function aa(be,De){return be===De||be!==be&&De!==De}var fs=kl(function(){return arguments}())?kl:function(be){return Is(be)&&St.call(be,"callee")&&!wi.call(be,"callee")},ca=Array.isArray;function la(be){return be!=null&&om(be.length)&&!da(be)}function mu(be){return Is(be)&&la(be)}var ua=ra||Ll;function da(be){if(!Bc(be))return!1;var De=Fc(be);return De==L||De==M||De==b||De==ne}function om(be){return typeof be=="number"&&be>-1&&be%1==0&&be<=f}function Bc(be){var De=typeof be;return be!=null&&(De=="object"||De=="function")}function Is(be){return be!=null&&typeof be=="object"}function ld(be){if(!Is(be)||Fc(be)!=K)return!1;var De=qt(be);if(De===null)return!0;var rt=St.call(De,"constructor")&&De.constructor;return typeof rt=="function"&&rt instanceof rt&&vt.call(rt)==En}var Op=ut?Mt(ut):Rp;function xl(be){return Tr(be,gu(be))}function gu(be){return la(be)?lu(be):lh(be)}var am=du(function(be,De,rt,Zt){uu(be,De,rt,Zt)});function Ba(be){return function(){return be}}function za(be){return be}function Ll(){return!1}n.exports=am}(Nw,Nw.exports)),Nw.exports}var REe=CEe();const lp=jg(REe);function eo(n,e=[]){const i=N.useRef(n);return N.useEffect(()=>{i.current=n}),N.useCallback((...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},e)}function Iy(n,e,i,a){const l=eo(i);return N.useEffect(()=>{const u=typeof n=="function"?n():n??document;if(!(!i||!u))return u.addEventListener(e,l,a),()=>{u.removeEventListener(e,l,a)}},[e,n,a,l,i]),()=>{const u=typeof n=="function"?n():n??document;u==null||u.removeEventListener(e,l,a)}}function tZ(n){const{isOpen:e,ref:i}=n,[a,l]=N.useState(e),[u,f]=N.useState(!1);return N.useEffect(()=>{u||(l(e),f(!0))},[e,u,a]),Iy(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!a),onComplete(){var C;const E=qye(i.current),b=new E.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(b)}}}var Q2,fK;function IEe(){return fK||(fK=1,Q2=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],a=0;a<n.rangeCount;a++)i.push(n.getRangeAt(a));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),Q2}var Z2,mK;function AEe(){if(mK)return Z2;mK=1;var n=IEe(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function a(u){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return u.replace(/#{\s*key\s*}/g,f)}function l(u,f){var _,E,b,C,I,O,L=!1;f||(f={}),_=f.debug||!1;try{b=n(),C=document.createRange(),I=document.getSelection(),O=document.createElement("span"),O.textContent=u,O.ariaHidden="true",O.style.all="unset",O.style.position="fixed",O.style.top=0,O.style.clip="rect(0, 0, 0, 0)",O.style.whiteSpace="pre",O.style.webkitUserSelect="text",O.style.MozUserSelect="text",O.style.msUserSelect="text",O.style.userSelect="text",O.addEventListener("copy",function(F){if(F.stopPropagation(),f.format)if(F.preventDefault(),typeof F.clipboardData>"u"){_&&console.warn("unable to use e.clipboardData"),_&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var z=e[f.format]||e.default;window.clipboardData.setData(z,u)}else F.clipboardData.clearData(),F.clipboardData.setData(f.format,u);f.onCopy&&(F.preventDefault(),f.onCopy(F.clipboardData))}),document.body.appendChild(O),C.selectNodeContents(O),I.addRange(C);var M=document.execCommand("copy");if(!M)throw new Error("copy command was unsuccessful");L=!0}catch(F){_&&console.error("unable to copy using execCommand: ",F),_&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",u),f.onCopy&&f.onCopy(window.clipboardData),L=!0}catch(z){_&&console.error("unable to copy using clipboardData: ",z),_&&console.error("falling back to prompt"),E=a("message"in f?f.message:i),window.prompt(E,u)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(C):I.removeAllRanges()),O&&document.body.removeChild(O),b()}return L}return Z2=l,Z2}var PEe=AEe();const gK=jg(PEe);function _K(n,e={}){const[i,a]=N.useState(!1),[l,u]=N.useState(n);N.useEffect(()=>u(n),[n]);const{timeout:f=1500,..._}=typeof e=="number"?{timeout:e}:e,E=N.useCallback(b=>{const C=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>a(!0)).catch(()=>a(gK(C,_))):a(gK(C,_))},[l,_]);return N.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{a(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,i]),{value:l,setValue:u,onCopy:E,hasCopied:i}}function nZ(n){const{value:e,defaultValue:i,onChange:a,shouldUpdate:l=(O,L)=>O!==L}=n,u=eo(a),f=eo(l),[_,E]=N.useState(i),b=e!==void 0,C=b?e:_,I=eo(O=>{const M=typeof O=="function"?O(C):O;f(C,M)&&(b||E(M),u(M))},[b,u,C,f]);return[C,I]}function OEe(n={}){const{onChange:e,precision:i,defaultValue:a,value:l,step:u=1,min:f=Number.MIN_SAFE_INTEGER,max:_=Number.MAX_SAFE_INTEGER,keepWithinRange:E=!0}=n,b=eo(e),[C,I]=N.useState(()=>a==null?"":eM(a,u,i)??""),O=typeof l<"u",L=O?l:C,M=rZ(pg(L),u),F=i??M,z=N.useCallback(ie=>{ie!==L&&(O||I(ie.toString()),b==null||b(ie.toString(),pg(ie)))},[b,O,L]),X=N.useCallback(ie=>{let de=ie;return E&&(de=zO(de,f,_)),cF(de,F)},[F,E,_,f]),K=N.useCallback((ie=u)=>{let de;L===""?de=pg(ie):de=pg(L)+ie,de=X(de),z(de)},[X,u,z,L]),ne=N.useCallback((ie=u)=>{let de;L===""?de=pg(-ie):de=pg(L)-ie,de=X(de),z(de)},[X,u,z,L]),oe=N.useCallback(()=>{let ie;a==null?ie="":ie=eM(a,u,i)??f,z(ie)},[a,i,u,z,f]),ae=N.useCallback(ie=>{const de=eM(ie,u,F)??f;z(de)},[F,u,z,f]),le=pg(L);return{isOutOfRange:le>_||le<f,isAtMax:le===_,isAtMin:le===f,precision:F,value:L,valueAsNumber:le,update:z,reset:oe,increment:K,decrement:ne,clamp:X,cast:ae,setValue:I}}function pg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function rZ(n,e){return Math.max(SU(e),SU(n))}function eM(n,e,i){const a=pg(n);if(Number.isNaN(a))return;const l=rZ(a,e);return cF(a,i??l)}function th(n={}){const{onClose:e,onOpen:i,isOpen:a,id:l}=n,u=eo(i),f=eo(e),[_,E]=N.useState(n.defaultIsOpen||!1),b=a!==void 0?a:_,C=a!==void 0,I=N.useId(),O=l??`disclosure-${I}`,L=N.useCallback(()=>{C||E(!1),f==null||f()},[C,f]),M=N.useCallback(()=>{C||E(!0),u==null||u()},[C,u]),F=N.useCallback(()=>{b?L():M()},[b,M,L]);function z(K={}){return{...K,"aria-expanded":b,"aria-controls":O,onClick(ne){var oe;(oe=K.onClick)==null||oe.call(K,ne),F()}}}function X(K={}){return{...K,hidden:!b,id:O}}return{isOpen:b,onOpen:M,onClose:L,onToggle:F,isControlled:C,getButtonProps:z,getDisclosureProps:X}}const pp=globalThis!=null&&globalThis.document?N.useLayoutEffect:N.useEffect,Gf=(n,e)=>{const i=N.useRef(!1),a=N.useRef(!1);N.useEffect(()=>{if(i.current&&a.current)return n();a.current=!0},e),N.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function kEe(n){const e=n.current;if(!e)return!1;const i=Xye(e);return!i||e.contains(i)?!1:!!dEe(i)}function iZ(n,e){const{shouldFocus:i,visible:a,focusRef:l}=e,u=i&&!a;Gf(()=>{if(!u||kEe(n))return;const f=(l==null?void 0:l.current)||n.current;let _;if(f)return _=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(_)}},[u,n,l])}const NEe={preventScroll:!0,shouldFocus:!1};function DEe(n,e=NEe){const{focusRef:i,preventScroll:a,shouldFocus:l,visible:u}=e,f=xEe(n)?n.current:n,_=l&&u,E=N.useRef(_),b=N.useRef(u);pp(()=>{!b.current&&u&&(E.current=_),b.current=u},[u,_]);const C=N.useCallback(()=>{if(!(!u||!f||!E.current)&&(E.current=!1,!f.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:a})});else{const I=JQ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[u,a,f,i]);Gf(()=>{C()},[C]),Iy(f,"transitionend",C)}function xEe(n){return"current"in n}function LEe(n){return"current"in n}const sZ=()=>typeof window<"u";function MEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const UEe=n=>sZ()&&n.test(navigator.vendor),VEe=n=>sZ()&&n.test(MEe()),FEe=()=>VEe(/mac|iphone|ipad|ipod/i),jEe=()=>FEe()&&UEe(/apple/i);function BEe(n){const{ref:e,elements:i,enabled:a}=n,l=()=>{var u;return((u=e.current)==null?void 0:u.ownerDocument)??document};Iy(l,"pointerdown",u=>{var b,C;if(!jEe()||!a)return;const f=((C=(b=u.composedPath)==null?void 0:b.call(u))==null?void 0:C[0])??u.target,E=(i??[e]).some(I=>{const O=LEe(I)?I.current:I;return(O==null?void 0:O.contains(f))||O===f});l().activeElement!==f&&E&&(u.preventDefault(),f.focus())})}function zEe(n,e){const i=N.useId();return N.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function WEe(n,...e){const i=zEe(n);return N.useMemo(()=>e.map(a=>`${a}-${i}`),[i,e])}function GEe(n,e){const i=eo(n);N.useEffect(()=>{let a=null;const l=()=>i();return e!==null&&(a=window.setInterval(l,e)),()=>{a&&window.clearInterval(a)}},[e,i])}function oZ(n){const e=N.useRef(null);return e.current=n,e}function HEe(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Fi(...n){return e=>{n.forEach(i=>{HEe(i,e)})}}function $Ee(...n){return N.useMemo(()=>Fi(...n),n)}function aZ(n){const{ref:e,handler:i,enabled:a=!0}=n,l=eo(i),f=N.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;N.useEffect(()=>{if(!a)return;const _=I=>{tM(I,e)&&(f.isPointerDown=!0)},E=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&i&&tM(I,e)&&(f.isPointerDown=!1,l(I))},b=I=>{f.ignoreEmulatedMouseEvents=!0,i&&f.isPointerDown&&tM(I,e)&&(f.isPointerDown=!1,l(I))},C=cZ(e.current);return C.addEventListener("mousedown",_,!0),C.addEventListener("mouseup",E,!0),C.addEventListener("touchstart",_,!0),C.addEventListener("touchend",b,!0),()=>{C.removeEventListener("mousedown",_,!0),C.removeEventListener("mouseup",E,!0),C.removeEventListener("touchstart",_,!0),C.removeEventListener("touchend",b,!0)}},[i,e,l,f,a])}function tM(n,e){var a,l;const i=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return i&&!cZ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function cZ(n){return(n==null?void 0:n.ownerDocument)??document}function KEe(n,e){const i=eo(n);N.useEffect(()=>{if(e==null)return;let a=null;return a=window.setTimeout(()=>{i()},e),()=>{a&&window.clearTimeout(a)}},[e,i])}const lZ=1/60*1e3,qEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),uZ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(qEe()),lZ);function YEe(n){let e=[],i=[],a=0,l=!1,u=!1;const f=new WeakSet,_={schedule:(E,b=!1,C=!1)=>{const I=C&&l,O=I?e:i;return b&&f.add(E),O.indexOf(E)===-1&&(O.push(E),I&&l&&(a=e.length)),E},cancel:E=>{const b=i.indexOf(E);b!==-1&&i.splice(b,1),f.delete(E)},process:E=>{if(l){u=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,a=e.length,a)for(let b=0;b<a;b++){const C=e[b];C(E),f.has(C)&&(_.schedule(C),n())}l=!1,u&&(u=!1,_.process(E))}};return _}const XEe=40;let bU=!0,EC=!1,TU=!1;const qS={delta:0,timestamp:0},qC=["read","update","preRender","render","postRender"],_N=qC.reduce((n,e)=>(n[e]=YEe(()=>EC=!0),n),{}),JEe=qC.reduce((n,e)=>{const i=_N[e];return n[e]=(a,l=!1,u=!1)=>(EC||eve(),i.schedule(a,l,u)),n},{}),QEe=qC.reduce((n,e)=>(n[e]=_N[e].cancel,n),{});qC.reduce((n,e)=>(n[e]=()=>_N[e].process(qS),n),{});const ZEe=n=>_N[n].process(qS),dZ=n=>{EC=!1,qS.delta=bU?lZ:Math.max(Math.min(n-qS.timestamp,XEe),1),qS.timestamp=n,TU=!0,qC.forEach(ZEe),TU=!1,EC&&(bU=!1,uZ(dZ))},eve=()=>{EC=!0,bU=!0,TU||uZ(dZ)},yK=()=>qS;var tve=Object.defineProperty,nve=(n,e,i)=>e in n?tve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Gd=(n,e,i)=>(nve(n,typeof e!="symbol"?e+"":e,i),i);class rve{constructor(e,i,a){if(Gd(this,"history",[]),Gd(this,"startEvent",null),Gd(this,"lastEvent",null),Gd(this,"lastEventInfo",null),Gd(this,"handlers",{}),Gd(this,"removeListeners",()=>{}),Gd(this,"threshold",3),Gd(this,"win"),Gd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const _=nM(this.lastEventInfo,this.history),E=this.startEvent!==null,b=ave(_.offset,{x:0,y:0})>=this.threshold;if(!E&&!b)return;const{timestamp:C}=yK();this.history.push({..._.point,timestamp:C});const{onStart:I,onMove:O}=this.handlers;E||(I==null||I(this.lastEvent,_),this.startEvent=this.lastEvent),O==null||O(this.lastEvent,_)}),Gd(this,"onPointerMove",(_,E)=>{this.lastEvent=_,this.lastEventInfo=E,JEe.update(this.updatePoint,!0)}),Gd(this,"onPointerUp",(_,E)=>{const b=nM(E,this.history),{onEnd:C,onSessionEnd:I}=this.handlers;I==null||I(_,b),this.end(),!(!C||!this.startEvent)&&(C==null||C(_,b))}),this.win=e.view??window,Qye(e))return;this.handlers=i,a&&(this.threshold=a),e.stopPropagation(),e.preventDefault();const l={point:KQ(e)},{timestamp:u}=yK();this.history=[{...l.point,timestamp:u}];const{onSessionStart:f}=i;f==null||f(e,nM(l,this.history)),this.removeListeners=ove(BO(this.win,"pointermove",this.onPointerMove),BO(this.win,"pointerup",this.onPointerUp),BO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),QEe.update(this.updatePoint)}}function EK(n,e){return{x:n.x-e.x,y:n.y-e.y}}function nM(n,e){return{point:n.point,delta:EK(n.point,e[e.length-1]),offset:EK(n.point,e[0]),velocity:sve(e,.1)}}const ive=n=>n*1e3;function sve(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=n[n.length-1];for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>ive(e)));)i--;if(!a)return{x:0,y:0};const u=(l.timestamp-a.timestamp)/1e3;if(u===0)return{x:0,y:0};const f={x:(l.x-a.x)/u,y:(l.y-a.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function ove(...n){return e=>n.reduce((i,a)=>a(i),e)}function rM(n,e){return Math.abs(n-e)}function vK(n){return"x"in n&&"y"in n}function ave(n,e){if(typeof n=="number"&&typeof e=="number")return rM(n,e);if(vK(n)&&vK(e)){const i=rM(n.x,e.x),a=rM(n.y,e.y);return Math.sqrt(i**2+a**2)}return 0}function cve(n,e){const{onPan:i,onPanStart:a,onPanEnd:l,onPanSessionStart:u,onPanSessionEnd:f,threshold:_}=e,E=!!(i||a||l||u||f),b=N.useRef(null),C=oZ({onSessionStart:u,onSessionEnd:f,onStart:a,onMove:i,onEnd(I,O){b.current=null,l==null||l(I,O)}});N.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(C.current)}),N.useEffect(()=>{const I=n.current;if(!I||!E)return;function O(L){b.current=new rve(L,C.current,_)}return BO(I,"pointerdown",O)},[n,E,C,_]),N.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const Co={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},Qh=n=>hZ(e=>n(e,"&"),"[role=group]","[data-group]",".group"),bf=n=>hZ(e=>n(e,"~ &"),"[data-peer]",".peer"),hZ=(n,...e)=>e.map(n).join(", "),YS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Qh(Co.open),_groupClosed:Qh(Co.closed),_groupHover:Qh(Co.hover),_peerHover:bf(Co.hover),_groupFocus:Qh(Co.focus),_peerFocus:bf(Co.focus),_groupFocusVisible:Qh(Co.focusVisible),_peerFocusVisible:bf(Co.focusVisible),_groupActive:Qh(Co.active),_peerActive:bf(Co.active),_groupDisabled:Qh(Co.disabled),_peerDisabled:bf(Co.disabled),_groupInvalid:Qh(Co.invalid),_peerInvalid:bf(Co.invalid),_groupChecked:Qh(Co.checked),_peerChecked:bf(Co.checked),_groupFocusWithin:Qh(Co.focusWithin),_peerFocusWithin:bf(Co.focusWithin),_peerPlaceholderShown:bf(Co.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},pZ=Object.keys(YS),lve=n=>/!(important)?$/.test(n),SK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,uve=(n,e)=>i=>{const a=String(e),l=lve(a),u=SK(a),f=n?`${n}.${u}`:u;let _=Xu(i.__cssMap)&&f in i.__cssMap?i.__cssMap[f].varRef:e;return _=SK(_),l?`${_} !important`:_};function uF(n){const{scale:e,transform:i,compose:a}=n;return(u,f)=>{const _=uve(e,u)(f);let E=(i==null?void 0:i(_,f))??_;return a&&(E=a(E,f)),E}}const uO=(...n)=>e=>n.reduce((i,a)=>a(i),e);function Hu(n,e){return i=>{const a={property:i,scale:n};return a.transform=uF({scale:n,transform:e}),a}}const dve=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function hve(n){const{property:e,scale:i,transform:a}=n;return{scale:i,property:dve(e),transform:i?uF({scale:i,compose:a}):a}}const fZ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function pve(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...fZ].join(" ")}function fve(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...fZ].join(" ")}const mve={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},gve={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function _ve(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const yve={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},wU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},Eve=new Set(Object.values(wU)),CU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),vve=n=>n.trim();function Sve(n,e){if(n==null||CU.has(n))return n;if(!(RU(n)||CU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),u=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!u||!f)return n;const _=u.includes("-gradient")?u:`${u}-gradient`,[E,...b]=f.split(",").map(vve).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const C=E in wU?wU[E]:E;b.unshift(C);const I=b.map(O=>{if(Eve.has(O))return O;const L=O.indexOf(" "),[M,F]=L!==-1?[O.substr(0,L),O.substr(L+1)]:[O],z=RU(F)?F:F&&F.split(" "),X=`colors.${M}`,K=X in e.__cssMap?e.__cssMap[X].varRef:M;return z?[K,...Array.isArray(z)?z:[z]].join(" "):K});return`${_}(${I.join(", ")})`}const RU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),bve=(n,e)=>Sve(n,e??{});function Tve(n){return/^var\(--.+\)$/.test(n)}const wve=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},Zh=n=>e=>`${n}(${e})`,jr={filter(n){return n!=="auto"?n:mve},backdropFilter(n){return n!=="auto"?n:gve},ring(n){return _ve(jr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?pve():n==="auto-gpu"?fve():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=wve(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(Tve(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:bve,blur:Zh("blur"),opacity:Zh("opacity"),brightness:Zh("brightness"),contrast:Zh("contrast"),dropShadow:Zh("drop-shadow"),grayscale:Zh("grayscale"),hueRotate:n=>Zh("hue-rotate")(jr.degree(n)),invert:Zh("invert"),saturate:Zh("saturate"),sepia:Zh("sepia"),bgImage(n){return n==null||RU(n)||CU.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=yve[n]??{},a={flexDirection:n};return e&&(a[e]=1),i&&(a[i]=1),a}},Ge={borderWidths:Hu("borderWidths"),borderStyles:Hu("borderStyles"),colors:Hu("colors"),borders:Hu("borders"),gradients:Hu("gradients",jr.gradient),radii:Hu("radii",jr.px),space:Hu("space",uO(jr.vh,jr.px)),spaceT:Hu("space",uO(jr.vh,jr.px)),degreeT(n){return{property:n,transform:jr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:uF({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Hu("sizes",uO(jr.vh,jr.px)),sizesT:Hu("sizes",uO(jr.vh,jr.fraction)),shadows:Hu("shadows"),logical:hve,blur:Hu("blur",jr.blur)},WO={background:Ge.colors("background"),backgroundColor:Ge.colors("backgroundColor"),backgroundImage:Ge.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:jr.bgClip},bgSize:Ge.prop("backgroundSize"),bgPosition:Ge.prop("backgroundPosition"),bg:Ge.colors("background"),bgColor:Ge.colors("backgroundColor"),bgPos:Ge.prop("backgroundPosition"),bgRepeat:Ge.prop("backgroundRepeat"),bgAttachment:Ge.prop("backgroundAttachment"),bgGradient:Ge.gradients("backgroundImage"),bgClip:{transform:jr.bgClip}};Object.assign(WO,{bgImage:WO.backgroundImage,bgImg:WO.backgroundImage});const ri={border:Ge.borders("border"),borderWidth:Ge.borderWidths("borderWidth"),borderStyle:Ge.borderStyles("borderStyle"),borderColor:Ge.colors("borderColor"),borderRadius:Ge.radii("borderRadius"),borderTop:Ge.borders("borderTop"),borderBlockStart:Ge.borders("borderBlockStart"),borderTopLeftRadius:Ge.radii("borderTopLeftRadius"),borderStartStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ge.radii("borderTopRightRadius"),borderStartEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ge.borders("borderRight"),borderInlineEnd:Ge.borders("borderInlineEnd"),borderBottom:Ge.borders("borderBottom"),borderBlockEnd:Ge.borders("borderBlockEnd"),borderBottomLeftRadius:Ge.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ge.radii("borderBottomRightRadius"),borderLeft:Ge.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ge.borders(["borderLeft","borderRight"]),borderInline:Ge.borders("borderInline"),borderY:Ge.borders(["borderTop","borderBottom"]),borderBlock:Ge.borders("borderBlock"),borderTopWidth:Ge.borderWidths("borderTopWidth"),borderBlockStartWidth:Ge.borderWidths("borderBlockStartWidth"),borderTopColor:Ge.colors("borderTopColor"),borderBlockStartColor:Ge.colors("borderBlockStartColor"),borderTopStyle:Ge.borderStyles("borderTopStyle"),borderBlockStartStyle:Ge.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ge.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ge.borderWidths("borderBlockEndWidth"),borderBottomColor:Ge.colors("borderBottomColor"),borderBlockEndColor:Ge.colors("borderBlockEndColor"),borderBottomStyle:Ge.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ge.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ge.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ge.borderWidths("borderInlineStartWidth"),borderLeftColor:Ge.colors("borderLeftColor"),borderInlineStartColor:Ge.colors("borderInlineStartColor"),borderLeftStyle:Ge.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ge.borderStyles("borderInlineStartStyle"),borderRightWidth:Ge.borderWidths("borderRightWidth"),borderInlineEndWidth:Ge.borderWidths("borderInlineEndWidth"),borderRightColor:Ge.colors("borderRightColor"),borderInlineEndColor:Ge.colors("borderInlineEndColor"),borderRightStyle:Ge.borderStyles("borderRightStyle"),borderInlineEndStyle:Ge.borderStyles("borderInlineEndStyle"),borderTopRadius:Ge.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ge.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ge.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ge.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(ri,{rounded:ri.borderRadius,roundedTop:ri.borderTopRadius,roundedTopLeft:ri.borderTopLeftRadius,roundedTopRight:ri.borderTopRightRadius,roundedTopStart:ri.borderStartStartRadius,roundedTopEnd:ri.borderStartEndRadius,roundedBottom:ri.borderBottomRadius,roundedBottomLeft:ri.borderBottomLeftRadius,roundedBottomRight:ri.borderBottomRightRadius,roundedBottomStart:ri.borderEndStartRadius,roundedBottomEnd:ri.borderEndEndRadius,roundedLeft:ri.borderLeftRadius,roundedRight:ri.borderRightRadius,roundedStart:ri.borderInlineStartRadius,roundedEnd:ri.borderInlineEndRadius,borderStart:ri.borderInlineStart,borderEnd:ri.borderInlineEnd,borderTopStartRadius:ri.borderStartStartRadius,borderTopEndRadius:ri.borderStartEndRadius,borderBottomStartRadius:ri.borderEndStartRadius,borderBottomEndRadius:ri.borderEndEndRadius,borderStartRadius:ri.borderInlineStartRadius,borderEndRadius:ri.borderInlineEndRadius,borderStartWidth:ri.borderInlineStartWidth,borderEndWidth:ri.borderInlineEndWidth,borderStartColor:ri.borderInlineStartColor,borderEndColor:ri.borderInlineEndColor,borderStartStyle:ri.borderInlineStartStyle,borderEndStyle:ri.borderInlineEndStyle});const Cve={color:Ge.colors("color"),textColor:Ge.colors("color"),fill:Ge.colors("fill"),stroke:Ge.colors("stroke"),accentColor:Ge.colors("accentColor"),textFillColor:Ge.colors("textFillColor")},Rk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:jr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ge.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ge.space("gap"),rowGap:Ge.space("rowGap"),columnGap:Ge.space("columnGap")};Object.assign(Rk,{flexDir:Rk.flexDirection});const qu={width:Ge.sizesT("width"),inlineSize:Ge.sizesT("inlineSize"),height:Ge.sizes("height"),blockSize:Ge.sizes("blockSize"),boxSize:Ge.sizes(["width","height"]),minWidth:Ge.sizes("minWidth"),minInlineSize:Ge.sizes("minInlineSize"),minHeight:Ge.sizes("minHeight"),minBlockSize:Ge.sizes("minBlockSize"),maxWidth:Ge.sizes("maxWidth"),maxInlineSize:Ge.sizes("maxInlineSize"),maxHeight:Ge.sizes("maxHeight"),maxBlockSize:Ge.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (min-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (max-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ge.propT("float",jr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(qu,{w:qu.width,h:qu.height,minW:qu.minWidth,maxW:qu.maxWidth,minH:qu.minHeight,maxH:qu.maxHeight,overscroll:qu.overscrollBehavior,overscrollX:qu.overscrollBehaviorX,overscrollY:qu.overscrollBehaviorY});const Rve={filter:{transform:jr.filter},blur:Ge.blur("--chakra-blur"),brightness:Ge.propT("--chakra-brightness",jr.brightness),contrast:Ge.propT("--chakra-contrast",jr.contrast),hueRotate:Ge.propT("--chakra-hue-rotate",jr.hueRotate),invert:Ge.propT("--chakra-invert",jr.invert),saturate:Ge.propT("--chakra-saturate",jr.saturate),dropShadow:Ge.propT("--chakra-drop-shadow",jr.dropShadow),backdropFilter:{transform:jr.backdropFilter},backdropBlur:Ge.blur("--chakra-backdrop-blur"),backdropBrightness:Ge.propT("--chakra-backdrop-brightness",jr.brightness),backdropContrast:Ge.propT("--chakra-backdrop-contrast",jr.contrast),backdropHueRotate:Ge.propT("--chakra-backdrop-hue-rotate",jr.hueRotate),backdropInvert:Ge.propT("--chakra-backdrop-invert",jr.invert),backdropSaturate:Ge.propT("--chakra-backdrop-saturate",jr.saturate)},Ive={ring:{transform:jr.ring},ringColor:Ge.colors("--chakra-ring-color"),ringOffset:Ge.prop("--chakra-ring-offset-width"),ringOffsetColor:Ge.colors("--chakra-ring-offset-color"),ringInset:Ge.prop("--chakra-ring-inset")},Ave={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:jr.outline},outlineOffset:!0,outlineColor:Ge.colors("outlineColor")},mZ={gridGap:Ge.space("gridGap"),gridColumnGap:Ge.space("gridColumnGap"),gridRowGap:Ge.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function Pve(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const Ove=n=>{const e=new WeakMap;return(a,l,u,f)=>{if(typeof a>"u")return n(a,l,u);e.has(a)||e.set(a,new Map);const _=e.get(a);if(_.has(l))return _.get(l);const E=n(a,l,u,f);return _.set(l,E),E}},kve=Ove(Pve),Nve={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},Dve={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},iM=(n,e,i)=>{const a={},l=kve(n,e,{});for(const u in l)u in i&&i[u]!=null||(a[u]=l[u]);return a},xve={srOnly:{transform(n){return n===!0?Nve:n==="focusable"?Dve:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>iM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>iM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>iM(e,n,i)}},Jw={position:!0,pos:Ge.prop("position"),zIndex:Ge.prop("zIndex","zIndices"),inset:Ge.spaceT("inset"),insetX:Ge.spaceT(["left","right"]),insetInline:Ge.spaceT("insetInline"),insetY:Ge.spaceT(["top","bottom"]),insetBlock:Ge.spaceT("insetBlock"),top:Ge.spaceT("top"),insetBlockStart:Ge.spaceT("insetBlockStart"),bottom:Ge.spaceT("bottom"),insetBlockEnd:Ge.spaceT("insetBlockEnd"),left:Ge.spaceT("left"),insetInlineStart:Ge.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ge.spaceT("right"),insetInlineEnd:Ge.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Jw,{insetStart:Jw.insetInlineStart,insetEnd:Jw.insetInlineEnd});const IU={boxShadow:Ge.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ge.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ge.prop("backgroundBlendMode"),opacity:!0};Object.assign(IU,{shadow:IU.boxShadow});const es={margin:Ge.spaceT("margin"),marginTop:Ge.spaceT("marginTop"),marginBlockStart:Ge.spaceT("marginBlockStart"),marginRight:Ge.spaceT("marginRight"),marginInlineEnd:Ge.spaceT("marginInlineEnd"),marginBottom:Ge.spaceT("marginBottom"),marginBlockEnd:Ge.spaceT("marginBlockEnd"),marginLeft:Ge.spaceT("marginLeft"),marginInlineStart:Ge.spaceT("marginInlineStart"),marginX:Ge.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ge.spaceT("marginInline"),marginY:Ge.spaceT(["marginTop","marginBottom"]),marginBlock:Ge.spaceT("marginBlock"),padding:Ge.space("padding"),paddingTop:Ge.space("paddingTop"),paddingBlockStart:Ge.space("paddingBlockStart"),paddingRight:Ge.space("paddingRight"),paddingBottom:Ge.space("paddingBottom"),paddingBlockEnd:Ge.space("paddingBlockEnd"),paddingLeft:Ge.space("paddingLeft"),paddingInlineStart:Ge.space("paddingInlineStart"),paddingInlineEnd:Ge.space("paddingInlineEnd"),paddingX:Ge.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ge.space("paddingInline"),paddingY:Ge.space(["paddingTop","paddingBottom"]),paddingBlock:Ge.space("paddingBlock")};Object.assign(es,{m:es.margin,mt:es.marginTop,mr:es.marginRight,me:es.marginInlineEnd,marginEnd:es.marginInlineEnd,mb:es.marginBottom,ml:es.marginLeft,ms:es.marginInlineStart,marginStart:es.marginInlineStart,mx:es.marginX,my:es.marginY,p:es.padding,pt:es.paddingTop,py:es.paddingY,px:es.paddingX,pb:es.paddingBottom,pl:es.paddingLeft,ps:es.paddingInlineStart,paddingStart:es.paddingInlineStart,pr:es.paddingRight,pe:es.paddingInlineEnd,paddingEnd:es.paddingInlineEnd});const Lve={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ge.spaceT("scrollMargin"),scrollMarginTop:Ge.spaceT("scrollMarginTop"),scrollMarginBottom:Ge.spaceT("scrollMarginBottom"),scrollMarginLeft:Ge.spaceT("scrollMarginLeft"),scrollMarginRight:Ge.spaceT("scrollMarginRight"),scrollMarginX:Ge.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ge.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ge.spaceT("scrollPadding"),scrollPaddingTop:Ge.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ge.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ge.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ge.spaceT("scrollPaddingRight"),scrollPaddingX:Ge.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ge.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},Mve={fontFamily:Ge.prop("fontFamily","fonts"),fontSize:Ge.prop("fontSize","fontSizes",jr.px),fontWeight:Ge.prop("fontWeight","fontWeights"),lineHeight:Ge.prop("lineHeight","lineHeights"),letterSpacing:Ge.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},Uve={textDecorationColor:Ge.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ge.shadows("textShadow")},Vve={clipPath:!0,transform:Ge.propT("transform",jr.transform),transformOrigin:!0,translateX:Ge.spaceT("--chakra-translate-x"),translateY:Ge.spaceT("--chakra-translate-y"),skewX:Ge.degreeT("--chakra-skew-x"),skewY:Ge.degreeT("--chakra-skew-y"),scaleX:Ge.prop("--chakra-scale-x"),scaleY:Ge.prop("--chakra-scale-y"),scale:Ge.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ge.degreeT("--chakra-rotate")},Fve={listStyleType:!0,listStylePosition:!0,listStylePos:Ge.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ge.prop("listStyleImage")},jve={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ge.prop("transitionDuration","transition.duration"),transitionProperty:Ge.prop("transitionProperty","transition.property"),transitionTimingFunction:Ge.prop("transitionTimingFunction","transition.easing")},dF=lp({},WO,ri,Cve,Rk,qu,Rve,Ive,Ave,mZ,xve,Jw,IU,es,Lve,Mve,Uve,Vve,Fve,jve),Bve=Object.assign({},es,qu,Rk,mZ,Jw),zve=Object.keys(Bve),Wve=[...Object.keys(dF),...pZ],Gve={...dF,...YS},Hve=n=>n in Gve,$ve=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:a,media:l}=e.__breakpoints,u={};for(const f in n){let _=Sl(n[f],e);if(_==null)continue;if(_=Xu(_)&&i(_)?a(_):_,!Array.isArray(_)){u[f]=_;continue}const E=_.slice(0,l.length).length;for(let b=0;b<E;b+=1){const C=l==null?void 0:l[b];if(!C){u[f]=_[b];continue}u[C]=u[C]||{},_[b]!=null&&(u[C][f]=_[b])}}return u};function Kve(n){const e=[];let i="",a=!1;for(let l=0;l<n.length;l++){const u=n[l];u==="("?(a=!0,i+=u):u===")"?(a=!1,i+=u):u===","&&!a?(e.push(i),i=""):i+=u}return i=i.trim(),i&&e.push(i),e}function qve(n){return/^var\(--.+\)$/.test(n)}const Yve=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!qve(e),Xve=(n,e)=>{if(e==null)return e;const i=f=>{var _,E;return(E=(_=n.__cssMap)==null?void 0:_[f])==null?void 0:E.varRef},a=f=>i(f)??f,[l,u]=Kve(e);return e=i(l)??a(u)??a(e),e};function Jve(n){const{configs:e={},pseudos:i={},theme:a}=n,l=(u,f=!1)=>{var C;const _=Sl(u,a),E=$ve(_)(a);let b={};for(let I in E){const O=E[I];let L=Sl(O,a);I in i&&(I=i[I]),Yve(I,L)&&(L=Xve(a,L));let M=e[I];if(M===!0&&(M={property:I}),Xu(L)){b[I]=b[I]??{},b[I]=lp({},b[I],l(L,!0));continue}let F=((C=M==null?void 0:M.transform)==null?void 0:C.call(M,L,a,_))??L;F=M!=null&&M.processResult?l(F,!0):F;const z=Sl(M==null?void 0:M.property,a);if(!f&&(M!=null&&M.static)){const X=Sl(M.static,a);b=lp({},b,X)}if(z&&Array.isArray(z)){for(const X of z)b[X]=F;continue}if(z){z==="&"&&Xu(F)?b=lp({},b,F):b[z]=F;continue}if(Xu(F)){b=lp({},b,F);continue}b[I]=F}return b};return l}const gZ=n=>e=>Jve({theme:e,pseudos:YS,configs:dF})(n);function lGe(n){return n}function uGe(n){return n}function Hi(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function Qve(n,e,i){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${e}.${i}`])==null?void 0:l.varRef)??i}function Zve(n,e){if(Array.isArray(n))return n;if(Xu(n))return e(n);if(n!=null)return[n]}function eSe(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function tSe(n){const e=n.__breakpoints;return function(a,l,u,f){var O,L;if(!e)return;const _={},E=Zve(u,e.toArrayValue);if(!E)return _;const b=E.length,C=b===1,I=!!a.parts;for(let M=0;M<b;M++){const F=e.details[M],z=e.details[eSe(E,M)],X=kw(F.minW,z==null?void 0:z._minW),K=Sl((O=a[l])==null?void 0:O[E[M]],f);if(K){if(I){(L=a.parts)==null||L.forEach(ne=>{lp(_,{[ne]:C?K[ne]:{[X]:K[ne]}})});continue}if(!I){C?lp(_,K):_[X]=K;continue}_[X]=K}}return _}}function nSe(n){return e=>{const{variant:i,size:a,theme:l}=e,u=tSe(l);return lp({},Sl(n.baseStyle??{},e),u(n,"sizes",a,e),u(n,"variants",i,e))}}function Bi(n){return M0(n,["styleConfig","size","variant","colorScheme"])}function _Z(n){return Xu(n)&&n.reference?n.reference:String(n)}const yN=(n,...e)=>e.map(_Z).join(` ${n} `).replace(/calc/g,""),bK=(...n)=>`calc(${yN("+",...n)})`,TK=(...n)=>`calc(${yN("-",...n)})`,AU=(...n)=>`calc(${yN("*",...n)})`,wK=(...n)=>`calc(${yN("/",...n)})`,CK=n=>{const e=_Z(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:AU(e,-1)},Rf=Object.assign(n=>({add:(...e)=>Rf(bK(n,...e)),subtract:(...e)=>Rf(TK(n,...e)),multiply:(...e)=>Rf(AU(n,...e)),divide:(...e)=>Rf(wK(n,...e)),negate:()=>Rf(CK(n)),toString:()=>n.toString()}),{add:bK,subtract:TK,multiply:AU,divide:wK,negate:CK});function rSe(n,e="-"){return n.replace(/\s+/g,e)}function iSe(n){const e=rSe(n.toString());return oSe(sSe(e))}function sSe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function oSe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function aSe(n,e=""){return[e,n].filter(Boolean).join("-")}function cSe(n,e){return`var(${n}${e?`, ${e}`:""})`}function lSe(n,e=""){return iSe(`--${aSe(n,e)}`)}function Vn(n,e,i){const a=lSe(n,i);return{variable:a,reference:cSe(a,e)}}function uSe(n,e){const i={};for(const a of e){if(Array.isArray(a)){const[l,u]=a;i[l]=Vn(`${n}-${l}`,u);continue}i[a]=Vn(`${n}-${a}`)}return i}const dSe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function hSe(n){return ZQ(n,dSe)}function pSe(n){return n.semanticTokens}function fSe(n){const{__cssMap:e,__cssVars:i,__breakpoints:a,...l}=n;return l}function mSe(n){const e=hSe(n),i=pSe(n),a=u=>pZ.includes(u)||u==="default",l={};return hK(e,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!1,value:u})}),hK(i,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!0,value:u})},{stop:u=>Object.keys(u).every(a)}),l}function RK(n,e){return Vn(String(n).replace(/\./g,"-"),void 0,e)}function gSe(n){var f;const e=mSe(n),i=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function u(_,E){const C=[String(_).split(".")[0],E].join(".");if(!e[C])return E;const{reference:O}=RK(C,i);return O}for(const[_,E]of Object.entries(e)){const{isSemantic:b,value:C}=E,{variable:I,reference:O}=RK(_,i);if(!b){if(_.startsWith("space")){const M=_.split("."),[F,...z]=M,X=`${F}.-${z.join(".")}`,K=Rf.negate(C),ne=Rf.negate(O);l[X]={value:K,var:I,varRef:ne}}a[I]=C,l[_]={value:C,var:I,varRef:O};continue}const L=Xu(C)?C:{default:C};a=lp(a,Object.entries(L).reduce((M,[F,z])=>{if(!z)return M;const X=u(_,`${z}`);if(F==="default")return M[I]=X,M;const K=(YS==null?void 0:YS[F])??F;return M[K]={[I]:X},M},{})),l[_]={value:O,var:I,varRef:O}}return{cssVars:a,cssMap:l}}function _Se(n){const e=fSe(n),{cssMap:i,cssVars:a}=gSe(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:i,__breakpoints:cEe(e.breakpoints)}),e}function ci(n,e={}){let i=!1;function a(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){a();for(const I of C)e[I]=E(I);return ci(n,e)}function u(...C){for(const I of C)I in e||(e[I]=E(I));return ci(n,e)}function f(){return Object.fromEntries(Object.entries(e).map(([I,O])=>[I,O.selector]))}function _(){return Object.fromEntries(Object.entries(e).map(([I,O])=>[I,O.className]))}function E(C){const L=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:L,selector:`.${L}`,toString:()=>C}}return{parts:l,toPart:E,extend:u,selectors:f,classnames:_,get keys(){return Object.keys(e)},__type:{}}}const ySe=ci("accordion").parts("root","container","button","panel","icon"),ESe=ci("alert").parts("title","description","container","icon","spinner"),vSe=ci("avatar").parts("label","badge","container","excessLabel","group"),SSe=ci("breadcrumb").parts("link","item","container","separator");ci("button").parts();const bSe=ci("checkbox").parts("control","icon","container","label");ci("progress").parts("track","filledTrack","label");const TSe=ci("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),wSe=ci("editable").parts("preview","input","textarea"),CSe=ci("form").parts("container","requiredIndicator","helperText"),RSe=ci("formError").parts("text","icon"),ISe=ci("input").parts("addon","field","element","group"),ASe=ci("list").parts("container","item","icon"),PSe=ci("menu").parts("button","list","item","groupTitle","icon","command","divider"),OSe=ci("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),kSe=ci("numberinput").parts("root","field","stepperGroup","stepper");ci("pininput").parts("field");const NSe=ci("popover").parts("content","header","body","footer","popper","arrow","closeButton"),DSe=ci("progress").parts("label","filledTrack","track"),xSe=ci("radio").parts("container","control","label"),LSe=ci("select").parts("field","icon"),MSe=ci("slider").parts("container","track","thumb","filledTrack","mark"),USe=ci("stat").parts("container","label","helpText","number","icon"),VSe=ci("switch").parts("container","track","thumb","label"),FSe=ci("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),jSe=ci("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),BSe=ci("tag").parts("container","label","closeButton"),zSe=ci("card").parts("container","header","body","footer");ci("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:WSe,defineMultiStyleConfig:GSe}=Hi(ySe.keys),HSe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},$Se={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},KSe={pt:"2",px:"4",pb:"5"},qSe={fontSize:"1.25em"},YSe=WSe({container:HSe,button:$Se,panel:KSe,icon:qSe}),XSe=GSe({baseStyle:YSe});function by(n,e,i){return Math.min(Math.max(n,i),e)}class JSe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var Dw=JSe;function hF(n){if(typeof n!="string")throw new Dw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=s0e.test(n)?e0e(n):n;const i=t0e.exec(e);if(i){const f=Array.from(i).slice(1);return[...f.slice(0,3).map(_=>parseInt(vC(_,2),16)),parseInt(vC(f[3]||"f",2),16)/255]}const a=n0e.exec(e);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,16)),parseInt(f[3]||"ff",16)/255]}const l=r0e.exec(e);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,10)),parseFloat(f[3]||"1")]}const u=i0e.exec(e);if(u){const[f,_,E,b]=Array.from(u).slice(1).map(parseFloat);if(by(0,100,_)!==_)throw new Dw(n);if(by(0,100,E)!==E)throw new Dw(n);return[...o0e(f,_,E),Number.isNaN(b)?1:b]}throw new Dw(n)}function QSe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const IK=n=>parseInt(n.replace(/_/g,""),36),ZSe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=IK(e.substring(0,3)),a=IK(e.substring(3)).toString(16);let l="";for(let u=0;u<6-a.length;u++)l+="0";return n[i]=`${l}${a}`,n},{});function e0e(n){const e=n.toLowerCase().trim(),i=ZSe[QSe(e)];if(!i)throw new Dw(n);return`#${i}`}const vC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),t0e=new RegExp(`^#${vC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),n0e=new RegExp(`^#${vC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),r0e=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${vC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),i0e=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,s0e=/^[a-z]+$/i,AK=n=>Math.round(n*255),o0e=(n,e,i)=>{let a=i/100;if(e===0)return[a,a,a].map(AK);const l=(n%360+360)%360/60,u=(1-Math.abs(2*a-1))*(e/100),f=u*(1-Math.abs(l%2-1));let _=0,E=0,b=0;l>=0&&l<1?(_=u,E=f):l>=1&&l<2?(_=f,E=u):l>=2&&l<3?(E=u,b=f):l>=3&&l<4?(E=f,b=u):l>=4&&l<5?(_=f,b=u):l>=5&&l<6&&(_=u,b=f);const C=a-u/2,I=_+C,O=E+C,L=b+C;return[I,O,L].map(AK)};function a0e(n,e,i,a){return`rgba(${by(0,255,n).toFixed()}, ${by(0,255,e).toFixed()}, ${by(0,255,i).toFixed()}, ${parseFloat(by(0,1,a).toFixed(3))})`}function c0e(n,e){const[i,a,l,u]=hF(n);return a0e(i,a,l,u-e)}function l0e(n){const[e,i,a,l]=hF(n);let u=f=>{const _=by(0,255,f).toString(16);return _.length===1?`0${_}`:_};return`#${u(e)}${u(i)}${u(a)}${l<1?u(Math.round(l*255)):""}`}const u0e=n=>Object.keys(n).length===0;function d0e(n,e,i,a,l){for(e=e.split?e.split("."):e,a=0;a<e.length;a++)n=n?n[e[a]]:l;return n===l?i:n}const Dc=(n,e,i)=>{const a=d0e(n,`colors.${e}`,e);try{return l0e(a),a}catch{return i??"#000000"}},h0e=n=>{const[e,i,a]=hF(n);return(e*299+i*587+a*114)/1e3},p0e=n=>e=>{const i=Dc(e,n);return h0e(i)<128?"dark":"light"},f0e=n=>e=>p0e(n)(e)==="dark",d0=(n,e)=>i=>{const a=Dc(i,n);return c0e(a,1-e)};function PK(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const m0e=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function g0e(n){const e=m0e();return!n||u0e(n)?e:n.string&&n.colors?y0e(n.string,n.colors):n.string&&!n.colors?_0e(n.string):n.colors&&!n.string?E0e(n.colors):e}function _0e(n){let e=0;if(n.length===0)return e.toString();for(let a=0;a<n.length;a+=1)e=n.charCodeAt(a)+((e<<5)-e),e=e&e;let i="#";for(let a=0;a<3;a+=1){const l=e>>a*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function y0e(n,e){let i=0;if(n.length===0)return e[0];for(let a=0;a<n.length;a+=1)i=n.charCodeAt(a)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function E0e(n){return n[Math.floor(Math.random()*n.length)]}function Un(n,e){return i=>i.colorMode==="dark"?e:n}function pF(n){const{orientation:e,vertical:i,horizontal:a}=n;return e?e==="vertical"?i:a:{}}function yZ(n){return Xu(n)&&n.reference?n.reference:String(n)}const EN=(n,...e)=>e.map(yZ).join(` ${n} `).replace(/calc/g,""),OK=(...n)=>`calc(${EN("+",...n)})`,kK=(...n)=>`calc(${EN("-",...n)})`,PU=(...n)=>`calc(${EN("*",...n)})`,NK=(...n)=>`calc(${EN("/",...n)})`,DK=n=>{const e=yZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:PU(e,-1)},If=Object.assign(n=>({add:(...e)=>If(OK(n,...e)),subtract:(...e)=>If(kK(n,...e)),multiply:(...e)=>If(PU(n,...e)),divide:(...e)=>If(NK(n,...e)),negate:()=>If(DK(n)),toString:()=>n.toString()}),{add:OK,subtract:kK,multiply:PU,divide:NK,negate:DK});function v0e(n){return!Number.isInteger(parseFloat(n.toString()))}function S0e(n,e="-"){return n.replace(/\s+/g,e)}function EZ(n){const e=S0e(n.toString());return e.includes("\\.")?n:v0e(n)?e.replace(".","\\."):n}function b0e(n,e=""){return[e,EZ(n)].filter(Boolean).join("-")}function T0e(n,e){return`var(${EZ(n)}${e?`, ${e}`:""})`}function w0e(n,e=""){return`--${b0e(n,e)}`}function Vo(n,e){const i=w0e(n,e==null?void 0:e.prefix);return{variable:i,reference:T0e(i,C0e(e==null?void 0:e.fallback))}}function C0e(n){return n==null?void 0:n.reference}const{definePartsStyle:YC,defineMultiStyleConfig:R0e}=Hi(ESe.keys),tu=Vn("alert-fg"),Hf=Vn("alert-bg"),I0e=YC({container:{bg:Hf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:tu.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:tu.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function fF(n){const{theme:e,colorScheme:i}=n,a=d0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:a}}const A0e=YC(n=>{const{colorScheme:e}=n,i=fF(n);return{container:{[tu.variable]:`colors.${e}.600`,[Hf.variable]:i.light,_dark:{[tu.variable]:`colors.${e}.200`,[Hf.variable]:i.dark}}}}),P0e=YC(n=>{const{colorScheme:e}=n,i=fF(n);return{container:{[tu.variable]:`colors.${e}.600`,[Hf.variable]:i.light,_dark:{[tu.variable]:`colors.${e}.200`,[Hf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:tu.reference}}}),O0e=YC(n=>{const{colorScheme:e}=n,i=fF(n);return{container:{[tu.variable]:`colors.${e}.600`,[Hf.variable]:i.light,_dark:{[tu.variable]:`colors.${e}.200`,[Hf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:tu.reference}}}),k0e=YC(n=>{const{colorScheme:e}=n;return{container:{[tu.variable]:"colors.white",[Hf.variable]:`colors.${e}.600`,_dark:{[tu.variable]:"colors.gray.900",[Hf.variable]:`colors.${e}.200`},color:tu.reference}}}),N0e={subtle:A0e,"left-accent":P0e,"top-accent":O0e,solid:k0e},D0e=R0e({baseStyle:I0e,variants:N0e,defaultProps:{variant:"subtle",colorScheme:"blue"}}),vZ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},x0e={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},L0e={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},SZ={...vZ,...x0e,container:L0e},M0e=n=>typeof n=="function";function xc(n,...e){return M0e(n)?n(...e):n}const{definePartsStyle:bZ,defineMultiStyleConfig:U0e}=Hi(vSe.keys),XS=Vn("avatar-border-color"),Qw=Vn("avatar-bg"),SC=Vn("avatar-font-size"),h0=Vn("avatar-size"),V0e={borderRadius:"full",border:"0.2em solid",borderColor:XS.reference,[XS.variable]:"white",_dark:{[XS.variable]:"colors.gray.800"}},F0e={bg:Qw.reference,fontSize:SC.reference,width:h0.reference,height:h0.reference,lineHeight:"1",[Qw.variable]:"colors.gray.200",_dark:{[Qw.variable]:"colors.whiteAlpha.400"}},j0e=n=>{const{name:e,theme:i}=n,a=e?g0e({string:e}):"colors.gray.400",l=f0e(a)(i);let u="white";return l||(u="gray.800"),{bg:Qw.reference,fontSize:SC.reference,color:u,borderColor:XS.reference,verticalAlign:"top",width:h0.reference,height:h0.reference,"&:not([data-loaded])":{[Qw.variable]:a},[XS.variable]:"colors.white",_dark:{[XS.variable]:"colors.gray.800"}}},B0e={fontSize:SC.reference,lineHeight:"1"},z0e=bZ(n=>({badge:xc(V0e,n),excessLabel:xc(F0e,n),container:xc(j0e,n),label:B0e}));function ug(n){const e=n!=="100%"?SZ[n]:void 0;return bZ({container:{[h0.variable]:e??n,[SC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[h0.variable]:e??n,[SC.variable]:`calc(${e??n} / 2.5)`}})}const W0e={"2xs":ug(4),xs:ug(6),sm:ug(8),md:ug(12),lg:ug(16),xl:ug(24),"2xl":ug(32),full:ug("100%")},G0e=U0e({baseStyle:z0e,sizes:W0e,defaultProps:{size:"md"}}),to=uSe("badge",["bg","color","shadow"]),H0e={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:to.bg.reference,color:to.color.reference,boxShadow:to.shadow.reference},$0e=n=>{const{colorScheme:e,theme:i}=n,a=d0(`${e}.500`,.6)(i);return{[to.bg.variable]:`colors.${e}.500`,[to.color.variable]:"colors.white",_dark:{[to.bg.variable]:a,[to.color.variable]:"colors.whiteAlpha.800"}}},K0e=n=>{const{colorScheme:e,theme:i}=n,a=d0(`${e}.200`,.16)(i);return{[to.bg.variable]:`colors.${e}.100`,[to.color.variable]:`colors.${e}.800`,_dark:{[to.bg.variable]:a,[to.color.variable]:`colors.${e}.200`}}},q0e=n=>{const{colorScheme:e,theme:i}=n,a=d0(`${e}.200`,.8)(i);return{[to.color.variable]:`colors.${e}.500`,_dark:{[to.color.variable]:a},[to.shadow.variable]:`inset 0 0 0px 1px ${to.color.reference}`}},Y0e={solid:$0e,subtle:K0e,outline:q0e},Zw={baseStyle:H0e,variants:Y0e,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:X0e,definePartsStyle:J0e}=Hi(SSe.keys),sM=Vn("breadcrumb-link-decor"),Q0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:sM.reference,[sM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[sM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},Z0e=J0e({link:Q0e}),ebe=X0e({baseStyle:Z0e}),tbe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},TZ=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Un("gray.800","whiteAlpha.900")(n),_hover:{bg:Un("gray.100","whiteAlpha.200")(n)},_active:{bg:Un("gray.200","whiteAlpha.300")(n)}};const a=d0(`${e}.200`,.12)(i),l=d0(`${e}.200`,.24)(i);return{color:Un(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Un(`${e}.50`,a)(n)},_active:{bg:Un(`${e}.100`,l)(n)}}},nbe=n=>{const{colorScheme:e}=n,i=Un("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...xc(TZ,n)}},rbe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},ibe=n=>{const{colorScheme:e}=n;if(e==="gray"){const _=Un("gray.100","whiteAlpha.200")(n);return{bg:_,color:Un("gray.800","whiteAlpha.900")(n),_hover:{bg:Un("gray.200","whiteAlpha.300")(n),_disabled:{bg:_}},_active:{bg:Un("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:a="white",hoverBg:l=`${e}.600`,activeBg:u=`${e}.700`}=rbe[e]??{},f=Un(i,`${e}.200`)(n);return{bg:f,color:Un(a,"gray.800")(n),_hover:{bg:Un(l,`${e}.300`)(n),_disabled:{bg:f}},_active:{bg:Un(u,`${e}.400`)(n)}}},sbe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Un(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Un(`${e}.700`,`${e}.500`)(n)}}},obe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},abe={ghost:TZ,outline:nbe,solid:ibe,link:sbe,unstyled:obe},cbe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},lbe={baseStyle:tbe,variants:abe,sizes:cbe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Ay,defineMultiStyleConfig:ube}=Hi(zSe.keys),Ik=Vn("card-bg"),Lf=Vn("card-padding"),wZ=Vn("card-shadow"),GO=Vn("card-radius"),CZ=Vn("card-border-width","0"),RZ=Vn("card-border-color"),dbe=Ay({container:{[Ik.variable]:"colors.chakra-body-bg",backgroundColor:Ik.reference,boxShadow:wZ.reference,borderRadius:GO.reference,color:"chakra-body-text",borderWidth:CZ.reference,borderColor:RZ.reference},body:{padding:Lf.reference,flex:"1 1 0%"},header:{padding:Lf.reference},footer:{padding:Lf.reference}}),hbe={sm:Ay({container:{[GO.variable]:"radii.base",[Lf.variable]:"space.3"}}),md:Ay({container:{[GO.variable]:"radii.md",[Lf.variable]:"space.5"}}),lg:Ay({container:{[GO.variable]:"radii.xl",[Lf.variable]:"space.7"}})},pbe={elevated:Ay({container:{[wZ.variable]:"shadows.base",_dark:{[Ik.variable]:"colors.gray.700"}}}),outline:Ay({container:{[CZ.variable]:"1px",[RZ.variable]:"colors.chakra-border-color"}}),filled:Ay({container:{[Ik.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Lf.variable]:0},header:{[Lf.variable]:0},footer:{[Lf.variable]:0}}},fbe=ube({baseStyle:dbe,variants:pbe,sizes:hbe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:HO,defineMultiStyleConfig:mbe}=Hi(bSe.keys),eC=Vn("checkbox-size"),gbe=n=>{const{colorScheme:e}=n;return{w:eC.reference,h:eC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Un(`${e}.500`,`${e}.200`)(n),borderColor:Un(`${e}.500`,`${e}.200`)(n),color:Un("white","gray.900")(n),_hover:{bg:Un(`${e}.600`,`${e}.300`)(n),borderColor:Un(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Un("gray.200","transparent")(n),bg:Un("gray.200","whiteAlpha.300")(n),color:Un("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Un(`${e}.500`,`${e}.200`)(n),borderColor:Un(`${e}.500`,`${e}.200`)(n),color:Un("white","gray.900")(n)},_disabled:{bg:Un("gray.100","whiteAlpha.100")(n),borderColor:Un("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Un("red.500","red.300")(n)}}},_be={_disabled:{cursor:"not-allowed"}},ybe={userSelect:"none",_disabled:{opacity:.4}},Ebe={transitionProperty:"transform",transitionDuration:"normal"},vbe=HO(n=>({icon:Ebe,container:_be,control:xc(gbe,n),label:ybe})),Sbe={sm:HO({control:{[eC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:HO({control:{[eC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:HO({control:{[eC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},mg=mbe({baseStyle:vbe,sizes:Sbe,defaultProps:{size:"md",colorScheme:"blue"}}),tC=Vo("close-button-size"),hw=Vo("close-button-bg"),bbe={w:[tC.reference],h:[tC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[hw.variable]:"colors.blackAlpha.100",_dark:{[hw.variable]:"colors.whiteAlpha.100"}},_active:{[hw.variable]:"colors.blackAlpha.200",_dark:{[hw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:hw.reference},Tbe={lg:{[tC.variable]:"sizes.10",fontSize:"md"},md:{[tC.variable]:"sizes.8",fontSize:"xs"},sm:{[tC.variable]:"sizes.6",fontSize:"2xs"}},wbe={baseStyle:bbe,sizes:Tbe,defaultProps:{size:"md"}},{variants:Cbe,defaultProps:Rbe}=Zw,Ibe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:to.bg.reference,color:to.color.reference,boxShadow:to.shadow.reference},Abe={baseStyle:Ibe,variants:Cbe,defaultProps:Rbe},Pbe={w:"100%",mx:"auto",maxW:"prose",px:"4"},Obe={baseStyle:Pbe},kbe={opacity:.6,borderColor:"inherit"},Nbe={borderStyle:"solid"},Dbe={borderStyle:"dashed"},xbe={solid:Nbe,dashed:Dbe},Lbe={baseStyle:kbe,variants:xbe,defaultProps:{variant:"solid"}},{definePartsStyle:OU,defineMultiStyleConfig:Mbe}=Hi(TSe.keys),oM=Vn("drawer-bg"),aM=Vn("drawer-box-shadow");function bS(n){return OU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const Ube={bg:"blackAlpha.600",zIndex:"modal"},Vbe={display:"flex",zIndex:"modal",justifyContent:"center"},Fbe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[oM.variable]:"colors.white",[aM.variable]:"shadows.lg",_dark:{[oM.variable]:"colors.gray.700",[aM.variable]:"shadows.dark-lg"},bg:oM.reference,boxShadow:aM.reference}},jbe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Bbe={position:"absolute",top:"2",insetEnd:"3"},zbe={px:"6",py:"2",flex:"1",overflow:"auto"},Wbe={px:"6",py:"4"},Gbe=OU(n=>({overlay:Ube,dialogContainer:Vbe,dialog:xc(Fbe,n),header:jbe,closeButton:Bbe,body:zbe,footer:Wbe})),Hbe={xs:bS("xs"),sm:bS("md"),md:bS("lg"),lg:bS("2xl"),xl:bS("4xl"),full:bS("full")},$be=Mbe({baseStyle:Gbe,sizes:Hbe,defaultProps:{size:"xs"}}),{definePartsStyle:Kbe,defineMultiStyleConfig:qbe}=Hi(wSe.keys),Ybe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Xbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Jbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Qbe=Kbe({preview:Ybe,input:Xbe,textarea:Jbe}),Zbe=qbe({baseStyle:Qbe}),{definePartsStyle:eTe,defineMultiStyleConfig:tTe}=Hi(CSe.keys),JS=Vn("form-control-color"),nTe={marginStart:"1",[JS.variable]:"colors.red.500",_dark:{[JS.variable]:"colors.red.300"},color:JS.reference},rTe={mt:"2",[JS.variable]:"colors.gray.600",_dark:{[JS.variable]:"colors.whiteAlpha.600"},color:JS.reference,lineHeight:"normal",fontSize:"sm"},iTe=eTe({container:{width:"100%",position:"relative"},requiredIndicator:nTe,helperText:rTe}),sTe=tTe({baseStyle:iTe}),{definePartsStyle:oTe,defineMultiStyleConfig:aTe}=Hi(RSe.keys),QS=Vn("form-error-color"),cTe={[QS.variable]:"colors.red.500",_dark:{[QS.variable]:"colors.red.300"},color:QS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},lTe={marginEnd:"0.5em",[QS.variable]:"colors.red.500",_dark:{[QS.variable]:"colors.red.300"},color:QS.reference},uTe=oTe({text:cTe,icon:lTe}),dTe=aTe({baseStyle:uTe}),hTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},pTe={baseStyle:hTe},fTe={fontFamily:"heading",fontWeight:"bold"},mTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},gTe={baseStyle:fTe,sizes:mTe,defaultProps:{size:"xl"}},{definePartsStyle:Pf,defineMultiStyleConfig:_Te}=Hi(ISe.keys),LS=Vn("input-height"),MS=Vn("input-font-size"),US=Vn("input-padding"),VS=Vn("input-border-radius"),yTe=Pf({addon:{height:LS.reference,fontSize:MS.reference,px:US.reference,borderRadius:VS.reference},field:{width:"100%",height:LS.reference,fontSize:MS.reference,px:US.reference,borderRadius:VS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),dg={lg:{[MS.variable]:"fontSizes.lg",[US.variable]:"space.4",[VS.variable]:"radii.md",[LS.variable]:"sizes.12"},md:{[MS.variable]:"fontSizes.md",[US.variable]:"space.4",[VS.variable]:"radii.md",[LS.variable]:"sizes.10"},sm:{[MS.variable]:"fontSizes.sm",[US.variable]:"space.3",[VS.variable]:"radii.sm",[LS.variable]:"sizes.8"},xs:{[MS.variable]:"fontSizes.xs",[US.variable]:"space.2",[VS.variable]:"radii.sm",[LS.variable]:"sizes.6"}},ETe={lg:Pf({field:dg.lg,group:dg.lg}),md:Pf({field:dg.md,group:dg.md}),sm:Pf({field:dg.sm,group:dg.sm}),xs:Pf({field:dg.xs,group:dg.xs})};function mF(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Un("blue.500","blue.300")(n),errorBorderColor:i||Un("red.500","red.300")(n)}}const vTe=Pf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=mF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Un("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Dc(e,a),boxShadow:`0 0 0 1px ${Dc(e,a)}`},_focusVisible:{zIndex:1,borderColor:Dc(e,i),boxShadow:`0 0 0 1px ${Dc(e,i)}`}},addon:{border:"1px solid",borderColor:Un("inherit","whiteAlpha.50")(n),bg:Un("gray.100","whiteAlpha.300")(n)}}}),STe=Pf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=mF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Un("gray.100","whiteAlpha.50")(n),_hover:{bg:Un("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Dc(e,a)},_focusVisible:{bg:"transparent",borderColor:Dc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Un("gray.100","whiteAlpha.50")(n)}}}),bTe=Pf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=mF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Dc(e,a),boxShadow:`0px 1px 0px 0px ${Dc(e,a)}`},_focusVisible:{borderColor:Dc(e,i),boxShadow:`0px 1px 0px 0px ${Dc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),TTe=Pf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),wTe={outline:vTe,filled:STe,flushed:bTe,unstyled:TTe},oi=_Te({baseStyle:yTe,sizes:ETe,variants:wTe,defaultProps:{size:"md",variant:"outline"}}),cM=Vn("kbd-bg"),CTe={[cM.variable]:"colors.gray.100",_dark:{[cM.variable]:"colors.whiteAlpha.100"},bg:cM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},RTe={baseStyle:CTe},ITe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},ATe={baseStyle:ITe},{defineMultiStyleConfig:PTe,definePartsStyle:OTe}=Hi(ASe.keys),kTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},NTe=OTe({icon:kTe}),DTe=PTe({baseStyle:NTe}),{defineMultiStyleConfig:xTe,definePartsStyle:LTe}=Hi(PSe.keys),ep=Vn("menu-bg"),lM=Vn("menu-shadow"),MTe={[ep.variable]:"#fff",[lM.variable]:"shadows.sm",_dark:{[ep.variable]:"colors.gray.700",[lM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:ep.reference,boxShadow:lM.reference},UTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[ep.variable]:"colors.gray.100",_dark:{[ep.variable]:"colors.whiteAlpha.100"}},_active:{[ep.variable]:"colors.gray.200",_dark:{[ep.variable]:"colors.whiteAlpha.200"}},_expanded:{[ep.variable]:"colors.gray.100",_dark:{[ep.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:ep.reference},VTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},FTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},jTe={opacity:.6},BTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},zTe={transitionProperty:"common",transitionDuration:"normal"},WTe=LTe({button:zTe,list:MTe,item:UTe,groupTitle:VTe,icon:FTe,command:jTe,divider:BTe}),GTe=xTe({baseStyle:WTe}),{defineMultiStyleConfig:HTe,definePartsStyle:kU}=Hi(OSe.keys),uM=Vn("modal-bg"),dM=Vn("modal-shadow"),$Te={bg:"blackAlpha.600",zIndex:"modal"},KTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},qTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[uM.variable]:"colors.white",[dM.variable]:"shadows.lg",_dark:{[uM.variable]:"colors.gray.700",[dM.variable]:"shadows.dark-lg"},bg:uM.reference,boxShadow:dM.reference}},YTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},XTe={position:"absolute",top:"2",insetEnd:"3"},JTe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},QTe={px:"6",py:"4"},ZTe=kU(n=>({overlay:$Te,dialogContainer:xc(KTe,n),dialog:xc(qTe,n),header:YTe,closeButton:XTe,body:xc(JTe,n),footer:QTe}));function Hd(n){return kU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const ewe={xs:Hd("xs"),sm:Hd("sm"),md:Hd("md"),lg:Hd("lg"),xl:Hd("xl"),"2xl":Hd("2xl"),"3xl":Hd("3xl"),"4xl":Hd("4xl"),"5xl":Hd("5xl"),"6xl":Hd("6xl"),full:Hd("full")},twe=HTe({baseStyle:ZTe,sizes:ewe,defaultProps:{size:"md"}}),IZ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:nwe,definePartsStyle:AZ}=Hi(kSe.keys),gF=Vo("number-input-stepper-width"),PZ=Vo("number-input-input-padding"),rwe=If(gF).add("0.5rem").toString(),hM=Vo("number-input-bg"),pM=Vo("number-input-color"),fM=Vo("number-input-border-color"),iwe={[gF.variable]:"sizes.6",[PZ.variable]:rwe},swe=n=>{var e;return((e=xc(oi.baseStyle,n))==null?void 0:e.field)??{}},owe={width:gF.reference},awe={borderStart:"1px solid",borderStartColor:fM.reference,color:pM.reference,bg:hM.reference,[pM.variable]:"colors.chakra-body-text",[fM.variable]:"colors.chakra-border-color",_dark:{[pM.variable]:"colors.whiteAlpha.800",[fM.variable]:"colors.whiteAlpha.300"},_active:{[hM.variable]:"colors.gray.200",_dark:{[hM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},cwe=AZ(n=>({root:iwe,field:xc(swe,n)??{},stepperGroup:owe,stepper:awe}));function dO(n){var u,f;const e=(u=oi.sizes)==null?void 0:u[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=e.field)==null?void 0:f.fontSize)??"md",l=IZ.fontSizes[a];return AZ({field:{...e.field,paddingInlineEnd:PZ.reference,verticalAlign:"top"},stepper:{fontSize:If(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const lwe={xs:dO("xs"),sm:dO("sm"),md:dO("md"),lg:dO("lg")},uwe=nwe({baseStyle:cwe,sizes:lwe,variants:oi.variants,defaultProps:oi.defaultProps});var RQ;const dwe={...(RQ=oi.baseStyle)==null?void 0:RQ.field,textAlign:"center"},hwe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var IQ;const pwe={outline:n=>{var e,i;return((i=xc((e=oi.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=xc((e=oi.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=xc((e=oi.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((IQ=oi.variants)==null?void 0:IQ.unstyled.field)??{}},fwe={baseStyle:dwe,sizes:hwe,variants:pwe,defaultProps:oi.defaultProps},{defineMultiStyleConfig:mwe,definePartsStyle:gwe}=Hi(NSe.keys),hO=Vo("popper-bg"),_we=Vo("popper-arrow-bg"),xK=Vo("popper-arrow-shadow-color"),ywe={zIndex:"popover"},Ewe={[hO.variable]:"colors.white",bg:hO.reference,[_we.variable]:hO.reference,[xK.variable]:"colors.gray.200",_dark:{[hO.variable]:"colors.gray.700",[xK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},vwe={px:3,py:2,borderBottomWidth:"1px"},Swe={px:3,py:2},bwe={px:3,py:2,borderTopWidth:"1px"},Twe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},wwe=gwe({popper:ywe,content:Ewe,header:vwe,body:Swe,footer:bwe,closeButton:Twe}),Cwe=mwe({baseStyle:wwe}),{defineMultiStyleConfig:Rwe,definePartsStyle:xw}=Hi(DSe.keys),Iwe=n=>{const{colorScheme:e,theme:i,isIndeterminate:a,hasStripe:l}=n,u=Un(PK(),PK("1rem","rgba(0,0,0,0.1)"))(n),f=Un(`${e}.500`,`${e}.200`)(n),_=`linear-gradient(
    to right,
    transparent 0%,
    ${Dc(i,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&u,...a?{bgImage:_}:{bgColor:f}}},Awe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},Pwe=n=>({bg:Un("gray.100","whiteAlpha.300")(n)}),Owe=n=>({transitionProperty:"common",transitionDuration:"slow",...Iwe(n)}),kwe=xw(n=>({label:Awe,filledTrack:Owe(n),track:Pwe(n)})),Nwe={xs:xw({track:{h:"1"}}),sm:xw({track:{h:"2"}}),md:xw({track:{h:"3"}}),lg:xw({track:{h:"4"}})},Dwe=Rwe({sizes:Nwe,baseStyle:kwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:xwe,definePartsStyle:$O}=Hi(xSe.keys),Lwe=n=>{var i;const e=(i=xc(mg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},Mwe=$O(n=>{var e,i;return{label:(e=mg.baseStyle)==null?void 0:e.call(mg,n).label,container:(i=mg.baseStyle)==null?void 0:i.call(mg,n).container,control:Lwe(n)}}),Uwe={md:$O({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:$O({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:$O({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},Vwe=xwe({baseStyle:Mwe,sizes:Uwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Fwe,definePartsStyle:jwe}=Hi(LSe.keys),pO=Vn("select-bg");var AQ;const Bwe={...(AQ=oi.baseStyle)==null?void 0:AQ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:pO.reference,[pO.variable]:"colors.white",_dark:{[pO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:pO.reference}},zwe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},Wwe=jwe({field:Bwe,icon:zwe}),fO={paddingInlineEnd:"8"};var PQ,OQ,kQ,NQ,DQ,xQ,LQ,MQ;const Gwe={lg:{...(PQ=oi.sizes)==null?void 0:PQ.lg,field:{...(OQ=oi.sizes)==null?void 0:OQ.lg.field,...fO}},md:{...(kQ=oi.sizes)==null?void 0:kQ.md,field:{...(NQ=oi.sizes)==null?void 0:NQ.md.field,...fO}},sm:{...(DQ=oi.sizes)==null?void 0:DQ.sm,field:{...(xQ=oi.sizes)==null?void 0:xQ.sm.field,...fO}},xs:{...(LQ=oi.sizes)==null?void 0:LQ.xs,field:{...(MQ=oi.sizes)==null?void 0:MQ.xs.field,...fO},icon:{insetEnd:"1"}}},Hwe=Fwe({baseStyle:Wwe,sizes:Gwe,variants:oi.variants,defaultProps:oi.defaultProps}),mM=Vn("skeleton-start-color"),gM=Vn("skeleton-end-color"),$we={[mM.variable]:"colors.gray.100",[gM.variable]:"colors.gray.400",_dark:{[mM.variable]:"colors.gray.800",[gM.variable]:"colors.gray.600"},background:mM.reference,borderColor:gM.reference,opacity:.7,borderRadius:"sm"},Kwe={baseStyle:$we},_M=Vn("skip-link-bg"),qwe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[_M.variable]:"colors.white",_dark:{[_M.variable]:"colors.gray.700"},bg:_M.reference}},Ywe={baseStyle:qwe},{defineMultiStyleConfig:Xwe,definePartsStyle:vN}=Hi(MSe.keys),jy=Vn("slider-thumb-size"),bC=Vn("slider-track-size"),gg=Vn("slider-bg"),Jwe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...pF({orientation:e,vertical:{h:"100%",px:Rf(jy.reference).divide(2).toString()},horizontal:{w:"100%",py:Rf(jy.reference).divide(2).toString()}})}},Qwe=n=>({...pF({orientation:n.orientation,horizontal:{h:bC.reference},vertical:{w:bC.reference}}),overflow:"hidden",borderRadius:"sm",[gg.variable]:"colors.gray.200",_dark:{[gg.variable]:"colors.whiteAlpha.200"},_disabled:{[gg.variable]:"colors.gray.300",_dark:{[gg.variable]:"colors.whiteAlpha.300"}},bg:gg.reference}),Zwe=n=>{const{orientation:e}=n;return{...pF({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:jy.reference,h:jy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},eCe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[gg.variable]:`colors.${e}.500`,_dark:{[gg.variable]:`colors.${e}.200`},bg:gg.reference}},tCe=vN(n=>({container:Jwe(n),track:Qwe(n),thumb:Zwe(n),filledTrack:eCe(n)})),nCe=vN({container:{[jy.variable]:"sizes.4",[bC.variable]:"sizes.1"}}),rCe=vN({container:{[jy.variable]:"sizes.3.5",[bC.variable]:"sizes.1"}}),iCe=vN({container:{[jy.variable]:"sizes.2.5",[bC.variable]:"sizes.0.5"}}),sCe={lg:nCe,md:rCe,sm:iCe},oCe=Xwe({baseStyle:tCe,sizes:sCe,defaultProps:{size:"md",colorScheme:"blue"}}),vy=Vo("spinner-size"),aCe={width:[vy.reference],height:[vy.reference]},cCe={xs:{[vy.variable]:"sizes.3"},sm:{[vy.variable]:"sizes.4"},md:{[vy.variable]:"sizes.6"},lg:{[vy.variable]:"sizes.8"},xl:{[vy.variable]:"sizes.12"}},lCe={baseStyle:aCe,sizes:cCe,defaultProps:{size:"md"}},{defineMultiStyleConfig:uCe,definePartsStyle:OZ}=Hi(USe.keys),dCe={fontWeight:"medium"},hCe={opacity:.8,marginBottom:"2"},pCe={verticalAlign:"baseline",fontWeight:"semibold"},fCe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},mCe=OZ({container:{},label:dCe,helpText:hCe,number:pCe,icon:fCe}),gCe={md:OZ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},_Ce=uCe({baseStyle:mCe,sizes:gCe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:yCe,definePartsStyle:Lw}=Hi(["stepper","step","title","description","indicator","separator","icon","number"]),Af=Vn("stepper-indicator-size"),FS=Vn("stepper-icon-size"),jS=Vn("stepper-title-font-size"),Mw=Vn("stepper-description-font-size"),pw=Vn("stepper-accent-color"),ECe=Lw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[pw.variable]:`colors.${n}.500`,_dark:{[pw.variable]:`colors.${n}.200`}},title:{fontSize:jS.reference,fontWeight:"medium"},description:{fontSize:Mw.reference,color:"chakra-subtle-text"},number:{fontSize:jS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:FS.reference,height:FS.reference},indicator:{flexShrink:0,borderRadius:"full",width:Af.reference,height:Af.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:pw.reference},"&[data-status=complete]":{bg:pw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:pw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Af.reference} - 8px)`,top:`calc(${Af.reference} + 4px)`,insetStart:`calc(${Af.reference} / 2 - 1px)`}}})),vCe=yCe({baseStyle:ECe,sizes:{xs:Lw({stepper:{[Af.variable]:"sizes.4",[FS.variable]:"sizes.3",[jS.variable]:"fontSizes.xs",[Mw.variable]:"fontSizes.xs"}}),sm:Lw({stepper:{[Af.variable]:"sizes.6",[FS.variable]:"sizes.4",[jS.variable]:"fontSizes.sm",[Mw.variable]:"fontSizes.xs"}}),md:Lw({stepper:{[Af.variable]:"sizes.8",[FS.variable]:"sizes.5",[jS.variable]:"fontSizes.md",[Mw.variable]:"fontSizes.sm"}}),lg:Lw({stepper:{[Af.variable]:"sizes.10",[FS.variable]:"sizes.6",[jS.variable]:"fontSizes.lg",[Mw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:SCe,definePartsStyle:KO}=Hi(VSe.keys),nC=Vo("switch-track-width"),Py=Vo("switch-track-height"),yM=Vo("switch-track-diff"),bCe=If.subtract(nC,Py),NU=Vo("switch-thumb-x"),fw=Vo("switch-bg"),TCe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[nC.reference],height:[Py.reference],transitionProperty:"common",transitionDuration:"fast",[fw.variable]:"colors.gray.300",_dark:{[fw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[fw.variable]:`colors.${e}.500`,_dark:{[fw.variable]:`colors.${e}.200`}},bg:fw.reference}},wCe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Py.reference],height:[Py.reference],_checked:{transform:`translateX(${NU.reference})`}},CCe=KO(n=>({container:{[yM.variable]:bCe,[NU.variable]:yM.reference,_rtl:{[NU.variable]:If(yM).negate().toString()}},track:TCe(n),thumb:wCe})),RCe={sm:KO({container:{[nC.variable]:"1.375rem",[Py.variable]:"sizes.3"}}),md:KO({container:{[nC.variable]:"1.875rem",[Py.variable]:"sizes.4"}}),lg:KO({container:{[nC.variable]:"2.875rem",[Py.variable]:"sizes.6"}})},ICe=SCe({baseStyle:CCe,sizes:RCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:ACe,definePartsStyle:ZS}=Hi(FSe.keys),PCe=ZS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),Ak={"&[data-is-numeric=true]":{textAlign:"end"}},OCe=ZS(n=>{const{colorScheme:e}=n;return{th:{color:Un("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Un(`${e}.100`,`${e}.700`)(n),...Ak},td:{borderBottom:"1px",borderColor:Un(`${e}.100`,`${e}.700`)(n),...Ak},caption:{color:Un("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),kCe=ZS(n=>{const{colorScheme:e}=n;return{th:{color:Un("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Un(`${e}.100`,`${e}.700`)(n),...Ak},td:{borderBottom:"1px",borderColor:Un(`${e}.100`,`${e}.700`)(n),...Ak},caption:{color:Un("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Un(`${e}.100`,`${e}.700`)(n)},td:{background:Un(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),NCe={simple:OCe,striped:kCe,unstyled:{}},DCe={sm:ZS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:ZS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:ZS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},xCe=ACe({baseStyle:PCe,variants:NCe,sizes:DCe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),yl=Vn("tabs-color"),Xd=Vn("tabs-bg"),mO=Vn("tabs-border-color"),{defineMultiStyleConfig:LCe,definePartsStyle:fp}=Hi(jSe.keys),MCe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},UCe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},VCe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},FCe={p:4},jCe=fp(n=>({root:MCe(n),tab:UCe(n),tablist:VCe(n),tabpanel:FCe})),BCe={sm:fp({tab:{py:1,px:4,fontSize:"sm"}}),md:fp({tab:{fontSize:"md",py:2,px:4}}),lg:fp({tab:{fontSize:"lg",py:3,px:4}})},zCe=fp(n=>{const{colorScheme:e,orientation:i}=n,a=i==="vertical",l=a?"borderStart":"borderBottom",u=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[yl.variable]:`colors.${e}.600`,_dark:{[yl.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[Xd.variable]:"colors.gray.200",_dark:{[Xd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:yl.reference,bg:Xd.reference}}}),WCe=fp(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[mO.variable]:"transparent",_selected:{[yl.variable]:`colors.${e}.600`,[mO.variable]:"colors.white",_dark:{[yl.variable]:`colors.${e}.300`,[mO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:mO.reference},color:yl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),GCe=fp(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Xd.variable]:"colors.gray.50",_dark:{[Xd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Xd.variable]:"colors.white",[yl.variable]:`colors.${e}.600`,_dark:{[Xd.variable]:"colors.gray.800",[yl.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:yl.reference,bg:Xd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),HCe=fp(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Dc(i,`${e}.700`),bg:Dc(i,`${e}.100`)}}}}),$Ce=fp(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[yl.variable]:"colors.gray.600",_dark:{[yl.variable]:"inherit"},_selected:{[yl.variable]:"colors.white",[Xd.variable]:`colors.${e}.600`,_dark:{[yl.variable]:"colors.gray.800",[Xd.variable]:`colors.${e}.300`}},color:yl.reference,bg:Xd.reference}}}),KCe=fp({}),qCe={line:zCe,enclosed:WCe,"enclosed-colored":GCe,"soft-rounded":HCe,"solid-rounded":$Ce,unstyled:KCe},YCe=LCe({baseStyle:jCe,sizes:BCe,variants:qCe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:XCe,definePartsStyle:Oy}=Hi(BSe.keys),LK=Vn("tag-bg"),MK=Vn("tag-color"),EM=Vn("tag-shadow"),qO=Vn("tag-min-height"),YO=Vn("tag-min-width"),XO=Vn("tag-font-size"),JO=Vn("tag-padding-inline"),JCe={fontWeight:"medium",lineHeight:1.2,outline:0,[MK.variable]:to.color.reference,[LK.variable]:to.bg.reference,[EM.variable]:to.shadow.reference,color:MK.reference,bg:LK.reference,boxShadow:EM.reference,borderRadius:"md",minH:qO.reference,minW:YO.reference,fontSize:XO.reference,px:JO.reference,_focusVisible:{[EM.variable]:"shadows.outline"}},QCe={lineHeight:1.2,overflow:"visible"},ZCe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},eRe=Oy({container:JCe,label:QCe,closeButton:ZCe}),tRe={sm:Oy({container:{[qO.variable]:"sizes.5",[YO.variable]:"sizes.5",[XO.variable]:"fontSizes.xs",[JO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Oy({container:{[qO.variable]:"sizes.6",[YO.variable]:"sizes.6",[XO.variable]:"fontSizes.sm",[JO.variable]:"space.2"}}),lg:Oy({container:{[qO.variable]:"sizes.8",[YO.variable]:"sizes.8",[XO.variable]:"fontSizes.md",[JO.variable]:"space.3"}})},nRe={subtle:Oy(n=>{var e;return{container:(e=Zw.variants)==null?void 0:e.subtle(n)}}),solid:Oy(n=>{var e;return{container:(e=Zw.variants)==null?void 0:e.solid(n)}}),outline:Oy(n=>{var e;return{container:(e=Zw.variants)==null?void 0:e.outline(n)}})},rRe=XCe({variants:nRe,baseStyle:eRe,sizes:tRe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var UQ;const iRe={...(UQ=oi.baseStyle)==null?void 0:UQ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var VQ;const sRe={outline:n=>{var e;return((e=oi.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=oi.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=oi.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((VQ=oi.variants)==null?void 0:VQ.unstyled.field)??{}};var FQ,jQ,BQ,zQ;const oRe={xs:((FQ=oi.sizes)==null?void 0:FQ.xs.field)??{},sm:((jQ=oi.sizes)==null?void 0:jQ.sm.field)??{},md:((BQ=oi.sizes)==null?void 0:BQ.md.field)??{},lg:((zQ=oi.sizes)==null?void 0:zQ.lg.field)??{}},aRe={baseStyle:iRe,sizes:oRe,variants:sRe,defaultProps:{size:"md",variant:"outline"}},gO=Vo("tooltip-bg"),vM=Vo("tooltip-fg"),cRe=Vo("popper-arrow-bg"),lRe={bg:gO.reference,color:vM.reference,[gO.variable]:"colors.gray.700",[vM.variable]:"colors.whiteAlpha.900",_dark:{[gO.variable]:"colors.gray.300",[vM.variable]:"colors.gray.900"},[cRe.variable]:gO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},uRe={baseStyle:lRe},dRe={Accordion:XSe,Alert:D0e,Avatar:G0e,Badge:Zw,Breadcrumb:ebe,Button:lbe,Checkbox:mg,CloseButton:wbe,Code:Abe,Container:Obe,Divider:Lbe,Drawer:$be,Editable:Zbe,Form:sTe,FormError:dTe,FormLabel:pTe,Heading:gTe,Input:oi,Kbd:RTe,Link:ATe,List:DTe,Menu:GTe,Modal:twe,NumberInput:uwe,PinInput:fwe,Popover:Cwe,Progress:Dwe,Radio:Vwe,Select:Hwe,Skeleton:Kwe,SkipLink:Ywe,Slider:oCe,Spinner:lCe,Stat:_Ce,Switch:ICe,Table:xCe,Tabs:YCe,Tag:rRe,Textarea:aRe,Tooltip:uRe,Card:fbe,Stepper:vCe},hRe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},pRe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},fRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},mRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},gRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},_Re={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},yRe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},ERe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},vRe={property:_Re,easing:yRe,duration:ERe},SRe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},bRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},TRe={breakpoints:pRe,zIndices:SRe,radii:mRe,blur:bRe,colors:fRe,...IZ,sizes:SZ,shadows:gRe,space:vZ,borders:hRe,transition:vRe},wRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},CRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},RRe="ltr",IRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},ARe={semanticTokens:wRe,direction:RRe,...TRe,components:dRe,styles:CRe,config:IRe};function PRe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function ORe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var kRe=function(){function n(i){var a=this;this._insertTag=function(l){var u;a.tags.length===0?a.insertionPoint?u=a.insertionPoint.nextSibling:a.prepend?u=a.container.firstChild:u=a.before:u=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,u),a.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(a){a.forEach(this._insertTag)},e.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(ORe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var u=PRe(l);try{u.insertRule(a,u.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},e.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),sc="-ms-",Pk="-moz-",ii="-webkit-",kZ="comm",_F="rule",yF="decl",NRe="@import",NZ="@keyframes",DRe="@layer",xRe=Math.abs,SN=String.fromCharCode,LRe=Object.assign;function MRe(n,e){return Na(n,0)^45?(((e<<2^Na(n,0))<<2^Na(n,1))<<2^Na(n,2))<<2^Na(n,3):0}function DZ(n){return n.trim()}function URe(n,e){return(n=e.exec(n))?n[0]:n}function si(n,e,i){return n.replace(e,i)}function DU(n,e){return n.indexOf(e)}function Na(n,e){return n.charCodeAt(e)|0}function TC(n,e,i){return n.slice(e,i)}function rp(n){return n.length}function EF(n){return n.length}function _O(n,e){return e.push(n),n}function VRe(n,e){return n.map(e).join("")}var bN=1,p0=1,xZ=0,Cl=0,uo=0,U0="";function TN(n,e,i,a,l,u,f){return{value:n,root:e,parent:i,type:a,props:l,children:u,line:bN,column:p0,length:f,return:""}}function mw(n,e){return LRe(TN("",null,null,"",null,null,0),n,{length:-n.length},e)}function FRe(){return uo}function jRe(){return uo=Cl>0?Na(U0,--Cl):0,p0--,uo===10&&(p0=1,bN--),uo}function nu(){return uo=Cl<xZ?Na(U0,Cl++):0,p0++,uo===10&&(p0=1,bN++),uo}function mp(){return Na(U0,Cl)}function QO(){return Cl}function XC(n,e){return TC(U0,n,e)}function wC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function LZ(n){return bN=p0=1,xZ=rp(U0=n),Cl=0,[]}function MZ(n){return U0="",n}function ZO(n){return DZ(XC(Cl-1,xU(n===91?n+2:n===40?n+1:n)))}function BRe(n){for(;(uo=mp())&&uo<33;)nu();return wC(n)>2||wC(uo)>3?"":" "}function zRe(n,e){for(;--e&&nu()&&!(uo<48||uo>102||uo>57&&uo<65||uo>70&&uo<97););return XC(n,QO()+(e<6&&mp()==32&&nu()==32))}function xU(n){for(;nu();)switch(uo){case n:return Cl;case 34:case 39:n!==34&&n!==39&&xU(uo);break;case 40:n===41&&xU(n);break;case 92:nu();break}return Cl}function WRe(n,e){for(;nu()&&n+uo!==57;)if(n+uo===84&&mp()===47)break;return"/*"+XC(e,Cl-1)+"*"+SN(n===47?n:nu())}function GRe(n){for(;!wC(mp());)nu();return XC(n,Cl)}function HRe(n){return MZ(ek("",null,null,null,[""],n=LZ(n),0,[0],n))}function ek(n,e,i,a,l,u,f,_,E){for(var b=0,C=0,I=f,O=0,L=0,M=0,F=1,z=1,X=1,K=0,ne="",oe=l,ae=u,le=a,Y=ne;z;)switch(M=K,K=nu()){case 40:if(M!=108&&Na(Y,I-1)==58){DU(Y+=si(ZO(K),"&","&\f"),"&\f")!=-1&&(X=-1);break}case 34:case 39:case 91:Y+=ZO(K);break;case 9:case 10:case 13:case 32:Y+=BRe(M);break;case 92:Y+=zRe(QO()-1,7);continue;case 47:switch(mp()){case 42:case 47:_O($Re(WRe(nu(),QO()),e,i),E);break;default:Y+="/"}break;case 123*F:_[b++]=rp(Y)*X;case 125*F:case 59:case 0:switch(K){case 0:case 125:z=0;case 59+C:X==-1&&(Y=si(Y,/\f/g,"")),L>0&&rp(Y)-I&&_O(L>32?VK(Y+";",a,i,I-1):VK(si(Y," ","")+";",a,i,I-2),E);break;case 59:Y+=";";default:if(_O(le=UK(Y,e,i,b,C,l,_,ne,oe=[],ae=[],I),u),K===123)if(C===0)ek(Y,e,le,le,oe,u,I,_,ae);else switch(O===99&&Na(Y,3)===110?100:O){case 100:case 108:case 109:case 115:ek(n,le,le,a&&_O(UK(n,le,le,0,0,l,_,ne,l,oe=[],I),ae),l,ae,I,_,a?oe:ae);break;default:ek(Y,le,le,le,[""],ae,0,_,ae)}}b=C=L=0,F=X=1,ne=Y="",I=f;break;case 58:I=1+rp(Y),L=M;default:if(F<1){if(K==123)--F;else if(K==125&&F++==0&&jRe()==125)continue}switch(Y+=SN(K),K*F){case 38:X=C>0?1:(Y+="\f",-1);break;case 44:_[b++]=(rp(Y)-1)*X,X=1;break;case 64:mp()===45&&(Y+=ZO(nu())),O=mp(),C=I=rp(ne=Y+=GRe(QO())),K++;break;case 45:M===45&&rp(Y)==2&&(F=0)}}return u}function UK(n,e,i,a,l,u,f,_,E,b,C){for(var I=l-1,O=l===0?u:[""],L=EF(O),M=0,F=0,z=0;M<a;++M)for(var X=0,K=TC(n,I+1,I=xRe(F=f[M])),ne=n;X<L;++X)(ne=DZ(F>0?O[X]+" "+K:si(K,/&\f/g,O[X])))&&(E[z++]=ne);return TN(n,e,i,l===0?_F:_,E,b,C)}function $Re(n,e,i){return TN(n,e,i,kZ,SN(FRe()),TC(n,2,-2),0)}function VK(n,e,i,a){return TN(n,e,i,yF,TC(n,0,a),TC(n,a+1,-1),a)}function e0(n,e){for(var i="",a=EF(n),l=0;l<a;l++)i+=e(n[l],l,n,e)||"";return i}function KRe(n,e,i,a){switch(n.type){case DRe:if(n.children.length)break;case NRe:case yF:return n.return=n.return||n.value;case kZ:return"";case NZ:return n.return=n.value+"{"+e0(n.children,a)+"}";case _F:n.value=n.props.join(",")}return rp(i=e0(n.children,a))?n.return=n.value+"{"+i+"}":""}function qRe(n){var e=EF(n);return function(i,a,l,u){for(var f="",_=0;_<e;_++)f+=n[_](i,a,l,u)||"";return f}}function YRe(n){return function(e){e.root||(e=e.return)&&n(e)}}var FK=function(e){var i=new WeakMap;return function(a){if(i.has(a))return i.get(a);var l=e(a);return i.set(a,l),l}};function UZ(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var XRe=function(e,i,a){for(var l=0,u=0;l=u,u=mp(),l===38&&u===12&&(i[a]=1),!wC(u);)nu();return XC(e,Cl)},JRe=function(e,i){var a=-1,l=44;do switch(wC(l)){case 0:l===38&&mp()===12&&(i[a]=1),e[a]+=XRe(Cl-1,i,a);break;case 2:e[a]+=ZO(l);break;case 4:if(l===44){e[++a]=mp()===58?"&\f":"",i[a]=e[a].length;break}default:e[a]+=SN(l)}while(l=nu());return e},QRe=function(e,i){return MZ(JRe(LZ(e),i))},jK=new WeakMap,ZRe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,a=e.parent,l=e.column===a.column&&e.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!jK.get(a))&&!l){jK.set(e,!0);for(var u=[],f=QRe(i,u),_=a.props,E=0,b=0;E<f.length;E++)for(var C=0;C<_.length;C++,b++)e.props[b]=u[E]?f[E].replace(/&\f/g,_[C]):_[C]+" "+f[E]}}},eIe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function VZ(n,e){switch(MRe(n,e)){case 5103:return ii+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ii+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ii+n+Pk+n+sc+n+n;case 6828:case 4268:return ii+n+sc+n+n;case 6165:return ii+n+sc+"flex-"+n+n;case 5187:return ii+n+si(n,/(\w+).+(:[^]+)/,ii+"box-$1$2"+sc+"flex-$1$2")+n;case 5443:return ii+n+sc+"flex-item-"+si(n,/flex-|-self/,"")+n;case 4675:return ii+n+sc+"flex-line-pack"+si(n,/align-content|flex-|-self/,"")+n;case 5548:return ii+n+sc+si(n,"shrink","negative")+n;case 5292:return ii+n+sc+si(n,"basis","preferred-size")+n;case 6060:return ii+"box-"+si(n,"-grow","")+ii+n+sc+si(n,"grow","positive")+n;case 4554:return ii+si(n,/([^-])(transform)/g,"$1"+ii+"$2")+n;case 6187:return si(si(si(n,/(zoom-|grab)/,ii+"$1"),/(image-set)/,ii+"$1"),n,"")+n;case 5495:case 3959:return si(n,/(image-set\([^]*)/,ii+"$1$`$1");case 4968:return si(si(n,/(.+:)(flex-)?(.*)/,ii+"box-pack:$3"+sc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ii+n+n;case 4095:case 3583:case 4068:case 2532:return si(n,/(.+)-inline(.+)/,ii+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(rp(n)-1-e>6)switch(Na(n,e+1)){case 109:if(Na(n,e+4)!==45)break;case 102:return si(n,/(.+:)(.+)-([^]+)/,"$1"+ii+"$2-$3$1"+Pk+(Na(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~DU(n,"stretch")?VZ(si(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Na(n,e+1)!==115)break;case 6444:switch(Na(n,rp(n)-3-(~DU(n,"!important")&&10))){case 107:return si(n,":",":"+ii)+n;case 101:return si(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ii+(Na(n,14)===45?"inline-":"")+"box$3$1"+ii+"$2$3$1"+sc+"$2box$3")+n}break;case 5936:switch(Na(n,e+11)){case 114:return ii+n+sc+si(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ii+n+sc+si(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ii+n+sc+si(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ii+n+sc+n+n}return n}var tIe=function(e,i,a,l){if(e.length>-1&&!e.return)switch(e.type){case yF:e.return=VZ(e.value,e.length);break;case NZ:return e0([mw(e,{value:si(e.value,"@","@"+ii)})],l);case _F:if(e.length)return VRe(e.props,function(u){switch(URe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return e0([mw(e,{props:[si(u,/:(read-\w+)/,":"+Pk+"$1")]})],l);case"::placeholder":return e0([mw(e,{props:[si(u,/:(plac\w+)/,":"+ii+"input-$1")]}),mw(e,{props:[si(u,/:(plac\w+)/,":"+Pk+"$1")]}),mw(e,{props:[si(u,/:(plac\w+)/,sc+"input-$1")]})],l)}return""})}},nIe=[tIe],rIe=function(e){var i=e.key;if(i==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(F){var z=F.getAttribute("data-emotion");z.indexOf(" ")!==-1&&(document.head.appendChild(F),F.setAttribute("data-s",""))})}var l=e.stylisPlugins||nIe,u={},f,_=[];f=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(F){for(var z=F.getAttribute("data-emotion").split(" "),X=1;X<z.length;X++)u[z[X]]=!0;_.push(F)});var E,b=[ZRe,eIe];{var C,I=[KRe,YRe(function(F){C.insert(F)})],O=qRe(b.concat(l,I)),L=function(z){return e0(HRe(z),O)};E=function(z,X,K,ne){C=K,L(z?z+"{"+X.styles+"}":X.styles),ne&&(M.inserted[X.name]=!0)}}var M={key:i,sheet:new kRe({key:i,container:f,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:E};return M.sheet.hydrate(_),M};function By(){return By=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},By.apply(null,arguments)}var SM={exports:{}},pi={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BK;function iIe(){if(BK)return pi;BK=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,_=n?Symbol.for("react.context"):60110,E=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,O=n?Symbol.for("react.suspense_list"):60120,L=n?Symbol.for("react.memo"):60115,M=n?Symbol.for("react.lazy"):60116,F=n?Symbol.for("react.block"):60121,z=n?Symbol.for("react.fundamental"):60117,X=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function ne(ae){if(typeof ae=="object"&&ae!==null){var le=ae.$$typeof;switch(le){case e:switch(ae=ae.type,ae){case E:case b:case a:case u:case l:case I:return ae;default:switch(ae=ae&&ae.$$typeof,ae){case _:case C:case M:case L:case f:return ae;default:return le}}case i:return le}}}function oe(ae){return ne(ae)===b}return pi.AsyncMode=E,pi.ConcurrentMode=b,pi.ContextConsumer=_,pi.ContextProvider=f,pi.Element=e,pi.ForwardRef=C,pi.Fragment=a,pi.Lazy=M,pi.Memo=L,pi.Portal=i,pi.Profiler=u,pi.StrictMode=l,pi.Suspense=I,pi.isAsyncMode=function(ae){return oe(ae)||ne(ae)===E},pi.isConcurrentMode=oe,pi.isContextConsumer=function(ae){return ne(ae)===_},pi.isContextProvider=function(ae){return ne(ae)===f},pi.isElement=function(ae){return typeof ae=="object"&&ae!==null&&ae.$$typeof===e},pi.isForwardRef=function(ae){return ne(ae)===C},pi.isFragment=function(ae){return ne(ae)===a},pi.isLazy=function(ae){return ne(ae)===M},pi.isMemo=function(ae){return ne(ae)===L},pi.isPortal=function(ae){return ne(ae)===i},pi.isProfiler=function(ae){return ne(ae)===u},pi.isStrictMode=function(ae){return ne(ae)===l},pi.isSuspense=function(ae){return ne(ae)===I},pi.isValidElementType=function(ae){return typeof ae=="string"||typeof ae=="function"||ae===a||ae===b||ae===u||ae===l||ae===I||ae===O||typeof ae=="object"&&ae!==null&&(ae.$$typeof===M||ae.$$typeof===L||ae.$$typeof===f||ae.$$typeof===_||ae.$$typeof===C||ae.$$typeof===z||ae.$$typeof===X||ae.$$typeof===K||ae.$$typeof===F)},pi.typeOf=ne,pi}var zK;function sIe(){return zK||(zK=1,SM.exports=iIe()),SM.exports}var bM,WK;function oIe(){if(WK)return bM;WK=1;var n=sIe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[n.ForwardRef]=a,u[n.Memo]=l;function f(M){return n.isMemo(M)?l:u[M.$$typeof]||e}var _=Object.defineProperty,E=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,O=Object.prototype;function L(M,F,z){if(typeof F!="string"){if(O){var X=I(F);X&&X!==O&&L(M,X,z)}var K=E(F);b&&(K=K.concat(b(F)));for(var ne=f(M),oe=f(F),ae=0;ae<K.length;++ae){var le=K[ae];if(!i[le]&&!(z&&z[le])&&!(oe&&oe[le])&&!(ne&&ne[le])){var Y=C(F,le);try{_(M,le,Y)}catch{}}}}return M}return bM=L,bM}var aIe=oIe();const cIe=jg(aIe);var lIe=!0;function FZ(n,e,i){var a="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(a+=l+" ")}),a}var vF=function(e,i,a){var l=e.key+"-"+i.name;(a===!1||lIe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},SF=function(e,i,a){vF(e,i,a);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var u=i;do e.insert(i===u?"."+l:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function uIe(n){for(var e=0,i,a=0,l=n.length;l>=4;++a,l-=4)i=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(a+2)&255)<<16;case 2:e^=(n.charCodeAt(a+1)&255)<<8;case 1:e^=n.charCodeAt(a)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var dIe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},hIe=/[A-Z]|^ms/g,pIe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,jZ=function(e){return e.charCodeAt(1)===45},GK=function(e){return e!=null&&typeof e!="boolean"},TM=UZ(function(n){return jZ(n)?n:n.replace(hIe,"-$&").toLowerCase()}),HK=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(pIe,function(a,l,u){return ip={name:l,styles:u,next:ip},l})}return dIe[e]!==1&&!jZ(e)&&typeof i=="number"&&i!==0?i+"px":i};function CC(n,e,i){if(i==null)return"";var a=i;if(a.__emotion_styles!==void 0)return a;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return ip={name:l.name,styles:l.styles,next:ip},l.name;var u=i;if(u.styles!==void 0){var f=u.next;if(f!==void 0)for(;f!==void 0;)ip={name:f.name,styles:f.styles,next:ip},f=f.next;var _=u.styles+";";return _}return fIe(n,e,i)}case"function":{if(n!==void 0){var E=ip,b=i(n);return ip=E,CC(n,e,b)}break}}var C=i;if(e==null)return C;var I=e[C];return I!==void 0?I:C}function fIe(n,e,i){var a="";if(Array.isArray(i))for(var l=0;l<i.length;l++)a+=CC(n,e,i[l])+";";else for(var u in i){var f=i[u];if(typeof f!="object"){var _=f;e!=null&&e[_]!==void 0?a+=u+"{"+e[_]+"}":GK(_)&&(a+=TM(u)+":"+HK(u,_)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(e==null||e[f[0]]===void 0))for(var E=0;E<f.length;E++)GK(f[E])&&(a+=TM(u)+":"+HK(u,f[E])+";");else{var b=CC(n,e,f);switch(u){case"animation":case"animationName":{a+=TM(u)+":"+b+";";break}default:a+=u+"{"+b+"}"}}}return a}var $K=/label:\s*([^\s;{]+)\s*(;|$)/g,ip;function wN(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";ip=void 0;var u=n[0];if(u==null||u.raw===void 0)a=!1,l+=CC(i,e,u);else{var f=u;l+=f[0]}for(var _=1;_<n.length;_++)if(l+=CC(i,e,n[_]),a){var E=u;l+=E[_]}$K.lastIndex=0;for(var b="",C;(C=$K.exec(l))!==null;)b+="-"+C[1];var I=uIe(l)+b;return{name:I,styles:l,next:ip}}var mIe=function(e){return e()},BZ=nK.useInsertionEffect?nK.useInsertionEffect:!1,zZ=BZ||mIe,KK=BZ||N.useLayoutEffect,bF=N.createContext(typeof HTMLElement<"u"?rIe({key:"css"}):null);bF.Provider;var gIe=function(){return N.useContext(bF)},TF=function(e){return N.forwardRef(function(i,a){var l=N.useContext(bF);return e(i,l,a)})},f0=N.createContext({}),_Ie=function(e,i){if(typeof i=="function"){var a=i(e);return a}return By({},e,i)},yIe=FK(function(n){return FK(function(e){return _Ie(n,e)})}),EIe=function(e){var i=N.useContext(f0);return e.theme!==i&&(i=yIe(i)(e.theme)),N.createElement(f0.Provider,{value:i},e.children)},wF={}.hasOwnProperty,LU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",vIe=function(e,i){var a={};for(var l in i)wF.call(i,l)&&(a[l]=i[l]);return a[LU]=e,a},SIe=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return vF(i,a,l),zZ(function(){return SF(i,a,l)}),null},bIe=TF(function(n,e,i){var a=n.css;typeof a=="string"&&e.registered[a]!==void 0&&(a=e.registered[a]);var l=n[LU],u=[a],f="";typeof n.className=="string"?f=FZ(e.registered,u,n.className):n.className!=null&&(f=n.className+" ");var _=wN(u,void 0,N.useContext(f0));f+=e.key+"-"+_.name;var E={};for(var b in n)wF.call(n,b)&&b!=="css"&&b!==LU&&(E[b]=n[b]);return E.className=f,i&&(E.ref=i),N.createElement(N.Fragment,null,N.createElement(SIe,{cache:e,serialized:_,isStringTag:typeof l=="string"}),N.createElement(l,E))}),TIe=bIe,qK=function(e,i){var a=arguments;if(i==null||!wF.call(i,"css"))return N.createElement.apply(void 0,a);var l=a.length,u=new Array(l);u[0]=TIe,u[1]=vIe(e,i);for(var f=2;f<l;f++)u[f]=a[f];return N.createElement.apply(null,u)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(qK||(qK={}));var CN=TF(function(n,e){var i=n.styles,a=wN([i],void 0,N.useContext(f0)),l=N.useRef();return KK(function(){var u=e.key+"-global",f=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),_=!1,E=document.querySelector('style[data-emotion="'+u+" "+a.name+'"]');return e.sheet.tags.length&&(f.before=e.sheet.tags[0]),E!==null&&(_=!0,E.setAttribute("data-emotion",u),f.hydrate([E])),l.current=[f,_],function(){f.flush()}},[e]),KK(function(){var u=l.current,f=u[0],_=u[1];if(_){u[1]=!1;return}if(a.next!==void 0&&SF(e,a.next,!0),f.tags.length){var E=f.tags[f.tags.length-1].nextElementSibling;f.before=E,f.flush()}e.insert("",a,f,!1)},[e,a.name]),null});function wIe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return wN(e)}function JC(){var n=wIe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const CF=N.createContext({});CF.displayName="ColorModeContext";function RN(){const n=N.useContext(CF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function Tg(n,e){const{colorMode:i}=RN();return i==="dark"?e:n}const yO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function CIe(n={}){const{preventTransition:e=!0,nonce:i}=n,a={setDataset:l=>{const u=e?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,u==null||u()},setClassName(l){document.body.classList.add(l?yO.dark:yO.light),document.body.classList.remove(l?yO.light:yO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const u=a.query(),f=_=>{l(_.matches?"dark":"light")};return typeof u.addListener=="function"?u.addListener(f):u.addEventListener("change",f),()=>{typeof u.removeListener=="function"?u.removeListener(f):u.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const RIe="chakra-ui-color-mode";function IIe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const AIe=IIe(RIe),YK=()=>{},PIe=Hye()?N.useLayoutEffect:N.useEffect;function XK(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const WZ=function(e){const{value:i,children:a,options:{useSystemColorMode:l,initialColorMode:u,disableTransitionOnChange:f}={},colorModeManager:_=AIe}=e,E=gIe(),b=u==="dark"?"dark":"light",[C,I]=N.useState(()=>XK(_,b)),[O,L]=N.useState(()=>XK(_)),{getSystemTheme:M,setClassName:F,setDataset:z,addListener:X}=N.useMemo(()=>CIe({preventTransition:f,nonce:E==null?void 0:E.nonce}),[f,E==null?void 0:E.nonce]),K=u==="system"&&!C?O:C,ne=N.useCallback(le=>{const Y=le==="system"?M():le;I(Y),F(Y==="dark"),z(Y),_.set(Y)},[_,M,F,z]);PIe(()=>{u==="system"&&L(M())},[]),N.useEffect(()=>{const le=_.get();if(le){ne(le);return}if(u==="system"){ne("system");return}ne(b)},[_,b,u,ne]);const oe=N.useCallback(()=>{ne(K==="dark"?"light":"dark")},[K,ne]);N.useEffect(()=>{if(l)return X(ne)},[l,X,ne]);const ae=N.useMemo(()=>({colorMode:i??K,toggleColorMode:i?YK:oe,setColorMode:i?YK:ne,forced:i!==void 0}),[K,oe,ne,i]);return T.jsx(CF.Provider,{value:ae,children:a})};WZ.displayName="ColorModeProvider";const GZ=String.raw,HZ=GZ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,OIe=()=>T.jsx(CN,{styles:HZ}),kIe=({scope:n=""})=>T.jsx(CN,{styles:GZ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${HZ}
    `});function NIe(n){const{cssVarsRoot:e,theme:i,children:a}=n,l=N.useMemo(()=>_Se(i),[i]);return T.jsxs(EIe,{theme:l,children:[T.jsx(DIe,{root:e}),a]})}function DIe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return T.jsx(CN,{styles:i=>({[e]:i.__cssVars})})}Ti({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function xIe(){const{colorMode:n}=RN();return T.jsx(CN,{styles:e=>{const i=QQ(e,"styles.global"),a=Sl(i,{theme:e,colorMode:n});return a?gZ(a)(e):void 0}})}const[LIe,MIe]=Ti({strict:!1,name:"PortalManagerContext"});function RF(n){const{children:e,zIndex:i}=n;return T.jsx(LIe,{value:{zIndex:i},children:e})}RF.displayName="PortalManager";const IF=N.createContext({getDocument(){return document},getWindow(){return window}});IF.displayName="EnvironmentContext";function UIe({defer:n}={}){const[,e]=N.useReducer(i=>i+1,0);return pp(()=>{n&&e()},[n]),N.useContext(IF)}function $Z(n){const{children:e,environment:i,disabled:a}=n,l=N.useRef(null),u=N.useMemo(()=>i||{getDocument:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument)??document},getWindow:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument.defaultView)??window}},[i]),f=!a||!i;return T.jsxs(IF.Provider,{value:u,children:[e,f&&T.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}$Z.displayName="EnvironmentProvider";const VIe=n=>{const{children:e,colorModeManager:i,portalZIndex:a,resetScope:l,resetCSS:u=!0,theme:f={},environment:_,cssVarsRoot:E,disableEnvironment:b,disableGlobalStyle:C}=n,I=T.jsx($Z,{environment:_,disabled:b,children:e});return T.jsx(NIe,{theme:f,cssVarsRoot:E,children:T.jsxs(WZ,{colorModeManager:i,options:f.config,children:[u?T.jsx(kIe,{scope:l}):T.jsx(OIe,{}),!C&&T.jsx(xIe,{}),a?T.jsx(RF,{zIndex:a,children:I}):I]})})},AF=N.createContext({});function PF(n){const e=N.useRef(null);return e.current===null&&(e.current=n()),e.current}const QC=N.createContext(null),OF=N.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class FIe extends N.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=i.offsetHeight||0,a.width=i.offsetWidth||0,a.top=i.offsetTop,a.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function jIe({children:n,isPresent:e}){const i=N.useId(),a=N.useRef(null),l=N.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=N.useContext(OF);return N.useInsertionEffect(()=>{const{width:f,height:_,top:E,left:b}=l.current;if(e||!a.current||!f||!_)return;a.current.dataset.motionPopId=i;const C=document.createElement("style");return u&&(C.nonce=u),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${_}px !important;
            top: ${E}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[e]),T.jsx(FIe,{isPresent:e,childRef:a,sizeRef:l,children:N.cloneElement(n,{ref:a})})}const BIe=({children:n,initial:e,isPresent:i,onExitComplete:a,custom:l,presenceAffectsLayout:u,mode:f})=>{const _=PF(zIe),E=N.useId(),b=N.useCallback(I=>{_.set(I,!0);for(const O of _.values())if(!O)return;a&&a()},[_,a]),C=N.useMemo(()=>({id:E,initial:e,isPresent:i,custom:l,onExitComplete:b,register:I=>(_.set(I,!1),()=>_.delete(I))}),u?[Math.random(),b]:[i,b]);return N.useMemo(()=>{_.forEach((I,O)=>_.set(O,!1))},[i]),N.useEffect(()=>{!i&&!_.size&&a&&a()},[i]),f==="popLayout"&&(n=T.jsx(jIe,{isPresent:i,children:n})),T.jsx(QC.Provider,{value:C,children:n})};function zIe(){return new Map}function kF(n=!0){const e=N.useContext(QC);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:l}=e,u=N.useId();N.useEffect(()=>{n&&l(u)},[n]);const f=N.useCallback(()=>n&&a&&a(u),[u,a,n]);return!i&&a?[!1,f]:[!0]}function WIe(){return GIe(N.useContext(QC))}function GIe(n){return n===null?!0:n.isPresent}const EO=n=>n.key||"";function JK(n){const e=[];return N.Children.forEach(n,i=>{N.isValidElement(i)&&e.push(i)}),e}const NF=typeof window<"u",KZ=NF?N.useLayoutEffect:N.useEffect,V0=({children:n,custom:e,initial:i=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:u="sync",propagate:f=!1})=>{const[_,E]=kF(f),b=N.useMemo(()=>JK(n),[n]),C=f&&!_?[]:b.map(EO),I=N.useRef(!0),O=N.useRef(b),L=PF(()=>new Map),[M,F]=N.useState(b),[z,X]=N.useState(b);KZ(()=>{I.current=!1,O.current=b;for(let oe=0;oe<z.length;oe++){const ae=EO(z[oe]);C.includes(ae)?L.delete(ae):L.get(ae)!==!0&&L.set(ae,!1)}},[z,C.length,C.join("-")]);const K=[];if(b!==M){let oe=[...b];for(let ae=0;ae<z.length;ae++){const le=z[ae],Y=EO(le);C.includes(Y)||(oe.splice(ae,0,le),K.push(le))}u==="wait"&&K.length&&(oe=K),X(JK(oe)),F(b);return}const{forceRender:ne}=N.useContext(AF);return T.jsx(T.Fragment,{children:z.map(oe=>{const ae=EO(oe),le=f&&!_?!1:b===z||C.includes(ae),Y=()=>{if(L.has(ae))L.set(ae,!0);else return;let Z=!0;L.forEach(Q=>{Q||(Z=!1)}),Z&&(ne==null||ne(),X(O.current),f&&(E==null||E()),a&&a())};return T.jsx(BIe,{isPresent:le,initial:!I.current||i?void 0:!1,custom:le?void 0:e,presenceAffectsLayout:l,mode:u,onExitComplete:le?void 0:Y,children:oe},ae)})})},ru=n=>n;let qZ=ru;function DF(n){let e;return()=>(e===void 0&&(e=n()),e)}const m0=(n,e,i)=>{const a=e-n;return a===0?1:(i-n)/a},Mf=n=>n*1e3,Uf=n=>n/1e3,HIe={useManualTiming:!1};function $Ie(n){let e=new Set,i=new Set,a=!1,l=!1;const u=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function _(b){u.has(b)&&(E.schedule(b),n()),b(f)}const E={schedule:(b,C=!1,I=!1)=>{const L=I&&a?e:i;return C&&u.add(b),L.has(b)||L.add(b),b},cancel:b=>{i.delete(b),u.delete(b)},process:b=>{if(f=b,a){l=!0;return}a=!0,[e,i]=[i,e],e.forEach(_),e.clear(),a=!1,l&&(l=!1,E.process(b))}};return E}const vO=["read","resolveKeyframes","update","preRender","render","postRender"],KIe=40;function YZ(n,e){let i=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>i=!0,f=vO.reduce((X,K)=>(X[K]=$Ie(u),X),{}),{read:_,resolveKeyframes:E,update:b,preRender:C,render:I,postRender:O}=f,L=()=>{const X=performance.now();i=!1,l.delta=a?1e3/60:Math.max(Math.min(X-l.timestamp,KIe),1),l.timestamp=X,l.isProcessing=!0,_.process(l),E.process(l),b.process(l),C.process(l),I.process(l),O.process(l),l.isProcessing=!1,i&&e&&(a=!1,n(L))},M=()=>{i=!0,a=!0,l.isProcessing||n(L)};return{schedule:vO.reduce((X,K)=>{const ne=f[K];return X[K]=(oe,ae=!1,le=!1)=>(i||M(),ne.schedule(oe,ae,le)),X},{}),cancel:X=>{for(let K=0;K<vO.length;K++)f[vO[K]].cancel(X)},state:l,steps:f}}const{schedule:ss,cancel:Og,state:Pa,steps:wM}=YZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:ru,!0),XZ=N.createContext({strict:!1}),QK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},g0={};for(const n in QK)g0[n]={isEnabled:e=>QK[n].some(i=>!!e[i])};function qIe(n){for(const e in n)g0[e]={...g0[e],...n[e]}}const YIe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ok(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||YIe.has(n)}let JZ=n=>!Ok(n);function XIe(n){n&&(JZ=e=>e.startsWith("on")?!Ok(e):n(e))}try{XIe(require("@emotion/is-prop-valid").default)}catch{}function JIe(n,e,i){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(JZ(l)||i===!0&&Ok(l)||!e&&!Ok(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function QIe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...a)=>n(...a);return new Proxy(i,{get:(a,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const IN=N.createContext({});function RC(n){return typeof n=="string"||Array.isArray(n)}function AN(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const xF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],LF=["initial",...xF];function PN(n){return AN(n.animate)||LF.some(e=>RC(n[e]))}function QZ(n){return!!(PN(n)||n.variants)}function ZIe(n,e){if(PN(n)){const{initial:i,animate:a}=n;return{initial:i===!1||RC(i)?i:void 0,animate:RC(a)?a:void 0}}return n.inherit!==!1?e:{}}function eAe(n){const{initial:e,animate:i}=ZIe(n,N.useContext(IN));return N.useMemo(()=>({initial:e,animate:i}),[ZK(e),ZK(i)])}function ZK(n){return Array.isArray(n)?n.join(" "):n}const tAe=Symbol.for("motionComponentSymbol");function BS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function nAe(n,e,i){return N.useCallback(a=>{a&&n.onMount&&n.onMount(a),e&&(a?e.mount(a):e.unmount()),i&&(typeof i=="function"?i(a):BS(i)&&(i.current=a))},[e])}const MF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),rAe="framerAppearId",ZZ="data-"+MF(rAe),{schedule:UF}=YZ(queueMicrotask,!1),eee=N.createContext({});function iAe(n,e,i,a,l){var u,f;const{visualElement:_}=N.useContext(IN),E=N.useContext(XZ),b=N.useContext(QC),C=N.useContext(OF).reducedMotion,I=N.useRef(null);a=a||E.renderer,!I.current&&a&&(I.current=a(n,{visualState:e,parent:_,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:C}));const O=I.current,L=N.useContext(eee);O&&!O.projection&&l&&(O.type==="html"||O.type==="svg")&&sAe(I.current,i,l,L);const M=N.useRef(!1);N.useInsertionEffect(()=>{O&&M.current&&O.update(i,b)});const F=i[ZZ],z=N.useRef(!!F&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,F))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,F)));return KZ(()=>{O&&(M.current=!0,window.MotionIsMounted=!0,O.updateFeatures(),UF.render(O.render),z.current&&O.animationState&&O.animationState.animateChanges())}),N.useEffect(()=>{O&&(!z.current&&O.animationState&&O.animationState.animateChanges(),z.current&&(queueMicrotask(()=>{var X;(X=window.MotionHandoffMarkAsComplete)===null||X===void 0||X.call(window,F)}),z.current=!1))}),O}function sAe(n,e,i,a){const{layoutId:l,layout:u,drag:f,dragConstraints:_,layoutScroll:E,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:tee(n.parent)),n.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!f||_&&BS(_),visualElement:n,animationType:typeof u=="string"?u:"both",initialPromotionConfig:a,layoutScroll:E,layoutRoot:b})}function tee(n){if(n)return n.options.allowProjection!==!1?n.projection:tee(n.parent)}function oAe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:a,Component:l}){var u,f;n&&qIe(n);function _(b,C){let I;const O={...N.useContext(OF),...b,layoutId:aAe(b)},{isStatic:L}=O,M=eAe(b),F=a(b,L);if(!L&&NF){cAe();const z=lAe(O);I=z.MeasureLayout,M.visualElement=iAe(l,F,O,e,z.ProjectionNode)}return T.jsxs(IN.Provider,{value:M,children:[I&&M.visualElement?T.jsx(I,{visualElement:M.visualElement,...O}):null,i(l,b,nAe(F,M.visualElement,C),F,L,M.visualElement)]})}_.displayName=`motion.${typeof l=="string"?l:`create(${(f=(u=l.displayName)!==null&&u!==void 0?u:l.name)!==null&&f!==void 0?f:""})`}`;const E=N.forwardRef(_);return E[tAe]=l,E}function aAe({layoutId:n}){const e=N.useContext(AF).id;return e&&n!==void 0?e+"-"+n:n}function cAe(n,e){N.useContext(XZ).strict}function lAe(n){const{drag:e,layout:i}=g0;if(!e&&!i)return{};const a={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const uAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function VF(n){return typeof n!="string"||n.includes("-")?!1:!!(uAe.indexOf(n)>-1||/[A-Z]/u.test(n))}function eq(n){const e=[{},{}];return n==null||n.values.forEach((i,a)=>{e[0][a]=i.get(),e[1][a]=i.getVelocity()}),e}function FF(n,e,i,a){if(typeof e=="function"){const[l,u]=eq(a);e=e(i!==void 0?i:n.custom,l,u)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,u]=eq(a);e=e(i!==void 0?i:n.custom,l,u)}return e}const MU=n=>Array.isArray(n),dAe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),hAe=n=>MU(n)?n[n.length-1]||0:n,lc=n=>!!(n&&n.getVelocity);function tk(n){const e=lc(n)?n.get():n;return dAe(e)?e.toValue():e}function pAe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},a,l,u){const f={latestValues:fAe(a,l,u,n),renderState:e()};return i&&(f.onMount=_=>i({props:a,current:_,...f}),f.onUpdate=_=>i(_)),f}const nee=n=>(e,i)=>{const a=N.useContext(IN),l=N.useContext(QC),u=()=>pAe(n,e,a,l);return i?u():PF(u)};function fAe(n,e,i,a){const l={},u=a(n,{});for(const O in u)l[O]=tk(u[O]);let{initial:f,animate:_}=n;const E=PN(n),b=QZ(n);e&&b&&!E&&n.inherit!==!1&&(f===void 0&&(f=e.initial),_===void 0&&(_=e.animate));let C=i?i.initial===!1:!1;C=C||f===!1;const I=C?_:f;if(I&&typeof I!="boolean"&&!AN(I)){const O=Array.isArray(I)?I:[I];for(let L=0;L<O.length;L++){const M=FF(n,O[L]);if(M){const{transitionEnd:F,transition:z,...X}=M;for(const K in X){let ne=X[K];if(Array.isArray(ne)){const oe=C?ne.length-1:0;ne=ne[oe]}ne!==null&&(l[K]=ne)}for(const K in F)l[K]=F[K]}}}return l}const F0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Jy=new Set(F0),ree=n=>e=>typeof e=="string"&&e.startsWith(n),iee=ree("--"),mAe=ree("var(--"),jF=n=>mAe(n)?gAe.test(n.split("/*")[0].trim()):!1,gAe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,see=(n,e)=>e&&typeof n=="number"?e.transform(n):n,$f=(n,e,i)=>i>e?e:i<n?n:i,j0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},IC={...j0,transform:n=>$f(0,1,n)},SO={...j0,default:1},ZC=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),fg=ZC("deg"),gp=ZC("%"),Bn=ZC("px"),_Ae=ZC("vh"),yAe=ZC("vw"),tq={...gp,parse:n=>gp.parse(n)/100,transform:n=>gp.transform(n*100)},EAe={borderWidth:Bn,borderTopWidth:Bn,borderRightWidth:Bn,borderBottomWidth:Bn,borderLeftWidth:Bn,borderRadius:Bn,radius:Bn,borderTopLeftRadius:Bn,borderTopRightRadius:Bn,borderBottomRightRadius:Bn,borderBottomLeftRadius:Bn,width:Bn,maxWidth:Bn,height:Bn,maxHeight:Bn,top:Bn,right:Bn,bottom:Bn,left:Bn,padding:Bn,paddingTop:Bn,paddingRight:Bn,paddingBottom:Bn,paddingLeft:Bn,margin:Bn,marginTop:Bn,marginRight:Bn,marginBottom:Bn,marginLeft:Bn,backgroundPositionX:Bn,backgroundPositionY:Bn},vAe={rotate:fg,rotateX:fg,rotateY:fg,rotateZ:fg,scale:SO,scaleX:SO,scaleY:SO,scaleZ:SO,skew:fg,skewX:fg,skewY:fg,distance:Bn,translateX:Bn,translateY:Bn,translateZ:Bn,x:Bn,y:Bn,z:Bn,perspective:Bn,transformPerspective:Bn,opacity:IC,originX:tq,originY:tq,originZ:Bn},nq={...j0,transform:Math.round},BF={...EAe,...vAe,zIndex:nq,size:Bn,fillOpacity:IC,strokeOpacity:IC,numOctaves:nq},SAe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},bAe=F0.length;function TAe(n,e,i){let a="",l=!0;for(let u=0;u<bAe;u++){const f=F0[u],_=n[f];if(_===void 0)continue;let E=!0;if(typeof _=="number"?E=_===(f.startsWith("scale")?1:0):E=parseFloat(_)===0,!E||i){const b=see(_,BF[f]);if(!E){l=!1;const C=SAe[f]||f;a+=`${C}(${b}) `}i&&(e[f]=b)}}return a=a.trim(),i?a=i(e,l?"":a):l&&(a="none"),a}function zF(n,e,i){const{style:a,vars:l,transformOrigin:u}=n;let f=!1,_=!1;for(const E in e){const b=e[E];if(Jy.has(E)){f=!0;continue}else if(iee(E)){l[E]=b;continue}else{const C=see(b,BF[E]);E.startsWith("origin")?(_=!0,u[E]=C):a[E]=C}}if(e.transform||(f||i?a.transform=TAe(e,n.transform,i):a.transform&&(a.transform="none")),_){const{originX:E="50%",originY:b="50%",originZ:C=0}=u;a.transformOrigin=`${E} ${b} ${C}`}}const wAe={offset:"stroke-dashoffset",array:"stroke-dasharray"},CAe={offset:"strokeDashoffset",array:"strokeDasharray"};function RAe(n,e,i=1,a=0,l=!0){n.pathLength=1;const u=l?wAe:CAe;n[u.offset]=Bn.transform(-a);const f=Bn.transform(e),_=Bn.transform(i);n[u.array]=`${f} ${_}`}function rq(n,e,i){return typeof n=="string"?n:Bn.transform(e+i*n)}function IAe(n,e,i){const a=rq(e,n.x,n.width),l=rq(i,n.y,n.height);return`${a} ${l}`}function WF(n,{attrX:e,attrY:i,attrScale:a,originX:l,originY:u,pathLength:f,pathSpacing:_=1,pathOffset:E=0,...b},C,I){if(zF(n,b,I),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:O,style:L,dimensions:M}=n;O.transform&&(M&&(L.transform=O.transform),delete O.transform),M&&(l!==void 0||u!==void 0||L.transform)&&(L.transformOrigin=IAe(M,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(O.x=e),i!==void 0&&(O.y=i),a!==void 0&&(O.scale=a),f!==void 0&&RAe(O,f,_,E,!1)}const GF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),oee=()=>({...GF(),attrs:{}}),HF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function aee(n,{style:e,vars:i},a,l){Object.assign(n.style,e,l&&l.getProjectionStyles(a));for(const u in i)n.style.setProperty(u,i[u])}const cee=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function lee(n,e,i,a){aee(n,e,void 0,a);for(const l in e.attrs)n.setAttribute(cee.has(l)?l:MF(l),e.attrs[l])}const kk={};function AAe(n){Object.assign(kk,n)}function uee(n,{layout:e,layoutId:i}){return Jy.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!kk[n]||n==="opacity")}function $F(n,e,i){var a;const{style:l}=n,u={};for(const f in l)(lc(l[f])||e.style&&lc(e.style[f])||uee(f,n)||((a=i==null?void 0:i.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(u[f]=l[f]);return u}function dee(n,e,i){const a=$F(n,e,i);for(const l in n)if(lc(n[l])||lc(e[l])){const u=F0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[u]=n[l]}return a}function PAe(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const iq=["x","y","width","height","cx","cy","r"],OAe={useVisualState:nee({scrapeMotionValuesFromProps:dee,createRenderState:oee,onUpdate:({props:n,prevProps:e,current:i,renderState:a,latestValues:l})=>{if(!i)return;let u=!!n.drag;if(!u){for(const _ in l)if(Jy.has(_)){u=!0;break}}if(!u)return;let f=!e;if(e)for(let _=0;_<iq.length;_++){const E=iq[_];n[E]!==e[E]&&(f=!0)}f&&ss.read(()=>{PAe(i,a),ss.render(()=>{WF(a,l,HF(i.tagName),n.transformTemplate),lee(i,a)})})}})},kAe={useVisualState:nee({scrapeMotionValuesFromProps:$F,createRenderState:GF})};function hee(n,e,i){for(const a in e)!lc(e[a])&&!uee(a,i)&&(n[a]=e[a])}function NAe({transformTemplate:n},e){return N.useMemo(()=>{const i=GF();return zF(i,e,n),Object.assign({},i.vars,i.style)},[e])}function DAe(n,e){const i=n.style||{},a={};return hee(a,i,n),Object.assign(a,NAe(n,e)),a}function xAe(n,e){const i={},a=DAe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}function LAe(n,e,i,a){const l=N.useMemo(()=>{const u=oee();return WF(u,e,HF(a),n.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(n.style){const u={};hee(u,n.style,n),l.style={...u,...l.style}}return l}function MAe(n=!1){return(i,a,l,{latestValues:u},f)=>{const E=(VF(i)?LAe:xAe)(a,u,f,i),b=JIe(a,typeof i=="string",n),C=i!==N.Fragment?{...b,...E,ref:l}:{},{children:I}=a,O=N.useMemo(()=>lc(I)?I.get():I,[I]);return N.createElement(i,{...C,children:O})}}function UAe(n,e){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...VF(a)?OAe:kAe,preloadedFeatures:n,useRender:MAe(l),createVisualElement:e,Component:a};return oAe(f)}}function pee(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}function ON(n,e,i){const a=n.getProps();return FF(a,e,i!==void 0?i:a.custom,n)}const VAe=DF(()=>window.ScrollTimeline!==void 0);class FAe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let a=0;a<this.animations.length;a++)this.animations[a][e]=i}attachTimeline(e,i){const a=this.animations.map(l=>{if(VAe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{a.forEach((l,u)=>{l&&l(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class jAe extends FAe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function KF(n,e){return n?n[e]||n.default||n:void 0}const UU=2e4;function fee(n){let e=0;const i=50;let a=n.next(e);for(;!a.done&&e<UU;)e+=i,a=n.next(e);return e>=UU?1/0:e}function qF(n){return typeof n=="function"}function sq(n,e){n.timeline=e,n.onfinish=null}const YF=n=>Array.isArray(n)&&typeof n[0]=="number",BAe={linearEasing:void 0};function zAe(n,e){const i=DF(n);return()=>{var a;return(a=BAe[e])!==null&&a!==void 0?a:i()}}const Nk=zAe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),mee=(n,e,i=10)=>{let a="";const l=Math.max(Math.round(e/i),2);for(let u=0;u<l;u++)a+=n(m0(0,l-1,u))+", ";return`linear(${a.substring(0,a.length-2)})`};function gee(n){return!!(typeof n=="function"&&Nk()||!n||typeof n=="string"&&(n in VU||Nk())||YF(n)||Array.isArray(n)&&n.every(gee))}const Uw=([n,e,i,a])=>`cubic-bezier(${n}, ${e}, ${i}, ${a})`,VU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Uw([0,.65,.55,1]),circOut:Uw([.55,0,1,.45]),backIn:Uw([.31,.01,.66,-.59]),backOut:Uw([.33,1.53,.69,.99])};function _ee(n,e){if(n)return typeof n=="function"&&Nk()?mee(n,e):YF(n)?Uw(n):Array.isArray(n)?n.map(i=>_ee(i,e)||VU.easeOut):VU[n]}const qd={x:!1,y:!1};function yee(){return qd.x||qd.y}function WAe(n,e,i){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const u=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return u?Array.from(u):[]}return Array.from(n)}function Eee(n,e){const i=WAe(n),a=new AbortController,l={passive:!0,...e,signal:a.signal};return[i,l,()=>a.abort()]}function oq(n){return e=>{e.pointerType==="touch"||yee()||n(e)}}function GAe(n,e,i={}){const[a,l,u]=Eee(n,i),f=oq(_=>{const{target:E}=_,b=e(_);if(typeof b!="function"||!E)return;const C=oq(I=>{b(I),E.removeEventListener("pointerleave",C)});E.addEventListener("pointerleave",C,l)});return a.forEach(_=>{_.addEventListener("pointerenter",f,l)}),u}const vee=(n,e)=>e?n===e?!0:vee(n,e.parentElement):!1,XF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,HAe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function $Ae(n){return HAe.has(n.tagName)||n.tabIndex!==-1}const Vw=new WeakSet;function aq(n){return e=>{e.key==="Enter"&&n(e)}}function CM(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const KAe=(n,e)=>{const i=n.currentTarget;if(!i)return;const a=aq(()=>{if(Vw.has(i))return;CM(i,"down");const l=aq(()=>{CM(i,"up")}),u=()=>CM(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",u,e)});i.addEventListener("keydown",a,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),e)};function cq(n){return XF(n)&&!yee()}function qAe(n,e,i={}){const[a,l,u]=Eee(n,i),f=_=>{const E=_.currentTarget;if(!cq(_)||Vw.has(E))return;Vw.add(E);const b=e(_),C=(L,M)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",O),!(!cq(L)||!Vw.has(E))&&(Vw.delete(E),typeof b=="function"&&b(L,{success:M}))},I=L=>{C(L,i.useGlobalTarget||vee(E,L.target))},O=L=>{C(L,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",O,l)};return a.forEach(_=>{!$Ae(_)&&_.getAttribute("tabindex")===null&&(_.tabIndex=0),(i.useGlobalTarget?window:_).addEventListener("pointerdown",f,l),_.addEventListener("focus",b=>KAe(b,l),l)}),u}function YAe(n){return n==="x"||n==="y"?qd[n]?null:(qd[n]=!0,()=>{qd[n]=!1}):qd.x||qd.y?null:(qd.x=qd.y=!0,()=>{qd.x=qd.y=!1})}const See=new Set(["width","height","top","left","right","bottom",...F0]);let nk;function XAe(){nk=void 0}const _p={now:()=>(nk===void 0&&_p.set(Pa.isProcessing||HIe.useManualTiming?Pa.timestamp:performance.now()),nk),set:n=>{nk=n,queueMicrotask(XAe)}};function JF(n,e){n.indexOf(e)===-1&&n.push(e)}function QF(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class ZF{constructor(){this.subscriptions=[]}add(e){return JF(this.subscriptions,e),()=>QF(this.subscriptions,e)}notify(e,i,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,a);else for(let u=0;u<l;u++){const f=this.subscriptions[u];f&&f(e,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function bee(n,e){return e?n*(1e3/e):0}const lq=30,JAe=n=>!isNaN(parseFloat(n));class QAe{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const u=_p.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=_p.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=JAe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new ZF);const a=this.events[e].add(i);return e==="change"?()=>{a(),ss.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-a}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=_p.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>lq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,lq);return bee(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function AC(n,e){return new QAe(n,e)}function ZAe(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,AC(i))}function ePe(n,e){const i=ON(n,e);let{transitionEnd:a={},transition:l={},...u}=i||{};u={...u,...a};for(const f in u){const _=hAe(u[f]);ZAe(n,f,_)}}function tPe(n){return!!(lc(n)&&n.add)}function FU(n,e){const i=n.getValue("willChange");if(tPe(i))return i.add(e)}function Tee(n){return n.props[ZZ]}const wee=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,nPe=1e-7,rPe=12;function iPe(n,e,i,a,l){let u,f,_=0;do f=e+(i-e)/2,u=wee(f,a,l)-n,u>0?i=f:e=f;while(Math.abs(u)>nPe&&++_<rPe);return f}function eR(n,e,i,a){if(n===e&&i===a)return ru;const l=u=>iPe(u,0,1,n,i);return u=>u===0||u===1?u:wee(l(u),e,a)}const Cee=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,Ree=n=>e=>1-n(1-e),Iee=eR(.33,1.53,.69,.99),ej=Ree(Iee),Aee=Cee(ej),Pee=n=>(n*=2)<1?.5*ej(n):.5*(2-Math.pow(2,-10*(n-1))),tj=n=>1-Math.sin(Math.acos(n)),Oee=Ree(tj),kee=Cee(tj),Nee=n=>/^0[^.\s]+$/u.test(n);function sPe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Nee(n):!0}const rC=n=>Math.round(n*1e5)/1e5,nj=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function oPe(n){return n==null}const aPe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,rj=(n,e)=>i=>!!(typeof i=="string"&&aPe.test(i)&&i.startsWith(n)||e&&!oPe(i)&&Object.prototype.hasOwnProperty.call(i,e)),Dee=(n,e,i)=>a=>{if(typeof a!="string")return a;const[l,u,f,_]=a.match(nj);return{[n]:parseFloat(l),[e]:parseFloat(u),[i]:parseFloat(f),alpha:_!==void 0?parseFloat(_):1}},cPe=n=>$f(0,255,n),RM={...j0,transform:n=>Math.round(cPe(n))},Ty={test:rj("rgb","red"),parse:Dee("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:a=1})=>"rgba("+RM.transform(n)+", "+RM.transform(e)+", "+RM.transform(i)+", "+rC(IC.transform(a))+")"};function lPe(n){let e="",i="",a="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,a+=a,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const jU={test:rj("#"),parse:lPe,transform:Ty.transform},zS={test:rj("hsl","hue"),parse:Dee("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+gp.transform(rC(e))+", "+gp.transform(rC(i))+", "+rC(IC.transform(a))+")"},oc={test:n=>Ty.test(n)||jU.test(n)||zS.test(n),parse:n=>Ty.test(n)?Ty.parse(n):zS.test(n)?zS.parse(n):jU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Ty.transform(n):zS.transform(n)},uPe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function dPe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(nj))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(uPe))===null||i===void 0?void 0:i.length)||0)>0}const xee="number",Lee="color",hPe="var",pPe="var(",uq="${}",fPe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function PC(n){const e=n.toString(),i=[],a={color:[],number:[],var:[]},l=[];let u=0;const _=e.replace(fPe,E=>(oc.test(E)?(a.color.push(u),l.push(Lee),i.push(oc.parse(E))):E.startsWith(pPe)?(a.var.push(u),l.push(hPe),i.push(E)):(a.number.push(u),l.push(xee),i.push(parseFloat(E))),++u,uq)).split(uq);return{values:i,split:_,indexes:a,types:l}}function Mee(n){return PC(n).values}function Uee(n){const{split:e,types:i}=PC(n),a=e.length;return l=>{let u="";for(let f=0;f<a;f++)if(u+=e[f],l[f]!==void 0){const _=i[f];_===xee?u+=rC(l[f]):_===Lee?u+=oc.transform(l[f]):u+=l[f]}return u}}const mPe=n=>typeof n=="number"?0:n;function gPe(n){const e=Mee(n);return Uee(n)(e.map(mPe))}const kg={test:dPe,parse:Mee,createTransformer:Uee,getAnimatableNone:gPe},_Pe=new Set(["brightness","contrast","saturate","opacity"]);function yPe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[a]=i.match(nj)||[];if(!a)return n;const l=i.replace(a,"");let u=_Pe.has(e)?1:0;return a!==i&&(u*=100),e+"("+u+l+")"}const EPe=/\b([a-z-]*)\(.*?\)/gu,BU={...kg,getAnimatableNone:n=>{const e=n.match(EPe);return e?e.map(yPe).join(" "):n}},vPe={...BF,color:oc,backgroundColor:oc,outlineColor:oc,fill:oc,stroke:oc,borderColor:oc,borderTopColor:oc,borderRightColor:oc,borderBottomColor:oc,borderLeftColor:oc,filter:BU,WebkitFilter:BU},ij=n=>vPe[n];function Vee(n,e){let i=ij(n);return i!==BU&&(i=kg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const SPe=new Set(["auto","none","0"]);function bPe(n,e,i){let a=0,l;for(;a<n.length&&!l;){const u=n[a];typeof u=="string"&&!SPe.has(u)&&PC(u).values.length&&(l=n[a]),a++}if(l&&i)for(const u of e)n[u]=Vee(i,l)}const dq=n=>n===j0||n===Bn,hq=(n,e)=>parseFloat(n.split(", ")[e]),pq=(n,e)=>(i,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return hq(l[1],e);{const u=a.match(/^matrix\((.+)\)$/u);return u?hq(u[1],n):0}},TPe=new Set(["x","y","z"]),wPe=F0.filter(n=>!TPe.has(n));function CPe(n){const e=[];return wPe.forEach(i=>{const a=n.getValue(i);a!==void 0&&(e.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),e}const _0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:pq(4,13),y:pq(5,14)};_0.translateX=_0.x;_0.translateY=_0.y;const ky=new Set;let zU=!1,WU=!1;function Fee(){if(WU){const n=Array.from(ky).filter(a=>a.needsMeasurement),e=new Set(n.map(a=>a.element)),i=new Map;e.forEach(a=>{const l=CPe(a);l.length&&(i.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),e.forEach(a=>{a.render();const l=i.get(a);l&&l.forEach(([u,f])=>{var _;(_=a.getValue(u))===null||_===void 0||_.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}WU=!1,zU=!1,ky.forEach(n=>n.complete()),ky.clear()}function jee(){ky.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(WU=!0)})}function RPe(){jee(),Fee()}class sj{constructor(e,i,a,l,u,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=a,this.motionValue=l,this.element=u,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ky.add(this),zU||(zU=!0,ss.read(jee),ss.resolveKeyframes(Fee))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:a,motionValue:l}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const f=l==null?void 0:l.get(),_=e[e.length-1];if(f!==void 0)e[0]=f;else if(a&&i){const E=a.readValue(i,_);E!=null&&(e[0]=E)}e[0]===void 0&&(e[0]=_),l&&f===void 0&&l.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ky.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ky.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Bee=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),IPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function APe(n){const e=IPe.exec(n);if(!e)return[,];const[,i,a,l]=e;return[`--${i??a}`,l]}function zee(n,e,i=1){const[a,l]=APe(n);if(!a)return;const u=window.getComputedStyle(e).getPropertyValue(a);if(u){const f=u.trim();return Bee(f)?parseFloat(f):f}return jF(l)?zee(l,e,i+1):l}const Wee=n=>e=>e.test(n),PPe={test:n=>n==="auto",parse:n=>n},Gee=[j0,Bn,gp,fg,yAe,_Ae,PPe],fq=n=>Gee.find(Wee(n));class Hee extends sj{constructor(e,i,a,l,u){super(e,i,a,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<e.length;E++){let b=e[E];if(typeof b=="string"&&(b=b.trim(),jF(b))){const C=zee(b,i.current);C!==void 0&&(e[E]=C),E===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!See.has(a)||e.length!==2)return;const[l,u]=e,f=fq(l),_=fq(u);if(f!==_)if(dq(f)&&dq(_))for(let E=0;E<e.length;E++){const b=e[E];typeof b=="string"&&(e[E]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,a=[];for(let l=0;l<e.length;l++)sPe(e[l])&&a.push(l);a.length&&bPe(e,a,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:a}=this;if(!e||!e.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=_0[a](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(a,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:a,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const u=i.getValue(a);u&&u.jump(this.measuredOrigin,!1);const f=l.length-1,_=l[f];l[f]=_0[a](i.measureViewportBox(),window.getComputedStyle(i.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([E,b])=>{i.getValue(E).set(b)}),this.resolveNoneKeyframes()}}const mq=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(kg.test(n)||n==="0")&&!n.startsWith("url("));function OPe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function kPe(n,e,i,a){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=n[n.length-1],f=mq(l,e),_=mq(u,e);return!f||!_?!1:OPe(n)||(i==="spring"||qF(i))&&a}const NPe=n=>n!==null;function kN(n,{repeat:e,repeatType:i="loop"},a){const l=n.filter(NPe),u=e&&i!=="loop"&&e%2===1?0:l.length-1;return!u||a===void 0?l[u]:a}const DPe=40;class $ee{constructor({autoplay:e=!0,delay:i=0,type:a="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:f="loop",..._}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=_p.now(),this.options={autoplay:e,delay:i,type:a,repeat:l,repeatDelay:u,repeatType:f,..._},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>DPe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&RPe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=_p.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:u,delay:f,onComplete:_,onUpdate:E,isGenerator:b}=this.options;if(!b&&!kPe(e,a,l,u))if(f)this.options.duration=0;else{E&&E(kN(e,this.options,i)),_&&_(),this.resolveFinishedPromise();return}const C=this.initPlayback(e,i);C!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Es=(n,e,i)=>n+(e-n)*i;function IM(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function xPe({hue:n,saturation:e,lightness:i,alpha:a}){n/=360,e/=100,i/=100;let l=0,u=0,f=0;if(!e)l=u=f=i;else{const _=i<.5?i*(1+e):i+e-i*e,E=2*i-_;l=IM(E,_,n+1/3),u=IM(E,_,n),f=IM(E,_,n-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(f*255),alpha:a}}function Dk(n,e){return i=>i>0?e:n}const AM=(n,e,i)=>{const a=n*n,l=i*(e*e-a)+a;return l<0?0:Math.sqrt(l)},LPe=[jU,Ty,zS],MPe=n=>LPe.find(e=>e.test(n));function gq(n){const e=MPe(n);if(!e)return!1;let i=e.parse(n);return e===zS&&(i=xPe(i)),i}const _q=(n,e)=>{const i=gq(n),a=gq(e);if(!i||!a)return Dk(n,e);const l={...i};return u=>(l.red=AM(i.red,a.red,u),l.green=AM(i.green,a.green,u),l.blue=AM(i.blue,a.blue,u),l.alpha=Es(i.alpha,a.alpha,u),Ty.transform(l))},UPe=(n,e)=>i=>e(n(i)),tR=(...n)=>n.reduce(UPe),GU=new Set(["none","hidden"]);function VPe(n,e){return GU.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function FPe(n,e){return i=>Es(n,e,i)}function oj(n){return typeof n=="number"?FPe:typeof n=="string"?jF(n)?Dk:oc.test(n)?_q:zPe:Array.isArray(n)?Kee:typeof n=="object"?oc.test(n)?_q:jPe:Dk}function Kee(n,e){const i=[...n],a=i.length,l=n.map((u,f)=>oj(u)(u,e[f]));return u=>{for(let f=0;f<a;f++)i[f]=l[f](u);return i}}function jPe(n,e){const i={...n,...e},a={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(a[l]=oj(n[l])(n[l],e[l]));return l=>{for(const u in a)i[u]=a[u](l);return i}}function BPe(n,e){var i;const a=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const f=e.types[u],_=n.indexes[f][l[f]],E=(i=n.values[_])!==null&&i!==void 0?i:0;a[u]=E,l[f]++}return a}const zPe=(n,e)=>{const i=kg.createTransformer(e),a=PC(n),l=PC(e);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?GU.has(n)&&!l.values.length||GU.has(e)&&!a.values.length?VPe(n,e):tR(Kee(BPe(a,l),l.values),i):Dk(n,e)};function qee(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?Es(n,e,i):oj(n)(n,e)}const WPe=5;function Yee(n,e,i){const a=Math.max(e-WPe,0);return bee(i-n(a),e-a)}const Bs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},yq=.001;function GPe({duration:n=Bs.duration,bounce:e=Bs.bounce,velocity:i=Bs.velocity,mass:a=Bs.mass}){let l,u,f=1-e;f=$f(Bs.minDamping,Bs.maxDamping,f),n=$f(Bs.minDuration,Bs.maxDuration,Uf(n)),f<1?(l=b=>{const C=b*f,I=C*n,O=C-i,L=HU(b,f),M=Math.exp(-I);return yq-O/L*M},u=b=>{const I=b*f*n,O=I*i+i,L=Math.pow(f,2)*Math.pow(b,2)*n,M=Math.exp(-I),F=HU(Math.pow(b,2),f);return(-l(b)+yq>0?-1:1)*((O-L)*M)/F}):(l=b=>{const C=Math.exp(-b*n),I=(b-i)*n+1;return-.001+C*I},u=b=>{const C=Math.exp(-b*n),I=(i-b)*(n*n);return C*I});const _=5/n,E=$Pe(l,u,_);if(n=Mf(n),isNaN(E))return{stiffness:Bs.stiffness,damping:Bs.damping,duration:n};{const b=Math.pow(E,2)*a;return{stiffness:b,damping:f*2*Math.sqrt(a*b),duration:n}}}const HPe=12;function $Pe(n,e,i){let a=i;for(let l=1;l<HPe;l++)a=a-n(a)/e(a);return a}function HU(n,e){return n*Math.sqrt(1-e*e)}const KPe=["duration","bounce"],qPe=["stiffness","damping","mass"];function Eq(n,e){return e.some(i=>n[i]!==void 0)}function YPe(n){let e={velocity:Bs.velocity,stiffness:Bs.stiffness,damping:Bs.damping,mass:Bs.mass,isResolvedFromDuration:!1,...n};if(!Eq(n,qPe)&&Eq(n,KPe))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),l=a*a,u=2*$f(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Bs.mass,stiffness:l,damping:u}}else{const i=GPe(n);e={...e,...i,mass:Bs.mass},e.isResolvedFromDuration=!0}return e}function Xee(n=Bs.visualDuration,e=Bs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:a,restDelta:l}=i;const u=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],_={done:!1,value:u},{stiffness:E,damping:b,mass:C,duration:I,velocity:O,isResolvedFromDuration:L}=YPe({...i,velocity:-Uf(i.velocity||0)}),M=O||0,F=b/(2*Math.sqrt(E*C)),z=f-u,X=Uf(Math.sqrt(E/C)),K=Math.abs(z)<5;a||(a=K?Bs.restSpeed.granular:Bs.restSpeed.default),l||(l=K?Bs.restDelta.granular:Bs.restDelta.default);let ne;if(F<1){const ae=HU(X,F);ne=le=>{const Y=Math.exp(-F*X*le);return f-Y*((M+F*X*z)/ae*Math.sin(ae*le)+z*Math.cos(ae*le))}}else if(F===1)ne=ae=>f-Math.exp(-X*ae)*(z+(M+X*z)*ae);else{const ae=X*Math.sqrt(F*F-1);ne=le=>{const Y=Math.exp(-F*X*le),Z=Math.min(ae*le,300);return f-Y*((M+F*X*z)*Math.sinh(Z)+ae*z*Math.cosh(Z))/ae}}const oe={calculatedDuration:L&&I||null,next:ae=>{const le=ne(ae);if(L)_.done=ae>=I;else{let Y=0;F<1&&(Y=ae===0?Mf(M):Yee(ne,ae,le));const Z=Math.abs(Y)<=a,Q=Math.abs(f-le)<=l;_.done=Z&&Q}return _.value=_.done?f:le,_},toString:()=>{const ae=Math.min(fee(oe),UU),le=mee(Y=>oe.next(ae*Y).value,ae,30);return ae+"ms "+le}};return oe}function vq({keyframes:n,velocity:e=0,power:i=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:f,min:_,max:E,restDelta:b=.5,restSpeed:C}){const I=n[0],O={done:!1,value:I},L=Z=>_!==void 0&&Z<_||E!==void 0&&Z>E,M=Z=>_===void 0?E:E===void 0||Math.abs(_-Z)<Math.abs(E-Z)?_:E;let F=i*e;const z=I+F,X=f===void 0?z:f(z);X!==z&&(F=X-I);const K=Z=>-F*Math.exp(-Z/a),ne=Z=>X+K(Z),oe=Z=>{const Q=K(Z),ie=ne(Z);O.done=Math.abs(Q)<=b,O.value=O.done?X:ie};let ae,le;const Y=Z=>{L(O.value)&&(ae=Z,le=Xee({keyframes:[O.value,M(O.value)],velocity:Yee(ne,Z,O.value),damping:l,stiffness:u,restDelta:b,restSpeed:C}))};return Y(0),{calculatedDuration:null,next:Z=>{let Q=!1;return!le&&ae===void 0&&(Q=!0,oe(Z),Y(Z)),ae!==void 0&&Z>=ae?le.next(Z-ae):(!Q&&oe(Z),O)}}}const XPe=eR(.42,0,1,1),JPe=eR(0,0,.58,1),Jee=eR(.42,0,.58,1),QPe=n=>Array.isArray(n)&&typeof n[0]!="number",ZPe={linear:ru,easeIn:XPe,easeInOut:Jee,easeOut:JPe,circIn:tj,circInOut:kee,circOut:Oee,backIn:ej,backInOut:Aee,backOut:Iee,anticipate:Pee},Sq=n=>{if(YF(n)){qZ(n.length===4);const[e,i,a,l]=n;return eR(e,i,a,l)}else if(typeof n=="string")return ZPe[n];return n};function eOe(n,e,i){const a=[],l=i||qee,u=n.length-1;for(let f=0;f<u;f++){let _=l(n[f],n[f+1]);if(e){const E=Array.isArray(e)?e[f]||ru:e;_=tR(E,_)}a.push(_)}return a}function tOe(n,e,{clamp:i=!0,ease:a,mixer:l}={}){const u=n.length;if(qZ(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const f=n[0]===n[1];n[0]>n[u-1]&&(n=[...n].reverse(),e=[...e].reverse());const _=eOe(e,a,l),E=_.length,b=C=>{if(f&&C<n[0])return e[0];let I=0;if(E>1)for(;I<n.length-2&&!(C<n[I+1]);I++);const O=m0(n[I],n[I+1],C);return _[I](O)};return i?C=>b($f(n[0],n[u-1],C)):b}function nOe(n,e){const i=n[n.length-1];for(let a=1;a<=e;a++){const l=m0(0,e,a);n.push(Es(i,1,l))}}function rOe(n){const e=[0];return nOe(e,n.length-1),e}function iOe(n,e){return n.map(i=>i*e)}function sOe(n,e){return n.map(()=>e||Jee).splice(0,n.length-1)}function xk({duration:n=300,keyframes:e,times:i,ease:a="easeInOut"}){const l=QPe(a)?a.map(Sq):Sq(a),u={done:!1,value:e[0]},f=iOe(i&&i.length===e.length?i:rOe(e),n),_=tOe(f,e,{ease:Array.isArray(l)?l:sOe(e,l)});return{calculatedDuration:n,next:E=>(u.value=_(E),u.done=E>=n,u)}}const oOe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>ss.update(e,!0),stop:()=>Og(e),now:()=>Pa.isProcessing?Pa.timestamp:_p.now()}},aOe={decay:vq,inertia:vq,tween:xk,keyframes:xk,spring:Xee},cOe=n=>n/100;class aj extends $ee{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:a,element:l,keyframes:u}=this.options,f=(l==null?void 0:l.KeyframeResolver)||sj,_=(E,b)=>this.onKeyframesResolved(E,b);this.resolver=new f(u,_,i,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:u,velocity:f=0}=this.options,_=qF(i)?i:aOe[i]||xk;let E,b;_!==xk&&typeof e[0]!="number"&&(E=tR(cOe,qee(e[0],e[1])),e=[0,100]);const C=_({...this.options,keyframes:e});u==="mirror"&&(b=_({...this.options,keyframes:[...e].reverse(),velocity:-f})),C.calculatedDuration===null&&(C.calculatedDuration=fee(C));const{calculatedDuration:I}=C,O=I+l,L=O*(a+1)-l;return{generator:C,mirroredGenerator:b,mapPercentToKeyframes:E,calculatedDuration:I,resolvedDuration:O,totalDuration:L}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:a}=this;if(!a){const{keyframes:Z}=this.options;return{done:!0,value:Z[Z.length-1]}}const{finalKeyframe:l,generator:u,mirroredGenerator:f,mapPercentToKeyframes:_,keyframes:E,calculatedDuration:b,totalDuration:C,resolvedDuration:I}=a;if(this.startTime===null)return u.next(0);const{delay:O,repeat:L,repeatType:M,repeatDelay:F,onUpdate:z}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-C/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const X=this.currentTime-O*(this.speed>=0?1:-1),K=this.speed>=0?X<0:X>C;this.currentTime=Math.max(X,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let ne=this.currentTime,oe=u;if(L){const Z=Math.min(this.currentTime,C)/I;let Q=Math.floor(Z),ie=Z%1;!ie&&Z>=1&&(ie=1),ie===1&&Q--,Q=Math.min(Q,L+1),!!(Q%2)&&(M==="reverse"?(ie=1-ie,F&&(ie-=F/I)):M==="mirror"&&(oe=f)),ne=$f(0,1,ie)*I}const ae=K?{done:!1,value:E[0]}:oe.next(ne);_&&(ae.value=_(ae.value));let{done:le}=ae;!K&&b!==null&&(le=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const Y=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&le);return Y&&l!==void 0&&(ae.value=kN(E,this.options,l)),z&&z(ae.value),Y&&this.finish(),ae}get duration(){const{resolved:e}=this;return e?Uf(e.calculatedDuration):0}get time(){return Uf(this.currentTime)}set time(e){e=Mf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Uf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=oOe,onPlay:i,startTime:a}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const lOe=new Set(["opacity","clipPath","filter","transform"]);function uOe(n,e,i,{delay:a=0,duration:l=300,repeat:u=0,repeatType:f="loop",ease:_="easeInOut",times:E}={}){const b={[e]:i};E&&(b.offset=E);const C=_ee(_,l);return Array.isArray(C)&&(b.easing=C),n.animate(b,{delay:a,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:u+1,direction:f==="reverse"?"alternate":"normal"})}const dOe=DF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Lk=10,hOe=2e4;function pOe(n){return qF(n.type)||n.type==="spring"||!gee(n.ease)}function fOe(n,e){const i=new aj({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let u=0;for(;!a.done&&u<hOe;)a=i.sample(u),l.push(a.value),u+=Lk;return{times:void 0,keyframes:l,duration:u-Lk,ease:"linear"}}const Qee={anticipate:Pee,backInOut:Aee,circInOut:kee};function mOe(n){return n in Qee}class bq extends $ee{constructor(e){super(e);const{name:i,motionValue:a,element:l,keyframes:u}=this.options;this.resolver=new Hee(u,(f,_)=>this.onKeyframesResolved(f,_),i,a,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:a=300,times:l,ease:u,type:f,motionValue:_,name:E,startTime:b}=this.options;if(!_.owner||!_.owner.current)return!1;if(typeof u=="string"&&Nk()&&mOe(u)&&(u=Qee[u]),pOe(this.options)){const{onComplete:I,onUpdate:O,motionValue:L,element:M,...F}=this.options,z=fOe(e,F);e=z.keyframes,e.length===1&&(e[1]=e[0]),a=z.duration,l=z.times,u=z.ease,f="keyframes"}const C=uOe(_.owner.current,E,e,{...this.options,duration:a,times:l,ease:u});return C.startTime=b??this.calcStartTime(),this.pendingTimeline?(sq(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:I}=this.options;_.set(kN(e,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:a,times:l,type:f,ease:u,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Uf(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Uf(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.currentTime=Mf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return ru;const{animation:a}=i;sq(a,e)}return ru}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:a,duration:l,type:u,ease:f,times:_}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:C,onComplete:I,element:O,...L}=this.options,M=new aj({...L,keyframes:a,duration:l,type:u,ease:f,times:_,isGenerator:!0}),F=Mf(this.time);b.setWithVelocity(M.sample(F-Lk).value,M.sample(F).value,Lk)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:a,repeatDelay:l,repeatType:u,damping:f,type:_}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:b}=i.owner.getProps();return dOe()&&a&&lOe.has(a)&&!E&&!b&&!l&&u!=="mirror"&&f!==0&&_!=="inertia"}}const gOe={type:"spring",stiffness:500,damping:25,restSpeed:10},_Oe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),yOe={type:"keyframes",duration:.8},EOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},vOe=(n,{keyframes:e})=>e.length>2?yOe:Jy.has(n)?n.startsWith("scale")?_Oe(e[1]):gOe:EOe;function SOe({when:n,delay:e,delayChildren:i,staggerChildren:a,staggerDirection:l,repeat:u,repeatType:f,repeatDelay:_,from:E,elapsed:b,...C}){return!!Object.keys(C).length}const cj=(n,e,i,a={},l,u)=>f=>{const _=KF(a,n)||{},E=_.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Mf(E);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),..._,delay:-b,onUpdate:O=>{e.set(O),_.onUpdate&&_.onUpdate(O)},onComplete:()=>{f(),_.onComplete&&_.onComplete()},name:n,motionValue:e,element:u?void 0:l};SOe(_)||(C={...C,...vOe(n,C)}),C.duration&&(C.duration=Mf(C.duration)),C.repeatDelay&&(C.repeatDelay=Mf(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(I=!0)),I&&!u&&e.get()!==void 0){const O=kN(C.keyframes,_);if(O!==void 0)return ss.update(()=>{C.onUpdate(O),C.onComplete()}),new jAe([])}return!u&&bq.supports(C)?new bq(C):new aj(C)};function bOe({protectedKeys:n,needsAnimating:e},i){const a=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,a}function Zee(n,e,{delay:i=0,transitionOverride:a,type:l}={}){var u;let{transition:f=n.getDefaultTransition(),transitionEnd:_,...E}=e;a&&(f=a);const b=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const I in E){const O=n.getValue(I,(u=n.latestValues[I])!==null&&u!==void 0?u:null),L=E[I];if(L===void 0||C&&bOe(C,I))continue;const M={delay:i,...KF(f||{},I)};let F=!1;if(window.MotionHandoffAnimation){const X=Tee(n);if(X){const K=window.MotionHandoffAnimation(X,I,ss);K!==null&&(M.startTime=K,F=!0)}}FU(n,I),O.start(cj(I,O,L,n.shouldReduceMotion&&See.has(I)?{type:!1}:M,n,F));const z=O.animation;z&&b.push(z)}return _&&Promise.all(b).then(()=>{ss.update(()=>{_&&ePe(n,_)})}),b}function $U(n,e,i={}){var a;const l=ON(n,e,i.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:u=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(u=i.transitionOverride);const f=l?()=>Promise.all(Zee(n,l,i)):()=>Promise.resolve(),_=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:C=0,staggerChildren:I,staggerDirection:O}=u;return TOe(n,e,C+b,I,O,i)}:()=>Promise.resolve(),{when:E}=u;if(E){const[b,C]=E==="beforeChildren"?[f,_]:[_,f];return b().then(()=>C())}else return Promise.all([f(),_(i.delay)])}function TOe(n,e,i=0,a=0,l=1,u){const f=[],_=(n.variantChildren.size-1)*a,E=l===1?(b=0)=>b*a:(b=0)=>_-b*a;return Array.from(n.variantChildren).sort(wOe).forEach((b,C)=>{b.notify("AnimationStart",e),f.push($U(b,e,{...u,delay:i+E(C)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(f)}function wOe(n,e){return n.sortNodePosition(e)}function COe(n,e,i={}){n.notify("AnimationStart",e);let a;if(Array.isArray(e)){const l=e.map(u=>$U(n,u,i));a=Promise.all(l)}else if(typeof e=="string")a=$U(n,e,i);else{const l=typeof e=="function"?ON(n,e,i.custom):e;a=Promise.all(Zee(n,l,i))}return a.then(()=>{n.notify("AnimationComplete",e)})}const ROe=LF.length;function ete(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?ete(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<ROe;i++){const a=LF[i],l=n.props[a];(RC(l)||l===!1)&&(e[a]=l)}return e}const IOe=[...xF].reverse(),AOe=xF.length;function POe(n){return e=>Promise.all(e.map(({animation:i,options:a})=>COe(n,i,a)))}function OOe(n){let e=POe(n),i=Tq(),a=!0;const l=E=>(b,C)=>{var I;const O=ON(n,C,E==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(O){const{transition:L,transitionEnd:M,...F}=O;b={...b,...F,...M}}return b};function u(E){e=E(n)}function f(E){const{props:b}=n,C=ete(n.parent)||{},I=[],O=new Set;let L={},M=1/0;for(let z=0;z<AOe;z++){const X=IOe[z],K=i[X],ne=b[X]!==void 0?b[X]:C[X],oe=RC(ne),ae=X===E?K.isActive:null;ae===!1&&(M=z);let le=ne===C[X]&&ne!==b[X]&&oe;if(le&&a&&n.manuallyAnimateOnMount&&(le=!1),K.protectedKeys={...L},!K.isActive&&ae===null||!ne&&!K.prevProp||AN(ne)||typeof ne=="boolean")continue;const Y=kOe(K.prevProp,ne);let Z=Y||X===E&&K.isActive&&!le&&oe||z>M&&oe,Q=!1;const ie=Array.isArray(ne)?ne:[ne];let de=ie.reduce(l(X),{});ae===!1&&(de={});const{prevResolvedValues:ue={}}=K,pe={...ue,...de},ke=Oe=>{Z=!0,O.has(Oe)&&(Q=!0,O.delete(Oe)),K.needsAnimating[Oe]=!0;const we=n.getValue(Oe);we&&(we.liveStyle=!1)};for(const Oe in pe){const we=de[Oe],Se=ue[Oe];if(L.hasOwnProperty(Oe))continue;let Be=!1;MU(we)&&MU(Se)?Be=!pee(we,Se):Be=we!==Se,Be?we!=null?ke(Oe):O.add(Oe):we!==void 0&&O.has(Oe)?ke(Oe):K.protectedKeys[Oe]=!0}K.prevProp=ne,K.prevResolvedValues=de,K.isActive&&(L={...L,...de}),a&&n.blockInitialAnimation&&(Z=!1),Z&&(!(le&&Y)||Q)&&I.push(...ie.map(Oe=>({animation:Oe,options:{type:X}})))}if(O.size){const z={};O.forEach(X=>{const K=n.getBaseTarget(X),ne=n.getValue(X);ne&&(ne.liveStyle=!0),z[X]=K??null}),I.push({animation:z})}let F=!!I.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(F=!1),a=!1,F?e(I):Promise.resolve()}function _(E,b){var C;if(i[E].isActive===b)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(O=>{var L;return(L=O.animationState)===null||L===void 0?void 0:L.setActive(E,b)}),i[E].isActive=b;const I=f(E);for(const O in i)i[O].protectedKeys={};return I}return{animateChanges:f,setActive:_,setAnimateFunction:u,getState:()=>i,reset:()=>{i=Tq(),a=!0}}}function kOe(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!pee(e,n):!1}function fy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Tq(){return{animate:fy(!0),whileInView:fy(),whileHover:fy(),whileTap:fy(),whileDrag:fy(),whileFocus:fy(),exit:fy()}}class Bg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class NOe extends Bg{constructor(e){super(e),e.animationState||(e.animationState=OOe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();AN(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let DOe=0;class xOe extends Bg{constructor(){super(...arguments),this.id=DOe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const LOe={animation:{Feature:NOe},exit:{Feature:xOe}};function OC(n,e,i,a={passive:!0}){return n.addEventListener(e,i,a),()=>n.removeEventListener(e,i)}function nR(n){return{point:{x:n.pageX,y:n.pageY}}}const MOe=n=>e=>XF(e)&&n(e,nR(e));function iC(n,e,i,a){return OC(n,e,MOe(i),a)}const wq=(n,e)=>Math.abs(n-e);function UOe(n,e){const i=wq(n.x,e.x),a=wq(n.y,e.y);return Math.sqrt(i**2+a**2)}class tte{constructor(e,i,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=OM(this.lastMoveEventInfo,this.history),O=this.startEvent!==null,L=UOe(I.offset,{x:0,y:0})>=3;if(!O&&!L)return;const{point:M}=I,{timestamp:F}=Pa;this.history.push({...M,timestamp:F});const{onStart:z,onMove:X}=this.handlers;O||(z&&z(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),X&&X(this.lastMoveEvent,I)},this.handlePointerMove=(I,O)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=PM(O,this.transformPagePoint),ss.update(this.updatePoint,!0)},this.handlePointerUp=(I,O)=>{this.end();const{onEnd:L,onSessionEnd:M,resumeAnimation:F}=this.handlers;if(this.dragSnapToOrigin&&F&&F(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=OM(I.type==="pointercancel"?this.lastMoveEventInfo:PM(O,this.transformPagePoint),this.history);this.startEvent&&L&&L(I,z),M&&M(I,z)},!XF(e))return;this.dragSnapToOrigin=u,this.handlers=i,this.transformPagePoint=a,this.contextWindow=l||window;const f=nR(e),_=PM(f,this.transformPagePoint),{point:E}=_,{timestamp:b}=Pa;this.history=[{...E,timestamp:b}];const{onSessionStart:C}=i;C&&C(e,OM(_,this.history)),this.removeListeners=tR(iC(this.contextWindow,"pointermove",this.handlePointerMove),iC(this.contextWindow,"pointerup",this.handlePointerUp),iC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Og(this.updatePoint)}}function PM(n,e){return e?{point:e(n.point)}:n}function Cq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function OM({point:n},e){return{point:n,delta:Cq(n,nte(e)),offset:Cq(n,VOe(e)),velocity:FOe(e,.1)}}function VOe(n){return n[0]}function nte(n){return n[n.length-1]}function FOe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=nte(n);for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>Mf(e)));)i--;if(!a)return{x:0,y:0};const u=Uf(l.timestamp-a.timestamp);if(u===0)return{x:0,y:0};const f={x:(l.x-a.x)/u,y:(l.y-a.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const rte=1e-4,jOe=1-rte,BOe=1+rte,ite=.01,zOe=0-ite,WOe=0+ite;function ou(n){return n.max-n.min}function GOe(n,e,i){return Math.abs(n-e)<=i}function Rq(n,e,i,a=.5){n.origin=a,n.originPoint=Es(e.min,e.max,n.origin),n.scale=ou(i)/ou(e),n.translate=Es(i.min,i.max,n.origin)-n.originPoint,(n.scale>=jOe&&n.scale<=BOe||isNaN(n.scale))&&(n.scale=1),(n.translate>=zOe&&n.translate<=WOe||isNaN(n.translate))&&(n.translate=0)}function sC(n,e,i,a){Rq(n.x,e.x,i.x,a?a.originX:void 0),Rq(n.y,e.y,i.y,a?a.originY:void 0)}function Iq(n,e,i){n.min=i.min+e.min,n.max=n.min+ou(e)}function HOe(n,e,i){Iq(n.x,e.x,i.x),Iq(n.y,e.y,i.y)}function Aq(n,e,i){n.min=e.min-i.min,n.max=n.min+ou(e)}function oC(n,e,i){Aq(n.x,e.x,i.x),Aq(n.y,e.y,i.y)}function $Oe(n,{min:e,max:i},a){return e!==void 0&&n<e?n=a?Es(e,n,a.min):Math.max(n,e):i!==void 0&&n>i&&(n=a?Es(i,n,a.max):Math.min(n,i)),n}function Pq(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function KOe(n,{top:e,left:i,bottom:a,right:l}){return{x:Pq(n.x,i,l),y:Pq(n.y,e,a)}}function Oq(n,e){let i=e.min-n.min,a=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function qOe(n,e){return{x:Oq(n.x,e.x),y:Oq(n.y,e.y)}}function YOe(n,e){let i=.5;const a=ou(n),l=ou(e);return l>a?i=m0(e.min,e.max-a,n.min):a>l&&(i=m0(n.min,n.max-l,e.min)),$f(0,1,i)}function XOe(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const KU=.35;function JOe(n=KU){return n===!1?n=0:n===!0&&(n=KU),{x:kq(n,"left","right"),y:kq(n,"top","bottom")}}function kq(n,e,i){return{min:Nq(n,e),max:Nq(n,i)}}function Nq(n,e){return typeof n=="number"?n:n[e]||0}const Dq=()=>({translate:0,scale:1,origin:0,originPoint:0}),WS=()=>({x:Dq(),y:Dq()}),xq=()=>({min:0,max:0}),Qs=()=>({x:xq(),y:xq()});function Yu(n){return[n("x"),n("y")]}function ste({top:n,left:e,right:i,bottom:a}){return{x:{min:e,max:i},y:{min:n,max:a}}}function QOe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function ZOe(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),a=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function kM(n){return n===void 0||n===1}function qU({scale:n,scaleX:e,scaleY:i}){return!kM(n)||!kM(e)||!kM(i)}function gy(n){return qU(n)||ote(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function ote(n){return Lq(n.x)||Lq(n.y)}function Lq(n){return n&&n!=="0%"}function Mk(n,e,i){const a=n-i,l=e*a;return i+l}function Mq(n,e,i,a,l){return l!==void 0&&(n=Mk(n,l,a)),Mk(n,i,a)+e}function YU(n,e=0,i=1,a,l){n.min=Mq(n.min,e,i,a,l),n.max=Mq(n.max,e,i,a,l)}function ate(n,{x:e,y:i}){YU(n.x,e.translate,e.scale,e.originPoint),YU(n.y,i.translate,i.scale,i.originPoint)}const Uq=.999999999999,Vq=1.0000000000001;function eke(n,e,i,a=!1){const l=i.length;if(!l)return;e.x=e.y=1;let u,f;for(let _=0;_<l;_++){u=i[_],f=u.projectionDelta;const{visualElement:E}=u.options;E&&E.props.style&&E.props.style.display==="contents"||(a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&HS(n,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),f&&(e.x*=f.x.scale,e.y*=f.y.scale,ate(n,f)),a&&gy(u.latestValues)&&HS(n,u.latestValues))}e.x<Vq&&e.x>Uq&&(e.x=1),e.y<Vq&&e.y>Uq&&(e.y=1)}function GS(n,e){n.min=n.min+e,n.max=n.max+e}function Fq(n,e,i,a,l=.5){const u=Es(n.min,n.max,l);YU(n,e,i,u,a)}function HS(n,e){Fq(n.x,e.x,e.scaleX,e.scale,e.originX),Fq(n.y,e.y,e.scaleY,e.scale,e.originY)}function cte(n,e){return ste(ZOe(n.getBoundingClientRect(),e))}function tke(n,e,i){const a=cte(n,i),{scroll:l}=e;return l&&(GS(a.x,l.offset.x),GS(a.y,l.offset.y)),a}const lte=({current:n})=>n?n.ownerDocument.defaultView:null,nke=new WeakMap;class rke{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Qs(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(nR(C).point)},u=(C,I)=>{const{drag:O,dragPropagation:L,onDragStart:M}=this.getProps();if(O&&!L&&(this.openDragLock&&this.openDragLock(),this.openDragLock=YAe(O),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Yu(z=>{let X=this.getAxisMotionValue(z).get()||0;if(gp.test(X)){const{projection:K}=this.visualElement;if(K&&K.layout){const ne=K.layout.layoutBox[z];ne&&(X=ou(ne)*(parseFloat(X)/100))}}this.originPoint[z]=X}),M&&ss.postRender(()=>M(C,I)),FU(this.visualElement,"transform");const{animationState:F}=this.visualElement;F&&F.setActive("whileDrag",!0)},f=(C,I)=>{const{dragPropagation:O,dragDirectionLock:L,onDirectionLock:M,onDrag:F}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:z}=I;if(L&&this.currentDirection===null){this.currentDirection=ike(z),this.currentDirection!==null&&M&&M(this.currentDirection);return}this.updateAxis("x",I.point,z),this.updateAxis("y",I.point,z),this.visualElement.render(),F&&F(C,I)},_=(C,I)=>this.stop(C,I),E=()=>Yu(C=>{var I;return this.getAnimationState(C)==="paused"&&((I=this.getAxisMotionValue(C).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new tte(e,{onSessionStart:l,onStart:u,onMove:f,onSessionEnd:_,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:lte(this.visualElement)})}stop(e,i){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&ss.postRender(()=>u(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,a){const{drag:l}=this.getProps();if(!a||!bO(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let f=this.originPoint[e]+a[e];this.constraints&&this.constraints[e]&&(f=$Oe(f,this.constraints[e],this.elastic[e])),u.set(f)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;i&&BS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=KOe(l.layoutBox,i):this.constraints=!1,this.elastic=JOe(a),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Yu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=XOe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!BS(e))return!1;const a=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=tke(a,l.root,this.visualElement.getTransformPagePoint());let f=qOe(l.layout.layoutBox,u);if(i){const _=i(QOe(f));this.hasMutatedConstraints=!!_,_&&(f=ste(_))}return f}startAnimation(e){const{drag:i,dragMomentum:a,dragElastic:l,dragTransition:u,dragSnapToOrigin:f,onDragTransitionEnd:_}=this.getProps(),E=this.constraints||{},b=Yu(C=>{if(!bO(C,i,this.currentDirection))return;let I=E&&E[C]||{};f&&(I={min:0,max:0});const O=l?200:1e6,L=l?40:1e7,M={type:"inertia",velocity:a?e[C]:0,bounceStiffness:O,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...u,...I};return this.startAxisValueAnimation(C,M)});return Promise.all(b).then(_)}startAxisValueAnimation(e,i){const a=this.getAxisMotionValue(e);return FU(this.visualElement,e),a.start(cj(e,a,0,i,this.visualElement,!1))}stopAnimation(){Yu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Yu(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,a=this.visualElement.getProps(),l=a[i];return l||this.visualElement.getValue(e,(a.initial?a.initial[e]:void 0)||0)}snapToCursor(e){Yu(i=>{const{drag:a}=this.getProps();if(!bO(i,a,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(i);if(l&&l.layout){const{min:f,max:_}=l.layout.layoutBox[i];u.set(e[i]-Es(f,_,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!BS(i)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Yu(f=>{const _=this.getAxisMotionValue(f);if(_&&this.constraints!==!1){const E=_.get();l[f]=YOe({min:E,max:E},this.constraints[f])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Yu(f=>{if(!bO(f,e,null))return;const _=this.getAxisMotionValue(f),{min:E,max:b}=this.constraints[f];_.set(Es(E,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;nke.set(this.visualElement,this);const e=this.visualElement.current,i=iC(e,"pointerdown",E=>{const{drag:b,dragListener:C=!0}=this.getProps();b&&C&&this.start(E)}),a=()=>{const{dragConstraints:E}=this.getProps();BS(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),ss.read(a);const f=OC(window,"resize",()=>this.scalePositionWithinConstraints()),_=l.addEventListener("didUpdate",({delta:E,hasLayoutChanged:b})=>{this.isDragging&&b&&(Yu(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=E[C].translate,I.set(I.get()+E[C].translate))}),this.visualElement.render())});return()=>{f(),i(),u(),_&&_()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:f=KU,dragMomentum:_=!0}=e;return{...e,drag:i,dragDirectionLock:a,dragPropagation:l,dragConstraints:u,dragElastic:f,dragMomentum:_}}}function bO(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function ike(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class ske extends Bg{constructor(e){super(e),this.removeGroupControls=ru,this.removeListeners=ru,this.controls=new rke(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ru}unmount(){this.removeGroupControls(),this.removeListeners()}}const jq=n=>(e,i)=>{n&&ss.postRender(()=>n(e,i))};class oke extends Bg{constructor(){super(...arguments),this.removePointerDownListener=ru}onPointerDown(e){this.session=new tte(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:lte(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:jq(e),onStart:jq(i),onMove:a,onEnd:(u,f)=>{delete this.session,l&&ss.postRender(()=>l(u,f))}}}mount(){this.removePointerDownListener=iC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const rk={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Bq(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const gw={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Bn.test(n))n=parseFloat(n);else return n;const i=Bq(n,e.target.x),a=Bq(n,e.target.y);return`${i}% ${a}%`}},ake={correct:(n,{treeScale:e,projectionDelta:i})=>{const a=n,l=kg.parse(n);if(l.length>5)return a;const u=kg.createTransformer(n),f=typeof l[0]!="number"?1:0,_=i.x.scale*e.x,E=i.y.scale*e.y;l[0+f]/=_,l[1+f]/=E;const b=Es(_,E,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),u(l)}};class cke extends N.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a,layoutId:l}=this.props,{projection:u}=e;AAe(lke),u&&(i.group&&i.group.add(u),a&&a.register&&l&&a.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),rk.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:a,drag:l,isPresent:u}=this.props,f=a.projection;return f&&(f.isPresent=u,l||e.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?f.promote():f.relegate()||ss.postRender(()=>{const _=f.getStack();(!_||!_.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),UF.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ute(n){const[e,i]=kF(),a=N.useContext(AF);return T.jsx(cke,{...n,layoutGroup:a,switchLayoutGroup:N.useContext(eee),isPresent:e,safeToRemove:i})}const lke={borderRadius:{...gw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:gw,borderTopRightRadius:gw,borderBottomLeftRadius:gw,borderBottomRightRadius:gw,boxShadow:ake};function uke(n,e,i){const a=lc(n)?n:AC(n);return a.start(cj("",a,e,i)),a.animation}function dke(n){return n instanceof SVGElement&&n.tagName!=="svg"}const hke=(n,e)=>n.depth-e.depth;class pke{constructor(){this.children=[],this.isDirty=!1}add(e){JF(this.children,e),this.isDirty=!0}remove(e){QF(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(hke),this.isDirty=!1,this.children.forEach(e)}}function fke(n,e){const i=_p.now(),a=({timestamp:l})=>{const u=l-i;u>=e&&(Og(a),n(u-e))};return ss.read(a,!0),()=>Og(a)}const dte=["TopLeft","TopRight","BottomLeft","BottomRight"],mke=dte.length,zq=n=>typeof n=="string"?parseFloat(n):n,Wq=n=>typeof n=="number"||Bn.test(n);function gke(n,e,i,a,l,u){l?(n.opacity=Es(0,i.opacity!==void 0?i.opacity:1,_ke(a)),n.opacityExit=Es(e.opacity!==void 0?e.opacity:1,0,yke(a))):u&&(n.opacity=Es(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,a));for(let f=0;f<mke;f++){const _=`border${dte[f]}Radius`;let E=Gq(e,_),b=Gq(i,_);if(E===void 0&&b===void 0)continue;E||(E=0),b||(b=0),E===0||b===0||Wq(E)===Wq(b)?(n[_]=Math.max(Es(zq(E),zq(b),a),0),(gp.test(b)||gp.test(E))&&(n[_]+="%")):n[_]=b}(e.rotate||i.rotate)&&(n.rotate=Es(e.rotate||0,i.rotate||0,a))}function Gq(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const _ke=hte(0,.5,Oee),yke=hte(.5,.95,ru);function hte(n,e,i){return a=>a<n?0:a>e?1:i(m0(n,e,a))}function Hq(n,e){n.min=e.min,n.max=e.max}function $u(n,e){Hq(n.x,e.x),Hq(n.y,e.y)}function $q(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function Kq(n,e,i,a,l){return n-=e,n=Mk(n,1/i,a),l!==void 0&&(n=Mk(n,1/l,a)),n}function Eke(n,e=0,i=1,a=.5,l,u=n,f=n){if(gp.test(e)&&(e=parseFloat(e),e=Es(f.min,f.max,e/100)-f.min),typeof e!="number")return;let _=Es(u.min,u.max,a);n===u&&(_-=e),n.min=Kq(n.min,e,i,_,l),n.max=Kq(n.max,e,i,_,l)}function qq(n,e,[i,a,l],u,f){Eke(n,e[i],e[a],e[l],e.scale,u,f)}const vke=["x","scaleX","originX"],Ske=["y","scaleY","originY"];function Yq(n,e,i,a){qq(n.x,e,vke,i?i.x:void 0,a?a.x:void 0),qq(n.y,e,Ske,i?i.y:void 0,a?a.y:void 0)}function Xq(n){return n.translate===0&&n.scale===1}function pte(n){return Xq(n.x)&&Xq(n.y)}function Jq(n,e){return n.min===e.min&&n.max===e.max}function bke(n,e){return Jq(n.x,e.x)&&Jq(n.y,e.y)}function Qq(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function fte(n,e){return Qq(n.x,e.x)&&Qq(n.y,e.y)}function Zq(n){return ou(n.x)/ou(n.y)}function eY(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class Tke{constructor(){this.members=[]}add(e){JF(this.members,e),e.scheduleRender()}remove(e){if(QF(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let a;for(let l=i;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){a=u;break}}return a?(this.promote(a),!0):!1}promote(e,i){const a=this.lead;if(e!==a&&(this.prevLead=a,this.lead=e,e.show(),a)){a.instance&&a.scheduleRender(),e.scheduleRender(),e.resumeFrom=a,i&&(e.resumeFrom.preserveOpacity=!0),a.snapshot&&(e.snapshot=a.snapshot,e.snapshot.latestValues=a.animationValues||a.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:a}=e;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function wke(n,e,i){let a="";const l=n.x.translate/e.x,u=n.y.translate/e.y,f=(i==null?void 0:i.z)||0;if((l||u||f)&&(a=`translate3d(${l}px, ${u}px, ${f}px) `),(e.x!==1||e.y!==1)&&(a+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:C,rotateX:I,rotateY:O,skewX:L,skewY:M}=i;b&&(a=`perspective(${b}px) ${a}`),C&&(a+=`rotate(${C}deg) `),I&&(a+=`rotateX(${I}deg) `),O&&(a+=`rotateY(${O}deg) `),L&&(a+=`skewX(${L}deg) `),M&&(a+=`skewY(${M}deg) `)}const _=n.x.scale*e.x,E=n.y.scale*e.y;return(_!==1||E!==1)&&(a+=`scale(${_}, ${E})`),a||"none"}const _y={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Fw=typeof window<"u"&&window.MotionDebug!==void 0,NM=["","X","Y","Z"],Cke={visibility:"hidden"},tY=1e3;let Rke=0;function DM(n,e,i,a){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),a&&(a[n]=0))}function mte(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=Tee(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:u}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",ss,!(l||u))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&mte(a)}function gte({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},_=e==null?void 0:e()){this.id=Rke++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Fw&&(_y.totalNodes=_y.resolvedTargetDeltas=_y.recalculatedProjection=0),this.nodes.forEach(Pke),this.nodes.forEach(xke),this.nodes.forEach(Lke),this.nodes.forEach(Oke),Fw&&window.MotionDebug.record(_y)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=_?_.root||_:this,this.path=_?[..._.path,_]:[],this.parent=_,this.depth=_?_.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new pke)}addEventListener(f,_){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new ZF),this.eventHandlers.get(f).add(_)}notifyListeners(f,..._){const E=this.eventHandlers.get(f);E&&E.notify(..._)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,_=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=dke(f),this.instance=f;const{layoutId:E,layout:b,visualElement:C}=this.options;if(C&&!C.current&&C.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_&&(b||E)&&(this.isLayoutDirty=!0),n){let I;const O=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=fke(O,250),rk.hasAnimatedSinceResize&&(rk.hasAnimatedSinceResize=!1,this.nodes.forEach(rY))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&C&&(E||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:O,hasRelativeTargetChanged:L,layout:M})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||C.getDefaultTransition()||jke,{onLayoutAnimationStart:z,onLayoutAnimationComplete:X}=C.getProps(),K=!this.targetLayout||!fte(this.targetLayout,M)||L,ne=!O&&L;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ne||O&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,ne);const oe={...KF(F,"layout"),onPlay:z,onComplete:X};(C.shouldReduceMotion||this.options.layoutRoot)&&(oe.delay=0,oe.type=!1),this.startAnimation(oe)}else O||rY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=M})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Og(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Mke),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&mte(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:_,layout:E}=this.options;if(_===void 0&&!E)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(nY);return}this.isUpdating||this.nodes.forEach(Nke),this.isUpdating=!1,this.nodes.forEach(Dke),this.nodes.forEach(Ike),this.nodes.forEach(Ake),this.clearAllSnapshots();const _=_p.now();Pa.delta=$f(0,1e3/60,_-Pa.timestamp),Pa.timestamp=_,Pa.isProcessing=!0,wM.update.process(Pa),wM.preRender.process(Pa),wM.render.process(Pa),Pa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,UF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(kke),this.sharedNodes.forEach(Uke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ss.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ss.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Qs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_}=this.options;_&&_.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let _=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(_=!1),_){const E=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,_=this.projectionDelta&&!pte(this.projectionDelta),E=this.getTransformTemplate(),b=E?E(this.latestValues,""):void 0,C=b!==this.prevTransformTemplateValue;f&&(_||gy(this.latestValues)||C)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const _=this.measurePageBox();let E=this.removeElementScroll(_);return f&&(E=this.removeTransform(E)),Bke(E),{animationId:this.root.animationId,measuredBox:_,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:_}=this.options;if(!_)return Qs();const E=_.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(zke))){const{scroll:C}=this.root;C&&(GS(E.x,C.offset.x),GS(E.y,C.offset.y))}return E}removeElementScroll(f){var _;const E=Qs();if($u(E,f),!((_=this.scroll)===null||_===void 0)&&_.wasRoot)return E;for(let b=0;b<this.path.length;b++){const C=this.path[b],{scroll:I,options:O}=C;C!==this.root&&I&&O.layoutScroll&&(I.wasRoot&&$u(E,f),GS(E.x,I.offset.x),GS(E.y,I.offset.y))}return E}applyTransform(f,_=!1){const E=Qs();$u(E,f);for(let b=0;b<this.path.length;b++){const C=this.path[b];!_&&C.options.layoutScroll&&C.scroll&&C!==C.root&&HS(E,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),gy(C.latestValues)&&HS(E,C.latestValues)}return gy(this.latestValues)&&HS(E,this.latestValues),E}removeTransform(f){const _=Qs();$u(_,f);for(let E=0;E<this.path.length;E++){const b=this.path[E];if(!b.instance||!gy(b.latestValues))continue;qU(b.latestValues)&&b.updateSnapshot();const C=Qs(),I=b.measurePageBox();$u(C,I),Yq(_,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,C)}return gy(this.latestValues)&&Yq(_,this.latestValues),_}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Pa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var _;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==E;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:O}=this.options;if(!(!this.layout||!(I||O))){if(this.resolvedRelativeTargetAt=Pa.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Qs(),this.relativeTargetOrigin=Qs(),oC(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),$u(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Qs(),this.targetWithTransforms=Qs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),HOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):$u(this.target,this.layout.layoutBox),ate(this.target,this.targetDelta)):$u(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Qs(),this.relativeTargetOrigin=Qs(),oC(this.relativeTargetOrigin,this.target,L.target),$u(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Fw&&_y.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||qU(this.parent.latestValues)||ote(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const _=this.getLead(),E=!!this.resumingFrom||this!==_;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Pa.timestamp&&(b=!1),b)return;const{layout:C,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||I))return;$u(this.layoutCorrected,this.layout.layoutBox);const O=this.treeScale.x,L=this.treeScale.y;eke(this.layoutCorrected,this.treeScale,this.path,E),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=Qs());const{target:M}=_;if(!M){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():($q(this.prevProjectionDelta.x,this.projectionDelta.x),$q(this.prevProjectionDelta.y,this.projectionDelta.y)),sC(this.projectionDelta,this.layoutCorrected,M,this.latestValues),(this.treeScale.x!==O||this.treeScale.y!==L||!eY(this.projectionDelta.x,this.prevProjectionDelta.x)||!eY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",M)),Fw&&_y.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var _;if((_=this.options.visualElement)===null||_===void 0||_.scheduleRender(),f){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=WS(),this.projectionDelta=WS(),this.projectionDeltaWithTransform=WS()}setAnimationOrigin(f,_=!1){const E=this.snapshot,b=E?E.latestValues:{},C={...this.latestValues},I=WS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const O=Qs(),L=E?E.source:void 0,M=this.layout?this.layout.source:void 0,F=L!==M,z=this.getStack(),X=!z||z.members.length<=1,K=!!(F&&!X&&this.options.crossfade===!0&&!this.path.some(Fke));this.animationProgress=0;let ne;this.mixTargetDelta=oe=>{const ae=oe/1e3;iY(I.x,f.x,ae),iY(I.y,f.y,ae),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(oC(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Vke(this.relativeTarget,this.relativeTargetOrigin,O,ae),ne&&bke(this.relativeTarget,ne)&&(this.isProjectionDirty=!1),ne||(ne=Qs()),$u(ne,this.relativeTarget)),F&&(this.animationValues=C,gke(C,b,this.latestValues,ae,K,X)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ae},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Og(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ss.update(()=>{rk.hasAnimatedSinceResize=!0,this.currentAnimation=uke(0,tY,{...f,onUpdate:_=>{this.mixTargetDelta(_),f.onUpdate&&f.onUpdate(_)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(tY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:_,target:E,layout:b,latestValues:C}=f;if(!(!_||!E||!b)){if(this!==f&&this.layout&&b&&_te(this.options.animationType,this.layout.layoutBox,b.layoutBox)){E=this.target||Qs();const I=ou(this.layout.layoutBox.x);E.x.min=f.target.x.min,E.x.max=E.x.min+I;const O=ou(this.layout.layoutBox.y);E.y.min=f.target.y.min,E.y.max=E.y.min+O}$u(_,E),HS(_,C),sC(this.projectionDeltaWithTransform,this.layoutCorrected,_,C)}}registerSharedNode(f,_){this.sharedNodes.has(f)||this.sharedNodes.set(f,new Tke),this.sharedNodes.get(f).add(_);const b=_.options.initialPromotionConfig;_.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(_):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:_}=this.options;return _?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:_}=this.options;return _?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:_,preserveFollowOpacity:E}={}){const b=this.getStack();b&&b.promote(this,E),f&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let _=!1;const{latestValues:E}=f;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(_=!0),!_)return;const b={};E.z&&DM("z",f,b,this.animationValues);for(let C=0;C<NM.length;C++)DM(`rotate${NM[C]}`,f,b,this.animationValues),DM(`skew${NM[C]}`,f,b,this.animationValues);f.render();for(const C in b)f.setStaticValue(C,b[C]),this.animationValues&&(this.animationValues[C]=b[C]);f.scheduleRender()}getProjectionStyles(f){var _,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Cke;const b={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=tk(f==null?void 0:f.pointerEvents)||"",b.transform=C?C(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const F={};return this.options.layoutId&&(F.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,F.pointerEvents=tk(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!gy(this.latestValues)&&(F.transform=C?C({},""):"none",this.hasProjected=!1),F}const O=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=wke(this.projectionDeltaWithTransform,this.treeScale,O),C&&(b.transform=C(O,b.transform));const{x:L,y:M}=this.projectionDelta;b.transformOrigin=`${L.origin*100}% ${M.origin*100}% 0`,I.animationValues?b.opacity=I===this?(E=(_=O.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:O.opacityExit:b.opacity=I===this?O.opacity!==void 0?O.opacity:"":O.opacityExit!==void 0?O.opacityExit:0;for(const F in kk){if(O[F]===void 0)continue;const{correct:z,applyTo:X}=kk[F],K=b.transform==="none"?O[F]:z(O[F],I);if(X){const ne=X.length;for(let oe=0;oe<ne;oe++)b[X[oe]]=K}else b[F]=K}return this.options.layoutId&&(b.pointerEvents=I===this?tk(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var _;return(_=f.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(nY),this.root.sharedNodes.clear()}}}function Ike(n){n.updateLayout()}function Ake(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:u}=n.options,f=i.source!==n.layout.source;u==="size"?Yu(I=>{const O=f?i.measuredBox[I]:i.layoutBox[I],L=ou(O);O.min=a[I].min,O.max=O.min+L}):_te(u,i.layoutBox,a)&&Yu(I=>{const O=f?i.measuredBox[I]:i.layoutBox[I],L=ou(a[I]);O.max=O.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+L)});const _=WS();sC(_,a,i.layoutBox);const E=WS();f?sC(E,n.applyTransform(l,!0),i.measuredBox):sC(E,a,i.layoutBox);const b=!pte(_);let C=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:O,layout:L}=I;if(O&&L){const M=Qs();oC(M,i.layoutBox,O.layoutBox);const F=Qs();oC(F,a,L.layoutBox),fte(M,F)||(C=!0),I.options.layoutRoot&&(n.relativeTarget=F,n.relativeTargetOrigin=M,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:E,layoutDelta:_,hasLayoutChanged:b,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function Pke(n){Fw&&_y.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function Oke(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function kke(n){n.clearSnapshot()}function nY(n){n.clearMeasurements()}function Nke(n){n.isLayoutDirty=!1}function Dke(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function rY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function xke(n){n.resolveTargetDelta()}function Lke(n){n.calcProjection()}function Mke(n){n.resetSkewAndRotation()}function Uke(n){n.removeLeadSnapshot()}function iY(n,e,i){n.translate=Es(e.translate,0,i),n.scale=Es(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function sY(n,e,i,a){n.min=Es(e.min,i.min,a),n.max=Es(e.max,i.max,a)}function Vke(n,e,i,a){sY(n.x,e.x,i.x,a),sY(n.y,e.y,i.y,a)}function Fke(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const jke={duration:.45,ease:[.4,0,.1,1]},oY=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),aY=oY("applewebkit/")&&!oY("chrome/")?Math.round:ru;function cY(n){n.min=aY(n.min),n.max=aY(n.max)}function Bke(n){cY(n.x),cY(n.y)}function _te(n,e,i){return n==="position"||n==="preserve-aspect"&&!GOe(Zq(e),Zq(i),.2)}function zke(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const Wke=gte({attachResizeListener:(n,e)=>OC(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),xM={current:void 0},yte=gte({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!xM.current){const n=new Wke({});n.mount(window),n.setOptions({layoutScroll:!0}),xM.current=n}return xM.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Gke={pan:{Feature:oke},drag:{Feature:ske,ProjectionNode:yte,MeasureLayout:ute}};function lY(n,e,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,u=a[l];u&&ss.postRender(()=>u(e,nR(e)))}class Hke extends Bg{mount(){const{current:e}=this.node;e&&(this.unmount=GAe(e,i=>(lY(this.node,i,"Start"),a=>lY(this.node,a,"End"))))}unmount(){}}class $ke extends Bg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=tR(OC(this.node.current,"focus",()=>this.onFocus()),OC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function uY(n,e,i){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),u=a[l];u&&ss.postRender(()=>u(e,nR(e)))}class Kke extends Bg{mount(){const{current:e}=this.node;e&&(this.unmount=qAe(e,i=>(uY(this.node,i,"Start"),(a,{success:l})=>uY(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const XU=new WeakMap,LM=new WeakMap,qke=n=>{const e=XU.get(n.target);e&&e(n)},Yke=n=>{n.forEach(qke)};function Xke({root:n,...e}){const i=n||document;LM.has(i)||LM.set(i,{});const a=LM.get(i),l=JSON.stringify(e);return a[l]||(a[l]=new IntersectionObserver(Yke,{root:n,...e})),a[l]}function Jke(n,e,i){const a=Xke(e);return XU.set(n,i),a.observe(n),()=>{XU.delete(n),a.unobserve(n)}}const Qke={some:0,all:1};class Zke extends Bg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:a,amount:l="some",once:u}=e,f={root:i?i.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:Qke[l]},_=E=>{const{isIntersecting:b}=E;if(this.isInView===b||(this.isInView=b,u&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),O=b?C:I;O&&O(E)};return Jke(this.node.current,f,_)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(eNe(e,i))&&this.startObserver()}unmount(){}}function eNe({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const tNe={inView:{Feature:Zke},tap:{Feature:Kke},focus:{Feature:$ke},hover:{Feature:Hke}},nNe={layout:{ProjectionNode:yte,MeasureLayout:ute}},JU={current:null},Ete={current:!1};function rNe(){if(Ete.current=!0,!!NF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>JU.current=n.matches;n.addListener(e),e()}else JU.current=!1}const iNe=[...Gee,oc,kg],sNe=n=>iNe.find(Wee(n)),dY=new WeakMap;function oNe(n,e,i){for(const a in e){const l=e[a],u=i[a];if(lc(l))n.addValue(a,l);else if(lc(u))n.addValue(a,AC(l,{owner:n}));else if(u!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,AC(f!==void 0?f:l,{owner:n}))}}for(const a in i)e[a]===void 0&&n.removeValue(a);return e}const hY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class aNe{scrapeMotionValuesFromProps(e,i,a){return{}}constructor({parent:e,props:i,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:u,visualState:f},_={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=sj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=_p.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,ss.render(this.render,!1,!0))};const{latestValues:E,renderState:b,onUpdate:C}=f;this.onUpdate=C,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=a,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=_,this.blockInitialAnimation=!!u,this.isControllingVariants=PN(i),this.isVariantNode=QZ(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:I,...O}=this.scrapeMotionValuesFromProps(i,{},this);for(const L in O){const M=O[L];E[L]!==void 0&&lc(M)&&M.set(E[L],!1)}}mount(e){this.current=e,dY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),Ete.current||rNe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:JU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){dY.delete(this.current),this.projection&&this.projection.unmount(),Og(this.notifyUpdate),Og(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const a=Jy.has(e),l=i.on("change",_=>{this.latestValues[e]=_,this.props.onUpdate&&ss.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),u=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),u(),f&&f(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in g0){const i=g0[e];if(!i)continue;const{isEnabled:a,Feature:l}=i;if(!this.features[e]&&l&&a(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Qs()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<hY.length;a++){const l=hY[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,f=e[u];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=oNe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const a=this.values.get(e);i!==a&&(a&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let a=this.values.get(e);return a===void 0&&i!==void 0&&(a=AC(i===null?void 0:i,{owner:this}),this.addValue(e,a)),a}readValue(e,i){var a;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(a=this.getBaseTargetFromProps(this.props,e))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(Bee(l)||Nee(l))?l=parseFloat(l):!sNe(l)&&kg.test(i)&&(l=Vee(e,i)),this.setBaseTarget(e,lc(l)?l.get():l)),lc(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=FF(this.props,a,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(l=f[e])}if(a&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!lc(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new ZF),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class vte extends aNe{constructor(){super(...arguments),this.KeyframeResolver=Hee}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:a}){delete i[e],delete a[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;lc(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function cNe(n){return window.getComputedStyle(n)}class lNe extends vte{constructor(){super(...arguments),this.type="html",this.renderInstance=aee}readValueFromInstance(e,i){if(Jy.has(i)){const a=ij(i);return a&&a.default||0}else{const a=cNe(e),l=(iee(i)?a.getPropertyValue(i):a[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return cte(e,i)}build(e,i,a){zF(e,i,a.transformTemplate)}scrapeMotionValuesFromProps(e,i,a){return $F(e,i,a)}}class uNe extends vte{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Qs}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(Jy.has(i)){const a=ij(i);return a&&a.default||0}return i=cee.has(i)?i:MF(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,a){return dee(e,i,a)}build(e,i,a){WF(e,i,this.isSVGTag,a.transformTemplate)}renderInstance(e,i,a,l){lee(e,i,a,l)}mount(e){this.isSVGTag=HF(e.tagName),super.mount(e)}}const dNe=(n,e)=>VF(n)?new uNe(e):new lNe(e,{allowProjection:n!==N.Fragment}),hNe=UAe({...LOe,...tNe,...Gke,...nNe},dNe),em=QIe(hNe),pNe=(n,e)=>n.find(i=>i.id===e);function pY(n,e){const i=Ste(n,e),a=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:a}}function Ste(n,e){for(const[i,a]of Object.entries(n))if(pNe(a,e))return i}function fNe(n){const e=n.includes("right"),i=n.includes("left");let a="center";return e&&(a="flex-end"),i&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function mNe(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:a,bottom:l,right:u,left:f}}var gNe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,_Ne=UZ(function(n){return gNe.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),yNe=_Ne,ENe=function(e){return e!=="theme"},fY=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?yNe:ENe},mY=function(e,i,a){var l;if(i){var u=i.shouldForwardProp;l=e.__emotion_forwardProp&&u?function(f){return e.__emotion_forwardProp(f)&&u(f)}:u}return typeof l!="function"&&a&&(l=e.__emotion_forwardProp),l},vNe=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return vF(i,a,l),zZ(function(){return SF(i,a,l)}),null},SNe=function n(e,i){var a=e.__emotion_real===e,l=a&&e.__emotion_base||e,u,f;i!==void 0&&(u=i.label,f=i.target);var _=mY(e,i,a),E=_||fY(l),b=!E("as");return function(){var C=arguments,I=a&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&I.push("label:"+u+";"),C[0]==null||C[0].raw===void 0)I.push.apply(I,C);else{var O=C[0];I.push(O[0]);for(var L=C.length,M=1;M<L;M++)I.push(C[M],O[M])}var F=TF(function(z,X,K){var ne=b&&z.as||l,oe="",ae=[],le=z;if(z.theme==null){le={};for(var Y in z)le[Y]=z[Y];le.theme=N.useContext(f0)}typeof z.className=="string"?oe=FZ(X.registered,ae,z.className):z.className!=null&&(oe=z.className+" ");var Z=wN(I.concat(ae),X.registered,le);oe+=X.key+"-"+Z.name,f!==void 0&&(oe+=" "+f);var Q=b&&_===void 0?fY(ne):E,ie={};for(var de in z)b&&de==="as"||Q(de)&&(ie[de]=z[de]);return ie.className=oe,K&&(ie.ref=K),N.createElement(N.Fragment,null,N.createElement(vNe,{cache:X,serialized:Z,isStringTag:typeof ne=="string"}),N.createElement(ne,ie))});return F.displayName=u!==void 0?u:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",F.defaultProps=e.defaultProps,F.__emotion_real=F,F.__emotion_base=l,F.__emotion_styles=I,F.__emotion_forwardProp=_,Object.defineProperty(F,"toString",{value:function(){return"."+f}}),F.withComponent=function(z,X){var K=n(z,By({},i,X,{shouldForwardProp:mY(F,X,!0)}));return K.apply(void 0,I)},F}},bNe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],QU=SNe.bind(null);bNe.forEach(function(n){QU[n]=QU(n)});const TNe=new Set([...Wve,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),wNe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function CNe(n){return(wNe.has(n)||!TNe.has(n))&&n[0]!=="_"}const RNe=_Ee(QU),INe=({baseStyle:n})=>e=>{const{theme:i,css:a,__css:l,sx:u,...f}=e,[_]=wEe(f,Hve),E=Sl(n,e),b=rEe({},l,E,gN(_),u),C=gZ(b)(e.theme);return a?[C,a]:C};function MM(n,e){const{baseStyle:i,...a}=e??{};a.shouldForwardProp||(a.shouldForwardProp=CNe);const l=INe({baseStyle:i}),u=RNe(n,a)(l);return N.forwardRef(function(E,b){const{children:C,...I}=E,{colorMode:O,forced:L}=RN(),M=L?O:void 0;return N.createElement(u,{ref:b,"data-theme":M,...I},C)})}function ANe(){const n=new Map;return new Proxy(MM,{apply(e,i,a){return MM(...a)},get(e,i){return n.has(i)||n.set(i,MM(i)),n.get(i)}})}const Ut=ANe(),PNe={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let a=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(a=1),{opacity:0,[i]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},bte=N.memo(n=>{const{id:e,message:i,onCloseComplete:a,onRequestRemove:l,requestClose:u=!1,position:f="bottom",duration:_=5e3,containerStyle:E,motionVariants:b=PNe,toastSpacing:C="0.5rem"}=n,[I,O]=N.useState(_),L=WIe();Gf(()=>{L||a==null||a()},[L]),Gf(()=>{O(_)},[_]);const M=()=>O(null),F=()=>O(_),z=()=>{L&&l()};N.useEffect(()=>{L&&u&&l()},[L,u,l]),KEe(z,I);const X=N.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...E}),[E,C]),K=N.useMemo(()=>fNe(f),[f]);return T.jsx(em.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:M,onHoverEnd:F,custom:{position:f},style:K,children:T.jsx(Ut.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:X,children:Sl(i,{id:e,onClose:z})})})});bte.displayName="ToastComponent";function Bt(n){return N.forwardRef(n)}var UM,gY;function ONe(){if(gY)return UM;gY=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(u,f){if(u===f)return!0;if(u&&f&&typeof u=="object"&&typeof f=="object"){if(u.constructor!==f.constructor)return!1;var _,E,b;if(Array.isArray(u)){if(_=u.length,_!=f.length)return!1;for(E=_;E--!==0;)if(!l(u[E],f[E]))return!1;return!0}var C;if(e&&u instanceof Map&&f instanceof Map){if(u.size!==f.size)return!1;for(C=u.entries();!(E=C.next()).done;)if(!f.has(E.value[0]))return!1;for(C=u.entries();!(E=C.next()).done;)if(!l(E.value[1],f.get(E.value[0])))return!1;return!0}if(i&&u instanceof Set&&f instanceof Set){if(u.size!==f.size)return!1;for(C=u.entries();!(E=C.next()).done;)if(!f.has(E.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(f)){if(_=u.length,_!=f.length)return!1;for(E=_;E--!==0;)if(u[E]!==f[E])return!1;return!0}if(u.constructor===RegExp)return u.source===f.source&&u.flags===f.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof f.valueOf=="function")return u.valueOf()===f.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof f.toString=="function")return u.toString()===f.toString();if(b=Object.keys(u),_=b.length,_!==Object.keys(f).length)return!1;for(E=_;E--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[E]))return!1;if(n&&u instanceof Element)return!1;for(E=_;E--!==0;)if(!((b[E]==="_owner"||b[E]==="__v"||b[E]==="__o")&&u.$$typeof)&&!l(u[b[E]],f[b[E]]))return!1;return!0}return u!==u&&f!==f}return UM=function(f,_){try{return l(f,_)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}},UM}var kNe=ONe();const NNe=jg(kNe);function B0(){const n=N.useContext(f0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function Tte(){const n=RN(),e=B0();return{...n,theme:e}}function DNe(n,e,i){if(e==null)return e;const a=l=>{var u,f;return(f=(u=n.__cssMap)==null?void 0:u[l])==null?void 0:f.value};return a(e)??a(i)??i}function xNe(n,e,i){const a=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return u=>{const f=l.filter(Boolean),_=a.map((E,b)=>{const C=`${n}.${E}`;return DNe(u,C,f[b]??E)});return Array.isArray(e)?_:_[0]}}function wte(n,e={}){const{styleConfig:i,...a}=e,{theme:l,colorMode:u}=Tte(),f=n?QQ(l,`components.${n}`):void 0,_=i||f,E=lp({theme:l,colorMode:u},(_==null?void 0:_.defaultProps)??{},gN(M0(a,["children"])),(C,I)=>C?void 0:I),b=N.useRef({});if(_){const I=nSe(_)(E);NNe(b.current,I)||(b.current=I)}return b.current}function sd(n,e={}){return wte(n,e)}function La(n,e={}){return wte(n,e)}const _Y={path:T.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[T.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),T.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),T.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},mn=Bt((n,e)=>{const{as:i,viewBox:a,color:l="currentColor",focusable:u=!1,children:f,className:_,__css:E,...b}=n,C=_n("chakra-icon",_),I=sd("Icon",n),O={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...E,...I},L={ref:e,focusable:u,className:C,__css:O},M=a??_Y.viewBox;if(i&&typeof i!="string")return T.jsx(Ut.svg,{as:i,...L,...b});const F=f??_Y.path;return T.jsx(Ut.svg,{verticalAlign:"middle",viewBox:M,...L,...b,children:F})});mn.displayName="Icon";function LNe(n){return T.jsx(mn,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function MNe(n){return T.jsx(mn,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function yY(n){return T.jsx(mn,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const UNe=JC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),oh=Bt((n,e)=>{const i=sd("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:u="0.45s",emptyColor:f="transparent",className:_,...E}=Bi(n),b=_n("chakra-spinner",_),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${UNe} ${u} linear infinite`,...i};return T.jsx(Ut.div,{ref:e,__css:C,className:b,...E,children:a&&T.jsx(Ut.span,{srOnly:!0,children:a})})});oh.displayName="Spinner";const[VNe,lj]=Ti({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[FNe,uj]=Ti({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),Cte={info:{icon:MNe,colorScheme:"blue"},warning:{icon:yY,colorScheme:"orange"},success:{icon:LNe,colorScheme:"green"},error:{icon:yY,colorScheme:"red"},loading:{icon:oh,colorScheme:"blue"}};function jNe(n){return Cte[n].colorScheme}function BNe(n){return Cte[n].icon}const Vf=Bt(function(e,i){const{status:a="info",addRole:l=!0,...u}=Bi(e),f=e.colorScheme??jNe(a),_=La("Alert",{...e,colorScheme:f}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",..._.container};return T.jsx(VNe,{value:{status:a},children:T.jsx(FNe,{value:_,children:T.jsx(Ut.div,{"data-status":a,role:l?"alert":void 0,ref:i,...u,className:_n("chakra-alert",e.className),__css:E})})})});Vf.displayName="Alert";function Ff(n){const{status:e}=lj(),i=BNe(e),a=uj(),l=e==="loading"?a.spinner:a.icon;return T.jsx(Ut.span,{display:"inherit","data-status":e,...n,className:_n("chakra-alert__icon",n.className),__css:l,children:n.children||T.jsx(i,{h:"100%",w:"100%"})})}Ff.displayName="AlertIcon";const aC=Bt(function(e,i){const a=uj(),{status:l}=lj();return T.jsx(Ut.div,{ref:i,"data-status":l,...e,className:_n("chakra-alert__title",e.className),__css:a.title})});aC.displayName="AlertTitle";const cC=Bt(function(e,i){const{status:a}=lj(),l=uj(),u={display:"inline",...l.description};return T.jsx(Ut.div,{ref:i,"data-status":a,...e,className:_n("chakra-alert__desc",e.className),__css:u})});cC.displayName="AlertDescription";function zNe(n){return T.jsx(mn,{focusable:"false","aria-hidden":!0,...n,children:T.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const dj=Bt(function(e,i){const a=sd("CloseButton",e),{children:l,isDisabled:u,__css:f,..._}=Bi(e),E={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return T.jsx(Ut.button,{type:"button","aria-label":"Close",ref:i,disabled:u,__css:{...E,...a,...f},..._,children:l||T.jsx(zNe,{width:"1em",height:"1em"})})});dj.displayName="CloseButton";const WNe=n=>{const{status:e,variant:i="solid",id:a,title:l,isClosable:u,onClose:f,description:_,colorScheme:E,icon:b}=n,C=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return T.jsxs(Vf,{addRole:!1,status:e,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:E,children:[T.jsx(Ff,{children:b}),T.jsxs(Ut.div,{flex:"1",maxWidth:"100%",children:[l&&T.jsx(aC,{id:C==null?void 0:C.title,children:l}),_&&T.jsx(cC,{id:C==null?void 0:C.description,display:"block",children:_})]}),u&&T.jsx(dj,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function Rte(n={}){const{render:e,toastComponent:i=WNe}=n;return l=>typeof e=="function"?e({...l,...n}):T.jsx(i,{...l,...n})}const GNe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},op=HNe(GNe);function HNe(n){let e=n;const i=new Set,a=l=>{e=l(e),i.forEach(u=>u())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{a(()=>n),i.delete(l)}),removeToast:(l,u)=>{a(f=>({...f,[u]:f[u].filter(_=>_.id!=l)}))},notify:(l,u)=>{const f=$Ne(l,u),{position:_,id:E}=f;return a(b=>{const I=_.includes("top")?[f,...b[_]??[]]:[...b[_]??[],f];return{...b,[_]:I}}),E},update:(l,u)=>{l&&a(f=>{const _={...f},{position:E,index:b}=pY(_,l);return E&&b!==-1&&(_[E][b]={..._[E][b],...u,message:Rte(u)}),_})},closeAll:({positions:l}={})=>{a(u=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((E,b)=>(E[b]=u[b].map(C=>({...C,requestClose:!0})),E),{...u}))},close:l=>{a(u=>{const f=Ste(u,l);return f?{...u,[f]:u[f].map(_=>_.id==l?{..._,requestClose:!0}:_)}:u})},isActive:l=>!!pY(op.getState(),l).position}}let EY=0;function $Ne(n,e={}){EY+=1;const i=e.id??EY,a=e.position??"bottom";return{id:i,message:n,position:a,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>op.removeToast(String(i),a),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var Ite=WQ();const[Ate,KNe]=Ti({strict:!1,name:"PortalContext"}),hj="chakra-portal",qNe=".chakra-portal",YNe=n=>T.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),XNe=n=>{const{appendToParentPortal:e,children:i}=n,[a,l]=N.useState(null),u=N.useRef(null),[,f]=N.useState({});N.useEffect(()=>f({}),[]);const _=KNe(),E=MIe();pp(()=>{if(!a)return;const C=a.ownerDocument,I=e?_??C.body:C.body;if(!I)return;u.current=C.createElement("div"),u.current.className=hj,I.appendChild(u.current),f({});const O=u.current;return()=>{I.contains(O)&&I.removeChild(O)}},[a]);const b=E!=null&&E.zIndex?T.jsx(YNe,{zIndex:E==null?void 0:E.zIndex,children:i}):i;return u.current?Ite.createPortal(T.jsx(Ate,{value:u.current,children:b}),u.current):T.jsx("span",{ref:C=>{C&&l(C)}})},JNe=n=>{const{children:e,containerRef:i,appendToParentPortal:a}=n,l=i.current,u=l??(typeof window<"u"?document.body:void 0),f=N.useMemo(()=>{const E=l==null?void 0:l.ownerDocument.createElement("div");return E&&(E.className=hj),E},[l]),[,_]=N.useState({});return pp(()=>_({}),[]),pp(()=>{if(!(!f||!u))return u.appendChild(f),()=>{u.removeChild(f)}},[f,u]),u&&f?Ite.createPortal(T.jsx(Ate,{value:a?f:null,children:e}),f):null};function od(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...a}=e;return i?T.jsx(JNe,{containerRef:i,...a}):T.jsx(XNe,{...a})}od.className=hj;od.selector=qNe;od.displayName="Portal";const[QNe,ZNe]=Ti({name:"ToastOptionsContext",strict:!1}),e1e=n=>{const e=N.useSyncExternalStore(op.subscribe,op.getState,op.getState),{motionVariants:i,component:a=bte,portalProps:l,animatePresenceProps:u}=n,_=Object.keys(e).map(E=>{const b=e[E];return T.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:mNe(E),children:T.jsx(V0,{...u,initial:!1,children:b.map(C=>T.jsx(a,{motionVariants:i,...C},C.id))})},E)});return T.jsx(od,{...l,children:_})},t1e=n=>function({children:i,theme:a=n,toastOptions:l,...u}){return T.jsxs(VIe,{theme:a,...u,children:[T.jsx(QNe,{value:l==null?void 0:l.defaultOptions,children:i}),T.jsx(e1e,{...l})]})},n1e=t1e(ARe);function vY(n){return n.sort((e,i)=>{const a=e.compareDocumentPosition(i);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const r1e=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function SY(n,e,i){let a=n+1;return i&&a>=e&&(a=0),a}function bY(n,e,i){let a=n-1;return i&&a<0&&(a=e),a}const VM=typeof window<"u"?N.useLayoutEffect:N.useEffect,TY=n=>n;var i1e=Object.defineProperty,s1e=(n,e,i)=>e in n?i1e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,js=(n,e,i)=>(s1e(n,typeof e!="symbol"?e+"":e,i),i);class o1e{constructor(){js(this,"descendants",new Map),js(this,"register",e=>{if(e!=null)return r1e(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),js(this,"unregister",e=>{this.descendants.delete(e);const i=vY(Array.from(this.descendants.keys()));this.assignIndex(i)}),js(this,"destroy",()=>{this.descendants.clear()}),js(this,"assignIndex",e=>{this.descendants.forEach(i=>{const a=e.indexOf(i.node);i.index=a,i.node.dataset.index=i.index.toString()})}),js(this,"count",()=>this.descendants.size),js(this,"enabledCount",()=>this.enabledValues().length),js(this,"values",()=>Array.from(this.descendants.values()).sort((i,a)=>i.index-a.index)),js(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),js(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),js(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),js(this,"first",()=>this.item(0)),js(this,"firstEnabled",()=>this.enabledItem(0)),js(this,"last",()=>this.item(this.descendants.size-1)),js(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),js(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),js(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),js(this,"next",(e,i=!0)=>{const a=SY(e,this.count(),i);return this.item(a)}),js(this,"nextEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),u=SY(l,this.enabledCount(),i);return this.enabledItem(u)}),js(this,"prev",(e,i=!0)=>{const a=bY(e,this.count()-1,i);return this.item(a)}),js(this,"prevEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),u=bY(l,this.enabledCount()-1,i);return this.enabledItem(u)}),js(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const a=Array.from(this.descendants.keys()).concat(e),l=vY(a);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const u={node:e,index:-1,...i};this.descendants.set(e,u),this.assignIndex(l)})}}function Pte(){const[n,e]=Ti({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=N.useRef(new o1e);return VM(()=>()=>l.current.destroy()),l.current},l=>{const u=e(),[f,_]=N.useState(-1),E=N.useRef(null);VM(()=>()=>{E.current&&u.unregister(E.current)},[]),VM(()=>{if(!E.current)return;const C=Number(E.current.dataset.index);f!=C&&!Number.isNaN(C)&&_(C)});const b=TY(l?u.register(l):u.register);return{descendants:u,index:f,enabledIndex:u.enabledIndexOf(E.current),register:Fi(b,E)}}]}const wY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Ny={enter:{duration:.2,ease:wY.easeOut},exit:{duration:.1,ease:wY.easeIn}},Dy={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},[a1e,c1e]=Ti({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function l1e(n){const e=n.trim().split(" "),i=e[0]??"",a=e.length>1?e[e.length-1]:"";return i&&a?`${i.charAt(0)}${a.charAt(0)}`:i.charAt(0)}function Ote(n){const{name:e,getInitials:i,...a}=n,l=c1e();return T.jsx(Ut.div,{role:"img","aria-label":e,...a,__css:l.label,children:e?i==null?void 0:i(e):null})}Ote.displayName="AvatarName";const kte=n=>T.jsxs(Ut.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[T.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),T.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Nte(n){const{loading:e,src:i,srcSet:a,onLoad:l,onError:u,crossOrigin:f,sizes:_,ignoreFallback:E}=n,[b,C]=N.useState("pending");N.useEffect(()=>{C(i?"loading":"pending")},[i]);const I=N.useRef(null),O=N.useCallback(()=>{if(!i)return;L();const M=new Image;M.src=i,f&&(M.crossOrigin=f),a&&(M.srcset=a),_&&(M.sizes=_),e&&(M.loading=e),M.onload=F=>{L(),C("loaded"),l==null||l(F)},M.onerror=F=>{L(),C("failed"),u==null||u(F)},I.current=M},[i,f,a,_,l,u,e]),L=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return pp(()=>{if(!E)return b==="loading"&&O(),()=>{L()}},[b,O,E]),E?"loaded":b}const u1e=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function Dte(n){const{src:e,srcSet:i,onError:a,onLoad:l,getInitials:u,name:f,borderRadius:_,loading:E,iconLabel:b,icon:C=T.jsx(kte,{}),ignoreFallback:I,referrerPolicy:O,crossOrigin:L}=n,F=Nte({src:e,onError:a,crossOrigin:L,ignoreFallback:I})==="loaded";return!e||!F?f?T.jsx(Ote,{className:"chakra-avatar__initials",getInitials:u,name:f}):N.cloneElement(C,{role:"img","aria-label":b}):T.jsx(Ut.img,{src:e,srcSet:i,alt:f??b,onLoad:l,referrerPolicy:O,crossOrigin:L??void 0,className:"chakra-avatar__img",loading:E,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:_}})}Dte.displayName="AvatarImage";const d1e={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},eh=Bt((n,e)=>{const i=La("Avatar",n),[a,l]=N.useState(!1),{src:u,srcSet:f,name:_,showBorder:E,borderRadius:b="full",onError:C,onLoad:I,getInitials:O=l1e,icon:L=T.jsx(kte,{}),iconLabel:M=" avatar",loading:F,children:z,borderColor:X,ignoreFallback:K,crossOrigin:ne,referrerPolicy:oe,...ae}=Bi(n),le={borderRadius:b,borderWidth:E?"2px":void 0,...d1e,...i.container};return X&&(le.borderColor=X),T.jsx(Ut.span,{ref:e,...ae,className:_n("chakra-avatar",n.className),"data-loaded":rr(a),__css:le,children:T.jsxs(a1e,{value:i,children:[T.jsx(Dte,{src:u,srcSet:f,loading:F,onLoad:Nn(I,()=>{l(!0)}),onError:C,getInitials:O,name:_,borderRadius:b,icon:L,iconLabel:M,ignoreFallback:K,crossOrigin:ne,referrerPolicy:oe}),z]})})});eh.displayName="Avatar";const Yd=Bt(function(e,i){const a=sd("Badge",e),{className:l,...u}=Bi(e);return T.jsx(Ut.span,{ref:i,className:_n("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});Yd.displayName="Badge";const yt=Ut("div");yt.displayName="Box";const[hGe,h1e]=Ti({strict:!1,name:"ButtonGroupContext"});function jw(n){const{children:e,className:i,...a}=n,l=N.isValidElement(e)?N.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=_n("chakra-button__icon",i);return T.jsx(Ut.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:u,children:l})}jw.displayName="ButtonIcon";function ZU(n){const{label:e,placement:i,spacing:a="0.5rem",children:l=T.jsx(oh,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:f,..._}=n,E=_n("chakra-button__spinner",u),b=i==="start"?"marginEnd":"marginStart",C=N.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,e,b,a]);return T.jsx(Ut.div,{className:E,..._,__css:C,children:l})}ZU.displayName="ButtonSpinner";function p1e(n){const[e,i]=N.useState(!n);return{ref:N.useCallback(u=>{u&&i(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}const Yn=Bt((n,e)=>{const i=h1e(),a=sd("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:u,isActive:f,children:_,leftIcon:E,rightIcon:b,loadingText:C,iconSpacing:I="0.5rem",type:O,spinner:L,spinnerPlacement:M="start",className:F,as:z,shouldWrapChildren:X,...K}=Bi(n),ne=N.useMemo(()=>{const Y={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!i&&{_focus:Y}}},[a,i]),{ref:oe,type:ae}=p1e(z),le={rightIcon:b,leftIcon:E,iconSpacing:I,children:_,shouldWrapChildren:X};return T.jsxs(Ut.button,{disabled:l||u,ref:$Ee(e,oe),as:z,type:O??ae,"data-active":rr(f),"data-loading":rr(u),__css:ne,className:_n("chakra-button",F),...K,children:[u&&M==="start"&&T.jsx(ZU,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:I,children:L}),u?C||T.jsx(Ut.span,{opacity:0,children:T.jsx(CY,{...le})}):T.jsx(CY,{...le}),u&&M==="end"&&T.jsx(ZU,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:I,children:L})]})});Yn.displayName="Button";function CY(n){const{leftIcon:e,rightIcon:i,children:a,iconSpacing:l,shouldWrapChildren:u}=n;return u?T.jsxs("span",{style:{display:"contents"},children:[e&&T.jsx(jw,{marginEnd:l,children:e}),a,i&&T.jsx(jw,{marginStart:l,children:i})]}):T.jsxs(T.Fragment,{children:[e&&T.jsx(jw,{marginEnd:l,children:e}),a,i&&T.jsx(jw,{marginStart:l,children:i})]})}const Nc=Bt((n,e)=>{const{icon:i,children:a,isRound:l,"aria-label":u,...f}=n,_=i||a,E=N.isValidElement(_)?N.cloneElement(_,{"aria-hidden":!0,focusable:!1}):null;return T.jsx(Yn,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":u,...f,children:E})});Nc.displayName="IconButton";const xte=Ut("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});xte.displayName="Center";const f1e={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Bt(function(e,i){const{axis:a="both",...l}=e;return T.jsx(Ut.div,{ref:i,__css:f1e[a],...l,position:"absolute"})});var m1e=()=>typeof document<"u",RY=!1,rR=null,zy=!1,eV=!1,tV=new Set;function pj(n,e){tV.forEach(i=>i(n,e))}var g1e=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function _1e(n){return!(n.metaKey||!g1e&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function IY(n){zy=!0,_1e(n)&&(rR="keyboard",pj("keyboard",n))}function TS(n){if(rR="pointer",n.type==="mousedown"||n.type==="pointerdown"){zy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;pj("pointer",n)}}function y1e(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function E1e(n){y1e(n)&&(zy=!0,rR="virtual")}function v1e(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!zy&&!eV&&(rR="virtual",pj("virtual",n)),zy=!1,eV=!1)}function S1e(){zy=!1,eV=!0}function AY(){return rR!=="pointer"}function b1e(){if(!m1e()||RY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){zy=!0,n.apply(this,i)},document.addEventListener("keydown",IY,!0),document.addEventListener("keyup",IY,!0),document.addEventListener("click",E1e,!0),window.addEventListener("focus",v1e,!0),window.addEventListener("blur",S1e,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",TS,!0),document.addEventListener("pointermove",TS,!0),document.addEventListener("pointerup",TS,!0)):(document.addEventListener("mousedown",TS,!0),document.addEventListener("mousemove",TS,!0),document.addEventListener("mouseup",TS,!0)),RY=!0}function T1e(n){b1e(),n(AY());const e=()=>n(AY());return tV.add(e),()=>{tV.delete(e)}}const[w1e,Lte]=Ti({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[C1e,z0]=Ti({strict:!1,name:"FormControlContext"});function R1e(n){const{id:e,isRequired:i,isInvalid:a,isDisabled:l,isReadOnly:u,...f}=n,_=N.useId(),E=e||`field-${_}`,b=`${E}-label`,C=`${E}-feedback`,I=`${E}-helptext`,[O,L]=N.useState(!1),[M,F]=N.useState(!1),[z,X]=N.useState(!1),K=N.useCallback((Y={},Z=null)=>({id:I,...Y,ref:Fi(Z,Q=>{Q&&F(!0)})}),[I]),ne=N.useCallback((Y={},Z=null)=>({...Y,ref:Z,"data-focus":rr(z),"data-disabled":rr(l),"data-invalid":rr(a),"data-readonly":rr(u),id:Y.id!==void 0?Y.id:b,htmlFor:Y.htmlFor!==void 0?Y.htmlFor:E}),[E,l,z,a,u,b]),oe=N.useCallback((Y={},Z=null)=>({id:C,...Y,ref:Fi(Z,Q=>{Q&&L(!0)}),"aria-live":"polite"}),[C]),ae=N.useCallback((Y={},Z=null)=>({...Y,...f,ref:Z,role:"group","data-focus":rr(z),"data-disabled":rr(l),"data-invalid":rr(a),"data-readonly":rr(u)}),[f,l,z,a,u]),le=N.useCallback((Y={},Z=null)=>({...Y,ref:Z,role:"presentation","aria-hidden":!0,children:Y.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!a,isReadOnly:!!u,isDisabled:!!l,isFocused:!!z,onFocus:()=>X(!0),onBlur:()=>X(!1),hasFeedbackText:O,setHasFeedbackText:L,hasHelpText:M,setHasHelpText:F,id:E,labelId:b,feedbackId:C,helpTextId:I,htmlProps:f,getHelpTextProps:K,getErrorMessageProps:oe,getRootProps:ae,getLabelProps:ne,getRequiredIndicatorProps:le}}const Br=Bt(function(e,i){const a=La("Form",e),l=Bi(e),{getRootProps:u,htmlProps:f,..._}=R1e(l),E=_n("chakra-form-control",e.className);return T.jsx(C1e,{value:_,children:T.jsx(w1e,{value:a,children:T.jsx(Ut.div,{...u({},i),className:E,__css:a.container})})})});Br.displayName="FormControl";const t0=Bt(function(e,i){const a=z0(),l=Lte(),u=_n("chakra-form__helper-text",e.className);return T.jsx(Ut.div,{...a==null?void 0:a.getHelpTextProps(e,i),__css:l.helperText,className:u})});t0.displayName="FormHelperText";function fj(n){const{isDisabled:e,isInvalid:i,isReadOnly:a,isRequired:l,...u}=mj(n);return{...u,disabled:e,readOnly:a,required:l,"aria-invalid":xf(i),"aria-required":xf(l),"aria-readonly":xf(a)}}function mj(n){const e=z0(),{id:i,disabled:a,readOnly:l,required:u,isRequired:f,isInvalid:_,isReadOnly:E,isDisabled:b,onFocus:C,onBlur:I,...O}=n,L=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&L.push(e.feedbackId),e!=null&&e.hasHelpText&&L.push(e.helpTextId),{...O,"aria-describedby":L.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:a??b??(e==null?void 0:e.isDisabled),isReadOnly:l??E??(e==null?void 0:e.isReadOnly),isRequired:u??f??(e==null?void 0:e.isRequired),isInvalid:_??(e==null?void 0:e.isInvalid),onFocus:Nn(e==null?void 0:e.onFocus,C),onBlur:Nn(e==null?void 0:e.onBlur,I)}}const I1e={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function A1e(n={}){const e=mj(n),{isDisabled:i,isReadOnly:a,isRequired:l,isInvalid:u,id:f,onBlur:_,onFocus:E,"aria-describedby":b}=e,{defaultChecked:C,isChecked:I,isFocusable:O,onChange:L,isIndeterminate:M,name:F,value:z,tabIndex:X=void 0,"aria-label":K,"aria-labelledby":ne,"aria-invalid":oe,...ae}=n,le=M0(ae,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Y=eo(L),Z=eo(_),Q=eo(E),[ie,de]=N.useState(!1),[ue,pe]=N.useState(!1),[ke,xe]=N.useState(!1),[Fe,Oe]=N.useState(!1);N.useEffect(()=>T1e(de),[]);const we=N.useRef(null),[Se,Be]=N.useState(!0),[Ee,Ce]=N.useState(!!C),Pe=I!==void 0,Me=Pe?I:Ee,ze=N.useCallback(Mt=>{if(a||i){Mt.preventDefault();return}Pe||Ce(Me?Mt.currentTarget.checked:M?!0:Mt.currentTarget.checked),Y==null||Y(Mt)},[a,i,Me,Pe,M,Y]);pp(()=>{we.current&&(we.current.indeterminate=!!M)},[M]),Gf(()=>{i&&pe(!1)},[i,pe]),pp(()=>{const Mt=we.current;if(!(Mt!=null&&Mt.form))return;const fn=()=>{Ce(!!C)};return Mt.form.addEventListener("reset",fn),()=>{var zt;return(zt=Mt.form)==null?void 0:zt.removeEventListener("reset",fn)}},[]);const He=i&&!O,qe=N.useCallback(Mt=>{Mt.key===" "&&Oe(!0)},[Oe]),nt=N.useCallback(Mt=>{Mt.key===" "&&Oe(!1)},[Oe]);pp(()=>{if(!we.current)return;we.current.checked!==Me&&Ce(we.current.checked)},[we.current]);const Ze=N.useCallback((Mt={},fn=null)=>{const zt=Te=>{ue&&Te.preventDefault(),Oe(!0)};return{...Mt,ref:fn,"data-active":rr(Fe),"data-hover":rr(ke),"data-checked":rr(Me),"data-focus":rr(ue),"data-focus-visible":rr(ue&&ie),"data-indeterminate":rr(M),"data-disabled":rr(i),"data-invalid":rr(u),"data-readonly":rr(a),"aria-hidden":!0,onMouseDown:Nn(Mt.onMouseDown,zt),onMouseUp:Nn(Mt.onMouseUp,()=>Oe(!1)),onMouseEnter:Nn(Mt.onMouseEnter,()=>xe(!0)),onMouseLeave:Nn(Mt.onMouseLeave,()=>xe(!1))}},[Fe,Me,i,ue,ie,ke,M,u,a]),gt=N.useCallback((Mt={},fn=null)=>({...Mt,ref:fn,"data-active":rr(Fe),"data-hover":rr(ke),"data-checked":rr(Me),"data-focus":rr(ue),"data-focus-visible":rr(ue&&ie),"data-indeterminate":rr(M),"data-disabled":rr(i),"data-invalid":rr(u),"data-readonly":rr(a)}),[Fe,Me,i,ue,ie,ke,M,u,a]),sn=N.useCallback((Mt={},fn=null)=>({...le,htmlFor:Se?f:void 0,...Mt,ref:Fi(fn,zt=>{zt&&Be(zt.tagName==="LABEL")}),onClick:Nn(Mt.onClick,()=>{var zt;Se||((zt=we.current)==null||zt.click(),requestAnimationFrame(()=>{var Te;(Te=we.current)==null||Te.focus({preventScroll:!0})}))}),"data-disabled":rr(i),"data-checked":rr(Me),"data-invalid":rr(u)}),[le,i,Me,u,Se,f]),ut=N.useCallback((Mt={},fn=null)=>({...Mt,ref:Fi(we,fn),type:"checkbox",name:F,value:z,id:f,tabIndex:X,onChange:Nn(Mt.onChange,ze),onBlur:Nn(Mt.onBlur,Z,()=>pe(!1)),onFocus:Nn(Mt.onFocus,Q,()=>pe(!0)),onKeyDown:Nn(Mt.onKeyDown,qe),onKeyUp:Nn(Mt.onKeyUp,nt),required:l,checked:Me,disabled:He,readOnly:a,"aria-label":K,"aria-labelledby":ne,"aria-invalid":oe?!!oe:u,"aria-describedby":b,"aria-disabled":i,"aria-checked":M?"mixed":Me,style:I1e}),[F,z,f,X,ze,Z,Q,qe,nt,l,Me,He,a,K,ne,oe,u,b,i,M]),kt=N.useCallback((Mt={},fn=null)=>({...Mt,ref:fn,onMouseDown:Nn(Mt.onMouseDown,P1e),"data-disabled":rr(i),"data-checked":rr(Me),"data-invalid":rr(u)}),[Me,i,u]);return{state:{isInvalid:u,isFocused:ue,isChecked:Me,isActive:Fe,isHovered:ke,isIndeterminate:M,isDisabled:i,isReadOnly:a,isRequired:l},getRootProps:sn,getCheckboxProps:Ze,getIndicatorProps:gt,getInputProps:ut,getLabelProps:kt,htmlProps:le}}function P1e(n){n.preventDefault(),n.stopPropagation()}const xy=Bt(function(e,i){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:u,borderRightWidth:f,borderWidth:_,borderStyle:E,borderColor:b,...C}=sd("Divider",e),{className:I,orientation:O="horizontal",__css:L,...M}=Bi(e),F={vertical:{borderLeftWidth:a||f||_||"1px",height:"100%"},horizontal:{borderBottomWidth:l||u||_||"1px",width:"100%"}};return T.jsx(Ut.hr,{ref:i,"aria-orientation":O,...M,__css:{...C,border:"0",borderColor:b,borderStyle:E,...F[O],...L},className:_n("chakra-divider",I)})});xy.displayName="Divider";const is=Bt(function(e,i){const{direction:a,align:l,justify:u,wrap:f,basis:_,grow:E,shrink:b,...C}=e,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:u,flexWrap:f,flexBasis:_,flexGrow:E,flexShrink:b};return T.jsx(Ut.div,{ref:i,__css:I,...C})});is.displayName="Flex";function O1e(n,e){if(n==null)return{};var i={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(e.indexOf(a)!==-1)continue;i[a]=n[a]}return i}var FM={exports:{}},jM,PY;function k1e(){if(PY)return jM;PY=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return jM=n,jM}var BM,OY;function N1e(){if(OY)return BM;OY=1;var n=k1e();function e(){}function i(){}return i.resetWarningCache=e,BM=function(){function a(f,_,E,b,C,I){if(I!==n){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}a.isRequired=a;function l(){return a}var u={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return u.PropTypes=u,u},BM}var kY;function D1e(){return kY||(kY=1,FM.exports=N1e()()),FM.exports}var x1e=D1e();const An=jg(x1e);var nV="data-focus-lock",Mte="data-focus-lock-disabled",L1e="data-no-focus-lock",M1e="data-autofocus-inside",U1e="data-no-autofocus";function zM(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function V1e(n,e){var i=N.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(a){var l=i.value;l!==a&&(i.value=a,i.callback(a,l))}}}})[0];return i.callback=e,i.facade}var F1e=typeof window<"u"?N.useLayoutEffect:N.useEffect,NY=new WeakMap;function Ute(n,e){var i=V1e(null,function(a){return n.forEach(function(l){return zM(l,a)})});return F1e(function(){var a=NY.get(i);if(a){var l=new Set(a),u=new Set(n),f=i.current;l.forEach(function(_){u.has(_)||zM(_,null)}),u.forEach(function(_){l.has(_)||zM(_,f)})}NY.set(i,n)},[n]),i}var WM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},ap=function(){return ap=Object.assign||function(e){for(var i,a=1,l=arguments.length;a<l;a++){i=arguments[a];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(e[u]=i[u])}return e},ap.apply(this,arguments)};function iR(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i}function j1e(n,e,i){if(i||arguments.length===2)for(var a=0,l=e.length,u;a<l;a++)(u||!(a in e))&&(u||(u=Array.prototype.slice.call(e,0,a)),u[a]=e[a]);return n.concat(u||Array.prototype.slice.call(e))}function Vte(n){return n}function Fte(n,e){e===void 0&&(e=Vte);var i=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(u){var f=e(u,a);return i.push(f),function(){i=i.filter(function(_){return _!==f})}},assignSyncMedium:function(u){for(a=!0;i.length;){var f=i;i=[],f.forEach(u)}i={push:function(_){return u(_)},filter:function(){return i}}},assignMedium:function(u){a=!0;var f=[];if(i.length){var _=i;i=[],_.forEach(u),f=i}var E=function(){var C=f;f=[],C.forEach(u)},b=function(){return Promise.resolve().then(E)};b(),i={push:function(C){f.push(C),b()},filter:function(C){return f=f.filter(C),i}}}};return l}function gj(n,e){return e===void 0&&(e=Vte),Fte(n,e)}function jte(n){n===void 0&&(n={});var e=Fte(null);return e.options=ap({async:!0,ssr:!1},n),e}var Bte=function(n){var e=n.sideCar,i=iR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=e.read();if(!a)throw new Error("Sidecar medium not found");return N.createElement(a,ap({},i))};Bte.isSideCarExport=!0;function B1e(n,e){return n.useMedium(e),Bte}var zte=gj({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),Wte=gj(),z1e=gj(),W1e=jte({async:!0,ssr:typeof document<"u"}),G1e=N.createContext(void 0),H1e=[],_j=N.forwardRef(function(e,i){var a,l=N.useState(),u=l[0],f=l[1],_=N.useRef(),E=N.useRef(!1),b=N.useRef(null),C=N.useState({}),I=C[1],O=e.children,L=e.disabled,M=L===void 0?!1:L,F=e.noFocusGuards,z=F===void 0?!1:F,X=e.persistentFocus,K=X===void 0?!1:X,ne=e.crossFrame,oe=ne===void 0?!0:ne,ae=e.autoFocus,le=ae===void 0?!0:ae;e.allowTextSelection;var Y=e.group,Z=e.className,Q=e.whiteList,ie=e.hasPositiveIndices,de=e.shards,ue=de===void 0?H1e:de,pe=e.as,ke=pe===void 0?"div":pe,xe=e.lockProps,Fe=xe===void 0?{}:xe,Oe=e.sideCar,we=e.returnFocus,Se=we===void 0?!1:we,Be=e.focusOptions,Ee=e.onActivation,Ce=e.onDeactivation,Pe=N.useState({}),Me=Pe[0],ze=N.useCallback(function(fn){var zt=fn.captureFocusRestore;if(!b.current){var Te,Ve=(Te=document)==null?void 0:Te.activeElement;b.current=Ve,Ve!==document.body&&(b.current=zt(Ve))}_.current&&Ee&&Ee(_.current),E.current=!0,I()},[Ee]),He=N.useCallback(function(){E.current=!1,Ce&&Ce(_.current),I()},[Ce]),qe=N.useCallback(function(fn){var zt=b.current;if(zt){var Te=(typeof zt=="function"?zt():zt)||document.body,Ve=typeof Se=="function"?Se(Te):Se;if(Ve){var $e=typeof Ve=="object"?Ve:void 0;b.current=null,fn?Promise.resolve().then(function(){return Te.focus($e)}):Te.focus($e)}}},[Se]),nt=N.useCallback(function(fn){E.current&&zte.useMedium(fn)},[]),Ze=Wte.useMedium,gt=N.useCallback(function(fn){_.current!==fn&&(_.current=fn,f(fn))},[]),sn=By((a={},a[Mte]=M&&"disabled",a[nV]=Y,a),Fe),ut=z!==!0,kt=ut&&z!=="tail",ct=Ute([i,gt]),Mt=N.useMemo(function(){return{observed:_,shards:ue,enabled:!M,active:E.current}},[M,E.current,ue,u]);return fi.createElement(N.Fragment,null,ut&&[fi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:M?-1:0,style:WM}),ie?fi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:M?-1:1,style:WM}):null],!M&&fi.createElement(Oe,{id:Me,sideCar:W1e,observed:u,disabled:M,persistentFocus:K,crossFrame:oe,autoFocus:le,whiteList:Q,shards:ue,onActivation:ze,onDeactivation:He,returnFocus:qe,focusOptions:Be,noFocusGuards:z}),fi.createElement(ke,By({ref:ct},sn,{className:Z,onBlur:Ze,onFocus:nt}),fi.createElement(G1e.Provider,{value:Mt},O)),kt&&fi.createElement("div",{"data-focus-guard":!0,tabIndex:M?-1:0,style:WM}))});_j.propTypes={};function rV(n,e){return rV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},rV(n,e)}function $1e(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,rV(n,e)}function kC(n){"@babel/helpers - typeof";return kC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kC(n)}function K1e(n,e){if(kC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,e);if(kC(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function q1e(n){var e=K1e(n,"string");return kC(e)=="symbol"?e:e+""}function Y1e(n,e,i){return(e=q1e(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function X1e(n,e){function i(a){return a.displayName||a.name||"Component"}return function(l){var u=[],f;function _(){f=n(u.map(function(b){return b.props})),e(f)}var E=function(b){$1e(C,b);function C(){return b.apply(this,arguments)||this}C.peek=function(){return f};var I=C.prototype;return I.componentDidMount=function(){u.push(this),_()},I.componentDidUpdate=function(){_()},I.componentWillUnmount=function(){var L=u.indexOf(this);u.splice(L,1),_()},I.render=function(){return fi.createElement(l,this.props)},C}(N.PureComponent);return Y1e(E,"displayName","SideEffect("+i(l)+")"),E}}var Cp=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Wy=function(n){return Array.isArray(n)?n:[n]},Gte=function(n){return Array.isArray(n)?n[0]:n},J1e=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Hte=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},$te=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},Q1e=function(n){return n.hasAttribute("inert")},Z1e=function(n,e){return!n||$te(n)||!J1e(n)&&!Q1e(n)&&e(Hte(n))},Kte=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=Z1e(e,Kte.bind(void 0,n));return n.set(e,a),a},eDe=function(n,e){return n&&!$te(n)?rDe(n)?e(Hte(n)):!1:!0},qte=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=eDe(e,qte.bind(void 0,n));return n.set(e,a),a},Yte=function(n){return n.dataset},tDe=function(n){return n.tagName==="BUTTON"},Xte=function(n){return n.tagName==="INPUT"},Jte=function(n){return Xte(n)&&n.type==="radio"},nDe=function(n){return!((Xte(n)||tDe(n))&&(n.type==="hidden"||n.disabled))},rDe=function(n){var e=n.getAttribute(U1e);return![!0,"true",""].includes(e)},yj=function(n){var e;return!!(n&&(!((e=Yte(n))===null||e===void 0)&&e.focusGuard))},iV=function(n){return!yj(n)},iDe=function(n){return!!n},sDe=function(n,e){var i=Math.max(0,n.tabIndex),a=Math.max(0,e.tabIndex),l=i-a,u=n.index-e.index;if(l){if(!i)return 1;if(!a)return-1}return l||u},oDe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},Ej=function(n,e,i){return Cp(n).map(function(a,l){var u=oDe(a);return{node:a,index:l,tabIndex:i&&u===-1?(a.dataset||{}).focusGuard?0:-1:u}}).filter(function(a){return!e||a.tabIndex>=0}).sort(sDe)},aDe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],vj=aDe.join(","),cDe="".concat(vj,", [data-focus-guard]"),Qte=function(n,e){return Cp((n.shadowRoot||n).children).reduce(function(i,a){return i.concat(a.matches(e?cDe:vj)?[a]:[],Qte(a))},[])},lDe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?y0([n.contentDocument.body],e):[n]},y0=function(n,e){return n.reduce(function(i,a){var l,u=Qte(a,e),f=(l=[]).concat.apply(l,u.map(function(_){return lDe(_,e)}));return i.concat(f,a.parentNode?Cp(a.parentNode.querySelectorAll(vj)).filter(function(_){return _===a}):[])},[])},uDe=function(n){var e=n.querySelectorAll("[".concat(M1e,"]"));return Cp(e).map(function(i){return y0([i])}).reduce(function(i,a){return i.concat(a)},[])},Sj=function(n,e){return Cp(n).filter(function(i){return Kte(e,i)}).filter(function(i){return nDe(i)})},DY=function(n,e){return e===void 0&&(e=new Map),Cp(n).filter(function(i){return qte(e,i)})},bj=function(n,e,i){return Ej(Sj(y0(n,i),e),!0,i)},NC=function(n,e){return Ej(Sj(y0(n),e),!1)},dDe=function(n,e){return Sj(uDe(n),e)},Ly=function(n,e){return n.shadowRoot?Ly(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:Cp(n.children).some(function(i){var a;if(i instanceof HTMLIFrameElement){var l=(a=i.contentDocument)===null||a===void 0?void 0:a.body;return l?Ly(l,e):!1}return Ly(i,e)})},hDe=function(n){for(var e=new Set,i=n.length,a=0;a<i;a+=1)for(var l=a+1;l<i;l+=1){var u=n[a].compareDocumentPosition(n[l]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(a)}return n.filter(function(f,_){return!e.has(_)})},Zte=function(n){return n.parentNode?Zte(n.parentNode):n},Tj=function(n){var e=Wy(n);return e.filter(Boolean).reduce(function(i,a){var l=a.getAttribute(nV);return i.push.apply(i,l?hDe(Cp(Zte(a).querySelectorAll("[".concat(nV,'="').concat(l,'"]:not([').concat(Mte,'="disabled"])')))):[a]),i},[])},pDe=function(n){try{return n()}catch{return}},DC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?DC(e.shadowRoot):e instanceof HTMLIFrameElement&&pDe(function(){return e.contentWindow.document})?DC(e.contentWindow.document):e}},fDe=function(n,e){return n===e},mDe=function(n,e){return!!Cp(n.querySelectorAll("iframe")).some(function(i){return fDe(i,e)})},ene=function(n,e){return e===void 0&&(e=DC(Gte(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:Tj(n).some(function(i){return Ly(i,e)||mDe(i,e)})},gDe=function(n){n===void 0&&(n=document);var e=DC(n);return e?Cp(n.querySelectorAll("[".concat(L1e,"]"))).some(function(i){return Ly(i,e)}):!1},_De=function(n,e){return e.filter(Jte).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},wj=function(n,e){return Jte(n)&&n.name?_De(n,e):n},yDe=function(n){var e=new Set;return n.forEach(function(i){return e.add(wj(i,n))}),n.filter(function(i){return e.has(i)})},xY=function(n){return n[0]&&n.length>1?wj(n[0],n):n[0]},LY=function(n,e){return n.indexOf(wj(e,n))},sV="NEW_FOCUS",EDe=function(n,e,i,a,l){var u=n.length,f=n[0],_=n[u-1],E=yj(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?i.indexOf(a):-1,C=l?i.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:sV;if(I===-1)return sV;var O=b-C,L=i.indexOf(f),M=i.indexOf(_),F=yDe(i),z=a!==void 0?F.indexOf(a):-1,X=l?F.indexOf(l):z,K=F.filter(function(Z){return Z.tabIndex>=0}),ne=a!==void 0?K.indexOf(a):-1,oe=l?K.indexOf(l):ne,ae=ne>=0&&oe>=0?oe-ne:X-z;if(!O&&I>=0||e.length===0)return I;var le=LY(n,e[0]),Y=LY(n,e[e.length-1]);if(b<=L&&E&&Math.abs(O)>1)return Y;if(b>=M&&E&&Math.abs(O)>1)return le;if(O&&Math.abs(ae)>1)return I;if(b<=L)return Y;if(b>M)return le;if(O)return Math.abs(O)>1?I:(u+I+O)%u}},vDe=function(n){return function(e){var i,a=(i=Yte(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||a!==void 0&&a!=="false"||n.indexOf(e)>=0}},MY=function(n,e,i){var a=n.map(function(u){var f=u.node;return f}),l=DY(a.filter(vDe(i)));return l&&l.length?xY(l):xY(DY(e))},oV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&oV(n.parentNode.host||n.parentNode,e),e},GM=function(n,e){for(var i=oV(n),a=oV(e),l=0;l<i.length;l+=1){var u=i[l];if(a.indexOf(u)>=0)return u}return!1},tne=function(n,e,i){var a=Wy(n),l=Wy(e),u=a[0],f=!1;return l.filter(Boolean).forEach(function(_){f=GM(f||_,_)||f,i.filter(Boolean).forEach(function(E){var b=GM(u,E);b&&(!f||Ly(b,f)?f=b:f=GM(b,f))})}),f},UY=function(n,e){return n.reduce(function(i,a){return i.concat(dDe(a,e))},[])},SDe=function(n,e){var i=new Map;return e.forEach(function(a){return i.set(a.node,a)}),n.map(function(a){return i.get(a)}).filter(iDe)},bDe=function(n,e){var i=DC(Wy(n).length>0?document:Gte(n).ownerDocument),a=Tj(n).filter(iV),l=tne(i||n,n,a),u=new Map,f=NC(a,u),_=f.filter(function(M){var F=M.node;return iV(F)});if(_[0]){var E=NC([l],u).map(function(M){var F=M.node;return F}),b=SDe(E,_),C=b.map(function(M){var F=M.node;return F}),I=b.filter(function(M){var F=M.tabIndex;return F>=0}).map(function(M){var F=M.node;return F}),O=EDe(C,I,E,i,e);if(O===sV){var L=MY(f,I,UY(a,u))||MY(f,C,UY(a,u));if(L)return{node:L};console.warn("focus-lock: cannot find any node to move focus into");return}return O===void 0?O:b[O]}},TDe=function(n){var e=Tj(n).filter(iV),i=tne(n,n,e),a=Ej(y0([i],!0),!0,!0),l=y0(e,!1);return a.map(function(u){var f=u.node,_=u.index;return{node:f,index:_,lockItem:l.indexOf(f)>=0,guard:yj(f)}})},Cj=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},HM=0,$M=!1,nne=function(n,e,i){i===void 0&&(i={});var a=bDe(n,e);if(!$M&&a){if(HM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),$M=!0,setTimeout(function(){$M=!1},1);return}HM++,Cj(a.node,i.focusOptions),HM--}};function _w(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var wDe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:_w(i),parent:_w(i.parentElement),left:_w(i.previousElementSibling),right:_w(i.nextElementSibling)}),i=i.parentElement;return{element:_w(n),stack:e,ownerDocument:n.ownerDocument}},CDe=function(n){var e,i,a,l,u;if(n)for(var f=n.stack,_=n.ownerDocument,E=new Map,b=0,C=f;b<C.length;b++){var I=C[b],O=(e=I.parent)===null||e===void 0?void 0:e.call(I);if(O&&_.contains(O)){for(var L=(i=I.left)===null||i===void 0?void 0:i.call(I),M=I.current(),F=O.contains(M)?M:void 0,z=(a=I.right)===null||a===void 0?void 0:a.call(I),X=bj([O],E),K=(u=(l=F??(L==null?void 0:L.nextElementSibling))!==null&&l!==void 0?l:z)!==null&&u!==void 0?u:L;K;){for(var ne=0,oe=X;ne<oe.length;ne++){var ae=oe[ne];if(K!=null&&K.contains(ae.node))return ae.node}K=K.nextElementSibling}if(X.length)return X[0].node}}},rne=function(n){var e=wDe(n);return function(){return CDe(e)}},RDe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var a=Wy(e);if(a.every(function(f){return!Ly(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?bj(a,new Map):NC(a,new Map),u=l.findIndex(function(f){var _=f.node;return _===n});if(u!==-1)return{prev:l[u-1],next:l[u+1],first:l[0],last:l[l.length-1]}},IDe=function(n,e){var i=e?bj(Wy(n),new Map):NC(Wy(n),new Map);return{first:i[0],last:i[i.length-1]}},ADe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},ine=function(n,e,i){e===void 0&&(e={});var a=ADe(e),l=RDe(n,a.scope,a.onlyTabbable);if(l){var u=i(l,a.cycle);u&&Cj(u.node,a.focusOptions)}},PDe=function(n,e){e===void 0&&(e={}),ine(n,e,function(i,a){var l=i.next,u=i.first;return l||a&&u})},ODe=function(n,e){e===void 0&&(e={}),ine(n,e,function(i,a){var l=i.prev,u=i.last;return l||a&&u})},sne=function(n,e,i){var a,l=IDe(n,(a=e.onlyTabbable)!==null&&a!==void 0?a:!0),u=l[i];u&&Cj(u.node,e.focusOptions)},kDe=function(n,e){e===void 0&&(e={}),sne(n,e,"first")},NDe=function(n,e){e===void 0&&(e={}),sne(n,e,"last")};function Rj(n){setTimeout(n,1)}var DDe=function(e){return e&&"current"in e?e.current:e},one=function(){return document&&document.activeElement===document.body},xDe=function(){return one()||gDe()},n0=null,ml=null,VY=function(){return null},r0=null,xC=!1,Ij=!1,LDe=function(){return!0},MDe=function(e){return(n0.whiteList||LDe)(e)},UDe=function(e,i){r0={observerNode:e,portaledElement:i}},VDe=function(e){return r0&&r0.portaledElement===e};function FY(n,e,i,a){var l=null,u=n;do{var f=a[u];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(u!==n)return;l=null}else break}while((u+=i)!==e);l&&(l.node.tabIndex=0)}var FDe=function(e){return e?!!xC:xC==="meanwhile"},jDe=function n(e,i,a){return i&&(i.host===e&&(!i.activeElement||a.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,a))},BDe=function(e,i){return i.some(function(a){return jDe(e,a,a)})},ane=function(e){return NC(e,new Map)},zDe=function(e){return!ane([e.parentNode]).some(function(i){return i.node===e})},Uk=function(){var e=!1;if(n0){var i=n0,a=i.observed,l=i.persistentFocus,u=i.autoFocus,f=i.shards,_=i.crossFrame,E=i.focusOptions,b=i.noFocusGuards,C=a||r0&&r0.portaledElement;if(one()&&ml&&ml!==document.body&&(!document.body.contains(ml)||zDe(ml))){var I=VY();I&&I.focus()}var O=document&&document.activeElement;if(C){var L=[C].concat(f.map(DDe).filter(Boolean)),M=function(){if(!FDe(_)||!b||!ml||Ij)return!1;var ne=ane(L),oe=ne.findIndex(function(ae){var le=ae.node;return le===ml});return oe===0||oe===ne.length-1};if((!O||MDe(O))&&(l||M()||!xDe()||!ml&&u)&&(C&&!(ene(L)||O&&BDe(O,L)||VDe(O))&&(document&&!ml&&O&&!u?(O.blur&&O.blur(),document.body.focus()):(e=nne(L,ml,{focusOptions:E}),r0={})),ml=document&&document.activeElement,ml!==document.body&&(VY=rne(ml)),xC=!1),document&&O!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var F=document&&document.activeElement,z=TDe(L),X=z.map(function(K){var ne=K.node;return ne}).indexOf(F);X>-1&&(z.filter(function(K){var ne=K.guard,oe=K.node;return ne&&oe.dataset.focusAutoGuard}).forEach(function(K){var ne=K.node;return ne.removeAttribute("tabIndex")}),FY(X,z.length,1,z),FY(X,-1,-1,z))}}}return e},cne=function(e){Uk()&&e&&(e.stopPropagation(),e.preventDefault())},Aj=function(){return Rj(Uk)},WDe=function(e){var i=e.target,a=e.currentTarget;a.contains(i)||UDe(a,i)},GDe=function(){return null},lne=function(){Ij=!0},une=function(){Ij=!1,xC="just",Rj(function(){xC="meanwhile"})},HDe=function(){document.addEventListener("focusin",cne),document.addEventListener("focusout",Aj),window.addEventListener("focus",lne),window.addEventListener("blur",une)},$De=function(){document.removeEventListener("focusin",cne),document.removeEventListener("focusout",Aj),window.removeEventListener("focus",lne),window.removeEventListener("blur",une)};function KDe(n){return n.filter(function(e){var i=e.disabled;return!i})}var dne={moveFocusInside:nne,focusInside:ene,focusNextElement:PDe,focusPrevElement:ODe,focusFirstElement:kDe,focusLastElement:NDe,captureFocusRestore:rne};function qDe(n){var e=n.slice(-1)[0];e&&!n0&&HDe();var i=n0,a=i&&e&&e.id===i.id;n0=e,i&&!a&&(i.onDeactivation(),n.filter(function(l){var u=l.id;return u===i.id}).length||i.returnFocus(!e)),e?(ml=null,(!a||i.observed!==e.observed)&&e.onActivation(dne),Uk(),Rj(Uk)):($De(),ml=null)}zte.assignSyncMedium(WDe);Wte.assignMedium(Aj);z1e.assignMedium(function(n){return n(dne)});const YDe=X1e(KDe,qDe)(GDe);var aV=N.forwardRef(function(e,i){return fi.createElement(_j,By({sideCar:YDe,ref:i},e))}),hne=_j.propTypes||{};hne.sideCar;O1e(hne,["sideCar"]);aV.propTypes={};const XDe=aV.default??aV,pne=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:a,restoreFocus:l,children:u,isDisabled:f,autoFocus:_,persistentFocus:E,lockFocusAcrossFrames:b}=n,C=N.useCallback(()=>{e!=null&&e.current?e.current.focus():a!=null&&a.current&&JQ(a.current).length===0&&requestAnimationFrame(()=>{var M;(M=a.current)==null||M.focus()})},[e,a]),I=N.useCallback(()=>{var L;(L=i==null?void 0:i.current)==null||L.focus()},[i]),O=l&&!i;return T.jsx(XDe,{crossFrame:b,persistentFocus:E,autoFocus:_,disabled:f,onActivation:C,onDeactivation:I,returnFocus:O,children:u})};pne.displayName="FocusLock";const[JDe,QDe]=Ti({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),sp=Bt((n,e)=>{const i=La("FormError",n),a=Bi(n),l=z0();return l!=null&&l.isInvalid?T.jsx(JDe,{value:i,children:T.jsx(Ut.div,{...l==null?void 0:l.getErrorMessageProps(a,e),className:_n("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});sp.displayName="FormErrorMessage";const ZDe=Bt((n,e)=>{const i=QDe(),a=z0();if(!(a!=null&&a.isInvalid))return null;const l=_n("chakra-form__error-icon",n.className);return T.jsx(mn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:T.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});ZDe.displayName="FormErrorIcon";const ns=Bt(function(e,i){const a=sd("FormLabel",e),l=Bi(e),{className:u,children:f,requiredIndicator:_=T.jsx(fne,{}),optionalIndicator:E=null,...b}=l,C=z0(),I=(C==null?void 0:C.getLabelProps(b,i))??{ref:i,...b};return T.jsxs(Ut.label,{...I,className:_n("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,C!=null&&C.isRequired?_:E]})});ns.displayName="FormLabel";const fne=Bt(function(e,i){const a=z0(),l=Lte();if(!(a!=null&&a.isRequired))return null;const u=_n("chakra-form__required-indicator",e.className);return T.jsx(Ut.span,{...a==null?void 0:a.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:u})});fne.displayName="RequiredIndicator";const Pj=Bt(function(e,i){const{templateAreas:a,gap:l,rowGap:u,columnGap:f,column:_,row:E,autoFlow:b,autoRows:C,templateRows:I,autoColumns:O,templateColumns:L,...M}=e,F={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:u,gridColumnGap:f,gridAutoColumns:O,gridColumn:_,gridRow:E,gridAutoFlow:b,gridAutoRows:C,gridTemplateRows:I,gridTemplateColumns:L};return T.jsx(Ut.div,{ref:i,__css:F,...M})});Pj.displayName="Grid";const mne=Bt(function(e,i){const{columns:a,spacingX:l,spacingY:u,spacing:f,minChildWidth:_,...E}=e,b=B0(),C=_?txe(_,b):nxe(a);return T.jsx(Pj,{ref:i,gap:f,columnGap:l,rowGap:u,templateColumns:C,...E})});mne.displayName="SimpleGrid";function exe(n){return typeof n=="number"?`${n}px`:n}function txe(n,e){return lF(n,i=>{const a=xNe("sizes",i,exe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function nxe(n){return lF(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function zg(n){const{viewBox:e="0 0 24 24",d:i,displayName:a,defaultProps:l={}}=n,u=N.Children.toArray(n.path),f=Bt((_,E)=>T.jsx(mn,{ref:E,viewBox:e,...l,..._,children:u.length?u:T.jsx("path",{fill:"currentColor",d:i})}));return f.displayName=a,f}const cV=Bt(function(e,i){const{htmlWidth:a,htmlHeight:l,alt:u,...f}=e;return T.jsx("img",{width:a,height:l,ref:i,alt:u,...f})});cV.displayName="NativeImage";const up=Bt(function(e,i){const{fallbackSrc:a,fallback:l,src:u,srcSet:f,align:_,fit:E,loading:b,ignoreFallback:C,crossOrigin:I,fallbackStrategy:O="beforeLoadOrError",referrerPolicy:L,...M}=e,F=a!==void 0||l!==void 0,z=b!=null||C||!F,X=Nte({...e,crossOrigin:I,ignoreFallback:z}),K=u1e(X,O),ne={ref:i,objectFit:E,objectPosition:_,...z?M:M0(M,["onError","onLoad"])};return K?l||T.jsx(Ut.img,{as:cV,className:"chakra-image__placeholder",src:a,...ne}):T.jsx(Ut.img,{as:cV,src:u,srcSet:f,crossOrigin:I,loading:b,referrerPolicy:L,className:"chakra-image",...ne})});up.displayName="Image";const Gi=Bt(function(e,i){const{htmlSize:a,...l}=e,u=La("Input",l),f=Bi(l),_=fj(f),E=_n("chakra-input",e.className);return T.jsx(Ut.input,{size:a,..._,__css:u.field,ref:i,className:E})});Gi.displayName="Input";Gi.id="Input";const[rxe,gne]=Ti({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),My=Bt(function(e,i){const a=La("Input",e),{children:l,className:u,...f}=Bi(e),_=_n("chakra-input__group",u),E={},b=mN(l),C=a.field;b.forEach(O=>{a&&(C&&O.type.id==="InputLeftElement"&&(E.paddingStart=C.height??C.h),C&&O.type.id==="InputRightElement"&&(E.paddingEnd=C.height??C.h),O.type.id==="InputRightAddon"&&(E.borderEndRadius=0),O.type.id==="InputLeftAddon"&&(E.borderStartRadius=0))});const I=b.map(O=>{var M,F;const L=gN({size:((M=O.props)==null?void 0:M.size)||e.size,variant:((F=O.props)==null?void 0:F.variant)||e.variant});return O.type.id!=="Input"?N.cloneElement(O,L):N.cloneElement(O,Object.assign(L,E,O.props))});return T.jsx(Ut.div,{className:_,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:T.jsx(rxe,{value:a,children:I})})});My.displayName="InputGroup";const ixe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},sxe=Ut("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),Oj=Bt(function(e,i){const{placement:a="left",...l}=e,u=ixe[a]??{},f=gne();return T.jsx(sxe,{ref:i,...l,__css:{...f.addon,...u}})});Oj.displayName="InputAddon";const kj=Bt(function(e,i){return T.jsx(Oj,{ref:i,placement:"left",...e,className:_n("chakra-input__left-addon",e.className)})});kj.displayName="InputLeftAddon";kj.id="InputLeftAddon";const _ne=Bt(function(e,i){return T.jsx(Oj,{ref:i,placement:"right",...e,className:_n("chakra-input__right-addon",e.className)})});_ne.displayName="InputRightAddon";_ne.id="InputRightAddon";const oxe=Ut("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),NN=Bt(function(e,i){const{placement:a="left",...l}=e,u=gne(),f=u.field,E={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...u.element};return T.jsx(oxe,{ref:i,__css:E,...l})});NN.id="InputElement";NN.displayName="InputElement";const lC=Bt(function(e,i){const{className:a,...l}=e,u=_n("chakra-input__left-element",a);return T.jsx(NN,{ref:i,placement:"left",className:u,...l})});lC.id="InputLeftElement";lC.displayName="InputLeftElement";const Vk=Bt(function(e,i){const{className:a,...l}=e,u=_n("chakra-input__right-element",a);return T.jsx(NN,{ref:i,placement:"right",className:u,...l})});Vk.id="InputRightElement";Vk.displayName="InputRightElement";const Ql=Bt(function(e,i){const a=sd("Link",e),{className:l,isExternal:u,...f}=Bi(e);return T.jsx(Ut.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:i,className:_n("chakra-link",l),...f,__css:a})});Ql.displayName="Link";const[axe,yne]=Ti({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),DN=Bt(function(e,i){const a=La("List",e),{children:l,styleType:u="none",stylePosition:f,spacing:_,...E}=Bi(e),b=mN(l),I=_?{["& > *:not(style) ~ *:not(style)"]:{mt:_}}:{};return T.jsx(axe,{value:a,children:T.jsx(Ut.ul,{ref:i,listStyleType:u,listStylePosition:f,role:"list",__css:{...a.container,...I},...E,children:b})})});DN.displayName="List";const cxe=Bt((n,e)=>{const{as:i,...a}=n;return T.jsx(DN,{ref:e,as:"ol",styleType:"decimal",marginStart:"1em",...a})});cxe.displayName="OrderedList";const lxe=Bt(function(e,i){const{as:a,...l}=e;return T.jsx(DN,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});lxe.displayName="UnorderedList";const Ene=Bt(function(e,i){const a=yne();return T.jsx(Ut.li,{ref:i,...e,__css:a.item})});Ene.displayName="ListItem";const uxe=Bt(function(e,i){const a=yne();return T.jsx(mn,{ref:i,role:"presentation",...e,__css:a.icon})});uxe.displayName="ListIcon";function dxe(n,e={}){const{ssr:i=!0,fallback:a}=e,{getWindow:l}=UIe(),u=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(b=>b!=null);const[_,E]=N.useState(()=>u.map((b,C)=>({media:b,matches:i?!!f[C]:l().matchMedia(b).matches})));return N.useEffect(()=>{const b=l();E(u.map(O=>({media:O,matches:b.matchMedia(O).matches})));const C=u.map(O=>b.matchMedia(O)),I=O=>{E(L=>L.slice().map(M=>M.media===O.media?{...M,matches:O.matches}:M))};return C.forEach(O=>{typeof O.addListener=="function"?O.addListener(I):O.addEventListener("change",I)}),()=>{C.forEach(O=>{typeof O.removeListener=="function"?O.removeListener(I):O.removeEventListener("change",I)})}},[l]),_.map(b=>b.matches)}function hxe(n,e,i,a){if(e==null)return a;if(!a)return n.find(f=>i(f).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(u=>i(u).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let u;return l.includes(a)?(u=l.indexOf(a)+1,u===l.length&&(u=0),l[u]):(u=n.indexOf(l[0]),n[u])}return a}function pxe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function fxe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[a,l]=N.useState([]),u=N.useRef(void 0),f=()=>{u.current&&(clearTimeout(u.current),u.current=null)},_=()=>{f(),u.current=setTimeout(()=>{l([]),u.current=null},e)};N.useEffect(()=>f,[]);function E(b){return C=>{if(C.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(pxe(C)){const I=a.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(I),b(I.join("")),_()}}}return E}var Tl="top",rd="bottom",id="right",wl="left",Nj="auto",sR=[Tl,rd,id,wl],E0="start",LC="end",mxe="clippingParents",vne="viewport",yw="popper",gxe="reference",jY=sR.reduce(function(n,e){return n.concat([e+"-"+E0,e+"-"+LC])},[]),Sne=[].concat(sR,[Nj]).reduce(function(n,e){return n.concat([e,e+"-"+E0,e+"-"+LC])},[]),_xe="beforeRead",yxe="read",Exe="afterRead",vxe="beforeMain",Sxe="main",bxe="afterMain",Txe="beforeWrite",wxe="write",Cxe="afterWrite",Rxe=[_xe,yxe,Exe,vxe,Sxe,bxe,Txe,wxe,Cxe];function Tp(n){return n?(n.nodeName||"").toLowerCase():null}function au(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function Gy(n){var e=au(n).Element;return n instanceof e||n instanceof Element}function Ju(n){var e=au(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function Dj(n){if(typeof ShadowRoot>"u")return!1;var e=au(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function Ixe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var a=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!Ju(u)||!Tp(u)||(Object.assign(u.style,a),Object.keys(l).forEach(function(f){var _=l[f];_===!1?u.removeAttribute(f):u.setAttribute(f,_===!0?"":_)}))})}function Axe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(a){var l=e.elements[a],u=e.attributes[a]||{},f=Object.keys(e.styles.hasOwnProperty(a)?e.styles[a]:i[a]),_=f.reduce(function(E,b){return E[b]="",E},{});!Ju(l)||!Tp(l)||(Object.assign(l.style,_),Object.keys(u).forEach(function(E){l.removeAttribute(E)}))})}}const Pxe={name:"applyStyles",enabled:!0,phase:"write",fn:Ixe,effect:Axe,requires:["computeStyles"]};function yp(n){return n.split("-")[0]}var Uy=Math.max,Fk=Math.min,v0=Math.round;function lV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function bne(){return!/^((?!chrome|android).)*safari/i.test(lV())}function S0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var a=n.getBoundingClientRect(),l=1,u=1;e&&Ju(n)&&(l=n.offsetWidth>0&&v0(a.width)/n.offsetWidth||1,u=n.offsetHeight>0&&v0(a.height)/n.offsetHeight||1);var f=Gy(n)?au(n):window,_=f.visualViewport,E=!bne()&&i,b=(a.left+(E&&_?_.offsetLeft:0))/l,C=(a.top+(E&&_?_.offsetTop:0))/u,I=a.width/l,O=a.height/u;return{width:I,height:O,top:C,right:b+I,bottom:C+O,left:b,x:b,y:C}}function xj(n){var e=S0(n),i=n.offsetWidth,a=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-a)<=1&&(a=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:a}}function Tne(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&Dj(i)){var a=e;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Kf(n){return au(n).getComputedStyle(n)}function Oxe(n){return["table","td","th"].indexOf(Tp(n))>=0}function Wg(n){return((Gy(n)?n.ownerDocument:n.document)||window.document).documentElement}function xN(n){return Tp(n)==="html"?n:n.assignedSlot||n.parentNode||(Dj(n)?n.host:null)||Wg(n)}function BY(n){return!Ju(n)||Kf(n).position==="fixed"?null:n.offsetParent}function kxe(n){var e=/firefox/i.test(lV()),i=/Trident/i.test(lV());if(i&&Ju(n)){var a=Kf(n);if(a.position==="fixed")return null}var l=xN(n);for(Dj(l)&&(l=l.host);Ju(l)&&["html","body"].indexOf(Tp(l))<0;){var u=Kf(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function oR(n){for(var e=au(n),i=BY(n);i&&Oxe(i)&&Kf(i).position==="static";)i=BY(i);return i&&(Tp(i)==="html"||Tp(i)==="body"&&Kf(i).position==="static")?e:i||kxe(n)||e}function Lj(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function uC(n,e,i){return Uy(n,Fk(e,i))}function Nxe(n,e,i){var a=uC(n,e,i);return a>i?i:a}function wne(){return{top:0,right:0,bottom:0,left:0}}function Cne(n){return Object.assign({},wne(),n)}function Rne(n,e){return e.reduce(function(i,a){return i[a]=n,i},{})}var Dxe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Cne(typeof e!="number"?e:Rne(e,sR))};function xxe(n){var e,i=n.state,a=n.name,l=n.options,u=i.elements.arrow,f=i.modifiersData.popperOffsets,_=yp(i.placement),E=Lj(_),b=[wl,id].indexOf(_)>=0,C=b?"height":"width";if(!(!u||!f)){var I=Dxe(l.padding,i),O=xj(u),L=E==="y"?Tl:wl,M=E==="y"?rd:id,F=i.rects.reference[C]+i.rects.reference[E]-f[E]-i.rects.popper[C],z=f[E]-i.rects.reference[E],X=oR(u),K=X?E==="y"?X.clientHeight||0:X.clientWidth||0:0,ne=F/2-z/2,oe=I[L],ae=K-O[C]-I[M],le=K/2-O[C]/2+ne,Y=uC(oe,le,ae),Z=E;i.modifiersData[a]=(e={},e[Z]=Y,e.centerOffset=Y-le,e)}}function Lxe(n){var e=n.state,i=n.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||Tne(e.elements.popper,l)&&(e.elements.arrow=l))}const Mxe={name:"arrow",enabled:!0,phase:"main",fn:xxe,effect:Lxe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function b0(n){return n.split("-")[1]}var Uxe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Vxe(n,e){var i=n.x,a=n.y,l=e.devicePixelRatio||1;return{x:v0(i*l)/l||0,y:v0(a*l)/l||0}}function zY(n){var e,i=n.popper,a=n.popperRect,l=n.placement,u=n.variation,f=n.offsets,_=n.position,E=n.gpuAcceleration,b=n.adaptive,C=n.roundOffsets,I=n.isFixed,O=f.x,L=O===void 0?0:O,M=f.y,F=M===void 0?0:M,z=typeof C=="function"?C({x:L,y:F}):{x:L,y:F};L=z.x,F=z.y;var X=f.hasOwnProperty("x"),K=f.hasOwnProperty("y"),ne=wl,oe=Tl,ae=window;if(b){var le=oR(i),Y="clientHeight",Z="clientWidth";if(le===au(i)&&(le=Wg(i),Kf(le).position!=="static"&&_==="absolute"&&(Y="scrollHeight",Z="scrollWidth")),le=le,l===Tl||(l===wl||l===id)&&u===LC){oe=rd;var Q=I&&le===ae&&ae.visualViewport?ae.visualViewport.height:le[Y];F-=Q-a.height,F*=E?1:-1}if(l===wl||(l===Tl||l===rd)&&u===LC){ne=id;var ie=I&&le===ae&&ae.visualViewport?ae.visualViewport.width:le[Z];L-=ie-a.width,L*=E?1:-1}}var de=Object.assign({position:_},b&&Uxe),ue=C===!0?Vxe({x:L,y:F},au(i)):{x:L,y:F};if(L=ue.x,F=ue.y,E){var pe;return Object.assign({},de,(pe={},pe[oe]=K?"0":"",pe[ne]=X?"0":"",pe.transform=(ae.devicePixelRatio||1)<=1?"translate("+L+"px, "+F+"px)":"translate3d("+L+"px, "+F+"px, 0)",pe))}return Object.assign({},de,(e={},e[oe]=K?F+"px":"",e[ne]=X?L+"px":"",e.transform="",e))}function Fxe(n){var e=n.state,i=n.options,a=i.gpuAcceleration,l=a===void 0?!0:a,u=i.adaptive,f=u===void 0?!0:u,_=i.roundOffsets,E=_===void 0?!0:_,b={placement:yp(e.placement),variation:b0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,zY(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:f,roundOffsets:E})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,zY(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const jxe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Fxe,data:{}};var TO={passive:!0};function Bxe(n){var e=n.state,i=n.instance,a=n.options,l=a.scroll,u=l===void 0?!0:l,f=a.resize,_=f===void 0?!0:f,E=au(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&b.forEach(function(C){C.addEventListener("scroll",i.update,TO)}),_&&E.addEventListener("resize",i.update,TO),function(){u&&b.forEach(function(C){C.removeEventListener("scroll",i.update,TO)}),_&&E.removeEventListener("resize",i.update,TO)}}const zxe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Bxe,data:{}};var Wxe={left:"right",right:"left",bottom:"top",top:"bottom"};function ik(n){return n.replace(/left|right|bottom|top/g,function(e){return Wxe[e]})}var Gxe={start:"end",end:"start"};function WY(n){return n.replace(/start|end/g,function(e){return Gxe[e]})}function Mj(n){var e=au(n),i=e.pageXOffset,a=e.pageYOffset;return{scrollLeft:i,scrollTop:a}}function Uj(n){return S0(Wg(n)).left+Mj(n).scrollLeft}function Hxe(n,e){var i=au(n),a=Wg(n),l=i.visualViewport,u=a.clientWidth,f=a.clientHeight,_=0,E=0;if(l){u=l.width,f=l.height;var b=bne();(b||!b&&e==="fixed")&&(_=l.offsetLeft,E=l.offsetTop)}return{width:u,height:f,x:_+Uj(n),y:E}}function $xe(n){var e,i=Wg(n),a=Mj(n),l=(e=n.ownerDocument)==null?void 0:e.body,u=Uy(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=Uy(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),_=-a.scrollLeft+Uj(n),E=-a.scrollTop;return Kf(l||i).direction==="rtl"&&(_+=Uy(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:f,x:_,y:E}}function Vj(n){var e=Kf(n),i=e.overflow,a=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function Ine(n){return["html","body","#document"].indexOf(Tp(n))>=0?n.ownerDocument.body:Ju(n)&&Vj(n)?n:Ine(xN(n))}function dC(n,e){var i;e===void 0&&(e=[]);var a=Ine(n),l=a===((i=n.ownerDocument)==null?void 0:i.body),u=au(a),f=l?[u].concat(u.visualViewport||[],Vj(a)?a:[]):a,_=e.concat(f);return l?_:_.concat(dC(xN(f)))}function uV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function Kxe(n,e){var i=S0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function GY(n,e,i){return e===vne?uV(Hxe(n,i)):Gy(e)?Kxe(e,i):uV($xe(Wg(n)))}function qxe(n){var e=dC(xN(n)),i=["absolute","fixed"].indexOf(Kf(n).position)>=0,a=i&&Ju(n)?oR(n):n;return Gy(a)?e.filter(function(l){return Gy(l)&&Tne(l,a)&&Tp(l)!=="body"}):[]}function Yxe(n,e,i,a){var l=e==="clippingParents"?qxe(n):[].concat(e),u=[].concat(l,[i]),f=u[0],_=u.reduce(function(E,b){var C=GY(n,b,a);return E.top=Uy(C.top,E.top),E.right=Fk(C.right,E.right),E.bottom=Fk(C.bottom,E.bottom),E.left=Uy(C.left,E.left),E},GY(n,f,a));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}function Ane(n){var e=n.reference,i=n.element,a=n.placement,l=a?yp(a):null,u=a?b0(a):null,f=e.x+e.width/2-i.width/2,_=e.y+e.height/2-i.height/2,E;switch(l){case Tl:E={x:f,y:e.y-i.height};break;case rd:E={x:f,y:e.y+e.height};break;case id:E={x:e.x+e.width,y:_};break;case wl:E={x:e.x-i.width,y:_};break;default:E={x:e.x,y:e.y}}var b=l?Lj(l):null;if(b!=null){var C=b==="y"?"height":"width";switch(u){case E0:E[b]=E[b]-(e[C]/2-i[C]/2);break;case LC:E[b]=E[b]+(e[C]/2-i[C]/2);break}}return E}function MC(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=a===void 0?n.placement:a,u=i.strategy,f=u===void 0?n.strategy:u,_=i.boundary,E=_===void 0?mxe:_,b=i.rootBoundary,C=b===void 0?vne:b,I=i.elementContext,O=I===void 0?yw:I,L=i.altBoundary,M=L===void 0?!1:L,F=i.padding,z=F===void 0?0:F,X=Cne(typeof z!="number"?z:Rne(z,sR)),K=O===yw?gxe:yw,ne=n.rects.popper,oe=n.elements[M?K:O],ae=Yxe(Gy(oe)?oe:oe.contextElement||Wg(n.elements.popper),E,C,f),le=S0(n.elements.reference),Y=Ane({reference:le,element:ne,placement:l}),Z=uV(Object.assign({},ne,Y)),Q=O===yw?Z:le,ie={top:ae.top-Q.top+X.top,bottom:Q.bottom-ae.bottom+X.bottom,left:ae.left-Q.left+X.left,right:Q.right-ae.right+X.right},de=n.modifiersData.offset;if(O===yw&&de){var ue=de[l];Object.keys(ie).forEach(function(pe){var ke=[id,rd].indexOf(pe)>=0?1:-1,xe=[Tl,rd].indexOf(pe)>=0?"y":"x";ie[pe]+=ue[xe]*ke})}return ie}function Xxe(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=i.boundary,u=i.rootBoundary,f=i.padding,_=i.flipVariations,E=i.allowedAutoPlacements,b=E===void 0?Sne:E,C=b0(a),I=C?_?jY:jY.filter(function(M){return b0(M)===C}):sR,O=I.filter(function(M){return b.indexOf(M)>=0});O.length===0&&(O=I);var L=O.reduce(function(M,F){return M[F]=MC(n,{placement:F,boundary:l,rootBoundary:u,padding:f})[yp(F)],M},{});return Object.keys(L).sort(function(M,F){return L[M]-L[F]})}function Jxe(n){if(yp(n)===Nj)return[];var e=ik(n);return[WY(n),e,WY(e)]}function Qxe(n){var e=n.state,i=n.options,a=n.name;if(!e.modifiersData[a]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!0:f,E=i.fallbackPlacements,b=i.padding,C=i.boundary,I=i.rootBoundary,O=i.altBoundary,L=i.flipVariations,M=L===void 0?!0:L,F=i.allowedAutoPlacements,z=e.options.placement,X=yp(z),K=X===z,ne=E||(K||!M?[ik(z)]:Jxe(z)),oe=[z].concat(ne).reduce(function(Me,ze){return Me.concat(yp(ze)===Nj?Xxe(e,{placement:ze,boundary:C,rootBoundary:I,padding:b,flipVariations:M,allowedAutoPlacements:F}):ze)},[]),ae=e.rects.reference,le=e.rects.popper,Y=new Map,Z=!0,Q=oe[0],ie=0;ie<oe.length;ie++){var de=oe[ie],ue=yp(de),pe=b0(de)===E0,ke=[Tl,rd].indexOf(ue)>=0,xe=ke?"width":"height",Fe=MC(e,{placement:de,boundary:C,rootBoundary:I,altBoundary:O,padding:b}),Oe=ke?pe?id:wl:pe?rd:Tl;ae[xe]>le[xe]&&(Oe=ik(Oe));var we=ik(Oe),Se=[];if(u&&Se.push(Fe[ue]<=0),_&&Se.push(Fe[Oe]<=0,Fe[we]<=0),Se.every(function(Me){return Me})){Q=de,Z=!1;break}Y.set(de,Se)}if(Z)for(var Be=M?3:1,Ee=function(ze){var He=oe.find(function(qe){var nt=Y.get(qe);if(nt)return nt.slice(0,ze).every(function(Ze){return Ze})});if(He)return Q=He,"break"},Ce=Be;Ce>0;Ce--){var Pe=Ee(Ce);if(Pe==="break")break}e.placement!==Q&&(e.modifiersData[a]._skip=!0,e.placement=Q,e.reset=!0)}}const Zxe={name:"flip",enabled:!0,phase:"main",fn:Qxe,requiresIfExists:["offset"],data:{_skip:!1}};function HY(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function $Y(n){return[Tl,id,rd,wl].some(function(e){return n[e]>=0})}function eLe(n){var e=n.state,i=n.name,a=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,f=MC(e,{elementContext:"reference"}),_=MC(e,{altBoundary:!0}),E=HY(f,a),b=HY(_,l,u),C=$Y(E),I=$Y(b);e.modifiersData[i]={referenceClippingOffsets:E,popperEscapeOffsets:b,isReferenceHidden:C,hasPopperEscaped:I},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":I})}const tLe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:eLe};function nLe(n,e,i){var a=yp(n),l=[wl,Tl].indexOf(a)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,f=u[0],_=u[1];return f=f||0,_=(_||0)*l,[wl,id].indexOf(a)>=0?{x:_,y:f}:{x:f,y:_}}function rLe(n){var e=n.state,i=n.options,a=n.name,l=i.offset,u=l===void 0?[0,0]:l,f=Sne.reduce(function(C,I){return C[I]=nLe(I,e.rects,u),C},{}),_=f[e.placement],E=_.x,b=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=E,e.modifiersData.popperOffsets.y+=b),e.modifiersData[a]=f}const iLe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:rLe};function sLe(n){var e=n.state,i=n.name;e.modifiersData[i]=Ane({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const oLe={name:"popperOffsets",enabled:!0,phase:"read",fn:sLe,data:{}};function aLe(n){return n==="x"?"y":"x"}function cLe(n){var e=n.state,i=n.options,a=n.name,l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!1:f,E=i.boundary,b=i.rootBoundary,C=i.altBoundary,I=i.padding,O=i.tether,L=O===void 0?!0:O,M=i.tetherOffset,F=M===void 0?0:M,z=MC(e,{boundary:E,rootBoundary:b,padding:I,altBoundary:C}),X=yp(e.placement),K=b0(e.placement),ne=!K,oe=Lj(X),ae=aLe(oe),le=e.modifiersData.popperOffsets,Y=e.rects.reference,Z=e.rects.popper,Q=typeof F=="function"?F(Object.assign({},e.rects,{placement:e.placement})):F,ie=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),de=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ue={x:0,y:0};if(le){if(u){var pe,ke=oe==="y"?Tl:wl,xe=oe==="y"?rd:id,Fe=oe==="y"?"height":"width",Oe=le[oe],we=Oe+z[ke],Se=Oe-z[xe],Be=L?-Z[Fe]/2:0,Ee=K===E0?Y[Fe]:Z[Fe],Ce=K===E0?-Z[Fe]:-Y[Fe],Pe=e.elements.arrow,Me=L&&Pe?xj(Pe):{width:0,height:0},ze=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:wne(),He=ze[ke],qe=ze[xe],nt=uC(0,Y[Fe],Me[Fe]),Ze=ne?Y[Fe]/2-Be-nt-He-ie.mainAxis:Ee-nt-He-ie.mainAxis,gt=ne?-Y[Fe]/2+Be+nt+qe+ie.mainAxis:Ce+nt+qe+ie.mainAxis,sn=e.elements.arrow&&oR(e.elements.arrow),ut=sn?oe==="y"?sn.clientTop||0:sn.clientLeft||0:0,kt=(pe=de==null?void 0:de[oe])!=null?pe:0,ct=Oe+Ze-kt-ut,Mt=Oe+gt-kt,fn=uC(L?Fk(we,ct):we,Oe,L?Uy(Se,Mt):Se);le[oe]=fn,ue[oe]=fn-Oe}if(_){var zt,Te=oe==="x"?Tl:wl,Ve=oe==="x"?rd:id,$e=le[ae],Et=ae==="y"?"height":"width",vt=$e+z[Te],St=$e-z[Ve],Wt=[Tl,wl].indexOf(X)!==-1,dn=(zt=de==null?void 0:de[ae])!=null?zt:0,En=Wt?vt:$e-Y[Et]-Z[Et]-dn+ie.altAxis,tn=Wt?$e+Y[Et]+Z[Et]-dn-ie.altAxis:St,wt=L&&Wt?Nxe(En,$e,tn):uC(L?En:vt,$e,L?tn:St);le[ae]=wt,ue[ae]=wt-$e}e.modifiersData[a]=ue}}const lLe={name:"preventOverflow",enabled:!0,phase:"main",fn:cLe,requiresIfExists:["offset"]};function uLe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function dLe(n){return n===au(n)||!Ju(n)?Mj(n):uLe(n)}function hLe(n){var e=n.getBoundingClientRect(),i=v0(e.width)/n.offsetWidth||1,a=v0(e.height)/n.offsetHeight||1;return i!==1||a!==1}function pLe(n,e,i){i===void 0&&(i=!1);var a=Ju(e),l=Ju(e)&&hLe(e),u=Wg(e),f=S0(n,l,i),_={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(a||!a&&!i)&&((Tp(e)!=="body"||Vj(u))&&(_=dLe(e)),Ju(e)?(E=S0(e,!0),E.x+=e.clientLeft,E.y+=e.clientTop):u&&(E.x=Uj(u))),{x:f.left+_.scrollLeft-E.x,y:f.top+_.scrollTop-E.y,width:f.width,height:f.height}}function fLe(n){var e=new Map,i=new Set,a=[];n.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var f=[].concat(u.requires||[],u.requiresIfExists||[]);f.forEach(function(_){if(!i.has(_)){var E=e.get(_);E&&l(E)}}),a.push(u)}return n.forEach(function(u){i.has(u.name)||l(u)}),a}function mLe(n){var e=fLe(n);return Rxe.reduce(function(i,a){return i.concat(e.filter(function(l){return l.phase===a}))},[])}function gLe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function _Le(n){var e=n.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(e).map(function(i){return e[i]})}var KY={placement:"bottom",modifiers:[],strategy:"absolute"};function qY(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function yLe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,a=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?KY:l;return function(_,E,b){b===void 0&&(b=u);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},KY,u),modifiersData:{},elements:{reference:_,popper:E},attributes:{},styles:{}},I=[],O=!1,L={state:C,setOptions:function(X){var K=typeof X=="function"?X(C.options):X;F(),C.options=Object.assign({},u,C.options,K),C.scrollParents={reference:Gy(_)?dC(_):_.contextElement?dC(_.contextElement):[],popper:dC(E)};var ne=mLe(_Le([].concat(a,C.options.modifiers)));return C.orderedModifiers=ne.filter(function(oe){return oe.enabled}),M(),L.update()},forceUpdate:function(){if(!O){var X=C.elements,K=X.reference,ne=X.popper;if(qY(K,ne)){C.rects={reference:pLe(K,oR(ne),C.options.strategy==="fixed"),popper:xj(ne)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(ie){return C.modifiersData[ie.name]=Object.assign({},ie.data)});for(var oe=0;oe<C.orderedModifiers.length;oe++){if(C.reset===!0){C.reset=!1,oe=-1;continue}var ae=C.orderedModifiers[oe],le=ae.fn,Y=ae.options,Z=Y===void 0?{}:Y,Q=ae.name;typeof le=="function"&&(C=le({state:C,options:Z,name:Q,instance:L})||C)}}}},update:gLe(function(){return new Promise(function(z){L.forceUpdate(),z(C)})}),destroy:function(){F(),O=!0}};if(!qY(_,E))return L;L.setOptions(b).then(function(z){!O&&b.onFirstUpdate&&b.onFirstUpdate(z)});function M(){C.orderedModifiers.forEach(function(z){var X=z.name,K=z.options,ne=K===void 0?{}:K,oe=z.effect;if(typeof oe=="function"){var ae=oe({state:C,name:X,instance:L,options:ne}),le=function(){};I.push(ae||le)}})}function F(){I.forEach(function(z){return z()}),I=[]}return L}}var ELe=[zxe,oLe,jxe,Pxe,iLe,Zxe,lLe,Mxe,tLe],vLe=yLe({defaultModifiers:ELe});const wS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),ho={arrowShadowColor:wS("--popper-arrow-shadow-color"),arrowSize:wS("--popper-arrow-size","8px"),arrowSizeHalf:wS("--popper-arrow-size-half"),arrowBg:wS("--popper-arrow-bg"),transformOrigin:wS("--popper-transform-origin"),arrowOffset:wS("--popper-arrow-offset")};function SLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const bLe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},TLe=n=>bLe[n],YY={scroll:!0,resize:!0};function wLe(n){let e;return typeof n=="object"?e={enabled:!0,options:{...YY,...n}}:e={enabled:n,options:YY},e}const CLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},RLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{XY(n)},effect:({state:n})=>()=>{XY(n)}},XY=n=>{n.elements.popper.style.setProperty(ho.transformOrigin.var,TLe(n.placement))},ILe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{ALe(n)}},ALe=n=>{var i;if(!n.placement)return;const e=PLe(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:ho.arrowSize.varRef,height:ho.arrowSize.varRef,zIndex:-1});const a={[ho.arrowSizeHalf.var]:`calc(${ho.arrowSize.varRef} / 2 - 1px)`,[ho.arrowOffset.var]:`calc(${ho.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},PLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:ho.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:ho.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:ho.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:ho.arrowOffset.varRef}},OLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{JY(n)},effect:({state:n})=>()=>{JY(n)}},JY=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=SLe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:ho.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},kLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},NLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function DLe(n,e="ltr"){var a;const i=((a=kLe[n])==null?void 0:a[e])||n;return e==="ltr"?i:NLe[n]??i}function Fj(n={}){const{enabled:e=!0,modifiers:i,placement:a="bottom",strategy:l="absolute",arrowPadding:u=8,eventListeners:f=!0,offset:_,gutter:E=8,flip:b=!0,boundary:C="clippingParents",preventOverflow:I=!0,matchWidth:O,direction:L="ltr"}=n,M=N.useRef(null),F=N.useRef(null),z=N.useRef(null),X=DLe(a,L),K=N.useRef(()=>{}),ne=N.useCallback(()=>{var ie;!e||!M.current||!F.current||((ie=K.current)==null||ie.call(K),z.current=vLe(M.current,F.current,{placement:X,modifiers:[OLe,ILe,RLe,{...CLe,enabled:!!O},{name:"eventListeners",...wLe(f)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:_??[0,E]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:C}},...i??[]],strategy:l}),z.current.forceUpdate(),K.current=z.current.destroy)},[X,e,i,O,f,u,_,E,b,I,C,l]);N.useEffect(()=>()=>{var ie;!M.current&&!F.current&&((ie=z.current)==null||ie.destroy(),z.current=null)},[]);const oe=N.useCallback(ie=>{M.current=ie,ne()},[ne]),ae=N.useCallback((ie={},de=null)=>({...ie,ref:Fi(oe,de)}),[oe]),le=N.useCallback(ie=>{F.current=ie,ne()},[ne]),Y=N.useCallback((ie={},de=null)=>({...ie,ref:Fi(le,de),style:{...ie.style,position:l,minWidth:O?void 0:"max-content",inset:"0 auto auto 0"}}),[l,le,O]),Z=N.useCallback((ie={},de=null)=>{const{size:ue,shadowColor:pe,bg:ke,style:xe,...Fe}=ie;return{...Fe,ref:de,"data-popper-arrow":"",style:xLe(ie)}},[]),Q=N.useCallback((ie={},de=null)=>({...ie,ref:de,"data-popper-arrow-inner":""}),[]);return{update(){var ie;(ie=z.current)==null||ie.update()},forceUpdate(){var ie;(ie=z.current)==null||ie.forceUpdate()},transformOrigin:ho.transformOrigin.varRef,referenceRef:oe,popperRef:le,getPopperProps:Y,getArrowProps:Z,getArrowInnerProps:Q,getReferenceProps:ae}}function xLe(n){const{size:e,shadowColor:i,bg:a,style:l}=n,u={...l,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),i&&(u["--popper-arrow-shadow-color"]=i),a&&(u["--popper-arrow-bg"]=a),u}function LLe(){const n=N.useRef(new Map),e=n.current,i=N.useCallback((l,u,f,_)=>{n.current.set(f,{type:u,el:l,options:_}),l.addEventListener(u,f,_)},[]),a=N.useCallback((l,u,f,_)=>{l.removeEventListener(u,f,_),n.current.delete(f)},[]);return N.useEffect(()=>()=>{e.forEach((l,u)=>{a(l.el,l.type,u,l.options)})},[a,e]),{add:i,remove:a}}function KM(n){var l,u;const e=((u=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:u[0])??n.target,{tagName:i,isContentEditable:a}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&a!==!0}function Pne(n={}){const{ref:e,isDisabled:i,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:u=!0,onMouseDown:f,onMouseUp:_,onClick:E,onKeyDown:b,onKeyUp:C,tabIndex:I,onMouseOver:O,onMouseLeave:L,...M}=n,[F,z]=N.useState(!0),[X,K]=N.useState(!1),ne=LLe(),oe=Oe=>{Oe&&Oe.tagName!=="BUTTON"&&z(!1)},ae=F?I:I||0,le=i&&!a,Y=N.useCallback(Oe=>{if(i){Oe.stopPropagation(),Oe.preventDefault();return}Oe.currentTarget.focus(),E==null||E(Oe)},[i,E]),Z=N.useCallback(Oe=>{X&&KM(Oe)&&(Oe.preventDefault(),Oe.stopPropagation(),K(!1),ne.remove(document,"keyup",Z,!1))},[X,ne]),Q=N.useCallback(Oe=>{if(b==null||b(Oe),i||Oe.defaultPrevented||Oe.metaKey||!KM(Oe.nativeEvent)||F)return;const we=l&&Oe.key==="Enter";u&&Oe.key===" "&&(Oe.preventDefault(),K(!0)),we&&(Oe.preventDefault(),Oe.currentTarget.click()),ne.add(document,"keyup",Z,!1)},[i,F,b,l,u,ne,Z]),ie=N.useCallback(Oe=>{if(C==null||C(Oe),i||Oe.defaultPrevented||Oe.metaKey||!KM(Oe.nativeEvent)||F)return;u&&Oe.key===" "&&(Oe.preventDefault(),K(!1),Oe.currentTarget.click())},[u,F,i,C]),de=N.useCallback(Oe=>{Oe.button===0&&(K(!1),ne.remove(document,"mouseup",de,!1))},[ne]),ue=N.useCallback(Oe=>{if(Oe.button!==0)return;if(i){Oe.stopPropagation(),Oe.preventDefault();return}F||K(!0),Oe.currentTarget.focus({preventScroll:!0}),ne.add(document,"mouseup",de,!1),f==null||f(Oe)},[i,F,f,ne,de]),pe=N.useCallback(Oe=>{Oe.button===0&&(F||K(!1),_==null||_(Oe))},[_,F]),ke=N.useCallback(Oe=>{if(i){Oe.preventDefault();return}O==null||O(Oe)},[i,O]),xe=N.useCallback(Oe=>{X&&(Oe.preventDefault(),K(!1)),L==null||L(Oe)},[X,L]),Fe=Fi(e,oe);return F?{...M,ref:Fe,type:"button","aria-disabled":le?void 0:i,disabled:le,onClick:Y,onMouseDown:f,onMouseUp:_,onKeyUp:C,onKeyDown:b,onMouseOver:O,onMouseLeave:L}:{...M,ref:Fe,role:"button","data-active":rr(X),"aria-disabled":i?"true":void 0,tabIndex:le?void 0:ae,onClick:Y,onMouseDown:ue,onMouseUp:pe,onKeyUp:ie,onKeyDown:Q,onMouseOver:ke,onMouseLeave:xe}}const[MLe,ULe,VLe,FLe]=Pte(),[jLe,aR]=Ti({strict:!1,name:"MenuContext"});function One(n){return(n==null?void 0:n.ownerDocument)??document}function BLe(n){return One(n).activeElement===n}function zLe(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:u=!0,isLazy:f,isOpen:_,defaultIsOpen:E,onClose:b,onOpen:C,placement:I="bottom-start",lazyBehavior:O="unmount",direction:L,computePositionOnMount:M=!1,...F}=n,z=N.useRef(null),X=N.useRef(null),K=N.useRef(!0),ne=VLe(),oe=N.useCallback(()=>{requestAnimationFrame(()=>{var Pe;(Pe=z.current)==null||Pe.focus({preventScroll:!1})})},[]),ae=N.useCallback(()=>{const Pe=setTimeout(()=>{var Me,ze;if(l)(Me=l.current)==null||Me.focus();else if(!ne.count())(ze=z.current)==null||ze.focus({preventScroll:!1});else{const He=ne.firstEnabled();He&&ke(He.index)}});Se.current.add(Pe)},[ne,l]),le=N.useCallback(()=>{const Pe=setTimeout(()=>{var Me;if(!ne.count())(Me=z.current)==null||Me.focus({preventScroll:!1});else{const ze=ne.lastEnabled();ze&&ke(ze.index)}});Se.current.add(Pe)},[ne]),Y=N.useCallback(()=>{C==null||C(),u?ae():oe()},[u,ae,oe,C]),{isOpen:Z,onOpen:Q,onClose:ie,onToggle:de}=th({isOpen:_,defaultIsOpen:E,onClose:b,onOpen:Y});aZ({enabled:Z&&a,ref:z,handler:Pe=>{var ze,He,qe;const Me=((He=(ze=Pe.composedPath)==null?void 0:ze.call(Pe))==null?void 0:He[0])??Pe.target;(qe=X.current)!=null&&qe.contains(Me)||ie()}});const ue=Fj({...F,enabled:Z||M,placement:I,direction:L}),[pe,ke]=N.useState(-1);iZ(z,{focusRef:X,visible:Z,shouldFocus:!0});const xe=tZ({isOpen:Z,ref:z}),[Fe,Oe]=WEe(e,"menu-button","menu-list"),we=N.useCallback(()=>{Q(),oe()},[Q,oe]),Se=N.useRef(new Set([]));N.useEffect(()=>{const Pe=Se.current;return()=>{Pe.forEach(Me=>clearTimeout(Me)),Pe.clear()}},[]),Gf(()=>{var Pe;Z||(ke(-1),(Pe=z.current)==null||Pe.scrollTo(0,0))},[Z]),Gf(()=>{Z&&pe===-1&&oe()},[pe,Z]),N.useEffect(()=>{var Me;if(!Z)return;const Pe=ne.item(pe);(Me=Pe==null?void 0:Pe.node)==null||Me.focus({preventScroll:!K.current})},[ne,pe,Z]);const Be=N.useCallback(()=>{Q(),ae()},[ae,Q]),Ee=N.useCallback(()=>{K.current=!0,Q(),le()},[Q,le]),Ce=N.useCallback(()=>{var qe,nt;const Pe=One(z.current),Me=(qe=z.current)==null?void 0:qe.contains(Pe.activeElement);if(!(Z&&!Me))return;const He=(nt=ne.item(pe))==null?void 0:nt.node;He==null||He.focus({preventScroll:!K.current})},[Z,pe,ne]);return{openAndFocusMenu:we,openAndFocusFirstItem:Be,openAndFocusLastItem:Ee,onTransitionEnd:Ce,unstable__animationState:xe,descendants:ne,popper:ue,buttonId:Fe,menuId:Oe,forceUpdate:ue.forceUpdate,orientation:"vertical",isOpen:Z,onToggle:de,onOpen:Q,onClose:ie,menuRef:z,buttonRef:X,focusedIndex:pe,closeOnSelect:i,closeOnBlur:a,autoSelect:u,setFocusedIndex:ke,isLazy:f,lazyBehavior:O,initialFocusRef:l,scrollIntoViewRef:K}}function WLe(n={},e=null){const i=aR(),{onToggle:a,popper:l,openAndFocusFirstItem:u,openAndFocusLastItem:f,scrollIntoViewRef:_}=i,E=N.useCallback(b=>{const C=b.key,O={Enter:u,ArrowDown:u,ArrowUp:f}[C];O&&(_.current=!0,b.preventDefault(),b.stopPropagation(),O(b))},[u,f,_]);return{...n,ref:Fi(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":rr(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Nn(n.onClick,a),onKeyDown:Nn(n.onKeyDown,E)}}function dV(n){var e;return KLe(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function GLe(n={},e=null){const i=aR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:u,isOpen:f,onClose:_,menuId:E,isLazy:b,lazyBehavior:C,scrollIntoViewRef:I,unstable__animationState:O}=i,L=ULe(),M=fxe({preventDefault:K=>K.key!==" "&&dV(K.target)}),F=N.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const ne=K.key,ae={Tab:Y=>Y.preventDefault(),Escape:Y=>{Y.stopPropagation(),_()},ArrowDown:()=>{I.current=!0;const Y=L.nextEnabled(a)??L.firstEnabled();Y&&l(Y.index)},ArrowUp:()=>{I.current=!0;const Y=L.prevEnabled(a)??L.firstEnabled();Y&&l(Y.index)}}[ne];if(ae){K.preventDefault(),ae(K);return}const le=M(Y=>{const Z=hxe(L.values(),Y,Q=>{var ie;return((ie=Q==null?void 0:Q.node)==null?void 0:ie.textContent)??""},L.item(a));if(Z){const Q=L.indexOf(Z.node);l(Q)}});dV(K.target)&&le(K)},[L,a,M,_,l,I]),z=N.useRef(!1);f&&(z.current=!0);const X=aF({wasSelected:z.current,enabled:b,mode:C,isSelected:O.present});return{...n,ref:Fi(u,e),children:X?n.children:null,tabIndex:-1,role:"menu",id:E,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Nn(n.onKeyDown,F)}}function HLe(n={}){const{popper:e,isOpen:i}=aR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function $Le(n={},e=null){const{onMouseEnter:i,onMouseMove:a,onMouseLeave:l,onClick:u,onFocus:f,isDisabled:_,isFocusable:E,closeOnSelect:b,type:C,...I}=n,O=aR(),{setFocusedIndex:L,focusedIndex:M,closeOnSelect:F,onClose:z,menuId:X,scrollIntoViewRef:K}=O,ne=N.useRef(null),oe=`${X}-menuitem-${N.useId()}`,{index:ae,register:le}=FLe({disabled:_&&!E}),Y=N.useCallback(ke=>{i==null||i(ke),!_&&(K.current=!1,L(ae))},[L,ae,_,i,K]),Z=N.useCallback(ke=>{a==null||a(ke),ne.current&&!BLe(ne.current)&&Y(ke)},[Y,a]),Q=N.useCallback(ke=>{l==null||l(ke),!_&&L(-1)},[L,_,l]),ie=N.useCallback(ke=>{u==null||u(ke),dV(ke.currentTarget)&&(b??F)&&z()},[z,u,F,b]),de=N.useCallback(ke=>{f==null||f(ke),L(ae)},[L,f,ae]),ue=ae===M,pe=Pne({onClick:ie,onFocus:de,onMouseEnter:Y,onMouseMove:Z,onMouseLeave:Q,ref:Fi(le,ne,e),isDisabled:_,isFocusable:E});return{...I,...pe,type:C??pe.type,id:oe,role:"menuitem",tabIndex:ue?0:-1}}function KLe(n){if(!qLe(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function qLe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[YLe,cR]=Ti({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),LN=n=>{const{children:e}=n,i=La("Menu",n),a=Bi(n),{direction:l}=B0(),{descendants:u,...f}=zLe({...a,direction:l}),_=N.useMemo(()=>f,[f]),{isOpen:E,onClose:b,forceUpdate:C}=_;return T.jsx(MLe,{value:u,children:T.jsx(jLe,{value:_,children:T.jsx(YLe,{value:i,children:Sl(e,{isOpen:E,onClose:b,forceUpdate:C})})})})};LN.displayName="Menu";const XLe=Bt((n,e)=>{const i=cR();return T.jsx(Ut.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),MN=Bt((n,e)=>{const{children:i,as:a,...l}=n,u=WLe(l,e),f=a||XLe;return T.jsx(f,{...u,className:_n("chakra-menu__menu-button",n.className),children:T.jsx(Ut.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});MN.displayName="MenuButton";const kne=Bt((n,e)=>{const i=cR();return T.jsx(Ut.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});kne.displayName="MenuCommand";const Nne=n=>{const{className:e,children:i,...a}=n,l=cR(),u=N.Children.only(i),f=N.isValidElement(u)?N.cloneElement(u,{focusable:"false","aria-hidden":!0,className:_n("chakra-menu__icon",u.props.className)}):null,_=_n("chakra-menu__icon-wrapper",e);return T.jsx(Ut.span,{className:_,...a,__css:l.icon,children:f})};Nne.displayName="MenuIcon";const JLe=Bt((n,e)=>{const{type:i,...a}=n,l=cR(),u=a.as||i?i??void 0:"button",f=N.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return T.jsx(Ut.button,{ref:e,type:u,...a,__css:f})}),UC=Bt((n,e)=>{const{icon:i,iconSpacing:a="0.75rem",command:l,commandSpacing:u="0.75rem",children:f,..._}=n,E=$Le(_,e),C=i||l?T.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return T.jsxs(JLe,{...E,className:_n("chakra-menu__menuitem",E.className),children:[i&&T.jsx(Nne,{fontSize:"0.8em",marginEnd:a,children:i}),C,l&&T.jsx(kne,{marginStart:u,children:l})]})});UC.displayName="MenuItem";const QLe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},ZLe=Ut(em.div),UN=Bt(function(e,i){var O;const{rootProps:a,motionProps:l,...u}=e,{isOpen:f,onTransitionEnd:_,unstable__animationState:E}=aR(),b=GLe(u,i),C=HLe(a),I=cR();return T.jsx(Ut.div,{...C,__css:{zIndex:e.zIndex??((O=I.list)==null?void 0:O.zIndex)},children:T.jsx(ZLe,{variants:QLe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:_n("chakra-menu__menu-list",b.className),onUpdate:_,onAnimationComplete:YQ(E.onComplete,b.onAnimationComplete)})})});UN.displayName="MenuList";var e2e=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},CS=new WeakMap,wO=new WeakMap,CO={},qM=0,Dne=function(n){return n&&(n.host||Dne(n.parentNode))},t2e=function(n,e){return e.map(function(i){if(n.contains(i))return i;var a=Dne(i);return a&&n.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},n2e=function(n,e,i,a){var l=t2e(e,Array.isArray(n)?n:[n]);CO[i]||(CO[i]=new WeakMap);var u=CO[i],f=[],_=new Set,E=new Set(l),b=function(I){!I||_.has(I)||(_.add(I),b(I.parentNode))};l.forEach(b);var C=function(I){!I||E.has(I)||Array.prototype.forEach.call(I.children,function(O){if(_.has(O))C(O);else try{var L=O.getAttribute(a),M=L!==null&&L!=="false",F=(CS.get(O)||0)+1,z=(u.get(O)||0)+1;CS.set(O,F),u.set(O,z),f.push(O),F===1&&M&&wO.set(O,!0),z===1&&O.setAttribute(i,"true"),M||O.setAttribute(a,"true")}catch(X){console.error("aria-hidden: cannot operate on ",O,X)}})};return C(e),_.clear(),qM++,function(){f.forEach(function(I){var O=CS.get(I)-1,L=u.get(I)-1;CS.set(I,O),u.set(I,L),O||(wO.has(I)||I.removeAttribute(a),wO.delete(I)),L||I.removeAttribute(i)}),qM--,qM||(CS=new WeakMap,CS=new WeakMap,wO=new WeakMap,CO={})}},r2e=function(n,e,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=e2e(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),n2e(a,l,i,"aria-hidden")):function(){return null}},i2e=Object.defineProperty,s2e=(n,e,i)=>e in n?i2e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,o2e=(n,e,i)=>(s2e(n,e+"",i),i);class a2e{constructor(){o2e(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const hV=new a2e;function xne(n,e){const[i,a]=N.useState(0);return N.useEffect(()=>{const l=n.current;if(l){if(e){const u=hV.add(l);a(u)}return()=>{hV.remove(l),a(0)}}},[e,n]),i}function c2e(n){const{isOpen:e,onClose:i,id:a,closeOnOverlayClick:l=!0,closeOnEsc:u=!0,useInert:f=!0,onOverlayClick:_,onEsc:E}=n,b=N.useRef(null),C=N.useRef(null),[I,O,L]=u2e(a,"chakra-modal","chakra-modal--header","chakra-modal--body");l2e(b,e&&f);const M=xne(b,e),F=N.useRef(null),z=N.useCallback(Q=>{F.current=Q.target},[]),X=N.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),u&&(i==null||i()),E==null||E())},[u,i,E]),[K,ne]=N.useState(!1),[oe,ae]=N.useState(!1),le=N.useCallback((Q={},ie=null)=>({role:"dialog",...Q,ref:Fi(ie,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?O:void 0,"aria-describedby":oe?L:void 0,onClick:Nn(Q.onClick,de=>de.stopPropagation())}),[L,oe,I,O,K]),Y=N.useCallback(Q=>{Q.stopPropagation(),F.current===Q.target&&hV.isTopModal(b.current)&&(l&&(i==null||i()),_==null||_())},[i,l,_]),Z=N.useCallback((Q={},ie=null)=>({...Q,ref:Fi(ie,C),onClick:Nn(Q.onClick,Y),onKeyDown:Nn(Q.onKeyDown,X),onMouseDown:Nn(Q.onMouseDown,z)}),[X,z,Y]);return{isOpen:e,onClose:i,headerId:O,bodyId:L,setBodyMounted:ae,setHeaderMounted:ne,dialogRef:b,overlayRef:C,getDialogProps:le,getDialogContainerProps:Z,index:M}}function l2e(n,e){const i=n.current;N.useEffect(()=>{if(!(!n.current||!e))return r2e(n.current)},[e,n,i])}function u2e(n,...e){const i=N.useId(),a=n||i;return N.useMemo(()=>e.map(l=>`${l}-${a}`),[a,e])}const[d2e,W0]=Ti({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[h2e,Hy]=Ti({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),vs=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:a,autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:L,animatePresenceProps:M,onCloseComplete:F}=e,z=La("Modal",e),K={...c2e(e),autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:L};return T.jsx(h2e,{value:K,children:T.jsx(d2e,{value:z,children:T.jsx(V0,{...M,onExitComplete:F,children:K.isOpen&&T.jsx(od,{...i,children:a})})})})};vs.displayName="Modal";var sk="right-scroll-bar-position",ok="width-before-scroll-bar",p2e="with-scroll-bars-hidden",f2e="--removed-body-scroll-bar-size",Lne=jte(),YM=function(){},VN=N.forwardRef(function(n,e){var i=N.useRef(null),a=N.useState({onScrollCapture:YM,onWheelCapture:YM,onTouchMoveCapture:YM}),l=a[0],u=a[1],f=n.forwardProps,_=n.children,E=n.className,b=n.removeScrollBar,C=n.enabled,I=n.shards,O=n.sideCar,L=n.noIsolation,M=n.inert,F=n.allowPinchZoom,z=n.as,X=z===void 0?"div":z,K=n.gapMode,ne=iR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),oe=O,ae=Ute([i,e]),le=ap(ap({},ne),l);return N.createElement(N.Fragment,null,C&&N.createElement(oe,{sideCar:Lne,removeScrollBar:b,shards:I,noIsolation:L,inert:M,setCallbacks:u,allowPinchZoom:!!F,lockRef:i,gapMode:K}),f?N.cloneElement(N.Children.only(_),ap(ap({},le),{ref:ae})):N.createElement(X,ap({},le,{className:E,ref:ae}),_))});VN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};VN.classNames={fullWidth:ok,zeroRight:sk};var m2e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function g2e(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=m2e();return e&&n.setAttribute("nonce",e),n}function _2e(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function y2e(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var E2e=function(){var n=0,e=null;return{add:function(i){n==0&&(e=g2e())&&(_2e(e,i),y2e(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},v2e=function(){var n=E2e();return function(e,i){N.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},Mne=function(){var n=v2e(),e=function(i){var a=i.styles,l=i.dynamic;return n(a,l),null};return e},S2e={left:0,top:0,right:0,gap:0},XM=function(n){return parseInt(n||"",10)||0},b2e=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],a=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[XM(i),XM(a),XM(l)]},T2e=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return S2e;var e=b2e(n),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,a-i+e[2]-e[0])}},w2e=Mne(),i0="data-scroll-locked",C2e=function(n,e,i,a){var l=n.left,u=n.top,f=n.right,_=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(p2e,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(_,"px ").concat(a,`;
  }
  body[`).concat(i0,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(_,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(_,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(sk,` {
    right: `).concat(_,"px ").concat(a,`;
  }
  
  .`).concat(ok,` {
    margin-right: `).concat(_,"px ").concat(a,`;
  }
  
  .`).concat(sk," .").concat(sk,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(ok," .").concat(ok,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(i0,`] {
    `).concat(f2e,": ").concat(_,`px;
  }
`)},QY=function(){var n=parseInt(document.body.getAttribute(i0)||"0",10);return isFinite(n)?n:0},R2e=function(){N.useEffect(function(){return document.body.setAttribute(i0,(QY()+1).toString()),function(){var n=QY()-1;n<=0?document.body.removeAttribute(i0):document.body.setAttribute(i0,n.toString())}},[])},I2e=function(n){var e=n.noRelative,i=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;R2e();var u=N.useMemo(function(){return T2e(l)},[l]);return N.createElement(w2e,{styles:C2e(u,!e,l,i?"":"!important")})},pV=!1;if(typeof window<"u")try{var RO=Object.defineProperty({},"passive",{get:function(){return pV=!0,!0}});window.addEventListener("test",RO,RO),window.removeEventListener("test",RO,RO)}catch{pV=!1}var RS=pV?{passive:!1}:!1,A2e=function(n){return n.tagName==="TEXTAREA"},Une=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!A2e(n)&&i[e]==="visible")},P2e=function(n){return Une(n,"overflowY")},O2e=function(n){return Une(n,"overflowX")},ZY=function(n,e){var i=e.ownerDocument,a=e;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Vne(n,a);if(l){var u=Fne(n,a),f=u[1],_=u[2];if(f>_)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},k2e=function(n){var e=n.scrollTop,i=n.scrollHeight,a=n.clientHeight;return[e,i,a]},N2e=function(n){var e=n.scrollLeft,i=n.scrollWidth,a=n.clientWidth;return[e,i,a]},Vne=function(n,e){return n==="v"?P2e(e):O2e(e)},Fne=function(n,e){return n==="v"?k2e(e):N2e(e)},D2e=function(n,e){return n==="h"&&e==="rtl"?-1:1},x2e=function(n,e,i,a,l){var u=D2e(n,window.getComputedStyle(e).direction),f=u*a,_=i.target,E=e.contains(_),b=!1,C=f>0,I=0,O=0;do{var L=Fne(n,_),M=L[0],F=L[1],z=L[2],X=F-z-u*M;(M||X)&&Vne(n,_)&&(I+=X,O+=M),_ instanceof ShadowRoot?_=_.host:_=_.parentNode}while(!E&&_!==document.body||E&&(e.contains(_)||e===_));return(C&&Math.abs(I)<1||!C&&Math.abs(O)<1)&&(b=!0),b},IO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},eX=function(n){return[n.deltaX,n.deltaY]},tX=function(n){return n&&"current"in n?n.current:n},L2e=function(n,e){return n[0]===e[0]&&n[1]===e[1]},M2e=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},U2e=0,IS=[];function V2e(n){var e=N.useRef([]),i=N.useRef([0,0]),a=N.useRef(),l=N.useState(U2e++)[0],u=N.useState(Mne)[0],f=N.useRef(n);N.useEffect(function(){f.current=n},[n]),N.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var F=j1e([n.lockRef.current],(n.shards||[]).map(tX),!0).filter(Boolean);return F.forEach(function(z){return z.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),F.forEach(function(z){return z.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var _=N.useCallback(function(F,z){if("touches"in F&&F.touches.length===2||F.type==="wheel"&&F.ctrlKey)return!f.current.allowPinchZoom;var X=IO(F),K=i.current,ne="deltaX"in F?F.deltaX:K[0]-X[0],oe="deltaY"in F?F.deltaY:K[1]-X[1],ae,le=F.target,Y=Math.abs(ne)>Math.abs(oe)?"h":"v";if("touches"in F&&Y==="h"&&le.type==="range")return!1;var Z=ZY(Y,le);if(!Z)return!0;if(Z?ae=Y:(ae=Y==="v"?"h":"v",Z=ZY(Y,le)),!Z)return!1;if(!a.current&&"changedTouches"in F&&(ne||oe)&&(a.current=ae),!ae)return!0;var Q=a.current||ae;return x2e(Q,z,F,Q==="h"?ne:oe)},[]),E=N.useCallback(function(F){var z=F;if(!(!IS.length||IS[IS.length-1]!==u)){var X="deltaY"in z?eX(z):IO(z),K=e.current.filter(function(ae){return ae.name===z.type&&(ae.target===z.target||z.target===ae.shadowParent)&&L2e(ae.delta,X)})[0];if(K&&K.should){z.cancelable&&z.preventDefault();return}if(!K){var ne=(f.current.shards||[]).map(tX).filter(Boolean).filter(function(ae){return ae.contains(z.target)}),oe=ne.length>0?_(z,ne[0]):!f.current.noIsolation;oe&&z.cancelable&&z.preventDefault()}}},[]),b=N.useCallback(function(F,z,X,K){var ne={name:F,delta:z,target:X,should:K,shadowParent:F2e(X)};e.current.push(ne),setTimeout(function(){e.current=e.current.filter(function(oe){return oe!==ne})},1)},[]),C=N.useCallback(function(F){i.current=IO(F),a.current=void 0},[]),I=N.useCallback(function(F){b(F.type,eX(F),F.target,_(F,n.lockRef.current))},[]),O=N.useCallback(function(F){b(F.type,IO(F),F.target,_(F,n.lockRef.current))},[]);N.useEffect(function(){return IS.push(u),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:O}),document.addEventListener("wheel",E,RS),document.addEventListener("touchmove",E,RS),document.addEventListener("touchstart",C,RS),function(){IS=IS.filter(function(F){return F!==u}),document.removeEventListener("wheel",E,RS),document.removeEventListener("touchmove",E,RS),document.removeEventListener("touchstart",C,RS)}},[]);var L=n.removeScrollBar,M=n.inert;return N.createElement(N.Fragment,null,M?N.createElement(u,{styles:M2e(l)}):null,L?N.createElement(I2e,{gapMode:n.gapMode}):null)}function F2e(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const j2e=B1e(Lne,V2e);var jne=N.forwardRef(function(n,e){return N.createElement(VN,ap({},n,{ref:e,sideCar:j2e}))});jne.classNames=VN.classNames;function B2e(n){const{autoFocus:e,trapFocus:i,dialogRef:a,initialFocusRef:l,blockScrollOnMount:u,allowPinchZoom:f,finalFocusRef:_,returnFocusOnClose:E,preserveScrollBarGap:b,lockFocusAcrossFrames:C,isOpen:I}=Hy(),[O,L]=kF();N.useEffect(()=>{!O&&L&&setTimeout(L)},[O,L]);const M=xne(a,I);return T.jsx(pne,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:_,restoreFocus:E,contentRef:a,lockFocusAcrossFrames:C,children:T.jsx(jne,{removeScrollBar:!b,allowPinchZoom:f,enabled:M===1&&u,forwardProps:!0,children:n.children})})}const z2e={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Dy.enter(Ny.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:a,reverse:l,delay:u})=>{const f={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,u),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},Bw={initial:"initial",animate:"enter",exit:"exit",variants:z2e},W2e=N.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:u=!0,className:f,offsetX:_=0,offsetY:E=8,transition:b,transitionEnd:C,delay:I,animatePresenceProps:O,...L}=e,M=a?l&&a:!0,F=l||a?"enter":"exit",z={offsetX:_,offsetY:E,reverse:u,transition:b,transitionEnd:C,delay:I};return T.jsx(V0,{...O,custom:z,children:M&&T.jsx(em.div,{ref:i,className:_n("chakra-offset-slide",f),custom:z,...Bw,animate:F,...L})})});W2e.displayName="SlideFade";const G2e={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:e,...a==null?void 0:a.exit}},transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Dy.enter(Ny.enter,i),transitionEnd:n==null?void 0:n.enter})},Bne={initial:"exit",animate:"enter",exit:"exit",variants:G2e},H2e=N.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:u=!0,initialScale:f=.95,className:_,transition:E,transitionEnd:b,delay:C,animatePresenceProps:I,...O}=e,L=a?l&&a:!0,M=l||a?"enter":"exit",F={initialScale:f,reverse:u,transition:E,transitionEnd:b,delay:C};return T.jsx(V0,{...I,custom:F,children:L&&T.jsx(em.div,{ref:i,className:_n("chakra-offset-slide",_),...Bne,animate:M,custom:F,...O})})});H2e.displayName="ScaleFade";const $2e={slideInBottom:{...Bw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Bw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Bw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Bw,custom:{offsetX:-16,reverse:!0}},scale:{...Bne,custom:{initialScale:.95,reverse:!0}},none:{}},K2e=Ut(em.section),q2e=n=>$2e[n||"none"],zne=N.forwardRef((n,e)=>{const{preset:i,motionProps:a=q2e(i),...l}=n;return T.jsx(K2e,{ref:e,...a,...l})});zne.displayName="ModalTransition";const Ss=Bt((n,e)=>{const{className:i,children:a,containerProps:l,motionProps:u,...f}=n,{getDialogProps:_,getDialogContainerProps:E}=Hy(),b=_(f,e),C=E(l),I=_n("chakra-modal__content",i),O=W0(),L={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...O.dialog},M={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...O.dialogContainer},{motionPreset:F}=Hy();return T.jsx(B2e,{children:T.jsx(Ut.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:M,children:T.jsx(zne,{preset:F,motionProps:u,className:I,...b,__css:L,children:a})})})});Ss.displayName="ModalContent";const bs=Bt((n,e)=>{const{className:i,...a}=n,{bodyId:l,setBodyMounted:u}=Hy();N.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=_n("chakra-modal__body",i),_=W0();return T.jsx(Ut.div,{ref:e,className:f,id:l,...a,__css:_.body})});bs.displayName="ModalBody";const zs=Bt((n,e)=>{const{onClick:i,className:a,...l}=n,{onClose:u}=Hy(),f=_n("chakra-modal__close-btn",a),_=W0();return T.jsx(dj,{ref:e,__css:_.closeButton,className:f,onClick:Nn(i,E=>{E.stopPropagation(),u()}),...l})});zs.displayName="ModalCloseButton";const nh=Bt((n,e)=>{const{className:i,...a}=n,l=_n("chakra-modal__footer",i),u=W0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...u.footer};return T.jsx(Ut.footer,{ref:e,...a,__css:f,className:l})});nh.displayName="ModalFooter";const fo=Bt((n,e)=>{const{className:i,...a}=n,{headerId:l,setHeaderMounted:u}=Hy();N.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=_n("chakra-modal__header",i),_=W0(),E={flex:0,..._.header};return T.jsx(Ut.header,{ref:e,className:f,id:l,...a,__css:E})});fo.displayName="ModalHeader";const Y2e={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Dy.enter(Ny.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Dy.exit(Ny.exit,i),transitionEnd:e==null?void 0:e.exit})},Wne={initial:"exit",animate:"enter",exit:"exit",variants:Y2e},X2e=N.forwardRef(function(e,i){const{unmountOnExit:a,in:l,className:u,transition:f,transitionEnd:_,delay:E,animatePresenceProps:b,...C}=e,I=l||a?"enter":"exit",O=a?l&&a:!0,L={transition:f,transitionEnd:_,delay:E};return T.jsx(V0,{...b,custom:L,children:O&&T.jsx(em.div,{ref:i,className:_n("chakra-fade",u),custom:L,...Wne,animate:I,...C})})});X2e.displayName="Fade";const J2e=Ut(em.div),Ts=Bt((n,e)=>{const{className:i,transition:a,motionProps:l,...u}=n,f=_n("chakra-modal__overlay",i),E={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...W0().overlay},{motionPreset:b}=Hy(),I=l||(b==="none"?{}:Wne);return T.jsx(J2e,{...I,__css:E,ref:e,className:f,...u})});Ts.displayName="ModalOverlay";function Q2e(n){const{leastDestructiveRef:e,...i}=n;return T.jsx(vs,{...i,initialFocusRef:e})}const Z2e=Bt((n,e)=>T.jsx(Ss,{ref:e,role:"alertdialog",...n})),eMe=n=>T.jsx(mn,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),tMe=n=>T.jsx(mn,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function nX(n,e,i,a){N.useEffect(()=>{if(!n.current||!a)return;const l=n.current.ownerDocument.defaultView??window,u=Array.isArray(e)?e:[e],f=new l.MutationObserver(_=>{for(const E of _)E.type==="attributes"&&E.attributeName&&u.includes(E.attributeName)&&i(E)});return f.observe(n.current,{attributes:!0,attributeFilter:u}),()=>f.disconnect()})}const nMe=50,rX=300;function rMe(n,e){const[i,a]=N.useState(!1),[l,u]=N.useState(null),[f,_]=N.useState(!0),E=N.useRef(null),b=()=>clearTimeout(E.current);GEe(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?nMe:null);const C=N.useCallback(()=>{f&&n(),E.current=setTimeout(()=>{_(!1),a(!0),u("increment")},rX)},[n,f]),I=N.useCallback(()=>{f&&e(),E.current=setTimeout(()=>{_(!1),a(!0),u("decrement")},rX)},[e,f]),O=N.useCallback(()=>{_(!0),a(!1),b()},[]);return N.useEffect(()=>()=>b(),[]),{up:C,down:I,stop:O,isSpinning:i}}const iMe=/^[Ee0-9+\-.]$/;function sMe(n){return iMe.test(n)}function oMe(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function aMe(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:a=!0,min:l=Number.MIN_SAFE_INTEGER,max:u=Number.MAX_SAFE_INTEGER,step:f=1,isReadOnly:_,isDisabled:E,isRequired:b,isInvalid:C,pattern:I="[0-9]*(.[0-9]+)?",inputMode:O="decimal",allowMouseWheel:L,id:M,onChange:F,precision:z,name:X,"aria-describedby":K,"aria-label":ne,"aria-labelledby":oe,onFocus:ae,onBlur:le,onInvalid:Y,getAriaValueText:Z,isValidCharacter:Q,format:ie,parse:de,...ue}=n,pe=eo(ae),ke=eo(le),xe=eo(Y),Fe=eo(Q??sMe),Oe=eo(Z),we=OEe(n),{update:Se,increment:Be,decrement:Ee}=we,[Ce,Pe]=N.useState(!1),Me=!(_||E),ze=N.useRef(null),He=N.useRef(null),qe=N.useRef(null),nt=N.useRef(null),Ze=N.useCallback(wt=>wt.split("").filter(Fe).join(""),[Fe]),gt=N.useCallback(wt=>(de==null?void 0:de(wt))??wt,[de]),sn=N.useCallback(wt=>((ie==null?void 0:ie(wt))??wt).toString(),[ie]);Gf(()=>{(we.valueAsNumber>u||we.valueAsNumber<l)&&(xe==null||xe("rangeOverflow",sn(we.value),we.valueAsNumber))},[we.valueAsNumber,we.value,sn,xe]),pp(()=>{if(!ze.current)return;if(ze.current.value!=we.value){const sr=gt(ze.current.value);we.setValue(Ze(sr))}},[gt,Ze]);const ut=N.useCallback((wt=f)=>{Me&&Be(wt)},[Be,Me,f]),kt=N.useCallback((wt=f)=>{Me&&Ee(wt)},[Ee,Me,f]),ct=rMe(ut,kt);nX(qe,"disabled",ct.stop,ct.isSpinning),nX(nt,"disabled",ct.stop,ct.isSpinning);const Mt=N.useCallback(wt=>{if(wt.nativeEvent.isComposing)return;const xt=gt(wt.currentTarget.value);Se(Ze(xt)),He.current={start:wt.currentTarget.selectionStart,end:wt.currentTarget.selectionEnd}},[Se,Ze,gt]),fn=N.useCallback(wt=>{var sr;pe==null||pe(wt),He.current&&(wt.currentTarget.selectionStart=He.current.start??((sr=wt.currentTarget.value)==null?void 0:sr.length),wt.currentTarget.selectionEnd=He.current.end??wt.currentTarget.selectionStart)},[pe]),zt=N.useCallback(wt=>{if(wt.nativeEvent.isComposing)return;oMe(wt,Fe)||wt.preventDefault();const sr=Te(wt)*f,xt=wt.key,br={ArrowUp:()=>ut(sr),ArrowDown:()=>kt(sr),Home:()=>Se(l),End:()=>Se(u)}[xt];br&&(wt.preventDefault(),br(wt))},[Fe,f,ut,kt,Se,l,u]),Te=wt=>{let sr=1;return(wt.metaKey||wt.ctrlKey)&&(sr=.1),wt.shiftKey&&(sr=10),sr},Ve=N.useMemo(()=>{const wt=Oe==null?void 0:Oe(we.value);if(wt!=null)return wt;const sr=we.value.toString();return sr||void 0},[we.value,Oe]),$e=N.useCallback(()=>{let wt=we.value;if(we.value==="")return;/^[eE]/.test(we.value.toString())?we.setValue(""):(we.valueAsNumber<l&&(wt=l),we.valueAsNumber>u&&(wt=u),we.cast(wt))},[we,u,l]),Et=N.useCallback(()=>{Pe(!1),i&&$e()},[i,Pe,$e]),vt=N.useCallback(()=>{e&&requestAnimationFrame(()=>{var wt;(wt=ze.current)==null||wt.focus()})},[e]),St=N.useCallback(wt=>{wt.preventDefault(),ct.up(),vt()},[vt,ct]),Wt=N.useCallback(wt=>{wt.preventDefault(),ct.down(),vt()},[vt,ct]);Iy(()=>ze.current,"wheel",wt=>{var wi;const xt=(((wi=ze.current)==null?void 0:wi.ownerDocument)??document).activeElement===ze.current;if(!L||!xt)return;wt.preventDefault();const qt=Te(wt)*f,br=Math.sign(wt.deltaY);br===-1?ut(qt):br===1&&kt(qt)},{passive:!1});const dn=N.useCallback((wt={},sr=null)=>{const xt=E||a&&we.isAtMax;return{...wt,ref:Fi(sr,qe),role:"button",tabIndex:-1,onPointerDown:Nn(wt.onPointerDown,qt=>{qt.button!==0||xt||St(qt)}),onPointerLeave:Nn(wt.onPointerLeave,ct.stop),onPointerUp:Nn(wt.onPointerUp,ct.stop),disabled:xt,"aria-disabled":xf(xt)}},[we.isAtMax,a,St,ct.stop,E]),En=N.useCallback((wt={},sr=null)=>{const xt=E||a&&we.isAtMin;return{...wt,ref:Fi(sr,nt),role:"button",tabIndex:-1,onPointerDown:Nn(wt.onPointerDown,qt=>{qt.button!==0||xt||Wt(qt)}),onPointerLeave:Nn(wt.onPointerLeave,ct.stop),onPointerUp:Nn(wt.onPointerUp,ct.stop),disabled:xt,"aria-disabled":xf(xt)}},[we.isAtMin,a,Wt,ct.stop,E]),tn=N.useCallback((wt={},sr=null)=>({name:X,inputMode:O,type:"text",pattern:I,"aria-labelledby":oe,"aria-label":ne,"aria-describedby":K,id:M,disabled:E,role:"spinbutton",...wt,readOnly:wt.readOnly??_,"aria-readonly":wt.readOnly??_,"aria-required":wt.required??b,required:wt.required??b,ref:Fi(ze,sr),value:sn(we.value),"aria-valuemin":l,"aria-valuemax":u,"aria-valuenow":Number.isNaN(we.valueAsNumber)?void 0:we.valueAsNumber,"aria-invalid":xf(C??we.isOutOfRange),"aria-valuetext":Ve,autoComplete:"off",autoCorrect:"off",onChange:Nn(wt.onChange,Mt),onKeyDown:Nn(wt.onKeyDown,zt),onFocus:Nn(wt.onFocus,fn,()=>Pe(!0)),onBlur:Nn(wt.onBlur,ke,Et)}),[X,O,I,oe,ne,sn,K,M,E,b,_,C,we.value,we.valueAsNumber,we.isOutOfRange,l,u,Ve,Mt,zt,fn,ke,Et]);return{value:sn(we.value),valueAsNumber:we.valueAsNumber,isFocused:Ce,isDisabled:E,isReadOnly:_,getIncrementButtonProps:dn,getDecrementButtonProps:En,getInputProps:tn,htmlProps:ue}}const[cMe,FN]=Ti({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[lMe,jj]=Ti({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),Io=Bt(function(e,i){const a=La("NumberInput",e),l=Bi(e),u=mj(l),{htmlProps:f,..._}=aMe(u),E=N.useMemo(()=>_,[_]);return T.jsx(lMe,{value:E,children:T.jsx(cMe,{value:a,children:T.jsx(Ut.div,{...f,ref:i,className:_n("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...a.root}})})})});Io.displayName="NumberInput";const Ao=Bt(function(e,i){const a=FN();return T.jsx(Ut.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...a.stepperGroup}})});Ao.displayName="NumberInputStepper";const Po=Bt(function(e,i){const{getInputProps:a}=jj(),l=a(e,i),u=FN();return T.jsx(Ut.input,{...l,className:_n("chakra-numberinput__field",e.className),__css:{width:"100%",...u.field}})});Po.displayName="NumberInputField";const Gne=Ut("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),Oo=Bt(function(e,i){const a=FN(),{getDecrementButtonProps:l}=jj(),u=l(e,i);return T.jsx(Gne,{...u,__css:a.stepper,children:e.children??T.jsx(eMe,{})})});Oo.displayName="NumberDecrementStepper";const ko=Bt(function(e,i){const{getIncrementButtonProps:a}=jj(),l=a(e,i),u=FN();return T.jsx(Gne,{...l,__css:u.stepper,children:e.children??T.jsx(tMe,{})})});ko.displayName="NumberIncrementStepper";const[uMe,jN]=Ti({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[dMe,Hne]=Ti({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),AS={click:"click",hover:"hover"};function hMe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:a,id:l,returnFocusOnClose:u=!0,autoFocus:f=!0,arrowSize:_,arrowShadowColor:E,trigger:b=AS.click,openDelay:C=200,closeDelay:I=200,isLazy:O,lazyBehavior:L="unmount",computePositionOnMount:M,...F}=n,{isOpen:z,onClose:X,onOpen:K,onToggle:ne}=th(n),[oe,ae]=N.useState(u);N.useEffect(()=>ae(u),[u]);const le=N.useRef(null),Y=N.useRef(null),Z=N.useRef(null),Q=N.useRef(!1),ie=N.useRef(!1);z&&(ie.current=!0);const[de,ue]=N.useState(!1),[pe,ke]=N.useState(!1),xe=N.useId(),Fe=l??xe,[Oe,we,Se,Be]=["popover-trigger","popover-content","popover-header","popover-body"].map(zt=>`${zt}-${Fe}`),{referenceRef:Ee,getArrowProps:Ce,getPopperProps:Pe,getArrowInnerProps:Me,forceUpdate:ze}=Fj({...F,enabled:z||!!M}),He=tZ({isOpen:z,ref:Z});BEe({enabled:z,ref:Y}),iZ(Z,{focusRef:Y,visible:z,shouldFocus:oe&&b===AS.click}),DEe(Z,{focusRef:a,visible:z,shouldFocus:f&&b===AS.click}),aZ({enabled:z&&e,ref:Z,handler(zt){var Ve;const Te=((Ve=zt.composedPath)==null?void 0:Ve.call(zt)[0])??[zt.target];AO(Y.current,Te)||(Te&&ae(!Ck(Te)),X())}});const qe=aF({wasSelected:ie.current,enabled:O,mode:L,isSelected:He.present}),nt=N.useCallback((zt={},Te=null)=>{const Ve={...zt,style:{...zt.style,transformOrigin:ho.transformOrigin.varRef,[ho.arrowSize.var]:_?`${_}px`:void 0,[ho.arrowShadowColor.var]:E},ref:Fi(Z,Te),children:qe?zt.children:null,id:we,tabIndex:-1,role:"dialog",onKeyDown:Nn(zt.onKeyDown,$e=>{$e.nativeEvent.isComposing||i&&$e.key==="Escape"&&($e.preventDefault(),$e.stopPropagation(),X())}),onBlur:Nn(zt.onBlur,$e=>{const Et=iX($e),vt=AO(Z.current,Et),St=AO(Y.current,Et),Wt=!vt&&!St;Et&&ae(!Ck(Et)),z&&e&&Wt&&X()}),"aria-labelledby":de?Se:void 0,"aria-describedby":pe?Be:void 0};return b===AS.hover&&(Ve.role="tooltip",Ve.onMouseEnter=Nn(zt.onMouseEnter,()=>{Q.current=!0}),Ve.onMouseLeave=Nn(zt.onMouseLeave,$e=>{$e.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>X(),I))})),Ve},[qe,we,de,Se,pe,Be,b,i,X,z,e,I,E,_]),Ze=N.useCallback((zt={},Te=null)=>Pe({...zt,style:{visibility:z?"visible":"hidden",...zt.style}},Te),[z,Pe]),gt=N.useCallback((zt,Te=null)=>({...zt,ref:Fi(Te,le,Ee)}),[le,Ee]),sn=N.useRef(void 0),ut=N.useRef(void 0),kt=N.useCallback(zt=>{le.current==null&&Ee(zt)},[Ee]),ct=N.useCallback((zt={},Te=null)=>{const Ve={...zt,ref:Fi(Y,Te,kt),id:Oe,"aria-haspopup":"dialog","aria-expanded":z,"aria-controls":we};return b===AS.click&&(Ve.onClick=Nn(zt.onClick,ne)),b===AS.hover&&(Ve.onFocus=Nn(zt.onFocus,()=>{sn.current===void 0&&K()}),Ve.onBlur=Nn(zt.onBlur,$e=>{const Et=iX($e),vt=!AO(Z.current,Et);z&&e&&vt&&X()}),Ve.onKeyDown=Nn(zt.onKeyDown,$e=>{$e.key==="Escape"&&X()}),Ve.onMouseEnter=Nn(zt.onMouseEnter,()=>{Q.current=!0,sn.current=window.setTimeout(()=>K(),C)}),Ve.onMouseLeave=Nn(zt.onMouseLeave,()=>{Q.current=!1,sn.current&&(clearTimeout(sn.current),sn.current=void 0),ut.current=window.setTimeout(()=>{Q.current===!1&&X()},I)})),Ve},[Oe,z,we,b,kt,ne,K,e,X,C,I]);N.useEffect(()=>()=>{sn.current&&clearTimeout(sn.current),ut.current&&clearTimeout(ut.current)},[]);const Mt=N.useCallback((zt={},Te=null)=>({...zt,id:Se,ref:Fi(Te,Ve=>{ue(!!Ve)})}),[Se]),fn=N.useCallback((zt={},Te=null)=>({...zt,id:Be,ref:Fi(Te,Ve=>{ke(!!Ve)})}),[Be]);return{forceUpdate:ze,isOpen:z,onAnimationComplete:He.onComplete,onClose:X,getAnchorProps:gt,getArrowProps:Ce,getArrowInnerProps:Me,getPopoverPositionerProps:Ze,getPopoverProps:nt,getTriggerProps:ct,getHeaderProps:Mt,getBodyProps:fn}}function AO(n,e){return n===e||(n==null?void 0:n.contains(e))}function iX(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function $ne(n){const e=La("Popover",n),{children:i,...a}=Bi(n),l=B0(),u=hMe({...a,direction:l.direction});return T.jsx(uMe,{value:u,children:T.jsx(dMe,{value:e,children:Sl(i,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}$ne.displayName="Popover";function Kne(n){var i;const e=N.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const qne=Bt(function(e,i){const{getBodyProps:a}=jN(),l=Hne();return T.jsx(Ut.div,{...a(e,i),className:_n("chakra-popover__body",e.className),__css:l.body})});qne.displayName="PopoverBody";function pMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const fMe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},mMe=Ut(em.section),Yne=Bt(function(e,i){const{variants:a=fMe,...l}=e,{isOpen:u}=jN();return T.jsx(mMe,{ref:i,variants:pMe(a),initial:!1,animate:u?"enter":"exit",...l})});Yne.displayName="PopoverTransition";const Xne=Bt(function(e,i){const{rootProps:a,motionProps:l,...u}=e,{getPopoverProps:f,getPopoverPositionerProps:_,onAnimationComplete:E}=jN(),b=Hne(),C={position:"relative",display:"flex",flexDirection:"column",...b.content};return T.jsx(Ut.div,{..._(a),__css:b.popper,className:"chakra-popover__popper",children:T.jsx(Yne,{...l,...f(u,i),onAnimationComplete:YQ(E,u.onAnimationComplete),className:_n("chakra-popover__content",e.className),__css:C})})});Xne.displayName="PopoverContent";function Jne(n){const e=N.Children.only(n.children),{getTriggerProps:i}=jN();return T.jsx(T.Fragment,{children:N.cloneElement(e,i(e.props,Kne(e)))})}Jne.displayName="PopoverTrigger";function gMe(n,e,i){return(n-e)*100/(i-e)}JC({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});JC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const _Me=JC({"0%":{left:"-40%"},"100%":{left:"100%"}}),yMe=JC({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function EMe(n){const{value:e=0,min:i,max:a,valueText:l,getValueText:u,isIndeterminate:f,role:_="progressbar"}=n,E=gMe(e,i,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":i,"aria-valuenow":f?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,E):l})(),role:_},percent:E,value:e}}const[vMe,SMe]=Ti({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),bMe=Bt((n,e)=>{const{min:i,max:a,value:l,isIndeterminate:u,role:f,..._}=n,E=EMe({value:l,min:i,max:a,isIndeterminate:u,role:f}),C={height:"100%",...SMe().filledTrack};return T.jsx(Ut.div,{ref:e,style:{width:`${E.percent}%`,..._.style},...E.bind,..._,__css:C})}),Vy=Bt((n,e)=>{var Y;const{value:i,min:a=0,max:l=100,hasStripe:u,isAnimated:f,children:_,borderRadius:E,isIndeterminate:b,"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,title:L,role:M,...F}=Bi(n),z=La("Progress",n),X=E??((Y=z.track)==null?void 0:Y.borderRadius),K={animation:`${yMe} 1s linear infinite`},ae={...!b&&u&&f&&K,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${_Me} 1s ease infinite normal none running`}},le={overflow:"hidden",position:"relative",...z.track};return T.jsx(Ut.div,{ref:e,borderRadius:X,__css:le,...F,children:T.jsxs(vMe,{value:z,children:[T.jsx(bMe,{"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,min:a,max:l,value:i,isIndeterminate:b,css:ae,borderRadius:X,title:L,role:M}),_]})})});Vy.displayName="Progress";const Qne=Bt(function(e,i){const{children:a,placeholder:l,className:u,...f}=e;return T.jsxs(Ut.select,{...f,ref:i,className:_n("chakra-select",u),children:[l&&T.jsx("option",{value:"",children:l}),a]})});Qne.displayName="SelectField";const Zne=Bt((n,e)=>{var ne;const i=La("Select",n),{rootProps:a,placeholder:l,icon:u,color:f,height:_,h:E,minH:b,minHeight:C,iconColor:I,iconSize:O,...L}=Bi(n),[M,F]=TEe(L,zve),z=fj(F),X={width:"100%",height:"fit-content",position:"relative",color:f},K={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(ne=i.field)==null?void 0:ne._focus}};return T.jsxs(Ut.div,{className:"chakra-select__wrapper",__css:X,...M,...a,children:[T.jsx(Qne,{ref:e,height:E??_,minH:b??C,placeholder:l,...z,__css:K,children:n.children}),T.jsx(ere,{"data-disabled":rr(z.disabled),...(I||f)&&{color:I||f},__css:i.icon,...O&&{fontSize:O},children:u})]})});Zne.displayName="Select";const TMe=n=>T.jsx("svg",{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),wMe=Ut("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),ere=n=>{const{children:e=T.jsx(TMe,{}),...i}=n,a=N.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return T.jsx(wMe,{...i,className:"chakra-select__icon-wrapper",children:N.isValidElement(e)?a:null})};ere.displayName="SelectIcon";function JM(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function CMe(n){const{orientation:e,thumbPercents:i,isReversed:a}=n,l=L=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...JM({orientation:e,vertical:{bottom:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`}})}),u={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...JM({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},_=i.length===1,E=[0,a?100-i[0]:i[0]],b=_?E:i;let C=b[0];!_&&a&&(C=100-C);const I=Math.abs(b[b.length-1]-b[0]),O={...f,...JM({orientation:e,vertical:a?{height:`${I}%`,top:`${C}%`}:{height:`${I}%`,bottom:`${C}%`},horizontal:a?{width:`${I}%`,right:`${C}%`}:{width:`${I}%`,left:`${C}%`}})};return{trackStyle:f,innerTrackStyle:O,rootStyle:u,getThumbStyle:l}}function RMe(n){const{isReversed:e,direction:i,orientation:a}=n;return i==="ltr"||a==="vertical"?e:!e}function IMe(n){const{min:e=0,max:i=100,onChange:a,value:l,defaultValue:u,isReversed:f,direction:_="ltr",orientation:E="horizontal",id:b,isDisabled:C,isReadOnly:I,onChangeStart:O,onChangeEnd:L,step:M=1,getAriaValueText:F,"aria-valuetext":z,"aria-label":X,"aria-labelledby":K,name:ne,focusThumbOnChange:oe=!0,...ae}=n,le=eo(O),Y=eo(L),Z=eo(F),Q=RMe({isReversed:f,direction:_,orientation:E}),[ie,de]=nZ({value:l,defaultValue:u??PMe(e,i),onChange:a}),[ue,pe]=N.useState(!1),[ke,xe]=N.useState(!1),Fe=!(C||I),Oe=(i-e)/10,we=M||(i-e)/100,Se=zO(ie,e,i),Be=i-Se+e,Ce=uK(Q?Be:Se,e,i),Pe=E==="vertical",Me=oZ({min:e,max:i,step:M,isDisabled:C,value:Se,isInteractive:Fe,isReversed:Q,isVertical:Pe,eventSource:null,focusThumbOnChange:oe,orientation:E}),ze=N.useRef(null),He=N.useRef(null),qe=N.useRef(null),nt=N.useId(),Ze=b??nt,[gt,sn]=[`slider-thumb-${Ze}`,`slider-track-${Ze}`],ut=N.useCallback(xt=>{var io;if(!ze.current)return;const qt=Me.current;qt.eventSource="pointer";const br=ze.current.getBoundingClientRect(),{clientX:wi,clientY:Cs}=((io=xt.touches)==null?void 0:io[0])??xt,cr=Pe?br.bottom-Cs:wi-br.left,zn=Pe?br.height:br.width;let ra=cr/zn;Q&&(ra=1-ra);let Hs=EEe(ra,qt.min,qt.max);return qt.step&&(Hs=parseFloat(dK(Hs,qt.min,qt.step))),Hs=zO(Hs,qt.min,qt.max),Hs},[Pe,Q,Me]),kt=N.useCallback(xt=>{const qt=Me.current;qt.isInteractive&&(xt=parseFloat(dK(xt,qt.min,we)),xt=zO(xt,qt.min,qt.max),de(xt))},[we,de,Me]),ct=N.useMemo(()=>({stepUp(xt=we){const qt=Q?Se-xt:Se+xt;kt(qt)},stepDown(xt=we){const qt=Q?Se+xt:Se-xt;kt(qt)},reset(){kt(u||0)},stepTo(xt){kt(xt)}}),[kt,Q,Se,we,u]),Mt=N.useCallback(xt=>{const qt=Me.current,wi={ArrowRight:()=>ct.stepUp(),ArrowUp:()=>ct.stepUp(),ArrowLeft:()=>ct.stepDown(),ArrowDown:()=>ct.stepDown(),PageUp:()=>ct.stepUp(Oe),PageDown:()=>ct.stepDown(Oe),Home:()=>kt(qt.min),End:()=>kt(qt.max)}[xt.key];wi&&(xt.preventDefault(),xt.stopPropagation(),wi(xt),qt.eventSource="keyboard")},[ct,kt,Oe,Me]),fn=(Z==null?void 0:Z(Se))??z,{getThumbStyle:zt,rootStyle:Te,trackStyle:Ve,innerTrackStyle:$e}=N.useMemo(()=>{const xt=Me.current;return CMe({isReversed:Q,orientation:xt.orientation,thumbPercents:[Ce]})},[Q,Ce,Me]),Et=N.useCallback(()=>{Me.current.focusThumbOnChange&&setTimeout(()=>{var qt;return(qt=He.current)==null?void 0:qt.focus()})},[Me]);Gf(()=>{const xt=Me.current;Et(),xt.eventSource==="keyboard"&&(Y==null||Y(xt.value))},[Se,Y]);function vt(xt){const qt=ut(xt);qt!=null&&qt!==Me.current.value&&de(qt)}cve(qe,{onPanSessionStart(xt){const qt=Me.current;qt.isInteractive&&(pe(!0),Et(),vt(xt),le==null||le(qt.value))},onPanSessionEnd(){const xt=Me.current;xt.isInteractive&&(pe(!1),Y==null||Y(xt.value))},onPan(xt){Me.current.isInteractive&&vt(xt)}});const St=N.useCallback((xt={},qt=null)=>({...xt,...ae,ref:Fi(qt,qe),tabIndex:-1,"aria-disabled":xf(C),"data-focused":rr(ke),style:{...xt.style,...Te}}),[ae,C,ke,Te]),Wt=N.useCallback((xt={},qt=null)=>({...xt,ref:Fi(qt,ze),id:sn,"data-disabled":rr(C),style:{...xt.style,...Ve}}),[C,sn,Ve]),dn=N.useCallback((xt={},qt=null)=>({...xt,ref:qt,style:{...xt.style,...$e}}),[$e]),En=N.useCallback((xt={},qt=null)=>({...xt,ref:Fi(qt,He),role:"slider",tabIndex:Fe?0:void 0,id:gt,"data-active":rr(ue),"aria-valuetext":fn,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":Se,"aria-orientation":E,"aria-disabled":xf(C),"aria-readonly":xf(I),"aria-label":X,"aria-labelledby":X?void 0:K,style:{...xt.style,...zt(0)},onKeyDown:Nn(xt.onKeyDown,Mt),onFocus:Nn(xt.onFocus,()=>xe(!0)),onBlur:Nn(xt.onBlur,()=>xe(!1))}),[Fe,gt,ue,fn,e,i,Se,E,C,I,X,K,zt,Mt]),tn=N.useCallback((xt,qt=null)=>{const br=!(xt.value<e||xt.value>i),wi=Se>=xt.value,Cs=uK(xt.value,e,i),cr={position:"absolute",pointerEvents:"none",...AMe({orientation:E,vertical:{bottom:Q?`${100-Cs}%`:`${Cs}%`},horizontal:{left:Q?`${100-Cs}%`:`${Cs}%`}})};return{...xt,ref:qt,role:"presentation","aria-hidden":!0,"data-disabled":rr(C),"data-invalid":rr(!br),"data-highlighted":rr(wi),style:{...xt.style,...cr}}},[C,Q,i,e,E,Se]),wt=N.useCallback((xt={},qt=null)=>({...xt,ref:qt,type:"hidden",value:Se,name:ne}),[ne,Se]);return{state:{value:Se,isFocused:ke,isDragging:ue},actions:ct,getRootProps:St,getTrackProps:Wt,getInnerTrackProps:dn,getThumbProps:En,getMarkerProps:tn,getInputProps:wt}}function AMe(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function PMe(n,e){return e<n?n:n+(e-n)/2}const[OMe,BN]=Ti({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[kMe,zN]=Ti({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),fV=Bt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=La("Slider",i),l=Bi(i),{direction:u}=B0();l.direction=u;const{getInputProps:f,getRootProps:_,...E}=IMe(l),b=_(),C=f({},e);return T.jsx(OMe,{value:E,children:T.jsx(kMe,{value:a,children:T.jsxs(Ut.div,{...b,className:_n("chakra-slider",i.className),__css:a.container,children:[i.children,T.jsx("input",{...C})]})})})});fV.displayName="Slider";const mV=Bt((n,e)=>{const{getThumbProps:i}=BN(),a=zN(),l=i(n,e);return T.jsx(Ut.div,{...l,className:_n("chakra-slider__thumb",n.className),__css:a.thumb})});mV.displayName="SliderThumb";const gV=Bt((n,e)=>{const{getTrackProps:i}=BN(),a=zN(),l=i(n,e);return T.jsx(Ut.div,{...l,className:_n("chakra-slider__track",n.className),__css:a.track})});gV.displayName="SliderTrack";const _V=Bt((n,e)=>{const{getInnerTrackProps:i}=BN(),a=zN(),l=i(n,e);return T.jsx(Ut.div,{...l,className:_n("chakra-slider__filled-track",n.className),__css:a.filledTrack})});_V.displayName="SliderFilledTrack";const NMe=Bt((n,e)=>{const{getMarkerProps:i}=BN(),a=zN(),l=i(n,e);return T.jsx(Ut.div,{...l,className:_n("chakra-slider__marker",n.className),__css:a.mark})});NMe.displayName="SliderMark";const s0=Ut("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});s0.displayName="Spacer";const tre=n=>T.jsx(Ut.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});tre.displayName="StackItem";function DMe(n){const{spacing:e,direction:i}=n,a={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":lF(i,l=>a[l])}}const Bj=Bt((n,e)=>{const{isInline:i,direction:a,align:l,justify:u,spacing:f="0.5rem",wrap:_,children:E,divider:b,className:C,shouldWrapChildren:I,...O}=n,L=i?"row":a??"column",M=N.useMemo(()=>DMe({spacing:f,direction:L}),[f,L]),F=!!b,z=!I&&!F,X=N.useMemo(()=>{const ne=mN(E);return z?ne:ne.map((oe,ae)=>{const le=typeof oe.key<"u"?oe.key:ae,Y=ae+1===ne.length,Q=I?T.jsx(tre,{children:oe},le):oe;if(!F)return Q;const ie=N.cloneElement(b,{__css:M}),de=Y?null:ie;return T.jsxs(N.Fragment,{children:[Q,de]},le)})},[b,M,F,z,I,E]),K=_n("chakra-stack",C);return T.jsx(Ut.div,{ref:e,display:"flex",alignItems:l,justifyContent:u,flexDirection:L,flexWrap:_,gap:F?void 0:f,className:K,...O,children:X})});Bj.displayName="Stack";const hr=Bt((n,e)=>T.jsx(Bj,{align:"center",...n,direction:"row",ref:e}));hr.displayName="HStack";const ai=Bt((n,e)=>T.jsx(Bj,{align:"center",...n,direction:"column",ref:e}));ai.displayName="VStack";const jf=Bt(function(e,i){const a=La("Switch",e),{spacing:l="0.5rem",children:u,...f}=Bi(e),{getIndicatorProps:_,getInputProps:E,getCheckboxProps:b,getRootProps:C,getLabelProps:I}=A1e(f),O=N.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),L=N.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),M=N.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return T.jsxs(Ut.label,{...C(),className:_n("chakra-switch",e.className),__css:O,children:[T.jsx("input",{className:"chakra-switch__input",...E({},i)}),T.jsx(Ut.span,{...b(),className:"chakra-switch__track",__css:L,children:T.jsx(Ut.span,{__css:a.thumb,className:"chakra-switch__thumb",..._()})}),u&&T.jsx(Ut.span,{className:"chakra-switch__label",...I(),__css:M,children:u})]})});jf.displayName="Switch";const[xMe,LMe,MMe,UMe]=Pte();function VMe(n){const{defaultIndex:e,onChange:i,index:a,isManual:l,isLazy:u,lazyBehavior:f="unmount",orientation:_="horizontal",direction:E="ltr",...b}=n,[C,I]=N.useState(e??0),[O,L]=nZ({defaultValue:e??0,value:a,onChange:i});N.useEffect(()=>{a!=null&&I(a)},[a]);const M=MMe(),F=N.useId();return{id:`tabs-${n.id??F}`,selectedIndex:O,focusedIndex:C,setSelectedIndex:L,setFocusedIndex:I,isManual:l,isLazy:u,lazyBehavior:f,orientation:_,descendants:M,direction:E,htmlProps:b}}const[FMe,WN]=Ti({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function jMe(n){const{focusedIndex:e,orientation:i,direction:a}=WN(),l=LMe(),u=N.useCallback(f=>{const _=()=>{var ne;const K=l.nextEnabled(e);K&&((ne=K.node)==null||ne.focus())},E=()=>{var ne;const K=l.prevEnabled(e);K&&((ne=K.node)==null||ne.focus())},b=()=>{var ne;const K=l.firstEnabled();K&&((ne=K.node)==null||ne.focus())},C=()=>{var ne;const K=l.lastEnabled();K&&((ne=K.node)==null||ne.focus())},I=i==="horizontal",O=i==="vertical",L=f.key,M=a==="ltr"?"ArrowLeft":"ArrowRight",F=a==="ltr"?"ArrowRight":"ArrowLeft",X={[M]:()=>I&&E(),[F]:()=>I&&_(),ArrowDown:()=>O&&_(),ArrowUp:()=>O&&E(),Home:b,End:C}[L];X&&(f.preventDefault(),X(f))},[l,e,i,a]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Nn(n.onKeyDown,u)}}function BMe(n){const{isDisabled:e=!1,isFocusable:i=!1,...a}=n,{setSelectedIndex:l,isManual:u,id:f,setFocusedIndex:_,selectedIndex:E}=WN(),{index:b,register:C}=UMe({disabled:e&&!i}),I=b===E,O=()=>{l(b)},L=()=>{_(b),!u&&!(e&&i)&&l(b)};return{...Pne({...a,ref:Fi(C,n.ref),isDisabled:e,isFocusable:i,onClick:Nn(n.onClick,O)}),id:nre(f,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":rre(f,b),onFocus:e?void 0:Nn(n.onFocus,L)}}const[zMe,WMe]=Ti({});function GMe(n){const e=WN(),{id:i,selectedIndex:a}=e,u=mN(n.children).map((f,_)=>N.createElement(zMe,{key:f.key??_,value:{isSelected:_===a,id:rre(i,_),tabId:nre(i,_),selectedIndex:a}},f));return{...n,children:u}}function HMe(n){const{children:e,...i}=n,{isLazy:a,lazyBehavior:l}=WN(),{isSelected:u,id:f,tabId:_}=WMe(),E=N.useRef(!1);u&&(E.current=!0);const b=aF({wasSelected:E.current,isSelected:u,enabled:a,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":_,hidden:!u,id:f}}function nre(n,e){return`${n}--tab-${e}`}function rre(n,e){return`${n}--tabpanel-${e}`}const[$Me,GN]=Ti({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),T0=Bt(function(e,i){const a=La("Tabs",e),{children:l,className:u,...f}=Bi(e),{htmlProps:_,descendants:E,...b}=VMe(f),C=N.useMemo(()=>b,[b]),{isFitted:I,...O}=_,L={position:"relative",...a.root};return T.jsx(xMe,{value:E,children:T.jsx(FMe,{value:C,children:T.jsx($Me,{value:a,children:T.jsx(Ut.div,{className:_n("chakra-tabs",u),ref:i,...O,__css:L,children:l})})})})});T0.displayName="Tabs";const Oa=Bt(function(e,i){const a=GN(),l=BMe({...e,ref:i}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return T.jsx(Ut.button,{...l,className:_n("chakra-tabs__tab",e.className),__css:u})});Oa.displayName="Tab";const w0=Bt(function(e,i){const a=jMe({...e,ref:i}),l=GN(),u={display:"flex",...l.tablist};return T.jsx(Ut.div,{...a,className:_n("chakra-tabs__tablist",e.className),__css:u})});w0.displayName="TabList";const Oc=Bt(function(e,i){const a=HMe({...e,ref:i}),l=GN();return T.jsx(Ut.div,{outline:"0",...a,className:_n("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});Oc.displayName="TabPanel";const VC=Bt(function(e,i){const a=GMe(e),l=GN();return T.jsx(Ut.div,{...a,width:"100%",ref:i,className:_n("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});VC.displayName="TabPanels";const[KMe,ire]=Ti({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),sre=Bt((n,e)=>{const i=La("Tag",n),a=Bi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return T.jsx(KMe,{value:i,children:T.jsx(Ut.span,{ref:e,...a,__css:l})})});sre.displayName="Tag";const ore=Bt((n,e)=>{const i=ire();return T.jsx(Ut.span,{ref:e,noOfLines:1,...n,__css:i.label})});ore.displayName="TagLabel";const qMe=Bt((n,e)=>T.jsx(mn,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));qMe.displayName="TagLeftIcon";const YMe=Bt((n,e)=>T.jsx(mn,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));YMe.displayName="TagRightIcon";const are=n=>T.jsx(mn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:T.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});are.displayName="TagCloseIcon";const cre=Bt((n,e)=>{const{isDisabled:i,children:a,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...ire().closeButton};return T.jsx(Ut.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:f,children:a||T.jsx(are,{})})});cre.displayName="TagCloseButton";const XMe=["h","minH","height","minHeight"],lre=Bt((n,e)=>{const i=sd("Textarea",n),{className:a,rows:l,...u}=Bi(n),f=fj(u),_=l?M0(i,XMe):i;return T.jsx(Ut.textarea,{ref:e,rows:l,...f,className:_n("chakra-textarea",a),__css:_})});lre.displayName="Textarea";function JMe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function QMe(n,e){const i=l=>({...e,...l,position:JMe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),a=l=>{const u=i(l),f=Rte(u);return op.notify(f,u)};return a.update=(l,u)=>{op.update(l,i(u))},a.promise=(l,u)=>{const f=a({...u.loading,status:"loading",duration:null});l.then(_=>a.update(f,{status:"success",duration:5e3,...Sl(u.success,_)})).catch(_=>a.update(f,{status:"error",duration:5e3,...Sl(u.error,_)}))},a.closeAll=op.closeAll,a.close=op.close,a.isActive=op.isActive,a}function dc(n){const{theme:e}=Tte(),i=ZNe();return N.useMemo(()=>QMe(e.direction,{...i,...n}),[n,e.direction,i])}const ZMe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},yV=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},ak=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function eUe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:u,closeOnPointerDown:f=l,closeOnEsc:_=!0,onOpen:E,onClose:b,placement:C,id:I,isOpen:O,defaultIsOpen:L,arrowSize:M=10,arrowShadowColor:F,arrowPadding:z,modifiers:X,isDisabled:K,gutter:ne,offset:oe,direction:ae,...le}=n,{isOpen:Y,onOpen:Z,onClose:Q}=th({isOpen:O,defaultIsOpen:L,onOpen:E,onClose:b}),{referenceRef:ie,getPopperProps:de,getArrowInnerProps:ue,getArrowProps:pe}=Fj({enabled:Y,placement:C,arrowPadding:z,modifiers:X,gutter:ne,offset:oe,direction:ae}),ke=N.useId(),Fe=`tooltip-${I??ke}`,Oe=N.useRef(null),we=N.useRef(void 0),Se=N.useCallback(()=>{we.current&&(clearTimeout(we.current),we.current=void 0)},[]),Be=N.useRef(void 0),Ee=N.useCallback(()=>{Be.current&&(clearTimeout(Be.current),Be.current=void 0)},[]),Ce=N.useCallback(()=>{Ee(),Q()},[Q,Ee]),Pe=tUe(Oe,Ce),Me=N.useCallback(()=>{if(!K&&!we.current){Y&&Pe();const ut=ak(Oe);we.current=ut.setTimeout(Z,e)}},[Pe,K,Y,Z,e]),ze=N.useCallback(()=>{Se();const ut=ak(Oe);Be.current=ut.setTimeout(Ce,i)},[i,Ce,Se]),He=N.useCallback(()=>{Y&&a&&ze()},[a,ze,Y]),qe=N.useCallback(()=>{Y&&f&&ze()},[f,ze,Y]),nt=N.useCallback(ut=>{Y&&ut.key==="Escape"&&ze()},[Y,ze]);Iy(()=>yV(Oe),"keydown",_?nt:void 0),Iy(()=>{if(!u)return null;const ut=Oe.current;if(!ut)return null;const kt=eZ(ut);return kt.localName==="body"?ak(Oe):kt},"scroll",()=>{Y&&u&&Ce()},{passive:!0,capture:!0}),N.useEffect(()=>{K&&(Se(),Y&&Q())},[K,Y,Q,Se]),N.useEffect(()=>()=>{Se(),Ee()},[Se,Ee]),Iy(()=>Oe.current,"pointerleave",ze);const Ze=N.useCallback((ut={},kt=null)=>({...ut,ref:Fi(Oe,kt,ie),onPointerEnter:Nn(ut.onPointerEnter,Mt=>{Mt.pointerType!=="touch"&&Me()}),onClick:Nn(ut.onClick,He),onPointerDown:Nn(ut.onPointerDown,qe),onFocus:Nn(ut.onFocus,Me),onBlur:Nn(ut.onBlur,ze),"aria-describedby":Y?Fe:void 0}),[Me,ze,qe,Y,Fe,He,ie]),gt=N.useCallback((ut={},kt=null)=>de({...ut,style:{...ut.style,[ho.arrowSize.var]:M?`${M}px`:void 0,[ho.arrowShadowColor.var]:F}},kt),[de,M,F]),sn=N.useCallback((ut={},kt=null)=>{const ct={...ut.style,position:"relative",transformOrigin:ho.transformOrigin.varRef};return{ref:kt,...le,...ut,id:Fe,role:"tooltip",style:ct}},[le,Fe]);return{isOpen:Y,show:Me,hide:ze,getTriggerProps:Ze,getTooltipProps:sn,getTooltipPositionerProps:gt,getArrowProps:pe,getArrowInnerProps:ue}}const QM="chakra-ui:close-tooltip";function tUe(n,e){return N.useEffect(()=>{const i=yV(n);return i.addEventListener(QM,e),()=>i.removeEventListener(QM,e)},[e,n]),()=>{const i=yV(n),a=ak(n);i.dispatchEvent(new a.CustomEvent(QM))}}const nUe=Ut(em.div),Bf=Bt((n,e)=>{const i=sd("Tooltip",n),a=Bi(n),l=B0(),{children:u,label:f,shouldWrapChildren:_,"aria-label":E,hasArrow:b,bg:C,portalProps:I,background:O,backgroundColor:L,bgColor:M,motionProps:F,animatePresenceProps:z,...X}=a,K=O??L??C??M;if(K){i.bg=K;const ie=Qve(l,"colors",K);i[ho.arrowBg.var]=ie}const ne=eUe({...X,direction:l.direction}),oe=!N.isValidElement(u)||_;let ae;if(oe)ae=T.jsx(Ut.span,{display:"inline-block",tabIndex:0,...ne.getTriggerProps(),children:u});else{const ie=N.Children.only(u);ae=N.cloneElement(ie,ne.getTriggerProps(ie.props,Kne(ie)))}const le=!!E,Y=ne.getTooltipProps({},e),Z=le?M0(Y,["role","id"]):Y,Q=ZQ(Y,["role","id"]);return f?T.jsxs(T.Fragment,{children:[ae,T.jsx(V0,{...z,children:ne.isOpen&&T.jsx(od,{...I,children:T.jsx(Ut.div,{...ne.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:T.jsxs(nUe,{variants:ZMe,initial:"exit",animate:"enter",exit:"exit",...F,...Z,__css:i,children:[f,le&&T.jsx(Ut.span,{srOnly:!0,...Q,children:E}),b&&T.jsx(Ut.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:T.jsx(Ut.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):T.jsx(T.Fragment,{children:u})});Bf.displayName="Tooltip";const FC=Bt(function(e,i){const a=sd("Heading",e),{className:l,...u}=Bi(e);return T.jsx(Ut.h2,{ref:i,className:_n("chakra-heading",e.className),...u,__css:a})});FC.displayName="Heading";const at=Bt(function(e,i){const a=sd("Text",e),{className:l,align:u,decoration:f,casing:_,...E}=Bi(e),b=gN({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return T.jsx(Ut.p,{ref:i,className:_n("chakra-text",e.className),...b,...E,__css:a})});at.displayName="Text";const ure=Bt(function(e,i){const{spacing:a="0.5rem",spacingX:l,spacingY:u,children:f,justify:_,direction:E,align:b,className:C,shouldWrapChildren:I,...O}=e,L=N.useMemo(()=>I?N.Children.map(f,(M,F)=>T.jsx(zj,{children:M},F)):f,[f,I]);return T.jsx(Ut.div,{ref:i,className:_n("chakra-wrap",C),...O,children:T.jsx(Ut.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:_,alignItems:b,flexDirection:E,listStyleType:"none",gap:a,columnGap:l,rowGap:u,padding:"0"},children:L})})});ure.displayName="Wrap";const zj=Bt(function(e,i){const{className:a,...l}=e;return T.jsx(Ut.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:_n("chakra-wrap__listitem",a),...l})});zj.displayName="WrapItem";const rUe="modulepreload",iUe=function(n,e){return new URL(n,e).href},sX={},ZM=function(e,i,a){let l=Promise.resolve();if(i&&i.length>0){const f=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),E=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=iUe(b,a),b in sX)return;sX[b]=!0;const C=b.endsWith(".css"),I=C?'[rel="stylesheet"]':"";if(!!a)for(let M=f.length-1;M>=0;M--){const F=f[M];if(F.href===b&&(!C||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${I}`))return;const L=document.createElement("link");if(L.rel=C?"stylesheet":rUe,C||(L.as="script"),L.crossOrigin="",L.href=b,E&&L.setAttribute("nonce",E),document.head.appendChild(L),C)return new Promise((M,F)=>{L.addEventListener("load",M),L.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${b}`)))})}))}function u(f){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=f,window.dispatchEvent(_),!_.defaultPrevented)throw f}return l.then(f=>{for(const _ of f||[])_.status==="rejected"&&u(_.reason);return e().catch(u)})},PO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${a}.${l}`},$={log:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${PO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${PO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${PO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${PO()}] ${n}`)}};async function sUe(n){let e;try{switch(n){case"default":e=await ZM(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:e=await ZM(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return e.default}catch(i){return $.error("Failed to load theme:",i),e=await ZM(()=>import("./index.v0.9.22.js"),[],import.meta.url),e.default}}const oUe=()=>{};var oX={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dre=function(n){const e=[];let i=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},aUe=function(n){const e=[];let i=0,a=0;for(;i<n.length;){const l=n[i++];if(l<128)e[a++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[i++];e[a++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[i++],f=n[i++],_=n[i++],E=((l&7)<<18|(u&63)<<12|(f&63)<<6|_&63)-65536;e[a++]=String.fromCharCode(55296+(E>>10)),e[a++]=String.fromCharCode(56320+(E&1023))}else{const u=n[i++],f=n[i++];e[a++]=String.fromCharCode((l&15)<<12|(u&63)<<6|f&63)}}return e.join("")},hre={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const u=n[l],f=l+1<n.length,_=f?n[l+1]:0,E=l+2<n.length,b=E?n[l+2]:0,C=u>>2,I=(u&3)<<4|_>>4;let O=(_&15)<<2|b>>6,L=b&63;E||(L=64,f||(O=64)),a.push(i[C],i[I],i[O],i[L])}return a.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(dre(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):aUe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const u=i[n.charAt(l++)],_=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,u==null||_==null||b==null||I==null)throw new cUe;const O=u<<2|_>>4;if(a.push(O),b!==64){const L=_<<4&240|b>>2;if(a.push(L),I!==64){const M=b<<6&192|I;a.push(M)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class cUe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const lUe=function(n){const e=dre(n);return hre.encodeByteArray(e,!0)},jk=function(n){return lUe(n).replace(/\./g,"")},pre=function(n){try{return hre.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uUe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dUe=()=>uUe().__FIREBASE_DEFAULTS__,hUe=()=>{if(typeof process>"u"||typeof oX>"u")return;const n=oX.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},pUe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&pre(n[1]);return e&&JSON.parse(e)},HN=()=>{try{return oUe()||dUe()||hUe()||pUe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},fre=n=>{var e,i;return(i=(e=HN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},Wj=n=>{const e=fre(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),a]:[e.substring(0,i),a]},mre=()=>{var n;return(n=HN())===null||n===void 0?void 0:n.config},gre=n=>{var e;return(e=HN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fUe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _re(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[jk(JSON.stringify(i)),jk(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function mUe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(uc())}function gUe(){var n;const e=(n=HN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _Ue(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function yUe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function EUe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function vUe(){const n=uc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function SUe(){return!gUe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function bUe(){try{return typeof indexedDB=="object"}catch{return!1}}function TUe(){return new Promise((n,e)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wUe="FirebaseError";class ah extends Error{constructor(e,i,a){super(i),this.code=e,this.customData=a,this.name=wUe,Object.setPrototypeOf(this,ah.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lR.prototype.create)}}class lR{constructor(e,i,a){this.service=e,this.serviceName=i,this.errors=a}create(e,...i){const a=i[0]||{},l=`${this.service}/${e}`,u=this.errors[e],f=u?CUe(u,a):"Error",_=`${this.serviceName}: ${f} (${l}).`;return new ah(l,_,a)}}function CUe(n,e){return n.replace(RUe,(i,a)=>{const l=e[a];return l!=null?String(l):`<${a}?>`})}const RUe=/\{\$([^}]+)}/g;function IUe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function qf(n,e){if(n===e)return!0;const i=Object.keys(n),a=Object.keys(e);for(const l of i){if(!a.includes(l))return!1;const u=n[l],f=e[l];if(aX(u)&&aX(f)){if(!qf(u,f))return!1}else if(u!==f)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function aX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uR(n){const e=[];for(const[i,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function zw(n){const e={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,u]=a.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function Ww(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function AUe(n,e){const i=new PUe(n,e);return i.subscribe.bind(i)}class PUe{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,a){let l;if(e===void 0&&i===void 0&&a===void 0)throw new Error("Missing Observer.");OUe(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:a},l.next===void 0&&(l.next=eU),l.error===void 0&&(l.error=eU),l.complete===void 0&&(l.complete=eU);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function OUe(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function eU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ji(n){return n&&n._delegate?n._delegate:n}class Yf{constructor(e,i,a){this.name=e,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kUe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const a=new fUe;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const a=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(DUe(e))try{this.getOrInitializeService({instanceIdentifier:yy})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const u=this.getOrInitializeService({instanceIdentifier:l});a.resolve(u)}catch{}}}}clearInstance(e=yy){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=yy){return this.instances.has(e)}getOptions(e=yy){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[u,f]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(u);a===_&&f.resolve(l)}return l}onInit(e,i){var a;const l=this.normalizeInstanceIdentifier(i),u=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;u.add(e),this.onInitCallbacks.set(l,u);const f=this.instances.get(l);return f&&e(f,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:NUe(e),options:i}),this.instances.set(e,a),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=yy){return this.component?this.component.multipleInstances?e:yy:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function NUe(n){return n===yy?void 0:n}function DUe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xUe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new kUe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(xr||(xr={}));const LUe={debug:xr.DEBUG,verbose:xr.VERBOSE,info:xr.INFO,warn:xr.WARN,error:xr.ERROR,silent:xr.SILENT},MUe=xr.INFO,UUe={[xr.DEBUG]:"log",[xr.VERBOSE]:"log",[xr.INFO]:"info",[xr.WARN]:"warn",[xr.ERROR]:"error"},VUe=(n,e,...i)=>{if(e<n.logLevel)return;const a=new Date().toISOString(),l=UUe[e];if(l)console[l](`[${a}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Gj{constructor(e){this.name=e,this._logLevel=MUe,this._logHandler=VUe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?LUe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,xr.DEBUG,...e),this._logHandler(this,xr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,xr.VERBOSE,...e),this._logHandler(this,xr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,xr.INFO,...e),this._logHandler(this,xr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,xr.WARN,...e),this._logHandler(this,xr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,xr.ERROR,...e),this._logHandler(this,xr.ERROR,...e)}}const FUe=(n,e)=>e.some(i=>n instanceof i);let cX,lX;function jUe(){return cX||(cX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function BUe(){return lX||(lX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yre=new WeakMap,EV=new WeakMap,Ere=new WeakMap,tU=new WeakMap,Hj=new WeakMap;function zUe(n){const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",f)},u=()=>{i(Cg(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",f)});return e.then(i=>{i instanceof IDBCursor&&yre.set(i,n)}).catch(()=>{}),Hj.set(e,n),e}function WUe(n){if(EV.has(n))return;const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",f),n.removeEventListener("abort",f)},u=()=>{i(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",f),n.addEventListener("abort",f)});EV.set(n,e)}let vV={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return EV.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ere.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Cg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function GUe(n){vV=n(vV)}function HUe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const a=n.call(nU(this),e,...i);return Ere.set(a,e.sort?e.sort():[e]),Cg(a)}:BUe().includes(n)?function(...e){return n.apply(nU(this),e),Cg(yre.get(this))}:function(...e){return Cg(n.apply(nU(this),e))}}function $Ue(n){return typeof n=="function"?HUe(n):(n instanceof IDBTransaction&&WUe(n),FUe(n,jUe())?new Proxy(n,vV):n)}function Cg(n){if(n instanceof IDBRequest)return zUe(n);if(tU.has(n))return tU.get(n);const e=$Ue(n);return e!==n&&(tU.set(n,e),Hj.set(e,n)),e}const nU=n=>Hj.get(n);function KUe(n,e,{blocked:i,upgrade:a,blocking:l,terminated:u}={}){const f=indexedDB.open(n,e),_=Cg(f);return a&&f.addEventListener("upgradeneeded",E=>{a(Cg(f.result),E.oldVersion,E.newVersion,Cg(f.transaction),E)}),i&&f.addEventListener("blocked",E=>i(E.oldVersion,E.newVersion,E)),_.then(E=>{u&&E.addEventListener("close",()=>u()),l&&E.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),_}const qUe=["get","getKey","getAll","getAllKeys","count"],YUe=["put","add","delete","clear"],rU=new Map;function uX(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(rU.get(e))return rU.get(e);const i=e.replace(/FromIndex$/,""),a=e!==i,l=YUe.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||qUe.includes(i)))return;const u=async function(f,..._){const E=this.transaction(f,l?"readwrite":"readonly");let b=E.store;return a&&(b=b.index(_.shift())),(await Promise.all([b[i](..._),l&&E.done]))[0]};return rU.set(e,u),u}GUe(n=>({...n,get:(e,i,a)=>uX(e,i)||n.get(e,i,a),has:(e,i)=>!!uX(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XUe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(JUe(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function JUe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const SV="@firebase/app",dX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xf=new Gj("@firebase/app"),QUe="@firebase/app-compat",ZUe="@firebase/analytics-compat",eVe="@firebase/analytics",tVe="@firebase/app-check-compat",nVe="@firebase/app-check",rVe="@firebase/auth",iVe="@firebase/auth-compat",sVe="@firebase/database",oVe="@firebase/data-connect",aVe="@firebase/database-compat",cVe="@firebase/functions",lVe="@firebase/functions-compat",uVe="@firebase/installations",dVe="@firebase/installations-compat",hVe="@firebase/messaging",pVe="@firebase/messaging-compat",fVe="@firebase/performance",mVe="@firebase/performance-compat",gVe="@firebase/remote-config",_Ve="@firebase/remote-config-compat",yVe="@firebase/storage",EVe="@firebase/storage-compat",vVe="@firebase/firestore",SVe="@firebase/vertexai",bVe="@firebase/firestore-compat",TVe="firebase",wVe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bV="[DEFAULT]",CVe={[SV]:"fire-core",[QUe]:"fire-core-compat",[eVe]:"fire-analytics",[ZUe]:"fire-analytics-compat",[nVe]:"fire-app-check",[tVe]:"fire-app-check-compat",[rVe]:"fire-auth",[iVe]:"fire-auth-compat",[sVe]:"fire-rtdb",[oVe]:"fire-data-connect",[aVe]:"fire-rtdb-compat",[cVe]:"fire-fn",[lVe]:"fire-fn-compat",[uVe]:"fire-iid",[dVe]:"fire-iid-compat",[hVe]:"fire-fcm",[pVe]:"fire-fcm-compat",[fVe]:"fire-perf",[mVe]:"fire-perf-compat",[gVe]:"fire-rc",[_Ve]:"fire-rc-compat",[yVe]:"fire-gcs",[EVe]:"fire-gcs-compat",[vVe]:"fire-fst",[bVe]:"fire-fst-compat",[SVe]:"fire-vertex","fire-js":"fire-js",[TVe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bk=new Map,RVe=new Map,TV=new Map;function hX(n,e){try{n.container.addComponent(e)}catch(i){Xf.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Ng(n){const e=n.name;if(TV.has(e))return Xf.debug(`There were multiple attempts to register component ${e}.`),!1;TV.set(e,n);for(const i of Bk.values())hX(i,n);for(const i of RVe.values())hX(i,n);return!0}function dR(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function El(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IVe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Rg=new lR("app","Firebase",IVe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AVe{constructor(e,i,a){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Yf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Rg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy=wVe;function vre(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const a=Object.assign({name:bV,automaticDataCollectionEnabled:!1},e),l=a.name;if(typeof l!="string"||!l)throw Rg.create("bad-app-name",{appName:String(l)});if(i||(i=mre()),!i)throw Rg.create("no-options");const u=Bk.get(l);if(u){if(qf(i,u.options)&&qf(a,u.config))return u;throw Rg.create("duplicate-app",{appName:l})}const f=new xUe(l);for(const E of TV.values())f.addComponent(E);const _=new AVe(i,a,f);return Bk.set(l,_),_}function $N(n=bV){const e=Bk.get(n);if(!e&&n===bV&&mre())return vre();if(!e)throw Rg.create("no-app",{appName:n});return e}function Qu(n,e,i){var a;let l=(a=CVe[n])!==null&&a!==void 0?a:n;i&&(l+=`-${i}`);const u=l.match(/\s|\//),f=e.match(/\s|\//);if(u||f){const _=[`Unable to register library "${l}" with version "${e}":`];u&&_.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&f&&_.push("and"),f&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xf.warn(_.join(" "));return}Ng(new Yf(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PVe="firebase-heartbeat-database",OVe=1,jC="firebase-heartbeat-store";let iU=null;function Sre(){return iU||(iU=KUe(PVe,OVe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(jC)}catch(i){console.warn(i)}}}}).catch(n=>{throw Rg.create("idb-open",{originalErrorMessage:n.message})})),iU}async function kVe(n){try{const i=(await Sre()).transaction(jC),a=await i.objectStore(jC).get(bre(n));return await i.done,a}catch(e){if(e instanceof ah)Xf.warn(e.message);else{const i=Rg.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Xf.warn(i.message)}}}async function pX(n,e){try{const a=(await Sre()).transaction(jC,"readwrite");await a.objectStore(jC).put(e,bre(n)),await a.done}catch(i){if(i instanceof ah)Xf.warn(i.message);else{const a=Rg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Xf.warn(a.message)}}}function bre(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NVe=1024,DVe=30;class xVe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new MVe(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=fX();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(f=>f.date===u))return;if(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats.length>DVe){const f=UVe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Xf.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=fX(),{heartbeatsToSend:a,unsentEntries:l}=LVe(this._heartbeatsCache.heartbeats),u=jk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(i){return Xf.warn(i),""}}}function fX(){return new Date().toISOString().substring(0,10)}function LVe(n,e=NVe){const i=[];let a=n.slice();for(const l of n){const u=i.find(f=>f.agent===l.agent);if(u){if(u.dates.push(l.date),mX(i)>e){u.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),mX(i)>e){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class MVe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return bUe()?TUe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await kVe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return pX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return pX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function mX(n){return jk(JSON.stringify({version:2,heartbeats:n})).length}function UVe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let a=1;a<n.length;a++)n[a].date<i&&(i=n[a].date,e=a);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VVe(n){Ng(new Yf("platform-logger",e=>new XUe(e),"PRIVATE")),Ng(new Yf("heartbeat",e=>new xVe(e),"PRIVATE")),Qu(SV,dX,n),Qu(SV,dX,"esm2017"),Qu("fire-js","")}VVe("");function Tre(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const FVe=Tre,wre=new lR("auth","Firebase",Tre());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zk=new Gj("@firebase/auth");function jVe(n,...e){zk.logLevel<=xr.WARN&&zk.warn(`Auth (${Qy}): ${n}`,...e)}function ck(n,...e){zk.logLevel<=xr.ERROR&&zk.error(`Auth (${Qy}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rh(n,...e){throw $j(n,...e)}function Ep(n,...e){return $j(n,...e)}function Cre(n,e,i){const a=Object.assign(Object.assign({},FVe()),{[e]:i});return new lR("auth","Firebase",a).create(e,{appName:n.name})}function zf(n){return Cre(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function $j(n,...e){if(typeof n!="string"){const i=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(i,...a)}return wre.create(n,...e)}function Wn(n,e,...i){if(!n)throw $j(e,...i)}function Of(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ck(e),new Error(e)}function Jf(n,e){n||Of(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function BVe(){return gX()==="http:"||gX()==="https:"}function gX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zVe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(BVe()||yUe()||"connection"in navigator)?navigator.onLine:!0}function WVe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(e,i){this.shortDelay=e,this.longDelay=i,Jf(i>e,"Short delay should be less than long delay!"),this.isMobile=mUe()||EUe()}get(){return zVe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kj(n,e){Jf(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rre{static initialize(e,i,a){this.fetchImpl=e,i&&(this.headersImpl=i),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Of("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Of("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Of("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GVe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HVe=new hR(3e4,6e4);function tm(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function nm(n,e,i,a,l={}){return Ire(n,l,async()=>{let u={},f={};a&&(e==="GET"?f=a:u={body:JSON.stringify(a)});const _=uR(Object.assign({key:n.config.apiKey},f)).slice(1),E=await n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:E},u);return _Ue()||(b.referrerPolicy="no-referrer"),Rre.fetch()(Are(n,n.config.apiHost,i,_),b)})}async function Ire(n,e,i){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},GVe),e);try{const l=new KVe(n),u=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const f=await u.json();if("needConfirmation"in f)throw OO(n,"account-exists-with-different-credential",f);if(u.ok&&!("errorMessage"in f))return f;{const _=u.ok?f.errorMessage:f.error.message,[E,b]=_.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw OO(n,"credential-already-in-use",f);if(E==="EMAIL_EXISTS")throw OO(n,"email-already-in-use",f);if(E==="USER_DISABLED")throw OO(n,"user-disabled",f);const C=a[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw Cre(n,C,b);rh(n,C)}}catch(l){if(l instanceof ah)throw l;rh(n,"network-request-failed",{message:String(l)})}}async function pR(n,e,i,a,l={}){const u=await nm(n,e,i,a,l);return"mfaPendingCredential"in u&&rh(n,"multi-factor-auth-required",{_serverResponse:u}),u}function Are(n,e,i,a){const l=`${e}${i}?${a}`;return n.config.emulator?Kj(n.config,l):`${n.config.apiScheme}://${l}`}function $Ve(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class KVe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,a)=>{this.timer=setTimeout(()=>a(Ep(this.auth,"network-request-failed")),HVe.get())})}}function OO(n,e,i){const a={appName:n.name};i.email&&(a.email=i.email),i.phoneNumber&&(a.phoneNumber=i.phoneNumber);const l=Ep(n,e,a);return l.customData._tokenResponse=i,l}function _X(n){return n!==void 0&&n.enterprise!==void 0}class qVe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return $Ve(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function YVe(n,e){return nm(n,"GET","/v2/recaptchaConfig",tm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XVe(n,e){return nm(n,"POST","/v1/accounts:delete",e)}async function Pre(n,e){return nm(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function JVe(n,e=!1){const i=ji(n),a=await i.getIdToken(e),l=qj(a);Wn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,f=u==null?void 0:u.sign_in_provider;return{claims:l,token:a,authTime:hC(sU(l.auth_time)),issuedAtTime:hC(sU(l.iat)),expirationTime:hC(sU(l.exp)),signInProvider:f||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function sU(n){return Number(n)*1e3}function qj(n){const[e,i,a]=n.split(".");if(e===void 0||i===void 0||a===void 0)return ck("JWT malformed, contained fewer than 3 sections"),null;try{const l=pre(i);return l?JSON.parse(l):(ck("Failed to decode base64 JWT payload"),null)}catch(l){return ck("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function yX(n){const e=qj(n);return Wn(e,"internal-error"),Wn(typeof e.exp<"u","internal-error"),Wn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BC(n,e,i=!1){if(i)return e;try{return await e}catch(a){throw a instanceof ah&&QVe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function QVe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZVe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CV{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=hC(this.lastLoginAt),this.creationTime=hC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wk(n){var e;const i=n.auth,a=await n.getIdToken(),l=await BC(n,Pre(i,{idToken:a}));Wn(l==null?void 0:l.users.length,i,"internal-error");const u=l.users[0];n._notifyReloadListener(u);const f=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?Ore(u.providerUserInfo):[],_=tFe(n.providerData,f),E=n.isAnonymous,b=!(n.email&&u.passwordHash)&&!(_!=null&&_.length),C=E?b:!1,I={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:_,metadata:new CV(u.createdAt,u.lastLoginAt),isAnonymous:C};Object.assign(n,I)}async function eFe(n){const e=ji(n);await Wk(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function tFe(n,e){return[...n.filter(a=>!e.some(l=>l.providerId===a.providerId)),...e]}function Ore(n){return n.map(e=>{var{providerId:i}=e,a=iR(e,["providerId"]);return{providerId:i,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nFe(n,e){const i=await Ire(n,{},async()=>{const a=uR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,f=Are(n,l,"/v1/token",`key=${u}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",Rre.fetch()(f,{method:"POST",headers:_,body:a})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function rFe(n,e){return nm(n,"POST","/v2/accounts:revokeToken",tm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Wn(e.idToken,"internal-error"),Wn(typeof e.idToken<"u","internal-error"),Wn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yX(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Wn(e.length!==0,"internal-error");const i=yX(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Wn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:a,refreshToken:l,expiresIn:u}=await nFe(e,i);this.updateTokensAndExpiration(a,l,Number(u))}updateTokensAndExpiration(e,i,a){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,i){const{refreshToken:a,accessToken:l,expirationTime:u}=i,f=new o0;return a&&(Wn(typeof a=="string","internal-error",{appName:e}),f.refreshToken=a),l&&(Wn(typeof l=="string","internal-error",{appName:e}),f.accessToken=l),u&&(Wn(typeof u=="number","internal-error",{appName:e}),f.expirationTime=u),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new o0,this.toJSON())}_performRefresh(){return Of("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hg(n,e){Wn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class kf{constructor(e){var{uid:i,auth:a,stsTokenManager:l}=e,u=iR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ZVe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new CV(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const i=await BC(this,this.stsTokenManager.getToken(this.auth,e));return Wn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return JVe(this,e)}reload(){return eFe(this)}_assign(e){this!==e&&(Wn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new kf(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Wn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),i&&await Wk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(El(this.auth.app))return Promise.reject(zf(this.auth));const e=await this.getIdToken();return await BC(this,XVe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var a,l,u,f,_,E,b,C;const I=(a=i.displayName)!==null&&a!==void 0?a:void 0,O=(l=i.email)!==null&&l!==void 0?l:void 0,L=(u=i.phoneNumber)!==null&&u!==void 0?u:void 0,M=(f=i.photoURL)!==null&&f!==void 0?f:void 0,F=(_=i.tenantId)!==null&&_!==void 0?_:void 0,z=(E=i._redirectEventId)!==null&&E!==void 0?E:void 0,X=(b=i.createdAt)!==null&&b!==void 0?b:void 0,K=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:ne,emailVerified:oe,isAnonymous:ae,providerData:le,stsTokenManager:Y}=i;Wn(ne&&Y,e,"internal-error");const Z=o0.fromJSON(this.name,Y);Wn(typeof ne=="string",e,"internal-error"),hg(I,e.name),hg(O,e.name),Wn(typeof oe=="boolean",e,"internal-error"),Wn(typeof ae=="boolean",e,"internal-error"),hg(L,e.name),hg(M,e.name),hg(F,e.name),hg(z,e.name),hg(X,e.name),hg(K,e.name);const Q=new kf({uid:ne,auth:e,email:O,emailVerified:oe,displayName:I,isAnonymous:ae,photoURL:M,phoneNumber:L,tenantId:F,stsTokenManager:Z,createdAt:X,lastLoginAt:K});return le&&Array.isArray(le)&&(Q.providerData=le.map(ie=>Object.assign({},ie))),z&&(Q._redirectEventId=z),Q}static async _fromIdTokenResponse(e,i,a=!1){const l=new o0;l.updateFromServerResponse(i);const u=new kf({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a});return await Wk(u),u}static async _fromGetAccountInfoResponse(e,i,a){const l=i.users[0];Wn(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?Ore(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),_=new o0;_.updateFromIdToken(a);const E=new kf({uid:l.localId,auth:e,stsTokenManager:_,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new CV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(E,b),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EX=new Map;function Nf(n){Jf(n instanceof Function,"Expected a class definition");let e=EX.get(n);return e?(Jf(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,EX.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kre{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}kre.type="NONE";const vX=kre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lk(n,e,i){return`firebase:${n}:${e}:${i}`}class a0{constructor(e,i,a){this.persistence=e,this.auth=i,this.userKey=a;const{config:l,name:u}=this.auth;this.fullUserKey=lk(this.userKey,l.apiKey,u),this.fullPersistenceKey=lk("persistence",l.apiKey,u),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?kf._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,a="authUser"){if(!i.length)return new a0(Nf(vX),e,a);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let u=l[0]||Nf(vX);const f=lk(a,e.config.apiKey,e.name);let _=null;for(const b of i)try{const C=await b._get(f);if(C){const I=kf._fromJSON(e,C);b!==u&&(_=I),u=b;break}}catch{}const E=l.filter(b=>b._shouldAllowMigration);return!u._shouldAllowMigration||!E.length?new a0(u,e,a):(u=E[0],_&&await u._set(f,_.toJSON()),await Promise.all(i.map(async b=>{if(b!==u)try{await b._remove(f)}catch{}})),new a0(u,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SX(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Lre(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Nre(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ure(e))return"Blackberry";if(Vre(e))return"Webos";if(Dre(e))return"Safari";if((e.includes("chrome/")||xre(e))&&!e.includes("edge/"))return"Chrome";if(Mre(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(i);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Nre(n=uc()){return/firefox\//i.test(n)}function Dre(n=uc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xre(n=uc()){return/crios\//i.test(n)}function Lre(n=uc()){return/iemobile/i.test(n)}function Mre(n=uc()){return/android/i.test(n)}function Ure(n=uc()){return/blackberry/i.test(n)}function Vre(n=uc()){return/webos/i.test(n)}function Yj(n=uc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function iFe(n=uc()){var e;return Yj(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function sFe(){return vUe()&&document.documentMode===10}function Fre(n=uc()){return Yj(n)||Mre(n)||Vre(n)||Ure(n)||/windows phone/i.test(n)||Lre(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jre(n,e=[]){let i;switch(n){case"Browser":i=SX(uc());break;case"Worker":i=`${SX(uc())}-${n}`;break;default:i=n}const a=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${Qy}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oFe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const a=u=>new Promise((f,_)=>{try{const E=e(u);f(E)}catch(E){_(E)}});a.onAbort=i,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const a of this.queue)await a(e),a.onAbort&&i.push(a.onAbort)}catch(a){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aFe(n,e={}){return nm(n,"GET","/v2/passwordPolicy",tm(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cFe=6;class lFe{constructor(e){var i,a,l,u;const f=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=f.minPasswordLength)!==null&&i!==void 0?i:cFe,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=e.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,a,l,u,f,_;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(i=E.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),E.isValid&&(E.isValid=(a=E.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),E.isValid&&(E.isValid=(l=E.containsLowercaseLetter)!==null&&l!==void 0?l:!0),E.isValid&&(E.isValid=(u=E.containsUppercaseLetter)!==null&&u!==void 0?u:!0),E.isValid&&(E.isValid=(f=E.containsNumericCharacter)!==null&&f!==void 0?f:!0),E.isValid&&(E.isValid=(_=E.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),E}validatePasswordLengthOptions(e,i){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(i.meetsMinPasswordLength=e.length>=a),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let a;for(let l=0;l<e.length;l++)a=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,i,a,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uFe{constructor(e,i,a,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new bX(this),this.idTokenSubscription=new bX(this),this.beforeStateQueue=new oFe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=wre,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Nf(i)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await a0.create(this,e),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await Pre(this,{idToken:e}),a=await kf._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(a)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(El(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(_,_))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,_=l==null?void 0:l._redirectEventId,E=await this.tryRedirectSignIn(e);(!f||f===_)&&(E!=null&&E.user)&&(l=E.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Wn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await Wk(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=WVe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(El(this.app))return Promise.reject(zf(this));const i=e?ji(e):null;return i&&Wn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Wn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return El(this.app)?Promise.reject(zf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return El(this.app)?Promise.reject(zf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Nf(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await aFe(this),i=new lFe(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new lR("auth","Firebase",e())}onAuthStateChanged(e,i,a){return this.registerStateListener(this.authStateSubscription,e,i,a)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,a){return this.registerStateListener(this.idTokenSubscription,e,i,a)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(a.tenantId=this.tenantId),await rFe(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const a=await this.getOrInitRedirectPersistenceManager(i);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Nf(e)||this._popupRedirectResolver;Wn(i,this,"argument-error"),this.redirectPersistenceManager=await a0.create(this,[Nf(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,a;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,a,l){if(this._deleted)return()=>{};const u=typeof i=="function"?i:i.next.bind(i);let f=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(Wn(_,this,"internal-error"),_.then(()=>{f||u(this.currentUser)}),typeof i=="function"){const E=e.addObserver(i,a,l);return()=>{f=!0,E()}}else{const E=e.addObserver(i);return()=>{f=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Wn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=jre(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const a=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());a&&(i["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(El(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&jVe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Gg(n){return ji(n)}class bX{constructor(e){this.auth=e,this.observer=null,this.addObserver=AUe(i=>this.observer=i)}get next(){return Wn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let KN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function dFe(n){KN=n}function Bre(n){return KN.loadJS(n)}function hFe(){return KN.recaptchaEnterpriseScript}function pFe(){return KN.gapiScript}function fFe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class mFe{constructor(){this.enterprise=new gFe}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class gFe{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const _Fe="recaptcha-enterprise",zre="NO_RECAPTCHA";class yFe{constructor(e){this.type=_Fe,this.auth=Gg(e)}async verify(e="verify",i=!1){async function a(u){if(!i){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(f,_)=>{YVe(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)_(new Error("recaptcha Enterprise site key undefined"));else{const b=new qVe(E);return u.tenantId==null?u._agentRecaptchaConfig=b:u._tenantRecaptchaConfigs[u.tenantId]=b,f(b.siteKey)}}).catch(E=>{_(E)})})}function l(u,f,_){const E=window.grecaptcha;_X(E)?E.enterprise.ready(()=>{E.enterprise.execute(u,{action:e}).then(b=>{f(b)}).catch(()=>{f(zre)})}):_(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new mFe().execute("siteKey",{action:"verify"}):new Promise((u,f)=>{a(this.auth).then(_=>{if(!i&&_X(window.grecaptcha))l(_,u,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let E=hFe();E.length!==0&&(E+=_),Bre(E).then(()=>{l(_,u,f)}).catch(b=>{f(b)})}}).catch(_=>{f(_)})})}}async function TX(n,e,i,a=!1,l=!1){const u=new yFe(n);let f;if(l)f=zre;else try{f=await u.verify(i)}catch{f=await u.verify(i,!0)}const _=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in _){const E=_.phoneEnrollmentInfo.phoneNumber,b=_.phoneEnrollmentInfo.recaptchaToken;Object.assign(_,{phoneEnrollmentInfo:{phoneNumber:E,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in _){const E=_.phoneSignInInfo.recaptchaToken;Object.assign(_,{phoneSignInInfo:{recaptchaToken:E,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return _}return a?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function Gk(n,e,i,a,l){var u;if(!((u=n._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await TX(n,e,i,i==="getOobCode");return a(n,f)}else return a(n,e).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await TX(n,e,i,i==="getOobCode");return a(n,_)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EFe(n,e){const i=dR(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),u=i.getOptions();if(qf(u,e??{}))return l;rh(l,"already-initialized")}return i.initialize({options:e})}function vFe(n,e){const i=(e==null?void 0:e.persistence)||[],a=(Array.isArray(i)?i:[i]).map(Nf);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function SFe(n,e,i){const a=Gg(n);Wn(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const l=!1,u=Wre(e),{host:f,port:_}=bFe(e),E=_===null?"":`:${_}`,b={url:`${u}//${f}${E}/`},C=Object.freeze({host:f,port:_,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Wn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Wn(qf(b,a.config.emulator)&&qf(C,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=C,a.settings.appVerificationDisabledForTesting=!0,TFe()}function Wre(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function bFe(n){const e=Wre(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const a=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const u=l[1];return{host:u,port:wX(a.substr(u.length+1))}}else{const[u,f]=a.split(":");return{host:u,port:wX(f)}}}function wX(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function TFe(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xj{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Of("not implemented")}_getIdTokenResponse(e){return Of("not implemented")}_linkToIdToken(e,i){return Of("not implemented")}_getReauthenticationResolver(e){return Of("not implemented")}}async function wFe(n,e){return nm(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CFe(n,e){return pR(n,"POST","/v1/accounts:signInWithPassword",tm(n,e))}async function Gre(n,e){return nm(n,"POST","/v1/accounts:sendOobCode",tm(n,e))}async function RFe(n,e){return Gre(n,e)}async function IFe(n,e){return Gre(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AFe(n,e){return pR(n,"POST","/v1/accounts:signInWithEmailLink",tm(n,e))}async function PFe(n,e){return pR(n,"POST","/v1/accounts:signInWithEmailLink",tm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC extends Xj{constructor(e,i,a,l=null){super("password",a),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new zC(e,i,"password")}static _fromEmailAndCode(e,i,a=null){return new zC(e,i,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Gk(e,i,"signInWithPassword",CFe);case"emailLink":return AFe(e,{email:this._email,oobCode:this._password});default:rh(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const a={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Gk(e,a,"signUpPassword",wFe);case"emailLink":return PFe(e,{idToken:i,email:this._email,oobCode:this._password});default:rh(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c0(n,e){return pR(n,"POST","/v1/accounts:signInWithIdp",tm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OFe="http://localhost";class $y extends Xj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new $y(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):rh("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:l}=i,u=iR(i,["providerId","signInMethod"]);if(!a||!l)return null;const f=new $y(a,l);return f.idToken=u.idToken||void 0,f.accessToken=u.accessToken||void 0,f.secret=u.secret,f.nonce=u.nonce,f.pendingToken=u.pendingToken||null,f}_getIdTokenResponse(e){const i=this.buildRequest();return c0(e,i)}_linkToIdToken(e,i){const a=this.buildRequest();return a.idToken=i,c0(e,a)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,c0(e,i)}buildRequest(){const e={requestUri:OFe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=uR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kFe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function NFe(n){const e=zw(Ww(n)).link,i=e?zw(Ww(e)).deep_link_id:null,a=zw(Ww(n)).deep_link_id;return(a?zw(Ww(a)).link:null)||a||i||e||n}class Jj{constructor(e){var i,a,l,u,f,_;const E=zw(Ww(e)),b=(i=E.apiKey)!==null&&i!==void 0?i:null,C=(a=E.oobCode)!==null&&a!==void 0?a:null,I=kFe((l=E.mode)!==null&&l!==void 0?l:null);Wn(b&&C&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=C,this.continueUrl=(u=E.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(f=E.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(_=E.tenantId)!==null&&_!==void 0?_:null}static parseLink(e){const i=NFe(e);try{return new Jj(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0{constructor(){this.providerId=G0.PROVIDER_ID}static credential(e,i){return zC._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const a=Jj.parseLink(i);return Wn(a,"argument-error"),zC._fromEmailAndCode(e,a.code,a.tenantId)}}G0.PROVIDER_ID="password";G0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";G0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hre{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR extends Hre{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g extends fR{constructor(){super("facebook.com")}static credential(e){return $y._fromParams({providerId:_g.PROVIDER_ID,signInMethod:_g.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _g.credentialFromTaggedObject(e)}static credentialFromError(e){return _g.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _g.credential(e.oauthAccessToken)}catch{return null}}}_g.FACEBOOK_SIGN_IN_METHOD="facebook.com";_g.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg extends fR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return $y._fromParams({providerId:yg.PROVIDER_ID,signInMethod:yg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return yg.credentialFromTaggedObject(e)}static credentialFromError(e){return yg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:a}=e;if(!i&&!a)return null;try{return yg.credential(i,a)}catch{return null}}}yg.GOOGLE_SIGN_IN_METHOD="google.com";yg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends fR{constructor(){super("github.com")}static credential(e){return $y._fromParams({providerId:Eg.PROVIDER_ID,signInMethod:Eg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Eg.credentialFromTaggedObject(e)}static credentialFromError(e){return Eg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Eg.credential(e.oauthAccessToken)}catch{return null}}}Eg.GITHUB_SIGN_IN_METHOD="github.com";Eg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg extends fR{constructor(){super("twitter.com")}static credential(e,i){return $y._fromParams({providerId:vg.PROVIDER_ID,signInMethod:vg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return vg.credentialFromTaggedObject(e)}static credentialFromError(e){return vg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:a}=e;if(!i||!a)return null;try{return vg.credential(i,a)}catch{return null}}}vg.TWITTER_SIGN_IN_METHOD="twitter.com";vg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DFe(n,e){return pR(n,"POST","/v1/accounts:signUp",tm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ky{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,a,l=!1){const u=await kf._fromIdTokenResponse(e,a,l),f=CX(a);return new Ky({user:u,providerId:f,_tokenResponse:a,operationType:i})}static async _forOperation(e,i,a){await e._updateTokensIfNecessary(a,!0);const l=CX(a);return new Ky({user:e,providerId:l,_tokenResponse:a,operationType:i})}}function CX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk extends ah{constructor(e,i,a,l){var u;super(i.code,i.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,Hk.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:i.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,i,a,l){return new Hk(e,i,a,l)}}function $re(n,e,i,a){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?Hk._fromErrorAndOperation(n,u,e,a):u})}async function xFe(n,e,i=!1){const a=await BC(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return Ky._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LFe(n,e,i=!1){const{auth:a}=n;if(El(a.app))return Promise.reject(zf(a));const l="reauthenticate";try{const u=await BC(n,$re(a,l,e,n),i);Wn(u.idToken,a,"internal-error");const f=qj(u.idToken);Wn(f,a,"internal-error");const{sub:_}=f;return Wn(n.uid===_,a,"user-mismatch"),Ky._forOperation(n,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&rh(a,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kre(n,e,i=!1){if(El(n.app))return Promise.reject(zf(n));const a="signIn",l=await $re(n,a,e),u=await Ky._fromIdTokenResponse(n,a,l);return i||await n._updateCurrentUser(u.user),u}async function MFe(n,e){return Kre(Gg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qre(n){const e=Gg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function UFe(n,e,i){const a=Gg(n);await Gk(a,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",IFe)}async function VFe(n,e,i){if(El(n.app))return Promise.reject(zf(n));const a=Gg(n),f=await Gk(a,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",DFe).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&qre(n),E}),_=await Ky._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(_.user),_}function FFe(n,e,i){return El(n.app)?Promise.reject(zf(n)):MFe(ji(n),G0.credential(e,i)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&qre(n),a})}async function Yre(n,e){const i=ji(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:u}=await RFe(i.auth,l);u!==n.email&&await n.reload()}function jFe(n,e,i,a){return ji(n).onIdTokenChanged(e,i,a)}function BFe(n,e,i){return ji(n).beforeAuthStateChanged(e,i)}function zFe(n,e,i,a){return ji(n).onAuthStateChanged(e,i,a)}function WFe(n){return ji(n).signOut()}const $k="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xre{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem($k,"1"),this.storage.removeItem($k),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GFe=1e3,HFe=10;class Jre extends Xre{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Fre(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const a=this.storage.getItem(i),l=this.localCache[i];a!==l&&e(i,l,a)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((f,_,E)=>{this.notifyListeners(f,E)});return}const a=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!i&&this.localCache[a]===f||this.notifyListeners(a,f)},u=this.storage.getItem(a);sFe()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,HFe):l()}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:a}),!0)})},GFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}Jre.type="LOCAL";const $Fe=Jre;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qre extends Xre{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}Qre.type="SESSION";const Zre=Qre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KFe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const a=new qN(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:a,eventType:l,data:u}=i.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;i.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const _=Array.from(f).map(async b=>b(i.origin,u)),E=await KFe(_);i.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:E})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}qN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qj(n="",e=10){let i="";for(let a=0;a<e;a++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qFe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,f;return new Promise((_,E)=>{const b=Qj("",20);l.port1.start();const C=setTimeout(()=>{E(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const O=I;if(O.data.eventId===b)switch(O.data.status){case"ack":clearTimeout(C),u=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),_(O.data.response);break;default:clearTimeout(C),clearTimeout(u),E(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vp(){return window}function YFe(n){vp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eie(){return typeof vp().WorkerGlobalScope<"u"&&typeof vp().importScripts=="function"}async function XFe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function JFe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function QFe(){return eie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tie="firebaseLocalStorageDb",ZFe=1,Kk="firebaseLocalStorage",nie="fbase_key";class mR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function YN(n,e){return n.transaction([Kk],e?"readwrite":"readonly").objectStore(Kk)}function eje(){const n=indexedDB.deleteDatabase(tie);return new mR(n).toPromise()}function RV(){const n=indexedDB.open(tie,ZFe);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(Kk,{keyPath:nie})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(Kk)?e(a):(a.close(),await eje(),e(await RV()))})})}async function RX(n,e,i){const a=YN(n,!0).put({[nie]:e,value:i});return new mR(a).toPromise()}async function tje(n,e){const i=YN(n,!1).get(e),a=await new mR(i).toPromise();return a===void 0?null:a.value}function IX(n,e){const i=YN(n,!0).delete(e);return new mR(i).toPromise()}const nje=800,rje=3;class rie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await RV(),this.db)}async _withRetries(e){let i=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(i++>rje)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return eie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=qN._getInstance(QFe()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await XFe(),!this.activeServiceWorker)return;this.sender=new qFe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((e=a[0])===null||e===void 0)&&e.fulfilled&&!((i=a[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||JFe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await RV();return await RX(e,$k,"1"),await IX(e,$k),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(a=>RX(a,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(a=>tje(a,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>IX(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=YN(l,!1).getAll();return new mR(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],a=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),nje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}rie.type="LOCAL";const ije=rie;new hR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sje(n,e){return e?Nf(e):(Wn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj extends Xj{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return c0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return c0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return c0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function oje(n){return Kre(n.auth,new Zj(n),n.bypassAuthState)}function aje(n){const{auth:e,user:i}=n;return Wn(i,e,"internal-error"),LFe(i,new Zj(n),n.bypassAuthState)}async function cje(n){const{auth:e,user:i}=n;return Wn(i,e,"internal-error"),xFe(i,new Zj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iie{constructor(e,i,a,l,u=!1){this.auth=e,this.resolver=a,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:a,postBody:l,tenantId:u,error:f,type:_}=e;if(f){this.reject(f);return}const E={auth:this.auth,requestUri:i,sessionId:a,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(E))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return oje;case"linkViaPopup":case"linkViaRedirect":return cje;case"reauthViaPopup":case"reauthViaRedirect":return aje;default:rh(this.auth,"internal-error")}}resolve(e){Jf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Jf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lje=new hR(2e3,1e4);class $S extends iie{constructor(e,i,a,l,u){super(e,i,l,u),this.provider=a,this.authWindow=null,this.pollId=null,$S.currentPopupAction&&$S.currentPopupAction.cancel(),$S.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Wn(e,this.auth,"internal-error"),e}async onExecution(){Jf(this.filter.length===1,"Popup operations only handle one event");const e=Qj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Ep(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ep(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,$S.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,a;if(!((a=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ep(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,lje.get())};e()}}$S.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uje="pendingRedirect",uk=new Map;class dje extends iie{constructor(e,i,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,a),this.eventId=null}async execute(){let e=uk.get(this.auth._key());if(!e){try{const a=await hje(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(i){e=()=>Promise.reject(i)}uk.set(this.auth._key(),e)}return this.bypassAuthState||uk.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function hje(n,e){const i=mje(e),a=fje(n);if(!await a._isAvailable())return!1;const l=await a._get(i)==="true";return await a._remove(i),l}function pje(n,e){uk.set(n._key(),e)}function fje(n){return Nf(n._redirectPersistence)}function mje(n){return lk(uje,n.config.apiKey,n.name)}async function gje(n,e,i=!1){if(El(n.app))return Promise.reject(zf(n));const a=Gg(n),l=sje(a,e),f=await new dje(a,l,i).execute();return f&&!i&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _je=10*60*1e3;class yje{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(i=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Eje(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var a;if(e.error&&!sie(e)){const l=((a=e.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";i.onError(Ep(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const a=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=_je&&this.cachedEventUids.clear(),this.cachedEventUids.has(AX(e))}saveEventToCache(e){this.cachedEventUids.add(AX(e)),this.lastProcessedEventTime=Date.now()}}function AX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function sie({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Eje(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sie(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vje(n,e={}){return nm(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sje=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,bje=/^https?/;async function Tje(n){if(n.config.emulator)return;const{authorizedDomains:e}=await vje(n);for(const i of e)try{if(wje(i))return}catch{}rh(n,"unauthorized-domain")}function wje(n){const e=wV(),{protocol:i,hostname:a}=new URL(e);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&f.hostname===a}if(!bje.test(i))return!1;if(Sje.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cje=new hR(3e4,6e4);function PX(){const n=vp().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function Rje(n){return new Promise((e,i)=>{var a,l,u;function f(){PX(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{PX(),i(Ep(n,"network-request-failed"))},timeout:Cje.get()})}if(!((l=(a=vp().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=vp().gapi)===null||u===void 0)&&u.load)f();else{const _=fFe("iframefcb");return vp()[_]=()=>{gapi.load?f():i(Ep(n,"network-request-failed"))},Bre(`${pFe()}?onload=${_}`).catch(E=>i(E))}}).catch(e=>{throw dk=null,e})}let dk=null;function Ije(n){return dk=dk||Rje(n),dk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aje=new hR(5e3,15e3),Pje="__/auth/iframe",Oje="emulator/auth/iframe",kje={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Nje=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Dje(n){const e=n.config;Wn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?Kj(e,Oje):`https://${n.config.authDomain}/${Pje}`,a={apiKey:e.apiKey,appName:n.name,v:Qy},l=Nje.get(n.config.apiHost);l&&(a.eid=l);const u=n._getFrameworks();return u.length&&(a.fw=u.join(",")),`${i}?${uR(a).slice(1)}`}async function xje(n){const e=await Ije(n),i=vp().gapi;return Wn(i,n,"internal-error"),e.open({where:document.body,url:Dje(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:kje,dontclear:!0},a=>new Promise(async(l,u)=>{await a.restyle({setHideOnLeave:!1});const f=Ep(n,"network-request-failed"),_=vp().setTimeout(()=>{u(f)},Aje.get());function E(){vp().clearTimeout(_),l(a)}a.ping(E).then(E,()=>{u(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lje={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Mje=500,Uje=600,Vje="_blank",Fje="http://localhost";class OX{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function jje(n,e,i,a=Mje,l=Uje){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let _="";const E=Object.assign(Object.assign({},Lje),{width:a.toString(),height:l.toString(),top:u,left:f}),b=uc().toLowerCase();i&&(_=xre(b)?Vje:i),Nre(b)&&(e=e||Fje,E.scrollbars="yes");const C=Object.entries(E).reduce((O,[L,M])=>`${O}${L}=${M},`,"");if(iFe(b)&&_!=="_self")return Bje(e||"",_),new OX(null);const I=window.open(e||"",_,C);Wn(I,n,"popup-blocked");try{I.focus()}catch{}return new OX(I)}function Bje(n,e){const i=document.createElement("a");i.href=n,i.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zje="__/auth/handler",Wje="emulator/auth/handler",Gje=encodeURIComponent("fac");async function kX(n,e,i,a,l,u){Wn(n.config.authDomain,n,"auth-domain-config-required"),Wn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:a,v:Qy,eventId:l};if(e instanceof Hre){e.setDefaultLanguage(n.languageCode),f.providerId=e.providerId||"",IUe(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,I]of Object.entries({}))f[C]=I}if(e instanceof fR){const C=e.getScopes().filter(I=>I!=="");C.length>0&&(f.scopes=C.join(","))}n.tenantId&&(f.tid=n.tenantId);const _=f;for(const C of Object.keys(_))_[C]===void 0&&delete _[C];const E=await n._getAppCheckToken(),b=E?`#${Gje}=${encodeURIComponent(E)}`:"";return`${Hje(n)}?${uR(_).slice(1)}${b}`}function Hje({config:n}){return n.emulator?Kj(n,Wje):`https://${n.authDomain}/${zje}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oU="webStorageSupport";class $je{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Zre,this._completeRedirectFn=gje,this._overrideRedirectResult=pje}async _openPopup(e,i,a,l){var u;Jf((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const f=await kX(e,i,a,wV(),l);return jje(e,f,Qj())}async _openRedirect(e,i,a,l){await this._originValidation(e);const u=await kX(e,i,a,wV(),l);return YFe(u),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:u}=this.eventManagers[i];return l?Promise.resolve(l):(Jf(u,"If manager is not set, promise should be"),u)}const a=this.initAndGetManager(e);return this.eventManagers[i]={promise:a},a.catch(()=>{delete this.eventManagers[i]}),a}async initAndGetManager(e){const i=await xje(e),a=new yje(e);return i.register("authEvent",l=>(Wn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=i,a}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(oU,{type:oU},l=>{var u;const f=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[oU];f!==void 0&&i(!!f),rh(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=Tje(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return Fre()||Dre()||Yj()}}const Kje=$je;var NX="@firebase/auth",DX="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qje{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Wn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yje(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Xje(n){Ng(new Yf("auth",(e,{options:i})=>{const a=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:f,authDomain:_}=a.options;Wn(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const E={apiKey:f,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jre(n)},b=new uFe(a,l,u,E);return vFe(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,a)=>{e.getProvider("auth-internal").initialize()})),Ng(new Yf("auth-internal",e=>{const i=Gg(e.getProvider("auth").getImmediate());return(a=>new qje(a))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Qu(NX,DX,Yje(n)),Qu(NX,DX,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jje=5*60,Qje=gre("authIdTokenMaxAge")||Jje;let xX=null;const Zje=n=>async e=>{const i=e&&await e.getIdTokenResult(),a=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(a&&a>Qje)return;const l=i==null?void 0:i.token;xX!==l&&(xX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function XN(n=$N()){const e=dR(n,"auth");if(e.isInitialized())return e.getImmediate();const i=EFe(n,{popupRedirectResolver:Kje,persistence:[ije,$Fe,Zre]}),a=gre("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(a,location.origin);if(location.origin===u.origin){const f=Zje(u.toString());BFe(i,f,()=>f(i.currentUser)),jFe(i,_=>f(_))}}const l=fre("auth");return l&&SFe(i,`http://${l}`),i}function e4e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}dFe({loadJS(n){return new Promise((e,i)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=e,a.onerror=l=>{const u=Ep("internal-error");u.customData=l,i(u)},a.type="text/javascript",a.charset="UTF-8",e4e().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Xje("Browser");var LX=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ig,oie;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(Y,Z){function Q(){}Q.prototype=Z.prototype,Y.D=Z.prototype,Y.prototype=new Q,Y.prototype.constructor=Y,Y.C=function(ie,de,ue){for(var pe=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)pe[ke-2]=arguments[ke];return Z.prototype[de].apply(ie,pe)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Y,Z,Q){Q||(Q=0);var ie=Array(16);if(typeof Z=="string")for(var de=0;16>de;++de)ie[de]=Z.charCodeAt(Q++)|Z.charCodeAt(Q++)<<8|Z.charCodeAt(Q++)<<16|Z.charCodeAt(Q++)<<24;else for(de=0;16>de;++de)ie[de]=Z[Q++]|Z[Q++]<<8|Z[Q++]<<16|Z[Q++]<<24;Z=Y.g[0],Q=Y.g[1],de=Y.g[2];var ue=Y.g[3],pe=Z+(ue^Q&(de^ue))+ie[0]+3614090360&4294967295;Z=Q+(pe<<7&4294967295|pe>>>25),pe=ue+(de^Z&(Q^de))+ie[1]+3905402710&4294967295,ue=Z+(pe<<12&4294967295|pe>>>20),pe=de+(Q^ue&(Z^Q))+ie[2]+606105819&4294967295,de=ue+(pe<<17&4294967295|pe>>>15),pe=Q+(Z^de&(ue^Z))+ie[3]+3250441966&4294967295,Q=de+(pe<<22&4294967295|pe>>>10),pe=Z+(ue^Q&(de^ue))+ie[4]+4118548399&4294967295,Z=Q+(pe<<7&4294967295|pe>>>25),pe=ue+(de^Z&(Q^de))+ie[5]+1200080426&4294967295,ue=Z+(pe<<12&4294967295|pe>>>20),pe=de+(Q^ue&(Z^Q))+ie[6]+2821735955&4294967295,de=ue+(pe<<17&4294967295|pe>>>15),pe=Q+(Z^de&(ue^Z))+ie[7]+4249261313&4294967295,Q=de+(pe<<22&4294967295|pe>>>10),pe=Z+(ue^Q&(de^ue))+ie[8]+1770035416&4294967295,Z=Q+(pe<<7&4294967295|pe>>>25),pe=ue+(de^Z&(Q^de))+ie[9]+2336552879&4294967295,ue=Z+(pe<<12&4294967295|pe>>>20),pe=de+(Q^ue&(Z^Q))+ie[10]+4294925233&4294967295,de=ue+(pe<<17&4294967295|pe>>>15),pe=Q+(Z^de&(ue^Z))+ie[11]+2304563134&4294967295,Q=de+(pe<<22&4294967295|pe>>>10),pe=Z+(ue^Q&(de^ue))+ie[12]+1804603682&4294967295,Z=Q+(pe<<7&4294967295|pe>>>25),pe=ue+(de^Z&(Q^de))+ie[13]+4254626195&4294967295,ue=Z+(pe<<12&4294967295|pe>>>20),pe=de+(Q^ue&(Z^Q))+ie[14]+2792965006&4294967295,de=ue+(pe<<17&4294967295|pe>>>15),pe=Q+(Z^de&(ue^Z))+ie[15]+1236535329&4294967295,Q=de+(pe<<22&4294967295|pe>>>10),pe=Z+(de^ue&(Q^de))+ie[1]+4129170786&4294967295,Z=Q+(pe<<5&4294967295|pe>>>27),pe=ue+(Q^de&(Z^Q))+ie[6]+3225465664&4294967295,ue=Z+(pe<<9&4294967295|pe>>>23),pe=de+(Z^Q&(ue^Z))+ie[11]+643717713&4294967295,de=ue+(pe<<14&4294967295|pe>>>18),pe=Q+(ue^Z&(de^ue))+ie[0]+3921069994&4294967295,Q=de+(pe<<20&4294967295|pe>>>12),pe=Z+(de^ue&(Q^de))+ie[5]+3593408605&4294967295,Z=Q+(pe<<5&4294967295|pe>>>27),pe=ue+(Q^de&(Z^Q))+ie[10]+38016083&4294967295,ue=Z+(pe<<9&4294967295|pe>>>23),pe=de+(Z^Q&(ue^Z))+ie[15]+3634488961&4294967295,de=ue+(pe<<14&4294967295|pe>>>18),pe=Q+(ue^Z&(de^ue))+ie[4]+3889429448&4294967295,Q=de+(pe<<20&4294967295|pe>>>12),pe=Z+(de^ue&(Q^de))+ie[9]+568446438&4294967295,Z=Q+(pe<<5&4294967295|pe>>>27),pe=ue+(Q^de&(Z^Q))+ie[14]+3275163606&4294967295,ue=Z+(pe<<9&4294967295|pe>>>23),pe=de+(Z^Q&(ue^Z))+ie[3]+4107603335&4294967295,de=ue+(pe<<14&4294967295|pe>>>18),pe=Q+(ue^Z&(de^ue))+ie[8]+1163531501&4294967295,Q=de+(pe<<20&4294967295|pe>>>12),pe=Z+(de^ue&(Q^de))+ie[13]+2850285829&4294967295,Z=Q+(pe<<5&4294967295|pe>>>27),pe=ue+(Q^de&(Z^Q))+ie[2]+4243563512&4294967295,ue=Z+(pe<<9&4294967295|pe>>>23),pe=de+(Z^Q&(ue^Z))+ie[7]+1735328473&4294967295,de=ue+(pe<<14&4294967295|pe>>>18),pe=Q+(ue^Z&(de^ue))+ie[12]+2368359562&4294967295,Q=de+(pe<<20&4294967295|pe>>>12),pe=Z+(Q^de^ue)+ie[5]+4294588738&4294967295,Z=Q+(pe<<4&4294967295|pe>>>28),pe=ue+(Z^Q^de)+ie[8]+2272392833&4294967295,ue=Z+(pe<<11&4294967295|pe>>>21),pe=de+(ue^Z^Q)+ie[11]+1839030562&4294967295,de=ue+(pe<<16&4294967295|pe>>>16),pe=Q+(de^ue^Z)+ie[14]+4259657740&4294967295,Q=de+(pe<<23&4294967295|pe>>>9),pe=Z+(Q^de^ue)+ie[1]+2763975236&4294967295,Z=Q+(pe<<4&4294967295|pe>>>28),pe=ue+(Z^Q^de)+ie[4]+1272893353&4294967295,ue=Z+(pe<<11&4294967295|pe>>>21),pe=de+(ue^Z^Q)+ie[7]+4139469664&4294967295,de=ue+(pe<<16&4294967295|pe>>>16),pe=Q+(de^ue^Z)+ie[10]+3200236656&4294967295,Q=de+(pe<<23&4294967295|pe>>>9),pe=Z+(Q^de^ue)+ie[13]+681279174&4294967295,Z=Q+(pe<<4&4294967295|pe>>>28),pe=ue+(Z^Q^de)+ie[0]+3936430074&4294967295,ue=Z+(pe<<11&4294967295|pe>>>21),pe=de+(ue^Z^Q)+ie[3]+3572445317&4294967295,de=ue+(pe<<16&4294967295|pe>>>16),pe=Q+(de^ue^Z)+ie[6]+76029189&4294967295,Q=de+(pe<<23&4294967295|pe>>>9),pe=Z+(Q^de^ue)+ie[9]+3654602809&4294967295,Z=Q+(pe<<4&4294967295|pe>>>28),pe=ue+(Z^Q^de)+ie[12]+3873151461&4294967295,ue=Z+(pe<<11&4294967295|pe>>>21),pe=de+(ue^Z^Q)+ie[15]+530742520&4294967295,de=ue+(pe<<16&4294967295|pe>>>16),pe=Q+(de^ue^Z)+ie[2]+3299628645&4294967295,Q=de+(pe<<23&4294967295|pe>>>9),pe=Z+(de^(Q|~ue))+ie[0]+4096336452&4294967295,Z=Q+(pe<<6&4294967295|pe>>>26),pe=ue+(Q^(Z|~de))+ie[7]+1126891415&4294967295,ue=Z+(pe<<10&4294967295|pe>>>22),pe=de+(Z^(ue|~Q))+ie[14]+2878612391&4294967295,de=ue+(pe<<15&4294967295|pe>>>17),pe=Q+(ue^(de|~Z))+ie[5]+4237533241&4294967295,Q=de+(pe<<21&4294967295|pe>>>11),pe=Z+(de^(Q|~ue))+ie[12]+1700485571&4294967295,Z=Q+(pe<<6&4294967295|pe>>>26),pe=ue+(Q^(Z|~de))+ie[3]+2399980690&4294967295,ue=Z+(pe<<10&4294967295|pe>>>22),pe=de+(Z^(ue|~Q))+ie[10]+4293915773&4294967295,de=ue+(pe<<15&4294967295|pe>>>17),pe=Q+(ue^(de|~Z))+ie[1]+2240044497&4294967295,Q=de+(pe<<21&4294967295|pe>>>11),pe=Z+(de^(Q|~ue))+ie[8]+1873313359&4294967295,Z=Q+(pe<<6&4294967295|pe>>>26),pe=ue+(Q^(Z|~de))+ie[15]+4264355552&4294967295,ue=Z+(pe<<10&4294967295|pe>>>22),pe=de+(Z^(ue|~Q))+ie[6]+2734768916&4294967295,de=ue+(pe<<15&4294967295|pe>>>17),pe=Q+(ue^(de|~Z))+ie[13]+1309151649&4294967295,Q=de+(pe<<21&4294967295|pe>>>11),pe=Z+(de^(Q|~ue))+ie[4]+4149444226&4294967295,Z=Q+(pe<<6&4294967295|pe>>>26),pe=ue+(Q^(Z|~de))+ie[11]+3174756917&4294967295,ue=Z+(pe<<10&4294967295|pe>>>22),pe=de+(Z^(ue|~Q))+ie[2]+718787259&4294967295,de=ue+(pe<<15&4294967295|pe>>>17),pe=Q+(ue^(de|~Z))+ie[9]+3951481745&4294967295,Y.g[0]=Y.g[0]+Z&4294967295,Y.g[1]=Y.g[1]+(de+(pe<<21&4294967295|pe>>>11))&4294967295,Y.g[2]=Y.g[2]+de&4294967295,Y.g[3]=Y.g[3]+ue&4294967295}a.prototype.u=function(Y,Z){Z===void 0&&(Z=Y.length);for(var Q=Z-this.blockSize,ie=this.B,de=this.h,ue=0;ue<Z;){if(de==0)for(;ue<=Q;)l(this,Y,ue),ue+=this.blockSize;if(typeof Y=="string"){for(;ue<Z;)if(ie[de++]=Y.charCodeAt(ue++),de==this.blockSize){l(this,ie),de=0;break}}else for(;ue<Z;)if(ie[de++]=Y[ue++],de==this.blockSize){l(this,ie),de=0;break}}this.h=de,this.o+=Z},a.prototype.v=function(){var Y=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Y[0]=128;for(var Z=1;Z<Y.length-8;++Z)Y[Z]=0;var Q=8*this.o;for(Z=Y.length-8;Z<Y.length;++Z)Y[Z]=Q&255,Q/=256;for(this.u(Y),Y=Array(16),Z=Q=0;4>Z;++Z)for(var ie=0;32>ie;ie+=8)Y[Q++]=this.g[Z]>>>ie&255;return Y};function u(Y,Z){var Q=_;return Object.prototype.hasOwnProperty.call(Q,Y)?Q[Y]:Q[Y]=Z(Y)}function f(Y,Z){this.h=Z;for(var Q=[],ie=!0,de=Y.length-1;0<=de;de--){var ue=Y[de]|0;ie&&ue==Z||(Q[de]=ue,ie=!1)}this.g=Q}var _={};function E(Y){return-128<=Y&&128>Y?u(Y,function(Z){return new f([Z|0],0>Z?-1:0)}):new f([Y|0],0>Y?-1:0)}function b(Y){if(isNaN(Y)||!isFinite(Y))return I;if(0>Y)return z(b(-Y));for(var Z=[],Q=1,ie=0;Y>=Q;ie++)Z[ie]=Y/Q|0,Q*=4294967296;return new f(Z,0)}function C(Y,Z){if(Y.length==0)throw Error("number format error: empty string");if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(Y.charAt(0)=="-")return z(C(Y.substring(1),Z));if(0<=Y.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=b(Math.pow(Z,8)),ie=I,de=0;de<Y.length;de+=8){var ue=Math.min(8,Y.length-de),pe=parseInt(Y.substring(de,de+ue),Z);8>ue?(ue=b(Math.pow(Z,ue)),ie=ie.j(ue).add(b(pe))):(ie=ie.j(Q),ie=ie.add(b(pe)))}return ie}var I=E(0),O=E(1),L=E(16777216);n=f.prototype,n.m=function(){if(F(this))return-z(this).m();for(var Y=0,Z=1,Q=0;Q<this.g.length;Q++){var ie=this.i(Q);Y+=(0<=ie?ie:4294967296+ie)*Z,Z*=4294967296}return Y},n.toString=function(Y){if(Y=Y||10,2>Y||36<Y)throw Error("radix out of range: "+Y);if(M(this))return"0";if(F(this))return"-"+z(this).toString(Y);for(var Z=b(Math.pow(Y,6)),Q=this,ie="";;){var de=oe(Q,Z).g;Q=X(Q,de.j(Z));var ue=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(Y);if(Q=de,M(Q))return ue+ie;for(;6>ue.length;)ue="0"+ue;ie=ue+ie}},n.i=function(Y){return 0>Y?0:Y<this.g.length?this.g[Y]:this.h};function M(Y){if(Y.h!=0)return!1;for(var Z=0;Z<Y.g.length;Z++)if(Y.g[Z]!=0)return!1;return!0}function F(Y){return Y.h==-1}n.l=function(Y){return Y=X(this,Y),F(Y)?-1:M(Y)?0:1};function z(Y){for(var Z=Y.g.length,Q=[],ie=0;ie<Z;ie++)Q[ie]=~Y.g[ie];return new f(Q,~Y.h).add(O)}n.abs=function(){return F(this)?z(this):this},n.add=function(Y){for(var Z=Math.max(this.g.length,Y.g.length),Q=[],ie=0,de=0;de<=Z;de++){var ue=ie+(this.i(de)&65535)+(Y.i(de)&65535),pe=(ue>>>16)+(this.i(de)>>>16)+(Y.i(de)>>>16);ie=pe>>>16,ue&=65535,pe&=65535,Q[de]=pe<<16|ue}return new f(Q,Q[Q.length-1]&-2147483648?-1:0)};function X(Y,Z){return Y.add(z(Z))}n.j=function(Y){if(M(this)||M(Y))return I;if(F(this))return F(Y)?z(this).j(z(Y)):z(z(this).j(Y));if(F(Y))return z(this.j(z(Y)));if(0>this.l(L)&&0>Y.l(L))return b(this.m()*Y.m());for(var Z=this.g.length+Y.g.length,Q=[],ie=0;ie<2*Z;ie++)Q[ie]=0;for(ie=0;ie<this.g.length;ie++)for(var de=0;de<Y.g.length;de++){var ue=this.i(ie)>>>16,pe=this.i(ie)&65535,ke=Y.i(de)>>>16,xe=Y.i(de)&65535;Q[2*ie+2*de]+=pe*xe,K(Q,2*ie+2*de),Q[2*ie+2*de+1]+=ue*xe,K(Q,2*ie+2*de+1),Q[2*ie+2*de+1]+=pe*ke,K(Q,2*ie+2*de+1),Q[2*ie+2*de+2]+=ue*ke,K(Q,2*ie+2*de+2)}for(ie=0;ie<Z;ie++)Q[ie]=Q[2*ie+1]<<16|Q[2*ie];for(ie=Z;ie<2*Z;ie++)Q[ie]=0;return new f(Q,0)};function K(Y,Z){for(;(Y[Z]&65535)!=Y[Z];)Y[Z+1]+=Y[Z]>>>16,Y[Z]&=65535,Z++}function ne(Y,Z){this.g=Y,this.h=Z}function oe(Y,Z){if(M(Z))throw Error("division by zero");if(M(Y))return new ne(I,I);if(F(Y))return Z=oe(z(Y),Z),new ne(z(Z.g),z(Z.h));if(F(Z))return Z=oe(Y,z(Z)),new ne(z(Z.g),Z.h);if(30<Y.g.length){if(F(Y)||F(Z))throw Error("slowDivide_ only works with positive integers.");for(var Q=O,ie=Z;0>=ie.l(Y);)Q=ae(Q),ie=ae(ie);var de=le(Q,1),ue=le(ie,1);for(ie=le(ie,2),Q=le(Q,2);!M(ie);){var pe=ue.add(ie);0>=pe.l(Y)&&(de=de.add(Q),ue=pe),ie=le(ie,1),Q=le(Q,1)}return Z=X(Y,de.j(Z)),new ne(de,Z)}for(de=I;0<=Y.l(Z);){for(Q=Math.max(1,Math.floor(Y.m()/Z.m())),ie=Math.ceil(Math.log(Q)/Math.LN2),ie=48>=ie?1:Math.pow(2,ie-48),ue=b(Q),pe=ue.j(Z);F(pe)||0<pe.l(Y);)Q-=ie,ue=b(Q),pe=ue.j(Z);M(ue)&&(ue=O),de=de.add(ue),Y=X(Y,pe)}return new ne(de,Y)}n.A=function(Y){return oe(this,Y).h},n.and=function(Y){for(var Z=Math.max(this.g.length,Y.g.length),Q=[],ie=0;ie<Z;ie++)Q[ie]=this.i(ie)&Y.i(ie);return new f(Q,this.h&Y.h)},n.or=function(Y){for(var Z=Math.max(this.g.length,Y.g.length),Q=[],ie=0;ie<Z;ie++)Q[ie]=this.i(ie)|Y.i(ie);return new f(Q,this.h|Y.h)},n.xor=function(Y){for(var Z=Math.max(this.g.length,Y.g.length),Q=[],ie=0;ie<Z;ie++)Q[ie]=this.i(ie)^Y.i(ie);return new f(Q,this.h^Y.h)};function ae(Y){for(var Z=Y.g.length+1,Q=[],ie=0;ie<Z;ie++)Q[ie]=Y.i(ie)<<1|Y.i(ie-1)>>>31;return new f(Q,Y.h)}function le(Y,Z){var Q=Z>>5;Z%=32;for(var ie=Y.g.length-Q,de=[],ue=0;ue<ie;ue++)de[ue]=0<Z?Y.i(ue+Q)>>>Z|Y.i(ue+Q+1)<<32-Z:Y.i(ue+Q);return new f(de,Y.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,oie=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=C,Ig=f}).apply(typeof LX<"u"?LX:typeof self<"u"?self:typeof window<"u"?window:{});var kO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var aie,Gw,cie,hk,IV,lie,uie,die;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,W,re){return A==Array.prototype||A==Object.prototype||(A[W]=re.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof kO=="object"&&kO];for(var W=0;W<A.length;++W){var re=A[W];if(re&&re.Math==Math)return re}throw Error("Cannot find global object")}var a=i(this);function l(A,W){if(W)e:{var re=a;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var Xe=A[ge];if(!(Xe in re))break e;re=re[Xe]}A=A[A.length-1],ge=re[A],W=W(ge),W!=ge&&W!=null&&e(re,A,{configurable:!0,writable:!0,value:W})}}function u(A,W){A instanceof String&&(A+="");var re=0,ge=!1,Xe={next:function(){if(!ge&&re<A.length){var lt=re++;return{value:W(lt,A[lt]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return Xe[Symbol.iterator]=function(){return Xe},Xe}l("Array.prototype.values",function(A){return A||function(){return u(this,function(W,re){return re})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},_=this||self;function E(A){var W=typeof A;return W=W!="object"?W:A?Array.isArray(A)?"array":W:"null",W=="array"||W=="object"&&typeof A.length=="number"}function b(A){var W=typeof A;return W=="object"&&A!=null||W=="function"}function C(A,W,re){return A.call.apply(A.bind,arguments)}function I(A,W,re){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var Xe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Xe,ge),A.apply(W,Xe)}}return function(){return A.apply(W,arguments)}}function O(A,W,re){return O=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:I,O.apply(null,arguments)}function L(A,W){var re=Array.prototype.slice.call(arguments,1);return function(){var ge=re.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function M(A,W){function re(){}re.prototype=W.prototype,A.aa=W.prototype,A.prototype=new re,A.prototype.constructor=A,A.Qb=function(ge,Xe,lt){for(var Gt=Array(arguments.length-2),ti=2;ti<arguments.length;ti++)Gt[ti-2]=arguments[ti];return W.prototype[Xe].apply(ge,Gt)}}function F(A){const W=A.length;if(0<W){const re=Array(W);for(let ge=0;ge<W;ge++)re[ge]=A[ge];return re}return[]}function z(A,W){for(let re=1;re<arguments.length;re++){const ge=arguments[re];if(E(ge)){const Xe=A.length||0,lt=ge.length||0;A.length=Xe+lt;for(let Gt=0;Gt<lt;Gt++)A[Xe+Gt]=ge[Gt]}else A.push(ge)}}class X{constructor(W,re){this.i=W,this.j=re,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function K(A){return/^[\s\xa0]*$/.test(A)}function ne(){var A=_.navigator;return A&&(A=A.userAgent)?A:""}function oe(A){return oe[" "](A),A}oe[" "]=function(){};var ae=ne().indexOf("Gecko")!=-1&&!(ne().toLowerCase().indexOf("webkit")!=-1&&ne().indexOf("Edge")==-1)&&!(ne().indexOf("Trident")!=-1||ne().indexOf("MSIE")!=-1)&&ne().indexOf("Edge")==-1;function le(A,W,re){for(const ge in A)W.call(re,A[ge],ge,A)}function Y(A,W){for(const re in A)W.call(void 0,A[re],re,A)}function Z(A){const W={};for(const re in A)W[re]=A[re];return W}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(A,W){let re,ge;for(let Xe=1;Xe<arguments.length;Xe++){ge=arguments[Xe];for(re in ge)A[re]=ge[re];for(let lt=0;lt<Q.length;lt++)re=Q[lt],Object.prototype.hasOwnProperty.call(ge,re)&&(A[re]=ge[re])}}function de(A){var W=1;A=A.split(":");const re=[];for(;0<W&&A.length;)re.push(A.shift()),W--;return A.length&&re.push(A.join(":")),re}function ue(A){_.setTimeout(()=>{throw A},0)}function pe(){var A=Se;let W=null;return A.g&&(W=A.g,A.g=A.g.next,A.g||(A.h=null),W.next=null),W}class ke{constructor(){this.h=this.g=null}add(W,re){const ge=xe.get();ge.set(W,re),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var xe=new X(()=>new Fe,A=>A.reset());class Fe{constructor(){this.next=this.g=this.h=null}set(W,re){this.h=W,this.g=re,this.next=null}reset(){this.next=this.g=this.h=null}}let Oe,we=!1,Se=new ke,Be=()=>{const A=_.Promise.resolve(void 0);Oe=()=>{A.then(Ee)}};var Ee=()=>{for(var A;A=pe();){try{A.h.call(A.g)}catch(re){ue(re)}var W=xe;W.j(A),100>W.h&&(W.h++,A.next=W.g,W.g=A)}we=!1};function Ce(){this.s=this.s,this.C=this.C}Ce.prototype.s=!1,Ce.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ce.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Pe(A,W){this.type=A,this.g=this.target=W,this.defaultPrevented=!1}Pe.prototype.h=function(){this.defaultPrevented=!0};var Me=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var A=!1,W=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const re=()=>{};_.addEventListener("test",re,W),_.removeEventListener("test",re,W)}catch{}return A}();function ze(A,W){if(Pe.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var re=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=W,W=A.relatedTarget){if(ae){e:{try{oe(W.nodeName);var Xe=!0;break e}catch{}Xe=!1}Xe||(W=null)}}else re=="mouseover"?W=A.fromElement:re=="mouseout"&&(W=A.toElement);this.relatedTarget=W,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:He[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&ze.aa.h.call(this)}}M(ze,Pe);var He={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var qe="closure_listenable_"+(1e6*Math.random()|0),nt=0;function Ze(A,W,re,ge,Xe){this.listener=A,this.proxy=null,this.src=W,this.type=re,this.capture=!!ge,this.ha=Xe,this.key=++nt,this.da=this.fa=!1}function gt(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function sn(A){this.src=A,this.g={},this.h=0}sn.prototype.add=function(A,W,re,ge,Xe){var lt=A.toString();A=this.g[lt],A||(A=this.g[lt]=[],this.h++);var Gt=kt(A,W,ge,Xe);return-1<Gt?(W=A[Gt],re||(W.fa=!1)):(W=new Ze(W,this.src,lt,!!ge,Xe),W.fa=re,A.push(W)),W};function ut(A,W){var re=W.type;if(re in A.g){var ge=A.g[re],Xe=Array.prototype.indexOf.call(ge,W,void 0),lt;(lt=0<=Xe)&&Array.prototype.splice.call(ge,Xe,1),lt&&(gt(W),A.g[re].length==0&&(delete A.g[re],A.h--))}}function kt(A,W,re,ge){for(var Xe=0;Xe<A.length;++Xe){var lt=A[Xe];if(!lt.da&&lt.listener==W&&lt.capture==!!re&&lt.ha==ge)return Xe}return-1}var ct="closure_lm_"+(1e6*Math.random()|0),Mt={};function fn(A,W,re,ge,Xe){if(Array.isArray(W)){for(var lt=0;lt<W.length;lt++)fn(A,W[lt],re,ge,Xe);return null}return re=dn(re),A&&A[qe]?A.K(W,re,b(ge)?!!ge.capture:!1,Xe):zt(A,W,re,!1,ge,Xe)}function zt(A,W,re,ge,Xe,lt){if(!W)throw Error("Invalid event type");var Gt=b(Xe)?!!Xe.capture:!!Xe,ti=St(A);if(ti||(A[ct]=ti=new sn(A)),re=ti.add(W,re,ge,Gt,lt),re.proxy)return re;if(ge=Te(),re.proxy=ge,ge.src=A,ge.listener=re,A.addEventListener)Me||(Xe=Gt),Xe===void 0&&(Xe=!1),A.addEventListener(W.toString(),ge,Xe);else if(A.attachEvent)A.attachEvent(Et(W.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return re}function Te(){function A(re){return W.call(A.src,A.listener,re)}const W=vt;return A}function Ve(A,W,re,ge,Xe){if(Array.isArray(W))for(var lt=0;lt<W.length;lt++)Ve(A,W[lt],re,ge,Xe);else ge=b(ge)?!!ge.capture:!!ge,re=dn(re),A&&A[qe]?(A=A.i,W=String(W).toString(),W in A.g&&(lt=A.g[W],re=kt(lt,re,ge,Xe),-1<re&&(gt(lt[re]),Array.prototype.splice.call(lt,re,1),lt.length==0&&(delete A.g[W],A.h--)))):A&&(A=St(A))&&(W=A.g[W.toString()],A=-1,W&&(A=kt(W,re,ge,Xe)),(re=-1<A?W[A]:null)&&$e(re))}function $e(A){if(typeof A!="number"&&A&&!A.da){var W=A.src;if(W&&W[qe])ut(W.i,A);else{var re=A.type,ge=A.proxy;W.removeEventListener?W.removeEventListener(re,ge,A.capture):W.detachEvent?W.detachEvent(Et(re),ge):W.addListener&&W.removeListener&&W.removeListener(ge),(re=St(W))?(ut(re,A),re.h==0&&(re.src=null,W[ct]=null)):gt(A)}}}function Et(A){return A in Mt?Mt[A]:Mt[A]="on"+A}function vt(A,W){if(A.da)A=!0;else{W=new ze(W,this);var re=A.listener,ge=A.ha||A.src;A.fa&&$e(A),A=re.call(ge,W)}return A}function St(A){return A=A[ct],A instanceof sn?A:null}var Wt="__closure_events_fn_"+(1e9*Math.random()>>>0);function dn(A){return typeof A=="function"?A:(A[Wt]||(A[Wt]=function(W){return A.handleEvent(W)}),A[Wt])}function En(){Ce.call(this),this.i=new sn(this),this.M=this,this.F=null}M(En,Ce),En.prototype[qe]=!0,En.prototype.removeEventListener=function(A,W,re,ge){Ve(this,A,W,re,ge)};function tn(A,W){var re,ge=A.F;if(ge)for(re=[];ge;ge=ge.F)re.push(ge);if(A=A.M,ge=W.type||W,typeof W=="string")W=new Pe(W,A);else if(W instanceof Pe)W.target=W.target||A;else{var Xe=W;W=new Pe(ge,A),ie(W,Xe)}if(Xe=!0,re)for(var lt=re.length-1;0<=lt;lt--){var Gt=W.g=re[lt];Xe=wt(Gt,ge,!0,W)&&Xe}if(Gt=W.g=A,Xe=wt(Gt,ge,!0,W)&&Xe,Xe=wt(Gt,ge,!1,W)&&Xe,re)for(lt=0;lt<re.length;lt++)Gt=W.g=re[lt],Xe=wt(Gt,ge,!1,W)&&Xe}En.prototype.N=function(){if(En.aa.N.call(this),this.i){var A=this.i,W;for(W in A.g){for(var re=A.g[W],ge=0;ge<re.length;ge++)gt(re[ge]);delete A.g[W],A.h--}}this.F=null},En.prototype.K=function(A,W,re,ge){return this.i.add(String(A),W,!1,re,ge)},En.prototype.L=function(A,W,re,ge){return this.i.add(String(A),W,!0,re,ge)};function wt(A,W,re,ge){if(W=A.i.g[String(W)],!W)return!0;W=W.concat();for(var Xe=!0,lt=0;lt<W.length;++lt){var Gt=W[lt];if(Gt&&!Gt.da&&Gt.capture==re){var ti=Gt.listener,gi=Gt.ha||Gt.src;Gt.fa&&ut(A.i,Gt),Xe=ti.call(gi,ge)!==!1&&Xe}}return Xe&&!ge.defaultPrevented}function sr(A,W,re){if(typeof A=="function")re&&(A=O(A,re));else if(A&&typeof A.handleEvent=="function")A=O(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:_.setTimeout(A,W||0)}function xt(A){A.g=sr(()=>{A.g=null,A.i&&(A.i=!1,xt(A))},A.l);const W=A.h;A.h=null,A.m.apply(null,W)}class qt extends Ce{constructor(W,re){super(),this.m=W,this.l=re,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:xt(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function br(A){Ce.call(this),this.h=A,this.g={}}M(br,Ce);var wi=[];function Cs(A){le(A.g,function(W,re){this.g.hasOwnProperty(re)&&$e(W)},A),A.g={}}br.prototype.N=function(){br.aa.N.call(this),Cs(this)},br.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cr=_.JSON.stringify,zn=_.JSON.parse,ra=class{stringify(A){return _.JSON.stringify(A,void 0)}parse(A){return _.JSON.parse(A,void 0)}};function Hs(){}Hs.prototype.h=null;function io(A){return A.h||(A.h=A.i())}function Vc(){}var Rs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ma(){Pe.call(this,"d")}M(Ma,Pe);function Fo(){Pe.call(this,"c")}M(Fo,Pe);var Ua={},hc=null;function Rl(){return hc=hc||new En}Ua.La="serverreachability";function Va(A){Pe.call(this,Ua.La,A)}M(Va,Pe);function pc(A){const W=Rl();tn(W,new Va(W))}Ua.STAT_EVENT="statevent";function mo(A,W){Pe.call(this,Ua.STAT_EVENT,A),this.stat=W}M(mo,Pe);function Di(A){const W=Rl();tn(W,new mo(W,A))}Ua.Ma="timingevent";function os(A,W){Pe.call(this,Ua.Ma,A),this.size=W}M(os,Pe);function ia(A,W){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){A()},W)}function Il(){this.g=!0}Il.prototype.xa=function(){this.g=!1};function Fa(A,W,re,ge,Xe,lt){A.info(function(){if(A.g)if(lt)for(var Gt="",ti=lt.split("&"),gi=0;gi<ti.length;gi++){var kr=ti[gi].split("=");if(1<kr.length){var so=kr[0];kr=kr[1];var As=so.split("_");Gt=2<=As.length&&As[1]=="type"?Gt+(so+"="+kr+"&"):Gt+(so+"=redacted&")}}else Gt=null;else Gt=lt;return"XMLHTTP REQ ("+ge+") [attempt "+Xe+"]: "+W+`
`+re+`
`+Gt})}function jo(A,W,re,ge,Xe,lt,Gt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+Xe+"]: "+W+`
`+re+`
`+lt+" "+Gt})}function ft(A,W,re,ge){A.info(function(){return"XMLHTTP TEXT ("+W+"): "+Pr(A,re)+(ge?" "+ge:"")})}function hn(A,W){A.info(function(){return"TIMEOUT: "+W})}Il.prototype.info=function(){};function Pr(A,W){if(!A.g)return W;if(!W)return null;try{var re=JSON.parse(W);if(re){for(A=0;A<re.length;A++)if(Array.isArray(re[A])){var ge=re[A];if(!(2>ge.length)){var Xe=ge[1];if(Array.isArray(Xe)&&!(1>Xe.length)){var lt=Xe[0];if(lt!="noop"&&lt!="stop"&&lt!="close")for(var Gt=1;Gt<Xe.length;Gt++)Xe[Gt]=""}}}}return cr(re)}catch{return W}}var Ci={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Al={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},$i;function Pl(){}M(Pl,Hs),Pl.prototype.g=function(){return new XMLHttpRequest},Pl.prototype.i=function(){return{}},$i=new Pl;function Bo(A,W,re,ge){this.j=A,this.i=W,this.l=re,this.R=ge||1,this.U=new br(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new cu}function cu(){this.i=null,this.g="",this.h=!1}var Ol={},sa={};function lu(A,W,re){A.L=1,A.v=gc(oa(W)),A.m=re,A.P=!0,fc(A,null)}function fc(A,W){A.F=Date.now(),vn(A),A.A=oa(A.v);var re=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),mu(re.i,"t",ge),A.C=0,re=A.j.J,A.h=new cu,A.g=aE(A.j,re?W:null,!A.m),0<A.O&&(A.M=new qt(O(A.Y,A,A.g),A.O)),W=A.U,re=A.g,ge=A.ca;var Xe="readystatechange";Array.isArray(Xe)||(Xe&&(wi[0]=Xe.toString()),Xe=wi);for(var lt=0;lt<Xe.length;lt++){var Gt=fn(re,Xe[lt],ge||W.handleEvent,!1,W.h||W);if(!Gt)break;W.g[Gt.key]=Gt}W=A.H?Z(A.H):{},A.m?(A.u||(A.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,W)):(A.u="GET",A.g.ea(A.A,A.u,null,W)),pc(),Fa(A.i,A.u,A.A,A.l,A.R,A.m)}Bo.prototype.ca=function(A){A=A.target;const W=this.M;W&&Ii(A)==3?W.j():this.Y(A)},Bo.prototype.Y=function(A){try{if(A==this.g)e:{const As=Ii(this.g);var W=this.g.Ba();const _c=this.g.Z();if(!(3>As)&&(As!=3||this.g&&(this.h.h||this.g.oa()||$s(this.g)))){this.J||As!=4||W==7||(W==8||0>=_c?pc(3):pc(2)),Fc(this);var re=this.g.Z();this.X=re;t:if(xi(this)){var ge=$s(this.g);A="";var Xe=ge.length,lt=Ii(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ja(this),kl(this);var Gt="";break t}this.h.i=new _.TextDecoder}for(W=0;W<Xe;W++)this.h.h=!0,A+=this.h.i.decode(ge[W],{stream:!(lt&&W==Xe-1)});ge.length=0,this.h.g+=A,this.C=0,Gt=this.h.g}else Gt=this.g.oa();if(this.o=re==200,jo(this.i,this.u,this.A,this.l,this.R,As,re),this.o){if(this.T&&!this.K){t:{if(this.g){var ti,gi=this.g;if((ti=gi.g?gi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(ti)){var kr=ti;break t}}kr=null}if(re=kr)ft(this.i,this.l,re,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Rp(this,re);else{this.o=!1,this.s=3,Di(12),ja(this),kl(this);break e}}if(this.P){re=!0;let ga;for(;!this.J&&this.C<Gt.length;)if(ga=as(this,Gt),ga==sa){As==4&&(this.s=4,Di(14),re=!1),ft(this.i,this.l,null,"[Incomplete Response]");break}else if(ga==Ol){this.s=4,Di(15),ft(this.i,this.l,Gt,"[Invalid Chunk]"),re=!1;break}else ft(this.i,this.l,ga,null),Rp(this,ga);if(xi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),As!=4||Gt.length!=0||this.h.h||(this.s=1,Di(16),re=!1),this.o=this.o&&re,!re)ft(this.i,this.l,Gt,"[Invalid Chunked Response]"),ja(this),kl(this);else if(0<Gt.length&&!this.W){this.W=!0;var so=this.j;so.g==this&&so.ba&&!so.M&&(so.j.info("Great, no buffering proxy detected. Bytes received: "+Gt.length),qg(so),so.M=!0,Di(11))}}else ft(this.i,this.l,Gt,null),Rp(this,Gt);As==4&&ja(this),this.o&&!this.J&&(As==4?dm(this.j,this):(this.o=!1,vn(this)))}else ha(this.g),re==400&&0<Gt.indexOf("Unknown SID")?(this.s=3,Di(12)):(this.s=0,Di(13)),ja(this),kl(this)}}}catch{}finally{}};function xi(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function as(A,W){var re=A.C,ge=W.indexOf(`
`,re);return ge==-1?sa:(re=Number(W.substring(re,ge)),isNaN(re)?Ol:(ge+=1,ge+re>W.length?sa:(W=W.slice(ge,ge+re),A.C=ge+re,W)))}Bo.prototype.cancel=function(){this.J=!0,ja(this)};function vn(A){A.S=Date.now()+A.I,Ri(A,A.I)}function Ri(A,W){if(A.B!=null)throw Error("WatchDog timer not null");A.B=ia(O(A.ba,A),W)}function Fc(A){A.B&&(_.clearTimeout(A.B),A.B=null)}Bo.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(hn(this.i,this.A),this.L!=2&&(pc(),Di(17)),ja(this),this.s=2,kl(this)):Ri(this,this.S-A)};function kl(A){A.j.G==0||A.J||dm(A.j,A)}function ja(A){Fc(A);var W=A.M;W&&typeof W.ma=="function"&&W.ma(),A.M=null,Cs(A.U),A.g&&(W=A.g,A.g=null,W.abort(),W.ma())}function Rp(A,W){try{var re=A.j;if(re.G!=0&&(re.g==A||go(re.h,A))){if(!A.K&&go(re.h,A)&&re.G==3){try{var ge=re.Da.g.parse(W)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var Xe=ge;if(Xe[0]==0){e:if(!re.u){if(re.g)if(re.g.F+3e3<A.F)um(re),Ml(re);else break e;lm(re),Di(18)}}else re.za=Xe[1],0<re.za-re.T&&37500>Xe[2]&&re.F&&re.v==0&&!re.C&&(re.C=ia(O(re.Za,re),6e3));if(1>=rm(re.h)&&re.ca){try{re.ca()}catch{}re.ca=void 0}}else pd(re,11)}else if((A.K||re.g==A)&&um(re),!K(W))for(Xe=re.Da.g.parse(W),W=0;W<Xe.length;W++){let kr=Xe[W];if(re.T=kr[0],kr=kr[1],re.G==2)if(kr[0]=="c"){re.K=kr[1],re.ia=kr[2];const so=kr[3];so!=null&&(re.la=so,re.j.info("VER="+re.la));const As=kr[4];As!=null&&(re.Aa=As,re.j.info("SVER="+re.Aa));const _c=kr[5];_c!=null&&typeof _c=="number"&&0<_c&&(ge=1.5*_c,re.L=ge,re.j.info("backChannelRequestTimeoutMs_="+ge)),ge=re;const ga=A.g;if(ga){const kp=ga.g?ga.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(kp){var lt=ge.h;lt.g||kp.indexOf("spdy")==-1&&kp.indexOf("quic")==-1&&kp.indexOf("h2")==-1||(lt.j=lt.l,lt.g=new Set,lt.h&&(Ip(lt,lt.h),lt.h=null))}if(ge.D){const pm=ga.g?ga.g.getResponseHeader("X-HTTP-Session-Id"):null;pm&&(ge.ya=pm,ei(ge.I,ge.D,pm))}}re.G=3,re.l&&re.l.ua(),re.ba&&(re.R=Date.now()-A.F,re.j.info("Handshake RTT: "+re.R+"ms")),ge=re;var Gt=A;if(ge.qa=Yg(ge,ge.J?ge.ia:null,ge.W),Gt.K){Nl(ge.h,Gt);var ti=Gt,gi=ge.L;gi&&(ti.I=gi),ti.B&&(Fc(ti),vn(ti)),ge.g=Gt}else _u(ge);0<re.i.length&&zc(re)}else kr[0]!="stop"&&kr[0]!="close"||pd(re,7);else re.G==3&&(kr[0]=="stop"||kr[0]=="close"?kr[0]=="stop"?pd(re,7):cs(re):kr[0]!="noop"&&re.l&&re.l.ta(kr),re.v=0)}}pc(4)}catch{}}var lh=class{constructor(A,W){this.g=A,this.map=W}};function uu(A){this.l=A||10,_.PerformanceNavigationTiming?(A=_.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function zo(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function rm(A){return A.h?1:A.g?A.g.size:0}function go(A,W){return A.h?A.h==W:A.g?A.g.has(W):!1}function Ip(A,W){A.g?A.g.add(W):A.h=W}function Nl(A,W){A.h&&A.h==W?A.h=null:A.g&&A.g.has(W)&&A.g.delete(W)}uu.prototype.cancel=function(){if(this.i=uh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function uh(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let W=A.i;for(const re of A.g.values())W=W.concat(re.D);return W}return F(A.i)}function dh(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(E(A)){for(var W=[],re=A.length,ge=0;ge<re;ge++)W.push(A[ge]);return W}W=[],re=0;for(ge in A)W[re++]=A[ge];return W}function Tr(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(E(A)||typeof A=="string"){var W=[];A=A.length;for(var re=0;re<A;re++)W.push(re);return W}W=[],re=0;for(const ge in A)W[re++]=ge;return W}}}function du(A,W){if(A.forEach&&typeof A.forEach=="function")A.forEach(W,void 0);else if(E(A)||typeof A=="string")Array.prototype.forEach.call(A,W,void 0);else for(var re=Tr(A),ge=dh(A),Xe=ge.length,lt=0;lt<Xe;lt++)W.call(void 0,ge[lt],re&&re[lt],A)}var hu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ad(A,W){if(A){A=A.split("&");for(var re=0;re<A.length;re++){var ge=A[re].indexOf("="),Xe=null;if(0<=ge){var lt=A[re].substring(0,ge);Xe=A[re].substring(ge+1)}else lt=A[re];W(lt,Xe?decodeURIComponent(Xe.replace(/\+/g," ")):"")}}}function mc(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof mc){this.h=A.h,cd(this,A.j),this.o=A.o,this.g=A.g,Dl(this,A.s),this.l=A.l;var W=A.i,re=new aa;re.i=W.i,W.g&&(re.g=new Map(W.g),re.h=W.h),pu(this,re),this.m=A.m}else A&&(W=String(A).match(hu))?(this.h=!1,cd(this,W[1]||"",!0),this.o=pr(W[2]||""),this.g=pr(W[3]||"",!0),Dl(this,W[4]),this.l=pr(W[5]||"",!0),pu(this,W[6]||"",!0),this.m=pr(W[7]||"")):(this.h=!1,this.i=new aa(null,this.h))}mc.prototype.toString=function(){var A=[],W=this.j;W&&A.push(jc(W,fu,!0),":");var re=this.g;return(re||W=="file")&&(A.push("//"),(W=this.o)&&A.push(jc(W,fu,!0),"@"),A.push(encodeURIComponent(String(re)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),re=this.s,re!=null&&A.push(":",String(re))),(re=this.l)&&(this.g&&re.charAt(0)!="/"&&A.push("/"),A.push(jc(re,re.charAt(0)=="/"?Ap:hh,!0))),(re=this.i.toString())&&A.push("?",re),(re=this.m)&&A.push("#",jc(re,Pp)),A.join("")};function oa(A){return new mc(A)}function cd(A,W,re){A.j=re?pr(W,!0):W,A.j&&(A.j=A.j.replace(/:$/,""))}function Dl(A,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);A.s=W}else A.s=null}function pu(A,W,re){W instanceof aa?(A.i=W,da(A.i,A.h)):(re||(W=jc(W,sm)),A.i=new aa(W,A.h))}function ei(A,W,re){A.i.set(W,re)}function gc(A){return ei(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function pr(A,W){return A?W?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function jc(A,W,re){return typeof A=="string"?(A=encodeURI(A).replace(W,im),re&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function im(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var fu=/[#\/\?@]/g,hh=/[#\?:]/g,Ap=/[#\?]/g,sm=/[#\?@]/g,Pp=/#/g;function aa(A,W){this.h=this.g=null,this.i=A||null,this.j=!!W}function fs(A){A.g||(A.g=new Map,A.h=0,A.i&&ad(A.i,function(W,re){A.add(decodeURIComponent(W.replace(/\+/g," ")),re)}))}n=aa.prototype,n.add=function(A,W){fs(this),this.i=null,A=ua(this,A);var re=this.g.get(A);return re||this.g.set(A,re=[]),re.push(W),this.h+=1,this};function ca(A,W){fs(A),W=ua(A,W),A.g.has(W)&&(A.i=null,A.h-=A.g.get(W).length,A.g.delete(W))}function la(A,W){return fs(A),W=ua(A,W),A.g.has(W)}n.forEach=function(A,W){fs(this),this.g.forEach(function(re,ge){re.forEach(function(Xe){A.call(W,Xe,ge,this)},this)},this)},n.na=function(){fs(this);const A=Array.from(this.g.values()),W=Array.from(this.g.keys()),re=[];for(let ge=0;ge<W.length;ge++){const Xe=A[ge];for(let lt=0;lt<Xe.length;lt++)re.push(W[ge])}return re},n.V=function(A){fs(this);let W=[];if(typeof A=="string")la(this,A)&&(W=W.concat(this.g.get(ua(this,A))));else{A=Array.from(this.g.values());for(let re=0;re<A.length;re++)W=W.concat(A[re])}return W},n.set=function(A,W){return fs(this),this.i=null,A=ua(this,A),la(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[W]),this.h+=1,this},n.get=function(A,W){return A?(A=this.V(A),0<A.length?String(A[0]):W):W};function mu(A,W,re){ca(A,W),0<re.length&&(A.i=null,A.g.set(ua(A,W),F(re)),A.h+=re.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],W=Array.from(this.g.keys());for(var re=0;re<W.length;re++){var ge=W[re];const lt=encodeURIComponent(String(ge)),Gt=this.V(ge);for(ge=0;ge<Gt.length;ge++){var Xe=lt;Gt[ge]!==""&&(Xe+="="+encodeURIComponent(String(Gt[ge]))),A.push(Xe)}}return this.i=A.join("&")};function ua(A,W){return W=String(W),A.j&&(W=W.toLowerCase()),W}function da(A,W){W&&!A.j&&(fs(A),A.i=null,A.g.forEach(function(re,ge){var Xe=ge.toLowerCase();ge!=Xe&&(ca(this,ge),mu(this,Xe,re))},A)),A.j=W}function om(A,W){const re=new Il;if(_.Image){const ge=new Image;ge.onload=L(Is,re,"TestLoadImage: loaded",!0,W,ge),ge.onerror=L(Is,re,"TestLoadImage: error",!1,W,ge),ge.onabort=L(Is,re,"TestLoadImage: abort",!1,W,ge),ge.ontimeout=L(Is,re,"TestLoadImage: timeout",!1,W,ge),_.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else W(!1)}function Bc(A,W){const re=new Il,ge=new AbortController,Xe=setTimeout(()=>{ge.abort(),Is(re,"TestPingServer: timeout",!1,W)},1e4);fetch(A,{signal:ge.signal}).then(lt=>{clearTimeout(Xe),lt.ok?Is(re,"TestPingServer: ok",!0,W):Is(re,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout(Xe),Is(re,"TestPingServer: error",!1,W)})}function Is(A,W,re,ge,Xe){try{Xe&&(Xe.onload=null,Xe.onerror=null,Xe.onabort=null,Xe.ontimeout=null),ge(re)}catch{}}function ld(){this.g=new ra}function Op(A,W,re){const ge=re||"";try{du(A,function(Xe,lt){let Gt=Xe;b(Xe)&&(Gt=cr(Xe)),W.push(ge+lt+"="+encodeURIComponent(Gt))})}catch(Xe){throw W.push(ge+"type="+encodeURIComponent("_badmap")),Xe}}function xl(A){this.l=A.Ub||null,this.j=A.eb||!1}M(xl,Hs),xl.prototype.g=function(){return new gu(this.l,this.j)},xl.prototype.i=function(A){return function(){return A}}({});function gu(A,W){En.call(this),this.D=A,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}M(gu,En),n=gu.prototype,n.open=function(A,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=W,this.readyState=1,za(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(W.body=A),(this.D||_).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ba(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,za(this)),this.g&&(this.readyState=3,za(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;am(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function am(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var W=A.value?A.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!A.done}))&&(this.response=this.responseText+=W)}A.done?Ba(this):za(this),this.readyState==3&&am(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,Ba(this))},n.Qa=function(A){this.g&&(this.response=A,Ba(this))},n.ga=function(){this.g&&Ba(this)};function Ba(A){A.readyState=4,A.l=null,A.j=null,A.v=null,za(A)}n.setRequestHeader=function(A,W){this.u.append(A,W)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],W=this.h.entries();for(var re=W.next();!re.done;)re=re.value,A.push(re[0]+": "+re[1]),re=W.next();return A.join(`\r
`)};function za(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(gu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function Ll(A){let W="";return le(A,function(re,ge){W+=ge,W+=":",W+=re,W+=`\r
`}),W}function be(A,W,re){e:{for(ge in re){var ge=!1;break e}ge=!0}ge||(re=Ll(re),typeof A=="string"?re!=null&&encodeURIComponent(String(re)):ei(A,W,re))}function De(A){En.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}M(De,En);var rt=/^https?$/i,Zt=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,W,re,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);W=W?W.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():$i.g(),this.v=this.o?io(this.o):io($i),this.g.onreadystatechange=O(this.Ea,this);try{this.B=!0,this.g.open(W,String(A),!0),this.B=!1}catch(lt){tr(this,lt);return}if(A=re||"",re=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var Xe in ge)re.set(Xe,ge[Xe]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const lt of ge.keys())re.set(lt,ge.get(lt));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(re.keys()).find(lt=>lt.toLowerCase()=="content-type"),Xe=_.FormData&&A instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Zt,W,void 0))||ge||Xe||re.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[lt,Gt]of re)this.g.setRequestHeader(lt,Gt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Hr(this),this.u=!0,this.g.send(A),this.u=!1}catch(lt){tr(this,lt)}};function tr(A,W){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=W,A.m=5,Or(A),gn(A)}function Or(A){A.A||(A.A=!0,tn(A,"complete"),tn(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,tn(this,"complete"),tn(this,"abort"),gn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Jr(this):this.bb())},n.bb=function(){Jr(this)};function Jr(A){if(A.h&&typeof f<"u"&&(!A.v[1]||Ii(A)!=4||A.Z()!=2)){if(A.u&&Ii(A)==4)sr(A.Ea,0,A);else if(tn(A,"readystatechange"),Ii(A)==4){A.h=!1;try{const Gt=A.Z();e:switch(Gt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var re;if(!(re=W)){var ge;if(ge=Gt===0){var Xe=String(A.D).match(hu)[1]||null;!Xe&&_.self&&_.self.location&&(Xe=_.self.location.protocol.slice(0,-1)),ge=!rt.test(Xe?Xe.toLowerCase():"")}re=ge}if(re)tn(A,"complete"),tn(A,"success");else{A.m=6;try{var lt=2<Ii(A)?A.g.statusText:""}catch{lt=""}A.l=lt+" ["+A.Z()+"]",Or(A)}}finally{gn(A)}}}}function gn(A,W){if(A.g){Hr(A);const re=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,W||tn(A,"ready");try{re.onreadystatechange=ge}catch{}}}function Hr(A){A.I&&(_.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function Ii(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<Ii(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var W=this.g.responseText;return A&&W.indexOf(A)==0&&(W=W.substring(A.length)),zn(W)}};function $s(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function ha(A){const W={};A=(A.g&&2<=Ii(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if(K(A[ge]))continue;var re=de(A[ge]);const Xe=re[0];if(re=re[1],typeof re!="string")continue;re=re.trim();const lt=W[Xe]||[];W[Xe]=lt,lt.push(re)}Y(W,function(ge){return ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function pa(A,W,re){return re&&re.internalChannelParams&&re.internalChannelParams[A]||W}function ud(A){this.Aa=0,this.i=[],this.j=new Il,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=pa("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=pa("baseRetryDelayMs",5e3,A),this.cb=pa("retryDelaySeedMs",1e4,A),this.Wa=pa("forwardChannelMaxRetries",2,A),this.wa=pa("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new uu(A&&A.concurrentRequestLimit),this.Da=new ld,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ud.prototype,n.la=8,n.G=1,n.connect=function(A,W,re,ge){Di(0),this.W=A,this.H=W||{},re&&ge!==void 0&&(this.H.OSID=re,this.H.OAID=ge),this.F=this.X,this.I=Yg(this,null,this.W),zc(this)};function cs(A){if(ph(A),A.G==3){var W=A.U++,re=oa(A.I);if(ei(re,"SID",A.K),ei(re,"RID",W),ei(re,"TYPE","terminate"),dd(A,re),W=new Bo(A,A.j,W),W.L=2,W.v=gc(oa(re)),re=!1,_.navigator&&_.navigator.sendBeacon)try{re=_.navigator.sendBeacon(W.v.toString(),"")}catch{}!re&&_.Image&&(new Image().src=W.v,re=!0),re||(W.g=aE(W.j,null),W.g.ea(W.v)),W.F=Date.now(),vn(W)}fd(A)}function Ml(A){A.g&&(qg(A),A.g.cancel(),A.g=null)}function ph(A){Ml(A),A.u&&(_.clearTimeout(A.u),A.u=null),um(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&_.clearTimeout(A.s),A.s=null)}function zc(A){if(!zo(A.h)&&!A.s){A.s=!0;var W=A.Ga;Oe||Be(),we||(Oe(),we=!0),Se.add(W,A),A.B=0}}function Kg(A,W){return rm(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=W.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=ia(O(A.Ga,A,W),hd(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Xe=new Bo(this,this.j,A);let lt=this.o;if(this.S&&(lt?(lt=Z(lt),ie(lt,this.S)):lt=this.S),this.m!==null||this.O||(Xe.H=lt,lt=null),this.P)e:{for(var W=0,re=0;re<this.i.length;re++){t:{var ge=this.i[re];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(W+=ge,4096<W){W=re;break e}if(W===4096||re===this.i.length-1){W=re+1;break e}}W=1e3}else W=1e3;W=fa(this,Xe,W),re=oa(this.I),ei(re,"RID",A),ei(re,"CVER",22),this.D&&ei(re,"X-HTTP-Session-Id",this.D),dd(this,re),lt&&(this.O?W="headers="+encodeURIComponent(String(Ll(lt)))+"&"+W:this.m&&be(re,this.m,lt)),Ip(this.h,Xe),this.Ua&&ei(re,"TYPE","init"),this.P?(ei(re,"$req",W),ei(re,"SID","null"),Xe.T=!0,lu(Xe,re,null)):lu(Xe,re,W),this.G=2}}else this.G==3&&(A?cm(this,A):this.i.length==0||zo(this.h)||cm(this))};function cm(A,W){var re;W?re=W.l:re=A.U++;const ge=oa(A.I);ei(ge,"SID",A.K),ei(ge,"RID",re),ei(ge,"AID",A.T),dd(A,ge),A.m&&A.o&&be(ge,A.m,A.o),re=new Bo(A,A.j,re,A.B+1),A.m===null&&(re.H=A.o),W&&(A.i=W.D.concat(A.i)),W=fa(A,re,1e3),re.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Ip(A.h,re),lu(re,ge,W)}function dd(A,W){A.H&&le(A.H,function(re,ge){ei(W,ge,re)}),A.l&&du({},function(re,ge){ei(W,ge,re)})}function fa(A,W,re){re=Math.min(A.i.length,re);var ge=A.l?O(A.l.Na,A.l,A):null;e:{var Xe=A.i;let lt=-1;for(;;){const Gt=["count="+re];lt==-1?0<re?(lt=Xe[0].g,Gt.push("ofs="+lt)):lt=0:Gt.push("ofs="+lt);let ti=!0;for(let gi=0;gi<re;gi++){let kr=Xe[gi].g;const so=Xe[gi].map;if(kr-=lt,0>kr)lt=Math.max(0,Xe[gi].g-100),ti=!1;else try{Op(so,Gt,"req"+kr+"_")}catch{ge&&ge(so)}}if(ti){ge=Gt.join("&");break e}}}return A=A.i.splice(0,re),W.D=A,ge}function _u(A){if(!A.g&&!A.u){A.Y=1;var W=A.Fa;Oe||Be(),we||(Oe(),we=!0),Se.add(W,A),A.v=0}}function lm(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=ia(O(A.Fa,A),hd(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,oE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=ia(O(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Di(10),Ml(this),oE(this))};function qg(A){A.A!=null&&(_.clearTimeout(A.A),A.A=null)}function oE(A){A.g=new Bo(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var W=oa(A.qa);ei(W,"RID","rpc"),ei(W,"SID",A.K),ei(W,"AID",A.T),ei(W,"CI",A.F?"0":"1"),!A.F&&A.ja&&ei(W,"TO",A.ja),ei(W,"TYPE","xmlhttp"),dd(A,W),A.m&&A.o&&be(W,A.m,A.o),A.L&&(A.g.I=A.L);var re=A.g;A=A.ia,re.L=1,re.v=gc(oa(W)),re.m=null,re.P=!0,fc(re,A)}n.Za=function(){this.C!=null&&(this.C=null,Ml(this),lm(this),Di(19))};function um(A){A.C!=null&&(_.clearTimeout(A.C),A.C=null)}function dm(A,W){var re=null;if(A.g==W){um(A),qg(A),A.g=null;var ge=2}else if(go(A.h,W))re=W.D,Nl(A.h,W),ge=1;else return;if(A.G!=0){if(W.o)if(ge==1){re=W.m?W.m.length:0,W=Date.now()-W.F;var Xe=A.B;ge=Rl(),tn(ge,new os(ge,re)),zc(A)}else _u(A);else if(Xe=W.s,Xe==3||Xe==0&&0<W.X||!(ge==1&&Kg(A,W)||ge==2&&lm(A)))switch(re&&0<re.length&&(W=A.h,W.i=W.i.concat(re)),Xe){case 1:pd(A,5);break;case 4:pd(A,10);break;case 3:pd(A,6);break;default:pd(A,2)}}}function hd(A,W){let re=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(re*=2),re*W}function pd(A,W){if(A.j.info("Error code "+W),W==2){var re=O(A.fb,A),ge=A.Xa;const Xe=!ge;ge=new mc(ge||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||cd(ge,"https"),gc(ge),Xe?om(ge.toString(),re):Bc(ge.toString(),re)}else Di(2);A.G=0,A.l&&A.l.sa(W),fd(A),ph(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Di(2)):(this.j.info("Failed to ping google.com"),Di(1))};function fd(A){if(A.G=0,A.ka=[],A.l){const W=uh(A.h);(W.length!=0||A.i.length!=0)&&(z(A.ka,W),z(A.ka,A.i),A.h.i.length=0,F(A.i),A.i.length=0),A.l.ra()}}function Yg(A,W,re){var ge=re instanceof mc?oa(re):new mc(re);if(ge.g!="")W&&(ge.g=W+"."+ge.g),Dl(ge,ge.s);else{var Xe=_.location;ge=Xe.protocol,W=W?W+"."+Xe.hostname:Xe.hostname,Xe=+Xe.port;var lt=new mc(null);ge&&cd(lt,ge),W&&(lt.g=W),Xe&&Dl(lt,Xe),re&&(lt.l=re),ge=lt}return re=A.D,W=A.ya,re&&W&&ei(ge,re,W),ei(ge,"VER",A.la),dd(A,ge),ge}function aE(A,W,re){if(W&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=A.Ca&&!A.pa?new De(new xl({eb:re})):new De(A.pa),W.Ha(A.J),W}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Gn(){}n=Gn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function hm(){}hm.prototype.g=function(A,W){return new ma(A,W)};function ma(A,W){En.call(this),this.g=new ud(W),this.l=A,this.h=W&&W.messageUrlParams||null,A=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(A?A["X-WebChannel-Content-Type"]=W.messageContentType:A={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(A?A["X-WebChannel-Client-Profile"]=W.va:A={"X-WebChannel-Client-Profile":W.va}),this.g.S=A,(A=W&&W.Sb)&&!K(A)&&(this.g.m=A),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!K(W)&&(this.g.D=W,A=this.h,A!==null&&W in A&&(A=this.h,W in A&&delete A[W])),this.j=new Wc(this)}M(ma,En),ma.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ma.prototype.close=function(){cs(this.g)},ma.prototype.o=function(A){var W=this.g;if(typeof A=="string"){var re={};re.__data__=A,A=re}else this.u&&(re={},re.__data__=cr(A),A=re);W.i.push(new lh(W.Ya++,A)),W.G==3&&zc(W)},ma.prototype.N=function(){this.g.l=null,delete this.j,cs(this.g),delete this.g,ma.aa.N.call(this)};function cE(A){Ma.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var W=A.__sm__;if(W){e:{for(const re in W){A=re;break e}A=void 0}(this.i=A)&&(A=this.i,W=W!==null&&A in W?W[A]:void 0),this.data=W}else this.data=A}M(cE,Ma);function lE(){Fo.call(this),this.status=1}M(lE,Fo);function Wc(A){this.g=A}M(Wc,Gn),Wc.prototype.ua=function(){tn(this.g,"a")},Wc.prototype.ta=function(A){tn(this.g,new cE(A))},Wc.prototype.sa=function(A){tn(this.g,new lE)},Wc.prototype.ra=function(){tn(this.g,"b")},hm.prototype.createWebChannel=hm.prototype.g,ma.prototype.send=ma.prototype.o,ma.prototype.open=ma.prototype.m,ma.prototype.close=ma.prototype.close,die=function(){return new hm},uie=function(){return Rl()},lie=Ua,IV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ci.NO_ERROR=0,Ci.TIMEOUT=8,Ci.HTTP_ERROR=6,hk=Ci,Al.COMPLETE="complete",cie=Al,Vc.EventType=Rs,Rs.OPEN="a",Rs.CLOSE="b",Rs.ERROR="c",Rs.MESSAGE="d",En.prototype.listen=En.prototype.K,Gw=Vc,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,aie=De}).apply(typeof kO<"u"?kO:typeof self<"u"?self:typeof window<"u"?window:{});const MX="@firebase/firestore",UX="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ac.UNAUTHENTICATED=new ac(null),ac.GOOGLE_CREDENTIALS=new ac("google-credentials-uid"),ac.FIRST_PARTY=new ac("first-party-uid"),ac.MOCK_USER=new ac("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let H0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy=new Gj("@firebase/firestore");function OS(){return qy.logLevel}function rn(n,...e){if(qy.logLevel<=xr.DEBUG){const i=e.map(e4);qy.debug(`Firestore (${H0}): ${n}`,...i)}}function Qf(n,...e){if(qy.logLevel<=xr.ERROR){const i=e.map(e4);qy.error(`Firestore (${H0}): ${n}`,...i)}}function C0(n,...e){if(qy.logLevel<=xr.WARN){const i=e.map(e4);qy.warn(`Firestore (${H0}): ${n}`,...i)}}function e4(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(n="Unexpected state"){const e=`FIRESTORE (${H0}) INTERNAL ASSERTION FAILED: `+n;throw Qf(e),new Error(e)}function mi(n,e){n||qn()}function ir(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class un extends ah{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hie{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class t4e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(ac.UNAUTHENTICATED))}shutdown(){}}class n4e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class r4e{constructor(e){this.t=e,this.currentUser=ac.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){mi(this.o===void 0);let a=this.i;const l=E=>this.i!==a?(a=this.i,i(E)):Promise.resolve();let u=new Wf;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Wf,e.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const E=u;e.enqueueRetryable(async()=>{await E.promise,await l(this.currentUser)})},_=E=>{rn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(E=>_(E)),setTimeout(()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?_(E):(rn("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Wf)}},0),f()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==e?(rn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(mi(typeof a.accessToken=="string"),new hie(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return mi(e===null||typeof e=="string"),new ac(e)}}class i4e{constructor(e,i,a){this.l=e,this.h=i,this.P=a,this.type="FirstParty",this.user=ac.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class s4e{constructor(e,i,a){this.l=e,this.h=i,this.P=a}getToken(){return Promise.resolve(new i4e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(ac.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class VX{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class o4e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,El(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){mi(this.o===void 0);const a=u=>{u.error!=null&&rn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const f=u.token!==this.R;return this.R=u.token,rn("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?i(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>a(u))};const l=u=>{rn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(u=>l(u)),setTimeout(()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?l(u):rn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new VX(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(mi(typeof i.token=="string"),this.R=i.token,new VX(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a4e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let a=0;a<n;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pie(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fie{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=a4e(40);for(let u=0;u<l.length;++u)a.length<20&&l[u]<i&&(a+=e.charAt(l[u]%62))}return a}}function vr(n,e){return n<e?-1:n>e?1:0}function AV(n,e){let i=0;for(;i<n.length&&i<e.length;){const a=n.codePointAt(i),l=e.codePointAt(i);if(a!==l){if(a<128&&l<128)return vr(a,l);{const u=pie(),f=c4e(u.encode(FX(n,i)),u.encode(FX(e,i)));return f!==0?f:vr(a,l)}}i+=a>65535?2:1}return vr(n.length,e.length)}function FX(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function c4e(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return vr(n[i],e[i]);return vr(n.length,e.length)}function R0(n,e,i){return n.length===e.length&&n.every((a,l)=>i(a,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jX=-62135596800,BX=1e6;class Do{static now(){return Do.fromMillis(Date.now())}static fromDate(e){return Do.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),a=Math.floor((e-1e3*i)*BX);return new Do(i,a)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new un(Pt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new un(Pt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<jX)throw new un(Pt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new un(Pt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/BX}_compareTo(e){return this.seconds===e.seconds?vr(this.nanoseconds,e.nanoseconds):vr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-jX;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{static fromTimestamp(e){return new er(e)}static min(){return new er(new Do(0,0))}static max(){return new er(new Do(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zX="__name__";class tp{constructor(e,i,a){i===void 0?i=0:i>e.length&&qn(),a===void 0?a=e.length-i:a>e.length-i&&qn(),this.segments=e,this.offset=i,this.len=a}get length(){return this.len}isEqual(e){return tp.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof tp?e.forEach(a=>{i.push(a)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,a=this.limit();i<a;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const a=Math.min(e.length,i.length);for(let l=0;l<a;l++){const u=tp.compareSegments(e.get(l),i.get(l));if(u!==0)return u}return vr(e.length,i.length)}static compareSegments(e,i){const a=tp.isNumericId(e),l=tp.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?tp.extractNumericId(e).compare(tp.extractNumericId(i)):AV(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ig.fromString(e.substring(4,e.length-2))}}class rs extends tp{construct(e,i,a){return new rs(e,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const a of e){if(a.indexOf("//")>=0)throw new un(Pt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new rs(i)}static emptyPath(){return new rs([])}}const l4e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Da extends tp{construct(e,i,a){return new Da(e,i,a)}static isValidIdentifier(e){return l4e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Da.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===zX}static keyField(){return new Da([zX])}static fromServerFormat(e){const i=[];let a="",l=0;const u=()=>{if(a.length===0)throw new un(Pt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let f=!1;for(;l<e.length;){const _=e[l];if(_==="\\"){if(l+1===e.length)throw new un(Pt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[l+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new un(Pt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=E,l+=2}else _==="`"?(f=!f,l++):_!=="."||f?(a+=_,l++):(u(),l++)}if(u(),f)throw new un(Pt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Da(i)}static emptyPath(){return new Da([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e){this.path=e}static fromPath(e){return new Pn(rs.fromString(e))}static fromName(e){return new Pn(rs.fromString(e).popFirst(5))}static empty(){return new Pn(rs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&rs.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return rs.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pn(new rs(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WC=-1;function u4e(n,e){const i=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=er.fromTimestamp(a===1e9?new Do(i+1,0):new Do(i,a));return new Dg(l,Pn.empty(),e)}function d4e(n){return new Dg(n.readTime,n.key,WC)}class Dg{constructor(e,i,a){this.readTime=e,this.documentKey=i,this.largestBatchId=a}static min(){return new Dg(er.min(),Pn.empty(),WC)}static max(){return new Dg(er.max(),Pn.empty(),WC)}}function h4e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Pn.comparator(n.documentKey,e.documentKey),i!==0?i:vr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p4e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class f4e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $0(n){if(n.code!==Pt.FAILED_PRECONDITION||n.message!==p4e)throw n;rn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&qn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new At((a,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(a,l)},this.catchCallback=u=>{this.wrapFailure(i,u).next(a,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof At?i:At.resolve(i)}catch(i){return At.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):At.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):At.reject(i)}static resolve(e){return new At((i,a)=>{i(e)})}static reject(e){return new At((i,a)=>{a(e)})}static waitFor(e){return new At((i,a)=>{let l=0,u=0,f=!1;e.forEach(_=>{++l,_.next(()=>{++u,f&&u===l&&i()},E=>a(E))}),f=!0,u===l&&i()})}static or(e){let i=At.resolve(!1);for(const a of e)i=i.next(l=>l?At.resolve(l):a());return i}static forEach(e,i){const a=[];return e.forEach((l,u)=>{a.push(i.call(this,l,u))}),this.waitFor(a)}static mapArray(e,i){return new At((a,l)=>{const u=e.length,f=new Array(u);let _=0;for(let E=0;E<u;E++){const b=E;i(e[b]).next(C=>{f[b]=C,++_,_===u&&a(f)},C=>l(C))}})}static doWhile(e,i){return new At((a,l)=>{const u=()=>{e()===!0?i().next(()=>{u()},l):a()};u()})}}function m4e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function K0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=a=>this.oe(a),this._e=a=>i.writeSequenceNumber(a))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}JN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t4=-1;function QN(n){return n==null}function qk(n){return n===0&&1/n==-1/0}function g4e(n){return typeof n=="number"&&Number.isInteger(n)&&!qk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mie="";function _4e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=WX(e)),e=y4e(n.get(i),e);return WX(e)}function y4e(n,e){let i=e;const a=n.length;for(let l=0;l<a;l++){const u=n.charAt(l);switch(u){case"\0":i+="";break;case mie:i+="";break;default:i+=u}}return i}function WX(n){return n+mie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GX(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function Hg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function gie(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,i){this.comparator=e,this.root=i||ka.EMPTY}insert(e,i){return new ws(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,ka.BLACK,null,null))}remove(e){return new ws(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ka.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(e){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(e,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,a)=>(e(i,a),!1))}toString(){const e=[];return this.inorderTraversal((i,a)=>(e.push(`${i}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new NO(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new NO(this.root,e,this.comparator,!1)}getReverseIterator(){return new NO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new NO(this.root,e,this.comparator,!0)}}class NO{constructor(e,i,a,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=i?a(e.key,i):1,i&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ka{constructor(e,i,a,l,u){this.key=e,this.value=i,this.color=a??ka.RED,this.left=l??ka.EMPTY,this.right=u??ka.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,a,l,u){return new ka(e??this.key,i??this.value,a??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,a){let l=this;const u=a(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,i,a),null):u===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return ka.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let a,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return ka.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ka.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ka.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw qn();const e=this.left.check();if(e!==this.right.check())throw qn();return e+(this.isRed()?0:1)}}ka.EMPTY=null,ka.RED=!0,ka.BLACK=!1;ka.EMPTY=new class{constructor(){this.size=0}get key(){throw qn()}get value(){throw qn()}get color(){throw qn()}get left(){throw qn()}get right(){throw qn()}copy(e,i,a,l,u){return this}insert(e,i,a){return new ka(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(e){this.comparator=e,this.data=new ws(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,a)=>(e(i),!1))}forEachInRange(e,i){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new HX(this.data.getIterator())}getIteratorFrom(e){return new HX(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(a=>{i=i.add(a)}),i}isEqual(e){if(!(e instanceof xo)||this.size!==e.size)return!1;const i=this.data.getIterator(),a=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=a.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new xo(this.comparator);return i.data=e,i}}class HX{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(e){this.fields=e,e.sort(Da.comparator)}static empty(){return new Zl([])}unionWith(e){let i=new xo(Da.comparator);for(const a of this.fields)i=i.add(a);for(const a of e)i=i.add(a);return new Zl(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return R0(this.fields,e.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ie extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new _ie("Invalid base64 string: "+u):u}}(e);return new xa(i)}static fromUint8Array(e){const i=function(l){let u="";for(let f=0;f<l.length;++f)u+=String.fromCharCode(l[f]);return u}(e);return new xa(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return vr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}xa.EMPTY_BYTE_STRING=new xa("");const E4e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xg(n){if(mi(!!n),typeof n=="string"){let e=0;const i=E4e.exec(n);if(mi(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:Zs(n.seconds),nanos:Zs(n.nanos)}}function Zs(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Lg(n){return typeof n=="string"?xa.fromBase64String(n):xa.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yie="server_timestamp",Eie="__type__",vie="__previous_value__",Sie="__local_write_time__";function n4(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Eie])===null||i===void 0?void 0:i.stringValue)===yie}function ZN(n){const e=n.mapValue.fields[vie];return n4(e)?ZN(e):e}function GC(n){const e=xg(n.mapValue.fields[Sie].timestampValue);return new Do(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4e{constructor(e,i,a,l,u,f,_,E,b){this.databaseId=e,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=u,this.forceLongPolling=f,this.autoDetectLongPolling=_,this.longPollingOptions=E,this.useFetchStreams=b}}const Yk="(default)";class HC{constructor(e,i){this.projectId=e,this.database=i||Yk}static empty(){return new HC("","")}get isDefaultDatabase(){return this.database===Yk}isEqual(e){return e instanceof HC&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bie="__type__",S4e="__max__",DO={mapValue:{}},Tie="__vector__",Xk="value";function Mg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?n4(n)?4:T4e(n)?9007199254740991:b4e(n)?10:11:qn()}function wp(n,e){if(n===e)return!0;const i=Mg(n);if(i!==Mg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return GC(n).isEqual(GC(e));case 3:return function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const f=xg(l.timestampValue),_=xg(u.timestampValue);return f.seconds===_.seconds&&f.nanos===_.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,u){return Lg(l.bytesValue).isEqual(Lg(u.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,u){return Zs(l.geoPointValue.latitude)===Zs(u.geoPointValue.latitude)&&Zs(l.geoPointValue.longitude)===Zs(u.geoPointValue.longitude)}(n,e);case 2:return function(l,u){if("integerValue"in l&&"integerValue"in u)return Zs(l.integerValue)===Zs(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const f=Zs(l.doubleValue),_=Zs(u.doubleValue);return f===_?qk(f)===qk(_):isNaN(f)&&isNaN(_)}return!1}(n,e);case 9:return R0(n.arrayValue.values||[],e.arrayValue.values||[],wp);case 10:case 11:return function(l,u){const f=l.mapValue.fields||{},_=u.mapValue.fields||{};if(GX(f)!==GX(_))return!1;for(const E in f)if(f.hasOwnProperty(E)&&(_[E]===void 0||!wp(f[E],_[E])))return!1;return!0}(n,e);default:return qn()}}function $C(n,e){return(n.values||[]).find(i=>wp(i,e))!==void 0}function I0(n,e){if(n===e)return 0;const i=Mg(n),a=Mg(e);if(i!==a)return vr(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return vr(n.booleanValue,e.booleanValue);case 2:return function(u,f){const _=Zs(u.integerValue||u.doubleValue),E=Zs(f.integerValue||f.doubleValue);return _<E?-1:_>E?1:_===E?0:isNaN(_)?isNaN(E)?0:-1:1}(n,e);case 3:return $X(n.timestampValue,e.timestampValue);case 4:return $X(GC(n),GC(e));case 5:return AV(n.stringValue,e.stringValue);case 6:return function(u,f){const _=Lg(u),E=Lg(f);return _.compareTo(E)}(n.bytesValue,e.bytesValue);case 7:return function(u,f){const _=u.split("/"),E=f.split("/");for(let b=0;b<_.length&&b<E.length;b++){const C=vr(_[b],E[b]);if(C!==0)return C}return vr(_.length,E.length)}(n.referenceValue,e.referenceValue);case 8:return function(u,f){const _=vr(Zs(u.latitude),Zs(f.latitude));return _!==0?_:vr(Zs(u.longitude),Zs(f.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return KX(n.arrayValue,e.arrayValue);case 10:return function(u,f){var _,E,b,C;const I=u.fields||{},O=f.fields||{},L=(_=I[Xk])===null||_===void 0?void 0:_.arrayValue,M=(E=O[Xk])===null||E===void 0?void 0:E.arrayValue,F=vr(((b=L==null?void 0:L.values)===null||b===void 0?void 0:b.length)||0,((C=M==null?void 0:M.values)===null||C===void 0?void 0:C.length)||0);return F!==0?F:KX(L,M)}(n.mapValue,e.mapValue);case 11:return function(u,f){if(u===DO.mapValue&&f===DO.mapValue)return 0;if(u===DO.mapValue)return 1;if(f===DO.mapValue)return-1;const _=u.fields||{},E=Object.keys(_),b=f.fields||{},C=Object.keys(b);E.sort(),C.sort();for(let I=0;I<E.length&&I<C.length;++I){const O=AV(E[I],C[I]);if(O!==0)return O;const L=I0(_[E[I]],b[C[I]]);if(L!==0)return L}return vr(E.length,C.length)}(n.mapValue,e.mapValue);default:throw qn()}}function $X(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return vr(n,e);const i=xg(n),a=xg(e),l=vr(i.seconds,a.seconds);return l!==0?l:vr(i.nanos,a.nanos)}function KX(n,e){const i=n.values||[],a=e.values||[];for(let l=0;l<i.length&&l<a.length;++l){const u=I0(i[l],a[l]);if(u)return u}return vr(i.length,a.length)}function A0(n){return PV(n)}function PV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const a=xg(i);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Lg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Pn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let a="[",l=!0;for(const u of i.values||[])l?l=!1:a+=",",a+=PV(u);return a+"]"}(n.arrayValue):"mapValue"in n?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",u=!0;for(const f of a)u?u=!1:l+=",",l+=`${f}:${PV(i.fields[f])}`;return l+"}"}(n.mapValue):qn()}function pk(n){switch(Mg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ZN(n);return e?16+pk(e):16;case 5:return 2*n.stringValue.length;case 6:return Lg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,u)=>l+pk(u),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Hg(a.fields,(u,f)=>{l+=u.length+pk(f)}),l}(n.mapValue);default:throw qn()}}function qX(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function OV(n){return!!n&&"integerValue"in n}function r4(n){return!!n&&"arrayValue"in n}function YX(n){return!!n&&"nullValue"in n}function XX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function fk(n){return!!n&&"mapValue"in n}function b4e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[bie])===null||i===void 0?void 0:i.stringValue)===Tie}function pC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Hg(n.mapValue.fields,(i,a)=>e.mapValue.fields[i]=pC(a)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=pC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function T4e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===S4e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e){this.value=e}static empty(){return new vl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let a=0;a<e.length-1;++a)if(i=(i.mapValue.fields||{})[e.get(a)],!fk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=pC(i)}setAll(e){let i=Da.emptyPath(),a={},l=[];e.forEach((f,_)=>{if(!i.isImmediateParentOf(_)){const E=this.getFieldsMap(i);this.applyChanges(E,a,l),a={},l=[],i=_.popLast()}f?a[_.lastSegment()]=pC(f):l.push(_.lastSegment())});const u=this.getFieldsMap(i);this.applyChanges(u,a,l)}delete(e){const i=this.field(e.popLast());fk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return wp(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<e.length;++a){let l=i.mapValue.fields[e.get(a)];fk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,a){Hg(i,(l,u)=>e[l]=u);for(const l of a)delete e[l]}clone(){return new vl(pC(this.value))}}function wie(n){const e=[];return Hg(n.fields,(i,a)=>{const l=new Da([i]);if(fk(a)){const u=wie(a.mapValue).fields;if(u.length===0)e.push(l);else for(const f of u)e.push(l.child(f))}else e.push(l)}),new Zl(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e,i,a,l,u,f,_){this.key=e,this.documentType=i,this.version=a,this.readTime=l,this.createTime=u,this.data=f,this.documentState=_}static newInvalidDocument(e){return new cc(e,0,er.min(),er.min(),er.min(),vl.empty(),0)}static newFoundDocument(e,i,a,l){return new cc(e,1,i,er.min(),a,l,0)}static newNoDocument(e,i){return new cc(e,2,i,er.min(),er.min(),vl.empty(),0)}static newUnknownDocument(e,i){return new cc(e,3,i,er.min(),er.min(),vl.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(er.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=vl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=vl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=er.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof cc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new cc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e,i){this.position=e,this.inclusive=i}}function JX(n,e,i){let a=0;for(let l=0;l<n.position.length;l++){const u=e[l],f=n.position[l];if(u.field.isKeyField()?a=Pn.comparator(Pn.fromName(f.referenceValue),i.key):a=I0(f,i.data.field(u.field)),u.dir==="desc"&&(a*=-1),a!==0)break}return a}function QX(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!wp(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{constructor(e,i="asc"){this.field=e,this.dir=i}}function w4e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cie{}class po extends Cie{constructor(e,i,a){super(),this.field=e,this.op=i,this.value=a}static create(e,i,a){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,a):new R4e(e,i,a):i==="array-contains"?new P4e(e,a):i==="in"?new O4e(e,a):i==="not-in"?new k4e(e,a):i==="array-contains-any"?new N4e(e,a):new po(e,i,a)}static createKeyFieldInFilter(e,i,a){return i==="in"?new I4e(e,a):new A4e(e,a)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(I0(i,this.value)):i!==null&&Mg(this.value)===Mg(i)&&this.matchesComparison(I0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return qn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ih extends Cie{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new ih(e,i)}matches(e){return Rie(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Rie(n){return n.op==="and"}function Iie(n){return C4e(n)&&Rie(n)}function C4e(n){for(const e of n.filters)if(e instanceof ih)return!1;return!0}function kV(n){if(n instanceof po)return n.field.canonicalString()+n.op.toString()+A0(n.value);if(Iie(n))return n.filters.map(e=>kV(e)).join(",");{const e=n.filters.map(i=>kV(i)).join(",");return`${n.op}(${e})`}}function Aie(n,e){return n instanceof po?function(a,l){return l instanceof po&&a.op===l.op&&a.field.isEqual(l.field)&&wp(a.value,l.value)}(n,e):n instanceof ih?function(a,l){return l instanceof ih&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((u,f,_)=>u&&Aie(f,l.filters[_]),!0):!1}(n,e):void qn()}function Pie(n){return n instanceof po?function(i){return`${i.field.canonicalString()} ${i.op} ${A0(i.value)}`}(n):n instanceof ih?function(i){return i.op.toString()+" {"+i.getFilters().map(Pie).join(" ,")+"}"}(n):"Filter"}class R4e extends po{constructor(e,i,a){super(e,i,a),this.key=Pn.fromName(a.referenceValue)}matches(e){const i=Pn.comparator(e.key,this.key);return this.matchesComparison(i)}}class I4e extends po{constructor(e,i){super(e,"in",i),this.keys=Oie("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class A4e extends po{constructor(e,i){super(e,"not-in",i),this.keys=Oie("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function Oie(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>Pn.fromName(a.referenceValue))}class P4e extends po{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return r4(i)&&$C(i.arrayValue,this.value)}}class O4e extends po{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&$C(this.value.arrayValue,i)}}class k4e extends po{constructor(e,i){super(e,"not-in",i)}matches(e){if($C(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!$C(this.value.arrayValue,i)}}class N4e extends po{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!r4(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>$C(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4e{constructor(e,i=null,a=[],l=[],u=null,f=null,_=null){this.path=e,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=u,this.startAt=f,this.endAt=_,this.le=null}}function ZX(n,e=null,i=[],a=[],l=null,u=null,f=null){return new D4e(n,e,i,a,l,u,f)}function i4(n){const e=ir(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(a=>kV(a)).join(","),i+="|ob:",i+=e.orderBy.map(a=>function(u){return u.field.canonicalString()+u.dir}(a)).join(","),QN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(a=>A0(a)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(a=>A0(a)).join(",")),e.le=i}return e.le}function s4(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!w4e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!Aie(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!QX(n.startAt,e.startAt)&&QX(n.endAt,e.endAt)}function NV(n){return Pn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,i=null,a=[],l=[],u=null,f="F",_=null,E=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=u,this.limitType=f,this.startAt=_,this.endAt=E,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function x4e(n,e,i,a,l,u,f,_){return new gR(n,e,i,a,l,u,f,_)}function o4(n){return new gR(n)}function eJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function kie(n){return n.collectionGroup!==null}function fC(n){const e=ir(n);if(e.he===null){e.he=[];const i=new Set;for(const u of e.explicitOrderBy)e.he.push(u),i.add(u.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(f){let _=new xo(Da.comparator);return f.filters.forEach(E=>{E.getFlattenedFilters().forEach(b=>{b.isInequality()&&(_=_.add(b.field))})}),_})(e).forEach(u=>{i.has(u.canonicalString())||u.isKeyField()||e.he.push(new Qk(u,a))}),i.has(Da.keyField().canonicalString())||e.he.push(new Qk(Da.keyField(),a))}return e.he}function Sp(n){const e=ir(n);return e.Pe||(e.Pe=L4e(e,fC(n))),e.Pe}function L4e(n,e){if(n.limitType==="F")return ZX(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const u=l.dir==="desc"?"asc":"desc";return new Qk(l.field,u)});const i=n.endAt?new Jk(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new Jk(n.startAt.position,n.startAt.inclusive):null;return ZX(n.path,n.collectionGroup,e,n.filters,n.limit,i,a)}}function DV(n,e){const i=n.filters.concat([e]);return new gR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function Zk(n,e,i){return new gR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function e1(n,e){return s4(Sp(n),Sp(e))&&n.limitType===e.limitType}function Nie(n){return`${i4(Sp(n))}|lt:${n.limitType}`}function kS(n){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>Pie(l)).join(", ")}]`),QN(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>A0(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>A0(l)).join(",")),`Target(${a})`}(Sp(n))}; limitType=${n.limitType})`}function t1(n,e){return e.isFoundDocument()&&function(a,l){const u=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(u):Pn.isDocumentKey(a.path)?a.path.isEqual(u):a.path.isImmediateParentOf(u)}(n,e)&&function(a,l){for(const u of fC(a))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0}(n,e)&&function(a,l){for(const u of a.filters)if(!u.matches(l))return!1;return!0}(n,e)&&function(a,l){return!(a.startAt&&!function(f,_,E){const b=JX(f,_,E);return f.inclusive?b<=0:b<0}(a.startAt,fC(a),l)||a.endAt&&!function(f,_,E){const b=JX(f,_,E);return f.inclusive?b>=0:b>0}(a.endAt,fC(a),l))}(n,e)}function M4e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Die(n){return(e,i)=>{let a=!1;for(const l of fC(n)){const u=U4e(l,e,i);if(u!==0)return u;a=a||l.field.isKeyField()}return 0}}function U4e(n,e,i){const a=n.field.isKeyField()?Pn.comparator(e.key,i.key):function(u,f,_){const E=f.data.field(u),b=_.data.field(u);return E!==null&&b!==null?I0(E,b):qn()}(n.field,e,i);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return qn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a!==void 0){for(const[l,u]of a)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,i){const a=this.mapKeyFn(e),l=this.inner[a];if(l===void 0)return this.inner[a]=[[e,i]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(e){Hg(this.inner,(i,a)=>{for(const[l,u]of a)e(l,u)})}isEmpty(){return gie(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V4e=new ws(Pn.comparator);function Zf(){return V4e}const xie=new ws(Pn.comparator);function Hw(...n){let e=xie;for(const i of n)e=e.insert(i.key,i);return e}function Lie(n){let e=xie;return n.forEach((i,a)=>e=e.insert(i,a.overlayedDocument)),e}function wy(){return mC()}function Mie(){return mC()}function mC(){return new Zy(n=>n.toString(),(n,e)=>n.isEqual(e))}const F4e=new ws(Pn.comparator),j4e=new xo(Pn.comparator);function Lr(...n){let e=j4e;for(const i of n)e=e.add(i);return e}const B4e=new xo(vr);function z4e(){return B4e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a4(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qk(e)?"-0":e}}function Uie(n){return{integerValue:""+n}}function W4e(n,e){return g4e(e)?Uie(e):a4(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{constructor(){this._=void 0}}function G4e(n,e,i){return n instanceof eN?function(l,u){const f={fields:{[Eie]:{stringValue:yie},[Sie]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&n4(u)&&(u=ZN(u)),u&&(f.fields[vie]=u),{mapValue:f}}(i,e):n instanceof P0?Fie(n,e):n instanceof O0?jie(n,e):function(l,u){const f=Vie(l,u),_=tJ(f)+tJ(l.Ie);return OV(f)&&OV(l.Ie)?Uie(_):a4(l.serializer,_)}(n,e)}function H4e(n,e,i){return n instanceof P0?Fie(n,e):n instanceof O0?jie(n,e):i}function Vie(n,e){return n instanceof tN?function(a){return OV(a)||function(u){return!!u&&"doubleValue"in u}(a)}(e)?e:{integerValue:0}:null}class eN extends n1{}class P0 extends n1{constructor(e){super(),this.elements=e}}function Fie(n,e){const i=Bie(e);for(const a of n.elements)i.some(l=>wp(l,a))||i.push(a);return{arrayValue:{values:i}}}class O0 extends n1{constructor(e){super(),this.elements=e}}function jie(n,e){let i=Bie(e);for(const a of n.elements)i=i.filter(l=>!wp(l,a));return{arrayValue:{values:i}}}class tN extends n1{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function tJ(n){return Zs(n.integerValue||n.doubleValue)}function Bie(n){return r4(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zie{constructor(e,i){this.field=e,this.transform=i}}function $4e(n,e){return n.field.isEqual(e.field)&&function(a,l){return a instanceof P0&&l instanceof P0||a instanceof O0&&l instanceof O0?R0(a.elements,l.elements,wp):a instanceof tN&&l instanceof tN?wp(a.Ie,l.Ie):a instanceof eN&&l instanceof eN}(n.transform,e.transform)}class K4e{constructor(e,i){this.version=e,this.transformResults=i}}class Zu{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Zu}static exists(e){return new Zu(void 0,e)}static updateTime(e){return new Zu(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function mk(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class r1{}function Wie(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new c4(n.key,Zu.none()):new _R(n.key,n.data,Zu.none());{const i=n.data,a=vl.empty();let l=new xo(Da.comparator);for(let u of e.fields)if(!l.has(u)){let f=i.field(u);f===null&&u.length>1&&(u=u.popLast(),f=i.field(u)),f===null?a.delete(u):a.set(u,f),l=l.add(u)}return new $g(n.key,a,new Zl(l.toArray()),Zu.none())}}function q4e(n,e,i){n instanceof _R?function(l,u,f){const _=l.value.clone(),E=rJ(l.fieldTransforms,u,f.transformResults);_.setAll(E),u.convertToFoundDocument(f.version,_).setHasCommittedMutations()}(n,e,i):n instanceof $g?function(l,u,f){if(!mk(l.precondition,u))return void u.convertToUnknownDocument(f.version);const _=rJ(l.fieldTransforms,u,f.transformResults),E=u.data;E.setAll(Gie(l)),E.setAll(_),u.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(n,e,i):function(l,u,f){u.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,i)}function gC(n,e,i,a){return n instanceof _R?function(u,f,_,E){if(!mk(u.precondition,f))return _;const b=u.value.clone(),C=iJ(u.fieldTransforms,E,f);return b.setAll(C),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null}(n,e,i,a):n instanceof $g?function(u,f,_,E){if(!mk(u.precondition,f))return _;const b=iJ(u.fieldTransforms,E,f),C=f.data;return C.setAll(Gie(u)),C.setAll(b),f.convertToFoundDocument(f.version,C).setHasLocalMutations(),_===null?null:_.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(I=>I.field))}(n,e,i,a):function(u,f,_){return mk(u.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):_}(n,e,i)}function Y4e(n,e){let i=null;for(const a of n.fieldTransforms){const l=e.data.field(a.field),u=Vie(a.transform,l||null);u!=null&&(i===null&&(i=vl.empty()),i.set(a.field,u))}return i||null}function nJ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&R0(a,l,(u,f)=>$4e(u,f))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class _R extends r1{constructor(e,i,a,l=[]){super(),this.key=e,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class $g extends r1{constructor(e,i,a,l,u=[]){super(),this.key=e,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function Gie(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=n.data.field(i);e.set(i,a)}}),e}function rJ(n,e,i){const a=new Map;mi(n.length===i.length);for(let l=0;l<i.length;l++){const u=n[l],f=u.transform,_=e.data.field(u.field);a.set(u.field,H4e(f,_,i[l]))}return a}function iJ(n,e,i){const a=new Map;for(const l of n){const u=l.transform,f=i.data.field(l.field);a.set(l.field,G4e(u,f,e))}return a}class c4 extends r1{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class X4e extends r1{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4e{constructor(e,i,a,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(e,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&q4e(u,e,a[l])}}applyToLocalView(e,i){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(i=gC(a,e,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(i=gC(a,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const a=Mie();return this.mutations.forEach(l=>{const u=e.get(l.key),f=u.overlayedDocument;let _=this.applyToLocalView(f,u.mutatedFields);_=i.has(l.key)?null:_;const E=Wie(f,_);E!==null&&a.set(l.key,E),f.isValidDocument()||f.convertToNoDocument(er.min())}),a}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Lr())}isEqual(e){return this.batchId===e.batchId&&R0(this.mutations,e.mutations,(i,a)=>nJ(i,a))&&R0(this.baseMutations,e.baseMutations,(i,a)=>nJ(i,a))}}class l4{constructor(e,i,a,l){this.batch=e,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(e,i,a){mi(e.mutations.length===a.length);let l=function(){return F4e}();const u=e.mutations;for(let f=0;f<u.length;f++)l=l.insert(u[f].key,a[f].version);return new l4(e,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var co,Gr;function e3e(n){switch(n){case Pt.OK:return qn();case Pt.CANCELLED:case Pt.UNKNOWN:case Pt.DEADLINE_EXCEEDED:case Pt.RESOURCE_EXHAUSTED:case Pt.INTERNAL:case Pt.UNAVAILABLE:case Pt.UNAUTHENTICATED:return!1;case Pt.INVALID_ARGUMENT:case Pt.NOT_FOUND:case Pt.ALREADY_EXISTS:case Pt.PERMISSION_DENIED:case Pt.FAILED_PRECONDITION:case Pt.ABORTED:case Pt.OUT_OF_RANGE:case Pt.UNIMPLEMENTED:case Pt.DATA_LOSS:return!0;default:return qn()}}function Hie(n){if(n===void 0)return Qf("GRPC error has no .code"),Pt.UNKNOWN;switch(n){case co.OK:return Pt.OK;case co.CANCELLED:return Pt.CANCELLED;case co.UNKNOWN:return Pt.UNKNOWN;case co.DEADLINE_EXCEEDED:return Pt.DEADLINE_EXCEEDED;case co.RESOURCE_EXHAUSTED:return Pt.RESOURCE_EXHAUSTED;case co.INTERNAL:return Pt.INTERNAL;case co.UNAVAILABLE:return Pt.UNAVAILABLE;case co.UNAUTHENTICATED:return Pt.UNAUTHENTICATED;case co.INVALID_ARGUMENT:return Pt.INVALID_ARGUMENT;case co.NOT_FOUND:return Pt.NOT_FOUND;case co.ALREADY_EXISTS:return Pt.ALREADY_EXISTS;case co.PERMISSION_DENIED:return Pt.PERMISSION_DENIED;case co.FAILED_PRECONDITION:return Pt.FAILED_PRECONDITION;case co.ABORTED:return Pt.ABORTED;case co.OUT_OF_RANGE:return Pt.OUT_OF_RANGE;case co.UNIMPLEMENTED:return Pt.UNIMPLEMENTED;case co.DATA_LOSS:return Pt.DATA_LOSS;default:return qn()}}(Gr=co||(co={}))[Gr.OK=0]="OK",Gr[Gr.CANCELLED=1]="CANCELLED",Gr[Gr.UNKNOWN=2]="UNKNOWN",Gr[Gr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Gr[Gr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Gr[Gr.NOT_FOUND=5]="NOT_FOUND",Gr[Gr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Gr[Gr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Gr[Gr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Gr[Gr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Gr[Gr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Gr[Gr.ABORTED=10]="ABORTED",Gr[Gr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Gr[Gr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Gr[Gr.INTERNAL=13]="INTERNAL",Gr[Gr.UNAVAILABLE=14]="UNAVAILABLE",Gr[Gr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t3e=new Ig([4294967295,4294967295],0);function sJ(n){const e=pie().encode(n),i=new oie;return i.update(e),new Uint8Array(i.digest())}function oJ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),a=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new Ig([i,a],0),new Ig([l,u],0)]}class u4{constructor(e,i,a){if(this.bitmap=e,this.padding=i,this.hashCount=a,i<0||i>=8)throw new $w(`Invalid padding: ${i}`);if(a<0)throw new $w(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new $w(`Invalid hash count: ${a}`);if(e.length===0&&i!==0)throw new $w(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Ig.fromNumber(this.Ee)}Ae(e,i,a){let l=e.add(i.multiply(Ig.fromNumber(a)));return l.compare(t3e)===1&&(l=new Ig([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=sJ(e),[a,l]=oJ(i);for(let u=0;u<this.hashCount;u++){const f=this.Ae(a,l,u);if(!this.Re(f))return!1}return!0}static create(e,i,a){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),f=new u4(u,l,i);return a.forEach(_=>f.insert(_)),f}insert(e){if(this.Ee===0)return;const i=sJ(e),[a,l]=oJ(i);for(let u=0;u<this.hashCount;u++){const f=this.Ae(a,l,u);this.Ve(f)}}Ve(e){const i=Math.floor(e/8),a=e%8;this.bitmap[i]|=1<<a}}class $w extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i1{constructor(e,i,a,l,u){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,i,a){const l=new Map;return l.set(e,yR.createSynthesizedTargetChangeForCurrentChange(e,i,a)),new i1(er.min(),l,new ws(vr),Zf(),Lr())}}class yR{constructor(e,i,a,l,u){this.resumeToken=e,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,i,a){return new yR(a,i,Lr(),Lr(),Lr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e,i,a,l){this.me=e,this.removedTargetIds=i,this.key=a,this.fe=l}}class $ie{constructor(e,i){this.targetId=e,this.ge=i}}class Kie{constructor(e,i,a=xa.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=a,this.cause=l}}class aJ{constructor(){this.pe=0,this.ye=cJ(),this.we=xa.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Lr(),i=Lr(),a=Lr();return this.ye.forEach((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:qn()}}),new yR(this.we,this.Se,e,i,a)}Me(){this.be=!1,this.ye=cJ()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,mi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class n3e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Zf(),this.$e=xO(),this.Ue=xO(),this.Ke=new ws(vr)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const a=this.He(i);switch(e.state){case 0:this.Je(i)&&a.Ce(e.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(e.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(i);break;case 3:this.Je(i)&&(a.Le(),a.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),a.Ce(e.resumeToken));break;default:qn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((a,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,a=e.ge.count,l=this.Xe(i);if(l){const u=l.target;if(NV(u))if(a===0){const f=new Pn(u.path);this.ze(i,f,cc.newNoDocument(f,er.min()))}else mi(a===1);else{const f=this.et(i);if(f!==a){const _=this.tt(e),E=_?this.nt(_,e,f):1;if(E!==0){this.Ye(i);const b=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,b)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:u=0}=i;let f,_;try{f=Lg(a).toUint8Array()}catch(E){if(E instanceof _ie)return C0("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{_=new u4(f,l,u)}catch(E){return C0(E instanceof $w?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return _.Ee===0?null:_}nt(e,i,a){return i.ge.count===a-this.st(e,i.targetId)?0:2}st(e,i){const a=this.ke.getRemoteKeysForTarget(i);let l=0;return a.forEach(u=>{const f=this.ke.it(),_=`projects/${f.projectId}/databases/${f.database}/documents/${u.path.canonicalString()}`;e.mightContain(_)||(this.ze(i,u,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((u,f)=>{const _=this.Xe(f);if(_){if(u.current&&NV(_.target)){const E=new Pn(_.target.path);this._t(E).has(f)||this.ut(f,E)||this.ze(f,E,cc.newNoDocument(E,e))}u.ve&&(i.set(f,u.Fe()),u.Me())}});let a=Lr();this.Ue.forEach((u,f)=>{let _=!0;f.forEachWhile(E=>{const b=this.Xe(E);return!b||b.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)}),_&&(a=a.add(u))}),this.Qe.forEach((u,f)=>f.setReadTime(e));const l=new i1(e,i,this.Ke,this.Qe,a);return this.Qe=Zf(),this.$e=xO(),this.Ue=xO(),this.Ke=new ws(vr),l}Ge(e,i){if(!this.Je(e))return;const a=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,a),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,a){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),a&&(this.Qe=this.Qe.insert(i,a))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new aJ,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new xo(vr),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new xo(vr),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||rn("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new aJ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function xO(){return new ws(Pn.comparator)}function cJ(){return new ws(Pn.comparator)}const r3e={asc:"ASCENDING",desc:"DESCENDING"},i3e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},s3e={and:"AND",or:"OR"};class o3e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function xV(n,e){return n.useProto3Json||QN(e)?e:{value:e}}function nN(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qie(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function a3e(n,e){return nN(n,e.toTimestamp())}function bp(n){return mi(!!n),er.fromTimestamp(function(i){const a=xg(i);return new Do(a.seconds,a.nanos)}(n))}function d4(n,e){return LV(n,e).canonicalString()}function LV(n,e){const i=function(l){return new rs(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Yie(n){const e=rs.fromString(n);return mi(ese(e)),e}function MV(n,e){return d4(n.databaseId,e.path)}function aU(n,e){const i=Yie(e);if(i.get(1)!==n.databaseId.projectId)throw new un(Pt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new un(Pt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Pn(Jie(i))}function Xie(n,e){return d4(n.databaseId,e)}function c3e(n){const e=Yie(n);return e.length===4?rs.emptyPath():Jie(e)}function UV(n){return new rs(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Jie(n){return mi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function lJ(n,e,i){return{name:MV(n,e),fields:i.value.mapValue.fields}}function l3e(n,e){let i;if("targetChange"in e){e.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:qn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=function(b,C){return b.useProto3Json?(mi(C===void 0||typeof C=="string"),xa.fromBase64String(C||"")):(mi(C===void 0||C instanceof Buffer||C instanceof Uint8Array),xa.fromUint8Array(C||new Uint8Array))}(n,e.targetChange.resumeToken),f=e.targetChange.cause,_=f&&function(b){const C=b.code===void 0?Pt.UNKNOWN:Hie(b.code);return new un(C,b.message||"")}(f);i=new Kie(a,l,u,_||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const l=aU(n,a.document.name),u=bp(a.document.updateTime),f=a.document.createTime?bp(a.document.createTime):er.min(),_=new vl({mapValue:{fields:a.document.fields}}),E=cc.newFoundDocument(l,u,f,_),b=a.targetIds||[],C=a.removedTargetIds||[];i=new gk(b,C,E.key,E)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const l=aU(n,a.document),u=a.readTime?bp(a.readTime):er.min(),f=cc.newNoDocument(l,u),_=a.removedTargetIds||[];i=new gk([],_,f.key,f)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const l=aU(n,a.document),u=a.removedTargetIds||[];i=new gk([],u,l,null)}else{if(!("filter"in e))return qn();{e.filter;const a=e.filter;a.targetId;const{count:l=0,unchangedNames:u}=a,f=new Z4e(l,u),_=a.targetId;i=new $ie(_,f)}}return i}function u3e(n,e){let i;if(e instanceof _R)i={update:lJ(n,e.key,e.value)};else if(e instanceof c4)i={delete:MV(n,e.key)};else if(e instanceof $g)i={update:lJ(n,e.key,e.data),updateMask:E3e(e.fieldMask)};else{if(!(e instanceof X4e))return qn();i={verify:MV(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(a=>function(u,f){const _=f.transform;if(_ instanceof eN)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof P0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof O0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof tN)return{fieldPath:f.field.canonicalString(),increment:_.Ie};throw qn()}(0,a))),e.precondition.isNone||(i.currentDocument=function(l,u){return u.updateTime!==void 0?{updateTime:a3e(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:qn()}(n,e.precondition)),i}function d3e(n,e){return n&&n.length>0?(mi(e!==void 0),n.map(i=>function(l,u){let f=l.updateTime?bp(l.updateTime):bp(u);return f.isEqual(er.min())&&(f=bp(u)),new K4e(f,l.transformResults||[])}(i,e))):[]}function h3e(n,e){return{documents:[Xie(n,e.path)]}}function p3e(n,e){const i={structuredQuery:{}},a=e.path;let l;e.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=Xie(n,l);const u=function(b){if(b.length!==0)return Zie(ih.create(b,"and"))}(e.filters);u&&(i.structuredQuery.where=u);const f=function(b){if(b.length!==0)return b.map(C=>function(O){return{field:NS(O.field),direction:g3e(O.dir)}}(C))}(e.orderBy);f&&(i.structuredQuery.orderBy=f);const _=xV(n,e.limit);return _!==null&&(i.structuredQuery.limit=_),e.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(e.endAt)),{ht:i,parent:l}}function f3e(n){let e=c3e(n.parent);const i=n.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){mi(a===1);const C=i.from[0];C.allDescendants?l=C.collectionId:e=e.child(C.collectionId)}let u=[];i.where&&(u=function(I){const O=Qie(I);return O instanceof ih&&Iie(O)?O.getFilters():[O]}(i.where));let f=[];i.orderBy&&(f=function(I){return I.map(O=>function(M){return new Qk(DS(M.field),function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(M.direction))}(O))}(i.orderBy));let _=null;i.limit&&(_=function(I){let O;return O=typeof I=="object"?I.value:I,QN(O)?null:O}(i.limit));let E=null;i.startAt&&(E=function(I){const O=!!I.before,L=I.values||[];return new Jk(L,O)}(i.startAt));let b=null;return i.endAt&&(b=function(I){const O=!I.before,L=I.values||[];return new Jk(L,O)}(i.endAt)),x4e(e,l,f,u,_,"F",E,b)}function m3e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return qn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function Qie(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=DS(i.unaryFilter.field);return po.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=DS(i.unaryFilter.field);return po.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=DS(i.unaryFilter.field);return po.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=DS(i.unaryFilter.field);return po.create(f,"!=",{nullValue:"NULL_VALUE"});default:return qn()}}(n):n.fieldFilter!==void 0?function(i){return po.create(DS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return qn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return ih.create(i.compositeFilter.filters.map(a=>Qie(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return qn()}}(i.compositeFilter.op))}(n):qn()}function g3e(n){return r3e[n]}function _3e(n){return i3e[n]}function y3e(n){return s3e[n]}function NS(n){return{fieldPath:n.canonicalString()}}function DS(n){return Da.fromServerFormat(n.fieldPath)}function Zie(n){return n instanceof po?function(i){if(i.op==="=="){if(XX(i.value))return{unaryFilter:{field:NS(i.field),op:"IS_NAN"}};if(YX(i.value))return{unaryFilter:{field:NS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(XX(i.value))return{unaryFilter:{field:NS(i.field),op:"IS_NOT_NAN"}};if(YX(i.value))return{unaryFilter:{field:NS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:NS(i.field),op:_3e(i.op),value:i.value}}}(n):n instanceof ih?function(i){const a=i.getFilters().map(l=>Zie(l));return a.length===1?a[0]:{compositeFilter:{op:y3e(i.op),filters:a}}}(n):qn()}function E3e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function ese(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,i,a,l,u=er.min(),f=er.min(),_=xa.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=_,this.expectedCount=E}withSequenceNumber(e){return new wg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new wg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v3e{constructor(e){this.Tt=e}}function S3e(n){const e=f3e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Zk(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b3e{constructor(){this.Tn=new T3e}addToCollectionParentIndex(e,i){return this.Tn.add(i),At.resolve()}getCollectionParents(e,i){return At.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return At.resolve()}deleteFieldIndex(e,i){return At.resolve()}deleteAllFieldIndexes(e){return At.resolve()}createTargetIndexes(e,i){return At.resolve()}getDocumentsMatchingTarget(e,i){return At.resolve(null)}getIndexType(e,i){return At.resolve(0)}getFieldIndexes(e,i){return At.resolve([])}getNextCollectionGroupToUpdate(e){return At.resolve(null)}getMinOffset(e,i){return At.resolve(Dg.min())}getMinOffsetFromCollectionGroup(e,i){return At.resolve(Dg.min())}updateCollectionGroup(e,i,a){return At.resolve()}updateIndexEntries(e,i){return At.resolve()}}class T3e{constructor(){this.index={}}add(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i]||new xo(rs.comparator),u=!l.has(a);return this.index[i]=l.add(a),u}has(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(e){return(this.index[e]||new xo(rs.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},tse=41943040;class _l{static withCacheSize(e){return new _l(e,_l.DEFAULT_COLLECTION_PERCENTILE,_l.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_l.DEFAULT_COLLECTION_PERCENTILE=10,_l.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,_l.DEFAULT=new _l(tse,_l.DEFAULT_COLLECTION_PERCENTILE,_l.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),_l.DISABLED=new _l(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new k0(0)}static Kn(){return new k0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dJ="LruGarbageCollector",w3e=1048576;function hJ([n,e],[i,a]){const l=vr(n,i);return l===0?vr(e,a):l}class C3e{constructor(e){this.Hn=e,this.buffer=new xo(hJ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();hJ(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class R3e{constructor(e,i,a){this.garbageCollector=e,this.asyncQueue=i,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){rn(dJ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){K0(i)?rn(dJ,"Ignoring IndexedDB error during garbage collection: ",i):await $0(i)}await this.er(3e5)})}}class I3e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(a=>Math.floor(i/100*a))}nthSequenceNumber(e,i){if(i===0)return At.resolve(JN.ae);const a=new C3e(i);return this.tr.forEachTarget(e,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(e,i,a){return this.tr.removeTargets(e,i,a)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(rn("LruGarbageCollector","Garbage collection skipped; disabled"),At.resolve(uJ)):this.getCacheSize(e).next(a=>a<this.params.cacheSizeCollectionThreshold?(rn("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),uJ):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let a,l,u,f,_,E,b;const C=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(rn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(e,l))).next(I=>(a=I,_=Date.now(),this.removeTargets(e,a,i))).next(I=>(u=I,E=Date.now(),this.removeOrphanedDocuments(e,a))).next(I=>(b=Date.now(),OS()<=xr.DEBUG&&rn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-C}ms
	Determined least recently used ${l} in `+(_-f)+`ms
	Removed ${u} targets in `+(E-_)+`ms
	Removed ${I} documents in `+(b-E)+`ms
Total Duration: ${b-C}ms`),At.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:I})))}}function A3e(n,e){return new I3e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P3e{constructor(){this.changes=new Zy(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,cc.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?At.resolve(a):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O3e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k3e{constructor(e,i,a,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(e,i){let a=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(a!==null&&gC(a.mutation,l,Zl.empty(),Do.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.getLocalViewOfDocuments(e,a,Lr()).next(()=>a))}getLocalViewOfDocuments(e,i,a=Lr()){const l=wy();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,a).next(u=>{let f=Hw();return u.forEach((_,E)=>{f=f.insert(_,E.overlayedDocument)}),f}))}getOverlayedDocuments(e,i){const a=wy();return this.populateOverlays(e,a,i).next(()=>this.computeViews(e,i,a,Lr()))}populateOverlays(e,i,a){const l=[];return a.forEach(u=>{i.has(u)||l.push(u)}),this.documentOverlayCache.getOverlays(e,l).next(u=>{u.forEach((f,_)=>{i.set(f,_)})})}computeViews(e,i,a,l){let u=Zf();const f=mC(),_=function(){return mC()}();return i.forEach((E,b)=>{const C=a.get(b.key);l.has(b.key)&&(C===void 0||C.mutation instanceof $g)?u=u.insert(b.key,b):C!==void 0?(f.set(b.key,C.mutation.getFieldMask()),gC(C.mutation,b,C.mutation.getFieldMask(),Do.now())):f.set(b.key,Zl.empty())}),this.recalculateAndSaveOverlays(e,u).next(E=>(E.forEach((b,C)=>f.set(b,C)),i.forEach((b,C)=>{var I;return _.set(b,new O3e(C,(I=f.get(b))!==null&&I!==void 0?I:null))}),_))}recalculateAndSaveOverlays(e,i){const a=mC();let l=new ws((f,_)=>f-_),u=Lr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(f=>{for(const _ of f)_.keys().forEach(E=>{const b=i.get(E);if(b===null)return;let C=a.get(E)||Zl.empty();C=_.applyToLocalView(b,C),a.set(E,C);const I=(l.get(_.batchId)||Lr()).add(E);l=l.insert(_.batchId,I)})}).next(()=>{const f=[],_=l.getReverseIterator();for(;_.hasNext();){const E=_.getNext(),b=E.key,C=E.value,I=Mie();C.forEach(O=>{if(!u.has(O)){const L=Wie(i.get(O),a.get(O));L!==null&&I.set(O,L),u=u.add(O)}}),f.push(this.documentOverlayCache.saveOverlays(e,b,I))}return At.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,i,a,l){return function(f){return Pn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):kie(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,a,l):this.getDocumentsMatchingCollectionQuery(e,i,a,l)}getNextDocuments(e,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,a,l).next(u=>{const f=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,a.largestBatchId,l-u.size):At.resolve(wy());let _=WC,E=u;return f.next(b=>At.forEach(b,(C,I)=>(_<I.largestBatchId&&(_=I.largestBatchId),u.get(C)?At.resolve():this.remoteDocumentCache.getEntry(e,C).next(O=>{E=E.insert(C,O)}))).next(()=>this.populateOverlays(e,b,u)).next(()=>this.computeViews(e,E,b,Lr())).next(C=>({batchId:_,changes:Lie(C)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Pn(i)).next(a=>{let l=Hw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,a,l){const u=i.collectionGroup;let f=Hw();return this.indexManager.getCollectionParents(e,u).next(_=>At.forEach(_,E=>{const b=function(I,O){return new gR(O,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,E.child(u));return this.getDocumentsMatchingCollectionQuery(e,b,a,l).next(C=>{C.forEach((I,O)=>{f=f.insert(I,O)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(e,i,a,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,a.largestBatchId).next(f=>(u=f,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,a,u,l))).next(f=>{u.forEach((E,b)=>{const C=b.getKey();f.get(C)===null&&(f=f.insert(C,cc.newInvalidDocument(C)))});let _=Hw();return f.forEach((E,b)=>{const C=u.get(E);C!==void 0&&gC(C.mutation,b,Zl.empty(),Do.now()),t1(i,b)&&(_=_.insert(E,b))}),_})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N3e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return At.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:bp(l.createTime)}}(i)),At.resolve()}getNamedQuery(e,i){return At.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:S3e(l.bundledQuery),readTime:bp(l.readTime)}}(i)),At.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D3e{constructor(){this.overlays=new ws(Pn.comparator),this.Rr=new Map}getOverlay(e,i){return At.resolve(this.overlays.get(i))}getOverlays(e,i){const a=wy();return At.forEach(i,l=>this.getOverlay(e,l).next(u=>{u!==null&&a.set(l,u)})).next(()=>a)}saveOverlays(e,i,a){return a.forEach((l,u)=>{this.Et(e,i,u)}),At.resolve()}removeOverlaysForBatchId(e,i,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(u=>this.overlays=this.overlays.remove(u)),this.Rr.delete(a)),At.resolve()}getOverlaysForCollection(e,i,a){const l=wy(),u=i.length+1,f=new Pn(i.child("")),_=this.overlays.getIteratorFrom(f);for(;_.hasNext();){const E=_.getNext().value,b=E.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===u&&E.largestBatchId>a&&l.set(E.getKey(),E)}return At.resolve(l)}getOverlaysForCollectionGroup(e,i,a,l){let u=new ws((b,C)=>b-C);const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>a){let C=u.get(b.largestBatchId);C===null&&(C=wy(),u=u.insert(b.largestBatchId,C)),C.set(b.getKey(),b)}}const _=wy(),E=u.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach((b,C)=>_.set(b,C)),!(_.size()>=l)););return At.resolve(_)}Et(e,i,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new Q4e(i,a));let u=this.Rr.get(i);u===void 0&&(u=Lr(),this.Rr.set(i,u)),this.Rr.set(i,u.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x3e{constructor(){this.sessionToken=xa.EMPTY_BYTE_STRING}getSessionToken(e){return At.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,At.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(){this.Vr=new xo(ta.mr),this.gr=new xo(ta.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const a=new ta(e,i);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(e,i){e.forEach(a=>this.addReference(a,i))}removeReference(e,i){this.wr(new ta(e,i))}Sr(e,i){e.forEach(a=>this.removeReference(a,i))}br(e){const i=new Pn(new rs([])),a=new ta(i,e),l=new ta(i,e+1),u=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),u.push(f.key)}),u}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new Pn(new rs([])),a=new ta(i,e),l=new ta(i,e+1);let u=Lr();return this.gr.forEachInRange([a,l],f=>{u=u.add(f.key)}),u}containsKey(e){const i=new ta(e,0),a=this.Vr.firstAfterOrEqual(i);return a!==null&&e.isEqual(a.key)}}class ta{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return Pn.comparator(e.key,i.key)||vr(e.Cr,i.Cr)}static pr(e,i){return vr(e.Cr,i.Cr)||Pn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L3e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new xo(ta.mr)}checkEmpty(e){return At.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,a,l){const u=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new J4e(u,i,a,l);this.mutationQueue.push(f);for(const _ of l)this.Mr=this.Mr.add(new ta(_.key,u)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return At.resolve(f)}lookupMutationBatch(e,i){return At.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const a=i+1,l=this.Nr(a),u=l<0?0:l;return At.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return At.resolve(this.mutationQueue.length===0?t4:this.Fr-1)}getAllMutationBatches(e){return At.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const a=new ta(i,0),l=new ta(i,Number.POSITIVE_INFINITY),u=[];return this.Mr.forEachInRange([a,l],f=>{const _=this.Or(f.Cr);u.push(_)}),At.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,i){let a=new xo(vr);return i.forEach(l=>{const u=new ta(l,0),f=new ta(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([u,f],_=>{a=a.add(_.Cr)})}),At.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(e,i){const a=i.path,l=a.length+1;let u=a;Pn.isDocumentKey(u)||(u=u.child(""));const f=new ta(new Pn(u),0);let _=new xo(vr);return this.Mr.forEachWhile(E=>{const b=E.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(_=_.add(E.Cr)),!0)},f),At.resolve(this.Br(_))}Br(e){const i=[];return e.forEach(a=>{const l=this.Or(a);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){mi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return At.forEach(i.mutations,l=>{const u=new ta(l.key,i.batchId);return a=a.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=a})}qn(e){}containsKey(e,i){const a=new ta(i,0),l=this.Mr.firstAfterOrEqual(a);return At.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,At.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M3e{constructor(e){this.kr=e,this.docs=function(){return new ws(Pn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const a=i.key,l=this.docs.get(a),u=l?l.size:0,f=this.kr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:f}),this.size+=f-u,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const a=this.docs.get(i);return At.resolve(a?a.document.mutableCopy():cc.newInvalidDocument(i))}getEntries(e,i){let a=Zf();return i.forEach(l=>{const u=this.docs.get(l);a=a.insert(l,u?u.document.mutableCopy():cc.newInvalidDocument(l))}),At.resolve(a)}getDocumentsMatchingQuery(e,i,a,l){let u=Zf();const f=i.path,_=new Pn(f.child("__id-9223372036854775808__")),E=this.docs.getIteratorFrom(_);for(;E.hasNext();){const{key:b,value:{document:C}}=E.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||h4e(d4e(C),a)<=0||(l.has(C.key)||t1(i,C))&&(u=u.insert(C.key,C.mutableCopy()))}return At.resolve(u)}getAllFromCollectionGroup(e,i,a,l){qn()}qr(e,i){return At.forEach(this.docs,a=>i(a))}newChangeBuffer(e){return new U3e(this)}getSize(e){return At.resolve(this.size)}}class U3e extends P3e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(a)}),At.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V3e{constructor(e){this.persistence=e,this.Qr=new Zy(i=>i4(i),s4),this.lastRemoteSnapshotVersion=er.min(),this.highestTargetId=0,this.$r=0,this.Ur=new h4,this.targetCount=0,this.Kr=k0.Un()}forEachTarget(e,i){return this.Qr.forEach((a,l)=>i(l)),At.resolve()}getLastRemoteSnapshotVersion(e){return At.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return At.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),At.resolve(this.highestTargetId)}setTargetsMetadata(e,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.$r&&(this.$r=i),At.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new k0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,At.resolve()}updateTargetData(e,i){return this.zn(i),At.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,At.resolve()}removeTargets(e,i,a){let l=0;const u=[];return this.Qr.forEach((f,_)=>{_.sequenceNumber<=i&&a.get(_.targetId)===null&&(this.Qr.delete(f),u.push(this.removeMatchingKeysForTargetId(e,_.targetId)),l++)}),At.waitFor(u).next(()=>l)}getTargetCount(e){return At.resolve(this.targetCount)}getTargetData(e,i){const a=this.Qr.get(i)||null;return At.resolve(a)}addMatchingKeys(e,i,a){return this.Ur.yr(i,a),At.resolve()}removeMatchingKeys(e,i,a){this.Ur.Sr(i,a);const l=this.persistence.referenceDelegate,u=[];return l&&i.forEach(f=>{u.push(l.markPotentiallyOrphaned(e,f))}),At.waitFor(u)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),At.resolve()}getMatchingKeysForTargetId(e,i){const a=this.Ur.vr(i);return At.resolve(a)}containsKey(e,i){return At.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nse{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new JN(0),this.zr=!1,this.zr=!0,this.jr=new x3e,this.referenceDelegate=e(this),this.Hr=new V3e(this),this.indexManager=new b3e,this.remoteDocumentCache=function(l){return new M3e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new v3e(i),this.Yr=new N3e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new D3e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let a=this.Wr[e.toKey()];return a||(a=new L3e(i,this.referenceDelegate),this.Wr[e.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,a){rn("MemoryPersistence","Starting transaction:",e);const l=new F3e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(u=>this.referenceDelegate.Xr(l).next(()=>u)).toPromise().then(u=>(l.raiseOnCommittedEvent(),u))}ei(e,i){return At.or(Object.values(this.Wr).map(a=>()=>a.containsKey(e,i)))}}class F3e extends f4e{constructor(e){super(),this.currentSequenceNumber=e}}class p4{constructor(e){this.persistence=e,this.ti=new h4,this.ni=null}static ri(e){return new p4(e)}get ii(){if(this.ni)return this.ni;throw qn()}addReference(e,i,a){return this.ti.addReference(a,i),this.ii.delete(a.toString()),At.resolve()}removeReference(e,i,a){return this.ti.removeReference(a,i),this.ii.add(a.toString()),At.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),At.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(u=>this.ii.add(u.toString()))}).next(()=>a.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return At.forEach(this.ii,a=>{const l=Pn.fromPath(a);return this.si(e,l).next(u=>{u||i.removeEntry(l,er.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(a=>{a?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return At.or([()=>At.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class rN{constructor(e,i){this.persistence=e,this.oi=new Zy(a=>_4e(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=A3e(this,i)}static ri(e,i){return new rN(e,i)}Zr(){}Xr(e){return At.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(a=>i.next(l=>a+l))}sr(e){let i=0;return this.rr(e,a=>{i++}).next(()=>i)}rr(e,i){return At.forEach(this.oi,(a,l)=>this.ar(e,a,l).next(u=>u?At.resolve():i(l)))}removeTargets(e,i,a){return this.persistence.getTargetCache().removeTargets(e,i,a)}removeOrphanedDocuments(e,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.qr(e,f=>this.ar(e,f,i).next(_=>{_||(a++,u.removeEntry(f,er.min()))})).next(()=>u.apply(e)).next(()=>a)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),At.resolve()}removeTarget(e,i){const a=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),At.resolve()}removeReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),At.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),At.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=pk(e.data.value)),i}ar(e,i,a){return At.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return At.resolve(l!==void 0&&l>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f4{constructor(e,i,a,l){this.targetId=e,this.fromCache=i,this.Hi=a,this.Ji=l}static Yi(e,i){let a=Lr(),l=Lr();for(const u of i.docChanges)switch(u.type){case 0:a=a.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new f4(e,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j3e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B3e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return SUe()?8:m4e(uc())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,a,l){const u={result:null};return this.rs(e,i).next(f=>{u.result=f}).next(()=>{if(!u.result)return this.ss(e,i,l,a).next(f=>{u.result=f})}).next(()=>{if(u.result)return;const f=new j3e;return this._s(e,i,f).next(_=>{if(u.result=_,this.Xi)return this.us(e,i,f,_.size)})}).next(()=>u.result)}us(e,i,a,l){return a.documentReadCount<this.es?(OS()<=xr.DEBUG&&rn("QueryEngine","SDK will not create cache indexes for query:",kS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),At.resolve()):(OS()<=xr.DEBUG&&rn("QueryEngine","Query:",kS(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(OS()<=xr.DEBUG&&rn("QueryEngine","The SDK decides to create cache indexes for query:",kS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Sp(i))):At.resolve())}rs(e,i){if(eJ(i))return At.resolve(null);let a=Sp(i);return this.indexManager.getIndexType(e,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=Zk(i,null,"F"),a=Sp(i)),this.indexManager.getDocumentsMatchingTarget(e,a).next(u=>{const f=Lr(...u);return this.ns.getDocuments(e,f).next(_=>this.indexManager.getMinOffset(e,a).next(E=>{const b=this.cs(i,_);return this.ls(i,b,f,E.readTime)?this.rs(e,Zk(i,null,"F")):this.hs(e,b,i,E)}))})))}ss(e,i,a,l){return eJ(i)||l.isEqual(er.min())?At.resolve(null):this.ns.getDocuments(e,a).next(u=>{const f=this.cs(i,u);return this.ls(i,f,a,l)?At.resolve(null):(OS()<=xr.DEBUG&&rn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),kS(i)),this.hs(e,f,i,u4e(l,WC)).next(_=>_))})}cs(e,i){let a=new xo(Die(e));return i.forEach((l,u)=>{t1(e,u)&&(a=a.add(u))}),a}ls(e,i,a,l){if(e.limit===null)return!1;if(a.size!==i.size)return!0;const u=e.limitType==="F"?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}_s(e,i,a){return OS()<=xr.DEBUG&&rn("QueryEngine","Using full collection scan to execute query:",kS(i)),this.ns.getDocumentsMatchingQuery(e,i,Dg.min(),a)}hs(e,i,a,l){return this.ns.getDocumentsMatchingQuery(e,a,l).next(u=>(i.forEach(f=>{u=u.insert(f.key,f)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m4="LocalStore",z3e=3e8;class W3e{constructor(e,i,a,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new ws(vr),this.Is=new Zy(u=>i4(u),s4),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(a)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new k3e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function G3e(n,e,i,a){return new W3e(n,e,i,a)}async function rse(n,e){const i=ir(n);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(u=>(l=u,i.As(e),i.mutationQueue.getAllMutationBatches(a))).next(u=>{const f=[],_=[];let E=Lr();for(const b of l){f.push(b.batchId);for(const C of b.mutations)E=E.add(C.key)}for(const b of u){_.push(b.batchId);for(const C of b.mutations)E=E.add(C.key)}return i.localDocuments.getDocuments(a,E).next(b=>({Rs:b,removedBatchIds:f,addedBatchIds:_}))})})}function H3e(n,e){const i=ir(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=e.batch.keys(),u=i.ds.newChangeBuffer({trackRemovals:!0});return function(_,E,b,C){const I=b.batch,O=I.keys();let L=At.resolve();return O.forEach(M=>{L=L.next(()=>C.getEntry(E,M)).next(F=>{const z=b.docVersions.get(M);mi(z!==null),F.version.compareTo(z)<0&&(I.applyToRemoteDocument(F,b),F.isValidDocument()&&(F.setReadTime(b.commitVersion),C.addEntry(F)))})}),L.next(()=>_.mutationQueue.removeMutationBatch(E,I))}(i,a,e,u).next(()=>u.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(_){let E=Lr();for(let b=0;b<_.mutationResults.length;++b)_.mutationResults[b].transformResults.length>0&&(E=E.add(_.batch.mutations[b].key));return E}(e))).next(()=>i.localDocuments.getDocuments(a,l))})}function ise(n){const e=ir(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function $3e(n,e){const i=ir(n),a=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const f=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const _=[];e.targetChanges.forEach((C,I)=>{const O=l.get(I);if(!O)return;_.push(i.Hr.removeMatchingKeys(u,C.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(u,C.addedDocuments,I)));let L=O.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(I)!==null?L=L.withResumeToken(xa.EMPTY_BYTE_STRING,er.min()).withLastLimboFreeSnapshotVersion(er.min()):C.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(C.resumeToken,a)),l=l.insert(I,L),function(F,z,X){return F.resumeToken.approximateByteSize()===0||z.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=z3e?!0:X.addedDocuments.size+X.modifiedDocuments.size+X.removedDocuments.size>0}(O,L,C)&&_.push(i.Hr.updateTargetData(u,L))});let E=Zf(),b=Lr();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&_.push(i.persistence.referenceDelegate.updateLimboDocument(u,C))}),_.push(K3e(u,f,e.documentUpdates).next(C=>{E=C.Vs,b=C.fs})),!a.isEqual(er.min())){const C=i.Hr.getLastRemoteSnapshotVersion(u).next(I=>i.Hr.setTargetsMetadata(u,u.currentSequenceNumber,a));_.push(C)}return At.waitFor(_).next(()=>f.apply(u)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,E,b)).next(()=>E)}).then(u=>(i.Ts=l,u))}function K3e(n,e,i){let a=Lr(),l=Lr();return i.forEach(u=>a=a.add(u)),e.getEntries(n,a).next(u=>{let f=Zf();return i.forEach((_,E)=>{const b=u.get(_);E.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(_)),E.isNoDocument()&&E.version.isEqual(er.min())?(e.removeEntry(_,E.readTime),f=f.insert(_,E)):!b.isValidDocument()||E.version.compareTo(b.version)>0||E.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(E),f=f.insert(_,E)):rn(m4,"Ignoring outdated watch update for ",_,". Current version:",b.version," Watch version:",E.version)}),{Vs:f,fs:l}})}function q3e(n,e){const i=ir(n);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=t4),i.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function Y3e(n,e){const i=ir(n);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.Hr.getTargetData(a,e).next(u=>u?(l=u,At.resolve(l)):i.Hr.allocateTargetId(a).next(f=>(l=new wg(e,f,"TargetPurposeListen",a.currentSequenceNumber),i.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(a.targetId,a),i.Is.set(e,a.targetId)),a})}async function VV(n,e,i){const a=ir(n),l=a.Ts.get(e),u=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",u,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!K0(f))throw f;rn(m4,`Failed to update sequence numbers for target ${e}: ${f}`)}a.Ts=a.Ts.remove(e),a.Is.delete(l.target)}function pJ(n,e,i){const a=ir(n);let l=er.min(),u=Lr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(E,b,C){const I=ir(E),O=I.Is.get(C);return O!==void 0?At.resolve(I.Ts.get(O)):I.Hr.getTargetData(b,C)}(a,f,Sp(e)).next(_=>{if(_)return l=_.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,_.targetId).next(E=>{u=E})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,e,i?l:er.min(),i?u:Lr())).next(_=>(X3e(a,M4e(e),_),{documents:_,gs:u})))}function X3e(n,e,i){let a=n.Es.get(e)||er.min();i.forEach((l,u)=>{u.readTime.compareTo(a)>0&&(a=u.readTime)}),n.Es.set(e,a)}class fJ{constructor(){this.activeTargetIds=z4e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class J3e{constructor(){this.ho=new fJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,a){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,a){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new fJ,Promise.resolve()}handleUserChange(e,i,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q3e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mJ="ConnectivityMonitor";class gJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){rn(mJ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){rn(mJ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let LO=null;function FV(){return LO===null?LO=function(){return 268435456+Math.round(2147483648*Math.random())}():LO++,"0x"+LO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cU="RestConnection",Z3e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class e5e{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===Yk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(e,i,a,l,u){const f=FV(),_=this.bo(e,i.toUriEncodedString());rn(cU,`Sending RPC '${e}' ${f}:`,_,a);const E={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(E,l,u),this.vo(e,_,E,a).then(b=>(rn(cU,`Received RPC '${e}' ${f}: `,b),b),b=>{throw C0(cU,`RPC '${e}' ${f} failed with error: `,b,"url: ",_,"request:",a),b})}Co(e,i,a,l,u,f){return this.So(e,i,a,l,u)}Do(e,i,a){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+H0}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,u)=>e[u]=l),a&&a.headers.forEach((l,u)=>e[u]=l)}bo(e,i){const a=Z3e[e];return`${this.po}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t5e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ic="WebChannelConnection";class n5e extends e5e{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,a,l){const u=FV();return new Promise((f,_)=>{const E=new aie;E.setWithCredentials(!0),E.listenOnce(cie.COMPLETE,()=>{try{switch(E.getLastErrorCode()){case hk.NO_ERROR:const C=E.getResponseJson();rn(ic,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(C)),f(C);break;case hk.TIMEOUT:rn(ic,`RPC '${e}' ${u} timed out`),_(new un(Pt.DEADLINE_EXCEEDED,"Request time out"));break;case hk.HTTP_ERROR:const I=E.getStatus();if(rn(ic,`RPC '${e}' ${u} failed with status:`,I,"response text:",E.getResponseText()),I>0){let O=E.getResponseJson();Array.isArray(O)&&(O=O[0]);const L=O==null?void 0:O.error;if(L&&L.status&&L.message){const M=function(z){const X=z.toLowerCase().replace(/_/g,"-");return Object.values(Pt).indexOf(X)>=0?X:Pt.UNKNOWN}(L.status);_(new un(M,L.message))}else _(new un(Pt.UNKNOWN,"Server responded with status "+E.getStatus()))}else _(new un(Pt.UNAVAILABLE,"Connection failed."));break;default:qn()}}finally{rn(ic,`RPC '${e}' ${u} completed.`)}});const b=JSON.stringify(l);rn(ic,`RPC '${e}' ${u} sending request:`,l),E.send(i,"POST",b,a,15)})}Wo(e,i,a){const l=FV(),u=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=die(),_=uie(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(E.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Do(E.initMessageHeaders,i,a),E.encodeInitMessageHeaders=!0;const C=u.join("");rn(ic,`Creating RPC '${e}' stream ${l}: ${C}`,E);const I=f.createWebChannel(C,E);let O=!1,L=!1;const M=new t5e({Fo:z=>{L?rn(ic,`Not sending because RPC '${e}' stream ${l} is closed:`,z):(O||(rn(ic,`Opening RPC '${e}' stream ${l} transport.`),I.open(),O=!0),rn(ic,`RPC '${e}' stream ${l} sending:`,z),I.send(z))},Mo:()=>I.close()}),F=(z,X,K)=>{z.listen(X,ne=>{try{K(ne)}catch(oe){setTimeout(()=>{throw oe},0)}})};return F(I,Gw.EventType.OPEN,()=>{L||(rn(ic,`RPC '${e}' stream ${l} transport opened.`),M.Qo())}),F(I,Gw.EventType.CLOSE,()=>{L||(L=!0,rn(ic,`RPC '${e}' stream ${l} transport closed`),M.Uo())}),F(I,Gw.EventType.ERROR,z=>{L||(L=!0,C0(ic,`RPC '${e}' stream ${l} transport errored:`,z),M.Uo(new un(Pt.UNAVAILABLE,"The operation could not be completed")))}),F(I,Gw.EventType.MESSAGE,z=>{var X;if(!L){const K=z.data[0];mi(!!K);const ne=K,oe=(ne==null?void 0:ne.error)||((X=ne[0])===null||X===void 0?void 0:X.error);if(oe){rn(ic,`RPC '${e}' stream ${l} received error:`,oe);const ae=oe.status;let le=function(Q){const ie=co[Q];if(ie!==void 0)return Hie(ie)}(ae),Y=oe.message;le===void 0&&(le=Pt.INTERNAL,Y="Unknown error status: "+ae+" with message "+oe.message),L=!0,M.Uo(new un(le,Y)),I.close()}else rn(ic,`RPC '${e}' stream ${l} received:`,K),M.Ko(K)}}),F(_,lie.STAT_EVENT,z=>{z.stat===IV.PROXY?rn(ic,`RPC '${e}' stream ${l} detected buffering proxy`):z.stat===IV.NOPROXY&&rn(ic,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{M.$o()},0),M}}function lU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s1(n){return new o3e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sse{constructor(e,i,a=1e3,l=1.5,u=6e4){this.Ti=e,this.timerId=i,this.Go=a,this.zo=l,this.jo=u,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-a);l>0&&rn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _J="PersistentStream";class ose{constructor(e,i,a,l,u,f,_,E){this.Ti=e,this.n_=a,this.r_=l,this.connection=u,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=_,this.listener=E,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new sse(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===Pt.RESOURCE_EXHAUSTED?(Qf(i.toString()),Qf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===Pt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===i&&this.V_(a,l)},a=>{e(()=>{const l=new un(Pt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(e,i){const a=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return rn(_J,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(rn(_J,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class r5e extends ose{constructor(e,i,a,l,u,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,f),this.serializer=u}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=l3e(this.serializer,e),a=function(u){if(!("targetChange"in u))return er.min();const f=u.targetChange;return f.targetIds&&f.targetIds.length?er.min():f.readTime?bp(f.readTime):er.min()}(e);return this.listener.p_(i,a)}y_(e){const i={};i.database=UV(this.serializer),i.addTarget=function(u,f){let _;const E=f.target;if(_=NV(E)?{documents:h3e(u,E)}:{query:p3e(u,E).ht},_.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){_.resumeToken=qie(u,f.resumeToken);const b=xV(u,f.expectedCount);b!==null&&(_.expectedCount=b)}else if(f.snapshotVersion.compareTo(er.min())>0){_.readTime=nN(u,f.snapshotVersion.toTimestamp());const b=xV(u,f.expectedCount);b!==null&&(_.expectedCount=b)}return _}(this.serializer,e);const a=m3e(this.serializer,e);a&&(i.labels=a),this.I_(i)}w_(e){const i={};i.database=UV(this.serializer),i.removeTarget=e,this.I_(i)}}class i5e extends ose{constructor(e,i,a,l,u,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,f),this.serializer=u}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return mi(!!e.streamToken),this.lastStreamToken=e.streamToken,mi(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){mi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=d3e(e.writeResults,e.commitTime),a=bp(e.commitTime);return this.listener.v_(a,i)}C_(){const e={};e.database=UV(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(a=>u3e(this.serializer,a))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s5e{}class o5e extends s5e{constructor(e,i,a,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new un(Pt.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,f])=>this.connection.So(e,LV(i,a),l,u,f)).catch(u=>{throw u.name==="FirebaseError"?(u.code===Pt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new un(Pt.UNKNOWN,u.toString())})}Co(e,i,a,l,u){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Co(e,LV(i,a),l,f,_,u)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Pt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new un(Pt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class a5e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Qf(i),this.N_=!1):rn("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yy="RemoteStore";class c5e{constructor(e,i,a,l,u){this.localStore=e,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=u,this.z_.To(f=>{a.enqueueAndForget(async()=>{eE(this)&&(rn(Yy,"Restarting streams for network reachability change."),await async function(E){const b=ir(E);b.W_.add(4),await ER(b),b.j_.set("Unknown"),b.W_.delete(4),await o1(b)}(this))})}),this.j_=new a5e(a,l)}}async function o1(n){if(eE(n))for(const e of n.G_)await e(!0)}async function ER(n){for(const e of n.G_)await e(!1)}function ase(n,e){const i=ir(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),E4(i)?y4(i):q0(i).c_()&&_4(i,e))}function g4(n,e){const i=ir(n),a=q0(i);i.K_.delete(e),a.c_()&&cse(i,e),i.K_.size===0&&(a.c_()?a.P_():eE(i)&&i.j_.set("Unknown"))}function _4(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(er.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}q0(n).y_(e)}function cse(n,e){n.H_.Ne(e),q0(n).w_(e)}function y4(n){n.H_=new n3e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),q0(n).start(),n.j_.B_()}function E4(n){return eE(n)&&!q0(n).u_()&&n.K_.size>0}function eE(n){return ir(n).W_.size===0}function lse(n){n.H_=void 0}async function l5e(n){n.j_.set("Online")}async function u5e(n){n.K_.forEach((e,i)=>{_4(n,e)})}async function d5e(n,e){lse(n),E4(n)?(n.j_.q_(e),y4(n)):n.j_.set("Unknown")}async function h5e(n,e,i){if(n.j_.set("Online"),e instanceof Kie&&e.state===2&&e.cause)try{await async function(l,u){const f=u.cause;for(const _ of u.targetIds)l.K_.has(_)&&(await l.remoteSyncer.rejectListen(_,f),l.K_.delete(_),l.H_.removeTarget(_))}(n,e)}catch(a){rn(Yy,"Failed to remove targets %s: %s ",e.targetIds.join(","),a),await iN(n,a)}else if(e instanceof gk?n.H_.We(e):e instanceof $ie?n.H_.Ze(e):n.H_.je(e),!i.isEqual(er.min()))try{const a=await ise(n.localStore);i.compareTo(a)>=0&&await function(u,f){const _=u.H_.ot(f);return _.targetChanges.forEach((E,b)=>{if(E.resumeToken.approximateByteSize()>0){const C=u.K_.get(b);C&&u.K_.set(b,C.withResumeToken(E.resumeToken,f))}}),_.targetMismatches.forEach((E,b)=>{const C=u.K_.get(E);if(!C)return;u.K_.set(E,C.withResumeToken(xa.EMPTY_BYTE_STRING,C.snapshotVersion)),cse(u,E);const I=new wg(C.target,E,b,C.sequenceNumber);_4(u,I)}),u.remoteSyncer.applyRemoteEvent(_)}(n,i)}catch(a){rn(Yy,"Failed to raise snapshot:",a),await iN(n,a)}}async function iN(n,e,i){if(!K0(e))throw e;n.W_.add(1),await ER(n),n.j_.set("Offline"),i||(i=()=>ise(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{rn(Yy,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await o1(n)})}function use(n,e){return e().catch(i=>iN(n,i,e))}async function a1(n){const e=ir(n),i=Ug(e);let a=e.U_.length>0?e.U_[e.U_.length-1].batchId:t4;for(;p5e(e);)try{const l=await q3e(e.localStore,a);if(l===null){e.U_.length===0&&i.P_();break}a=l.batchId,f5e(e,l)}catch(l){await iN(e,l)}dse(e)&&hse(e)}function p5e(n){return eE(n)&&n.U_.length<10}function f5e(n,e){n.U_.push(e);const i=Ug(n);i.c_()&&i.S_&&i.b_(e.mutations)}function dse(n){return eE(n)&&!Ug(n).u_()&&n.U_.length>0}function hse(n){Ug(n).start()}async function m5e(n){Ug(n).C_()}async function g5e(n){const e=Ug(n);for(const i of n.U_)e.b_(i.mutations)}async function _5e(n,e,i){const a=n.U_.shift(),l=l4.from(a,e,i);await use(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await a1(n)}async function y5e(n,e){e&&Ug(n).S_&&await async function(a,l){if(function(f){return e3e(f)&&f!==Pt.ABORTED}(l.code)){const u=a.U_.shift();Ug(a).h_(),await use(a,()=>a.remoteSyncer.rejectFailedWrite(u.batchId,l)),await a1(a)}}(n,e),dse(n)&&hse(n)}async function yJ(n,e){const i=ir(n);i.asyncQueue.verifyOperationInProgress(),rn(Yy,"RemoteStore received new credentials");const a=eE(i);i.W_.add(3),await ER(i),a&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await o1(i)}async function E5e(n,e){const i=ir(n);e?(i.W_.delete(2),await o1(i)):e||(i.W_.add(2),await ER(i),i.j_.set("Unknown"))}function q0(n){return n.J_||(n.J_=function(i,a,l){const u=ir(i);return u.M_(),new r5e(a,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:l5e.bind(null,n),No:u5e.bind(null,n),Lo:d5e.bind(null,n),p_:h5e.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),E4(n)?y4(n):n.j_.set("Unknown")):(await n.J_.stop(),lse(n))})),n.J_}function Ug(n){return n.Y_||(n.Y_=function(i,a,l){const u=ir(i);return u.M_(),new i5e(a,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:m5e.bind(null,n),Lo:y5e.bind(null,n),D_:g5e.bind(null,n),v_:_5e.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await a1(n)):(await n.Y_.stop(),n.U_.length>0&&(rn(Yy,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4{constructor(e,i,a,l,u){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=u,this.deferred=new Wf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,a,l,u){const f=Date.now()+a,_=new v4(e,i,f,l,u);return _.start(a),_}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new un(Pt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function S4(n,e){if(Qf("AsyncQueue",`${e}: ${n}`),K0(n))return new un(Pt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{static emptySet(e){return new l0(e.comparator)}constructor(e){this.comparator=e?(i,a)=>e(i,a)||Pn.comparator(i.key,a.key):(i,a)=>Pn.comparator(i.key,a.key),this.keyedMap=Hw(),this.sortedSet=new ws(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,a)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof l0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=a.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const a=new l0;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EJ{constructor(){this.Z_=new ws(Pn.comparator)}track(e){const i=e.doc.key,a=this.Z_.get(i);a?e.type!==0&&a.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&a.type!==1?this.Z_=this.Z_.insert(i,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.Z_=this.Z_.remove(i):e.type===1&&a.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):qn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,a)=>{e.push(a)}),e}}class N0{constructor(e,i,a,l,u,f,_,E,b){this.query=e,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=u,this.fromCache=f,this.syncStateChanged=_,this.excludesMetadataChanges=E,this.hasCachedResults=b}static fromInitialDocuments(e,i,a,l,u){const f=[];return i.forEach(_=>{f.push({type:0,doc:_})}),new N0(e,i,l0.emptySet(i),f,a,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&e1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,a=e.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class S5e{constructor(){this.queries=vJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,a){const l=ir(i),u=l.queries;l.queries=vJ(),u.forEach((f,_)=>{for(const E of _.ta)E.onError(a)})})(this,new un(Pt.ABORTED,"Firestore shutting down"))}}function vJ(){return new Zy(n=>Nie(n),e1)}async function pse(n,e){const i=ir(n);let a=3;const l=e.query;let u=i.queries.get(l);u?!u.na()&&e.ra()&&(a=2):(u=new v5e,a=e.ra()?0:1);try{switch(a){case 0:u.ea=await i.onListen(l,!0);break;case 1:u.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(f){const _=S4(f,`Initialization of query '${kS(e.query)}' failed`);return void e.onError(_)}i.queries.set(l,u),u.ta.push(e),e.sa(i.onlineState),u.ea&&e.oa(u.ea)&&b4(i)}async function fse(n,e){const i=ir(n),a=e.query;let l=3;const u=i.queries.get(a);if(u){const f=u.ta.indexOf(e);f>=0&&(u.ta.splice(f,1),u.ta.length===0?l=e.ra()?0:1:!u.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function b5e(n,e){const i=ir(n);let a=!1;for(const l of e){const u=l.query,f=i.queries.get(u);if(f){for(const _ of f.ta)_.oa(l)&&(a=!0);f.ea=l}}a&&b4(i)}function T5e(n,e,i){const a=ir(n),l=a.queries.get(e);if(l)for(const u of l.ta)u.onError(i);a.queries.delete(e)}function b4(n){n.ia.forEach(e=>{e.next()})}var jV,SJ;(SJ=jV||(jV={}))._a="default",SJ.Cache="cache";class mse{constructor(e,i,a){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(e){if(!this.options.includeMetadataChanges){const a=[];for(const l of e.docChanges)l.type!==3&&a.push(l);e=new N0(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const a=i!=="Offline";return(!this.options.Ta||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=N0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==jV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gse{constructor(e){this.key=e}}class _se{constructor(e){this.key=e}}class w5e{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Lr(),this.mutatedKeys=Lr(),this.ya=Die(e),this.wa=new l0(this.ya)}get Sa(){return this.fa}ba(e,i){const a=i?i.Da:new EJ,l=i?i.wa:this.wa;let u=i?i.mutatedKeys:this.mutatedKeys,f=l,_=!1;const E=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((C,I)=>{const O=l.get(C),L=t1(this.query,I)?I:null,M=!!O&&this.mutatedKeys.has(O.key),F=!!L&&(L.hasLocalMutations||this.mutatedKeys.has(L.key)&&L.hasCommittedMutations);let z=!1;O&&L?O.data.isEqual(L.data)?M!==F&&(a.track({type:3,doc:L}),z=!0):this.va(O,L)||(a.track({type:2,doc:L}),z=!0,(E&&this.ya(L,E)>0||b&&this.ya(L,b)<0)&&(_=!0)):!O&&L?(a.track({type:0,doc:L}),z=!0):O&&!L&&(a.track({type:1,doc:O}),z=!0,(E||b)&&(_=!0)),z&&(L?(f=f.add(L),u=F?u.add(C):u.delete(C)):(f=f.delete(C),u=u.delete(C)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const C=this.query.limitType==="F"?f.last():f.first();f=f.delete(C.key),u=u.delete(C.key),a.track({type:1,doc:C})}return{wa:f,Da:a,ls:_,mutatedKeys:u}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,a,l){const u=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const f=e.Da.X_();f.sort((C,I)=>function(L,M){const F=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return qn()}};return F(L)-F(M)}(C.type,I.type)||this.ya(C.doc,I.doc)),this.Ca(a),l=l!=null&&l;const _=i&&!l?this.Fa():[],E=this.pa.size===0&&this.current&&!l?1:0,b=E!==this.ga;return this.ga=E,f.length!==0||b?{snapshot:new N0(this.query,e.wa,u,f,e.mutatedKeys,E===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:_}:{Ma:_}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new EJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Lr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const i=[];return e.forEach(a=>{this.pa.has(a)||i.push(new _se(a))}),this.pa.forEach(a=>{e.has(a)||i.push(new gse(a))}),i}Oa(e){this.fa=e.gs,this.pa=Lr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return N0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const T4="SyncEngine";class C5e{constructor(e,i,a){this.query=e,this.targetId=i,this.view=a}}class R5e{constructor(e){this.key=e,this.Ba=!1}}class I5e{constructor(e,i,a,l,u,f){this.localStore=e,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new Zy(_=>Nie(_),e1),this.qa=new Map,this.Qa=new Set,this.$a=new ws(Pn.comparator),this.Ua=new Map,this.Ka=new h4,this.Wa={},this.Ga=new Map,this.za=k0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function A5e(n,e,i=!0){const a=Tse(n);let l;const u=a.ka.get(e);return u?(a.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.Na()):l=await yse(a,e,i,!0),l}async function P5e(n,e){const i=Tse(n);await yse(i,e,!0,!1)}async function yse(n,e,i,a){const l=await Y3e(n.localStore,Sp(e)),u=l.targetId,f=n.sharedClientState.addLocalQueryTarget(u,i);let _;return a&&(_=await O5e(n,e,u,f==="current",l.resumeToken)),n.isPrimaryClient&&i&&ase(n.remoteStore,l),_}async function O5e(n,e,i,a,l){n.Ha=(I,O,L)=>async function(F,z,X,K){let ne=z.view.ba(X);ne.ls&&(ne=await pJ(F.localStore,z.query,!1).then(({documents:Y})=>z.view.ba(Y,ne)));const oe=K&&K.targetChanges.get(z.targetId),ae=K&&K.targetMismatches.get(z.targetId)!=null,le=z.view.applyChanges(ne,F.isPrimaryClient,oe,ae);return TJ(F,z.targetId,le.Ma),le.snapshot}(n,I,O,L);const u=await pJ(n.localStore,e,!0),f=new w5e(e,u.gs),_=f.ba(u.documents),E=yR.createSynthesizedTargetChangeForCurrentChange(i,a&&n.onlineState!=="Offline",l),b=f.applyChanges(_,n.isPrimaryClient,E);TJ(n,i,b.Ma);const C=new C5e(e,i,f);return n.ka.set(e,C),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),b.snapshot}async function k5e(n,e,i){const a=ir(n),l=a.ka.get(e),u=a.qa.get(l.targetId);if(u.length>1)return a.qa.set(l.targetId,u.filter(f=>!e1(f,e))),void a.ka.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await VV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&g4(a.remoteStore,l.targetId),BV(a,l.targetId)}).catch($0)):(BV(a,l.targetId),await VV(a.localStore,l.targetId,!0))}async function N5e(n,e){const i=ir(n),a=i.ka.get(e),l=i.qa.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),g4(i.remoteStore,a.targetId))}async function D5e(n,e,i){const a=j5e(n);try{const l=await function(f,_){const E=ir(f),b=Do.now(),C=_.reduce((L,M)=>L.add(M.key),Lr());let I,O;return E.persistence.runTransaction("Locally write mutations","readwrite",L=>{let M=Zf(),F=Lr();return E.ds.getEntries(L,C).next(z=>{M=z,M.forEach((X,K)=>{K.isValidDocument()||(F=F.add(X))})}).next(()=>E.localDocuments.getOverlayedDocuments(L,M)).next(z=>{I=z;const X=[];for(const K of _){const ne=Y4e(K,I.get(K.key).overlayedDocument);ne!=null&&X.push(new $g(K.key,ne,wie(ne.value.mapValue),Zu.exists(!0)))}return E.mutationQueue.addMutationBatch(L,b,X,_)}).next(z=>{O=z;const X=z.applyToLocalDocumentSet(I,F);return E.documentOverlayCache.saveOverlays(L,z.batchId,X)})}).then(()=>({batchId:O.batchId,changes:Lie(I)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(l.batchId),function(f,_,E){let b=f.Wa[f.currentUser.toKey()];b||(b=new ws(vr)),b=b.insert(_,E),f.Wa[f.currentUser.toKey()]=b}(a,l.batchId,i),await vR(a,l.changes),await a1(a.remoteStore)}catch(l){const u=S4(l,"Failed to persist write");i.reject(u)}}async function Ese(n,e){const i=ir(n);try{const a=await $3e(i.localStore,e);e.targetChanges.forEach((l,u)=>{const f=i.Ua.get(u);f&&(mi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?mi(f.Ba):l.removedDocuments.size>0&&(mi(f.Ba),f.Ba=!1))}),await vR(i,a,e)}catch(a){await $0(a)}}function bJ(n,e,i){const a=ir(n);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ka.forEach((u,f)=>{const _=f.view.sa(e);_.snapshot&&l.push(_.snapshot)}),function(f,_){const E=ir(f);E.onlineState=_;let b=!1;E.queries.forEach((C,I)=>{for(const O of I.ta)O.sa(_)&&(b=!0)}),b&&b4(E)}(a.eventManager,e),l.length&&a.La.p_(l),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function x5e(n,e,i){const a=ir(n);a.sharedClientState.updateQueryState(e,"rejected",i);const l=a.Ua.get(e),u=l&&l.key;if(u){let f=new ws(Pn.comparator);f=f.insert(u,cc.newNoDocument(u,er.min()));const _=Lr().add(u),E=new i1(er.min(),new Map,new ws(vr),f,_);await Ese(a,E),a.$a=a.$a.remove(u),a.Ua.delete(e),w4(a)}else await VV(a.localStore,e,!1).then(()=>BV(a,e,i)).catch($0)}async function L5e(n,e){const i=ir(n),a=e.batch.batchId;try{const l=await H3e(i.localStore,e);Sse(i,a,null),vse(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await vR(i,l)}catch(l){await $0(l)}}async function M5e(n,e,i){const a=ir(n);try{const l=await function(f,_){const E=ir(f);return E.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let C;return E.mutationQueue.lookupMutationBatch(b,_).next(I=>(mi(I!==null),C=I.keys(),E.mutationQueue.removeMutationBatch(b,I))).next(()=>E.mutationQueue.performConsistencyCheck(b)).next(()=>E.documentOverlayCache.removeOverlaysForBatchId(b,C,_)).next(()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,C)).next(()=>E.localDocuments.getDocuments(b,C))})}(a.localStore,e);Sse(a,e,i),vse(a,e),a.sharedClientState.updateMutationState(e,"rejected",i),await vR(a,l)}catch(l){await $0(l)}}function vse(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function Sse(n,e,i){const a=ir(n);let l=a.Wa[a.currentUser.toKey()];if(l){const u=l.get(e);u&&(i?u.reject(i):u.resolve(),l=l.remove(e)),a.Wa[a.currentUser.toKey()]=l}}function BV(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const a of n.qa.get(e))n.ka.delete(a),i&&n.La.Ja(a,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(a=>{n.Ka.containsKey(a)||bse(n,a)})}function bse(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(g4(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),w4(n))}function TJ(n,e,i){for(const a of i)a instanceof gse?(n.Ka.addReference(a.key,e),U5e(n,a)):a instanceof _se?(rn(T4,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,e),n.Ka.containsKey(a.key)||bse(n,a.key)):qn()}function U5e(n,e){const i=e.key,a=i.path.canonicalString();n.$a.get(i)||n.Qa.has(a)||(rn(T4,"New document in limbo: "+i),n.Qa.add(a),w4(n))}function w4(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new Pn(rs.fromString(e)),a=n.za.next();n.Ua.set(a,new R5e(i)),n.$a=n.$a.insert(i,a),ase(n.remoteStore,new wg(Sp(o4(i.path)),a,"TargetPurposeLimboResolution",JN.ae))}}async function vR(n,e,i){const a=ir(n),l=[],u=[],f=[];a.ka.isEmpty()||(a.ka.forEach((_,E)=>{f.push(a.Ha(E,e,i).then(b=>{var C;if((b||i)&&a.isPrimaryClient){const I=b?!b.fromCache:(C=i==null?void 0:i.targetChanges.get(E.targetId))===null||C===void 0?void 0:C.current;a.sharedClientState.updateQueryState(E.targetId,I?"current":"not-current")}if(b){l.push(b);const I=f4.Yi(E.targetId,b);u.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(E,b){const C=ir(E);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>At.forEach(b,O=>At.forEach(O.Hi,L=>C.persistence.referenceDelegate.addReference(I,O.targetId,L)).next(()=>At.forEach(O.Ji,L=>C.persistence.referenceDelegate.removeReference(I,O.targetId,L)))))}catch(I){if(!K0(I))throw I;rn(m4,"Failed to update sequence numbers: "+I)}for(const I of b){const O=I.targetId;if(!I.fromCache){const L=C.Ts.get(O),M=L.snapshotVersion,F=L.withLastLimboFreeSnapshotVersion(M);C.Ts=C.Ts.insert(O,F)}}}(a.localStore,u))}async function V5e(n,e){const i=ir(n);if(!i.currentUser.isEqual(e)){rn(T4,"User change. New user:",e.toKey());const a=await rse(i.localStore,e);i.currentUser=e,function(u,f){u.Ga.forEach(_=>{_.forEach(E=>{E.reject(new un(Pt.CANCELLED,f))})}),u.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await vR(i,a.Rs)}}function F5e(n,e){const i=ir(n),a=i.Ua.get(e);if(a&&a.Ba)return Lr().add(a.key);{let l=Lr();const u=i.qa.get(e);if(!u)return l;for(const f of u){const _=i.ka.get(f);l=l.unionWith(_.view.Sa)}return l}}function Tse(n){const e=ir(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ese.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=F5e.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=x5e.bind(null,e),e.La.p_=b5e.bind(null,e.eventManager),e.La.Ja=T5e.bind(null,e.eventManager),e}function j5e(n){const e=ir(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=L5e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=M5e.bind(null,e),e}class sN{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=s1(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return G3e(this.persistence,new B3e,e.initialUser,this.serializer)}Xa(e){return new nse(p4.ri,this.serializer)}Za(e){return new J3e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}sN.provider={build:()=>new sN};class B5e extends sN{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){mi(this.persistence.referenceDelegate instanceof rN);const a=this.persistence.referenceDelegate.garbageCollector;return new R3e(a,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?_l.withCacheSize(this.cacheSizeBytes):_l.DEFAULT;return new nse(a=>rN.ri(a,i),this.serializer)}}class zV{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>bJ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=V5e.bind(null,this.syncEngine),await E5e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new S5e}()}createDatastore(e){const i=s1(e.databaseInfo.databaseId),a=function(u){return new n5e(u)}(e.databaseInfo);return function(u,f,_,E){return new o5e(u,f,_,E)}(e.authCredentials,e.appCheckCredentials,a,i)}createRemoteStore(e){return function(a,l,u,f,_){return new c5e(a,l,u,f,_)}(this.localStore,this.datastore,e.asyncQueue,i=>bJ(this.syncEngine,i,0),function(){return gJ.D()?new gJ:new Q3e}())}createSyncEngine(e,i){return function(l,u,f,_,E,b,C){const I=new I5e(l,u,f,_,E,b);return C&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const u=ir(l);rn(Yy,"RemoteStore shutting down."),u.W_.add(5),await ER(u),u.z_.shutdown(),u.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}zV.provider={build:()=>new zV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wse{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Qf("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vg="FirestoreClient";class z5e{constructor(e,i,a,l,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=ac.UNAUTHENTICATED,this.clientId=fie.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(a,async f=>{rn(Vg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(rn(Vg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Wf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const a=S4(i,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function uU(n,e){n.asyncQueue.verifyOperationInProgress(),rn(Vg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let a=i.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await rse(e.localStore,l),a=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function wJ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await W5e(n);rn(Vg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(a=>yJ(e.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>yJ(e.remoteStore,l)),n._onlineComponents=e}async function W5e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){rn(Vg,"Using user provided OfflineComponentProvider");try{await uU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===Pt.FAILED_PRECONDITION||l.code===Pt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;C0("Error using user provided cache. Falling back to memory cache: "+i),await uU(n,new sN)}}else rn(Vg,"Using default OfflineComponentProvider"),await uU(n,new B5e(void 0));return n._offlineComponents}async function Cse(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(rn(Vg,"Using user provided OnlineComponentProvider"),await wJ(n,n._uninitializedComponentsProvider._online)):(rn(Vg,"Using default OnlineComponentProvider"),await wJ(n,new zV))),n._onlineComponents}function G5e(n){return Cse(n).then(e=>e.syncEngine)}async function Rse(n){const e=await Cse(n),i=e.eventManager;return i.onListen=A5e.bind(null,e.syncEngine),i.onUnlisten=k5e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=P5e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=N5e.bind(null,e.syncEngine),i}function H5e(n,e,i={}){const a=new Wf;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,_,E,b){const C=new wse({next:O=>{C.su(),f.enqueueAndForget(()=>fse(u,I));const L=O.docs.has(_);!L&&O.fromCache?b.reject(new un(Pt.UNAVAILABLE,"Failed to get document because the client is offline.")):L&&O.fromCache&&E&&E.source==="server"?b.reject(new un(Pt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(O)},error:O=>b.reject(O)}),I=new mse(o4(_.path),C,{includeMetadataChanges:!0,Ta:!0});return pse(u,I)}(await Rse(n),n.asyncQueue,e,i,a)),a.promise}function $5e(n,e,i={}){const a=new Wf;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,_,E,b){const C=new wse({next:O=>{C.su(),f.enqueueAndForget(()=>fse(u,I)),O.fromCache&&E.source==="server"?b.reject(new un(Pt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(O)},error:O=>b.reject(O)}),I=new mse(_,C,{includeMetadataChanges:!0,Ta:!0});return pse(u,I)}(await Rse(n),n.asyncQueue,e,i,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ise(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ase(n,e,i){if(!i)throw new un(Pt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function K5e(n,e,i,a){if(e===!0&&a===!0)throw new un(Pt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function RJ(n){if(!Pn.isDocumentKey(n))throw new un(Pt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function IJ(n){if(Pn.isDocumentKey(n))throw new un(Pt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function c1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":qn()}function sh(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new un(Pt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=c1(n);throw new un(Pt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pse="firestore.googleapis.com",AJ=!0;class PJ{constructor(e){var i,a;if(e.host===void 0){if(e.ssl!==void 0)throw new un(Pt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Pse,this.ssl=AJ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:AJ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=tse;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<w3e)throw new un(Pt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}K5e("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ise((a=e.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new un(Pt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new un(Pt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new un(Pt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class l1{constructor(e,i,a,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new PJ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new un(Pt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new un(Pt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new PJ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new t4e;switch(a.type){case"firstParty":return new s4e(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new un(Pt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=CJ.get(i);a&&(rn("ComponentProvider","Removing Datastore"),CJ.delete(i),a.terminate())}(this),Promise.resolve()}}function q5e(n,e,i,a={}){var l;const u=(n=sh(n,l1))._getSettings(),f=Object.assign(Object.assign({},u),{emulatorOptions:n._getEmulatorOptions()}),_=`${e}:${i}`;u.host!==Pse&&u.host!==_&&C0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const E=Object.assign(Object.assign({},u),{host:_,ssl:!1,emulatorOptions:a});if(!qf(E,f)&&(n._setSettings(E),a.mockUserToken)){let b,C;if(typeof a.mockUserToken=="string")b=a.mockUserToken,C=ac.MOCK_USER;else{b=_re(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new un(Pt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new ac(I)}n._authCredentials=new n4e(new hie(b,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tE{constructor(e,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new tE(this.firestore,e,this._query)}}class Lc{constructor(e,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ag(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Lc(this.firestore,e,this._key)}}class Ag extends tE{constructor(e,i,a){super(e,i,o4(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Lc(this.firestore,null,new Pn(e))}withConverter(e){return new Ag(this.firestore,e,this._path)}}function iu(n,e,...i){if(n=ji(n),Ase("collection","path",e),n instanceof l1){const a=rs.fromString(e,...i);return IJ(a),new Ag(n,null,a)}{if(!(n instanceof Lc||n instanceof Ag))throw new un(Pt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(rs.fromString(e,...i));return IJ(a),new Ag(n.firestore,null,a)}}function Sr(n,e,...i){if(n=ji(n),arguments.length===1&&(e=fie.newId()),Ase("doc","path",e),n instanceof l1){const a=rs.fromString(e,...i);return RJ(a),new Lc(n,null,new Pn(a))}{if(!(n instanceof Lc||n instanceof Ag))throw new un(Pt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(rs.fromString(e,...i));return RJ(a),new Lc(n.firestore,n instanceof Ag?n.converter:null,new Pn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OJ="AsyncQueue";class kJ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new sse(this,"async_queue_retry"),this.Su=()=>{const a=lU();a&&rn(OJ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=e;const i=lU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=lU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Wf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!K0(e))throw e;rn(OJ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let _=f.message||"";return f.stack&&(_=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),_}(a);throw Qf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=i,i}enqueueAfterDelay(e,i,a){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=v4.createAndSchedule(this,e,i,a,u=>this.Fu(u));return this.fu.push(l),l}Du(){this.gu&&qn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}class nE extends l1{constructor(e,i,a,l){super(e,i,a,l),this.type="firestore",this._queue=new kJ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new kJ(e),this._firestoreClient=void 0,await e}}}function _k(n,e){const i=typeof n=="object"?n:$N(),a=typeof n=="string"?n:Yk,l=dR(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const u=Wj("firestore");u&&q5e(l,...u)}return l}function C4(n){if(n._terminated)throw new un(Pt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Y5e(n),n._firestoreClient}function Y5e(n){var e,i,a;const l=n._freezeSettings(),u=function(_,E,b,C){return new v4e(_,E,b,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,Ise(C.experimentalLongPollingOptions),C.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new z5e(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&function(_){const E=_==null?void 0:_._online.build();return{_offline:_==null?void 0:_._offline.build(E),_online:E}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new D0(xa.fromBase64String(e))}catch(i){throw new un(Pt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new D0(xa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new un(Pt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Da(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R4{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new un(Pt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new un(Pt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return vr(this._lat,e._lat)||vr(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I4{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,l){if(a.length!==l.length)return!1;for(let u=0;u<a.length;++u)if(a[u]!==l[u])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5e=/^__.*__$/;class J5e{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return this.fieldMask!==null?new $g(e,this.data,this.fieldMask,i,this.fieldTransforms):new _R(e,this.data,i,this.fieldTransforms)}}class Ose{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return new $g(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function kse(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw qn()}}class d1{constructor(e,i,a,l,u,f){this.settings=e,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,u===void 0&&this.Bu(),this.fieldTransforms=u||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new d1(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.$u(e),l}Uu(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return oN(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(kse(this.Lu)&&X5e.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class Q5e{constructor(e,i,a){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=a||s1(e)}ju(e,i,a,l=!1){return new d1({Lu:e,methodName:i,zu:a,path:Da.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function h1(n){const e=n._freezeSettings(),i=s1(n._databaseId);return new Q5e(n._databaseId,!!e.ignoreUndefinedProperties,i)}function Nse(n,e,i,a,l,u={}){const f=n.ju(u.merge||u.mergeFields?2:0,e,i,l);O4("Data must be an object, but it was:",f,a);const _=xse(a,f);let E,b;if(u.merge)E=new Zl(f.fieldMask),b=f.fieldTransforms;else if(u.mergeFields){const C=[];for(const I of u.mergeFields){const O=WV(e,I,i);if(!f.contains(O))throw new un(Pt.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);Mse(C,O)||C.push(O)}E=new Zl(C),b=f.fieldTransforms.filter(I=>E.covers(I.field))}else E=null,b=f.fieldTransforms;return new J5e(new vl(_),E,b)}class p1 extends SR{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof p1}}function Dse(n,e,i){return new d1({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class A4 extends SR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=Dse(this,e,!0),a=this.Hu.map(u=>rE(u,i)),l=new P0(a);return new zie(e.path,l)}isEqual(e){return e instanceof A4&&qf(this.Hu,e.Hu)}}class P4 extends SR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=Dse(this,e,!0),a=this.Hu.map(u=>rE(u,i)),l=new O0(a);return new zie(e.path,l)}isEqual(e){return e instanceof P4&&qf(this.Hu,e.Hu)}}function Z5e(n,e,i,a){const l=n.ju(1,e,i);O4("Data must be an object, but it was:",l,a);const u=[],f=vl.empty();Hg(a,(E,b)=>{const C=k4(e,E,i);b=ji(b);const I=l.Uu(C);if(b instanceof p1)u.push(C);else{const O=rE(b,I);O!=null&&(u.push(C),f.set(C,O))}});const _=new Zl(u);return new Ose(f,_,l.fieldTransforms)}function eBe(n,e,i,a,l,u){const f=n.ju(1,e,i),_=[WV(e,a,i)],E=[l];if(u.length%2!=0)throw new un(Pt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let O=0;O<u.length;O+=2)_.push(WV(e,u[O])),E.push(u[O+1]);const b=[],C=vl.empty();for(let O=_.length-1;O>=0;--O)if(!Mse(b,_[O])){const L=_[O];let M=E[O];M=ji(M);const F=f.Uu(L);if(M instanceof p1)b.push(L);else{const z=rE(M,F);z!=null&&(b.push(L),C.set(L,z))}}const I=new Zl(b);return new Ose(C,I,f.fieldTransforms)}function tBe(n,e,i,a=!1){return rE(i,n.ju(a?4:3,e))}function rE(n,e){if(Lse(n=ji(n)))return O4("Unsupported field value:",e,n),xse(n,e);if(n instanceof SR)return function(a,l){if(!kse(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const u=a._toFieldTransform(l);u&&l.fieldTransforms.push(u)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(a,l){const u=[];let f=0;for(const _ of a){let E=rE(_,l.Ku(f));E==null&&(E={nullValue:"NULL_VALUE"}),u.push(E),f++}return{arrayValue:{values:u}}}(n,e)}return function(a,l){if((a=ji(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return W4e(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const u=Do.fromDate(a);return{timestampValue:nN(l.serializer,u)}}if(a instanceof Do){const u=new Do(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:nN(l.serializer,u)}}if(a instanceof R4)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof D0)return{bytesValue:qie(l.serializer,a._byteString)};if(a instanceof Lc){const u=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(u))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:d4(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof I4)return function(f,_){return{mapValue:{fields:{[bie]:{stringValue:Tie},[Xk]:{arrayValue:{values:f.toArray().map(b=>{if(typeof b!="number")throw _.Wu("VectorValues must only contain numeric values.");return a4(_.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${c1(a)}`)}(n,e)}function xse(n,e){const i={};return gie(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hg(n,(a,l)=>{const u=rE(l,e.qu(a));u!=null&&(i[a]=u)}),{mapValue:{fields:i}}}function Lse(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Do||n instanceof R4||n instanceof D0||n instanceof Lc||n instanceof SR||n instanceof I4)}function O4(n,e,i){if(!Lse(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=c1(i);throw a==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+a)}}function WV(n,e,i){if((e=ji(e))instanceof u1)return e._internalPath;if(typeof e=="string")return k4(n,e);throw oN("Field path arguments must be of type string or ",n,!1,void 0,i)}const nBe=new RegExp("[~\\*/\\[\\]]");function k4(n,e,i){if(e.search(nBe)>=0)throw oN(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new u1(...e.split("."))._internalPath}catch{throw oN(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function oN(n,e,i,a,l){const u=a&&!a.isEmpty(),f=l!==void 0;let _=`Function ${e}() called with invalid data`;i&&(_+=" (via `toFirestore()`)"),_+=". ";let E="";return(u||f)&&(E+=" (found",u&&(E+=` in field ${a}`),f&&(E+=` in document ${l}`),E+=")"),new un(Pt.INVALID_ARGUMENT,_+n+E)}function Mse(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Use{constructor(e,i,a,l,u){this._firestore=e,this._userDataWriter=i,this._key=a,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new Lc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new rBe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(N4("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class rBe extends Use{data(){return super.data()}}function N4(n,e){return typeof e=="string"?k4(n,e):e instanceof u1?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iBe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new un(Pt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class D4{}class Vse extends D4{}function GV(n,e,...i){let a=[];e instanceof D4&&a.push(e),a=a.concat(i),function(u){const f=u.filter(E=>E instanceof x4).length,_=u.filter(E=>E instanceof f1).length;if(f>1||f>0&&_>0)throw new un(Pt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class f1 extends Vse{constructor(e,i,a){super(),this._field=e,this._op=i,this._value=a,this.type="where"}static _create(e,i,a){return new f1(e,i,a)}_apply(e){const i=this._parse(e);return Fse(e._query,i),new tE(e.firestore,e.converter,DV(e._query,i))}_parse(e){const i=h1(e.firestore);return function(u,f,_,E,b,C,I){let O;if(b.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new un(Pt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){xJ(I,C);const M=[];for(const F of I)M.push(DJ(E,u,F));O={arrayValue:{values:M}}}else O=DJ(E,u,I)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||xJ(I,C),O=tBe(_,f,I,C==="in"||C==="not-in");return po.create(b,C,O)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function NJ(n,e,i){const a=e,l=N4("where",n);return f1._create(l,a,i)}class x4 extends D4{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new x4(e,i)}_parse(e){const i=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:ih.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,u){let f=l;const _=u.getFlattenedFilters();for(const E of _)Fse(f,E),f=DV(f,E)}(e._query,i),new tE(e.firestore,e.converter,DV(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class L4 extends Vse{constructor(e,i,a){super(),this.type=e,this._limit=i,this._limitType=a}static _create(e,i,a){return new L4(e,i,a)}_apply(e){return new tE(e.firestore,e.converter,Zk(e._query,this._limit,this._limitType))}}function sBe(n){return L4._create("limit",n,"F")}function DJ(n,e,i){if(typeof(i=ji(i))=="string"){if(i==="")throw new un(Pt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kie(e)&&i.indexOf("/")!==-1)throw new un(Pt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=e.path.child(rs.fromString(i));if(!Pn.isDocumentKey(a))throw new un(Pt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return qX(n,new Pn(a))}if(i instanceof Lc)return qX(n,i._key);throw new un(Pt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${c1(i)}.`)}function xJ(n,e){if(!Array.isArray(n)||n.length===0)throw new un(Pt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Fse(n,e){const i=function(l,u){for(const f of l)for(const _ of f.getFlattenedFilters())if(u.indexOf(_.op)>=0)return _.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new un(Pt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new un(Pt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class oBe{convertValue(e,i="none"){switch(Mg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Zs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Lg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw qn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const a={};return Hg(e,(l,u)=>{a[l]=this.convertValue(u,i)}),a}convertVectorValue(e){var i,a,l;const u=(l=(a=(i=e.fields)===null||i===void 0?void 0:i[Xk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>Zs(f.doubleValue));return new I4(u)}convertGeoPoint(e){return new R4(Zs(e.latitude),Zs(e.longitude))}convertArray(e,i){return(e.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(e,i){switch(i){case"previous":const a=ZN(e);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(GC(e));default:return null}}convertTimestamp(e){const i=xg(e);return new Do(i.seconds,i.nanos)}convertDocumentKey(e,i){const a=rs.fromString(e);mi(ese(a));const l=new HC(a.get(1),a.get(3)),u=new Pn(a.popFirst(5));return l.isEqual(i)||Qf(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jse(n,e,i){let a;return a=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Bse extends Use{constructor(e,i,a,l,u,f){super(e,i,a,l,f),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new yk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const a=this._document.data.field(N4("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class yk extends Bse{data(e={}){return super.data(e)}}class aBe{constructor(e,i,a,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new Kw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(a=>{e.call(i,new yk(this._firestore,this._userDataWriter,a.key,a,new Kw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new un(Pt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,u){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(_=>{const E=new yk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new Kw(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);return _.doc,{type:"added",doc:E,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(_=>u||_.type!==3).map(_=>{const E=new yk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new Kw(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,C=-1;return _.type!==0&&(b=f.indexOf(_.doc.key),f=f.delete(_.doc.key)),_.type!==1&&(f=f.add(_.doc),C=f.indexOf(_.doc.key)),{type:cBe(_.type),doc:E,oldIndex:b,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function cBe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return qn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lo(n){n=sh(n,Lc);const e=sh(n.firestore,nE);return H5e(C4(e),n._key).then(i=>dBe(e,n,i))}class zse extends oBe{constructor(e){super(),this.firestore=e}convertBytes(e){return new D0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Lc(this.firestore,null,i)}}function ed(n){n=sh(n,tE);const e=sh(n.firestore,nE),i=C4(e),a=new zse(e);return iBe(n._query),$5e(i,n._query).then(l=>new aBe(e,a,n,l))}function Fg(n,e,i){n=sh(n,Lc);const a=sh(n.firestore,nE),l=jse(n.converter,e,i);return m1(a,[Nse(h1(a),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Zu.none())])}function Mo(n,e,i,...a){n=sh(n,Lc);const l=sh(n.firestore,nE),u=h1(l);let f;return f=typeof(e=ji(e))=="string"||e instanceof u1?eBe(u,"updateDoc",n._key,e,i,a):Z5e(u,"updateDoc",n._key,e),m1(l,[f.toMutation(n._key,Zu.exists(!0))])}function lBe(n){return m1(sh(n.firestore,nE),[new c4(n._key,Zu.none())])}function uBe(n,e){const i=sh(n.firestore,nE),a=Sr(n),l=jse(n.converter,e);return m1(i,[Nse(h1(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Zu.exists(!1))]).then(()=>a)}function m1(n,e){return function(a,l){const u=new Wf;return a.asyncQueue.enqueueAndForget(async()=>D5e(await G5e(a),l,u)),u.promise}(C4(n),e)}function dBe(n,e,i){const a=i.docs.get(e._key),l=new zse(n);return new Bse(n,l,e._key,a,new Kw(i.hasPendingWrites,i.fromCache),e.converter)}function hBe(...n){return new A4("arrayUnion",n)}function Wse(...n){return new P4("arrayRemove",n)}(function(e,i=!0){(function(l){H0=l})(Qy),Ng(new Yf("firestore",(a,{instanceIdentifier:l,options:u})=>{const f=a.getProvider("app").getImmediate(),_=new nE(new r4e(a.getProvider("auth-internal")),new o4e(f,a.getProvider("app-check-internal")),function(b,C){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new un(Pt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new HC(b.options.projectId,C)}(f,l),f);return u=Object.assign({useFetchStreams:i},u),_._setSettings(u),_},"PUBLIC").setMultipleInstances(!0)),Qu(MX,UX,e),Qu(MX,UX,"esm2017")})();var pBe="firebase",fBe="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qu(pBe,fBe,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mBe="type.googleapis.com/google.protobuf.Int64Value",gBe="type.googleapis.com/google.protobuf.UInt64Value";function Gse(n,e){const i={};for(const a in n)n.hasOwnProperty(a)&&(i[a]=e(n[a]));return i}function aN(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>aN(e));if(typeof n=="function"||typeof n=="object")return Gse(n,e=>aN(e));throw new Error("Data cannot be encoded in JSON: "+n)}function x0(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case mBe:case gBe:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>x0(e)):typeof n=="function"||typeof n=="object"?Gse(n,e=>x0(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M4="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LJ={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class bl extends ah{constructor(e,i,a){super(`${M4}/${e}`,i||""),this.details=a,Object.setPrototypeOf(this,bl.prototype)}}function _Be(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function cN(n,e){let i=_Be(n),a=i,l;try{const u=e&&e.error;if(u){const f=u.status;if(typeof f=="string"){if(!LJ[f])return new bl("internal","internal");i=LJ[f],a=f}const _=u.message;typeof _=="string"&&(a=_),l=u.details,l!==void 0&&(l=x0(l))}}catch{}return i==="ok"?null:new bl(i,a,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yBe{constructor(e,i,a,l){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,El(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=i.getImmediate({optional:!0}),this.messaging=a.getImmediate({optional:!0}),this.auth||i.get().then(u=>this.auth=u,()=>{}),this.messaging||a.get().then(u=>this.messaging=u,()=>{}),this.appCheck||l==null||l.get().then(u=>this.appCheck=u,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const i=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return i.error?null:i.token}return null}async getContext(e){const i=await this.getAuthToken(),a=await this.getMessagingToken(),l=await this.getAppCheckToken(e);return{authToken:i,messagingToken:a,appCheckToken:l}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HV="us-central1",EBe=/^data: (.*?)(?:\n|$)/;function vBe(n){let e=null;return{promise:new Promise((i,a)=>{e=setTimeout(()=>{a(new bl("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class SBe{constructor(e,i,a,l,u=HV,f=(..._)=>fetch(..._)){this.app=e,this.fetchImpl=f,this.emulatorOrigin=null,this.contextProvider=new yBe(e,i,a,l),this.cancelAllRequests=new Promise(_=>{this.deleteService=()=>Promise.resolve(_())});try{const _=new URL(u);this.customDomain=_.origin+(_.pathname==="/"?"":_.pathname),this.region=HV}catch{this.customDomain=null,this.region=u}}_delete(){return this.deleteService()}_url(e){const i=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${i}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${i}.cloudfunctions.net/${e}`}}function bBe(n,e,i){n.emulatorOrigin=`http://${e}:${i}`}function TBe(n,e,i){const a=l=>CBe(n,e,l,{});return a.stream=(l,u)=>IBe(n,e,l,u),a}async function wBe(n,e,i,a){i["Content-Type"]="application/json";let l;try{l=await a(n,{method:"POST",body:JSON.stringify(e),headers:i})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function Hse(n,e){const i={},a=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return a.authToken&&(i.Authorization="Bearer "+a.authToken),a.messagingToken&&(i["Firebase-Instance-ID-Token"]=a.messagingToken),a.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=a.appCheckToken),i}function CBe(n,e,i,a){const l=n._url(e);return RBe(n,l,i,a)}async function RBe(n,e,i,a){i=aN(i);const l={data:i},u=await Hse(n,a),f=a.timeout||7e4,_=vBe(f),E=await Promise.race([wBe(e,l,u,n.fetchImpl),_.promise,n.cancelAllRequests]);if(_.cancel(),!E)throw new bl("cancelled","Firebase Functions instance was deleted.");const b=cN(E.status,E.json);if(b)throw b;if(!E.json)throw new bl("internal","Response is not valid JSON object.");let C=E.json.data;if(typeof C>"u"&&(C=E.json.result),typeof C>"u")throw new bl("internal","Response is missing data field.");return{data:x0(C)}}function IBe(n,e,i,a){const l=n._url(e);return ABe(n,l,i,a||{})}async function ABe(n,e,i,a){var l;i=aN(i);const u={data:i},f=await Hse(n,a);f["Content-Type"]="application/json",f.Accept="text/event-stream";let _;try{_=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(u),headers:f,signal:a==null?void 0:a.signal})}catch(L){if(L instanceof Error&&L.name==="AbortError"){const F=new bl("cancelled","Request was cancelled.");return{data:Promise.reject(F),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(F)}}}}}}const M=cN(0,null);return{data:Promise.reject(M),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(M)}}}}}}let E,b;const C=new Promise((L,M)=>{E=L,b=M});(l=a==null?void 0:a.signal)===null||l===void 0||l.addEventListener("abort",()=>{const L=new bl("cancelled","Request was cancelled.");b(L)});const I=_.body.getReader(),O=PBe(I,E,b,a==null?void 0:a.signal);return{stream:{[Symbol.asyncIterator](){const L=O.getReader();return{async next(){const{value:M,done:F}=await L.read();return{value:M,done:F}},async return(){return await L.cancel(),{done:!0,value:void 0}}}}},data:C}}function PBe(n,e,i,a){const l=(f,_)=>{const E=f.match(EBe);if(!E)return;const b=E[1];try{const C=JSON.parse(b);if("result"in C){e(x0(C.result));return}if("message"in C){_.enqueue(x0(C.message));return}if("error"in C){const I=cN(0,C);_.error(I),i(I);return}}catch(C){if(C instanceof bl){_.error(C),i(C);return}}},u=new TextDecoder;return new ReadableStream({start(f){let _="";return E();async function E(){if(a!=null&&a.aborted){const b=new bl("cancelled","Request was cancelled");return f.error(b),i(b),Promise.resolve()}try{const{value:b,done:C}=await n.read();if(C){_.trim()&&l(_.trim(),f),f.close();return}if(a!=null&&a.aborted){const O=new bl("cancelled","Request was cancelled");f.error(O),i(O),await n.cancel();return}_+=u.decode(b,{stream:!0});const I=_.split(`
`);_=I.pop()||"";for(const O of I)O.trim()&&l(O.trim(),f);return E()}catch(b){const C=b instanceof bl?b:cN(0,null);f.error(C),i(C)}}},cancel(){return n.cancel()}})}const MJ="@firebase/functions",UJ="0.12.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OBe="auth-internal",kBe="app-check-internal",NBe="messaging-internal";function DBe(n){const e=(i,{instanceIdentifier:a})=>{const l=i.getProvider("app").getImmediate(),u=i.getProvider(OBe),f=i.getProvider(NBe),_=i.getProvider(kBe);return new SBe(l,u,f,_,a)};Ng(new Yf(M4,e,"PUBLIC").setMultipleInstances(!0)),Qu(MJ,UJ,n),Qu(MJ,UJ,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xBe(n=$N(),e=HV){const a=dR(ji(n),M4).getImmediate({identifier:e}),l=Wj("functions");return l&&LBe(a,...l),a}function LBe(n,e,i){bBe(ji(n),e,i)}function U4(n,e,i){return TBe(ji(n),e)}DBe();const MBe=[{key:"VITE_FIREBASE_API_KEY",value:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU"},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:"disruptive-metaverse.firebaseapp.com"},{key:"VITE_FIREBASE_PROJECT_ID",value:"disruptive-metaverse"},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:"disruptive-metaverse.appspot.com"},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:"294433070603"},{key:"VITE_FIREBASE_APP_ID",value:"1:294433070603:web:136cddd196eea9614fb10e"}],$V=MBe.filter(n=>!n.value);if($V.length>0){const e=`Missing environment variables: ${$V.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;$.warn(e),console.warn(e)}const UBe={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},VBe=$V.length>0;$.log(`Firebase initializing with ${VBe?"fallback":"environment"} configuration`);let MO,V4,Qn,g1;try{MO=vre(UBe),V4=XN(MO),Qn=_k(MO),g1=xBe(MO),$.log("Firebase initialized successfully")}catch(n){$.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const qw=n=>!0,VJ=(n,e)=>{const a=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return a+l},$se=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return $.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();$.log(`userFirestore: Checking if username "${e}" is taken`);const i=iu(Qn,"users"),a=GV(i,sBe(100)),l=await ed(a);let u=!1;return l.forEach(f=>{const _=f.data();_.username&&_.username.toLowerCase()===e&&(u=!0)}),$.log(`userFirestore: Username "${e}" is ${u?"taken":"available"}`),u}catch(e){return $.error("userFirestore: Error checking username availability:",e),!0}},FBe=async(n,e)=>{let i=VJ(n,e),a=0;const l=10;for(;a<l;){if(!await $se(i))return i;i=VJ(n,e),a++}return i+Math.floor(Math.random()*100)},su=async n=>{try{$.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=Sr(Qn,"users",n),i=await Lo(e);if(i.exists()){const a=i.data();return $.log("userFirestore: Found PUBLIC Profile for : "+a.Nickname),delete a.email,delete a.emailVerified,a}else return $.error("userFirestore: user profile document not found"),null}catch(e){throw $.error("userFirestore: Error fetching user public profile data:",e),e}},jBe=async(n,e,i)=>{try{if($.log("userFirestore: Starting registerUser process"),$.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw $.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const a={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};$.log("userFirestore: Critical fields captured for registration"),$.log("userFirestore: Creating user auth record");const u=(await VFe(V4,n,e)).user;await Yre(u),$.log("userFirestore: Verification email sent"),$.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(L=>setTimeout(L,5e3));const f=Sr(Qn,"users",u.uid),_=await Lo(f);if(_.exists()){$.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const L=_.data(),M={};L.firstName||(M.firstName=a.firstName),L.lastName||(M.lastName=a.lastName),L.Nickname||(M.Nickname=a.Nickname),L.username||(M.username=a.username),L.companyName||(M.companyName=a.companyName),L.linkedInProfile||(M.linkedInProfile=a.linkedInProfile),L.rpmURL||(M.rpmURL=a.rpmURL),Object.keys(M).length>0&&($.log("userFirestore: Updating document with fields:",Object.keys(M).join(", ")),await Mo(f,{...M,lastUpdated:new Date}))}else{$.error("userFirestore: Cloud Function failed to create user document, creating manually"),await Fg(f,{...a,id:u.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const L=Sr(Qn,"users",u.uid,"private","data");await Fg(L,{email:u.email,emailVerified:!1})}const E=await Lo(f);if(!E.exists())throw new Error("User document does not exist even after creation attempts");let b=E.data();b.firstName||(b.firstName=a.firstName),b.lastName||(b.lastName=a.lastName),b.Nickname||(b.Nickname=a.Nickname),b.username||(b.username=a.username),b.companyName||(b.companyName=a.companyName);let C=!1,I={};for(const L in a)(!b[L]||b[L]==="")&&(I[L]=a[L],C=!0);(!b.groups||!b.groups.includes("users"))&&(I.groups=b.groups?[...b.groups,"users"]:["users"],C=!0,$.log("userFirestore: Adding user to users group")),C&&($.log("userFirestore: Updating user document with missing fields"),$.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await Mo(f,I),b=(await Lo(f)).data());const O={...u,...b,firstName:a.firstName,lastName:a.lastName,Nickname:a.Nickname,username:a.username,companyName:a.companyName,linkedInProfile:a.linkedInProfile};return $.log("userFirestore: Registration complete, returning user data"),$.log("userFirestore: Fields included in return data:",Object.keys(O).join(", ")),O}catch(a){throw $.error("userFirestore: Error creating user:",a),a}},Kse=async(n,e)=>{try{$.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=Sr(Qn,"users",n);await Mo(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),$.log("userFirestore: rpmURL updated successfully.")}catch(i){throw $.error("userFirestore: Error updating rpmURL:",i),i}},BBe=async(n,e)=>{try{const i=await su(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return $.error("userFirestore: Error checking group membership:",i),!1}};var zBe={};const lN=()=>{const n=typeof process<"u"&&zBe&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},WBe=(n,e)=>{if(!lN())return $.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},GBe=(n,e)=>{if(!lN())return $.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},F4=typeof lN=="function"?lN():!1;F4&&$.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const HBe=async(n,e)=>{if(F4)return WBe();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const a=XN().currentUser;if(a&&a.uid===n.uid)try{const u=(await a.getIdTokenResult(!0)).claims.groups||[],f=`space_${e}_owners`;if(u.includes(f))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return $.error("Error checking space owner permissions:",i),!1}},qse=async(n,e)=>{if(F4)return GBe();try{if($.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return $.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await su(n);if($.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if($.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return $.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else $.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=XN().currentUser;if(l&&l.uid===n){const u=await l.getIdTokenResult();if($.log(`userPermissions: Token claims for ${n}:`,u.claims),u.claims&&u.claims.groups&&Array.isArray(u.claims.groups)&&u.claims.groups.includes(e))return $.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(a){$.error("userPermissions: Error checking token claims:",a)}}return $.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return $.error("userPermissions: Error checking if user belongs to group:",i),!1}},$Be=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Qd={sendUserToUnity:"sendUserToUnity",playerInstantiated:"playerInstantiated",firstSceneLoaded:"firstSceneLoaded"};class KBe{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const a=this.events[e];a?(a.forEach(l=>{l(i)}),$.log(`EventBus: Published event '${e}'`)):$.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const a=(l=this.events[e])==null?void 0:l.indexOf(i);a>-1&&this.events[e].splice(a,1)}}const Zd=new KBe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yse="firebasestorage.googleapis.com",Xse="storageBucket",qBe=2*60*1e3,YBe=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs extends ah{constructor(e,i,a=0){super(dU(e),`Firebase Storage: ${i} (${dU(e)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Gs.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return dU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ws;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ws||(Ws={}));function dU(n){return"storage/"+n}function j4(){const n="An unknown error occurred, please check the error payload for server response.";return new Gs(Ws.UNKNOWN,n)}function XBe(n){return new Gs(Ws.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function JBe(n){return new Gs(Ws.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function QBe(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Gs(Ws.UNAUTHENTICATED,n)}function ZBe(){return new Gs(Ws.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function e6e(n){return new Gs(Ws.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function t6e(){return new Gs(Ws.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function n6e(){return new Gs(Ws.CANCELED,"User canceled the upload/download.")}function r6e(n){return new Gs(Ws.INVALID_URL,"Invalid URL '"+n+"'.")}function i6e(n){return new Gs(Ws.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function s6e(){return new Gs(Ws.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Xse+"' property when initializing the app?")}function o6e(){return new Gs(Ws.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function a6e(){return new Gs(Ws.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function c6e(n){return new Gs(Ws.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function KV(n){return new Gs(Ws.INVALID_ARGUMENT,n)}function Jse(){return new Gs(Ws.APP_DELETED,"The Firebase app was deleted.")}function l6e(n){return new Gs(Ws.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _C(n,e){return new Gs(Ws.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Ew(n){throw new Gs(Ws.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let a;try{a=eu.makeFromUrl(e,i)}catch{return new eu(e,"")}if(a.path==="")return a;throw i6e(e)}static makeFromUrl(e,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function u(oe){oe.path.charAt(oe.path.length-1)==="/"&&(oe.path_=oe.path_.slice(0,-1))}const f="(/(.*))?$",_=new RegExp("^gs://"+l+f,"i"),E={bucket:1,path:3};function b(oe){oe.path_=decodeURIComponent(oe.path)}const C="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),O="(/([^?#]*).*)?$",L=new RegExp(`^https?://${I}/${C}/b/${l}/o${O}`,"i"),M={bucket:1,path:3},F=i===Yse?"(?:storage.googleapis.com|storage.cloud.google.com)":i,z="([^?#]*)",X=new RegExp(`^https?://${F}/${l}/${z}`,"i"),ne=[{regex:_,indices:E,postModify:u},{regex:L,indices:M,postModify:b},{regex:X,indices:{bucket:1,path:2},postModify:b}];for(let oe=0;oe<ne.length;oe++){const ae=ne[oe],le=ae.regex.exec(e);if(le){const Y=le[ae.indices.bucket];let Z=le[ae.indices.path];Z||(Z=""),a=new eu(Y,Z),ae.postModify(a);break}}if(a==null)throw r6e(e);return a}}class u6e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d6e(n,e,i){let a=1,l=null,u=null,f=!1,_=0;function E(){return _===2}let b=!1;function C(...z){b||(b=!0,e.apply(null,z))}function I(z){l=setTimeout(()=>{l=null,n(L,E())},z)}function O(){u&&clearTimeout(u)}function L(z,...X){if(b){O();return}if(z){O(),C.call(null,z,...X);return}if(E()||f){O(),C.call(null,z,...X);return}a<64&&(a*=2);let ne;_===1?(_=2,ne=0):ne=(a+Math.random())*1e3,I(ne)}let M=!1;function F(z){M||(M=!0,O(),!b&&(l!==null?(z||(_=2),clearTimeout(l),I(0)):z||(_=1)))}return I(0),u=setTimeout(()=>{f=!0,F(!0)},i),F}function h6e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p6e(n){return n!==void 0}function f6e(n){return typeof n=="object"&&!Array.isArray(n)}function B4(n){return typeof n=="string"||n instanceof String}function FJ(n){return z4()&&n instanceof Blob}function z4(){return typeof Blob<"u"}function jJ(n,e,i,a){if(a<e)throw KV(`Invalid value for '${n}'. Expected ${e} or greater.`);if(a>i)throw KV(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _1(n,e,i){let a=e;return i==null&&(a=`https://${e}`),`${i}://${a}/v0${n}`}function Qse(n){const e=encodeURIComponent;let i="?";for(const a in n)if(n.hasOwnProperty(a)){const l=e(a)+"="+e(n[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var Fy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Fy||(Fy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m6e(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return i||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g6e{constructor(e,i,a,l,u,f,_,E,b,C,I,O=!0){this.url_=e,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=f,this.callback_=_,this.errorCallback_=E,this.timeout_=b,this.progressCallback_=C,this.connectionFactory_=I,this.retry=O,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((L,M)=>{this.resolve_=L,this.reject_=M,this.start_()})}start_(){const e=(a,l)=>{if(l){a(!1,new UO(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const f=_=>{const E=_.loaded,b=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,b)};this.progressCallback_!==null&&u.addUploadProgressListener(f),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(f),this.pendingConnection_=null;const _=u.getErrorCode()===Fy.NO_ERROR,E=u.getStatus();if(!_||m6e(E,this.additionalRetryCodes_)&&this.retry){const C=u.getErrorCode()===Fy.ABORT;a(!1,new UO(!1,null,C));return}const b=this.successCodes_.indexOf(E)!==-1;a(!0,new UO(b,u))})},i=(a,l)=>{const u=this.resolve_,f=this.reject_,_=l.connection;if(l.wasSuccessCode)try{const E=this.callback_(_,_.getResponse());p6e(E)?u(E):u()}catch(E){f(E)}else if(_!==null){const E=j4();E.serverResponse=_.getErrorText(),this.errorCallback_?f(this.errorCallback_(_,E)):f(E)}else if(l.canceled){const E=this.appDelete_?Jse():n6e();f(E)}else{const E=t6e();f(E)}};this.canceled_?i(!1,new UO(!1,null,!0)):this.backoffId_=d6e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&h6e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class UO{constructor(e,i,a){this.wasSuccessCode=e,this.connection=i,this.canceled=!!a}}function _6e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function y6e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function E6e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function v6e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function S6e(n,e,i,a,l,u,f=!0){const _=Qse(n.urlParams),E=n.url+_,b=Object.assign({},n.headers);return E6e(b,e),_6e(b,i),y6e(b,u),v6e(b,a),new g6e(E,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b6e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function T6e(...n){const e=b6e();if(e!==void 0){const i=new e;for(let a=0;a<n.length;a++)i.append(n[a]);return i.getBlob()}else{if(z4())return new Blob(n);throw new Gs(Ws.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function w6e(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C6e(n){if(typeof atob>"u")throw c6e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dp={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class hU{constructor(e,i){this.data=e,this.contentType=i||null}}function R6e(n,e){switch(n){case dp.RAW:return new hU(Zse(e));case dp.BASE64:case dp.BASE64URL:return new hU(eoe(n,e));case dp.DATA_URL:return new hU(A6e(e),P6e(e))}throw j4()}function Zse(n){const e=[];for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);if(a<=127)e.push(a);else if(a<=2047)e.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const u=a,f=n.charCodeAt(++i);a=65536|(u&1023)<<10|f&1023,e.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?e.push(239,191,189):e.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(e)}function I6e(n){let e;try{e=decodeURIComponent(n)}catch{throw _C(dp.DATA_URL,"Malformed data URL.")}return Zse(e)}function eoe(n,e){switch(n){case dp.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw _C(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case dp.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw _C(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=C6e(e)}catch(l){throw l.message.includes("polyfill")?l:_C(n,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class toe{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw _C(dp.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=O6e(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=e.substring(e.indexOf(",")+1)}}function A6e(n){const e=new toe(n);return e.base64?eoe(dp.BASE64,e.rest):I6e(e.rest)}function P6e(n){return new toe(n).contentType}function O6e(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg{constructor(e,i){let a=0,l="";FJ(e)?(this.data_=e,a=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),a=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),a=e.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(FJ(this.data_)){const a=this.data_,l=w6e(a,e,i);return l===null?null:new Sg(l)}else{const a=new Uint8Array(this.data_.buffer,e,i-e);return new Sg(a,!0)}}static getBlob(...e){if(z4()){const i=e.map(a=>a instanceof Sg?a.data_:a);return new Sg(T6e.apply(null,i))}else{const i=e.map(f=>B4(f)?R6e(dp.RAW,f).data:f.data_);let a=0;i.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let u=0;return i.forEach(f=>{for(let _=0;_<f.length;_++)l[u++]=f[_]}),new Sg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function noe(n){let e;try{e=JSON.parse(n)}catch{return null}return f6e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k6e(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function N6e(n,e){const i=e.split("/").filter(a=>a.length>0).join("/");return n.length===0?i:n+"/"+i}function roe(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D6e(n,e){return e}class Pc{constructor(e,i,a,l){this.server=e,this.local=i||e,this.writable=!!a,this.xform=l||D6e}}let VO=null;function x6e(n){return!B4(n)||n.length<2?n:roe(n)}function ioe(){if(VO)return VO;const n=[];n.push(new Pc("bucket")),n.push(new Pc("generation")),n.push(new Pc("metageneration")),n.push(new Pc("name","fullPath",!0));function e(u,f){return x6e(f)}const i=new Pc("name");i.xform=e,n.push(i);function a(u,f){return f!==void 0?Number(f):f}const l=new Pc("size");return l.xform=a,n.push(l),n.push(new Pc("timeCreated")),n.push(new Pc("updated")),n.push(new Pc("md5Hash",null,!0)),n.push(new Pc("cacheControl",null,!0)),n.push(new Pc("contentDisposition",null,!0)),n.push(new Pc("contentEncoding",null,!0)),n.push(new Pc("contentLanguage",null,!0)),n.push(new Pc("contentType",null,!0)),n.push(new Pc("metadata","customMetadata",!0)),VO=n,VO}function L6e(n,e){function i(){const a=n.bucket,l=n.fullPath,u=new eu(a,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:i})}function M6e(n,e,i){const a={};a.type="file";const l=i.length;for(let u=0;u<l;u++){const f=i[u];a[f.local]=f.xform(a,e[f.server])}return L6e(a,n),a}function soe(n,e,i){const a=noe(e);return a===null?null:M6e(n,a,i)}function U6e(n,e,i,a){const l=noe(e);if(l===null||!B4(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const f=encodeURIComponent;return u.split(",").map(b=>{const C=n.bucket,I=n.fullPath,O="/b/"+f(C)+"/o/"+f(I),L=_1(O,i,a),M=Qse({alt:"media",token:b});return L+M})[0]}function V6e(n,e){const i={},a=e.length;for(let l=0;l<a;l++){const u=e[l];u.writable&&(i[u.server]=n[u.local])}return JSON.stringify(i)}class W4{constructor(e,i,a,l){this.url=e,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ooe(n){if(!n)throw j4()}function F6e(n,e){function i(a,l){const u=soe(n,l,e);return ooe(u!==null),u}return i}function j6e(n,e){function i(a,l){const u=soe(n,l,e);return ooe(u!==null),U6e(u,l,n.host,n._protocol)}return i}function aoe(n){function e(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=ZBe():l=QBe():i.getStatus()===402?l=JBe(n.bucket):i.getStatus()===403?l=e6e(n.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return e}function coe(n){const e=aoe(n);function i(a,l){let u=e(a,l);return a.getStatus()===404&&(u=XBe(n.path)),u.serverResponse=l.serverResponse,u}return i}function B6e(n,e,i){const a=e.fullServerUrl(),l=_1(a,n.host,n._protocol),u="GET",f=n.maxOperationRetryTime,_=new W4(l,u,j6e(n,i),f);return _.errorHandler=coe(e),_}function z6e(n,e){const i=e.fullServerUrl(),a=_1(i,n.host,n._protocol),l="DELETE",u=n.maxOperationRetryTime;function f(E,b){}const _=new W4(a,l,f,u);return _.successCodes=[200,204],_.errorHandler=coe(e),_}function W6e(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function G6e(n,e,i){const a=Object.assign({},i);return a.fullPath=n.path,a.size=e.size(),a.contentType||(a.contentType=W6e(null,e)),a}function H6e(n,e,i,a,l){const u=e.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function _(){let ne="";for(let oe=0;oe<2;oe++)ne=ne+Math.random().toString().slice(2);return ne}const E=_();f["Content-Type"]="multipart/related; boundary="+E;const b=G6e(e,a,l),C=V6e(b,i),I="--"+E+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+E+`\r
Content-Type: `+b.contentType+`\r
\r
`,O=`\r
--`+E+"--",L=Sg.getBlob(I,a,O);if(L===null)throw o6e();const M={name:b.fullPath},F=_1(u,n.host,n._protocol),z="POST",X=n.maxUploadRetryTime,K=new W4(F,z,F6e(n,i),X);return K.urlParams=M,K.headers=f,K.body=L.uploadData(),K.errorHandler=aoe(e),K}class $6e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Fy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Fy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Fy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,a,l){if(this.sent_)throw Ew("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const u in l)l.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,l[u].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ew("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ew("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ew("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ew("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class K6e extends $6e{initXhr(){this.xhr_.responseType="text"}}function G4(){return new K6e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e,i){this._service=e,i instanceof eu?this._location=i:this._location=eu.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new Xy(e,i)}get root(){const e=new eu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return roe(this._location.path)}get storage(){return this._service}get parent(){const e=k6e(this._location.path);if(e===null)return null;const i=new eu(this._location.bucket,e);return new Xy(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw l6e(e)}}function q6e(n,e,i){n._throwIfRoot("uploadBytes");const a=H6e(n.storage,n._location,ioe(),new Sg(e,!0),i);return n.storage.makeRequestWithTokens(a,G4).then(l=>({metadata:l,ref:n}))}function Y6e(n){n._throwIfRoot("getDownloadURL");const e=B6e(n.storage,n._location,ioe());return n.storage.makeRequestWithTokens(e,G4).then(i=>{if(i===null)throw a6e();return i})}function X6e(n){n._throwIfRoot("deleteObject");const e=z6e(n.storage,n._location);return n.storage.makeRequestWithTokens(e,G4)}function J6e(n,e){const i=N6e(n._location.path,e),a=new eu(n._location.bucket,i);return new Xy(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q6e(n){return/^[A-Za-z]+:\/\//.test(n)}function Z6e(n,e){return new Xy(n,e)}function loe(n,e){if(n instanceof H4){const i=n;if(i._bucket==null)throw s6e();const a=new Xy(i,i._bucket);return e!=null?loe(a,e):a}else return e!==void 0?J6e(n,e):n}function eze(n,e){if(e&&Q6e(e)){if(n instanceof H4)return Z6e(n,e);throw KV("To use ref(service, url), the first argument must be a Storage instance.")}else return loe(n,e)}function BJ(n,e){const i=e==null?void 0:e[Xse];return i==null?null:eu.makeFromBucketSpec(i,n)}function tze(n,e,i,a={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:_re(l,n.app.options.projectId))}class H4{constructor(e,i,a,l,u){this.app=e,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=u,this._bucket=null,this._host=Yse,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=qBe,this._maxUploadRetryTime=YBe,this._requests=new Set,l!=null?this._bucket=eu.makeFromBucketSpec(l,this._host):this._bucket=BJ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=eu.makeFromBucketSpec(this._url,e):this._bucket=BJ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){jJ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){jJ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(El(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Xy(this,e)}_makeRequest(e,i,a,l,u=!0){if(this._deleted)return new u6e(Jse());{const f=S6e(e,this._appId,a,l,i,this._firebaseVersion,u);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(e,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,a,l).getPromise()}}const zJ="@firebase/storage",WJ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uoe="storage";function $4(n,e,i){return n=ji(n),q6e(n,e,i)}function y1(n){return n=ji(n),Y6e(n)}function K4(n){return n=ji(n),X6e(n)}function iE(n,e){return n=ji(n),eze(n,e)}function sE(n=$N(),e){n=ji(n);const a=dR(n,uoe).getImmediate({identifier:e}),l=Wj("storage");return l&&nze(a,...l),a}function nze(n,e,i,a={}){tze(n,e,i,a)}function rze(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new H4(i,a,l,e,Qy)}function ize(){Ng(new Yf(uoe,rze,"PUBLIC").setMultipleInstances(!0)),Qu(zJ,WJ,""),Qu(zJ,WJ,"esm2017")}ize();const Ek=async n=>{const e=sE(),i=iE(e,n);try{return await y1(i)}catch(a){throw $.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let qV={};const td=async n=>{try{const e=Sr(Qn,"spaces",n),i=await Lo(e);if(i.exists()){let a=i.data();const l=a.name,u=a.description;if(a.webglBuildId){const f=Sr(Qn,"webglBuilds",a.webglBuildId),_=await Lo(f);if(_.exists()){const E=_.data();a={...a,...E,name:l||E.name,description:u||E.description}}else $.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await sze(a),a=oze(a),console.log("Space data:",a),$.log(`spacesFirestore: Caching space data for: ${n}`),qV[n]=a,a}else return $.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw $.error("spacesFirestore: Error fetching item data:",e),e}},sze=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await Ek(l))});return await Promise.all(i),n},oze=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:a,gsUrlLoader:l,...u}=n;return{...u,codeUrl:e,dataUrl:i,frameworkUrl:a,loaderUrl:l}};let pU={};const doe=async n=>{$.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(pU[n])return $.log("spacesFirestore: Returning cached videos for space:",n),pU[n];const e=iu(Qn,`spaces/${n}/videos`),i=await ed(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),pU[n]=a,a}catch(e){throw $.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},aze=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=sE(),a=Date.now(),l=e.name.split(".").pop(),u=`logo_${a}.${l}`,f=iE(i,`spaces/${n}/logo/${u}`);$.log(`Uploading logo for space ${n}`);const _=await $4(f,e),E=await y1(_.ref),b=Sr(Qn,"spaces",n);return await Mo(b,{logoUrl:E,logoGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,logoFileName:u,updatedAt:new Date().toISOString()}),$.log(`Successfully uploaded logo for space ${n}`),E}catch(i){throw $.error("Error uploading space logo:",i),i}},cze=async n=>{try{const e=Sr(Qn,"spaces",n),i=await Lo(e);if(!i.exists())return $.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.logoGsUrl){const l=sE(),u=iE(l,a.logoGsUrl);try{await K4(u),$.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){$.warn(`Could not delete logo file from storage: ${f.message}`)}}return await Mo(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),$.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw $.error("Error deleting space logo:",e),e}},lze=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=sE(),a=Date.now(),l=e.name.split(".").pop(),u=`background_${a}.${l}`,f=iE(i,`spaces/${n}/background/${u}`);$.log(`Uploading background for space ${n}`);const _=await $4(f,e),E=await y1(_.ref),b=Sr(Qn,"spaces",n);return await Mo(b,{backgroundUrl:E,backgroundGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,backgroundFileName:u,gsUrlLoadingBackground:`gs://${_.ref.bucket}/${_.ref.fullPath}`,updatedAt:new Date().toISOString()}),$.log(`Successfully uploaded background for space ${n}`),E}catch(i){throw $.error("Error uploading space background:",i),i}},uze=async n=>{try{const e=Sr(Qn,"spaces",n),i=await Lo(e);if(!i.exists())return $.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.backgroundGsUrl){const l=sE(),u=iE(l,a.backgroundGsUrl);try{await K4(u),$.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){$.warn(`Could not delete background file from storage: ${f.message}`)}}return await Mo(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),$.log(`Successfully removed background for space ${n}`),!0}catch(e){throw $.error("Error deleting space background:",e),e}},dze=async(n,e)=>{try{if(!n||!e||!e.uid)throw new Error("Missing required parameters");const i=Sr(Qn,`spaces/${n}/BannedUsers`,e.uid),a=Object.entries({...e,bannedAt:e.bannedAt||new Date().toISOString()}).reduce((l,[u,f])=>(f!==void 0&&(l[u]=f),l),{});await Fg(i,a);try{const l=Sr(Qn,"users",e.uid),u=await Lo(l);if(u.exists()){const f=u.data(),_=Array.isArray(f.groups)?f.groups:[],E=`space_${n}_banned`;_.includes(E)||await Mo(l,{groups:[..._,E]})}}catch(l){$.error("spacesFirestore: failed to add banned group to user",l)}return $.log(`spacesFirestore: Added banned user ${e.uid} to space ${n}`),!0}catch(i){throw $.error("spacesFirestore: Error adding banned user:",i),i}},q4=async(n,e)=>{try{$.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=Sr(Qn,"spaces",n);return await Mo(i,{...e,updatedAt:new Date().toISOString()}),qV[n]&&delete qV[n],!0}catch(i){throw $.error("spacesFirestore: Error updating space settings:",i),i}},hze=async(n,e)=>q4(n,{accessibleToAllUsers:e}),YV=async(n,e)=>q4(n,{HLSStreamURL:e}),hoe=async n=>{try{const e=Sr(Qn,"spaces",n),i=await Lo(e);return i.exists()&&i.data().HLSStreamURL||null}catch(e){throw $.error("spacesFirestore: Error getting HLS stream:",e),e}},pze=async(n,e)=>($.warn("uploadSpaceVideoBackground: Not implemented in simplified stub."),null),fze=async n=>($.warn("deleteSpaceVideoBackground: Not implemented in simplified stub."),null),ro=N.createContext(null),mze=N.createContext(null),gze=({children:n})=>{const[e,i]=N.useState(null),a=N.useRef(null),[l,u]=N.useState(!0),[f,_]=N.useState(!1),E=XN(),b=le=>le?le.Nickname?le.Nickname:`${le.firstName} ${le.lastName}`:"Anon";N.useEffect(()=>{const le=zFe(E,async Y=>{if($.log("UserProvider: Firebase onAuthStateChanged() fired"),Y)try{const Z=await su(Y.uid),Q=b(Z),ie={uid:Y.uid,email:Y.email,emailVerified:Y.emailVerified,...Z,displayName:Q};$.log(`UserProvider: User authenticated: ${Y.uid}`),i(ie),a.current=ie,L(ie)}catch(Z){$.error("UserProvider: Error fetching user profile data:",Z)}else i(null),a.current=null;u(!1)});return()=>{le&&le()}},[]);const C=async(le,Y,Z)=>{try{_(!0),$.log("UserProvider: Starting registration process"),$.log("UserProvider: Registration includes fields:",Object.keys(Z||{}).join(", "));const Q={...Z},ie=["firstName","lastName","username","companyName","linkedInProfile"],de=ie.filter(we=>!Q[we]);de.length>0&&$.warn(`UserProvider: Registration missing fields: ${de.join(", ")}`);const ue=Q.firstName&&Q.lastName?`${Q.firstName}${Q.lastName.charAt(0).toUpperCase()}`:"";$.log("UserProvider: Generated default nickname for registration");const pe={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:Q.Nickname||ue,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...Q};$.log("UserProvider: Prepared registration data with fields:",Object.keys(pe).join(", "));const ke=await jBe(le,Y,pe);$.log("UserProvider: Registration successful, received user data");const xe=ie.filter(we=>!ke[we]);xe.length>0&&$.warn(`UserProvider: Returned user data missing fields: ${xe.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(we=>{ke[we]||($.warn(`UserProvider: ${we} is missing in returned data, using original value`),ke[we]=pe[we])});const Oe={uid:ke.uid,email:ke.email,...ke,displayName:b(ke)};return $.log("UserProvider: Created user object with fields:",Object.keys(Oe).join(", ")),i(Oe),a.current=Oe,$.log("UserProvider: User registered successfully with groups:",pe.groups),await new Promise(we=>setTimeout(we,2e3)),_(!1),Oe}catch(Q){throw _(!1),$.error("UserProvider: Error during registration:",Q),Q}},I=async(le,Y,Z)=>{try{if($.log("UserProvider: Signing in user"),!Z)throw new Error("CAPTCHA verification is required");const ie=(await FFe(E,le,Y)).user;return $.log("UserProvider: User signed in successfully:",ie.email),ie}catch(Q){throw $.error("UserProvider: Error signing in:",Q),Q}},O=async()=>{try{await WFe(E),i(null),$.log("UserProvider: User signed out.")}catch(le){throw $.error("UserProvider: Error signing out:",le),le}},L=()=>{const le=a.current;if(le){const Y=M(le);$.log("UserProvider: sendUserToUnity() using the eventBus",Y),Zd.publish(Qd.sendUserToUnity,Y)}else $.log("UserProvider: No current user to send to Unity.")},M=le=>{const Y={};return[...$Be,"uid"].forEach(Q=>{le.hasOwnProperty(Q)&&(Y[Q]=le[Q])}),Y},F=async le=>!e||!e.uid?!1:await qse(e.uid,le),z=async le=>{try{return!e||!e.uid?!1:e.groups&&e.groups.includes(`space_${le}_banned`)?!0:(await Lo(Sr(Qn,`spaces/${le}/BannedUsers`,e.uid))).exists()}catch(Y){return Y.code!=="permission-denied"&&$.error("UserProvider: isUserBannedFromSpace error:",Y),!1}},X=async le=>{if(!e||!e.uid)return!1;try{if(await z(le))return $.warn(`UserProvider: User ${e.uid} banned from ${le}`),!1;const Y=await td(le);if(Y.usersAllowed.includes(e.uid)||Y.userAdmin.includes(e.uid)||Y.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const Q=`space_${le}_owners`,ie=`space_${le}_hosts`;if(e.groups.includes(Q)||e.groups.includes(ie))return $.log(`UserProvider: User ${e.uid} has access to space ${le} as owner/host`),!0}return Y.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(Y){return $.error("UserProvider: Error verifying user access to space:",Y),!1}},K=async le=>{if(!e||!e.uid)return!1;try{return(await td(le)).userAdmin.includes(e.uid)}catch(Y){return $.error("UserProvider: Error verifying user admin status for space:",Y),!1}},ne=async le=>{if(!e||!e.uid)return!1;try{return(await td(le)).usersModerators.includes(e.uid)}catch(Y){return $.error("UserProvider: Error verifying user moderator status for space:",Y),!1}},oe=async()=>{try{const le=E.currentUser;return le&&!le.emailVerified?(await Yre(le),$.log("UserProvider: Verification email resent to:",le.email),!0):!1}catch(le){throw $.error("UserProvider: Error resending verification email:",le),le}},ae=async()=>{try{const le=E.currentUser;if(!le)return $.warn("UserProvider: updateUser called but no current user exists"),null;$.log("UserProvider: Updating user data from Firestore");const Y=await su(le.uid);if(!Y)return $.error("UserProvider: Failed to fetch updated user profile"),null;const Z=b(Y),Q={uid:le.uid,email:le.email,emailVerified:le.emailVerified,...Y,displayName:Z};return $.log("UserProvider: User data updated with fields:",Object.keys(Q).join(", ")),i(Q),a.current=Q,L(Q),Q}catch(le){throw $.error("UserProvider: Error updating user data:",le),le}};return T.jsx(mze.Provider,{value:{registrationInProgress:f},children:T.jsx(ro.Provider,{value:{user:e,loading:l,register:C,signIn:I,signOut:O,sendUserToUnity:L,isUserInGroup:F,userHasAccessToSpace:X,userIsAdminOfSpace:K,userIsModeratorOfSpace:ne,resendVerificationEmail:oe,updateUser:ae,isUserBannedFromSpace:z},children:n})})},poe=N.createContext(),ch=()=>N.useContext(poe),_ze=({children:n})=>{const[e,i]=N.useState(!1),a=N.useRef(null),[l,u]=N.useState(!1);N.useEffect(()=>{const E=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(b)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const f=N.useCallback(E=>{a.current=E},[]),_=N.useCallback(()=>{const E=a.current;if(!E)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=E.querySelector("video")||E;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(E.requestFullscreen?E.requestFullscreen():E.webkitRequestFullscreen?E.webkitRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.msRequestFullscreen&&E.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):E.requestFullscreen?E.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),i(!0)):E.mozRequestFullScreen?(E.mozRequestFullScreen(),i(!0)):E.msRequestFullscreen&&(E.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return N.useEffect(()=>{const E=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),()=>{document.removeEventListener("fullscreenchange",E),document.removeEventListener("webkitfullscreenchange",E),document.removeEventListener("mozfullscreenchange",E),document.removeEventListener("MSFullscreenChange",E)}},[]),T.jsx(poe.Provider,{value:{isFullscreen:e,toggleFullscreen:_,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:T.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})};var fU={},vw={},Sw={},GJ;function yze(){if(GJ)return Sw;GJ=1,Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.useUnityCanvasId=void 0;var n=nd(),e=0,i="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var u=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return u};return Sw.useUnityCanvasId=a,Sw}var Tf={},bw={},HJ;function foe(){if(HJ)return bw;HJ=1,Object.defineProperty(bw,"__esModule",{value:!0}),bw.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(bw.UnityLoaderStatus=n={})),bw}var Tw={},$J;function Y4(){return $J||($J=1,Object.defineProperty(Tw,"__esModule",{value:!0}),Tw.isBrowserEnvironment=void 0,Tw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),Tw}var KJ;function Eze(){if(KJ)return Tf;KJ=1;var n=Tf&&Tf.__awaiter||function(f,_,E,b){function C(I){return I instanceof E?I:new E(function(O){O(I)})}return new(E||(E=Promise))(function(I,O){function L(z){try{F(b.next(z))}catch(X){O(X)}}function M(z){try{F(b.throw(z))}catch(X){O(X)}}function F(z){z.done?I(z.value):C(z.value).then(L,M)}F((b=b.apply(f,_||[])).next())})},e=Tf&&Tf.__generator||function(f,_){var E={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,C,I,O=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return O.next=L(0),O.throw=L(1),O.return=L(2),typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function L(F){return function(z){return M([F,z])}}function M(F){if(b)throw new TypeError("Generator is already executing.");for(;O&&(O=0,F[0]&&(E=0)),E;)try{if(b=1,C&&(I=F[0]&2?C.return:F[0]?C.throw||((I=C.return)&&I.call(C),0):C.next)&&!(I=I.call(C,F[1])).done)return I;switch(C=0,I&&(F=[F[0]&2,I.value]),F[0]){case 0:case 1:I=F;break;case 4:return E.label++,{value:F[1],done:!1};case 5:E.label++,C=F[1],F=[0];continue;case 7:F=E.ops.pop(),E.trys.pop();continue;default:if(I=E.trys,!(I=I.length>0&&I[I.length-1])&&(F[0]===6||F[0]===2)){E=0;continue}if(F[0]===3&&(!I||F[1]>I[0]&&F[1]<I[3])){E.label=F[1];break}if(F[0]===6&&E.label<I[1]){E.label=I[1],I=F;break}if(I&&E.label<I[2]){E.label=I[2],E.ops.push(F);break}I[2]&&E.ops.pop(),E.trys.pop();continue}F=_.call(f,E)}catch(z){F=[6,z],C=0}finally{b=I=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}};Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.useUnityInstance=void 0;var i=nd(),a=foe(),l=Y4(),u=function(f,_,E,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var C,I;return e(this,function(O){switch(O.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||_===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];O.label=1;case 1:return O.trys.push([1,3,,4]),[4,window.createUnityInstance(_,E,b.setLoadingProgression)];case 2:return C=O.sent(),b.setUnityInstance(C),b.setInitialisationError(null),[3,4];case 3:return I=O.sent(),b.setUnityInstance(null),b.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,_,E,b])};return Tf.useUnityInstance=u,Tf}var ww={},qJ;function vze(){if(qJ)return ww;qJ=1,Object.defineProperty(ww,"__esModule",{value:!0}),ww.useUnityArguments=void 0;var n=nd(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return ww.useUnityArguments=e,ww}var Cw={},YJ;function Sze(){if(YJ)return Cw;YJ=1,Object.defineProperty(Cw,"__esModule",{value:!0}),Cw.useUnityLoader=void 0;var n=nd(),e=Y4(),i=foe(),a=function(l){var u=(0,n.useState)(i.UnityLoaderStatus.Loading),f=u[0],_=u[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){_(i.UnityLoaderStatus.Idle);return}var E=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));E===null?(E=window.document.createElement("script"),E.type="text/javascript",E.src=l.loaderUrl,E.async=!0,E.setAttribute("data-status","loading"),window.document.body.appendChild(E),E.addEventListener("load",function(){return E==null?void 0:E.setAttribute("data-status","loaded")}),E.addEventListener("error",function(){return E==null?void 0:E.setAttribute("data-status","error")})):_(E.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(C){return _(C.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return E.addEventListener("load",b),E.addEventListener("error",b),function(){E!==null&&(E.removeEventListener("load",b),E.removeEventListener("error",b),window.document.body.removeChild(E))}}},[l.loaderUrl]),f};return Cw.useUnityLoader=a,Cw}var XJ;function bze(){if(XJ)return vw;XJ=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.Unity=void 0;var n=nd(),e=nd(),i=yze(),a=Eze(),l=vze(),u=Sze(),f=(0,e.forwardRef)(function(_,E){var b=(0,e.useRef)(null),C=(0,i.useUnityCanvasId)(_),I=(0,l.useUnityArguments)(_),O=(0,u.useUnityLoader)(_.unityProvider.unityConfig);return(0,a.useUnityInstance)(O,b.current,I,_.unityProvider),(0,n.useImperativeHandle)(E,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:C,style:_.style,className:_.className,tabIndex:_.tabIndex})});return vw.Unity=f,vw}var wf={},Rw={},JJ;function moe(){if(JJ)return Rw;JJ=1,Object.defineProperty(Rw,"__esModule",{value:!0}),Rw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Rw.errorMessages=n,Rw}var my={},QJ;function Tze(){if(QJ)return my;QJ=1;var n=my&&my.__spreadArray||function(_,E,b){if(b||arguments.length===2)for(var C=0,I=E.length,O;C<I;C++)(O||!(C in E))&&(O||(O=Array.prototype.slice.call(E,0,C)),O[C]=E[C]);return _.concat(O||Array.prototype.slice.call(E))};Object.defineProperty(my,"__esModule",{value:!0}),my.useEventSystem=void 0;var e=nd(),i=moe(),a=Y4(),l=[],u=function(_){for(var E=[],b=1;b<arguments.length;b++)E[b-1]=arguments[b];var C=void 0;return l.forEach(function(I){C=I.apply(void 0,n([_],E,!1))}),C};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=u);var f=function(){var _=(0,e.useRef)([]),E=(0,e.useCallback)(function(I,O){_.current=n(n([],_.current,!0),[{eventName:I,callback:O}],!1)},[_]),b=(0,e.useCallback)(function(I,O){_.current=_.current.filter(function(L){return L.eventName!==I&&L.callback!==O})},[_]),C=(0,e.useCallback)(function(I){for(var O=[],L=1;L<arguments.length;L++)O[L-1]=arguments[L];var M=_.current.find(function(F){return F.eventName===I});if(typeof M>"u"){console.warn(i.errorMessages.noEventListener,{eventName:I});return}return M.callback.apply(M,O)},[_]);return(0,e.useEffect)(function(){return l.push(C),function(){l.splice(l.indexOf(C),1)}},[C]),{addEventListener:E,removeEventListener:b}};return my.useEventSystem=f,my}var Iw={},ZJ;function wze(){if(ZJ)return Iw;ZJ=1,Object.defineProperty(Iw,"__esModule",{value:!0}),Iw.useNullableState=void 0;var n=nd(),e=function(i){return(0,n.useState)(i||null)};return Iw.useNullableState=e,Iw}var eQ;function Cze(){if(eQ)return wf;eQ=1;var n=wf&&wf.__awaiter||function(_,E,b,C){function I(O){return O instanceof b?O:new b(function(L){L(O)})}return new(b||(b=Promise))(function(O,L){function M(X){try{z(C.next(X))}catch(K){L(K)}}function F(X){try{z(C.throw(X))}catch(K){L(K)}}function z(X){X.done?O(X.value):I(X.value).then(M,F)}z((C=C.apply(_,E||[])).next())})},e=wf&&wf.__generator||function(_,E){var b={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},C,I,O,L=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return L.next=M(0),L.throw=M(1),L.return=M(2),typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function M(z){return function(X){return F([z,X])}}function F(z){if(C)throw new TypeError("Generator is already executing.");for(;L&&(L=0,z[0]&&(b=0)),b;)try{if(C=1,I&&(O=z[0]&2?I.return:z[0]?I.throw||((O=I.return)&&O.call(I),0):I.next)&&!(O=O.call(I,z[1])).done)return O;switch(I=0,O&&(z=[z[0]&2,O.value]),z[0]){case 0:case 1:O=z;break;case 4:return b.label++,{value:z[1],done:!1};case 5:b.label++,I=z[1],z=[0];continue;case 7:z=b.ops.pop(),b.trys.pop();continue;default:if(O=b.trys,!(O=O.length>0&&O[O.length-1])&&(z[0]===6||z[0]===2)){b=0;continue}if(z[0]===3&&(!O||z[1]>O[0]&&z[1]<O[3])){b.label=z[1];break}if(z[0]===6&&b.label<O[1]){b.label=O[1],O=z;break}if(O&&b.label<O[2]){b.label=O[2],b.ops.push(z);break}O[2]&&b.ops.pop(),b.trys.pop();continue}z=E.call(_,b)}catch(X){z=[6,X],I=0}finally{C=O=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}};Object.defineProperty(wf,"__esModule",{value:!0}),wf.useUnityContext=void 0;var i=nd(),a=moe(),l=Tze(),u=wze(),f=function(_){var E=(0,u.useNullableState)(),b=E[0],C=E[1],I=(0,i.useState)(0),O=I[0],L=I[1],M=(0,i.useState)(!1),F=M[0],z=M[1],X=(0,u.useNullableState)(),K=X[0],ne=X[1],oe=(0,l.useEventSystem)(),ae=(0,i.useRef)({setLoadingProgression:L,setInitialisationError:ne,setUnityInstance:C,setIsLoaded:z,unityConfig:_}),le=(0,i.useCallback)(function(ue){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(ue===!0?1:0)},[b]),Y=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),Z=(0,i.useCallback)(function(ue,pe,ke){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(ue,pe,ke)},[b]),Q=(0,i.useCallback)(function(ue,pe){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(ue,pe)},[b]),ie=(0,i.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),de=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var ue;return e(this,function(pe){switch(pe.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(ue=b.Module.canvas,document.body.appendChild(ue),ue.style.display="none",[4,ie()]);case 1:return pe.sent(),ue.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){z(O===1)},[O]),{unityProvider:ae.current,loadingProgression:O,initialisationError:K,isLoaded:F,UNSAFE__unityInstance:b,requestFullscreen:le,requestPointerLock:Y,sendMessage:Z,takeScreenshot:Q,unload:ie,UNSAFE__detachAndUnloadImmediate:de,addEventListener:oe.addEventListener,removeEventListener:oe.removeEventListener}};return wf.useUnityContext=f,wf}var tQ;function Rze(){return tQ||(tQ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=bze();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=Cze();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(fU)),fU}var goe=Rze();const $d="[UnityProvider]",XV=N.createContext(),Ize=({spaceID:n,children:e,loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:u,loadingBackground:f,showLoginButton:_,showDisruptiveLogo:E})=>{$.log(`${$d} Initializing with spaceID:`,n),$.log(`${$d} Unity URLs:`,{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:u});const{unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:L,removeEventListener:M,error:F}=goe.useUnityContext({loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:u}),z={unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:L,removeEventListener:M,error:F,spaceID:n},X=N.useRef(null),K=N.useRef(Date.now());N.useEffect(()=>{const le=()=>{document.hidden?($.log(`${$d} Page hidden, starting keep-alive`),ne()):($.log(`${$d} Page visible, stopping keep-alive`),oe())};return document.addEventListener("visibilitychange",le),()=>{document.removeEventListener("visibilitychange",le),oe()}},[]),N.useEffect(()=>{const le=()=>{K.current=Date.now(),document.hidden&&O("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",le),window.addEventListener("keydown",le),window.addEventListener("touchstart",le),()=>{window.removeEventListener("mousemove",le),window.removeEventListener("keydown",le),window.removeEventListener("touchstart",le)}},[O]);const ne=()=>{X.current||(X.current=setInterval(()=>{I&&document.hidden&&(O("WebGLInputManager","KeepAlive"),$.debug(`${$d} Sent keep-alive message`))},1e4))},oe=()=>{X.current&&(clearInterval(X.current),X.current=null)};N.useEffect(()=>($.log(`${$d} Component mounted`),()=>{$.log(`${$d} Component unmounting`),oe()}),[]),N.useEffect(()=>{$.log(`${$d} Loading progress:`,C)},[C]),N.useEffect(()=>{I&&($.log(`${$d} Unity instance loaded for:`,n),document.hidden&&ne())},[I,n]),N.useEffect(()=>{F&&$.error(`${$d} Unity error:`,F)},[F]),$.log(`${$d} Rendering provider with instance:`,z),N.useEffect(()=>{$.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:u})},[i,a,l,u]);const ae=[];if(i||ae.push("loaderUrl"),a||ae.push("dataUrl"),l||ae.push("frameworkUrl"),u||ae.push("codeUrl"),ae.length>0)return $.error(`UnityProvider: Missing required Unity build URLs: ${ae.join(", ")}`),T.jsx(XV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${ae.join(", ")}`),spaceID:n},children:e});try{return N.useEffect(()=>{$.log("UnityProvider: Unity context created:",b),b?$.log("UnityProvider: Unity provider is available"):$.error("UnityProvider: Unity provider is not available"),I?$.log("UnityProvider: Unity is loaded"):$.log("UnityProvider: Unity is not loaded yet")},[b,I]),T.jsx(XV.Provider,{value:z,children:e})}catch(le){return $.error("UnityProvider: Error creating Unity context:",le),T.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[T.jsx("h3",{children:"Unity Error"}),T.jsxs("p",{children:["Error creating Unity context: ",le.message]}),T.jsx("p",{children:"Please check the console for more details."})]})}},Uo=()=>N.useContext(XV),Mc=()=>{const{sendMessage:n,isLoaded:e}=Uo(),i=N.useRef([]),a=N.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:u,data:f}=i.current.shift();$.log("useSendUnityEvent: Processing queued event to Unity:",u,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(f)}))}catch(_){$.error("useSendUnityEvent: Error sending event to Unity:",_),i.current.unshift({eventName:u,data:f});break}}},[n,e]);return N.useEffect(()=>{const u=setInterval(()=>{a()},1e3);return()=>clearInterval(u)},[a]),N.useCallback((u,f)=>{$.log("useSendUnityEvent: Queuing event for Unity:",u),i.current.push({eventName:u,data:f}),a()},[a])},Uc=()=>{const{addEventListener:n,removeEventListener:e}=Uo();return N.useCallback((i,a)=>{const l=u=>{$.log(i+" unity message received.");let f=null;if(u)try{f=JSON.parse(u)}catch(_){$.warn("Failed to parse JSON data from Unity message:",_)}a(f)};return n(i,l),()=>{e(i,l)}},[n,e])},_oe=()=>{const[n,e]=N.useState({}),[i,a]=N.useState(!1),[l,u]=N.useState(null),[f,_]=N.useState(0),E=Mc(),b=Uc(),{spaceID:C,sendMessage:I,isLoaded:O}=Uo(),L=N.useCallback((X,K)=>{if(!X)return;$.log(`useHLSStream: Sending stream URL to Unity: ${X} for player ${K}`);const ne={identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:X};if(E("SetHLSStream",ne),O&&I)try{$.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(ne)})),$.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:X})),$.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",X),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:K.toString(),Url:X}))}catch(oe){$.error("useHLSStream: Error with direct message:",oe)}else $.warn("useHLSStream: Unity not loaded, could not send direct message")},[E,I,O]);N.useEffect(()=>{C&&M(C)},[C]);const M=async X=>{try{if(!X){$.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}a(!0),$.log(`useHLSStream: Loading stream from Firebase for space ${X}`);const K=await hoe(X);if(K&&K.streamUrl)if($.log(`useHLSStream: Loaded stream data from Firebase for space ${X}`,K),u(K),O)$.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{L(K.streamUrl,K.playerIndex||"0")},500),setTimeout(()=>{$.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),L(K.streamUrl,K.playerIndex||"0")},2e3);else{$.warn("useHLSStream: Unity is not loaded yet, will try again later");const ne=setInterval(()=>{O&&($.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),L(K.streamUrl,K.playerIndex||"0"),clearInterval(ne))},1e3);setTimeout(()=>{clearInterval(ne)},3e4)}else $.log(`useHLSStream: No saved stream found for space ${X}`),u(null)}catch(K){$.error(`useHLSStream: Error loading stream from Firebase for space ${X}`,K)}finally{a(!1)}},F=N.useCallback(async()=>{C&&($.log(`useHLSStream: Forcing reload of stream data for space ${C}`),_(X=>X+1),await M(C))},[C]),z=N.useCallback(async(X,K=0,ne={})=>{try{if(!X||!X.trim()){$.error("useHLSStream: Invalid stream URL");return}a(!0),$.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${K}]`,X);const{enabled:oe=!0,rtmpUrl:ae="",streamKey:le="",skipSendToUnity:Y=!1}=ne;if(Y||L(X,K),C)try{const Z={streamUrl:X,playerIndex:K.toString(),enabled:oe,rtmpUrl:ae,streamKey:le,updatedAt:new Date().toISOString()};$.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,Z),await YV(C,Z),u(Z)}catch(Z){throw $.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,Z),Z}else $.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{a(!1)}},[L,C]);return N.useEffect(()=>{const K=b("SetHLSStream",ne=>{if(ne)try{$.log("useHLSStream: Received player status update",ne);const{identifier:oe,playerIndex:ae,isReady:le,isPlaying:Y}=ne,Z=`${oe}_${ae}`;e(Q=>({...Q,[Z]:{identifier:oe,playerIndex:ae,isReady:le,isPlaying:Y}}))}catch(oe){$.error("useHLSStream: Error handling player status update",oe)}});return()=>{K()}},[b]),N.useEffect(()=>{if(l&&l.streamUrl){$.log("useHLSStream: Resending saved stream URL to Unity");const X=setTimeout(()=>{L(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(X)}},[l,n,L,f]),N.useEffect(()=>{const X=K=>{if(K.detail){if($.log("useHLSStream: Received stream update event",K.detail),C===K.detail.spaceId)$.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),M(C);else if(K.detail.streamUrl){$.log(`useHLSStream: Using stream URL directly from event: ${K.detail.streamUrl}`);const ne=K.detail.playerIndex||"0";L(K.detail.streamUrl,ne),u(K.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",X),window.addEventListener("SpaceStreamUpdated",X),()=>{window.removeEventListener("SpaceHLSStreamUpdated",X),window.removeEventListener("SpaceStreamUpdated",X)}},[C,L]),{setHLSStreamUrl:z,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:F}},Aze=()=>{const[n,e]=N.useState(!1),i=Uc();return N.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{$.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},Pze=()=>{const[n,e]=N.useState(null),i=Uc();return console.log(" Nameplate click hook initialized"),N.useEffect(()=>{console.log(" Setting up nameplate click listener...");const u=i("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const _=typeof f=="string"?JSON.parse(f):f;e({playerName:_.playerName,playerId:_.playerId,uid:_.uid,isLocalPlayer:_.isLocalPlayer}),console.log(" Processed nameplate data:",_)}catch(_){console.error(" Error processing nameplate data:",_)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof u=="function"&&u()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},Oze=()=>{const n=Uc(),{sendUserToUnity:e}=N.useContext(ro);return N.useEffect(()=>{const a=n("RequestUserForUnity",()=>{$.log("React: Request from Unity to send user data"),e()});return()=>{a()}},[n,e]),!0},nQ=async(n,e,i,a={})=>{try{const{mediaType:l="image",displayAsVideo:u=!1,directUrl:f=null}=a;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let _=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const E=sE(),b=Date.now(),C=i.name.split(".").pop(),I=`${e}_${b}.${C}`,O=iE(E,`spaces/${n}/mediaScreens/${I}`);$.log(`Uploading image for media screen ${e} in space ${n}`);const L=await $4(O,i);_=await y1(L.ref);const M=Sr(Qn,`spaces/${n}/mediaScreens`,e);await Fg(M,{imageUrl:_,gsUrl:`gs://${L.ref.bucket}/${L.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){_=f;const E=Sr(Qn,`spaces/${n}/mediaScreens`,e);await Fg(E,{videoUrl:f,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return $.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${u})`),_}catch(l){throw $.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},X4=async n=>{$.log(`Getting media screen images for space: ${n}`);try{const e=iu(Qn,`spaces/${n}/mediaScreens`),i=await ed(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(e){throw $.error("Error fetching media screen images from Firestore:",e),e}},Df=async(n,e)=>{try{const i=Sr(Qn,`spaces/${n}/mediaScreens`,e),a=await Lo(i);return a.exists()?{id:a.id,...a.data()}:($.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw $.error("Error fetching media screen image:",i),i}},kze=async(n,e)=>{try{const i=await Df(n,e);if(!i)return $.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=sE(),u=iE(l,i.gsUrl);try{await K4(u),$.log(`Deleted file from storage: ${i.gsUrl}`)}catch(f){$.warn(`Could not delete file from storage: ${f.message}`)}}const a=Sr(Qn,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await Mo(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),$.log(`Successfully removed video for media screen ${e}`)):(await Mo(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),$.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw $.error("Error deleting media screen image:",i),i}},Nze=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const a=await Df(n,e);if(!a||!a.imageUrl&&!a.videoUrl)return $.warn(`No media screen content found with ID: ${e} to update`),!1;const l=Sr(Qn,`spaces/${n}/mediaScreens`,e);return await Mo(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),$.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(a){throw $.error("Error updating media screen display mode:",a),a}},Dze=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},yoe=()=>{const{spaceID:n}=Uo(),e=Mc(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{$.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){$.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}$.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await X4(n);$.log("Fetched Media Screen Images",u),u.forEach(f=>{const{id:_,imageUrl:E,displayAsVideo:b,videoUrl:C}=f;let I=null;(!b||!C)&&(I=E?Dze(E):null),e("SetMediaScreenImage",{mediaScreenId:_,imageUrl:I,videoUrl:C||null,displayAsVideo:b||!1,timestamp:Date.now()}),$.log(`Sent media screen data for ${_} to Unity (displayAsVideo: ${b})`),b&&C&&(e("SetMediaScreenDisplayMode",{mediaScreenId:_,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),$.log(`Set display mode to video for screen ${_}`))})}catch(u){$.error("Error fetching media screen images:",u)}})()},[e,n,i])},xze=()=>{const{spaceID:n}=Uo(),e=Mc(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{$.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){$.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}$.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await doe(n),f=async b=>{const C=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const O=await I.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),M=["640x360","295x166"];let F=null;for(let z of M){const X=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(X,{method:"HEAD"})).ok){F=X;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${X}`,K)}}return F||O.thumbnail_url},_=u.map(async b=>{const C=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:C}}),E=await Promise.all(_);$.log("Fetched Thumbnails",E),E.forEach(({gameObjectName:b,thumbnailUrl:C})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:C})})}catch(u){$.error("Error fetching thumbnails:",u)}})()},[e,n,i])},Eoe=()=>{const[n,e]=N.useState([]),i=Uc();return N.useEffect(()=>{let a=!0,l=null;const u=()=>{window.unityInstance&&($.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=L=>{if(a){$.log("UpdatePlayerList unity message received.");try{let M=[];if(typeof L=="object"&&L!==null?M=L.players||[]:M=JSON.parse(L).players||[],Array.isArray(M)){const F=Array.from(new Map(M.map(z=>[z.playerId,z])).values());e(F),l&&(clearTimeout(l),l=null)}}catch(M){$.error("Error handling player list data:",M),l||(l=setTimeout(u,1e3))}}},_=()=>{$.log("Player disconnected, requesting fresh player list"),u()},E=()=>{$.log("Player left, requesting fresh player list"),u()};u();const b=i("UpdatePlayerList",f),C=i("PlayerDisconnected",_),I=i("PlayerLeft",E),O=setInterval(u,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof C=="function"&&C(),typeof I=="function"&&I(),clearInterval(O)}},[i]),n},voe=()=>{const n=Mc(),e=N.useCallback((a,l,u,f,_,E)=>{const b=u||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},I=_||{x:1,y:1,z:1};try{const O={portalId:a,prefabName:l||"PortalObjectPrefab",position:b,rotation:C,scale:I,initialImageUrl:E};return $.log("Sending portal placement to Unity:",O),n("PlacePortalPrefab",O),!0}catch(O){return $.error("Error placing portal:",O),!1}},[n]),i=N.useCallback((a,l,u,f,_,E)=>{const b=u||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},I=_||{x:1,y:1,z:1};try{const O={portalId:a,prefabName:l||"PortalObjectPrefab",position:b,rotation:C,scale:I,initialImageUrl:E},L={eventName:"PlacePortalPrefab",data:JSON.stringify(O)};return $.log("Directly sending portal placement to Unity:",O),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(L)),!0}catch(O){return $.error("Error directly placing portal:",O),!1}},[]);return{placePortal:e,directPlacePortal:i,isUnityLoaded:!0}},Soe=()=>{const n=Mc(),e=N.useCallback((a,l,u,f,_)=>{const E=u||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},C=_||{x:1,y:1,z:1};try{const I={hotspotId:a,glbUrl:l,position:E,rotation:b,scale:C};return $.log("Sending seating hotspot placement to Unity:",I),n("SeatingHotspot",I),!0}catch(I){return $.error("Error placing seating hotspot:",I),!1}},[n]),i=N.useCallback((a,l,u,f,_)=>{const E=u||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},C=_||{x:1,y:1,z:1};try{const I={hotspotId:a,glbUrl:l,position:E,rotation:b,scale:C},O={eventName:"SeatingHotspot",data:JSON.stringify(I)};return $.log("Directly sending seating hotspot placement to Unity:",I),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(O)),!0}catch(I){return $.error("Error directly placing seating hotspot:",I),!1}},[]);return{placeCatalogueItem:e,directPlaceCatalogueItem:i,isUnityLoaded:!0}},Lze=U4(g1,"trackAnalytics"),Mze=U4(g1,"createAnalyticsSession"),Uze=U4(g1,"endAnalyticsSession"),Vze=async(n,e={})=>{try{$.log(`Creating secure analytics session for space ${n}`);const i=await Mze({spaceId:n,sessionData:{userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",deviceType:typeof navigator<"u"&&/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop",sessionType:"webgl",startUrl:typeof window<"u"?window.location.href:"unknown",referrer:typeof document<"u"?document.referrer:"unknown",...e}});return $.log(`Secure analytics session created: ${i.data.sessionId}`),i.data.sessionId}catch(i){throw $.error("Error creating secure analytics session:",i),i}},Fze=async(n,e,i,a={})=>{try{$.log(`Tracking secure analytics event: ${i} in space ${n}`);const l=await Lze({spaceId:n,sessionId:e,eventType:i,eventData:{...a,timestamp:new Date().toISOString(),clientSide:!0}});return $.log(`Secure analytics event tracked: ${i} (${l.data.eventId})`),l.data.eventId}catch(l){throw $.error("Error tracking secure analytics event:",l),l}},jze=async(n,e)=>{try{$.log(`Ending secure analytics session: ${e} in space ${n}`),await Uze({spaceId:n,sessionId:e}),$.log(`Secure analytics session ended: ${e}`)}catch(i){throw $.error("Error ending secure analytics session:",i),i}},na={UNITY:{VIDEO_PLAY:"unity_video_play",VIDEO_PAUSE:"unity_video_pause",VIDEO_COMPLETE:"unity_video_complete",PORTAL_CLICK:"unity_portal_click",PORTAL_NAVIGATE:"unity_portal_navigate",MEDIA_SCREEN_CLICK:"unity_media_screen_click",NAMEPLATE_CLICK:"unity_nameplate_click",OBJECT_INTERACT:"unity_object_interact",PLAYER_MOVE:"unity_player_move",PLAYER_SPAWN:"unity_player_spawn",SPACE_LOAD:"unity_space_load",SPACE_READY:"unity_space_ready"},REACT:{MODAL_OPEN:"react_modal_open",MODAL_CLOSE:"react_modal_close",UI_CLICK:"react_ui_click",USER_LOGIN:"react_user_login",USER_LOGOUT:"react_user_logout",SPACE_ENTER:"react_space_enter",SPACE_EXIT:"react_space_exit",CHAT_MESSAGE:"react_chat_message",UPLOAD_START:"react_upload_start",UPLOAD_COMPLETE:"react_upload_complete",SETTINGS_CHANGE:"react_settings_change"}},No={NAVIGATION:"navigation",MEDIA_INTERACTION:"media_interaction",SOCIAL_INTERACTION:"social_interaction",UI_INTERACTION:"ui_interaction",SYSTEM_EVENT:"system_event",USER_BEHAVIOR:"user_behavior",CONTENT_INTERACTION:"content_interaction",PERFORMANCE:"performance"},Bze=async(n,e,i={})=>{try{return $.log(`Creating secure analytics session for user ${e} in space ${n}`),await Vze(n,i)}catch(a){throw $.error("Error creating analytics session:",a),a}},vk=async(n,e,i,a={})=>{try{return $.log(`Tracking secure analytics event: ${i} in space ${n}`),await Fze(n,e,i,a)}catch(l){throw $.error("Error tracking analytics event:",l),l}},zze=async(n,e)=>{try{$.log(`Ending secure analytics session: ${e} in space ${n}`),await jze(n,e)}catch(i){throw $.error("Error ending analytics session:",i),i}},Wze=async(n,e,i,a)=>vk(n,e,na.UNITY.VIDEO_PLAY,{userId:i,category:No.MEDIA_INTERACTION,source:"unity",videoId:a.gameObjectName,videoUrl:a.videoUrl,spaceId:n,...a}),bR=(n,e={})=>{const{user:i}=N.useContext(ro),a=N.useRef(null),[l,u]=N.useState(!1),[f,_]=N.useState(!1),E=N.useRef(!1),b=N.useRef(!1),C=N.useRef(!1),{autoStart:I=!0,sessionMetadata:O={},enableDebugLogs:L=!1}=e;N.useEffect(()=>(i&&n&&I&&!a.current&&!C.current&&M(),()=>{a.current&&F()}),[i,n,I]),N.useEffect(()=>{const le=()=>{document.hidden&&a.current&&F()},Y=()=>{a.current&&F()};return document.addEventListener("visibilitychange",le),window.addEventListener("beforeunload",Y),()=>{document.removeEventListener("visibilitychange",le),window.removeEventListener("beforeunload",Y)}},[]);const M=N.useCallback(async()=>{if(!i||!n||a.current||C.current){L&&$.log("Analytics session already initializing or initialized, skipping");return}try{C.current=!0,_(!0);const le=await Bze(n,i.uid,{unityVersion:window.unityVersion||"unknown",reactVersion:"18.x",startUrl:window.location.href,referrer:document.referrer,...O});a.current=le,u(!0),E.current?L&&$.log(" Analytics: Space entry already tracked for this session, skipping duplicate"):(await vk(n,le,na.REACT.SPACE_ENTER,{userId:i.uid,category:No.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),E.current=!0,L&&$.log(` Analytics: Space entry tracked for session ${le}`)),L&&$.log(`Analytics session initialized: ${le} for space ${n}`)}catch(le){$.error("Failed to initialize analytics session:",le),_(!1)}finally{C.current=!1}},[i,n,O,L]),F=N.useCallback(async()=>{if(!(!a.current||!n))try{b.current?L&&$.log(" Analytics: Space exit already tracked for this session, skipping duplicate"):(await vk(n,a.current,na.REACT.SPACE_EXIT,{userId:i==null?void 0:i.uid,category:No.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),b.current=!0,L&&$.log(` Analytics: Space exit tracked for session ${a.current}`)),await zze(n,a.current),L&&$.log(`Analytics session ended: ${a.current}`),a.current=null,u(!1),_(!1),E.current=!1,b.current=!1}catch(le){$.error("Failed to end analytics session:",le)}},[n,i==null?void 0:i.uid,L]),z=N.useCallback(async(le,Y={})=>{if(!a.current||!n||!f)return L&&$.warn("Cannot track event: No active analytics session"),null;try{const Z=await vk(n,a.current,le,{userId:i==null?void 0:i.uid,spaceId:n,timestamp:new Date().toISOString(),...Y});return L&&$.log(`Analytics event tracked: ${le}`,Y),Z}catch(Z){return $.error("Failed to track analytics event:",Z),null}},[n,i==null?void 0:i.uid,f,L]),X=N.useCallback(async le=>{if(!a.current||!n||!f)return L&&$.warn("Cannot track video play: No active analytics session"),null;try{const Y=await Wze(n,a.current,i==null?void 0:i.uid,le);return L&&$.log("Video play event tracked:",le),Y}catch(Y){return $.error("Failed to track video play event:",Y),null}},[n,i==null?void 0:i.uid,f,L]),K=N.useCallback(async(le,Y={})=>z(le,{...Y,source:"unity",category:Y.category||No.USER_BEHAVIOR}),[z]),ne=N.useCallback(async(le,Y={})=>z(le,{...Y,source:"react",category:Y.category||No.UI_INTERACTION}),[z]),oe=N.useCallback(async(le,Y,Z={})=>{const Q=le==="open"?na.REACT.MODAL_OPEN:na.REACT.MODAL_CLOSE;return ne(Q,{modalName:Y,action:le,category:No.UI_INTERACTION,...Z})},[ne]),ae=N.useCallback(async()=>{a.current&&await F(),await M()},[F,M]);return{isInitialized:l,isTracking:f,sessionId:a.current,track:z,trackVideoPlay:X,trackUnityEvent:K,trackReactEvent:ne,trackModal:oe,initializeSession:M,endSession:F,restartSession:ae,isReady:l&&f&&a.current!==null}},Gze=n=>{const[e,i]=N.useState(null),{user:a}=N.useContext(ro),l=Uc(),{spaceID:u}=Uo(),{trackUnityEvent:f,isReady:_}=bR(u,{enableDebugLogs:!0});return N.useEffect(()=>{let b=!0;const I=l("PlayVideo",async O=>{try{const{gameObjectName:L}=O;if(!L){$.error("Game object name is missing in Unity event data.");return}const M=await doe(u);$.log("SPACES VIDEOS",M);const F=M.find(z=>z.id===L);F&&b?(i(F.url),$.log("Video URL set to:",F.url),_&&a&&(f(na.UNITY.VIDEO_PLAY,{category:No.MEDIA_INTERACTION,videoId:L,videoUrl:F.url,videoTitle:F.title||F.name||L,isEditMode:!1,spaceId:u,timestamp:new Date().toISOString(),videoData:{gameObjectName:L,videoMetadata:F}}),$.log(" Analytics: Video play event tracked for:",L))):console.error("Video not found for game object:",L)}catch(L){console.error("Error fetching space videos:",L)}});return()=>{b=!1,I()}},[l,u,n]),[e,()=>{i(null)}]},Hze=()=>{const[n,e]=N.useState(null),[i,a]=N.useState(!1),[l,u]=N.useState(null),f=Uc(),_=Mc();N.useEffect(()=>f("KickPlayerResult",I=>{$.log("KickPlayerResult event received:",I),I?(e(I),a(!1),I.success?u(null):u(I.errorMessage||"Failed to kick player")):($.error("Invalid KickPlayerResult data from Unity"),u("Invalid result from Unity"),a(!1))}),[f]);const E=N.useCallback((C,I)=>{var O;try{if(!C){u("Player UID is required");return}a(!0),u(null),e(null);const L={uid:C,requestedBy:I||((O=window.currentUser)==null?void 0:O.uid)};$.log("Sending KickPlayer event to Unity:",L),_("KickPlayer",L)}catch(L){$.error("Error kicking player:",L),u(L.message||"Failed to send kick request"),a(!1)}},[_]),b=N.useCallback(()=>{e(null),u(null),a(!1)},[]);return{kickPlayer:E,isKicking:i,kickResult:n,error:l,resetKickState:b}},$ze=n=>{const{placePortal:e}=voe();N.useEffect(()=>{const i=async()=>{try{const a=iu(Qn,"spaces",n,"portals"),l=await ed(a);if(l.empty){$.log("useSpacePortals: No portals found for space:",n);return}$.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(u=>{const f=u.data();$.log(`useSpacePortals: Placing portal ${f.portalId} in Unity:`,f),e(f.portalId,f.prefabName,f.position,f.rotation,f.scale)})}catch(a){$.error("useSpacePortals: Error loading portals:",a)}};if(window.unityInstance)$.log("useSpacePortals: Unity is ready, loading portals"),i();else{const a=()=>{$.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",a),()=>{window.removeEventListener("PlayerInstantiated",a)}}},[n,e])},boe=async(n,e)=>{console.log(" fetchPortalAnalyticsData called with:",{spaceId:n,portalId:e});let i=null,a=null;try{if(!n||!e)throw new Error(`Invalid parameters: spaceId=${n}, portalId=${e}`);const u=Sr(Qn,"spaces",n,"portals",e);console.log(" Querying Firestore path:",`spaces/${n}/portals/${e}`);const f=await Lo(u);if(f.exists()){const _=f.data();i=_.targetSpaceId,a=_.targetSpaceName,console.log(" Portal data fetched from Firestore:",{targetSpaceId:i,targetSpaceName:a})}else{console.warn(" Portal document not found in Firestore for:",e);const _=e.split("_");_.length>=3&&(i=_[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}}catch(u){console.error(" Error fetching portal data from Firestore:",u);const f=e.split("_");f.length>=3&&(i=f[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}const l={targetSpaceId:i,targetSpaceName:a};return console.log(" fetchPortalAnalyticsData returning:",l),l},Kze=()=>{const[n,e]=N.useState(null),{user:i}=N.useContext(ro),a=Uc(),{spaceID:l}=Uo(),{trackUnityEvent:u,isReady:f}=bR(l,{enableDebugLogs:!0});return N.useEffect(()=>{console.log("Setting up portal click listener...");const b=a("PortalClicked",async C=>{console.log("Portal click event received:",C);try{const I=typeof C=="string"?JSON.parse(C):C;if(console.log("Parsed portal data:",I),e(I),f&&i&&I&&I.portalId)try{const{targetSpaceId:O,targetSpaceName:L}=await boe(l,I.portalId);await u(na.UNITY.PORTAL_CLICK,{category:No.NAVIGATION,portalId:I.portalId,targetSpaceId:O,targetSpaceName:L,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked for:",I.portalId,"targeting:",L||O)}catch(O){console.error(" Analytics: Error tracking portal click:",O);try{await u(na.UNITY.PORTAL_CLICK,{category:No.NAVIGATION,portalId:I.portalId,targetSpaceId:null,targetSpaceName:null,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked (fallback) for:",I.portalId)}catch(L){console.error(" Analytics: Failed to track portal click even with fallback:",L)}}}catch(I){console.error("Error parsing portal click data:",I,"Data:",C)}});return()=>{console.log("Cleaning up portal click listener"),typeof b=="function"&&b()}},[a,f,i,l,u]),{clickedPortal:n,clearClickedPortal:()=>{console.log("Clearing clicked portal state"),e(null)},isAnalyticsReady:f,trackPortalClick:u}},qze=()=>{const{user:n}=N.useContext(ro),e=Uc(),{spaceID:i}=Uo(),{trackUnityEvent:a,isReady:l}=bR(i,{enableDebugLogs:!0});N.useEffect(()=>{console.log("Setting up portal navigation listener...");const f=e("PortalNavigate",async _=>{console.log(" PORTAL CLICKED BY PLAYER (non-edit mode)");try{const E=typeof _=="string"?JSON.parse(_):_;if(console.log("Portal data:",E),!E.portalId){console.error("Portal ID is missing from portal data");return}let b=null,C=null;try{const I=await boe(i,E.portalId);b=I.targetSpaceId,C=I.targetSpaceName}catch(I){console.error("Error fetching portal analytics data:",I);const O=E.portalId.split("_");O.length>=3&&(b=O[2])}if(b){if(console.log("Navigating to space:",b,`(${C||"Unknown space name"})`),l&&n&&E)try{await a(na.UNITY.PORTAL_NAVIGATE,{category:No.NAVIGATION,portalId:E.portalId,targetSpaceId:b,targetSpaceName:C,sourceSpaceId:i,isEditMode:!1,navigationType:"direct",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",E.portalId,"",C||b)}catch(I){console.error(" Analytics: Error tracking portal navigation:",I)}window.location.href=`/?spaceId=${b}`}else console.error("Could not determine target space ID from portal:",E.portalId)}catch(E){console.error("Error handling portal navigation:",E)}});return()=>{console.log("Cleaning up portal navigation listener"),typeof f=="function"&&f()}},[e,l,n,i,a])},Yze=n=>{const{placeCatalogueItem:e}=Soe();N.useEffect(()=>{const i=async()=>{try{const a=iu(Qn,"spaces",n,"catalogue"),l=await ed(a);if(l.empty){$.log("useSpaceCatalogueItems: No catalogue items found for space:",n);return}$.log(`useSpaceCatalogueItems: Found ${l.size} items for space ${n}`),l.forEach(u=>{const f=u.data();$.log(`useSpaceCatalogueItems: Placing item ${f.itemId} in Unity:`,f),e(f.itemId,f.glbUrl,f.position,f.rotation,f.scale)})}catch(a){$.error("useSpaceCatalogueItems: Error loading catalogue items:",a)}};if(window.unityInstance)$.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),i();else{const a=()=>{$.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),i()};return window.addEventListener("PlayerInstantiated",a),()=>{window.removeEventListener("PlayerInstantiated",a)}}},[n,e])},Toe=()=>{const[n,e]=N.useState(null),i=Uc();return N.useEffect(()=>{$.log("Setting up seating hotspot click listener...");const u=i("SeatingHotspotClicked",async f=>{$.log(" Seating hotspot click event received from Unity:",f);try{const _=typeof f=="string"?JSON.parse(f):f;$.log(" Parsed Unity click data:",_);const E=_.hotspotId.split("_");if(E.length>=3){const b=E.slice(1,-1).join("_");$.log(" Extracted spaceId:",b);const C=Sr(Qn,"spaces",b,"catalogue",_.hotspotId);$.log(" Fetching from Firebase path:",`spaces/${b}/catalogue/${_.hotspotId}`);const I=await Lo(C);if(I.exists()){const O=I.data();$.log(" Fetched Firebase data:",O),$.log(" Firebase position:",O.position),$.log(" Unity position:",_.position);const L={..._,position:O.position||_.position,rotation:O.rotation||_.rotation,scale:O.scale||_.scale};$.log(" Combined data being set:",L),e(L)}else $.warn(" Item not found in Firebase:",_.hotspotId),e(_)}else $.error(" Invalid hotspot ID format:",_.hotspotId),e(_)}catch(_){$.error(" Error handling seating hotspot click:",_,"Data:",f)}});return()=>{$.log("Cleaning up seating hotspot click listener"),typeof u=="function"&&u()}},[i]),{clickedItem:n,clearClickedItem:()=>{$.log("Clearing clicked item state"),e(null)}}},Xze=n=>({opacity:1});var TR=n=>n.type==="checkbox",Cy=n=>n instanceof Date,kc=n=>n==null;const woe=n=>typeof n=="object";var no=n=>!kc(n)&&!Array.isArray(n)&&woe(n)&&!Cy(n),Jze=n=>no(n)&&n.target?TR(n.target)?n.target.checked:n.target.value:n,Qze=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,Zze=(n,e)=>n.has(Qze(e)),eWe=n=>{const e=n.constructor&&n.constructor.prototype;return no(e)&&e.hasOwnProperty("isPrototypeOf")},J4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ku(n){let e;const i=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(J4&&(n instanceof Blob||a))&&(i||no(n)))if(e=i?[]:{},!i&&!eWe(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Ku(n[l]));else return n;return e}var E1=n=>Array.isArray(n)?n.filter(Boolean):[],lo=n=>n===void 0,pn=(n,e,i)=>{if(!e||!no(n))return i;const a=E1(e.split(/[,[\].]+?/)).reduce((l,u)=>kc(l)?l:l[u],n);return lo(a)||a===n?lo(n[e])?i:n[e]:a},np=n=>typeof n=="boolean",Q4=n=>/^\w*$/.test(n),Coe=n=>E1(n.replace(/["|']|\]/g,"").split(/\.|\[/)),ts=(n,e,i)=>{let a=-1;const l=Q4(e)?[e]:Coe(e),u=l.length,f=u-1;for(;++a<u;){const _=l[a];let E=i;if(a!==f){const b=n[_];E=no(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(_==="__proto__"||_==="constructor"||_==="prototype")return;n[_]=E,n=n[_]}return n};const rQ={BLUR:"blur",FOCUS_OUT:"focusout"},Jd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Cf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};fi.createContext(null);var tWe=(n,e,i,a=!0)=>{const l={defaultValues:e._defaultValues};for(const u in n)Object.defineProperty(l,u,{get:()=>{const f=u;return e._proxyFormState[f]!==Jd.all&&(e._proxyFormState[f]=!a||Jd.all),n[f]}});return l},gl=n=>no(n)&&!Object.keys(n).length,nWe=(n,e,i,a)=>{i(n);const{name:l,...u}=n;return gl(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(f=>e[f]===Jd.all)},Sk=n=>Array.isArray(n)?n:[n];function rWe(n){const e=fi.useRef(n);e.current=n,fi.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var hp=n=>typeof n=="string",iWe=(n,e,i,a,l)=>hp(n)?(a&&e.watch.add(n),pn(i,n,l)):Array.isArray(n)?n.map(u=>(a&&e.watch.add(u),pn(i,u))):(a&&(e.watchAll=!0),i),sWe=(n,e,i,a,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[a]:l||!0}}:{},iQ=n=>({isOnSubmit:!n||n===Jd.onSubmit,isOnBlur:n===Jd.onBlur,isOnChange:n===Jd.onChange,isOnAll:n===Jd.all,isOnTouch:n===Jd.onTouched}),sQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const yC=(n,e,i,a)=>{for(const l of i||Object.keys(n)){const u=pn(n,l);if(u){const{_f:f,..._}=u;if(f){if(f.refs&&f.refs[0]&&e(f.refs[0],l)&&!a)return!0;if(f.ref&&e(f.ref,f.name)&&!a)return!0;if(yC(_,e))break}else if(no(_)&&yC(_,e))break}}};var oWe=(n,e,i)=>{const a=Sk(pn(n,i));return ts(a,"root",e[i]),ts(n,i,a),n},Z4=n=>n.type==="file",cp=n=>typeof n=="function",uN=n=>{if(!J4)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},bk=n=>hp(n),e3=n=>n.type==="radio",dN=n=>n instanceof RegExp;const oQ={value:!1,isValid:!1},aQ={value:!0,isValid:!0};var Roe=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!lo(n[0].attributes.value)?lo(n[0].value)||n[0].value===""?aQ:{value:n[0].value,isValid:!0}:aQ:oQ}return oQ};const cQ={isValid:!1,value:null};var Ioe=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,cQ):cQ;function lQ(n,e,i="validate"){if(bk(n)||Array.isArray(n)&&n.every(bk)||np(n)&&!n)return{type:i,message:bk(n)?n:"",ref:e}}var PS=n=>no(n)&&!dN(n)?n:{value:n,message:""},uQ=async(n,e,i,a,l,u)=>{const{ref:f,refs:_,required:E,maxLength:b,minLength:C,min:I,max:O,pattern:L,validate:M,name:F,valueAsNumber:z,mount:X}=n._f,K=pn(i,F);if(!X||e.has(F))return{};const ne=_?_[0]:f,oe=ue=>{l&&ne.reportValidity&&(ne.setCustomValidity(np(ue)?"":ue||""),ne.reportValidity())},ae={},le=e3(f),Y=TR(f),Z=le||Y,Q=(z||Z4(f))&&lo(f.value)&&lo(K)||uN(f)&&f.value===""||K===""||Array.isArray(K)&&!K.length,ie=sWe.bind(null,F,a,ae),de=(ue,pe,ke,xe=Cf.maxLength,Fe=Cf.minLength)=>{const Oe=ue?pe:ke;ae[F]={type:ue?xe:Fe,message:Oe,ref:f,...ie(ue?xe:Fe,Oe)}};if(u?!Array.isArray(K)||!K.length:E&&(!Z&&(Q||kc(K))||np(K)&&!K||Y&&!Roe(_).isValid||le&&!Ioe(_).isValid)){const{value:ue,message:pe}=bk(E)?{value:!!E,message:E}:PS(E);if(ue&&(ae[F]={type:Cf.required,message:pe,ref:ne,...ie(Cf.required,pe)},!a))return oe(pe),ae}if(!Q&&(!kc(I)||!kc(O))){let ue,pe;const ke=PS(O),xe=PS(I);if(!kc(K)&&!isNaN(K)){const Fe=f.valueAsNumber||K&&+K;kc(ke.value)||(ue=Fe>ke.value),kc(xe.value)||(pe=Fe<xe.value)}else{const Fe=f.valueAsDate||new Date(K),Oe=Be=>new Date(new Date().toDateString()+" "+Be),we=f.type=="time",Se=f.type=="week";hp(ke.value)&&K&&(ue=we?Oe(K)>Oe(ke.value):Se?K>ke.value:Fe>new Date(ke.value)),hp(xe.value)&&K&&(pe=we?Oe(K)<Oe(xe.value):Se?K<xe.value:Fe<new Date(xe.value))}if((ue||pe)&&(de(!!ue,ke.message,xe.message,Cf.max,Cf.min),!a))return oe(ae[F].message),ae}if((b||C)&&!Q&&(hp(K)||u&&Array.isArray(K))){const ue=PS(b),pe=PS(C),ke=!kc(ue.value)&&K.length>+ue.value,xe=!kc(pe.value)&&K.length<+pe.value;if((ke||xe)&&(de(ke,ue.message,pe.message),!a))return oe(ae[F].message),ae}if(L&&!Q&&hp(K)){const{value:ue,message:pe}=PS(L);if(dN(ue)&&!K.match(ue)&&(ae[F]={type:Cf.pattern,message:pe,ref:f,...ie(Cf.pattern,pe)},!a))return oe(pe),ae}if(M){if(cp(M)){const ue=await M(K,i),pe=lQ(ue,ne);if(pe&&(ae[F]={...pe,...ie(Cf.validate,pe.message)},!a))return oe(pe.message),ae}else if(no(M)){let ue={};for(const pe in M){if(!gl(ue)&&!a)break;const ke=lQ(await M[pe](K,i),ne,pe);ke&&(ue={...ke,...ie(pe,ke.message)},oe(ke.message),a&&(ae[F]=ue))}if(!gl(ue)&&(ae[F]={ref:ne,...ue},!a))return ae}}return oe(!0),ae};function aWe(n,e){const i=e.slice(0,-1).length;let a=0;for(;a<i;)n=lo(n)?a++:n[e[a++]];return n}function cWe(n){for(const e in n)if(n.hasOwnProperty(e)&&!lo(n[e]))return!1;return!0}function Ro(n,e){const i=Array.isArray(e)?e:Q4(e)?[e]:Coe(e),a=i.length===1?n:aWe(n,i),l=i.length-1,u=i[l];return a&&delete a[u],l!==0&&(no(a)&&gl(a)||Array.isArray(a)&&cWe(a))&&Ro(n,i.slice(0,-1)),n}var mU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const u of n)u.next&&u.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(u=>u!==l)}}),unsubscribe:()=>{n=[]}}},JV=n=>kc(n)||!woe(n);function bg(n,e){if(JV(n)||JV(e))return n===e;if(Cy(n)&&Cy(e))return n.getTime()===e.getTime();const i=Object.keys(n),a=Object.keys(e);if(i.length!==a.length)return!1;for(const l of i){const u=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=e[l];if(Cy(u)&&Cy(f)||no(u)&&no(f)||Array.isArray(u)&&Array.isArray(f)?!bg(u,f):u!==f)return!1}}return!0}var Aoe=n=>n.type==="select-multiple",lWe=n=>e3(n)||TR(n),gU=n=>uN(n)&&n.isConnected,Poe=n=>{for(const e in n)if(cp(n[e]))return!0;return!1};function hN(n,e={}){const i=Array.isArray(n);if(no(n)||i)for(const a in n)Array.isArray(n[a])||no(n[a])&&!Poe(n[a])?(e[a]=Array.isArray(n[a])?[]:{},hN(n[a],e[a])):kc(n[a])||(e[a]=!0);return e}function Ooe(n,e,i){const a=Array.isArray(n);if(no(n)||a)for(const l in n)Array.isArray(n[l])||no(n[l])&&!Poe(n[l])?lo(e)||JV(i[l])?i[l]=Array.isArray(n[l])?hN(n[l],[]):{...hN(n[l])}:Ooe(n[l],kc(e)?{}:e[l],i[l]):i[l]=!bg(n[l],e[l]);return i}var Aw=(n,e)=>Ooe(n,e,hN(e)),koe=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:a})=>lo(n)?n:e?n===""?NaN:n&&+n:i&&hp(n)?new Date(n):a?a(n):n;function _U(n){const e=n.ref;return Z4(e)?e.files:e3(e)?Ioe(n.refs).value:Aoe(e)?[...e.selectedOptions].map(({value:i})=>i):TR(e)?Roe(n.refs).value:koe(lo(e.value)?n.ref.value:e.value,n)}var uWe=(n,e,i,a)=>{const l={};for(const u of n){const f=pn(e,u);f&&ts(l,u,f._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:a}},Pw=n=>lo(n)?n:dN(n)?n.source:no(n)?dN(n.value)?n.value.source:n.value:n;const dQ="AsyncFunction";var dWe=n=>!!n&&!!n.validate&&!!(cp(n.validate)&&n.validate.constructor.name===dQ||no(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===dQ)),hWe=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function hQ(n,e,i){const a=pn(n,i);if(a||Q4(i))return{error:a,name:i};const l=i.split(".");for(;l.length;){const u=l.join("."),f=pn(e,u),_=pn(n,u);if(f&&!Array.isArray(f)&&i!==u)return{name:i};if(_&&_.type)return{name:u,error:_};l.pop()}return{name:i}}var pWe=(n,e,i,a,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?a.isOnBlur:l.isOnBlur)?!n:(i?a.isOnChange:l.isOnChange)?n:!0,fWe=(n,e)=>!E1(pn(n,e)).length&&Ro(n,e);const mWe={mode:Jd.onSubmit,reValidateMode:Jd.onChange,shouldFocusError:!0};function gWe(n={}){let e={...mWe,...n},i={submitCount:0,isDirty:!1,isLoading:cp(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},a={},l=no(e.defaultValues)||no(e.values)?Ku(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:Ku(l),f={action:!1,mount:!1,watch:!1},_={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},E,b=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:mU(),array:mU(),state:mU()},O=iQ(e.mode),L=iQ(e.reValidateMode),M=e.criteriaMode===Jd.all,F=Te=>Ve=>{clearTimeout(b),b=setTimeout(Te,Ve)},z=async Te=>{if(!e.disabled&&(C.isValid||Te)){const Ve=e.resolver?gl((await Z()).errors):await ie(a,!0);Ve!==i.isValid&&I.state.next({isValid:Ve})}},X=(Te,Ve)=>{!e.disabled&&(C.isValidating||C.validatingFields)&&((Te||Array.from(_.mount)).forEach($e=>{$e&&(Ve?ts(i.validatingFields,$e,Ve):Ro(i.validatingFields,$e))}),I.state.next({validatingFields:i.validatingFields,isValidating:!gl(i.validatingFields)}))},K=(Te,Ve=[],$e,Et,vt=!0,St=!0)=>{if(Et&&$e&&!e.disabled){if(f.action=!0,St&&Array.isArray(pn(a,Te))){const Wt=$e(pn(a,Te),Et.argA,Et.argB);vt&&ts(a,Te,Wt)}if(St&&Array.isArray(pn(i.errors,Te))){const Wt=$e(pn(i.errors,Te),Et.argA,Et.argB);vt&&ts(i.errors,Te,Wt),fWe(i.errors,Te)}if(C.touchedFields&&St&&Array.isArray(pn(i.touchedFields,Te))){const Wt=$e(pn(i.touchedFields,Te),Et.argA,Et.argB);vt&&ts(i.touchedFields,Te,Wt)}C.dirtyFields&&(i.dirtyFields=Aw(l,u)),I.state.next({name:Te,isDirty:ue(Te,Ve),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else ts(u,Te,Ve)},ne=(Te,Ve)=>{ts(i.errors,Te,Ve),I.state.next({errors:i.errors})},oe=Te=>{i.errors=Te,I.state.next({errors:i.errors,isValid:!1})},ae=(Te,Ve,$e,Et)=>{const vt=pn(a,Te);if(vt){const St=pn(u,Te,lo($e)?pn(l,Te):$e);lo(St)||Et&&Et.defaultChecked||Ve?ts(u,Te,Ve?St:_U(vt._f)):xe(Te,St),f.mount&&z()}},le=(Te,Ve,$e,Et,vt)=>{let St=!1,Wt=!1;const dn={name:Te};if(!e.disabled){const En=!!(pn(a,Te)&&pn(a,Te)._f&&pn(a,Te)._f.disabled);if(!$e||Et){C.isDirty&&(Wt=i.isDirty,i.isDirty=dn.isDirty=ue(),St=Wt!==dn.isDirty);const tn=En||bg(pn(l,Te),Ve);Wt=!!(!En&&pn(i.dirtyFields,Te)),tn||En?Ro(i.dirtyFields,Te):ts(i.dirtyFields,Te,!0),dn.dirtyFields=i.dirtyFields,St=St||C.dirtyFields&&Wt!==!tn}if($e){const tn=pn(i.touchedFields,Te);tn||(ts(i.touchedFields,Te,$e),dn.touchedFields=i.touchedFields,St=St||C.touchedFields&&tn!==$e)}St&&vt&&I.state.next(dn)}return St?dn:{}},Y=(Te,Ve,$e,Et)=>{const vt=pn(i.errors,Te),St=C.isValid&&np(Ve)&&i.isValid!==Ve;if(e.delayError&&$e?(E=F(()=>ne(Te,$e)),E(e.delayError)):(clearTimeout(b),E=null,$e?ts(i.errors,Te,$e):Ro(i.errors,Te)),($e?!bg(vt,$e):vt)||!gl(Et)||St){const Wt={...Et,...St&&np(Ve)?{isValid:Ve}:{},errors:i.errors,name:Te};i={...i,...Wt},I.state.next(Wt)}},Z=async Te=>{X(Te,!0);const Ve=await e.resolver(u,e.context,uWe(Te||_.mount,a,e.criteriaMode,e.shouldUseNativeValidation));return X(Te),Ve},Q=async Te=>{const{errors:Ve}=await Z(Te);if(Te)for(const $e of Te){const Et=pn(Ve,$e);Et?ts(i.errors,$e,Et):Ro(i.errors,$e)}else i.errors=Ve;return Ve},ie=async(Te,Ve,$e={valid:!0})=>{for(const Et in Te){const vt=Te[Et];if(vt){const{_f:St,...Wt}=vt;if(St){const dn=_.array.has(St.name),En=vt._f&&dWe(vt._f);En&&C.validatingFields&&X([Et],!0);const tn=await uQ(vt,_.disabled,u,M,e.shouldUseNativeValidation&&!Ve,dn);if(En&&C.validatingFields&&X([Et]),tn[St.name]&&($e.valid=!1,Ve))break;!Ve&&(pn(tn,St.name)?dn?oWe(i.errors,tn,St.name):ts(i.errors,St.name,tn[St.name]):Ro(i.errors,St.name))}!gl(Wt)&&await ie(Wt,Ve,$e)}}return $e.valid},de=()=>{for(const Te of _.unMount){const Ve=pn(a,Te);Ve&&(Ve._f.refs?Ve._f.refs.every($e=>!gU($e)):!gU(Ve._f.ref))&&He(Te)}_.unMount=new Set},ue=(Te,Ve)=>!e.disabled&&(Te&&Ve&&ts(u,Te,Ve),!bg(Ee(),l)),pe=(Te,Ve,$e)=>iWe(Te,_,{...f.mount?u:lo(Ve)?l:hp(Te)?{[Te]:Ve}:Ve},$e,Ve),ke=Te=>E1(pn(f.mount?u:l,Te,e.shouldUnregister?pn(l,Te,[]):[])),xe=(Te,Ve,$e={})=>{const Et=pn(a,Te);let vt=Ve;if(Et){const St=Et._f;St&&(!St.disabled&&ts(u,Te,koe(Ve,St)),vt=uN(St.ref)&&kc(Ve)?"":Ve,Aoe(St.ref)?[...St.ref.options].forEach(Wt=>Wt.selected=vt.includes(Wt.value)):St.refs?TR(St.ref)?St.refs.length>1?St.refs.forEach(Wt=>(!Wt.defaultChecked||!Wt.disabled)&&(Wt.checked=Array.isArray(vt)?!!vt.find(dn=>dn===Wt.value):vt===Wt.value)):St.refs[0]&&(St.refs[0].checked=!!vt):St.refs.forEach(Wt=>Wt.checked=Wt.value===vt):Z4(St.ref)?St.ref.value="":(St.ref.value=vt,St.ref.type||I.values.next({name:Te,values:{...u}})))}($e.shouldDirty||$e.shouldTouch)&&le(Te,vt,$e.shouldTouch,$e.shouldDirty,!0),$e.shouldValidate&&Be(Te)},Fe=(Te,Ve,$e)=>{for(const Et in Ve){const vt=Ve[Et],St=`${Te}.${Et}`,Wt=pn(a,St);(_.array.has(Te)||no(vt)||Wt&&!Wt._f)&&!Cy(vt)?Fe(St,vt,$e):xe(St,vt,$e)}},Oe=(Te,Ve,$e={})=>{const Et=pn(a,Te),vt=_.array.has(Te),St=Ku(Ve);ts(u,Te,St),vt?(I.array.next({name:Te,values:{...u}}),(C.isDirty||C.dirtyFields)&&$e.shouldDirty&&I.state.next({name:Te,dirtyFields:Aw(l,u),isDirty:ue(Te,St)})):Et&&!Et._f&&!kc(St)?Fe(Te,St,$e):xe(Te,St,$e),sQ(Te,_)&&I.state.next({...i}),I.values.next({name:f.mount?Te:void 0,values:{...u}})},we=async Te=>{f.mount=!0;const Ve=Te.target;let $e=Ve.name,Et=!0;const vt=pn(a,$e),St=()=>Ve.type?_U(vt._f):Jze(Te),Wt=dn=>{Et=Number.isNaN(dn)||Cy(dn)&&isNaN(dn.getTime())||bg(dn,pn(u,$e,dn))};if(vt){let dn,En;const tn=St(),wt=Te.type===rQ.BLUR||Te.type===rQ.FOCUS_OUT,sr=!hWe(vt._f)&&!e.resolver&&!pn(i.errors,$e)&&!vt._f.deps||pWe(wt,pn(i.touchedFields,$e),i.isSubmitted,L,O),xt=sQ($e,_,wt);ts(u,$e,tn),wt?(vt._f.onBlur&&vt._f.onBlur(Te),E&&E(0)):vt._f.onChange&&vt._f.onChange(Te);const qt=le($e,tn,wt,!1),br=!gl(qt)||xt;if(!wt&&I.values.next({name:$e,type:Te.type,values:{...u}}),sr)return C.isValid&&(e.mode==="onBlur"&&wt?z():wt||z()),br&&I.state.next({name:$e,...xt?{}:qt});if(!wt&&xt&&I.state.next({...i}),e.resolver){const{errors:wi}=await Z([$e]);if(Wt(tn),Et){const Cs=hQ(i.errors,a,$e),cr=hQ(wi,a,Cs.name||$e);dn=cr.error,$e=cr.name,En=gl(wi)}}else X([$e],!0),dn=(await uQ(vt,_.disabled,u,M,e.shouldUseNativeValidation))[$e],X([$e]),Wt(tn),Et&&(dn?En=!1:C.isValid&&(En=await ie(a,!0)));Et&&(vt._f.deps&&Be(vt._f.deps),Y($e,En,dn,qt))}},Se=(Te,Ve)=>{if(pn(i.errors,Ve)&&Te.focus)return Te.focus(),1},Be=async(Te,Ve={})=>{let $e,Et;const vt=Sk(Te);if(e.resolver){const St=await Q(lo(Te)?Te:vt);$e=gl(St),Et=Te?!vt.some(Wt=>pn(St,Wt)):$e}else Te?(Et=(await Promise.all(vt.map(async St=>{const Wt=pn(a,St);return await ie(Wt&&Wt._f?{[St]:Wt}:Wt)}))).every(Boolean),!(!Et&&!i.isValid)&&z()):Et=$e=await ie(a);return I.state.next({...!hp(Te)||C.isValid&&$e!==i.isValid?{}:{name:Te},...e.resolver||!Te?{isValid:$e}:{},errors:i.errors}),Ve.shouldFocus&&!Et&&yC(a,Se,Te?vt:_.mount),Et},Ee=Te=>{const Ve={...f.mount?u:l};return lo(Te)?Ve:hp(Te)?pn(Ve,Te):Te.map($e=>pn(Ve,$e))},Ce=(Te,Ve)=>({invalid:!!pn((Ve||i).errors,Te),isDirty:!!pn((Ve||i).dirtyFields,Te),error:pn((Ve||i).errors,Te),isValidating:!!pn(i.validatingFields,Te),isTouched:!!pn((Ve||i).touchedFields,Te)}),Pe=Te=>{Te&&Sk(Te).forEach(Ve=>Ro(i.errors,Ve)),I.state.next({errors:Te?i.errors:{}})},Me=(Te,Ve,$e)=>{const Et=(pn(a,Te,{_f:{}})._f||{}).ref,vt=pn(i.errors,Te)||{},{ref:St,message:Wt,type:dn,...En}=vt;ts(i.errors,Te,{...En,...Ve,ref:Et}),I.state.next({name:Te,errors:i.errors,isValid:!1}),$e&&$e.shouldFocus&&Et&&Et.focus&&Et.focus()},ze=(Te,Ve)=>cp(Te)?I.values.subscribe({next:$e=>Te(pe(void 0,Ve),$e)}):pe(Te,Ve,!0),He=(Te,Ve={})=>{for(const $e of Te?Sk(Te):_.mount)_.mount.delete($e),_.array.delete($e),Ve.keepValue||(Ro(a,$e),Ro(u,$e)),!Ve.keepError&&Ro(i.errors,$e),!Ve.keepDirty&&Ro(i.dirtyFields,$e),!Ve.keepTouched&&Ro(i.touchedFields,$e),!Ve.keepIsValidating&&Ro(i.validatingFields,$e),!e.shouldUnregister&&!Ve.keepDefaultValue&&Ro(l,$e);I.values.next({values:{...u}}),I.state.next({...i,...Ve.keepDirty?{isDirty:ue()}:{}}),!Ve.keepIsValid&&z()},qe=({disabled:Te,name:Ve,field:$e,fields:Et})=>{(np(Te)&&f.mount||Te||_.disabled.has(Ve))&&(Te?_.disabled.add(Ve):_.disabled.delete(Ve),le(Ve,_U($e?$e._f:pn(Et,Ve)._f),!1,!1,!0))},nt=(Te,Ve={})=>{let $e=pn(a,Te);const Et=np(Ve.disabled)||np(e.disabled);return ts(a,Te,{...$e||{},_f:{...$e&&$e._f?$e._f:{ref:{name:Te}},name:Te,mount:!0,...Ve}}),_.mount.add(Te),$e?qe({field:$e,disabled:np(Ve.disabled)?Ve.disabled:e.disabled,name:Te}):ae(Te,!0,Ve.value),{...Et?{disabled:Ve.disabled||e.disabled}:{},...e.progressive?{required:!!Ve.required,min:Pw(Ve.min),max:Pw(Ve.max),minLength:Pw(Ve.minLength),maxLength:Pw(Ve.maxLength),pattern:Pw(Ve.pattern)}:{},name:Te,onChange:we,onBlur:we,ref:vt=>{if(vt){nt(Te,Ve),$e=pn(a,Te);const St=lo(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,Wt=lWe(St),dn=$e._f.refs||[];if(Wt?dn.find(En=>En===St):St===$e._f.ref)return;ts(a,Te,{_f:{...$e._f,...Wt?{refs:[...dn.filter(gU),St,...Array.isArray(pn(l,Te))?[{}]:[]],ref:{type:St.type,name:Te}}:{ref:St}}}),ae(Te,!1,void 0,St)}else $e=pn(a,Te,{}),$e._f&&($e._f.mount=!1),(e.shouldUnregister||Ve.shouldUnregister)&&!(Zze(_.array,Te)&&f.action)&&_.unMount.add(Te)}}},Ze=()=>e.shouldFocusError&&yC(a,Se,_.mount),gt=Te=>{np(Te)&&(I.state.next({disabled:Te}),yC(a,(Ve,$e)=>{const Et=pn(a,$e);Et&&(Ve.disabled=Et._f.disabled||Te,Array.isArray(Et._f.refs)&&Et._f.refs.forEach(vt=>{vt.disabled=Et._f.disabled||Te}))},0,!1))},sn=(Te,Ve)=>async $e=>{let Et;$e&&($e.preventDefault&&$e.preventDefault(),$e.persist&&$e.persist());let vt=Ku(u);if(_.disabled.size)for(const St of _.disabled)ts(vt,St,void 0);if(I.state.next({isSubmitting:!0}),e.resolver){const{errors:St,values:Wt}=await Z();i.errors=St,vt=Wt}else await ie(a);if(Ro(i.errors,"root"),gl(i.errors)){I.state.next({errors:{}});try{await Te(vt,$e)}catch(St){Et=St}}else Ve&&await Ve({...i.errors},$e),Ze(),setTimeout(Ze);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:gl(i.errors)&&!Et,submitCount:i.submitCount+1,errors:i.errors}),Et)throw Et},ut=(Te,Ve={})=>{pn(a,Te)&&(lo(Ve.defaultValue)?Oe(Te,Ku(pn(l,Te))):(Oe(Te,Ve.defaultValue),ts(l,Te,Ku(Ve.defaultValue))),Ve.keepTouched||Ro(i.touchedFields,Te),Ve.keepDirty||(Ro(i.dirtyFields,Te),i.isDirty=Ve.defaultValue?ue(Te,Ku(pn(l,Te))):ue()),Ve.keepError||(Ro(i.errors,Te),C.isValid&&z()),I.state.next({...i}))},kt=(Te,Ve={})=>{const $e=Te?Ku(Te):l,Et=Ku($e),vt=gl(Te),St=vt?l:Et;if(Ve.keepDefaultValues||(l=$e),!Ve.keepValues){if(Ve.keepDirtyValues){const Wt=new Set([..._.mount,...Object.keys(Aw(l,u))]);for(const dn of Array.from(Wt))pn(i.dirtyFields,dn)?ts(St,dn,pn(u,dn)):Oe(dn,pn(St,dn))}else{if(J4&&lo(Te))for(const Wt of _.mount){const dn=pn(a,Wt);if(dn&&dn._f){const En=Array.isArray(dn._f.refs)?dn._f.refs[0]:dn._f.ref;if(uN(En)){const tn=En.closest("form");if(tn){tn.reset();break}}}}a={}}u=e.shouldUnregister?Ve.keepDefaultValues?Ku(l):{}:Ku(St),I.array.next({values:{...St}}),I.values.next({values:{...St}})}_={mount:Ve.keepDirtyValues?_.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!C.isValid||!!Ve.keepIsValid||!!Ve.keepDirtyValues,f.watch=!!e.shouldUnregister,I.state.next({submitCount:Ve.keepSubmitCount?i.submitCount:0,isDirty:vt?!1:Ve.keepDirty?i.isDirty:!!(Ve.keepDefaultValues&&!bg(Te,l)),isSubmitted:Ve.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:vt?{}:Ve.keepDirtyValues?Ve.keepDefaultValues&&u?Aw(l,u):i.dirtyFields:Ve.keepDefaultValues&&Te?Aw(l,Te):Ve.keepDirty?i.dirtyFields:{},touchedFields:Ve.keepTouched?i.touchedFields:{},errors:Ve.keepErrors?i.errors:{},isSubmitSuccessful:Ve.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},ct=(Te,Ve)=>kt(cp(Te)?Te(u):Te,Ve);return{control:{register:nt,unregister:He,getFieldState:Ce,handleSubmit:sn,setError:Me,_executeSchema:Z,_getWatch:pe,_getDirty:ue,_updateValid:z,_removeUnmounted:de,_updateFieldArray:K,_updateDisabledField:qe,_getFieldArray:ke,_reset:kt,_resetDefaultValues:()=>cp(e.defaultValues)&&e.defaultValues().then(Te=>{ct(Te,e.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Te=>{i={...i,...Te}},_disableForm:gt,_subjects:I,_proxyFormState:C,_setErrors:oe,get _fields(){return a},get _formValues(){return u},get _state(){return f},set _state(Te){f=Te},get _defaultValues(){return l},get _names(){return _},set _names(Te){_=Te},get _formState(){return i},set _formState(Te){i=Te},get _options(){return e},set _options(Te){e={...e,...Te}}},trigger:Be,register:nt,handleSubmit:sn,watch:ze,setValue:Oe,getValues:Ee,reset:ct,resetField:ut,clearErrors:Pe,unregister:He,setError:Me,setFocus:(Te,Ve={})=>{const $e=pn(a,Te),Et=$e&&$e._f;if(Et){const vt=Et.refs?Et.refs[0]:Et.ref;vt.focus&&(vt.focus(),Ve.shouldSelect&&cp(vt.select)&&vt.select())}},getFieldState:Ce}}function Noe(n={}){const e=fi.useRef(void 0),i=fi.useRef(void 0),[a,l]=fi.useState({isDirty:!1,isValidating:!1,isLoading:cp(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:cp(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...gWe(n),formState:a});const u=e.current.control;return u._options=n,rWe({subject:u._subjects.state,next:f=>{nWe(f,u._proxyFormState,u._updateFormState)&&l({...u._formState})}}),fi.useEffect(()=>u._disableForm(n.disabled),[u,n.disabled]),fi.useEffect(()=>{if(u._proxyFormState.isDirty){const f=u._getDirty();f!==a.isDirty&&u._subjects.state.next({isDirty:f})}},[u,a.isDirty]),fi.useEffect(()=>{n.values&&!bg(n.values,i.current)?(u._reset(n.values,u._options.resetOptions),i.current=n.values,l(f=>({...f}))):u._resetDefaultValues()},[n.values,u]),fi.useEffect(()=>{n.errors&&u._setErrors(n.errors)},[n.errors,u]),fi.useEffect(()=>{u._state.mount||(u._updateValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),fi.useEffect(()=>{n.shouldUnregister&&u._subjects.values.next({values:u._getWatch()})},[n.shouldUnregister,u]),e.current.formState=tWe(a,u),e.current}var _We=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function QV(){return QV=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},QV.apply(this,arguments)}function yWe(n,e){if(n==null)return{};var i={},a=Object.keys(n),l,u;for(u=0;u<a.length;u++)l=a[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function FO(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function EWe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,ZV(n,e)}function ZV(n,e){return ZV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,l){return a.__proto__=l,a},ZV(n,e)}var v1=function(n){EWe(e,n);function e(){var a;return a=n.call(this)||this,a.handleExpired=a.handleExpired.bind(FO(a)),a.handleErrored=a.handleErrored.bind(FO(a)),a.handleChange=a.handleChange.bind(FO(a)),a.handleRecaptchaRef=a.handleRecaptchaRef.bind(FO(a)),a}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(u,f){l.executionResolve=u,l.executionReject=f,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var u=document.createElement("div");this._widgetId=l(u,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(u)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var u=yWe(l,_We);return N.createElement("div",QV({},u,{ref:this.handleRecaptchaRef}))},e}(N.Component);v1.displayName="ReCAPTCHA";v1.propTypes={sitekey:An.string.isRequired,onChange:An.func,grecaptcha:An.object,theme:An.oneOf(["dark","light"]),type:An.oneOf(["image","audio"]),tabindex:An.number,onExpired:An.func,onErrored:An.func,size:An.oneOf(["compact","normal","invisible"]),stoken:An.string,hl:An.string,badge:An.oneOf(["bottomright","bottomleft","inline"]),isolated:An.bool};v1.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function eF(){return eF=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},eF.apply(this,arguments)}function vWe(n,e){if(n==null)return{};var i={},a=Object.keys(n),l,u;for(u=0;u<a.length;u++)l=a[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function SWe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var Kd={},bWe=0;function TWe(n,e){return e=e||{},function(a){var l=a.displayName||a.name||"Component",u=function(_){SWe(E,_);function E(C,I){var O;return O=_.call(this,C,I)||this,O.state={},O.__scriptURL="",O}var b=E.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+bWe++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(I){var O=this;this.setState(I,function(){return O.props.asyncScriptOnLoad&&O.props.asyncScriptOnLoad(O.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=Kd[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var O in I.observers)I.observers[O](I);delete window[e.callbackName]},b.componentDidMount=function(){var I=this,O=this.setupScriptURL(),L=this.asyncScriptLoaderGetScriptLoaderID(),M=e,F=M.globalName,z=M.callbackName,X=M.scriptId;if(F&&typeof window[F]<"u"&&(Kd[O]={loaded:!0,observers:{}}),Kd[O]){var K=Kd[O];if(K&&(K.loaded||K.errored)){this.asyncScriptLoaderHandleLoad(K);return}K.observers[L]=function(Y){return I.asyncScriptLoaderHandleLoad(Y)};return}var ne={};ne[L]=function(Y){return I.asyncScriptLoaderHandleLoad(Y)},Kd[O]={loaded:!1,observers:ne};var oe=document.createElement("script");oe.src=O,oe.async=!0;for(var ae in e.attributes)oe.setAttribute(ae,e.attributes[ae]);X&&(oe.id=X);var le=function(Z){if(Kd[O]){var Q=Kd[O],ie=Q.observers;for(var de in ie)Z(ie[de])&&delete ie[de]}};z&&typeof window<"u"&&(window[z]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),oe.onload=function(){var Y=Kd[O];Y&&(Y.loaded=!0,le(function(Z){return z?!1:(Z(Y),!0)}))},oe.onerror=function(){var Y=Kd[O];Y&&(Y.errored=!0,le(function(Z){return Z(Y),!0}))},document.body.appendChild(oe)},b.componentWillUnmount=function(){var I=this.__scriptURL;if(e.removeOnUnmount===!0)for(var O=document.getElementsByTagName("script"),L=0;L<O.length;L+=1)O[L].src.indexOf(I)>-1&&O[L].parentNode&&O[L].parentNode.removeChild(O[L]);var M=Kd[I];M&&(delete M.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete Kd[I])},b.render=function(){var I=e.globalName,O=this.props;O.asyncScriptOnLoad;var L=O.forwardedRef,M=vWe(O,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(M[I]=typeof window[I]<"u"?window[I]:void 0),M.ref=L,N.createElement(a,M)},E}(N.Component),f=N.forwardRef(function(_,E){return N.createElement(u,eF({},_,{forwardedRef:E}))});return f.displayName="AsyncScriptLoader("+l+")",f.propTypes={asyncScriptOnLoad:An.func},cIe(f,a)}}var tF="onloadcallback",wWe="grecaptcha";function nF(){return typeof window<"u"&&window.recaptchaOptions||{}}function CWe(){var n=nF(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+tF+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+tF+"&render=explicit"}const Doe=TWe(CWe,{callbackName:tF,globalName:wWe,attributes:nF().nonce?{nonce:nF().nonce}:{}})(v1),S1=(n,e="generic-modal")=>{N.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),$.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){$.error(`Failed to disable Unity input for ${e}:`,l)}},a=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),$.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):$.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){$.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():a(),()=>{n&&a()}},[n,e])},xoe=({isOpen:n,onClose:e,userData:i,onConfirm:a,fullscreenRef:l})=>{const[u,f]=N.useState((i==null?void 0:i.username)||""),[_,E]=N.useState((i==null?void 0:i.Nickname)||""),[b,C]=N.useState(!1),[I,O]=N.useState(null),[L,M]=N.useState(!1),F=dc(),z=oe=>!(!oe||oe.trim()===""||!/^[a-z0-9]{1,15}$/.test(oe)),X=async oe=>{var ae,le;if(!z(oe))return!oe||oe.trim()===""?O("Username cannot be empty"):O("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),O(null);try{let Y=!1,Z=0;const Q=3;for(;Z<Q;)try{Y=await $se(oe);break}catch(ie){if($.error(`Attempt ${Z+1}: Error checking username:`,ie),Z++,Z>=Q)throw ie;await new Promise(de=>setTimeout(de,1e3))}return Y?(O("Username is already taken"),!1):!0}catch(Y){return $.error("Error checking username after retries:",Y),Y.code==="permission-denied"||(ae=Y.message)!=null&&ae.includes("permissions")?O("Username check unavailable. Please try again or pick a unique name."):O("Error checking username availability. Please try again."),Y.code==="permission-denied"||((le=Y.message)==null?void 0:le.includes("permissions"))}finally{C(!1)}};N.useEffect(()=>{if(!u){O("Username cannot be empty");return}if(u!==(i==null?void 0:i.username)){const oe=setTimeout(async()=>{await X(u)},500);return()=>clearTimeout(oe)}},[u]),N.useEffect(()=>{if(i&&i.firstName&&i.lastName){const oe=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;E(oe)}},[i]);const K=async()=>{M(!0);try{if(!await X(u)){M(!1);return}if(_.length>15){O("Display Name must be at most 15 characters"),M(!1);return}qw(_),$.log("UsernameConfirmation: Preparing to confirm user registration");const ae=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",le={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:u,Nickname:_||ae,email:i.email,password:i.password};$.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(le).join(", ")),await a(le),e()}catch(oe){$.error("Error during username confirmation:",oe),F({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{M(!1)}},ne=()=>{L||e()};return T.jsxs(vs,{isOpen:n,onClose:ne,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!L,closeOnEsc:!L,children:[T.jsx(Ts,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),T.jsxs(Ss,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[T.jsxs(fo,{children:[T.jsx(FC,{size:"lg",mb:2,children:"Customize Your Profile"}),T.jsx(at,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),T.jsx(zs,{color:"gray.400",isDisabled:L}),T.jsx(bs,{children:T.jsxs(ai,{spacing:6,align:"stretch",children:[T.jsxs(Br,{isInvalid:!!I,children:[T.jsx(ns,{children:"Username"}),T.jsxs(My,{children:[T.jsx(kj,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),T.jsx(Gi,{placeholder:"username",value:u,onChange:oe=>f(oe.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?T.jsx(sp,{children:I}):T.jsx(t0,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),T.jsxs(Br,{children:[T.jsx(ns,{children:"Nickname"}),T.jsx(Gi,{placeholder:"Nickname",value:_,onChange:oe=>E(oe.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),T.jsx(t0,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),T.jsx(nh,{children:T.jsxs(is,{gap:3,width:"100%",children:[T.jsx(Yn,{variant:"outline",onClick:ne,flex:"1",isDisabled:L,children:"Back"}),T.jsx(Yn,{colorScheme:"blue",onClick:K,isLoading:L||b,isDisabled:!!I||!u||L,flex:"2",children:"Finish"})]})})]})]})};xoe.propTypes={isOpen:An.bool.isRequired,onClose:An.func.isRequired,userData:An.object.isRequired,onConfirm:An.func.isRequired,fullscreenRef:An.object};const RWe="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function t3({mode:n,label:e,buttonProps:i={},isOpen:a,onClose:l}){const{register:u,handleSubmit:f,formState:{errors:_}}=Noe(),{register:E}=N.useContext(ro),b=dc(),{fullscreenRef:C}=ch(),[I,O]=N.useState(!1),[L,M]=N.useState(!1),[F,z]=N.useState(null),X=N.useRef(null),[K,ne]=N.useState(!1),[oe,ae]=N.useState(null),[le,Y]=N.useState(!1),Z=a!==void 0?a:I,Q=l||(()=>O(!1));S1(Z||K),N.useEffect(()=>{!Z&&X.current&&(X.current.reset(),z(null))},[Z]);const ie=xe=>{z(xe)},de=async xe=>{$.log("Register.jsx: Processing registration form submission");const{email:Fe,password:Oe,confirmPassword:we,...Se}=xe;if($.log("Register.jsx: Registration data fields:",Object.keys(Se).join(", ")),!F){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(Oe!==we){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}qw(Se.firstName),qw(Se.lastName),qw(Se.companyName),M(!0);try{const Be=await FBe(Se.firstName||"",Se.lastName||""),Ee=Se.firstName&&Se.lastName?`${Se.firstName}${Se.lastName.charAt(0).toUpperCase()}`:"";Ee&&qw(Ee),$.log("Register.jsx: Generated username and nickname for new user");const Ce={...Se,firstName:Se.firstName||"",lastName:Se.lastName||"",companyName:Se.companyName||"",linkedInProfile:Se.linkedInProfile||"",email:Fe,password:Oe,username:Be,Nickname:Ee,captchaToken:F};$.log("Register.jsx: Prepared registration data with fields:",Object.keys(Ce).join(", ")),ae(Ce),ne(!0)}catch(Be){$.error("User: Registration Error:",Be);let Ee="An error occurred during registration. Please try again.",Ce=!1;Be.code==="auth/email-already-in-use"?(Ee="This email address is already registered. Please sign in instead.",Ce=!0):Be.code==="auth/invalid-email"?Ee="The email address is not valid. Please check and try again.":Be.code==="auth/weak-password"?Ee="The password is too weak. Please choose a stronger password.":Be.message&&(Ee=Be.message),b({title:"Registration Failed",description:T.jsxs(T.Fragment,{children:[Ee,Ce&&T.jsx(at,{mt:2,children:T.jsx(Ql,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{M(!1),X.current&&X.current.reset()}},ue=async xe=>{M(!0);try{$.log("Register.jsx: Completing registration with confirmed username");const{email:Fe,password:Oe,...we}=xe,Se={...we,firstName:we.firstName||"",lastName:we.lastName||"",companyName:we.companyName||"",linkedInProfile:we.linkedInProfile||"",username:we.username||"",Nickname:we.Nickname||""};$.log("Register.jsx: Final registration data includes fields:",Object.keys(Se).join(", "));const Be=await E(Fe,Oe,Se);Q(),ne(!1),$.log("User: Registration process complete."),b({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),ae(null),Y(!1)}catch(Fe){$.error("User: Registration Error during final step:",Fe);let Oe="An error occurred during registration. Please try again.";Fe.code==="auth/email-already-in-use"?Oe="This email address is already in use. Please try another one.":Fe.message&&(Oe=Fe.message),b({title:"Registration Failed",description:Oe,status:"error",duration:5e3,isClosable:!0,position:"top"}),ne(!1),ae(null),Y(!1)}finally{M(!1)}},pe=()=>{l?l():O(!I)},ke=n==="link"?T.jsx(Ql,{variant:"header",onClick:pe,children:e}):T.jsx(Yn,{onClick:pe,...i,children:e});return T.jsxs(T.Fragment,{children:[!a&&ke,T.jsxs(vs,{isOpen:Z&&!K,onClose:Q,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[T.jsx(Ts,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),T.jsxs(Ss,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[T.jsxs(fo,{p:8,textAlign:"center",children:[T.jsx(FC,{size:"lg",mb:2,children:"Create Account"}),T.jsx(at,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),T.jsx(zs,{color:"gray.400"}),T.jsx(bs,{px:8,children:T.jsx("form",{onSubmit:f(de),children:T.jsxs(ai,{spacing:4,children:[T.jsxs(Br,{isInvalid:_.companyName,isRequired:!0,children:[T.jsx(Gi,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required",setValueAs:xe=>xe===""?"":xe})}),T.jsx(sp,{children:_.companyName&&_.companyName.message})]}),T.jsxs(is,{gap:4,w:"100%",children:[T.jsxs(Br,{isInvalid:_.firstName,isRequired:!0,children:[T.jsx(Gi,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required",setValueAs:xe=>xe===""?"":xe})}),T.jsx(sp,{children:_.firstName&&_.firstName.message})]}),T.jsxs(Br,{isInvalid:_.lastName,isRequired:!0,children:[T.jsx(Gi,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required",setValueAs:xe=>xe===""?"":xe})}),T.jsx(sp,{children:_.lastName&&_.lastName.message})]})]}),T.jsxs(Br,{isInvalid:_.email,isRequired:!0,children:[T.jsx(Gi,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),T.jsx(sp,{children:_.email&&_.email.message})]}),T.jsxs(is,{gap:4,w:"100%",children:[T.jsxs(Br,{isInvalid:_.password,isRequired:!0,children:[T.jsx(Gi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),T.jsx(sp,{children:_.password&&_.password.message})]}),T.jsxs(Br,{isInvalid:_.confirmPassword,isRequired:!0,children:[T.jsx(Gi,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),T.jsx(sp,{children:_.confirmPassword&&_.confirmPassword.message})]})]}),T.jsx(Br,{children:T.jsx(Gi,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile",{setValueAs:xe=>xe===""?"":xe})})}),T.jsx(yt,{width:"100%",display:"flex",justifyContent:"center",my:4,children:T.jsx(Doe,{ref:X,sitekey:RWe,onChange:ie,theme:"dark"})})]})})}),T.jsxs(nh,{px:8,pb:8,flexDirection:"column",gap:4,children:[T.jsx(Yn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(de),isLoading:L,loadingText:"Processing",isDisabled:!F,children:"Next: Set Your Username"}),T.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",T.jsx(Ql,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),K&&T.jsx(xoe,{isOpen:K,onClose:()=>ne(!1),userData:oe,onConfirm:ue,fullscreenRef:C,isRegistering:le})]})}t3.propTypes={mode:An.oneOf(["button","link"]),label:An.string,buttonProps:An.object,isOpen:An.bool,onClose:An.func};const IWe=zg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),AWe=zg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),PWe=zg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),OWe=zg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),pQ=zg({displayName:"EmailIcon",path:T.jsxs("g",{fill:"currentColor",children:[T.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),T.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),kWe=zg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),NWe=zg({displayName:"QuestionOutlineIcon",path:T.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[T.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),T.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),T.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),DWe=zg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),xWe="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function n3({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:a=!1}){const{signIn:l}=N.useContext(ro),{fullscreenRef:u}=ch(),f=dc(),{register:_,handleSubmit:E,formState:{errors:b}}=Noe(),[C,I]=N.useState(!1),[O,L]=N.useState(a),[M,F]=N.useState(!1),[z,X]=N.useState(!1),[K,ne]=N.useState(""),[oe,ae]=N.useState(!1),[le,Y]=N.useState(null),Z=N.useRef(null);S1(O||z),N.useEffect(()=>{const Fe=()=>{L(!0)};return window.addEventListener("openSignInModal",Fe),()=>{window.removeEventListener("openSignInModal",Fe)}},[]);const Q=Fe=>{Y(Fe)},ie=async Fe=>{if(!le){f({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}I(!0);try{await l(Fe.email,Fe.password,le),$.log("User: Sign-in process complete."),L(!1),window.location.reload()}catch(Oe){$.error("User: SignIn Error:",Oe);const we=Oe.message||"An error occurred while logging in. Please check your credentials.",Se=we.includes("verify your email");f({title:Se?"Email Verification Required":"Error",description:we,status:Se?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:u.current})}finally{I(!1),Z.current&&Z.current.reset()}},de=async()=>{if(!K){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:u.current});return}try{ae(!0),await UFe(V4,K),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:u.current}),X(!1)}catch(Fe){$.error("User: Reset Password Error:",Fe),f({title:"Error",description:Fe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:u.current})}finally{ae(!1)}},ue=()=>L(Fe=>!Fe),pe=()=>{L(!1),F(!0)},ke=()=>{X(!0)},xe=n==="link"?T.jsx(Ql,{variant:"header",onClick:ue,children:e}):T.jsx(Yn,{onClick:ue,...i,children:e});return T.jsxs(T.Fragment,{children:[xe,T.jsxs(vs,{isOpen:O,onClose:ue,size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[T.jsx(Ts,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),T.jsx("form",{onSubmit:E(ie),children:T.jsxs(Ss,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Fe=>{Fe.stopPropagation()},children:[T.jsxs(fo,{p:8,textAlign:"center",children:[T.jsx(FC,{size:"lg",mb:2,children:"Welcome Back"}),T.jsx(at,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),T.jsx(zs,{color:"gray.400"}),T.jsx(bs,{px:8,pb:8,children:T.jsxs(ai,{spacing:4,children:[T.jsxs(Br,{isInvalid:b.email,children:[T.jsxs(My,{children:[T.jsx(lC,{pointerEvents:"none",children:T.jsx(pQ,{color:"gray.500"})}),T.jsx(Gi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("email",{required:"Email is required."})})]}),T.jsx(sp,{children:b.email&&b.email.message})]}),T.jsxs(Br,{isInvalid:b.password,children:[T.jsxs(My,{children:[T.jsx(lC,{pointerEvents:"none",children:T.jsx(PWe,{color:"gray.500"})}),T.jsx(Gi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("password",{required:"Password is required."})})]}),T.jsx(sp,{children:b.password&&b.password.message})]}),T.jsx(yt,{alignSelf:"flex-end",children:T.jsx(Ql,{color:"blue.400",fontSize:"sm",onClick:ke,children:"Forgot Password?"})}),T.jsx(is,{width:"100%",justifyContent:"center",my:4,children:T.jsx(Doe,{ref:Z,sitekey:xWe,onChange:Q,theme:"dark"})})]})}),T.jsxs(nh,{px:8,pb:8,flexDirection:"column",gap:4,children:[T.jsx(Yn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:C,loadingText:"Signing In",isDisabled:!le,children:"Sign In"}),T.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",T.jsx(Ql,{color:"blue.400",onClick:pe,children:"Sign Up"})]})]})]})})]}),T.jsxs(vs,{isOpen:z,onClose:()=>X(!1),size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[T.jsx(Ts,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),T.jsxs(Ss,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Fe=>{Fe.stopPropagation()},children:[T.jsxs(fo,{p:8,textAlign:"center",children:[T.jsx(FC,{size:"lg",mb:2,children:"Reset Password"}),T.jsx(at,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),T.jsx(zs,{color:"gray.400"}),T.jsx(bs,{px:8,pb:4,children:T.jsx(Br,{children:T.jsxs(My,{children:[T.jsx(lC,{pointerEvents:"none",children:T.jsx(pQ,{color:"gray.500"})}),T.jsx(Gi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:K,onChange:Fe=>ne(Fe.target.value)})]})})}),T.jsxs(nh,{px:8,pb:8,flexDirection:"column",gap:4,children:[T.jsx(Yn,{colorScheme:"blue",size:"lg",width:"100%",onClick:de,isLoading:oe,loadingText:"Sending",children:"Send Reset Link"}),T.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",T.jsx(Ql,{color:"blue.400",onClick:()=>X(!1),children:"Back to Sign In"})]})]})]})]}),T.jsx(t3,{mode:"link",isOpen:M,onClose:()=>F(!1)})]})}n3.propTypes={mode:An.oneOf(["button","link"]),label:An.string,buttonProps:An.object,initialIsOpen:An.bool};function LWe(){const{loadingProgression:n,isLoaded:e,error:i}=Uo(),{user:a}=N.useContext(ro),[l,u]=N.useState(!1),[f,_]=N.useState(!1),[E,b]=N.useState(!1),[C,I]=N.useState(!1),O=N.useRef(!1),L=N.useRef(!1),M=N.useRef(null),F=N.useRef(null),z=N.useRef(null),X=Uc(),K=N.useRef(null),ne=N.useRef(null),oe=N.useRef(null);N.useRef(null),N.useEffect(()=>{u(!a&&n===0)},[a,n]),N.useEffect(()=>{const Y=document.createElement("style");return Y.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Y),K.current=Y,()=>{K.current&&document.head.removeChild(K.current)}},[]),N.useEffect(()=>{const Y=()=>{const Z=document.getElementById("unity-canvas"),Q=document.getElementById("unity-container");Z&&(M.current=Z,Z.style.zIndex="1"),Q&&(F.current=Q,Q.style.zIndex="1"),Z&&Q&&oe.current&&(clearInterval(oe.current),oe.current=null)};return Y(),oe.current=setInterval(Y,100),()=>{oe.current&&(clearInterval(oe.current),oe.current=null)}},[]),N.useEffect(()=>{window.isFirstSceneLoaded&&(L.current=!0,I(!0));const Z=X("FirstSceneLoaded",()=>{L.current=!0,I(!0),window.isFirstSceneLoaded=!0}),Q=setTimeout(()=>{L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{Z(),clearTimeout(Q)}},[X]),N.useEffect(()=>{window.isPlayerInstantiated&&(O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0));const Y=()=>{O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Y);const Z=X("PlayerInstantiated",Y),Q=setTimeout(()=>{O.current||(O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Y),Z(),clearTimeout(Q)}},[X]),N.useEffect(()=>(C&&E&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{M.current&&(M.current.style.opacity="1",M.current.style.removeProperty("opacity")),F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),z.current&&(z.current.style.opacity="0",z.current.style.pointerEvents="none",setTimeout(()=>{z.current&&(z.current.style.display="none")},1500))},2e3)),()=>{ne.current&&clearTimeout(ne.current)}),[C,E]);const ae=()=>e?e&&!C&&!E?"Scene initializing":C&&!E?"Player initializing":"Ready":"World loading",le=()=>e?e&&!C&&!E?85:C&&!E?95:100:n*80;return T.jsx(T.Fragment,{children:l?T.jsx(yt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:T.jsxs(ai,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[T.jsx(at,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),T.jsx(at,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),T.jsx(Yn,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>_(!0),children:"Sign In"})]})}):T.jsx(yt,{ref:z,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:T.jsxs(is,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[T.jsx(at,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),T.jsx(at,{fontSize:"sm",children:ae()}),T.jsx(Vy,{value:le(),size:"lg",width:"100%",marginY:2})]})})})}function Loe({mode:n="button",label:e="Sign Out"}){const i=dc(),{signOut:a}=N.useContext(ro),{fullscreenRef:l}=ch(),u=async()=>{try{await a(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(_){console.error("SignOut Error:",_),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?T.jsx(Ql,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return T.jsx(T.Fragment,{children:f})}Loe.propTypes={mode:An.oneOf(["button","link"]),label:An.string};function MWe(){const{user:n}=N.useContext(ro);return T.jsx("div",{children:n!==null?T.jsx("div",{children:T.jsx(Loe,{})}):T.jsxs("div",{children:[T.jsx(t3,{}),T.jsx(n3,{})]})})}function UWe(){const{fullscreenRef:n}=ch(),[e,i]=N.useState(!1),a=()=>{i(!e)};return T.jsxs(T.Fragment,{children:[T.jsx(Bf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:T.jsx(Nc,{"aria-label":"Controller Help",icon:T.jsx(NWe,{}),onClick:a,variant:"iconButton"})}),T.jsxs(vs,{isOpen:e,onClose:a,size:"md",portalProps:{containerRef:n},children:[T.jsx(Ts,{}),T.jsxs(Ss,{children:[T.jsx(fo,{children:"Notes"}),T.jsx(zs,{}),T.jsx(bs,{children:T.jsx(at,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),T.jsx(nh,{children:T.jsx(Yn,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Moe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},fQ=fi.createContext&&fi.createContext(Moe),Pg=function(){return Pg=Object.assign||function(n){for(var e,i=1,a=arguments.length;i<a;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},Pg.apply(this,arguments)},VWe=function(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i};function Uoe(n){return n&&n.map(function(e,i){return fi.createElement(e.tag,Pg({key:i},e.attr),Uoe(e.child))})}function Rr(n){return function(e){return fi.createElement(FWe,Pg({attr:Pg({},n.attr)},e),Uoe(n.child))}}function FWe(n){var e=function(i){var a=n.attr,l=n.size,u=n.title,f=VWe(n,["attr","size","title"]),_=l||i.size||"1em",E;return i.className&&(E=i.className),n.className&&(E=(E?E+" ":"")+n.className),fi.createElement("svg",Pg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,f,{className:E,style:Pg(Pg({color:n.color||i.color},i.style),n.style),height:_,width:_,xmlns:"http://www.w3.org/2000/svg"}),u&&fi.createElement("title",null,u),n.children)};return fQ!==void 0?fi.createElement(fQ.Consumer,null,function(i){return e(i)}):e(Moe)}function Voe(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function jWe(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function mQ(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function gQ(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function rF(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function BWe(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z"}}]})(n)}function zWe(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function WWe(n){return Rr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function GWe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Foe(n){return Rr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function HWe(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function $We(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function joe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function Boe(n){return Rr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function KWe(n){return Rr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function qWe(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function YWe(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function iF(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function XWe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function JWe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function QWe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function zoe({open:n,onClose:e}){const i=N.useRef(null),a=Mc(),{user:l}=N.useContext(ro),u=E=>{i.current&&!i.current.contains(E.target)&&e()},f=async E=>{const b=_(E);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const C=b.data.url;if(console.log(`Avatar URL: ${C}`),a("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await Kse(l.uid,C),e()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},_=E=>{try{return JSON.parse(E.data)}catch{return null}};return N.useEffect(()=>(n&&(document.addEventListener("mousedown",u),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",f)}),[n]),n&&T.jsx(od,{children:T.jsx(yt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:E=>E.stopPropagation(),children:T.jsx(yt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:T.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function ZWe({isOpen:n,onClose:e}){const[i,a]=N.useState(!1),[l,u]=N.useState(null),{user:f}=N.useContext(ro),_=Mc(),E=M=>{M.stopPropagation(),a(!0)},b=()=>{a(!1),e()},C=async M=>{if(u(M),f&&f.uid)try{await Kse(f.uid,M.url),_("AvatarUrlFromReact",{url:M.url}),e()}catch(F){console.error("Error updating RPM URL:",F)}else console.error("No authenticated user found to update rpmURL.")},I=Tg("gray.200","whiteAlpha.300"),O="rgba(0, 0, 0, 0.3)",L=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return T.jsxs(T.Fragment,{children:[T.jsx(od,{children:T.jsxs(vs,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[T.jsx(Ts,{bg:"rgba(0, 0, 0, 0.7)"}),T.jsxs(Ss,{bg:"gray.800",color:"white",maxW:"900px",children:[T.jsx(fo,{fontSize:"lg",children:"Customise Your Avatar"}),T.jsx(zs,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),T.jsx(bs,{pb:4,children:T.jsxs(ai,{spacing:4,align:"stretch",children:[T.jsx(at,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),T.jsxs(mne,{columns:5,spacing:2,children:[T.jsx(yt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:E,_hover:{bg:O},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:T.jsxs(ai,{spacing:1,children:[T.jsx(mn,{as:qWe,boxSize:4}),T.jsx(at,{fontSize:"xs",children:"Create Custom Avatar"})]})}),L.map(M=>T.jsxs(yt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===M.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>C(M),_hover:{bg:O},transition:"all 0.2s",aspectRatio:"1",children:[T.jsx(up,{src:M.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:M.name,width:"100%",height:"100%",objectFit:"cover"}),T.jsx(yt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:T.jsx(at,{fontSize:"xs",children:M.name})})]},M.id))]})]})})]})]})}),i&&T.jsx(zoe,{open:i,onClose:b})]})}function e8e(){const{fullscreenRef:n}=ch(),[e,i]=N.useState(!1),[a,l]=N.useState(!1),[u,f]=N.useState(!1),[_,E]=N.useState(!1),{user:b}=N.useContext(ro),[C,I]=N.useState(null),[O,L]=N.useState(!0),M=(K,ne)=>!K||!ne?"?":`${K.charAt(0)}${ne.charAt(0)}`.toUpperCase(),F=async()=>{if(b!=null&&b.uid){L(!0);try{const K=await su(b.uid);I({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{L(!1)}}};N.useEffect(()=>{F()},[b==null?void 0:b.uid]),N.useEffect(()=>{const K=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const z=()=>l(!a),X=()=>{l(!1),F()};return e?T.jsxs(T.Fragment,{children:[T.jsx(Bf,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:_,portalProps:{containerRef:n},children:T.jsxs(yt,{position:"relative",onMouseEnter:()=>{f(!0),E(!0)},onMouseLeave:()=>{f(!1),E(!1)},cursor:"pointer",onClick:z,children:[T.jsx(eh,{src:O||C==null?void 0:C.rpmURL,size:"md",borderRadius:"full",bg:"white",name:O?M(C==null?void 0:C.firstName,C==null?void 0:C.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&T.jsx(yt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:T.jsx(at,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),T.jsx(ZWe,{isOpen:a,onClose:X})]}):null}function t8e(n){return Rr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function n8e(n){return Rr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function r8e(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:a}=ch(),l=dc();N.useEffect(()=>{const f=_=>{console.error("Fullscreen error:",_),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const u=()=>{i.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return T.jsx(Bf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:T.jsx(Nc,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?T.jsx(t8e,{}):T.jsx(n8e,{}),onClick:u,variant:"iconButton",size:a?"lg":"md"})})}const _Q={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function i8e(){const{isOpen:n,onOpen:e,onClose:i}=th(),{fullscreenRef:a}=ch(),[l,u]=Gze(!1);N.useEffect(()=>{$.log("VideoPlayer: Current video URL:",l),l&&($.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const f=()=>{$.log("VideoPlayer: Closing modal"),u(),i()};return T.jsx(od,{containerRef:a,children:T.jsxs(vs,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[T.jsx(Ts,{bg:"rgba(0, 0, 0, 0.8)"}),T.jsxs(Ss,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[T.jsx(zs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),T.jsx(bs,{p:0,width:"100%",children:l&&T.jsx(yt,{style:_Q.iframeContainer,children:T.jsx("iframe",{src:l,style:_Q.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function s8e({isOpen:n,onClose:e,playerName:i,playerId:a,uid:l}){const[u,f]=N.useState(null),[_,E]=N.useState(!0),[b,C]=N.useState(null);return N.useEffect(()=>{n&&(async()=>{if(E(!0),C(null),!l){$.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),E(!1);return}try{$.log("NameplateModal: Fetching profile for UID:",l);const O=await su(l);O?f({firstName:O.firstName,lastName:O.lastName,linkedinUrl:O.linkedinUrl,websiteUrl:O.websiteUrl,rpmURL:O.rpmURL?O.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(O){$.error("Error fetching profile data:",O),C("Error loading profile data")}finally{E(!1)}})()},[l,n,i]),T.jsxs(vs,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[T.jsx(Ts,{backdropFilter:"blur(10px)"}),T.jsxs(Ss,{bg:"gray.900",color:"white",borderRadius:"xl",children:[T.jsx(fo,{children:"Player Info"}),T.jsx(zs,{}),T.jsx(bs,{pb:6,children:_?T.jsx(xte,{py:8,children:T.jsx(oh,{size:"xl",color:"blue.400"})}):b?T.jsxs(Vf,{status:"warning",variant:"solid",borderRadius:"md",children:[T.jsx(Ff,{}),b]}):T.jsxs(ai,{spacing:4,align:"center",children:[T.jsx(eh,{size:"2xl",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),T.jsxs(ai,{spacing:1,children:[T.jsx(at,{fontSize:"2xl",fontWeight:"bold",children:i}),(u==null?void 0:u.firstName)&&T.jsxs(at,{fontSize:"md",color:"gray.400",children:[u.firstName," ",u.lastName]}),T.jsxs(at,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((u==null?void 0:u.linkedinUrl)||(u==null?void 0:u.websiteUrl))&&T.jsxs(T.Fragment,{children:[T.jsx(xy,{borderColor:"whiteAlpha.300"}),T.jsxs(hr,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedinUrl)&&T.jsx(Ql,{href:u.linkedinUrl,isExternal:!0,children:T.jsx(Nc,{icon:T.jsx(Voe,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(u==null?void 0:u.websiteUrl)&&T.jsx(Ql,{href:u.websiteUrl,isExternal:!0,children:T.jsx(Nc,{icon:T.jsx(Foe,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const o8e=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[a]=dxe("(max-width: 768px)"),[l,u]=N.useState(!1);N.useEffect(()=>{u(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent||""))},[]);const f=a||l,_=Eoe(),[E,b]=N.useState(!1),[C,I]=N.useState([]),[O,L]=N.useState(!1),[M,F]=N.useState({}),[z,X]=N.useState({}),[K,ne]=N.useState(!1),oe=dc(),[ae,le]=N.useState(null),[Y,Z]=N.useState(null),{isOpen:Q,onOpen:ie,onClose:de}=th(),[ue,pe]=N.useState(null),{isOpen:ke,onOpen:xe,onClose:Fe}=th(),[Oe,we]=N.useState(null),Se=window.currentUser||{},Ee=i||window.spaceID||window.location.pathname.split("/").pop()||"fallback-space-id";N.useEffect(()=>{td(Ee).then(ct=>ne(!!(ct!=null&&ct.voiceDisabled)))},[Ee]),N.useEffect(()=>{const ct=()=>b(!0);return window.addEventListener("PlayerInstantiated",ct),window.isPlayerInstantiated&&b(!0),()=>window.removeEventListener("PlayerInstantiated",ct)},[]),N.useEffect(()=>{const ct={};_.forEach(Mt=>{var fn;Mt.uid&&((fn=window.agoraClient)!=null&&fn.client)&&(ct[Mt.uid]=Mt.isLocalPlayer?window.agoraClient.client.uid:Mt.uid)}),X(ct)},[_]),N.useEffect(()=>{const ct=setInterval(()=>{var Mt;if(window.agoraClient){L(!!window.agoraClient.isVoiceEnabled);const fn={};(Mt=window.agoraClient.client)==null||Mt.remoteUsers.forEach(zt=>{fn[zt.uid]=!!zt.audioTrack&&!zt.audioTrack.muted}),F(fn)}},500);return()=>clearInterval(ct)},[]),N.useEffect(()=>{(async()=>{const Mt=await Promise.all(_.map(async fn=>{var zt,Te;if(!fn.uid)return fn;try{const Ve=await su(fn.uid),$e=`space_${Ee}_owners`,Et=`space_${Ee}_hosts`,vt=(zt=Ve.groups)!=null&&zt.includes($e)?"owner":(Te=Ve.groups)!=null&&Te.includes(Et)?"host":null,St=Ve.rpmURL?Ve.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):void 0;return{...fn,...Ve,rpmURL:St,role:vt}}catch{return fn}}));I(Mt)})()},[_,Ee]);const{kickPlayer:Ce,isKicking:Pe,kickResult:Me,error:ze,resetKickState:He}=Hze();N.useEffect(()=>{Me!=null&&Me.success&&(ae||Oe)&&(ae&&(oe({title:"Remove Successful",description:`${ae} has been removed.`,status:"success",duration:3e3,isClosable:!0}),le(null)),Oe&&(oe({title:"Ban Successful",description:`${Oe} has been banned.`,status:"success",duration:3e3,isClosable:!0}),we(null)),He()),ze&&(oe({title:"Error",description:ze,status:"error",duration:3e3,isClosable:!0}),le(null),we(null),He())},[Me,ze,ae,Oe,oe,He]);const qe=ct=>ct.isLocalPlayer||ct.uid===Se.uid,nt=ct=>qe(ct)?O:M[z[ct.uid]],Ze=({role:ct})=>ct==="owner"?T.jsx(mn,{as:rF,color:"green.400",boxSize:3,ml:1}):ct==="host"?T.jsx(mn,{as:iF,color:"purple.400",boxSize:3,ml:1}):null,gt=({role:ct})=>ct==="owner"?T.jsxs(hr,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[T.jsx(mn,{as:rF,color:"green.300"}),T.jsx(Yd,{colorScheme:"green",variant:"solid",children:"Owner"})]}):ct==="host"?T.jsxs(hr,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[T.jsx(mn,{as:iF,color:"purple.300"}),T.jsx(Yd,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null,sn=()=>{Y&&(le(Y.playerName),Ce(Y.uid,Se.uid),de())},ut=async()=>{ue&&(we(ue.playerName),await dze(Ee,{uid:ue.uid,playerName:ue.playerName,bannedAt:new Date().toISOString(),...Se.uid&&{bannedBy:Se.uid}}),Ce(ue.uid,Se.uid),Fe())},kt=(ct,Mt)=>{var zt;if(!(((zt=C.find(Te=>Te.isLocalPlayer))==null?void 0:zt.role)==="owner"))return oe({title:"Permission Denied",status:"error",duration:3e3,isClosable:!0});ct==="remove"?(Z(Mt),ie()):ct==="ban"&&(pe(Mt),xe())};return T.jsxs(T.Fragment,{children:[T.jsxs(yt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:E&&n&&!f?"visible":"hidden",role:"group",children:[T.jsx(yt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:T.jsx(Nc,{icon:T.jsx(kWe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:e})}),T.jsxs(at,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",_.length]}),T.jsx(yt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:T.jsx(ai,{align:"stretch",spacing:1,width:"100%",children:C.sort((ct,Mt)=>ct.isLocalPlayer?-1:Mt.isLocalPlayer?1:0).map((ct,Mt)=>{var Ve;const fn=qe(ct),zt=((Ve=C.find($e=>$e.isLocalPlayer))==null?void 0:Ve.role)==="owner"&&!fn&&ct.role!=="owner",Te=!K&&nt(ct);return T.jsx(yt,{children:T.jsxs($ne,{placement:"left",trigger:"hover",children:[T.jsx(Jne,{children:T.jsxs(hr,{p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},children:[T.jsx(eh,{size:"xs",bg:"whiteAlpha.400",src:ct.rpmURL,name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),T.jsx(at,{fontSize:"xs",children:ct.playerName}),T.jsx(Ze,{role:ct.role}),T.jsx(s0,{}),!K&&(Te?T.jsx(yt,{color:"green.400",children:T.jsx(Boe,{})}):T.jsx(yt,{color:"red.400",children:T.jsx(joe,{})})),fn?T.jsx(at,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):zt?T.jsxs(LN,{children:[T.jsx(MN,{as:Nc,"aria-label":"Options",icon:T.jsx(WWe,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),T.jsxs(UN,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[T.jsx(UC,{icon:T.jsx(XWe,{}),onClick:()=>kt("remove",ct),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"}),T.jsx(UC,{icon:T.jsx(jWe,{}),onClick:()=>kt("ban",ct),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Ban"})]})]}):null]})}),T.jsx(Xne,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",p:4,minW:"220px",children:T.jsx(qne,{children:T.jsxs(ai,{align:"center",spacing:3,children:[T.jsx(eh,{size:"lg",src:ct.rpmURL}),T.jsx(at,{fontWeight:"bold",children:ct.playerName}),T.jsx(gt,{role:ct.role}),ct.firstName&&T.jsxs(at,{fontSize:"sm",color:"gray.300",children:[ct.firstName," ",ct.lastName]}),T.jsxs(hr,{spacing:4,pt:2,children:[ct.linkedInProfile&&T.jsx(Ql,{href:ct.linkedInProfile,isExternal:!0,children:T.jsx(mn,{as:Voe})}),ct.websiteUrl&&T.jsx(Ql,{href:ct.websiteUrl,isExternal:!0,children:T.jsx(mn,{as:Foe})})]})]})})})]})},Mt)})})})]}),T.jsxs(vs,{isOpen:Q,onClose:de,isCentered:!0,children:[T.jsx(Ts,{}),T.jsxs(Ss,{bg:"gray.800",color:"white",children:[T.jsx(fo,{children:"Confirm Removal"}),T.jsx(zs,{}),T.jsx(bs,{children:T.jsxs(at,{children:["Remove ",Y==null?void 0:Y.playerName," from the room?"]})}),T.jsxs(nh,{children:[T.jsx(Yn,{colorScheme:"red",onClick:sn,isLoading:Pe,mr:3,children:"Remove"}),T.jsx(Yn,{bg:"white",color:"gray.800",onClick:de,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]}),T.jsxs(vs,{isOpen:ke,onClose:Fe,isCentered:!0,children:[T.jsx(Ts,{}),T.jsxs(Ss,{bg:"gray.800",color:"white",children:[T.jsx(fo,{children:"Confirm Ban"}),T.jsx(zs,{}),T.jsx(bs,{children:T.jsxs(at,{children:["Ban ",ue==null?void 0:ue.playerName," from the room? They will not be able to re-enter."]})}),T.jsxs(nh,{children:[T.jsx(Yn,{colorScheme:"red",onClick:ut,isLoading:Pe,mr:3,children:"Ban"}),T.jsx(Yn,{bg:"white",color:"gray.800",onClick:Fe,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var Tk={exports:{}},a8e=Tk.exports,yQ;function c8e(){return yQ||(yQ=1,function(n,e){(function(i,a){n.exports=a()})(a8e,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in t)){var c=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(t,o,c.get?c:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(t)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Sy<"u"?Sy:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t){try{return!!t()}catch{return!0}},f=!u(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),_=f,E=Function.prototype,b=E.call,C=_&&E.bind.bind(b,b),I=_?C:function(t){return function(){return b.apply(t,arguments)}},O=I({}.isPrototypeOf),L=function(t){return t&&t.Math==Math&&t},M=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),F=f,z=Function.prototype,X=z.apply,K=z.call,ne=typeof Reflect=="object"&&Reflect.apply||(F?K.bind(X):function(){return K.apply(X,arguments)}),oe=I,ae=oe({}.toString),le=oe("".slice),Y=function(t){return le(ae(t),8,-1)},Z=Y,Q=I,ie=function(t){if(Z(t)==="Function")return Q(t)},de=typeof document=="object"&&document.all,ue={all:de,IS_HTMLDDA:de===void 0&&de!==void 0},pe=ue.all,ke=ue.IS_HTMLDDA?function(t){return typeof t=="function"||t===pe}:function(t){return typeof t=="function"},xe={},Fe=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Oe=f,we=Function.prototype.call,Se=Oe?we.bind(we):function(){return we.apply(we,arguments)},Be={},Ee={}.propertyIsEnumerable,Ce=Object.getOwnPropertyDescriptor,Pe=Ce&&!Ee.call({1:2},1);Be.f=Pe?function(t){var r=Ce(this,t);return!!r&&r.enumerable}:Ee;var Me,ze,He=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},qe=u,nt=Y,Ze=Object,gt=I("".split),sn=qe(function(){return!Ze("z").propertyIsEnumerable(0)})?function(t){return nt(t)=="String"?gt(t,""):Ze(t)}:Ze,ut=function(t){return t==null},kt=ut,ct=TypeError,Mt=function(t){if(kt(t))throw ct("Can't call method on "+t);return t},fn=sn,zt=Mt,Te=function(t){return fn(zt(t))},Ve=ke,$e=ue.all,Et=ue.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Ve(t)||t===$e}:function(t){return typeof t=="object"?t!==null:Ve(t)},vt={},St=vt,Wt=M,dn=ke,En=function(t){return dn(t)?t:void 0},tn=function(t,r){return arguments.length<2?En(St[t])||En(Wt[t]):St[t]&&St[t][r]||Wt[t]&&Wt[t][r]},wt=typeof navigator<"u"&&String(navigator.userAgent)||"",sr=M,xt=wt,qt=sr.process,br=sr.Deno,wi=qt&&qt.versions||br&&br.version,Cs=wi&&wi.v8;Cs&&(ze=(Me=Cs.split("."))[0]>0&&Me[0]<4?1:+(Me[0]+Me[1])),!ze&&xt&&(!(Me=xt.match(/Edge\/(\d+)/))||Me[1]>=74)&&(Me=xt.match(/Chrome\/(\d+)/))&&(ze=+Me[1]);var cr=ze,zn=cr,ra=u,Hs=M.String,io=!!Object.getOwnPropertySymbols&&!ra(function(){var t=Symbol();return!Hs(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&zn&&zn<41}),Vc=io&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Rs=tn,Ma=ke,Fo=O,Ua=Object,hc=Vc?function(t){return typeof t=="symbol"}:function(t){var r=Rs("Symbol");return Ma(r)&&Fo(r.prototype,Ua(t))},Rl=String,Va=function(t){try{return Rl(t)}catch{return"Object"}},pc=ke,mo=Va,Di=TypeError,os=function(t){if(pc(t))return t;throw Di(mo(t)+" is not a function")},ia=os,Il=ut,Fa=function(t,r){var s=t[r];return Il(s)?void 0:ia(s)},jo=Se,ft=ke,hn=Et,Pr=TypeError,Ci={exports:{}},Al=M,$i=Object.defineProperty,Pl=function(t,r){try{$i(Al,t,{value:r,configurable:!0,writable:!0})}catch{Al[t]=r}return r},Bo="__core-js_shared__",cu=M[Bo]||Pl(Bo,{}),Ol=cu;(Ci.exports=function(t,r){return Ol[t]||(Ol[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var sa=Ci.exports,lu=Mt,fc=Object,xi=function(t){return fc(lu(t))},as=xi,vn=I({}.hasOwnProperty),Ri=Object.hasOwn||function(t,r){return vn(as(t),r)},Fc=I,kl=0,ja=Math.random(),Rp=Fc(1 .toString),lh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Rp(++kl+ja,36)},uu=sa,zo=Ri,rm=lh,go=io,Ip=Vc,Nl=M.Symbol,uh=uu("wks"),dh=Ip?Nl.for||Nl:Nl&&Nl.withoutSetter||rm,Tr=function(t){return zo(uh,t)||(uh[t]=go&&zo(Nl,t)?Nl[t]:dh("Symbol."+t)),uh[t]},du=Se,hu=Et,ad=hc,mc=Fa,oa=function(t,r){var s,o;if(ft(s=t.toString)&&!hn(o=jo(s,t))||ft(s=t.valueOf)&&!hn(o=jo(s,t)))return o;throw Pr("Can't convert object to primitive value")},cd=TypeError,Dl=Tr("toPrimitive"),pu=function(t,r){if(!hu(t)||ad(t))return t;var s,o=mc(t,Dl);if(o){if(s=du(o,t,r),!hu(s)||ad(s))return s;throw cd("Can't convert object to primitive value")}return oa(t)},ei=hc,gc=function(t){var r=pu(t,"string");return ei(r)?r:r+""},pr=Et,jc=M.document,im=pr(jc)&&pr(jc.createElement),fu=function(t){return im?jc.createElement(t):{}},hh=fu,Ap=!Fe&&!u(function(){return Object.defineProperty(hh("div"),"a",{get:function(){return 7}}).a!=7}),sm=Fe,Pp=Se,aa=Be,fs=He,ca=Te,la=gc,mu=Ri,ua=Ap,da=Object.getOwnPropertyDescriptor;xe.f=sm?da:function(t,r){if(t=ca(t),r=la(r),ua)try{return da(t,r)}catch{}if(mu(t,r))return fs(!Pp(aa.f,t,r),t[r])};var om=u,Bc=ke,Is=/#|\.prototype\./,ld=function(t,r){var s=xl[Op(t)];return s==am||s!=gu&&(Bc(r)?om(r):!!r)},Op=ld.normalize=function(t){return String(t).replace(Is,".").toLowerCase()},xl=ld.data={},gu=ld.NATIVE="N",am=ld.POLYFILL="P",Ba=ld,za=os,Ll=f,be=ie(ie.bind),De=function(t,r){return za(t),r===void 0?t:Ll?be(t,r):function(){return t.apply(r,arguments)}},rt={},Zt=Fe&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),tr=Et,Or=String,Jr=TypeError,gn=function(t){if(tr(t))return t;throw Jr(Or(t)+" is not an object")},Hr=Fe,Ii=Ap,$s=Zt,ha=gn,pa=gc,ud=TypeError,cs=Object.defineProperty,Ml=Object.getOwnPropertyDescriptor,ph="enumerable",zc="configurable",Kg="writable";rt.f=Hr?$s?function(t,r,s){if(ha(t),r=pa(r),ha(s),typeof t=="function"&&r==="prototype"&&"value"in s&&Kg in s&&!s[Kg]){var o=Ml(t,r);o&&o[Kg]&&(t[r]=s.value,s={configurable:zc in s?s[zc]:o[zc],enumerable:ph in s?s[ph]:o[ph],writable:!1})}return cs(t,r,s)}:cs:function(t,r,s){if(ha(t),r=pa(r),ha(s),Ii)try{return cs(t,r,s)}catch{}if("get"in s||"set"in s)throw ud("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var cm=rt,dd=He,fa=Fe?function(t,r,s){return cm.f(t,r,dd(1,s))}:function(t,r,s){return t[r]=s,t},_u=M,lm=ne,qg=ie,oE=ke,um=xe.f,dm=Ba,hd=vt,pd=De,fd=fa,Yg=Ri,aE=function(t){var r=function(s,o,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,o)}return new t(s,o,c)}return lm(t,this,arguments)};return r.prototype=t.prototype,r},Gn=function(t,r){var s,o,c,d,h,m,y,v,S,R=t.target,P=t.global,D=t.stat,G=t.proto,j=P?_u:D?_u[R]:(_u[R]||{}).prototype,B=P?hd:hd[R]||fd(hd,R,{})[R],J=B.prototype;for(d in r)o=!(s=dm(P?d:R+(D?".":"#")+d,t.forced))&&j&&Yg(j,d),m=B[d],o&&(y=t.dontCallGetSet?(S=um(j,d))&&S.value:j[d]),h=o&&y?y:r[d],o&&typeof m==typeof h||(v=t.bind&&o?pd(h,_u):t.wrap&&o?aE(h):G&&oE(h)?qg(h):h,(t.sham||h&&h.sham||m&&m.sham)&&fd(v,"sham",!0),fd(B,d,v),G&&(Yg(hd,c=R+"Prototype")||fd(hd,c,{}),fd(hd[c],d,h),t.real&&J&&(s||!J[d])&&fd(J,d,h)))},hm=Math.ceil,ma=Math.floor,cE=Math.trunc||function(t){var r=+t;return(r>0?ma:hm)(r)},lE=cE,Wc=function(t){var r=+t;return r!=r||r===0?0:lE(r)},A=Wc,W=Math.max,re=Math.min,ge=function(t,r){var s=A(t);return s<0?W(s+r,0):re(s,r)},Xe=Wc,lt=Math.min,Gt=function(t){return t>0?lt(Xe(t),9007199254740991):0},ti=Gt,gi=function(t){return ti(t.length)},kr=Te,so=ge,As=gi,_c=function(t){return function(r,s,o){var c,d=kr(r),h=As(d),m=so(o,h);if(t&&s!=s){for(;h>m;)if((c=d[m++])!=c)return!0}else for(;h>m;m++)if((t||m in d)&&d[m]===s)return t||m||0;return!t&&-1}},ga={includes:_c(!0),indexOf:_c(!1)},kp=ga.includes;Gn({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(t){return kp(this,t,arguments.length>1?arguments[1]:void 0)}});var pm=vt,yc=function(t){return pm[t+"Prototype"]},wR=yc("Array").includes,CR=Et,fm=Y,b1=Tr("match"),RR=function(t){var r;return CR(t)&&((r=t[b1])!==void 0?!!r:fm(t)=="RegExp")},T1=RR,IR=TypeError,Y0={};Y0[Tr("toStringTag")]="z";var Np=String(Y0)==="[object z]",Xg=Np,w1=ke,Dp=Y,C1=Tr("toStringTag"),AR=Object,X0=Dp(function(){return arguments}())=="Arguments",Gc=Xg?Dp:function(t){var r,s,o;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,d){try{return c[d]}catch{}}(r=AR(t),C1))=="string"?s:X0?Dp(r):(o=Dp(r))=="Object"&&w1(r.callee)?"Arguments":o},PR=Gc,OR=String,Wa=function(t){if(PR(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return OR(t)},R1=Tr("match"),I1=Gn,A1=function(t){if(T1(t))throw IR("The method doesn't accept regular expressions");return t},P1=Mt,kR=Wa,Ul=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[R1]=!1,"/./"[t](r)}catch{}}return!1},Jg=I("".indexOf);I1({target:"String",proto:!0,forced:!Ul("includes")},{includes:function(t){return!!~Jg(kR(P1(this)),kR(A1(t)),arguments.length>1?arguments[1]:void 0)}});var NR=yc("String").includes,J0=O,DR=wR,xR=NR,Qg=Array.prototype,Q0=String.prototype,O1=function(t){var r=t.includes;return t===Qg||J0(Qg,t)&&r===Qg.includes?DR:typeof t=="string"||t===Q0||J0(Q0,t)&&r===Q0.includes?xR:r},ot=l(O1),Z0=os,Zg=xi,eb=sn,LR=gi,uE=TypeError,mm=function(t){return function(r,s,o,c){Z0(s);var d=Zg(r),h=eb(d),m=LR(d),y=t?m-1:0,v=t?-1:1;if(o<2)for(;;){if(y in h){c=h[y],y+=v;break}if(y+=v,t?y<0:m<=y)throw uE("Reduce of empty array with no initial value")}for(;t?y>=0:m>y;y+=v)y in h&&(c=s(c,h[y],y,d));return c}},tb={left:mm(!1)},MR=u,xp=function(t,r){var s=[][t];return!!s&&MR(function(){s.call(null,r||function(){return 1},1)})},Lp=typeof process<"u"&&Y(process)=="process",UR=tb.left;Gn({target:"Array",proto:!0,forced:!Lp&&cr>79&&cr<83||!xp("reduce")},{reduce:function(t){var r=arguments.length;return UR(this,t,r,r>1?arguments[1]:void 0)}});var VR=yc("Array").reduce,FR=O,jR=VR,dE=Array.prototype,fh=function(t){var r=t.reduce;return t===dE||FR(dE,t)&&r===dE.reduce?jR:r},hE=fh,Ec=l(hE),k1=Y,e_=Array.isArray||function(t){return k1(t)=="Array"},t_=Gn,N1=e_,BR=I([].reverse),nb=[1,2];t_({target:"Array",proto:!0,forced:String(nb)===String(nb.reverse())},{reverse:function(){return N1(this)&&(this.length=this.length),BR(this)}});var Li=yc("Array").reverse,rb=O,pE=Li,Mp=Array.prototype,zR=function(t){var r=t.reverse;return t===Mp||rb(Mp,t)&&r===Mp.reverse?pE:r},fE=zR,gm=l(fE),mE=lh,Up=sa("keys"),n_=function(t){return Up[t]||(Up[t]=mE(t))},D1=!u(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),x1=Ri,WR=ke,gE=xi,_E=D1,yE=n_("IE_PROTO"),r_=Object,ib=r_.prototype,i_=_E?r_.getPrototypeOf:function(t){var r=gE(t);if(x1(r,yE))return r[yE];var s=r.constructor;return WR(s)&&r instanceof s?s.prototype:r instanceof r_?ib:null},L1=I,GR=os,M1=ke,U1=String,sb=TypeError,mh=function(t,r,s){try{return L1(GR(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},HR=gn,_m=function(t){if(typeof t=="object"||M1(t))return t;throw sb("Can't set "+U1(t)+" as a prototype")},yu=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=mh(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(o,c){return HR(o),_m(c),r?t(o,c):o.__proto__=c,o}}():void 0),gh={},Hc={},s_=Ri,V1=Te,F1=ga.indexOf,Vp=Hc,ym=I([].push),Fp=function(t,r){var s,o=V1(t),c=0,d=[];for(s in o)!s_(Vp,s)&&s_(o,s)&&ym(d,s);for(;r.length>c;)s_(o,s=r[c++])&&(~F1(d,s)||ym(d,s));return d},Em=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ob=Fp,vm=Em.concat("length","prototype");gh.f=Object.getOwnPropertyNames||function(t){return ob(t,vm)};var $c={};$c.f=Object.getOwnPropertySymbols;var Mi=tn,Ai=gh,_h=$c,Wo=gn,Ga=I([].concat),jp=Mi("Reflect","ownKeys")||function(t){var r=Ai.f(Wo(t)),s=_h.f;return s?Ga(r,s(t)):r},Bp=Ri,Ha=jp,EE=xe,$R=rt,vE={},SE=Fp,KR=Em,Kc=Object.keys||function(t){return SE(t,KR)},bE=Fe,ab=Zt,qR=rt,j1=gn,yh=Te,Sm=Kc;vE.f=bE&&!ab?Object.defineProperties:function(t,r){j1(t);for(var s,o=yh(r),c=Sm(r),d=c.length,h=0;d>h;)qR.f(t,s=c[h++],o[s]);return t};var md,o_=tn("document","documentElement"),TE=gn,qc=vE,vc=Em,zp=Hc,gd=o_,_d=fu,yd="prototype",wE="script",CE=n_("IE_PROTO"),a_=function(){},$a=function(t){return"<"+wE+">"+t+"</"+wE+">"},Ka=function(t){t.write($a("")),t.close();var r=t.parentWindow.Object;return t=null,r},_i=function(){try{md=new ActiveXObject("htmlfile")}catch{}var t,r,s;_i=typeof document<"u"?document.domain&&md?Ka(md):(r=_d("iframe"),s="java"+wE+":",r.style.display="none",gd.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write($a("document.F=Object")),t.close(),t.F):Ka(md);for(var o=vc.length;o--;)delete _i[yd][vc[o]];return _i()};zp[CE]=!0;var _a=Object.create||function(t,r){var s;return t!==null?(a_[yd]=TE(t),s=new a_,a_[yd]=null,s[CE]=t):s=_i(),r===void 0?s:qc.f(s,r)},YR=Et,XR=fa,RE=Error,cb=I("".replace),JR=String(RE("zxcasd").stack),c_=/\n\s*at [^:]*:[^\n]*/,QR=c_.test(JR),bm=He,lb=!u(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",bm(1,7)),t.stack!==7)}),B1=fa,l_=function(t,r){if(QR&&typeof t=="string"&&!RE.prepareStackTrace)for(;r--;)t=cb(t,c_,"");return t},IE=lb,ub=Error.captureStackTrace,Eh={},Tm=Eh,ZR=Tr("iterator"),AE=Array.prototype,u_=function(t){return t!==void 0&&(Tm.Array===t||AE[ZR]===t)},wm=Gc,PE=Fa,db=ut,hb=Eh,pb=Tr("iterator"),Ed=function(t){if(!db(t))return PE(t,pb)||PE(t,"@@iterator")||hb[wm(t)]},Yc=Se,Wp=os,fb=gn,eI=Va,vd=Ed,vh=TypeError,d_=function(t,r){var s=arguments.length<2?vd(t):r;if(Wp(s))return fb(Yc(s,t));throw vh(eI(t)+" is not iterable")},tI=Se,Eu=gn,Sh=Fa,h_=function(t,r,s){var o,c;Eu(t);try{if(!(o=Sh(t,"return"))){if(r==="throw")throw s;return s}o=tI(o,t)}catch(d){c=!0,o=d}if(r==="throw")throw s;if(c)throw o;return Eu(o),s},nI=De,OE=Se,rI=gn,p_=Va,vu=u_,f_=gi,Cm=O,Gp=d_,mb=Ed,Hp=h_,iI=TypeError,Rm=function(t,r){this.stopped=t,this.result=r},zi=Rm.prototype,bh=function(t,r,s){var o,c,d,h,m,y,v,S=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),D=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),j=nI(r,S),B=function(ee){return o&&Hp(o,"normal",ee),new Rm(!0,ee)},J=function(ee){return R?(rI(ee),G?j(ee[0],ee[1],B):j(ee[0],ee[1])):G?j(ee,B):j(ee)};if(P)o=t.iterator;else if(D)o=t;else{if(!(c=mb(t)))throw iI(p_(t)+" is not iterable");if(vu(c)){for(d=0,h=f_(t);h>d;d++)if((m=J(t[d]))&&Cm(zi,m))return m;return new Rm(!1)}o=Gp(t,c)}for(y=P?t.next:o.next;!(v=OE(y,o)).done;){try{m=J(v.value)}catch(ee){Hp(o,"throw",ee)}if(typeof m=="object"&&m&&Cm(zi,m))return m}return new Rm(!1)},gb=Wa,_b=Gn,kE=O,yb=i_,Su=yu,Ki=function(t,r,s){for(var o=Ha(r),c=$R.f,d=EE.f,h=0;h<o.length;h++){var m=o[h];Bp(t,m)||s&&Bp(s,m)||c(t,m,d(r,m))}},Ps=_a,Os=fa,Im=He,m_=function(t,r){YR(r)&&"cause"in r&&XR(t,"cause",r.cause)},g_=function(t,r,s,o){IE&&(ub?ub(t,r):B1(t,"stack",l_(s,o)))},z1=bh,Go=function(t,r){return t===void 0?arguments.length<2?"":r:gb(t)},Eb=Tr("toStringTag"),Am=Error,vb=[].push,ya=function(t,r){var s,o=kE(qa,this);Su?s=Su(Am(),o?yb(this):qa):(s=o?this:Ps(qa),Os(s,Eb,"Error")),r!==void 0&&Os(s,"message",Go(r)),g_(s,ya,s.stack,1),arguments.length>2&&m_(s,arguments[2]);var c=[];return z1(t,vb,{that:c}),Os(s,"errors",c),s};Su?Su(ya,Am):Ki(ya,Am,{name:!0});var qa=ya.prototype=Ps(Am.prototype,{constructor:Im(1,ya),message:Im(1,""),name:Im(1,"AggregateError")});_b({global:!0},{AggregateError:ya});var Th,$p,Pm,sI=ke,Sb=M.WeakMap,oI=sI(Sb)&&/native code/.test(String(Sb)),bb=M,aI=Et,cI=fa,NE=Ri,DE=cu,__=n_,lI=Hc,y_="Object already initialized",Om=bb.TypeError,uI=bb.WeakMap;if(oI||DE.state){var Xc=DE.state||(DE.state=new uI);Xc.get=Xc.get,Xc.has=Xc.has,Xc.set=Xc.set,Th=function(t,r){if(Xc.has(t))throw Om(y_);return r.facade=t,Xc.set(t,r),r},$p=function(t){return Xc.get(t)||{}},Pm=function(t){return Xc.has(t)}}else{var Kp=__("state");lI[Kp]=!0,Th=function(t,r){if(NE(t,Kp))throw Om(y_);return r.facade=t,cI(t,Kp,r),r},$p=function(t){return NE(t,Kp)?t[Kp]:{}},Pm=function(t){return NE(t,Kp)}}var wh,Tb,wb,Sd={set:Th,get:$p,has:Pm,enforce:function(t){return Pm(t)?$p(t):Th(t,{})},getterFor:function(t){return function(r){var s;if(!aI(r)||(s=$p(r)).type!==t)throw Om("Incompatible receiver, "+t+" required");return s}}},xE=Fe,dI=Ri,Cb=Function.prototype,W1=xE&&Object.getOwnPropertyDescriptor,Rb=dI(Cb,"name"),hI={PROPER:Rb&&(function(){}).name==="something",CONFIGURABLE:Rb&&(!xE||xE&&W1(Cb,"name").configurable)},G1=fa,bd=function(t,r,s,o){return o&&o.enumerable?t[r]=s:G1(t,r,s),t},pI=u,fI=ke,LE=Et,H1=_a,mI=i_,$1=bd,Sc=Tr("iterator"),ME=!1;[].keys&&("next"in(wb=[].keys())?(Tb=mI(mI(wb)))!==Object.prototype&&(wh=Tb):ME=!0);var UE=!LE(wh)||pI(function(){var t={};return wh[Sc].call(t)!==t});fI((wh=UE?{}:H1(wh))[Sc])||$1(wh,Sc,function(){return this});var Ib={IteratorPrototype:wh,BUGGY_SAFARI_ITERATORS:ME},gI=Gc,_I=Np?{}.toString:function(){return"[object "+gI(this)+"]"},Ab=Np,km=rt.f,Pb=fa,Ob=Ri,K1=_I,kb=Tr("toStringTag"),Td=function(t,r,s,o){if(t){var c=s?t:t.prototype;Ob(c,kb)||km(c,kb,{configurable:!0,value:r}),o&&!Ab&&Pb(c,"toString",K1)}},yI=Ib.IteratorPrototype,EI=_a,vI=He,q1=Td,Ya=Eh,Ea=function(){return this},VE=function(t,r,s,o){var c=r+" Iterator";return t.prototype=EI(yI,{next:vI(+!o,s)}),q1(t,c,!1,!0),Ya[c]=Ea,t},SI=Gn,bI=Se,TI=hI,wI=VE,Nb=i_,CI=Td,FE=bd,Db=Eh,RI=Ib,xb=TI.PROPER,Nm=RI.BUGGY_SAFARI_ITERATORS,jE=Tr("iterator"),BE="keys",qp="values",II="entries",AI=function(){return this},zE=function(t,r,s,o,c,d,h){wI(s,r,o);var m,y,v,S=function(J){if(J===c&&j)return j;if(!Nm&&J in D)return D[J];switch(J){case BE:case qp:case II:return function(){return new s(this,J)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,D=t.prototype,G=D[jE]||D["@@iterator"]||c&&D[c],j=!Nm&&G||S(c),B=r=="Array"&&D.entries||G;if(B&&(m=Nb(B.call(new t)))!==Object.prototype&&m.next&&(CI(m,R,!0,!0),Db[R]=AI),xb&&c==qp&&G&&G.name!==qp&&(P=!0,j=function(){return bI(G,this)}),c)if(y={values:S(qp),keys:d?j:S(BE),entries:S(II)},h)for(v in y)(Nm||P||!(v in D))&&FE(D,v,y[v]);else SI({target:r,proto:!0,forced:Nm||P},y);return h&&D[jE]!==j&&FE(D,jE,j,{}),Db[r]=j,y},WE=function(t,r){return{value:t,done:r}},GE=Te,bu=Eh,PI=Sd;rt.f;var OI=zE,HE=WE,Lb="Array Iterator",kI=PI.set,E_=PI.getterFor(Lb);OI(Array,"Array",function(t,r){kI(this,{type:Lb,target:GE(t),index:0,kind:r})},function(){var t=E_(this),r=t.target,s=t.kind,o=t.index++;return!r||o>=r.length?(t.target=void 0,HE(void 0,!0)):HE(s=="keys"?o:s=="values"?r[o]:[o,r[o]],!1)},"values"),bu.Arguments=bu.Array;var Ho=rt,$E=function(t,r,s){return Ho.f(t,r,s)},Y1=tn,KE=$E,$o=Fe,NI=Tr("species"),nn=O,Dm=TypeError,v_=function(t,r){if(nn(r,t))return t;throw Dm("Incorrect invocation")},DI=ke,Mb=cu,S_=I(Function.toString);DI(Mb.inspectSource)||(Mb.inspectSource=function(t){return S_(t)});var b_=Mb.inspectSource,Ub=I,xI=u,Vb=ke,LI=Gc,Fb=b_,qE=function(){},_o=[],Jc=tn("Reflect","construct"),Tu=/^\s*(?:class|function)\b/,MI=Ub(Tu.exec),UI=!Tu.exec(qE),va=function(t){if(!Vb(t))return!1;try{return Jc(qE,_o,t),!0}catch{return!1}},jb=function(t){if(!Vb(t))return!1;switch(LI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return UI||!!MI(Tu,Fb(t))}catch{return!0}};jb.sham=!0;var Xa,xm,Bb,YE,T_=!Jc||xI(function(){var t;return va(va.call)||!va(Object)||!va(function(){t=!0})||t})?jb:va,VI=T_,X1=Va,XE=TypeError,JE=gn,Qc=function(t){if(VI(t))return t;throw XE(X1(t)+" is not a constructor")},Mr=ut,oo=Tr("species"),ls=function(t,r){var s,o=JE(t).constructor;return o===void 0||Mr(s=JE(o)[oo])?r:Qc(s)},ks=I([].slice),bc=TypeError,Vl=function(t,r){if(t<r)throw bc("Not enough arguments");return t},Ns=/(?:ipad|iphone|ipod).*applewebkit/i.test(wt),yo=M,Yp=ne,QE=De,ZE=ke,w_=Ri,Sa=u,ev=o_,Lm=ks,wu=fu,tv=Vl,zb=Ns,Ch=Lp,Mm=yo.setImmediate,Cu=yo.clearImmediate,nv=yo.process,Xp=yo.Dispatch,Wb=yo.Function,C_=yo.MessageChannel,rv=yo.String,Eo=0,Zc={},el="onreadystatechange";Sa(function(){Xa=yo.location});var Ko=function(t){if(w_(Zc,t)){var r=Zc[t];delete Zc[t],r()}},iv=function(t){return function(){Ko(t)}},sv=function(t){Ko(t.data)},ov=function(t){yo.postMessage(rv(t),Xa.protocol+"//"+Xa.host)};Mm&&Cu||(Mm=function(t){tv(arguments.length,1);var r=ZE(t)?t:Wb(t),s=Lm(arguments,1);return Zc[++Eo]=function(){Yp(r,void 0,s)},xm(Eo),Eo},Cu=function(t){delete Zc[t]},Ch?xm=function(t){nv.nextTick(iv(t))}:Xp&&Xp.now?xm=function(t){Xp.now(iv(t))}:C_&&!zb?(YE=(Bb=new C_).port2,Bb.port1.onmessage=sv,xm=QE(YE.postMessage,YE)):yo.addEventListener&&ZE(yo.postMessage)&&!yo.importScripts&&Xa&&Xa.protocol!=="file:"&&!Sa(ov)?(xm=ov,yo.addEventListener("message",sv,!1)):xm=el in wu("script")?function(t){ev.appendChild(wu("script"))[el]=function(){ev.removeChild(this),Ko(t)}}:function(t){setTimeout(iv(t),0)});var av={set:Mm,clear:Cu},wd=function(){this.head=null,this.tail=null};wd.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Jp,R_,Cd,I_,Rh,Gb=wd,FI=/ipad|iphone|ipod/i.test(wt)&&typeof Pebble<"u",Hb=/web0s(?!.*chrome)/i.test(wt),Ru=M,jI=De,J1=xe.f,cv=av.set,BI=Gb,Qp=Ns,Q1=FI,Um=Hb,lv=Lp,qi=Ru.MutationObserver||Ru.WebKitMutationObserver,zI=Ru.document,$b=Ru.process,uv=Ru.Promise,WI=J1(Ru,"queueMicrotask"),dv=WI&&WI.value;if(!dv){var A_=new BI,hv=function(){var t,r;for(lv&&(t=$b.domain)&&t.exit();r=A_.get();)try{r()}catch(s){throw A_.head&&Jp(),s}t&&t.enter()};Qp||lv||Um||!qi||!zI?!Q1&&uv&&uv.resolve?((I_=uv.resolve(void 0)).constructor=uv,Rh=jI(I_.then,I_),Jp=function(){Rh(hv)}):lv?Jp=function(){$b.nextTick(hv)}:(cv=jI(cv,Ru),Jp=function(){cv(hv)}):(R_=!0,Cd=zI.createTextNode(""),new qi(hv).observe(Cd,{characterData:!0}),Jp=function(){Cd.data=R_=!R_}),dv=function(t){A_.head||Jp(),A_.add(t)}}var Tc=dv,Ih=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Zp=M.Promise,Rd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",pv=!Rd&&!Lp&&typeof window=="object"&&typeof document=="object",ef=M,Ah=Zp,Kb=ke,qb=Ba,Z1=b_,Yb=Tr,eD=pv,GI=Rd,fv=cr,P_=Ah&&Ah.prototype,mv=Yb("species"),Xb=Kb(ef.PromiseRejectionEvent),Jb=qb("Promise",function(){var t=Z1(Ah),r=t!==String(Ah);if(!r&&fv===66||!P_.catch||!P_.finally)return!0;if(!fv||fv<51||!/native code/.test(t)){var s=new Ah(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((s.constructor={})[mv]=o,!(s.then(function(){})instanceof o))return!0}return!r&&(eD||GI)&&!Xb}),O_={CONSTRUCTOR:Jb,REJECTION_EVENT:Xb},Fl={},gv=os,_v=TypeError,Qb=function(t){var r,s;this.promise=new t(function(o,c){if(r!==void 0||s!==void 0)throw _v("Bad Promise constructor");r=o,s=c}),this.resolve=gv(r),this.reject=gv(s)};Fl.f=function(t){return new Qb(t)};var Vm,Zb,tD=Gn,tf=Lp,Ph=M,Id=Se,nD=bd,yv=Td,p=function(t){var r=Y1(t);$o&&r&&!r[NI]&&KE(r,NI,{configurable:!0,get:function(){return this}})},g=os,w=ke,k=Et,V=v_,H=ls,he=av.set,Re=Tc,Ue=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},it=Ih,Dt=Gb,Lt=Sd,Nt=Zp,Jt=O_,on=Fl,an="Promise",us=Jt.CONSTRUCTOR,Qe=Jt.REJECTION_EVENT,je=Lt.getterFor(an),tt=Lt.set,Ft=Nt&&Nt.prototype,cn=Nt,Sn=Ft,Cn=Ph.TypeError,Fn=Ph.document,Ds=Ph.process,Nr=on.f,Oh=Nr,rD=!!(Fn&&Fn.createEvent&&Ph.dispatchEvent),s3="unhandledrejection",o3=function(t){var r;return!(!k(t)||!w(r=t.then))&&r},a3=function(t,r){var s,o,c,d=r.value,h=r.state==1,m=h?t.ok:t.fail,y=t.resolve,v=t.reject,S=t.domain;try{m?(h||(r.rejection===2&&rae(r),r.rejection=1),m===!0?s=d:(S&&S.enter(),s=m(d),S&&(S.exit(),c=!0)),s===t.promise?v(Cn("Promise-chain cycle")):(o=o3(s))?Id(o,s,y,v):y(s)):v(d)}catch(R){S&&!c&&S.exit(),v(R)}},c3=function(t,r){t.notified||(t.notified=!0,Re(function(){for(var s,o=t.reactions;s=o.get();)a3(s,t);t.notified=!1,r&&!t.rejection&&nae(t)}))},l3=function(t,r,s){var o,c;rD?((o=Fn.createEvent("Event")).promise=r,o.reason=s,o.initEvent(t,!1,!0),Ph.dispatchEvent(o)):o={promise:r,reason:s},!Qe&&(c=Ph["on"+t])?c(o):t===s3&&Ue("Unhandled promise rejection",s)},nae=function(t){Id(he,Ph,function(){var r,s=t.facade,o=t.value;if(u3(t)&&(r=it(function(){tf?Ds.emit("unhandledRejection",o,s):l3(s3,s,o)}),t.rejection=tf||u3(t)?2:1,r.error))throw r.value})},u3=function(t){return t.rejection!==1&&!t.parent},rae=function(t){Id(he,Ph,function(){var r=t.facade;tf?Ds.emit("rejectionHandled",r):l3("rejectionhandled",r,t.value)})},Ev=function(t,r,s){return function(o){t(r,o,s)}},vv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,c3(t,!0))},iD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw Cn("Promise can't be resolved itself");var o=o3(r);o?Re(function(){var c={done:!1};try{Id(o,r,Ev(iD,c,t),Ev(vv,c,t))}catch(d){vv(c,d,t)}}):(t.value=r,t.state=1,c3(t,!1))}catch(c){vv({done:!1},c,t)}}};us&&(Sn=(cn=function(t){V(this,Sn),g(t),Id(Vm,this);var r=je(this);try{t(Ev(iD,r),Ev(vv,r))}catch(s){vv(r,s)}}).prototype,(Vm=function(t){tt(this,{type:an,done:!1,notified:!1,parent:!1,reactions:new Dt,rejection:!1,state:0,value:void 0})}).prototype=nD(Sn,"then",function(t,r){var s=je(this),o=Nr(H(this,cn));return s.parent=!0,o.ok=!w(t)||t,o.fail=w(r)&&r,o.domain=tf?Ds.domain:void 0,s.state==0?s.reactions.add(o):Re(function(){a3(o,s)}),o.promise}),Zb=function(){var t=new Vm,r=je(t);this.promise=t,this.resolve=Ev(iD,r),this.reject=Ev(vv,r)},on.f=Nr=function(t){return t===cn||t===void 0?new Zb(t):Oh(t)}),tD({global:!0,wrap:!0,forced:us},{Promise:cn}),yv(cn,an,!1,!0),p(an);var d3=Tr("iterator"),h3=!1;try{var iae=0,p3={next:function(){return{done:!!iae++}},return:function(){h3=!0}};p3[d3]=function(){return this},Array.from(p3,function(){throw 2})}catch{}var sae=Zp,oae=function(t,r){if(!h3)return!1;var s=!1;try{var o={};o[d3]=function(){return{next:function(){return{done:s=!0}}}},t(o)}catch{}return s},HI=O_.CONSTRUCTOR||!oae(function(t){sae.all(t).then(void 0,function(){})}),aae=Se,cae=os,lae=Fl,uae=Ih,dae=bh;Gn({target:"Promise",stat:!0,forced:HI},{all:function(t){var r=this,s=lae.f(r),o=s.resolve,c=s.reject,d=uae(function(){var h=cae(r.resolve),m=[],y=0,v=1;dae(t,function(S){var R=y++,P=!1;v++,aae(h,r,S).then(function(D){P||(P=!0,m[R]=D,--v||o(m))},c)}),--v||o(m)});return d.error&&c(d.value),s.promise}});var hae=Gn,pae=O_.CONSTRUCTOR;Zp&&Zp.prototype,hae({target:"Promise",proto:!0,forced:pae,real:!0},{catch:function(t){return this.then(void 0,t)}});var fae=Se,mae=os,gae=Fl,_ae=Ih,yae=bh;Gn({target:"Promise",stat:!0,forced:HI},{race:function(t){var r=this,s=gae.f(r),o=s.reject,c=_ae(function(){var d=mae(r.resolve);yae(t,function(h){fae(d,r,h).then(s.resolve,o)})});return c.error&&o(c.value),s.promise}});var Eae=Se,vae=Fl;Gn({target:"Promise",stat:!0,forced:O_.CONSTRUCTOR},{reject:function(t){var r=vae.f(this);return Eae(r.reject,void 0,t),r.promise}});var Sae=gn,bae=Et,Tae=Fl,f3=function(t,r){if(Sae(t),bae(r)&&r.constructor===t)return r;var s=Tae.f(t);return(0,s.resolve)(r),s.promise},wae=Gn,Cae=Zp,Rae=O_.CONSTRUCTOR,Iae=f3,Aae=tn("Promise"),Pae=!Rae;wae({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Iae(Pae&&this===Aae?Cae:this,t)}});var Oae=Se,kae=os,Nae=Fl,Dae=Ih,xae=bh;Gn({target:"Promise",stat:!0,forced:HI},{allSettled:function(t){var r=this,s=Nae.f(r),o=s.resolve,c=s.reject,d=Dae(function(){var h=kae(r.resolve),m=[],y=0,v=1;xae(t,function(S){var R=y++,P=!1;v++,Oae(h,r,S).then(function(D){P||(P=!0,m[R]={status:"fulfilled",value:D},--v||o(m))},function(D){P||(P=!0,m[R]={status:"rejected",reason:D},--v||o(m))})}),--v||o(m)});return d.error&&c(d.value),s.promise}});var Lae=Se,Mae=os,Uae=tn,Vae=Fl,Fae=Ih,jae=bh,m3="No one promise resolved";Gn({target:"Promise",stat:!0,forced:HI},{any:function(t){var r=this,s=Uae("AggregateError"),o=Vae.f(r),c=o.resolve,d=o.reject,h=Fae(function(){var m=Mae(r.resolve),y=[],v=0,S=1,R=!1;jae(t,function(P){var D=v++,G=!1;S++,Lae(m,r,P).then(function(j){G||R||(R=!0,c(j))},function(j){G||R||(G=!0,y[D]=j,--S||d(new s(y,m3)))})}),--S||d(new s(y,m3))});return h.error&&d(h.value),o.promise}});var Bae=Gn,sD=Zp,zae=u,Wae=tn,Gae=ke,Hae=ls,g3=f3,$ae=sD&&sD.prototype;Bae({target:"Promise",proto:!0,real:!0,forced:!!sD&&zae(function(){$ae.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=Hae(this,Wae("Promise")),s=Gae(t);return this.then(s?function(o){return g3(r,t()).then(function(){return o})}:t,s?function(o){return g3(r,t()).then(function(){throw o})}:t)}});var oD=I,Kae=Wc,qae=Wa,Yae=Mt,Xae=oD("".charAt),_3=oD("".charCodeAt),Jae=oD("".slice),y3=function(t){return function(r,s){var o,c,d=qae(Yae(r)),h=Kae(s),m=d.length;return h<0||h>=m?t?"":void 0:(o=_3(d,h))<55296||o>56319||h+1===m||(c=_3(d,h+1))<56320||c>57343?t?Xae(d,h):o:t?Jae(d,h,h+2):c-56320+(o-55296<<10)+65536}},aD={codeAt:y3(!1),charAt:y3(!0)},Qae=aD.charAt,Zae=Wa,E3=Sd,ece=zE,v3=WE,S3="String Iterator",tce=E3.set,nce=E3.getterFor(S3);ece(String,"String",function(t){tce(this,{type:S3,string:Zae(t),index:0})},function(){var t,r=nce(this),s=r.string,o=r.index;return o>=s.length?v3(void 0,!0):(t=Qae(s,o),r.index+=t.length,v3(t,!1))});var rce=vt.Promise,ice={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},sce=M,oce=Gc,ace=fa,b3=Eh,T3=Tr("toStringTag");for(var cD in ice){var w3=sce[cD],lD=w3&&w3.prototype;lD&&oce(lD)!==T3&&ace(lD,T3,cD),b3[cD]=b3.Array}var C3=rce,ht=l(C3),cce=yc("Array").values,lce=Gc,uce=Ri,dce=O,hce=cce,uD=Array.prototype,pce={DOMTokenList:!0,NodeList:!0},fce=function(t){var r=t.values;return t===uD||dce(uD,t)&&r===uD.values||uce(pce,lce(t))?hce:r},tl=l(fce),mce=u,gce=Tr("iterator"),dD=!mce(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),o="";return t.pathname="c%20d",r.forEach(function(c,d){r.delete("b"),o+=d+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[gce]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),_ce=bd,yce=gc,Ece=rt,vce=He,$I=function(t,r,s){var o=yce(r);o in t?Ece.f(t,o,vce(0,s)):t[o]=s},R3=ge,Sce=gi,bce=$I,Tce=Array,wce=Math.max,hD=function(t,r,s){for(var o=Sce(t),c=R3(r,o),d=R3(s===void 0?o:s,o),h=Tce(wce(d-c,0)),m=0;c<d;c++,m++)bce(h,m,t[c]);return h.length=m,h},I3=hD,Cce=Math.floor,pD=function(t,r){var s=t.length,o=Cce(s/2);return s<8?Rce(t,r):Ice(t,pD(I3(t,0,o),r),pD(I3(t,o),r),r)},Rce=function(t,r){for(var s,o,c=t.length,d=1;d<c;){for(o=d,s=t[d];o&&r(t[o-1],s)>0;)t[o]=t[--o];o!==d++&&(t[o]=s)}return t},Ice=function(t,r,s,o){for(var c=r.length,d=s.length,h=0,m=0;h<c||m<d;)t[h+m]=h<c&&m<d?o(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},A3=pD,fD=Gn,Sv=M,KI=Se,kh=I,bv=Fe,P3=dD,O3=bd,Ace=$E,Pce=function(t,r,s){for(var o in r)s&&s.unsafe&&t[o]?t[o]=r[o]:_ce(t,o,r[o],s);return t},Oce=Td,kce=VE,mD=Sd,k3=v_,gD=ke,Nce=Ri,Dce=De,xce=Gc,Lce=gn,N3=Et,wc=Wa,Mce=_a,D3=He,_D=d_,Uce=Ed,Tv=Vl,Vce=A3,Fce=Tr("iterator"),eT="URLSearchParams",x3=eT+"Iterator",L3=mD.set,Iu=mD.getterFor(eT),jce=mD.getterFor(x3),Bce=Object.getOwnPropertyDescriptor,yD=function(t){if(!bv)return Sv[t];var r=Bce(Sv,t);return r&&r.value},M3=yD("fetch"),qI=yD("Request"),tT=yD("Headers"),ED=qI&&qI.prototype,U3=tT&&tT.prototype,zce=Sv.RegExp,Wce=Sv.TypeError,V3=Sv.decodeURIComponent,Gce=Sv.encodeURIComponent,Hce=kh("".charAt),F3=kh([].join),k_=kh([].push),vD=kh("".replace),$ce=kh([].shift),j3=kh([].splice),B3=kh("".split),Kce=kh("".slice),qce=/\+/g,z3=Array(4),Yce=function(t){return z3[t-1]||(z3[t-1]=zce("((?:%[\\da-f]{2}){"+t+"})","gi"))},Xce=function(t){try{return V3(t)}catch{return t}},W3=function(t){var r=vD(t,qce," "),s=4;try{return V3(r)}catch{for(;s;)r=vD(r,Yce(s--),Xce);return r}},Jce=/[!'()~]|%20/g,Qce={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Zce=function(t){return Qce[t]},G3=function(t){return vD(Gce(t),Jce,Zce)},SD=kce(function(t,r){L3(this,{type:x3,iterator:_D(Iu(t).entries),kind:r})},"Iterator",function(){var t=jce(this),r=t.kind,s=t.iterator.next(),o=s.value;return s.done||(s.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),s},!0),H3=function(t){this.entries=[],this.url=null,t!==void 0&&(N3(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?Hce(t,0)==="?"?Kce(t,1):t:wc(t)))};H3.prototype={type:eT,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,o,c,d,h,m,y=Uce(t);if(y)for(s=(r=_D(t,y)).next;!(o=KI(s,r)).done;){if(d=(c=_D(Lce(o.value))).next,(h=KI(d,c)).done||(m=KI(d,c)).done||!KI(d,c).done)throw Wce("Expected sequence with length 2");k_(this.entries,{key:wc(h.value),value:wc(m.value)})}else for(var v in t)Nce(t,v)&&k_(this.entries,{key:v,value:wc(t[v])})},parseQuery:function(t){if(t)for(var r,s,o=B3(t,"&"),c=0;c<o.length;)(r=o[c++]).length&&(s=B3(r,"="),k_(this.entries,{key:W3($ce(s)),value:W3(F3(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],o=0;o<r.length;)t=r[o++],k_(s,G3(t.key)+"="+G3(t.value));return F3(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var YI=function(){k3(this,wv);var t=L3(this,new H3(arguments.length>0?arguments[0]:void 0));bv||(this.size=t.entries.length)},wv=YI.prototype;if(Pce(wv,{append:function(t,r){var s=Iu(this);Tv(arguments.length,2),k_(s.entries,{key:wc(t),value:wc(r)}),bv||this.length++,s.updateURL()},delete:function(t){for(var r=Iu(this),s=Tv(arguments.length,1),o=r.entries,c=wc(t),d=s<2?void 0:arguments[1],h=d===void 0?d:wc(d),m=0;m<o.length;){var y=o[m];if(y.key!==c||h!==void 0&&y.value!==h)m++;else if(j3(o,m,1),h!==void 0)break}bv||(this.size=o.length),r.updateURL()},get:function(t){var r=Iu(this).entries;Tv(arguments.length,1);for(var s=wc(t),o=0;o<r.length;o++)if(r[o].key===s)return r[o].value;return null},getAll:function(t){var r=Iu(this).entries;Tv(arguments.length,1);for(var s=wc(t),o=[],c=0;c<r.length;c++)r[c].key===s&&k_(o,r[c].value);return o},has:function(t){for(var r=Iu(this).entries,s=Tv(arguments.length,1),o=wc(t),c=s<2?void 0:arguments[1],d=c===void 0?c:wc(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(d===void 0||m.value===d))return!0}return!1},set:function(t,r){var s=Iu(this);Tv(arguments.length,1);for(var o,c=s.entries,d=!1,h=wc(t),m=wc(r),y=0;y<c.length;y++)(o=c[y]).key===h&&(d?j3(c,y--,1):(d=!0,o.value=m));d||k_(c,{key:h,value:m}),bv||(this.size=c.length),s.updateURL()},sort:function(){var t=Iu(this);Vce(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=Iu(this).entries,o=Dce(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)o((r=s[c++]).value,r.key,this)},keys:function(){return new SD(this,"keys")},values:function(){return new SD(this,"values")},entries:function(){return new SD(this,"entries")}},{enumerable:!0}),O3(wv,Fce,wv.entries,{}),O3(wv,"toString",function(){return Iu(this).serialize()},{enumerable:!0}),bv&&Ace(wv,"size",{get:function(){return Iu(this).entries.length},configurable:!0,enumerable:!0}),Oce(YI,eT),fD({global:!0,forced:!P3},{URLSearchParams:YI}),!P3&&gD(tT)){var ele=kh(U3.has),tle=kh(U3.set),$3=function(t){if(N3(t)){var r,s=t.body;if(xce(s)===eT)return r=t.headers?new tT(t.headers):new tT,ele(r,"content-type")||tle(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Mce(t,{body:D3(0,wc(s)),headers:D3(0,r)})}return t};if(gD(M3)&&fD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return M3(t,arguments.length>1?$3(arguments[1]):{})}}),gD(qI)){var bD=function(t){return k3(this,ED),new qI(t,arguments.length>1?$3(arguments[1]):{})};ED.constructor=bD,bD.prototype=ED,fD({global:!0,dontCallGetSet:!0,forced:!0},{Request:bD})}}var Au,nle={URLSearchParams:YI,getState:Iu},rle=vt.URLSearchParams,K3=Fe,ile=I,sle=Se,ole=u,TD=Kc,ale=$c,cle=Be,lle=xi,ule=sn,Cv=Object.assign,q3=Object.defineProperty,dle=ile([].concat),hle=!Cv||ole(function(){if(K3&&Cv({b:1},Cv(q3({},"a",{enumerable:!0,get:function(){q3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),o="abcdefghijklmnopqrst";return t[s]=7,o.split("").forEach(function(c){r[c]=c}),Cv({},t)[s]!=7||TD(Cv({},r)).join("")!=o})?function(t,r){for(var s=lle(t),o=arguments.length,c=1,d=ale.f,h=cle.f;o>c;)for(var m,y=ule(arguments[c++]),v=d?dle(TD(y),d(y)):TD(y),S=v.length,R=0;S>R;)m=v[R++],K3&&!sle(h,y,m)||(s[m]=y[m]);return s}:Cv,ple=gn,fle=h_,mle=De,gle=Se,_le=xi,yle=function(t,r,s,o){try{return o?r(ple(s)[0],s[1]):r(s)}catch(c){fle(t,"throw",c)}},Ele=u_,vle=T_,Sle=gi,Y3=$I,ble=d_,Tle=Ed,X3=Array,N_=I,wD=2147483647,wle=/[^\0-\u007E]/,J3=/[.\u3002\uFF0E\uFF61]/g,Q3="Overflow: input needs wider integers to process",Z3=RangeError,Cle=N_(J3.exec),Rv=Math.floor,CD=String.fromCharCode,e5=N_("".charCodeAt),t5=N_([].join),Fm=N_([].push),Rle=N_("".replace),Ile=N_("".split),Ale=N_("".toLowerCase),n5=function(t){return t+22+75*(t<26)},Ple=function(t,r,s){var o=0;for(t=s?Rv(t/700):t>>1,t+=Rv(t/r);t>455;)t=Rv(t/35),o+=36;return Rv(o+36*t/(t+38))},Ole=function(t){var r=[];t=function(J){for(var ee=[],fe=0,ye=J.length;fe<ye;){var ve=e5(J,fe++);if(ve>=55296&&ve<=56319&&fe<ye){var _e=e5(J,fe++);(64512&_e)==56320?Fm(ee,((1023&ve)<<10)+(1023&_e)+65536):(Fm(ee,ve),fe--)}else Fm(ee,ve)}return ee}(t);var s,o,c=t.length,d=128,h=0,m=72;for(s=0;s<t.length;s++)(o=t[s])<128&&Fm(r,CD(o));var y=r.length,v=y;for(y&&Fm(r,"-");v<c;){var S=wD;for(s=0;s<t.length;s++)(o=t[s])>=d&&o<S&&(S=o);var R=v+1;if(S-d>Rv((wD-h)/R))throw Z3(Q3);for(h+=(S-d)*R,d=S,s=0;s<t.length;s++){if((o=t[s])<d&&++h>wD)throw Z3(Q3);if(o==d){for(var P=h,D=36;;){var G=D<=m?1:D>=m+26?26:D-m;if(P<G)break;var j=P-G,B=36-G;Fm(r,CD(n5(G+j%B))),P=Rv(j/B),D+=36}Fm(r,CD(n5(P))),m=Ple(h,R,v==y),h=0,v++}}h++,d++}return t5(r,"")},kle=Gn,RD=Fe,Nle=dD,ID=M,r5=De,Pu=I,XI=bd,Ou=$E,Dle=v_,AD=Ri,PD=hle,Iv=function(t){var r=_le(t),s=vle(this),o=arguments.length,c=o>1?arguments[1]:void 0,d=c!==void 0;d&&(c=mle(c,o>2?arguments[2]:void 0));var h,m,y,v,S,R,P=Tle(r),D=0;if(!P||this===X3&&Ele(P))for(h=Sle(r),m=s?new this(h):X3(h);h>D;D++)R=d?c(r[D],D):r[D],Y3(m,D,R);else for(S=(v=ble(r,P)).next,m=s?new this:[];!(y=gle(S,v)).done;D++)R=d?yle(v,c,[y.value,D],!0):y.value,Y3(m,D,R);return m.length=D,m},Ad=hD,xle=aD.codeAt,Lle=function(t){var r,s,o=[],c=Ile(Rle(Ale(t),J3,"."),".");for(r=0;r<c.length;r++)s=c[r],Fm(o,Cle(wle,s)?"xn--"+Ole(s):s);return t5(o,".")},nf=Wa,Mle=Td,Ule=Vl,i5=nle,s5=Sd,Vle=s5.set,JI=s5.getterFor("URL"),Fle=i5.URLSearchParams,jle=i5.getState,nT=ID.URL,OD=ID.TypeError,QI=ID.parseInt,Ble=Math.floor,o5=Math.pow,ku=Pu("".charAt),Pd=Pu(/./.exec),rT=Pu([].join),zle=Pu(1 .toString),Wle=Pu([].pop),Av=Pu([].push),kD=Pu("".replace),Gle=Pu([].shift),Hle=Pu("".split),iT=Pu("".slice),ZI=Pu("".toLowerCase),$le=Pu([].unshift),ND="Invalid scheme",D_="Invalid host",a5="Invalid port",c5=/[a-z]/i,Kle=/[\d+-.a-z]/i,DD=/\d/,qle=/^0x/i,Yle=/^[0-7]+$/,Xle=/^\d+$/,l5=/^[\da-f]+$/i,Jle=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Qle=/[\0\t\n\r #/:<>?@[\\\]^|]/,Zle=/^[\u0000-\u0020]+/,eue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,tue=/[\t\n\r]/g,sT=function(t){var r,s,o,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)$le(r,t%256),t=Ble(t/256);return rT(r,".")}if(typeof t=="object"){for(r="",o=function(d){for(var h=null,m=1,y=null,v=0,S=0;S<8;S++)d[S]!==0?(v>m&&(h=y,m=v),y=null,v=0):(y===null&&(y=S),++v);return v>m&&(h=y,m=v),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),o===s?(r+=s?":":"::",c=!0):(r+=zle(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},eA={},u5=PD({},eA,{" ":1,'"':1,"<":1,">":1,"`":1}),d5=PD({},u5,{"#":1,"?":1,"{":1,"}":1}),xD=PD({},d5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),jm=function(t,r){var s=xle(t,0);return s>32&&s<127&&!AD(r,t)?t:encodeURIComponent(t)},tA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},oT=function(t,r){var s;return t.length==2&&Pd(c5,ku(t,0))&&((s=ku(t,1))==":"||!r&&s=="|")},h5=function(t){var r;return t.length>1&&oT(iT(t,0,2))&&(t.length==2||(r=ku(t,2))==="/"||r==="\\"||r==="?"||r==="#")},nue=function(t){return t==="."||ZI(t)==="%2e"},LD={},p5={},MD={},f5={},m5={},UD={},g5={},_5={},nA={},rA={},VD={},FD={},jD={},BD={},y5={},zD={},Pv={},Nh={},E5={},x_={},rf={},WD=function(t,r,s){var o,c,d,h=nf(t);if(r){if(c=this.parse(h))throw OD(c);this.searchParams=null}else{if(s!==void 0&&(o=new WD(s,!0)),c=this.parse(h,null,o))throw OD(c);(d=jle(new Fle)).bindURL(this),this.searchParams=d}};WD.prototype={type:"URL",parse:function(t,r,s){var o,c,d,h,m,y=this,v=r||LD,S=0,R="",P=!1,D=!1,G=!1;for(t=nf(t),r||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,t=kD(t,Zle,""),t=kD(t,eue,"$1")),t=kD(t,tue,""),o=Iv(t);S<=o.length;){switch(c=o[S],v){case LD:if(!c||!Pd(c5,c)){if(r)return ND;v=MD;continue}R+=ZI(c),v=p5;break;case p5:if(c&&(Pd(Kle,c)||c=="+"||c=="-"||c=="."))R+=ZI(c);else{if(c!=":"){if(r)return ND;R="",v=MD,S=0;continue}if(r&&(y.isSpecial()!=AD(tA,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,r)return void(y.isSpecial()&&tA[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?v=BD:y.isSpecial()&&s&&s.scheme==y.scheme?v=f5:y.isSpecial()?v=_5:o[S+1]=="/"?(v=m5,S++):(y.cannotBeABaseURL=!0,Av(y.path,""),v=E5)}break;case MD:if(!s||s.cannotBeABaseURL&&c!="#")return ND;if(s.cannotBeABaseURL&&c=="#"){y.scheme=s.scheme,y.path=Ad(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,v=rf;break}v=s.scheme=="file"?BD:UD;continue;case f5:if(c!="/"||o[S+1]!="/"){v=UD;continue}v=nA,S++;break;case m5:if(c=="/"){v=rA;break}v=Nh;continue;case UD:if(y.scheme=s.scheme,c==Au)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Ad(s.path),y.query=s.query;else if(c=="/"||c=="\\"&&y.isSpecial())v=g5;else if(c=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Ad(s.path),y.query="",v=x_;else{if(c!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Ad(s.path),y.path.length--,v=Nh;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Ad(s.path),y.query=s.query,y.fragment="",v=rf}break;case g5:if(!y.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,v=Nh;continue}v=rA}else v=nA;break;case _5:if(v=nA,c!="/"||ku(R,S+1)!="/")continue;S++;break;case nA:if(c!="/"&&c!="\\"){v=rA;continue}break;case rA:if(c=="@"){P&&(R="%40"+R),P=!0,d=Iv(R);for(var j=0;j<d.length;j++){var B=d[j];if(B!=":"||G){var J=jm(B,xD);G?y.password+=J:y.username+=J}else G=!0}R=""}else if(c==Au||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(P&&R=="")return"Invalid authority";S-=Iv(R).length+1,R="",v=VD}else R+=c;break;case VD:case FD:if(r&&y.scheme=="file"){v=zD;continue}if(c!=":"||D){if(c==Au||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return D_;if(r&&R==""&&(y.includesCredentials()||y.port!==null))return;if(h=y.parseHost(R))return h;if(R="",v=Pv,r)return;continue}c=="["?D=!0:c=="]"&&(D=!1),R+=c}else{if(R=="")return D_;if(h=y.parseHost(R))return h;if(R="",v=jD,r==FD)return}break;case jD:if(!Pd(DD,c)){if(c==Au||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()||r){if(R!=""){var ee=QI(R,10);if(ee>65535)return a5;y.port=y.isSpecial()&&ee===tA[y.scheme]?null:ee,R=""}if(r)return;v=Pv;continue}return a5}R+=c;break;case BD:if(y.scheme="file",c=="/"||c=="\\")v=y5;else{if(!s||s.scheme!="file"){v=Nh;continue}if(c==Au)y.host=s.host,y.path=Ad(s.path),y.query=s.query;else if(c=="?")y.host=s.host,y.path=Ad(s.path),y.query="",v=x_;else{if(c!="#"){h5(rT(Ad(o,S),""))||(y.host=s.host,y.path=Ad(s.path),y.shortenPath()),v=Nh;continue}y.host=s.host,y.path=Ad(s.path),y.query=s.query,y.fragment="",v=rf}}break;case y5:if(c=="/"||c=="\\"){v=zD;break}s&&s.scheme=="file"&&!h5(rT(Ad(o,S),""))&&(oT(s.path[0],!0)?Av(y.path,s.path[0]):y.host=s.host),v=Nh;continue;case zD:if(c==Au||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&oT(R))v=Nh;else if(R==""){if(y.host="",r)return;v=Pv}else{if(h=y.parseHost(R))return h;if(y.host=="localhost"&&(y.host=""),r)return;R="",v=Pv}continue}R+=c;break;case Pv:if(y.isSpecial()){if(v=Nh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=Au&&(v=Nh,c!="/"))continue}else y.fragment="",v=rf;else y.query="",v=x_;break;case Nh:if(c==Au||c=="/"||c=="\\"&&y.isSpecial()||!r&&(c=="?"||c=="#")){if((m=ZI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(y.shortenPath(),c=="/"||c=="\\"&&y.isSpecial()||Av(y.path,"")):nue(R)?c=="/"||c=="\\"&&y.isSpecial()||Av(y.path,""):(y.scheme=="file"&&!y.path.length&&oT(R)&&(y.host&&(y.host=""),R=ku(R,0)+":"),Av(y.path,R)),R="",y.scheme=="file"&&(c==Au||c=="?"||c=="#"))for(;y.path.length>1&&y.path[0]==="";)Gle(y.path);c=="?"?(y.query="",v=x_):c=="#"&&(y.fragment="",v=rf)}else R+=jm(c,d5);break;case E5:c=="?"?(y.query="",v=x_):c=="#"?(y.fragment="",v=rf):c!=Au&&(y.path[0]+=jm(c,eA));break;case x_:r||c!="#"?c!=Au&&(c=="'"&&y.isSpecial()?y.query+="%27":y.query+=c=="#"?"%23":jm(c,eA)):(y.fragment="",v=rf);break;case rf:c!=Au&&(y.fragment+=jm(c,u5))}S++}},parseHost:function(t){var r,s,o;if(ku(t,0)=="["){if(ku(t,t.length-1)!="]"||(r=function(c){var d,h,m,y,v,S,R,P=[0,0,0,0,0,0,0,0],D=0,G=null,j=0,B=function(){return ku(c,j)};if(B()==":"){if(ku(c,1)!=":")return;j+=2,G=++D}for(;B();){if(D==8)return;if(B()!=":"){for(d=h=0;h<4&&Pd(l5,B());)d=16*d+QI(B(),16),j++,h++;if(B()=="."){if(h==0||(j-=h,D>6))return;for(m=0;B();){if(y=null,m>0){if(!(B()=="."&&m<4))return;j++}if(!Pd(DD,B()))return;for(;Pd(DD,B());){if(v=QI(B(),10),y===null)y=v;else{if(y==0)return;y=10*y+v}if(y>255)return;j++}P[D]=256*P[D]+y,++m!=2&&m!=4||D++}if(m!=4)return;break}if(B()==":"){if(j++,!B())return}else if(B())return;P[D++]=d}else{if(G!==null)return;j++,G=++D}}if(G!==null)for(S=D-G,D=7;D!=0&&S>0;)R=P[D],P[D--]=P[G+S-1],P[G+--S]=R;else if(D!=8)return;return P}(iT(t,1,-1)),!r))return D_;this.host=r}else if(this.isSpecial()){if(t=Lle(t),Pd(Jle,t)||(r=function(c){var d,h,m,y,v,S,R,P=Hle(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(d=P.length)>4)return c;for(h=[],m=0;m<d;m++){if((y=P[m])=="")return c;if(v=10,y.length>1&&ku(y,0)=="0"&&(v=Pd(qle,y)?16:8,y=iT(y,v==8?1:2)),y==="")S=0;else{if(!Pd(v==10?Xle:v==8?Yle:l5,y))return c;S=QI(y,v)}Av(h,S)}for(m=0;m<d;m++)if(S=h[m],m==d-1){if(S>=o5(256,5-d))return null}else if(S>255)return null;for(R=Wle(h),m=0;m<h.length;m++)R+=h[m]*o5(256,3-m);return R}(t),r===null))return D_;this.host=r}else{if(Pd(Qle,t))return D_;for(r="",s=Iv(t),o=0;o<s.length;o++)r+=jm(s[o],eA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return AD(tA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&oT(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,o=t.password,c=t.host,d=t.port,h=t.path,m=t.query,y=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=s+(o?":"+o:"")+"@"),v+=sT(c),d!==null&&(v+=":"+d)):r=="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+rT(h,"/"):"",m!==null&&(v+="?"+m),y!==null&&(v+="#"+y),v},setHref:function(t){var r=this.parse(t);if(r)throw OD(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new Ov(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+sT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(nf(t)+":",LD)},getUsername:function(){return this.username},setUsername:function(t){var r=Iv(nf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=jm(r[s],xD)}},getPassword:function(){return this.password},setPassword:function(t){var r=Iv(nf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=jm(r[s],xD)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?sT(t):sT(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,VD)},getHostname:function(){var t=this.host;return t===null?"":sT(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,FD)},getPort:function(){var t=this.port;return t===null?"":nf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=nf(t))==""?this.port=null:this.parse(t,jD))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+rT(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Pv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=nf(t))==""?this.query=null:(ku(t,0)=="?"&&(t=iT(t,1)),this.query="",this.parse(t,x_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=nf(t))!=""?(ku(t,0)=="#"&&(t=iT(t,1)),this.fragment="",this.parse(t,rf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ov=function(t){var r=Dle(this,Cc),s=Ule(arguments.length,1)>1?arguments[1]:void 0,o=Vle(r,new WD(t,!1,s));RD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},Cc=Ov.prototype,Nu=function(t,r){return{get:function(){return JI(this)[t]()},set:r&&function(s){return JI(this)[r](s)},configurable:!0,enumerable:!0}};if(RD&&(Ou(Cc,"href",Nu("serialize","setHref")),Ou(Cc,"origin",Nu("getOrigin")),Ou(Cc,"protocol",Nu("getProtocol","setProtocol")),Ou(Cc,"username",Nu("getUsername","setUsername")),Ou(Cc,"password",Nu("getPassword","setPassword")),Ou(Cc,"host",Nu("getHost","setHost")),Ou(Cc,"hostname",Nu("getHostname","setHostname")),Ou(Cc,"port",Nu("getPort","setPort")),Ou(Cc,"pathname",Nu("getPathname","setPathname")),Ou(Cc,"search",Nu("getSearch","setSearch")),Ou(Cc,"searchParams",Nu("getSearchParams")),Ou(Cc,"hash",Nu("getHash","setHash"))),XI(Cc,"toJSON",function(){return JI(this).serialize()},{enumerable:!0}),XI(Cc,"toString",function(){return JI(this).serialize()},{enumerable:!0}),nT){var v5=nT.createObjectURL,S5=nT.revokeObjectURL;v5&&XI(Ov,"createObjectURL",r5(v5,nT)),S5&&XI(Ov,"revokeObjectURL",r5(S5,nT))}Mle(Ov,"URL"),kle({global:!0,forced:!Nle,sham:!RD},{URL:Ov});var rue=Gn,iue=u,sue=Vl,b5=Wa,oue=dD,T5=tn("URL");rue({target:"URL",stat:!0,forced:!(oue&&iue(function(){T5.canParse()}))},{canParse:function(t){var r=sue(arguments.length,1),s=b5(t),o=r<2||arguments[1]===void 0?void 0:b5(arguments[1]);try{return!!new T5(s,o)}catch{return!1}}});var iA=l(vt.URL);let w5=!0,C5=!0;function sA(t,r,s){const o=t.match(r);return o&&o.length>=s&&parseInt(o[s],10)}function L_(t,r,s){if(!t.RTCPeerConnection)return;const o=t.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const y=v=>{const S=s(v);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,y),c.apply(this,[h,y])};const d=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(m))return d.apply(this,arguments);const y=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,y])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function aue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(w5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function cue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(C5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function R5(){if(typeof window=="object"){if(w5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function GD(t,r){C5&&console.warn(t+" is deprecated, please use "+r+" instead.")}function I5(t){return Object.prototype.toString.call(t)==="[object Object]"}function A5(t){var r;return I5(t)?Ec(r=Object.keys(t)).call(r,function(s,o){const c=I5(t[o]),d=c?A5(t[o]):t[o],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[o]:d})},{}):t}function HD(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?HD(t,t.get(r[o]),s):o.endsWith("Ids")&&r[o].forEach(c=>{HD(t,t.get(c),s)})}))}function P5(t,r,s){const o=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&d.push(h)}),d.forEach(h=>{t.forEach(m=>{m.type===o&&m.trackId===h.id&&HD(t,m,c)})}),c}const O5=R5;function k5(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const v=typeof h[y]=="object"?h[y]:{ideal:h[y]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(v.ideal!==void 0){m.optional=m.optional||[];let R={};typeof v.ideal=="number"?(R[S("min",y)]=v.ideal,m.optional.push(R),R={},R[S("max",y)]=v.ideal,m.optional.push(R)):(R[S("",y)]=v.ideal,m.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",y)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,y)]=v[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const y=function(v,S,R){S in v&&!(R in v)&&(v[R]=v[S],delete v[S])};y((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),y(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let y=h.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const v=r.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||v)){let S;if(delete h.video.facingMode,y.exact==="environment"||y.ideal==="environment"?S=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(S=["front"]),S)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(D=>D.kind==="videoinput")).find(D=>S.some(G=>{var j;return ot(j=D.label.toLowerCase()).call(j,G)}));return!P&&R.length&&ot(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=y.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),O5("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return O5("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,y){c(h,v=>{s.webkitGetUserMedia(v,m,S=>{y&&y(d(S))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,y=>h(y).then(v=>{if(y.audio&&!v.getAudioTracks().length||y.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return v},v=>ht.reject(d(v))))}}}function N5(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function D5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const d=new Event("track");d.track=o.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const d=new Event("track");d.track=o,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else L_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function x5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let y=c.apply(this,arguments);return y||(y=r(this,h),this._senders.push(y)),y};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(m=>m.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function L5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const d=function(m){const y={};return m.result().forEach(v=>{const S={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{S[R]=v.stat(R)}),y[S.id]=S}),y},h=function(m){return new Map(Object.keys(m).map(y=>[y,m[y]]))};if(arguments.length>=2){const m=function(y){o(h(d(y)))};return r.apply(this,[m,s])}return new ht((m,y)=>{r.apply(this,[function(v){m(h(d(v)))},y])}).then(o,c)}}function M5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c});const o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>P5(d,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=s.apply(this,[]);return o.forEach(c=>c._pc=this),o}),L_(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>P5(c,o.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let o,c,d;return this.getSenders().forEach(h=>{h.track===s&&(o?d=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?d=!0:c=h),h.track===s)),d||o&&c?ht.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():ht.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function U5(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(y=>{if(this.getSenders().find(S=>S.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(y=>h.indexOf(y)===-1);this._shimmedLocalStreams[d.id]=[d].concat(m)};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],o.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function V5(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return U5(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(v=>this._reverseStreams[v.id])};const o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const v=new t.MediaStream(y.getTracks());this._streams[y.id]=v,this._reverseStreams[v.id]=y,y=v}o.apply(this,[y])};const c=t.RTCPeerConnection.prototype.removeStream;function d(y,v){let S=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],D=y._streams[P.id];S=S.replace(new RegExp(D.id,"g"),P.id)}),new RTCSessionDescription({type:v.type,sdp:S})}t.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},t.RTCPeerConnection.prototype.addTrack=function(y,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(D=>D===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(y),ht.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new t.MediaStream([y]);this._streams[v.id]=D,this._reverseStreams[D.id]=v,this.addStream(D)}return this.getSenders().find(D=>D.track===y)},["createOffer","createAnswer"].forEach(function(y){const v=t.RTCPeerConnection.prototype[y],S={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[P=>{const D=d(this,P);R[0].apply(null,[D])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):v.apply(this,arguments).then(P=>d(this,P))}};t.RTCPeerConnection.prototype[y]=S[y]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,v){let S=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],D=y._streams[P.id];S=S.replace(new RegExp(P.id,"g"),D.id)}),new RTCSessionDescription({type:v.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const y=m.get.apply(this);return y.type===""?y:d(this,y)}}),t.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>y.track===R)&&(v=this._streams[S])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $D(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function F5(t,r){L_(t,"negotiationneeded",s=>{const o=s.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return s})}var j5=Object.freeze({__proto__:null,fixNegotiationNeeded:F5,shimAddTrackRemoveTrack:V5,shimAddTrackRemoveTrackWithNative:U5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(o=>{const c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:x5,shimGetStats:L5,shimGetUserMedia:k5,shimMediaStream:N5,shimOnTrack:D5,shimPeerConnection:$D,shimSenderReceiverGetStats:M5});function B5(t,r){const s=t&&t.navigator,o=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){GD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,y){m in h&&!(y in h)&&(h[y]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function z5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function KD(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!d)try{m.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;m.forEach((v,S)=>{m.set(S,Object.assign({},v,{type:s[v.type]||v.type}))})}return m}).then(d,h)}}function W5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ht.resolve(new Map)}}function G5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s}),L_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function H5(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){GD("removeStream","removeTrack"),this.getSenders().forEach(s=>{var o;s.track&&ot(o=r.getTracks()).call(o,s.track)&&this.removeTrack(s)})})}function $5(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function K5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const o=s.length>0;o&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function q5(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function Y5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ht.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function X5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ht.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var J5=Object.freeze({__proto__:null,shimAddTransceiver:K5,shimCreateAnswer:X5,shimCreateOffer:Y5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ht.reject(o)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:q5,shimGetUserMedia:B5,shimOnTrack:z5,shimPeerConnection:KD,shimRTCDataChannel:$5,shimReceiverGetStats:G5,shimRemoveStream:H5,shimSenderGetStats:W5});function Q5(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var o;this._localStreams||(this._localStreams=[]),ot(o=this._localStreams).call(o,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var o=arguments.length,c=new Array(o>1?o-1:0),d=1;d<o;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var m;this._localStreams?ot(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const o=r.getTracks();this.getSenders().forEach(c=>{ot(o).call(o,c.track)&&this.removeTrack(c)})})}}function Z5(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),ot(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,s.dispatchEvent(d)})}),r.apply(s,arguments)}}}function eB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(y,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[S]);return v?(R.then(y,v),ht.resolve()):R},r.createAnswer=function(y,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return v?(R.then(y,v),ht.resolve()):R};let m=function(y,v,S){const R=c.apply(this,[y]);return S?(R.then(v,S),ht.resolve()):R};r.setLocalDescription=m,m=function(y,v,S){const R=d.apply(this,[y]);return S?(R.then(v,S),ht.resolve()):R},r.setRemoteDescription=m,m=function(y,v,S){const R=h.apply(this,[y]);return S?(R.then(v,S),ht.resolve()):R},r.addIceCandidate=m}function tB(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,o=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>o(nB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,o,c){r.mediaDevices.getUserMedia(s).then(o,c)}).bind(r))}function nB(t){return t&&t.video!==void 0?Object.assign({},t,{video:A5(t.video)}):t}function rB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,o){if(s&&s.iceServers){const c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(GD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new r(s,o)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function iB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function sB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const o=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function oB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var aB=Object.freeze({__proto__:null,shimAudioContext:oB,shimCallbacksAPI:eB,shimConstraints:nB,shimCreateOfferLegacy:sB,shimGetUserMedia:tB,shimLocalStreamsAPI:Q5,shimRTCIceServerUrls:rB,shimRemoteStreamsAPI:Z5,shimTrackEventTransceiver:iB}),cB=`	
\v\f\r \u2028\u2029\uFEFF`,lue=Mt,uue=Wa,qD=cB,lB=I("".replace),due=RegExp("^["+qD+"]+"),hue=RegExp("(^|[^"+qD+"])["+qD+"]+$"),pue=function(t){return function(r){var s=uue(lue(r));return 1&t&&(s=lB(s,due,"")),2&t&&(s=lB(s,hue,"$1")),s}},fue={trim:pue(3)},mue=hI.PROPER,gue=u,uB=cB,_ue=fue.trim;Gn({target:"String",proto:!0,forced:function(t){return gue(function(){return!!uB[t]()||""[t]()!==""||mue&&uB[t].name!==t})}("trim")},{trim:function(){return _ue(this)}});var yue=yc("String").trim,Eue=O,vue=yue,YD=String.prototype,Sue=function(t){var r=t.trim;return typeof t=="string"||t===YD||Eue(YD,t)&&r===YD.trim?vue:r},vo=l(Sue),dB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(s){return s.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(s){const o=r.splitSections(s);return o&&o[0]},r.getMediaSections=function(s){const o=r.splitSections(s);return o.shift(),o},r.matchPrefix=function(s,o){return r.splitLines(s).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(s){let o;o=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let d=8;d<o.length;d+=2)switch(o[d]){case"raddr":c.relatedAddress=o[d+1];break;case"rport":c.relatedPort=parseInt(o[d+1],10);break;case"tcptype":c.tcpType=o[d+1];break;case"ufrag":c.ufrag=o[d+1],c.usernameFragment=o[d+1];break;default:c[o[d]]===void 0&&(c[o[d]]=o[d+1])}return c},r.writeCandidate=function(s){const o=[];o.push(s.foundation);const c=s.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);const d=s.type;return o.push("typ"),o.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let o=s.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let o=s.payloadType;s.preferredPayloadType!==void 0&&(o=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const o=s.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const o={};let c;const d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(s){let o="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),o+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return o},r.parseRtcpFb=function(s){const o=s.substring(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(s){let o="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{o+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(s){const o=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,o),10)},d=s.indexOf(":",o);return d>-1?(c.attribute=s.substring(o+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(o+1),c},r.parseSsrcGroup=function(s){const o=s.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(s){const o=r.matchPrefix(s,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(s){const o=s.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:r.matchPrefix(s+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,o){let c="a=setup:"+o+`\r
`;return s.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},r.parseCryptoLine=function(s){const o=s.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const o=s.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,o){return r.matchPrefix(s+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,o){const c=r.matchPrefix(s+o,"a=ice-ufrag:")[0],d=r.matchPrefix(s+o,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(s){let o="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(s){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],y=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(y){const v=r.parseRtpMap(y),S=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(v.parameters=S.length?r.parseFmtp(S[0]):{},v.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const d=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{d.forEach(m=>{h.rtcpFeedback.find(y=>y.type===m.type&&y.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(s,o){let c="";c+="m="+s+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let d=0;return o.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const o=[],c=r.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),y=m.length>0&&m[0].ssrc;let v;const S=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(D=>parseInt(D,10)));S.length>0&&S[0].length>1&&S[0][0]===y&&(v=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let D={ssrc:y,codecPayloadType:parseInt(P.parameters.apt,10)};y&&v&&(D.rtx={ssrc:v}),o.push(D),d&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:y,mechanism:h?"red+ulpfec":"red"},o.push(D))}}),o.length===0&&y&&o.push({ssrc:y});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(s){const o={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const d=r.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=d.length>0,o.compound=d.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(s){let o="";return s.reducedSize&&(o+=`a=rtcp-rsize\r
`),s.mux&&(o+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(o+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),o},r.parseMsid=function(s){let o;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const d=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(o=d[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(s){const o=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:d};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const y=m[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:d}}},r.writeSctpDescription=function(s,o){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,o,c){let d;const h=o!==void 0?o:2;return d=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,o){const c=r.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const o=r.splitLines(s)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(s){const o=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const o=r.splitLines(s);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(dB);var hB=dB.exports,kv=l(hB),bue=i({__proto__:null,default:kv},[hB]);function oA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const o=new r(s),c=kv.parseCandidate(s.candidate),d=Object.assign(o,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,L_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function XD(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||L_(t,"icecandidate",r=>{if(r.candidate){const s=kv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function aA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const y=kv.splitSections(m.sdp);return y.shift(),y.some(v=>{const S=kv.parseMLine(v);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const y=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const v=parseInt(y[1],10);return v!=v?-1:v},c=function(m){let y=65536;return r.browser==="firefox"&&(y=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),y},d=function(m,y){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const S=kv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?v=parseInt(S[0].substr(19),10):r.browser==="firefox"&&y!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=o(arguments[0]),y=c(m),v=d(arguments[0],m);let S;S=y===0&&v===0?Number.POSITIVE_INFINITY:y===0||v===0?Math.max(y,v):Math.min(y,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function cA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(o,c){const d=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(o,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=s.apply(this,arguments);return r(o,this),o},L_(t,"datachannel",o=>(r(o.channel,o.target),o))}function JD(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const o=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function QD(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(d=>vo(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&o instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return s.apply(this,arguments)}}function lA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ht.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ht.resolve())})}function uA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return s.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?s.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var Tue=Object.freeze({__proto__:null,removeExtmapAllowMixed:QD,shimAddIceCandidateNullOrEmpty:lA,shimConnectionState:JD,shimMaxMessageSize:aA,shimParameterlessSetLocalDescription:uA,shimRTCIceCandidate:oA,shimRTCIceCandidateRelayProtocol:XD,shimSendThrowTypeError:cA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=R5,o=function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:m}=d;if(m.mozGetUserMedia)h.browser="firefox",h.version=sA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=sA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=sA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:o,commonShim:Tue,extractVersion:sA,disableLog:aue,disableWarnings:cue,sdp:bue};switch(o.browser){case"chrome":if(!j5||!$D||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(o.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=j5,lA(t,o),uA(t),k5(t,o),N5(t),$D(t,o),D5(t),V5(t,o),x5(t),L5(t),M5(t),F5(t,o),oA(t),XD(t),JD(t),aA(t,o),cA(t),QD(t,o);break;case"firefox":if(!J5||!KD||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=J5,lA(t,o),uA(t),B5(t,o),KD(t,o),z5(t),H5(t),W5(t),G5(t),$5(t),K5(t),q5(t),Y5(t),X5(t),oA(t),JD(t),aA(t,o),cA(t);break;case"safari":if(!aB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=aB,lA(t,o),uA(t),rB(t),sB(t),eB(t),Q5(t),Z5(t),iB(t),tB(t),oB(t),oA(t),XD(t),aA(t,o),cA(t),QD(t,o);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var pB=Va,wue=TypeError,fB=wt.match(/firefox\/(\d+)/i),Cue=!!fB&&+fB[1],Rue=/MSIE|Trident/.test(wt),mB=wt.match(/AppleWebKit\/(\d+)\./),Iue=!!mB&&+mB[1],Aue=Gn,gB=I,Pue=os,Oue=xi,_B=gi,kue=function(t,r){if(!delete t[r])throw wue("Cannot delete property "+pB(r)+" of "+pB(t))},yB=Wa,ZD=u,Nue=A3,Due=xp,EB=Cue,xue=Rue,vB=cr,SB=Iue,Bm=[],bB=gB(Bm.sort),Lue=gB(Bm.push),Mue=ZD(function(){Bm.sort(void 0)}),Uue=ZD(function(){Bm.sort(null)}),Vue=Due("sort"),TB=!ZD(function(){if(vB)return vB<70;if(!(EB&&EB>3)){if(xue)return!0;if(SB)return SB<603;var t,r,s,o,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(o=0;o<47;o++)Bm.push({k:r+o,v:s})}for(Bm.sort(function(d,h){return h.v-d.v}),o=0;o<Bm.length;o++)r=Bm[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Aue({target:"Array",proto:!0,forced:Mue||!Uue||!Vue||!TB},{sort:function(t){t!==void 0&&Pue(t);var r=Oue(this);if(TB)return t===void 0?bB(r):bB(r,t);var s,o,c=[],d=_B(r);for(o=0;o<d;o++)o in r&&Lue(c,r[o]);for(Nue(c,function(h){return function(m,y){return y===void 0?-1:m===void 0?1:h!==void 0?+h(m,y)||0:yB(m)>yB(y)?1:-1}}(t)),s=_B(c),o=0;o<s;)r[o]=c[o++];for(;o<d;)kue(r,o++);return r}});var Fue=yc("Array").sort,jue=O,Bue=Fue,ex=Array.prototype,zue=function(t){var r=t.sort;return t===ex||jue(ex,t)&&r===ex.sort?Bue:r},aT=l(zue),tx=M;Gn({global:!0,forced:tx.globalThis!==tx},{globalThis:tx});var wB=l(M),nx={exports:{}};(function(t,r){(function(s,o){var c="function",d="undefined",h="object",m="string",y="major",v="model",S="name",R="type",P="vendor",D="version",G="architecture",j="console",B="mobile",J="tablet",ee="smarttv",fe="wearable",ye="embedded",ve="Amazon",_e="Apple",Ne="ASUS",Je="BlackBerry",pt="Browser",_t="Chrome",Rn="Firefox",In="Google",yr="Huawei",di="LG",Zr="Microsoft",Aa="Motorola",We="Opera",st="Samsung",It="Sharp",Ke="Sony",U="Xiaomi",ce="Zebra",me="Facebook",et="Chromium OS",Qt="Mac OS",dr=function(Ni){for(var Zi={},Dr=0;Dr<Ni.length;Dr++)Zi[Ni[Dr].toUpperCase()]=Ni[Dr];return Zi},Qi=function(Ni,Zi){return typeof Ni===m&&nc(Zi).indexOf(nc(Ni))!==-1},nc=function(Ni){return Ni.toLowerCase()},Sf=function(Ni,Zi){if(typeof Ni===m)return Ni=Ni.replace(/^\s\s*/,""),typeof Zi===d?Ni:Ni.substring(0,350)},hy=function(Ni,Zi){for(var Dr,Ac,Jh,hi,Kn,rc,lg=0;lg<Zi.length&&!Kn;){var Wd=Zi[lg],J7=Zi[lg+1];for(Dr=Ac=0;Dr<Wd.length&&!Kn&&Wd[Dr];)if(Kn=Wd[Dr++].exec(Ni))for(Jh=0;Jh<J7.length;Jh++)rc=Kn[++Ac],typeof(hi=J7[Jh])===h&&hi.length>0?hi.length===2?typeof hi[1]==c?this[hi[0]]=hi[1].call(this,rc):this[hi[0]]=hi[1]:hi.length===3?typeof hi[1]!==c||hi[1].exec&&hi[1].test?this[hi[0]]=rc?rc.replace(hi[1],hi[2]):o:this[hi[0]]=rc?hi[1].call(this,rc,hi[2]):o:hi.length===4&&(this[hi[0]]=rc?hi[3].call(this,rc.replace(hi[1],hi[2])):o):this[hi]=rc||o;lg+=2}},uw=function(Ni,Zi){for(var Dr in Zi)if(typeof Zi[Dr]===h&&Zi[Dr].length>0){for(var Ac=0;Ac<Zi[Dr].length;Ac++)if(Qi(Zi[Dr][Ac],Ni))return Dr==="?"?o:Dr}else if(Qi(Zi[Dr],Ni))return Dr==="?"?o:Dr;return Ni},aO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},cO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,D],[/opios[\/ ]+([\w\.]+)/i],[D,[S,We+" Mini"]],[/\bopr\/([\w\.]+)/i],[D,[S,We]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,D],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[S,"UC"+pt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[D,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[D,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[D,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+pt],D],[/\bfocus\/([\w\.]+)/i],[D,[S,Rn+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[S,We+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[S,We+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[S,"MIUI "+pt]],[/fxios\/([-\w\.]+)/i],[D,[S,Rn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+pt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+pt],D],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,D],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,me],D],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[S,_t+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,_t+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[S,"Android "+pt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[D,uw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[S,Rn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,D],[/(cobalt)\/([\w\.]+)/i],[S,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,nc]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",nc]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,nc]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[P,st],[R,J]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[P,st],[R,B]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[P,_e],[R,B]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[P,_e],[R,J]],[/(macintosh);/i],[v,[P,_e]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[P,It],[R,B]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[P,yr],[R,J]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[P,yr],[R,B]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[P,U],[R,B]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[P,U],[R,J]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[P,"OPPO"],[R,B]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[P,"Vivo"],[R,B]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[P,"Realme"],[R,B]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[P,Aa],[R,B]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[P,Aa],[R,J]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[P,di],[R,J]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[P,di],[R,B]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[P,"Lenovo"],[R,J]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[P,"Nokia"],[R,B]],[/(pixel c)\b/i],[v,[P,In],[R,J]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[P,In],[R,B]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[P,Ke],[R,B]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[P,Ke],[R,J]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[P,"OnePlus"],[R,B]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[P,ve],[R,J]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[P,ve],[R,B]],[/(playbook);[-\w\),; ]+(rim)/i],[v,P,[R,J]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[P,Je],[R,B]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[P,Ne],[R,J]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[P,Ne],[R,B]],[/(nexus 9)/i],[v,[P,"HTC"],[R,J]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[v,/_/g," "],[R,B]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[P,"Acer"],[R,J]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[P,"Meizu"],[R,B]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,v,[R,B]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,v,[R,J]],[/(surface duo)/i],[v,[P,Zr],[R,J]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[P,"Fairphone"],[R,B]],[/(u304aa)/i],[v,[P,"AT&T"],[R,B]],[/\bsie-(\w*)/i],[v,[P,"Siemens"],[R,B]],[/\b(rct\w+) b/i],[v,[P,"RCA"],[R,J]],[/\b(venue[\d ]{2,7}) b/i],[v,[P,"Dell"],[R,J]],[/\b(q(?:mv|ta)\w+) b/i],[v,[P,"Verizon"],[R,J]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[P,"Barnes & Noble"],[R,J]],[/\b(tm\d{3}\w+) b/i],[v,[P,"NuVision"],[R,J]],[/\b(k88) b/i],[v,[P,"ZTE"],[R,J]],[/\b(nx\d{3}j) b/i],[v,[P,"ZTE"],[R,B]],[/\b(gen\d{3}) b.+49h/i],[v,[P,"Swiss"],[R,B]],[/\b(zur\d{3}) b/i],[v,[P,"Swiss"],[R,J]],[/\b((zeki)?tb.*\b) b/i],[v,[P,"Zeki"],[R,J]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],v,[R,J]],[/\b(ns-?\w{0,9}) b/i],[v,[P,"Insignia"],[R,J]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[P,"NextBook"],[R,J]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],v,[R,B]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],v,[R,B]],[/\b(ph-1) /i],[v,[P,"Essential"],[R,B]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[P,"Envizen"],[R,J]],[/\b(trio[-\w\. ]+) b/i],[v,[P,"MachSpeed"],[R,J]],[/\btu_(1491) b/i],[v,[P,"Rotor"],[R,J]],[/(shield[\w ]+) b/i],[v,[P,"Nvidia"],[R,J]],[/(sprint) (\w+)/i],[P,v,[R,B]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[P,Zr],[R,B]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[P,ce],[R,J]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[P,ce],[R,B]],[/smart-tv.+(samsung)/i],[P,[R,ee]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[P,st],[R,ee]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,di],[R,ee]],[/(apple) ?tv/i],[P,[v,_e+" TV"],[R,ee]],[/crkey/i],[[v,_t+"cast"],[P,In],[R,ee]],[/droid.+aft(\w)( bui|\))/i],[v,[P,ve],[R,ee]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[P,It],[R,ee]],[/(bravia[\w ]+)( bui|\))/i],[v,[P,Ke],[R,ee]],[/(mitv-\w{5}) bui/i],[v,[P,U],[R,ee]],[/Hbbtv.*(technisat) (.*);/i],[P,v,[R,ee]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,Sf],[v,Sf],[R,ee]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,ee]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,v,[R,j]],[/droid.+; (shield) bui/i],[v,[P,"Nvidia"],[R,j]],[/(playstation [345portablevi]+)/i],[v,[P,Ke],[R,j]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[P,Zr],[R,j]],[/((pebble))app/i],[P,v,[R,fe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[P,_e],[R,fe]],[/droid.+; (glass) \d/i],[v,[P,In],[R,fe]],[/droid.+; (wt63?0{2,3})\)/i],[v,[P,ce],[R,fe]],[/(quest( 2| pro)?)/i],[v,[P,me],[R,fe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,ye]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[R,B]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,J]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,J]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,B]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,D],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[D,uw,aO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[D,uw,aO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Qt],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,D],[/\(bb(10);/i],[D,[S,Je]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[S,Rn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[S,_t+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,et],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,D],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,D]]},Xl=function(Ni,Zi){if(typeof Ni===h&&(Zi=Ni,Ni=o),!(this instanceof Xl))return new Xl(Ni,Zi).getResult();var Dr=typeof s!==d&&s.navigator?s.navigator:o,Ac=Ni||(Dr&&Dr.userAgent?Dr.userAgent:""),Jh=Dr&&Dr.userAgentData?Dr.userAgentData:o,hi=Zi?function(Kn,rc){var lg={};for(var Wd in Kn)rc[Wd]&&rc[Wd].length%2==0?lg[Wd]=rc[Wd].concat(Kn[Wd]):lg[Wd]=Kn[Wd];return lg}(cO,Zi):cO;return this.getBrowser=function(){var Kn={};return Kn[S]=o,Kn[D]=o,hy.call(Kn,Ac,hi.browser),Kn[y]=function(rc){return typeof rc===m?rc.replace(/[^\d\.]/g,"").split(".")[0]:o}(Kn[D]),Dr&&Dr.brave&&typeof Dr.brave.isBrave==c&&(Kn[S]="Brave"),Kn},this.getCPU=function(){var Kn={};return Kn[G]=o,hy.call(Kn,Ac,hi.cpu),Kn},this.getDevice=function(){var Kn={};return Kn[P]=o,Kn[v]=o,Kn[R]=o,hy.call(Kn,Ac,hi.device),!Kn[R]&&Jh&&Jh.mobile&&(Kn[R]=B),Kn[v]=="Macintosh"&&Dr&&typeof Dr.standalone!==d&&Dr.maxTouchPoints&&Dr.maxTouchPoints>2&&(Kn[v]="iPad",Kn[R]=J),Kn},this.getEngine=function(){var Kn={};return Kn[S]=o,Kn[D]=o,hy.call(Kn,Ac,hi.engine),Kn},this.getOS=function(){var Kn={};return Kn[S]=o,Kn[D]=o,hy.call(Kn,Ac,hi.os),!Kn[S]&&Jh&&Jh.platform!="Unknown"&&(Kn[S]=Jh.platform.replace(/chrome os/i,et).replace(/macos/i,Qt)),Kn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ac},this.setUA=function(Kn){return Ac=typeof Kn===m&&Kn.length>350?Sf(Kn,350):Kn,this},this.setUA(Ac),this};Xl.VERSION="0.7.34",Xl.BROWSER=dr([S,D,y]),Xl.CPU=dr([G]),Xl.DEVICE=dr([v,P,R,j,B,ee,J,fe,ye]),Xl.ENGINE=Xl.OS=dr([S,D]),t.exports&&(r=t.exports=Xl),r.UAParser=Xl;var cg=typeof s!==d&&(s.jQuery||s.Zepto);if(cg&&!cg.ua){var py=new Xl;cg.ua=py.getResult(),cg.ua.get=function(){return py.getUA()},cg.ua.set=function(Ni){py.setUA(Ni);var Zi=py.getResult();for(var Dr in Zi)cg.ua[Dr]=Zi[Dr]}}})(typeof window=="object"?window:a)})(nx,nx.exports);var Wue=l(nx.exports),Gue=Gc,Hue=Ri,$ue=ut,Kue=Eh,que=Tr("iterator"),Yue=Object,Xue=function(t){if($ue(t))return!1;var r=Yue(t);return r[que]!==void 0||"@@iterator"in r||Hue(Kue,Gue(r))},Jue=l(Xue),CB=av.clear;Gn({global:!0,bind:!0,forced:M.clearImmediate!==CB},{clearImmediate:CB});var Que=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",RB=M,Zue=ne,ede=ke,tde=Que,nde=wt,rde=ks,ide=Vl,sde=RB.Function,ode=/MSIE .\./.test(nde)||tde&&function(){var t=RB.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),ade=Gn,IB=M,AB=av.set,cde=function(t,r){var s=1;return ode?function(o,c){var d=ide(arguments.length,1)>s,h=ede(o)?o:sde(o),m=d?rde(arguments,s):[],y=d?function(){Zue(h,this,m)}:h;return t(y)}:t},PB=IB.setImmediate?cde(AB):AB;ade({global:!0,bind:!0,forced:IB.setImmediate!==PB},{setImmediate:PB});var OB=l(vt.setImmediate),lde=Gn,ude=Tc,dde=os,hde=Vl,pde=Lp,fde=M.process;lde({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){hde(arguments.length,1),dde(t);var r=pde&&fde.domain;ude(r?r.bind(t):t)}});var kB=l(vt.queueMicrotask);function NB(t,r){return function(){return t.apply(r,arguments)}}const{toString:mde}=Object.prototype,{getPrototypeOf:rx}=Object,dA=(ix=Object.create(null),t=>{const r=mde.call(t);return ix[r]||(ix[r]=r.slice(8,-1).toLowerCase())});var ix;const Od=t=>(t=t.toLowerCase(),r=>dA(r)===t),hA=t=>r=>typeof r===t,{isArray:Nv}=Array,cT=hA("undefined"),DB=Od("ArrayBuffer"),gde=hA("string"),jl=hA("function"),xB=hA("number"),pA=t=>t!==null&&typeof t=="object",fA=t=>{if(dA(t)!=="object")return!1;const r=rx(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||Jue(t))},_de=Od("Date"),yde=Od("File"),Ede=Od("Blob"),vde=Od("FileList"),Sde=Od("URLSearchParams"),[bde,Tde,wde,Cde]=["ReadableStream","Request","Response","Headers"].map(Od);function lT(t,r){let s,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Nv(t))for(s=0,o=t.length;s<o;s++)r.call(null,t[s],s,t);else{const d=c?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let m;for(s=0;s<h;s++)m=d[s],r.call(null,t[m],m,t)}}function LB(t,r){r=r.toLowerCase();const s=Object.keys(t);let o,c=s.length;for(;c-- >0;)if(o=s[c],r===o.toLowerCase())return o;return null}const M_=wB!==void 0?wB:typeof self<"u"?self:typeof window<"u"?window:Sy,MB=t=>!cT(t)&&t!==M_,Rde=(sx=typeof Uint8Array<"u"&&rx(Uint8Array),t=>sx&&t instanceof sx);var sx;const Ide=Od("HTMLFormElement"),UB=(t=>{let{hasOwnProperty:r}=t;return(s,o)=>r.call(s,o)})(Object.prototype),Ade=Od("RegExp"),VB=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),o={};lT(s,(c,d)=>{let h;(h=r(c,d,t))!==!1&&(o[d]=h||c)}),Object.defineProperties(t,o)},ox="abcdefghijklmnopqrstuvwxyz",FB="0123456789",jB={DIGIT:FB,ALPHA:ox,ALPHA_DIGIT:ox+ox.toUpperCase()+FB},Pde=Od("AsyncFunction"),BB=(zB=typeof OB=="function",WB=jl(M_.postMessage),zB?OB:WB?(ax="axios@".concat(Math.random()),mA=[],M_.addEventListener("message",t=>{let{source:r,data:s}=t;r===M_&&s===ax&&mA.length&&mA.shift()()},!1),t=>{mA.push(t),M_.postMessage(ax,"*")}):t=>setTimeout(t));var zB,WB,ax,mA;const Ode=kB!==void 0?kB.bind(M_):typeof process<"u"&&process.nextTick||BB;var dt={isArray:Nv,isArrayBuffer:DB,isBuffer:function(t){return t!==null&&!cT(t)&&t.constructor!==null&&!cT(t.constructor)&&jl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||jl(t.append)&&((r=dA(t))==="formdata"||r==="object"&&jl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&DB(t.buffer),r},isString:gde,isNumber:xB,isBoolean:t=>t===!0||t===!1,isObject:pA,isPlainObject:fA,isReadableStream:bde,isRequest:Tde,isResponse:wde,isHeaders:Cde,isUndefined:cT,isDate:_de,isFile:yde,isBlob:Ede,isRegExp:Ade,isFunction:jl,isStream:t=>pA(t)&&jl(t.pipe),isURLSearchParams:Sde,isTypedArray:Rde,isFileList:vde,forEach:lT,merge:function t(){const{caseless:r}=MB(this)&&this||{},s={},o=(c,d)=>{const h=r&&LB(s,d)||d;fA(s[h])&&fA(c)?s[h]=t(s[h],c):fA(c)?s[h]=t({},c):Nv(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&lT(arguments[c],o);return s},extend:function(t,r,s){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return lT(r,(c,d)=>{s&&jl(c)?t[d]=NB(c,s):t[d]=c},{allOwnKeys:o}),t},trim:t=>vo(t)?vo(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,o)=>{t.prototype=Object.create(r.prototype,o),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,o)=>{let c,d,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)h=c[d],o&&!o(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&rx(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:dA,kindOfTest:Od,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const o=t.indexOf(r,s);return o!==-1&&o===s},toArray:t=>{if(!t)return null;if(Nv(t))return t;let r=t.length;if(!xB(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let o;for(;(o=s.next())&&!o.done;){const c=o.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const o=[];for(;(s=t.exec(r))!==null;)o.push(s);return o},isHTMLForm:Ide,hasOwnProperty:UB,hasOwnProp:UB,reduceDescriptors:VB,freezeMethods:t=>{VB(t,(r,s)=>{if(jl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=t[s];jl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},o=c=>{c.forEach(d=>{s[d]=!0})};return Nv(t)?o(t):o(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,o){return s.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:LB,global:M_,isContextDefined:MB,ALPHABET:jB,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jB.ALPHA_DIGIT,s="";const{length:o}=r;for(;t--;)s+=r[Math.random()*o|0];return s},isSpecCompliantForm:function(t){return!!(t&&jl(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(o,c)=>{if(pA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const d=Nv(o)?[]:{};return lT(o,(h,m)=>{const y=s(h,c+1);!cT(y)&&(d[m]=y)}),r[c]=void 0,d}}return o};return s(t,0)},isAsyncFn:Pde,isThenable:t=>t&&(pA(t)||jl(t))&&jl(t.then)&&jl(t.catch),setImmediate:BB,asap:Ode};function lr(t,r,s,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}dt.inherits(lr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:dt.toJSONObject(this.config),code:this.code,status:this.status}}});const GB=lr.prototype,HB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{HB[t]={value:t}}),Object.defineProperties(lr,HB),Object.defineProperty(GB,"isAxiosError",{value:!0}),lr.from=(t,r,s,o,c,d)=>{const h=Object.create(GB);return dt.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),lr.call(h,t.message,r,s,o,c),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function cx(t){return dt.isPlainObject(t)||dt.isArray(t)}function $B(t){return dt.endsWith(t,"[]")?t.slice(0,-2):t}function KB(t,r,s){return t?t.concat(r).map(function(o,c){return o=$B(o),!s&&c?"["+o+"]":o}).join(s?".":""):r}const kde=dt.toFlatObject(dt,{},null,function(t){return/^is[A-Z]/.test(t)});function gA(t,r,s){if(!dt.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const o=(s=dt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,D){return!dt.isUndefined(D[P])})).metaTokens,c=s.visitor||v,d=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&dt.isSpecCompliantForm(r);if(!dt.isFunction(c))throw new TypeError("visitor must be a function");function y(P){if(P===null)return"";if(dt.isDate(P))return P.toISOString();if(!m&&dt.isBlob(P))throw new lr("Blob is not supported. Use a Buffer instead.");return dt.isArrayBuffer(P)||dt.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function v(P,D,G){let j=P;if(P&&!G&&typeof P=="object"){if(dt.endsWith(D,"{}"))D=o?D:D.slice(0,-2),P=JSON.stringify(P);else if(dt.isArray(P)&&function(B){return dt.isArray(B)&&!B.some(cx)}(P)||(dt.isFileList(P)||dt.endsWith(D,"[]"))&&(j=dt.toArray(P)))return D=$B(D),j.forEach(function(B,J){!dt.isUndefined(B)&&B!==null&&r.append(h===!0?KB([D],J,d):h===null?D:D+"[]",y(B))}),!1}return!!cx(P)||(r.append(KB(G,D,d),y(P)),!1)}const S=[],R=Object.assign(kde,{defaultVisitor:v,convertValue:y,isVisitable:cx});if(!dt.isObject(t))throw new TypeError("data must be an object");return function P(D,G){if(!dt.isUndefined(D)){if(S.indexOf(D)!==-1)throw Error("Circular reference detected in "+G.join("."));S.push(D),dt.forEach(D,function(j,B){(!(dt.isUndefined(j)||j===null)&&c.call(r,j,dt.isString(B)?vo(B).call(B):B,G,R))===!0&&P(j,G?G.concat(B):[B])}),S.pop()}}(t),r}function qB(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function lx(t,r){this._pairs=[],t&&gA(t,this,r)}const YB=lx.prototype;function Nde(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function XB(t,r,s){if(!r)return t;const o=s&&s.encode||Nde;dt.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(d=c?c(r,s):dt.isURLSearchParams(r)?r.toString():new lx(r,s).toString(o),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}YB.append=function(t,r){this._pairs.push([t,r])},YB.toString=function(t){const r=t?function(s){return t.call(this,s,qB)}:qB;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var JB=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){dt.forEach(this.handlers,function(r){r!==null&&t(r)})}},QB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ZB={exports:{}},Dde=Gn,xde=Fe,e6=rt.f;Dde({target:"Object",stat:!0,forced:Object.defineProperty!==e6,sham:!xde},{defineProperty:e6});var t6=vt.Object,Lde=ZB.exports=function(t,r,s){return t6.defineProperty(t,r,s)};t6.defineProperty.sham&&(Lde.sham=!0);var n6=l(ZB.exports),Mde=TypeError,r6=e_,Ude=T_,Vde=Et,Fde=Tr("species"),i6=Array,jde=function(t){var r;return r6(t)&&(r=t.constructor,(Ude(r)&&(r===i6||r6(r.prototype))||Vde(r)&&(r=r[Fde])===null)&&(r=void 0)),r===void 0?i6:r},s6=function(t,r){return new(jde(t))(r===0?0:r)},Bde=u,zde=cr,Wde=Tr("species"),o6=function(t){return zde>=51||!Bde(function(){var r=[];return(r.constructor={})[Wde]=function(){return{foo:1}},r[t](Boolean).foo!==1})},Gde=Gn,Hde=u,$de=e_,Kde=Et,qde=xi,Yde=gi,a6=function(t){if(t>9007199254740991)throw Mde("Maximum allowed index exceeded");return t},c6=$I,Xde=s6,Jde=o6,Qde=cr,l6=Tr("isConcatSpreadable"),Zde=Qde>=51||!Hde(function(){var t=[];return t[l6]=!1,t.concat()[0]!==t}),ehe=function(t){if(!Kde(t))return!1;var r=t[l6];return r!==void 0?!!r:$de(t)};Gde({target:"Array",proto:!0,forced:!Zde||!Jde("concat")},{concat:function(t){var r,s,o,c,d,h=qde(this),m=Xde(h,0),y=0;for(r=-1,o=arguments.length;r<o;r++)if(ehe(d=r===-1?h:arguments[r]))for(c=Yde(d),a6(y+c),s=0;s<c;s++,y++)s in d&&c6(m,y,d[s]);else a6(y+1),c6(m,y++,d);return m.length=y,m}});var u6={},the=Y,nhe=Te,d6=gh.f,rhe=hD,h6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];u6.f=function(t){return h6&&the(t)=="Window"?function(r){try{return d6(r)}catch{return rhe(h6)}}(t):d6(nhe(t))};var Dv={},ihe=Tr;Dv.f=ihe;var p6=vt,she=Ri,ohe=Dv,ahe=rt.f,xs=function(t){var r=p6.Symbol||(p6.Symbol={});she(r,t)||ahe(r,t,{value:ohe.f(t)})},che=Se,lhe=tn,uhe=Tr,dhe=bd,f6=function(){var t=lhe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,o=uhe("toPrimitive");r&&!r[o]&&dhe(r,o,function(c){return che(s,this)},{})},hhe=De,phe=sn,fhe=xi,mhe=gi,ghe=s6,m6=I([].push),_he=function(t){var r=t==1,s=t==2,o=t==3,c=t==4,d=t==6,h=t==7,m=t==5||d;return function(y,v,S,R){for(var P,D,G=fhe(y),j=phe(G),B=hhe(v,S),J=mhe(j),ee=0,fe=R||ghe,ye=r?fe(y,J):s||h?fe(y,0):void 0;J>ee;ee++)if((m||ee in j)&&(D=B(P=j[ee],ee,G),t))if(r)ye[ee]=D;else if(D)switch(t){case 3:return!0;case 5:return P;case 6:return ee;case 2:m6(ye,P)}else switch(t){case 4:return!1;case 7:m6(ye,P)}return d?-1:o||c?c:ye}},g6={forEach:_he(0)},_A=Gn,ux=M,dx=Se,yhe=I,xv=Fe,Lv=io,Ehe=u,qo=Ri,vhe=O,hx=gn,yA=Te,px=gc,She=Wa,fx=He,uT=_a,_6=Kc,bhe=gh,y6=u6,The=$c,E6=xe,v6=rt,whe=vE,S6=Be,b6=bd,Che=$E,mx=sa,T6=Hc,w6=lh,Rhe=Tr,Ihe=Dv,Ahe=xs,Phe=f6,Ohe=Td,C6=Sd,EA=g6.forEach,nl=n_("hidden"),vA="Symbol",dT="prototype",khe=C6.set,R6=C6.getterFor(vA),kd=Object[dT],U_=ux.Symbol,SA=U_&&U_[dT],Nhe=ux.TypeError,gx=ux.QObject,I6=E6.f,V_=v6.f,A6=y6.f,Dhe=S6.f,P6=yhe([].push),sf=mx("symbols"),hT=mx("op-symbols"),xhe=mx("wks"),_x=!gx||!gx[dT]||!gx[dT].findChild,yx=xv&&Ehe(function(){return uT(V_({},"a",{get:function(){return V_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var o=I6(kd,r);o&&delete kd[r],V_(t,r,s),o&&t!==kd&&V_(kd,r,o)}:V_,Ex=function(t,r){var s=sf[t]=uT(SA);return khe(s,{type:vA,tag:t,description:r}),xv||(s.description=r),s},bA=function(t,r,s){t===kd&&bA(hT,r,s),hx(t);var o=px(r);return hx(s),qo(sf,o)?(s.enumerable?(qo(t,nl)&&t[nl][o]&&(t[nl][o]=!1),s=uT(s,{enumerable:fx(0,!1)})):(qo(t,nl)||V_(t,nl,fx(1,{})),t[nl][o]=!0),yx(t,o,s)):V_(t,o,s)},vx=function(t,r){hx(t);var s=yA(r),o=_6(s).concat(D6(s));return EA(o,function(c){xv&&!dx(O6,s,c)||bA(t,c,s[c])}),t},O6=function(t){var r=px(t),s=dx(Dhe,this,r);return!(this===kd&&qo(sf,r)&&!qo(hT,r))&&(!(s||!qo(this,r)||!qo(sf,r)||qo(this,nl)&&this[nl][r])||s)},k6=function(t,r){var s=yA(t),o=px(r);if(s!==kd||!qo(sf,o)||qo(hT,o)){var c=I6(s,o);return!c||!qo(sf,o)||qo(s,nl)&&s[nl][o]||(c.enumerable=!0),c}},N6=function(t){var r=A6(yA(t)),s=[];return EA(r,function(o){qo(sf,o)||qo(T6,o)||P6(s,o)}),s},D6=function(t){var r=t===kd,s=A6(r?hT:yA(t)),o=[];return EA(s,function(c){!qo(sf,c)||r&&!qo(kd,c)||P6(o,sf[c])}),o};Lv||(U_=function(){if(vhe(SA,this))throw Nhe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?She(arguments[0]):void 0,r=w6(t),s=function(o){this===kd&&dx(s,hT,o),qo(this,nl)&&qo(this[nl],r)&&(this[nl][r]=!1),yx(this,r,fx(1,o))};return xv&&_x&&yx(kd,r,{configurable:!0,set:s}),Ex(r,t)},b6(SA=U_[dT],"toString",function(){return R6(this).tag}),b6(U_,"withoutSetter",function(t){return Ex(w6(t),t)}),S6.f=O6,v6.f=bA,whe.f=vx,E6.f=k6,bhe.f=y6.f=N6,The.f=D6,Ihe.f=function(t){return Ex(Rhe(t),t)},xv&&Che(SA,"description",{configurable:!0,get:function(){return R6(this).description}})),_A({global:!0,wrap:!0,forced:!Lv,sham:!Lv},{Symbol:U_}),EA(_6(xhe),function(t){Ahe(t)}),_A({target:vA,stat:!0,forced:!Lv},{useSetter:function(){_x=!0},useSimple:function(){_x=!1}}),_A({target:"Object",stat:!0,forced:!Lv,sham:!xv},{create:function(t,r){return r===void 0?uT(t):vx(uT(t),r)},defineProperty:bA,defineProperties:vx,getOwnPropertyDescriptor:k6}),_A({target:"Object",stat:!0,forced:!Lv},{getOwnPropertyNames:N6}),Phe(),Ohe(U_,vA),T6[nl]=!0;var x6=io&&!!Symbol.for&&!!Symbol.keyFor,Lhe=Gn,Mhe=tn,Uhe=Ri,Vhe=Wa,L6=sa,Fhe=x6,Sx=L6("string-to-symbol-registry"),jhe=L6("symbol-to-string-registry");Lhe({target:"Symbol",stat:!0,forced:!Fhe},{for:function(t){var r=Vhe(t);if(Uhe(Sx,r))return Sx[r];var s=Mhe("Symbol")(r);return Sx[r]=s,jhe[s]=r,s}});var Bhe=Gn,zhe=Ri,Whe=hc,Ghe=Va,Hhe=x6,M6=sa("symbol-to-string-registry");Bhe({target:"Symbol",stat:!0,forced:!Hhe},{keyFor:function(t){if(!Whe(t))throw TypeError(Ghe(t)+" is not a symbol");if(zhe(M6,t))return M6[t]}});var U6=e_,$he=ke,V6=Y,Khe=Wa,F6=I([].push),qhe=Gn,j6=tn,B6=ne,Yhe=Se,pT=I,z6=u,W6=ke,G6=hc,H6=ks,Xhe=function(t){if($he(t))return t;if(U6(t)){for(var r=t.length,s=[],o=0;o<r;o++){var c=t[o];typeof c=="string"?F6(s,c):typeof c!="number"&&V6(c)!="Number"&&V6(c)!="String"||F6(s,Khe(c))}var d=s.length,h=!0;return function(m,y){if(h)return h=!1,y;if(U6(this))return y;for(var v=0;v<d;v++)if(s[v]===m)return y}}},Jhe=io,Qhe=String,zm=j6("JSON","stringify"),TA=pT(/./.exec),$6=pT("".charAt),Zhe=pT("".charCodeAt),epe=pT("".replace),tpe=pT(1 .toString),npe=/[\uD800-\uDFFF]/g,K6=/^[\uD800-\uDBFF]$/,q6=/^[\uDC00-\uDFFF]$/,Y6=!Jhe||z6(function(){var t=j6("Symbol")();return zm([t])!="[null]"||zm({a:t})!="{}"||zm(Object(t))!="{}"}),X6=z6(function(){return zm("\uDF06\uD834")!=='"\\udf06\\ud834"'||zm("\uDEAD")!=='"\\udead"'}),rpe=function(t,r){var s=H6(arguments),o=Xhe(r);if(W6(o)||t!==void 0&&!G6(t))return s[1]=function(c,d){if(W6(o)&&(d=Yhe(o,this,Qhe(c),d)),!G6(d))return d},B6(zm,null,s)},ipe=function(t,r,s){var o=$6(s,r-1),c=$6(s,r+1);return TA(K6,t)&&!TA(q6,c)||TA(q6,t)&&!TA(K6,o)?"\\u"+tpe(Zhe(t,0),16):t};zm&&qhe({target:"JSON",stat:!0,forced:Y6||X6},{stringify:function(t,r,s){var o=H6(arguments),c=B6(Y6?rpe:zm,null,o);return X6&&typeof c=="string"?epe(c,npe,ipe):c}});var J6=$c,spe=xi;Gn({target:"Object",stat:!0,forced:!io||u(function(){J6.f(1)})},{getOwnPropertySymbols:function(t){var r=J6.f;return r?r(spe(t)):[]}}),xs("asyncIterator"),xs("hasInstance"),xs("isConcatSpreadable"),xs("iterator"),xs("match"),xs("matchAll"),xs("replace"),xs("search"),xs("species"),xs("split");var ope=f6;xs("toPrimitive"),ope();var ape=tn,cpe=Td;xs("toStringTag"),cpe(ape("Symbol"),"Symbol"),xs("unscopables"),Td(M.JSON,"JSON",!0);var lpe=vt.Symbol,upe=Tr,dpe=rt.f,Q6=upe("metadata"),Z6=Function.prototype;Z6[Q6]===void 0&&dpe(Z6,Q6,{value:null}),xs("dispose"),xs("metadata");var hpe=lpe;xs("asyncDispose");var ppe=I,bx=tn("Symbol"),fpe=bx.keyFor,mpe=ppe(bx.prototype.valueOf),ez=bx.isRegisteredSymbol||function(t){try{return fpe(mpe(t))!==void 0}catch{return!1}};Gn({target:"Symbol",stat:!0},{isRegisteredSymbol:ez});for(var gpe=sa,tz=tn,_pe=I,ype=hc,Epe=Tr,wA=tz("Symbol"),nz=wA.isWellKnownSymbol,rz=tz("Object","getOwnPropertyNames"),vpe=_pe(wA.prototype.valueOf),iz=gpe("wks"),Tx=0,sz=rz(wA),Spe=sz.length;Tx<Spe;Tx++)try{var oz=sz[Tx];ype(wA[oz])&&Epe(oz)}catch{}var az=function(t){if(nz&&nz(t))return!0;try{for(var r=vpe(t),s=0,o=rz(iz),c=o.length;s<c;s++)if(iz[o[s]]==r)return!0}catch{}return!1};Gn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:az}),xs("matcher"),xs("observable"),Gn({target:"Symbol",stat:!0},{isRegistered:ez}),Gn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:az}),xs("metadataKey"),xs("patternMatch"),xs("replaceAll");var Mv=l(hpe),cz=l(Dv.f("iterator"));function fT(t){return fT=typeof Mv=="function"&&typeof cz=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Mv=="function"&&r.constructor===Mv&&r!==Mv.prototype?"symbol":typeof r},fT(t)}var bpe=l(Dv.f("toPrimitive"));function Tpe(t){var r=function(s,o){if(fT(s)!=="object"||s===null)return s;var c=s[bpe];if(c!==void 0){var d=c.call(s,o);if(fT(d)!=="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(t,"string");return fT(r)==="symbol"?r:String(r)}function q(t,r,s){return(r=Tpe(r))in t?n6(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var lz=l(rle),wpe={isBrowser:!0,classes:{URLSearchParams:lz!==void 0?lz:lx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const wx=typeof window<"u"&&typeof document<"u",Cx=typeof navigator=="object"&&navigator||void 0,Cpe=wx&&(!Cx||["ReactNative","NativeScript","NS"].indexOf(Cx.product)<0),Rpe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ipe=wx&&window.location.href||"http://localhost";function uz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function dz(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?uz(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):uz(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var Ja=dz(dz({},Object.freeze({__proto__:null,hasBrowserEnv:wx,hasStandardBrowserEnv:Cpe,hasStandardBrowserWebWorkerEnv:Rpe,navigator:Cx,origin:Ipe})),wpe),Ape=gn,Ppe=Se,Ope=Ri,kpe=O,Npe=function(){var t=Ape(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},hz=RegExp.prototype,pz=function(t){var r=t.flags;return r!==void 0||"flags"in hz||Ope(t,"flags")||!kpe(hz,t)?r:Ppe(Npe,t)},Dpe=aD.charAt,fz=Se,xpe=gn,Lpe=ke,Mpe=Y,Upe=/./.exec,Vpe=TypeError,Fpe=Gn,mz=Se,gz=ie,jpe=VE,CA=WE,_z=Mt,yz=Gt,mT=Wa,Bpe=gn,zpe=ut,Wpe=Y,Gpe=RR,Ez=pz,Hpe=Fa,$pe=u,Kpe=ls,qpe=function(t,r,s){return r+(s?Dpe(t,r).length:1)},Ype=function(t,r){var s=t.exec;if(Lpe(s)){var o=fz(s,t,r);return o!==null&&xpe(o),o}if(Mpe(t)==="RegExp")return fz(Upe,t,r);throw Vpe("RegExp#exec called on incompatible receiver")},vz=Sd,Xpe=Tr("matchAll"),Sz="RegExp String",bz=Sz+" Iterator",Jpe=vz.set,Qpe=vz.getterFor(bz),Zpe=TypeError,Rx=gz("".indexOf),RA=gz("".matchAll),Ix=!!RA&&!$pe(function(){RA("a",/./)}),efe=jpe(function(t,r,s,o){Jpe(this,{type:bz,regexp:t,string:r,global:s,unicode:o,done:!1})},Sz,function(){var t=Qpe(this);if(t.done)return CA(void 0,!0);var r=t.regexp,s=t.string,o=Ype(r,s);return o===null?(t.done=!0,CA(void 0,!0)):t.global?(mT(o[0])===""&&(r.lastIndex=qpe(s,yz(r.lastIndex),t.unicode)),CA(o,!1)):(t.done=!0,CA(o,!1))}),Tz=function(t){var r,s,o,c=Bpe(this),d=mT(t),h=Kpe(c,RegExp),m=mT(Ez(c));return r=new h(h===RegExp?c.source:c,m),s=!!~Rx(m,"g"),o=!!~Rx(m,"u"),r.lastIndex=yz(c.lastIndex),new efe(r,d,s,o)};Fpe({target:"String",proto:!0,forced:Ix},{matchAll:function(t){var r,s,o,c,d=_z(this);if(zpe(t)){if(Ix)return RA(d,t)}else{if(Gpe(t)&&(r=mT(_z(Ez(t))),!~Rx(r,"g")))throw Zpe("`.matchAll` does not allow non-global regexes");if(Ix)return RA(d,t);if((o=Hpe(t,Xpe))===void 0&&Wpe(t)=="RegExp"&&(o=Tz),o)return mz(o,t,d)}return s=mT(d),c=new RegExp(t,"g"),mz(Tz,c,s)}});var tfe=yc("String").matchAll,nfe=O,rfe=tfe,Ax=String.prototype,ife=function(t){var r=t.matchAll;return typeof t=="string"||t===Ax||nfe(Ax,t)&&r===Ax.matchAll?rfe:r},sfe=l(ife);function wz(t){function r(s,o,c,d){let h=s[d++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),y=d>=s.length;return h=!h&&dt.isArray(c)?c.length:h,y?(dt.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&dt.isObject(c[h])||(c[h]=[]),r(s,o,c[h],d)&&dt.isArray(c[h])&&(c[h]=function(v){const S={},R=Object.keys(v);let P;const D=R.length;let G;for(P=0;P<D;P++)G=R[P],S[G]=v[G];return S}(c[h])),!m)}if(dt.isFormData(t)&&dt.isFunction(t.entries)){const s={};return dt.forEachEntry(t,(o,c)=>{r(function(d){return sfe(dt).call(dt,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,s,0)}),s}return null}const Px={transitional:QB,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",o=s.indexOf("application/json")>-1,c=dt.isObject(t);if(c&&dt.isHTMLForm(t)&&(t=new FormData(t)),dt.isFormData(t))return o?JSON.stringify(wz(t)):t;if(dt.isArrayBuffer(t)||dt.isBuffer(t)||dt.isStream(t)||dt.isFile(t)||dt.isBlob(t)||dt.isReadableStream(t))return t;if(dt.isArrayBufferView(t))return t.buffer;if(dt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return gA(h,new Ja.classes.URLSearchParams,Object.assign({visitor:function(y,v,S,R){return Ja.isNode&&dt.isBuffer(y)?(this.append(v,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((d=dt.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return gA(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,y){if(dt.isString(h))try{return(m||JSON.parse)(h),vo(dt).call(dt,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(y||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||Px.transitional,s=r&&r.forcedJSONParsing,o=this.responseType==="json";if(dt.isResponse(t)||dt.isReadableStream(t))return t;if(t&&dt.isString(t)&&(s&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(d){if(c)throw d.name==="SyntaxError"?lr.from(d,lr.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ja.classes.FormData,Blob:Ja.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};dt.forEach(["delete","get","head","post","put","patch"],t=>{Px.headers[t]={}});var Ox=Px;const ofe=dt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Cz=Symbol("internals");function gT(t){var r;return t&&vo(r=String(t)).call(r).toLowerCase()}function IA(t){return t===!1||t==null?t:dt.isArray(t)?t.map(IA):String(t)}function kx(t,r,s,o,c){return dt.isFunction(o)?o.call(this,r,s):(c&&(r=s),dt.isString(r)?dt.isString(o)?r.indexOf(o)!==-1:dt.isRegExp(o)?o.test(r):void 0:void 0)}class AA{constructor(r){r&&this.set(r)}set(r,s,o){const c=this;function d(y,v,S){const R=gT(v);if(!R)throw new Error("header name must be a non-empty string");const P=dt.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||v]=IA(y))}const h=(y,v)=>dt.forEach(y,(S,R)=>d(S,R,v));if(dt.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(dt.isString(r)&&(r=vo(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(vo(m=r).call(m)))h((y=>{const v={};let S,R,P;return y&&y.split(`
`).forEach(function(D){var G,j;P=D.indexOf(":"),S=vo(G=D.substring(0,P)).call(G).toLowerCase(),R=vo(j=D.substring(P+1)).call(j),!S||v[S]&&ofe[S]||(S==="set-cookie"?v[S]?v[S].push(R):v[S]=[R]:v[S]=v[S]?v[S]+", "+R:R)}),v})(r),s);else if(dt.isHeaders(r))for(const[y,v]of r.entries())d(v,y,o);else r!=null&&d(s,r,o);var m;return this}get(r,s){if(r=gT(r)){const o=dt.findKey(this,r);if(o){const c=this[o];if(!s)return c;if(s===!0)return function(d){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=m.exec(d);)h[y[1]]=y[2];return h}(c);if(dt.isFunction(s))return s.call(this,c,o);if(dt.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=gT(r)){const o=dt.findKey(this,r);return!(!o||this[o]===void 0||s&&!kx(0,this[o],o,s))}return!1}delete(r,s){const o=this;let c=!1;function d(h){if(h=gT(h)){const m=dt.findKey(o,h);!m||s&&!kx(0,o[m],m,s)||(delete o[m],c=!0)}}return dt.isArray(r)?r.forEach(d):d(r),c}clear(r){const s=Object.keys(this);let o=s.length,c=!1;for(;o--;){const d=s[o];r&&!kx(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const s=this,o={};return dt.forEach(this,(c,d)=>{var h;const m=dt.findKey(o,d);if(m)return s[m]=IA(c),void delete s[d];const y=r?function(v){return vo(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(d):vo(h=String(d)).call(h);y!==d&&delete s[d],s[y]=IA(c),o[y]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return dt.forEach(this,(o,c)=>{o!=null&&o!==!1&&(s[c]=r&&dt.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,o]=r;return s+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),d=1;d<o;d++)c[d-1]=arguments[d];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[Cz]=this[Cz]={accessors:{}}).accessors,o=this.prototype;function c(d){const h=gT(d);s[h]||(function(m,y){const v=dt.toCamelCase(" "+y);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+v,{value:function(R,P,D){return this[S].call(this,y,R,P,D)},configurable:!0})})}(o,d),s[h]=!0)}return dt.isArray(r)?r.forEach(c):c(r),this}}AA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),dt.reduceDescriptors(AA.prototype,(t,r)=>{let{value:s}=t,o=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[o]=c}}}),dt.freezeMethods(AA);var Nd=AA;function Nx(t,r){const s=this||Ox,o=r||s,c=Nd.from(o.headers);let d=o.data;return dt.forEach(t,function(h){d=h.call(s,d,c.normalize(),r?r.status:void 0)}),c.normalize(),d}function Rz(t){return!(!t||!t.__CANCEL__)}function Uv(t,r,s){lr.call(this,t??"canceled",lr.ERR_CANCELED,r,s),this.name="CanceledError"}function Iz(t,r,s){const o=s.config.validateStatus;s.status&&o&&!o(s.status)?r(new lr("Request failed with status code "+s.status,[lr.ERR_BAD_REQUEST,lr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}dt.inherits(Uv,lr,{__CANCEL__:!0});const PA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(d,h){d=d||10;const m=new Array(d),y=new Array(d);let v,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const D=Date.now(),G=y[R];v||(v=D),m[S]=P,y[S]=D;let j=R,B=0;for(;j!==S;)B+=m[j++],j%=d;if(S=(S+1)%d,S===R&&(R=(R+1)%d),D-v<h)return;const J=G&&D-G;return J?Math.round(1e3*B/J):void 0}}(50,250);return function(d,h){let m,y,v=0,S=1e3/h;const R=function(P){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,y&&(clearTimeout(y),y=null),d.apply(null,P)};return[function(){const P=Date.now(),D=P-v;for(var G=arguments.length,j=new Array(G),B=0;B<G;B++)j[B]=arguments[B];D>=S?R(j,P):(m=j,y||(y=setTimeout(()=>{y=null,R(m)},S-D)))},()=>m&&R(m)]}(d=>{const h=d.loaded,m=d.lengthComputable?d.total:void 0,y=h-o,v=c(y);o=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:y,rate:v||void 0,estimated:v&&m&&h<=m?(m-h)/v:void 0,event:d,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},Az=(t,r)=>{const s=t!=null;return[o=>r[0]({lengthComputable:s,total:t,loaded:o}),r[1]]},Pz=t=>function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return dt.asap(()=>t(...s))};var afe=Ja.hasStandardBrowserEnv?((t,r)=>s=>(s=new iA(s,Ja.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new iA(Ja.origin),Ja.navigator&&/(msie|trident)/i.test(Ja.navigator.userAgent)):()=>!0,cfe=Ja.hasStandardBrowserEnv?{write(t,r,s,o,c,d){const h=[t+"="+encodeURIComponent(r)];dt.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),dt.isString(o)&&h.push("path="+o),dt.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Oz(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,o){return o?s.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):s}(t,r):r}function kz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const Nz=t=>t instanceof Nd?function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?kz(Object(o),!0).forEach(function(c){q(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):kz(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t):t;function F_(t,r){r=r||{};const s={};function o(v,S,R,P){return dt.isPlainObject(v)&&dt.isPlainObject(S)?dt.merge.call({caseless:P},v,S):dt.isPlainObject(S)?dt.merge({},S):dt.isArray(S)?S.slice():S}function c(v,S,R,P){return dt.isUndefined(S)?dt.isUndefined(v)?void 0:o(void 0,v,0,P):o(v,S,0,P)}function d(v,S){if(!dt.isUndefined(S))return o(void 0,S)}function h(v,S){return dt.isUndefined(S)?dt.isUndefined(v)?void 0:o(void 0,v):o(void 0,S)}function m(v,S,R){return R in r?o(v,S):R in t?o(void 0,v):void 0}const y={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(v,S,R)=>c(Nz(v),Nz(S),0,!0)};return dt.forEach(Object.keys(Object.assign({},t,r)),function(v){const S=y[v]||c,R=S(t[v],r[v],v);dt.isUndefined(R)&&S!==m||(s[v]=R)}),s}var Dz=t=>{const r=F_({},t);let s,{data:o,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:m,auth:y}=r;if(r.headers=m=Nd.from(m),r.url=XB(Oz(r.baseURL,r.url),t.params,t.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),dt.isFormData(o)){if(Ja.hasStandardBrowserEnv||Ja.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[v,...S]=s?s.split(";").map(R=>vo(R).call(R)).filter(Boolean):[];m.setContentType([v||"multipart/form-data",...S].join("; "))}}if(Ja.hasStandardBrowserEnv&&(c&&dt.isFunction(c)&&(c=c(r)),c||c!==!1&&afe(r.url))){const v=d&&h&&cfe.read(h);v&&m.set(d,v)}return r},lfe=typeof XMLHttpRequest<"u"&&function(t){return new ht(function(r,s){const o=Dz(t);let c=o.data;const d=Nd.from(o.headers).normalize();let h,m,y,v,S,{responseType:R,onUploadProgress:P,onDownloadProgress:D}=o;function G(){v&&v(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let j=new XMLHttpRequest;function B(){if(!j)return;const ee=Nd.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders());Iz(function(fe){r(fe),G()},function(fe){s(fe),G()},{data:R&&R!=="text"&&R!=="json"?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:ee,config:t,request:j}),j=null}j.open(o.method.toUpperCase(),o.url,!0),j.timeout=o.timeout,"onloadend"in j?j.onloadend=B:j.onreadystatechange=function(){j&&j.readyState===4&&(j.status!==0||j.responseURL&&j.responseURL.indexOf("file:")===0)&&setTimeout(B)},j.onabort=function(){j&&(s(new lr("Request aborted",lr.ECONNABORTED,t,j)),j=null)},j.onerror=function(){s(new lr("Network Error",lr.ERR_NETWORK,t,j)),j=null},j.ontimeout=function(){let ee=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const fe=o.transitional||QB;o.timeoutErrorMessage&&(ee=o.timeoutErrorMessage),s(new lr(ee,fe.clarifyTimeoutError?lr.ETIMEDOUT:lr.ECONNABORTED,t,j)),j=null},c===void 0&&d.setContentType(null),"setRequestHeader"in j&&dt.forEach(d.toJSON(),function(ee,fe){j.setRequestHeader(fe,ee)}),dt.isUndefined(o.withCredentials)||(j.withCredentials=!!o.withCredentials),R&&R!=="json"&&(j.responseType=o.responseType),D&&([y,S]=PA(D,!0),j.addEventListener("progress",y)),P&&j.upload&&([m,v]=PA(P),j.upload.addEventListener("progress",m),j.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(h=ee=>{j&&(s(!ee||ee.type?new Uv(null,t,j):ee),j.abort(),j=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const J=function(ee){const fe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ee);return fe&&fe[1]||""}(o.url);J&&Ja.protocols.indexOf(J)===-1?s(new lr("Unsupported protocol "+J+":",lr.ERR_BAD_REQUEST,t)):j.send(c||null)})},ufe=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let o,c=new AbortController;const d=function(v){if(!o){o=!0,m();const S=v instanceof Error?v:this.reason;c.abort(S instanceof lr?S:new Uv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,d(new lr("timeout ".concat(r," of ms exceeded"),lr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(d):v.removeEventListener("abort",d)}),t=null)};t.forEach(v=>v.addEventListener("abort",d));const{signal:y}=c;return y.unsubscribe=()=>dt.asap(m),y}},dfe=C3,hfe=Fl;Gn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=hfe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var pfe=Fl,ffe=Ih;Gn({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=pfe.f(this),s=ffe(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var Dx=l(dfe),xz=Dv.f("asyncIterator"),mfe=l(xz);function xx(t,r){this.v=t,this.k=r}function _T(t){var r,s;function o(d,h){try{var m=t[d](h),y=m.value,v=y instanceof xx;Dx.resolve(v?y.v:y).then(function(S){if(v){var R=d==="return"?"return":"next";if(!y.k||S.done)return o(R,S);S=t[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):s=null}this._invoke=function(d,h){return new Dx(function(m,y){var v={key:d,arg:h,resolve:m,reject:y,next:null};s?s=s.next=v:(r=s=v,o(d,h))})},typeof t.return!="function"&&(this.return=void 0)}function Bl(t){return function(){return new _T(t.apply(this,arguments))}}function Dn(t){return new xx(t,0)}function OA(t){var r={},s=!1;function o(c,d){return s=!0,{done:!1,value:new xx(d=new Dx(function(h){h(t[c](d))}),1)}}return r[Mv!==void 0&&cz||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):o("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return o("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):o("return",c)}),r}_T.prototype[typeof Mv=="function"&&mfe||"@@asyncIterator"]=function(){return this},_T.prototype.next=function(t){return this._invoke("next",t)},_T.prototype.throw=function(t){return this._invoke("throw",t)},_T.prototype.return=function(t){return this._invoke("return",t)};var Lx=l(xz);function Mx(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=Lx,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new kA(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function kA(t){function r(s){if(Object(s)!==s)return ht.reject(new TypeError(s+" is not an object."));var o=s.done;return ht.resolve(s.value).then(function(c){return{value:c,done:o}})}return kA=function(s){this.s=s,this.n=s.next},kA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?ht.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?ht.reject(s):r(o.apply(this.s,arguments))}},new kA(t)}const gfe=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let o,c=0;for(;c<s;)o=c+r,yield t.slice(c,o),c=o},_fe=function(){var t=Bl(function*(r,s){var o,c=!1,d=!1;try{for(var h,m=Mx(yfe(r));c=!(h=yield Dn(m.next())).done;c=!1){const y=h.value;yield*OA(Mx(gfe(y,s)))}}catch(y){d=!0,o=y}finally{try{c&&m.return!=null&&(yield Dn(m.return()))}finally{if(d)throw o}}});return function(r,s){return t.apply(this,arguments)}}(),yfe=function(){var t=Bl(function*(r){if(r[Lx])return void(yield*OA(Mx(r)));const s=r.getReader();try{for(;;){const{done:o,value:c}=yield Dn(s.read());if(o)break;yield c}}finally{yield Dn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),Lz=(t,r,s,o)=>{const c=_fe(t,r);let d,h=0,m=y=>{d||(d=!0,o&&o(y))};return new ReadableStream({async pull(y){try{const{done:v,value:S}=await c.next();if(v)return m(),void y.close();let R=S.byteLength;if(s){let P=h+=R;s(P)}y.enqueue(new Uint8Array(S))}catch(v){throw m(v),v}},cancel:y=>(m(y),c.return())},{highWaterMark:2})};function Mz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Uz(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Mz(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Mz(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const NA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Vz=NA&&typeof ReadableStream=="function",Efe=NA&&(typeof TextEncoder=="function"?(Fz=new TextEncoder,t=>Fz.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var Fz;const jz=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return!!t(...s)}catch{return!1}},vfe=Vz&&jz(()=>{let t=!1;const r=new Request(Ja.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),Ux=Vz&&jz(()=>dt.isReadableStream(new Response("").body)),DA={stream:Ux&&(t=>t.body)};var Bz;NA&&(Bz=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!DA[t]&&(DA[t]=dt.isFunction(Bz[t])?r=>r[t]():(r,s)=>{throw new lr("Response type '".concat(t,"' is not supported"),lr.ERR_NOT_SUPPORT,s)})}));const Sfe=async(t,r)=>{const s=dt.toFiniteNumber(t.getContentLength());return s??(async o=>o==null?0:dt.isBlob(o)?o.size:dt.isSpecCompliantForm(o)?(await new Request(Ja.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:dt.isArrayBufferView(o)||dt.isArrayBuffer(o)?o.byteLength:(dt.isURLSearchParams(o)&&(o+=""),dt.isString(o)?(await Efe(o)).byteLength:void 0))(r)};var bfe=NA&&(async t=>{let{url:r,method:s,data:o,signal:c,cancelToken:d,timeout:h,onDownloadProgress:m,onUploadProgress:y,responseType:v,headers:S,withCredentials:R="same-origin",fetchOptions:P}=Dz(t);v=v?(v+"").toLowerCase():"text";let D,G=ufe([c,d&&d.toAbortSignal()],h);const j=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let B;try{if(y&&vfe&&s!=="get"&&s!=="head"&&(B=await Sfe(S,o))!==0){let ve,_e=new Request(r,{method:"POST",body:o,duplex:"half"});if(dt.isFormData(o)&&(ve=_e.headers.get("content-type"))&&S.setContentType(ve),_e.body){const[Ne,Je]=Az(B,PA(Pz(y)));o=Lz(_e.body,65536,Ne,Je)}}dt.isString(R)||(R=R?"include":"omit");const J="credentials"in Request.prototype;D=new Request(r,Uz(Uz({},P),{},{signal:G,method:s.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:J?R:void 0}));let ee=await fetch(D);const fe=Ux&&(v==="stream"||v==="response");if(Ux&&(m||fe&&j)){const ve={};["status","statusText","headers"].forEach(pt=>{ve[pt]=ee[pt]});const _e=dt.toFiniteNumber(ee.headers.get("content-length")),[Ne,Je]=m&&Az(_e,PA(Pz(m),!0))||[];ee=new Response(Lz(ee.body,65536,Ne,()=>{Je&&Je(),j&&j()}),ve)}v=v||"text";let ye=await DA[dt.findKey(DA,v)||"text"](ee,t);return!fe&&j&&j(),await new ht((ve,_e)=>{Iz(ve,_e,{data:ye,headers:Nd.from(ee.headers),status:ee.status,statusText:ee.statusText,config:t,request:D})})}catch(J){throw j&&j(),J&&J.name==="TypeError"&&/fetch/i.test(J.message)?Object.assign(new lr("Network Error",lr.ERR_NETWORK,t,D),{cause:J.cause||J}):lr.from(J,J&&J.code,t,D)}});const Vx={http:null,xhr:lfe,fetch:bfe};dt.forEach(Vx,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const zz=t=>"- ".concat(t),Tfe=t=>dt.isFunction(t)||t===null||t===!1;var Wz={getAdapter:t=>{t=dt.isArray(t)?t:[t];const{length:r}=t;let s,o;const c={};for(let d=0;d<r;d++){let h;if(s=t[d],o=s,!Tfe(s)&&(o=Vx[(h=String(s)).toLowerCase()],o===void 0))throw new lr("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+d]=o}if(!o){const d=Object.entries(c).map(h=>{let[m,y]=h;return"adapter ".concat(m," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new lr("There is no suitable adapter to dispatch the request "+(r?d.length>1?`since :
`+d.map(zz).join(`
`):" "+zz(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:Vx};function Fx(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Uv(null,t)}function Gz(t){return Fx(t),t.headers=Nd.from(t.headers),t.data=Nx.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Wz.getAdapter(t.adapter||Ox.adapter)(t).then(function(r){return Fx(t),r.data=Nx.call(t,t.transformResponse,r),r.headers=Nd.from(r.headers),r},function(r){return Rz(r)||(Fx(t),r&&r.response&&(r.response.data=Nx.call(t,t.transformResponse,r.response),r.response.headers=Nd.from(r.response.headers))),ht.reject(r)})}const Hz="1.7.9",xA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{xA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const $z={};xA.transitional=function(t,r,s){function o(c,d){return"[Axios v"+Hz+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(t===!1)throw new lr(o(d," has been removed"+(r?" in "+r:"")),lr.ERR_DEPRECATED);return r&&!$z[d]&&($z[d]=!0,console.warn(o(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,h)}},xA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var LA={assertOptions:function(t,r,s){if(typeof t!="object")throw new lr("options must be an object",lr.ERR_BAD_OPTION_VALUE);const o=Object.keys(t);let c=o.length;for(;c-- >0;){const d=o[c],h=r[d];if(h){const m=t[d],y=m===void 0||h(m,d,t);if(y!==!0)throw new lr("option "+d+" must be "+y,lr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new lr("Unknown option "+d,lr.ERR_BAD_OPTION)}},validators:xA};const Dh=LA.validators;let MA=class{constructor(t){this.defaults=t,this.interceptors={request:new JB,response:new JB}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=F_(this.defaults,r);const{transitional:s,paramsSerializer:o,headers:c}=r;s!==void 0&&LA.assertOptions(s,{silentJSONParsing:Dh.transitional(Dh.boolean),forcedJSONParsing:Dh.transitional(Dh.boolean),clarifyTimeoutError:Dh.transitional(Dh.boolean)},!1),o!=null&&(dt.isFunction(o)?r.paramsSerializer={serialize:o}:LA.assertOptions(o,{encode:Dh.function,serialize:Dh.function},!0)),LA.assertOptions(r,{baseUrl:Dh.spelling("baseURL"),withXsrfToken:Dh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&dt.merge(c.common,c[r.method]);c&&dt.forEach(["delete","get","head","post","put","patch","common"],D=>{delete c[D]}),r.headers=Nd.concat(d,c);const h=[];let m=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(r)===!1||(m=m&&D.synchronous,h.unshift(D.fulfilled,D.rejected))});const y=[];let v;this.interceptors.response.forEach(function(D){y.push(D.fulfilled,D.rejected)});let S,R=0;if(!m){const D=[Gz.bind(this),void 0];for(D.unshift.apply(D,h),D.push.apply(D,y),S=D.length,v=ht.resolve(r);R<S;)v=v.then(D[R++],D[R++]);return v}S=h.length;let P=r;for(R=0;R<S;){const D=h[R++],G=h[R++];try{P=D(P)}catch(j){G.call(this,j);break}}try{v=Gz.call(this,P)}catch(D){return ht.reject(D)}for(R=0,S=y.length;R<S;)v=v.then(y[R++],y[R++]);return v}getUri(t){return XB(Oz((t=F_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};dt.forEach(["delete","get","head","options"],function(t){MA.prototype[t]=function(r,s){return this.request(F_(s||{},{method:t,url:r,data:(s||{}).data}))}}),dt.forEach(["post","put","patch"],function(t){function r(s){return function(o,c,d){return this.request(F_(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}MA.prototype[t]=r(),MA.prototype[t+"Form"]=r(!0)});var UA=MA;class jx{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new ht(function(c){s=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let d=o._listeners.length;for(;d-- >0;)o._listeners[d](c);o._listeners=null}),this.promise.then=c=>{let d;const h=new ht(m=>{o.subscribe(m),d=m}).then(c);return h.cancel=function(){o.unsubscribe(d)},h},r(function(c,d,h){o.reason||(o.reason=new Uv(c,d,h),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=o=>{r.abort(o)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new jx(function(o){r=o}),cancel:r}}}var wfe=jx;const Bx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Bx).forEach(t=>{let[r,s]=t;Bx[s]=r});var Cfe=Bx;const ao=function t(r){const s=new UA(r),o=NB(UA.prototype.request,s);return dt.extend(o,UA.prototype,s,{allOwnKeys:!0}),dt.extend(o,s,null,{allOwnKeys:!0}),o.create=function(c){return t(F_(r,c))},o}(Ox);ao.Axios=UA,ao.CanceledError=Uv,ao.CancelToken=wfe,ao.isCancel=Rz,ao.VERSION=Hz,ao.toFormData=gA,ao.AxiosError=lr,ao.Cancel=ao.CanceledError,ao.all=function(t){return ht.all(t)},ao.spread=function(t){return function(r){return t.apply(null,r)}},ao.isAxiosError=function(t){return dt.isObject(t)&&t.isAxiosError===!0},ao.mergeConfig=F_,ao.AxiosHeaders=Nd,ao.formToJSON=t=>wz(dt.isHTMLForm(t)?new FormData(t):t),ao.getAdapter=Wz.getAdapter,ao.HttpStatusCode=Cfe,ao.default=ao;var ba=ao;const Rfe=()=>{};function yT(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Rfe};return t.promise=new ht((r,s)=>{t.resolve=o=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(o),t.value=o)},t.reject=o=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(o))}}),t}const VA=new Map,FA=new Map,xh=new Map;let Yi=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Hn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const Kz=new Wue;let Dd=Kz.getResult(),zx=null;function xn(t){if(!zx){Dd=Kz.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Hn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Hn.CHROME;case"Safari":case"Mobile Safari":return Hn.SAFARI;case"Edge":return Hn.EDGE;case"Firefox":return Hn.FIREFOX;case"QQ":case"QQBrowser":return Hn.QQ;case"Opera":return Hn.OPERA;case"WeChat":return Hn.WECHAT;default:return m.browser.name||""}}(Dd),s=qz(Dd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Dd),c=Dd.os.version,d=qz(Dd,!1),h=Dd.device.type;if(!(r&&s&&o&&c))return{name:r,version:s,os:o,osVersion:c,browserVersion:d,deviceType:h};zx={name:r,version:s,os:o,osVersion:c,browserVersion:d,deviceType:h}}return zx}function qz(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function jA(){return xn().os}function Yz(){const t=xn();return"".concat(t.os," ").concat(t.osVersion)}function BA(){const t=xn();return!!(Dd.engine.name==="WebKit"&&t.os===Yi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Hn.SAFARI||Yo()&&t.name!==Hn.SAFARI)}function of(){return xn().name===Hn.CHROME}function Ls(){return xn().name===Hn.SAFARI}function Xz(){return xn().name===Hn.EDGE}function $r(){return xn().name===Hn.FIREFOX}function Yo(){return xn().os===Yi.IOS}function ET(t){const r=xn();return!(r.name!==Hn.CHROME||!r.osVersion)&&Number(r.version)>=t}function Jz(t){const r=xn();return!(r.name!==Hn.CHROME||!r.osVersion)&&Number(r.version)<t}function Wx(t,r,s){const o=xn();return!(o.name!==t||!o.osVersion)&&(s?Number(o.version)>=r&&Number(o.version)<=s:Number(o.version)===r)}function Gx(t){const r=xn();return!(r.name!==Hn.EDGE||!r.osVersion)&&Number(r.version)>=t}function Qz(t){const r=xn();return!(r.name!==Hn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function Zz(t,r,s){const o=xn();if(o.os!==Yi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function eW(t,r,s){const o=xn();if(o.name!==Hn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function Hx(t){const r=xn();return!(r.name!==Hn.OPERA||!r.osVersion)&&Number(r.version)>=t}function tW(){const t=xn();if(t.os!==Yi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Vv(){const t=xn();if(t.os!==Yi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function $x(){const t=xn();if(t.os!==Yi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function nW(){const t=xn();if(t.os!==Yi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Du(){return Ls()&&navigator.maxTouchPoints>0}function rW(){return xn().name===Hn.WECHAT}function iW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Kx(){const t=jA();return function(){const{deviceType:r}=xn();return r==="mobile"||r==="tablet"}()||t===Yi.ANDROID||t===Yi.IOS||t===Yi.HARMONY_OS}function af(){const t=xn();return t.name!==Hn.EDGE&&t.name!==Hn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function zA(){return jA()===Yi.ANDROID}function vT(){const t=xn();return zA()&&(t.name===Hn.CHROME||t.name===Hn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function sW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function bt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?sW(Object(s),!0).forEach(function(o){Xt(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):sW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Xt(t,r,s){return(r=function(o){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let te=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Xt(this,"code",void 0),Xt(this,"message",void 0),Xt(this,"data",void 0),Xt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function cf(t,r){if(typeof t!="boolean")throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Wi(t,r,s){if(!ot(s).call(s,t))throw new Le(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function ur(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new Le(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(o,"]. integer only"))}function qx(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&ur(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&ur(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&ur(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&ur(t.ideal,"".concat(r,".ideal"),1,1/0)}else ur(t,r,1,1/0)}function ms(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!oW(t,s,o,c))throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function lf(t,r){if(!Array.isArray(t))throw new Le(te.INVALID_PARAMS,"".concat(r," should be an array"))}function Kr(t){return t==null}function oW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(t))}var ST=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(ST||{}),Yx=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(Yx||{});const aW=new class{constructor(){Xt(this,"_clientSize",null),Xt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Xt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Xt(this,"getStyle",t=>window.getComputedStyle(t,null)),Xt(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const o=this.getStyle(t),{display:c,visibility:d,opacity:h,filter:m}=o;return(c==="none"||ot(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(y=>{var v;const S=y.split("(")[0];return ot(v=["brightness","blur","opacity"]).call(v,S)}).map(y=>{const[v,S]=y.split(/\(|\)/);return[v,Number(S.match(/^[0-9\.]+/))]}).forEach(y=>{const[v,S]=y;switch(v){case"brightness":(S<.1||S>3)&&(s=!1);break;case"blur":S>3&&(s=!1);break;case"opacity":S<.1&&(s=!1)}}),s)}),Xt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,o=!0;const c=h=>r(h);let d=t;for(;d&&o;)c(d)||(s=!1,o=!1),d=d.parentElement,d||(o=!1);return s}),Xt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Xt(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:o,right:c,top:d,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),y=this.getClientHeight();return{width:r,height:s,left:o,right:c,top:d,bottom:h,clientWidth:m,clientHeight:y,clientMin:Math.min(m,y)}}),Xt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),Xt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),Xt(this,"checkCoverForAPoint",(t,r,s)=>{const o=this.elementFromPoint(t,r);return o!==null&&o!==s}),Xt(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:o}=this._clientSize,c=t/6,d=r/6,h=[],m=10**6;for(let y=0;y<5;y++)for(let v=0;v<5;v++){const S=(s*m+(y===0?.1:y===4?(c*y*m-1e5)/m:c*y)*m)/m,R=(o*m+(v===0?.1:v===4?(d*v*m-1e5)/m:d*v)*m)/m;h.push({x:S,y:R})}return[...h]}),Xt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),Xt(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),Xt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:o,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let m,y,v,S;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(r<0)return!1;if(y=r<d?r:d,s<0)v=0;else{if(!(s<c))return!1;v=s}if(o<0)return!1;S=o<c?o:c;const R=y-m,P=S-v;return this.checkSizeIsVisible(R,P,h)}),Xt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Xt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(ST.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(ST.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ST.SIZE)}}return this.returnHiddenResult(ST.STYLE)}return this.returnHiddenResult(Yx.UNMOUNTED)}return this.returnHiddenResult(Yx.INVALID_HTML_ELEMENT)}),Xt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function Xx(t){return new TextEncoder().encode(t)}const cW=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},Jx=async t=>function(r,s){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(s).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",Xx(t)),16);let zr=class{constructor(){Xt(this,"_events",{}),Xt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],o=this._indexOfListener(s,r);o!==-1&&s.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(d=>d);for(var s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];for(let d=0;d<r.length;d+=1){const h=r[d];h.once&&this.off(t,h.listener),h.listener.apply(this,o||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(d){console.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},bT=null;function lW(){if(bT)return bT;if(window.electron)return bT=window.electron;if(!window.require)return null;try{return bT=window.require("electron"),bT}catch{return null}}let Pi=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),qr=function(t){return t.TRACER="tracer",t}({});function uW(t){return ur(t.timeout,"config.timeout",0,1e5),ur(t.timeoutFactor,"config.timeoutFactor",0,100,!1),ur(t.maxRetryCount,"config.maxRetryConfig",0,1/0),ur(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Ife=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Xn=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function TT(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function dW(t){return ms(t.turnServerURL,"turnServerURL"),ms(t.username,"username"),ms(t.password,"password"),t.udpport&&ur(t.udpport,"udpport",1,99999,!0),t.forceturn&&cf(t.forceturn,"forceturn"),t.security&&cf(t.security,"security"),t.tcpport&&ur(t.tcpport,"tcpport",1,99999,!0),!0}function Qx(t){return t.level!==void 0&&Wi(t.level,"level",[1,2,3]),t.delay!==void 0&&ur(t.delay,"delay",0,3e3,!0),!0}let bn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Ms=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Rc=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Fv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Us(t,r){for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return t.getListeners(r).length===0?ht.reject(new Le(te.UNEXPECTED_ERROR,"can not emit promise")):new ht((d,h)=>{t.emit(r,...o,d,h)})}function mr(t,r){if(t.getListeners(r).length===0)return ht.resolve();for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return Us(t,r,...o)}function rl(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return wT(t,r,...o)}function wT(t,r){let s=null,o=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(t.emit(r,...d,m=>{s=m},m=>{o=m}),o!==null)throw o;if(s===null)throw new Le(te.UNEXPECTED_ERROR,"handler is not sync");return s}const yi=new class extends zr{set networkState(t){this.emit(Fv.NETWORK_STATE_CHANGE,t,this._networkState),t===Rc.ONLINE?this.emit(Fv.ONLINE):t===Rc.OFFLINE&&(this.onlineWaiter=new ht(r=>{this.once(Fv.ONLINE,()=>{this.onlineWaiter=void 0,r(Rc.ONLINE)})}),this.emit(Fv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Rc.ONLINE}constructor(){super(),Xt(this,"_moduleName","network-indicator"),Xt(this,"_networkState",Rc.ONLINE),Xt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Rc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Rc.OFFLINE})}};function WA(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function jv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function GA(t){ht!==void 0?ht.resolve().then(t):setTimeout(t,0)}function Yr(t){return JSON.parse(JSON.stringify(t))}function j_(t){try{return Yr(t)}catch{return t}}const hW={};function Wm(t,r){hW[r]||(hW[r]=!0,t())}function B_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)s[o]=r.charCodeAt(o);return s}function Gm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function pW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const o=new Uint8Array(r);o.set(s),s=o}return s}function fW(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=Ec(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let d=0;return r.forEach(h=>{c.set(h,d),d+=h.length}),c}function Lh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function mW(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?Lh(s):s.size}),r+138}function Afe(t){const r=new Le(te.TIMEOUT,"timeout");return new ht((s,o)=>{window.setTimeout(()=>o(r),t)})}function gs(t){return new ht(r=>{window.setTimeout(r,t)})}function gr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+gr(t-s.length,"")}function z_(){return gr(32,"").toUpperCase()}const HA=()=>{},gW=new class{constructor(){Xt(this,"fnMap",new Map)}throttleByKey(t,r,s,o){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const y=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:y,args:d,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,bt(bt({},m),{},{fn:t,args:d,skipFn:o}))}else{const m=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:d,skipFn:o})}}},_W=gW.throttleByKey.bind(gW);function yW(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function Zx(t,r){if(!yW(t)||!yW(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let o=0;o<r.length;o++)s[o]=Zx(t[o],r[o]);return s}{const s=bt({},t);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(t,o)?s[o]=Zx(t[o],r[o]):s[o]=r[o]);return s}}function EW(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let o=0;for(;t>0&&(s[o]=255&t,t>>=8,o++,o!==r););return s}function eL(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function vW(t){const r="0123456789abcdef";function s(fe){let ye,ve="";for(ye=0;ye<=3;ye++)ve+=r.charAt(fe>>8*ye+4&15)+r.charAt(fe>>8*ye&15);return ve}function o(fe,ye){const ve=(65535&fe)+(65535&ye);return(fe>>16)+(ye>>16)+(ve>>16)<<16|65535&ve}function c(fe,ye,ve,_e,Ne,Je){return o(function(pt,_t){return pt<<_t|pt>>>32-_t}(o(o(ye,fe),o(_e,Je)),Ne),ve)}function d(fe,ye,ve,_e,Ne,Je,pt){return c(ye&ve|~ye&_e,fe,ye,Ne,Je,pt)}function h(fe,ye,ve,_e,Ne,Je,pt){return c(ye&_e|ve&~_e,fe,ye,Ne,Je,pt)}function m(fe,ye,ve,_e,Ne,Je,pt){return c(ye^ve^_e,fe,ye,Ne,Je,pt)}function y(fe,ye,ve,_e,Ne,Je,pt){return c(ve^(ye|~_e),fe,ye,Ne,Je,pt)}const v=function(fe){let ye;const ve=1+(fe.length+8>>6),_e=new Array(16*ve);for(ye=0;ye<16*ve;ye++)_e[ye]=0;for(ye=0;ye<fe.length;ye++)_e[ye>>2]|=fe.charCodeAt(ye)<<ye%4*8;return _e[ye>>2]|=128<<ye%4*8,_e[16*ve-2]=8*fe.length,_e}(t);let S,R,P,D,G,j=1732584193,B=-271733879,J=-1732584194,ee=271733878;for(S=0;S<v.length;S+=16)R=j,P=B,D=J,G=ee,j=d(j,B,J,ee,v[S+0],7,-680876936),ee=d(ee,j,B,J,v[S+1],12,-389564586),J=d(J,ee,j,B,v[S+2],17,606105819),B=d(B,J,ee,j,v[S+3],22,-1044525330),j=d(j,B,J,ee,v[S+4],7,-176418897),ee=d(ee,j,B,J,v[S+5],12,1200080426),J=d(J,ee,j,B,v[S+6],17,-1473231341),B=d(B,J,ee,j,v[S+7],22,-45705983),j=d(j,B,J,ee,v[S+8],7,1770035416),ee=d(ee,j,B,J,v[S+9],12,-1958414417),J=d(J,ee,j,B,v[S+10],17,-42063),B=d(B,J,ee,j,v[S+11],22,-1990404162),j=d(j,B,J,ee,v[S+12],7,1804603682),ee=d(ee,j,B,J,v[S+13],12,-40341101),J=d(J,ee,j,B,v[S+14],17,-1502002290),B=d(B,J,ee,j,v[S+15],22,1236535329),j=h(j,B,J,ee,v[S+1],5,-165796510),ee=h(ee,j,B,J,v[S+6],9,-1069501632),J=h(J,ee,j,B,v[S+11],14,643717713),B=h(B,J,ee,j,v[S+0],20,-373897302),j=h(j,B,J,ee,v[S+5],5,-701558691),ee=h(ee,j,B,J,v[S+10],9,38016083),J=h(J,ee,j,B,v[S+15],14,-660478335),B=h(B,J,ee,j,v[S+4],20,-405537848),j=h(j,B,J,ee,v[S+9],5,568446438),ee=h(ee,j,B,J,v[S+14],9,-1019803690),J=h(J,ee,j,B,v[S+3],14,-187363961),B=h(B,J,ee,j,v[S+8],20,1163531501),j=h(j,B,J,ee,v[S+13],5,-1444681467),ee=h(ee,j,B,J,v[S+2],9,-51403784),J=h(J,ee,j,B,v[S+7],14,1735328473),B=h(B,J,ee,j,v[S+12],20,-1926607734),j=m(j,B,J,ee,v[S+5],4,-378558),ee=m(ee,j,B,J,v[S+8],11,-2022574463),J=m(J,ee,j,B,v[S+11],16,1839030562),B=m(B,J,ee,j,v[S+14],23,-35309556),j=m(j,B,J,ee,v[S+1],4,-1530992060),ee=m(ee,j,B,J,v[S+4],11,1272893353),J=m(J,ee,j,B,v[S+7],16,-155497632),B=m(B,J,ee,j,v[S+10],23,-1094730640),j=m(j,B,J,ee,v[S+13],4,681279174),ee=m(ee,j,B,J,v[S+0],11,-358537222),J=m(J,ee,j,B,v[S+3],16,-722521979),B=m(B,J,ee,j,v[S+6],23,76029189),j=m(j,B,J,ee,v[S+9],4,-640364487),ee=m(ee,j,B,J,v[S+12],11,-421815835),J=m(J,ee,j,B,v[S+15],16,530742520),B=m(B,J,ee,j,v[S+2],23,-995338651),j=y(j,B,J,ee,v[S+0],6,-198630844),ee=y(ee,j,B,J,v[S+7],10,1126891415),J=y(J,ee,j,B,v[S+14],15,-1416354905),B=y(B,J,ee,j,v[S+5],21,-57434055),j=y(j,B,J,ee,v[S+12],6,1700485571),ee=y(ee,j,B,J,v[S+3],10,-1894986606),J=y(J,ee,j,B,v[S+10],15,-1051523),B=y(B,J,ee,j,v[S+1],21,-2054922799),j=y(j,B,J,ee,v[S+8],6,1873313359),ee=y(ee,j,B,J,v[S+15],10,-30611744),J=y(J,ee,j,B,v[S+6],15,-1560198380),B=y(B,J,ee,j,v[S+13],21,1309151649),j=y(j,B,J,ee,v[S+4],6,-145523070),ee=y(ee,j,B,J,v[S+11],10,-1120210379),J=y(J,ee,j,B,v[S+2],15,718787259),B=y(B,J,ee,j,v[S+9],21,-343485551),j=o(j,R),B=o(B,P),J=o(J,D),ee=o(ee,G);return s(j)+s(B)+s(J)+s(ee)}let Pfe=1,SW=console,Ks=class{static setLogger(t){SW=t}constructor(t,r){Xt(this,"id",void 0),Xt(this,"lockingPromise",ht.resolve()),Xt(this,"locks",0),Xt(this,"name",""),Xt(this,"lockId",void 0),this.lockId=Pfe++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");SW.debug("".concat(s," ").concat(o))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new ht(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),o}};function Bv(t,r){return function(s,o,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(o));try{for(var y=arguments.length,v=new Array(y),S=0;S<y;S++)v[S]=arguments[S];return await d.apply(this,v)}finally{m()}},c}}const Oi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function tL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function xd(t,r,s,o){const c=Object.assign({},Oi,o);let d=c.timeout;const h=async()=>{await function(v){return new ht(S=>{window.setTimeout(S,v)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let m=!1;const y=new ht(async(v,S)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Le(te.OPERATION_ABORTED));try{const P=await t();if(!r(P,R)||R+1===c.maxRetryCount)return v(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return y.cancel=()=>m=!0,y}let $A,bW=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ec(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},KA=0,nL=0;function rL(t,r,s,o){return new ht((c,d)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),KA+=Lh(r.data)):s&&(r.data.size?KA+=r.data.size:r.data instanceof FormData?KA+=mW(r.data):KA+=Lh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ba.request(r).then(h=>{typeof h.data=="string"?nL+=Lh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?nL+=h.data.byteLength:nL+=Lh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{ba.isCancel(h)?d(new Le(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Le(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Le(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Le(te.NETWORK_ERROR,h.message))})})}async function Ofe(t,r){const s=new Blob([r.data],{type:"buffer"});return await rL(t,bt(bt({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const TW=()=>window.isSecureContext!==void 0;function xu(t){if(Array.isArray(t))return t.map(s=>s);if(!wW(t))return t;const r={};for(const s in t){const o=t[s];wW(o)||Array.isArray(o)?r[s]=xu(o):r[s]=o}return r}function wW(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let iL=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Mh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},CT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Mh,remoteCandidate:Mh},updateInterval:0},CW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},RW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},IW={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},AW={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let sL=class{constructor(t,r){Xt(this,"onFirstVideoReceived",void 0),Xt(this,"onFirstVideoDecoded",void 0),Xt(this,"onFirstAudioReceived",void 0),Xt(this,"onFirstVideoDecodedTimeout",void 0),Xt(this,"onFirstAudioDecoded",void 0),Xt(this,"onSelectedLocalCandidateChanged",void 0),Xt(this,"onSelectedRemoteCandidateChanged",void 0),Xt(this,"videoIsReady",!1),Xt(this,"videoIsReady2",{}),Xt(this,"pc",void 0),Xt(this,"options",void 0),Xt(this,"intervalTimer",void 0),Xt(this,"stats",xu(CT)),Xt(this,"isFirstVideoReceived",{}),Xt(this,"isFirstVideoDecoded",{}),Xt(this,"isFirstAudioReceived",{}),Xt(this,"isFirstAudioDecoded",{}),Xt(this,"isFirstVideoDecodedTimeout",{}),Xt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ht(t=>{t({local:bt({},Mh),remote:bt({},Mh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,d=0,h=0;for(const m of s)t[m].forEach((y,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const S=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,R=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,d+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?y.packetLostRate=0:y.packetLostRate=S<=0||R<=0?0:R/(S+R)});t.sendPacketLossRate=o<=0||d<=0?0:d/(o+d),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},kfe=class extends sL{constructor(){super(...arguments),Xt(this,"_stats",CT),Xt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=xu(CT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const o=ot(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=xu(RW);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=xu(CW),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,m=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:bt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=xu(AW);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=xu(IW);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ht((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const o={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{o[c]=s.stat(c)}),r.push(o)}),r}},RT=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),qA=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),oL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),il=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var zv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(zv||{});function IT(t,r,s,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:zv.kNone;if(!r)return;const d=Number(r[s]);if(typeof d!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!t)return h?d/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const y=Number(t[o]);if(typeof y!="number")return;const v=h-y;return v?(d-m)/v*c:void 0}let PW=class extends sL{constructor(){super(...arguments),Xt(this,"_stats",CT),Xt(this,"report",void 0),Xt(this,"lastDecodeVideoReceiverStats",new Map),Xt(this,"lastVideoFramesRecv",new Map),Xt(this,"lastVideoFramesSent",new Map),Xt(this,"lastVideoFramesDecode",new Map),Xt(this,"lastVideoFramesOutput",new Map),Xt(this,"lastVideoJBDelay",new Map),Xt(this,"lastAudioJBDelay",new Map),Xt(this,"mediaBytesSent",new Map),Xt(this,"mediaBytesRetransmit",new Map),Xt(this,"mediaBytesTargetEncode",new Map),Xt(this,"lastDecodeAudioReceiverStats",new Map),Xt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=xu(CT),this.report.forEach(t=>{switch(t.type){case il.OUTBOUND:case il.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,o=!r&&!("frameWidth"in t);t.type===il.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===il.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case il.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case il.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:bt({},Mh),remote:bt({},Mh)};return t.forEach(s=>{let o;if(s.type===il.TRANSPORT&&(o=t.get(s.selectedCandidatePairId)),s.type===il.CANDIDATE_PAIR&&s.selected&&(o=s),o){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const d=t.get(o.localCandidateId);d&&c(r.local,d)}if(o.remoteCandidateId){const d=t.get(o.remoteCandidateId);d&&c(r.remote,d)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===il.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===il.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===il.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(bt({},r),bt({},this.stats.selectedCandidatePair.localCandidate)),t.type===il.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(bt({},r),bt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(o=>o.ssrc===t.ssrc);r||(r=xu(AW),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=IT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",zv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,bt({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=xu(CW),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=IT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=IT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",zv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=IT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",zv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=IT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",zv.kMillisecondsFromSeconds),o&&d-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((d-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:bt({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);r||(r=xu(RW),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const o=new iL(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const c=new iL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const c=new iL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-o.lastFrameCount,d=t.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const o=this.findRemoteStatsId(t.ssrc,il.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=xu(IW),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,il.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const o=Array.from(tl(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return o?o.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var o,c,d,h;const m=r?this.report.get(r):void 0,y=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:t.framesSent;if(typeof y!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,S=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof S=="number"||(v=0,S=0),R==null){const P=Date.now(),D=this.lastVideoFramesSent.get(s.ssrc);D&&P-D.lts>=800?(R=Math.round((y-D.count)/((P-D.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:R})):D?R=D.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:0})}s.sentFrame={width:v,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var o,c,d,h,m;const y=r?this.report.get(r):void 0,v=(o=y==null?void 0:y.framesReceived)!==null&&o!==void 0?o:t.framesReceived,S=(c=y==null?void 0:y.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(d=y==null?void 0:y.frameHeight)!==null&&d!==void 0?d:t.frameHeight,P=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,D=(m=y==null?void 0:y.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),j=Date.now();s.framesReceivedCount=v;let B=0;G&&j-G.lts>=800?(B=Math.round((v-G.count)/((j-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:j,rate:B})):G?B=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:j,rate:0}),s.receivedFrame={width:S||0,height:R||0,frameRate:B||0},s.decodedFrame={width:S||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:S||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&D){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let j=G.jitterBufferMs;const B=D-G.jitterBufferEmittedCount;B>0&&(j=1e3*(P-G.jitterBufferDelay)/B),s.jitterBufferMs=j,s.currentDelayMs=Math.round(j),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:D,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var o,c,d,h;const m=r?this.report.get(r):void 0,y=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&o!==void 0?o:0,v=(d=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,s){var o,c,d,h,m,y,v;const S=r?this.report.get(r):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,D=(d=S==null?void 0:S.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,G=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,j=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,B=(y=S==null?void 0:S.totalSamplesDuration)!==null&&y!==void 0?y:t==null?void 0:t.totalSamplesDuration,J=(v=S==null?void 0:S.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),D&&G){const fe=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ye=fe.jitterBufferMs;const ve=G-fe.jitterBufferEmittedCount;ve>0&&(ye=1e3*(D-fe.jitterBufferDelay)/ve),s.jitterBufferMs=Math.round(ye),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=j;let ee=1920;B&&P&&(ee=P/B/50,s.receivedFrames=Math.round(P/ee)),J&&(s.droppedFrames=Math.round(J/ee))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const o=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},Nfe=class extends sL{updateStats(){return ht.resolve()}};function aL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new kfe(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new PW(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof ht||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(m))}(t)?new PW(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Nfe(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const OW="websdk_ng_install_id";function cL(){try{if(se("INSTALL_ID"))return se("INSTALL_ID");let t=window.localStorage.getItem(OW);return t||(t=z_(),window.localStorage.setItem(OW,t)),or("INSTALL_ID",t),t}catch{return}}const zl=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],o=r[2];return"".concat(s,".").concat(o)}return"4.0.0.999"}("4.23.2"),lL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let W_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Vs=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const o=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const d=c.join(""),h={};return h[t]=o,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Vs;const YA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},uL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},dL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",hL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Ir=bt(bt(bt({},hL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:uL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},YA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function or(t,r,s){var o,c,d;ot(o=Object.keys(Ir)).call(o,t)&&(!s&&ot(c=Object.keys(Ld)).call(c,t)||(Ir[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(Ir.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(Ir.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,Ir.USE_NEW_NETWORK_CONFIG=d,d&&(Ir.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ir.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ir.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ir.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ir.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ir.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ir.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(Ir.ENABLE_INSTANT_VIDEO=!0,Ir.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(Ir.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(Ir.NEW_TURN_MODE||(Ir.NEW_TURN_MODE=4))))}function se(t){return Ir[t]}lL||(Ir.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ir.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ir.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ir.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ir.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ir.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ir.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ir.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ir.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ir.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ir.AREAS=["NORTH_AMERICA","OVERSEA"]);let kW=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Ld={};var Tn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Tn||{});let XA=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const NW=128,Dfe=96,DW=1e3,Wv=10;let xfe=0;var xW=(()=>{var t={8:(o,c,d)=>{d.r(c),d.d(c,{Parser:()=>pt,Printer:()=>di,parse:()=>st,print:()=>It});const h=`
`,m="".concat("\r").concat(h),y=" ";let v;function S(Ke){return Ke>="0"&&Ke<="9"}function R(Ke){return Ke>="!"&&Ke<="~"}function P(Ke){return R(Ke)||Ke>=""&&Ke<=""}function D(Ke){return Ke==="!"||Ke>="#"&&Ke<="'"||Ke>="*"&&Ke<="+"||Ke>="-"&&Ke<="."||Ke>="0"&&Ke<="9"||Ke>="A"&&Ke<="Z"||Ke>="^"&&Ke<="~"}function G(Ke){return Ke>="1"&&Ke<="9"}function j(Ke){return Ke>="A"&&Ke<="Z"||Ke>="a"&&Ke<="z"}function B(Ke){return Ke==="d"||Ke==="h"||Ke==="m"||Ke==="s"}function J(Ke){return Ke>""&&Ke<"	"||Ke>"\v"&&Ke<"\f"||Ke>""&&Ke<""}function ee(Ke){return j(Ke)||S(Ke)||Ke==="+"||Ke==="/"}function fe(Ke){return S(Ke)||j(Ke)||Ke==="+"||Ke==="/"||Ke==="-"||Ke==="_"}function ye(Ke){return j(Ke)||S(Ke)||Ke==="+"||Ke==="/"}function ve(Ke,U){var ce=Object.keys(Ke);if(Object.getOwnPropertySymbols){var me=Object.getOwnPropertySymbols(Ke);U&&(me=me.filter(function(et){return Object.getOwnPropertyDescriptor(Ke,et).enumerable})),ce.push.apply(ce,me)}return ce}function _e(Ke){for(var U=1;U<arguments.length;U++){var ce=arguments[U]!=null?arguments[U]:{};U%2?ve(Object(ce),!0).forEach(function(me){Ne(Ke,me,ce[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ke,Object.getOwnPropertyDescriptors(ce)):ve(Object(ce)).forEach(function(me){Object.defineProperty(Ke,me,Object.getOwnPropertyDescriptor(ce,me))})}return Ke}function Ne(Ke,U,ce){return U in Ke?Object.defineProperty(Ke,U,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ke[U]=ce,Ke}(function(Ke){Ke.VERSION="v",Ke.ORIGIN="o",Ke.SESSION_NAME="s",Ke.INFORMATION="i",Ke.URI="u",Ke.EMAIL="e",Ke.PHONE="p",Ke.CONNECTION="c",Ke.BANDWIDTH="b",Ke.TIME="t",Ke.REPEAT="r",Ke.ZONE_ADJUSTMENTS="z",Ke.KEY="k",Ke.ATTRIBUTE="a",Ke.MEDIA="m"})(v||(v={}));class Je{consumeText(U,ce){let me=ce;for(;me<U.length;){const et=U[me];if(et==="\0"||et==="\r"||et===h)break;me+=1}if(me-ce==0)throw new Error("Invalid text, at ".concat(U));return me}consumeUnicastAddress(U,ce,me){return this.consumeTill(U,ce,y)}consumeOneOrMore(U,ce,me){let et=ce;for(;me(U[et]);)et++;if(et-ce==0)throw new Error("Invalid rule at ".concat(ce,"."));return et}consumeSpace(U,ce){if(U[ce]===y)return ce+1;throw new Error("Invalid space at ".concat(ce,"."))}consumeIP4Address(U,ce){let me=ce;for(let et=0;et<4;et++)if(me=this.consumeDecimalUChar(U,me),et!==3){if(U[me]!==".")throw new Error("Invalid IP4 address.");me++}return me}consumeDecimalUChar(U,ce){let me=ce;for(let Qt=0;Qt<3&&S(U[me]);Qt++,me++);if(me-ce==0)throw new Error("Invalid decimal uchar.");const et=parseInt(U.slice(ce,me));if(et>=0&&et<=255)return me;throw new Error("Invalid decimal uchar")}consumeIP6Address(U,ce){let me=this.consumeHexpart(U,ce);return U[me]===":"&&(me+=1,me=this.consumeIP4Address(U,me)),me}consumeHexpart(U,ce){let me=ce;if(U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}if(me=this.consumeHexseq(U,me),U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}return me}consumeHexseq(U,ce){let me=ce;for(;me=this.consumeHex4(U,me),U[me]===":"&&U[me+1]!==":";)me+=1;return me}consumeHex4(U,ce){let me=0;for(;me<4;me++)if(!((et=U[ce+me])>="0"&&et<="9"||et>="a"&&et<="f"||et>="A"&&et<="F")){if(me===0)throw new Error("Invalid hex 4");break}var et;return ce+me}consumeFQDN(U,ce){let me=ce;for(;S(U[me])||j(U[me])||U[me]==="-"||U[me]===".";)me+=1;if(me-ce<4)throw new Error("Invalid FQDN");return me}consumeExtnAddr(U,ce){return this.consumeOneOrMore(U,ce,P)}consumeMulticastAddress(U,ce,me){switch(me){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(U,ce);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(U,ce);default:try{return this.consumeFQDN(U,ce)}catch{return this.consumeExtnAddr(U,ce)}}}consumeIP6MulticastAddress(U,ce){const me=this.consumeHexpart(U,ce);return U[me]==="/"?this.consumeInteger(U,me+1):me}consumeIP4MulticastAddress(U,ce){let me=ce+3;const et=U.slice(ce,me),Qt=parseInt(et);if(Qt<224||Qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dr=0;dr<3;dr++){if(U[me]!==".")throw new Error("Invalid IP4 multicast address.");me+=1,me=this.consumeDecimalUChar(U,me)}return U[me]==="/"&&(me+=1),me=this.consumeTTL(U,me),U[me]==="/"&&(me=this.consumeInteger(U,me)),me}consumeInteger(U,ce){if(!G(U[ce]))throw new Error("Invalid integer.");for(ce+=1;S(U[ce]);)ce+=1;return ce}consumeTTL(U,ce){if(U[ce]==="0")return ce+1;if(!G(U[ce]))throw new Error("Invalid TTL.");ce+=1;for(let me=0;me<2&&S(U[ce]);me++)ce+=1;return ce}consumeToken(U,ce){return this.consumeOneOrMore(U,ce,D)}consumeTime(U,ce){let me=ce;if(U[me]==="0")return me+1;for(G(U[me])&&(me+=1);S(U[me]);)me++;if(me-ce<10)throw new Error("Invalid time");return me}consumeAddress(U,ce){return this.consumeTill(U,ce,y)}consumeTypedTime(U,ce){let me=ce;return me=this.consumeOneOrMore(U,me,S),B(U[me])?me+1:me}consumeRepeatInterval(U,ce){if(!G(U[ce]))throw new Error("Invalid repeat interval");for(ce+=1;S(U[ce]);)ce+=1;return B(U[ce])&&(ce+=1),ce}consumePort(U,ce){return this.consumeOneOrMore(U,ce,S)}consume(U,ce,me){for(let et=0;et<me.length;et++){if(ce+et>=U.length)throw new Error("consume exceeding value length");if(U[ce+et]!==me[et])throw new Error("consume ".concat(me," failed at ").concat(et))}return ce+me.length}consumeTill(U,ce,me){let et=ce;for(;et<U.length&&(typeof me!="string"||U[et]!==me)&&(typeof me!="function"||!me(U[et]));)et++;return et}}class pt extends Je{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(U){const ce=this.probeEOL(U);this.records=U.split(ce).filter(py=>!!vo(py).call(py)).map(this.parseLine),this.currentLine=0;const me=this.parseVersion(),et=this.parseOrigin(),Qt=this.parseSessionName(),dr=this.parseInformation(),Qi=this.parseUri(),nc=this.parseEmail(),Sf=this.parsePhone(),hy=this.parseConnection(),uw=this.parseBandWidth(),aO=this.parseTimeFields(),cO=this.parseKey(),Xl=this.parseSessionAttribute(),cg=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:me,origin:et,sessionName:Qt,information:dr,uri:Qi,emails:nc,phones:Sf,connection:hy,bandwidths:uw,timeFields:aO,key:cO,attributes:Xl,mediaDescriptions:cg}}getCurrentRecord(){const U=this.records[this.currentLine];if(!U)throw new Error("Record doesn't exit.");return U}probeEOL(U){for(let ce=0;ce<U.length;ce++)if(U[ce]===h)return U[ce-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(U,ce){if(U.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const me=U[0];if(U[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:me,value:U.slice(2),line:ce,cur:0}}parseSessionAttribute(){const U=new Rn;for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.ATTRIBUTE)break;const me={attField:this.extractOneOrMore(ce,et=>D(et)&&et!==":"),_cur:0};ce.value[ce.cur]===":"&&(ce.cur+=1,me.attValue=this.extractOneOrMore(ce,J)),U.parse(me),this.currentLine++}return U.digest()}parseMediaAttributes(U){const ce=new In(U);for(;this.currentLine<this.records.length;){const me=this.getCurrentRecord();if(me.type!==v.ATTRIBUTE)break;const et={attField:this.extractOneOrMore(me,Qt=>D(Qt)&&Qt!==":"),_cur:0};me.value[me.cur]===":"&&(me.cur+=1,et.attValue=this.extractOneOrMore(me,J)),ce.parse(et),this.currentLine++}return ce.digest()}parseKey(){const U=this.getCurrentRecord();if(U.type===v.KEY){if(U.value==="prompt"||U.value==="clear:"||U.value==="base64:"||U.value==="uri:")return U.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const U=this.getCurrentRecord();if(U.type===v.ZONE_ADJUSTMENTS){const ce=[];for(;;)try{const me=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);let et=!1;U.value[U.cur]==="-"&&(et=!0,U.cur+=1);const Qt=this.extract(U,this.consumeTypedTime);ce.push({time:me,typedTime:Qt,back:et})}catch{break}if(ce.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ce}return[]}parseRepeat(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.REPEAT)break;{const me=this.extract(ce,this.consumeRepeatInterval),et=this.parseTypedTime(ce);U.push({repeatInterval:me,typedTimes:et}),this.currentLine++}}return U}parseTypedTime(U){const ce=[];for(;;)try{this.consumeSpaceForRecord(U),ce.push(this.extract(U,this.consumeTypedTime))}catch{break}if(ce.length===0)throw new Error("Invalid typed time.");return ce}parseTime(){const U=this.getCurrentRecord(),ce=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);const me=this.extract(U,this.consumeTime);return this.currentLine++,{startTime:ce,stopTime:me}}parseBandWidth(){const U=[];for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.BANDWIDTH)break;{const me=this.extractOneOrMore(ce,D);if(ce.value[ce.cur]!==":")throw new Error("Invalid bandwidth field.");ce.cur++;const et=this.extractOneOrMore(ce,S);U.push({bwtype:me,bandwidth:et}),this.currentLine++}}return U}parseVersion(){const U=this.getCurrentRecord();if(U.type!==v.VERSION)throw new Error("first sdp record must be version");const ce=U.value.slice(0,this.consumeOneOrMore(U.value,0,S));if(ce.length!==U.value.length)throw new Error('invalid proto version, "v='.concat(U.value,'"'));return this.currentLine++,ce}parseOrigin(){const U=this.getCurrentRecord();if(U.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ce=this.extractOneOrMore(U,P);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,S);this.consumeSpaceForRecord(U);const et=this.extractOneOrMore(U,S);this.consumeSpaceForRecord(U);const Qt=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const dr=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const Qi=this.extract(U,this.consumeUnicastAddress);return this.currentLine++,{username:ce,sessId:me,sessVersion:et,nettype:Qt,addrtype:dr,unicastAddress:Qi}}parseSessionName(){const U=this.getCurrentRecord();if(U.type===v.SESSION_NAME){const ce=this.extract(U,this.consumeText);return this.currentLine++,ce}}parseInformation(){const U=this.getCurrentRecord();if(U.type!==v.INFORMATION)return;const ce=this.extract(U,this.consumeText);return this.currentLine++,ce}parseUri(){const U=this.getCurrentRecord();if(U.type===v.URI)return this.currentLine++,U.value}parseEmail(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.EMAIL)break;U.push(ce.value),this.currentLine++}return U}parsePhone(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.PHONE)break;U.push(ce.value),this.currentLine++}return U}parseConnection(){const U=this.getCurrentRecord();if(U.type===v.CONNECTION){const ce=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const et=this.extract(U,this.consumeAddress);return this.currentLine++,{nettype:ce,addrtype:me,address:et}}}parseMedia(){const U=this.getCurrentRecord(),ce=this.extract(U,this.consumeToken);this.consumeSpaceForRecord(U);let me=this.extract(U,this.consumePort);U.value[U.cur]==="/"&&(U.cur+=1,me+=this.extract(U,this.consumeInteger)),this.consumeSpaceForRecord(U);const et=[];for(et.push(this.extract(U,this.consumeToken));U.value[U.cur]==="/";)U.cur+=1,et.push(this.extract(U,this.consumeToken));if(et.length===0)throw new Error("Invalid proto");const Qt=this.parseFmt(U);return this.currentLine++,{mediaType:ce,port:me,protos:et,fmts:Qt}}parseTimeFields(){const U=[];for(;this.getCurrentRecord().type===v.TIME;){const ce=this.parseTime(),me=this.parseRepeat(),et=this.parseZone();U.push({time:ce,repeats:me,zones:et})}return U}parseMediaDescription(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ce=this.parseMedia(),me=this.parseInformation(),et=this.parseConnections(),Qt=this.parseBandWidth(),dr=this.parseKey(),Qi=this.parseMediaAttributes(ce);U.push({media:ce,information:me,connections:et,bandwidths:Qt,key:dr,attributes:Qi})}return U}parseConnections(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)U.push(this.parseConnection());return U}parseFmt(U){const ce=[];for(;;)try{this.consumeSpaceForRecord(U),ce.push(this.extract(U,this.consumeToken))}catch{break}if(ce.length===0)throw new Error("Invalid fmts");return ce}extract(U,ce){for(var me=arguments.length,et=new Array(me>2?me-2:0),Qt=2;Qt<me;Qt++)et[Qt-2]=arguments[Qt];const dr=ce.call(this,U.value,U.cur,...et),Qi=U.value.slice(U.cur,dr);return U.cur=dr,Qi}extractOneOrMore(U,ce){const me=this.consumeOneOrMore(U.value,U.cur,ce),et=U.value.slice(U.cur,me);return U.cur=me,et}consumeSpaceForRecord(U){if(U.value[U.cur]!==y)throw new Error("Invalid space at ".concat(U.cur,"."));U.cur+=1}}class _t extends Je{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(U,ce,me){const et=this.consumeOneOrMore(U.attValue,U._cur,ce),Qt=U.attValue.slice(U._cur,et),[dr,Qi]=me||[];if(typeof dr=="number"&&Qt.length<dr)throw new Error("error in length, should be more or equal than ".concat(dr," characters."));if(typeof Qi=="number"&&Qt.length>Qi)throw new Error("error in length, should be less or equal than ".concat(Qi," characters."));return U._cur=et,Qt}consumeAttributeSpace(U){if(U.attValue[U._cur]!==y)throw new Error("Invalid space at ".concat(U._cur,"."));U._cur+=1}extract(U,ce){if(!U.attValue)throw new Error("Nothing to extract from attValue.");for(var me=arguments.length,et=new Array(me>2?me-2:0),Qt=2;Qt<me;Qt++)et[Qt-2]=arguments[Qt];const dr=ce.call(this,U.attValue,U._cur,...et),Qi=U.attValue.slice(U._cur,dr);return U._cur=dr,Qi}atEnd(U){if(!U.attValue)throw new Error;return U._cur>=U.attValue.length}peekChar(U){if(!U.attValue)throw new Error;return U.attValue[U._cur]}peek(U,ce){if(!U.attValue)throw new Error;for(let me=0;me<ce.length;me++)if(ce[me]!==U.attValue[U._cur+me])return!1;return!0}parseIceUfrag(U){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(U,ee,[4,256])}parseIcePwd(U){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(U,ee,[22,256])}parseIceOptions(U){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ce=[];for(;!this.atEnd(U);){ce.push(this.extractOneOrMore(U,ee));try{this.consumeAttributeSpace(U)}catch(me){if(this.atEnd(U))break;throw me}}this.attributes.iceOptions=ce}parseFingerprint(U){const ce=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ce,fingerprint:me})}parseExtmap(U){const ce=this.extractOneOrMore(U,S);let me;this.peekChar(U)==="/"&&(this.extract(U,this.consume,"/"),me=this.extract(U,this.consumeToken)),this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeTill,y),Qt=_e(_e({entry:parseInt(ce,10)},me&&{direction:me}),{},{extensionName:et});this.peekChar(U)===y&&(this.consumeAttributeSpace(U),Qt.extensionAttributes=this.extract(U,this.consumeTill)),this.attributes.extmaps.push(Qt)}parseSetup(U){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ce=this.extract(U,this.consumeTill);if(ce!=="active"&&ce!=="passive"&&ce!=="actpass"&&ce!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ce}}class Rn extends _t{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"group":this.parseGroup(U);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"fingerprint":this.parseFingerprint(U);break;case"setup":this.parseSetup(U);break;case"tls-id":this.parseTlsId(U);break;case"identity":this.parseIdentity(U);break;case"extmap":this.parseExtmap(U);break;case"msid-semantic":this.parseMsidSemantic(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(ce){throw console.error("parsing session attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),ce}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(U){const ce=this.extract(U,this.consumeToken),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===y;)this.consumeAttributeSpace(U),me.push(this.extract(U,this.consumeToken));this.attributes.groups.push({semantic:ce,identificationTag:me})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(U){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(U,fe)}parseIdentity(U){const ce=this.extractOneOrMore(U,ye),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===y;){this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeToken);this.extract(U,this.consume,"=");const Qt=this.extractOneOrMore(U,dr=>dr!==y&&J(dr));me.push({name:et,value:Qt})}this.attributes.identities.push({assertionValue:ce,extensions:me})}parseMsidSemantic(U){this.peekChar(U)===y&&this.consumeAttributeSpace(U);const ce={semantic:this.extract(U,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(U)}catch{break}if(this.peekChar(U)==="*"){this.extract(U,this.consume,"*"),ce.applyForAll=!0;break}{const me=this.extract(U,this.consumeTill,y);ce.identifierList.push(me)}}this.attributes.msidSemantic=ce}}class In extends _t{constructor(U){super(),Ne(this,"attributes",void 0),U.protos.indexOf("RTP")!==-1||U.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"extmap":this.parseExtmap(U);break;case"setup":this.parseSetup(U);break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"candidate":this.parseCandidate(U);break;case"remote-candidate":this.parseRemoteCandidate(U);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(U);break;case"rtpmap":this.parseRtpmap(U);break;case"ptime":this.parsePtime(U);break;case"maxptime":this.parseMaxPtime(U);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(U);break;case"ssrc":this.parseSSRC(U);break;case"fmtp":this.parseFmtp(U);break;case"rtcp-fb":this.parseRtcpFb(U);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(U);break;case"mid":this.parseMid(U);break;case"msid":this.parseMsid(U);break;case"imageattr":this.parseImageAttr(U);break;case"rid":this.parseRid(U);break;case"simulcast":this.parseSimulcast(U);break;case"sctp-port":this.parseSctpPort(U);break;case"max-message-size":this.parseMaxMessageSize(U);break;case"ssrc-group":this.parseSSRCGroup(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(ce){throw console.error("parsing media attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),ce}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}parseCandidate(U){const ce=this.extractOneOrMore(U,ee,[1,32]);this.consumeAttributeSpace(U);const me=this.extractOneOrMore(U,S,[1,5]);this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const Qt=this.extractOneOrMore(U,S,[1,10]);this.consumeAttributeSpace(U);const dr=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const Qi=this.extract(U,this.consumePort);this.consumeAttributeSpace(U),this.extract(U,this.consume,"typ"),this.consumeAttributeSpace(U);const nc={foundation:ce,componentId:me,transport:et,priority:Qt,connectionAddress:dr,port:Qi,type:this.extract(U,this.consumeToken),extension:{}};for(this.peek(U," raddr")&&(this.extract(U,this.consume," raddr"),this.consumeAttributeSpace(U),nc.relAddr=this.extract(U,this.consumeAddress)),this.peek(U," rport")&&(this.extract(U,this.consume," rport"),this.consumeAttributeSpace(U),nc.relPort=this.extract(U,this.consumePort));this.peekChar(U)===y;){this.consumeAttributeSpace(U);const Sf=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U),nc.extension[Sf]=this.extractOneOrMore(U,R)}this.attributes.candidates.push(nc)}parseRemoteCandidate(U){const ce=[];for(;;){const me=this.extractOneOrMore(U,S,[1,5]);this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const Qt=this.extract(U,this.consumePort);ce.push({componentId:me,connectionAddress:et,port:Qt});try{this.consumeAttributeSpace(U)}catch{break}}this.attributes.remoteCandidatesList.push(ce)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(U){const ce=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,"/");this.extract(U,this.consume,"/");const et={encodingName:me,clockRate:this.extractOneOrMore(U,S)};this.atEnd(U)||this.peekChar(U)!=="/"||(this.extract(U,this.consume,"/"),et.encodingParameters=parseInt(this.extract(U,this.consumeTill),10));const Qt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ce,10));Qt?Qt.rtpMap=et:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtpMap:et,rtcpFeedbacks:[]})}parsePtime(U){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(U,this.consumeTill)}parseMaxPtime(U){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(U,this.consumeTill)}parseDirection(U){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=U.attField}parseSSRC(U){const ce=this.extractOneOrMore(U,S);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,":");let et;this.peekChar(U)===":"&&(this.extract(U,this.consume,":"),et=this.extract(U,this.consumeTill));const Qt=this.attributes.ssrcs.find(dr=>dr.ssrcId===parseInt(ce,10));Qt?Qt.attributes[me]=et:this.attributes.ssrcs.push({ssrcId:parseInt(ce,10),attributes:{[me]:et}})}parseFmtp(U){const ce=this.extract(U,this.consumeTill,y);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill),et={};me.split(";").forEach(dr=>{let[Qi,nc]=dr.split("=");Qi=vo(Qi).call(Qi);const Sf=typeof nc=="string"?vo(nc).call(nc):null;typeof Qi=="string"&&Qi.length>0&&(et[Qi]=Sf)});const Qt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ce,10));Qt?Qt.fmtp={parameters:et}:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[],fmtp:{parameters:et}})}parseFmtParameters(U){const ce={},me=this.extract(U,this.consumeTill,"=");U._cur++;const et=this.extract(U,this.consumeTill,";");for(ce[me]=et;U.attValue[U._cur]===";";){const Qt=this.extract(U,this.consumeTill,"=");U._cur++;const dr=this.extract(U,this.consumeTill,";");ce[Qt]=dr}return ce}parseRtcpFb(U){let ce="";ce=this.peekChar(U)==="*"?this.extract(U,this.consume,"*"):this.extract(U,this.consumeTill,y),this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,y);let et;if(me==="trr-int")et={type:me,interval:this.extract(U,this.consumeTill)};else{const Qt={type:me};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),Qt.parameter=this.extract(U,this.consumeToken),this.peekChar(U)===y&&(Qt.additional=this.extract(U,this.consumeTill))),et=Qt}if(ce==="*")this.attributes.rtcpFeedbackWildcards.push(et);else{const Qt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ce,10));Qt?Qt.rtcpFeedbacks.push(et):this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[et]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(U){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ce={port:this.extract(U,this.consumePort)};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),ce.netType=this.extractOneOrMore(U,D),this.consumeAttributeSpace(U),ce.addressType=this.extractOneOrMore(U,D),this.consumeAttributeSpace(U),ce.address=this.extract(U,this.consumeAddress)),this.attributes.rtcp=ce}parseMsid(U){const ce={id:this.extractOneOrMore(U,D,[1,64])};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),ce.appdata=this.extractOneOrMore(U,D,[1,64])),this.attributes.msids.push(ce)}parseImageAttr(U){this.attributes.imageattr.push(U.attValue)}parseRid(U){const ce=this.extractOneOrMore(U,et=>j(et)||S(et)||et==="_"||et==="-");this.consumeAttributeSpace(U);const me={id:ce,direction:this.extract(U,this.consumeToken),params:[]};if(this.peekChar(U)===y){if(this.consumeAttributeSpace(U),this.peek(U,"pt=")){this.extract(U,this.consume,"pt=");const et=[];for(;;){const Qt=this.extract(U,this.consumeToken);et.push(Qt);try{this.extract(U,this.consume,",")}catch{break}}me.payloads=et,this.peekChar(U)===y&&this.extract(U,this.consume,y)}for(;;){const et=this.extract(U,this.consumeToken);switch(et){case"depend":{const Qt={type:et,rids:this.extract(U,this.consume,"=").split(",")};me.params.push(Qt);break}default:{const Qt={type:et};this.peekChar(U)==="="&&(this.extract(U,this.consume,"="),Qt.val=this.extract(U,this.consumeTill,";")),me.params.push(Qt)}}try{this.extract(U,this.consume,";")}catch{break}}}this.attributes.rids.push(me)}parseSimulcast(U){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=U.attValue,this.extract(U,this.consumeTill)}parseSctpPort(U){this.attributes.sctpPort=this.extractOneOrMore(U,S,[1,5])}parseMaxMessageSize(U){this.attributes.maxMessageSize=this.extractOneOrMore(U,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(U){this.attributes.mid=this.extract(U,this.consumeToken)}parseSSRCGroup(U){const ce=this.extract(U,this.consumeToken),me=[];for(;;)try{this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeInteger);me.push(parseInt(et,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ce,ssrcIds:me})}}function yr(Ke,U,ce){return U in Ke?Object.defineProperty(Ke,U,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ke[U]=ce,Ke}class di{constructor(){yr(this,"eol",m)}print(U,ce){let me="";return ce&&(this.eol=ce),me+=this.printVersion(U.version),me+=this.printOrigin(U.origin),me+=this.printSessionName(U.sessionName),me+=this.printInformation(U.information),me+=this.printUri(U.uri),me+=this.printEmail(U.emails),me+=this.printPhone(U.phones),me+=this.printConnection(U.connection),me+=this.printBandwidth(U.bandwidths),me+=this.printTimeFields(U.timeFields),me+=this.printKey(U.key),me+=this.printSessionAttributes(U.attributes),me+=this.printMediaDescription(U.mediaDescriptions),me}printVersion(U){return"v=".concat(U).concat(this.eol)}printOrigin(U){return"o=".concat(U.username," ").concat(U.sessId," ").concat(U.sessVersion," ").concat(U.nettype," ").concat(U.addrtype," ").concat(U.unicastAddress).concat(this.eol)}printSessionName(U){return U?"s=".concat(U).concat(this.eol):""}printInformation(U){return U?"i=".concat(U).concat(this.eol):""}printUri(U){return U?"u=".concat(U).concat(this.eol):""}printEmail(U){let ce="";for(const me of U)ce+="e=".concat(me).concat(this.eol);return ce}printPhone(U){let ce="";for(const me of U)ce+="e=".concat(me).concat(this.eol);return ce}printConnection(U){return U?"c=".concat(U.nettype," ").concat(U.addrtype," ").concat(U.address).concat(this.eol):""}printBandwidth(U){let ce="";for(const me of U)ce+="b=".concat(me.bwtype,":").concat(me.bandwidth).concat(this.eol);return ce}printTimeFields(U){let ce="";for(const me of U){ce+="t=".concat(me.time.startTime," ").concat(me.time.startTime).concat(this.eol);for(const et of me.repeats)ce+="r=".concat(et.repeatInterval," ").concat(et.typedTimes.join(" ")).concat(this.eol);me.zoneAdjustments&&(ce+="z=",ce+="z=".concat(me.zoneAdjustments.map(et=>"".concat(et.time," ").concat(et.back?"-":""," ").concat(et.typedTime)).join(" ")).concat(this.eol),ce+=this.eol)}return ce}printKey(U){return U?"k=".concat(U).concat(this.eol):""}printAttributes(U){let ce="";for(const me of U)ce+="a=".concat(me.attField).concat(me.attValue?":".concat(me.attValue):"").concat(this.eol);return ce}printMediaDescription(U){let ce="";for(const me of U)ce+=this.printMedia(me.media),ce+=this.printInformation(me.information),ce+=this.printConnections(me.connections),ce+=this.printBandwidth(me.bandwidths),ce+=this.printKey(me.key),ce+=this.printMediaAttributes(me);return ce}printConnections(U){let ce="";for(const me of U)ce+=this.printConnection(me);return ce}printMedia(U){return"m=".concat(U.mediaType," ").concat(U.port," ").concat(U.protos.join("/")," ").concat(U.fmts.join(" ")).concat(this.eol)}printSessionAttributes(U){return new Aa(this.eol).print(U)}printMediaAttributes(U){return new We(this.eol).print(U)}}class Zr{constructor(U){yr(this,"eol",void 0),this.eol=U}printIceUfrag(U){return U===void 0?"":"a=ice-ufrag:".concat(U).concat(this.eol)}printIcePwd(U){return U===void 0?"":"a=ice-pwd:".concat(U).concat(this.eol)}printIceOptions(U){return U===void 0?"":"a=ice-options:".concat(U.join(y)).concat(this.eol)}printFingerprints(U){return U.length>0?U.map(ce=>"a=fingerprint:".concat(ce.hashFunction).concat(y).concat(ce.fingerprint)).join(this.eol)+this.eol:""}printExtmap(U){return U.map(ce=>"a=extmap:".concat(ce.entry).concat(ce.direction?"/".concat(ce.direction):"").concat(y).concat(ce.extensionName).concat(ce.extensionAttributes?"".concat(y).concat(ce.extensionAttributes):"").concat(this.eol)).join("")}printSetup(U){return U===void 0?"":"a=setup:".concat(U).concat(this.eol)}printUnrecognized(U){return U.map(ce=>"a=".concat(ce.attField).concat(ce.attValue?":".concat(ce.attValue):"").concat(this.eol)).join("")}}class Aa extends Zr{print(U){let ce="";return ce+=this.printGroups(U.groups),ce+=this.printMsidSemantic(U.msidSemantic),ce+=this.printIceLite(U.iceLite),ce+=this.printIceUfrag(U.iceUfrag),ce+=this.printIcePwd(U.icePwd),ce+=this.printIceOptions(U.iceOptions),ce+=this.printFingerprints(U.fingerprints),ce+=this.printSetup(U.setup),ce+=this.printTlsId(U.tlsId),ce+=this.printIdentity(U.identities),ce+=this.printExtmap(U.extmaps),ce+=this.printUnrecognized(U.unrecognized),ce}printGroups(U){let ce="";return U.length>0&&(ce+=U.map(me=>"a=group:".concat(me.semantic).concat(me.identificationTag.map(et=>"".concat(y).concat(et)).join("")).concat(this.eol)).join("")),ce}printIceLite(U){return U===void 0?"":"a=ice-lite"+this.eol}printTlsId(U){return U?"a=tls-id:".concat(U).concat(this.eol):""}printIdentity(U){return U.length===0?"":U.map(ce=>"a=identity:".concat(ce.assertionValue).concat(ce.extensions.map(me=>"".concat(y).concat(me.name).concat(me.value?"=".concat(me.value):"")))).join(this.eol)+this.eol}printMsidSemantic(U){if(!U)return"";let ce="a=msid-semantic:".concat(U.semantic);return U.applyForAll?ce+="".concat(y,"*"):U.identifierList.length>0&&(ce+=U.identifierList.map(me=>"".concat(y).concat(me))),ce+this.eol}}class We extends Zr{print(U){const ce=U.attributes;let me="";return me+=this.printRTCP(ce.rtcp),me+=this.printIceUfrag(ce.iceUfrag),me+=this.printIcePwd(ce.icePwd),me+=this.printIceOptions(ce.iceOptions),me+=this.printCandidates(ce.candidates),me+=this.printRemoteCandidatesList(ce.remoteCandidatesList),me+=this.printEndOfCandidates(ce.endOfCandidates),me+=this.printFingerprints(ce.fingerprints),me+=this.printSetup(ce.setup),me+=this.printMid(ce.mid),me+=this.printExtmap(ce.extmaps),me+=this.printRTPRelated(ce),me+=this.printPtime(ce.ptime),me+=this.printMaxPtime(ce.maxPtime),me+=this.printDirection(ce.direction),me+=this.printSSRCGroups(ce.ssrcGroups),me+=this.printSSRC(ce.ssrcs),me+=this.printRTCPMux(ce.rtcpMux),me+=this.printRTCPMuxOnly(ce.rtcpMuxOnly),me+=this.printRTCPRsize(ce.rtcpRsize),me+=this.printMSId(ce.msids),me+=this.printImageattr(ce.imageattr),me+=this.printRid(ce.rids),me+=this.printSimulcast(ce.simulcast),me+=this.printSCTPPort(ce.sctpPort),me+=this.printMaxMessageSize(ce.maxMessageSize),me+=this.printUnrecognized(ce.unrecognized),me}printCandidates(U){return U.map(ce=>"a=candidate:".concat(ce.foundation).concat(y).concat(ce.componentId).concat(y).concat(ce.transport).concat(y).concat(ce.priority).concat(y).concat(ce.connectionAddress).concat(y).concat(ce.port).concat(y,"typ").concat(y).concat(ce.type).concat(ce.relAddr?"".concat(y,"raddr").concat(y).concat(ce.relAddr):"").concat(ce.relPort?"".concat(y,"rport").concat(y).concat(ce.relPort):"").concat(Object.keys(ce.extension).map(me=>"".concat(y).concat(me).concat(y).concat(ce.extension[me])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(U){return U.map(ce=>"a=remote-candidates:".concat(ce.join(y)).concat(this.eol)).join("")}printEndOfCandidates(U){return U===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(U){if(!U.payloads)return"";const ce=U.payloads;let me="";me+=U.rtcpFeedbackWildcards.map(et=>this.printRTCPFeedback("*",et)).join("");for(const et of ce)me+=this.printRtpMap(et.payloadType,et.rtpMap),me+=this.printFmtp(et.payloadType,et.fmtp),me+=et.rtcpFeedbacks.map(Qt=>this.printRTCPFeedback(et.payloadType,Qt)).join("");return me}printFmtp(U,ce){if(!ce)return"";const me=Object.keys(ce.parameters);return me.length===1&&ce.parameters[me[0]]===null?"a=fmtp:".concat(U).concat(y).concat(me[0]).concat(this.eol):"a=fmtp:".concat(U).concat(y).concat(Object.keys(ce.parameters).map(et=>"".concat(et,"=").concat(ce.parameters[et])).join(";")).concat(this.eol)}printRtpMap(U,ce){return ce?"a=rtpmap:".concat(U).concat(y).concat(ce.encodingName,"/").concat(ce.clockRate).concat(ce.encodingParameters?"/".concat(ce.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(U,ce){let me="a=rtcp-fb:".concat(U).concat(y),et=ce;return et.type==="trr-int"?me+="ttr-int".concat(y).concat(et.interval):(me+="".concat(et.type),et.parameter&&(me+="".concat(y).concat(et.parameter),et.additional&&(me+="".concat(y).concat(et.additional)))),me+this.eol}printPtime(U){return U===void 0?"":"a=ptime:".concat(U).concat(this.eol)}printMaxPtime(U){return U===void 0?"":"a=maxptime:".concat(U).concat(this.eol)}printDirection(U){return U===void 0?"":"a=".concat(U).concat(this.eol)}printSSRC(U){return U.map(ce=>Object.keys(ce.attributes).map(me=>"a=ssrc:".concat(ce.ssrcId.toString(10)).concat(y).concat(me).concat(ce.attributes[me]?":".concat(ce.attributes[me]):"").concat(this.eol)).join("")).join("")}printRTCPMux(U){return U===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(U){return U===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(U){return U===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(U){if(U===void 0)return"";let ce="a=rtcp:".concat(U.port);return U.netType&&(ce+="".concat(y).concat(U.netType)),U.addressType&&(ce+="".concat(y).concat(U.addressType)),U.address&&(ce+="".concat(y).concat(U.address)),ce+this.eol}printMSId(U){return U.map(ce=>"a=msid:".concat(ce.id).concat(ce.appdata?"".concat(y).concat(ce.appdata):"").concat(this.eol)).join("")}printImageattr(U){return U.map(ce=>"a=imageattr:".concat(ce).concat(this.eol)).join("")}printRid(U){return U.map(ce=>{let me="a=rid:".concat(ce.id).concat(y).concat(ce.direction);return ce.payloads&&(me+="".concat(y,"pt=").concat(ce.payloads.join(","))),ce.params.length>0&&(me+="".concat(y).concat(ce.params.map(et=>et.type==="depend"?"depend=".concat(et.rids.join(",")):"".concat(et.type,"=").concat(et.val)).join(";"))),me+this.eol}).join("")}printSimulcast(U){return U===void 0?"":"a=simulcast:".concat(U).concat(this.eol)}printSCTPPort(U){return U===void 0?"":"a=sctp-port:".concat(U).concat(this.eol)}printMaxMessageSize(U){return U===void 0?"":"a=max-message-size:".concat(U).concat(this.eol)}printMid(U){return U===void 0?"":"a=mid:".concat(U).concat(this.eol)}printSSRCGroups(U){return U.map(ce=>"a=ssrc-group:".concat(ce.semantic).concat(ce.ssrcIds.map(me=>"".concat(y).concat(me.toString(10))).join("")).concat(this.eol)).join("")}}function st(Ke){return new pt().parse(Ke)}function It(Ke,U){return new di().print(Ke,U)}}},r={};function s(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return t[o](c,c.exports,s),c.exports}return s.d=(o,c)=>{for(var d in c)s.o(c,d)&&!s.o(o,d)&&Object.defineProperty(o,d,{enumerable:!0,get:c[d]})},s.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s(8)})();function Qa(t){return xW.parse(t)}function Hm(t,r){return xW.print(t,r)}var Lfe=yc("Array").keys,Mfe=Gc,Ufe=Ri,Vfe=O,Ffe=Lfe,pL=Array.prototype,jfe={DOMTokenList:!0,NodeList:!0},Bfe=function(t){var r=t.keys;return t===pL||Vfe(pL,t)&&r===pL.keys||Ufe(jfe,Mfe(t))?Ffe:r},sl=l(Bfe);function LW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function ln(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?LW(Object(s),!0).forEach(function(o){Xr(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):LW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Xr(t,r,s){return(r=function(o){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const MW=new class extends zr{constructor(){super(...arguments),Xr(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class zfe{constructor(r){Xr(this,"logger",void 0),Xr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function fL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function UW(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Wl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},JA=Date.now(),AT=t=>{for(const r in Wl)if(Object.prototype.hasOwnProperty.call(Wl,r)&&Wl[r]===t)return r;return"DEFAULT"},x=new class{constructor(){Xr(this,"proxyServerURL",void 0),Xr(this,"logLevel",Wl.DEBUG),Xr(this,"uploadState","collecting"),Xr(this,"uploadLogWaitingList",[]),Xr(this,"uploadLogUploadingList",[]),Xr(this,"uploadErrorCount",0),Xr(this,"currentLogID",0),Xr(this,"url",void 0),Xr(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Wl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Wl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Wl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Wl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Wl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){or("UPLOAD_LOG",!0)}disableLogUpload(){or("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new zfe(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-JA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-JA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=fL()+" Agora-SDK [".concat(AT(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=fL()+" %cAgora-SDK [".concat(AT(o),"]:");let d=[];if(!se("USE_NEW_LOG"))switch(o){case Wl.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Wl.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Wl.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Wl.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-JA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-JA);const o=Math.max(0,Math.min(4,r[0]));r[0]=fL()+" Agora-SDK [".concat(AT(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(t){if(!se("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];Array.isArray(s[0])?s[0][0]=UW()+" Agora-SDK [".concat(AT(t),"]:"):s[0]=UW()+" Agora-SDK [".concat(AT(t),"]:");let c="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:zl,process_id:se("PROCESS_ID"),payload:JSON.stringify(t)};return xd(async()=>{const s=await ba.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(se("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(se("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=s,o}},()=>(this.uploadLogUploadingList=[],!1),s=>{const o={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(o.status=s.response.status,o.data=s.response.data,o.headers=s.response.headers):s.request&&(o.status=s.request.status),MW.reportLogUploadError(o),!0},{timeout:se("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:se("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,se("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var VW;function Wfe(t){return ms(t.reportId,"params.reportId",0,100,!1),ms(t.category,"params.category",0,100,!1),ms(t.event,"params.event",0,100,!1),ms(t.label,"params.label",0,100,!1),ur(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(VW={}).FREE="free",VW.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const Gfe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Xi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Ur=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Hfe=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Ht(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,o){const c=o.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,y=new Array(m),v=0;v<m;v++)y[v]=arguments[v];let S=y;if(t.argsMap)try{S=t.argsMap(this,...y)}catch(P){x.warning(P),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),S=[]}const R=(t.report||Ot).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:S,tag:qr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const P=c.apply(this,y);return P instanceof ht?P.then(D=>(R.onSuccess(t.reportResult&&D),D)).catch(D=>{throw R.onError(D),D}):(R.onSuccess(t.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const Ot=new class{constructor(){Xr(this,"baseInfoMap",new Map),Xr(this,"proxyServer",void 0),Xr(this,"eventUploadTimer",void 0),Xr(this,"setSessionIdTimer",void 0),Xr(this,"url",void 0),Xr(this,"sids",new Set),Xr(this,"backupUrl",void 0),Xr(this,"_appId",void 0),Xr(this,"_aid",0),Xr(this,"keyEventUploadPendingItems",[]),Xr(this,"normalEventUploadPendingItems",[]),Xr(this,"apiInvokeUploadPendingItems",[]),Xr(this,"apiInvokeCount",0),Xr(this,"apiInvokeLoggedCount",0),Xr(this,"ltsList",[]),Xr(this,"lastSendNormalEventTime",Date.now()),Xr(this,"customReportCounterTimer",void 0),Xr(this,"customReportCount",0),Xr(this,"extApiInvoke",async t=>{for(const r of t){const s=ln(ln({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:qr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),se("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),se("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,o]=r;return s+o}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!se("SHOW_REPORT_INVOKER_LOG"),h=!!se("SHOW_REPORT_USER_INVOKER_LOG"),m=d||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function v(D,G){if(m){let j="[apiInvoke-".concat(y,"]");r.id&&(j+="[".concat(r.id,"]")),r.name&&(j+="[".concat(r.name,"]")),x.info("".concat(j," ").concat(D),D==="start"?r.options:G||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});v("start");let R=!1;gs(r.timeout).then(()=>{R||(this.sendApiInvoke(ln(ln({},S()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const P=new Le(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:D=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(ln(ln({},S()),{},{success:!0},r.reportResult&&{result:D})),v("onSuccess"),D};return s?_W(G,r.name+"Success",s,()=>R=!0):G()},onError:D=>{const G=()=>{if(R)throw D;R=!0,this.sendApiInvoke(ln(ln({},S()),{},{success:!1,error:D})),v("onFailure",D.toString())};return s?_W(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),o=this.createBaseInfo(t,s);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:se("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:lL?"global":"oversea",areas:se("AREAS")&&se("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientRole:S}=r,R=Date.now(),P=ln(ln({},o),{},{eventType:Xi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:dL,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:se("PROCESS_ID"),appType:se("APP_TYPE"),success:!0,version:zl,stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientType:ot(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:S,serviceId:se("PROCESS_ID"),extensionID:se("PLUGIN_INFO").join(",")||""});var D;this.send({type:Ur.SESSION,data:P},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln({},o),{},{role:r.role,eventType:Xi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Ur.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln({},o),{},{eventType:Xi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Ur.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:d,avoidJoinStartTime:h,addr:m,isProxy:y}=r,v=c-(d&&h?h:s.startTime),S=ln(ln({},o),{},{eventType:Xi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:v,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:cL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:Ur.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(y){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),j=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split("=")[1]:"",isProxy:y?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),j=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const D=Object.assign({},S,P,{eventType:Xi.REJOIN_GATEWAY});this.send({type:Ur.RE_JOIN_GATEWAY,data:D},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=Date.now(),c=ln(ln({},s.info),{},{lts:o,timeout:r,elapse:o-s.startTime});this.send({type:Ur.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln({},o),{},{eventType:Xi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Ur.PUBLISH,data:d},!0)}subscribe(t,r,s){const o=this.baseInfoMap.get(t);if(!o)return;const c=o.info,d=Date.now(),h=ln(ln({},c),{},{eventType:Xi.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Ur.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...sl(r=this.baseInfoMap).call(r)],o=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const d=c.info,h=Date.now(),m=ln(ln({},d),{},{eventType:Xi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Ur.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=ln(ln(ln({},d),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=ln(ln(ln({},d),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln(ln({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Xi.AB_TEST,lts:c});this.send({type:Ur.AB_TEST,data:d},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln(ln({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Xi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Ur.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln(ln({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Xi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Ur.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=ln(ln(ln({},d),o),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln({},o),{},{eventType:Xi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Ur.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln({},o),{},{eventType:Xi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Ur.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln({},o),{},{eventType:Xi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Ur.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Ur.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now();(function(d,h,m){const y=d[h];if(!y||typeof y!="string")return[d];d[h]="";const v=Lh(JSON.stringify(d));let S=0;const R=[];let P=0;for(let D=0;D<y.length;D++)P+=y.charCodeAt(D)<=127?1:3,P<=m-v||(R[R.length]=bt(bt({},d),{},{[h]:y.substring(S,D)}),S=D,P=y.charCodeAt(D)<=127?1:3);return S!==y.length-1&&(R[R.length]=bt(bt({},d),{},{[h]:y.substring(S)})),R})(ln(ln(ln({},o),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:Ur.WORKER_EVENT,data:d},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln(ln({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Ur.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln(ln({},o),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Ur.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=ln(ln(ln({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Ur.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>se("CUSTOM_REPORT_LIMIT"))throw new Le(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),o=r.map(c=>({type:Ur.USER_ANALYTICS,data:ln(ln({sid:t},c),{},{lts:s})}));try{se("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new Le(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=se("NOT_REPORT_EVENT");if(t.tag&&ot(r)&&ot(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:o,uid:c,cid:d}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:y,message:v}=t.error;h=y||v||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:o,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Ur.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>se("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],o=[];for(;t.length;){const d=t.shift();s.length<20?s.push(d):o.push(d)}t.push(...o);for(const d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),aT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),se("ENABLE_EVENT_REPORT")&&s.length&&(se("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{se("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>se("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-se("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){yi.networkState===Rc.OFFLINE&&await ht.race([yi.onlineWaiter,gs(2*Oi.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach(h=>{const m=Xx(JSON.stringify(h.data)),y=new ArrayBuffer(5),v=(R=>{let P=0;return Object.entries(Ur).forEach(D=>{let[G,j]=D;j===R.type&&(P=Hfe[G])}),P})(h),S=new DataView(y);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&v),S.setUint8(3,v>>>8&255),S.setUint8(4,v>>>16&255),d=cW(d,new Uint8Array(y)),d=cW(d,m)}),d},s="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(se("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(se("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await rL(o,{timeout:1e4,data:r(t),headers:ln(ln({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const y=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return y&&y.info.vid&&+y.info.vid||0})(t[0]),o=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:o};yi.networkState===Rc.OFFLINE&&await ht.race([yi.onlineWaiter,gs(2*Oi.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("EVENT_REPORT_DOMAIN"),"&p=").concat(se("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(se("EVENT_REPORT_DOMAIN"),":").concat(se("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(se("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(se("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(se("STATS_COLLECTOR_PORT")).concat(d)));try{r?await Ofe(h,{timeout:1e4,data:c}):await rL(h,{timeout:1e4,data:c})}catch(y){if(m===1)throw y;continue}return}}createBaseInfo(t,r){const s=Object.assign({},Gfe);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),o=s[s.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:qr.TRACER}).onSuccess()}};MW.on("REPORT_LOG_UPLOAD",t=>{t.networkState=yi.networkState,Ot.reportApiInvoke(null,{name:"logUploadError",options:t,tag:qr.TRACER}).onSuccess("logUploadError")});class Ae extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Xr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const _s={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function jn(){return _s}function FW(){return"setSinkId"in HTMLAudioElement.prototype&&(!se("RESTRICTION_SET_PLAYBACK_DEVICE")||(of()||Xz())&&!Kx())}function jW(){return!_s.supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&af()}let ys=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Gv(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Ln(t,r,s,o,c){return{width:t,height:r,frameRate:s,bitrateMin:o,bitrateMax:c}}function Lu(t,r,s,o,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:o,bitrateMax:c}}function mL(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const $fe={"90p":Ln(160,90),"90p_1":Ln(160,90),"120p":Ln(160,120,15,30,65),"120p_1":Ln(160,120,15,30,65),"120p_3":Ln(120,120,15,30,50),"120p_4":Ln(212,120),"180p":Ln(320,180,15,30,140),"180p_1":Ln(320,180,15,30,140),"180p_3":Ln(180,180,15,30,100),"180p_4":Ln(240,180,15,30,120),"240p":Ln(320,240,15,40,200),"240p_1":Ln(320,240,15,40,200),"240p_3":Ln(240,240,15,40,140),"240p_4":Ln(424,240,15,40,220),"360p":Ln(640,360,15,80,400),"360p_1":Ln(640,360,15,80,400),"360p_3":Ln(360,360,15,80,260),"360p_4":Ln(640,360,30,80,600),"360p_6":Ln(360,360,30,80,400),"360p_7":Ln(480,360,15,80,320),"360p_8":Ln(480,360,30,80,490),"360p_9":Ln(640,360,15,80,800),"360p_10":Ln(640,360,24,80,800),"360p_11":Ln(640,360,24,80,1e3),"480p":Ln(640,480,15,100,500),"480p_1":Ln(640,480,15,100,500),"480p_2":Ln(640,480,30,100,1e3),"480p_3":Ln(480,480,15,100,400),"480p_4":Ln(640,480,30,100,750),"480p_6":Ln(480,480,30,100,600),"480p_8":Ln(848,480,15,100,610),"480p_9":Ln(848,480,30,100,930),"480p_10":Ln(640,480,10,100,400),"720p":Ln(1280,720,15,120,1130),"720p_auto":Ln(1280,720,30,900,3e3),"720p_1":Ln(1280,720,15,120,1130),"720p_2":Ln(1280,720,30,120,2e3),"720p_3":Ln(1280,720,30,120,1710),"720p_5":Ln(960,720,15,120,910),"720p_6":Ln(960,720,30,120,1380),"1080p":Ln(1920,1080,15,120,2080),"1080p_1":Ln(1920,1080,15,120,2080),"1080p_2":Ln(1920,1080,30,120,3e3),"1080p_3":Ln(1920,1080,30,120,3150),"1080p_5":Ln(1920,1080,60,120,4780),"1440p":Ln(2560,1440,30,120,4850),"1440p_1":Ln(2560,1440,30,120,4850),"1440p_2":Ln(2560,1440,60,120,7350),"4k":Ln(3840,2160,30,120,8910),"4k_1":Ln(3840,2160,30,120,8910),"4k_3":Ln(3840,2160,60,120,13500)},Kfe={"480p":Lu(640,480,5),"480p_1":Lu(640,480,5),"480p_2":Lu(640,480,30),"480p_3":Lu(640,480,15),"720p":Lu(1280,720,5),"720p_auto":Ln(1280,720,30,900,3e3),"720p_1":Lu(1280,720,5),"720p_2":Lu(1280,720,30),"720p_3":Lu(1280,720,15),"1080p":Lu(1920,1080,5),"1080p_1":Lu(1920,1080,5),"1080p_2":Lu(1920,1080,30),"1080p_3":Lu(1920,1080,15)},qfe={"1SL1TL":mL(1,1),"3SL3TL":mL(3,3),"2SL3TL":mL(2,3)};function Uh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},$fe[t]):t}function gL(t){return typeof t=="string"?Object.assign({},Kfe[t]):t}function QA(t){return typeof t=="string"?Object.assign({},qfe[t]):t}const Yfe={speech_low_quality:Gv(16e3,!1),speech_standard:Gv(32e3,!1,18),music_standard:Gv(48e3,!1),standard_stereo:Gv(48e3,!0,56),high_quality:Gv(48e3,!1,128),high_quality_stereo:Gv(48e3,!0,192)};function ZA(t){return typeof t=="string"?Object.assign({},Yfe[t]):t}const Hv=[];function BW(t){return Wi(t,"mediaSource",["screen","window","application"]),!0}let Ct=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),_r=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),$v=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),Xfe=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),Jfe=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),G_=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Kv=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),qv=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Yv=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),ol=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const _L={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},yL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},zW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Qfe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},WW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Xo=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),al=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),PT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),H_=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),So=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Vh=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const EL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let eP=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function GW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Vr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?GW(Object(s),!0).forEach(function(o){Ie(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):GW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Ie(t,r,s){return(r=function(o){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Mn(t,r,s,o,c){var d,h,m={};return Object.keys(o).forEach(function(y){m[y]=o[y]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ec(d=gm(h=s.slice()).call(h)).call(d,function(y,v){return v(t,r,y)||y},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class HW extends zr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(G_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Ie(this,"trackMediaType",void 0),Ie(this,"_ID",void 0),Ie(this,"_rtpTransceiver",void 0),Ie(this,"_lowRtpTransceiver",void 0),Ie(this,"_hints",[]),Ie(this,"_isClosed",!1),Ie(this,"_originMediaStreamTrack",void 0),Ie(this,"mediaStreamTrack",void 0),Ie(this,"_external",{}),this._ID=s||gr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){ot(Hv).call(Hv,o)||Hv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Wm(()=>{var s;Ot.reportApiInvoke(null,{name:Pi.GET_MEDIA_STREAM_TRACK,options:[],tag:qr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===$v.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Hv.indexOf(r);s!==-1&&Hv.splice(s,1)}(this),this.emit(Kv.CLOSED),this.removeAllListeners(G_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===$v.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(G_.TRANSCEIVER_UPDATED,r,s)}}class Xv extends HW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Ie(this,"_enabled",!0),Ie(this,"_muted",!1),Ie(this,"_isExternalTrack",!1),Ie(this,"_isClosed",!1),Ie(this,"_enabledMutex",void 0),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ks("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ct.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mr(this,Ct.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Kv.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),cf(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ht.resolve([])}}const $W=window.AudioContext||window.webkitAudioContext;let cl=null;const ar=new class extends zr{constructor(){super(...arguments),Ie(this,"prevState",void 0),Ie(this,"curState",void 0),Ie(this,"currentTime",void 0),Ie(this,"currentTimeStuckAt",void 0),Ie(this,"interruptDetectorTrack",void 0),Ie(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(ys.IOS_15_16_INTERRUPTION_START)}),Ie(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(cl&&await cl.suspend(),this.emit(ys.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Jv(){if(!cl){if(function(){if(!$W)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Vr({},se("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),cl=new $W(t),ar.curState=cl.state,cl.onstatechange=()=>{ar.prevState=ar.curState,ar.curState=cl?cl.state:void 0;const{prevState:r,curState:s}=ar,o=s==="running",c=s==="interrupted",d=r==="running",h=r==="suspended",m=r==="interrupted",y=xn().osVersion;(Yo()||Du())&&d&&c&&(x.info("ios".concat(y,"-interruption-start")),ar.emit(ys.IOS_INTERRUPTION_START)),(Yo()||Du())&&(h||m)&&o&&(x.info("ios".concat(y,"-interruption-end")),ar.emit(ys.IOS_INTERRUPTION_END)),r!==s&&ar.emit(ys.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=cl)===null||r===void 0?void 0:r.currentTime;ar.currentTime!==s?(ar.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),ar.currentTimeStuckAt=void 0),ar.currentTime=s):(s!==ar.currentTimeStuckAt&&(Ot.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:qr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),ar.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,d=!1,h=!1;function m(j){r.state==="running"?y(!1):Yo()||Du()?r.state==="suspended"&&(y(!0),j&&r.resume().then(v,v)):r.state!=="closed"&&(y(!0),j&&r.resume().then(v,v))}function y(j){if(c!==j){c=j;for(let B=0,J=s;B<J.length;B+=1){const ee=J[B];j?window.addEventListener(ee,S,{capture:!0,passive:!0}):window.removeEventListener(ee,S,{capture:!0,passive:!0})}}}function v(){m(!1)}function S(){m(!0)}function R(j){if(!h)if(o.paused)if(j){let B;P(!1),h=!0;try{B=o.play(),B?B.then(D,D):(o.addEventListener("playing",D),o.addEventListener("abort",D),o.addEventListener("error",D))}catch{D()}}else P(!0);else P(!1)}function P(j){if(d!==j){d=j;for(let B=0,J=s;B<J.length;B++){const ee=J[B];j?window.addEventListener(ee,G,{capture:!0,passive:!0}):window.removeEventListener(ee,G,{capture:!0,passive:!0})}}}function D(){o.removeEventListener("playing",D),o.removeEventListener("abort",D),o.removeEventListener("error",D),h=!1,R(!1)}function G(){R(!0)}if(Yo()){const j=r.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=B.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=j.stream,R(!0)}ar.on(ys.STATE_CHANGE,function(){m(!0)}),m(!1)}(cl)}(),!cl)throw new Le(te.NOT_SUPPORTED,"can not create audio context");return cl}return cl}function $_(t){if(function(){if(vL!==null)return vL;const o=Jv(),c=o.createBufferSource(),d=o.createGain(),h=o.createGain();c.connect(d),c.connect(h),c.disconnect(d);let m=!1;try{c.disconnect(d)}catch{m=!0}return c.disconnect(),vL=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(o,c,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),ot(h=t._inputNodes).call(h,o)||(o instanceof AudioNode?(t._inputNodes.push(o),r.call(t,o,c,d)):r.call(t,o,c)),t},t.disconnect=(o,c,d)=>{s.call(t),o?WA(t._inputNodes,o):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let vL=null;function SL(t,r){let s=!1;const o=1/r;if(se("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*o)}else{const c=Jv();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(s)return void(d=null);const m=c.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(c.currentTime+o),t(c.currentTime)};h()}return()=>{s=!0}}class KW{constructor(){Ie(this,"context",void 0),Ie(this,"analyserNode",void 0),Ie(this,"sourceNode",void 0),this.context=Jv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Yo()||Du()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const s=Ec(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class qW extends zr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ie(this,"outputNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"isPlayed",!1),Ie(this,"sourceNode",void 0),Ie(this,"context",void 0),Ie(this,"audioBufferNode",void 0),Ie(this,"destNode",void 0),Ie(this,"audioOutputLevel",0),Ie(this,"volumeLevelAnalyser",void 0),Ie(this,"_processedNode",void 0),Ie(this,"playNode",void 0),Ie(this,"isDestroyed",!1),Ie(this,"onNoAudioInput",void 0),Ie(this,"isNoAudioInput",!1),Ie(this,"_noAudioInputCount",0),this.context=Jv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),$_(this.outputNode),this.volumeLevelAnalyser=new KW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(ol.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const d=o.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return o.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!jn().webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&GA(()=>{ar.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Yo()||Du()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let o;s.getFloatTimeDomainData?(o=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o)):(o=new Uint8Array(s.fftSize),s.getByteTimeDomainData(o));let c=!1;for(let d=0;d<o.length;d++)o[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await gs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class YW extends qW{get isFreeze(){return!1}constructor(r,s,o){var c;if(super(),Ie(this,"sourceNode",void 0),Ie(this,"track",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"audioElement",void 0),Ie(this,"isCurrentTrackCloned",!1),Ie(this,"isRemoteTrack",!1),Ie(this,"originVolumeLevelAnalyser",void 0),Ie(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),$_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),$_(this.outputNode),this.emit(ol.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(te.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),$_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([m]));$_(y),this.originVolumeLevelAnalyser=new KW,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=xn();s&&h.os===Yi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(ar.on(ys.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),$_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ol.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),ar.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([s]));$_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function XW(t,r,s){const o=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Zfe(t,r){const s=await JW(t.mediaSource),{sourceId:o,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ht((m,y)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(J);const ee=new Error("NotAllowedError");ee.name="NotAllowedError",y(ee)};let j=h;const B=document.createElement("div");if(h){const ee=document.createElement("input");ee.setAttribute("type","checkbox");const fe=document.createElement("span");ee.setAttribute("style","margin-right: 6px;"),fe.innerText="Share audio",ee.checked=j,ee.onchange=()=>{j=ee.checked},B.appendChild(ee),B.appendChild(fe)}D.appendChild(B),D.appendChild(G),S.appendChild(R),S.appendChild(P),S.appendChild(D);const J=document.createElement("div");J.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),J.appendChild(v),J.appendChild(S),document.body.appendChild(J),d.map(ee=>{if(ee.id){const fe=document.createElement("div");fe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=ee.thumbnail;try{const{width:ve}=ye.getSize();ve>1920&&(ye=ye.resize({width:1920}))}catch(ve){throw ve&&ve.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ve}fe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+ee.name.replace(/[\u00A0-\u9999<>\&]/g,function(ve){return"&#"+ve.charCodeAt(0)+";"})+"</span>",fe.onclick=()=>{document.body.removeChild(J),m({sourceId:ee.id,audio:j})},P.appendChild(fe)}})})}(s,r);return await XW(o,t,c)}async function JW(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=lW();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(te.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new ht((d,h)=>{s.desktopCapturer.getSources({types:r},(m,y)=>{m?h(m):d(y)})}));try{return await o}catch(d){throw new Le(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const bL=new Ks("safari");let QW=!1,ZW=!1;async function ll(t,r){let s=0,o=null;for(;s<2;)try{o=await eme(t,r,s>0);break}catch(c){if(c instanceof Le)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const d=tP(c.name||c.code||c,c.message);if(d.code===te.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await gs(500);continue}throw x.error("[".concat(r,"] ").concat(d.toString())),d}if(!o)throw new Le(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function eme(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const o=jn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(lW())t.screen.sourceId?Qv(c,await XW(t.screen.sourceId,t.screen,!!t.screenAudio)):Qv(c,await Zfe(t.screen,!!t.screenAudio));else if(of()&&t.screen.extensionId&&t.screen.mandatory){if(!o.getStreamFromExtension)throw new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=t.screen.extensionId,m=r,new ht((D,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},j=>{if(!j||!j.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),j),void G(new Le(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(j.streamId)})}catch(j){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),j.toString()),G(new Le(te.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=P,Qv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(o.getDisplayMedia){var d;t.screen.mediaSource&&BW(t.screen.mediaSource);const P={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:G,systemAudio:j,preferCurrentTab:B}=t.screen,J={selfBrowserSurface:D,surfaceSwitching:G,systemAudio:j,preferCurrentTab:B};!D&&delete J.selfBrowserSurface,!G&&delete J.surfaceSwitching,!j&&delete J.systemAudio,!B&&delete J.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:t.screenAudio,controls:J})),Qv(c,await navigator.mediaDevices.getDisplayMedia(Vr({video:P,audio:t.screenAudio},J)))}else{if(!$r())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&BW(t.screen.mediaSource);const P={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),Qv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!t.video&&!t.audio)return c;let y={video:t.video,audio:t.audio},v=se("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),y=Zx(y,v)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(y)),xn();let S,R=null;(Ls()||Yo()||BA())&&(R=await bL.lock());try{S=await navigator.mediaDevices.getUserMedia(y)}catch(P){throw R&&R(),P}return y.audio&&(QW=!0),y.video&&(ZW=!0),Qv(c,S),R&&R(),c}function tP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(te.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(te.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(te.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(te.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(te.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(te.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new Le(te.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function Qv(t,r){const s=t.getVideoTracks()[0],o=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(o&&t.removeTrack(o),t.addTrack(d)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const ul=new class extends zr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(H_.STATE_CHANGE,t),this._state=t)}constructor(){super(),Ie(this,"_state",PT.IDLE),Ie(this,"isAccessMicrophonePermission",!1),Ie(this,"isAccessCameraPermission",!1),Ie(this,"lastAccessMicrophonePermission",!1),Ie(this,"lastAccessCameraPermission",!1),Ie(this,"checkdeviceMatched",!1),Ie(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(se("ENUMERATE_DEVICES_INTERVAL")||(zA()||jA()===Yi.HARMONY_OS)&&af())&&this.updateDevicesInfo()},se("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(h=!1);let m=null,y=null,v=null;if(!s&&(d||h)){if(bL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await bL.lock())(),x.debug("[device manager] GUM unlock")),QW&&(d=!1,this.isAccessMicrophonePermission=!0),ZW&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,d,h),d&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=tP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(S){const R=tP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{y=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=tP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,new Le(te.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new Le(te.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=PT.INITING;try{await this.updateDevicesInfo(),this.state=PT.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=PT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=r)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==PT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(H_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(H_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(H_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){o.video=!0;break}return o}};let TL=!1;const dl=new class extends zr{constructor(){super(...arguments),Ie(this,"onAutoplayFailed",void 0),Ie(this,"onAudioAutoplayFailed",void 0)}};function e8(){if(xn(),!TL){const t=r=>{r.preventDefault(),TL=!1,vT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};TL=!0,vT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),dl.onAutoplayFailed?dl.onAutoplayFailed():dl.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),dl.emit("autoplay-failed")}}function t8(t,r,s,o){if(!t)return;const c=Ot.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,h=Date.now(),m=Vr(Vr({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:dl.onAutoplayFailed||dl.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:o,extend:void 0});Ot.send({type:Ur.AUTOPLAY_FAILED,data:m},!0)}const tme=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ta=new class{constructor(){Ie(this,"onAutoplayFailed",void 0),Ie(this,"elementMap",new Map),Ie(this,"elementStateMap",new Map),Ie(this,"elementsNeedToResume",[]),Ie(this,"sinkIdMap",new Map),Ie(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,o]=r;const c=this.elementStateMap.get(s),d=o.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return o.pause(),void o.play();if(ar.curState==="running")return Vv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const o=s.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),ar.on(ys.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ar.on(ys.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ar.on(ys.STATE_CHANGE,()=>{Yo()&&ar.prevState==="suspended"&&ar.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(o){throw new Le(te.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(t,r,s,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,So.INIT),this.setVolume(r,s);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&t8(o,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),GA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),e8()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){tme.forEach(s=>{r.addEventListener(s,o=>{const c=this.elementStateMap.get(t),d=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),o.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new ht(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{vT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function li(){return function(t,r,s){const o=s.value;return typeof o=="function"&&(s.value=function(){this._isClosed&&new Le(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const m=o.apply(this,d);return m instanceof ht?new ht((y,v)=>{m.then(y).catch(v)}):m}),s}}class n8 extends zr{constructor(r){super(),Ie(this,"name","VideoProcessorDestination"),Ie(this,"ID","0"),Ie(this,"_source",void 0),Ie(this,"videoContext",void 0),Ie(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Xo.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Xo.ON_TRACK,void 0)}}class r8 extends zr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"usageRegistry",[]),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Us(this,al.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),mr(this,al.REQUEST_UPDATE_CONSTRAINTS,Array.from(tl(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),mr(this,al.REQUEST_UPDATE_CONSTRAINTS,Array.from(tl(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof ht&&(o=await o),r.push(Vr(Vr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class i8 extends zr{constructor(r){super(),Ie(this,"name","AudioProcessorDestination"),Ie(this,"ID","0"),Ie(this,"inputTrack",void 0),Ie(this,"inputNode",void 0),Ie(this,"audioProcessorContext",void 0),Ie(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Xo.ON_TRACK,void 0),this.emit(Xo.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Xo.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Xo.ON_NODE,this.inputNode))}}class s8 extends zr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,o){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"audioContext",void 0),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"usageRegistry",[]),Ie(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=o}async getConstraints(){return Us(this,al.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),mr(this,al.REQUEST_UPDATE_CONSTRAINTS,Array.from(tl(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),mr(this,al.REQUEST_UPDATE_CONSTRAINTS,Array.from(tl(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof ht&&(o=await o),r.push(Vr(Vr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class wL extends zr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ie(this,"context",void 0),Ie(this,"processSourceNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"processedNode",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"outputNode",void 0),this.outputNode=new nme}setVolume(){}createOutputTrack(){throw new Le(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class nme{disconnect(){}connect(){}}function o8(t){return new ht((r,s)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=Yo()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&$r()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(HA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function nP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=Uh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!iW()&&s.frameRate&&(r.frameRate=s.frameRate),Xz()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),$r()&&(r.frameRate={ideal:30,max:30}),r}function a8(t){const r={};return iW()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,of()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function c8(t){const r=a8(t);if(t.encoderConfig){const s=ZA(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),zA()&&(r.sampleRate=void 0),r}const rme=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:o,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=s,width:h=o,height:m=c}=r;if(!d||!h||!m)return;h=eL(h),m=eL(m),d=eL(d);const{max:y,min:v}=function(D,G,j){const B=200*Math.pow(j/15,.6)*Math.pow(D*G/640/360,.75);return{min:Math.floor(B),max:Math.floor(4*B)}}(h,m,d),{bitrateMax:S,bitrateMin:R}=r||{};S||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=se("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(d=Math.min(d,P)),{frameRate:d,bitrateMax:S||y,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},l8=async(t,r,s)=>await(async(o,c,d)=>{const h=function(v){const S=[];for(let R=0;R<v.length;R+=2)S.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(S)}(vW(""+c+d)).slice(0,16),m=h.slice(0,12),y=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},y,o))})(t.buffer,r,s),CL=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new ht((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const d=await u8(c);s({buffer:d,width:r.width,height:r.height})}else o(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},u8=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var d8,h8,p8,f8,m8,g8,_8,y8,E8,v8,S8,b8,T8,w8,C8,R8,I8,A8,Wr,P8,O8,k8,N8,D8,x8,Fh,L8,M8,U8,V8,F8,j8,B8,z8,W8,G8,H8,$8,K8,Fs;let Qr=(d8=Ht({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),h8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),p8=li(),f8=Bv("LocalAudioTrack","_enabledMutex"),m8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),g8=li(),_8=Bv("LocalAudioTrack","_enabledMutex"),y8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),E8=li(),v8=li(),S8=li(),b8=Ht({argsMap:t=>[t.getTrackId()]}),T8=li(),w8=Ht({argsMap:t=>[t.getTrackId()]}),C8=li(),R8=Ht({argsMap:t=>[t.getTrackId()]}),I8=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),A8=Ht({argsMap:t=>[t.getTrackId()]}),Mn((Wr=class extends Xv{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ta.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,o){super(t,s),Ie(this,"trackMediaType",Yv.AUDIO),Ie(this,"_encoderConfig",void 0),Ie(this,"_trackSource",void 0),Ie(this,"metadata",[]),Ie(this,"_enabled",!0),Ie(this,"_volume",100),Ie(this,"_useAudioElement",!0),Ie(this,"_bypassWebAudio",!1),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_processorDestination",void 0),Ie(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new wL,se("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),se("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ls()&&!cl?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){ur(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Ta.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,mr(this,Ct.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!FW())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ta.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await mr(this,Ct.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(o){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await mr(this,Ct.NEED_DISABLE_TRACK,this)}catch(o){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await mr(this,Ct.NEED_MUTE_TRACK,this):await mr(this,Ct.NEED_UNMUTE_TRACK,this))}getStats(){return Wm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),rl(this,Ct.GET_STATS)||Vr({},_L)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ol.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(ol.ON_AUDIO_BUFFER),this._source.on(ol.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ta.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ta.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ta.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mr(this,Ct.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return ht.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Xo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await mr(this,Ct.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mr(this,Ct.NEED_REPLACE_TRACK,this))}),t.on(Xo.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Xo.ON_TRACK),t.removeAllListeners(Xo.ON_NODE)}bindProcessorContextEvents(t){t.on(al.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(al.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof wL&&(this._trackSource=new YW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new s8(this._source.context,this.getTrackId(),"local"),r=new i8(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(ol.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ta.stop(this.getTrackId()),this._source.play()),mr(this,Ct.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[d8],Object.getOwnPropertyDescriptor(Wr.prototype,"setVolume"),Wr.prototype),Mn(Wr.prototype,"setPlaybackDevice",[h8,p8],Object.getOwnPropertyDescriptor(Wr.prototype,"setPlaybackDevice"),Wr.prototype),Mn(Wr.prototype,"setEnabled",[f8,m8,g8],Object.getOwnPropertyDescriptor(Wr.prototype,"setEnabled"),Wr.prototype),Mn(Wr.prototype,"setMuted",[_8,y8,E8],Object.getOwnPropertyDescriptor(Wr.prototype,"setMuted"),Wr.prototype),Mn(Wr.prototype,"getStats",[v8],Object.getOwnPropertyDescriptor(Wr.prototype,"getStats"),Wr.prototype),Mn(Wr.prototype,"setAudioFrameCallback",[S8],Object.getOwnPropertyDescriptor(Wr.prototype,"setAudioFrameCallback"),Wr.prototype),Mn(Wr.prototype,"play",[b8,T8],Object.getOwnPropertyDescriptor(Wr.prototype,"play"),Wr.prototype),Mn(Wr.prototype,"stop",[w8,C8],Object.getOwnPropertyDescriptor(Wr.prototype,"stop"),Wr.prototype),Mn(Wr.prototype,"close",[R8],Object.getOwnPropertyDescriptor(Wr.prototype,"close"),Wr.prototype),Mn(Wr.prototype,"pipe",[I8],Object.getOwnPropertyDescriptor(Wr.prototype,"pipe"),Wr.prototype),Mn(Wr.prototype,"unpipe",[A8],Object.getOwnPropertyDescriptor(Wr.prototype,"unpipe"),Wr.prototype),Wr),rP=(P8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),O8=li(),k8=Bv("MicrophoneAudioTrack","_enabledMutex"),N8=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),D8=li(),x8=Ht({argsMap:t=>[t.getTrackId()]}),Mn((Fh=class extends Qr{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,o){super(t,r.encoderConfig?ZA(r.encoderConfig):{},o,se("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ie(this,"_config",void 0),Ie(this,"_deviceName","default"),Ie(this,"_constraints",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Vv()||$x())&&ar.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await ul.getDeviceById(t),s={};s.audio=Vr({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let o=null;try{o=await ll(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await ll({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await ul.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),se("AUTO_RESET_AUDIO_ROUTE")&&(Yo()||Du())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),s||(this._enabled=!1);try{await mr(this,Ct.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Vr({},this._constraints),d=ul.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await ll({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await mr(this,Ct.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Vv()||$x())&&ar.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Yo()||Du())&&this._enabled&&!this._isClosed&&ar.duringInterruption){const t=async()=>{ar.off(ys.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ar.on(ys.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Kv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=ul.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await ll({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(al.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(al.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[P8,O8],Object.getOwnPropertyDescriptor(Fh.prototype,"setDevice"),Fh.prototype),Mn(Fh.prototype,"setEnabled",[k8,N8,D8],Object.getOwnPropertyDescriptor(Fh.prototype,"setEnabled"),Fh.prototype),Mn(Fh.prototype,"close",[x8],Object.getOwnPropertyDescriptor(Fh.prototype,"close"),Fh.prototype),Fh),ime=(L8=Ht({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),M8=li(),U8=Ht({argsMap:t=>[t.getTrackId()]}),V8=li(),F8=Ht({argsMap:t=>[t.getTrackId()]}),j8=li(),B8=Ht({argsMap:t=>[t.getTrackId()]}),z8=li(),W8=Ht({argsMap:t=>[t.getTrackId()]}),G8=li(),H8=Ht({argsMap:t=>[t.getTrackId()]}),$8=Ht({argsMap:t=>[t.getTrackId()]}),K8=li(),Mn((Fs=class extends Qr{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,o){super(r.createOutputTrack(),s,o),Ie(this,"source",void 0),Ie(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(ol.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Kv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){ur(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[L8,M8],Object.getOwnPropertyDescriptor(Fs.prototype,"startProcessAudioBuffer"),Fs.prototype),Mn(Fs.prototype,"pauseProcessAudioBuffer",[U8,V8],Object.getOwnPropertyDescriptor(Fs.prototype,"pauseProcessAudioBuffer"),Fs.prototype),Mn(Fs.prototype,"seekAudioBuffer",[F8,j8],Object.getOwnPropertyDescriptor(Fs.prototype,"seekAudioBuffer"),Fs.prototype),Mn(Fs.prototype,"resumeProcessAudioBuffer",[B8,z8],Object.getOwnPropertyDescriptor(Fs.prototype,"resumeProcessAudioBuffer"),Fs.prototype),Mn(Fs.prototype,"stopProcessAudioBuffer",[W8,G8],Object.getOwnPropertyDescriptor(Fs.prototype,"stopProcessAudioBuffer"),Fs.prototype),Mn(Fs.prototype,"close",[H8],Object.getOwnPropertyDescriptor(Fs.prototype,"close"),Fs.prototype),Mn(Fs.prototype,"setAudioBufferPlaybackSpeed",[$8,K8],Object.getOwnPropertyDescriptor(Fs.prototype,"setAudioBufferPlaybackSpeed"),Fs.prototype),Fs);class Ui extends Qr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Jv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,gr(8,"track-mix-")),Ie(this,"trackList",void 0),Ie(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}WA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Ui?s.emit(G_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class sme extends qW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(ol.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ie(this,"audioBuffer",void 0),Ie(this,"sourceNode",void 0),Ie(this,"startPlayTime",0),Ie(this,"startPlayOffset",0),Ie(this,"pausePlayTime",0),Ie(this,"options",void 0),Ie(this,"currentLoopCount",0),Ie(this,"currentPlaybackSpeed",100),Ie(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const q8=new Map;class RL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Ie(this,"trackId",void 0),Ie(this,"config",void 0),Ie(this,"onFirstVideoFrameDecoded",void 0),Ie(this,"onVideoStateChanged",void 0),Ie(this,"freezeTimeCounterList",[]),Ie(this,"renderFreezeAccTime",0),Ie(this,"isKeepLastFrame",!1),Ie(this,"timeUpdatedCount",0),Ie(this,"freezeTime",0),Ie(this,"playbackTime",0),Ie(this,"lastTimeUpdatedTime",0),Ie(this,"autoplayFailed",!1),Ie(this,"videoTrack",void 0),Ie(this,"videoElement",void 0),Ie(this,"cacheVideoElement",void 0),Ie(this,"renderStats",void 0),Ie(this,"_videoState",Vh.VideoStateStopped),Ie(this,"videoElementCheckInterval",void 0),Ie(this,"videoElementFreezeTimeout",void 0),Ie(this,"_videoElementStatus",So.NONE),Ie(this,"isGettingVideoDimensions",!1),Ie(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Ie(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ar.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Yz())),nW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ie(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=So.PLAYING;break;case"loadeddata":if(this.videoState=Vh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=So.CANPLAY;break;case"stalled":this.videoElementStatus=So.STALLED;break;case"suspend":this.videoElementStatus=So.SUSPEND;break;case"pause":this.videoElementStatus=So.PAUSED,Yo()||Du()||Ls()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=So.WAITING;break;case"abort":this.videoElementStatus=So.ABORT;break;case"ended":this.videoElementStatus=So.ENDED;break;case"emptied":this.videoElementStatus=So.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=So.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,uf.lastVisibleTime<uf.lastHiddenTime||d<uf.lastHiddenTime||d<uf.lastVisibleTime)return;for(c>se("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Yz())),nW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),ar.on(ys.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ar.on(ys.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&t8(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=xn();if((o.name==="Safari"&&Number(o.version)===15||Vv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ht((d,h)=>{o.toBlob(async m=>{if(o.remove(),m){const y=await u8(m);d({buffer:y,width:o.width,height:o.height})}else h(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await CL(r)}destroy(){this.renderStats=void 0,ar.off(ys.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ar.off(ys.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Vh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=So.INIT,!this.videoElementCheckInterval&&(Y8.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)||(this.videoElementStatus=So.DESTROYED)},1e3),se("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,se("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Vh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Vh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},y=(v,S)=>{if(this.videoElementStatus===So.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},d){const D=S.presentationTime-d.presentationTime;this.videoState===Vh.VideoStateStarting&&(this.videoState=Vh.VideoStateDecoding),this.videoState===Vh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,se("VIDEO_FREEZE_DURATION"))),D<se("VIDEO_FREEZE_DURATION")&&this.videoState===Vh.VideoStateFrozen&&(this.videoState=Vh.VideoStateDecoding),D>se("VIDEO_FREEZE_DURATION")&&uf.lastVisibleTime>=uf.lastHiddenTime&&d.timestamp>uf.lastVisibleTime&&d.timestamp>uf.lastHiddenTime&&(this.renderFreezeAccTime+=D)}d=Vr(Vr({},S),{},{timestamp:v})}var R,P;se("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,y))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),zA()&&!se("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=xn();o.name==="Safari"&&Number(o.version)===15||Vv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$r()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$r()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(d=>{x.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){Y8.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=So.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,vT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};vT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),e8()}}const Y8=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class X8 extends RL{constructor(r){super(r),Ie(this,"container",void 0),Ie(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await CL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",se("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var J8,Q8,Z8,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,dG,hG,pG,fG,mG,gG,_G,yG,EG,vG,On,SG,bG,TG,wG,CG,RG,IG,AG,hl;let Ar=(J8=Ht({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),Q8=li(),Z8=Ht({argsMap:t=>[t.getTrackId()]}),eG=Bv("LocalVideoTrack","_enabledMutex"),tG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),nG=li(),rG=Bv("LocalVideoTrack","_enabledMutex"),iG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),sG=li(),oG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),aG=li(),cG=li(),lG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),uG=li(),dG=li(),hG=li(),pG=li(),fG=li(),mG=li(),gG=li(),_G=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),yG=Ht({argsMap:t=>[t.getTrackId()]}),EG=Ht({argsMap:t=>[t.getTrackId()]}),vG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),On=class Woe extends Xv{get videoHeight(){if(Ls()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ls()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==So.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,o,c,d,h){if(super(r,d),Ie(this,"trackMediaType",Yv.VIDEO),Ie(this,"_player",void 0),Ie(this,"isUseScaleResolutionDownBy",!1),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"_encoderConfig",void 0),Ie(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ie(this,"_optimizationMode",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_videoWidth",void 0),Ie(this,"_forceBitrateLimit",void 0),Ie(this,"_enabled",!0),Ie(this,"_processorDestination",void 0),Ie(this,"_processorContext",void 0),Ls()){const{width:m,height:y}=r.getSettings();this._videoWidth=m,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(_r.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Wx(Hn.CHROME,115)&&jA().indexOf("Windows")!==-1){const m=function(y,v){if("VideoFrame"in window&&"TransformStream"in window&&jn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let P,D,G=Date.now();const j=()=>{B&&(clearInterval(B),B=void 0),P&&(P.close(),P=void 0),y.stop(),D=void 0,R.removeEventListener("ended",j)};let B=window.setInterval(()=>{if(D&&P&&Date.now()-G>1e3)try{R.readyState==="live"?D.enqueue(P.clone()):j()}catch{j()}},1e3);const J=new TransformStream({transform:(ee,fe)=>{R.readyState==="live"?(D=fe,G=Date.now(),P===void 0?(P=ee,fe.enqueue(ee.clone())):(fe.enqueue(P),P=ee)):ee.close()}});return R.addEventListener("ended",j),S.readable.pipeThrough(J).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(_r.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new r8(this.getTrackId(),"local"),this._processorDestination=new n8(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const o=Vr(Vr(Vr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new RL(o):this._player=new X8(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Kv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},se("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await mr(this,Ct.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await mr(this,Ct.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await mr(this,Ct.NEED_MUTE_TRACK,this):await mr(this,Ct.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Uh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=nP({encoderConfig:r});(Ls()||Yo()||Du())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const d=new Le(te.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mr(this,Ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return Wm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),rl(this,Ct.GET_STATS)||Vr({},yL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await CL(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await mr(this,Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){o8(this._originMediaStreamTrack).then(r=>{let[s,o]=r;this._videoHeight=o,this._videoWidth=s}).catch(HA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Uh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mr(this,Ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!s||!o)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:m}=function(y,v,S,R,P){const D=se("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const B=Math.floor(200*Math.pow(S/15,.6)*Math.pow(y*v/640/360,.75));P=D==="STANDARD_BITRATE"?4*B:2*B,R=(G=R)!==null&&G!==void 0?G:B}else{var j;R=(j=R)!==null&&j!==void 0?j:Math.floor(P/10)}return{min:R,max:P}}(r,s,o,d,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=aW.checkOneElementVisible(d),y=Object.assign({},m);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const v=Ot.reportApiInvoke(null,{tag:qr.TRACER,name:Pi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(o){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Vr(Vr({},o),Uh(r))),o=j_(o);const c=gr(8,"track-video-cloned-"),d=new Woe(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,j_(this._scalabilityMode),this._optimizationMode,c,j_(this._hints));return r&&o&&d.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Wm(()=>{Ot.reportApiInvoke(null,{name:Pi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:qr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!se("ENABLE_VIDEO_SEI")||!se("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const o=s.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Xo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await mr(this,Ct.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mr(this,Ct.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Xo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(al.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(al.REQUEST_CONSTRAINTS)}},Mn(On.prototype,"play",[J8,Q8],Object.getOwnPropertyDescriptor(On.prototype,"play"),On.prototype),Mn(On.prototype,"stop",[Z8],Object.getOwnPropertyDescriptor(On.prototype,"stop"),On.prototype),Mn(On.prototype,"setEnabled",[eG,tG,nG],Object.getOwnPropertyDescriptor(On.prototype,"setEnabled"),On.prototype),Mn(On.prototype,"setMuted",[rG,iG,sG],Object.getOwnPropertyDescriptor(On.prototype,"setMuted"),On.prototype),Mn(On.prototype,"setEncoderConfiguration",[oG,aG],Object.getOwnPropertyDescriptor(On.prototype,"setEncoderConfiguration"),On.prototype),Mn(On.prototype,"getStats",[cG],Object.getOwnPropertyDescriptor(On.prototype,"getStats"),On.prototype),Mn(On.prototype,"setBeautyEffect",[lG,uG],Object.getOwnPropertyDescriptor(On.prototype,"setBeautyEffect"),On.prototype),Mn(On.prototype,"getCurrentFrameData",[dG],Object.getOwnPropertyDescriptor(On.prototype,"getCurrentFrameData"),On.prototype),Mn(On.prototype,"getCurrentFrameImage",[hG],Object.getOwnPropertyDescriptor(On.prototype,"getCurrentFrameImage"),On.prototype),Mn(On.prototype,"setBitrateLimit",[pG],Object.getOwnPropertyDescriptor(On.prototype,"setBitrateLimit"),On.prototype),Mn(On.prototype,"setOptimizationMode",[fG],Object.getOwnPropertyDescriptor(On.prototype,"setOptimizationMode"),On.prototype),Mn(On.prototype,"setScalabiltyMode",[mG],Object.getOwnPropertyDescriptor(On.prototype,"setScalabiltyMode"),On.prototype),Mn(On.prototype,"updateMediaStreamTrackResolution",[gG],Object.getOwnPropertyDescriptor(On.prototype,"updateMediaStreamTrackResolution"),On.prototype),Mn(On.prototype,"pipe",[_G],Object.getOwnPropertyDescriptor(On.prototype,"pipe"),On.prototype),Mn(On.prototype,"unpipe",[yG],Object.getOwnPropertyDescriptor(On.prototype,"unpipe"),On.prototype),Mn(On.prototype,"close",[EG],Object.getOwnPropertyDescriptor(On.prototype,"close"),On.prototype),Mn(On.prototype,"replaceTrack",[vG],Object.getOwnPropertyDescriptor(On.prototype,"replaceTrack"),On.prototype),On),IL=(SG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),bG=li(),TG=Bv("CameraVideoTrack","_enabledMutex"),wG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),CG=li(),RG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),IG=li(),AG=Ht({argsMap:t=>[t.getTrackId()]}),hl=class Goe extends Ar{get __className__(){return"CameraVideoTrack"}constructor(r,s,o,c,d,h){super(r,Uh(s.encoderConfig),c,d,h),Ie(this,"_config",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_constraints",void 0),Ie(this,"_enabled",!0),Ie(this,"_deviceName","default"),Ie(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Vv()||$x())&&!function(){const m=xn();if(m.os!==Yi.IOS||!m.osVersion)return!1;const y=m.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&rW()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=Uh(this._config.encoderConfig),ar.on(ys.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ar.on(ys.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await ul.getDeviceById(r),o={};o.video=Vr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await ll(o,this.getTrackId())}catch(d){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await ll({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await ul.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Vr(Vr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await ll(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await ll({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Vr({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await ll({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await mr(this,Ct.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await mr(this,Ct.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Uh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=Yr(this._config);o.encoderConfig=r;const c=nP(o);(Ls()||Yo()||Du())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new Le(te.UNEXPECTED_ERROR,d.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mr(this,Ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Yo()||Du())&&this._enabled&&!this._isClosed&&ar.duringInterruption){const r=async()=>{ar.off(ys.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ar.on(ys.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Kv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,o=ul.searchDeviceIdByName(this._deviceName);if(o&&!s.deviceId&&(s.deviceId={exact:o}),this._enabled){const c=await ll({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ar.off(ys.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ar.off(ys.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Vr(Vr({},o),Uh(r))),o=j_(o);const c=gr(8,"track-cam-cloned-"),d=new Goe(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,j_(Vr(Vr({},this._config),{},{encoderConfig:o})),j_(this._constraints),j_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&d.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(al.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}}),this.processorContext.on(al.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Mn(hl.prototype,"setDevice",[SG,bG],Object.getOwnPropertyDescriptor(hl.prototype,"setDevice"),hl.prototype),Mn(hl.prototype,"setEnabled",[TG,wG,CG],Object.getOwnPropertyDescriptor(hl.prototype,"setEnabled"),hl.prototype),Mn(hl.prototype,"setEncoderConfiguration",[RG,IG],Object.getOwnPropertyDescriptor(hl.prototype,"setEncoderConfiguration"),hl.prototype),Mn(hl.prototype,"close",[AG],Object.getOwnPropertyDescriptor(hl.prototype,"close"),hl.prototype),hl);function AL(t,r,s,o){s.optimizationMode&&(o&&o.width&&o.height?(s.encoderConfig=Vr(Vr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var PG,OG,kG,NG,Gl,DG,xG,LG,MG,UG,VG,bo;class FG extends HW{getUserId(){return this._userId}constructor(r,s,o,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(gr(5,""))),Ie(this,"_userId",void 0),Ie(this,"_uintId",void 0),Ie(this,"_isDestroyed",!1),Ie(this,"store",void 0),Ie(this,"processor",void 0),Ie(this,"processorContext",void 0),this._userId=s,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Zv=(PG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),OG=Ht({argsMap:t=>[t.getTrackId()]}),kG=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),NG=Ht({argsMap:t=>[t.getTrackId()]}),Mn((Gl=class extends FG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==So.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,o){super(t,r,s,o),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"trackMediaType",Yv.VIDEO),Ie(this,"_videoWidth",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_player",void 0),Ie(this,"processorDestination",void 0),Ie(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new r8(this.getTrackId(),"remote"),this.processorDestination=new n8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),rl(this,Ct.GET_STATS)||Vr({},WW)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Vr(Vr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new RL(s):this._player=new X8(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(qv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(qv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(qv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},se("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){o8(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(HA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=aW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const y=Ot.reportApiInvoke(null,{tag:qr.TRACER,name:Pi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Xo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Xo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(G_.SEI_RECEIVED,t)}}).prototype,"play",[PG],Object.getOwnPropertyDescriptor(Gl.prototype,"play"),Gl.prototype),Mn(Gl.prototype,"stop",[OG],Object.getOwnPropertyDescriptor(Gl.prototype,"stop"),Gl.prototype),Mn(Gl.prototype,"pipe",[kG],Object.getOwnPropertyDescriptor(Gl.prototype,"pipe"),Gl.prototype),Mn(Gl.prototype,"unpipe",[NG],Object.getOwnPropertyDescriptor(Gl.prototype,"unpipe"),Gl.prototype),Gl),eS=(DG=Ht({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),xG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),LG=Ht({argsMap:t=>[t.getTrackId()]}),MG=Ht({argsMap:t=>[t.getTrackId()]}),UG=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),VG=Ht({argsMap:t=>[t.getTrackId()]}),Mn((bo=class extends FG{get isPlaying(){return this._useAudioElement?Ta.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,o){super(t,r,s,o),Ie(this,"trackMediaType",Yv.AUDIO),Ie(this,"_source",void 0),Ie(this,"_useAudioElement",!0),Ie(this,"_volume",100),Ie(this,"processorContext",void 0),Ie(this,"processorDestination",void 0),Ie(this,"_played",!1),Ie(this,"_bypassWebAudio",!1),se("DISABLE_WEBAUDIO")?(this._source=new wL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new YW(t,!0),se("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ol.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(qv.FIRST_FRAME_DECODED)}),this.processorContext=new s8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new i8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ol.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ol.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(ol.ON_AUDIO_BUFFER),this._source.on(ol.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?Ta.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!FW())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ta.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Wm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),rl(this,Ct.GET_STATS)||Vr({},zW)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ta.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ta.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ta.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Xo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Xo.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Xo.ON_TRACK),this.processorDestination.removeAllListeners(Xo.ON_NODE)}}).prototype,"setVolume",[DG],Object.getOwnPropertyDescriptor(bo.prototype,"setVolume"),bo.prototype),Mn(bo.prototype,"setPlaybackDevice",[xG],Object.getOwnPropertyDescriptor(bo.prototype,"setPlaybackDevice"),bo.prototype),Mn(bo.prototype,"play",[LG],Object.getOwnPropertyDescriptor(bo.prototype,"play"),bo.prototype),Mn(bo.prototype,"stop",[MG],Object.getOwnPropertyDescriptor(bo.prototype,"stop"),bo.prototype),Mn(bo.prototype,"pipe",[UG],Object.getOwnPropertyDescriptor(bo.prototype,"pipe"),bo.prototype),Mn(bo.prototype,"unpipe",[VG],Object.getOwnPropertyDescriptor(bo.prototype,"unpipe"),bo.prototype),bo);const uf=new class extends zr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ie(this,"_lastHiddenTime",0),Ie(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class jG extends zr{constructor(r,s){super(),Ie(this,"trackMediaType",Yv.DATA),Ie(this,"_version",1),Ie(this,"_type",3),Ie(this,"_config",void 0),Ie(this,"_originDataChannel",void 0),Ie(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ie(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Ie(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return se("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ht((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Le(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[eP.OPEN,eP.CLOSE,eP.ERROR].forEach(s=>{const o=()=>{this.emit(s)};this._datachannelEventMap.set(s,o),r.addEventListener(s,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[o,c]=s;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class ome extends jG{constructor(r){super(r),Ie(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(se("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(eP.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class ame extends jG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function iP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>iA.revokeObjectURL(t),0),new Worker(iA.createObjectURL(t))}const BG=71,PL=1,OL=2,kL=1,zG=2;var df=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(df||{});function WG(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==BG)return;const o=t.getUint16(1),c=PL+OL+o,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:o,tlv:[],frame:d};let m=PL+OL;for(;m<c;){const y=t.getUint8(m),v=t.getUint16(m+kL),S=kL+zG;if(y===df.AUDIO_LEVEL){let R=t.getUint8(m+S);for(let P=1;P<v;P++)R=R<<8|t.getUint8(m+S+P);h.tlv.push({tag:y,length:v,value:r?127^R>>1:127&R})}else if(y===df.METADATA||y===df.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let P=0;P<v;P++)R[P]=t.getUint8(m+S+P);h.tlv.push({tag:y,length:v,value:R})}m+=S+v}return h}const sP=new Map,oP=127,K_=1e-10,NL=139/13,aP=new Map;function DL(t,r,s){const o="".concat(t,"-").concat(r,"-").concat(s);let c=0;return aP.has(o)?c=aP.get(o):(c=Math.log(function(h,m){const y=h-m;m<y&&(m=y);let v=1;for(let S=h,R=1;S>m;S--,R++)v=v*S/R;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,aP.set(o,c)),c<K_&&(c=K_),c}function GG(t,r,s){const o=r.length,c=t.length/o;let d=!1;for(let h=0,m=0;h<o;h++){let y=0;for(let v=m+c;m<v;m++)t[m]>s&&y++;r[h]!==y&&(r[h]=y,d=!0)}return d}window.cache=aP;let cme=0;class HG{constructor(r){Ie(this,"id",void 0),Ie(this,"immediates",[]),Ie(this,"lastNonSilence",-1),Ie(this,"immediateSpeechActivityScore",K_),Ie(this,"lastLevelChangedTime",Date.now()),Ie(this,"levels",[]),Ie(this,"longs",[]),Ie(this,"longSpeechActivityScore",K_),Ie(this,"mediums",[]),Ie(this,"mediumSpeechActivityScore",K_),Ie(this,"minLevel",0),Ie(this,"nextMinLevel",0),Ie(this,"nextMinLevelWindowLength",0),Ie(this,"energyScore",0),this.id=r||"".concat(cme++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,o=this.minLevel+NL;let c=!1;for(let d=0;d<r.length;++d){let h=s[d];h<o&&(h=0);const m=Math.floor(h/NL);r[d]!==m&&(r[d]=m,c=!0)}return c}computeLongs(){return GG(this.mediums,this.longs,4)}computeMediums(){return GG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=DL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=DL(this.longs[0],10,47),this.longSpeechActivityScore>K_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=DL(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(gm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let o=r;return r<0&&(o=0),r>oP&&(o=oP),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+NL?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>oP&&(s=oP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class lme{constructor(r){Ie(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class xL{constructor(r,s,o){Ie(this,"isDominant",void 0),Ie(this,"energyRanking",void 0),Ie(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=o}}class ume extends zr{constructor(r){super(),Ie(this,"dominantId",null),Ie(this,"lastDecisionTime",0),Ie(this,"lastLevelChangedTime",0),Ie(this,"lastLevelIdleTime",0),Ie(this,"relativeSpeechActivities",[]),Ie(this,"speakers",new Map),Ie(this,"enableSilence",!1),Ie(this,"timeoutToSilenceInterval",0),Ie(this,"decisionMaker",null),Ie(this,"loudest",[]),Ie(this,"numLoudestToTrack",3),Ie(this,"energyExpireTimeMs",250),Ie(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const d=c.levelChanged(s,o);return this.updateLoudestList(c,d,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new HG(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,o){const c=r.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==r;)++y;return new xL(c,y,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new xL(c,0,r.energyScore);const d=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const y=this.loudest[h];if(y.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(y.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new xL(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new lme(this),this.decisionMaker.execute())}makeDecision(r){let s=null,o=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const m=tl(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(d=S.value[0],m=S.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const y=this.relativeSpeechActivities;let v=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let B=0;B<y.length;++B){const J=m==null?K_:m.getSpeechActivityScore(B);y[B]=Math.log(P.getSpeechActivityScore(B)/J)}const D=y[0],G=y[1],j=y[2];D>3&&G>2&&j>0&&G>v&&(v=G,d=R)}this.enableSilence&&m!=null&&d===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,o=this.dominantId),o==null&&!this.enableSilence||o===s||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let o=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const s=[];for(const c of tl(o=this.speakers).call(o)){var o;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const tS=new Map;let Md=null,cP=null;const $G=3;let q_=[];const Ud=new Map,lP=new Map;class dme{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Ie(this,"id",void 0),Ie(this,"track",void 0),Ie(this,"score",0),Ie(this,"active",!0),Ie(this,"muted",!1),Ie(this,"timer",0),Ie(this,"actives",0),Ie(this,"inactives",0),this.id=r,this.track=s,this.setActive(Ud.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:o}=function(){const c=[],d=[];return Array.from(tl(Ud).call(Ud)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(s.length>3){let c;s.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(s.length<3&&o.length>0){let c;o.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let o;return Array.from(tl(Ud).call(Ud)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let o;return Array.from(tl(Ud).call(Ud)).forEach(c=>{c.active||c.id===s||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let uP;function KG(t){const r=Ud.get(t);r&&(Ud.delete(t),r.clearTimer())}const dP=new Map,hme=new Map;function pme(t,r,s){let o=new Uint8Array(t,r,s),c=[],d=0;for(;c.length<s;)d+3<s&&o[d]===0&&o[d+1]===0&&o[d+2]===3&&(o[d+3]===0||o[d+3]===1||o[d+3]===2||o[d+3]===3)?(c.push(o[d],o[d+1],o[d+3]),d+=4):(c.push(o[d]),d++);return new Uint8Array(c)}const hP=new Map,OT=new Map;(function(){const t=xn();_s.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),_s.getStreamFromExtension=t.name===Hn.CHROME&&Number(t.version)>34,_s.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),_s.supportMinBitrate=t.name===Hn.CHROME||t.name===Hn.EDGE,_s.supportSetRtpSenderParameters=function(){const r=xn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!af()||!(!Ls()&&!BA())||r.name===Hn.FIREFOX&&Number(r.version)>=64)}(),t.name===Hn.SAFARI&&(Number(t.version)>=14?_s.supportDualStream=!0:_s.supportDualStream=!1),_s.webAudioMediaStreamDest=function(){const r=xn();return!(r.name===Hn.SAFARI&&Number(r.version)<12)}(),_s.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",_s.supportWebGL=typeof WebGLRenderingContext<"u",_s.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,af()||(_s.webAudioWithAEC=!0),_s.supportShareAudio=function(){const r=xn();return(r.os===Yi.WIN_10||r.os===Yi.WIN_81||r.os===Yi.WIN_7||r.os===Yi.LINUX||r.os===Yi.MAC_OS||r.os===Yi.CHROMIUM_OS)&&r.name===Hn.CHROME&&Number(r.version)>=74}(),_s.supportDataChannel=!!(ET(76)||function(r){const s=xn();return!(s.name!==Hn.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||Qz(14)),_s.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!$r()&&!!r&&r.prototype.setConfiguration instanceof Function}(),_s.supportWebRTCEncodedTransform=function(){const r=xn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),_s.supportWebRTCInsertableStream=function(){const r=xn();return(r.name===Hn.CHROME||r.name===Hn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),_s.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,_s.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,GA(()=>{_s.supportDualStreamEncoding=function(){const r=xn();return!!se("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&se("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",_s)})})();const fme=["CHINA","GLOBAL"],qG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Y_=[],nS=[];function X_(t,r){return!!r&&Y_.some(s=>s.uid===t&&s.channelName===r)}function LL(){return nS.length>0}var mme=g6.forEach,YG=xp("forEach")?[].forEach:function(t){return mme(this,t,arguments.length>1?arguments[1]:void 0)};Gn({target:"Array",proto:!0,forced:[].forEach!=YG},{forEach:YG});var gme=yc("Array").forEach,_me=Gc,yme=Ri,Eme=O,vme=gme,ML=Array.prototype,Sme={DOMTokenList:!0,NodeList:!0},bme=function(t){var r=t.forEach;return t===ML||Eme(ML,t)&&r===ML.forEach||yme(Sme,_me(t))?vme:r},Tme=l(bme),wme=xi,XG=Kc;Gn({target:"Object",stat:!0,forced:u(function(){XG(1)})},{keys:function(t){return XG(wme(t))}});var JG=l(vt.Object.keys),Cme=l(hE),Rme=l(fE),Ime=Gn,QG=e_,Ame=T_,Pme=Et,ZG=ge,Ome=gi,kme=Te,Nme=$I,Dme=Tr,xme=ks,Lme=o6("slice"),Mme=Dme("species"),UL=Array,Ume=Math.max;Ime({target:"Array",proto:!0,forced:!Lme},{slice:function(t,r){var s,o,c,d=kme(this),h=Ome(d),m=ZG(t,h),y=ZG(r===void 0?h:r,h);if(QG(d)&&(s=d.constructor,(Ame(s)&&(s===UL||QG(s.prototype))||Pme(s)&&(s=s[Mme])===null)&&(s=void 0),s===UL||s===void 0))return xme(d,m,y);for(o=new(s===void 0?UL:s)(Ume(y-m,0)),c=0;m<y;m++,c++)m in d&&Nme(o,c,d[m]);return o.length=c,o}});var Vme=yc("Array").slice,Fme=O,jme=Vme,VL=Array.prototype,Bme=function(t){var r=t.slice;return t===VL||Fme(VL,t)&&r===VL.slice?jme:r},zme=l(Bme);function Rt(t,r,s,o,c){var d,h,m,y={};return Tme(d=JG(o)).call(d,function(v){y[v]=o[v]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=Cme(h=Rme(m=zme(s).call(s)).call(m)).call(h,function(v,S){return S(t,r,v)||v},y),c&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(c):void 0,y.initializer=void 0),y.initializer===void 0&&(n6(t,r,y),y=null),y}let pP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),FL=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Mu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Jo=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),jt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Er=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Yt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Kt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),kT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),wn=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Qo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),en=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function fP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Ae(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function mP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||oW(t,1,255)))throw new Ae(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let hf=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Wme={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},jL={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function BL(t,r){ms(t.url,"".concat(r,".url"),1,1e3,!1),Kr(t.x)||ur(t.x,"".concat(r,".x"),0,1e4),Kr(t.y)||ur(t.y,"".concat(r,".y"),0,1e4),Kr(t.width)||ur(t.width,"".concat(r,".width"),0,1e4),Kr(t.height)||ur(t.height,"".concat(r,".height"),0,1e4),Kr(t.zOrder)||ur(t.zOrder,"".concat(r,".zOrder"),0,255),Kr(t.alpha)||ur(t.alpha,"".concat(r,".alpha"),0,1,!1)}const Gme={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let $m=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),zL=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Vi=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function eH(t){if(!t.channelName)throw new Ae(te.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Ae(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&ms(t.token,"info.token",1,2047),mP(t.uid),fP(t.channelName),!0}let Zo=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),pf=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Za=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),rS=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Zn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),ds=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),gP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Ji=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),$n=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const tH=[$n.AFRICA,$n.ASIA,$n.CHINA,$n.EUROPE,$n.GLOBAL,$n.INDIA,$n.JAPAN,$n.NORTH_AMERICA,$n.OCEANIA,$n.OVERSEA,$n.SOUTH_AMERICA];let qs=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const _P={CHINA:{},ASIA:{CODE:qs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:qs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:qs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:qs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:qs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:qs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:qs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:qs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:qs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:qs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:qs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:qs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:qs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};lL&&(_P.CHINA={CODE:qs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let NT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function nH(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class rH extends zr{constructor(r,s){super(),q(this,"onICEConnectionStateChange",void 0),q(this,"onConnectionStateChange",void 0),q(this,"onDTLSTransportStateChange",void 0),q(this,"onDTLSTransportError",void 0),q(this,"onICETransportStateChange",void 0),q(this,"onFirstAudioReceived",void 0),q(this,"onFirstVideoReceived",void 0),q(this,"onFirstAudioDecoded",void 0),q(this,"onFirstVideoDecoded",void 0),q(this,"onFirstVideoDecodedTimeout",void 0),q(this,"onSelectedLocalCandidateChanged",void 0),q(this,"onSelectedRemoteCandidateChanged",void 0),q(this,"onICECandidateError",void 0),q(this,"getLocalVideoStats",void 0)}}class iH extends rH{constructor(r,s){super(r,s),q(this,"establishPromise",void 0)}}let Tt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ys=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),ff=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const sH=["disconnected","failed"];let Ye=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Jn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Vt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Uu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Vu=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),hs=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),oH=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),jh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Hl=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Vd=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),iS=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ui=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),sS=function(t){return t.ABORT="abort",t}({}),Km=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Hme=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const $me={[pP.ACCESS_POINT]:{[Jo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Jo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Jo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Jo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Jo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Jo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Jo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[pP.UNILBS]:{[Mu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Mu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Mu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Mu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Mu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Mu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Mu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Mu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Mu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Mu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Mu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Mu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[pP.STRING_UID_ALLOCATOR]:{[FL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[FL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[FL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function oS(t){const r=$me[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===pP.ACCESS_POINT){const o=t%1e4;if(o.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Kme={[jt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[jt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[jt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[jt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[jt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[jt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[jt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[jt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[jt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[jt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[jt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[jt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[jt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[jt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[jt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[jt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[jt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[jt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[jt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[jt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[jt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[jt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[jt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[jt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[jt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[jt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[jt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[jt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[jt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[jt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[jt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[jt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[jt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[jt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[jt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[jt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[jt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[jt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[jt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[jt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[jt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[jt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[jt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[jt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[jt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[jt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[jt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[jt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[jt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[jt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[jt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[jt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[jt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[jt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[jt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[jt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[jt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[jt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[jt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[jt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[jt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[jt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[jt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function DT(t){return Kme[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function aH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function WL(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?aH(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):aH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function cH(t,r){if(typeof t=="string")return t;const{proxy:s,host:o,port:c}=t;if(r){const d=se("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const qme=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Yme=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Xme=/wss:\/\/(.+):([0-9]+)\/?/,Jme=/wss:\/\/(.[^\/]+)\/?/;let Qme=0;class Zme{constructor(r,s){q(this,"id",0),q(this,"store",void 0),q(this,"recordIndex",void 0),q(this,"websockets",[]),q(this,"try443PortDuration",2e3),q(this,"forceCloseWSDuration",5e3),q(this,"try443PortTimeout",null),q(this,"forceCloseTimeout",null),q(this,"isTry443PortFailed",!1),q(this,"isNormalPortFailed",!1),q(this,"useDoubleDomain",!1),q(this,"useProxy",!1),q(this,"startTime",Date.now()),this.id=++Qme,this.try443PortDuration=se("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,o){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:o});const c=se("GATEWAY_DOMAINS"),d=Date.now(),h=[],m=c.find(P=>{var D;return ot(D=r.host).call(D,P)});m||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)c.forEach(P=>{y.push(cH(WL(WL({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=WL({},r);if(s&&m){const D=c.find(G=>G!==m);D&&(P.host=P.host.replace(m,D))}y.push(cH(P,s))}try{y.forEach(P=>{const D=new WebSocket(P);D.binaryType="arraybuffer",h.push(D),this.logger("ws is connecting:",D.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(D=>D.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,o);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Ae(te.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const v=yT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(D=>{D!==P&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,v.resolve(P)},P.onclose=D=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(P.readyState));const G=h.every(j=>j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),v.reject({code:D.code,reason:gP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=D=>this.logger("".concat(P.url," onmessage: ").concat(D.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(v.isResolved)return S();xn().os===Yi.MAC_OS&&$r()&&S(),this.createWebSocket(r,!0,!0).then(P=>{v.resolve(P)}).catch(P=>{this.isNormalPortFailed&&v.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,s,o,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(d){let h,m,y;return[,h,m,y]=d.match(qme)||[],h||([,m,y]=d.match(Yme)||[]),m&&y||([,m,y]=d.match(Xme)||[]),m&&y||([,m]=d.match(Jme)||[]),m||x.warning("un-destructible url: ",d),{proxy:h,host:m,port:y||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function lH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class uH extends zr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;ot(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(en.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(en.CONNECTED):this._state==="closed"?this.emit(en.CLOSED):this._state==="failed"&&this.emit(en.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),q(this,"connectionID",0),q(this,"currentURLIndex",0),q(this,"urls",[]),q(this,"_reconnectMode","tryNext"),q(this,"reconnectReason",void 0),q(this,"_initMutex",void 0),q(this,"name",void 0),q(this,"_state","closed"),q(this,"reconnectInterrupter",void 0),q(this,"websocket",void 0),q(this,"retryConfig",void 0),q(this,"reconnectCount",0),q(this,"forceCloseTimeout",5e3),q(this,"onlineReconnectListener",void 0),q(this,"useCompress",void 0),q(this,"tryDoubleDomain",!1),q(this,"use443PortOnly",!1),q(this,"wsInflateLength",0),q(this,"wsDeflateLength",0),q(this,"closeEstablishingWs",()=>{}),q(this,"store",void 0),q(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var D=arguments[P]!=null?arguments[P]:{};P%2?lH(Object(D),!0).forEach(function(G){q(R,G,D[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(D)):lH(Object(D)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(D,G))})}return R}({},s),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Ks("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:y}=s,v=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*y)/10);Rc.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S),yi.on(Fv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===Rc.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=yT(),d=this.urls[this.currentURLIndex];se("ENABLE_PREALLOC_PC")&&this.emit(oH.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(c.resolve).catch(c.reject),this.once(en.CLOSED,()=>{c.reject(new Le(te.WS_DISCONNECT))}),this.once(en.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;s?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new Le(te.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const o=yT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},d=async S=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Le(te.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=rl(this,en.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,D=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return o.reject(new Le(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(en.ON_MESSAGE,S)},m=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),se("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=se("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(S){const R=this.state==="closed",P=S instanceof Le,D=P&&S.code===te.WS_ABORT,G=P&&S.code===te.WS_ERR,j=P?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(j)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[S]},y),R||G?(o.reject(R?new Le(te.WS_DISCONNECT,"websocket is closed: ".concat(j)):new Le(te.WS_ERR,"init websocket failed: ".concat(j))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(j))):d&&d(S)}return o.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||yi.isOnline||!yi.onlineWaiter||(this.onlineReconnectListener=yi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,s){const h=tL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await ht.race([gs(h),this.onlineReconnectListener||new ht(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(en.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Us(this,en.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var d;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&ot(m).call(m,"dynamic key expired")?(this.emit(en.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class GL extends uH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const o=yT(),c=function(h,m){return new Zme(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Le(te.WS_ABORT,"choose best websocket aborted"))};const d=se("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class xT extends uH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new ht((o,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new Le(te.WS_ABORT,"choose best websocket aborted"))};const m=se("GATEWAY_DOMAINS");let y;const v=r.indexOf("?h="),S=m.find(G=>v!==-1?ot(r).call(r,G,v):ot(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const G=Date.now();try{m.forEach(j=>{const B=v===-1?r.replace(S,j):r.substr(0,v)+r.substr(v).replace(S,j),J=new WebSocket(B);J.binaryType="arraybuffer",h.push(J),x.debug("[choose-best-ws] ws is connecting:",J.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(B=>B.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(j=>j.url),service:"gateway"},s),h.forEach(j=>{j.onopen=()=>{if(d)return;const B=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(B,"ms")),h.filter(J=>J!==j).forEach(J=>{x.debug("[choose-best-ws]close backup websocket: ".concat(J.url)),J.close()}),d=!0,o(j)},j.onclose=B=>{y=B,!d&&(h.find(J=>!(J.readyState===WebSocket.CLOSED||J.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),d=!0,c(y)))},j.onmessage=B=>{x.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(B.data))}}),gs(this.forceCloseTimeout).then(()=>{h.forEach(j=>{j.readyState!==WebSocket.OPEN&&j.close()})})}if(R){var D;let G;x.debug("[choose-best-ws] use single url: ",r),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(j){const B=new Le(te.WS_ERR,"init websocket failed! Error: ".concat(j.toString()));return x.error("[".concat(this.name,"]").concat(B)),void c(B)}G.onopen=()=>{o(G)},G.onclose=j=>{c(j)},G.onmessage=j=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(j.data))},gs(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class ege extends zr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Er.CONNECTED?this.emit(Yt.WS_CONNECTED):r===Er.RECONNECTING?this.emit(Yt.WS_RECONNECTING,this._websocketReconnectReason):r===Er.CLOSED&&this.emit(Yt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",Er.CLOSED),q(this,"reconnectToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new bW(5)),q(this,"pingpongTimer",void 0),q(this,"wsInflateDataTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Yt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===wn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Xn.UID_BANNED);break;case 15:this.close(Xn.IP_BANNED);break;case 16:this.close(Xn.CHANNEL_BANNED)}if(c._type===wn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case jt.ERR_LICENSE_MISSING:this.close(Xn.LICENSE_MISSING);break;case jt.ERR_LICENSE_EXPIRED:this.close(Xn.LICENSE_EXPIRED);break;case jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xn.LICENSE_MINUTES_EXCEEDED);break;case jt.ERR_LICENSE_PERIOD_INVALID:this.close(Xn.LICENSE_PERIOD_INVALID);break;case jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xn.LICENSE_MULTIPLE_SDK_SERVICE);break;case jt.ERR_LICENSE_ILLEGAL:this.close(Xn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new GL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,se("JOIN_GATEWAY_USE_DUAL_DOMAIN"),se("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Er.CONNECTED&&this.reconnect("retry",Ms.OFFLINE)})}async request(r,s,o,c){const d=gr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new ht((G,j)=>{if(this.connectionState===Er.CONNECTED)return G();const B=()=>{this.off(Yt.WS_CLOSED,J),G()},J=()=>{this.off(Yt.WS_CONNECTED,B),j(new Ae(te.WS_ABORT))};this.once(Yt.WS_CONNECTED,B),this.once(Yt.WS_CLOSED,J),r!==Kt.PUBLISH&&r!==Kt.PUBLISH_DATASTREAM&&r!==Kt.SUBSCRIBE&&r!==Kt.SUBSCRIBE_DATASTREAM&&r!==Kt.UNSUBSCRIBE&&r!==Kt.UNSUBSCRIBE_DATASTREAM&&r!==Kt.UNPUBLISH&&r!==Kt.UNPUBLISH_DATASTREAM&&r!==Kt.CONTROL&&r!==Kt.RESTART_ICE||this.once(Yt.DISCONNECT_P2P,()=>{j(new Ae(te.DISCONNECT_P2P))}),r!==Kt.PUBLISH&&r!==Kt.RESTART_ICE||this.once(Yt.ABORT_P2P_EXECUTION,()=>{j(new Ae(te.DISCONNECT_P2P))})});if(this.connectionState!==Er.CONNECTING&&this.connectionState!==Er.RECONNECTING||r===Kt.JOIN||r===Kt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new ht((G,j)=>{let B=!1;const J=(fe,ye)=>{B=!0,G({isSuccess:fe==="success",message:ye||{}}),this.off(Yt.WS_CLOSED,ee),this.off(Yt.WS_RECONNECTING,ee),this.emit(Yt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),J);const ee=()=>{j(new Ae(te.WS_ABORT,"type: ".concat(r))),this.off(Yt.WS_CLOSED,ee),this.off(Yt.WS_RECONNECTING,ee),this.off("res-@".concat(d),J)};this.once(Yt.WS_CLOSED,ee),this.once(Yt.WS_RECONNECTING,ee),gs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Yt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await v}catch(G){if(this.connectionState===Er.CLOSED||r===Kt.LEAVE)throw new Ae(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Kt.JOIN||r===Kt.REJOIN?null:(await y(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=DT(R),D=new Ae(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===jt.ERR_TOO_MANY_BROADCASTERS?((r===Kt.JOIN||r===Kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):P.action==="failed"?D.throw():P.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ms.MULTI_IP)):this.reconnect(P.action,Ms.SERVER_ERROR),r===Kt.JOIN||r===Kt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new ht(o=>{const c=d=>{(!s||s(d))&&(this.off(r,c),o(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(kT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const d=se("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Er.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},se("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ht((s,o)=>{this.once(Yt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Yt.WS_CLOSED,c=>o(this.initError||new Ae(te.WS_ABORT,c))),this.connectionState=Er.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Xn.LEAVE,this.connectionState=Er.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Yt.ABORT_P2P_EXECUTION);const r=await Us(this,Yt.REQUEST_JOIN_INFO),s=await this.request(Kt.JOIN,r);if(!s)return this.emit(Yt.REPORT_JOIN_GATEWAY,gP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Yt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Er.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Ae(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=wT(this,Yt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Kt.REJOIN,r);return!!s&&(this.connectionState=Er.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(o=>{this.emit(wn.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(wn.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(wn.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(wn.MUTE_AUDIO,{uid:o.uid}):this.emit(wn.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(wn.MUTE_VIDEO,{uid:o.uid}):this.emit(wn.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(wn.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(wn.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(wn.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(wn.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(wn.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=DT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Yt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xn.UID_BANNED),void this.close()):void this.reconnect(s.action,Ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=se("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>se("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ms.TIMEOUT):this.request(Kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),se("REPORT_STATS")&&this.send(Kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(kT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(en.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Yt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(en.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(en.CLOSED,()=>{this.connectionState=Er.CLOSED}),this.websocket.on(en.FAILED,()=>{this._disconnectedReason=Xn.NETWORK_ERROR,this.connectionState=Er.CLOSED}),this.websocket.on(en.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Er.CONNECTED?this.connectionState=Er.RECONNECTING:this.connectionState=Er.CONNECTING}),this.websocket.on(en.WILL_RECONNECT,(r,s,o)=>{const c=wT(this,Yt.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=gP.P2P_DISCONNECTED),d&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Yt.REPORT_JOIN_GATEWAY,s||gP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Yt.DISCONNECT_P2P)),o(r)}),this.websocket.on(en.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Ms.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Yt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Ae){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===jt.ERR_NO_AUTHORIZED)return this.initError=new Ae(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Xn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ms.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(en.REQUEST_NEW_URLS,(r,s)=>{Us(this,Yt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(en.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(oH.PRE_CONNECT_PC,()=>{this.emit(Yt.PRE_CONNECT_PC)})}}let tge=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Ei=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function dH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function yP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?dH(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):dH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function qm(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(se("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function HL(t,r){t.addresses||(t.addresses=[]);const s=function(m,y){if(se("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:D}=R;return{address:"".concat(P,":").concat(D)}});const v=se("GATEWAY_DOMAINS");let S=v[1]&&ot(y).call(y,v[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:D,ip:G}=R;if(P)return{address:"".concat(P,".").concat(v[S++%v.length],":").concat(D)};const j=/^[\.\:\d]+$/.test(G),B=j?"".concat(G.replace(/[^\d]/g,"-"),".").concat(v[S++%v.length],":").concat(D):"".concat(G,":").concat(D);return j||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:D,address:B}})}(t.addresses,r),o=Array.isArray(t.detail)&&t.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let y=0;y<m.length;y++){var c;const v=vo(c=m[y]).call(c);s[y]&&v&&(s[y].ip6=v)}}const d=t.detail&&t.detail.candidate;let h;if(d){const[m,y]=d.split(":");m&&y&&(h={port:Number(y),ip:m,address:"".concat(m,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Ic(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function hH(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(Ic(r.width),"x").concat(Ic(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function pH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function LT(t,r){let s,o,c;switch(r){case Ei.CHOOSE_SERVER:o=4096,c="choose server";break;case Ei.CLOUD_PROXY:o=1048576,c="proxy";break;case Ei.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case Ei.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Ae(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===o&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>yP(yP({},h),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:yP(yP({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!s)throw new Ae(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function fH(t,r){return await ht.all(t.addresses.map(async s=>({address:se("USE_TURN_IP")?s.ip:qm(s.ip),tcpport:s.port,udpport:s.port,username:r&&se("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Vs.username,password:r&&se("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Jx(r.toString()):Vs.password})))}function $L(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||s.height,c=r.videoWidth||s.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Ic(t.height),Ic(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ym(t){let{candidateType:r,relayProtocol:s,type:o,address:c,port:d,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(o!=="local-candidate"){const y=c.split(".");y.length>=4&&(y[1]="*",y[2]="*"),m.address=y.join("."),m.port=d}return m}function EP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:se("SVC_MODE");if(se("ENABLE_SVC"))return function(r){return r in qA}(t)?t:qA.L1T3}const mH={[Tt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Tt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function vP(t,r,s){r.forEach(o=>{var c;const d=mH[t].find(m=>{var y;let{key:v}=m;return ot(y=o.extensionName).call(y,v)});if(!d)return;const h=s.find(m=>{let{extensionName:y}=m;return ot(y).call(y,d.key)});h&&ot(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function aS(t,r){r.forEach(s=>{var o;const c=mH[t].find(d=>{var h;let{key:m}=d;return ot(h=s.extensionName).call(h,m)});ot(o=s.extensionName).call(o,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function gH(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ot(t).call(t,"abs-send-time")}function SP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ot(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function _H(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function yH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?_H(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_H(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function MT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:y}=r,{useXR:v}=s;let S=[],R=[],P=[],D=[],G=!1,j=!1;if(Qa(t).mediaDescriptions.forEach(J=>{o&&o!==J.attributes.direction||(J.media.mediaType!=="video"||G||(R=J.attributes.payloads,D=J.attributes.extmaps,G=!0),J.media.mediaType!=="audio"||j||(S=J.attributes.payloads,P=J.attributes.extmaps,j=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(J=>{var ee;(ee=J.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),v&&J.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(J=>{var ee;(ee=J.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),v&&J.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(J=>{var ee;return((ee=J.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"}),R=R.filter(J=>{var ee;return((ee=J.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"})),d&&(R=R.filter(J=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=J.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),h&&(S=S.filter(J=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=J.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(J=>{var ee;return ot(m).call(m,((ee=J.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const J=R.filter(ee=>{var fe;return ot(y).call(y,((fe=ee.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLowerCase())||"")});R=J.concat(c?[]:YL(J,R))}const B=se("UNSUPPORTED_VIDEO_CODEC");return B&&B.length>0&&(R=R.filter(J=>!(J.rtpMap&&ot(B).call(B,J.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:D}}function Xm(t){const r=Qa(t);let s,o;for(const c of r.mediaDescriptions){if(!s){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!o){const d=c.attributes.fingerprints;d.length>0&&(o={fingerprints:d})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:o}}function EH(t,r){const s=[],o=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const y=(m=o.find(v=>v.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?y:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function vH(t,r,s){const{cname:o}=t;let c=[];r&&(c=SH(r)),c.length===0&&(c=t.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const y=TP(t.rtpCapabilities),v=[];return Array.isArray(s)&&s.length>0&&s.forEach(S=>{v.push({kind:Tt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:Tt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:y,setup:m,cname:o,preSSRCs:v}}function SH(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function J_(t,r,s){const o=[],c=[];return t.forEach(d=>{let{ssrcId:h,rtx:m}=d;const y=gr(8,"track-"),v={ssrcId:h,attributes:yH({label:y,mslabel:s=s||gr(10,""),msid:"".concat(s," ").concat(y)},r&&{cname:r})};if(o.push(v),m!==void 0){const S={ssrcId:m,attributes:yH({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:o,ssrcGroups:c}}function cS(t,r){r instanceof Qr&&t.attributes.payloads.forEach(s=>{var o;const c=(o=s.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!$r()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function KL(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function qL(t,r){var s;if(!(r instanceof Ar&&r._encoderConfig&&r._hints.indexOf(_r.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;jn().supportMinBitrate&&o.bitrateMin&&t.attributes.payloads.forEach(c=>{var d,h;ot(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),jn().supportMinBitrate&&!ot(s=r._hints).call(s,_r.LOW_STREAM)&&o.bitrateMax&&t.attributes.payloads.forEach(c=>{var d,h;ot(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(se("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function bH(t){if(t.media.mediaType!=="video")return;const r=xn();if(r.name!==Hn.SAFARI&&r.os!==Yi.IOS)return;const s=t.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function bP(t,r,s){if(!r)return;let o,c;if(t.media.mediaType==="video"?(o=s.videoExtensions,c=s.videoCodecs):(o=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const d=o.find(h=>SP(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(y=>SP(y.extensionName))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(y,v){return v.filter(S=>!!y.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex(h=>SP(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const d=o.find(h=>gH(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(y=>y.extensionName===h)||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(y,v){return v.filter(S=>!!y.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex(h=>gH(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function TH(t,r,s){if($r()||t.media.mediaType!=="video"||!(r instanceof Ar)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!se("SIMULCAST")||s==="vp9"&&se("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Yr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:Yr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function wH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const o=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const S=MT(v,m,y,"sendonly"),R=MT(v,m,y,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Fu(S,R,"videoExtensions",P,D,G),Fu(S,R,"videoCodecs",P,D,G),Fu(S,R,"audioExtensions",P,D,G),Fu(S,R,"audioCodecs",P,D,G),se("RAISE_H264_BASELINE_PRIORITY")){const j=[],B=[];G.videoCodecs.forEach((J,ee)=>{var fe;if(((fe=J.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){var ye,ve;const _e=G.videoCodecs[ee+1],Ne=_e&&PH(J,_e),Je=(ye=J.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],pt=(ve=J.fmtp)===null||ve===void 0?void 0:ve.parameters["packetization-mode"];!Je||Je!==se("FIRST_H264_PROFILE_LEVEL_ID")||se("FIRST_PACKETIZATION_MODE")&&pt!==se("FIRST_PACKETIZATION_MODE")?Ne?B.push([J,_e]):B.push([J]):Ne?j.push([J,_e]):j.push([J])}}),j.length>0&&B.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((J,ee)=>{var fe;if(((fe=J.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){const ye=PH(J,G.videoCodecs[ee+1]),ve=j.shift()||B.shift()||[];ve.length>0&&(ye?G.videoCodecs.splice(ee,2,...ve):G.videoCodecs.splice(ee,1,...ve))}}),D.videoCodecs=D.videoCodecs.filter(J=>{var ee,fe;return!(((ee=J.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=J.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==se("FIRST_H264_PROFILE_LEVEL_ID"))}),se("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(J=>{var ee,fe;return!(((ee=J.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=J.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==se("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:D,sendrecv:G}}(t,r,o);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function CH(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=MT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Fu(t,r,"videoExtensions",s,o,c),Fu(t,r,"videoCodecs",s,o,c),Fu(t,r,"audioExtensions",s,o,c),Fu(t,r,"audioCodecs",s,o,c),se("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:o,sendrecv:c}}function Fu(t,r,s,o,c,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.entry===y.entry&&m.extensionName===y.extensionName)return h.push(v),!0})?d[s].push(m):o[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.payloadType===y.payloadType&&JSON.stringify(m)===JSON.stringify(y))return h.push(v),!0})?d[s].push(m):o[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}}function TP(t){const{send:r,recv:s,sendrecv:o}=t;if(!o){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...o.audioCodecs],d.videoCodecs=[...s.videoCodecs,...o.videoCodecs],d.audioExtensions=[...s.audioExtensions,...o.audioExtensions],d.videoExtensions=[...s.videoExtensions,...o.videoExtensions]):d=o,{send:c,recv:d}}function lS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function UT(t,r,s,o){let c=[];if(t===Tt.VIDEO){if(se("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(d=>{var h;return ot(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===se("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[];const h=[],m=[],y=[];if(s.videoCodecs.forEach(v=>{const S=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";ot(S).call(S,o)?d.push(v):ot(S).call(S,"vp9")?h.push(v):ot(S).call(S,"vp8")?m.push(v):ot(S).call(S,"h264")&&y.push(v)}),d.length===0){let v="";h.length!==0?(d=h,v="vp9"):m.length!==0?(d=m,v="vp8"):y.length!==0&&(d=y,v="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}d.length!==0&&(c=r.videoCodecs.filter(v=>d.some(S=>S.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),se("USE_PUB_RTX")||se("USE_SUB_RTX")){const d=YL(c,r.videoCodecs);c=[...c,...d]}}else c=r.audioCodecs.filter(d=>{var h;return ot(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(d=>{var h;return ot(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function YL(t,r){const s=t.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&ot(s).call(s,o.fmtp&&o.fmtp.parameters.apt))}async function VT(t,r,s){const o=r.toString(),c=IH(o,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:o});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=RH(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function RH(t,r,s){const o=Qa(t),{useXR:c}=r;return o.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!ot(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&lS(d),c&&ot(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Hm(o)}function IH(t,r,s,o){if(se("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(o,`
`),t),r==="offer"?c=>{IH(c,"answer",s==="local"?"remote":"local",o)}:void 0}function AH(t){const r=se("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>ot(t).call(t,s))}function PH(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function OH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function $l(t,r){return typeof se(t)===r?se(t):void 0}function nge(){try{const t=se("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?OH(Object(o),!0).forEach(function(c){q(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):OH(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const kH={};function Jm(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),kH[t.name]=t}function mf(t){const r=kH[t];if(!r)throw new Le(te.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function NH(t,r){return mf("DataStream").create(t,r)}function wP(){return mf("InterceptFrame").create()}function DH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function gf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?DH(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):DH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const XL=new Map;class rge extends zr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(ds.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(ds.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var o,c,d;super(),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"key",void 0),q(this,"ntpOffset",0),q(this,"signal",void 0),q(this,"role",void 0),q(this,"inChannelInfo",{joinAt:null,duration:0}),q(this,"spec",void 0),q(this,"_state","DISCONNECTED"),q(this,"_statsCollector",void 0),q(this,"_disconnectedReason",void 0),q(this,"isSignalRecover",!1),q(this,"hasChangeBGPAddress",!1),q(this,"trafficStatsInterval",void 0),q(this,"networkQualityInterval",void 0),q(this,"_joinGatewayStartTime",0),q(this,"_signalTimeout",!1),q(this,"_clientRoleOptions",void 0),q(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(o={spec:gf(gf({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(d=mf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,o)):new ege(gf(gf({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=XL.get(r.cname);if(d||(d=new Map,XL.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const v=new Ae(te.UID_CONFLICT);throw Ot.joinGateway(r.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),v}d.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,D]=R.split(":"),G={host:P,port:D};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),Ot.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),d.delete(r.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ds.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ds.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ds.NETWORK_QUALITY,{uplinkNetworkQuality:pH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:pH(this._statsCollector.trafficStats.B_dnq)}):this.emit(ds.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Xn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Er.CONNECTED||await function(o,c){return c===1/0?o:ht.race([o,Afe(c)])}(this.signal.request(Kt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(s),s!==Xn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:se("PUB_EXTEND"),twcc:!!se("PUBLISH_TWCC"),rtx:!!se("USE_PUB_RTX")};try{return(await this.signal.request(Kt.PUBLISH,c,!0))._message}catch(d){if(o&&d.data&&d.data.code===jt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw d}}async publishDataChannel(r,s,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Kt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(o&&h.data&&h.data.code===jt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Kt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ht.all(r.map(s=>this.signal.request(Kt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!se("SUBSCRIBE_TWCC"),rtx:!!se("USE_SUB_RTX")||void 0,extend:se("SUB_EXTEND"),svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return await this.signal.request(Kt.PRE_SUBSCRIBE,c,!0)}catch(d){if(o&&d.data&&d.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,s,!1);throw d}}async subscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!se("SUBSCRIBE_TWCC"),rtx:!!se("USE_SUB_RTX"),extend:se("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return(await this.signal.request(Kt.SUBSCRIBE,c,!0))._message}catch(d){if(o&&d.data&&d.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw d}}async subscribeDataChannel(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Kt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(o&&d.data&&d.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw d}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!se("USE_SUB_RTX"),twcc:!!se("SUBSCRIBE_TWCC"),svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return await this.signal.request(Kt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(s&&c.data&&c.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,d=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(s)return this.signal.request(Kt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ht.all(r.map(o=>this.signal.request(Kt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:s},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(Kt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Kt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Kt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Kt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),se("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(se("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},se("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),se("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},se("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(se("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Kt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Kt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Kt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Kt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Kt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Kt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),gf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Kt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=XL.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let o;return o=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Vs.username,password:Vs.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(gf(gf({},Vs),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Kt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);o&&o.B_st!==s.B_st&&GA(()=>{this.emit(ds.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Ae(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let o=se("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ds.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,ot(nS).call(nS,c)||nS.push(c);const d=!($r()||Jz(87)||jW())&&typeof se("ENABLE_PRE_SUB")=="boolean"&&se("ENABLE_PRE_SUB"),h=!jW()&&$l("ENABLE_PREALLOC_PC","boolean"),m=nge(),y=ET(87)||function(){const S=xn();if(S.name!==Hn.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),v=gf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:zl,browser:navigator.userAgent,process_id:se("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:se("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:gf({enableEncodedTransform:!!se("ENABLE_AUDIO_METADATA")&&y||!!se("ENABLE_AUDIO_TOPN")&&Wx(Hn.CHROME,87,116)||void 0,enableAudioMetadata:!!se("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!se("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:se("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:se("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:se("TOPN_SWITCH_HOLD_MS"),topnAudioGain:se("TOPN_AUDIO_GAIN"),enablePublishedUserList:se("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:se("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:$l("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:$l("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:$l("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:se("USE_PUB_RTX")===!0||se("USE_SUB_RTX")===!0||void 0,disableFEC:se("DISABLE_FEC"),enableNTPReport:!!se("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!se("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!se("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:$l("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!se("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!se("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:$l("USE_XR","boolean"),enableLossbasedBwe:$l("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!se("ENABLE_AUT_CC")||void 0,enableCCFallback:$l("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:d?$l("PRE_SUB_NUM","number"):void 0,enablePubTWCC:$l("PUBLISH_TWCC","boolean"),enableSubTWCC:$l("SUBSCRIBE_TWCC","boolean"),enablePubRTX:$l("USE_PUB_RTX","boolean"),enableSubRTX:$l("USE_SUB_RTX","boolean"),enableSubSVC:se("ENABLE_SVC")?se("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0,enableSvcExtended:se("ENABLE_SVC")&&Array.isArray(se("SVC_EXTENDED"))&&se("SVC_EXTENDED").length!==0?se("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,se("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new Ae(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Yt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Yt.WS_RECONNECTING,r=>{this.joinInfo&&Ot.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Ms.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ot.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Yt.WS_CLOSED,r=>{let s;switch(r){case Xn.LEAVE:s=Ms.LEAVE;break;case Xn.UID_BANNED:case Xn.IP_BANNED:case Xn.CHANNEL_BANNED:case Xn.SERVER_ERROR:s=Ms.SERVER_ERROR;break;case Xn.FALLBACK:s=Ms.FALLBACK;break;case Xn.LICENSE_MISSING:case Xn.LICENSE_EXPIRED:case Xn.LICENSE_MINUTES_EXCEEDED:case Xn.LICENSE_PERIOD_INVALID:case Xn.LICENSE_MULTIPLE_SDK_SERVICE:case Xn.LICENSE_ILLEGAL:case Xn.TOKEN_EXPIRE:s=r;break;default:s=Ms.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Ms.NETWORK_ERROR)),this.joinInfo&&Ot.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Xn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==Xn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Yt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=se("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Ot.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));or("EVENT_REPORT_DOMAIN",r[1]),or("EVENT_REPORT_BACKUP_DOMAIN",r[1]),or("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(wn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Yt.REQUEST_RECOVER,(r,s,o)=>{if(!this.joinInfo)return o(new Ae(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Us(this,ds.REQUEST_NEW_GATEWAY_LIST).then(s).catch(o)}),this.signal.on(Yt.REQUEST_JOIN_INFO,async(r,s,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const d=Yr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(se("NEW_TURN_MODE")&&d){let v=d.servers,S=d.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],d.servers=v),Array.isArray(S)&&S.length>0&&(S=[S[0]],d.serversFromGateway=S),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:y}=await Us(this,ds.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:d});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:y,version:"2"}}))}catch(v){s(v)}}),this.signal.on(Yt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Yt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let o,c="";var d;r instanceof Ae?(o=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):o=r,Ot.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Yt.IS_P2P_DISCONNECTED,r=>{r(wT(this,ds.IS_P2P_DISCONNECTED))}),this.signal.on(Yt.DISCONNECT_P2P,()=>{this.emit(ds.DISCONNECT_P2P)}),this.signal.on(Yt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Yt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Yt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(ds.JOIN_RESPONSE,r,s)}),this.signal.on(Yt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=se("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const o=SH(r);this.emit(ds.PRE_CONNECT_PC,{candidates:o,fingerprint:s})}}}),this.signal.on(Yt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof se("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(se("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Kt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Kt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Kt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const s={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Kt.UNSUBSCRIBE_STREAMS,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,s){const o={action:r.find(c=>c.stream_type===Zn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Kt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const o={action:r.find(c=>c.stream_type===Zn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Kt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const o={action:r===Tt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Kt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const o={action:r===Tt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Kt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Kt.RESTART_ICE,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Ms.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!se("GATEWAY_WSS_ADDRESS"))return se("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Kt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let CP=0,JL=0;function Fd(t,r,s,o){return new ht((c,d)=>{r.timeout=r.timeout||se("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),CP+=Lh(r.data)):s&&(r.data.size?CP+=r.data.size:r.data instanceof FormData?CP+=mW(r.data):CP+=Lh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ba.request(r).then(h=>{typeof h.data=="string"?JL+=Lh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?JL+=h.data.byteLength:JL+=Lh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{ba.isCancel(h)?d(new Ae(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Ae(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Ae(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Ae(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(We){var st=0;return function(){return st<We.length?{done:!1,value:We[st++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(We,st,It){return We==Array.prototype||We==Object.prototype||(We[st]=It.value),We},o,c=function(We){We=[typeof globalThis=="object"&&globalThis,We,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var st=0;st<We.length;++st){var It=We[st];if(It&&It.Math==Math)return It}throw Error("Cannot find global object")}(this);function d(We,st){if(st)e:{var It=c;We=We.split(".");for(var Ke=0;Ke<We.length-1;Ke++){var U=We[Ke];if(!(U in It))break e;It=It[U]}(st=st(Ke=It[We=We[We.length-1]]))!=Ke&&st!=null&&s(It,We,{configurable:!0,writable:!0,value:st})}}function h(We){return(We={next:We})[Symbol.iterator]=function(){return this},We}function m(We){var st=typeof Symbol<"u"&&Symbol.iterator&&We[Symbol.iterator];return st?st.call(We):{next:r(We)}}if(d("Symbol",function(We){function st(U,ce){this.A=U,s(this,"description",{configurable:!0,writable:!0,value:ce})}if(We)return We;st.prototype.toString=function(){return this.A};var It="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ke=0;return function U(ce){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new st(It+(ce||"")+"_"+Ke++,ce)}}),d("Symbol.iterator",function(We){if(We)return We;We=Symbol("Symbol.iterator");for(var st="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),It=0;It<st.length;It++){var Ke=c[st[It]];typeof Ke=="function"&&typeof Ke.prototype[We]!="function"&&s(Ke.prototype,We,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return We}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var y;e:{var v={};try{v.__proto__={a:!0},y=v.a;break e}catch{}y=!1}o=y?function(We,st){if(We.__proto__=st,We.__proto__!==st)throw new TypeError(We+" is not extensible");return We}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(We){if(We.m)throw new TypeError("Generator is already running");We.m=!0}function D(We,st){return We.h=3,{value:st}}function G(We){this.g=new R,this.G=We}function j(We,st,It,Ke){try{var U=st.call(We.g.j,It);if(!(U instanceof Object))throw new TypeError("Iterator result "+U+" is not an object");if(!U.done)return We.g.m=!1,U;var ce=U.value}catch(me){return We.g.j=null,We.g.s(me),B(We)}return We.g.j=null,Ke.call(We.g,ce),B(We)}function B(We){for(;We.g.h;)try{var st=We.G(We.g);if(st)return We.g.m=!1,{value:st.value,done:!1}}catch(It){We.g.v=void 0,We.g.s(It)}if(We.g.m=!1,We.g.l){if(st=We.g.l,We.g.l=null,st.F)throw st.D;return{value:st.return,done:!0}}return{value:void 0,done:!0}}function J(We){this.next=function(st){return We.o(st)},this.throw=function(st){return We.s(st)},this.return=function(st){return function(It,Ke){P(It.g);var U=It.g.j;return U?j(It,"return"in U?U.return:function(ce){return{value:ce,done:!0}},Ke,It.g.return):(It.g.return(Ke),B(It))}(We,st)},this[Symbol.iterator]=function(){return this}}function ee(We,st){return st=new J(new G(st)),S&&We.prototype&&S(st,We.prototype),st}if(R.prototype.o=function(We){this.v=We},R.prototype.s=function(We){this.l={D:We,F:!0},this.h=this.C||this.u},R.prototype.return=function(We){this.l={return:We},this.h=this.u},G.prototype.o=function(We){return P(this.g),this.g.j?j(this,this.g.j.next,We,this.g.o):(this.g.o(We),B(this))},G.prototype.s=function(We){return P(this.g),this.g.j?j(this,this.g.j.throw,We,this.g.o):(this.g.s(We),B(this))},d("Array.prototype.entries",function(We){return We||function(){return function(st,It){st instanceof String&&(st+="");var Ke=0,U=!1,ce={next:function(){if(!U&&Ke<st.length){var me=Ke++;return{value:It(me,st[me]),done:!1}}return U=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce}(this,function(st,It){return[st,It]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var fe=function(We,st){for(var It=0;It<We.length;It++)st(We[It])},ye=function(We){return We.replace(/\r?\n|\r/g,`\r
`)},ve=function(We,st,It){return st instanceof Blob?(It=It!==void 0?It+"":typeof st.name=="string"?st.name:"blob",st.name===It&&Object.prototype.toString.call(st)!=="[object Blob]"||(st=new File([st],It)),[String(We),st]):[String(We),String(st)]},_e=function(We,st){if(We.length<st)throw new TypeError(st+" argument required, but only "+We.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Je=Ne.FormData,pt=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,_t=Ne.Request&&Ne.fetch,Rn=Ne.navigator&&Ne.navigator.sendBeacon,In=Ne.Element&&Ne.Element.prototype,yr=Ne.Symbol&&Symbol.toStringTag;yr&&(Blob.prototype[yr]||(Blob.prototype[yr]="Blob"),"File"in Ne&&!File.prototype[yr]&&(File.prototype[yr]="File"));try{new File([],"")}catch{Ne.File=function(st,It,Ke){return st=new Blob(st,Ke||{}),Object.defineProperties(st,{name:{value:It},lastModified:{value:+(Ke&&Ke.lastModified!==void 0?new Date(Ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),yr&&Object.defineProperty(st,yr,{value:"File"}),st}}var di=function(We){return We.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Zr=function(We){this.i=[];var st=this;We&&fe(We.elements,function(It){if(It.name&&!It.disabled&&It.type!=="submit"&&It.type!=="button"&&!It.matches("form fieldset[disabled] *"))if(It.type==="file"){var Ke=It.files&&It.files.length?It.files:[new File([],"",{type:"application/octet-stream"})];fe(Ke,function(U){st.append(It.name,U)})}else It.type==="select-multiple"||It.type==="select-one"?fe(It.options,function(U){!U.disabled&&U.selected&&st.append(It.name,U.value)}):It.type==="checkbox"||It.type==="radio"?It.checked&&st.append(It.name,It.value):(Ke=It.type==="textarea"?ye(It.value):It.value,st.append(It.name,Ke))})};if((t=Zr.prototype).append=function(We,st,It){_e(arguments,2),this.i.push(ve(We,st,It))},t.delete=function(We){_e(arguments,1);var st=[];We=String(We),fe(this.i,function(It){It[0]!==We&&st.push(It)}),this.i=st},t.entries=function We(){var st,It=this;return ee(We,function(Ke){if(Ke.h==1&&(st=0),Ke.h!=3)return st<It.i.length?Ke=D(Ke,It.i[st]):(Ke.h=0,Ke=void 0),Ke;st++,Ke.h=2})},t.forEach=function(We,st){_e(arguments,1);for(var It=m(this),Ke=It.next();!Ke.done;Ke=It.next()){var U=m(Ke.value);Ke=U.next().value,U=U.next().value,We.call(st,U,Ke,this)}},t.get=function(We){_e(arguments,1);var st=this.i;We=String(We);for(var It=0;It<st.length;It++)if(st[It][0]===We)return st[It][1];return null},t.getAll=function(We){_e(arguments,1);var st=[];return We=String(We),fe(this.i,function(It){It[0]===We&&st.push(It[1])}),st},t.has=function(We){_e(arguments,1),We=String(We);for(var st=0;st<this.i.length;st++)if(this.i[st][0]===We)return!0;return!1},t.keys=function We(){var st,It,Ke,U,ce=this;return ee(We,function(me){if(me.h==1&&(st=m(ce),It=st.next()),me.h!=3)return It.done?void(me.h=0):(Ke=It.value,U=m(Ke),D(me,U.next().value));It=st.next(),me.h=2})},t.set=function(We,st,It){_e(arguments,2),We=String(We);var Ke=[],U=ve(We,st,It),ce=!0;fe(this.i,function(me){me[0]===We?ce&&(ce=!Ke.push(U)):Ke.push(me)}),ce&&Ke.push(U),this.i=Ke},t.values=function We(){var st,It,Ke,U,ce=this;return ee(We,function(me){if(me.h==1&&(st=m(ce),It=st.next()),me.h!=3)return It.done?void(me.h=0):(Ke=It.value,(U=m(Ke)).next(),D(me,U.next().value));It=st.next(),me.h=2})},Zr.prototype._asNative=function(){for(var We=new Je,st=m(this),It=st.next();!It.done;It=st.next()){var Ke=m(It.value);It=Ke.next().value,Ke=Ke.next().value,We.append(It,Ke)}return We},Zr.prototype._blob=function(){var We="----formdata-polyfill-"+Math.random(),st=[],It="--"+We+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ke,U){return typeof Ke=="string"?st.push(It+di(ye(U))+`"\r
\r
`+ye(Ke)+`\r
`):st.push(It+di(ye(U))+'"; filename="'+di(Ke.name)+`"\r
Content-Type: `+(Ke.type||"application/octet-stream")+`\r
\r
`,Ke,`\r
`)}),st.push("--"+We+"--"),new Blob(st,{type:"multipart/form-data; boundary="+We})},Zr.prototype[Symbol.iterator]=function(){return this.entries()},Zr.prototype.toString=function(){return"[object FormData]"},In&&!In.matches&&(In.matches=In.matchesSelector||In.mozMatchesSelector||In.msMatchesSelector||In.oMatchesSelector||In.webkitMatchesSelector||function(We){for(var st=(We=(this.document||this.ownerDocument).querySelectorAll(We)).length;0<=--st&&We.item(st)!==this;);return-1<st}),yr&&(Zr.prototype[yr]="FormData"),pt){var Aa=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(We,st){Aa.call(this,We,st),We.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(We){We instanceof Zr?(We=We._blob(),this.B||this.setRequestHeader("Content-Type",We.type),pt.call(this,We)):pt.call(this,We)}}_t&&(Ne.fetch=function(We,st){return st&&st.body&&st.body instanceof Zr&&(st.body=st.body._blob()),_t.call(this,We,st)}),Rn&&(Ne.navigator.sendBeacon=function(We,st){return st instanceof Zr&&(st=st._asNative()),Rn.call(this,We,st)}),Ne.FormData=Zr}})();const FT=()=>{const t=se("AREAS");return t.length===0&&t.push($n.GLOBAL),Ec(t).call(t,(r,s,o)=>{const c=xH(s);return c?o===0?c:"".concat(r,",").concat(c):r},"")},xH=t=>t===$n.OVERSEA?"".concat(qs.ASIA,",").concat(qs.EUROPE,",").concat(qs.AFRICA,",").concat(qs.NORTH_AMERICA,",").concat(qs.SOUTH_AMERICA,",").concat(qs.OCEANIA):qs[t],ige=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const o=_P[s],c=Object.keys(o);c&&c.map(d=>{d!=="CODE"&&(r[d]=r[d].concat(o[d]))})}),r},RP={GLOBAL:{ASIA:[$n.CHINA,$n.JAPAN,$n.INDIA,$n.KOREA,$n.HKMC],EUROPE:[],NORTH_AMERICA:[$n.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},IP=Object.keys(RP[$n.GLOBAL]),QL=[$n.CHINA,$n.NORTH_AMERICA,$n.EUROPE,$n.ASIA,$n.JAPAN,$n.INDIA,$n.OCEANIA,$n.SOUTH_AMERICA,$n.AFRICA,$n.KOREA,$n.HKMC,$n.US],sge=function(t,r){let s=[];if(ot(t).call(t,$n.GLOBAL)){const d=[$n.GLOBAL,$n.OVERSEA],h=Object.keys(_P);if(r===$n.GLOBAL)throw new Ae(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===$n.CHINA)s=[$n.OVERSEA];else if(c=r,ot(IP).call(IP,c)){const m=(o=r,RP[$n.GLOBAL][o]||[]),y=[...d,r,...m];s=h.filter(v=>!ot(y).call(y,v))}else if(function(m){let y=!1;return IP.forEach(v=>{var S;ot(S=RP[$n.GLOBAL][v]).call(S,m)&&(y=!0)}),y}(r)){const m=function(v){let S;return IP.forEach(R=>{var P;ot(P=RP[$n.GLOBAL][R]).call(P,v)&&(S=R)}),S}(r),y=[...d,m,r];s=h.filter(v=>!ot(y).call(y,v))}else s=t;s=function(m){const y=[];return QL.forEach(v=>{ot(m).call(m,v)&&y.push(v)}),y.concat(m.filter(v=>!ot(QL).call(QL,v)))}(s)}else s=t;var o,c;return s};function LH(t){var r,s;if(!t&&ot(r=se("AREAS")).call(r,$n.EXTENSIONS))return x.debug("update area from ap : reset"),void ZL(fme,!0);if(!ot(s=se("AREAS")).call(s,$n.GLOBAL)||!t)return;let o=_P.EXTENSIONS;o&&(o={CODE:xH($n.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),o),or("AREAS",[$n.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?or(c,o[c][0]):or(c,o[c])}))}function ZL(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Ot.reportApiInvoke(null,{name:Pi.SET_AREA,options:t,tag:qr.TRACER});try{let o=[];if(typeof t=="string"&&(o=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!ot(tH).call(tH,d))throw new Ae(te.INVALID_PARAMS,"invalid area code")}),o=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new Ae(te.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),o=h?sge(m,h):m}if(!r){if(Ld.AREAS){const d=new Ae(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void x.warning("setArea is prohibited because of config-distribute")}if(ot(o).call(o,$n.GLOBAL)&&se("AREAS")===$n.EXTENSIONS){const d=new Ae(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void x.warning("setArea is prohibited because of ap extensions")}}or("AREAS",o,r);const c=ige(o);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?or(d,c[d][0]):or(d,c[d])}),x.debug("set area success:",o.join(","))}catch(o){throw s.onError(o),o}s.onSuccess()}function MH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Bh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?MH(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):MH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let e2=1;function oge(t,r,s,o,c){e2+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:e2,requestId:e2,version:zl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(d)};let m,y,v=t[0];return xd(async()=>{m=Date.now();const S=await Fd(v,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-m,S.code!==0){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:y});throw x.error(D.toString()),D}const R=JSON.parse(S.json_body);if(R.code!==200){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(D.toString()),D}if(!R.servers||R.servers.length===0){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(D.toString()),D}const P=function(D,G){return{addressList:D.servers.map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(se("WORKER_DOMAIN"),":").concat(j.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:D.workerToken,vid:D.vid}}(R,r);return se("LIVE_STREAMING_ADDRESS")&&(P.addressList=se("LIVE_STREAMING_ADDRESS")instanceof Array?se("LIVE_STREAMING_ADDRESS"):[se("LIVE_STREAMING_ADDRESS")]),Bh(Bh({},P),{},{responseTime:y})},(S,R)=>(Ot.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:y,serverIp:t[R%t.length]}),!1),(S,R)=>(Ot.apworkerEvent(s.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:y,serverIp:t[R%t.length]}),!!(S.code!==te.OPERATION_ABORTED&&S.code!==te.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(v=t[(R+1)%t.length],!0)),c)}let t2=1;function UH(t,r,s,o){let{url:c,areaCode:d}=t;const{clientId:h,sid:m}=r,y=Date.now();let v;const S=r.role,[R,P]=r2(r,d,[Ei.CHOOSE_SERVER]);let D=yi.networkState;return xd(async()=>{D&&yi.networkState===Rc.OFFLINE&&yi.onlineWaiter&&await ht.race([yi.onlineWaiter,gs(o&&o.maxRetryTimeout||Oi.maxRetryTimeout)]),D=yi.networkState;const{data:G,headers:j}=await Fd(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=j.http3==="1"?1:-1,Ot.reportResourceTiming(c,m),FH(G,c,r,y,[Ei.CHOOSE_SERVER],v);const B=LT(G,Ei.CHOOSE_SERVER);return n2(B),HL(B,c)},G=>(G&&Ot.joinChooseServer(m,{role:S,lts:y,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(j=>j.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(Ot.joinChooseServer(m,{role:S,lts:y,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),o)}function VH(t,r,s,o){let c,{url:d,areaCode:h,serviceIds:m}=t;const y=Date.now(),v=r.role,[S,R]=r2(r,h,m);let P;return xd(async()=>{P&&yi.networkState===Rc.OFFLINE&&yi.onlineWaiter&&await ht.race([yi.onlineWaiter,gs(o&&o.maxRetryTimeout||Oi.maxRetryTimeout)]),P=yi.networkState;const{data:D,headers:G}=await Fd(d,{data:S,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,Ot.reportResourceTiming(d,r.sid),FH(D,d,r,y,m,c);const j=LT(D,Ei.CHOOSE_SERVER),B=LT(D,r.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK);return n2(j),{gatewayInfo:HL(j,d),proxyInfo:B,url:d}},D=>(D.gatewayInfo&&Ot.joinChooseServer(r.sid,{role:v,lts:y,succ:!0,csAddr:d,serverList:D.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&Ot.joinWebProxyAP(r.sid,{lts:y,sucess:1,apServerAddr:d,turnServerAddrList:D.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),D=>D.code!==te.OPERATION_ABORTED&&(D.code===te.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(Ot.joinWebProxyAP(r.sid,{lts:y,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:D.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),D),!0)),o)}const FH=(t,r,s,o,c,d)=>{const{sid:h,clientId:m,cloudProxyServer:y}=s,v=[],S=R=>{R.flag===4096?Ot.joinChooseServer(h,{role:s.role,lts:o,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Ot.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const D={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};v.push(D),S(D)}if(P!==0){const D=oS(P),G={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):v.push(G),S(G)}}),v.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},n2=t=>{var r,s,o,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(se("AP_AREA")&&((o=t.detail)!==null&&o!==void 0&&o[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?LH(t.detail[23].toLowerCase()):LH()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let y=0;y<m.length;y++){var d;const v=vo(d=m[y]).call(d);t.addresses[y]&&m&&(t.addresses[y].fingerprint=v)}}if(se("GATEWAY_ADDRESS")&&se("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",se("GATEWAY_ADDRESS"));const h=se("GATEWAY_ADDRESS").map(m=>{var y,v;const S=(y=(v=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||v===void 0?void 0:v.fingerprint)!==null&&y!==void 0?y:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:S}});t.addresses=h}},age=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const o=oS(s.buffer.code);throw new Ae(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Ae(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},r2=(t,r,s)=>{const o=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:o,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Bh(Bh(Bh({6:t.stringUid,11:r,12:se("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};d.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(d)),[h,o]},cge=(t,r)=>{const s=Math.floor(Math.random()*1e12),o={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,s]};let uS=0;function dS(t){return ht.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const jT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:o,allFailedhandler:c,promisesCollector:d}=t,h=0;const m=r;let y,v=0;const S=async()=>{const R=(()=>{const P=h*m,D=P+m;return s.slice(P,D).map(o)})();d&&d.push(...R);try{y=await dS(R)}catch(P){if(v+=m,h++,!(v>=s.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),y},jH=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:o}=t;const c=r.length;let d=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(y){if(d++,d>=c||o!=null&&o(y))throw y;return h()}};return h()};async function i2(t,r,s,o){return{gatewayInfo:await async function(d,h,m,y){let v=null;const S=[],R=async()=>{const D=se("WEBCS_DOMAIN").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(B=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:FT()})),G=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(B=>B.url)}),j=await jT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:B=>(x.debug("[".concat(d.clientId,"] Connect to choose_server:"),B.url),UH(B,d,h,m)),allFailedhandler:B=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:S});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},P=async()=>{if(await gs(1e3),v!==null)return v;const D=se("WEBCS_DOMAIN_BACKUP_LIST").map(B=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:FT()})),G=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(B=>B.url)}),j=await jT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:B=>(x.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),B.url),UH(B,d,h,m)),allFailedhandler:B=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:S});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};try{return v=await dS([R(),P()]),S.length&&S.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),v}catch(D){throw D[0]}}(t,r,s,o)}}async function BH(t,r,s,o,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await i2(t,r,s,c);if(se("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:D}=await GH(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:P};const G=D.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Vs.tcpport,udpport:j.udpport||Vs.udpport,username:j.username||Vs.username,password:j.password||Vs.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const j=(h=t.uid)!==null&&h!==void 0?h:P.uid,B="glb:".concat(j.toString()),J=await Jx(B),ee=D.map(fe=>({turnServerURL:fe.address,tcpport:fe.tcpport||Vs.tcpport,udpport:fe.udpport||Vs.udpport,username:B,password:J,forceturn:!1,security:!0}));G.push(...ee)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await i2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:y}=await GH(t,r,s,c),v={gatewayInfo:y},S=m.map(P=>({turnServerURL:P.address,tcpport:d==="proxy3"?void 0:P.tcpport?P.tcpport:Vs.tcpport,udpport:d==="proxy4"?void 0:P.udpport?P.udpport:Vs.udpport,username:P.username||Vs.username,password:P.password||Vs.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var R;const P=(R=t.uid)!==null&&R!==void 0?R:y.uid,D="glb:".concat(P.toString()),G=await Jx(D),j=m.map(B=>({turnServerURL:B.address,tcpport:d==="proxy3"?void 0:B.tcpport||Vs.tcpport,udpport:d==="proxy4"?void 0:B.udpport||Vs.udpport,username:D,password:G,forceturn:d!=="proxy4",security:d==="proxy5"}));S.push(...j)}return t.turnServer={mode:"manual",servers:S},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),v}async function zH(t,r,s,o,c){const d=se("ACCOUNT_REGISTER").slice(0,se("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?d.map(y=>"https://".concat(r.proxyServer,"/ap/?url=").concat(y+"/api/v1")):d.map(y=>"https://".concat(y,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const y=await async function(v,S,R,P,D){const G=Date.now(),j={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let B=v[0];const J=await xd(()=>Fd(B+"".concat(B.indexOf("?")===-1?"?":"&","action=stringuid"),{data:j,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ee,fe)=>{if(ee.code===0){if(ee.uid<=0||ee.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(ee.uid),ee),Ot.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:ee.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:j}),new Ae(te.INVALID_UINT_UID_FROM_STRING_UID);return Ot.reqUserAccount(j.sid,{lts:G,success:!0,serverAddr:B,stringUid:j.string_uid,uid:ee.uid,errorCode:null,extend:j}),!1}const ye=oS(ee.code);return ye.retry&&(B=v[(fe+1)%v.length]),Ot.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:ee.uid,errorCode:ye.desc,extend:j}),ye.retry},(ee,fe)=>ee.code!==te.OPERATION_ABORTED&&(Ot.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:null,errorCode:ee.code,extend:j}),B=v[(fe+1)%v.length],!0),D);if(J.code!==0){const ee=oS(J.code);throw new Ae(te.UNEXPECTED_RESPONSE,ee.desc)}return J}(h,t,r,s,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),y.uid}catch(y){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},m),y}}async function lge(t,r,s){const o=se("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1")):o.map(d=>"https://".concat(d,"/api/v1"));try{return await jH({referenceList:c,asyncMapHandler:h=>async function(m,y,v,S){const R=Date.now(),P={sid:v.sid,opid:10,appid:v.appId,string_uid:y};try{const D=await Fd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const G=oS(D.code);throw new Ae(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Ae(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:D.uid,elapse:Date.now()-R}}catch(D){throw D}}(h,t,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function uge(t,r,s){const o=se("CDS_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),c=o.map(y=>function(v,S,R,P){const D=xn(),G={flag:64,cipher_method:0,features:Bh(Bh(Bh(Bh(Bh({install_id:cL(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:S.appId,version:zl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:tge.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return xd(()=>Fd(v,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,j=>j.code!==te.OPERATION_ABORTED,P)}(y,t,r,s));let d=null,h=null,m={};try{d=await dS(c)}catch(y){if(y.code===te.OPERATION_ABORTED)throw y;h=y}if(c.forEach(y=>y.cancel()),Ot.reportApiInvoke(t.sid,{name:Pi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{m=function(y){if(!y.test_tags)return{};const v=y.test_tags,S=Object.keys(v),R={};return S.forEach(P=>{var D;const G=vo(D=P.slice(4)).call(D),j=JSON.parse(v[P]),B=j[1];R[G]={tag:j[0]||"",value:B}}),R}(d)}catch{}return m}async function WH(t,r){const s=se("WEBCS_DOMAIN").concat(se("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:FT(),serviceIds:[Ei.CHOOSE_SERVER,Ei.CLOUD_PROXY_FALLBACK]}));try{return await jH({referenceList:s,asyncMapHandler:c=>async function(d,h,m){let y,{url:v,areaCode:S,serviceIds:R}=d;const P=Date.now(),[D,G]=r2(h,S,R);let j=yi.networkState;try{j&&yi.networkState===Rc.OFFLINE&&yi.onlineWaiter&&await ht.race([yi.onlineWaiter,gs(Oi.maxRetryTimeout)]),j=yi.networkState;const{data:B,headers:J}=await Fd(v,{data:D,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=J.http3==="1"?1:-1,(ve=>{const _e=[];if(ve.response_body.forEach(Ne=>{const Je=Ne.buffer.code;if(Ne.uri===23&&Je===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const pt={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ve.detail[502]}),flag:Ne.buffer.flag};_e.push(pt)}if(Je!==0){const pt=oS(Je),_t={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,pt.desc,{desc:pt.desc,retry:pt.retry,csIp:ve.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(_t.error.toString()):_e.push(_t)}}),_e.length)throw new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,_e.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!_e.find(Ne=>Ne.error.data.retry),csIp:ve.detail[502],desc:[...new Set(_e.map(Ne=>{var Je;return Ne==null||(Je=Ne.error)===null||Je===void 0||(Je=Je.data)===null||Je===void 0?void 0:Je.desc}).filter(Ne=>!!Ne))]})})(B);const fe=LT(B,Ei.CHOOSE_SERVER),ye=LT(B,Ei.CLOUD_PROXY_FALLBACK);return n2(fe),{gatewayInfo:HL(fe,v),proxyInfo:ye,opid:G,requestTime:P,url:v,isHttp3:y,elapse:Date.now()-P}}catch(B){throw B}}(c,t,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function GH(t,r,s,o){const c=se("PROXY_SERVER_TYPE3"),d=(D,G,j)=>{let B=j||c;return Array.isArray(B)&&(B=G%2==0?c[1]:c[0]),"https://".concat(B,"/ap/?url=").concat(D)};let h=null;const m=[],y=async()=>{const D=se("WEBCS_DOMAIN").slice(0,se("AJAX_REQUEST_CONCURRENT")).map((B,J)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(B,"/api/v2/transpond/webrtc?v=2"),J,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):d("".concat(B,"/api/v2/transpond/webrtc?v=2"),J),{url:ee,areaCode:FT(),serviceIds:[Ei.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(B=>B.url)}),j=await jT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:B=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),B.url),VH(B,t,r,s)),allFailedhandler:B=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},v=async()=>{if(await gs(1e3),h!==null)return h;const D=se("WEBCS_DOMAIN_BACKUP_LIST").map((B,J)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(B,"/api/v2/transpond/webrtc?v=2"),J,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):d("".concat(B,"/api/v2/transpond/webrtc?v=2"),J),{url:ee,areaCode:FT(),serviceIds:[Ei.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(B=>B.url)}),j=await jT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:B=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),B.url),VH(B,t,r,s)),allFailedhandler:B=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await dS([y(),v()]))}catch(D){throw D[0]}if(m.length&&m.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!S||!R)throw new Ae(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=P,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];ot(c).call(c,D)&&(t.proxyServer=D,x.setProxyServer(D),Ot.setProxyServer(D))}return h={gatewayInfo:S,proxyInfo:await fH(R,S.uid)},h}async function dge(t,r,s){const o=se("UAP_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=o.map(d=>function(h,m,y,v){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:zl,cname:m.cname,uid:m.uid.toString(),requestId:t2,seq:t2};t2+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return xd(async()=>{const P=await Fd(h,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const D=JSON.parse(P.json_body);if(D.code!==200){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw x.error(G.toString()),G}if(!D.servers||D.servers.length===0){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:D.vid,workerToken:D.workerToken,addressList:(se("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(se("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==te.OPERATION_ABORTED&&P.code!==te.UNEXPECTED_RESPONSE||P.data&&P.data.retry),v)}(d,t,r,s));try{const d=await dS(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function hge(t,r,s){let o=null;const c=[],d=async h=>{const m=se(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return h&&(await gs(1e3),o!==null)?o:await jT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),y),function(v,S,R,P){const[D]=cge(S,[Ei.CHOOSE_SERVER]);let G=yi.networkState;return xd(async()=>{G&&yi.networkState===Rc.OFFLINE&&yi.onlineWaiter&&await ht.race([yi.onlineWaiter,gs(P&&P.maxRetryTimeout||Oi.maxRetryTimeout)]),G=yi.networkState;const j=await Fd(v,{data:D,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return age(j,v)},()=>!1,j=>j.code!==te.OPERATION_ABORTED&&(j.code===te.UPDATE_TICKET_FAILED?j.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),j),!0)),P)}(y,t,r,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:c})};try{return o=await dS([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function HH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function s2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?HH(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):HH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class pge extends zr{get isSuccess(){return!!this.configs}constructor(r,s){super(),q(this,"configs",void 0),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"cancelToken",void 0),q(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),q(this,"interval",void 0),q(this,"mutex",void 0),q(this,"mutableParamsRead",!1),q(this,"configCache",{}),q(this,"limit_bitrate",void 0),this.mutex=new Ks("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),se("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},se("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ot.reportApiInvoke(null,{options:void 0,name:Pi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:qr.TRACER}).onSuccess(JSON.stringify(Ld))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await uge(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var d;const h=aT(d=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(d);for(let v=0;v<h.length;v++)for(let S=h.length-1;S>v;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const D=P.__priority,G=h[S-1],j=c[G].value;if(typeof j.__priority=="number"){if(!(D>j.__priority))continue;{const B=R;h[S]=h[S-1],h[S-1]=B}}else{const B=R;h[S]=h[S-1],h[S-1]=B}}}const m=Date.now();let y={};return h.forEach(v=>{const S=c[v].value.__expires;S&&S<=m||(y[v]=c[v])}),y}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Ae(te.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){nH(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(NT.UPDATE_BITRATE_LIMIT,r):this.emit(NT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&s2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},o=Object.keys(r),c=[];o.forEach(d=>{const h=r[d].value;s[d]=h;const m=h.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const y=h.__type,v=r[d].value,S=r[d].tag;let R=0;y?y===kW.REALTIME&&(R=1):Object.keys(v).some(P=>Object.prototype.hasOwnProperty.call(hL,P)||!LL()&&Object.prototype.hasOwnProperty.call(YA,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:m,params:y,isApplied:v}=d;this.store.sessionId&&Ot.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:m,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const d={};return Object.keys(c).forEach(h=>{const m=c[h].value,y=m.__expires,v=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(d,S)||(d[S]=s2(s2({value:m[S]},y&&{expires:y}),v&&{type:v}))})}),d}(r);try{var o;const c=(o=s.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete s.LIMIT_BITRATE,c&&nH(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const y=Date.now();Object.keys(m).forEach(v=>{const{value:S,type:R,expires:P}=m[v];P&&P<=y||((R===kW.REALTIME||Object.prototype.hasOwnProperty.call(hL,v))&&(Ld[v]=S,Ir[v]=S,x.debug("Update realtime parameters from config distribute",v,S)),R||LL()||!Object.prototype.hasOwnProperty.call(YA,v)||(Ld[v]=S,Ir[v]=S,x.debug("Update gateway parameters from config distribute",v,S)))})}catch(y){x.error("Error update config immediately: ".concat(m),y.message)}}(s);const d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(d))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Ir,o)){const{value:c,expires:d}=r[o];if(d&&d<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(Ir[o],c)||(Ld[o]=c,Ir[o]=c,this.emit(NT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class fge extends zr{constructor(){super(...arguments),q(this,"resultStorage",new Map)}setLocalAudioStats(r,s,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,s))}setLocalVideoStats(r,s,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,s){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(s))}record(r,s,o){if(se("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var d;const h=ot(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",$H[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",$H[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Ui&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let o=null;s._encoderConfig&&s._encoderConfig.frameRate&&(o=Ic(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Ui&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const $H={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Xs=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function KH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Q_(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?KH(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):KH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class BT{constructor(r){q(this,"store",void 0),q(this,"onStatsException",void 0),q(this,"onUploadPublishDuration",void 0),q(this,"onStatsChanged",void 0),q(this,"localStats",new Map),q(this,"remoteStats",new Map),q(this,"updateStatsInterval",void 0),q(this,"trafficStats",void 0),q(this,"trafficStatsPeerList",[]),q(this,"uplinkStats",void 0),q(this,"exceptionMonitor",void 0),q(this,"p2pChannel",void 0),q(this,"scalabilityMode",qA.L1T1),q(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new fge,this.exceptionMonitor.on("exception",(s,o,c)=>{this.onStatsException&&this.onStatsException(s,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ye.LocalAudioTrack)||Q_({},_L)}getLocalVideoTrackStats(){return this.localStats.get(Ye.LocalVideoTrack)||Q_({},yL)}getRemoteAudioTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===d);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(o[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:m}]=d;m&&(o[h]=s(h,m))});return o}getRemoteNetworkQualityStats(r){const s={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===d);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(o[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:m}]=d;m&&(o[h]=s(h,m))});return o}getRTCStats(){let r=0,s=0,o=0,c=0;const d=this.localStats.get(Ye.LocalAudioTrack);d&&(r+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(Ye.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Ye.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:S,videoStats:R}=v;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?Xs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Xs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,o){if(!r)return!1;const c=!!o&&s.framesDecodeFreezeTime>o.framesDecodeFreezeTime,d=!o||s.framesDecodeCount>o.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[o,c]=s;switch(o){case Ye.LocalVideoTrack:case Ye.LocalVideoLowTrack:{const h=c,m=Q_({},yL),y=r.getStats(),v=r.getLocalMedia(o);if(y){const S=y.videoSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(Ye.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case Ye.LocalAudioTrack:{const h=c,m=Q_({},_L),y=r.getStats(),v=r.getLocalMedia(o);if(y){const S=y.audioSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ye.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var o,c;let[d,{videoStats:h,audioStats:m,videoPcStats:y}]=s;const v=m,S=h,R=y,P=Q_({},zW),D=Q_({},WW),G=Q_({},Qfe),{audioTrack:j,videoTrack:B,audioSSRC:J,videoSSRC:ee}=r.getRemoteMedia(d);let fe;fe=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(o=fe)===null||o===void 0?void 0:o.audioRecv.find(Je=>Je.ssrc===J),ve=(c=fe)===null||c===void 0?void 0:c.videoRecv.find(Je=>Je.ssrc===ee),_e=this.trafficStats&&this.trafficStats.peer_delay.find(Je=>Je.peer_uid===d);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(P.codecType=ye.codec),ye.outputLevel?P.receiveLevel=Math.round(32767*ye.outputLevel):j&&(P.receiveLevel=Math.round(32767*j.getVolumeLevel())),P.receiveBytes=ye.bytes,P.receivePackets=ye.packets,P.receivePacketsLost=ye.packetsLost,P.receivePacketsDiscarded=ye.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=v?8*Math.max(0,P.receiveBytes-v.receiveBytes):0,P.totalDuration=v?v.totalDuration+1:1,P.totalFreezeTime=v?v.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=ye.jitterBufferMs,P.totalDuration>10&&BT.isRemoteAudioFreeze(j)&&(P.totalFreezeTime+=1)),ve){var Ne;ve.codec!=="H264"&&ve.codec!=="H265"&&ve.codec!=="VP8"&&ve.codec!=="VP9"&&ve.codec!=="AV1X"&&ve.codec!=="AV1"||(D.codecType=ve.codec),D.receiveBytes=ve.bytes,D.receiveBitrate=S?8*Math.max(0,D.receiveBytes-S.receiveBytes):0,D.decodeFrameRate=ve.decodeFrameRate<0?0:ve.decodeFrameRate,D.renderFrameRate=ve.decodeFrameRate<0?0:ve.decodeFrameRate,ve.outputFrame&&(D.renderFrameRate=ve.outputFrame.frameRate),ve.receivedFrame?(D.receiveFrameRate=ve.receivedFrame.frameRate,D.receiveResolutionHeight=ve.receivedFrame.height,D.receiveResolutionWidth=ve.receivedFrame.width):B&&(D.receiveResolutionHeight=B._videoHeight||0,D.receiveResolutionWidth=B._videoWidth||0),ve.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(ve.framesRateFirefox)),D.receivePackets=ve.packets,D.receivePacketsLost=ve.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const Je=S?S.totalFreezeTime:0,pt=S?S.totalDuration:0;D.totalDuration=S?S.totalDuration+1:1,D.totalFreezeTime=(Ne=ve.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Je||0,D.receiveDelay=ve.jitterBufferMs||0;const _t=!!ee&&r.getRemoteVideoIsReady(ee);ve.totalFreezesDuration===void 0&&B&&_t&&BT.isRemoteVideoFreeze(B,ve,R)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-Je)/(D.totalDuration-pt),1))}_e&&(P.end2EndDelay=_e.B_ad,D.end2EndDelay=_e.B_vd,P.transportDelay=_e.B_ed,D.transportDelay=_e.B_ed,P.currentPacketLossRate=_e.B_ealr4/100,D.currentPacketLossRate=_e.B_evlr4/100,G.uplinkNetworkQuality=_e.B_punq?_e.B_punq:0,G.downlinkNetworkQuality=_e.B_pdnq?_e.B_pdnq:0),this.remoteStats.set(d,{audioStats:P,videoStats:D,videoPcStats:ve,networkStats:G}),j&&this.exceptionMonitor.setRemoteAudioStats(j,P),B&&this.exceptionMonitor.setRemoteVideoStats(B,D)})}}class qH{constructor(){q(this,"destChannelMediaInfos",new Map),q(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){eH(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){eH(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){fP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function YH(t){if(!(t instanceof qH))return new Ae(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Ae(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Ae(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Qm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){q(this,"uid",void 0),q(this,"_uintid",void 0),q(this,"_trust_in_room_",!0),q(this,"_trust_audio_enabled_state_",!0),q(this,"_trust_video_enabled_state_",!0),q(this,"_trust_audio_mute_state_",!0),q(this,"_trust_video_mute_state_",!0),q(this,"_audio_muted_",!1),q(this,"_video_muted_",!1),q(this,"_audio_enabled_",!0),q(this,"_video_enabled_",!0),q(this,"_audio_added_",!1),q(this,"_video_added_",!1),q(this,"_is_pre_created",!1),q(this,"_video_pre_subscribed",!1),q(this,"_audio_pre_subscribed",!1),q(this,"_trust_video_stream_added_state_",!0),q(this,"_trust_audio_stream_added_state_",!0),q(this,"_audioTrack",void 0),q(this,"_videoTrack",void 0),q(this,"_dataChannels",[]),q(this,"_audioSSRC",void 0),q(this,"_videoSSRC",void 0),q(this,"_audioOrtc",void 0),q(this,"_videoOrtc",void 0),q(this,"_cname",void 0),q(this,"_rtxSsrcId",void 0),q(this,"_videoMid",void 0),q(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function XH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function JH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?XH(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):XH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const zT="9",QH=4e4;function ZH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function _f(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ZH(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ZH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var hS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(hS||{});const AP=new Map;function e9(t,r,s,o){let{scale:c}=t;if(c===0&&o===hS.UP||c>=r.length-1&&o===hS.DOWN)return t;let d=_f(_f({},t),{},{scale:o===hS.DOWN?++c:--c});switch(s){case"maintain-framerate":d=_f(_f({},d),r[c].motion);break;case"maintain-resolution":d=_f(_f({},d),r[c].detail);break;case"balanced":d=_f(_f({},d),r[c].balanced)}return d}function t9(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:n9(r)};AP.set(t,s)}else AP.delete(t)}function n9(t){const r=_f({},t),{bitrateMax:s,frameRate:o,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:j,BALANCE_FRAMERATE_FACTOR:B,BALANCE_RESOLUTION_FACTOR:J,MOTION_RESOLUTION_FACTOR:ee,MOTION_BITRATE_FACTOR:fe,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:ve}=uL,_e=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(D,1)*_e),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:d}}];for(let Je=1;Je<=y;Je++){const pt={bwe_up:Math.round(Math.pow(R,Je)*s),bwe_down:Math.round(Math.pow(P,Je+1)*s),fps_up:Math.round(Math.pow(G,Je)*_e),fps_down:Math.round(Math.pow(D,Je+1)*_e)},_t={scaleResolutionDownBy:c/Math.pow(J,Je),frameRate:Math.max(Math.round(Math.pow(B,Je)*o),h),bitrateMax:Math.max(Math.round(Math.pow(j,Je)*s),S),bitrateMin:Math.max(Math.round(Math.pow(j,Je)*d),v)},Rn={scaleResolutionDownBy:c/Math.pow(ee,Je),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(fe,Je)*s),S),bitrateMin:Math.max(Math.round(Math.pow(fe,Je)*d),v)},In={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Je)*o),h),bitrateMax:Math.max(Math.round(Math.pow(ve,Je)*s),S),bitrateMin:Math.max(Math.round(Math.pow(ve,Je)*d),v)};Ne.push({scale:Je,threshold:pt,balanced:_t,motion:Rn,detail:In})}return Ne}function mge(t,r,s,o,c,d){const h=AP.get(t)||{overUse:0,underUse:0,adaptationList:n9(c)},{adaptationList:m}=h;AP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:v}=uL,{scale:S}=o;let R,P;return typeof r=="number"&&r>0&&function(D,G,j,B){if(G>=j.length)return!1;let{threshold:{fps_down:J}}=j[G];return se("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(J=j[0].threshold.fps_down),D<J}(r,S,m,d)&&(h.overUse++,P=RT.CPU,h.overUse>y)||typeof s=="number"&&s>0&&function(D,G,j){if(G>=j.length)return!1;const{threshold:{bwe_down:B}}=j[G];return D<B}(s,S,m)&&(h.overUse++,P=RT.BANDWIDTH,h.overUse>y)?(h.overUse=0,h.underUse=0,R=e9(o,m,d,hS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(D,G,j,B){if(G===0)return;let{threshold:{fps_up:J}}=j[G];return se("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(J=j[1].threshold.fps_up),D>J}(r,S,m,d)&&function(D,G,j){if(G===0)return;const{threshold:{bwe_up:B}}=j[G];return D>B}(s,S,m)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,R=e9(o,m,d,hS.UP),R.scale===0&&(P=RT.NONE))),[R,P])}function r9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function o2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?r9(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):r9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function gge(t){var r;return!!se("ENABLE_AG_ADAPTATION")&&!!(t instanceof IL||ot(r=t._hints).call(r,_r.CUSTOM_TRACK))&&(!!se("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const o=xn();if(o.os!==Yi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=s}(14)&&Zz(17,4)||Qz(14)&&eW(17,4,!0)))}const PP=new Map;function OP(t,r){const s=PP.get(t);if(s){const{timer:o}=s;window.clearTimeout(o),PP.delete(t)}r.qualityLimitationReason=RT.NONE,t9(t)}function _ge(t,r){var s;let o;switch(r){case Ye.LocalAudioTrack:o=Zn.Audio;break;case Ye.LocalVideoTrack:o=ot(s=t._hints).call(s,_r.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:o=Zn.Low}return o}function a2(t){const r=jn();if(t.some(s=>s._bypassWebAudio))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function c2(t,r){a2(t);const s=new Ui;return t.forEach(o=>s.addAudioTrack(o)),s}const yge=!jn().supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&af();function kP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return yge?(s={spec:r,store:t},mf("PlanBConnection").create(s)):new zh(r,t)}function l2(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function i9(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(TT(t.turnServer.servers))return!1;if(se("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var kn;function s9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function jd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?s9(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):s9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let zh=(kn=class Ey extends iH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ot(s=Object.keys(XA)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"id",gr(5,"connection-")),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"forceTurn",!1),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"transportEventReceiver",void 0),q(this,"statsFilter",void 0),q(this,"extension",{useXR:se("USE_XR")}),q(this,"localCapabilities",void 0),q(this,"remoteCodecs",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"isPreallocation",!1),q(this,"preSSRCMap",new Map),q(this,"dataStreamChannelMap",new Map),q(this,"establishPromise",void 0),q(this,"recoveredDataChannelIds",[]),q(this,"currentDataChannelId",1),q(this,"supportAV1RtpSpec",!1),q(this,"mutex",void 0),q(this,"qualityLimitationReason",RT.NONE),q(this,"isFirstConnected",!1),this.store=s,this.forceTurn=i9(r),this.mutex=new Ks("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Ey.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=aL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,$r()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(o)return{transceiver:o,track:o.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Xm(o.sdp),d=await wH({filterRTX:!se("USE_PUB_RTX")&&!se("USE_SUB_RTX"),filterVideoFec:se("FILTER_VIDEO_FEC"),filterAudioFec:se("FILTER_AUDIO_FEC"),filterVideoCodec:se("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=TP(d),this.initialOffer=o,se("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:qA.L1T3}]});const v=await y.createOffer();if(!v.sdp)return void y.close();const S=Qa(v.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=d.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&AH(o.sdp)&&(h=Yr(d),(s=h).send&&(aS(Tt.VIDEO,s.send.videoExtensions),aS(Tt.AUDIO,s.send.audioExtensions)),s.recv&&(aS(Tt.VIDEO,s.recv.videoExtensions),aS(Tt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(aS(Tt.VIDEO,s.sendrecv.videoExtensions),aS(Tt.AUDIO,s.sendrecv.audioExtensions))),jd(jd({},c),{},{rtpCapabilities:h||d,offerSDP:o.sdp})}catch(o){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&AH(this.initialOffer.sdp)&&(s=r.rtpCapabilities,o=this.localCapabilities,s.send&&(vP(Tt.VIDEO,s.send.videoExtensions,o.send.videoExtensions),vP(Tt.AUDIO,s.send.audioExtensions,o.send.audioExtensions)),s.recv&&(vP(Tt.VIDEO,s.recv.videoExtensions,o.recv.videoExtensions),vP(Tt.AUDIO,s.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Yr(this._localCapabilities)}get rtpCapabilities(){return Yr(this._rtpCapabilities)}get candidates(){return Yr(this._candidates)}get iceParameters(){return Yr(this._iceParameters)}get dtlsParameters(){return Yr(this._dtlsParameters)}constructor(v){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_originCandidates",void 0),q(this,"_iceParameters",void 0),q(this,"_isUseExtmapAllowMixed",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),q(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,v=Yr(v);const{iceParameters:R,dtlsParameters:P,candidates:D,rtpCapabilities:G,setup:j,localCapabilities:B,cname:J}=v;this._rtpCapabilities=G,this._candidates=D,this._originCandidates=Yr(D),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=B,this.setup=j,this.cname=J,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,D=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let j=1;j<v;j++){const B=2*j+2e4,J=2*j+QH,{ssrcs:ee,ssrcGroups:fe}=J_([{ssrcId:B}],this.cname),{ssrcs:ye,ssrcGroups:ve}=J_([{ssrcId:J,rtx:se("USE_SUB_RTX")?J+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:zT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:D.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ye,ssrcGroups:ve,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:zT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:D.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ee,ssrcGroups:fe,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Hm(this.sessionDesc)}send(v,S,R,P){const{ssrcs:D,ssrcGroups:G}=J_(S,this.cname,se("SYNC_GROUP")?R:void 0),j=this.findPreloadMediaDesc(D);if(j){if($r()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,j.attributes.mid),P&&(P.twcc||P.remb)){const B=this.sessionDesc.mediaDescriptions.indexOf(j);return this.sessionDesc.mediaDescriptions[B]=this.mungSendMediaDesc(j,P),{mid:j.attributes.mid,needExchangeSDP:!0}}return{mid:j.attributes.mid,needExchangeSDP:!1}}{const B=this.findAvailableMediaIndex(v,D);let J;return B===-1||B===1&&(Ls()||function(){const ee=xn();return!(ee.name!==Hn.CHROME||!ee.osVersion)&&Number(ee.version)<=90}()||se("ENABLE_ENCODED_TRANSFORM")&&of())||B===0&&se("USE_SUB_RTX")||tW()?(J=this.createOrRecycleSendMedia(v,D,G,"sendonly",P),this.updateBundleMids()):(J=Yr(this.sessionDesc.mediaDescriptions[B]),J.attributes.direction="sendonly",J.attributes.ssrcs=D,J.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[B]=this.mungSendMediaDesc(J,P)),$r()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,J.attributes.mid),{mid:J.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:S}}batchSend(v){const S=v.map(D=>{let{kind:G,ssrcMsg:j,mslabel:B}=D;return this.send(G,j,B)}),R=[];let P=!1;return S.forEach(D=>{let{mid:G,needExchangeSDP:j}=D;j&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||$r()||tW()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,S,R,P){v.forEach((D,G)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",S,R,P[G])}),this.updateBundleMids()}stopReceiving(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const S=this.sessionDesc||Qa((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const P=this.rtpCapabilities.send,D=this.localCapabilities.send;for(const G of S.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const j=D.videoCodecs.filter(B=>{var J,ee;return(J=B.rtpMap)===null||J===void 0?void 0:ot(ee=J.encodingName.toLowerCase()).call(ee,"vp8")})||[D.videoCodecs[0]];G.media.fmts=j.map(B=>B.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,se("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:B}=J_([{ssrcId:QH,rtx:se("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=B}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const j=D.audioCodecs.filter(B=>{var J,ee;return(J=B.rtpMap)===null||J===void 0?void 0:ot(ee=J.encodingName.toLowerCase()).call(ee,"opus")})||[D.audioCodecs[0]];G.media.fmts=j.map(B=>B.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,lS(G),se("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:B}=J_([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=B}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(JH(JH({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(v){case Ys.TCP_RELAY:this._candidates=R;break;case Ys.UDP_TCP_RELAY:case Ys.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(v){v=Yr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=v.iceUfrag,S.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const S=[];for(let R=0;R<v;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(v,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if($r()){if(P){const D=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(D||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!D||D!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:zT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,S,R,P,D,G){const j=v._mediaStreamTrack.kind,B=this.rtpCapabilities.recv,J=UT(j,B,this.localCapabilities.send,j===Tt.VIDEO?P:D),ee=j===Tt.VIDEO?B.videoExtensions:B.audioExtensions;this.currentMidIndex+=1;const fe="".concat(this.currentMidIndex);let ye={media:{mediaType:j,port:zT,protos:["UDP","TLS","RTP","SAVPF"],fmts:J.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:J,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(fe)}};ye=this.mungRecvMediaDsec(ye,v,G);const ve=this.findFirstClosedMedia(j);if(ve){const _e=this.sessionDesc.mediaDescriptions.indexOf(ve);this.sessionDesc.mediaDescriptions[_e]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(v,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var ve;return ot(ve=Object.keys(XA)).call(ve,ye)}))],D=new Set(S);if(P.every(ye=>D.has(ye)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(ye=>S.some(ve=>{var _e;return ot(_e=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(_e,ve)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const j=[...new Set(G.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))];let B;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(j)),v.length===0)B=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(B=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&ot(v).call(v,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),B.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(S)),!1;if(se("USE_PUB_RTX")||se("USE_SUB_RTX")){const ye=YL(G,this.rtpCapabilities.recv.videoCodecs);G.push(...ye)}this._rtpCapabilities.recv.videoCodecs=G;const J=this.localCapabilities.send,ee=this.rtpCapabilities.recv,fe=UT(Tt.VIDEO,ee,J,R);return B.forEach(ye=>{const ve=fe.map(_e=>_e.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from"),ye.attributes.payloads,"to",fe),ye.attributes.payloads=fe,ye.media.fmts=ve}),!0}createOrRecycleSendMedia(v,S,R,P,D){const G=this.rtpCapabilities.send,j=v===Tt.VIDEO?G.videoCodecs:G.audioCodecs,B=v===Tt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const J="".concat(this.currentMidIndex);let ee={media:{mediaType:v,port:zT,protos:["UDP","TLS","RTP","SAVPF"],fmts:j.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:B,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:j,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(J)}};ee=this.mungSendMediaDesc(ee,D);const fe=this.findFirstClosedMedia(v);if(fe){const ye=this.sessionDesc.mediaDescriptions.indexOf(fe);this.sessionDesc.mediaDescriptions[ye]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,S,R){const P=Yr(v);return KL(P),cS(P,S),qL(P,S),bH(P),bP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(v,S){const R=Yr(v);return bP(R,S,this.localCapabilities.recv),lS(R),R}updateRecvMedia(v,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===v);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(S=>$r()?S.media.port==="0"&&S.media.mediaType===v:S.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||S===void 0?void 0:S.attributes.ssrcs}}(jd(jd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=RH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),se("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(se("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:y}=r;if(Array.isArray(y)&&y.length>0){const{mids:v}=this.remoteSDP.batchSend(y.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));v.forEach((S,R)=>{this.preSSRCMap.set(y[R].ssrcId,S)}),await VT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(d=>Object.assign({},{kind:d.kind,ssrcMsg:[{ssrcId:d.ssrcId,rtx:d.rtx}],mslabel:d.mslabel})));c.forEach((d,h)=>{this.preSSRCMap.set(o[h].ssrcId,d)})}await VT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return Bl(function*(){const d=yield Dn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=EP();r.forEach(B=>{const J=c.peerConnection.addTransceiver(B._mediaStreamTrack,jd({direction:"sendonly"},B.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(J),B._updateRtpTransceiver(J)}),$r()&&se("SIMULCAST")===!0&&(yield Dn(c.applySimulcastForFirefox(h,r)));const y=yield Dn(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(y.sdp,r,v),R=Qa(S),P=v.map(B=>{const J=R.mediaDescriptions.find(ee=>ee.attributes.mid===B);if(!J)throw new Error("Cannot extract ssrc from mediaDescription.");return EH(J,se("USE_PUB_RTX"))});let D;try{D=yield P}catch(B){D=[],c.remoteSDP.receive(r,s,o,D);const J=c.remoteSDP.toString();throw yield Dn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Dn(c.peerConnection.setRemoteDescription({type:"answer",sdp:J})),yield Dn(c.stopSending(v,!0)),B}c.remoteSDP.receive(r,s,o,D);const G=c.remoteSDP.toString(),j=c.logSDPExchange(S,"offer","local","send");return yield Dn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Dn(c.applySimulcastEncodings(h,r)),yield Dn(c.applySendEncodings(h,r)),j==null||j(G),yield Dn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((B,J)=>{const ee=v[J];return{localSSRC:P[J],id:ee,transceiver:B}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:se("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}s.forEach(d=>{d._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Le?o:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(y=>{var v;OP(this.id+y.mid,this),y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);h&&(await VT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(y=>y.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await VT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(d=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,y]=h;if(y===d)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Bl(function*(){const o=yield Dn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=jn().supportPCSetConfiguration,d=se("FORCE_TURN_TCP")||s.forceTurn;if(r===Ys.RELAY&&!c)return;if(c&&!d){const R=r===Ys.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield Dn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Xm(h.sdp),{remoteIceParameters:y}=yield m.iceParameters;s.remoteSDP.restartICE(y);const v=s.remoteSDP.toString(),S=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Dn(s.peerConnection.setLocalDescription(h)),S==null||S(v),yield Dn(s.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ys.TCP_RELAY),await VT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{OP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return jd(jd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new Le(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?$r()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:jd(jd({},Mh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:jd(jd({},Mh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},se("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(TT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:se("NEW_TURN_MODE")&&s.iceServers?(se("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Ey.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Ey.newTurnServerConfigToIceServers(r.turnServer.servers)),se("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Ey.turnServerConfigToIceServers(r.turnServer.servers)),se("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Ey.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),se("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),se("ENABLE_ENCODED_TRANSFORM")&&jn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(qm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!se("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{const c=se("NEW_TURN_MODE");c===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(qm(o.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(qm(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:d}=o.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o,c;if(s||(s=this.peerConnection.getSenders().find(B=>B.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=function(j,B){return j.getTransceivers().find(J=>J.sender.track===B||J.receiver.track===B)}(this.peerConnection,r._mediaStreamTrack),y=rme(r);if(gge(r)&&m&&s&&y&&this.getLocalVideoStats&&ot(o=["vp8","vp9"]).call(o,this.store.codec)){var v;const j=d.degradationPreference||(ot(v=r._hints).call(v,_r.CUSTOM_TRACK)?se("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(B,J,ee,fe,ye,ve){if(OP(B,ee),ye(J),fe!=="balanced"&&fe!=="maintain-framerate"&&fe!=="maintain-resolution")return;let _e=-1;t9(B,J);const Ne=window.setInterval(()=>{const pt=PP.get(B);if(!se("ENABLE_AG_ADAPTATION")||!pt)return OP(B,ee),void ye(J);const _t=ve();if(_t.sendPackets>0&&_t.OutgoingAvailableBandwidth>0){if(_e===-1)return void(_e=Date.now());if(Date.now()-_e<1e3)return;const Rn=_t.sendFrameRate,In=_t.OutgoingAvailableBandwidth,[yr,di]=mge(B,Rn,In,pt.adaptationConfig,J,fe);di&&(ee.qualityLimitationReason=di),yr&&pt.adaptationConfig.scale!==yr.scale&&(x.debug("[".concat(B,"] applyAdaptation: ").concat(ee.qualityLimitationReason,`
           sendFps `).concat(Rn,", bwe ").concat(In,", switch from ").concat(pt.adaptationConfig.scale," to ").concat(yr.scale," ")),pt.adaptationConfig=o2(o2({},pt.adaptationConfig),yr),ye(yr))}},se("CHECK_LOCAL_STATS_INTERVAL")),Je=o2({},J);PP.set(B,{timer:Ne,adaptationConfig:Je,originConfig:J,adaptationFunc:ye}),x.debug("[".concat(B,"] start adaptation, originConfig: ").concat(JSON.stringify(J),", degradationPreference: ").concat(fe))})(this.id+m.mid,y,this,j,B=>{s&&this.updateAdaptation(s,B)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:j,frameRate:B,scaleResolutionDownBy:J}=r._encoderConfig;j&&(h.maxBitrate=1e3*j),(ot(S=r._hints).call(S,_r.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(B&&(h.maxFramerate=Ic(B)),J&&J>=1&&(h.scaleResolutionDownBy=J))}const{maxFramerate:R}=se("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),se("DSCP_TYPE")&&af()){var P;const j=se("DSCP_TYPE");ot(P=["very-low","low","medium","high"]).call(P,j)&&(h.networkPriority=j)}const D=s.getParameters(),G=(c=D.encodings)===null||c===void 0?void 0:c[0];$r()&&!G&&(d.encodings=[h]),G&&Object.assign(G,h),Object.assign(D,d),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await s.setParameters(D),await async function(j,B,J){try{var ee;if(!jn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(j)||!se("ENABLE_SVC"))return;const fe={},ye={},ve=B.getParameters(),_e=(ee=ve.encodings)===null||ee===void 0?void 0:ee[0];ye.scalabilityMode=EP(J),_e&&Object.assign(_e,ye),Object.assign(ve,fe),await B.setParameters(ve),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ve.encodings)))}catch(fe){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",fe)}}(this.store.codec,s,se("SVC_MODE"))}async updateAdaptation(r,s){var o,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!jn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:y}=s;h&&(d.maxBitrate=1e3*h),m&&(d.maxFramerate=Ic(m)),y&&y>=1&&ot(o=["vp8","vp9"]).call(o,this.store.codec)&&(d.scaleResolutionDownBy=y);const v=r.getParameters(),S=(c=v.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,d),Object.assign(v,{});try{await r.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],d=s[o];d instanceof Ar&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Qa(r);return s.forEach((d,h)=>{const m=o[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(cS(y,d),TH(y,d,this.store.codec))}),Hm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var o,c,d,h,m;const v=r[y],S=s[y];if(S instanceof Ar&&!ot(o=S._hints).call(o,_r.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=S._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!$r()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Ar&&this.isVP8Simulcast(c)){const d=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=d.sender.getParameters();await d.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,o,c,d,h;return!!(r instanceof Ar&&se("SIMULCAST")&&this.store.codec==="vp8"&&!ot(s=r._hints).call(s,_r.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(se("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(jn().supportPCSetConfiguration){const s=Ey.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Rt(kn.prototype,"updateRemoteRTPCapabilities",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteRTPCapabilities"),kn.prototype),Rt(kn.prototype,"connect",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"connect"),kn.prototype),Rt(kn.prototype,"updateRemoteConnect",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteConnect"),kn.prototype),Rt(kn.prototype,"createDataChannels",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"createDataChannels"),kn.prototype),Rt(kn.prototype,"receive",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"receive"),kn.prototype),Rt(kn.prototype,"batchReceive",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"batchReceive"),kn.prototype),Rt(kn.prototype,"stopReceiving",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"stopReceiving"),kn.prototype),Rt(kn.prototype,"muteRemote",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"muteRemote"),kn.prototype),Rt(kn.prototype,"unmuteRemote",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteRemote"),kn.prototype),Rt(kn.prototype,"muteLocal",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"muteLocal"),kn.prototype),Rt(kn.prototype,"unmuteLocal",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteLocal"),kn.prototype),Rt(kn.prototype,"close",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),Rt(kn.prototype,"updateEncoderConfig",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"updateEncoderConfig"),kn.prototype),Rt(kn.prototype,"updateSendParameters",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"updateSendParameters"),kn.prototype),Rt(kn.prototype,"replaceTrack",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"replaceTrack"),kn.prototype),Rt(kn.prototype,"updateAdaptation",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"updateAdaptation"),kn.prototype),Rt(kn.prototype,"getRemoteSSRC",[wa],Object.getOwnPropertyDescriptor(kn.prototype,"getRemoteSSRC"),kn.prototype),kn);function wa(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{d()}},s}function u2(t,r){let s=document.createElement("video"),o=document.createElement("canvas");s.setAttribute("style","display:none"),o.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),o.width=Ic(r.width),o.height=Ic(r.height);const c=Ic(r.framerate||15);document.body.append(s),document.body.append(o);let d=t._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=o.getContext("2d");if(!h)throw new Ae(te.UNEXPECTED_ERROR,"can not get canvas context");const m=jn(),y=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];y.canvas||(y.canvas=o),o.startCapture=()=>{if(!s)return o.stopCapture&&o.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const S=s.videoWidth,R=s.videoHeight/S,P=o.width*R;Math.abs(P-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(s,0,0,o.width,o.height),y.requestFrame&&y.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,s.srcObject=new MediaStream([d]))},o.stopCapture=SL(()=>o.startCapture&&o.startCapture(),c);const v=y.stop;return y.stop=()=>{v.call(y),s&&(s.remove(),s.srcObject=null,s=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},y}var NP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(NP||{}),vi=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(vi||{}),Z_=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(Z_||{}),Si=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(Si||{}),ey=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(ey||{}),o9=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(o9||{}),Wh=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Wh||{}),Ca=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(Ca||{}),a9=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(a9||{}),Ra=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Ra||{}),DP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(DP||{});const ty=1e3,ny=6,xP=3,Ege=Math.max(ny,xP);function $t(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function c9(t){const r={[Ra.CONN_TYPE]:0,[Ra.RTT]:t.rtt,[Ra.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[Ra.CONN_TYPE]=1),s==="tcp"&&(r[Ra.CONN_TYPE]=3),s==="tls"&&(r[Ra.CONN_TYPE]=4);break}case"srflx":r[Ra.CONN_TYPE]=2;break;case"unknown":r[Ra.CONN_TYPE]=5;break;default:r[Ra.CONN_TYPE]=0}return r}function l9(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class u9 extends zr{constructor(r){super(),q(this,"store",void 0),q(this,"uploadWRTCStatsTimer",void 0),q(this,"uploadOutboundDenoiserStatsTimer",void 0),q(this,"uploadExtStatsTimer",void 0),q(this,"uploadExtUsageStatsTimer",void 0),q(this,"uploadInboundExtStatsTimer",void 0),q(this,"requestStats",void 0),q(this,"requestTransportStats",void 0),q(this,"requestLocalMedia",void 0),q(this,"requestRemoteMedia",void 0),q(this,"requestAllTracks",void 0),q(this,"requestVideoIsReady",void 0),q(this,"requestUploadStats",void 0),q(this,"requestUpload",void 0),q(this,"uploadOutboundStarted",!1),q(this,"uploadInboundStarted",!1),q(this,"uploadTransportStarted",!1),q(this,"uploadBaseStatsStarted",!1),q(this,"uploadExtensionUsageStarted",!1),q(this,"lastRecvStats",void 0),q(this,"lastSendStats",void 0),q(this,"lastRefRecvStats",void 0),q(this,"lastRefSendStats",void 0),q(this,"lastFullRecvStats",void 0),q(this,"lastFullSendStats",void 0),q(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%xP==0,o=r%ny==0;let c,d;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(d=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!d&&this.uploadInboundStarted&&(d=this.requestStats(!0)),c||d){var h;const m={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,d,s);v&&(m.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,o?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,o);v&&(m.outbound=[v])}if(this.uploadInboundStarted&&d){const v=this.getInboundStats(d,o?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,o);v&&(m.inbound=v)}const y=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;y&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[DP.RTC_PEER_CONNECTION_STATE]=oL[y]):m.misc=[{addition:{[DP.RTC_PEER_CONNECTION_STATE]:oL[y]}}]),this.requestUploadStats(m)}this.lastRecvStats=d,this.lastSendStats=c,o&&(this.lastFullRecvStats=d,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=d,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,o;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[DP.RTC_PEER_CONNECTION_STATE]:oL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Ege+1&&(r=1)},ty)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[Ra.RTT]:r.rtt,[Ra.CONN_TYPE]:void 0,[Ra.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=c9(r);if(this.store.useP2P){if(s){const d=c9(s);c[Ra.CONN_TYPE]+=d[Ra.CONN_TYPE]<<3}c[Ra.CONN_TYPE]+=110}else c[Ra.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||d.length===0)return;let h,m,y;return d.forEach(v=>{let[S,{track:R,ssrcs:P}]=v;switch(S){case Ye.LocalVideoLowTrack:case Ye.LocalVideoTrack:if(S===Ye.LocalVideoTrack){const D=function(B,J,ee,fe,ye,ve){const _e=J.videoSend.find(_t=>_t.ssrc===B);if(!_e)return;const Ne={},{sentFrame:Je,inputFrame:pt}=_e;if(ve&&($t(Ne,vi.QP_SUM,_e.qpSumPerFrame),pt&&Je)){const _t=pt.frameRate,Rn=Je.frameRate;Ne[vi.FREEZE]=function(In,yr){let di=!0;return di=!(In<=5)&&(In<=10?yr<3:In<=20?yr<4:yr<5),di}(_t,Rn)?1:0}if(ye){switch(Je&&($t(Ne,vi.HEIGHT,Je.height),$t(Ne,vi.WIDTH,Je.width),$t(Ne,vi.FRAME_RATE,Je.frameRate)),Ne[vi.DISABLED]=fe._originMediaStreamTrack&&!fe._originMediaStreamTrack.enabled||fe._mediaStreamTrack&&!fe._mediaStreamTrack.enabled?1:0,_e.adaptionChangeReason){case"none":Ne[vi.ADAPTATION]=0;break;case"cpu":Ne[vi.ADAPTATION]=1;break;case"bandwidth":Ne[vi.ADAPTATION]=2;break;case"other":Ne[vi.ADAPTATION]=3}let _t=0;_e.adaptionChangeReason&&(_t+=l9(_e.adaptionChangeReason)),J.qualityLimitationReason&&(_t+=l9(J.qualityLimitationReason)<<3),Ne[vi.ADAPTATION]=_t,Ne[vi.PLAYER_STATUS]=EL[fe._player?fe._player.videoElementStatus:"uninit"],$t(Ne,vi.NACKS,_e.nacksCount),$t(Ne,vi.PLIS,_e.plisCount),$t(Ne,vi.FIRS,_e.firsCount),$t(Ne,vi.AVG_ENCODE,_e.avgEncodeMs),$t(Ne,vi.HUGE_FRAME_SENT,_e.hugeFramesSent),$t(Ne,vi.BYTES_RETRANSMIT,_e.retransmittedBytesSent),$t(Ne,vi.PACKAGES_RETRANSMIT,_e.retransmittedPacketsSent),$t(Ne,vi.KEY_FRAMES_ENCODED,_e.keyFramesEncoded);const Rn=ee&&ee.videoSend.find(In=>In.ssrc===B);if(Rn){let In=ye?ty:ty*ny;Rn.timestamp&&_e.timestamp&&(In=_e.timestamp-Rn.timestamp),Rn.packets!=null&&_e.packets!=null&&$t(Ne,vi.PACKAGE_RATE,1e3*(_e.packets-Rn.packets)/In),_e.packetsLost!=null&&Rn.packetsLost!=null&&$t(Ne,vi.PACKAGE_LOST,_e.packetsLost-Rn.packetsLost),Rn.bytes!=null&&_e.bytes!=null&&$t(Ne,vi.BITRATE,8*(_e.bytes-Rn.bytes)/In)}}return Ne}(P[0].ssrcId,r,s,R,o,c),G=R&&function(B,J,ee,fe){const ye=J.videoSend.find(_e=>_e.ssrc===B);if(!ye)return null;const ve={};if(fe){const _e=ye.inputFrame,Ne=_e&&_e.height||ee.videoHeight||0,Je=_e&&_e.width||ee.videoWidth||0,pt=_e&&_e.frameRate||0;$t(ve,NP.HEIGHT,Ne),$t(ve,NP.WIDTH,Je),$t(ve,NP.FRAME_RATE,pt)}return ve}(P[0].ssrcId,r,R,o),j=function(B,J){const ee={};return J&&($t(ee,vi.RETRANSMIT,B.bitrate.retransmit),$t(ee,vi.TARGET_ENCODED,B.bitrate.targetEncoded),$t(ee,vi.ACTUAL_ENCODED,B.bitrate.actualEncoded),$t(ee,vi.TRANSMIT,B.bitrate.transmit),$t(ee,vi.BANDWIDTH,B.sendBandwidth)),ee}(r,o);m=Object.assign({},D,G,j)}else y=function(D,G,j,B){const J=G.videoSend.find(fe=>fe.ssrc===D);if(!J)return;const ee={};if(B){const fe=J.sentFrame;if(fe&&($t(ee,Z_.HEIGHT,fe.height),$t(ee,Z_.WIDTH,fe.width),$t(ee,Z_.FRAME_RATE,fe.frameRate)),j){const ye=j.videoSend.find(ve=>ve.ssrc===D);if(ye){let ve=ty*ny;ye.timestamp&&J.timestamp&&(ve=J.timestamp-ye.timestamp),ye.packets!=null&&J.packets!=null&&$t(ee,Z_.PACKAGE_RATE,1e3*(J.packets-ye.packets)/ve),J.packetsLost!=null&&ye.packetsLost!=null&&$t(ee,Z_.PACKAGE_LOST,J.packetsLost-ye.packetsLost),ye.bytes!=null&&J.bytes!=null&&$t(ee,Z_.BITRATE,8*(J.bytes-ye.bytes)/ve)}}}return ee}(P[0].ssrcId,r,s,o);break;case Ye.LocalAudioTrack:h=R&&function(D,G,j,B,J){const ee=G.audioSend.find(ye=>ye.ssrc===D);if(!ee)return;const fe={};if(J){fe[Wh.DISABLED]=B._originMediaStreamTrack&&!B._originMediaStreamTrack.enabled||B._mediaStreamTrack&&!B._mediaStreamTrack.enabled?1:0;const ye=100*B._source.getAccurateVolumeLevel(),ve=ee.inputLevel;if(ve!=null){const Ne=Math.ceil(50*Math.log10(100*ve+1));$t(fe,Wh.LEVEL,Ne)}$t(fe,o9.PCM_LEVEL,ye),$t(fe,Wh.AEC_RETURN_LOSS,ee.aecReturnLoss),$t(fe,Wh.AEC_RETURN_LOSS_ENH,ee.aecReturnLossEnhancement),$t(fe,Wh.BYTES_RETRANSMIT,ee.retransmittedBytesSent),$t(fe,Wh.PACKAGES_RETRANSMIT,ee.retransmittedPacketsSent),fe[Wh.FREEZE]=0;const _e=j&&j.audioSend.find(Ne=>Ne.ssrc===D);if(_e){let Ne=ty*ny;_e.timestamp&&ee.timestamp&&(Ne=ee.timestamp-_e.timestamp),_e.bytes!=null&&ee.bytes!=null&&$t(fe,Wh.BITRATE,8*(ee.bytes-_e.bytes)/Ne),_e.packets!=null&&ee.packets!=null&&$t(fe,Wh.PACKAGE_RATE,1e3*(ee.packets-_e.packets)/Ne)}}return fe}(P[0].ssrcId,r,s,R,o)}}),{high:m,low:y,audio:h}}getInboundStats(r,s,o,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach(m=>{let[y,v]=m;const S={peer:y.uid};if(v.has(Tt.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,P=y.videoTrack?function(D,G,j,B,J,ee,fe,ye){const ve=G.videoRecv.find(In=>In.ssrc===D);if(!ve)return;const _e={},{receivedFrame:Ne,outputFrame:Je,decodeFrameRate:pt}=ve,_t=j&&j.videoRecv.find(In=>In.ssrc===D);if($t(_e,ey.FRAME_RATE_DECODE,pt),ve.framesRateFirefox&&$t(_e,Si.FRAME_RATE,ve.framesRateFirefox),Ne&&$t(_e,Si.FRAME_RATE,Ne.frameRate),$t(_e,Si.FRAMES_DROPPED,ve.framesDroppedCount),$t(_e,Si.BYTES_RETRANSMIT,ve.retransmittedBytesReceived),$t(_e,Si.PACKAGES_RETRANSMIT,ve.retransmittedPacketsReceived),$t(_e,Si.PACKAGES_DISCARDED,ve.packetsDiscarded),$t(_e,Si.AVG_DECODE,ve.avgDecodeMs),$t(_e,Si.AVG_PROCESSING_DELAY,ve.avgProcessingDelayMs),$t(_e,Si.AVG_ASSEMBLY_TIME,ve.avgFramesAssembledFromMultiplePacketsMs),$t(_e,Si.AVG_INTER_FRAME_DELAY,ve.avgInterFrameDelayMs),$t(_e,Si.KEY_FRAMES_DECODED,ve.keyFramesDecoded),_t){const In=G.timestamp-j.timestamp||ty*(ye?ny:fe?xP:1);ve.packetsLost!=null&&_t.packetsLost!=null&&$t(_e,Si.PACKAGE_LOST,ve.packetsLost-_t.packetsLost),_t.bytes!=null&&ve.bytes!=null&&$t(_e,Si.BITRATE,8*(ve.bytes-_t.bytes)/In),_t.packets!=null&&ve.packets!=null&&$t(_e,Si.PACKAGE_RATE,1e3*(ve.packets-_t.packets)/In)}if(ye&&($t(_e,Si.QP_SUM,ve.qpSumPerFrame),_e[Si.FREEZE]=J&&BT.isRemoteVideoFreeze(B,ve,_t)?1:0),fe){var Rn;Ne?($t(_e,Si.HEIGHT,Ne.height),$t(_e,Si.WIDTH,Ne.width)):B&&($t(_e,Si.HEIGHT,B._videoHeight||0),$t(_e,Si.WIDTH,B._videoWidth||0)),Je&&$t(_e,ey.FRAME_RATE_OUTPUT,Je.frameRate);const In=(Rn=B._player)===null||Rn===void 0?void 0:Rn.rendFrameRate.toFixed(0);if(In&&$t(_e,ey.FRAME_RATE_RENDER,+In),$t(_e,Si.JITTER_BUFFER,ve.jitterBufferMs),$t(_e,Si.CURRENT_DELAY,ve.currentDelayMs),$t(_e,Si.FIRS,ve.firsCount),$t(_e,Si.NACKS,ve.nacksCount),$t(_e,Si.PLIS,ve.plisCount),B){_e[Si.DISABLED]=B._originMediaStreamTrack.enabled&&B._mediaStreamTrack.enabled?0:1;const yr=B._player;if(yr){const{freezeTimeCounterList:di,renderFreezeAccTime:Zr,videoElementStatus:Aa}=yr;if(di&&di.length>0&&$t(_e,ey.FREEZE_TIME,di.splice(0,1)[0]),ee&&uf.visibility==="visible"&&Aa===So.PLAYING&&jn().supportRequestVideoFrameCallback){const We=Math.min(6e3,Zr);yr.renderFreezeAccTime=Math.max(0,Zr-We),$t(_e,ey.FREEZE_TIME_RENDER,We)}if(typeof ve.totalFreezesDuration=="number"){const We=_t&&_t.totalFreezesDuration?ve.totalFreezesDuration-_t.totalFreezesDuration:ve.totalFreezesDuration;$t(_e,ey.FREEZE_DURATION,1e3*We)}}}if(_e[Si.PLAYER_STATUS]=EL[B._player?B._player.videoElementStatus:"uninit"],_t&&ve.totalInterFrameDelay!==void 0&&ve.totalSquaredInterFrameDelay!==void 0&&_t.totalInterFrameDelay!==void 0&&_t.totalSquaredInterFrameDelay!==void 0){const yr=ve.totalInterFrameDelay-_t.totalInterFrameDelay,di=ve.totalSquaredInterFrameDelay-_t.totalSquaredInterFrameDelay,Zr=ve.framesDecodeCount-_t.framesDecodeCount,Aa=yr/Zr*1e3,We=Math.round(1e3*Math.sqrt((di-Math.pow(yr,2)/Zr)/Zr));!isNaN(We)&&Aa+We>Math.max(3*Aa,Aa+150)&&(_e[Si.I_FRAME_DELAY]=We)}}return _e}(y._videoSSRC,r,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(v.has(Tt.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(P,D,G,j,B,J){const ee=D.audioRecv.find(_e=>_e.ssrc===P);if(!ee)return;const fe={},ye=G&&G.audioRecv.find(_e=>_e.ssrc===P);if($t(fe,Ca.JITTER,ee.jitterMs),$t(fe,Ca.BYTES_RETRANSMIT,ee.retransmittedBytesReceived),$t(fe,Ca.PACKAGES_RETRANSMIT,ee.retransmittedPacketsReceived),$t(fe,Ca.PACKAGES_DISCARDED,ee.packetsDiscarded),$t(fe,Ca.AVG_PROCESSING_DELAY,ee.avgProcessingDelayMs),ye){const _e=D.timestamp-G.timestamp||ty*(J?ny:B?xP:1);ee.packets!=null&&ye.packets!=null&&$t(fe,Ca.PACKAGE_RATE,1e3*(ee.packets-ye.packets)/_e),B&&ye.bytes!=null&&ee.bytes!=null&&$t(fe,Ca.BITRATE,8*(ee.bytes-ye.bytes)/_e),ee.packetsLost!=null&&ye.packetsLost!=null&&$t(fe,Ca.PACKAGE_LOST,ee.packetsLost-ye.packetsLost)}if(J){const{receivedFrames:_e,droppedFrames:Ne}=ee;_e!=null&&Ne!=null&&(fe[Ca.FREEZE]=(ve=_e)===0||100*Ne/ve>20?1:0)}var ve;if(B){const _e=100*j._source.getAccurateVolumeLevel(),Ne=ee.outputLevel;if(Ne!=null){const Je=Math.ceil(50*Math.log10(100*Ne+1));$t(fe,a9.LEVEL,Je)}if($t(fe,Ca.PCM_LEVEL,_e),j&&(fe[Ca.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1),$t(fe,Ca.JITTER_BUFFER,ee.jitterBufferMs),$t(fe,Ca.CURRENT_DELAY,ee.jitterBufferMs),fe[Ca.PLAYER_STATUS]=EL[Ta.getPlayerState(j.getTrackId())],ye){const Je=ee.concealedSamples-ye.concealedSamples;Je>0&&$t(fe,Ca.CONCEALED_SAMPLES,Je);const pt=ee.totalSamplesReceived-ye.totalSamplesReceived;pt>0&&$t(fe,Ca.TOTAL_SAMPLES_RECEIVED,pt)}}return fe}(y._audioSSRC,r,s,y.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof rP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(kT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,o]=r;o.has(Tt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(Tt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),o={connectionInterval:se("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of d)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,S]of h)S.has(Tt.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),S.has(Tt.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(v,S){const R={};for(const{id:j,value:B,level:J,direction:ee}of v){var P;const fe=(P=S.get(j))!==null&&P!==void 0?P:0,ye=B===2?fe+se("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:fe;var D,G;S.set(j,ye),R[j]?(B===2&&(R[j].value=B),J>R[j].level&&(R[j].level=J),ee==="remote"&&(R[j].remoteUidCount+=1),R[j].totalTs=(D=S.get(j))!==null&&D!==void 0?D:0):R[j]={value:B,level:J,remoteUidCount:ee==="local"?0:1,totalTs:(G=S.get(j))!==null&&G!==void 0?G:0}}return Object.keys(R).map(j=>{const{level:B,value:J,totalTs:ee}=R[j];return{id:j,level:B,value:J,totalTs:ee}})}(c,r);const m=Date.now(),y=m>s?m:s+1;this.requestUpload&&this.requestUpload(kT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:y})},se("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const vge=se("ICE_RESTART_INTERVAL");let LP=new Map,pS=new Map,Zm=[Ys.UDP_TCP_RELAY,Ys.TCP_RELAY,Ys.RELAY],d2=se("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jn().supportPCSetConfiguration;function d9(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=LP.get(t.id);s&&(window.clearTimeout(s),LP.delete(t.id));const o=pS.get(t.id);r&&o&&o.index===Zm.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),pS.delete(t.id))}function h9(t,r,s){if(LP.size===0&&pS.size===0&&(Array.isArray(se("RESTART_SEQUENCE"))&&se("RESTART_SEQUENCE").length>0&&!function(m,y){if(m.length!==y.length)return!1;for(let v=0;v<m.length;v+=1){const S=m[v];if(m.filter(R=>R===S).length!==y.filter(R=>R===S).length)return!1}return!0}(Zm,se("RESTART_SEQUENCE"))&&(Zm=se("RESTART_SEQUENCE").filter(m=>{var y;if(ot(y=Object.values(Ys)).call(y,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Zm.join(" => ")))),d2=se("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jn().supportPCSetConfiguration),Zm.length===0)return void s();let o,{index:c=0,type:d}=pS.get(t.id)||{};if(d2&&d===Ys.RELAY)return void s();let h=d&&c>=Zm.length-1;if(d2)d=Ys.RELAY;else{if(h)return void s();d?(c++,d=Zm[c]):(d=Zm[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),pS.set(t.id,{index:c,type:d}),o=window.setTimeout(()=>h9(t,r,s),vge),LP.set(t.id,o)}var yn;function p9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Gh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?p9(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):p9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function f9(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=Lx,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new MP(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function MP(t){function r(s){if(Object(s)!==s)return ht.reject(new TypeError(s+" is not an object."));var o=s.done;return ht.resolve(s.value).then(function(c){return{value:c,done:o}})}return MP=function(s){this.s=s,this.n=s.next},MP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?ht.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?ht.reject(s):r(o.apply(this.s,arguments))}},new MP(t)}let WT=(yn=class extends zr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Vt.StateChange,r,this._state)}constructor(t,r){super(),q(this,"isPlanB",void 0),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"connection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"remoteDataChannelMap",new Map),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"pendingLocalDataChannels",[]),q(this,"pendingRemoteDataChannels",[]),q(this,"statsCollector",void 0),q(this,"shouldForwardP2PCreation",void 0),q(this,"iceFailedCount",0),q(this,"dtlsFailedCount",0),q(this,"mutex",void 0),q(this,"_state",Jn.Disconnected),q(this,"_pcStatsUploadType",se("NEW_ICE_RESTART")?ff.FIRST_CONNECTION:ff.OLD_FIRST_CONNECTION),q(this,"_isStartRestartIce",!1),q(this,"_restartTimer",void 0),q(this,"_isTryConnecting",!1),q(this,"_iceError",null),q(this,"_forceTurn",!1),q(this,"_isWaitPcToRePub",!1),q(this,"handleMuteLocalTrack",async(s,o,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Jn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void o();const m=h.find(v=>v[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const y=this.createMuteMessage(h);await mr(this,Vt.RequestMuteLocal,y),o()}catch(h){c(h)}finally{d()}}),q(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Jn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();const m=h.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];if(v.track._originMediaStreamTrack.stop(),!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const S=s._mediaStreamTrack.clone();v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}else{const S=u2(s,wT(this,Vt.RequestLowStreamParameter));v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}await new ht((S,R)=>{this.handleReplaceTrack(v.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const y=this.createUnmuteMessage(h);await mr(this,Vt.RequestUnmuteLocal,y),o()}catch(h){c(h)}finally{d()}}),q(this,"handleUpdateVideoEncoder",async(s,o,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==Jn.Connected)return void o();const{id:v,track:S}=y;await this.connection.updateSendParameters(v,S),await this.connection.updateEncoderConfig(v,S),this.emit(Vt.UpdateVideoEncoder,S),o()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Jn.Connected)return void o();const{id:m,track:y}=h;await this.connection.updateSendParameters(m,y),o()}catch(h){c(h)}finally{d()}}),q(this,"handleReplaceMixingTrack",async(s,o,c,d)=>{if(!this.connection||this.state!==Jn.Connected)return void o();const h=c2([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),o()}catch(v){c(v)}finally{var y;(y=m)===null||y===void 0||y()}}),q(this,"handleReplaceTrack",async(s,o,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.connection||!v||this.state!==Jn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),this.isPlanB){const S=v[1];S.id=s._mediaStreamTrack.id,this.localTrackMap.set(v[0],S)}if(v[0]===Ye.LocalVideoTrack&&!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ht((P,D)=>{this.handleReplaceTrack(S.track,P,D,!0)})}}o()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),q(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new u9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ks("P2PChannel-mutex",this.store.clientId),this.isPlanB=!jn().supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&af(),this.shouldForwardP2PCreation=se("FORWARD_P2P_CREATION")&&jn().supportPCSetConfiguration&&Kx(),this.shouldForwardP2PCreation&&(this.connection=kP(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=Jn.New,this._forceTurn=i9(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=kP(this.store,t),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=se("NEW_ICE_RESTART")?ff.FIRST_CONNECTION:ff.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");se("ENABLE_PREALLOC_PC")&&this.state===Jn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return ot(d=[Ye.LocalVideoLowTrack,Ye.LocalVideoTrack]).call(d,h)}),s=r.map(c=>{let[,{id:d}]=c;return d}),o=r.map(c=>{let[d]=c;return d});if(this.connection instanceof zh){if(Ot.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!ot(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(d=>ot(t).call(t,d));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof zh&&this.connection.peerConnectionState!=="closed"&&ot(t=[Jn.New,Jn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Jn.Connected){if(this.state===Jn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var o;ot(o=this.pendingLocalDataChannels).call(o,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const o=Date.now();this.store.publish(s.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const o=Date.now();this.store.publish(s.id+"","datachannel",void 0,o)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var o=this;return Bl(function*(){const c=yield Dn(o.mutex.lock("From P2PChannel.publish"));try{var d;const h=o.connection&&ot(d=["disconnected","failed"]).call(d,o.connection.peerConnectionState);if(!o.connection||o.state!==Jn.Connected||h){if(o.state===Jn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(t);const y=t.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(y),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Xs.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield Dn(o.tryToUnmuteAudio(t)));yield*OA(f9(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return Bl(function*(){r.forEach(P=>{let{track:D,type:G}=P;const j=Date.now();s.store.publish(D.getTrackId(),G===Ye.LocalAudioTrack?"audio":"video",j)}),s.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:D}=P;return D}),c=yield Dn(t.send(o,s.store.codec,s.store.audioCodec)),d=(yield Dn(c.next())).value,h=s.createGatewayPublishMessage(r,d);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===te.WS_ABORT&&r.forEach(D=>{let{track:G}=D;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),P}const y=s.mapPubResToRemoteConfig(h,m,o),v=(yield Dn(c.next(y))).value;if(s.state===Jn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");se("ENABLE_VIDEO_SEI");const S=se("ENABLE_ENCODED_TRANSFORM"),R=se("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const D=P.getRTCRtpTransceiver();if(!D||!S)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:j}=wP();P.trackMediaType===Tt.VIDEO?await G(D.sender,P):P.trackMediaType===Tt.AUDIO&&await j(D.sender,{metadata:R?()=>{const B=P.metadata.shift();return B&&B.value}:void 0})}),r.forEach(P=>{let{type:D}=P;s.statsCollector.addLocalStats(D)}),s.assignLocalTracks(r,v),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:D,type:G}=P;const j=Date.now();s.store.publish(D.getTrackId(),G===Ye.LocalAudioTrack?"audio":"video",void 0,j)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Ar))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=s,c=function(d,h){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=$L(d,h)),m.maxFramerate=d.framerate?Ic(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m}(t,o);if(o._encoderConfig||(o._encoderConfig={}),r!==Ye.LocalVideoLowTrack||!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=o._originMediaStreamTrack;if(!d.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const y=h.canvas;m.width&&(y.width=Ic(m.width)),m.height&&(y.height=Ic(m.height)),m.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=SL(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},Ic(m.framerate)))})(d,t)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(t){var r=this;return Bl(function*(){if(!r.connection||r.state!==Jn.Connected)return;const s=yield Dn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ye.LocalVideoTrack);if(!c)throw new Le(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ye.LocalVideoLowTrack))throw new Le(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:Ye.LocalVideoLowTrack}];if(yield*OA(f9(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get(Ye.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Dn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Us(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Us(this,Vt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:o}=this.pendingRemoteTracks[r];(o!==Tt.AUDIO||s._audio_added_&&s._audioSSRC)&&(o!==Tt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await Us(this,Vt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===Tt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(Vt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Jn.Connected)return void t.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(o=>o[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Jn.Connected)return void t.forEach(s=>{const o=this.pendingLocalDataChannels.indexOf(s);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const o=this.localDataChannels.indexOf(s);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Jn.Connected)return;const t=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Ye.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:d}]=o;return{type:c,track:d}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Jn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(o.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(o=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(t,new Map([[o.id,o]]));const d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:y}=h;return m.uid===t.uid&&y===o.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),s.map(o=>o.id)}async subscribe(t,r,s,o,c){var d;if(!this.connection||this.state!==Jn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let h,m,y;const v=this.connection.getPreMedia(s);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=v.transceiver,h=v.track,m=v.id;else if(c){const P=c.find(G=>{let{stream_type:j}=G;return j===r});if(!P)throw new Le(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const D=await this.connection.receive(r,P.ssrcs,String(t._uintid),P.attributes);this.connection instanceof zh&&(y=D.transceiver),h=D.track,m=D.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:o}],String(t._uintid),void 0);this.connection instanceof zh&&(y=P.transceiver),h=P.track,m=P.id}if(r===Tt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new eS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),y&&t._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new Zv(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),y&&t._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._videoTrack)),y&&se("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:D}=wP();r==Tt.VIDEO?await P(y.receiver,{onSei:se("ENABLE_VIDEO_SEI")&&(G=>{var j;return(j=t._videoTrack)===null||j===void 0?void 0:j._onSei(G)})}):r==Tt.AUDIO&&await D(y.receiver,{enableTopn:!!se("ENABLE_AUDIO_TOPN"),enableMetadata:!!se("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(Vt.AudioMetadata,G)}})}const S=this.remoteUserMap.get(t);S?S.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:D,kind:G}=P;return D.uid===t.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Vt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Jn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var d;let{user:h,mediaType:m}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);d?s.set(c.ssrcId,d):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:d,mediaType:h,ssrcId:m,rtxSsrcId:y}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:y}],mslabel:String(d._uintid)}}));r.forEach((c,d)=>{s.set(c.ssrcId,o[d])});for(const{user:c,mediaType:d,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:y,id:v,transceiver:S}=m;if(S&&se("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=wP();d==Tt.VIDEO?await D(S.receiver,{onSei:se("ENABLE_VIDEO_SEI")&&(j=>{var B;return(B=c._videoTrack)===null||B===void 0?void 0:B._onSei(j)})}):d==Tt.AUDIO&&await G(S.receiver,{enableTopn:!!se("ENABLE_AUDIO_TOPN"),enableMetadata:!!se("ENABLE_AUDIO_METADATA"),onMetadata:j=>{this.safeEmit(Vt.AudioMetadata,j)}})}if(d===Tt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(y):(c._audioTrack=new eS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(y):(c._videoTrack=new Zv(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),se("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=wP();d==Tt.VIDEO?await D(S.receiver,{onSei:j=>{var B;(B=c._videoTrack)===null||B===void 0||B._onSei(j)}}):d==Tt.AUDIO&&await G(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(d,v):this.remoteUserMap.set(c,new Map([[d,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(D=>{let{user:G,kind:j}=D;return G.uid===c.uid&&d===j});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(Vt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:y}=h;return r!==void 0?m.uid===t.uid&&r===y:m.uid===t.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Jn.Connected||s||o.forEach(h=>{let{kind:m}=h;var y;if(m===Tt.AUDIO)(y=t._audioTrack)===null||y===void 0||y._destroy(),t._audioTrack=void 0;else if(m===Tt.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Jn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:y}]=h;var v,S;if(y===Tt.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),y===Tt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(y===Tt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(t);return s.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:y,kind:v}=m;return d!==void 0?y.uid===c.uid&&d===v:y.uid===c.uid});h.forEach(m=>{const y=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(y,1)}),r=r.concat(h)}if(!this.connection||this.state!==Jn.Connected)return void r.forEach(c=>{let{user:d,kind:h}=c;var m;if(h===Tt.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===Tt.VIDEO){var y;(y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0}});const s=Ec(t).call(t,(c,d)=>{let{user:h,mediaType:m}=d;const y=this.filterTobeUnSubscribedTracks(h,m);return c.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));const o=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:h}]=c;var m,y;if(h===Tt.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===Tt.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0;else if(h===Tt.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),(v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0}}),o}isPreSubScribe(t){return!this.connection||this.state!==Jn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===Tt.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Ye.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Ye.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ui){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ye.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===Ye.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===Ye.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get(Ye.LocalAudioTrack),m=o?this.localTrackMap.get(Ye.LocalVideoLowTrack):this.localTrackMap.get(Ye.LocalVideoTrack);Ot.publish(this.store.sessionId,{eventElapse:Xs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(y=>y instanceof Qr),m=o?(d=this.localTrackMap.get(Ye.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(y=>y instanceof Ar);Ot.publish(this.store.sessionId,{eventElapse:Xs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===Tt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Ot.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===Tt.VIDEO,audio:o===Tt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Xs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ks("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=kP(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ye.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ui){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Jn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ye.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ye.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Ar||r&&r.track instanceof Qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(sl(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ye.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=aT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Jn.Reconnecting,se("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=kP(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case Ye.LocalVideoTrack:ot(r=o._hints).call(r,_r.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ye.LocalAudioTrack:o instanceof Ui?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ye.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(sl(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Vt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(sl(s).call(s)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:o,id:c}=s;if((t instanceof Qm?t.uid:t)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Qm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Bl(function*(){if(!r.connection||r.state!==Jn.Connected)return;const s=yield Dn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Dn(r.connection.restartICE(t));const d=yield Dn(o.next());if(d.done)return;const h=d.value,m=yield h;switch(l2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Ys.UDP_TCP_RELAY:r._pcStatsUploadType=ff.UDP_TCP_RESTART;break;case Ys.TCP_RELAY:r._pcStatsUploadType=ff.TCP_RESTART;break;case Ys.RELAY:r._pcStatsUploadType=ff.RELAY_RESTART;break;default:r._pcStatsUploadType=ff.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(d){var c;(c=o)===null||c===void 0||c.throw(d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalAudioTrack),o=t.videoSend.find(D=>D.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(D=>D.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!o||!c)return 1;const d=rl(this,Vt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&d?(y+d)/2:y||d)||0,S=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(_r.SCREEN_TRACK)===-1){const D=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(D&&G){const j=(1e3*D-G)/(1e3*D);return qG[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,d=o._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const y=rl(this,Vt.NeedSignalRTT),v=t.rtt,S=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let D=.7*P*100/50+.3*S/1500;R&&(D=.6*P*100/50+.2*S/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new ht((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Jn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return t===h});if(!o)return;const c=o[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,o[1].id)),this.isPlanB){const d=o[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Ye.LocalVideoTrack&&!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const d=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new ht((m,y)=>{this.handleReplaceTrack(d.track,m,y,!0)})}}}filterTobePublishedTracks(t,r,s){const o=[],c=this.getAllTracks();t=jv(t=t.filter(y=>c.indexOf(y)===-1));let d,h=!1;const m=this.localTrackMap.get(Ye.LocalAudioTrack);for(const y of t){if(y instanceof Ar&&(this.localTrackMap.has(Ye.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:Ye.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);o.push({track:v,type:Ye.LocalVideoLowTrack})}if(y instanceof Qr)if(m){const v=m.track;if(v instanceof Ui)a2([y]),v.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const S=c2([v,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(v,S)}}else d instanceof Ui?(a2([y]),d.addAudioTrack(y)):d||!y._useAudioElement&&jn().webAudioMediaStreamDest&&!y._bypassWebAudio?d=c2(d?[y,d]:[y]):d=y}return d&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),o.push({track:d,type:Ye.LocalAudioTrack})),o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=jv(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof Qr){const c=this.localTrackMap.get(Ye.LocalAudioTrack);if(!c)continue;c.track instanceof Ui?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ye.LocalAudioTrack,c]),c.track.close())):r.push([Ye.LocalAudioTrack,c])}if(o instanceof Ar){const c=this.localTrackMap.get(Ye.LocalVideoTrack);if(!c)continue;r.push([Ye.LocalVideoTrack,c]);const d=this.localTrackMap.get(Ye.LocalVideoLowTrack);d&&r.push([Ye.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=jv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=jv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ye.LocalVideoTrack:s.addListener(Ct.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Ct.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Ui?t.trackList.forEach(s=>{s.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ct.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ct.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Ct.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ye.LocalVideoTrack:s.off(Ct.GET_STATS,this.handleGetLocalVideoStats),s.off(Ct.GET_RTC_STATS,this.handleGetRTCStats),s.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Ui?t.trackList.forEach(r=>{r.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ct.GET_STATS,this.handleGetLocalAudioStats),r.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ct.GET_STATS,this.handleGetLocalAudioStats),t.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ct.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Zv&&r.addListener(Ct.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof eS&&r.addListener(Ct.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ct.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(Tt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Tt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let d,h,{track:m,type:y}=s;switch(y){case Ye.LocalAudioTrack:d=Zn.Audio,h={dtx:m instanceof rP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ye.LocalVideoTrack:d=ot(c=m._hints).call(c,_r.SCREEN_TRACK)?Zn.Screen:Zn.High,h=Gh(Gh({},hH(m)),{},{codec:this.store.codec,svc_mode:EP()});break;case Ye.LocalVideoLowTrack:d=Zn.Low,h=Gh(Gh({},hH(m)),{},{codec:this.store.codec,svc_mode:EP()})}return{stream_type:d,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalVideoTrack:o=ot(s=d._hints).call(s,_r.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalAudioTrack:o=Zn.Audio;break;case Ye.LocalVideoLowTrack:o=Zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Vt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof zh&&!$r()&&se("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},se("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof zh&&d9(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=ff.DISCONNECTED_OR_FAILED,rl(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Ot.reportApiInvoke(this.store.sessionId,{name:Pi.REPUB_AFTER_PC_CONNECTED,options:s.concat(o),tag:qr.TRACER}).onSuccess(),this.republish()}if(se("NEW_ICE_RESTART")&&t instanceof zh&&!$r()&&!this._forceTurn){if(ot(sH).call(sH,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{l2(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),rl(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE,c))},o=()=>{l2(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{h9(t,s,o)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&se("ICE_RESTART")&&rl(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Ot.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:qr.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(sl(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(qv.FIRST_FRAME_DECODED),Ot.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,Ur.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Xs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(sl(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Ot.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,Ur.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Xs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(sl(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Ot.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,Ur.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Xs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(Vt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ym(s))," -> ").concat(JSON.stringify(Ym(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ym(s))," -> ").concat(JSON.stringify(Ym(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Gh(Gh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof zh&&function(r){pS.delete(r.id),d9(r)}(t),t.close(),this.emit(Vt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ye.LocalAudioTrack);if(t instanceof Qr&&(s==null?void 0:s.track)instanceof Ui)return s.track.isActive||r.push([Ye.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(o&&(r.push(o),o[0]===Ye.LocalVideoTrack)){const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ye.LocalAudioTrack);if(t instanceof Qr&&(s==null?void 0:s.track)instanceof Ui)return s.track.isActive&&r.push([Ye.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(o)if(o[0]===Ye.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:o=Zn.Audio;break;case Ye.LocalVideoTrack:o=ot(s=d._hints).call(s,_r.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:o=Zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:o=Zn.Audio;break;case Ye.LocalVideoTrack:o=ot(s=d._hints).call(s,_r.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:o=Zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(o.id)&&s.push(o)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:d}]=s;switch(c){case Tt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:Tt.VIDEO,ssrcId:o._videoSSRC}));case Tt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:Tt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[o,{kind:c}]=s;if(r.has(o)){let d=r.get(o);c===Tt.VIDEO?d|=Ji.Video:d|=Ji.Audio,r.set(o,d)}else c===Tt.VIDEO?r.set(o,Ji.Video):r.set(o,Ji.Audio)}),{users:Array.from(r.entries()).map(s=>{let[o,c]=s;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new ht((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new ht((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((o,c)=>{var d;let{stream_type:h}=o;const m=(d=r.find(y=>{let{stream_type:v}=y;return h===v}))===null||d===void 0?void 0:d.attributes;if(m&&se("DISABLE_SCREEN_SHARE_REMB")){const y=s[c]._hints;(ot(y).call(y,_r.SCREEN_TRACK)||ot(y).call(y,_r.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",y))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof Qr){var r;const o=this.filterTobeUnmutedTracks(t[s]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(d=>{let[,{id:h}]=d;return h})));const c=this.createUnmuteMessage(o);return void await mr(this,Vt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Vt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await gs(tL(this.dtlsFailedCount,Oi)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await Us(this,Vt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Vt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ye.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Ar)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Ar).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Qr).length>1&&(t.some(r=>r instanceof Qr&&r._bypassWebAudio)||!jn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Ar&&this.pendingLocalTracks.some(s=>s instanceof Ar))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Qr&&this.pendingLocalTracks.some(s=>s instanceof Qr)&&(!jn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Qr&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const o=!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding,c=Gh(Gh({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=o?t._mediaStreamTrack.clone():u2(t,c);const h=gr(8,"track-low-"),m=new Ar(d,Gh(Gh({},o&&{scaleResolutionDownBy:$L(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(G_.TRANSCEIVER_UPDATED,y=>{t._updateRtpTransceiver(y,$v.LOW_STREAM)}),m._hints.push(_r.LOW_STREAM),ot(s=t._hints).call(s,_r.SCREEN_TRACK)&&m._hints.push(_r.SCREEN_LOW_TRACK),t.on("sei-to-send",y=>{m.emit("sei-to-send",y)}),t.addListener(Ct.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof zh){var c,d,h,m;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:D}=await this.connection.getSelectedCandidatePair();Ot.pcStats(this.store.sessionId,{startTime:y,eventElapse:t-y||0,iceconnectionsate:v,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=P.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=D.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=D.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,o){var c;const d=Array.from(sl(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){o||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===d.uid&&y.type==="video");Ot.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,Ur.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Xs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ye.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,$v.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Rt(yn.prototype,"startP2PConnection",[To],Object.getOwnPropertyDescriptor(yn.prototype,"startP2PConnection"),yn.prototype),Rt(yn.prototype,"connect",[To],Object.getOwnPropertyDescriptor(yn.prototype,"connect"),yn.prototype),Rt(yn.prototype,"updateRemoteRTPCapabilities",[To],Object.getOwnPropertyDescriptor(yn.prototype,"updateRemoteRTPCapabilities"),yn.prototype),Rt(yn.prototype,"publishDataChannel",[To],Object.getOwnPropertyDescriptor(yn.prototype,"publishDataChannel"),yn.prototype),Rt(yn.prototype,"unpublish",[To],Object.getOwnPropertyDescriptor(yn.prototype,"unpublish"),yn.prototype),Rt(yn.prototype,"unpublishDataChannel",[To],Object.getOwnPropertyDescriptor(yn.prototype,"unpublishDataChannel"),yn.prototype),Rt(yn.prototype,"unpublishLowStream",[To],Object.getOwnPropertyDescriptor(yn.prototype,"unpublishLowStream"),yn.prototype),Rt(yn.prototype,"subscribeDataChannel",[To],Object.getOwnPropertyDescriptor(yn.prototype,"subscribeDataChannel"),yn.prototype),Rt(yn.prototype,"subscribe",[To],Object.getOwnPropertyDescriptor(yn.prototype,"subscribe"),yn.prototype),Rt(yn.prototype,"massSubscribe",[To],Object.getOwnPropertyDescriptor(yn.prototype,"massSubscribe"),yn.prototype),Rt(yn.prototype,"unsubscribe",[To],Object.getOwnPropertyDescriptor(yn.prototype,"unsubscribe"),yn.prototype),Rt(yn.prototype,"unsubscribeDataChannel",[To],Object.getOwnPropertyDescriptor(yn.prototype,"unsubscribeDataChannel"),yn.prototype),Rt(yn.prototype,"massUnsubscribe",[To],Object.getOwnPropertyDescriptor(yn.prototype,"massUnsubscribe"),yn.prototype),Rt(yn.prototype,"muteRemote",[To],Object.getOwnPropertyDescriptor(yn.prototype,"muteRemote"),yn.prototype),Rt(yn.prototype,"unmuteRemote",[To],Object.getOwnPropertyDescriptor(yn.prototype,"unmuteRemote"),yn.prototype),Rt(yn.prototype,"hasRemoteMediaWithLock",[To],Object.getOwnPropertyDescriptor(yn.prototype,"hasRemoteMediaWithLock"),yn.prototype),Rt(yn.prototype,"disconnectForReconnect",[To],Object.getOwnPropertyDescriptor(yn.prototype,"disconnectForReconnect"),yn.prototype),Rt(yn.prototype,"updateBitrateLimit",[To],Object.getOwnPropertyDescriptor(yn.prototype,"updateBitrateLimit"),yn.prototype),Rt(yn.prototype,"remoteMediaSsrcChanged",[To],Object.getOwnPropertyDescriptor(yn.prototype,"remoteMediaSsrcChanged"),yn.prototype),yn);function To(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{d()}},s}function m9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function g9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?m9(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):m9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const Sge=Date.now(),bge=20,h2=new Map,UP=new Map;async function _9(t){const r=h2.get(t),s=Array.isArray(r)&&r[r.length-1],o=UP.get(t);if(!s)return void(o.isSyncing=!1);const c={uid:s.uid,payload:s.payload};o.firstRecvTs===0&&(o.firstRecvTs=s.recvTs,o.firstSendTs=s.sendTs);const d=s.sendTs-o.firstSendTs,h=d-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-d);let m=s.mediaDelay+h;m<=0?(r.pop(),y9(s.context,c),m=0):m=Math.min(m,bge),setTimeout(()=>r.length&&_9(t),m)}function y9(t,r){t.safeEmit(bn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function Tge(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return y9(s,{uid:t.uid,payload:t.payload});const o="".concat(s.id,"-").concat(t.uid),c=h2.get(o)||[],d=c.findIndex(v=>t.sendTs>=v.sendTs),h=g9(g9({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),h2.set(o,c);let m=!1;var y;UP.has(o)?m=!((y=UP.get(o))===null||y===void 0||!y.isSyncing):UP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||_9(o)}const wge=xn().name;function E9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function v9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?E9(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):E9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const fS="websdk_ng_cache_parameter",Cge=se("MAX_PRELOAD_ASYNC_LENGTH"),Rge=1e4,ry=new Map,iy=[];let p2=null,f2=0,m2=0;const VP=new Map,Ige=function(t,r){const s=[];let o=0;const c=async()=>{const d=s.shift();d&&await d(),s.length>0&&o<r?c():o--};return async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return new ht(async(y,v)=>{s.push(async()=>{try{const S=await t(...h);y(S)}catch(S){v(S)}}),o<r&&(o++,c())})}}(S9,Cge),g2=ba.CancelToken.source();async function S9(t,r,s,o,c,d){try{if(!se("ENABLE_PRELOAD"))return;if(!jn().supportWebCrypto)return void Wm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&ms(s,"token",1,2047),ms(t,"appid",1,2047),fP(r),o&&mP(o);const h=z_();x.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:t,cname:r,token:s||t,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let y,v;typeof o=="string"?(m.stringUid=o,[v,y]=await ht.all([lge(o,{sid:h,appId:t},g2.token),WH(v9(v9({},m),{},{token:s||t,uid:0}),g2.token)]),m.uid=v.uid,y.gatewayInfo.uid=m.uid,y.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),y=await WH(m,g2.token));const S={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||o,intUid:m.uid||y.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:v,ap:y};await async function(R){let P;try{R.uid&&T9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const D=I9(R),G=await async function(B,J){try{const ee=await window.crypto.subtle.importKey("raw",pW(J),"AES-GCM",!1,["encrypt"]),fe=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},ee,B_(window.btoa(JSON.stringify(B))));return Gm(new Uint8Array(fe))}catch{return}}(R,R.token||R.appId);if(!G)return;P=R9(fS);const j=P?JSON.parse(P):[];j.push({[D]:G}),j.length>se("AP_CACHE_NUM")&&j.shift(),FP(fS,JSON.stringify(j))}catch(D){x.warn("Error caching server parameters:",D.message),FP(fS,"")}}(S),f2++}catch(h){throw m2++,function(m){p2||(p2=window.setTimeout(()=>{let v="";VP.forEach((S,R)=>{v+="".concat(R,": ").concat(S," ;")}),Ot.reportApiInvoke(null,{name:Pi.PRELOAD,options:{success:f2,failed:m2,err:v}}).onError(m),f2=0,m2=0,VP.clear(),p2=null},Rge));const y=VP.get(m.code)||0;VP.set(m.code,y+1)}(h),h}}async function b9(t){try{if(se("AP_REQUEST_DETAIL")||se("ENABLE_ROLE_SELECT_EDGE"))return;const r=T9(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(o,c){try{const d=await window.crypto.subtle.importKey("raw",pW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,B_(o));return JSON.parse(window.atob(Gm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<se("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function T9(t){let r;try{if(r=R9(fS),!r)return;const s=JSON.parse(r),o=I9(t),c=function(h,m){for(let y=h.length-1;y>=0;y--)if(m(h[y]))return y;return-1}(s,h=>o in h);if(c===-1)return;const d=s.splice(c,1)[0];return FP(fS,JSON.stringify(s)),d[o]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),FP(fS,"")}}function _2(t){if(t){let r=ry.get(t);r&&(window.clearTimeout(r),r=null,ry.delete(t)),ot(iy).call(iy,t)||t.cloudProxyServer!=="disabled"||iy.push(t)}if(ry.size<se("AP_CACHE_NUM")&&iy.length>0){const r=iy.shift();ry.set(r,window.setTimeout(async()=>{const{appId:s,cname:o,token:c,stringUid:d,uid:h,proxyServer:m}=r;try{await Ige(s,o,c,h,m,d),ry.has(r)&&_2(r)}catch(y){x.warn("update preload failed",y.message),w9(r)}},se("AP_UPDATE_INTERVAL")))}}function w9(t){const r=iy.indexOf(t);r!==-1&&iy.splice(r,1);let s=ry.get(t);s&&(window.clearTimeout(s),s=null,ry.delete(t),_2())}function C9(t,r){const s=t.sua,o=t.ap;r&&s&&Ot.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),Ot.reportResourceTiming(t.ap.url,t.sid),Ot.joinWebProxyAP(t.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Ei.CHOOSE_SERVER,Ei.CLOUD_PROXY_FALLBACK].toString()}),Ot.joinChooseServer(t.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function R9(t){return window.atob(window.localStorage.getItem(t)||"")}function FP(t,r){window.localStorage.setItem(t,window.btoa(r))}function I9(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),vW(r)}function Age(t){let r=function(){const s=kge.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,o){let c=s.appId;c!==void 0&&(bi(o,10),eg(o,c));let d=s.cid;d!==void 0&&(bi(o,16),bi(o,d));let h=s.cname;h!==void 0&&(bi(o,26),eg(o,h));let m=s.deviceId;m!==void 0&&(bi(o,34),eg(o,m));let y=s.elapse;y!==void 0&&(bi(o,40),tg(o,y));let v=s.fileSize;v!==void 0&&(bi(o,48),tg(o,mS(v)));let S=s.height;S!==void 0&&(bi(o,56),tg(o,mS(S)));let R=s.jpg;R!==void 0&&(bi(o,66),bi(o,R.length),P9(o,R));let P=s.networkType;P!==void 0&&(bi(o,72),tg(o,mS(P)));let D=s.osType;D!==void 0&&(bi(o,80),tg(o,mS(D)));let G=s.requestId;G!==void 0&&(bi(o,90),eg(o,G));let j=s.sdkVersion;j!==void 0&&(bi(o,98),eg(o,j));let B=s.sequence;B!==void 0&&(bi(o,104),tg(o,mS(B)));let J=s.sid;J!==void 0&&(bi(o,114),eg(o,J));let ee=s.timestamp;ee!==void 0&&(bi(o,120),tg(o,ee));let fe=s.uid;fe!==void 0&&(bi(o,128),bi(o,fe));let ye=s.vid;ye!==void 0&&(bi(o,136),bi(o,ye));let ve=s.width;ve!==void 0&&(bi(o,144),tg(o,mS(ve)));let _e=s.service;_e!==void 0&&(bi(o,152),bi(o,_e));let Ne=s.callbackData;Ne!==void 0&&(bi(o,162),bi(o,Ne.length),P9(o,Ne));let Je=s.ticket;Je!==void 0&&(bi(o,170),eg(o,Je));let pt=s.vendorConfigs;pt!==void 0&&(bi(o,178),eg(o,pt))}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function Pge(t){return function(s){let o={};e:for(;!Nge(s);){let c=GT(s);switch(c>>>3){case 0:break e;case 1:o.code=GT(s);break;case 2:o.msg=O9(s,GT(s));break;case 3:o.requestId=O9(s,GT(s));break;case 4:o.timestamp=Dge(s,!1);break;default:Oge(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function Oge(t,r){switch(r){case 0:for(;128&ju(t););break;case 2:y2(t,GT(t));break;case 5:y2(t,4);break;case 1:y2(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function mS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let kge=[];function y2(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function Nge(t){return t.offset>=t.limit}function jP(t,r){let s=t.bytes,o=t.offset,c=t.limit,d=o+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),o}function A9(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function P9(t,r){let s=jP(t,r.length);t.bytes.set(r,s)}function O9(t,r){let s=A9(t,r),o=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let y,v,S,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=d:(y=c[m+s+1],(192&y)!=128?h+=d:(R=(31&P)<<6|63&y,R<128?h+=d:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=d:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=d:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],S=c[m+s+3],(12632256&(y|v<<8|S<<16))!=8421504?h+=d:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&S,R<65536||R>1114111?h+=d:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=d}return h}function eg(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}bi(t,o);let c=jP(t,o),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function ju(t){return t.bytes[A9(t,1)]}function k9(t,r){let s=jP(t,1);t.bytes[s]=r}function GT(t){let r,s=0,o=0;do r=ju(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function bi(t,r){for(r>>>=0;r>=128;)k9(t,127&r|128),r>>>=7;k9(t,r)}function Dge(t,r){let s,o=0,c=0,d=0;return s=ju(t),o=127&s,128&s&&(s=ju(t),o|=(127&s)<<7,128&s&&(s=ju(t),o|=(127&s)<<14,128&s&&(s=ju(t),o|=(127&s)<<21,128&s&&(s=ju(t),c=127&s,128&s&&(s=ju(t),c|=(127&s)<<7,128&s&&(s=ju(t),c|=(127&s)<<14,128&s&&(s=ju(t),c|=(127&s)<<21,128&s&&(s=ju(t),d=127&s,128&s&&(s=ju(t),d|=(127&s)<<7))))))))),{low:o|c<<28,high:c>>>4|d<<24,unsigned:r}}function tg(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=jP(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=d!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=d!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=d!==5?128|o:127&o;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}const N9={},D9={},BP=4294967296,xge=BP*BP,Lge=xge/2;L9(0,!0);const x9=L9(0),Mge=HT(0,-2147483648,!1),Uge=HT(-1,2147483647,!1);function L9(t,r){let s,o,c;return r?(c=0<=(t>>>=0)&&t<256)&&(o=D9[t],o)?o:(s=HT(t,0,!0),c&&(D9[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(o=N9[t],o)?o:(s=HT(t,t<0?-1:0,!1),c&&(N9[t]=s),s)}function HT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function M9(t,r){if(isNaN(t))return x9;{if(t<=-9223372036854776e3)return Mge;if(t+1>=Lge)return Uge}return t<0?x9:HT(t%BP|0,t/BP|0,r)}function U9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class E2 extends zr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Vd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),q(this,"name","AgoraRTCImageModeration"),q(this,"_connectionState",Hl.CONNECTING),q(this,"_sequence",0),q(this,"_moderationStartTime",void 0),q(this,"_workerConnection",void 0),q(this,"_workerMessageLengthLimit",void 0),q(this,"_qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",ba.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"_moderationInterval",void 0),q(this,"_moderationTimer",null),q(this,"_moderationMode",1),q(this,"_quality",1),q(this,"_qualityTimer",null),q(this,"_ticket",void 0),q(this,"_moderationIntervalMinimum",void 0),q(this,"_uploadFailedNum",0),q(this,"_uploadNum",0),q(this,"_uploadTimer",null),q(this,"_extraInfo",void 0),q(this,"_vendor",""),q(this,"_encoder",new TextEncoder),q(this,"_moderationId",void 0),q(this,"inspectImage",()=>{if(this.connectionState!==Hl.CONNECTED)throw new Ae(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Hl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=gr(5,"image-moderation-"),this._workerMessageLengthLimit=se("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=se("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=se("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new xT("worker-"+this._moderationId,Oi),this.on(Vd.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(iS[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Vd.STATE_CHANGE,iS.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new ht((c,d)=>{this.on(Vd.CONNECTION_STATE_CHANGE,(h,m)=>{h===Hl.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Hl.CONNECTED&&this.inspectImage()}async requestAP(r,s,o){const c=se("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),d=await function(y,v,S,R){let{appId:P,areaCode:D,cname:G,sid:j,token:B,uid:J}=v;uS++;const ee="moderation_plugin",fe={service_name:ee,json_body:JSON.stringify({appId:P,areaCode:D,cname:G,command:"allocateEdge",requestId:uS,seq:uS,sid:j,appToken:B,ts:Date.now(),uid:J+""})};let ye,ve,_e=y[0];return xd(async()=>{ye=Date.now();const Ne=await Fd(_e,{data:fe,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ve=Date.now()-ye,Ne.code!==0){const _t=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:ve});throw x.error(_t.toString()),_t}const Je=JSON.parse(Ne.json_body);if(Je.code!==200){const _t=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Je.code,", reason: ").concat(Je.reason),{code:Je.code,responseTime:ve});throw x.error(_t.toString()),_t}if(!Je.servers||!Array.isArray(Je.servers)||Je.servers.length===0){const _t=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Je.code,responseTime:ve});throw x.error(_t.toString()),_t}if(!Je.servers.some(_t=>!!_t.wss)){const _t=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Je.code,responseTime:ve});throw x.error(_t.toString()),_t}const pt=se("IMAGE_MODERATION_WORKER_HOST");return{addressList:Je.servers.map(_t=>{let{address:Rn,wss:In}=_t;if(Rn&&In)return"wss://".concat(Rn.replace(/\./g,"-"),".").concat(pt,":").concat(In,"/moderation")}).filter(_t=>!!_t),workerToken:Je.workerToken,vid:Je.vid,ticket:Je.appTicket,responseTime:ve}},(Ne,Je)=>(Ot.apworkerEvent(j,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Je===0,responseTime:ve,serverIp:y[Je%y.length]}),!1),(Ne,Je)=>(Ot.apworkerEvent(j,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:ee,responseTime:ve,serverIp:y[Je%y.length]}),!!(Ne.code!==te.OPERATION_ABORTED&&Ne.code!==te.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(_e=y[(Je+1)%y.length],!0)),R)}(c,r,s,o);this.emit(Vd.STATE_CHANGE,iS.AP_CONNECTED);const{addressList:h,ticket:m}=d;return this._ticket=m,h}async connectWorker(r){this.emit(Vd.STATE_CHANGE,iS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(en.CONNECTED,async()=>{this.emit(Vd.STATE_CHANGE,iS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Hl.CONNECTED}),this._workerConnection.on(en.CLOSED,()=>{this.connectionState=Hl.CLOSED}),this._workerConnection.on(en.FAILED,()=>{this.connectionState=Hl.CLOSED}),this._workerConnection.on(en.RECONNECTING,()=>{this.connectionState=this.connectionState===Hl.CONNECTED?Hl.RECONNECTING:Hl.CONNECTING}),this._workerConnection.on(en.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=Pge(new Uint8Array(r.data));se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ot.reportApiInvoke(this._connectInfo.sid||null,{name:Pi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:qr.TRACER}).onError(new Ae(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},se("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(en.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(en.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=rl(this,Vd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,s);this._workerConnection.sendMessage(o,!0,!0)}else se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:o,cname:c,cid:d,vid:h,sid:m,uid:y}=s;const v=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await l8(S,o,c),P=this._sequence+"-"+d+"-"+y+"-"+v+"-"+gr(12,""),D={appId:o,cid:d,cname:c,deviceId:"",elapse:E2.intToLong(Number(v-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:M9(v),uid:y,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const G=Age(D);if(G.byteLength<this._workerMessageLengthLimit){if(se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const j=function(B){for(var J=1;J<arguments.length;J++){var ee=arguments[J]!=null?arguments[J]:{};J%2?U9(Object(ee),!0).forEach(function(fe){q(B,fe,ee[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(ee)):U9(Object(ee)).forEach(function(fe){Object.defineProperty(B,fe,Object.getOwnPropertyDescriptor(ee,fe))})}return B}({},D);delete j.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(j))}return G}{const j=this.quality*this._qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:o,cname:c,cid:d,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ba.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Hl.CLOSED,this.emit(Vd.STATE_CHANGE,iS.CLOSED)}}function V9(t){if(ur(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Ae(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Ae(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Vge={name:"ImageModeration",create:function(t){let{config:r}=t;return V9(r),new E2(r)}};var F9,j9,B9,z9,W9,G9,H9,$9,K9,q9,Y9,X9,J9,Q9,Z9,e$,t$,n$,r$,i$,s$,o$,a$,c$,l$,u$,d$,h$,p$,f$,m$,g$,_$,y$,E$,v$,S$,b$,T$,w$,C$,mt;function R$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Bu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?R$(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):R$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}Ks.setLogger(x);let Fge=(F9=Ht(),j9=Ht({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Xv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),B9=Ht({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Yv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),z9=Ht({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),W9=Ht({argsMap:(t,r,s)=>[r,s]}),G9=Ht({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return[o==null?void 0:o.uid,c]})}),H9=Ht({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),$9=Ht({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return{uid:o==null?void 0:o.uid,mediaType:c}})}),K9=Ht(),q9=Ht(),Y9=Ht(),X9=Ht(),J9=Ht(),Q9=Ht(),Z9=Ht(),e$=Ht(),t$=Ht(),n$=Ht(),r$=Ht(),i$=Ht(),s$=Ht(),o$=Ht(),a$=Ht(),c$=Ht({argsMap:(t,r)=>[r]}),l$=Ht(),u$=Ht(),d$=Ht(),h$=Ht(),p$=Ht(),f$=Ht(),m$=Ht(),g$=Ht(),_$=Ht({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),y$=Ht(),E$=Ht(),v$=Ht(),S$=Ht(),b$=Ht(),T$=Ht(),w$=Ht({reportResult:!0}),C$=Ht(),mt=class extends zr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),q(this,"store",void 0),q(this,"_uid",void 0),q(this,"_channelName",void 0),q(this,"_uintUid",void 0),q(this,"_users",[]),q(this,"_config",void 0),q(this,"_clientId",void 0),q(this,"_appId",void 0),q(this,"_sessionId",null),q(this,"_key",void 0),q(this,"_rtmConfig",{}),q(this,"_joinInfo",void 0),q(this,"_gateway",void 0),q(this,"_statsCollector",void 0),q(this,"_configDistribute",void 0),q(this,"_leaveMutex",void 0),q(this,"_publishMutex",void 0),q(this,"_renewTokenMutex",void 0),q(this,"_subscribeMutex",void 0),q(this,"_encryptionMode","none"),q(this,"_encryptionSecret",null),q(this,"_encryptionSalt",null),q(this,"_encryptDataStream",!1),q(this,"_encryptDataStreamKey",null),q(this,"_encryptDataStreamIv",null),q(this,"_proxyServer",void 0),q(this,"_turnServer",{servers:[],mode:"auto"}),q(this,"_cloudProxyServerMode","disabled"),q(this,"_isDualStreamEnabled",!1),q(this,"_defaultStreamFallbackType",void 0),q(this,"_lowStreamParameter",void 0),q(this,"_streamFallbackTypeCacheMap",new Map),q(this,"_remoteStreamTypeCacheMap",new Map),q(this,"_axiosCancelSource",ba.CancelToken.source()),q(this,"_audioVolumeIndicationInterval",void 0),q(this,"_networkQualityInterval",void 0),q(this,"_userOfflineTimeout",void 0),q(this,"_streamRemovedTimeout",void 0),q(this,"_liveTranscodeStreamingClient",void 0),q(this,"_liveRawStreamingClient",void 0),q(this,"_channelMediaRelayClient",void 0),q(this,"_networkQualitySensitivity","normal"),q(this,"_p2pChannel",void 0),q(this,"_useLocalAccessPoint",!1),q(this,"_setLocalAPVersion",void 0),q(this,"_joinAndNotLeaveYet",!1),q(this,"_numberOfJoinCount",0),q(this,"_remoteDefaultVideoStreamType",void 0),q(this,"_inspect",void 0),q(this,"_moderation",void 0),q(this,"_license",void 0),q(this,"_pendingPublishedUsers",[]),q(this,"ntpAlignErrorCount",0),q(this,"remoteInboundOffset",0),q(this,"_peerConnectionState",void 0),q(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),q(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),q(this,"_handleUserOnline",c=>{if(se("BLOCK_LOCAL_CLIENT")&&X_(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(bn.USER_JOINED,d));else{const h=new Qm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(bn.USER_JOINED,h)}}),q(this,"_handleUserOffline",c=>{if(se("BLOCK_LOCAL_CLIENT")&&X_(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:WA(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(bn.USER_LEAVED,d,c.reason))}),q(this,"_handleAddAudioOrVideoStream",(c,d,h,m,y,v,S)=>{if(se("BLOCK_LOCAL_CLIENT")&&X_(d,this.channelName))return;const R=this._users.find(D=>D.uid===d);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||d),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),v&&(R._audioOrtc=v)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(bn.USER_PUBLISHED,R,c)),c==="video"?Ot.onGatewayStream(this._sessionId,Xi.ON_ADD_VIDEO_STREAM,Ur.ON_ADD_VIDEO_STREAM,{peer:y||d,ssrc:R._videoSSRC}):Ot.onGatewayStream(this._sessionId,Xi.ON_ADD_AUDIO_STREAM,Ur.ON_ADD_AUDIO_STREAM,{peer:y||d,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(D=>{if(D&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof WT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(D=>{x.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),q(this,"_handleRemoveStream",c=>{if(se("BLOCK_LOCAL_CLIENT")&&X_(c.uid,this.channelName))return;const d=this._users.find(m=>m.uid===c.uid);if(!d)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(bn.USER_UNPUBLISHED,d,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(bn.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(bn.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(bn.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof WT&&this._p2pChannel.unsubscribe(d).then(m=>{if(m)return this._gateway.unsubscribe(m,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),Ot.onGatewayStream(this._sessionId,Xi.ON_REMOVE_STREAM,Ur.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),q(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(se("BLOCK_LOCAL_CLIENT")&&X_(d,this.channelName))return;const m=this._users.find(S=>S.uid===d);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const y=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,d,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,d,R)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return y!==v?!y&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(bn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(bn.USER_UNPUBLISHED,m,c)):void 0}),q(this,"_handleMuteStream",(c,d,h)=>{if(se("BLOCK_LOCAL_CLIENT")&&X_(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const m=this._users.find(S=>S.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,c,R)}}const v=d==="audio"?m.hasAudio:m.hasVideo;if(y!==v){if(!y&&v)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(bn.USER_PUBLISHED,m,d)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(bn.USER_UNPUBLISHED,m,d)}}),q(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),q(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(bn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),q(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),q(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(bn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(bn.NETWORK_QUALITY,c)}),q(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,m)=>{const y=this._users.find(S=>S.uid===d);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?y.hasAudio:y.hasVideo;c==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,c==="audio"?(y._audio_added_=!0,h!==void 0&&(y._audioSSRC=h),m!==void 0&&(y._audioMid=m)):(y._video_added_=!0,h!==void 0&&(y._videoSSRC=h),m!==void 0&&(y._videoMid=m)),(c==="audio"?y.hasAudio:y.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(bn.USER_PUBLISHED,y,c)),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=t,this._clientId=r||gr(5,"client-"),this.store=new class{constructor(c,d,h,m){Xt(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:W_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case Tn.SET_SESSION_ID:return bt(bt({},d),{},{sessionId:h.sessionId});case Tn.SET_P2P_ID:return bt(bt({},d),{},{p2pId:h.p2pId});case Tn.SET_UID:return bt(bt({},d),{},{uid:h.uid});case Tn.SET_INT_UID:return bt(bt({},d),{},{intUid:h.intUid});case Tn.SET_PUB_ID:return bt(bt({},d),{},{pubId:h.pubId});case Tn.KEY_METRIC_CLIENT_CREATED:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{clientCreated:h.metric})});case Tn.KEY_METRIC_JOIN_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{joinStart:h.metric})});case Tn.AVOID_JOIN_START:return bt(bt({},d),{},{avoidJoinStart:h.avoidJoinStart});case Tn.KEY_METRIC_JOIN_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{joinEnd:h.metric})});case Tn.KEY_METRIC_REQUEST_AP_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{requestAPStart:h.metric})});case Tn.KEY_METRIC_REQUEST_AP_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{requestAPEnd:h.metric})});case Tn.KEY_METRIC_JOIN_GATEWAY_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case Tn.KEY_METRIC_JOIN_GATEWAY_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case Tn.KEY_METRIC_PEER_CONNECTION_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case Tn.KEY_METRIC_PEER_CONNECTION_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case Tn.KEY_METRIC_DESCRIPTION_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{descriptionStart:h.metric})});case Tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case Tn.KEY_METRIC_ICE_CONNECTION_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case Tn.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,y=m.findIndex(v=>v.trackId===h.metric.trackId);return y!==-1?(m[y]=bt(bt({},m[y]),h.metric),bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{publish:[...m]})})):bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case Tn.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,y=m.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return y!==-1?(m[y]=bt(bt({},m[y]),h.metric),bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{subscribe:[...m]})})):bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case Tn.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case Tn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=bt(bt({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case Tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case Tn.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[]},d;case Tn.SET_USE_P2P:return bt(bt({},d),{},{useP2P:h.val});case Tn.SET_TRANSPORT_TYPE:return bt(bt({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set sessionId(c){this.dispatch({type:Tn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:Tn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:Tn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:Tn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:Tn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:Tn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:Tn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:Tn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:Tn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Tn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Tn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Tn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Tn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Tn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Tn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Tn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Tn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Tn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Tn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Tn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,m){this.dispatch({type:Tn.KEY_METRIC_PUBLISH,metric:bt(bt({trackId:c,type:d},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,d,h,m,y,v,S){this.dispatch({type:Tn.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt(bt(bt({userId:c,type:d},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),y&&{firstFrame:y}),v&&{streamAdded:v}),S&&{firstDecoded:S})})}massSubscribe(c,d,h,m){c.forEach(y=>{this.dispatch({type:Tn.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt({userId:y.userId,type:y.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:Tn.RECORD_JOIN_CHANNEL_SERVICE,record:bt(bt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Tn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Tn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:Tn.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Ks("client-leave",this._clientId),this._publishMutex=new Ks("client-publish",this._clientId),this._renewTokenMutex=new Ks("client-renewtoken",this._clientId),this._subscribeMutex=new Ks("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(zl," build: ").concat(dL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{Qx(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new BT(this.store),this._statsCollector.onStatsException=(c,d,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(bn.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,m)=>{const y=this._users.find(v=>v.uid===c);y&&Ot.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:h,peer:y._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new rge(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Oi,httpRetryConfig:t.httpRetryConfig||Oi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new pge(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},mf("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new WT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,o,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];or("JOIN_GATEWAY_USE_443PORT_ONLY",d),or("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof GL&&(m.use443PortOnly=d,m.tryDoubleDomain=h),async function(y,v,S){VA.get(y)||VA.set(y,[]),FA.get(y)||FA.set(y,v),xh.get(y)||xh.set(y,0);const R=VA.get(y),P=FA.get(y);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(xh.get(y)===P){const J=yT();R.push(J),await J.promise}xh.set(y,xh.get(y)+1);for(var D=arguments.length,G=new Array(D>3?D-3:0),j=3;j<D;j++)G[j-3]=arguments[j];const B=await S(...G);return xh.set(y,xh.get(y)-1),xh.get(y)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),xh.get(y)===0&&(VA.set(y,[]),FA.set(y,0),xh.set(y,0)),B}("client.join",se("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,o,c)}async join(t,r,s,o,c){const d=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=($A||$A||($A=(window.location.protocol.split(":")[0]||"").toUpperCase(),$A))==="HTTPS",m=TW()?window.isSecureContext:"Browser Not Support";(!TW()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Ot.setAppId(t);try{if(!s&&s!==null)throw new Ae(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&ms(s,"token",1,2047),ms(t,"appid",1,2047),fP(r),o&&mP(o),c&&ms(c,"optionalInfo",1,2047)}catch(j){throw Ot.reportApiInvoke(z_(),{name:Pi.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:qr.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ot.reportApiInvoke(z_(),{name:Pi.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:qr.TRACER}).onError(j),j}this._gateway.state="CONNECTING";const y=await b9({appId:t,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(y==null?void 0:y.sid)||z_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const S=Ot.reportApiInvoke(v,{id:this._clientId,name:Pi.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:qr.TRACER}),R=Bu(Bu(Bu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:se("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async j=>{const B=function(ye){const ve=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_e=new Uint8Array(new ArrayBuffer(ve.length));for(let Ne=0;Ne<ve.length;Ne+=1)_e[Ne]=ve.charCodeAt(Ne);return _e}(),J=await window.crypto.subtle.importKey("spki",B,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ee=Xx(j),fe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},J,ee);return function(ye){let ve="";for(let _e=0;_e<ye.length;_e+=1)ve+=String.fromCharCode(ye[_e]);return window.btoa(ve)}(new Uint8Array(fe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,B=se("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(R.appId+this._encryptionSecret+this._encryptionSecret):j.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(J,ee,fe){const ye=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),ve=J==="aes-128-gcm2"?128:256,_e=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:DW,hash:"SHA-256",salt:fe},ye,ve+Dfe);return new Uint8Array(_e).subarray(ve/8)}(this._encryptionMode,B,B_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(J,ee,fe){const ye=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),ve=J==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:DW,hash:"SHA-256",salt:fe},ye,{name:"AES-GCM",length:ve},!0,["encrypt","decrypt"])}(this._encryptionMode,B,B_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&Ot.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let j;const B=R.cloudProxyServer;if(ot(D=["proxy3","proxy4","proxy5"]).call(D,B)){const ve=se("PROXY_SERVER_TYPE3");Array.isArray(ve)?R.proxyServer=ve[0]:R.proxyServer=ve}if(Ot.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),j={gatewayInfo:y.ap.gatewayInfo},se("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ve=(await fH(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(_e=>({turnServerURL:_e.address,tcpport:_e.tcpport||Vs.tcpport,udpport:_e.udpport||Vs.udpport,username:_e.username||Vs.username,password:_e.password||Vs.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:ve}}C9(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let ve;[ve,j]=await ht.all([zH(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Oi,this.store),BH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Oi,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(ve)),R.uid=ve,j.gatewayInfo.uid=ve,j.gatewayInfo.res.uid=ve}else j=await BH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Oi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(NT.UPDATE_BITRATE_LIMIT,ve=>{this._p2pChannel.updateBitrateLimit(ve)}),this._configDistribute.on(NT.UPDATE_CLIENT_ROLE_OPTIONS,ve=>{this._setClientRoleOptions(ve)})},0),this._key=s||t;const J=j.gatewayInfo,ee=R.uid?R.uid:J.uid;this._joinInfo=Bu(Bu({},R),{},{cid:J.cid,uid:ee,vid:J.vid,apResponse:J.res,apGatewayAddress:J.apGatewayAddress,uni_lbs_ip:J.uni_lbs_ip,gatewayAddrs:J.gatewayAddrs}),this.store.intUid=ee,this.store.cid=J.cid;const fe=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(fe),this._appId=t,this._channelName=R.cname,this._uid=fe,this.store.uid=fe,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ls()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ye)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,ot(Y_).call(Y_,G)||Y_.push(G),this._cloudProxyServerMode==="disabled"&&jn().supportWebCrypto&&se("ENABLE_PRELOAD")&&_2(this._joinInfo),fe}catch(j){const B=Array.isArray(j)?j[0]:j;throw B&&B.code===te.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),B):x.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),B),B.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(B),B}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Ae(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!se("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ls()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=Y_.indexOf(r);s!==-1&&Y_.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Xn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Xv))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Ae(te.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Ae(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof Xv))throw new Ae(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Ae(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const d=this._configDistribute.getBitrateLimit();c instanceof Ar&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(t){ur(t.id,"id",0,65535,!0),cf(t.ordered,"ordered"),ms(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Ae(te.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&se("FORCE_TURN")&&!se("TURN_ENABLE_TCP")&&!se("TURN_ENABLE_UDP"))throw new Ae(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return NH(c,!1)}(t),o=await this._p2pChannel.publishDataChannel([s]);if(o.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Ae(te.CREATE_DATACHANNEL_ERROR);try{await ht.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Xv))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(ui.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(o=>"".concat(o.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof Qm)){const o=this.remoteUsers.find(c=>c.uid===t);if(!o)throw new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");t=o}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Wi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Ae(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===Tt.AUDIO,o=r===Tt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:m,cname:y,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new Ae(te.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===t);S||(S=new Qm(t,v||t),S._is_pre_created=!0,this._users.push(S)),y&&(S._cname=y),S._uintid||(S._uintid=v||t),s&&(S._audioSSRC=d,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=d,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(S,r,d,m,h);const R=s?S._audioTrack:S._videoTrack;if(!R)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(d){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var s;if(ur(r,"channelId",0,65535,!0),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Ae(te.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&ot(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Ae(te.CREATE_DATACHANNEL_ERROR);const y={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,y,!0),await c._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),y;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,s){if(Wi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new Ae(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Wi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new Ae(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Tt.AUDIO:Tt.VIDEO,ssrcId:c};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const S=r==="audio"?t._audioSSRC:t._videoSSRC;S!==void 0&&S!==c&&(c=S,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Tt.AUDIO:Tt.VIDEO,ssrcId:c}),Xs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,t,r),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{y()}}async massSubscribe(t){if(lf(t,"subscribeList"),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:y,mediaType:v}=m;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:y,mediaType:v}=m;return{user:y,mediaType:v}}),d=await this._p2pChannel.globalLock();try{var h;for(let y=t.length-1;y>=0;y--){const v=t[y],{user:S,mediaType:R}=v;if(Wi(R,"mediaType",["audio","video"]),!S){const j=new Ae(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),j}if(!this._users.find(j=>j===S)){const j=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[y].error=j,t.splice(y,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const j=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[y].error=j,t.splice(y,1);continue}const D=Ji.Video|Ji.LwoVideo,G=s.get(S);if(G){if(R==="video"?G&D:G&Ji.Audio){t.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}s.set(S,G|(R==="video"?D:Ji.Audio))}else s.set(S,R==="video"?D:Ji.Audio)}for(let y=t.length-1;y>=0;y--){const v=t[y],{user:S,mediaType:R}=v,P=Ji.Video|Ji.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const D=s.get(S);s.set(S,R==="video"?D^P:D^Ji.Audio),t.splice(y,1)}}this.store.massSubscribe(t.map(y=>({userId:y.user.uid,type:y.mediaType})),r);let m=Ec(h=Array.from(s.entries())).call(h,(y,v)=>{let[S,R]=v;if(R===0)return y;const P={stream_id:S.uid,stream_type:R};return R&Ji.Audio&&(P.audio_ssrc=S._audioSSRC),R&Ji.Video&&(P.video_ssrc=S._videoSSRC),y.push(P),y},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:S,mediaType:R}=v;return{user:S,mediaType:R,ssrcId:R===Tt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===Tt.VIDEO?S._rtxSsrcId:void 0}}));const y=new Map;if(m=m.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:D,error_code:G}=S;(P||D||G)&&y.set(R,{video_error_code:P,audio_error_code:D,error_code:G})})}if(Array.from(y.entries()).length>0){const v=[];Array.from(y.entries()).forEach(S=>{let[R,P]=S;const D=this.remoteUsers.find(G=>G.uid===R);if(D){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=Tt.VIDEO:P.audio_error_code&&(G=Tt.AUDIO),v.push({user:D,mediaType:G})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const S=y.get(v.user.uid);if(S){const R=S.error_code||v.mediaType==="audio"&&S.audio_error_code||v.mediaType==="video"&&S.video_error_code;if(R){const P=DT(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(P.desc)),v.error=new Ae(te.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var S;Ot.subscribe(this.store.sessionId,{succ:!!v.error,ec:((S=v.error)===null||S===void 0?void 0:S.code)||null,video:v.mediaType===Tt.VIDEO,audio:v.mediaType===Tt.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===Tt.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:S,mediaType:R}=v;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(t),y}}finally{d(),o()}}async unsubscribe(t,r,s){if(!(t instanceof Qm)){const d=this.remoteUsers.find(h=>h.uid===t);if(!d)throw new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Wi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&WA(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&ur(r,"id",0,65535,!0),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=t._dataChannels.find(d=>d.id===r);c&&(o=[c])}else o=t._dataChannels;if(o===void 0){const c=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,o);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(lf(t,"unsubscribeList"),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:o,mediaType:c}=s;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:o,mediaType:c}=t[s];if(!o){const m=new Ae(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Wi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),t.splice(s,1);continue}const h=Ji.Video|Ji.LwoVideo;if(r.has(o)){const m=r.get(o);let y;switch(c){case"video":y=m&h;break;case"audio":y=m&Ji.Audio;break;default:y=m&(Ji.Audio|h)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(o,m|Ji.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Ji.Audio|h)}else c?c==="audio"?r.set(o,Ji.Audio):c==="video"&&r.set(o,h):r.set(o,Ji.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(o=>{let{user:c,mediaType:d}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(te.INVALID_PARAMS);Kr(s.width)||qx(s.width,"streamParameter.width"),Kr(s.height)||qx(s.height,"streamParameter.height"),Kr(s.framerate)||qx(s.framerate,"streamParameter.framerate"),Kr(s.bitrate)||ur(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Ye.LocalVideoLowTrack)}async enableDualStream(){if(!jn().supportDualStream)throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Ae(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Ae(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ye.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(o){Wi(o,"role",["audience","host"])}(t),r&&Qx(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Ae(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Ae(te.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Ae(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&se("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Ms.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&Qx(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(ms(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Ot.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy")}if(TT(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>dW(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"you should set license before join channel");if(ms(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Ae(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Ae(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Ae(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Stop proxy server after leave channel");Ot.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Ae(te.INVALID_PARAMS,"accessPoints is required.");lf(t.accessPoints.serverList,"accessPoints.serverList"),ms(t.accessPoints.domain,"accessPoints.domain");const r=(P,D)=>{ur(P,D,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ae(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");se("CLOSE_AFB_FOR_LOCAL_AP")&&(or("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),or("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=d.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,or("WEBCS_DOMAIN",h),or("WEBCS_DOMAIN_BACKUP_LIST",h),or("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(lf(t.report.hostname,"report.hostname"),or("EVENT_REPORT_DOMAIN",t.report.hostname[0]),or("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(or("EVENT_REPORT_DOMAIN",d[0]),or("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),or("STATS_COLLECTOR_PORT",m),t.report?or("ENABLE_EVENT_REPORT",!0):or("ENABLE_EVENT_REPORT",!1);let y="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(lf(t.log.hostname,"log.hostname"),y=t.log.hostname[0]):y=d[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),or("LOG_UPLOAD_SERVER","".concat(y,":").concat(v));let S=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(lf(t.cds.hostname,"cds.hostname"),S=t.cds.hostname):S=d;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),or("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),t.cds?or("ENABLE_CONFIG_DISTRIBUTE",!0):or("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(lf(t,"serverList"),ms(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ae(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(o=>s.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,or("WEBCS_DOMAIN",t),or("WEBCS_DOMAIN_BACKUP_LIST",t),or("GATEWAY_DOMAINS",[r]),or("EVENT_REPORT_DOMAIN",t[0]),or("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),or("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Wi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Wi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(o=>o.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Wi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,o){(function(d){Wi(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ms(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(ot(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Ae(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Ae(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(cf(o,"encryptDataStream"),!ot(c).call(c,t))throw new Ae(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Gm(s))}async renewToken(t){if(ms(t,"token",1,2047),!this._key||!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(se("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await hge(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Oi);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(bn.VOLUME_INDICATOR,t)},se("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Ae(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Ae(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Ae(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?hf.TRANSCODE:hf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(hf.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Ae(te.INVALID_PARAMS,"can not find live streaming url to stop");await ht.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){YH(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){YH(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof WT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,t.payload=await async function(c,d,h){var m;const y=Ec(m=Array.from(h)).call(m,(j,B)=>j+B,0),v={serverTs:0,seq:xfe++,length:h.length,checkSum:y},S=new Uint8Array(EW(y,2)),R=new ArrayBuffer(Wv),P=new DataView(R);P.setUint32(0,v.serverTs),P.setUint16(4,v.seq),P.setUint16(6,v.length),P.setUint16(8,v.checkSum);const D=16-h.length%16;h=fW(h,new Uint8Array(D));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:NW,additionalData:S},d,h);return fW(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Ae(te.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Kt.DATA_STREAM,{payload:Gm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-Sge},!s)}sendMetadata(t){if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Ae(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Kt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Gm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Wfe),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send custom report, not joined");await Ot.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){Wi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Wi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(cf(r,"apRTM"),ur(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=nS.indexOf(t);r!==-1&&nS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=ba.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&w9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ot.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ks("client-publish",this._clientId),this._subscribeMutex=new Ks("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const o=t||z_();t?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=t?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,Ot.addSid(o);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Ot.sessionInit(this._sessionId,Bu({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&se("FORCE_TURN")&&!se("TURN_ENABLE_TCP")&&!se("TURN_ENABLE_UDP"))throw new Ae(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await s.next()).value;if(o){try{await this._gateway.sendExtensionMessage(ui.PUBLISH,o,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Ar&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Ae(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},mf("LiveStreaming").create(o));var o;return s.onLiveStreamError=(c,d)=>{Ot.reportApiInvoke(this._sessionId,{name:Pi.ON_LIVE_STREAM_ERROR,options:[c,d],tag:qr.TRACER}).onSuccess(),this.safeEmit(bn.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{Ot.reportApiInvoke(this._sessionId,{name:Pi.ON_LIVE_STREAM_WARNING,options:[c,d],tag:qr.TRACER}).onSuccess(),this.safeEmit(bn.LIVE_STREAMING_WARNING,c,d)},s.on(zL.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new Ae(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,y,v,S){const R=se("UAP_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(P=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await oge(R,m,y,v,S)})(c,this._joinInfo,this._axiosCancelSource.token,Oi).then(d).catch(h)}),s};return t===hf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Ae(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),o=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},mf("ChannelMediaRelay").create(t));o.on("state",c=>{c===Za.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(bn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(bn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:o}=t,c=[];if(r){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(y=>y.uid!==h._uintid||y.stream_id!==m.id)&&d.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach(d=>{const{uid:h,stream_id:m,ordered:y,max_retrans_times:v,metadata:S}=d,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ot(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===d.stream_id)===-1){const P={id:m,ordered:!!y,maxRetransmits:v,metadata:S},D=function(G){return NH(G,!0)}(P);R._dataChannels.push(D),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(bn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,d.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,d.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(bn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(d=>{const{uid:h,stream_id:m}=d,y=this._users.find(S=>S._uintid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=y._dataChannels.find(S=>S.id===d.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(y,[v]).then(S=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==v),S)return this._gateway.unsubscribeDataChannel(S,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(bn.USER_UNPUBLISHED,y,"datachannel",v._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(bn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ds.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:d,expires:h}=r[o];h&&h<=s||d||LL()||!Object.prototype.hasOwnProperty.call(YA,o)||(Ld[o]=c,Ir[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(ds.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ds.CONNECTION_STATE_CHANGE,(t,r,s)=>{var o;if(s===Xn.FALLBACK)return;const c=()=>{this.safeEmit(bn.CONNECTION_STATE_CHANGE,t,r,s)};if(Ot.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Pi.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:qr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Tt.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Tt.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(ds.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Ae(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const o=await b9(Bu(Bu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(s=o.ap,C9(o),this._joinInfo.preload=!0):(s=await i2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Oi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d;const[m,y]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:y}):c.push({host:m,port:y})}),t(c)}catch(s){r(s)}}),this._gateway.on(ds.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(bn.NETWORK_QUALITY,t)}),this._gateway.on(ds.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(bn.STREAM_TYPE_CHANGED,t,r),Ot.reportApiInvoke(this._sessionId,{name:Pi.STREAM_TYPE_CHANGE,options:[t,r],tag:qr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(ds.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(ds.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let o=await this._p2pChannel.getEstablishParams();se("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(t)),r(o)}catch(o){s(o)}}),this._gateway.on(ds.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=vH(t.ortc,r,s);this._p2pChannel.connect(o)}),this._gateway.on(ds.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:d}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(d,"_").concat(c),icePwd:"".concat(d,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=se("FINGERPRINT"))!==null&&o!==void 0?o:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(wn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(wn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(wn.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(wn.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(wn.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(wn.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(wn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(wn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(wn.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Tt.AUDIO,!0)),this._gateway.signal.on(wn.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Tt.AUDIO,!1)),this._gateway.signal.on(wn.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Tt.VIDEO,!0)),this._gateway.signal.on(wn.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Tt.VIDEO,!1)),this._gateway.signal.on(wn.RECEIVE_METADATA,t=>{const r=B_(t.metadata);this.safeEmit(bn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(wn.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=B_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Wv)throw new Ae(te.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Wv));s=await async function(d,h,m){const y=m.subarray(0,Wv),v=y.slice(8,Wv),S=(v[0]<<8)+v[1],R=(y[6]<<8)+y[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:NW,additionalData:new Uint8Array(EW(S,2))},h,m.subarray(Wv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let o=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(d==null?void 0:d._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Tge(Bu(Bu({},t),{},{payload:s}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(wn.ON_CRYPT_ERROR,()=>{Wm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(bn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(wn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Xn.TOKEN_EXPIRE),this.safeEmit(bn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(wn.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(bn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(wn.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(wn.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(wn.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Yt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Kt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,o;const d=c.some(y=>{let{stream_type:v}=y;return v===Zn.Audio}),h=c.some(y=>{let{stream_type:v}=y;return v!==Zn.Audio}),m=c.some(y=>{let{stream_type:v}=y;return v===Zn.Screen||v===Zn.ScreenLow});r.state==="offer"&&Ot.publish(this._joinInfo.sid,{eventElapse:Xs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:d,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(s=c.find(y=>{let{stream_type:v}=y;return v===Zn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(o=c.find(y=>{let{stream_type:v}=y;return v!==Zn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Kt.SUBSCRIBE:r&&Ot.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===Tt.AUDIO,video:r.stream_type===Tt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Xs.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(wn.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(wn.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;se("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(o=>!X_(o.string_id||o.stream_id,this.channelName)));const r=[],s=[];for(const o of t.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Qm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(bn.USER_JOINED,c)));const d=Ji.Audio&o.stream_type,h=(Ji.Video|Ji.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,y=d&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),d&&!y&&this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(bn.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(bn.USER_PUBLISHED,c,"video")),(d&&!y||h&&!v||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(bn.PUBLISHED_USER_LIST).length>0?se("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(bn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(wn.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof WT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var o;return ot(o=Object.keys(XA)).call(o,s)}))})}_handleP2PEvents(){this._gateway.signal.on(wn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ui.PUBLISH,(t,r,s)=>{const{uid:o}=t;t.forEach(c=>{const{kind:d,ssrcs:h,mid:m,isMuted:y}=c;this._handleP2PAddAudioOrVideoStream(d,o,h[0].ssrcId,m);const v=this._users.find(S=>S.uid===o);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,d,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(o,d,!!y)})}),this._gateway.signal.on(ui.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(Yt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(ui.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=t,d=this._users.find(h=>h.uid===c);if(!d)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const y=m===Zn.Audio?Tt.AUDIO:Tt.VIDEO;await this._p2pChannel.unsubscribe(d,y),this._handleMuteStream(c,y,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(ui.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case Km.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Tt.VIDEO,!0);break;case Km.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Tt.AUDIO,!0);break;case Km.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Tt.VIDEO,!1);break;case Km.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Tt.AUDIO,!1)}}),this._gateway.signal.on(ui.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=t;o!==Qo.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){s(o)}}),this._gateway.signal.on(ui.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(Vt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:o}=t;r(await this._gateway.sendExtensionMessage(ui.RESTART_ICE,t,o===Qo.SEND_ONLY))}catch(o){s(o)}}),this._p2pChannel.on(Vt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(ui.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Vt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(ui.CONTROL,t,!0),r()}catch(o){s(o)}}),this._p2pChannel.on(Vt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Vt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Vt.StateChange,(t,r)=>{r===Jn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Vt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(bn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Vt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Vt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Vt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(Vt.RequestRePublishDataChannel,(t,r,s)=>{ht.all(t.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==te.DISCONNECT_P2P)throw d}})).then(r).catch(s)}),this._p2pChannel.on(Vt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:o,kind:c}of t)c===Tt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){s(o)}}),this._p2pChannel.on(Vt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Vt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Vt.MediaReconnectStart,t=>{this.safeEmit(bn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Vt.MediaReconnectEnd,t=>{this.safeEmit(bn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Vt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Vt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const o=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:d}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:d})}),this._p2pChannel.on(Vt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Vt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:o}),h=vH(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Vt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(Vt.P2PLost,()=>{this.safeEmit(bn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Vt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Vt.ConnectionTypeChange,t=>{this.safeEmit(bn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Vt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Vt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Vt.AudioMetadata,t=>{this.safeEmit(bn.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},mf("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:o,cname:c,sid:d,token:h,uid:m,cid:y,vid:v}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:y,vid:v?Number(v):0},Oi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(hs.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(bn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Uu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(bn.CONTENT_INSPECT_ERROR,new Ae(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(hs.INSPECT_RESULT,(r,s)=>{var o;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(bn.CONTENT_INSPECT_RESULT,r,s)}),t.on(hs.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(cf(t,"enabled"),t){if(!r)throw new Ae(te.INVALID_PARAMS,"config is required");if(V9(r),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(s={config:r},mf("ImageModeration").create(s));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:d,sid:h,token:m,uid:y,cid:v,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:d,sid:h,token:m,uid:y,cid:v,vid:S?Number(S):0},Oi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var s;if(!this._moderation)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(t){t.on(Vd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(bn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Hl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Ae(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Vd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Wi(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Ae(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){cf(t,"enabled"),or("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Rt(mt.prototype,"leave",[F9],Object.getOwnPropertyDescriptor(mt.prototype,"leave"),mt.prototype),Rt(mt.prototype,"publish",[j9],Object.getOwnPropertyDescriptor(mt.prototype,"publish"),mt.prototype),Rt(mt.prototype,"unpublish",[B9],Object.getOwnPropertyDescriptor(mt.prototype,"unpublish"),mt.prototype),Rt(mt.prototype,"subscribe",[z9],Object.getOwnPropertyDescriptor(mt.prototype,"subscribe"),mt.prototype),Rt(mt.prototype,"presubscribe",[W9],Object.getOwnPropertyDescriptor(mt.prototype,"presubscribe"),mt.prototype),Rt(mt.prototype,"massSubscribe",[G9],Object.getOwnPropertyDescriptor(mt.prototype,"massSubscribe"),mt.prototype),Rt(mt.prototype,"unsubscribe",[H9],Object.getOwnPropertyDescriptor(mt.prototype,"unsubscribe"),mt.prototype),Rt(mt.prototype,"massUnsubscribe",[$9],Object.getOwnPropertyDescriptor(mt.prototype,"massUnsubscribe"),mt.prototype),Rt(mt.prototype,"setLowStreamParameter",[K9],Object.getOwnPropertyDescriptor(mt.prototype,"setLowStreamParameter"),mt.prototype),Rt(mt.prototype,"enableDualStream",[q9],Object.getOwnPropertyDescriptor(mt.prototype,"enableDualStream"),mt.prototype),Rt(mt.prototype,"disableDualStream",[Y9],Object.getOwnPropertyDescriptor(mt.prototype,"disableDualStream"),mt.prototype),Rt(mt.prototype,"setClientRole",[X9],Object.getOwnPropertyDescriptor(mt.prototype,"setClientRole"),mt.prototype),Rt(mt.prototype,"_setClientRoleOptions",[J9],Object.getOwnPropertyDescriptor(mt.prototype,"_setClientRoleOptions"),mt.prototype),Rt(mt.prototype,"setProxyServer",[Q9],Object.getOwnPropertyDescriptor(mt.prototype,"setProxyServer"),mt.prototype),Rt(mt.prototype,"setTurnServer",[Z9],Object.getOwnPropertyDescriptor(mt.prototype,"setTurnServer"),mt.prototype),Rt(mt.prototype,"setLicense",[e$],Object.getOwnPropertyDescriptor(mt.prototype,"setLicense"),mt.prototype),Rt(mt.prototype,"startProxyServer",[t$],Object.getOwnPropertyDescriptor(mt.prototype,"startProxyServer"),mt.prototype),Rt(mt.prototype,"stopProxyServer",[n$],Object.getOwnPropertyDescriptor(mt.prototype,"stopProxyServer"),mt.prototype),Rt(mt.prototype,"setLocalAccessPointsV2",[r$],Object.getOwnPropertyDescriptor(mt.prototype,"setLocalAccessPointsV2"),mt.prototype),Rt(mt.prototype,"setLocalAccessPoints",[i$],Object.getOwnPropertyDescriptor(mt.prototype,"setLocalAccessPoints"),mt.prototype),Rt(mt.prototype,"setRemoteDefaultVideoStreamType",[s$],Object.getOwnPropertyDescriptor(mt.prototype,"setRemoteDefaultVideoStreamType"),mt.prototype),Rt(mt.prototype,"setRemoteVideoStreamType",[o$],Object.getOwnPropertyDescriptor(mt.prototype,"setRemoteVideoStreamType"),mt.prototype),Rt(mt.prototype,"setStreamFallbackOption",[a$],Object.getOwnPropertyDescriptor(mt.prototype,"setStreamFallbackOption"),mt.prototype),Rt(mt.prototype,"setEncryptionConfig",[c$],Object.getOwnPropertyDescriptor(mt.prototype,"setEncryptionConfig"),mt.prototype),Rt(mt.prototype,"renewToken",[l$],Object.getOwnPropertyDescriptor(mt.prototype,"renewToken"),mt.prototype),Rt(mt.prototype,"enableAudioVolumeIndicator",[u$],Object.getOwnPropertyDescriptor(mt.prototype,"enableAudioVolumeIndicator"),mt.prototype),Rt(mt.prototype,"startLiveStreaming",[d$],Object.getOwnPropertyDescriptor(mt.prototype,"startLiveStreaming"),mt.prototype),Rt(mt.prototype,"setLiveTranscoding",[h$],Object.getOwnPropertyDescriptor(mt.prototype,"setLiveTranscoding"),mt.prototype),Rt(mt.prototype,"stopLiveStreaming",[p$],Object.getOwnPropertyDescriptor(mt.prototype,"stopLiveStreaming"),mt.prototype),Rt(mt.prototype,"startChannelMediaRelay",[f$],Object.getOwnPropertyDescriptor(mt.prototype,"startChannelMediaRelay"),mt.prototype),Rt(mt.prototype,"updateChannelMediaRelay",[m$],Object.getOwnPropertyDescriptor(mt.prototype,"updateChannelMediaRelay"),mt.prototype),Rt(mt.prototype,"stopChannelMediaRelay",[g$],Object.getOwnPropertyDescriptor(mt.prototype,"stopChannelMediaRelay"),mt.prototype),Rt(mt.prototype,"sendCustomReportMessage",[_$],Object.getOwnPropertyDescriptor(mt.prototype,"sendCustomReportMessage"),mt.prototype),Rt(mt.prototype,"pickSVCLayer",[y$],Object.getOwnPropertyDescriptor(mt.prototype,"pickSVCLayer"),mt.prototype),Rt(mt.prototype,"setRTMConfig",[E$],Object.getOwnPropertyDescriptor(mt.prototype,"setRTMConfig"),mt.prototype),Rt(mt.prototype,"enableContentInspect",[v$],Object.getOwnPropertyDescriptor(mt.prototype,"enableContentInspect"),mt.prototype),Rt(mt.prototype,"disableContentInspect",[S$],Object.getOwnPropertyDescriptor(mt.prototype,"disableContentInspect"),mt.prototype),Rt(mt.prototype,"setImageModeration",[b$],Object.getOwnPropertyDescriptor(mt.prototype,"setImageModeration"),mt.prototype),Rt(mt.prototype,"setP2PTransport",[T$],Object.getOwnPropertyDescriptor(mt.prototype,"setP2PTransport"),mt.prototype),Rt(mt.prototype,"getJoinChannelServiceRecords",[w$],Object.getOwnPropertyDescriptor(mt.prototype,"getJoinChannelServiceRecords"),mt.prototype),Rt(mt.prototype,"setPublishAudioFilterEnabled",[C$],Object.getOwnPropertyDescriptor(mt.prototype,"setPublishAudioFilterEnabled"),mt.prototype),mt);class $T{constructor(r,s){q(this,"id",0),q(this,"element",void 0),q(this,"peerPair",void 0),q(this,"context",void 0),q(this,"audioPlayerElement",void 0),q(this,"audioTrack",void 0),$T.count+=1,this.id=$T.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const d=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(d),o.iceGatheringState==="complete"?o.localDescription:new ht(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},s=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await s(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(o){throw new Ae(te.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Ae(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Ae(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=s.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var I$,zP;q($T,"count",0);const jge=window.AudioContext||window.webkitAudioContext,Bge=new(I$=Ht({report:Ot}),Rt((zP=class{constructor(){q(this,"units",[]),q(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new jge);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new $T(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return xn().name!==Hn.SAFARI}}).prototype,"processExternalMediaAEC",[I$],Object.getOwnPropertyDescriptor(zP.prototype,"processExternalMediaAEC"),zP.prototype),zP);function A$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function P$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?A$(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):A$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const v2=window||document;function O$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!v2)return;const s=ki._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const o=c=>{if(!(c&&c.blockedURI&&(ki.onSecurityPolicyViolation||ki.getListeners(jh.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;se("CSP_DETECTED_HOSTNAME_LIST").some(h=>ot(d).call(d,h))&&(ki.onSecurityPolicyViolation&&typeof ki.onSecurityPolicyViolation=="function"&&ki.onSecurityPolicyViolation(c),ki.getListeners(jh.SECURITY_POLICY_VIOLATION).length>0&&ki.safeEmit(jh.SECURITY_POLICY_VIOLATION,c))};s&&v2.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||ki.getListeners(jh.SECURITY_POLICY_VIOLATION).length>0)&&v2.addEventListener("securitypolicyviolation",o),ki._cspEventHandlerPointer=o}var zge=O,Wge=pz,k$=RegExp.prototype,Gge=function(t){return t===k$||zge(k$,t)?Wge(t):t.flags},wo=l(Gge);function gS(t){let r=t.length;for(;--r>=0;)t[r]=0}const S2=256,N$=286,KT=30,qT=15,b2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),WP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Hge=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),D$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yf=new Array(576);gS(yf);const YT=new Array(60);gS(YT);const XT=new Array(512);gS(XT);const JT=new Array(256);gS(JT);const T2=new Array(29);gS(T2);const GP=new Array(KT);function w2(t,r,s,o,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=o,this.max_length=c,this.has_stree=t&&t.length}let x$,L$,M$;function C2(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}gS(GP);const U$=t=>t<256?XT[t]:XT[256+(t>>>7)],QT=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},pl=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,QT(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},Hh=(t,r,s)=>{pl(t,s[2*r],s[2*r+1])},V$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},F$=(t,r,s)=>{const o=new Array(16);let c,d,h=0;for(c=1;c<=qT;c++)h=h+s[c-1]<<1,o[c]=h;for(d=0;d<=r;d++){let m=t[2*d+1];m!==0&&(t[2*d]=V$(o[m]++,m))}},j$=t=>{let r;for(r=0;r<N$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<KT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},B$=t=>{t.bi_valid>8?QT(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},z$=(t,r,s,o)=>{const c=2*r,d=2*s;return t[c]<t[d]||t[c]===t[d]&&o[r]<=o[s]},R2=(t,r,s)=>{const o=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&z$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!z$(r,o,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=o},W$=(t,r,s)=>{let o,c,d,h,m=0;if(t.sym_next!==0)do o=255&t.pending_buf[t.sym_buf+m++],o+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],o===0?Hh(t,c,r):(d=JT[c],Hh(t,d+S2+1,r),h=b2[d],h!==0&&(c-=T2[d],pl(t,c,h)),o--,d=U$(o),Hh(t,d,s),h=WP[d],h!==0&&(o-=GP[d],pl(t,o,h)));while(m<t.sym_next);Hh(t,256,r)},I2=(t,r)=>{const s=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,m,y,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)y=t.heap[++t.heap_len]=v<2?++v:0,s[2*y]=1,t.depth[y]=0,t.opt_len--,c&&(t.static_len-=o[2*y+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)R2(t,s,h);y=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],R2(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*y]=s[2*h]+s[2*m],t.depth[y]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=y,t.heap[1]=y++,R2(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((S,R)=>{const P=R.dyn_tree,D=R.max_code,G=R.stat_desc.static_tree,j=R.stat_desc.has_stree,B=R.stat_desc.extra_bits,J=R.stat_desc.extra_base,ee=R.stat_desc.max_length;let fe,ye,ve,_e,Ne,Je,pt=0;for(_e=0;_e<=qT;_e++)S.bl_count[_e]=0;for(P[2*S.heap[S.heap_max]+1]=0,fe=S.heap_max+1;fe<573;fe++)ye=S.heap[fe],_e=P[2*P[2*ye+1]+1]+1,_e>ee&&(_e=ee,pt++),P[2*ye+1]=_e,ye>D||(S.bl_count[_e]++,Ne=0,ye>=J&&(Ne=B[ye-J]),Je=P[2*ye],S.opt_len+=Je*(_e+Ne),j&&(S.static_len+=Je*(G[2*ye+1]+Ne)));if(pt!==0){do{for(_e=ee-1;S.bl_count[_e]===0;)_e--;S.bl_count[_e]--,S.bl_count[_e+1]+=2,S.bl_count[ee]--,pt-=2}while(pt>0);for(_e=ee;_e!==0;_e--)for(ye=S.bl_count[_e];ye!==0;)ve=S.heap[--fe],ve>D||(P[2*ve+1]!==_e&&(S.opt_len+=(_e-P[2*ve+1])*P[2*ve],P[2*ve+1]=_e),ye--)}})(t,r),F$(s,v,t.bl_count)},G$=(t,r,s)=>{let o,c,d=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),r[2*(s+1)+1]=65535,o=0;o<=s;o++)c=h,h=r[2*(o+1)+1],++m<y&&c===h||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4))},H$=(t,r,s)=>{let o,c,d=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),o=0;o<=s;o++)if(c=h,h=r[2*(o+1)+1],!(++m<y&&c===h)){if(m<v)do Hh(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==d&&(Hh(t,c,t.bl_tree),m--),Hh(t,16,t.bl_tree),pl(t,m-3,2)):m<=10?(Hh(t,17,t.bl_tree),pl(t,m-3,3)):(Hh(t,18,t.bl_tree),pl(t,m-11,7));m=0,d=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4)}};let $$=!1;const K$=(t,r,s,o)=>{pl(t,0+(o?1:0),3),B$(t),QT(t,s),QT(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var $ge=t=>{$$||((()=>{let r,s,o,c,d;const h=new Array(16);for(o=0,c=0;c<28;c++)for(T2[c]=o,r=0;r<1<<b2[c];r++)JT[o++]=c;for(JT[o-1]=c,d=0,c=0;c<16;c++)for(GP[c]=d,r=0;r<1<<WP[c];r++)XT[d++]=c;for(d>>=7;c<KT;c++)for(GP[c]=d<<7,r=0;r<1<<WP[c]-7;r++)XT[256+d++]=c;for(s=0;s<=qT;s++)h[s]=0;for(r=0;r<=143;)yf[2*r+1]=8,r++,h[8]++;for(;r<=255;)yf[2*r+1]=9,r++,h[9]++;for(;r<=279;)yf[2*r+1]=7,r++,h[7]++;for(;r<=287;)yf[2*r+1]=8,r++,h[8]++;for(F$(yf,287,h),r=0;r<KT;r++)YT[2*r+1]=5,YT[2*r]=V$(r,5);x$=new w2(yf,b2,257,N$,qT),L$=new w2(YT,WP,0,KT,qT),M$=new w2(new Array(0),Hge,0,19,7)})(),$$=!0),t.l_desc=new C2(t.dyn_ltree,x$),t.d_desc=new C2(t.dyn_dtree,L$),t.bl_desc=new C2(t.bl_tree,M$),t.bi_buf=0,t.bi_valid=0,j$(t)},Kge=(t,r,s,o)=>{let c,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let y,v=4093624447;for(y=0;y<=31;y++,v>>>=1)if(1&v&&m.dyn_ltree[2*y]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(y=32;y<S2;y++)if(m.dyn_ltree[2*y]!==0)return 1;return 0})(t)),I2(t,t.l_desc),I2(t,t.d_desc),h=(m=>{let y;for(G$(m,m.dyn_ltree,m.l_desc.max_code),G$(m,m.dyn_dtree,m.d_desc.max_code),I2(m,m.bl_desc),y=18;y>=3&&m.bl_tree[2*D$[y]+1]===0;y--);return m.opt_len+=3*(y+1)+5+5+4,y})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&r!==-1?K$(t,r,s,o):t.strategy===4||d===c?(pl(t,2+(o?1:0),3),W$(t,yf,YT)):(pl(t,4+(o?1:0),3),((m,y,v,S)=>{let R;for(pl(m,y-257,5),pl(m,v-1,5),pl(m,S-4,4),R=0;R<S;R++)pl(m,m.bl_tree[2*D$[R]+1],3);H$(m,m.dyn_ltree,y-1),H$(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),W$(t,t.dyn_ltree,t.dyn_dtree)),j$(t),o&&B$(t)},qge=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(JT[s]+S2+1)]++,t.dyn_dtree[2*U$(r)]++),t.sym_next===t.sym_end),Yge=t=>{pl(t,2,3),Hh(t,256,yf),(r=>{r.bi_valid===16?(QT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},Xge={_tr_init:$ge,_tr_stored_block:K$,_tr_flush_block:Kge,_tr_tally:qge,_tr_align:Yge},ZT=(t,r,s,o)=>{let c=65535&t|0,d=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[o++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const Jge=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var ea=(t,r,s,o)=>{const c=Jge,d=o+s;t^=-1;for(let h=o;h<d;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},sy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},HP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Qge,_tr_stored_block:A2,_tr_flush_block:Zge,_tr_tally:ng,_tr_align:e_e}=Xge,{Z_NO_FLUSH:rg,Z_PARTIAL_FLUSH:t_e,Z_FULL_FLUSH:n_e,Z_FINISH:zu,Z_BLOCK:q$,Z_OK:Ia,Z_STREAM_END:Y$,Z_STREAM_ERROR:$h,Z_DATA_ERROR:r_e,Z_BUF_ERROR:P2,Z_DEFAULT_COMPRESSION:i_e,Z_FILTERED:s_e,Z_HUFFMAN_ONLY:$P,Z_RLE:o_e,Z_FIXED:a_e,Z_DEFAULT_STRATEGY:c_e,Z_UNKNOWN:l_e,Z_DEFLATED:KP}=HP,O2=286,u_e=30,d_e=19,h_e=2*O2+1,p_e=15,oy=258,Kh=262,_S=42,ay=113,ew=666,cy=(t,r)=>(t.msg=sy[r],r),X$=t=>2*t-(t>4?9:0),ig=t=>{let r=t.length;for(;--r>=0;)t[r]=0},f_e=t=>{let r,s,o,c=t.w_size;r=t.hash_size,o=r;do s=t.head[--o],t.head[o]=s>=c?s-c:0;while(--r);r=c,o=r;do s=t.prev[--o],t.prev[o]=s>=c?s-c:0;while(--r)};let sg=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Kl=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},ql=(t,r)=>{Zge(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Kl(t.strm)},ni=(t,r)=>{t.pending_buf[t.pending++]=r},tw=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},k2=(t,r,s,o)=>{let c=t.avail_in;return c>o&&(c=o),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=ZT(t.adler,r,c,s):t.state.wrap===2&&(t.adler=ea(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},J$=(t,r)=>{let s,o,c=t.max_chain_length,d=t.strstart,h=t.prev_length,m=t.nice_match;const y=t.strstart>t.w_size-Kh?t.strstart-(t.w_size-Kh):0,v=t.window,S=t.w_mask,R=t.prev,P=t.strstart+oy;let D=v[d+h-1],G=v[d+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,v[s+h]===G&&v[s+h-1]===D&&v[s]===v[d]&&v[++s]===v[d+1]){d+=2,s++;do;while(v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&d<P);if(o=oy-(P-d),d=P-oy,o>h){if(t.match_start=r,h=o,o>=m)break;D=v[d+h-1],G=v[d+h]}}while((r=R[r&S])>y&&--c!=0);return h<=t.lookahead?h:t.lookahead},yS=t=>{const r=t.w_size;let s,o,c;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Kh)&&(t.window.set(t.window.subarray(r,r+r-o),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),f_e(t),o+=r),t.strm.avail_in===0)break;if(s=k2(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=sg(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=sg(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Kh&&t.strm.avail_in!==0)},Q$=(t,r)=>{let s,o,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,o=t.strstart-t.block_start,s>o+t.strm.avail_in&&(s=o+t.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&r!==zu||r===rg||s!==o+t.strm.avail_in)))break;h=r===zu&&s===o+t.strm.avail_in?1:0,A2(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Kl(t.strm),o&&(o>s&&(o=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,s-=o),s&&(k2(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==rg&&r!==zu&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(k2(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,o=t.strstart-t.block_start,(o>=d||(o||r===zu)&&r!==rg&&t.strm.avail_in===0&&o<=c)&&(s=o>c?c:o,h=r===zu&&t.strm.avail_in===0&&s===o?1:0,A2(t,t.block_start,s,h),t.block_start+=s,Kl(t.strm)),h?3:1)},N2=(t,r)=>{let s,o;for(;;){if(t.lookahead<Kh){if(yS(t),t.lookahead<Kh&&r===rg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=sg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-Kh&&(t.match_length=J$(t,s)),t.match_length>=3)if(o=ng(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=sg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=sg(t,t.ins_h,t.window[t.strstart+1]);else o=ng(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(ql(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===zu?(ql(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ql(t,!1),t.strm.avail_out===0)?1:2},ES=(t,r)=>{let s,o,c;for(;;){if(t.lookahead<Kh){if(yS(t),t.lookahead<Kh&&r===rg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=sg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Kh&&(t.match_length=J$(t,s),t.match_length<=5&&(t.strategy===s_e||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,o=ng(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=sg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(ql(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(o=ng(t,0,t.window[t.strstart-1]),o&&ql(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=ng(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===zu?(ql(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ql(t,!1),t.strm.avail_out===0)?1:2};function qh(t,r,s,o,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=o,this.func=c}const nw=[new qh(0,0,0,0,Q$),new qh(4,4,8,4,N2),new qh(4,5,16,8,N2),new qh(4,6,32,32,N2),new qh(4,4,16,16,ES),new qh(8,16,32,32,ES),new qh(8,16,128,128,ES),new qh(8,32,128,256,ES),new qh(32,128,258,1024,ES),new qh(32,258,258,4096,ES)];function m_e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=KP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*h_e),this.dyn_dtree=new Uint16Array(2*(2*u_e+1)),this.bl_tree=new Uint16Array(2*(2*d_e+1)),ig(this.dyn_ltree),ig(this.dyn_dtree),ig(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(p_e+1),this.heap=new Uint16Array(2*O2+1),ig(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*O2+1),ig(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const rw=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==_S&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==ay&&r.status!==ew?1:0},Z$=t=>{if(rw(t))return cy(t,$h);t.total_in=t.total_out=0,t.data_type=l_e;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?_S:ay,t.adler=r.wrap===2?0:1,r.last_flush=-2,Qge(r),Ia},e7=t=>{const r=Z$(t);return r===Ia&&(s=>{s.window_size=2*s.w_size,ig(s.head),s.max_lazy_match=nw[s.level].max_lazy,s.good_match=nw[s.level].good_length,s.nice_match=nw[s.level].nice_length,s.max_chain_length=nw[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},t7=(t,r,s,o,c,d)=>{if(!t)return $h;let h=1;if(r===i_e&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||s!==KP||o<8||o>15||r<0||r>9||d<0||d>a_e||o===8&&h!==1)return cy(t,$h);o===8&&(o=9);const m=new m_e;return t.state=m,m.strm=t,m.status=_S,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=d,m.method=s,e7(t)};var g_e=(t,r)=>{if(rw(t)||r>q$||r<0)return t?cy(t,$h):$h;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===ew&&r!==zu)return cy(t,t.avail_out===0?P2:$h);const o=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Kl(t),t.avail_out===0)return s.last_flush=-1,Ia}else if(t.avail_in===0&&X$(r)<=X$(o)&&r!==zu)return cy(t,P2);if(s.status===ew&&t.avail_in!==0)return cy(t,P2);if(s.status===_S&&s.wrap===0&&(s.status=ay),s.status===_S){let c=KP+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=$P||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,tw(s,c),s.strstart!==0&&(tw(s,t.adler>>>16),tw(s,65535&t.adler)),t.adler=1,s.status=ay,Kl(t),s.pending!==0)return s.last_flush=-1,Ia}if(s.status===57){if(t.adler=0,ni(s,31),ni(s,139),ni(s,8),s.gzhead)ni(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ni(s,255&s.gzhead.time),ni(s,s.gzhead.time>>8&255),ni(s,s.gzhead.time>>16&255),ni(s,s.gzhead.time>>24&255),ni(s,s.level===9?2:s.strategy>=$P||s.level<2?4:0),ni(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ni(s,255&s.gzhead.extra.length),ni(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=ea(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(ni(s,0),ni(s,0),ni(s,0),ni(s,0),ni(s,0),ni(s,s.level===9?2:s.strategy>=$P||s.level<2?4:0),ni(s,3),s.status=ay,Kl(t),s.pending!==0)return s.last_flush=-1,Ia}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=ea(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Kl(t),s.pending!==0)return s.last_flush=-1,Ia;c=0,d-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(t.adler=ea(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ea(t.adler,s.pending_buf,s.pending-d,d)),Kl(t),s.pending!==0)return s.last_flush=-1,Ia;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ni(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ea(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ea(t.adler,s.pending_buf,s.pending-d,d)),Kl(t),s.pending!==0)return s.last_flush=-1,Ia;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ni(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ea(t.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Kl(t),s.pending!==0))return s.last_flush=-1,Ia;ni(s,255&t.adler),ni(s,t.adler>>8&255),t.adler=0}if(s.status=ay,Kl(t),s.pending!==0)return s.last_flush=-1,Ia}if(t.avail_in!==0||s.lookahead!==0||r!==rg&&s.status!==ew){let c=s.level===0?Q$(s,r):s.strategy===$P?((d,h)=>{let m;for(;;){if(d.lookahead===0&&(yS(d),d.lookahead===0)){if(h===rg)return 1;break}if(d.match_length=0,m=ng(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(ql(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===zu?(ql(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(ql(d,!1),d.strm.avail_out===0)?1:2})(s,r):s.strategy===o_e?((d,h)=>{let m,y,v,S;const R=d.window;for(;;){if(d.lookahead<=oy){if(yS(d),d.lookahead<=oy&&h===rg)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(v=d.strstart-1,y=R[v],y===R[++v]&&y===R[++v]&&y===R[++v])){S=d.strstart+oy;do;while(y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&v<S);d.match_length=oy-(S-v),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=ng(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=ng(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(ql(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===zu?(ql(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(ql(d,!1),d.strm.avail_out===0)?1:2})(s,r):nw[s.level].func(s,r);if(c!==3&&c!==4||(s.status=ew),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),Ia;if(c===2&&(r===t_e?e_e(s):r!==q$&&(A2(s,0,0,!1),r===n_e&&(ig(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Kl(t),t.avail_out===0))return s.last_flush=-1,Ia}return r!==zu?Ia:s.wrap<=0?Y$:(s.wrap===2?(ni(s,255&t.adler),ni(s,t.adler>>8&255),ni(s,t.adler>>16&255),ni(s,t.adler>>24&255),ni(s,255&t.total_in),ni(s,t.total_in>>8&255),ni(s,t.total_in>>16&255),ni(s,t.total_in>>24&255)):(tw(s,t.adler>>>16),tw(s,65535&t.adler)),Kl(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Ia:Y$)},__e=(t,r)=>{let s=r.length;if(rw(t))return $h;const o=t.state,c=o.wrap;if(c===2||c===1&&o.status!==_S||o.lookahead)return $h;if(c===1&&(t.adler=ZT(t.adler,r,s,0)),o.wrap=0,s>=o.w_size){c===0&&(ig(o.head),o.strstart=0,o.block_start=0,o.insert=0);let y=new Uint8Array(o.w_size);y.set(r.subarray(s-o.w_size,s),0),r=y,s=o.w_size}const d=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,yS(o);o.lookahead>=3;){let y=o.strstart,v=o.lookahead-2;do o.ins_h=sg(o,o.ins_h,o.window[y+3-1]),o.prev[y&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=y,y++;while(--v);o.strstart=y,o.lookahead=2,yS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,t.next_in=h,t.input=m,t.avail_in=d,o.wrap=c,Ia},iw={deflateInit:(t,r)=>t7(t,r,KP,15,8,c_e),deflateInit2:t7,deflateReset:e7,deflateResetKeep:Z$,deflateSetHeader:(t,r)=>rw(t)||t.state.wrap!==2?$h:(t.state.gzhead=r,Ia),deflate:g_e,deflateEnd:t=>{if(rw(t))return $h;const r=t.state.status;return t.state=null,r===ay?cy(t,r_e):Ia},deflateSetDictionary:__e,deflateInfo:"pako deflate (from Nodeca project)"};const y_e=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var qP={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const o in s)y_e(s,o)&&(t[o]=s[o])}}return t},flattenChunks:t=>{let r=0;for(let o=0,c=t.length;o<c;o++)r+=t[o].length;const s=new Uint8Array(r);for(let o=0,c=0,d=t.length;o<d;o++){let h=t[o];s.set(h,c),c+=h.length}return s}};let n7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n7=!1}const sw=new Uint8Array(256);for(let t=0;t<256;t++)sw[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;sw[254]=sw[254]=1;var ow={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,o,c,d,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),d=0,c=0;d<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),s<128?r[d++]=s:s<2048?(r[d++]=192|s>>>6,r[d++]=128|63&s):s<65536?(r[d++]=224|s>>>12,r[d++]=128|s>>>6&63,r[d++]=128|63&s):(r[d++]=240|s>>>18,r[d++]=128|s>>>12&63,r[d++]=128|s>>>6&63,r[d++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let o,c;const d=new Array(2*s);for(c=0,o=0;o<s;){let h=t[o++];if(h<128){d[c++]=h;continue}let m=sw[h];if(m>4)d[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<s;)h=h<<6|63&t[o++],m--;m>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&n7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let y="";for(let v=0;v<m;v++)y+=String.fromCharCode(h[v]);return y})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+sw[t[s]]>r?s:r}},r7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const i7=Object.prototype.toString,{Z_NO_FLUSH:E_e,Z_SYNC_FLUSH:v_e,Z_FULL_FLUSH:S_e,Z_FINISH:b_e,Z_OK:YP,Z_STREAM_END:T_e,Z_DEFAULT_COMPRESSION:w_e,Z_DEFAULT_STRATEGY:C_e,Z_DEFLATED:R_e}=HP;function XP(t){this.options=qP.assign({level:w_e,method:R_e,chunkSize:16384,windowBits:15,memLevel:8,strategy:C_e},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r7,this.strm.avail_out=0;let s=iw.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==YP)throw new Error(sy[s]);if(r.header&&iw.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?ow.string2buf(r.dictionary):i7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=iw.deflateSetDictionary(this.strm,o),s!==YP)throw new Error(sy[s]);this._dict_set=!0}}function I_e(t,r){const s=new XP(r);if(s.push(t,!0),s.err)throw s.msg||sy[s.err];return s.result}XP.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?b_e:E_e,typeof t=="string"?s.input=ow.string2buf(t):i7.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),(d===v_e||d===S_e)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=iw.deflate(s,d),c===T_e)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=iw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===YP;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},XP.prototype.onData=function(t){this.chunks.push(t)},XP.prototype.onEnd=function(t){t===YP&&(this.result=qP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var A_e={deflate:I_e};const JP=16209;var P_e=function(t,r){let s,o,c,d,h,m,y,v,S,R,P,D,G,j,B,J,ee,fe,ye,ve,_e,Ne,Je,pt;const _t=t.state;s=t.next_in,Je=t.input,o=s+(t.avail_in-5),c=t.next_out,pt=t.output,d=c-(r-t.avail_out),h=c+(t.avail_out-257),m=_t.dmax,y=_t.wsize,v=_t.whave,S=_t.wnext,R=_t.window,P=_t.hold,D=_t.bits,G=_t.lencode,j=_t.distcode,B=(1<<_t.lenbits)-1,J=(1<<_t.distbits)-1;e:do{D<15&&(P+=Je[s++]<<D,D+=8,P+=Je[s++]<<D,D+=8),ee=G[P&B];t:for(;;){if(fe=ee>>>24,P>>>=fe,D-=fe,fe=ee>>>16&255,fe===0)pt[c++]=65535&ee;else{if(!(16&fe)){if((64&fe)==0){ee=G[(65535&ee)+(P&(1<<fe)-1)];continue t}if(32&fe){_t.mode=16191;break e}t.msg="invalid literal/length code",_t.mode=JP;break e}ye=65535&ee,fe&=15,fe&&(D<fe&&(P+=Je[s++]<<D,D+=8),ye+=P&(1<<fe)-1,P>>>=fe,D-=fe),D<15&&(P+=Je[s++]<<D,D+=8,P+=Je[s++]<<D,D+=8),ee=j[P&J];n:for(;;){if(fe=ee>>>24,P>>>=fe,D-=fe,fe=ee>>>16&255,!(16&fe)){if((64&fe)==0){ee=j[(65535&ee)+(P&(1<<fe)-1)];continue n}t.msg="invalid distance code",_t.mode=JP;break e}if(ve=65535&ee,fe&=15,D<fe&&(P+=Je[s++]<<D,D+=8,D<fe&&(P+=Je[s++]<<D,D+=8)),ve+=P&(1<<fe)-1,ve>m){t.msg="invalid distance too far back",_t.mode=JP;break e}if(P>>>=fe,D-=fe,fe=c-d,ve>fe){if(fe=ve-fe,fe>v&&_t.sane){t.msg="invalid distance too far back",_t.mode=JP;break e}if(_e=0,Ne=R,S===0){if(_e+=y-fe,fe<ye){ye-=fe;do pt[c++]=R[_e++];while(--fe);_e=c-ve,Ne=pt}}else if(S<fe){if(_e+=y+S-fe,fe-=S,fe<ye){ye-=fe;do pt[c++]=R[_e++];while(--fe);if(_e=0,S<ye){fe=S,ye-=fe;do pt[c++]=R[_e++];while(--fe);_e=c-ve,Ne=pt}}}else if(_e+=S-fe,fe<ye){ye-=fe;do pt[c++]=R[_e++];while(--fe);_e=c-ve,Ne=pt}for(;ye>2;)pt[c++]=Ne[_e++],pt[c++]=Ne[_e++],pt[c++]=Ne[_e++],ye-=3;ye&&(pt[c++]=Ne[_e++],ye>1&&(pt[c++]=Ne[_e++]))}else{_e=c-ve;do pt[c++]=pt[_e++],pt[c++]=pt[_e++],pt[c++]=pt[_e++],ye-=3;while(ye>2);ye&&(pt[c++]=pt[_e++],ye>1&&(pt[c++]=pt[_e++]))}break}}break}}while(s<o&&c<h);ye=D>>3,s-=ye,D-=ye<<3,P&=(1<<D)-1,t.next_in=s,t.next_out=c,t.avail_in=s<o?o-s+5:5-(s-o),t.avail_out=c<h?h-c+257:257-(c-h),_t.hold=P,_t.bits=D};const QP=15,O_e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),k_e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),N_e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),D_e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var aw=(t,r,s,o,c,d,h,m)=>{const y=m.bits;let v,S,R,P,D,G,j=0,B=0,J=0,ee=0,fe=0,ye=0,ve=0,_e=0,Ne=0,Je=0,pt=null;const _t=new Uint16Array(16),Rn=new Uint16Array(16);let In,yr,di,Zr=null;for(j=0;j<=QP;j++)_t[j]=0;for(B=0;B<o;B++)_t[r[s+B]]++;for(fe=y,ee=QP;ee>=1&&_t[ee]===0;ee--);if(fe>ee&&(fe=ee),ee===0)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(J=1;J<ee&&_t[J]===0;J++);for(fe<J&&(fe=J),_e=1,j=1;j<=QP;j++)if(_e<<=1,_e-=_t[j],_e<0)return-1;if(_e>0&&(t===0||ee!==1))return-1;for(Rn[1]=0,j=1;j<QP;j++)Rn[j+1]=Rn[j]+_t[j];for(B=0;B<o;B++)r[s+B]!==0&&(h[Rn[r[s+B]]++]=B);if(t===0?(pt=Zr=h,G=20):t===1?(pt=O_e,Zr=k_e,G=257):(pt=N_e,Zr=D_e,G=0),Je=0,B=0,j=J,D=d,ye=fe,ve=0,R=-1,Ne=1<<fe,P=Ne-1,t===1&&Ne>852||t===2&&Ne>592)return 1;for(;;){In=j-ve,h[B]+1<G?(yr=0,di=h[B]):h[B]>=G?(yr=Zr[h[B]-G],di=pt[h[B]-G]):(yr=96,di=0),v=1<<j-ve,S=1<<ye,J=S;do S-=v,c[D+(Je>>ve)+S]=In<<24|yr<<16|di|0;while(S!==0);for(v=1<<j-1;Je&v;)v>>=1;if(v!==0?(Je&=v-1,Je+=v):Je=0,B++,--_t[j]==0){if(j===ee)break;j=r[s+h[B]]}if(j>fe&&(Je&P)!==R){for(ve===0&&(ve=fe),D+=J,ye=j-ve,_e=1<<ye;ye+ve<ee&&(_e-=_t[ye+ve],!(_e<=0));)ye++,_e<<=1;if(Ne+=1<<ye,t===1&&Ne>852||t===2&&Ne>592)return 1;R=Je&P,c[R]=fe<<24|ye<<16|D-d|0}}return Je!==0&&(c[D+Je]=j-ve<<24|64<<16|0),m.bits=fe,0};const{Z_FINISH:s7,Z_BLOCK:x_e,Z_TREES:ZP,Z_OK:ly,Z_STREAM_END:L_e,Z_NEED_DICT:M_e,Z_STREAM_ERROR:Wu,Z_DATA_ERROR:o7,Z_MEM_ERROR:a7,Z_BUF_ERROR:U_e,Z_DEFLATED:c7}=HP,eO=16180,tO=16190,Ef=16191,D2=16192,x2=16194,nO=16199,rO=16200,L2=16206,ps=16209,l7=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function V_e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const uy=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<eO||r.mode>16211?1:0},u7=t=>{if(uy(t))return Wu;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=eO,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,ly},d7=t=>{if(uy(t))return Wu;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,u7(t)},h7=(t,r)=>{let s;if(uy(t))return Wu;const o=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Wu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=s,o.wbits=r,d7(t))},p7=(t,r)=>{if(!t)return Wu;const s=new V_e;t.state=s,s.strm=t,s.window=null,s.mode=eO;const o=h7(t,r);return o!==ly&&(t.state=null),o};let M2,U2,f7=!0;const F_e=t=>{if(f7){M2=new Int32Array(512),U2=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(aw(1,t.lens,0,288,M2,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;aw(2,t.lens,0,32,U2,0,t.work,{bits:5}),f7=!1}t.lencode=M2,t.lenbits=9,t.distcode=U2,t.distbits=5},m7=(t,r,s,o)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),o>=d.wsize?(d.window.set(r.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>o&&(c=o),d.window.set(r.subarray(s-o,s-o+c),d.wnext),(o-=c)?(d.window.set(r.subarray(s-o,s),0),d.wnext=o,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var j_e=(t,r)=>{let s,o,c,d,h,m,y,v,S,R,P,D,G,j,B,J,ee,fe,ye,ve,_e,Ne,Je=0;const pt=new Uint8Array(4);let _t,Rn;const In=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(uy(t)||!t.output||!t.input&&t.avail_in!==0)return Wu;s=t.state,s.mode===Ef&&(s.mode=D2),h=t.next_out,c=t.output,y=t.avail_out,d=t.next_in,o=t.input,m=t.avail_in,v=s.hold,S=s.bits,R=m,P=y,Ne=ly;e:for(;;)switch(s.mode){case eO:if(s.wrap===0){s.mode=D2;break}for(;S<16;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if(2&s.wrap&&v===35615){s.wbits===0&&(s.wbits=15),s.check=0,pt[0]=255&v,pt[1]=v>>>8&255,s.check=ea(s.check,pt,2,0),v=0,S=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",s.mode=ps;break}if((15&v)!==c7){t.msg="unknown compression method",s.mode=ps;break}if(v>>>=4,S-=4,_e=8+(15&v),s.wbits===0&&(s.wbits=_e),_e>15||_e>s.wbits){t.msg="invalid window size",s.mode=ps;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&v?16189:Ef,v=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if(s.flags=v,(255&wo(s))!==c7){t.msg="unknown compression method",s.mode=ps;break}if(57344&wo(s)){t.msg="unknown header flags set",s.mode=ps;break}s.head&&(s.head.text=v>>8&1),512&wo(s)&&4&s.wrap&&(pt[0]=255&v,pt[1]=v>>>8&255,s.check=ea(s.check,pt,2,0)),v=0,S=0,s.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}s.head&&(s.head.time=v),512&wo(s)&&4&s.wrap&&(pt[0]=255&v,pt[1]=v>>>8&255,pt[2]=v>>>16&255,pt[3]=v>>>24&255,s.check=ea(s.check,pt,4,0)),v=0,S=0,s.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&wo(s)&&4&s.wrap&&(pt[0]=255&v,pt[1]=v>>>8&255,s.check=ea(s.check,pt,2,0)),v=0,S=0,s.mode=16184;case 16184:if(1024&wo(s)){for(;S<16;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}s.length=v,s.head&&(s.head.extra_len=v),512&wo(s)&&4&s.wrap&&(pt[0]=255&v,pt[1]=v>>>8&255,s.check=ea(s.check,pt,2,0)),v=0,S=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&wo(s)&&(D=s.length,D>m&&(D=m),D&&(s.head&&(_e=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(o.subarray(d,d+D),_e)),512&wo(s)&&4&s.wrap&&(s.check=ea(s.check,o,D,d)),m-=D,d+=D,s.length-=D),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&wo(s)){if(m===0)break e;D=0;do _e=o[d+D++],s.head&&_e&&s.length<65536&&(s.head.name+=String.fromCharCode(_e));while(_e&&D<m);if(512&wo(s)&&4&s.wrap&&(s.check=ea(s.check,o,D,d)),m-=D,d+=D,_e)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&wo(s)){if(m===0)break e;D=0;do _e=o[d+D++],s.head&&_e&&s.length<65536&&(s.head.comment+=String.fromCharCode(_e));while(_e&&D<m);if(512&wo(s)&&4&s.wrap&&(s.check=ea(s.check,o,D,d)),m-=D,d+=D,_e)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&wo(s)){for(;S<16;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if(4&s.wrap&&v!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ps;break}v=0,S=0}s.head&&(s.head.hcrc=wo(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=Ef;break;case 16189:for(;S<32;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}t.adler=s.check=l7(v),v=0,S=0,s.mode=tO;case tO:if(s.havedict===0)return t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=S,M_e;t.adler=s.check=1,s.mode=Ef;case Ef:if(r===x_e||r===ZP)break e;case D2:if(s.last){v>>>=7&S,S-=7&S,s.mode=L2;break}for(;S<3;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}switch(s.last=1&v,v>>>=1,S-=1,3&v){case 0:s.mode=16193;break;case 1:if(F_e(s),s.mode=nO,r===ZP){v>>>=2,S-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ps}v>>>=2,S-=2;break;case 16193:for(v>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ps;break}if(s.length=65535&v,v=0,S=0,s.mode=x2,r===ZP)break e;case x2:s.mode=16195;case 16195:if(D=s.length,D){if(D>m&&(D=m),D>y&&(D=y),D===0)break e;c.set(o.subarray(d,d+D),h),m-=D,d+=D,y-=D,h+=D,s.length-=D;break}s.mode=Ef;break;case 16196:for(;S<14;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if(s.nlen=257+(31&v),v>>>=5,S-=5,s.ndist=1+(31&v),v>>>=5,S-=5,s.ncode=4+(15&v),v>>>=4,S-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ps;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;S<3;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}s.lens[In[s.have++]]=7&v,v>>>=3,S-=3}for(;s.have<19;)s.lens[In[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,_t={bits:s.lenbits},Ne=aw(0,s.lens,0,19,s.lencode,0,s.work,_t),s.lenbits=_t.bits,Ne){t.msg="invalid code lengths set",s.mode=ps;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Je=s.lencode[v&(1<<s.lenbits)-1],B=Je>>>24,J=Je>>>16&255,ee=65535&Je,!(B<=S);){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if(ee<16)v>>>=B,S-=B,s.lens[s.have++]=ee;else{if(ee===16){for(Rn=B+2;S<Rn;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if(v>>>=B,S-=B,s.have===0){t.msg="invalid bit length repeat",s.mode=ps;break}_e=s.lens[s.have-1],D=3+(3&v),v>>>=2,S-=2}else if(ee===17){for(Rn=B+3;S<Rn;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}v>>>=B,S-=B,_e=0,D=3+(7&v),v>>>=3,S-=3}else{for(Rn=B+7;S<Rn;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}v>>>=B,S-=B,_e=0,D=11+(127&v),v>>>=7,S-=7}if(s.have+D>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ps;break}for(;D--;)s.lens[s.have++]=_e}}if(s.mode===ps)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ps;break}if(s.lenbits=9,_t={bits:s.lenbits},Ne=aw(1,s.lens,0,s.nlen,s.lencode,0,s.work,_t),s.lenbits=_t.bits,Ne){t.msg="invalid literal/lengths set",s.mode=ps;break}if(s.distbits=6,s.distcode=s.distdyn,_t={bits:s.distbits},Ne=aw(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,_t),s.distbits=_t.bits,Ne){t.msg="invalid distances set",s.mode=ps;break}if(s.mode=nO,r===ZP)break e;case nO:s.mode=rO;case rO:if(m>=6&&y>=258){t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=S,P_e(t,P),h=t.next_out,c=t.output,y=t.avail_out,d=t.next_in,o=t.input,m=t.avail_in,v=s.hold,S=s.bits,s.mode===Ef&&(s.back=-1);break}for(s.back=0;Je=s.lencode[v&(1<<s.lenbits)-1],B=Je>>>24,J=Je>>>16&255,ee=65535&Je,!(B<=S);){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if(J&&(240&J)==0){for(fe=B,ye=J,ve=ee;Je=s.lencode[ve+((v&(1<<fe+ye)-1)>>fe)],B=Je>>>24,J=Je>>>16&255,ee=65535&Je,!(fe+B<=S);){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}v>>>=fe,S-=fe,s.back+=fe}if(v>>>=B,S-=B,s.back+=B,s.length=ee,J===0){s.mode=16205;break}if(32&J){s.back=-1,s.mode=Ef;break}if(64&J){t.msg="invalid literal/length code",s.mode=ps;break}s.extra=15&J,s.mode=16201;case 16201:if(s.extra){for(Rn=s.extra;S<Rn;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,S-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Je=s.distcode[v&(1<<s.distbits)-1],B=Je>>>24,J=Je>>>16&255,ee=65535&Je,!(B<=S);){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if((240&J)==0){for(fe=B,ye=J,ve=ee;Je=s.distcode[ve+((v&(1<<fe+ye)-1)>>fe)],B=Je>>>24,J=Je>>>16&255,ee=65535&Je,!(fe+B<=S);){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}v>>>=fe,S-=fe,s.back+=fe}if(v>>>=B,S-=B,s.back+=B,64&J){t.msg="invalid distance code",s.mode=ps;break}s.offset=ee,s.extra=15&J,s.mode=16203;case 16203:if(s.extra){for(Rn=s.extra;S<Rn;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,S-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ps;break}s.mode=16204;case 16204:if(y===0)break e;if(D=P-y,s.offset>D){if(D=s.offset-D,D>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ps;break}D>s.wnext?(D-=s.wnext,G=s.wsize-D):G=s.wnext-D,D>s.length&&(D=s.length),j=s.window}else j=c,G=h-s.offset,D=s.length;D>y&&(D=y),y-=D,s.length-=D;do c[h++]=j[G++];while(--D);s.length===0&&(s.mode=rO);break;case 16205:if(y===0)break e;c[h++]=s.length,y--,s.mode=rO;break;case L2:if(s.wrap){for(;S<32;){if(m===0)break e;m--,v|=o[d++]<<S,S+=8}if(P-=y,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=wo(s)?ea(s.check,c,P,h-P):ZT(s.check,c,P,h-P)),P=y,4&s.wrap&&(wo(s)?v:l7(v))!==s.check){t.msg="incorrect data check",s.mode=ps;break}v=0,S=0}s.mode=16207;case 16207:if(s.wrap&&wo(s)){for(;S<32;){if(m===0)break e;m--,v+=o[d++]<<S,S+=8}if(4&s.wrap&&v!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ps;break}v=0,S=0}s.mode=16208;case 16208:Ne=L_e;break e;case ps:Ne=o7;break e;case 16210:return a7;default:return Wu}return t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=S,(s.wsize||P!==t.avail_out&&s.mode<ps&&(s.mode<L2||r!==s7))&&m7(t,t.output,t.next_out,P-t.avail_out),R-=t.avail_in,P-=t.avail_out,t.total_in+=R,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=wo(s)?ea(s.check,c,P,t.next_out-P):ZT(s.check,c,P,t.next_out-P)),t.data_type=s.bits+(s.last?64:0)+(s.mode===Ef?128:0)+(s.mode===nO||s.mode===x2?256:0),(R===0&&P===0||r===s7)&&Ne===ly&&(Ne=U_e),Ne},vf={inflateReset:d7,inflateReset2:h7,inflateResetKeep:u7,inflateInit:t=>p7(t,15),inflateInit2:p7,inflate:j_e,inflateEnd:t=>{if(uy(t))return Wu;let r=t.state;return r.window&&(r.window=null),t.state=null,ly},inflateGetHeader:(t,r)=>{if(uy(t))return Wu;const s=t.state;return(2&s.wrap)==0?Wu:(s.head=r,r.done=!1,ly)},inflateSetDictionary:(t,r)=>{const s=r.length;let o,c,d;return uy(t)?Wu:(o=t.state,o.wrap!==0&&o.mode!==tO?Wu:o.mode===tO&&(c=1,c=ZT(c,r,s,0),c!==o.check)?o7:(d=m7(t,r,s,s),d?(o.mode=16210,a7):(o.havedict=1,ly)))},inflateInfo:"pako inflate (from Nodeca project)"},B_e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const g7=Object.prototype.toString,{Z_NO_FLUSH:z_e,Z_FINISH:W_e,Z_OK:cw,Z_STREAM_END:V2,Z_NEED_DICT:F2,Z_STREAM_ERROR:G_e,Z_DATA_ERROR:_7,Z_MEM_ERROR:H_e}=HP;function iO(t){this.options=qP.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r7,this.strm.avail_out=0;let s=vf.inflateInit2(this.strm,r.windowBits);if(s!==cw)throw new Error(sy[s]);if(this.header=new B_e,vf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=ow.string2buf(r.dictionary):g7.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=vf.inflateSetDictionary(this.strm,r.dictionary),s!==cw)))throw new Error(sy[s])}function $_e(t,r){const s=new iO(r);if(s.push(t),s.err)throw s.msg||sy[s.err];return s.result}iO.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let d,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?W_e:z_e,g7.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),d=vf.inflate(s,h),d===F2&&c&&(d=vf.inflateSetDictionary(s,c),d===cw?d=vf.inflate(s,h):d===_7&&(d=F2));s.avail_in>0&&d===V2&&s.state.wrap>0&&t[s.next_in]!==0;)vf.inflateReset(s),d=vf.inflate(s,h);switch(d){case G_e:case _7:case F2:case H_e:return this.onEnd(d),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||d===V2))if(this.options.to==="string"){let y=ow.utf8border(s.output,s.next_out),v=s.next_out-y,S=ow.buf2string(s.output,y);s.next_out=v,s.avail_out=o-v,v&&s.output.set(s.output.subarray(y,y+v),0),this.onData(S)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==cw||m!==0){if(d===V2)return d=vf.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},iO.prototype.onData=function(t){this.chunks.push(t)},iO.prototype.onEnd=function(t){t===cw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=qP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var K_e={inflate:$_e};const{deflate:q_e}=A_e,{inflate:Y_e}=K_e;var X_e=q_e,J_e=Y_e,y7=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(y7||{});class Q_e{constructor(){q(this,"_sequence",0),q(this,"_startTime",Date.now()),q(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const y={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=v,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;se("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const o=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(o),d=new DataView(o);let h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let o=0;const c=s.getUint16(o,!0);o+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(o+2,!0)<<16|s.getUint16(o,!0)};let h,m;if(o+=4,se("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(o,!0),o+=2,d.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let y=!1;if(m.datas.length>0){const v=m.datas.find(S=>S.id===0);v&&(y=(1&new DataView(v.data).getUint32(0,!0))==1)}h=y?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:o,datas:c}=r,d=new ArrayBuffer(o+2),h=new Uint8Array(d),m=new DataView(d);let y=0;if(m.setUint8(y++,s),m.setUint8(y++,o),c.forEach(v=>{s?(m.setUint8(y++,v.id),m.setUint8(y++,v.length),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength):(m.setUint8(y++,v.id|v.length<<4),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength)}),y!==o+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(o+2));return d}deserializeExtension(r){const s=new DataView(r);let o=0;const c=s.getUint8(o);o++;const d=s.getUint8(o);o++;const h=c===y7.TWO_BYTE,m=[],y=new DataView(r,2);let v=0;for(;v<d;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=y.getUint8(v),v++,R=y.getUint8(v),v++):(S=15&y.getUint8(v),R=y.getUint8(v)>>4,v++),R>0&&(P=y.buffer.slice(v+2,v+2+R),v+=P.byteLength),m.push({id:S,length:R,data:P})}if(v!==d)throw Error("parse error");return{profile:c,length:d,datas:m}}decompress(r){return J_e(new Uint8Array(r))}compress(r){return X_e(new Uint8Array(r))}}const Z_e={name:"DataStream",create:(t,r)=>{const s=r?new ome(t):new ame(t);return s.useDataStream(new Q_e),s}};class eye extends zr{constructor(r,s,o){super(),q(this,"ws",void 0),q(this,"requestId",1),q(this,"heartBeatTimer",void 0),q(this,"joinInfo",void 0),q(this,"clientId",void 0),q(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),q(this,"onClose",c=>{this.emit("close"),this.dispose()}),q(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=s,this.ws=new xT("cross-channel-".concat(this.clientId),o),this.ws.on(en.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(en.CONNECTED,this.onOpen),this.ws.on(en.ON_MESSAGE,this.onMessage),this.ws.on(en.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new ht((s,o)=>{const c=window.setTimeout(()=>{o(new Ae(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(c),d.state&&d.state!==0?o(new Ae(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Ae(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Ae(te.WS_DISCONNECT);const s=()=>new ht((h,m)=>{this.ws.once(en.CLOSED,()=>m(new Ae(te.WS_ABORT))),this.ws.once(en.CONNECTED,h)});this.ws.state!=="connected"&&await s();const o=this.sendMessage(r),c=new ht((h,m)=>{const y=()=>{m(new Ae(te.WS_ABORT))};this.ws.once(en.RECONNECTING,y),this.ws.once(en.CLOSED,y),this.once("req_".concat(o),h),gs(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(en.RECONNECTING,y),this.ws.off(en.CLOSED,y),m(new Ae(te.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new Ae(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(en.REQUEST_NEW_URLS),this.ws.on(en.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class tye extends zr{set state(r){r!==this._state&&(r!==Za.RELAY_STATE_FAILURE&&(this.errorCode=rS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,o,c,d){super(),q(this,"joinInfo",void 0),q(this,"sid",void 0),q(this,"clientId",void 0),q(this,"cancelToken",ba.CancelToken.source()),q(this,"workerToken",void 0),q(this,"requestId",0),q(this,"signal",void 0),q(this,"prevChannelMediaConfig",void 0),q(this,"httpRetryConfig",void 0),q(this,"_resolution",void 0),q(this,"_state",Za.RELAY_STATE_IDLE),q(this,"errorCode",rS.RELAY_OK),q(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",pf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",pf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=rS.SRC_TOKEN_EXPIRED,this.state=Za.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=rS.DEST_TOKEN_EXPIRED,this.state=Za.RELAY_STATE_FAILURE))}),q(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",pf.NETWORK_DISCONNECTED),this.state=Za.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Za.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=rS.SERVER_CONNECTION_LOST,this.state=Za.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=z_(),this.signal=new eye(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==Za.RELAY_STATE_IDLE)throw new Ae(te.INVALID_OPERATION);this.state=Za.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Ae(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Ae(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Ae(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Za.RELAY_STATE_RUNNING)throw new Ae(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Za.RELAY_STATE_RUNNING)throw new Ae(te.INVALID_OPERATION);const s=this.genMessage(Zo.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Za.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ba.CancelToken.source(),this.state=Za.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await dge(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",pf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(Zo.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(Zo.SetSdkProfile,r);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Zo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",pf.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(Zo.SetSourceUserId,r);await this.signal.request(d),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Zo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",pf.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Zo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",pf.PACKET_SENT_TO_DEST_CHANNEL),this.state=Za.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(Zo.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",pf.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Zo.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const o=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:zl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,y=null;switch(r){case Zo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Zo.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ae(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},h;case Zo.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ae(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:y.uid+""},h;case Zo.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Ae(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:d},h;case Zo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Zo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Zo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Zo.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Ae(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:d},h;case Zo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const nye={name:"ChannelMediaRelay",create:function(t){return new tye(t.joinInfo,t.clientId,t.websocketRetryConfig||Oi,t.httpRetryConfig||Oi,t.resolution)}};function E7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function lw(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?E7(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):E7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class rye extends zr{constructor(r,s,o,c){super(),q(this,"spec",void 0),q(this,"token",void 0),q(this,"websocket",void 0),q(this,"pingpongTimer",void 0),q(this,"reconnectMode","retry"),q(this,"serviceMode",void 0),q(this,"reqId",0),q(this,"commandReqId",0),q(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),q(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Ot.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===hf.TRANSCODE?1:2}),this.emit($m.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new xT("live-streaming",o),this.websocket.on(en.CONNECTED,this.handleWebSocketOpen),this.websocket.on(en.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(en.REQUEST_NEW_URLS,(d,h)=>{Us(this,$m.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(en.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Ae(te.UNEXPECTED_ERROR);const m=lw({command:r,sdkVersion:zl==="4.23.2"?"0.0.1":zl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Ae(te.WS_DISCONNECT);const y=()=>new ht((P,D)=>{this.websocket.once(en.CLOSED,()=>D(new Ae(te.WS_ABORT))),this.websocket.once(en.CONNECTED,P)});this.websocket.state!=="connected"&&await y(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new ht((P,D)=>{const G=()=>{D(new Ae(te.WS_ABORT))};this.websocket.once(en.RECONNECTING,G),this.websocket.once(en.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),j=>{P(j)})});c&&Ot.workerEvent(this.spec.sid,lw(lw({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await v}catch(P){if(this.websocket.state==="closed")throw P;return await y(),await this.request(r,s,o)}return c&&Ot.workerEvent(this.spec.sid,lw(lw({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=zl==="4.23.2"?"0.0.1":zl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Vi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Vi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Vi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Vi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Ae(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Vi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Ae(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Vi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Ae(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit($m.WARNING,s,r.serverResponse.url)}case Vi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Ae(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit($m.WARNING,s,r.serverResponse.url)}case Vi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Ae(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Vi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Ae(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit($m.WARNING,s,r.serverResponse.url)}case Vi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Vi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Vi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Ae(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(HA)},6e3)}}function v7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function ec(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?v7(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):v7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class iye extends zr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Oi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Oi;super(),q(this,"onLiveStreamWarning",void 0),q(this,"onLiveStreamError",void 0),q(this,"spec",void 0),q(this,"retryTimeout",1e4),q(this,"connection",void 0),q(this,"httpRetryConfig",void 0),q(this,"wsRetryConfig",void 0),q(this,"streamingTasks",new Map),q(this,"isStartingStreamingTask",!1),q(this,"taskMutex",new Ks("live-streaming")),q(this,"cancelToken",ba.CancelToken.source()),q(this,"transcodingConfig",void 0),q(this,"uapResponse",void 0),q(this,"lastTaskId",1),q(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=ec(ec({},Gme),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>ec(ec(ec({},Wme),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Kr(h.width)||ur(h.width,"config.width",0,1e4),Kr(h.height)||ur(h.height,"config.height",0,1e4),Kr(h.videoBitrate)||ur(h.videoBitrate,"config.videoBitrate",1,1e6),Kr(h.videoFrameRate)||ur(h.videoFrameRate,"config.videoFrameRate"),Kr(h.lowLatency)||cf(h.lowLatency,"config.lowLatency"),Kr(h.audioSampleRate)||Wi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Kr(h.audioBitrate)||ur(h.audioBitrate,"config.audioBitrate",1,128),Kr(h.audioChannels)||Wi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Kr(h.videoGop)||ur(h.videoGop,"config.videoGop"),Kr(h.videoCodecProfile)||Wi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Kr(h.userCount)||ur(h.userCount,"config.userCount",0,17),Kr(h.backgroundColor)||ur(h.backgroundColor,"config.backgroundColor",0,16777215),Kr(h.userConfigExtraInfo)||ms(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Kr(h.transcodingUsers)&&(lf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,y)=>{mP(m.uid),Kr(m.x)||ur(m.x,"transcodingUser[".concat(y,"].x"),0,1e4),Kr(m.y)||ur(m.y,"transcodingUser[".concat(y,"].y"),0,1e4),Kr(m.width)||ur(m.width,"transcodingUser[".concat(y,"].width"),0,1e4),Kr(m.height)||ur(m.height,"transcodingUser[".concat(y,"].height"),0,1e4),Kr(m.zOrder)||ur(m.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),Kr(m.alpha)||ur(m.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),Kr(h.watermark)||BL(h.watermark,"watermark"),Kr(h.backgroundImage)||BL(h.backgroundImage,"backgroundImage"),h.images&&!Kr(h.images)&&(lf(h.images,"config.images"),h.images.forEach((m,y)=>{BL(m,"images[".concat(y,"]"))}))}(s);const o=[];s.images&&o.push(...s.images.map(h=>ec(ec(ec({},jL),h),{},{zOrder:255}))),s.backgroundImage&&(o.push(ec(ec(ec({},jL),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(o.push(ec(ec(ec({},jL),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=o,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>ec({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?ht.resolve(h.uid):zH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ht.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(tl(d=this.streamingTasks).call(d)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)})})}}async startLiveStreamingTask(r,s,o){if(!this.transcodingConfig&&s===hf.TRANSCODE)throw new Ae(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const d=await this.taskMutex.lock();if(!this.connection&&o)return void d();if(this.streamingTasks.get(r)&&!o)return d(),new Ae(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw d(),m}switch(s){case hf.TRANSCODE:c.transcodingConfig=ec({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new ht((v,S)=>{gs(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),y=await ht.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===hf.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new ht((s,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Ae(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===hf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(o)})}resetAllTask(){var r;const s=Array.from(tl(r=this.streamingTasks).call(r));this.terminate();for(const o of s)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ba.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Ae(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Us(this,zL.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new rye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on($m.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on($m.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on($m.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Ae(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));Us(this,zL.REQUEST_WORKER_MANAGER_LIST,r).then(d=>{this.uapResponse=d,o(d.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Vi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Ae(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Vi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Ae(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Vi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(tl(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const sye={name:"LiveStreaming",create:function(t){return new iye(t.joinInfo,t.websocketRetryConfig||Oi,t.httpRetryConfig||Oi)}};function oye(t){let r=T7();return function(s,o){let c=s.appId;c!==void 0&&(nr(o,10),Yh(o,c));let d=s.cid;d!==void 0&&(nr(o,16),nr(o,d));let h=s.cname;h!==void 0&&(nr(o,26),Yh(o,h));let m=s.deviceId;m!==void 0&&(nr(o,34),Yh(o,m));let y=s.elapse;y!==void 0&&(nr(o,40),og(o,y));let v=s.fileSize;v!==void 0&&(nr(o,48),og(o,vS(v)));let S=s.height;S!==void 0&&(nr(o,56),og(o,vS(S)));let R=s.jpg;R!==void 0&&(nr(o,66),nr(o,R.length),function(Aa,We){let st=SS(Aa,We.length);Aa.bytes.set(We,st)}(o,R));let P=s.networkType;P!==void 0&&(nr(o,72),og(o,vS(P)));let D=s.osType;D!==void 0&&(nr(o,80),og(o,vS(D)));let G=s.requestId;G!==void 0&&(nr(o,90),Yh(o,G));let j=s.sdkVersion;j!==void 0&&(nr(o,98),Yh(o,j));let B=s.sequence;B!==void 0&&(nr(o,104),og(o,vS(B)));let J=s.sid;J!==void 0&&(nr(o,114),Yh(o,J));let ee=s.timestamp;ee!==void 0&&(nr(o,120),og(o,ee));let fe=s.uid;fe!==void 0&&(nr(o,128),nr(o,fe));let ye=s.vid;ye!==void 0&&(nr(o,136),nr(o,ye));let ve=s.width;ve!==void 0&&(nr(o,144),og(o,vS(ve)));let _e=s.service;_e!==void 0&&(nr(o,152),nr(o,_e));let Ne=s.callbackData;Ne!==void 0&&(nr(o,162),Yh(o,Ne));let Je=s.jpgEncryption;Je!==void 0&&(nr(o,168),nr(o,Je));let pt=s.requestType;pt!==void 0&&(nr(o,176),nr(o,pt));let _t=s.scorePorn;_t!==void 0&&(nr(o,185),G2(o,_t));let Rn=s.scoreSexy;Rn!==void 0&&(nr(o,193),G2(o,Rn));let In=s.scoreNeutral;In!==void 0&&(nr(o,201),G2(o,In));let yr=s.scene;yr!==void 0&&(nr(o,208),nr(o,yr));let di=s.ossFilePrefix;di!==void 0&&(nr(o,218),Yh(o,di));let Zr=s.serviceVendor;if(Zr!==void 0)for(let Aa of Zr){nr(o,226);let We=T7();lye(Aa,We),nr(o,We.limit),pye(o,We),hye(We)}}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function aye(t){return function(s){let o={};e:for(;!w7(s);){let c=Xh(s);switch(c>>>3){case 0:break e;case 1:o.code=Xh(s);break;case 2:o.msg=C7(s,Xh(s));break;case 3:{let d=uye(s);o.data=cye(s),s.limit=d;break}default:S7(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function cye(t){let r={};e:for(;!w7(t);){let s=Xh(t);switch(s>>>3){case 0:break e;case 1:r.requestId=C7(t,Xh(t));break;case 2:r.requestType=Xh(t)>>>0;break;case 3:r.scorePorn=W2(t);break;case 4:r.scoreSexy=W2(t);break;case 5:r.scoreNeutral=W2(t);break;case 6:r.requestScene=Xh(t)>>>0;break;case 7:r.scene=Xh(t)>>>0;break;default:S7(t,7&s)}}return r}function lye(t,r){let s=t.service;s!==void 0&&(nr(r,8),nr(r,s));let o=t.vendor;o!==void 0&&(nr(r,16),nr(r,o));let c=t.token;c!==void 0&&(nr(r,26),Yh(r,c));let d=t.callbackUrl;d!==void 0&&(nr(r,34),Yh(r,d))}function uye(t){let r=Xh(t),s=t.limit;return t.limit=t.offset+r,s}function S7(t,r){switch(r){case 0:for(;128&R7(t););break;case 2:B2(t,Xh(t));break;case 5:B2(t,4);break;case 1:B2(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let dye=new Float32Array(1);new Uint8Array(dye.buffer);let j2=new Float64Array(1),tc=new Uint8Array(j2.buffer);function vS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let b7=[];function T7(){const t=b7.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function hye(t){b7.push(t)}function B2(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function w7(t){return t.offset>=t.limit}function SS(t,r){let s=t.bytes,o=t.offset,c=t.limit,d=o+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),o}function z2(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function C7(t,r){let s=z2(t,r),o=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let y,v,S,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=d:(y=c[m+s+1],(192&y)!=128?h+=d:(R=(31&P)<<6|63&y,R<128?h+=d:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=d:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=d:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],S=c[m+s+3],(12632256&(y|v<<8|S<<16))!=8421504?h+=d:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&S,R<65536||R>1114111?h+=d:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=d}return h}function Yh(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}nr(t,o);let c=SS(t,o),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function pye(t,r){let s=SS(t,r.limit),o=t.bytes,c=r.bytes;for(let d=0,h=r.limit;d<h;d++)o[d+s]=c[d]}function R7(t){return t.bytes[z2(t,1)]}function I7(t,r){let s=SS(t,1);t.bytes[s]=r}function W2(t){let r=z2(t,8),s=t.bytes;return tc[0]=s[r++],tc[1]=s[r++],tc[2]=s[r++],tc[3]=s[r++],tc[4]=s[r++],tc[5]=s[r++],tc[6]=s[r++],tc[7]=s[r++],j2[0]}function G2(t,r){let s=SS(t,8),o=t.bytes;j2[0]=r,o[s++]=tc[0],o[s++]=tc[1],o[s++]=tc[2],o[s++]=tc[3],o[s++]=tc[4],o[s++]=tc[5],o[s++]=tc[6],o[s++]=tc[7]}function Xh(t){let r,s=0,o=0;do r=R7(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function nr(t,r){for(r>>>=0;r>=128;)I7(t,127&r|128),r>>>=7;I7(t,r)}function og(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=SS(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=d!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=d!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=d!==5?128|o:127&o;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}function A7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const fye=new Map([["moderation",1],["supervise",2]]);class mye extends zr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(hs.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Ec(s=r.map(o=>fye.get(o)||0)).call(s,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),q(this,"name","AgoraRTCVideoContentInspect"),q(this,"_connectionState",Uu.CONNECTING),q(this,"_innerConnectionState",void 0),q(this,"sequence",0),q(this,"inspectStartTime",void 0),q(this,"workerManagerConnection",void 0),q(this,"workerConnection",void 0),q(this,"workerMessageLengthLimit",void 0),q(this,"inspectIntervalMinimum",void 0),q(this,"qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",ba.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"wmSequence",0),q(this,"inspectInterval",void 0),q(this,"inspectTimer",null),q(this,"ossFilePrefix",void 0),q(this,"extraInfo",void 0),q(this,"_inspectType",void 0),q(this,"_inspectMode",void 0),q(this,"_quality",1),q(this,"qualityTimer",null),q(this,"_inspectId",void 0),q(this,"_needWorkUrlOnly",!1),q(this,"inspectImage",()=>{if(this.connectionState!==Uu.CONNECTED)throw new Ae(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Uu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=gr(5,"inspect-"),this.workerMessageLengthLimit=se("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=se("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=se("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new xT("worker-manager-"+this._inspectId,Oi),this.on(hs.STATE_CHANGE,(s,o)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Vu[s]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new xT("worker-"+this._inspectId,Oi),this.handleWorkerEvents()}async init(r,s){this.emit(hs.STATE_CHANGE,Vu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new ht((c,d)=>{this.on(hs.CONNECTION_STATE_CHANGE,(h,m)=>{m===Uu.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(r,s,o){const c=se("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,y,v,S){let{appId:R,areaCode:P,cname:D,sid:G,token:j,uid:B}=y;uS++;const J="image_moderation_api",ee={service_name:J,json_body:JSON.stringify({appId:R,areaCode:P,cname:D,command:"allocateEdge",requestId:uS,seq:uS,sid:G,token:j,ts:Date.now(),uid:B+""})};let fe,ye,ve=m[0];return xd(async()=>{fe=Date.now();const _e=await Fd(ve,{data:ee,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-fe,_e.code!==0){const _t=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+_e.code,{retry:!0,responseTime:ye});throw x.error(_t.toString()),_t}const Ne=JSON.parse(_e.json_body);if(Ne.code!==200){const _t=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:ye});throw x.error(_t.toString()),_t}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const _t=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:ye});throw x.error(_t.toString()),_t}const Je=se("VIDEO_INSPECT_WORKER_MANAGER_HOST"),pt=se("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(_t=>{let{address:Rn,wss:In}=_t;if(Rn&&In)return"wss://".concat(Rn.replace(/\./g,"-"),".").concat(Je,":").concat(pt||In)}).filter(_t=>!!_t),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:ye}},(_e,Ne)=>(Ot.apworkerEvent(G,{success:!0,sc:200,serviceName:J,responseDetail:JSON.stringify(_e.addressList),firstSuccess:Ne===0,responseTime:ye,serverIp:m[Ne%m.length]}),!1),(_e,Ne)=>(Ot.apworkerEvent(G,{success:!1,sc:_e.data&&_e.data.code||200,serviceName:J,responseTime:ye,serverIp:m[Ne%m.length]}),!!(_e.code!==te.OPERATION_ABORTED&&_e.code!==te.UNEXPECTED_RESPONSE||_e.data&&_e.data.retry)&&(ve=m[(Ne+1)%m.length],!0)),S)}(c,r,s,o);this.emit(hs.STATE_CHANGE,Vu.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(hs.STATE_CHANGE,Vu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(en.CONNECTED,async()=>{this.emit(hs.STATE_CHANGE,Vu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(en.CLOSED,()=>{this._innerConnectionState<Vu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(en.FAILED,()=>{this._innerConnectionState<Vu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(en.RECONNECTING,()=>{this._innerConnectionState<Vu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(en.ON_MESSAGE,async r=>{this.emit(hs.STATE_CHANGE,Vu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Ae(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Ae(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=se("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(hs.STATE_CHANGE,Vu.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(hs.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(en.WILL_RECONNECT,(r,s,o)=>{o(r)}),this.workerManagerConnection.on(en.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(en.CONNECTED,async()=>{this.emit(hs.STATE_CHANGE,Vu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Uu.CONNECTED}),this.workerConnection.on(en.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=aye(new Uint8Array(r.data));if(se("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(hs.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var s;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},d=Ec(s=Object.keys(c)).call(s,(m,y)=>c[m]>c[y]?m:y,"porn"),h=Object.keys(c).find(m=>m===d);this.emit(hs.INSPECT_RESULT,h)}else this.emit(hs.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(hs.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(hs.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(en.CLOSED,()=>{this.connectionState=Uu.CLOSED}),this.workerConnection.on(en.FAILED,()=>{this.connectionState=Uu.CLOSED}),this.workerConnection.on(en.RECONNECTING,()=>{this.connectionState=this.connectionState===Uu.CONNECTED?Uu.RECONNECTING:Uu.CONNECTING}),this.workerConnection.on(en.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(en.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(hs.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{s(o)})})}async requestToInspectImage(){this.sequence++;const r=rl(this,hs.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(hs.INSPECT_RESULT,void 0,new Ae(te.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,s);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(hs.INSPECT_RESULT,void 0,new Ae(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:o,cname:c,cid:d,vid:h,sid:m,uid:y}=s;const v=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await l8(S,o,c),P=this.sequence+"-"+d+"-"+y+"-"+v+"-"+gr(12,""),D={appId:o,cid:d,cname:c,deviceId:"",elapse:(G=Number(v-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:M9(v),uid:y,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const j=oye(D);if(j.byteLength<this.workerMessageLengthLimit){if(se("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const B=function(J){for(var ee=1;ee<arguments.length;ee++){var fe=arguments[ee]!=null?arguments[ee]:{};ee%2?A7(Object(fe),!0).forEach(function(ye){q(J,ye,fe[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(fe)):A7(Object(fe)).forEach(function(ye){Object.defineProperty(J,ye,Object.getOwnPropertyDescriptor(fe,ye))})}return J}({},D);delete B.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(B))}return j}{const B=this.quality*this.qualityRatio;return this.quality=B,await this.generateRequestData(r,{appId:o,cname:c,cid:d,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ba.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Uu.CLOSED,this.emit(hs.STATE_CHANGE,Vu.CLOSED)}}const gye={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Ae(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Ae(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(s.inspectType)];o.forEach(c=>{var d;if(!ot(d=["supervise","moderation"]).call(d,c))throw new Ae(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=o}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Ae(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new mye(r)}};var P7=l(vt.Object.getOwnPropertySymbols),_ye=Gn,yye=ga.indexOf,Eye=xp,H2=ie([].indexOf),O7=!!H2&&1/H2([1],1,-0)<0;_ye({target:"Array",proto:!0,forced:O7||!Eye("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return O7?H2(this,t,r)||0:yye(this,t,r)}});var vye=yc("Array").indexOf,Sye=O,bye=vye,$2=Array.prototype,Tye=function(t){var r=t.indexOf;return t===$2||Sye($2,t)&&r===$2.indexOf?bye:r},k7=l(Tye);function wye(t,r){if(t==null)return{};var s,o,c=function(h,m){if(h==null)return{};var y,v,S={},R=JG(h);for(v=0;v<R.length;v++)y=R[v],k7(m).call(m,y)>=0||(S[y]=h[y]);return S}(t,r);if(P7){var d=P7(t);for(o=0;o<d.length;o++)s=d[o],k7(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let N7=class{get localCapabilities(){return Yr(this._localCapabilities)}get rtpCapabilities(){return Yr(this._rtpCapabilities)}get candidates(){return Yr(this._candidates)}get iceParameters(){return Yr(this._iceParameters)}get dtlsParameters(){return Yr(this._dtlsParameters)}constructor(t){q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_iceParameters",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname","o/i14u9pJrxRKAsu"),q(this,"firefoxSsrcMidMap",new Map),t=Yr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:o,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:m,videoCodec:y,audioCodec:v}=t;let S;this.setup=m,S=h===Qo.RECEIVE_ONLY?Qa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Qa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=d;const R=h===Qo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Qo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=h===Qo.RECEIVE_ONLY?c.send.videoCodecs:UT(Tt.VIDEO,R,P,y),G=h===Qo.RECEIVE_ONLY?c.send.audioCodecs:UT(Tt.AUDIO,R,P,v);for(const j of S.mediaDescriptions)j.attributes.iceUfrag=r.iceUfrag,j.attributes.icePwd=r.icePwd,j.attributes.fingerprints=s.fingerprints,j.attributes.candidates=o,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video"&&(j.media.fmts=D.map(B=>B.payloadType.toString(10)),j.attributes.payloads=D,j.attributes.extmaps=R.videoExtensions),j.media.mediaType==="audio"&&(j.media.fmts=G.map(B=>B.payloadType.toString(10)),j.attributes.payloads=G,j.attributes.extmaps=R.audioExtensions,lS(j));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Hm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,o,c){s=s.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=J_(r,this.cname,se("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(d);if(m){if($r()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(t,d,o);let v;return y===-1?(v=this.createOrRecycleSendMedia(t,d,h,"sendonly",o,c),this.updateBundleMids()):(v=Yr(this.sessionDesc.mediaDescriptions[y]),v.attributes.direction="sendonly",v.attributes.ssrcs=d,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,c)),$r()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const o=[];return t.forEach(c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let m,y=!1;h===-1?(y=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Yr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:y})}),o}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:o,port:c,type:d,relatedAddress:h,relatedPort:m,priority:y}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:o??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===v.priority&&S.connectionAddress===v.connectionAddress&&S.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,o,c){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=UT(d,h,this.localCapabilities.send,d===Tt.AUDIO?c:o),y=d===Tt.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let S={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};S=this.mungRecvMediaDsec(S,t);const R=this.findFirstClosedMedia(d);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>ot(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>ot(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===t&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if($r()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!d||d!==o.attributes.mid)}return!1}return c&&o.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=Yr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,o,c,d){const h=this.rtpCapabilities.send,m=t===Tt.VIDEO?h.videoCodecs:h.audioCodecs,y=t===Tt.VIDEO?h.videoExtensions:h.audioExtensions;$r()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,d);const S=this.findFirstClosedMedia(t);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,s){const o=Yr(t);return KL(o),cS(o,r),qL(o,r),bH(o),bP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(t,r){const s=Yr(t);return bP(s,r,this.localCapabilities.recv),lS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>$r()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const Cye=["sdp"];var wr;function D7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function ag(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?D7(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):D7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let x7=(wr=class xS extends rH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,o){super(r,s),q(this,"direction",void 0),q(this,"name",void 0),q(this,"store",void 0),q(this,"spec",void 0),q(this,"peerConnection",void 0),q(this,"initialOffer",void 0),q(this,"transport",void 0),q(this,"statsFilter",void 0),q(this,"localCandidateCount",0),q(this,"_isInRestartIce",!1),q(this,"mutex",void 0),q(this,"onLocalCandidate",void 0),q(this,"remoteSDP",void 0),q(this,"pendingCandidates",[]),q(this,"localCapabilities",void 0),q(this,"isReady",!1),q(this,"restartCnt",0),q(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Ks("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(xS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Qo.SEND_ONLY,this.name=this.direction===Qo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=aL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,$r()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await wH();if(this.localCapabilities=TP(s),r){const{sdp:o}=r,c=wye(r,Cye),d=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=MT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Fu(R,S,"videoExtensions",P,D,G),Fu(R,S,"videoCodecs",P,D,G),Fu(R,S,"audioExtensions",P,D,G),Fu(R,S,"audioCodecs",P,D,G),se("RAISE_H264_BASELINE_PRIORITY")){const j=G.videoCodecs.findIndex(B=>B.rtpMap&&B.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&B.fmtp&&B.fmtp.parameters["profile-level-id"]==="42001f");if(j!==-1){const B=G.videoCodecs.findIndex(J=>J.rtpMap&&J.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(B<j){x.debug("raising H264 baseline profile priority");const J=G.videoCodecs[j];G.videoCodecs.splice(j,1),G.videoCodecs.splice(B,0,J)}B!==-1&&se("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(J=>!(J.rtpMap&&J.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&J.fmtp&&J.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:D,sendrecv:G}}({},{},o);this.remoteSDP=new N7({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Xm(h.sdp);await this.peerConnection.setLocalDescription(h);const y=await CH({},{},h.sdp);this.localCapabilities=TP(y);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),ag(ag({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Xm(o.sdp);return this.initialOffer=o,ag(ag({},c),{},{sdp:o.sdp})}}catch(s){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:o,dtlsParameters:c}=r,d=await CH({},{},s);this.remoteSDP=new N7({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return Bl(function*(){const d=yield Dn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,o);r.forEach((B,J)=>{if(m[J].needCreateTransceiver){const ee=c.peerConnection.addTransceiver(B._mediaStreamTrack,{direction:"sendonly"});h.push(ee),B._updateRtpTransceiver(ee)}else{const ee=c.peerConnection.getTransceivers().find(fe=>fe.mid===m[J].mid);if(!ee)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[J].mid));h.push(ee),B._updateRtpTransceiver(ee)}}),$r()&&se("SIMULCAST")===!0&&(yield Dn(c.applySimulcastForFirefox(h,r)));const y=m.map(B=>B.mid),v=yield Dn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(v.sdp,r,y),R=Qa(S),P=y.map(B=>{const J=R.mediaDescriptions.find(ee=>ee.attributes.mid===B);if(!J)throw new Error("Cannot extract ssrc from mediaDescription.");return EH(J,se("USE_PUB_RTX"))}),D=h.map((B,J)=>{const ee=y[J];return{localSSRC:P[J],id:ee}});yield Dn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield D}catch(B){const J=c.remoteSDP.toString();throw yield Dn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Dn(c.peerConnection.setRemoteDescription({type:"answer",sdp:J})),yield Dn(c.stopSending(y,!0)),B}yield Dn(c.applySimulcastEncodings(h,r)),yield Dn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),j=c.logSDPExchange(S,"offer","local","send");return j==null||j(G),yield Dn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((B,J)=>{const ee=y[J];return{localSSRC:P[J],id:ee}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(y=>{var v;y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const y=this.remoteSDP.toString(),v=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,d,r);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(y=>y.mid===d);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const m=this.remoteSDP.toString(),y=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(v.sdp,d,r);y==null||y(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===W_.Auto&&(this.store.p2pTransport=W_.SdRtn,jn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,jn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Xm(s.sdp);return this.store.descriptionStart(),this.direction===Qo.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Qo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Xm(s.sdp);return await this.peerConnection.setLocalDescription(s),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new Le(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?$r()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:ag(ag({},Mh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:ag(ag({},Mh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;ot(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(TT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...xS.turnServerConfigToIceServers(r.turnServer.servers,s,o)),se("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...xS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,o)),ot(d=[W_.Relay,W_.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),se("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),se("ENABLE_ENCODED_TRANSFORM")&&jn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(o));const h=d.length>o?d[o]:d[0];switch(s){case W_.SdRtn:const m=r.filter(v=>{var S;return ot(S=v.username).call(S,"glb:")&&v.turnServerURL==v.turnServerURL}),y=m.length>o?m[o]:m[0];y&&(c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(qm(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(qm(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case W_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(qm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(qm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:o,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(d.maxBitrate=1e3*S),ot(h=r._hints).call(h,_r.LOW_STREAM)&&(R&&(d.maxFramerate=Ic(R)),P&&P>=1&&(d.scaleResolutionDownBy=P))}if(se("DSCP_TYPE")&&af()){var m;const S=se("DSCP_TYPE");ot(m=["very-low","low","medium","high"]).call(m,S)&&(d.networkPriority=S)}const y=s.getParameters(),v=(o=y.encodings)===null||o===void 0?void 0:o[0];$r()&&!v&&(c.encodings=[d]),v&&Object.assign(v,d),Object.assign(y,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],d=s[o];d instanceof Ar&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Qa(r);return s.forEach((d,h)=>{const m=o[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(cS(y,d),TH(y,d,this.store.codec))}),Hm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var o,c,d,h,m;const v=r[y],S=s[y];if(S instanceof Ar&&!ot(o=S._hints).call(o,_r.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=S._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!$r()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Ar&&this.isVP8Simulcast(c)){const d=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=d.sender.getParameters();await d.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,o,c,d,h;return!!(r instanceof Ar&&se("SIMULCAST")&&this.store.codec==="vp8"&&!ot(s=r._hints).call(s,_r.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(se("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var o,c;if(s=(o=s)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var d;const h=(d=Qa(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||d===void 0?void 0:d.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),ot(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,o){const c=Qa(r),d=c.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&o===Tt.AUDIO&&d.media.mediaType==="audio"&&lS(d),Hm(c)}},Rt(wr.prototype,"establish",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"establish"),wr.prototype),Rt(wr.prototype,"connect",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"connect"),wr.prototype),Rt(wr.prototype,"receive",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"receive"),wr.prototype),Rt(wr.prototype,"mockReceive",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"mockReceive"),wr.prototype),Rt(wr.prototype,"stopReceiving",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"stopReceiving"),wr.prototype),Rt(wr.prototype,"restartICE",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"restartICE"),wr.prototype),Rt(wr.prototype,"close",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"close"),wr.prototype),Rt(wr.prototype,"updateEncoderConfig",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"updateEncoderConfig"),wr.prototype),Rt(wr.prototype,"updateSendParameters",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"updateSendParameters"),wr.prototype),Rt(wr.prototype,"replaceTrack",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"replaceTrack"),wr.prototype),Rt(wr.prototype,"muteLocal",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"muteLocal"),wr.prototype),Rt(wr.prototype,"unmuteLocal",[Gu],Object.getOwnPropertyDescriptor(wr.prototype,"unmuteLocal"),wr.prototype),wr);function Gu(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{d()}},s}let Bd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var L7,M7,U7,V7,F7,j7,B7,z7,W7,G7,H7,Fr;function $7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function sO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$7(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let Rye=(L7=zd(Bd.SEND_ONLY),M7=zd(Bd.SEND_ONLY),U7=zd(),V7=zd(Bd.RECEIVE_ONLY),F7=zd(Bd.RECEIVE_ONLY),j7=zd(Bd.RECEIVE_ONLY),B7=zd(Bd.RECEIVE_ONLY),z7=zd(Bd.RECEIVE_ONLY),W7=zd(Bd.RECEIVE_ONLY),G7=zd(),H7=zd(Bd.RECEIVE_ONLY),Fr=class extends zr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Vt.StateChange,r,this._state)}constructor(t,r){super(),q(this,"isPlanB",!1),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"sendConnection",void 0),q(this,"recvConnection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"statsCollector",void 0),q(this,"dtlsFailedCount",0),q(this,"sendMutex",void 0),q(this,"recvMutex",void 0),q(this,"_state",Jn.Disconnected),q(this,"_restartStates",["disconnected","failed"]),q(this,"reconnectInterval",void 0),q(this,"uploadUnplinkStarted",!1),q(this,"uploadDownlinkStarted",!1),q(this,"uplinkStateUploadInterval",void 0),q(this,"downlinkStatsUploadInterval",void 0),q(this,"handleMuteLocalTrack",async(s,o,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Jn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void o();const v=y.find(D=>D[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(D=>{let[,{id:G}]=D;return G}));let S=!1;var h,m;s.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Ye.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Ye.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(y);await mr(this,Vt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?Km.MUTE_LOCAL_VIDEO:Km.MUTE_LOCAL_AUDIO;await mr(this,Vt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),o()}catch(y){c(y)}finally{d()}}),q(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Jn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const m=this.createUnmuteMessage(h),y=s.trackMediaType==="video"?Km.UNMUTE_LOCAL_VIDEO:Km.UNMUTE_LOCAL_AUDIO;await mr(this,Vt.RequestP2PMuteLocal,{action:y,message:m}),o()}catch(h){c(h)}finally{d()}}),q(this,"handleUpdateVideoEncoder",async(s,o,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==Jn.Connected)return void o();const{id:v,track:S}=y;v&&(await this.sendConnection.updateSendParameters(v,S),await this.sendConnection.updateEncoderConfig(v,S),this.emit(Vt.UpdateVideoEncoder,S)),o()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Jn.Connected)return void o();const{id:m,track:y}=h;m&&await this.sendConnection.updateSendParameters(m,y),o()}catch(h){c(h)}finally{d()}}),q(this,"handleReplaceTrack",async(s,o,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Jn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),v[0]===Ye.LocalVideoTrack&&jn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ht((P,D)=>{this.handleReplaceTrack(S.track,P,D,!0)})}}o()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new u9(t),this.bindStatsUploaderEvents(),this.sendMutex=new Ks("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Ks("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},se("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new x7(t,this.store,Qo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Jn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new x7(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jn.Connected}async addRemoteCandidate(t,r){if(r===Qo.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var o=this;return Bl(function*(){const c=yield Dn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Jn.Connected){o.throwIfTrackTypeNotMatch(t);const v=t.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(v))}o.store.pubId=o.store.pubId+1,Xs.markPublishStart(o.store.clientId,o.store.pubId);const d=o.filterTobePublishedTracks(t,r,s);if(d.length===0)return void(yield Dn(o.tryToUnmuteAudio(t)));d.forEach(v=>{let{track:S,type:R}=v;const P=Date.now();o.store.publish(S.getTrackId(),R===Ye.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(d);const h=yield Dn(o.sendConnection.send(d.map(v=>{let{track:S}=v;return S}),o.store.codec,o.store.audioCodec)),m=(yield Dn(h.next())).value,y=o.createGatewayPublishMessage(d,m);try{yield y}catch(v){throw h.throw(v),(v==null?void 0:v.code)===te.WS_ABORT&&d.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(d),v}yield Dn(h.next()),d.forEach(v=>{let{type:S}=v;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(d,m),d.forEach(v=>{let{track:S,type:R}=v;const P=Date.now();o.store.publish(S.getTrackId(),R===Ye.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Jn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ot(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),r.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Jn.Connected)return s&&s[1].track.close(),o;t.forEach(c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:d,ssrcs:h}]=o;const m={stream_type:_ge(d,c),ssrcs:h};d._muted||!d._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(o=>{mr(this,Vt.RequestMuteLocal,[o])}),s.length>0&&s.forEach(o=>{mr(this,Vt.RequestUnmuteLocal,[o])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Bl(function*(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Us(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,o){var c;if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),o);r===Tt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new eS(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new Zv(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const y=this.remoteUserMap.get(t);y?y.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===t.uid&&r===P});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Vt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,o){if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),o)}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:m}=d;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(o.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||o.forEach(d=>{let{kind:h}=d;var m;if(h===Tt.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===Tt.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:m}]=d;var y,v;if(m===Tt.VIDEO&&h._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Tt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(m===Tt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;mr(this,Vt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[Tt.VIDEO,Tt.AUDIO].forEach(o=>{s.has(o)?mr(this,Vt.RequestP2PUnmuteRemote,o):mr(this,Vt.RequestP2PMuteRemote,o)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===Tt.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Ye.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ui){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ye.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===Ye.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===Ye.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get(Ye.LocalAudioTrack),m=o?this.localTrackMap.get(Ye.LocalVideoLowTrack):this.localTrackMap.get(Ye.LocalVideoTrack);Ot.publish(this.store.sessionId,{eventElapse:Xs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(y=>y instanceof Qr),m=o?(d=this.localTrackMap.get(Ye.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(y=>y instanceof Ar);Ot.publish(this.store.sessionId,{eventElapse:Xs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===Tt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Ot.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===Tt.VIDEO,audio:o===Tt.AUDIO,peerid:s.uid,subscribeRequestid:o===Tt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Xs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ks("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ks("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ye.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ui){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Jn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ye.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ye.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Ar||r&&r.track instanceof Qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(sl(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ye.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=aT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Jn.Reconnecting,se("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case Ye.LocalVideoTrack:ot(r=o._hints).call(r,_r.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ye.LocalAudioTrack:o instanceof Ui?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ye.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(sl(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Vt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Qm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,o;if(t===Qo.SEND_ONLY){if(!this.sendConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const d=await Us(this,Vt.RequestP2PRestartICE,{direction:Qo.RECEIVE_ONLY,iceParameter:c});await o.restartICE(d),o.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalAudioTrack),o=t.videoSend.find(D=>{var G;return D.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(D=>{var G;return D.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!o||!c)return 1;const d=rl(this,Vt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&d?(y+d)/2:y||d)||0,S=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(_r.SCREEN_TRACK)===-1){const D=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(D&&G){const j=(1e3*D-G)/(1e3*D);return qG[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,d=o._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const y=rl(this,Vt.NeedSignalRTT),v=t.rtt,S=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let D=.7*P*100/50+.3*S/1500;R&&(D=.6*P*100/50+.2*S/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new ht((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const o=[],c=jn(),d=this.getAllTracks();t=jv(t=t.filter(y=>d.indexOf(y)===-1));let h=!1,m=!1;for(const y of t){if(y instanceof Ar&&(this.localTrackMap.has(Ye.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:Ye.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);o.push({track:v,type:Ye.LocalVideoLowTrack})}if(y instanceof Qr){const v=this.localTrackMap.get(Ye.LocalAudioTrack);if(v){if(!(v.track instanceof Ui))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(m){const S=o.find(R=>{let{type:P}=R;return P===Ye.LocalAudioTrack});if(!(S.track instanceof Ui))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(y)}else{if(!c.webAudioMediaStreamDest||y instanceof Ui||y._bypassWebAudio)o.push({track:y,type:Ye.LocalAudioTrack});else{const S=new Ui;S.addAudioTrack(y),o.push({track:S,type:Ye.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=jv(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof Qr){const c=this.localTrackMap.get(Ye.LocalAudioTrack);if(!c)continue;c.track instanceof Ui?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ye.LocalAudioTrack,c]),c.track.close())):r.push([Ye.LocalAudioTrack,c])}if(o instanceof Ar){const c=this.localTrackMap.get(Ye.LocalVideoTrack);if(!c)continue;r.push([Ye.LocalVideoTrack,c]);const d=this.localTrackMap.get(Ye.LocalVideoLowTrack);d&&r.push([Ye.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ye.LocalVideoTrack:s.addListener(Ct.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Ui?t.trackList.forEach(s=>{s.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ct.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ct.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ye.LocalVideoTrack:s.off(Ct.GET_STATS,this.handleGetLocalVideoStats),s.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Ui?t.trackList.forEach(r=>{r.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ct.GET_STATS,this.handleGetLocalAudioStats),r.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ct.GET_STATS,this.handleGetLocalAudioStats),t.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Zv&&r.addListener(Ct.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof eS&&r.addListener(Ct.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ct.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(Tt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Tt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let d,{track:h,type:m}=s;switch(m){case Ye.LocalAudioTrack:d=Zn.Audio;break;case Ye.LocalVideoTrack:d=ot(c=h._hints).call(c,_r.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:d=Zn.Low}return{kind:m===Ye.LocalAudioTrack?Tt.AUDIO:Tt.VIDEO,stream_type:d,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalVideoTrack:o=ot(s=d._hints).call(s,_r.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalAudioTrack:o=Zn.Audio;break;case Ye.LocalVideoLowTrack:o=Zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Vt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),ot(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await gs(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Ot.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:qr.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(sl(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(qv.FIRST_FRAME_DECODED),Ot.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,Ur.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Xs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(sl(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Ot.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,Ur.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Xs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(sl(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Ot.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,Ur.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Xs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(Vt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ym(s))," -> ").concat(JSON.stringify(Ym(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ym(s))," -> ").concat(JSON.stringify(Ym(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Vt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Qo.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Qo.SEND_ONLY?this.restartICE(t):Us(this,Vt.RequestP2PRestartICE,{direction:Qo.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ye.LocalAudioTrack);if(t instanceof Qr&&(s==null?void 0:s.track)instanceof Ui)return s.track.isActive||r.push([Ye.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(o&&(r.push(o),o[0]===Ye.LocalVideoTrack)){const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ye.LocalAudioTrack);if(t instanceof Qr&&(s==null?void 0:s.track)instanceof Ui)return s.track.isActive&&r.push([Ye.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(o)if(o[0]===Ye.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:o=Zn.Audio;break;case Ye.LocalVideoTrack:o=ot(s=d._hints).call(s,_r.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:o=Zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:o=Zn.Audio;break;case Ye.LocalVideoTrack:o=ot(s=d._hints).call(s,_r.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:o=Zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:d}]=s;switch(c){case Tt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:Tt.VIDEO,ssrcId:o._videoSSRC}));case Tt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:Tt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new ht((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new ht((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Qr){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const o=this.createUnmuteMessage(s);return void await mr(this,Vt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Vt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await gs(tL(this.dtlsFailedCount,Oi)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ye.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Ar)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Ar).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Qr).length>1&&(t.some(r=>r instanceof Qr&&r._bypassWebAudio)||!jn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Ar&&this.pendingLocalTracks.some(s=>s instanceof Ar))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Qr&&this.pendingLocalTracks.some(s=>s instanceof Qr)&&(!jn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Qr&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding,o=sO(sO({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():u2(t,o);const d=gr(8,"track-low-"),h=new Ar(c,sO(sO({},s&&{scaleResolutionDownBy:$L(o,t)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,d);return h.on(G_.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,$v.LOW_STREAM)}),h._hints.push(_r.LOW_STREAM),t.addListener(Ct.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,o){var c;const d=Array.from(sl(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){o||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===d.uid&&y.type==="video");Ot.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,Ur.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Xs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async preConnect(t){throw new Le(te.NOT_SUPPORTED)}getEstablishParams(){throw new Le(te.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(te.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new Le(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ye.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,$v.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Rt(Fr.prototype,"p2pConnect",[L7],Object.getOwnPropertyDescriptor(Fr.prototype,"p2pConnect"),Fr.prototype),Rt(Fr.prototype,"unpublish",[M7],Object.getOwnPropertyDescriptor(Fr.prototype,"unpublish"),Fr.prototype),Rt(Fr.prototype,"unpublishLowStream",[U7],Object.getOwnPropertyDescriptor(Fr.prototype,"unpublishLowStream"),Fr.prototype),Rt(Fr.prototype,"subscribe",[V7],Object.getOwnPropertyDescriptor(Fr.prototype,"subscribe"),Fr.prototype),Rt(Fr.prototype,"mockSubscribe",[F7],Object.getOwnPropertyDescriptor(Fr.prototype,"mockSubscribe"),Fr.prototype),Rt(Fr.prototype,"unsubscribe",[j7],Object.getOwnPropertyDescriptor(Fr.prototype,"unsubscribe"),Fr.prototype),Rt(Fr.prototype,"muteRemote",[B7],Object.getOwnPropertyDescriptor(Fr.prototype,"muteRemote"),Fr.prototype),Rt(Fr.prototype,"unmuteRemote",[z7],Object.getOwnPropertyDescriptor(Fr.prototype,"unmuteRemote"),Fr.prototype),Rt(Fr.prototype,"hasRemoteMediaWithLock",[W7],Object.getOwnPropertyDescriptor(Fr.prototype,"hasRemoteMediaWithLock"),Fr.prototype),Rt(Fr.prototype,"disconnectForReconnect",[G7],Object.getOwnPropertyDescriptor(Fr.prototype,"disconnectForReconnect"),Fr.prototype),Rt(Fr.prototype,"remoteMediaSsrcChanged",[H7],Object.getOwnPropertyDescriptor(Fr.prototype,"remoteMediaSsrcChanged"),Fr.prototype),Fr);function zd(t){return function(r,s,o){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];switch(t){case Bd.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}case Bd.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),v=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y(),v()}}}},o}}class dy extends zr{constructor(r,s){super(),q(this,"signal",void 0),q(this,"token",void 0),q(this,"tokenTimeout",void 0),q(this,"tokenInterval",void 0),q(this,"_sequence",0),q(this,"userMap",new Map),q(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const o=()=>{this.signal.connectionState===Er.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*se("P2P_TOKEN_INTERVAL"))};o()}async send(r,s,o,c,d){var h,m,y;if(this.userMap.size===0)return;const v=Array.from(tl(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:gr(6,""),d=(y=d)!==null&&y!==void 0?y:this._sequence++;const S={_id:c,_type:r,_seq:d,_message:s,token:"".concat(this.token,"_").concat(v)};se("SHOW_P2P_LOG")&&x.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(Kt.DATA_STREAM,{payload:Gm(this.encoder.encode(P))})});const R=new ht((P,D)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),J),this.off(sS.ABORT,B),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?D(new Le(te.INVALID_REMOTE_USER)):D(new Le(te.TIMEOUT))},se("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),j=()=>{G&&window.clearTimeout(G),this.off(sS.ABORT,B),o&&P()},B=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),J),D(new Le(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(sS.ABORT,B),this.once("res-@".concat(c,"_ack"),j);const J=(fe,ye)=>{ee=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off(sS.ABORT,B),fe==="success"?P(ye):D(new Le(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let ee=!1;o||(this.once("res-@".concat(c),J),gs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{ee||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===te.TIMEOUT)return await this.send(r,s,o,c,d);throw P}}onMessage(r){var s;const{_uid:o}=r;let c,d=this.userMap.get(o);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==ui.CHECK)return;const{token:v}=r;c=new Map,d={uid:o,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,d),this.signal.emit(wn.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:S}=r,R=(h=c.get(v))!==null&&h!==void 0?h:[];if(R.push(r),c.has(v)||c.set(v,R),R.length!==S)return;{const P=aT(R).call(R,(D,G)=>D.index-G.index).map(D=>D.payload).join("");c.delete(v),(r=JSON.parse(P))._uid=o}}const{_type:m,token:y}=r;if(ot(s=[ui.ACK,ui.CHECK]).call(s,m))return m===ui.CHECK&&this.handleCheckToken(d,y),void this.receiveMessage(r);y==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:gr(6,""),token:this.token,_type:ui.CHECK};se("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Kt.DATA_STREAM,{payload:Gm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:ui.ACK,token:this.token};se("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Kt.DATA_STREAM,{payload:Gm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,o){this.send(ui.RESPONSE,JSON.stringify({success:!o,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=v;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),v.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:o,_seq:c}=r,d=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:y}=d;if(c<y)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===y&&(this.receiveMessage(r),h.delete(y),d.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:o,_message:c,_uid:d}=r;if(se("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==ui.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case ui.CANDIDATE:case ui.CONTROL:this.signal.emit(o,h,d);break;case ui.PUBLISH:case ui.UNPUBLISH:case ui.RESTART_ICE:case ui.CALL:h.uid=d,Us(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case ui.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case ui.RESPONSE:{const{success:m,message:y}=h;this.emit("res-@".concat(s),m?"success":"failed",y);break}}}}splitMessage(r){if(r.length<dy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:o}=JSON.parse(r),c=gr(6,"");let d=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){d++;const y={id:c,index:d,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(y).length>dy.MAX_MESSAGE_SIZE?h-=50:(s.push(y),r=r.slice(h))}return s.map(y=>JSON.stringify(y))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},se("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Us(this.signal,ui.CALL,void 0),s=await this.send(ui.CALL,r);this.signal.emit(Yt.P2P_CONNECTION,s,!0)}async reset(r,s){const o=this.userMap.get(r);o&&(this.emit(sS.ABORT),this.signal.emit(wn.ON_USER_OFFLINE,{uid:o.uid,reason:Hme.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=gr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(sS.ABORT)}}q(dy,"MAX_SIZE",1),q(dy,"MAX_MESSAGE_SIZE",1024);class Iye extends zr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Er.CONNECTED?this.emit(Yt.WS_CONNECTED):r===Er.RECONNECTING?this.emit(Yt.WS_RECONNECTING,this._websocketReconnectReason):r===Er.CLOSED&&this.emit(Yt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",Er.CLOSED),q(this,"reconnectToken",void 0),q(this,"p2pToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new bW(5)),q(this,"pingpongTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"_external_signal",void 0),q(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Yt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case wn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case wn.MUTE_AUDIO:case wn.MUTE_VIDEO:case wn.ON_P2P_LOST:case wn.ON_USER_ONLINE:return;case wn.ON_USER_OFFLINE:const{uid:d}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===wn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Xn.UID_BANNED);break;case 15:this.close(Xn.IP_BANNED);break;case 16:this.close(Xn.CHANNEL_BANNED)}if(c._type===wn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case jt.ERR_LICENSE_MISSING:this.close(Xn.LICENSE_MISSING);break;case jt.ERR_LICENSE_EXPIRED:this.close(Xn.LICENSE_EXPIRED);break;case jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xn.LICENSE_MINUTES_EXCEEDED);break;case jt.ERR_LICENSE_PERIOD_INVALID:this.close(Xn.LICENSE_PERIOD_INVALID);break;case jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xn.LICENSE_MULTIPLE_SDK_SERVICE);break;case jt.ERR_LICENSE_ILLEGAL:this.close(Xn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new GL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,se("JOIN_GATEWAY_USE_DUAL_DOMAIN"),se("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Er.CONNECTED&&this.reconnect("retry",Ms.OFFLINE)}),this.p2pToken=gr(6,""),this._external_signal=new dy(this,this.p2pToken)}async request(r,s,o,c){const d=gr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new ht((G,j)=>{if(this.connectionState===Er.CONNECTED)return G();const B=()=>{this.off(Yt.WS_CLOSED,J),G()},J=()=>{this.off(Yt.WS_CONNECTED,B),j(new Le(te.WS_ABORT))};this.once(Yt.WS_CONNECTED,B),this.once(Yt.WS_CLOSED,J)});if(this.connectionState!==Er.CONNECTING&&this.connectionState!==Er.RECONNECTING||r===Kt.JOIN||r===Kt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new ht((G,j)=>{let B=!1;const J=(fe,ye)=>{B=!0,G({isSuccess:fe==="success",message:ye||{}}),this.off(Yt.WS_CLOSED,ee),this.off(Yt.WS_RECONNECTING,ee),this.emit(Yt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),J);const ee=()=>{j(new Le(te.WS_ABORT,"type: ".concat(r))),this.off(Yt.WS_CLOSED,ee),this.off(Yt.WS_RECONNECTING,ee),this.off("res-@".concat(d),J)};this.once(Yt.WS_CLOSED,ee),this.once(Yt.WS_RECONNECTING,ee),gs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Yt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await v}catch(G){if(this.connectionState===Er.CLOSED||r===Kt.LEAVE)throw new Le(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Kt.JOIN||r===Kt.REJOIN?null:(await y(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=DT(R),D=new Le(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===jt.ERR_TOO_MANY_BROADCASTERS?((r===Kt.JOIN||r===Kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):P.action==="failed"?D.throw():P.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ms.MULTI_IP)):this.reconnect(P.action,Ms.SERVER_ERROR),r===Kt.JOIN||r===Kt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new ht(o=>{const c=d=>{(!s||s(d))&&(this.off(r,c),o(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(kT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const d=se("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Er.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},se("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}async sendExtensionMessage(r,s,o){return await this._external_signal.send(r,s,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ht((s,o)=>{this.once(Yt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Yt.WS_CLOSED,()=>o(this.initError||new Le(te.WS_ABORT))),this.connectionState=Er.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Xn.LEAVE,this.connectionState=Er.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=gr(6,""),this._external_signal.clear(),this._external_signal=new dy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Yt.ABORT_P2P_EXECUTION);const r=await Us(this,Yt.REQUEST_JOIN_INFO),s=await this.request(Kt.JOIN,r);if(!s)return this.emit(Yt.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Yt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Er.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const o=B_(r.payload),c=new TextDecoder().decode(o),d=JSON.parse(c);"total"in d&&"id"in d||ot(s=Object.values(ui)).call(s,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(wn.ON_DATA_STREAM,r)}catch{this.emit(wn.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=DT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xn.UID_BANNED),void this.close()):void this.reconnect(s.action,Ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=se("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>se("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ms.TIMEOUT):this.request(Kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),se("REPORT_STATS")&&this.send(Kt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(en.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Yt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(en.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(en.CLOSED,()=>{this.connectionState=Er.CLOSED}),this.websocket.on(en.FAILED,()=>{this._disconnectedReason=Xn.NETWORK_ERROR,this.connectionState=Er.CLOSED}),this.websocket.on(en.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Er.CONNECTED?this.connectionState=Er.RECONNECTING:this.connectionState=Er.CONNECTING}),this.websocket.on(en.WILL_RECONNECT,(r,s,o)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(en.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Yt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===jt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ms.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ms.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(en.REQUEST_NEW_URLS,(r,s)=>{Us(this,Yt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(en.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Aye={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new Rye(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new Iye(s,r)}};function K7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function q7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?K7(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):K7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class Pye{constructor(r){q(this,"sessionDesc",void 0),q(this,"localCapabilities",void 0),q(this,"rtpCapabilities",void 0),q(this,"candidates",void 0),q(this,"_originCandidates",void 0),q(this,"iceParameters",void 0),q(this,"dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),r=Yr(r);const{iceParameters:s,dtlsParameters:o,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:m,sdkCodec:y,cname:v}=r,S=Qa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=Yr(c),this.iceParameters=s,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=v;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=d.videoCodecs.map(G=>G.payloadType.toString(10));let D=d.videoCodecs.filter(G=>{var j,B;return(j=G.rtpMap)===null||j===void 0?void 0:ot(B=j.encodingName.toLowerCase()).call(B,y)});D.length===0&&(D=d.videoCodecs),P.attributes.payloads=D,P.attributes.extmaps=d.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=d.audioCodecs.map(D=>D.payloadType.toString(10)),P.attributes.payloads=d.audioCodecs,P.attributes.extmaps=d.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Hm(this.sessionDesc)}send(r,s,o){const{ssrcs:c,ssrcGroups:d}=J_(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>r===Tt.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),m=c[0].attributes.label,y=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:y}}batchSend(r){return r.map(s=>{let{kind:o,ssrcMsg:c}=s;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const o=[],c=[],d=[];s.attributes.ssrcs.forEach(h=>{ot(r).call(r,h.attributes.label||"")?d.push(h):o.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;ot(m=d.map(y=>y.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=o,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,o){r.forEach((c,d)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=y})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(s.forEach(c=>{o.push(q7(q7({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Ys.TCP_RELAY:this.candidates=o;break;case Ys.UDP_TCP_RELAY:case Ys.RELAY:this.candidates=[...s,...o];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Yr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let o=0;o<r;o++)s.push((this.currentMidIndex+o+1).toString(10));return s}mungRecvMediaDsec(r,s){const o=Yr(r);return cS(o,s),qL(o,s),o}updateRecvMedia(r,s){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],s);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===Tt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var d;h&&(h.attributes.label=o,(d=h.attributes.msid)===null||d===void 0||d.replace(s,o))}}mungMediaDesc(r){const s=Yr(r);return KL(s),function(o){const c=o.attributes.extmaps.find(d=>SP(d.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const o of s.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var fr;function Y7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function oO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Y7(Object(s),!0).forEach(function(o){q(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Y7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let Oye=(fr=class Yw extends iH{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ot(s=Object.keys(XA)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"statsFilter",void 0),q(this,"useRTX",!1),q(this,"localCapabilities",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"establishPromise",void 0),q(this,"mutex",void 0),this.store=s,this.mutex=new Ks("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Yw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=aL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,$r()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Xm(r.sdp),o=MT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:se("FILTER_VIDEO_FEC"),filterAudioFec:se("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,oO(oO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Pye(oO(oO({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var o=this;return Bl(function*(){const c=yield Dn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield Dn(o.peerConnection.createOffer()),m=Qa(h.sdp),y=r.map(P=>{const D=P._mediaStreamTrack,G=m.mediaDescriptions.find(j=>j.attributes.mid===D.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(j,B,J){const ee=j.attributes.ssrcs.filter(ye=>ye.attributes.label===B),fe=j.attributes.ssrcGroups;if(ee.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(fe&&ee.length>1){const ye=fe.find(ve=>ve.ssrcIds.indexOf(ee[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:J?ye.ssrcIds[1]:void 0}]:[{ssrcId:ee[0].ssrcId}]}return[{ssrcId:ee[0].ssrcId}]}(G,D.id,o.useRTX)});let v;try{v=yield y}catch(P){throw d.forEach(D=>{Ls()&&D.replaceTrack(null),o.peerConnection.removeTrack(D)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,s,v);const R=o.remoteSDP.toString();return yield Dn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Dn(o.applySendEncodings(d,r)),yield Dn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,D)=>{const G=P._mediaStreamTrack.id;return{localSSRC:y[D],id:G}})}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{Ls()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(r,s,c),m=new ht((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(d)))},1e4),D=G=>{const j=xn();if((j.name==="Safari"&&Number(j.version)===11||Yo())&&G.track.id!==d&&G.streams[0].id===h){var B;const J=G.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(r,d,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S(J)}if(G.track.id===d)return this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S(G.track)};this.peerConnection.addEventListener("track",D)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:d}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(o=>{if(Ls()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(d=>d.active=!1),o.setParameters(c)}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(Ls()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(m=>m.active=!0),await d.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Bl(function*(){const o=yield Dn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=jn().supportPCSetConfiguration;if(r===Ys.RELAY&&!c)return;if(c){const v=s.peerConnection.getConfiguration(),S=r===Ys.RELAY?"relay":"all";v.iceTransportPolicy!==S&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(S,"]")),v.iceTransportPolicy=S,s.peerConnection.setConfiguration(v))}r!==Ys.RELAY&&s.remoteSDP.updateCandidates(r);const d=yield Dn(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Xm(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const y=s.remoteSDP.toString();yield Dn(s.peerConnection.setLocalDescription(d)),yield Dn(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new Le(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});o.length===1&&await this.applySendEncodings(o,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},se("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(TT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...Yw.turnServerConfigToIceServers(r.turnServer.servers)),se("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Yw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(v=>{var S;return((S=v.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!jn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof Ar)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(se("DSCP_TYPE")&&af()){var h;const v=se("DSCP_TYPE");ot(h=["very-low","low","medium","high"]).call(h,v)&&(d.networkPriority=v)}const m=s.getParameters(),y=(o=m.encodings)===null||o===void 0?void 0:o[0];y&&Object.assign(y,d),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],d=s[o];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const o=Qa(r);return s.forEach((c,d)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(y=>y.attributes.mid===h.kind);m&&cS(m,c)}),Hm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((d,h)=>{let{id:m,mslabel:y}=d;const{kind:v}=r[h];return new ht((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),D=G=>{const j=xn();if(j.name==="Safari"&&Number(j.version)===11&&G.track.id!==m&&G.streams[0].id===y){var B;const J=G.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(v,m,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S({track:J,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S({track:G.track,id:m})};this.peerConnection.addEventListener("track",D)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ht.all(s)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(jn().supportPCSetConfiguration){const s=Yw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Rt(fr.prototype,"connect",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"connect"),fr.prototype),Rt(fr.prototype,"stopSending",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"stopSending"),fr.prototype),Rt(fr.prototype,"receive",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"receive"),fr.prototype),Rt(fr.prototype,"stopReceiving",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"stopReceiving"),fr.prototype),Rt(fr.prototype,"muteRemote",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"muteRemote"),fr.prototype),Rt(fr.prototype,"unmuteRemote",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteRemote"),fr.prototype),Rt(fr.prototype,"muteLocal",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"muteLocal"),fr.prototype),Rt(fr.prototype,"unmuteLocal",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteLocal"),fr.prototype),Rt(fr.prototype,"close",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"close"),fr.prototype),Rt(fr.prototype,"updateEncoderConfig",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"updateEncoderConfig"),fr.prototype),Rt(fr.prototype,"updateSendParameters",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"updateSendParameters"),fr.prototype),Rt(fr.prototype,"replaceTrack",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"replaceTrack"),fr.prototype),Rt(fr.prototype,"getRemoteSSRC",[Yl],Object.getOwnPropertyDescriptor(fr.prototype,"getRemoteSSRC"),fr.prototype),fr);function Yl(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{d()}},s}const kye={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new Oye(s,r)}},Nye={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(sP.has(t)||!t.track)return;const s={track:t.track};if(of()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const y=r.metadata&&r.metadata();y?function(v,S){const{chunk:R,controller:P}=S,D=se("ENABLE_AUDIO_PTS_METADATA")?df.AUDIO_64_BIT_PTS:df.METADATA;R.data=function(G,j,B){const J=B.byteLength,ee=J+kL+zG,fe=PL+OL+ee,ye=new ArrayBuffer(G.byteLength+fe),ve=new DataView(ye);ve.setUint8(0,BG),ve.setUint16(1,ee),ve.setUint8(3,j),ve.setUint16(4,J);for(let Ne=0;Ne<J;Ne++)ve.setUint8(6+Ne,B[Ne]);const _e=new Uint8Array(ve.buffer);return _e.set(new Uint8Array(G),fe),_e.buffer}(R.data,D,v),P.enqueue(R)}(y,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Ls()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=iP(),d=new MessageChannel;await new ht(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=h,await new ht(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;if(m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&d.port1.postMessage({metadata:v})}},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=sP.get(t);if(c){sP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}sP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(dP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if(of()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");Wx(Hn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)),r.enableTopn?function(y,v,S){var R;const P=WG(new DataView(v.data));if(!P)return S.enqueue(v);const D=y.track.id;hme.set(D,y.track);const G=(R=P.tlv.find(ye=>ye.tag===df.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let j=0;typeof G=="number"&&(j=127-G);const B=Math.round(Math.pow(10,j/60)-1),{selected:J,speaker:ee}=function(ye,ve){let _e=tS.get(ye);if(_e||(_e=function(Ne){const Je=new HG;return tS.set(Ne,Je),Md||(Md=new ume(se("TOPN_SILENCE_THRESHOLD")||500),Md.on("ActiveSpeakerChanged",pt=>{pt!=null&&(cP=pt)})),Md.addSpeakers([Je]),Je}(ye)),tS.size<=$G)return{selected:!0,speaker:_e};if(!Md)throw new Error("no active speaker detector");return Md.levelChanged(_e.id,ve),q_=Md.loudest.map(Ne=>Ne.id),cP&&!ot(q_).call(q_,cP)&&q_.length>=$G&&q_.pop(),{selected:ot(q_).call(q_,_e.id)||_e.id===cP,speaker:_e}}(y,B),fe=function(ye,ve,_e){const Ne=Ud.get(ye)||new dme(ye,ve);return Ne.score=_e,Ud.set(ye,Ne),function(Je){if(lP.set(Je,!0),!uP)return void(uP=Date.now());const pt=Date.now();pt-uP>1e3&&(lP.get(Je)?lP.set(Je,!1):(KG(Je),lP.delete(Je)),uP=pt)}(ye),Ne}(D,y.track,ee.energyScore);fe.addSample(J),fe.active&&(v.data=P.frame.buffer,S.enqueue(v))}(t,h,m):r.enableMetadata?function(y,v,S){const R=WG(new DataView(y.data));if(!R)return v.enqueue(y);const P=R.tlv.find(D=>D.tag===df.METADATA||D.tag===df.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),y.data=R.frame.buffer,v.enqueue(y)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Ls()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=iP(),d=new MessageChannel;await new ht(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=h,await new ht(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function o(){t.track.removeEventListener("ended",o),function(c){const d=dP.get(c);if(d){(function(y){const v=tS.get(y);v&&(tS.delete(y),Md&&(Md.removeSpeakers([v]),tS.size===0&&(Md.destroy(),Md=null)))})(c),KG(c.track.id),dP.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}}(t)}dP.set(t,s),t.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(t,r){if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(hP.has(t)||!t.track)return;const s={track:t.track};if(of()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const d=[];r.on("sei-to-send",m=>{d.push(m)});const h=new TransformStream({transform(m,y){s.controller||(s.controller=y),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const v=d.shift();v&&(m.data=function(S,R){const P=function(ee){const fe=ee.length;let ye=[],ve=0;for(;ve<fe;)ve+2<fe&&ee[ve]===0&&ee[ve+1]===0&&(ee[ve+2]===0||ee[ve+2]===1||ee[ve+2]===2||ee[ve+2]===3)?(ye.push(ee[ve],ee[ve+1],3,ee[ve+2]),ve+=3):(ye.push(ee[ve]),ve++);return new Uint8Array(ye)}(R),D=P.length,G=Math.floor(D/255),j=D%255,B=new Uint8Array(6+G+1+D+S.byteLength);B[0]=0,B[1]=0,B[2]=0,B[3]=1,B[4]=6,B[5]=101;let J=0;for(;J<G;)B[6+J]=255,J++;return B[6+J]=j,J++,B.set(P,6+J),B.set(new Uint8Array(S),6+J+D),B.buffer}(m.data,v)),y.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Ls())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=iP(),d=new MessageChannel;await new ht(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=h,await new ht(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{d.port1.postMessage({sei:m})}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o))},s.worker=c}}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=hP.get(t);if(c){hP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}hP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(OT.has(t)){const c=OT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(of()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const y=function(v){const S=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,D=0,G=0;for(;(G=S.getUint8(P++))===255;)D+=255;D+=G;const j=pme(v.data,P,D);return new Uint8Array(j)}R++}return null}(h);y&&s.onSei&&s.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Ls()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=iP(),d=new MessageChannel;await new ht(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=h,await new ht(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}(function(c){const d=OT.get(c);if(d){OT.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}})(t)}OT.set(t,s),t.track.addEventListener("ended",o)}},Dye={name:"InterceptFrame",create:()=>Nye};cL(),or("PROCESS_ID","process-".concat(gr(8,""),"-").concat(gr(4,""),"-").concat(gr(4,""),"-").concat(gr(4,""),"-").concat(gr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(Ir,o)){const{value:c,expires:d}=r[o];if(d&&d<=s)return;Ld[o]=c,Ir[o]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Ld.AREAS)&&Ld.AREAS.length>0&&ZL(Ld.AREAS,!0);const X7=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),or(t,r,s)};Jm(nye,!1),Jm(sye,!1),Jm(Vge,!1),Jm(gye,!1),Jm(Z_e,!1),Jm(Aye,!1),Jm(kye,!1),Jm(Dye,!1);const ki=function(t){const r=new zr,s=t,o={getListeners:r.getListeners.bind(r),on:(c,d)=>(function(h,m){h===jh.SECURITY_POLICY_VIOLATION&&O$(m,!0)}(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return P$(P$({},s),o)}({__TRACK_LIST__:Hv,VERSION:zl,BUILD:dL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:X7,getParameter:se,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(o){let c;return jn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Ae(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=Ot.reportApiInvoke(null,{name:Pi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:qr.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(d&&h&&m),r&&Kx()&&Jz(75)&&new d().close()}catch(d){return x.error("check system requirement failed: ",d),!1}let s=!1;const o=xn();o.name===Hn.CHROME&&Number(o.version)>=58&&(Dd.engine.name!=="WebKit"||function(){const d=xn();if(BA()){if(d.os===Yi.MAC_OS)return!0;if(d.os===Yi.IOS){const h=Dd.os.version&&Dd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(o.name===Hn.FIREFOX&&Number(o.version)>=56||o.name===Hn.OPERA&&Number(o.version)>=45||o.name===Hn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Yo()||Du())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||rW()||xn().name===Hn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return ul.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return ul.getRecordingDevices(t)},getCameras:function(t){return ul.getCamerasDevices(t)},getElectronScreenSources:JW,getPlaybackDevices:function(t){return ul.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=gr(5,"client-"),o=Ot.reportApiInvoke(null,{id:s,name:Pi.CREATE_CLIENT,options:[r],tag:qr.TRACER});try{(function(c){Wi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Wi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Wi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ms(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&dW(c.turnServer),c.httpRetryConfig!==void 0&&uW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&uW(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(Zz(16,0)||eW(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),or("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new Fge(Bu(Bu({forceWaitGatewayResponse:!0},r),{},{role:ot(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=se("CAMERA_CAPTURE_CONFIG"),s=gr(8,"track-cam-"),o=Ot.reportApiInvoke(null,{id:s,tag:qr.TRACER,name:Pi.CREATE_CAM_VIDEO_TRACK,options:[Vr({},t),r]});r&&(t.encoderConfig=r);const c=nP(t);let d=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{d=(await ll({video:c},s)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!d){const m=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(x)}t.optimizationMode&&AL(s,d,t,Uh(t.encoderConfig));const h=new IL(d,t,c,t.scalabiltyMode?QA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return o.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=gr(8,"track-cus-"),s=Ot.reportApiInvoke(null,{id:r,tag:qr.TRACER,name:Pi.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),o=new Ar(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?QA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[_r.CUSTOM_TRACK]);return s.onSuccess(o.getTrackId()),x.info("create custom video track success with config",t,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return a8(P)}(r):void 0;s&&(r="auto");const o=gr(8,"track-scr-v-"),c=Ot.reportApiInvoke(null,{id:o,tag:qr.TRACER,name:Pi.CREATE_SCREEN_VIDEO_TRACK,options:[Vr({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=function(P){const D={};P.screenSourceType&&(D.mediaSource=P.screenSourceType),P.extensionId&&of()&&(D.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:j,surfaceSwitching:B,systemAudio:J,preferCurrentTab:ee}=P;(ET(107)||Gx(107)||Hx(93))&&(G&&(Wi(G,"displaySurface",["browser","window","monitor"]),D.displaySurface=G),j?(Wi(j,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=j):D.selfBrowserSurface="include",B&&(Wi(B,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=B)),(ET(105)||Gx(105)||Hx(91))&&J&&(Wi(J,"systemAudio",["exclude","include"]),D.systemAudio=J),(ET(94)||Gx(94)||Hx(80))&&ee&&(D.preferCurrentTab=!0),P.electronScreenSourceId&&(D.sourceId=P.electronScreenSourceId);const fe=P.encoderConfig?gL(P.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:fe?fe.width:void 0,maxHeight:fe?fe.height:void 0},fe&&(fe.frameRate&&(typeof fe.frameRate=="number"?(D.mandatory.maxFrameRate=fe.frameRate,D.mandatory.minFrameRate=fe.frameRate):(D.mandatory.maxFrameRate=fe.frameRate.max||fe.frameRate.ideal||fe.frameRate.exact||void 0,D.mandatory.minFrameRate=fe.frameRate.min||fe.frameRate.ideal||fe.frameRate.exact||void 0),D.frameRate=fe.frameRate),fe.width&&(D.width=fe.width),fe.height&&(D.height=fe.height)),D}(t);let h=null,m=null;const y=jn();if(!y.supportShareAudio&&r==="enable"){const P=new Le(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",o);const v=y.supportShareAudio&&r!=="disable";try{const P=await ll({screen:d,screenAudio:v?s||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new Le(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(AL(o,h,t,t.encoderConfig&&gL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const S=new Ar(h,t.encoderConfig?gL(t.encoderConfig):{},t.scalabiltyMode?QA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o,[_r.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const R=new Qr(m,void 0,gr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=se("CAMERA_CAPTURE_CONFIG"),o=gr(8,"track-mic-"),c=gr(8,"track-cam-"),d=Ot.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:qr.TRACER,name:Pi.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=nP(r),m=c8(t);let y=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const P=await ll({audio:m,video:h},"".concat(o,"-").concat(c));y=P.getAudioTracks()[0],v=P.getVideoTracks()[0]}catch(P){throw d.onError(P),P}if(!y||!v){const P=new Le(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(P),P.throw(x)}r.optimizationMode&&AL(c,v,r,Uh(r.encoderConfig));const S=new rP(y,t,m,o),R=new IL(v,r,h,r.scalabiltyMode?QA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=gr(8,"track-mic-"),s=Ot.reportApiInvoke(null,{id:r,tag:qr.TRACER,name:Pi.CREATE_MIC_AUDIO_TRACK,options:[t]}),o=c8(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await ll({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const d=new rP(c,t,o,r);return s.onSuccess(d.getTrackId()),x.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:function(t){const r=gr(8,"track-cus-"),s=Ot.reportApiInvoke(null,{id:r,tag:qr.TRACER,name:Pi.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),o=new Qr(t.mediaStreamTrack,t.encoderConfig?ZA(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",o.getTrackId()),s.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:o}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:o},h=gr(8,"track-buf-"),m=Ot.reportApiInvoke(null,{id:h,tag:qr.TRACER,name:Pi.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(se("DISABLE_WEBAUDIO"))throw new Le(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const y=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let D=null;if(typeof R=="string"){const j=q8.get(R);if(j)return x.debug("use cached audio resource: ",R),j;try{D=(await xd(()=>ba.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(B){throw new Le(te.FETCH_AUDIO_FILE_FAILED,B.toString())}}else D=await new ht((B,J)=>{const ee=new FileReader;ee.onload=fe=>{fe.target?B(fe.target.result):J(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.onerror=()=>{J(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.readAsArrayBuffer(R)});const G=await function(j){const B=Jv();return new ht((J,ee)=>{B.decodeAudioData(j,fe=>{J(fe)},fe=>{ee(new Le(te.DECODE_AUDIO_FILE_FAILED,fe.toString()))})})}(D);return typeof R=="string"&&P&&q8.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const v=new sme(c),S=new ime(y,v,o?ZA(o):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Ae(te.INVALID_PARAMS,"invalid app type",t);or("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){se("USE_NEW_LOG")?or("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){se("USE_NEW_LOG")?or("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new qH},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ot.reportApiInvoke(null,{tag:qr.TRACER,name:Pi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Qr||t instanceof eS)){const y=new Ae(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof Qr?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,h=c;const m=Date.now();return new ht(y=>{const v=setInterval(()=>{const S=t.getVolumeLevel();d=S>d?S:d,h=S<h?S:h;const R=d-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(v);const D=R,G={duration:P,deviceLabel:o,maxVolumeLevel:d,result:D};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),y(D)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ot.reportApiInvoke(null,{tag:qr.TRACER,name:Pi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Ar||t instanceof Zv)){const R=new Ae(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof Ar?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Ls()||BA())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,y=0;try{const R=Date.now();m=await function(P,D,G,j){let B,J=0,ee=null;return new ht((fe,ye)=>{function ve(){J>j&&B&&(B(),fe(J));const _e=G.getContext("2d");if(!_e){const pt=new Ae(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(pt.toString()),void ye(pt)}_e.drawImage(P,0,0,160,120);const Ne=_e.getImageData(0,0,G.width,G.height),Je=Math.floor(Ne.data.length/3);if(ee){for(let pt=0;pt<Je;pt+=3)if(Ne.data[pt]!==ee[pt])return J+=1,void(ee=Ne.data);ee=Ne.data}else ee=Ne.data}setTimeout(()=>{B&&(B(),fe(J))},D),B=SL(()=>{ve()},30)})}(d,r,h,4),y=Date.now()-R}catch(R){throw s.onError(R),R}wge===Hn.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const v=m>4,S={duration:y,changedPicNum:m,deviceLabel:o,result:v};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),s.onSuccess(S),v},setArea:ZL,audioElementPlayCenter:Ta,resumeAudioContext:function(){Ta.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){Bge.processExternalMediaAEC(t)},registerExtensions:function(t){const r=se("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!ot(r).call(r,s.name)&&r.push(s.name);const o=s;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=Ot.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=se(c)})}),X7("PLUGIN_INFO",r)},ChannelMediaRelayError:rS,ChannelMediaRelayEvent:pf,ChannelMediaRelayState:Za,RemoteStreamFallbackType:Jfe,RemoteStreamType:Xfe,ConnectionDisconnectedReason:Xn,AudienceLatencyLevelType:Ife,AREAS:$n,preload:async function(t,r,s,o){return S9(t,r,s,o)}});return Object.defineProperties(ki,{onAudioAutoplayFailed:{get:()=>dl.onAudioAutoplayFailed,set:t=>{dl.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>dl.onAutoplayFailed,set:t=>{dl.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ki._onSecurityPolicyViolation,set(t){ki._onSecurityPolicyViolation=t,O$(t)}},__CLIENT_LIST__:{get:()=>se("SHOW_GLOBAL_CLIENT_LIST")?Y_:[]}}),ul.on(H_.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),ki.onCameraChanged&&ki.onCameraChanged(t),ki.safeEmit(jh.CAMERA_CHANGED,t)}),ul.on(H_.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),ki.onMicrophoneChanged&&ki.onMicrophoneChanged(t),ki.safeEmit(jh.MICROPHONE_CHANGED,t)}),ul.on(H_.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),ki.onPlaybackDeviceChanged&&ki.onPlaybackDeviceChanged(t),ki.safeEmit(jh.PLAYBACK_DEVICE_CHANGED,t)}),Ta.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),dl.onAudioAutoplayFailed&&dl.onAudioAutoplayFailed()},ar.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),dl.onAudioAutoplayFailed&&dl.onAudioAutoplayFailed(),ki.safeEmit(jh.AUTOPLAY_FAILED)}),ar.on(ys.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),ki.onAudioContextStateChanged&&ki.onAudioContextStateChanged(t,r),ki.safeEmit(jh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),yi.on(Fv.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=ki),ki})}(Tk)),Tk.exports}var l8e=c8e();const KC=jg(l8e),u8e="9442a472625f44e7b2c5065b9f9b3988",d8e=KC.createClient({mode:"rtc",codec:"vp8"});let Ow=null;const Hoe=N.createContext(null),$oe=({children:n,appId:e=u8e,channel:i=null,token:a=null,uid:l=null,enabled:u=!0,startMuted:f=!0,onClientReady:_=()=>{}})=>{const[E,b]=N.useState(!1),[C,I]=N.useState(!1),[O,L]=N.useState([]),[M,F]=N.useState(null),[z,X]=N.useState(null),[K,ne]=N.useState(null),[oe,ae]=N.useState(!1),[le,Y]=N.useState(!1),[Z,Q]=N.useState(!1),[ie,de]=N.useState(null),[ue,pe]=N.useState(!1),ke=dc(),xe=N.useRef(d8e),Fe=N.useRef({appId:e,channel:i,uid:l,enabled:u}),Oe=N.useRef(!1),we=N.useRef(null);N.useRef(null),N.useEffect(()=>{Fe.current={appId:e,channel:i,uid:l,enabled:u}},[e,i,l,u]),N.useEffect(()=>{X(i)},[i]),N.useEffect(()=>{if(!xe.current)return;const qe=nt=>{$.log(`Connection state changed to: ${nt}`),nt==="DISCONNECTED"?(b(!1),$.log("Disconnected from Agora")):nt==="CONNECTED"&&(b(!0),F(null))};return xe.current.on("connection-state-change",qe),()=>{xe.current.off("connection-state-change",qe)}},[]),N.useEffect(()=>{if(!i||!u)return;const qe=async(ut,kt)=>{$.log(`User published: ${ut.uid}, mediaType: ${kt}`);try{await xe.current.subscribe(ut,kt),kt==="audio"&&ut.audioTrack.play(),L(ct=>ct.some(Mt=>Mt.uid===ut.uid)?ct:[...ct,ut])}catch(ct){$.error("Error subscribing to user:",ct)}},nt=(ut,kt)=>{$.log(`User unpublished: ${ut.uid}, mediaType: ${kt}`),kt==="audio"&&ut.audioTrack&&ut.audioTrack.stop()},Ze=ut=>{$.log(`User joined: ${ut.uid}`),L(kt=>kt.some(ct=>ct.uid===ut.uid)?kt:[...kt,ut])},gt=ut=>{$.log(`User left: ${ut.uid}`),L(kt=>kt.filter(ct=>ct.uid!==ut.uid))};return xe.current.on("user-published",qe),xe.current.on("user-unpublished",nt),xe.current.on("user-joined",Ze),xe.current.on("user-left",gt),(async()=>{if(Oe.current){$.log("Already initializing, skipping duplicate initialization");return}Oe.current=!0;try{if(E&&we.current===i){$.log(`Already joined to channel ${i}`),ae(!0),_(xe.current);return}if(xe.current.connectionState==="CONNECTING"||xe.current.connectionState==="CONNECTED")if(we.current&&we.current!==i){$.log("Connected to different channel, leaving first");try{await Ee()}catch(ut){$.error("Error leaving channel:",ut)}}else{b(!0),ae(!0),we.current=i,Ow=i,_(xe.current);return}$.log(`Joining channel ${i}`),await Be(),$.log("Join channel completed")}catch(ut){$.error("Error during initialization:",ut)}finally{Oe.current=!1}})(),()=>{$.log("Cleaning up event listeners"),xe.current.off("user-published",qe),xe.current.off("user-unpublished",nt),xe.current.off("user-joined",Ze),xe.current.off("user-left",gt)}},[i,u,l,_,E]);const Se=async()=>{if(!u||K)return K;$.log("Initializing microphone");try{const qe=await KC.createMicrophoneAudioTrack();return await qe.setMuted(f),ne(qe),$.log("Microphone initialized successfully"),qe}catch(qe){return $.error("Error initializing microphone:",qe),F("Failed to initialize microphone. Please check your permissions."),null}};N.useEffect(()=>{(async()=>{if(i)try{const gt=await td(i);gt&&gt.voiceDisabled?($.log("Voice is disabled for this space"),pe(!0),E&&await Ee()):pe(!1)}catch(Ze){$.error("Error checking if voice is disabled:",Ze)}})();const nt=Ze=>{Ze.detail&&typeof Ze.detail.voiceDisabled=="boolean"&&($.log("Voice setting changed:",Ze.detail.voiceDisabled),pe(Ze.detail.voiceDisabled),Ze.detail.voiceDisabled&&E?Ee():!Ze.detail.voiceDisabled&&!E&&u&&i&&Be())};return window.addEventListener("SpaceVoiceSettingChanged",nt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",nt)}},[i,E,u]);const Be=async()=>{if(!u)return $.log("Agora is disabled, not joining channel"),!1;if(ue)return $.log("Voice is disabled for this space, not joining channel"),F("Voice chat is disabled for this space"),!1;if(!i)return $.error("AgoraProvider: No channel specified"),F("No channel specified"),!1;if($.log(`joinChannel called for channel ${i} with UID ${l}`),$.log("Current state:",{isJoined:E,isJoining:le,connectionState:xe.current.connectionState,joinedChannel:we.current}),E&&we.current===i)return $.log(`Already joined to channel: ${i}`),!0;if(le)return $.log("AgoraProvider: Already in the process of joining"),!1;if(xe.current.connectionState==="CONNECTED")if(we.current&&we.current!==i){$.log("Connected to different channel, leaving first");try{await Ee()}catch(qe){$.error("Error leaving channel:",qe)}}else return $.log("Client already connected, setting joined state to true"),b(!0),ae(!0),we.current=i,Ow=i,_(xe.current),!0;if(xe.current.connectionState==="CONNECTING")return $.log("Client already connecting, waiting for connection"),Y(!0),new Promise(qe=>{const nt=setInterval(()=>{xe.current.connectionState==="CONNECTED"&&(clearInterval(nt),b(!0),Y(!1),ae(!0),we.current=i,Ow=i,_(xe.current),qe(!0))},500);setTimeout(()=>{clearInterval(nt),$.log("AgoraProvider: Connection timeout, considering join failed"),Y(!1),qe(!1)},1e4)});try{if($.log(`Joining channel: ${i} with UID: ${l||"random"}`),$.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const nt="AgoraProvider: App ID is empty or invalid";return $.error(nt),F(nt),Y(!1),!1}Y(!0);const qe=l||Math.floor(Math.random()*1e6);return await xe.current.join(e,i,a,qe),$.log(`Joined channel successfully with UID: ${xe.current.uid}`),b(!0),Y(!1),ae(!0),we.current=i,Ow=i,_(xe.current),!0}catch(qe){return $.error("Error joining channel:",qe),F(`Error joining channel: ${qe.toString()}`),Y(!1),!1}},Ee=async()=>{if(E)try{K&&await xe.current.unpublish(K),await xe.current.leave(),Ow=null,we.current=null,$.log("Left channel successfully"),b(!1),L([])}catch(qe){$.error("Error leaving channel:",qe),F(qe.message||"Failed to leave channel")}};N.useEffect(()=>()=>{K&&K.close()},[]),N.useEffect(()=>{u&&i&&(!E||we.current!==i)&&Be()},[u,i,E]);const Ce=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(qe){return $.error("Error checking microphone status:",qe),!1}};N.useEffect(()=>{const qe=()=>{const Ze=Ce();Ze!==C&&($.log("Syncing microphone state:",{actualStatus:Ze,currentState:C}),I(Ze),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Ze}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ze,window.agoraClient.microphoneTrack=K))};K&&qe();const nt=setInterval(qe,1e3);return()=>{clearInterval(nt)}},[K,C]);const Pe=async()=>{var qe;if(ue)return $.log("Voice is disabled for this space, cannot toggle"),ke({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const nt=C!==void 0?C:K?!K.muted:!1;if($.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:nt,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&($.log("AgoraProvider: No microphone track, initializing..."),!await Se()))return $.error("AgoraProvider: Failed to initialize microphone"),nt;const Ze=!nt;if($.log("AgoraProvider: New voice state will be:",Ze),nt){if(K)try{$.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||($.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),$.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(gt){return $.error("Error muting track:",gt),nt}}else if(K)try{xe.current&&E&&!((qe=xe.current.localTracks)!=null&&qe.includes(K))&&($.log("AgoraProvider: Publishing microphone track"),await xe.current.publish(K),$.log("AgoraProvider: Microphone track published successfully")),$.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&($.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),$.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(gt){return $.error("Error unmuting track:",gt),nt}return I(Ze),Ze}catch(nt){return $.error("Error toggling voice:",nt),C}},Me=async qe=>{try{ne(qe),$.log("Microphone track updated successfully")}catch(nt){throw $.error("Error updating microphone track:",nt),nt}},ze=async()=>{if(!xe.current||!i)return $.error("AgoraProvider: Voice chat not connected"),!1;try{if(Z)return $.log("AgoraProvider: Stopping screen share"),ie&&(Array.isArray(ie)?(await xe.current.unpublish(ie),ie.forEach(qe=>qe.close())):(await xe.current.unpublish(ie),ie.close()),de(null)),Q(!1),$.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;$.log("AgoraProvider: Starting screen share");try{const qe=await KC.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return $.log("AgoraProvider: Screen track created:",qe),qe.on("track-ended",()=>{$.log("AgoraProvider: Screen sharing ended by browser UI"),xe.current.unpublish(qe),qe.close(),de(null),Q(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await xe.current.publish(qe),de(qe),Q(!0),$.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=qe,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(qe){return $.error("AgoraProvider: Error creating screen track:",qe),Q(!1),de(null),!1}}catch(qe){return $.error("AgoraProvider: Error toggling screen share:",qe),Q(!1),de(null),!1}};N.useEffect(()=>{if($.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:xe.current,isScreenSharing:!1,screenTrack:null};const qe=Ze=>{$.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(gt=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!0,gt)}).catch(gt=>{$.error("AgoraProvider: Error handling ToggleScreenShare event:",gt),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1,Z)})},nt=Ze=>{$.log("AgoraProvider: Received JoinVoiceChat event"),Be().then(gt=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(gt)}).catch(gt=>{$.error("AgoraProvider: Error handling JoinVoiceChat event:",gt),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",qe),window.addEventListener("JoinVoiceChat",nt),()=>{window.removeEventListener("ToggleScreenShare",qe),window.removeEventListener("JoinVoiceChat",nt),typeof window<"u"&&window.agoraClient&&($.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&($.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),N.useEffect(()=>{$.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=K,window.agoraClient.client=xe.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),$.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,K]);const He={client:xe.current,isJoined:E,isVoiceEnabled:C,users:O,error:M,channel:z,appId:e,toggleVoice:Pe,leaveChannel:Ee,joinChannel:Be,microphoneTrack:K,isReady:oe,createMicrophoneTrack:Me,isScreenSharing:Z,screenTrack:ie,toggleScreenShare:ze,voiceDisabled:ue};return T.jsx(Hoe.Provider,{value:He,children:n})},Koe=()=>{const n=N.useContext(Hoe);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};$oe.propTypes={children:An.node.isRequired,appId:An.string.isRequired,channel:An.string.isRequired,token:An.string,uid:An.oneOfType([An.string,An.number])};const h8e=()=>{var Oe,we;const{client:n,isVoiceEnabled:e,isJoined:i,users:a,error:l,microphoneTrack:u,isReady:f,channel:_,appId:E,toggleVoice:b,joinChannel:C,leaveChannel:I,createMicrophoneTrack:O,isScreenSharing:L,screenTrack:M,toggleScreenShare:F,voiceDisabled:z}=Koe(),[X,K]=N.useState(e!==void 0?e:((Oe=window.agoraClient)==null?void 0:Oe.isVoiceEnabled)||!1),[ne,oe]=N.useState(L!==void 0?L:((we=window.agoraClient)==null?void 0:we.isScreenSharing)||!1),[ae,le]=N.useState(z!==void 0?z:!1),[Y,Z]=N.useState(!0);N.useEffect(()=>{var Se;e!==void 0?K(e):((Se=window.agoraClient)==null?void 0:Se.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):u&&K(!u.muted)},[e,u]),N.useEffect(()=>{var Se;L!==void 0?oe(L):((Se=window.agoraClient)==null?void 0:Se.isScreenSharing)!==void 0&&oe(window.agoraClient.isScreenSharing)},[L]),N.useEffect(()=>{z!==void 0&&le(z)},[z]);const Q=N.useRef({isVoiceEnabled:X,isScreenSharing:ne,isJoined:i,users:a,error:l,isReady:f,channel:_,appId:E,voiceDisabled:ae});N.useEffect(()=>{Q.current={isVoiceEnabled:X,isScreenSharing:ne,isJoined:i,users:a,error:l,isReady:f,channel:_,appId:E,voiceDisabled:ae}},[X,ne,i,a,l,f,_,E,ae]),N.useEffect(()=>{const Se=setTimeout(()=>{Z(!1)},5e3);return()=>clearTimeout(Se)},[]),N.useEffect(()=>{f&&Z(!1)},[f]),N.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:X,contextIsScreenSharing:L,localScreenSharing:ne,isJoined:i,users:a.length,error:l,isReady:f,channel:_,appId:E,hasMicrophoneTrack:!!u,trackMuted:u==null?void 0:u.muted,hasScreenTrack:!!M})},[e,X,L,ne,i,a,l,f,_,E,u,M]);const ie=async()=>{try{console.log("useVoiceChat: Toggling voice from:",X);const Se=await b();if(console.log("useVoiceChat: Toggle result:",Se),Se!==void 0)K(Se);else{const Be=!X;K(Be),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Be)}return Se!==void 0?Se:!X}catch(Se){return console.error("useVoiceChat: Error toggling voice:",Se),X}},de=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ne);const Se=await F();if(console.log("useVoiceChat: Screen share toggle result:",Se),Se!==void 0)oe(Se);else{const Be=!ne;oe(Be),window.agoraClient&&(window.agoraClient.isScreenSharing=Be)}return Se!==void 0?Se:!ne}catch(Se){return console.error("useVoiceChat: Error toggling screen share:",Se),ne}},ue=async()=>{X&&u&&await ie()},pe=async()=>{!X&&u&&await ie()},ke=Se=>a.some(Be=>{var Ee;return Be.uid===Se&&((Ee=Be.audioTrack)==null?void 0:Ee.isPlaying)}),xe=N.useCallback(()=>{if(!u||!X)return 0;try{return u.getVolumeLevel()}catch(Se){return console.error("Error getting volume level:",Se),0}},[u,X]);return{isVoiceEnabled:X,isScreenSharing:ne,isJoined:i,users:a,error:l,toggleVoice:ie,toggleScreenShare:de,mute:ue,unmute:pe,isUserSpeaking:ke,getVolumeLevel:xe,microphoneTrack:u,screenTrack:M,isLoading:Y,channel:_,appId:E,joinChannel:C,leaveChannel:I,client:n,setMicrophoneDevice:async Se=>{try{if(!Se){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}u&&(X&&await n.unpublish(u),await u.close());const Be=await KC.createMicrophoneAudioTrack({microphoneId:Se,encoderConfig:"music_standard"});O&&await O(Be),X&&await n.publish(Be),console.log("Microphone device changed successfully")}catch(Be){throw console.error("Error changing microphone device:",Be),Be}},voiceDisabled:ae}},p8e=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:u,toggleVoice:f,isJoined:_,joinChannel:E,channel:b,client:C,voiceDisabled:I}=h8e(),[O,L]=N.useState(!1),[M,F]=N.useState(!1);N.useEffect(()=>{const K=()=>{$.log("VoiceButton: Player instantiated, showing button"),F(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&($.log("VoiceButton: Player was already instantiated"),F(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),N.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:u,isJoined:_,channel:b,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:M,voiceDisabled:I})},[u,_,b,C,M,I]);const z=async()=>{if(!(O||I)){L(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:u,isJoined:_});try{if(!_&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await E(),console.log("VoiceButton: Joined channel successfully")}catch(ne){ne.message&&ne.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ne)}console.log("VoiceButton: Toggling voice state from:",u);const K=await f();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{L(!1)}}},X=()=>I?"Voice chat is disabled for this space":M?O?"Processing...":_?u?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!M||I?null:T.jsx(Bf,{label:X(),placement:e,hasArrow:!0,children:T.jsxs(yt,{position:"relative",cursor:"pointer",onClick:z,children:[T.jsx(eh,{size:n,borderRadius:"full",bg:u?"green.500":"red.500",icon:u?T.jsx(Boe,{color:"white"}):T.jsx(joe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&T.jsx(yt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:T.jsx(oh,{size:"sm",color:"white"})})]})})},f8e=fi.createContext({user:null}),m8e=({userNickname:n})=>{const{client:e,channel:i,screenTrack:a,isScreenSharing:l,toggleScreenShare:u}=Koe(),[f,_]=N.useState([]),[E,b]=N.useState(!1),[C,I]=N.useState(!0);N.useRef({});const O=N.useRef(null);N.useRef(null);const{user:L}=N.useContext(f8e)||{user:null},[M,F]=N.useState({}),z=N.useRef(a),[X,K]=N.useState(null),{isOpen:ne,onOpen:oe,onClose:ae}=th(),[le,Y]=N.useState(!1),Z=N.useRef(null),Q=N.useRef(null);N.useEffect(()=>{z.current=a},[a]),N.useEffect(()=>{if(!e||!i){b(!1);return}const ke=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const xe=e.connectionState;if(console.log("Current connection state:",xe),xe==="CONNECTED")b(!0),I(!1);else{b(!1);const Fe=Oe=>{console.log("Connection state changed:",Oe),Oe==="CONNECTED"?(b(!0),I(!1)):b(!1)};return e.on("connection-state-change",Fe),()=>{e.off("connection-state-change",Fe),clearTimeout(ke)}}return()=>{clearTimeout(ke)}},[e,i]),N.useEffect(()=>{const ke=async()=>{const xe={...M};let Fe=!1;for(const Oe of f){if(M[Oe.uid])continue;let we=null,Se=Oe.uid;if(typeof Se=="string"&&(Se.includes("-")?(we=Se.split("-")[0],Se=Se.split("-")[1]):Se.includes("_")&&(we=Se.split("_")[0],Se=Se.split("_")[1])),Se)try{console.log("Trying to fetch nickname for user ID:",Se);const Be=await su(Se);Be&&Be.Nickname?(console.log("Found nickname in Firebase for user ID:",Se,"Nickname:",Be.Nickname),xe[Oe.uid]=Be.Nickname,Fe=!0):we?(console.log("Using extracted name for user ID:",Se,"Name:",we),xe[Oe.uid]=we,Fe=!0):(xe[Oe.uid]="User",Fe=!0)}catch(Be){console.error("Error fetching user profile:",Be),we?(xe[Oe.uid]=we,Fe=!0):(xe[Oe.uid]="User",Fe=!0)}else we?(xe[Oe.uid]=we,Fe=!0):(xe[Oe.uid]="User",Fe=!0)}Fe&&F(xe)};f.length>0&&ke()},[f,M]),N.useEffect(()=>{if(!e||!i||!E)return;console.log("Setting up screen share event handlers");const ke=async(Oe,we)=>{if(console.log("User published:",Oe.uid,we,Oe),we==="video"){console.log("Remote video track detected:",Oe.uid);try{await e.subscribe(Oe,we),console.log("Subscribed to remote video track:",Oe.uid),_(Se=>Se.some(Be=>Be.uid===Oe.uid)?Se:[...Se,Oe])}catch(Se){console.error("Error subscribing to remote video track:",Se)}}},xe=(Oe,we)=>{if(console.log("User unpublished:",Oe.uid,we),we==="video"){if(console.log("Remote video track unpublished:",Oe.uid),Oe.videoTrack)try{Oe.videoTrack.stop()}catch(Se){console.error("Error stopping video track:",Se)}if(_(Se=>Se.filter(Be=>Be.uid!==Oe.uid)),l&&z.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),z.current.play(O.current)}catch(Se){console.error("Error replaying local screen track:",Se)}}},Fe=Oe=>{console.log("User left:",Oe.uid);const we=f.find(Se=>Se.uid===Oe.uid);if(we&&we.videoTrack)try{we.videoTrack.stop()}catch(Se){console.error("Error stopping video track:",Se)}if(_(Se=>Se.filter(Be=>Be.uid!==Oe.uid)),l&&z.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user left"),z.current.play(O.current)}catch(Se){console.error("Error replaying local screen track:",Se)}};return e.on("user-published",ke),e.on("user-unpublished",xe),e.on("user-left",Fe),()=>{e.off("user-published",ke),e.off("user-unpublished",xe),e.off("user-left",Fe)}},[e,i,E,f,l]),N.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(ke=>{if(ke.videoTrack)try{console.log("Playing video track for:",ke.uid),ke.videoTrack.play(`video-container-${ke.uid}`)}catch(xe){console.error("Error playing video track:",xe)}}),l&&z.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),z.current.play(O.current)}catch(ke){console.error("Error replaying local screen track:",ke)}},[f,l]),N.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&O.current)try{console.log("Playing local screen track"),a.play(O.current)}catch(ke){console.error("Error playing local screen track:",ke)}},[l,a]),N.useEffect(()=>()=>{if(f.forEach(ke=>{if(ke.videoTrack)try{ke.videoTrack.stop()}catch(xe){console.error("Error stopping video track on unmount:",xe)}}),a)try{a.stop()}catch(ke){console.error("Error stopping local screen track on unmount:",ke)}},[f,a]);const ie=()=>{console.log("Stopping local screen share"),u()},de=ke=>(console.log("Getting display name for UID:",ke,"type:",typeof ke),l&&L&&(ke===L.uid||ke===(e==null?void 0:e.uid))?n||"You":M[ke]?M[ke]:typeof ke=="string"?ke.includes("-")?ke.split("-")[0]:ke.includes("_")?ke.split("_")[0]:ke:"User"),ue=ke=>{console.log("Opening modal for remote screen",ke),K(ke),oe()},pe=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),oe()};return N.useEffect(()=>{ne&&X?(console.log("Modal opened, activeScreen:",X),setTimeout(()=>{if(X.isLocal&&z.current)try{console.log("Playing local screen in modal"),z.current.play("modal-screen-container"),Y(!0)}catch(ke){console.error("Error playing local screen in modal:",ke)}else if(X.videoTrack)try{console.log("Playing remote screen in modal"),X.videoTrack.play("modal-screen-container"),Y(!0)}catch(ke){console.error("Error playing remote screen in modal:",ke)}},500)):ne||(Y(!1),K(null),setTimeout(()=>{if(l&&z.current)try{z.current.play("local-screen-container")}catch(ke){console.error("Error playing local screen in small container:",ke)}f.forEach(ke=>{if(ke.videoTrack)try{ke.videoTrack.play(`video-container-${ke.uid}`)}catch(xe){console.error(`Error playing remote screen ${ke.uid} in small container:`,xe)}})},500))},[ne,X,l,f]),!E||C&&f.length===0&&!l||f.length===0&&!l?null:T.jsxs(T.Fragment,{children:[!ne&&T.jsxs(yt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Z,children:[l&&a&&T.jsxs(yt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:pe,children:[T.jsx(yt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),T.jsx(yt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(ke=>{const xe=M[ke.uid]||de(ke.uid);return T.jsxs(yt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>ue(ke),children:[T.jsx(yt,{id:`video-container-${ke.uid}`,width:"100%",height:"100%",position:"relative"}),T.jsx(yt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${xe}'s Screen`})]},ke.uid)})]}),ne&&T.jsx(yt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:ae,children:T.jsxs(yt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:ke=>ke.stopPropagation(),children:[!le&&T.jsxs(yt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[T.jsx(oh,{size:"xl"}),T.jsx(at,{mt:4,children:"Loading screen share..."})]}),T.jsx(yt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Q}),T.jsx(yt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:ae,children:""}),T.jsx(yt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:X!=null&&X.isLocal?n?`${n}'s Screen`:"Your Screen":`${M[X==null?void 0:X.uid]||de(X==null?void 0:X.uid)}'s Screen`}),(X==null?void 0:X.isLocal)&&T.jsx(yt,{position:"absolute",bottom:4,right:4,children:T.jsx(Yn,{colorScheme:"red",size:"sm",onClick:ie,children:"Stop Sharing"})})]})})]})},g8e=({onClose:n})=>{const e=dc(),[i,a]=N.useState(!1),[l,u]=N.useState(!1);N.useEffect(()=>{const E=()=>{window.agoraClient&&u(!!window.agoraClient.isScreenSharing)};E();const b=setInterval(E,1e3),C=()=>{E()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",C)}},[]);const f=async E=>{if(E.preventDefault(),E.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)_();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}_()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},_=async()=>{try{const E=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,C)=>{a(!1),b?(u(C),e(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(E)}catch(E){console.error("Error toggling screen share:",E),a(!1),e({title:"Screen sharing error",description:E.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function _8e({open:n,onClose:e}){const[i,a]=N.useState(0);return T.jsxs(vs,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[T.jsx(Ts,{backdropFilter:"blur(4px)"}),T.jsxs(Ss,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[T.jsx(fo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),T.jsx(zs,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),T.jsx(bs,{p:0,display:"flex",children:T.jsxs(T0,{orientation:"vertical",variant:"unstyled",index:i,onChange:a,display:"flex",flexGrow:1,children:[T.jsxs(w0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:$We,mb:1}),T.jsx(at,{fontSize:"xs",children:"Movement"})]}),T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:KWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Camera"})]}),T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:GWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Actions"})]}),T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:HWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Tips"})]})]}),T.jsxs(VC,{flexGrow:1,display:"flex",flexDirection:"column",children:[T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),T.jsxs(is,{wrap:"wrap",gap:3,children:[T.jsx(Jl,{keyLabel:"W",description:"Move Forward"}),T.jsx(Jl,{keyLabel:"A",description:"Move Left"}),T.jsx(Jl,{keyLabel:"S",description:"Move Backward"}),T.jsx(Jl,{keyLabel:"D",description:"Move Right"}),T.jsx(Jl,{keyLabel:"Shift",description:"Run"}),T.jsx(Jl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),T.jsxs(is,{wrap:"wrap",gap:3,children:[T.jsx(Jl,{keyLabel:"Mouse",description:"Look Around"}),T.jsx(Jl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),T.jsx(Jl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),T.jsxs(is,{wrap:"wrap",gap:3,children:[T.jsx(Jl,{keyLabel:"E",description:"Interact"}),T.jsx(Jl,{keyLabel:"F",description:"Emote Menu"}),T.jsx(Jl,{keyLabel:"T",description:"Chat"}),T.jsx(Jl,{keyLabel:"M",description:"Mute Mic"})]})]}),T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),T.jsxs(ai,{align:"stretch",spacing:2,children:[T.jsx(at,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),T.jsx(at,{fontSize:"xs",children:" Press ESC to access settings"}),T.jsx(at,{fontSize:"xs",children:" Click on players to view their profile"}),T.jsx(at,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Jl=({keyLabel:n,description:e})=>T.jsx(yt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:T.jsxs(hr,{spacing:2,children:[T.jsx(yt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),T.jsx(at,{fontSize:"xs",children:e})]})}),y8e=()=>{const[n,e]=N.useState([]),[i,a]=N.useState(""),[l,u]=N.useState(0),[f,_]=N.useState(100),[E,b]=N.useState(100),[C,I]=N.useState(!0),[O,L]=N.useState(!0),[M,F]=N.useState(!1);N.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ae=await KC.getMicrophones();e(ae),ae.length>0&&a(ae[0].deviceId)}catch(ae){console.error("Error getting audio devices:",ae)}})()},[]),N.useEffect(()=>{const oe=setInterval(()=>{u(M?Math.random()*50:0)},100);return()=>clearInterval(oe)},[M]);const z=oe=>{const ae=oe.target.value;a(ae),console.log("Microphone changed to:",ae)},X=oe=>{_(oe),console.log("Microphone volume set to:",oe)},K=oe=>{b(oe),console.log("Speaker volume set to:",oe)},ne=()=>{F(!M)};return T.jsxs(ai,{spacing:6,align:"stretch",children:[T.jsxs(Br,{children:[T.jsxs(ns,{children:["Microphone",T.jsx(Yd,{ml:2,colorScheme:M?"green":"red",children:M?"Enabled":"Muted"})]}),T.jsxs(Zne,{value:i,onChange:z,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(oe=>T.jsx("option",{value:oe.deviceId,children:oe.label||`Microphone ${oe.deviceId.slice(0,5)}...`},oe.deviceId)),n.length===0&&T.jsx("option",{value:"",children:"No microphones found"})]})]}),T.jsxs(yt,{children:[T.jsx(at,{mb:2,children:"Microphone Level"}),T.jsx(Vy,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),T.jsxs(Br,{children:[T.jsxs(ns,{children:["Microphone Volume: ",f,"%"]}),T.jsxs(fV,{value:f,onChange:X,min:0,max:100,step:1,colorScheme:"blue",children:[T.jsx(gV,{bg:"gray.700",children:T.jsx(_V,{})}),T.jsx(mV,{boxSize:6})]})]}),T.jsxs(Br,{children:[T.jsxs(ns,{children:["Speaker Volume: ",E,"%"]}),T.jsxs(fV,{value:E,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[T.jsx(gV,{bg:"gray.700",children:T.jsx(_V,{})}),T.jsx(mV,{boxSize:6})]})]}),T.jsxs(Br,{display:"flex",alignItems:"center",children:[T.jsx(ns,{mb:"0",children:"Microphone Enabled"}),T.jsx(jf,{isChecked:M,onChange:ne,colorScheme:"green",size:"lg"})]}),T.jsxs(Br,{display:"flex",alignItems:"center",children:[T.jsx(ns,{mb:"0",children:"Echo Cancellation"}),T.jsx(jf,{isChecked:C,onChange:()=>I(!C),colorScheme:"green",size:"lg"})]}),T.jsxs(Br,{display:"flex",alignItems:"center",children:[T.jsx(ns,{mb:"0",children:"Noise Suppression"}),T.jsx(jf,{isChecked:O,onChange:()=>L(!O),colorScheme:"green",size:"lg"})]}),T.jsxs(Vf,{status:"info",borderRadius:"md",children:[T.jsx(Ff,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function E8e({open:n,onClose:e,containerRef:i}){return T.jsx(od,{containerRef:i,children:T.jsxs(vs,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[T.jsx(Ts,{}),T.jsxs(Ss,{bg:"gray.900",color:"white",borderRadius:"lg",children:[T.jsx(fo,{children:"Settings"}),T.jsx(zs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),T.jsx(bs,{children:T.jsxs(T0,{variant:"enclosed",children:[T.jsxs(w0,{mb:4,children:[T.jsx(Oa,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),T.jsx(Oa,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),T.jsxs(VC,{children:[T.jsx(Oc,{children:T.jsx(yt,{p:4,bg:"gray.800",borderRadius:"md",children:T.jsx(y8e,{})})}),T.jsx(Oc,{children:T.jsx(yt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function v8e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function S8e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function EQ(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function Ry(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function qoe(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function b8e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function T8e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function w8e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function u0(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function wk(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function C8e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function R8e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function vQ(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function KS(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function I8e(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const A8e=async()=>{try{$.log("tagsFirestore: Fetching all tags");const n=iu(Qn,"tags"),e=await ed(n),i=[];return e.forEach(a=>{i.push({id:a.id,...a.data()})}),i}catch(n){throw $.error("tagsFirestore: Error fetching tags:",n),n}},P8e=async n=>{try{$.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=Sr(Qn,"tags",n),i=await Lo(e);return i.exists()?{id:i.id,...i.data()}:($.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw $.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},O8e=async({id:n,name:e,color:i,description:a})=>{try{$.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let u;if(n){const f=Sr(Qn,"tags",n);await Fg(f,l),u=n}else{const f=iu(Qn,"tags");u=(await uBe(f,l)).id}return{id:u,...l}}catch(l){throw $.error("tagsFirestore: Error creating tag:",l),l}},k8e=async(n,e)=>{try{$.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=Sr(Qn,"tags",e);if(!(await Lo(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=Sr(Qn,"spaces",n);return await Mo(l,{tags:hBe(e)}),!0}catch(i){throw $.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},N8e=async(n,e)=>{try{$.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=Sr(Qn,"spaces",n);return await Mo(i,{tags:Wse(e)}),!0}catch(i){throw $.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},D8e=async n=>{try{$.log(`tagsFirestore: Getting tags for space ${n}`);const e=Sr(Qn,"spaces",n),i=await Lo(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const u=[];for(const f of l){const _=await P8e(f);_&&u.push(_)}return u}catch(e){throw $.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},x8e=async()=>{$.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const a of n){$.log(`tagsFirestore: Processing tag: ${a.name}`);const l=Sr(Qn,"tags",a.id);(await Lo(l)).exists()?($.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),i++):(await O8e(a),e++,$.log(`tagsFirestore: Created tag: ${a.name}`))}return $.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw $.error("tagsFirestore: Error initializing default tags:",e),e}},Yoe=({spaceID:n})=>{const[e,i]=N.useState([]),[a,l]=N.useState([]),[u,f]=N.useState(!0),[_,E]=N.useState(!1),[b,C]=N.useState(!1),[I,O]=N.useState(null),{isOpen:L,onOpen:M,onClose:F}=th(),z=dc(),{user:X}=N.useContext(ro),K=(X==null?void 0:X.groups)&&(X.groups.includes("disruptiveAdmin")||X.groups.includes("admin"));N.useEffect(()=>{ne()},[n]);const ne=async()=>{f(!0);try{let Q=[];try{Q=await A8e(),i(Q)}catch(ie){$.error("SpaceTagsManager: Error loading available tags:",ie),i([]),z({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ie=await D8e(n);l(ie)}catch(ie){$.error("SpaceTagsManager: Error loading space tags:",ie),l([]),z({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Q){$.error("SpaceTagsManager: Error in loadTags:",Q),z({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},oe=async()=>{C(!0),O(null);try{const Q=await x8e();console.log("Tag initialization result:",Q),O(Q),z({title:"Tags initialized",description:`Successfully created ${Q.created} tags. Skipped ${Q.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ne()}catch(Q){$.error("SpaceTagsManager: Error initializing tags:",Q),O(!1),z({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},ae=async Q=>{if(!(!n||!Q)){E(!0);try{await k8e(n,Q);const ie=e.find(de=>de.id===Q);ie&&l(de=>[...de,ie]),z({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ie){$.error(`SpaceTagsManager: Error adding tag ${Q} to space:`,ie),z({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},le=async Q=>{if(!(!n||!Q)){E(!0);try{await N8e(n,Q),l(ie=>ie.filter(de=>de.id!==Q)),z({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ie){$.error(`SpaceTagsManager: Error removing tag ${Q} from space:`,ie),z({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},Y=()=>{const Q=a.map(ie=>ie.id);return e.filter(ie=>!Q.includes(ie.id))},Z=Y().length===0;return T.jsxs(yt,{children:[T.jsx(is,{mb:3,justifyContent:"space-between",alignItems:"center",children:T.jsxs(hr,{spacing:2,ml:"auto",children:[K&&T.jsx(Yn,{size:"xs",leftIcon:T.jsx(AWe,{}),onClick:M,variant:"outline",colorScheme:"purple",children:"Admin"}),T.jsxs(LN,{children:[T.jsx(MN,{as:Yn,size:"xs",leftIcon:T.jsx(IWe,{}),rightIcon:T.jsx(OWe,{}),isDisabled:u||_||Z,children:Z?"No Available Tags":"Add Tag"}),T.jsx(UN,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:Y().length>0?Y().map(Q=>T.jsx(UC,{onClick:()=>ae(Q.id),icon:T.jsx(yt,{width:"12px",height:"12px",borderRadius:"full",bg:Q.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Q.name},Q.id)):T.jsx(UC,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),u?T.jsx(is,{justify:"center",py:4,children:T.jsx(oh,{size:"sm",color:"blue.300"})}):e.length===0?T.jsx(yt,{children:T.jsxs(at,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",K?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?T.jsx(at,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):T.jsx(ure,{spacing:2,children:a.map(Q=>T.jsx(zj,{children:T.jsxs(sre,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Q.color||"#888"}`,children:[T.jsx(yt,{width:"8px",height:"8px",borderRadius:"full",bg:Q.color||"#888",mr:1}),T.jsx(ore,{children:Q.name}),T.jsx(cre,{onClick:()=>le(Q.id),isDisabled:_})]})},Q.id))}),T.jsxs(vs,{isOpen:L,onClose:F,size:"md",children:[T.jsx(Ts,{backdropFilter:"blur(4px)"}),T.jsxs(Ss,{bg:"gray.800",color:"white",children:[T.jsx(fo,{fontSize:"md",children:"Tag System Administration"}),T.jsx(zs,{}),T.jsxs(bs,{children:[T.jsx(at,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&T.jsxs(Vf,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[T.jsx(Ff,{}),T.jsxs(at,{fontSize:"sm",children:["Tags initialized. Created: ",T.jsx("b",{children:I.created}),", Skipped: ",T.jsx("b",{children:I.skipped})]})]}),T.jsx(Yn,{colorScheme:"blue",onClick:oe,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),T.jsx(nh,{children:T.jsx(Yn,{variant:"ghost",size:"sm",onClick:F,children:"Close"})})]})]})]})};Yoe.propTypes={spaceID:An.string.isRequired};const L8e=({isOpen:n,onClose:e})=>{const{spaceID:i}=Uo(),[a,l]=N.useState(0),[u,f]=N.useState(""),[_,E]=N.useState(""),[b,C]=N.useState(!1),[I,O]=N.useState(null),[L,M]=N.useState(null),[F,z]=N.useState(!1),[X,K]=N.useState(0),[ne,oe]=N.useState(null),ae=N.useRef(null),[le,Y]=N.useState(null),[Z,Q]=N.useState(null),[ie,de]=N.useState(!1),[ue,pe]=N.useState(0),[ke,xe]=N.useState(null),Fe=N.useRef(null),[Oe,we]=N.useState(null),[Se,Be]=N.useState(null),[Ee,Ce]=N.useState(!1),[Pe,Me]=N.useState(0),[ze,He]=N.useState(null),qe=N.useRef(null),[nt,Ze]=N.useState([]),[gt,sn]=N.useState([]),[ut,kt]=N.useState(!1),[ct,Mt]=N.useState([]),[fn,zt]=N.useState(null),[Te,Ve]=N.useState(!1),[$e,Et]=N.useState(!0),[vt,St]=N.useState(!1),[Wt,dn]=N.useState(!1),[En,tn]=N.useState(""),[wt,sr]=N.useState(""),[xt,qt]=N.useState(""),[br,wi]=N.useState(!1),{setHLSStreamUrl:Cs,savedStreamData:cr}=_oe(),zn=dc();N.useEffect(()=>{n&&i&&ra()},[n,i]);const ra=async()=>{try{const ft=await td(i);ft.logoUrl&&oe(ft.logoUrl),ft.backgroundUrl&&xe(ft.backgroundUrl),ft.videoBackgroundUrl&&He(ft.videoBackgroundUrl),ft.voiceDisabled!==void 0&&Ve(ft.voiceDisabled),ft.accessibleToAllUsers!==void 0&&Et(ft.accessibleToAllUsers),f(ft.name||""),E(ft.description||"");try{const hn=await hoe(i);if(hn){tn(hn.streamUrl||""),sr(hn.rtmpUrl||""),qt(hn.streamKey||"");const Pr=hn.enabled===!0;dn(Pr),$.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:Pr,rawValue:hn.enabled})}else dn(!1),$.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(hn){if($.error("Error fetching stream data directly:",hn),cr){tn(cr.streamUrl||""),sr(cr.rtmpUrl||""),qt(cr.streamKey||"");const Pr=cr.enabled===!0;dn(Pr),$.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:Pr,rawValue:cr.enabled})}else dn(!1),$.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}Hs(ft)}catch(ft){$.error("Error fetching space data:",ft),zn({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};N.useEffect(()=>{if(cr){if(!br){tn(cr.streamUrl||""),sr(cr.rtmpUrl||""),qt(cr.streamKey||"");const ft=cr.enabled===!0;dn(ft),$.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:ft,rawValue:cr.enabled})}}else n&&!br&&$.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[cr,br,n]);const Hs=async ft=>{if(i&&n){kt(!0);try{const hn=_k(),Pr=`space_${i}_owners`,Ci=GV(iu(hn,"users"),NJ("groups","array-contains",Pr)),Al=await ed(Ci),$i=[];for(const xi of Al.docs){const as=xi.data(),vn=await su(xi.id);$i.push({uid:xi.id,email:as.email,displayName:as.displayName||vn.Nickname||"Unknown User",photoURL:as.photoURL||vn.photoURL,firstName:vn.firstName,lastName:vn.lastName})}Ze($i);const Pl=`space_${i}_hosts`,Bo=GV(iu(hn,"users"),NJ("groups","array-contains",Pl)),cu=await ed(Bo),Ol=[];for(const xi of cu.docs){const as=xi.data(),vn=await su(xi.id);Ol.push({uid:xi.id,email:as.email,displayName:as.displayName||vn.Nickname||"Unknown User",photoURL:as.photoURL||vn.photoURL,firstName:vn.firstName,lastName:vn.lastName})}sn(Ol);const sa=iu(hn,`spaces/${i}/BannedUsers`),lu=await ed(sa),fc=[];for(const xi of lu.docs){const as=xi.id;try{const vn=await su(as);fc.push({uid:as,displayName:(vn==null?void 0:vn.Nickname)||as,firstName:vn==null?void 0:vn.firstName,lastName:vn==null?void 0:vn.lastName,photoURL:vn==null?void 0:vn.photoURL})}catch{fc.push({uid:as,displayName:as})}}Mt(fc)}catch(hn){$.error("Error fetching space users:",hn),zn({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{kt(!1)}}};N.useEffect(()=>{i&&n&&a===4&&Hs()},[i,n,a]);const io=ft=>{const hn=ft.target.files[0];if(hn){if(!hn.type.startsWith("image/")){zn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}O(hn);const Pr=new FileReader;Pr.onloadend=()=>{M(Pr.result)},Pr.readAsDataURL(hn)}},Vc=ft=>{const hn=ft.target.files[0];if(hn){if(!hn.type.startsWith("image/")){zn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}Y(hn);const Pr=new FileReader;Pr.onloadend=()=>{Q(Pr.result)},Pr.readAsDataURL(hn)}},Rs=ft=>{const hn=ft.target.files[0];if(hn){if(!hn.type.startsWith("video/")){zn({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const Pr=5*1024*1024;if(hn.size>Pr){zn({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}we(hn);const Ci=new FileReader;Ci.onloadend=()=>{Be(Ci.result)},Ci.readAsDataURL(hn)}},Ma=async()=>{if(!I){zn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{z(!0);const ft=setInterval(()=>{K(Pr=>{const Ci=Pr+10;return Ci>=90?90:Ci})},300),hn=await aze(i,I);clearInterval(ft),K(100),oe(hn),zn({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{O(null),M(null),K(0),z(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:hn}}))}catch(ft){console.error("Error uploading logo:",ft),zn({title:"Upload failed",description:ft.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),z(!1),K(0)}},Fo=async()=>{if(!le){zn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{de(!0);const ft=setInterval(()=>{pe(Pr=>{const Ci=Pr+10;return Ci>=90?90:Ci})},300),hn=await lze(i,le);clearInterval(ft),pe(100),xe(hn),zn({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Y(null),Q(null),pe(0),de(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:hn}}))}catch(ft){console.error("Error uploading background:",ft),zn({title:"Upload failed",description:ft.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),de(!1),pe(0)}},Ua=async()=>{if(ne)try{z(!0),await cze(i),oe(null),zn({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),z(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(ft){console.error("Error deleting logo:",ft),zn({title:"Deletion failed",description:ft.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),z(!1)}},hc=async()=>{if(ke)try{de(!0),await uze(i),xe(null),zn({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),de(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(ft){console.error("Error deleting background:",ft),zn({title:"Deletion failed",description:ft.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),de(!1)}},Rl=async()=>{if(!Oe){zn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{Ce(!0);const ft=setInterval(()=>{Me(Pr=>{const Ci=Pr+10;return Ci>=90?90:Ci})},300),hn=await pze(i,Oe);clearInterval(ft),Me(100),He(hn),zn({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{we(null),Be(null),Me(0),Ce(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:hn}}))}catch(ft){console.error("Error uploading video background:",ft),zn({title:"Upload failed",description:ft.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),Ce(!1),Me(0)}},Va=async()=>{if(ze)try{Ce(!0),await fze(i),He(null),zn({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),Ce(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(ft){console.error("Error deleting video background:",ft),zn({title:"Deletion failed",description:ft.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),Ce(!1)}},pc=()=>{ae.current&&ae.current.click()},mo=()=>{Fe.current&&Fe.current.click()},Di=()=>{qe.current&&qe.current.click()},os=async()=>{St(!0);try{await q4(i,{voiceDisabled:!Te}),Ve(!Te),zn({title:"Settings Updated",description:`Voice chat has been ${Te?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(ft){$.error("Error updating voice settings:",ft),zn({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{St(!1)}},ia=async()=>{St(!0);try{await hze(i,!$e),Et(!$e),zn({title:"Settings Updated",description:`Space is now ${$e?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(ft){$.error("Error updating accessibility settings:",ft),zn({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{St(!1)}},Il=async()=>{if(i){C(!0);try{const ft=_k(),hn=Sr(ft,"spaces",i);await Mo(hn,{name:u,description:_}),zn({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:u,description:_}}))}catch(ft){$.error("Error updating space details:",ft),zn({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},Fa=async()=>{if(i){wi(!0);try{const ft={enabled:Wt,streamUrl:En,rtmpUrl:wt,streamKey:xt,playerIndex:"0",updatedAt:new Date().toISOString()};$.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Wt,url:En,hasRtmp:!!wt,hasKey:!!xt});try{await YV(i,ft),$.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(hn){throw $.error("SpaceManageModal: Error updating stream settings directly in Firebase:",hn),hn}await Cs(En,0,{enabled:Wt,rtmpUrl:wt,streamKey:xt}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Wt,spaceId:i}})),zn({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Wt?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{ra()},500)}catch(ft){$.error("Error updating stream settings:",ft),zn({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{wi(!1)}}},jo=async ft=>{try{zt(ft);const hn=_k();await lBe(Sr(hn,`spaces/${i}/BannedUsers`,ft));const Pr=Sr(hn,"users",ft),Ci=`space_${i}_banned`;await Mo(Pr,{groups:Wse(Ci)}),Mt(Al=>Al.filter($i=>$i.uid!==ft)),zn({title:"User Unbanned",description:"User can now re-enter this space.",status:"success",duration:3e3,isClosable:!0})}catch(hn){$.error("Error unbanning user:",hn),zn({title:"Error",description:"Failed to unban user",status:"error",duration:3e3,isClosable:!0})}finally{zt(null)}};return T.jsxs(vs,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[T.jsx(Ts,{backdropFilter:"blur(4px)"}),T.jsxs(Ss,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[T.jsx(fo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),T.jsx(zs,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),T.jsx(bs,{p:0,display:"flex",overflow:"hidden",children:T.jsxs(T0,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",width:"100%",height:"100%",children:[T.jsxs(w0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:qoe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Details"})]}),T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:Ry,mb:1}),T.jsx(at,{fontSize:"xs",children:"Logo"})]}),T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:S8e,mb:1}),T.jsx(at,{fontSize:"xs",children:"Background"})]}),T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:T8e,mb:1}),T.jsx(at,{fontSize:"xs",children:"Settings"})]}),T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:vQ,mb:1}),T.jsx(at,{fontSize:"xs",children:"Users"})]}),T.jsxs(Oa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(mn,{as:KS,mb:1}),T.jsx(at,{fontSize:"xs",children:"Stream"})]})]}),T.jsxs(VC,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),T.jsxs(ai,{spacing:4,align:"stretch",children:[T.jsxs(Br,{children:[T.jsx(ns,{fontSize:"xs",children:"Space Name"}),T.jsx(Gi,{value:u,onChange:ft=>f(ft.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),T.jsxs(Br,{children:[T.jsx(ns,{fontSize:"xs",children:"Description"}),T.jsx(lre,{value:_,onChange:ft=>E(ft.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),T.jsxs(Br,{children:[T.jsx(ns,{fontSize:"xs",children:"Space Tags"}),T.jsx(yt,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?T.jsx(Yoe,{spaceID:i}):T.jsxs(Vf,{status:"warning",variant:"subtle",borderRadius:"md",children:[T.jsx(Ff,{}),T.jsx(aC,{fontSize:"sm",children:"Space ID missing"}),T.jsx(cC,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),T.jsx(Yn,{colorScheme:"blue",size:"sm",onClick:Il,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),T.jsx(at,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ne||L)&&T.jsxs(is,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ne&&T.jsxs(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),T.jsx(up,{src:ne,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),T.jsx(Yn,{mt:3,colorScheme:"red",leftIcon:T.jsx(mn,{as:u0}),onClick:Ua,isLoading:F,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),L&&T.jsxs(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),T.jsx(up,{src:L,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),T.jsxs(Br,{children:[T.jsx(ns,{fontSize:"xs",children:"Upload New Logo"}),T.jsx(Gi,{type:"file",accept:"image/*",onChange:io,ref:ae,display:"none"}),F&&T.jsxs(yt,{mt:3,mb:3,children:[T.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",X,"%"]}),T.jsx(Vy,{value:X,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),T.jsxs(hr,{mt:3,spacing:3,children:[T.jsx(Yn,{colorScheme:"blue",leftIcon:T.jsx(mn,{as:Ry}),onClick:pc,isDisabled:F,size:"sm",variant:"outline",children:"Browse"}),T.jsx(Yn,{colorScheme:"green",leftIcon:T.jsx(mn,{as:wk}),onClick:Ma,isLoading:F,loadingText:"Uploading...",isDisabled:!I||F,size:"sm",children:"Upload"})]}),T.jsx(t0,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Background"}),T.jsx(at,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),T.jsxs(T0,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[T.jsxs(w0,{children:[T.jsxs(Oa,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[T.jsx(mn,{as:Ry,mr:2}),"Image"]}),T.jsxs(Oa,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[T.jsx(mn,{as:EQ,mr:2}),"Video (max 5MB)"]})]}),T.jsxs(VC,{mt:4,children:[T.jsxs(Oc,{p:0,children:[(ke||Z)&&T.jsxs(is,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ke&&T.jsxs(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),T.jsx(up,{src:ke,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),T.jsx(Yn,{mt:3,colorScheme:"red",leftIcon:T.jsx(mn,{as:u0}),onClick:hc,isLoading:ie,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),Z&&T.jsxs(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),T.jsx(up,{src:Z,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),T.jsxs(Br,{children:[T.jsx(ns,{fontSize:"xs",children:"Upload New Background Image"}),T.jsx(Gi,{type:"file",accept:"image/*",onChange:Vc,ref:Fe,display:"none"}),ie&&T.jsxs(yt,{mt:3,mb:3,children:[T.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",ue,"%"]}),T.jsx(Vy,{value:ue,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),T.jsxs(hr,{mt:3,spacing:3,children:[T.jsx(Yn,{colorScheme:"blue",leftIcon:T.jsx(mn,{as:Ry}),onClick:mo,isDisabled:ie,size:"sm",variant:"outline",children:"Browse"}),T.jsx(Yn,{colorScheme:"green",leftIcon:T.jsx(mn,{as:wk}),onClick:Fo,isLoading:ie,loadingText:"Uploading...",isDisabled:!le||ie,size:"sm",children:"Upload"})]}),T.jsx(t0,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),T.jsxs(Oc,{p:0,children:[(ze||Se)&&T.jsxs(is,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ze&&T.jsxs(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),T.jsx(yt,{maxH:"160px",overflow:"hidden",position:"relative",children:T.jsx("video",{src:ze,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),T.jsx(Yn,{mt:3,colorScheme:"red",leftIcon:T.jsx(mn,{as:u0}),onClick:Va,isLoading:Ee,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Se&&T.jsxs(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),T.jsx(yt,{maxH:"160px",overflow:"hidden",children:T.jsx("video",{src:Se,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),T.jsxs(Br,{children:[T.jsx(ns,{fontSize:"xs",children:"Upload New Video Background"}),T.jsx(Gi,{type:"file",accept:"video/*",onChange:Rs,ref:qe,display:"none"}),Ee&&T.jsxs(yt,{mt:3,mb:3,children:[T.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",Pe,"%"]}),T.jsx(Vy,{value:Pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),T.jsxs(hr,{mt:3,spacing:3,children:[T.jsx(Yn,{colorScheme:"blue",leftIcon:T.jsx(mn,{as:EQ}),onClick:Di,isDisabled:Ee,size:"sm",variant:"outline",children:"Browse"}),T.jsx(Yn,{colorScheme:"green",leftIcon:T.jsx(mn,{as:wk}),onClick:Rl,isLoading:Ee,loadingText:"Uploading...",isDisabled:!Oe||Ee,size:"sm",children:"Upload"})]}),T.jsx(t0,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),T.jsx(at,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),T.jsxs(ai,{spacing:4,align:"stretch",children:[T.jsx(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:T.jsxs(hr,{justify:"space-between",align:"center",children:[T.jsxs(yt,{children:[T.jsxs(hr,{mb:1,spacing:2,children:[T.jsxs(yt,{position:"relative",w:"16px",h:"16px",children:[T.jsx(mn,{as:I8e,color:Te?"red.400":"green.400"}),Te&&T.jsx(yt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",children:Te?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),T.jsx(jf,{isChecked:!Te,onChange:os,colorScheme:"green",size:"md",isDisabled:vt})]})}),T.jsx(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:T.jsxs(hr,{justify:"space-between",align:"center",children:[T.jsxs(yt,{children:[T.jsxs(hr,{mb:1,spacing:2,children:[T.jsx(yt,{position:"relative",w:"16px",h:"16px",children:T.jsx(mn,{as:vQ,color:$e?"green.400":"red.400"})}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",children:$e?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),T.jsx(at,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),T.jsx(jf,{isChecked:$e,onChange:ia,colorScheme:"green",size:"md",isDisabled:vt})]})}),T.jsxs(Vf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[T.jsx(Ff,{color:"blue.300"}),T.jsxs(yt,{children:[T.jsx(aC,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),T.jsx(cC,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),T.jsx(at,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),ut?T.jsx(is,{justify:"center",align:"center",h:"200px",children:T.jsx(oh,{color:"blue.300"})}):T.jsxs(ai,{spacing:4,align:"stretch",children:[T.jsxs(yt,{children:[T.jsxs(hr,{mb:2,children:[T.jsx(mn,{as:v8e,color:"green.400"}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Owners"}),T.jsx(Yd,{colorScheme:"green",ml:2,children:nt.length})]}),T.jsx(yt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:nt.length===0?T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):T.jsx(ai,{spacing:1,align:"stretch",children:nt.map(ft=>T.jsxs(hr,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[T.jsx(eh,{size:"xs",src:ft.photoURL,name:ft.displayName}),T.jsxs(yt,{children:[T.jsx(at,{fontSize:"xs",children:ft.displayName}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:ft.firstName&&ft.lastName?`${ft.firstName} ${ft.lastName}`:"Full name not available"})]}),T.jsx(s0,{}),T.jsx(Yd,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},ft.uid))})})]}),T.jsxs(yt,{children:[T.jsxs(hr,{mb:2,children:[T.jsx(mn,{as:w8e,color:"purple.400"}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),T.jsx(Yd,{colorScheme:"purple",ml:2,children:gt.length})]}),T.jsx(yt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:gt.length===0?T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):T.jsx(ai,{spacing:1,align:"stretch",children:gt.map(ft=>T.jsxs(hr,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[T.jsx(eh,{size:"xs",src:ft.photoURL,name:ft.displayName}),T.jsxs(yt,{children:[T.jsx(at,{fontSize:"xs",children:ft.displayName}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:ft.firstName&&ft.lastName?`${ft.firstName} ${ft.lastName}`:"Full name not available"})]}),T.jsx(s0,{}),T.jsx(Yd,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},ft.uid))})})]}),T.jsxs(yt,{children:[T.jsxs(hr,{mb:2,children:[T.jsx(mn,{as:C8e,color:"red.400"}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Banned Users"}),T.jsx(Yd,{colorScheme:"red",ml:2,children:ct.length})]}),T.jsx(yt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ct.length===0?T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:"No banned users"}):T.jsx(ai,{spacing:1,align:"stretch",children:ct.map(ft=>T.jsxs(hr,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[T.jsx(eh,{size:"xs",src:ft.photoURL,name:ft.displayName}),T.jsxs(yt,{children:[T.jsx(at,{fontSize:"xs",children:ft.displayName}),ft.firstName&&T.jsxs(at,{fontSize:"xs",color:"whiteAlpha.600",children:[ft.firstName," ",ft.lastName]})]}),T.jsx(s0,{}),T.jsxs(hr,{spacing:2,children:[T.jsx(Yn,{size:"xs",colorScheme:"green",isLoading:fn===ft.uid,onClick:()=>jo(ft.uid),leftIcon:T.jsx(mn,{as:R8e}),children:"Unban"}),T.jsx(Yd,{colorScheme:"red",variant:"solid",fontSize:"2xs",children:"Banned"})]})]},ft.uid))})})]})]})]}),T.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),T.jsxs(ai,{spacing:4,align:"stretch",children:[T.jsx(yt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:T.jsxs(hr,{justify:"space-between",align:"center",children:[T.jsx(yt,{children:T.jsxs(hr,{mb:1,spacing:2,children:[T.jsx(yt,{position:"relative",w:"16px",h:"16px",children:T.jsx(mn,{as:KS,color:Wt?"green.400":"red.400"})}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),T.jsx(jf,{isChecked:Wt,onChange:async()=>{const ft=!Wt;dn(ft),wi(!0);try{$.log("SpaceManageModal: Auto-saving streaming enabled state:",ft);const hn={enabled:ft,streamUrl:En||"",rtmpUrl:wt||"",streamKey:xt||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await YV(i,hn),$.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(Pr){throw $.error("SpaceManageModal: Error updating streaming state directly in Firebase:",Pr),Pr}await Cs(En,0,{enabled:ft,rtmpUrl:wt,streamKey:xt}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:ft,spaceId:i}})),zn({title:"Streaming "+(ft?"Enabled":"Disabled"),description:`Streaming is now ${ft?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(hn){$.error("Error auto-saving streaming state:",hn),dn(!ft),zn({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{wi(!1),setTimeout(()=>{ra()},500)}},colorScheme:"green",size:"md",isDisabled:br})]})}),T.jsxs(yt,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),T.jsxs(Br,{mb:4,children:[T.jsx(ns,{fontSize:"xs",children:"Stream URL"}),T.jsx(Gi,{value:En,onChange:ft=>tn(ft.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:br})]}),T.jsx(xy,{my:3,borderColor:"whiteAlpha.200"}),T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),T.jsxs(Br,{mb:3,children:[T.jsx(ns,{fontSize:"xs",children:"RTMP URL"}),T.jsx(Gi,{value:wt,onChange:ft=>sr(ft.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:br})]}),T.jsxs(Br,{mb:3,children:[T.jsx(ns,{fontSize:"xs",children:"Stream Key"}),T.jsx(Gi,{value:xt,onChange:ft=>qt(ft.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:br,type:"password"})]})]}),T.jsx(Yn,{colorScheme:"blue",size:"sm",onClick:Fa,isLoading:br,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Wt?"inline-flex":"none",children:"Save Stream Settings"}),T.jsxs(Vf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[T.jsx(Ff,{color:"blue.300"}),T.jsxs(yt,{children:[T.jsx(aC,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),T.jsx(cC,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},Xoe="spaces",Joe="portals",M8e=async(n,e,i)=>{try{const a=Sr(Qn,Xoe,n,Joe,e),l={...i,sourceSpaceId:n,portalId:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Fg(a,l),$.log(`Saved portal ${e} to space ${n}`),!0}catch(a){return $.error("Error saving portal:",a),!1}},SQ=async(n,e,i)=>{try{const a=Sr(Qn,Xoe,n,Joe,e),l={...i,updatedAt:new Date().toISOString()};return await Mo(a,l),$.log(`Updated portal ${e} in space ${n}`),!0}catch(a){return $.error("Error updating portal:",a),!1}},U8e=({isOpen:n,onClose:e,currentSpaceId:i})=>{const[a,l]=N.useState([]),[u,f]=N.useState(!1),[_,E]=N.useState(null),[b,C]=N.useState(!1),I=dc(),{placePortal:O,directPlacePortal:L}=voe(),M=Tg("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),F=Tg("gray.800","white"),z=Tg("gray.200","whiteAlpha.200"),X=Tg("gray.200","whiteAlpha.300");N.useEffect(()=>{n&&(async()=>{f(!0),E(null),l([]);try{const ae=iu(Qn,"spaces"),Y=(await ed(ae)).docs.map(Z=>({id:Z.id,name:Z.data().name||`Space ID: ${Z.id}`}));l(Y)}catch(ae){$.error("PortalAdminModal: Error fetching spaces:",ae),E("Failed to load spaces. Please check your connection and try again.")}f(!1)})()},[n]);const K=async(oe,ae)=>{if(!i){$.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),I({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}C(!0),$.log(`PortalAdminModal: Attempting to place portal to ${ae} (${oe}) in space ${i}`);try{const le=await td(oe);if(!le)throw new Error(`Failed to fetch target space data for ${oe}`);const Y=le.backgroundUrl||le.backgroundGsUrl;Y||$.warn(`PortalAdminModal: No background image URL found for target space: ${oe}`);const Z="PortalObjectPrefab",Q={x:0,y:1.5,z:0},ie={x:0,y:0,z:0},de={x:1,y:1,z:1},ue=`portal_${i}_${oe}_${Date.now()}`;if(!await M8e(i,ue,{type:"portal",targetSpaceId:oe,targetSpaceName:ae,portalId:ue,position:Q,rotation:ie,scale:de,prefabName:Z,initialImageUrl:Y})){$.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),I({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),C(!1);return}$.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let xe=!1;try{const Fe={portalId:ue,prefabName:Z,position:Q,rotation:ie,scale:de,initialImageUrl:Y};xe=O(ue,Z,Q,ie,de,Y),xe||(xe=L(ue,Z,Q,ie,de,Y)),$.log("PortalAdminModal: Portal placement in Unity:",xe)}catch(Fe){$.error("PortalAdminModal: Error placing portal in Unity:",Fe)}xe?(I({title:"Portal Placed",description:`Portal to ${ae} created successfully.`,status:"success",duration:3e3,isClosable:!0}),e()):(I({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),e())}catch(le){$.error("PortalAdminModal: Error creating portal:",le),I({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{C(!1)}},ne=u||b;return T.jsxs(vs,{isOpen:n,onClose:e,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[T.jsx(Ts,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),T.jsxs(Ss,{bg:M,backdropFilter:"blur(18px)",color:F,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[T.jsx(fo,{borderBottom:"1px solid",borderColor:X,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),T.jsx(zs,{}),T.jsxs(bs,{p:6,children:[ne&&T.jsxs(ai,{justifyContent:"center",alignItems:"center",height:"200px",children:[T.jsx(oh,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),T.jsx(at,{mt:3,children:"Loading Spaces..."})]}),_&&T.jsxs(Vf,{status:"error",borderRadius:"md",variant:"subtle",children:[T.jsx(Ff,{}),_]}),!u&&!_&&a.length===0&&T.jsx(at,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!u&&!_&&a.length>0&&T.jsx(DN,{spacing:3,children:a.map(oe=>T.jsx(Ene,{p:3,borderRadius:"md",_hover:{bg:z,cursor:ne?"not-allowed":"pointer",transform:ne?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!ne&&K(oe.id,oe.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:ne?.7:1,pointerEvents:ne?"none":"auto",children:oe.name},oe.id))})]})]})]})},bQ=["Recent","Furniture","Objects","Upload","Portals"],V8e={Furniture:"chair",Objects:"misc"},F8e=({isOpen:n,onClose:e,settings:i})=>{const[a,l]=N.useState(bQ[0]),[u,f]=N.useState(""),[_,E]=N.useState(!1),[b,C]=N.useState(!1),[I,O]=N.useState([]),[L,M]=N.useState(!0),[F,z]=N.useState(null),{placeCatalogueItem:X}=Soe(),K=Tg("blue.500","blue.300"),ne=Tg("gray.500","gray.400"),oe=Tg("whiteAlpha.200","whiteAlpha.200");N.useEffect(()=>{n&&(async()=>{M(!0),z(null),O([]);try{const ue=iu(Qn,"catalogue"),pe=await ed(ue),ke=[];pe.forEach(xe=>{var we,Se;const Fe=xe.data(),Oe=["chair","misc"];Fe.glbUrl&&((we=Fe.categories)!=null&&we.some(Be=>Oe.includes(Be)))&&ke.push({id:xe.id,name:Fe.name||"Unnamed Item",thumbnail:((Se=Fe.thumbnail)==null?void 0:Se.src)||"https://via.placeholder.com/150",glbUrl:Fe.glbUrl,categories:Fe.categories})}),O(ke)}catch(ue){console.error("Error fetching catalogue items:",ue),z("Failed to load catalogue items. Please check your connection and try again.")}M(!1)})()},[n]);const ae=de=>{l(de),f(""),E(de==="Portals")},le=(de,ue)=>{const pe=V8e[ue];let ke=de;return pe&&(ke=ke.filter(xe=>{var Fe;return(Fe=xe.categories)==null?void 0:Fe.includes(pe)})),u&&(ke=ke.filter(xe=>xe.name.toLowerCase().includes(u.toLowerCase()))),ke},Y=["Furniture","Objects"].includes(a)?le(I,a):[],Z=async de=>{console.log(`Placing item: ${de.name}`);try{if(!de.glbUrl){console.error("Item is missing GLB URL");return}const ue=`item_${i.spaceID}_${Date.now()}`,pe={x:0,y:0,z:0},ke={x:0,y:0,z:0},xe={x:1,y:1,z:1},Fe={itemId:ue,name:de.name||"Unnamed Item",glbUrl:de.glbUrl,thumbnail:de.thumbnail||"https://via.placeholder.com/150",position:pe,rotation:ke,scale:xe,createdAt:Date.now(),updatedAt:Date.now(),categories:de.categories||[]};if(!Fe.glbUrl)throw new Error("GLB URL is required");await Fg(Sr(Qn,"spaces",i.spaceID,"catalogue",ue),Fe),X(ue,Fe.glbUrl,pe,ke,xe)?e():console.error("Failed to place item in Unity")}catch(ue){console.error("Error placing item:",ue)}},Q=()=>{C(!0)},ie=()=>{C(!1)};return T.jsxs(vs,{isOpen:n,onClose:e,size:"5xl",isCentered:!0,children:[T.jsx(Ts,{bg:"blackAlpha.600",backdropFilter:"blur(5px)"}),T.jsxs(Ss,{bg:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(15px)",color:"white",borderRadius:"xl",height:"85vh",maxHeight:"750px",width:"85vw",maxWidth:"1200px",overflow:"hidden",children:[T.jsx(fo,{pb:2,borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:_?"Create New Portal":"Content Catalogue"}),T.jsx(zs,{top:"14px"}),T.jsxs(bs,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[T.jsxs(hr,{spacing:4,p:4,borderBottom:"1px solid",borderColor:"whiteAlpha.300",overflowX:"auto",children:[bQ.filter(de=>de!=="Portals").map(de=>T.jsx(Yn,{variant:"ghost",size:"md",fontWeight:a===de?"semibold":"normal",color:a===de?"white":ne,bg:a===de?oe:"transparent",borderBottom:a===de?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:a!==de?"whiteAlpha.100":oe,color:"white"},onClick:()=>ae(de),px:4,whiteSpace:"nowrap",children:de},de)),T.jsx(s0,{}),T.jsx(Yn,{variant:"ghost",size:"md",fontWeight:a==="Portals"?"semibold":"normal",color:a==="Portals"?"white":ne,bg:a==="Portals"?oe:"transparent",borderBottom:a==="Portals"?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:a!=="Portals"?"whiteAlpha.100":oe,color:"white"},onClick:()=>ae("Portals"),px:4,whiteSpace:"nowrap",children:"Portals"},"Portals")]}),_&&a==="Portals"?T.jsx(yt,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:T.jsx(Yn,{size:"lg",colorScheme:"blue",onClick:Q,children:"Browse"})}):T.jsxs(T.Fragment,{children:[T.jsx(yt,{p:4,children:T.jsx(Gi,{placeholder:`Search in ${a}...`,value:u,onChange:de=>f(de.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),T.jsx(yt,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:T.jsx(Pj,{templateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:4,children:L?T.jsx(at,{color:"whiteAlpha.700",children:"Loading items..."}):Y.length>0?Y.map(de=>T.jsxs(yt,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>Z(de),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[T.jsx(yt,{bgImage:`url(${de.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"100px",mb:2,flexShrink:0}),T.jsx(at,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:de.name})]},de.id)):T.jsxs(at,{color:"whiteAlpha.700",children:[a==="Furniture"&&"No chairs found in the catalogue.",a==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(a)&&`No items found in "${a}"${u&&` matching "${u}"`}.`]})})})]})]})]}),T.jsx(U8e,{isOpen:b,onClose:ie,currentSpaceId:i==null?void 0:i.spaceID})]})},j8e=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=ch(),[a,l]=N.useState(!0),[u,f]=N.useState(!1),[_,E]=N.useState(!1),[b,C]=N.useState(!1),[I,O]=N.useState(!1),[L,M]=N.useState(!1),[F,z]=N.useState(!1),[X,K]=N.useState(null),[ne,oe]=N.useState(!1),[ae,le]=N.useState(!1),[Y,Z]=N.useState(!1),[Q,ie]=N.useState(!1),de=dc(),{user:ue}=N.useContext(ro),pe=(ue==null?void 0:ue.Nickname)||"Unknown",[ke,xe]=N.useState(!1),Fe=async()=>{if(ue!=null&&ue.uid&&e)try{const He=await su(ue.uid);let qe=!1,nt=!1;if(He.groups){const gt=`space_${e}_owners`,sn=`space_${e}_hosts`;qe=He.groups.includes(gt),nt=He.groups.includes(sn)}const Ze=await qse(ue.uid,"disruptiveAdmin");if(ie(Ze),K({rpmURL:He.rpmURL?He.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),le(qe||Ze),Z(nt),!qe&&!Ze&&ne){oe(!1);const gt=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(gt),de({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(He){console.error("Error fetching profile data:",He),le(!1),Z(!1),ie(!1)}else le(!1),Z(!1),ie(!1)};N.useEffect(()=>{Fe()},[ue==null?void 0:ue.uid,e,ne]),N.useEffect(()=>{const He=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",He),()=>{window.removeEventListener("PlayerInstantiated",He)}},[]),N.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&xe(window.agoraClient.voiceDisabled)}catch(nt){console.error("Error checking if voice is disabled:",nt)}})();const qe=nt=>{nt.detail&&typeof nt.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",nt.detail.voiceDisabled),xe(nt.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",qe),()=>{window.removeEventListener("SpaceVoiceSettingChanged",qe)}},[]);const Oe=()=>E(!_),we=()=>C(!b),Se=()=>{M(!L),Me()},Be=()=>{O(!1),Fe()},Ee=()=>{z(!1)},Ce=()=>{z(!0),Me()},Pe=He=>{He.stopPropagation(),typeof n=="function"&&($.log("CanvasMainMenu: Toggling player list"),n())},Me=()=>{f(!1)},ze=He=>{if(He.stopPropagation(),!ae){de({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const qe=!ne;oe(qe);const nt=new CustomEvent("editModeChanged",{detail:{enabled:qe}});window.dispatchEvent(nt),de({title:qe?"Edit Mode Enabled":"Edit Mode Disabled",description:qe?"You can now make changes to the scene.":"Scene editing is now disabled.",status:qe?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return T.jsxs(T.Fragment,{children:[T.jsxs(LN,{isOpen:u,onClose:()=>f(!1),children:[T.jsx(MN,{as:Nc,icon:T.jsx(DWe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:u?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:u?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!u)}),T.jsx(od,{containerRef:i,children:T.jsx(UN,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:T.jsxs(ai,{align:"stretch",spacing:4,children:[T.jsxs(hr,{children:[T.jsx(eh,{size:"md",src:X==null?void 0:X.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),T.jsxs(ai,{align:"start",spacing:0,children:[T.jsxs(hr,{children:[T.jsx(at,{fontWeight:"bold",children:pe}),ae&&!Q&&T.jsx(Bf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:T.jsx(yt,{display:"inline-block",children:T.jsx(mn,{as:rF,color:"green.400",boxSize:3})})}),!ae&&Y&&!Q&&T.jsx(Bf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:T.jsx(yt,{display:"inline-block",children:T.jsx(mn,{as:iF,color:"purple.400",boxSize:3})})}),Q&&T.jsx(Bf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:T.jsx(yt,{display:"inline-block",children:T.jsx(mn,{as:YWe,color:"blue.400",boxSize:3})})})]}),T.jsx(at,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),T.jsxs(hr,{spacing:4,justify:"center",children:[T.jsx(Nc,{icon:T.jsx(JWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:Pe}),ae&&T.jsx(Nc,{icon:T.jsx(zWe,{}),variant:"ghost",colorScheme:ne?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:ze}),!ne&&T.jsx(Nc,{icon:T.jsx(yt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"},isDisabled:!0}),ne&&T.jsx(Nc,{icon:T.jsx(BWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Catalogue",_hover:{bg:"whiteAlpha.200"},onClick:Ce}),T.jsx(Nc,{icon:T.jsx(yt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),T.jsx(xy,{borderColor:"whiteAlpha.300"}),T.jsxs(ai,{align:"stretch",spacing:2,children:[ae&&T.jsxs(hr,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},justify:"space-between",children:[T.jsx(at,{fontSize:"md",children:"Edit Mode"}),T.jsx(jf,{id:"edit-mode-toggle",isChecked:ne,onChange:ze,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:ne?"green.500":"black"}}})]}),ae&&T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Se,children:"Manage Space"}),ue&&e&&!ke&&T.jsx(g8e,{onClose:Me}),T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Oe,children:"Settings"}),T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:we,children:"Controls"}),T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&T.jsx(_8e,{open:b,onClose:we}),_&&T.jsx(E8e,{open:_,onClose:Oe}),I&&T.jsx(zoe,{open:I,onClose:Be}),T.jsx(L8e,{isOpen:L,onClose:Se}),T.jsx(F8e,{isOpen:F,onClose:Ee,settings:{spaceID:e}})]})},B8e=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:a})=>{const{spaceID:l}=Uo(),u=Mc(),f=dc(),_=N.useRef(null),E=N.useRef(null),b=N.useRef(),[C,I]=N.useState(null),[O,L]=N.useState(""),[M,F]=N.useState(!1),[z,X]=N.useState(0),[K,ne]=N.useState(null),[oe,ae]=N.useState(!0),[le,Y]=N.useState(!1),[Z,Q]=N.useState(!1),[ie,de]=N.useState(0),[ue,pe]=N.useState("image"),[ke,xe]=N.useState(""),[Fe,Oe]=N.useState(!1);N.useEffect(()=>{(async()=>{if(n&&i&&l){ae(!0);try{const gt=await Df(l,i);if(gt&&(gt.imageUrl||gt.videoUrl)){ne(gt);const sn=gt.mediaType==="video";pe(sn?"video":"image"),Oe(gt.displayAsVideo||!1),sn&&gt.videoUrl&&(xe(gt.videoUrl),de(1))}else ne(null)}catch(gt){$.error("Error fetching existing image:",gt),ne(null)}finally{ae(!1)}}})()},[n,i,l]),N.useEffect(()=>{n||(I(null),L(""),X(0),xe(""))},[n]);const we=N.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),Q(!0)},[]),Se=N.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),Q(!1)},[]),Be=N.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation()},[]),Ee=N.useCallback(Ze=>{if(Ze.preventDefault(),Ze.stopPropagation(),Q(!1),Ze.dataTransfer.files&&Ze.dataTransfer.files.length>0){const gt=Ze.dataTransfer.files[0];Ce(gt)}},[]);N.useEffect(()=>{const Ze=E.current;if(Ze)return Ze.addEventListener("dragenter",we),Ze.addEventListener("dragleave",Se),Ze.addEventListener("dragover",Be),Ze.addEventListener("drop",Ee),()=>{Ze.removeEventListener("dragenter",we),Ze.removeEventListener("dragleave",Se),Ze.removeEventListener("dragover",Be),Ze.removeEventListener("drop",Ee)}},[we,Se,Be,Ee]);const Ce=Ze=>{if(!Ze)return;if(!Ze.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(Ze);const gt=new FileReader;gt.onloadend=()=>{L(gt.result)},gt.readAsDataURL(Ze)},Pe=Ze=>{const gt=Ze.target.files[0];Ce(gt)},Me=async Ze=>{const gt=Ze.target.checked;if(Oe(gt),K)try{await Nze(l,i,gt),gt?u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),ne({...K,displayAsVideo:gt}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${gt?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),$.log(`Updated display mode for media screen ${i} to ${gt?"video":"image"}`),a&&a({type:"update",mediaScreenId:i,displayAsVideo:gt})}catch(sn){$.error("Error updating display mode:",sn),f({title:"Update failed",description:sn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),Oe(!gt)}},ze=async()=>{if(ue==="image"&&!C){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(ue==="video"&&!ke){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{F(!0);const Ze=setInterval(()=>{X(kt=>{const ct=kt+10;return ct>=90?90:ct})},300);let gt;ue==="image"?gt=await nQ(l,i,C,{mediaType:ue,displayAsVideo:Fe}):(gt=ke,await nQ(l,i,null,{mediaType:"video",directUrl:ke,displayAsVideo:Fe})),clearInterval(Ze),X(100);let sn=null,ut=null;ue==="image"?(sn=Fe?null:gt,ut=(K==null?void 0:K.videoUrl)||null):(sn=!Fe&&(K!=null&&K.imageUrl)?K.imageUrl:null,ut=gt),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:sn,videoUrl:ut,mediaType:ue,displayAsVideo:Fe}),$.log(`Uploaded and sent ${ue} for media screen ${i} (display as video: ${Fe})`),a&&a({type:"upload",mediaScreenId:i,imageUrl:ue==="image"?gt:K==null?void 0:K.imageUrl,videoUrl:ue==="video"?gt:K==null?void 0:K.videoUrl,mediaType:ue,displayAsVideo:Fe}),f({title:"Upload successful",description:`The ${ue} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),L(""),F(!1),X(0),e()},1e3)}catch(Ze){$.error(`Error uploading ${ue}:`,Ze),f({title:"Upload failed",description:Ze.message||`An error occurred while uploading the ${ue}`,status:"error",duration:5e3,isClosable:!0}),F(!1),X(0)}},He=async()=>{Y(!1);try{F(!0),await kze(l,i),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:ue==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:ue==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),$.log(`Deleted ${ue} for media screen ${i}`),a&&a({type:"delete",mediaScreenId:i}),f({title:`${ue==="image"?"Image":"Video"} deleted`,description:`The ${ue} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ne(null),F(!1),xe(""),Oe(!1),setTimeout(()=>{e()},500)}catch(Ze){$.error(`Error deleting ${ue}:`,Ze),f({title:"Deletion failed",description:Ze.message||`An error occurred while deleting the ${ue}`,status:"error",duration:5e3,isClosable:!0}),F(!1)}},qe=()=>{M||(I(null),L(""),X(0),e())},nt=Ze=>{de(Ze),pe(Ze===0?"image":"video")};return T.jsxs(T.Fragment,{children:[T.jsxs(vs,{isOpen:n,onClose:qe,size:"xl",children:[T.jsx(Ts,{backdropFilter:"blur(10px)"}),T.jsxs(Ss,{bg:"gray.800",color:"white",maxW:"900px",children:[T.jsx(fo,{children:"Media Screen Content"}),T.jsx(zs,{isDisabled:M}),T.jsxs(yt,{px:6,pb:2,children:[T.jsxs(is,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[T.jsxs(hr,{spacing:4,children:[T.jsx(at,{fontWeight:"medium",children:"Display as:"}),T.jsxs(hr,{spacing:2,children:[T.jsx(mn,{as:Ry,color:Fe?"gray.400":"green.300"}),T.jsx(jf,{colorScheme:"purple",size:"md",isChecked:Fe,onChange:Me}),T.jsx(mn,{as:KS,color:Fe?"purple.300":"gray.400"})]})]}),T.jsx(Yd,{colorScheme:Fe?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:Fe?"Video Output":"Image Output"})]}),T.jsxs(at,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",T.jsx("strong",{children:i})]}),T.jsx(at,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),T.jsx(xy,{mb:4})]}),T.jsx(bs,{children:T.jsxs(is,{children:[T.jsx(T0,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:ie,onChange:nt,h:"100%",minW:"120px",mr:4,children:T.jsxs(w0,{children:[T.jsxs(Oa,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[T.jsx(mn,{as:Ry,mr:2})," Image"]}),T.jsxs(Oa,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[T.jsx(mn,{as:KS,mr:2})," Video"]})]})}),T.jsx(yt,{flex:"1",children:oe?T.jsx(is,{justify:"center",align:"center",h:"150px",children:T.jsx(oh,{size:"xl",color:"blue.400"})}):T.jsxs(T.Fragment,{children:[T.jsx(yt,{children:ie===0?T.jsxs(ai,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&ue==="image"&&T.jsxs(yt,{children:[T.jsx(at,{fontWeight:"semibold",mb:2,children:"Current Image:"}),T.jsxs(is,{children:[T.jsx(yt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:T.jsx(up,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),T.jsxs(ai,{align:"flex-start",spacing:2,children:[T.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),T.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),T.jsx(Yn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:T.jsx(mn,{as:u0}),onClick:()=>Y(!0),isDisabled:M,children:"Delete"})]})]}),T.jsx(xy,{my:4})]}),T.jsx(at,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&ue==="image"?"Replace with new image:":"Upload new image:"}),T.jsxs(yt,{ref:E,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Z?"blue.400":"gray.500",bg:Z?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>_.current.click(),children:[O?T.jsx(yt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:T.jsx(up,{src:O,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):T.jsxs(ai,{spacing:2,children:[T.jsx(mn,{as:wk,boxSize:"24px",color:"gray.400"}),T.jsx(at,{children:"Drag and drop an image here, or click to browse"}),T.jsx(at,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),T.jsx(Gi,{type:"file",accept:"image/*",onChange:Pe,ref:_,display:"none"})]}),C&&T.jsxs(at,{fontSize:"sm",children:["Selected file: ",C.name," (",Math.round(C.size/1024)," KB)"]})]}):T.jsxs(ai,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&ue==="video"&&T.jsxs(yt,{children:[T.jsx(at,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),T.jsxs(is,{children:[T.jsx(yt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:T.jsx(at,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),T.jsxs(ai,{align:"flex-start",spacing:2,children:[T.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),T.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),T.jsx(Yn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:T.jsx(mn,{as:u0}),onClick:()=>Y(!0),isDisabled:M,children:"Delete"})]})]}),T.jsx(xy,{my:4})]}),T.jsx(at,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&ue==="video"?"Replace with new video:":"Add video URL:"}),T.jsx(yt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:T.jsxs(hr,{children:[T.jsx(mn,{as:qoe,color:"blue.300"}),T.jsx(at,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),T.jsxs(Br,{children:[T.jsx(ns,{fontSize:"sm",children:"Video URL"}),T.jsx(Gi,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:ke,onChange:Ze=>xe(Ze.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),T.jsx(at,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),T.jsxs(yt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[T.jsxs(hr,{children:[T.jsx(mn,{as:KS,color:"blue.300"}),T.jsx(at,{fontWeight:"medium",children:"Video Support"})]}),T.jsx(at,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),T.jsx(at,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),ke&&T.jsxs(yt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[T.jsxs(hr,{mb:2,children:[T.jsx(mn,{as:b8e,color:"blue.300"}),T.jsx(at,{fontWeight:"medium",children:"URL Preview"})]}),T.jsx(at,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:ke}),T.jsx(at,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),M&&T.jsxs(yt,{mt:4,children:[T.jsxs(at,{mb:2,children:["Uploading: ",z,"%"]}),T.jsx(Vy,{value:z,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),T.jsxs(nh,{children:[T.jsx(Yn,{variant:"ghost",mr:3,onClick:qe,isDisabled:M,children:"Cancel"}),T.jsx(Yn,{colorScheme:"blue",onClick:ze,isLoading:M,loadingText:"Uploading",isDisabled:ue==="image"&&!C||ue==="video"&&!ke||M||oe,leftIcon:T.jsx(mn,{as:ue==="image"?Ry:KS}),size:"lg",px:6,children:ue==="image"?"Upload Image":"Save Video URL"})]})]})]}),T.jsx(Q2e,{isOpen:le,leastDestructiveRef:b,onClose:()=>Y(!1),children:T.jsx(Ts,{children:T.jsxs(Z2e,{bg:"gray.800",color:"white",children:[T.jsxs(fo,{fontSize:"lg",fontWeight:"bold",children:["Delete ",ue==="video"?"Video":"Image"]}),T.jsxs(bs,{children:["Are you sure you want to delete this ",ue,"? This will revert the media screen to its blank state."]}),T.jsxs(nh,{children:[T.jsx(Yn,{ref:b,onClick:()=>Y(!1),children:"Cancel"}),T.jsx(Yn,{colorScheme:"red",onClick:He,ml:3,leftIcon:T.jsx(mn,{as:u0}),children:"Delete"})]})]})})})]})},z8e=n=>{const[e,i]=N.useState(null),[a,l]=N.useState(""),[u,f]=N.useState(null),[_,E]=N.useState(!1),b=Uc(),{spaceID:C}=Uo(),I=N.useCallback(M=>{var F,z;try{if(!M)return null;if(M.includes("youtube.com")||M.includes("youtu.be")){let X="";return M.includes("youtube.com/watch")?X=new URLSearchParams(new URL(M).search).get("v"):M.includes("youtu.be/")&&(X=M.split("youtu.be/")[1].split("?")[0]),X?`https://www.youtube.com/embed/${X}?autoplay=1`:M}if(M.includes("vimeo.com")){if(M.includes("player.vimeo.com/video"))return M;const X=(z=(F=M.split("vimeo.com/")[1])==null?void 0:F.split("?")[0])==null?void 0:z.split("/")[0];return X?`https://player.vimeo.com/video/${X}?autoplay=1`:M}return M}catch(X){return $.error("Error converting to embed URL:",X),M}},[]),O=N.useCallback(()=>{setTimeout(()=>{E(!1),$.log("Video processing state reset")},100)},[]);N.useEffect(()=>{let M=!0,F=null;const X=b("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:ne,videoUrl:oe}=K||{};if(!ne){$.error("Media screen ID is missing in Unity event data."),O();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ne}, setting ID but not playing video`),$.log("Edit mode is active, setting media screen ID but not playing video"),f(ne);return}if(E(!0),F=setTimeout(()=>{M&&($.warn("Video processing timeout reached, resetting state"),E(!1))},5e3),oe){if(console.log(`Using direct video URL from event: ${oe}`),M)try{const ae=I(oe);console.log(`Setting video URL to: ${ae} (original: ${oe})`),i(ae),l(`Media Screen ${ne}`),f(ne),$.log("Media screen video URL set directly from event:",ae)}catch(ae){$.error("Error setting video URL from direct URL:",ae)}finally{O(),clearTimeout(F)}return}console.log(`Fetching media screen data for ID: ${ne}`);try{const ae=await Df(C,ne);if(console.log("Media screen data from Firestore:",ae),!ae||!ae.videoUrl){$.error("No video URL found for media screen:",ne),O(),clearTimeout(F);return}if(!ae.displayAsVideo){$.log("Media screen is not set to display as video:",ne),console.log("displayAsVideo flag is false for this media screen"),O(),clearTimeout(F);return}if(M)try{const le=I(ae.videoUrl);console.log(`Setting video URL to: ${le} (original: ${ae.videoUrl})`),i(le),l(ae.title||`Media Screen ${ne}`),f(ne),$.log("Media screen video URL set to:",le)}catch(le){$.error("Error setting video URL from Firestore:",le)}finally{O(),clearTimeout(F)}}catch(ae){$.error(`Error fetching media screen data for ${ne}:`,ae),O(),clearTimeout(F)}}catch(ne){$.error("Error handling media screen video play:",ne),console.error("Error handling media screen video play:",ne),O(),clearTimeout(F)}});return()=>{M=!1,F&&clearTimeout(F),X()}},[b,C,n,I,O]);const L=N.useCallback(()=>{i(null),l(""),f(null),E(!1),$.log("Video player state reset")},[]);return[e,a,u,L,_]},W8e=()=>{const{spaceID:n}=Uo(),e=Mc(),i=Uc(),[a,l]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{$.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const u=N.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await _(b):"https://via.placeholder.com/640x360?text=Video"}catch(C){return $.error(`Error fetching thumbnail for ${b}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const O=await I.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),M=["640x360","295x166"];let F=null;for(let z of M){const X=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(X,{method:"HEAD"})).ok){F=X;break}}catch(K){$.warn(`Failed to validate thumbnail URL: ${X}`,K)}}return F||O.thumbnail_url}catch(C){return $.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},_=async b=>{let C="";if(b.includes("youtube.com/watch")?C=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(C=b.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(O){$.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,O)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},E=N.useCallback(async b=>{try{if(!n||!b)return;$.log(`Refreshing thumbnail for media screen ${b}`);const C=await Df(n,b);if(!C){$.log(`No media screen found with ID ${b}`);return}if($.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){$.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await u(C.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),$.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(C){$.error(`Error refreshing thumbnail for media screen ${b}:`,C)}},[n,u,e]);N.useEffect(()=>{if(!a){$.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}$.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:O,thumbnailUrl:L}=I;L==="refresh"&&O&&(console.log(`Received request to refresh thumbnail for media screen ${O}`),await E(O))}catch(O){console.error("Error handling SetMediaScreenThumbnail event:",O)}});return()=>{C()}},[i,E,a]),N.useEffect(()=>{if(!a){$.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}$.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");$.log("Fetching media screens for thumbnails...");const I=await X4(n);$.log("All media screens:",I);const O=I.filter(F=>F.displayAsVideo&&F.videoUrl);if($.log("Media screens set to display as videos:",O),O.length===0){$.log("No media screens set to display as videos found.");return}$.log(`Found ${O.length} media screens set to display as videos.`);const L=O.map(async F=>{try{const z=await u(F.videoUrl);return $.log(`Fetched thumbnail for ${F.id}: ${z}`),{mediaScreenId:F.id,thumbnailUrl:z}}catch(z){return $.error(`Error processing thumbnail for media screen ${F.id}:`,z),{mediaScreenId:F.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),M=await Promise.all(L);$.log("Fetched Media Screen Thumbnails",M),M.forEach(({mediaScreenId:F,thumbnailUrl:z})=>{e("SetMediaScreenThumbnail",{mediaScreenId:F,thumbnailUrl:z}),$.log(`Sent thumbnail to Unity for media screen ${F}: ${z}`)})}catch(I){$.error("Error fetching media screen thumbnails:",I)}};b();const C=setInterval(b,5*60*1e3);return()=>{clearInterval(C)}},[e,n,u,a])},TQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},G8e=()=>T.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),H8e=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:a,onClose:l})=>{const{fullscreenRef:u}=ch();return S1(a,`video-modal-${i}`),N.useEffect(()=>{if(a){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const _=document.getElementById("unity-canvas"),E=document.getElementById("unity-container");if(_&&(_.style.pointerEvents="none"),E&&(E.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),_&&(_.style.pointerEvents="auto"),E&&(E.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),T.jsxs(T.Fragment,{children:[T.jsx(G8e,{}),T.jsxs(vs,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:u},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[T.jsx(Ts,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),T.jsxs(Ss,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[T.jsx(zs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),T.jsx(bs,{p:0,width:"100%",children:n?T.jsx(yt,{className:"iframe-container",style:TQ.iframeContainer,children:T.jsx("iframe",{className:"video-iframe",src:n,style:TQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):T.jsxs(is,{direction:"column",align:"center",justify:"center",h:"400px",children:[T.jsx(oh,{size:"xl",mb:4}),T.jsx(at,{children:"Unable to load video"}),T.jsx(at,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Js=(...n)=>{},$8e=()=>{const{isOpen:n,onOpen:e,onClose:i}=th(),[a,l]=N.useState(null),[u,f]=N.useState("image"),_=N.useRef(null);S1(n,"image-viewer-modal");const E=N.useCallback(I=>{I.stopPropagation()},[]);return N.useEffect(()=>{if(n&&_.current){const I=_.current;I.addEventListener("mousemove",E),I.addEventListener("mousedown",E),I.addEventListener("mouseup",E),I.addEventListener("wheel",E);const O=document.getElementById("unity-canvas");return O&&(O.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",E),I.removeEventListener("mousedown",E),I.removeEventListener("mouseup",E),I.removeEventListener("wheel",E),O&&(O.style.pointerEvents="auto")}}},[n,E]),{isOpen:n,currentImageUrl:a,currentMediaType:u,openImageViewer:(I,O="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${O}`);const L=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),M=L?"image":O;console.log(`[DEBUG] Detected URL as ${L?"image":"non-image"}, using media type: ${M}`),l(I),f(M),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:_,preventPropagation:E}},K8e=()=>T.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),yU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),Js(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},q8e=()=>{const{spaceID:n}=Uo(),[e,i]=N.useState(!1),[a,l]=N.useState([]),[u,f]=N.useState(null),{isOpen:_,onOpen:E,onClose:b}=th(),[C,I]=N.useState({}),[O,L]=N.useState(0);N.useRef(null);const M=Mc(),{fullscreenRef:F}=ch(),z=Uc(),[X,K]=N.useState(!1),{isOpen:ne,currentImageUrl:oe,currentMediaType:ae,openImageViewer:le,closeImageViewer:Y,modalContentRef:Z,preventPropagation:Q}=$8e(),[ie,de,ue,pe,ke]=z8e(e),{isOpen:xe,onOpen:Fe,onClose:Oe}=th();W8e(),yoe(),N.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const Ce=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",Ce),()=>{window.removeEventListener("PlayerInstantiated",Ce)}},[]);const we=N.useCallback(Ce=>{if(Array.isArray(a)&&a.length>0){const Pe=a.find(Me=>Me.mediaScreenId===Ce);if(Pe){const Me=Pe.imageUrl,ze=Pe.videoUrl;return{screen:Pe,imageUrl:Me,videoUrl:ze,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(oe){let Pe=null;return Array.isArray(a)&&(Pe=a.find(Me=>Me.mediaScreenId===Ce)),{screen:Pe||{mediaScreenId:Ce},imageUrl:oe,videoUrl:null,mediaType:(Pe==null?void 0:Pe.mediaType)||"image",displayAsVideo:(Pe==null?void 0:Pe.displayAsVideo)||!1}}return n&&Ce&&Df(n,Ce).then(Pe=>{Pe&&l(Me=>Array.isArray(Me)&&Me.some(He=>He.mediaScreenId===Ce)?Me.map(He=>He.mediaScreenId===Ce?{...He,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1,hasImage:!!Pe.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:He):[...Array.isArray(Me)?Me:[],{mediaScreenId:Ce,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1,hasImage:!!Pe.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Pe=>{console.error(`Error fetching media screen data for ${Ce}:`,Pe)}),console.warn("No screen data found for:",Ce),null},[a,oe,n,l]),Se=N.useCallback(Ce=>{if(console.log(`[DEBUG] Processing click on screen: ${Ce}, isEditMode: ${e}`),f(Ce),e)console.log(`[DEBUG] Opening upload modal for screen: ${Ce} in edit mode`),E();else{const Pe=we(Ce);if(Pe){if(console.log(`[DEBUG] Screen data for ${Ce}:`,Pe),Js("Screen data details:",{mediaScreenId:Ce,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType,displayAsVideo:Pe.displayAsVideo}),xe&&ue===Ce)return;if(Pe.displayAsVideo&&Pe.videoUrl)Js(`Opening video player for: ${Pe.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:Ce,videoUrl:Pe.videoUrl});else if(Pe.imageUrl){Js(`Opening viewer modal with ${Pe.mediaType}: ${Pe.imageUrl}`);const ze=yU(Pe.imageUrl);le(ze,Pe.mediaType||"image")}else n&&Df(n,Ce).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)Js(`Opening video player for: ${ze.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:Ce,videoUrl:ze.videoUrl});else if(ze.imageUrl){Js(`Opening viewer modal with image: ${ze.imageUrl}`);const He=yU(ze.imageUrl);le(He,ze.mediaType||"image")}l(He=>Array.isArray(He)&&He.some(nt=>nt.mediaScreenId===Ce)?He.map(nt=>nt.mediaScreenId===Ce?{...nt,...ze,mediaScreenId:Ce,source:"firestore-click",lastUpdated:new Date().toISOString()}:nt):[...Array.isArray(He)?He:[],{...ze,mediaScreenId:Ce,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${Ce}:`,ze)})}else n&&Df(n,Ce).then(Me=>{if(Me){if(Me.displayAsVideo&&Me.videoUrl)Js(`Opening video player for: ${Me.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:Ce,videoUrl:Me.videoUrl});else if(Me.imageUrl){Js(`Opening viewer modal with image: ${Me.imageUrl}`);const ze=yU(Me.imageUrl);le(ze,Me.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(qe=>qe.mediaScreenId===Ce)?ze.map(qe=>qe.mediaScreenId===Ce?{...qe,...Me,mediaScreenId:Ce,source:"firestore-click",lastUpdated:new Date().toISOString()}:qe):[...Array.isArray(ze)?ze:[],{...Me,mediaScreenId:Ce,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Me=>{console.error(`Error fetching media screen data for ${Ce}:`,Me)})}},[e,E,we,xe,ue,M,le,n]);N.useEffect(()=>{if(!X)return;const Ce=async()=>{if(n)try{const Me=await X4(n),ze={};Me.forEach(He=>{He.id&&He.imageUrl&&(ze[He.id]=He.imageUrl)}),l(He=>He.map(qe=>{const nt=!!ze[qe.mediaScreenId],Ze=ze[qe.mediaScreenId],gt=qe.mediaType||"image";return{...qe,hasImage:nt,imageUrl:Ze,mediaType:gt}}))}catch(Me){console.error("Error fetching media screen images:",Me)}};Ce();let Pe=null;return e&&(Pe=setInterval(Ce,5e3)),()=>{Pe&&clearInterval(Pe)}},[n,e,O,X]);const Be=Ce=>{l(Pe=>Pe.map(Me=>{if(Me.mediaScreenId===Ce.mediaScreenId){if(Ce.type==="upload")return{...Me,hasImage:!0,imageUrl:Ce.imageUrl,mediaType:Ce.mediaType||"image"};if(Ce.type==="delete")return{...Me,hasImage:!1,imageUrl:null,mediaType:null}}return Me})),Ce.type==="delete"?(setTimeout(()=>{l(Pe=>Pe.filter(Me=>Me.mediaScreenId!==Ce.mediaScreenId))},100),setTimeout(()=>{l(Pe=>Pe.filter(Me=>Me.mediaScreenId!==Ce.mediaScreenId))},1500)):setTimeout(()=>{l(Pe=>Pe.some(ze=>ze.mediaScreenId===Ce.mediaScreenId)?Pe.map(ze=>ze.mediaScreenId===Ce.mediaScreenId?{...ze,imageUrl:Ce.imageUrl,hasImage:!0,mediaType:Ce.mediaType||"image"}:ze):[...Pe,{mediaScreenId:Ce.mediaScreenId,imageUrl:Ce.imageUrl,hasImage:!0,mediaType:Ce.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};N.useEffect(()=>{const Ce=Pe=>{const Me=Pe.detail.enabled;i(Me),Me?M("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):M("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",Ce),()=>{window.removeEventListener("editModeChanged",Ce)}},[M]),N.useEffect(()=>(window.JsSendMediaScreenClick=function(Ce){console.log("Unity: MediaScreenClick received with data:",Ce);try{const Pe=JSON.parse(Ce),Me=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Pe)});window.dispatchEvent(Me)}catch(Pe){console.error("Error processing MediaScreenClick data:",Pe)}},window.handleMediaScreenClick=function(Ce){console.log("Direct call to handleMediaScreenClick with ID:",Ce),Se(Ce)},window.TestJavaScriptFromUnity=function(Ce){console.log("Unity called TestJavaScriptFromUnity with:",Ce),alert("Unity called JavaScript: "+Ce)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Se]),N.useEffect(()=>{const Ce=ze=>{try{const He=JSON.parse(ze.detail);$.log(`MediaScreen registered: ${He.mediaScreenId}`),Js("MediaScreen registered from Unity:",He),l(nt=>nt.some(gt=>gt.mediaScreenId===He.mediaScreenId)?nt.map(gt=>gt.mediaScreenId===He.mediaScreenId?{...gt,...He,source:"event",lastUpdated:new Date().toISOString()}:gt):[...nt,{...He,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&M("SetMediaScreenEditMode",{mediaScreenId:He.mediaScreenId,enabled:!0,showUploadIcon:!0});const qe=He.mediaScreenId;qe&&Df(n,qe).then(nt=>{nt&&(Js(`Media screen data for ${qe}:`,nt),nt.displayAsVideo&&nt.videoUrl&&(Js(`Media screen ${qe} should display as video, sending null imageUrl`),M("SetMediaScreenImage",{mediaScreenId:qe,imageUrl:null,displayAsVideo:!0})))}).catch(nt=>{console.error(`Error fetching media screen data for ${qe}:`,nt)})}catch(He){console.error("Error handling MediaScreen registration:",He)}},Pe=ze=>{try{Js("MediaScreenClick event received:",ze);let He;if(typeof ze=="string")He=ze,Js("MediaScreenClick: Direct call with ID:",He);else{Js("MediaScreenClick: Event from Unity:",ze),Js("MediaScreenClick: Event detail:",ze.detail);try{He=JSON.parse(ze.detail).mediaScreenId,Js("MediaScreenClick: Parsed mediaScreenId:",He)}catch(qe){if(console.error("MediaScreenClick: Error parsing event detail:",qe),ze.detail&&ze.detail.mediaScreenId)He=ze.detail.mediaScreenId,Js("MediaScreenClick: Using direct mediaScreenId from detail:",He);else throw new Error("Could not extract mediaScreenId from event")}}$.log(`MediaScreen clicked: ${He}`),Js("MediaScreen clicked:",He),Se(He)}catch(He){console.error("Error handling MediaScreen click:",He)}},Me=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")Ce({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Pe({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const He=JSON.parse(ze.detail.eventData);He.mediaScreenId&&(Js("SetMediaScreenImage event received:",He),l(qe=>Array.isArray(qe)&&qe.some(Ze=>Ze.mediaScreenId===He.mediaScreenId)?qe.map(Ze=>Ze.mediaScreenId===He.mediaScreenId?{...Ze,imageUrl:He.imageUrl,hasImage:!!He.imageUrl,displayAsVideo:He.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Ze):[...Array.isArray(qe)?qe:[],{mediaScreenId:He.mediaScreenId,imageUrl:He.imageUrl,hasImage:!!He.imageUrl,displayAsVideo:He.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(He){console.error("Error handling SetMediaScreenImage event:",He)}};return window.addEventListener("RegisterMediaScreen",Ce),window.addEventListener("MediaScreenClick",Pe),window.addEventListener("reactUnityEvent",Me),()=>{window.removeEventListener("RegisterMediaScreen",Ce),window.removeEventListener("MediaScreenClick",Pe),window.removeEventListener("reactUnityEvent",Me)}},[e,E,M,a,ne,xe,le,Se,n]),N.useEffect(()=>{const Ce=Pe=>{try{Js("Direct MediaScreenClick event received:",Pe);let Me;if(Pe.detail)try{Me=JSON.parse(Pe.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!Me){console.error("No mediaScreenId found in MediaScreenClick event");return}Js(`Direct handler: Processing click for media screen ${Me}`),Se(Me)}catch(Me){console.error("Error in direct MediaScreenClick handler:",Me)}};return window.addEventListener("MediaScreenClick",Ce),()=>{window.removeEventListener("MediaScreenClick",Ce)}},[Se]),N.useEffect(()=>{ie&&Fe()},[ie,Fe]);const Ee=()=>{pe(),Oe()};return N.useEffect(()=>{const Pe=z("RegisterMediaScreen",Me=>{try{if($.log("Direct RegisterMediaScreen event received with data:",Me),!Me||!Me.mediaScreenId){$.warn("RegisterMediaScreen event received with invalid data");return}const ze=Me.mediaScreenId;$.log(`Media screen registered directly: ${ze}`),l(He=>He.some(nt=>nt.mediaScreenId===ze)?He.map(nt=>nt.mediaScreenId===ze?{...nt,...Me,source:"direct-event",lastUpdated:new Date().toISOString()}:nt):[...He,{...Me,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&M("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Pe()}},[z,e,M]),N.useEffect(()=>{const Pe=z("MediaScreenClick",Me=>{try{if($.log("Direct MediaScreenClick event received with data:",Me),!Me||!Me.mediaScreenId){$.warn("MediaScreenClick event received with invalid data");return}const ze=Me.mediaScreenId;$.log(`Media screen clicked directly: ${ze}`),Se(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Pe()}},[z,Se]),N.useEffect(()=>{e&&ue&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${ue}`),f(ue),E(),pe())},[e,ue,E,pe]),T.jsxs(T.Fragment,{children:[T.jsx(B8e,{isOpen:_,onClose:b,mediaScreenId:u,onImageChange:Be}),T.jsx(K8e,{}),T.jsx(od,{containerRef:F,children:T.jsxs(vs,{isOpen:ne,onClose:Y,size:"lg",isCentered:!0,portalProps:{containerRef:F},id:"image-viewer-modal",blockScrollOnMount:!0,children:[T.jsx(Ts,{bg:"rgba(0, 0, 0, 0.8)",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q}),T.jsxs(Ss,{ref:Z,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[T.jsx(zs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),T.jsx(bs,{p:0,width:"100%",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:oe?T.jsx(yt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:ae==="image"?T.jsx(up,{src:oe,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",oe),onError:Ce=>console.error("Error loading image:",Ce,oe),onClick:Q}):T.jsxs(yt,{width:"100%",textAlign:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[T.jsx(at,{mb:4,fontSize:"lg",children:"Video URL:"}),T.jsx(at,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:oe}),T.jsx(at,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):T.jsx(is,{direction:"column",align:"center",justify:"center",h:"400px",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:T.jsx(at,{children:"No image available"})})})]})]})}),T.jsx(H8e,{videoUrl:ie,videoTitle:de,mediaScreenId:ue,isOpen:xe,onClose:Ee})]})},Qoe=({backgroundUrl:n=null,videoBackgroundUrl:e=null,containerRef:i})=>{const[a,l]=N.useState(!1),[u,f]=N.useState(n),[_,E]=N.useState(e),b=N.useRef(null),C=N.useRef(null),I=N.useRef(null),O=N.useRef(!1),L=N.useRef(!1);N.useEffect(()=>{if(!(O.current||L.current)){if(L.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${e}, imageUrl: ${n}`),e){console.log(` PersistentBackground: Using provided video URL: ${e}`),F(e),O.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),z(n),O.current=!0;return}M()}},[n,e]),N.useEffect(()=>{const ne=oe=>{const{videoBackgroundUrl:ae}=oe.detail;console.log(` PersistentBackground: Received video background update event: ${ae}`),ae&&!O.current&&(F(ae),O.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",ne),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",ne)}},[]);const M=()=>{const oe=window.location.pathname.match(/\/space\/([^\/]+)/);if(!oe||!oe[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const ae=oe[1];console.log(` PersistentBackground: Found space ID: ${ae}`),td(ae).then(le=>{if(console.log(` PersistentBackground: Retrieved space data for ${ae}:`,le?"success":"null"),le&&le.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${le.videoBackgroundUrl}`),F(le.videoBackgroundUrl),O.current=!0;else if(le&&(le.backgroundUrl||le.backgroundGsUrl)){const Y=le.backgroundUrl||le.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${Y}`),z(Y),O.current=!0}}).catch(le=>{console.error(" PersistentBackground: Error fetching space data:",le)})},F=ne=>{if(!i||!i.current)return;console.log(` PersistentBackground: Setting up video background: ${ne}`),K();const oe=document.createElement("video");I.current=oe,oe.autoplay=!0,oe.loop=!0,oe.muted=!0,oe.playsInline=!0,oe.setAttribute("playsinline",""),oe.setAttribute("webkit-playsinline",""),oe.setAttribute("preload","auto"),oe.src=ne,Object.assign(oe.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(oe),X(),oe.load();try{oe.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(ae=>{console.warn(" First video play attempt failed:",ae);const le=()=>{oe.play().then(()=>console.log(" Video started after user interaction")).catch(Y=>console.error(" Video still failed to play:",Y))};window.addEventListener("click",le,{once:!0}),window.addEventListener("touchstart",le,{once:!0}),setTimeout(()=>{oe.play().then(()=>console.log(" Video started after timeout")).catch(Y=>console.error(" Video still failed to play after timeout:",Y))},1e3)})}catch(ae){console.error(" Error attempting to play video:",ae)}},z=ne=>{if(!i||!i.current||!ne)return;console.log(` PersistentBackground: Setting up image background: ${ne}`);const oe=document.createElement("div");b.current=oe,Object.assign(oe.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${ne}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(oe),X()},X=()=>{if(!i||!i.current)return;const ne=document.createElement("div");C.current=ne,Object.assign(ne.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ne)},K=()=>{!i||!i.current||(b.current&&i.current.contains(b.current)&&(i.current.removeChild(b.current),b.current=null),I.current&&i.current.contains(I.current)&&(I.current.pause(),I.current.src="",I.current.load(),i.current.removeChild(I.current),I.current=null),C.current&&i.current.contains(C.current)&&(i.current.removeChild(C.current),C.current=null))};return N.useEffect(()=>{if(!i||!i.current)return;const ne=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),b.current&&(b.current.style.opacity="0"),I.current&&(I.current.style.opacity="0"),C.current&&(C.current.style.opacity="0"),setTimeout(()=>{K()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),ne();return}Zd.subscribe(Qd.playerInstantiated,ne),window.addEventListener("PlayerInstantiated",ne);const oe=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),ne()},3e4);return()=>{Zd.unsubscribe(Qd.playerInstantiated,ne),window.removeEventListener("PlayerInstantiated",ne),clearTimeout(oe),K()}},[i]),null};Qoe.propTypes={backgroundUrl:An.string,videoBackgroundUrl:An.string,containerRef:An.shape({current:An.instanceOf(Element)})};const wQ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",Zoe=({containerRef:n})=>{const{spaceID:e}=Uo(),{isUserBannedFromSpace:i}=N.useContext(ro),[a,l]=N.useState(!1),[u,f]=N.useState(!1),[_,E]=N.useState(!1),[b,C]=N.useState(0),[I,O]=N.useState("Initialising World"),[L,M]=N.useState(null),F=N.useRef(null),z=N.useRef(null),X=N.useRef(null),K=N.useRef(null),ne=N.useRef(null),oe=N.useRef(null);N.useEffect(()=>($.log("PersistentLoader: Component mounted with spaceID:",e),$.log("PersistentLoader: Container ref:",n),()=>{$.log("PersistentLoader: Component unmounting")}),[]);const{error:ae}=Uo(),[le,Y]=N.useState(!1);return N.useEffect(()=>{ae&&($.error("PersistentLoader: Unity error detected:",ae),Y(!0),setTimeout(()=>{if(F.current){const Z=F.current.querySelector("div:first-child");Z&&(Z.textContent="Reconnecting...")}},3e3))},[ae]),N.useEffect(()=>{(async()=>{if(e){$.log(`PersistentLoader: Fetching logo for space ${e}`);try{const Q=await td(e);Q&&Q.logoUrl?($.log(`PersistentLoader: Found logo URL: ${Q.logoUrl}`),M(Q.logoUrl)):$.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(Q){$.error("PersistentLoader: Error fetching space logo:",Q)}}else $.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),N.useEffect(()=>{const Z=Q=>{const{logoUrl:ie}=Q.detail;$.log(`PersistentLoader: Logo update event received with URL: ${ie}`),M(ie),z.current?ie?($.log("PersistentLoader: Updating logo element with new URL"),z.current.src=ie,X.current.style.display="flex"):($.log("PersistentLoader: Hiding logo element (no URL)"),X.current.style.display="none"):$.warn("PersistentLoader: Logo ref is null during update")};return $.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",Z),()=>{$.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",Z)}},[]),N.useEffect(()=>{(async()=>{if(e&&i)try{await i(e)&&($.warn(`PersistentLoader: user banned from space ${e}`),l(!0))}catch(Q){$.error("PersistentLoader: error checking ban status",Q)}})()},[e,i]),N.useEffect(()=>{if(!n||!n.current){$.error("PersistentLoader: Container ref missing");return}if(a){const Be=document.createElement("div");return Object.assign(Be.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"red",background:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"8px",zIndex:"100",fontSize:"18px",fontWeight:"bold",textAlign:"center"}),Be.textContent="Access Denied: You have been banned from this space.",n.current.appendChild(Be),()=>{n.current.removeChild(Be)}}$.log("PersistentLoader: Creating loader elements");const Z=document.createElement("div");if(F.current=Z,Object.assign(Z.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),L){$.log(`PersistentLoader: Creating logo element with URL: ${L}`);const Be=document.createElement("div");X.current=Be,Object.assign(Be.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const Ee=document.createElement("img");z.current=Ee,Ee.src=L,Ee.alt="Space Logo",Ee.style.maxHeight="100px",Ee.style.maxWidth="100%",Ee.style.objectFit="contain",Ee.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",Be.appendChild(Ee),n.current.appendChild(Be),$.log("PersistentLoader: Logo container added to main container")}else $.log("PersistentLoader: No logo URL available, skipping logo creation");const Q=document.createElement("style");Q.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(Q),$.log("PersistentLoader: Animation styles added to document head");const ie=document.createElement("div");ie.style.fontSize="16px",ie.style.fontWeight="bold",ie.style.textAlign="center",ie.style.marginBottom="16px",ie.style.color="#ffffff",ie.textContent="Initialising World";const de=document.createElement("div");de.style.width="240px",de.style.height="100px",de.style.position="relative",de.style.marginBottom="15px",de.style.padding="0px",de.style.overflow="hidden",de.style.boxSizing="border-box",de.style.transition="opacity 0.8s ease-in-out",de.style.opacity="0";const ue=document.createElement("div");ue.style.width="100%",ue.style.height="100%",ue.style.position="absolute",ue.style.top="0",ue.style.left="0",ue.style.maskImage=`url(${wQ})`,ue.style.maskSize="contain",ue.style.maskPosition="center",ue.style.maskRepeat="no-repeat",ue.style.webkitMaskImage=`url(${wQ})`,ue.style.webkitMaskSize="contain",ue.style.webkitMaskPosition="center",ue.style.webkitMaskRepeat="no-repeat",ue.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",ue.style.backgroundSize="100% 100%",ue.style.transition="background 0.5s ease-out",K.current=ue,ne.current=null,de.appendChild(ue);const pe=document.createElement("div");pe.style.marginTop="8px",pe.style.fontSize="14px",pe.style.fontWeight="bold",pe.style.color="#ffffff",pe.textContent="0%",Z.appendChild(ie),Z.appendChild(de),Z.appendChild(pe),n.current.appendChild(Z),$.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{X.current&&(X.current.style.opacity="1"),Z.style.opacity="1",de.style.opacity="1"},500);const ke=Be=>{C(Be);const Ee=Math.round(Be*100),Ce=`linear-gradient(to right, #4facfe 0%, #00f2fe ${Ee}%, white ${Ee}%, white 100%)`;ue.style.background=Ce,pe.textContent=`${Ee}%`,$.log(`PersistentLoader: Progress updated to ${Ee}%`)},xe=Be=>{O(Be),ie.textContent=Be,$.log(`PersistentLoader: Loading stage updated to "${Be}"`)},Fe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];le&&(Fe[0].stage="Connecting to Space",Fe[1].stage="Reconnecting...",Fe[2].stage="Please Wait"),xe(Fe[0].stage),ke(.25);const Oe=Be=>{const Ee=Be.detail.progress;$.log(`PersistentLoader: Progress event received with value: ${Ee}`),ke(Ee),Ee<.33?xe(Fe[0].stage):Ee<.66?xe(Fe[1].stage):xe(Fe[2].stage)},we=()=>{$.log("PersistentLoader: First scene loaded event received"),f(!0),xe(Fe[1].stage),ke(.66)},Se=()=>{if($.log("PersistentLoader: Player instantiated event received"),oe.current&&(clearInterval(oe.current),$.log("PersistentLoader: Progress interval cleared")),E(!0),xe(Fe[2].stage),ke(1),le){$.log("PersistentLoader: Keeping loader visible due to Unity error");return}Z.style.transition="all 0.5s ease-in-out",de.style.transition="opacity 1.2s ease-in-out",ie.style.transition="opacity 0.4s ease-in-out",pe.style.transition="opacity 0.4s ease-in-out",X.current&&(X.current.style.transition="opacity 0.5s ease-in-out"),Z.style.backgroundColor="rgba(0, 0, 0, 0)",Z.style.backdropFilter="blur(0px)",Z.style.WebkitBackdropFilter="blur(0px)",Z.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",Z.style.border="1px solid rgba(255, 255, 255, 0)",ie.style.opacity="0",pe.style.opacity="0",X.current&&(X.current.style.opacity="0"),setTimeout(()=>{de.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(Z)?(n.current.removeChild(Z),$.log("PersistentLoader: Loader element removed after fade")):$.warn("PersistentLoader: Could not remove loader element (not found in container)"),X.current&&n.current&&n.current.contains(X.current)?(n.current.removeChild(X.current),$.log("PersistentLoader: Logo container removed after fade")):X.current&&$.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)$.log("PersistentLoader: Player was already instantiated"),Se();else{$.log("PersistentLoader: Subscribing to playerInstantiated event"),Zd.subscribe(Qd.playerInstantiated,Se);const Be=()=>Se();$.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",Be),$.log("PersistentLoader: Adding firstSceneLoaded event listener"),Zd.subscribe(Qd.firstSceneLoaded,we),$.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",Oe),oe.current=setInterval(()=>{_||C(Ce=>{const Pe=Math.min(Ce+.02,.95);return ke(Pe),Pe<.33&&I!==Fe[0].stage?xe(Fe[0].stage):Pe>=.33&&Pe<.66&&I!==Fe[1].stage?xe(Fe[1].stage):Pe>=.66&&I!==Fe[2].stage&&xe(Fe[2].stage),Pe})},300);const Ee=setTimeout(()=>{$.log("PersistentLoader: Forcing loader removal after timeout"),Se()},6e4);return()=>{$.log("PersistentLoader: Cleaning up event listeners"),Zd.unsubscribe(Qd.playerInstantiated,Se),window.removeEventListener("PlayerInstantiated",Be),Zd.unsubscribe(Qd.firstSceneLoaded,we),window.removeEventListener("UnityProgress",Oe),clearInterval(oe.current),clearTimeout(Ee),n.current&&n.current.contains(Z)&&(n.current.removeChild(Z),$.log("PersistentLoader: Loader element removed during cleanup")),X.current&&n.current&&n.current.contains(X.current)&&(n.current.removeChild(X.current),$.log("PersistentLoader: Logo container removed during cleanup"))}}},[L,n]),null};Zoe.propTypes={containerRef:An.shape({current:An.instanceOf(Element)})};const L0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,r3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,u=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),_=document.activeElement===u;!l&&(f||_)&&a.preventDefault()}},i=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},eae=()=>{document.body.classList.remove("unity-focused")};function pN(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?r3():eae(),new Promise(e=>{try{const i=L0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),sF(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function sF(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const a=()=>{i++;const l=L0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(u){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",u);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(i<e){const u=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${u}ms`),window.__unityInstancePoller=setTimeout(a,u)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function Y8e(){const n=L0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function Xw(n=!0){return console.log("Focusing Unity canvas"),n?r3():eae(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){pN(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function jO(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),r3(),new Promise(e=>{try{if(n)pN(!1).then(i=>{var u;i&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=L0();(u=l==null?void 0:l.Module)!=null&&u.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=L0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),pN(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function X8e(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function J8e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=pN,window.focusUnity=Xw,window.blockUnityKeyboardInput=jO,window.hasUnityKeyboardFocus=Y8e,window.getUnityInstance=L0,window.registerUnityInstance=X8e,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let a=0;a<i.addedNodes.length;a++){const l=i.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),sF(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),sF(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,a]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),jO(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),jO(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),jO(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(J8e,0);const Q8e=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[a,l]=N.useState(!1),[u,f]=N.useState(!1),{savedStreamData:_,reloadStreamData:E}=_oe(),{spaceID:b}=Uo(),{user:C}=N.useContext(ro),I=dc(),[O,L]=N.useState(!1),M=_K((_==null?void 0:_.rtmpUrl)||""),F=_K((_==null?void 0:_.streamKey)||"");N.useEffect(()=>{if(b){$.log("LiveStreamButton: Forcing reload of stream data"),E();const K=()=>{$.log("LiveStreamButton: Stream settings changed, reloading data"),E()};return window.addEventListener("StreamSettingsChanged",K),()=>{window.removeEventListener("StreamSettingsChanged",K)}}},[b,E]),N.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!b){L(!1);return}try{const ne=await BBe(C.uid,"disruptiveAdmin"),oe=await HBe(C,b);L(ne||oe)}catch(ne){$.error("Error checking user permissions:",ne),L(!1)}})()},[C==null?void 0:C.uid,b]),N.useEffect(()=>{$.log("LiveStreamButton: Current streaming data:",{enabled:_==null?void 0:_.enabled,hasRtmpUrl:!!(_!=null&&_.rtmpUrl),hasStreamKey:!!(_!=null&&_.streamKey),hasPermission:O,isPlayerReady:u})},[_,O,u]),N.useEffect(()=>{const K=()=>{$.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&($.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const z=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},X=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!u||!O||(_==null?void 0:_.enabled)!==!0?($.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!u,noPermission:!O,streamingDisabled:(_==null?void 0:_.enabled)!==!0,enabledValue:_==null?void 0:_.enabled}),null):T.jsxs(T.Fragment,{children:[T.jsx(Bf,{label:"Live Stream Info",placement:e,hasArrow:!0,children:T.jsx(eh,{size:n,borderRadius:"full",bg:"black",icon:T.jsx(QWe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:z})}),T.jsxs(vs,{isOpen:a,onClose:X,isCentered:!0,size:"md",children:[T.jsx(Ts,{backdropFilter:"blur(4px)"}),T.jsxs(Ss,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[T.jsx(fo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),T.jsx(zs,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),T.jsx(bs,{p:4,children:_!=null&&_.rtmpUrl&&(_!=null&&_.streamKey)?T.jsxs(yt,{children:[T.jsx(at,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),T.jsxs(yt,{mb:4,children:[T.jsx(at,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),T.jsx(is,{children:T.jsxs(My,{size:"sm",children:[T.jsx(Gi,{value:_.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),T.jsx(Vk,{children:T.jsx(Nc,{"aria-label":"Copy RTMP URL",icon:M.hasCopied?T.jsx(mQ,{}):T.jsx(gQ,{}),size:"xs",colorScheme:M.hasCopied?"green":"blue",onClick:()=>{M.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),T.jsxs(yt,{mb:4,children:[T.jsx(at,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),T.jsx(is,{children:T.jsxs(My,{size:"sm",children:[T.jsx(Gi,{value:_.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),T.jsx(Vk,{children:T.jsx(Nc,{"aria-label":"Copy Stream Key",icon:F.hasCopied?T.jsx(mQ,{}):T.jsx(gQ,{}),size:"xs",colorScheme:F.hasCopied?"green":"blue",onClick:()=>{F.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):T.jsxs(yt,{textAlign:"center",p:4,children:[T.jsx(at,{color:"white",children:"No stream configuration found for this space."}),T.jsx(at,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})};function Z8e(n,e,i){const a=N.useRef();N.useEffect(()=>(a.current&&clearTimeout(a.current),a.current=setTimeout(n,e),()=>clearTimeout(a.current)),i)}const eGe=({isOpen:n,onClose:e,portal:i,spaceId:a,style:l})=>{if(!n||!i)return null;const[u,f]=N.useState({x:0,y:1.5,z:0}),[_,E]=N.useState({x:0,y:0,z:0}),[b,C]=N.useState({x:1,y:1,z:1}),I=Mc(),O=dc();N.useEffect(()=>{i&&(f(i.position||{x:0,y:1.5,z:0}),E(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),N.useEffect(()=>{I("UpdatePortalTransform",{portalId:i.portalId,position:u,rotation:_,scale:b})},[u,_,b,i.portalId,I]),Z8e(()=>{const M={...i,position:u,rotation:_,scale:b};SQ(a,i.portalId,M)},300,[u,_,b,a,i.portalId]);const L=async()=>{try{if(I("DeletePortal",{portalId:i.portalId}),await SQ(a,i.portalId,null))O({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),e();else throw new Error("Failed to delete portal from Firebase")}catch{O({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return T.jsxs(yt,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[T.jsx(yt,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),T.jsxs(ai,{spacing:4,align:"stretch",children:[T.jsxs(Br,{children:[T.jsx(ns,{children:"Position"}),T.jsxs(hr,{children:[T.jsxs(Io,{value:u.x,onChange:(M,F)=>f(z=>({...z,x:F})),step:.1,precision:2,children:[T.jsx(Po,{placeholder:"X"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:u.y,onChange:(M,F)=>f(z=>({...z,y:F})),step:.1,precision:2,children:[T.jsx(Po,{placeholder:"Y"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:u.z,onChange:(M,F)=>f(z=>({...z,z:F})),step:.1,precision:2,children:[T.jsx(Po,{placeholder:"Z"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]})]})]}),T.jsxs(Br,{children:[T.jsx(ns,{children:"Rotation"}),T.jsxs(hr,{children:[T.jsxs(Io,{value:_.x,onChange:(M,F)=>E(z=>({...z,x:F})),step:1,children:[T.jsx(Po,{placeholder:"X"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:_.y,onChange:(M,F)=>E(z=>({...z,y:F})),step:1,children:[T.jsx(Po,{placeholder:"Y"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:_.z,onChange:(M,F)=>E(z=>({...z,z:F})),step:1,children:[T.jsx(Po,{placeholder:"Z"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]})]})]}),T.jsxs(Br,{children:[T.jsx(ns,{children:"Scale"}),T.jsxs(hr,{children:[T.jsxs(Io,{value:b.x,onChange:(M,F)=>C(z=>({...z,x:F})),step:.1,precision:2,min:.1,children:[T.jsx(Po,{placeholder:"X"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:b.y,onChange:(M,F)=>C(z=>({...z,y:F})),step:.1,precision:2,min:.1,children:[T.jsx(Po,{placeholder:"Y"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:b.z,onChange:(M,F)=>C(z=>({...z,z:F})),step:.1,precision:2,min:.1,children:[T.jsx(Po,{placeholder:"Z"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]})]})]}),T.jsx(hr,{spacing:4,width:"100%",justify:"flex-end",children:T.jsx(Yn,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Portal"})}),T.jsx(Yn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})},tGe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},nGe=()=>{const{spaceID:n}=Uo(),e=Mc(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityPortalImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{$.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){$.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}$.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=iu(Qn,"spaces",n,"portals"),f=await ed(u);if(f.empty){$.log("useUnityPortalImages: No portals found for space:",n);return}$.log(`useUnityPortalImages: Found ${f.size} portals for space ${n}`);for(const _ of f.docs){const E=_.data(),b=E.portalId,C=E.targetSpaceId;if(!C){$.warn(`useUnityPortalImages: No target space ID found for portal: ${b}`);continue}const I=await td(C);if(!I){$.warn(`useUnityPortalImages: No space data found for target space: ${C}`);continue}const O=I.backgroundUrl||I.backgroundGsUrl;if(!O){$.warn(`useUnityPortalImages: No background image URL found for target space: ${C}`);continue}const L=tGe(O);e("SetPortalImage",JSON.stringify({portalId:b,imageUrl:L})),$.log(`Sent portal image data to Unity for portal ${b}: ${L}`)}}catch(u){$.error("Error fetching portal images:",u)}})()},[e,n,i])},rGe=()=>(nGe(),null);function iGe(n,e,i){const a=N.useRef();N.useEffect(()=>(a.current&&clearTimeout(a.current),a.current=setTimeout(n,e),()=>clearTimeout(a.current)),i)}const sGe=({isOpen:n,onClose:e,item:i,spaceId:a,style:l})=>{if(!n||!i)return null;const[u,f]=N.useState({x:0,y:0,z:0}),[_,E]=N.useState({x:0,y:0,z:0}),[b,C]=N.useState({x:1,y:1,z:1}),I=Mc(),O=dc();N.useEffect(()=>{i&&(f(i.position||{x:0,y:0,z:0}),E(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),N.useEffect(()=>{I("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:u,rotation:_,scale:b})},[u,_,b,i.hotspotId,I]),iGe(()=>{const M=Sr(Qn,"spaces",a,"catalogue",i.hotspotId);Mo(M,{position:u,rotation:_,scale:b,updatedAt:Date.now()})},300,[u,_,b,a,i.hotspotId]);const L=async()=>{try{I("DeleteCatalogueItem",{hotspotId:i.hotspotId});const M=Sr(Qn,"spaces",a,"catalogue",i.hotspotId);await Mo(M,{deleted:!0}),O({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),e()}catch{O({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return T.jsxs(yt,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[T.jsx(yt,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),T.jsxs(ai,{spacing:4,align:"stretch",children:[T.jsxs(Br,{children:[T.jsx(ns,{children:"Position"}),T.jsxs(hr,{children:[T.jsxs(Io,{value:u.x,onChange:(M,F)=>f(z=>({...z,x:F})),step:.1,precision:2,children:[T.jsx(Po,{placeholder:"X"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:u.y,onChange:(M,F)=>f(z=>({...z,y:F})),step:.1,precision:2,children:[T.jsx(Po,{placeholder:"Y"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:u.z,onChange:(M,F)=>f(z=>({...z,z:F})),step:.1,precision:2,children:[T.jsx(Po,{placeholder:"Z"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]})]})]}),T.jsxs(Br,{children:[T.jsx(ns,{children:"Rotation"}),T.jsxs(hr,{children:[T.jsxs(Io,{value:_.x,onChange:(M,F)=>E(z=>({...z,x:F})),step:1,children:[T.jsx(Po,{placeholder:"X"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:_.y,onChange:(M,F)=>E(z=>({...z,y:F})),step:1,children:[T.jsx(Po,{placeholder:"Y"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:_.z,onChange:(M,F)=>E(z=>({...z,z:F})),step:1,children:[T.jsx(Po,{placeholder:"Z"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]})]})]}),T.jsxs(Br,{children:[T.jsx(ns,{children:"Scale"}),T.jsxs(hr,{children:[T.jsxs(Io,{value:b.x,onChange:(M,F)=>C(z=>({...z,x:F})),step:.1,precision:2,min:.1,children:[T.jsx(Po,{placeholder:"X"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:b.y,onChange:(M,F)=>C(z=>({...z,y:F})),step:.1,precision:2,min:.1,children:[T.jsx(Po,{placeholder:"Y"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]}),T.jsxs(Io,{value:b.z,onChange:(M,F)=>C(z=>({...z,z:F})),step:.1,precision:2,min:.1,children:[T.jsx(Po,{placeholder:"Z"}),T.jsxs(Ao,{children:[T.jsx(ko,{}),T.jsx(Oo,{})]})]})]})]}),T.jsx(hr,{spacing:4,width:"100%",justify:"flex-end",children:T.jsx(Yn,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Item"})}),T.jsx(Yn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})};function oGe(){const{clickedItem:n,clearClickedItem:e}=Toe(),[i,a]=N.useState(!1);N.useEffect(()=>{const f=_=>{_!=null&&_.detail&&typeof _.detail.enabled=="boolean"&&(a(_.detail.enabled),_.detail.enabled||e())};return window.addEventListener("editModeChanged",f),()=>window.removeEventListener("editModeChanged",f)},[e]);const l=()=>{e()};let u="";if(n!=null&&n.hotspotId){const f=n.hotspotId.split("_");f.length>=3&&(u=f.slice(1,-1).join("_"))}return T.jsx(T.Fragment,{children:n&&i&&T.jsx(sGe,{isOpen:!!n&&i,onClose:l,item:n,spaceId:u})})}const aGe=(n,e={})=>{const{user:i}=N.useContext(ro),{trackUnityEvent:a,isReady:l}=bR(n,{enableDebugLogs:e.enableDebugLogs||!1}),u=Uc();return N.useEffect(()=>{if(!l||!i)return;$.log(" Unity Analytics: Setting up event listeners");const f=u("PlayVideo",M=>{$.log(" Unity Analytics: Video play event detected",M),a(na.UNITY.VIDEO_PLAY,{category:No.MEDIA_INTERACTION,videoId:M==null?void 0:M.gameObjectName,videoUrl:M==null?void 0:M.videoUrl,isEditMode:(M==null?void 0:M.isEditMode)||!1,timestamp:new Date().toISOString(),...M})}),_=u("PlayMediaScreenVideo",M=>{$.log(" Unity Analytics: Media screen click event detected",M),a(na.UNITY.MEDIA_SCREEN_CLICK,{category:No.MEDIA_INTERACTION,mediaScreenId:M==null?void 0:M.mediaScreenId,videoUrl:M==null?void 0:M.videoUrl,isEditMode:(M==null?void 0:M.isEditMode)||!1,timestamp:new Date().toISOString(),...M})}),E=u("OpenNameplateModal",M=>{$.log(" Unity Analytics: Nameplate click event detected",M),a(na.UNITY.NAMEPLATE_CLICK,{category:No.SOCIAL_INTERACTION,targetUserId:M==null?void 0:M.uid,targetPlayerName:M==null?void 0:M.playerName,targetPlayerId:M==null?void 0:M.playerId,isLocalPlayer:(M==null?void 0:M.isLocalPlayer)||!1,timestamp:new Date().toISOString(),...M})}),b=u("PlayerInstantiated",M=>{$.log(" Unity Analytics: Player spawn event detected",M),a(na.UNITY.PLAYER_SPAWN,{category:No.SYSTEM_EVENT,timestamp:new Date().toISOString(),...M})}),C=u("FirstSceneLoaded",M=>{$.log(" Unity Analytics: First scene loaded event detected",M),a(na.UNITY.SPACE_READY,{category:No.SYSTEM_EVENT,timestamp:new Date().toISOString(),...M})}),I=u("SeatingHotspotClicked",M=>{$.log(" Unity Analytics: Catalogue item click event detected",M),a(na.UNITY.OBJECT_INTERACT,{category:No.CONTENT_INTERACTION,objectType:"catalogue_item",hotspotId:M==null?void 0:M.hotspotId,itemId:M==null?void 0:M.itemId,position:M==null?void 0:M.position,timestamp:new Date().toISOString(),...M})}),O=u("UpdatePlayerList",M=>{M!=null&&M.players&&Array.isArray(M.players)&&($.log(" Unity Analytics: Player list update event detected",M),a(na.UNITY.PLAYER_MOVE,{category:No.SOCIAL_INTERACTION,activePlayerCount:M.players.length,playerList:M.players.map(F=>({playerId:F.playerId,playerName:F.playerName,isLocalPlayer:F.isLocalPlayer})),timestamp:new Date().toISOString()}))}),L=u("RequestUserForUnity",M=>{$.log(" Unity Analytics: Unity user request event detected",M),a(na.UNITY.SPACE_LOAD,{category:No.SYSTEM_EVENT,requestType:"user_data",timestamp:new Date().toISOString(),...M})});return()=>{$.log(" Unity Analytics: Cleaning up event listeners"),f(),_(),E(),b(),C(),I(),O(),L()}},[l,i,a,u]),{isReady:l,trackUnityEvent:a}},cGe="9442a472625f44e7b2c5065b9f9b3988",EU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),i3=N.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:a,error:l}=Uo(),u=Aze();Oze();const f=Mc(),_=Xze(u),{user:E}=N.useContext(ro),[b,C]=N.useState(!1),[I,O]=N.useState(window.devicePixelRatio),[L,M]=Pze();Eoe().find(ut=>ut.isLocalPlayer);const[z,X]=N.useState(!0),[K,ne]=N.useState(!0),oe=n.spaceID||"default";qze(),$ze(oe),aGe(oe,{enableDebugLogs:!0});const{trackUnityEvent:ae}=bR(oe,{enableDebugLogs:!0}),[le,Y]=N.useState(!1),[Z,Q]=N.useState(!1),[ie,de]=N.useState(!1),ue=N.useMemo(()=>{const ct=new URLSearchParams(window.location.search).get("sessionId")||oe;return console.log("WebGLRenderer: Using session ID:",ct),ct},[oe]),[pe,ke]=N.useState(null);N.useEffect(()=>{E!=null&&E.uid&&su(E.uid).then(ut=>{ke(ut),console.log("WebGLRenderer: User profile loaded:",(ut==null?void 0:ut.Nickname)||"Unknown")}).catch(ut=>{console.error("Error fetching user profile:",ut)})},[E==null?void 0:E.uid]),N.useEffect(()=>{if(l||!E){console.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const ut=setTimeout(()=>{Q(!0),de(!0)},1e3);return()=>clearTimeout(ut)}else Q(!1)},[l,E]),N.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const ut=()=>{console.log("WebGLRenderer: Player instantiated event received"),ne(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ne(!0)),Zd.subscribe(Qd.playerInstantiated,ut);const kt=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ne(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Zd.unsubscribe(Qd.playerInstantiated,ut),clearTimeout(kt)}},[K]),N.useEffect(()=>{const ut=()=>{console.log("WebGLRenderer: Modal opened"),de(!0)},kt=()=>{console.log("WebGLRenderer: Modal closed"),de(!1)};return window.addEventListener("modal-opened",ut),window.addEventListener("modal-closed",kt),()=>{window.removeEventListener("modal-opened",ut),window.removeEventListener("modal-closed",kt)}},[]),N.useEffect(()=>{de(L!==null)},[L]),N.useEffect(()=>{a||u?setTimeout(()=>{C(!0),console.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,u]),N.useEffect(()=>{a&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(ut){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",ut)}},1e3)},[a,i]),N.useEffect(()=>{const ut=document.getElementById("webgl-root");return ut?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),ut.style.display="block",ut.getAttribute("data-space-id")!==oe&&(ut.setAttribute("data-space-id",oe),console.log(`WebGLRenderer: Set data-space-id attribute to ${oe}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[oe]),N.useEffect(()=>{const ut=()=>{const Mt=EU();Mt?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Mt.tabIndex=1,Mt.style.outline="none",Mt.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ie||Xw(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};ut();const kt=setTimeout(ut,1e3),ct=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),ut()};return window.addEventListener("unityReady",ct),()=>{clearTimeout(kt),window.removeEventListener("unityReady",ct)}},[a,ie]);const xe=N.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ie||Xw(!0)},[ie]);N.useEffect(()=>{if(a&&i){const ut=EU();if(ut)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),ut.addEventListener("click",xe),()=>{ut.removeEventListener("click",xe)}}},[a,i,xe]),N.useEffect(()=>{if(a&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const ut=kt=>{if(ie){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(kt.target.tagName==="INPUT"||kt.target.tagName==="TEXTAREA"||kt.target.tagName==="SELECT"||kt.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(kt.target.closest(".chakra-modal__content")||kt.target.closest('[role="dialog"]')||kt.target.closest('[role="menu"]')||kt.target.closest(".chakra-popover__content")||kt.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const ct=EU();if(ct&&(kt.target===ct||ct.contains(kt.target)))return;if(kt.target.closest(".webgl-overlay")||kt.target.closest(".game-ui")||kt.target.closest(".player-list")||kt.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{ie||Xw(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{ct&&!ie&&((ct.tabIndex===void 0||ct.tabIndex<0)&&(ct.tabIndex=1),ct.focus(),Xw(!0))},50)};return document.addEventListener("click",ut,!0),()=>{document.removeEventListener("click",ut,!0)}}},[a,i,ie]),N.useEffect(()=>{const ut=kt=>{console.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",kt)};return Zd.subscribe(Qd.sendUserToUnity,ut),()=>Zd.unsubscribe(Qd.sendUserToUnity,ut)},[f]);const{setFullscreenRef:Fe,fullscreenRef:Oe}=ch();N.useEffect(()=>{Fe(e.current)},[e,Fe]);const we=()=>{X(!z)},Se=E&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:K,showVoiceChat:Se,sessionId:ue}),N.useEffect(()=>{const ut=kt=>{console.log("Edit mode changed event:",kt.detail),Y(kt.detail.enabled)};return window.addEventListener("editModeChanged",ut),()=>{window.removeEventListener("editModeChanged",ut)}},[]),yoe(),xze();const Be=N.useRef(null),{clickedPortal:Ee,clearClickedPortal:Ce}=Kze(),[Pe,Me]=N.useState(!1),[ze,He]=N.useState(!1),[qe,nt]=N.useState(""),[Ze,gt]=N.useState("");N.useEffect(()=>{async function ut(){if(nt(""),gt(""),Ee&&!le){let kt=Ee.targetSpaceId;if(!kt&&Ee.portalId)try{const ct=Sr(Qn,"spaces",oe,"portals",Ee.portalId),Mt=await Lo(ct);Mt.exists()&&(kt=Mt.data().targetSpaceId)}catch{}if(kt)try{const ct=await td(kt);nt((ct==null?void 0:ct.name)||kt),gt((ct==null?void 0:ct.slug)||""),He(!0)}catch{nt(kt),gt(""),He(!0)}else nt(""),gt(""),He(!0)}}Ee&&le&&Me(!0),Ee&&!le&&ut()},[Ee,le,oe]);const sn=()=>{console.log("Closing portal editor"),Me(!1),Ce()};return console.log("WebGLRenderer render state:",{isPortalEditorOpen:Pe,clickedPortal:Ee,isEditMode:le}),Yze(oe),Toe(),T.jsxs(yt,{className:"webgl-renderer",children:[n.urlLoadingBackground&&T.jsx(Qoe,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:Be}),!Z&&T.jsx(Zoe,{containerRef:Be}),Z&&T.jsx(yt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:T.jsx(n3,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),T.jsx(oGe,{spaceId:oe,isEditMode:le}),T.jsx(RF,{containerRef:Oe.current?Oe:document.body,children:T.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[T.jsxs(yt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&T.jsx(MWe,{}),E&&T.jsx(Q8e,{size:"md"}),Se&&T.jsxs($oe,{appId:cGe,channel:ue,uid:E==null?void 0:E.uid,enabled:!0,children:[T.jsx(p8e,{size:"md",defaultMuted:!0,joinOnClick:!0}),T.jsx(m8e,{userNickname:pe==null?void 0:pe.Nickname})]}),T.jsx(e8e,{}),T.jsx(yt,{position:"relative",zIndex:"9999",children:T.jsx(j8e,{onTogglePlayerList:we,spaceID:oe})})]}),T.jsxs(yt,{ref:Be,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[T.jsx(yt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),T.jsx(yt,{..._,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?T.jsx(goe.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):T.jsx(yt,{width:"100%",height:"100%"})}),T.jsx(yt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:T.jsx(LWe,{})})]}),T.jsx(yt,{..._,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&T.jsx(up,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),T.jsxs(yt,{..._,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&T.jsx(UWe,{}),T.jsx(r8e,{})]}),T.jsx(i8e,{}),T.jsx(s8e,{isOpen:L!==null,onClose:()=>{console.log(" Closing nameplate modal"),M()},playerName:(L==null?void 0:L.playerName)||"Unknown Player",playerId:(L==null?void 0:L.playerId)||"Unknown ID"}),T.jsx(o8e,{isVisible:z,onToggleVisibility:X,spaceID:oe}),T.jsx(q8e,{}),T.jsx(yt,{position:"absolute",top:4,right:4,zIndex:1e3,children:Pe&&Ee&&T.jsx(eGe,{isOpen:Pe,onClose:sn,portal:Ee,spaceId:oe})}),!le&&ze&&T.jsxs(vs,{isOpen:ze,onClose:()=>{He(!1),Ce(),nt(""),gt("")},isCentered:!0,children:[T.jsx(Ts,{}),T.jsxs(Ss,{bg:"#181818",borderRadius:"2xl",boxShadow:"2xl",maxW:"420px",p:0,children:[T.jsx(fo,{textAlign:"center",fontWeight:"extrabold",fontSize:"2xl",color:"white",pt:8,pb:4,children:qe?`Visit ${qe}?`:"Visit Space?"}),T.jsx(zs,{color:"white",top:4,right:4}),T.jsx(bs,{pb:8,pt:2,px:8,children:T.jsxs(is,{mt:4,gap:6,justify:"center",children:[T.jsx(Yn,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{He(!1),Ce(),nt(""),gt("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),T.jsx(Yn,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:async()=>{if(Ee&&E){let ut=null;if(Ee.portalId){const kt=Ee.portalId.split("_");kt.length>=3&&(ut=kt[2])}await ae(na.UNITY.PORTAL_NAVIGATE,{category:No.NAVIGATION,portalId:Ee.portalId,targetSpaceId:ut,sourceSpaceId:oe,targetSpaceName:qe,targetSpaceSlug:Ze,isEditMode:!1,navigationType:"confirmed",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",Ee.portalId,"",ut)}Ze&&window.open(`https://www.spacesmetaverse.com/w/${Ze}`,"_blank","noopener"),He(!1),Ce(),nt(""),gt("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),T.jsx(rGe,{})]})})]})});i3.displayName="WebGLRenderer";i3.propTypes={settings:An.shape({urlLoadingBackground:An.string,videoBackgroundUrl:An.string,showAuthButton:An.bool,showDisruptiveLogo:An.bool,urlDisruptiveLogo:An.string,showHelpButton:An.bool,enableVoiceChat:An.bool,spaceID:An.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if($.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),$.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const tae=({spaceID:n,overrideSettings:e})=>{const i=N.useRef(null),[a,l]=N.useState(!0),{loading:u,isUserBannedFromSpace:f,user:_}=N.useContext(ro),[E,b]=N.useState(!1),[C,I]=N.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[O,L]=N.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return N.useEffect(()=>{(async()=>{try{const F=await td(n);if(F){console.log("Space data: ",F),I(ne=>({...ne,spaceID:n,loaderUrl:F.loaderUrl,dataUrl:F.dataUrl,frameworkUrl:F.frameworkUrl,codeUrl:F.codeUrl}));const z=await Ek(O.urlDisruptiveLogo);let X="";if(F.backgroundUrl)X=F.backgroundUrl;else if(F.backgroundGsUrl)try{X=await Ek(F.backgroundGsUrl)}catch(ne){$.warn("WebGLLoader: Error fetching background from GS URL:",ne)}else if(F.gsUrlLoadingBackground)try{X=await Ek(F.gsUrlLoadingBackground)}catch(ne){$.warn("WebGLLoader: Error fetching background from legacy GS URL:",ne)}let K="";F.videoBackgroundUrl&&(K=F.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",K)),L(ne=>({...ne,urlLoadingBackground:X,videoBackgroundUrl:K,showAuthButton:F.showAuthButton!==void 0?F.showAuthButton:!0,showDisruptiveLogo:F.showDisruptiveLogo!==void 0?F.showDisruptiveLogo:!0,showHelpButton:F.showHelpButton!==void 0?F.showHelpButton:!0,enableVoiceChat:F.enableVoiceChat!==void 0?F.enableVoiceChat:!0,urlDisruptiveLogo:z,spaceID:n,...e||{}})),K&&(console.log("WebGLLoader: Dispatching video background event with URL:",K),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:K}}))),l(!1)}else $.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(F){$.error("WebGLLoader: Error fetching space data:",F)}finally{l(!1)}})()},[n,O.urlDisruptiveLogo,e]),N.useEffect(()=>{(async()=>{if(!u&&_&&f)try{const F=await f(n);b(F)}catch(F){$.error("WebGLLoader: ban check error",F)}})()},[u,_,n,f]),N.useEffect(()=>{a||($.log("WebGLLoader: Unity config from Firebase",C),$.log("WebGLLoader: Space settings from Firebase",O))},[a]),u?T.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Loading user"}):E?T.jsx("div",{className:"flex justify-center items-center h-full mt-12 text-red-500",children:"Access Denied: You have been banned from this space."}):n?T.jsx(T.Fragment,{children:a?T.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):T.jsx(Ize,{...C,children:T.jsx(i3,{ref:i,settings:O})})}):null};tae.propTypes={spaceID:An.string.isRequired,overrideSettings:An.object};function CQ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",a=()=>{const[l,u]=N.useState(null);return N.useEffect(()=>{sUe(i).then(u)},[]),l?T.jsx(n1e,{theme:l,children:T.jsx(gze,{children:T.jsx(_ze,{children:T.jsx(tae,{spaceID:e})})})}):T.jsx("div",{children:"Loading theme..."})};try{Wye.createRoot(n).render(T.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",CQ):CQ());export{iEe as a,OSe as b,Hi as c,ISe as d,uGe as e,lGe as f,ESe as g,Xu as i,lp as m,ARe as t};
