function Dge(r,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in r)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(r,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var Z_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function a0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var nM={exports:{}},Vb={},rM={exports:{}},hr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z7;function Lge(){if(z7)return hr;z7=1;var r=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),I=Symbol.iterator;function N(Oe){return Oe===null||typeof Oe!="object"?null:(Oe=I&&Oe[I]||Oe["@@iterator"],typeof Oe=="function"?Oe:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,G={};function H(Oe,be,Ce){this.props=Oe,this.context=be,this.refs=G,this.updater=Ce||F}H.prototype.isReactComponent={},H.prototype.setState=function(Oe,be){if(typeof Oe!="object"&&typeof Oe!="function"&&Oe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Oe,be,"setState")},H.prototype.forceUpdate=function(Oe){this.updater.enqueueForceUpdate(this,Oe,"forceUpdate")};function te(){}te.prototype=H.prototype;function K(Oe,be,Ce){this.props=Oe,this.context=be,this.refs=G,this.updater=Ce||F}var Q=K.prototype=new te;Q.constructor=K,j(Q,H.prototype),Q.isPureReactComponent=!0;var de=Array.isArray,se=Object.prototype.hasOwnProperty,ge={current:null},ee={key:!0,ref:!0,__self:!0,__source:!0};function Z(Oe,be,Ce){var xe,ze={},Qe=null,et=null;if(be!=null)for(xe in be.ref!==void 0&&(et=be.ref),be.key!==void 0&&(Qe=""+be.key),be)se.call(be,xe)&&!ee.hasOwnProperty(xe)&&(ze[xe]=be[xe]);var ut=arguments.length-2;if(ut===1)ze.children=Ce;else if(1<ut){for(var it=Array(ut),Ct=0;Ct<ut;Ct++)it[Ct]=arguments[Ct+2];ze.children=it}if(Oe&&Oe.defaultProps)for(xe in ut=Oe.defaultProps,ut)ze[xe]===void 0&&(ze[xe]=ut[xe]);return{$$typeof:r,type:Oe,key:Qe,ref:et,props:ze,_owner:ge.current}}function ne(Oe,be){return{$$typeof:r,type:Oe.type,key:be,ref:Oe.ref,props:Oe.props,_owner:Oe._owner}}function ae(Oe){return typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===r}function me(Oe){var be={"=":"=0",":":"=2"};return"$"+Oe.replace(/[=:]/g,function(Ce){return be[Ce]})}var he=/\/+/g;function le(Oe,be){return typeof Oe=="object"&&Oe!==null&&Oe.key!=null?me(""+Oe.key):be.toString(36)}function Me(Oe,be,Ce,xe,ze){var Qe=typeof Oe;(Qe==="undefined"||Qe==="boolean")&&(Oe=null);var et=!1;if(Oe===null)et=!0;else switch(Qe){case"string":case"number":et=!0;break;case"object":switch(Oe.$$typeof){case r:case t:et=!0}}if(et)return et=Oe,ze=ze(et),Oe=xe===""?"."+le(et,0):xe,de(ze)?(Ce="",Oe!=null&&(Ce=Oe.replace(he,"$&/")+"/"),Me(ze,be,Ce,"",function(Ct){return Ct})):ze!=null&&(ae(ze)&&(ze=ne(ze,Ce+(!ze.key||et&&et.key===ze.key?"":(""+ze.key).replace(he,"$&/")+"/")+Oe)),be.push(ze)),1;if(et=0,xe=xe===""?".":xe+":",de(Oe))for(var ut=0;ut<Oe.length;ut++){Qe=Oe[ut];var it=xe+le(Qe,ut);et+=Me(Qe,be,Ce,it,ze)}else if(it=N(Oe),typeof it=="function")for(Oe=it.call(Oe),ut=0;!(Qe=Oe.next()).done;)Qe=Qe.value,it=xe+le(Qe,ut++),et+=Me(Qe,be,Ce,it,ze);else if(Qe==="object")throw be=String(Oe),Error("Objects are not valid as a React child (found: "+(be==="[object Object]"?"object with keys {"+Object.keys(Oe).join(", ")+"}":be)+"). If you meant to render a collection of children, use an array instead.");return et}function Ge(Oe,be,Ce){if(Oe==null)return Oe;var xe=[],ze=0;return Me(Oe,xe,"","",function(Qe){return be.call(Ce,Qe,ze++)}),xe}function tt(Oe){if(Oe._status===-1){var be=Oe._result;be=be(),be.then(function(Ce){(Oe._status===0||Oe._status===-1)&&(Oe._status=1,Oe._result=Ce)},function(Ce){(Oe._status===0||Oe._status===-1)&&(Oe._status=2,Oe._result=Ce)}),Oe._status===-1&&(Oe._status=0,Oe._result=be)}if(Oe._status===1)return Oe._result.default;throw Oe._result}var Ee={current:null},we={transition:null},ve={ReactCurrentDispatcher:Ee,ReactCurrentBatchConfig:we,ReactCurrentOwner:ge};function Be(){throw Error("act(...) is not supported in production builds of React.")}return hr.Children={map:Ge,forEach:function(Oe,be,Ce){Ge(Oe,function(){be.apply(this,arguments)},Ce)},count:function(Oe){var be=0;return Ge(Oe,function(){be++}),be},toArray:function(Oe){return Ge(Oe,function(be){return be})||[]},only:function(Oe){if(!ae(Oe))throw Error("React.Children.only expected to receive a single React element child.");return Oe}},hr.Component=H,hr.Fragment=s,hr.Profiler=l,hr.PureComponent=K,hr.StrictMode=a,hr.Suspense=v,hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ve,hr.act=Be,hr.cloneElement=function(Oe,be,Ce){if(Oe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Oe+".");var xe=j({},Oe.props),ze=Oe.key,Qe=Oe.ref,et=Oe._owner;if(be!=null){if(be.ref!==void 0&&(Qe=be.ref,et=ge.current),be.key!==void 0&&(ze=""+be.key),Oe.type&&Oe.type.defaultProps)var ut=Oe.type.defaultProps;for(it in be)se.call(be,it)&&!ee.hasOwnProperty(it)&&(xe[it]=be[it]===void 0&&ut!==void 0?ut[it]:be[it])}var it=arguments.length-2;if(it===1)xe.children=Ce;else if(1<it){ut=Array(it);for(var Ct=0;Ct<it;Ct++)ut[Ct]=arguments[Ct+2];xe.children=ut}return{$$typeof:r,type:Oe.type,key:ze,ref:Qe,props:xe,_owner:et}},hr.createContext=function(Oe){return Oe={$$typeof:f,_currentValue:Oe,_currentValue2:Oe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Oe.Provider={$$typeof:d,_context:Oe},Oe.Consumer=Oe},hr.createElement=Z,hr.createFactory=function(Oe){var be=Z.bind(null,Oe);return be.type=Oe,be},hr.createRef=function(){return{current:null}},hr.forwardRef=function(Oe){return{$$typeof:E,render:Oe}},hr.isValidElement=ae,hr.lazy=function(Oe){return{$$typeof:w,_payload:{_status:-1,_result:Oe},_init:tt}},hr.memo=function(Oe,be){return{$$typeof:T,type:Oe,compare:be===void 0?null:be}},hr.startTransition=function(Oe){var be=we.transition;we.transition={};try{Oe()}finally{we.transition=be}},hr.unstable_act=Be,hr.useCallback=function(Oe,be){return Ee.current.useCallback(Oe,be)},hr.useContext=function(Oe){return Ee.current.useContext(Oe)},hr.useDebugValue=function(){},hr.useDeferredValue=function(Oe){return Ee.current.useDeferredValue(Oe)},hr.useEffect=function(Oe,be){return Ee.current.useEffect(Oe,be)},hr.useId=function(){return Ee.current.useId()},hr.useImperativeHandle=function(Oe,be,Ce){return Ee.current.useImperativeHandle(Oe,be,Ce)},hr.useInsertionEffect=function(Oe,be){return Ee.current.useInsertionEffect(Oe,be)},hr.useLayoutEffect=function(Oe,be){return Ee.current.useLayoutEffect(Oe,be)},hr.useMemo=function(Oe,be){return Ee.current.useMemo(Oe,be)},hr.useReducer=function(Oe,be,Ce){return Ee.current.useReducer(Oe,be,Ce)},hr.useRef=function(Oe){return Ee.current.useRef(Oe)},hr.useState=function(Oe){return Ee.current.useState(Oe)},hr.useSyncExternalStore=function(Oe,be,Ce){return Ee.current.useSyncExternalStore(Oe,be,Ce)},hr.useTransition=function(){return Ee.current.useTransition()},hr.version="18.3.1",hr}var G7;function vu(){return G7||(G7=1,rM.exports=Lge()),rM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H7;function xge(){if(H7)return Vb;H7=1;var r=vu(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(E,v,T){var w,I={},N=null,F=null;T!==void 0&&(N=""+T),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(F=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(I[w]=v[w]);if(E&&E.defaultProps)for(w in v=E.defaultProps,v)I[w]===void 0&&(I[w]=v[w]);return{$$typeof:t,type:E,key:N,ref:F,props:I,_owner:l.current}}return Vb.Fragment=s,Vb.jsx=f,Vb.jsxs=f,Vb}var $7;function Mge(){return $7||($7=1,nM.exports=xge()),nM.exports}var O=Mge(),L=vu();const ti=a0(L),K7=Dge({__proto__:null,default:ti},[L]);var LP={},iM={exports:{}},Lc={},sM={exports:{}},oM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q7;function Uge(){return q7||(q7=1,function(r){function t(we,ve){var Be=we.length;we.push(ve);e:for(;0<Be;){var Oe=Be-1>>>1,be=we[Oe];if(0<l(be,ve))we[Oe]=ve,we[Be]=be,Be=Oe;else break e}}function s(we){return we.length===0?null:we[0]}function a(we){if(we.length===0)return null;var ve=we[0],Be=we.pop();if(Be!==ve){we[0]=Be;e:for(var Oe=0,be=we.length,Ce=be>>>1;Oe<Ce;){var xe=2*(Oe+1)-1,ze=we[xe],Qe=xe+1,et=we[Qe];if(0>l(ze,Be))Qe<be&&0>l(et,ze)?(we[Oe]=et,we[Qe]=Be,Oe=Qe):(we[Oe]=ze,we[xe]=Be,Oe=xe);else if(Qe<be&&0>l(et,Be))we[Oe]=et,we[Qe]=Be,Oe=Qe;else break e}}return ve}function l(we,ve){var Be=we.sortIndex-ve.sortIndex;return Be!==0?Be:we.id-ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;r.unstable_now=function(){return d.now()}}else{var f=Date,E=f.now();r.unstable_now=function(){return f.now()-E}}var v=[],T=[],w=1,I=null,N=3,F=!1,j=!1,G=!1,H=typeof setTimeout=="function"?setTimeout:null,te=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Q(we){for(var ve=s(T);ve!==null;){if(ve.callback===null)a(T);else if(ve.startTime<=we)a(T),ve.sortIndex=ve.expirationTime,t(v,ve);else break;ve=s(T)}}function de(we){if(G=!1,Q(we),!j)if(s(v)!==null)j=!0,tt(se);else{var ve=s(T);ve!==null&&Ee(de,ve.startTime-we)}}function se(we,ve){j=!1,G&&(G=!1,te(Z),Z=-1),F=!0;var Be=N;try{for(Q(ve),I=s(v);I!==null&&(!(I.expirationTime>ve)||we&&!me());){var Oe=I.callback;if(typeof Oe=="function"){I.callback=null,N=I.priorityLevel;var be=Oe(I.expirationTime<=ve);ve=r.unstable_now(),typeof be=="function"?I.callback=be:I===s(v)&&a(v),Q(ve)}else a(v);I=s(v)}if(I!==null)var Ce=!0;else{var xe=s(T);xe!==null&&Ee(de,xe.startTime-ve),Ce=!1}return Ce}finally{I=null,N=Be,F=!1}}var ge=!1,ee=null,Z=-1,ne=5,ae=-1;function me(){return!(r.unstable_now()-ae<ne)}function he(){if(ee!==null){var we=r.unstable_now();ae=we;var ve=!0;try{ve=ee(!0,we)}finally{ve?le():(ge=!1,ee=null)}}else ge=!1}var le;if(typeof K=="function")le=function(){K(he)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,Ge=Me.port2;Me.port1.onmessage=he,le=function(){Ge.postMessage(null)}}else le=function(){H(he,0)};function tt(we){ee=we,ge||(ge=!0,le())}function Ee(we,ve){Z=H(function(){we(r.unstable_now())},ve)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(we){we.callback=null},r.unstable_continueExecution=function(){j||F||(j=!0,tt(se))},r.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<we?Math.floor(1e3/we):5},r.unstable_getCurrentPriorityLevel=function(){return N},r.unstable_getFirstCallbackNode=function(){return s(v)},r.unstable_next=function(we){switch(N){case 1:case 2:case 3:var ve=3;break;default:ve=N}var Be=N;N=ve;try{return we()}finally{N=Be}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(we,ve){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var Be=N;N=we;try{return ve()}finally{N=Be}},r.unstable_scheduleCallback=function(we,ve,Be){var Oe=r.unstable_now();switch(typeof Be=="object"&&Be!==null?(Be=Be.delay,Be=typeof Be=="number"&&0<Be?Oe+Be:Oe):Be=Oe,we){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=Be+be,we={id:w++,callback:ve,priorityLevel:we,startTime:Be,expirationTime:be,sortIndex:-1},Be>Oe?(we.sortIndex=Be,t(T,we),s(v)===null&&we===s(T)&&(G?(te(Z),Z=-1):G=!0,Ee(de,Be-Oe))):(we.sortIndex=be,t(v,we),j||F||(j=!0,tt(se))),we},r.unstable_shouldYield=me,r.unstable_wrapCallback=function(we){var ve=N;return function(){var Be=N;N=ve;try{return we.apply(this,arguments)}finally{N=Be}}}}(oM)),oM}var Y7;function Vge(){return Y7||(Y7=1,sM.exports=Uge()),sM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X7;function Fge(){if(X7)return Lc;X7=1;var r=vu(),t=Vge();function s(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,b=1;b<arguments.length;b++)g+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},I={};function N(p){return v.call(I,p)?!0:v.call(w,p)?!1:T.test(p)?I[p]=!0:(w[p]=!0,!1)}function F(p,g,b,P){if(b!==null&&b.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return P?!1:b!==null?!b.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function j(p,g,b,P){if(g===null||typeof g>"u"||F(p,g,b,P))return!0;if(P)return!1;if(b!==null)switch(b.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function G(p,g,b,P,M,z,oe){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=P,this.attributeNamespace=M,this.mustUseProperty=b,this.propertyName=p,this.type=g,this.sanitizeURL=z,this.removeEmptyString=oe}var H={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){H[p]=new G(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];H[g]=new G(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){H[p]=new G(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){H[p]=new G(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){H[p]=new G(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){H[p]=new G(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){H[p]=new G(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){H[p]=new G(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){H[p]=new G(p,5,!1,p.toLowerCase(),null,!1,!1)});var te=/[\-:]([a-z])/g;function K(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(te,K);H[g]=new G(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(te,K);H[g]=new G(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(te,K);H[g]=new G(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){H[p]=new G(p,1,!1,p.toLowerCase(),null,!1,!1)}),H.xlinkHref=new G("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){H[p]=new G(p,1,!1,p.toLowerCase(),null,!0,!0)});function Q(p,g,b,P){var M=H.hasOwnProperty(g)?H[g]:null;(M!==null?M.type!==0:P||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(j(g,b,M,P)&&(b=null),P||M===null?N(g)&&(b===null?p.removeAttribute(g):p.setAttribute(g,""+b)):M.mustUseProperty?p[M.propertyName]=b===null?M.type===3?!1:"":b:(g=M.attributeName,P=M.attributeNamespace,b===null?p.removeAttribute(g):(M=M.type,b=M===3||M===4&&b===!0?"":""+b,P?p.setAttributeNS(P,g,b):p.setAttribute(g,b))))}var de=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,se=Symbol.for("react.element"),ge=Symbol.for("react.portal"),ee=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),ne=Symbol.for("react.profiler"),ae=Symbol.for("react.provider"),me=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),Ge=Symbol.for("react.memo"),tt=Symbol.for("react.lazy"),Ee=Symbol.for("react.offscreen"),we=Symbol.iterator;function ve(p){return p===null||typeof p!="object"?null:(p=we&&p[we]||p["@@iterator"],typeof p=="function"?p:null)}var Be=Object.assign,Oe;function be(p){if(Oe===void 0)try{throw Error()}catch(b){var g=b.stack.trim().match(/\n( *(at )?)/);Oe=g&&g[1]||""}return`
`+Oe+p}var Ce=!1;function xe(p,g){if(!p||Ce)return"";Ce=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(nt){var P=nt}Reflect.construct(p,[],g)}else{try{g.call()}catch(nt){P=nt}p.call(g.prototype)}else{try{throw Error()}catch(nt){P=nt}p()}}catch(nt){if(nt&&P&&typeof nt.stack=="string"){for(var M=nt.stack.split(`
`),z=P.stack.split(`
`),oe=M.length-1,Ie=z.length-1;1<=oe&&0<=Ie&&M[oe]!==z[Ie];)Ie--;for(;1<=oe&&0<=Ie;oe--,Ie--)if(M[oe]!==z[Ie]){if(oe!==1||Ie!==1)do if(oe--,Ie--,0>Ie||M[oe]!==z[Ie]){var Le=`
`+M[oe].replace(" at new "," at ");return p.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",p.displayName)),Le}while(1<=oe&&0<=Ie);break}}}finally{Ce=!1,Error.prepareStackTrace=b}return(p=p?p.displayName||p.name:"")?be(p):""}function ze(p){switch(p.tag){case 5:return be(p.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 2:case 15:return p=xe(p.type,!1),p;case 11:return p=xe(p.type.render,!1),p;case 1:return p=xe(p.type,!0),p;default:return""}}function Qe(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case ee:return"Fragment";case ge:return"Portal";case ne:return"Profiler";case Z:return"StrictMode";case le:return"Suspense";case Me:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case me:return(p.displayName||"Context")+".Consumer";case ae:return(p._context.displayName||"Context")+".Provider";case he:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Ge:return g=p.displayName||null,g!==null?g:Qe(p.type)||"Memo";case tt:g=p._payload,p=p._init;try{return Qe(p(g))}catch{}}return null}function et(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qe(g);case 8:return g===Z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ut(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function it(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Ct(p){var g=it(p)?"checked":"value",b=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),P=""+p[g];if(!p.hasOwnProperty(g)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var M=b.get,z=b.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return M.call(this)},set:function(oe){P=""+oe,z.call(this,oe)}}),Object.defineProperty(p,g,{enumerable:b.enumerable}),{getValue:function(){return P},setValue:function(oe){P=""+oe},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function _n(p){p._valueTracker||(p._valueTracker=Ct(p))}function Vt(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var b=g.getValue(),P="";return p&&(P=it(p)?p.checked?"true":"false":p.value),p=P,p!==b?(g.setValue(p),!0):!1}function ln(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function xn(p,g){var b=g.checked;return Be({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??p._wrapperState.initialChecked})}function Xt(p,g){var b=g.defaultValue==null?"":g.defaultValue,P=g.checked!=null?g.checked:g.defaultChecked;b=ut(g.value!=null?g.value:b),p._wrapperState={initialChecked:P,initialValue:b,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Pt(p,g){g=g.checked,g!=null&&Q(p,"checked",g,!1)}function Dt(p,g){Pt(p,g);var b=ut(g.value),P=g.type;if(b!=null)P==="number"?(b===0&&p.value===""||p.value!=b)&&(p.value=""+b):p.value!==""+b&&(p.value=""+b);else if(P==="submit"||P==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Ue(p,g.type,b):g.hasOwnProperty("defaultValue")&&Ue(p,g.type,ut(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Te(p,g,b){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var P=g.type;if(!(P!=="submit"&&P!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,b||g===p.value||(p.value=g),p.defaultValue=g}b=p.name,b!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,b!==""&&(p.name=b)}function Ue(p,g,b){(g!=="number"||ln(p.ownerDocument)!==p)&&(b==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+b&&(p.defaultValue=""+b))}var $e=Array.isArray;function mt(p,g,b,P){if(p=p.options,g){g={};for(var M=0;M<b.length;M++)g["$"+b[M]]=!0;for(b=0;b<p.length;b++)M=g.hasOwnProperty("$"+p[b].value),p[b].selected!==M&&(p[b].selected=M),M&&P&&(p[b].defaultSelected=!0)}else{for(b=""+ut(b),g=null,M=0;M<p.length;M++){if(p[M].value===b){p[M].selected=!0,P&&(p[M].defaultSelected=!0);return}g!==null||p[M].disabled||(g=p[M])}g!==null&&(g.selected=!0)}}function Et(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(s(91));return Be({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function yt(p,g){var b=g.value;if(b==null){if(b=g.children,g=g.defaultValue,b!=null){if(g!=null)throw Error(s(92));if($e(b)){if(1<b.length)throw Error(s(93));b=b[0]}g=b}g==null&&(g=""),b=g}p._wrapperState={initialValue:ut(b)}}function zt(p,g){var b=ut(g.value),P=ut(g.defaultValue);b!=null&&(b=""+b,b!==p.value&&(p.value=b),g.defaultValue==null&&p.defaultValue!==b&&(p.defaultValue=b)),P!=null&&(p.defaultValue=""+P)}function dn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function hn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yt(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?hn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Bn,ec=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,b,P,M){MSApp.execUnsafeLocalFunction(function(){return p(g,b,P,M)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(Bn=Bn||document.createElement("div"),Bn.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Bn.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function jt(p,g){if(g){var b=p.firstChild;if(b&&b===p.lastChild&&b.nodeType===3){b.nodeValue=g;return}}p.textContent=g}var an={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qi=["Webkit","ms","Moz","O"];Object.keys(an).forEach(function(p){qi.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),an[g]=an[p]})});function Ns(p,g,b){return g==null||typeof g=="boolean"||g===""?"":b||typeof g!="number"||g===0||an.hasOwnProperty(p)&&an[p]?(""+g).trim():g+"px"}function Gs(p,g){p=p.style;for(var b in g)if(g.hasOwnProperty(b)){var P=b.indexOf("--")===0,M=Ns(b,g[b],P);b==="float"&&(b="cssFloat"),P?p.setProperty(b,M):p[b]=M}}var ui=Be({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Na(p,g){if(g){if(ui[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(s(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(s(61))}if(g.style!=null&&typeof g.style!="object")throw Error(s(62))}}function Jc(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var so=null;function oo(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var kl=null,Ds=null,tc=null;function ea(p){if(p=Kf(p)){if(typeof kl!="function")throw Error(s(280));var g=p.stateNode;g&&(g=qf(g),kl(p.stateNode,p.type,g))}}function nc(p){Ds?tc?tc.push(p):tc=[p]:Ds=p}function Qc(){if(Ds){var p=Ds,g=tc;if(tc=Ds=null,ea(p),g)for(p=0;p<g.length;p++)ea(g[p])}}function Ru(p,g){return p(g)}function rc(){}var Zc=!1;function bo(p,g,b){if(Zc)return p(g,b);Zc=!0;try{return Ru(p,g,b)}finally{Zc=!1,(Ds!==null||tc!==null)&&(rc(),Qc())}}function Ci(p,g){var b=p.stateNode;if(b===null)return null;var P=qf(b);if(P===null)return null;b=P[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(P=!P.disabled)||(p=p.type,P=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!P;break e;default:p=!1}if(p)return null;if(b&&typeof b!="function")throw Error(s(231,g,typeof b));return b}var rs=!1;if(E)try{var Da={};Object.defineProperty(Da,"passive",{get:function(){rs=!0}}),window.addEventListener("test",Da,Da),window.removeEventListener("test",Da,Da)}catch{rs=!1}function Cu(p,g,b,P,M,z,oe,Ie,Le){var nt=Array.prototype.slice.call(arguments,3);try{g.apply(b,nt)}catch(It){this.onError(It)}}var ic=!1,ta=null,na=!1,Id=null,wg={onError:function(p){ic=!0,ta=p}};function Iu(p,g,b,P,M,z,oe,Ie,Le){ic=!1,ta=null,Cu.apply(wg,arguments)}function tp(p,g,b,P,M,z,oe,Ie,Le){if(Iu.apply(this,arguments),ic){if(ic){var nt=ta;ic=!1,ta=null}else throw Error(s(198));na||(na=!0,Id=nt)}}function Ls(p){var g=p,b=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(b=g.return),p=g.return;while(p)}return g.tag===3?b:null}function Au(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function ra(p){if(Ls(p)!==p)throw Error(s(188))}function Ad(p){var g=p.alternate;if(!g){if(g=Ls(p),g===null)throw Error(s(188));return g!==p?null:p}for(var b=p,P=g;;){var M=b.return;if(M===null)break;var z=M.alternate;if(z===null){if(P=M.return,P!==null){b=P;continue}break}if(M.child===z.child){for(z=M.child;z;){if(z===b)return ra(M),p;if(z===P)return ra(M),g;z=z.sibling}throw Error(s(188))}if(b.return!==P.return)b=M,P=z;else{for(var oe=!1,Ie=M.child;Ie;){if(Ie===b){oe=!0,b=M,P=z;break}if(Ie===P){oe=!0,P=M,b=z;break}Ie=Ie.sibling}if(!oe){for(Ie=z.child;Ie;){if(Ie===b){oe=!0,b=z,P=M;break}if(Ie===P){oe=!0,P=z,b=M;break}Ie=Ie.sibling}if(!oe)throw Error(s(189))}}if(b.alternate!==P)throw Error(s(190))}if(b.tag!==3)throw Error(s(188));return b.stateNode.current===b?p:g}function Pd(p){return p=Ad(p),p!==null?La(p):null}function La(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=La(p);if(g!==null)return g;p=p.sibling}return null}var Od=t.unstable_scheduleCallback,Pu=t.unstable_cancelCallback,wo=t.unstable_shouldYield,kd=t.unstable_requestPaint,Vr=t.unstable_now,di=t.unstable_getCurrentPriorityLevel,sc=t.unstable_ImmediatePriority,el=t.unstable_UserBlockingPriority,ia=t.unstable_NormalPriority,np=t.unstable_LowPriority,Nd=t.unstable_IdlePriority,Nl=null,ao=null;function Nf(p){if(ao&&typeof ao.onCommitFiberRoot=="function")try{ao.onCommitFiberRoot(Nl,p,void 0,(p.current.flags&128)===128)}catch{}}var Hs=Math.clz32?Math.clz32:Dd,rp=Math.log,tl=Math.LN2;function Dd(p){return p>>>=0,p===0?32:31-(rp(p)/tl|0)|0}var Ld=64,ur=4194304;function Dl(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Ll(p,g){var b=p.pendingLanes;if(b===0)return 0;var P=0,M=p.suspendedLanes,z=p.pingedLanes,oe=b&268435455;if(oe!==0){var Ie=oe&~M;Ie!==0?P=Dl(Ie):(z&=oe,z!==0&&(P=Dl(z)))}else oe=b&~M,oe!==0?P=Dl(oe):z!==0&&(P=Dl(z));if(P===0)return 0;if(g!==0&&g!==P&&(g&M)===0&&(M=P&-P,z=g&-g,M>=z||M===16&&(z&4194240)!==0))return g;if((P&4)!==0&&(P|=b&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=P;0<g;)b=31-Hs(g),M=1<<b,P|=p[b],g&=~M;return P}function Ou(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xa(p,g){for(var b=p.suspendedLanes,P=p.pingedLanes,M=p.expirationTimes,z=p.pendingLanes;0<z;){var oe=31-Hs(z),Ie=1<<oe,Le=M[oe];Le===-1?((Ie&b)===0||(Ie&P)!==0)&&(M[oe]=Ou(Ie,g)):Le<=g&&(p.expiredLanes|=Ie),z&=~Ie}}function Ro(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function ku(){var p=Ld;return Ld<<=1,(Ld&4194240)===0&&(Ld=64),p}function nl(p){for(var g=[],b=0;31>b;b++)g.push(p);return g}function xl(p,g,b){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-Hs(g),p[g]=b}function Wr(p,g){var b=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var P=p.eventTimes;for(p=p.expirationTimes;0<b;){var M=31-Hs(b),z=1<<M;g[M]=0,P[M]=-1,p[M]=-1,b&=~z}}function Ma(p,g){var b=p.entangledLanes|=g;for(p=p.entanglements;b;){var P=31-Hs(b),M=1<<P;M&g|p[P]&g&&(p[P]|=g),b&=~M}}var rr=0;function oc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Df,Ml,xd,ip,Lf,sp=!1,Co=[],Yi=null,Io=null,Ao=null,Ul=new Map,Po=new Map,Oo=[],xf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ac(p,g){switch(p){case"focusin":case"focusout":Yi=null;break;case"dragenter":case"dragleave":Io=null;break;case"mouseover":case"mouseout":Ao=null;break;case"pointerover":case"pointerout":Ul.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Po.delete(g.pointerId)}}function is(p,g,b,P,M,z){return p===null||p.nativeEvent!==z?(p={blockedOn:g,domEventName:b,eventSystemFlags:P,nativeEvent:z,targetContainers:[M]},g!==null&&(g=Kf(g),g!==null&&Ml(g)),p):(p.eventSystemFlags|=P,g=p.targetContainers,M!==null&&g.indexOf(M)===-1&&g.push(M),p)}function Nu(p,g,b,P,M){switch(g){case"focusin":return Yi=is(Yi,p,g,b,P,M),!0;case"dragenter":return Io=is(Io,p,g,b,P,M),!0;case"mouseover":return Ao=is(Ao,p,g,b,P,M),!0;case"pointerover":var z=M.pointerId;return Ul.set(z,is(Ul.get(z)||null,p,g,b,P,M)),!0;case"gotpointercapture":return z=M.pointerId,Po.set(z,is(Po.get(z)||null,p,g,b,P,M)),!0}return!1}function op(p){var g=fp(p.target);if(g!==null){var b=Ls(g);if(b!==null){if(g=b.tag,g===13){if(g=Au(b),g!==null){p.blockedOn=g,Lf(p.priority,function(){xd(b)});return}}else if(g===3&&b.stateNode.current.memoizedState.isDehydrated){p.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}p.blockedOn=null}function rl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var b=mr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(b===null){b=p.nativeEvent;var P=new b.constructor(b.type,b);so=P,b.target.dispatchEvent(P),so=null}else return g=Kf(b),g!==null&&Ml(g),p.blockedOn=b,!1;g.shift()}return!0}function Vl(p,g,b){rl(p)&&b.delete(g)}function Mf(){sp=!1,Yi!==null&&rl(Yi)&&(Yi=null),Io!==null&&rl(Io)&&(Io=null),Ao!==null&&rl(Ao)&&(Ao=null),Ul.forEach(Vl),Po.forEach(Vl)}function sa(p,g){p.blockedOn===g&&(p.blockedOn=null,sp||(sp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Mf)))}function oa(p){function g(M){return sa(M,p)}if(0<Co.length){sa(Co[0],p);for(var b=1;b<Co.length;b++){var P=Co[b];P.blockedOn===p&&(P.blockedOn=null)}}for(Yi!==null&&sa(Yi,p),Io!==null&&sa(Io,p),Ao!==null&&sa(Ao,p),Ul.forEach(g),Po.forEach(g),b=0;b<Oo.length;b++)P=Oo[b],P.blockedOn===p&&(P.blockedOn=null);for(;0<Oo.length&&(b=Oo[0],b.blockedOn===null);)op(b),b.blockedOn===null&&Oo.shift()}var il=de.ReactCurrentBatchConfig,Se=!0;function Ne(p,g,b,P){var M=rr,z=il.transition;il.transition=null;try{rr=1,Kt(p,g,b,P)}finally{rr=M,il.transition=z}}function Ze(p,g,b,P){var M=rr,z=il.transition;il.transition=null;try{rr=4,Kt(p,g,b,P)}finally{rr=M,il.transition=z}}function Kt(p,g,b,P){if(Se){var M=mr(p,g,b,P);if(M===null)WE(p,g,P,Kn,b),ac(p,P);else if(Nu(M,p,g,b,P))P.stopPropagation();else if(ac(p,P),g&4&&-1<xf.indexOf(p)){for(;M!==null;){var z=Kf(M);if(z!==null&&Df(z),z=mr(p,g,b,P),z===null&&WE(p,g,P,Kn,b),z===M)break;M=z}M!==null&&P.stopPropagation()}else WE(p,g,P,null,b)}}var Kn=null;function mr(p,g,b,P){if(Kn=null,p=oo(P),p=fp(p),p!==null)if(g=Ls(p),g===null)p=null;else if(b=g.tag,b===13){if(p=Au(g),p!==null)return p;p=null}else if(b===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return Kn=p,null}function Fr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(di()){case sc:return 1;case el:return 4;case ia:case np:return 16;case Nd:return 536870912;default:return 16}default:return 16}}var cn=null,Or=null,hi=null;function Ss(){if(hi)return hi;var p,g=Or,b=g.length,P,M="value"in cn?cn.value:cn.textContent,z=M.length;for(p=0;p<b&&g[p]===M[p];p++);var oe=b-p;for(P=1;P<=oe&&g[b-P]===M[z-P];P++);return hi=M.slice(p,1<P?1-P:void 0)}function ko(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function No(){return!0}function Du(){return!1}function Fi(p){function g(b,P,M,z,oe){this._reactName=b,this._targetInst=M,this.type=P,this.nativeEvent=z,this.target=oe,this.currentTarget=null;for(var Ie in p)p.hasOwnProperty(Ie)&&(b=p[Ie],this[Ie]=b?b(z):z[Ie]);return this.isDefaultPrevented=(z.defaultPrevented!=null?z.defaultPrevented:z.returnValue===!1)?No:Du,this.isPropagationStopped=Du,this}return Be(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=No)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=No)},persist:function(){},isPersistent:No}),g}var sl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Md=Fi(sl),cc=Be({},sl,{view:0,detail:0}),Rg=Fi(cc),Uf,Lu,Do,Fl=Be({},cc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Do&&(Do&&p.type==="mousemove"?(Uf=p.screenX-Do.screenX,Lu=p.screenY-Do.screenY):Lu=Uf=0,Do=p),Uf)},movementY:function(p){return"movementY"in p?p.movementY:Lu}}),Vf=Fi(Fl),Cg=Be({},Fl,{dataTransfer:0}),LE=Fi(Cg),Ff=Be({},cc,{relatedTarget:0}),jf=Fi(Ff),xu=Be({},sl,{animationName:0,elapsedTime:0,pseudoElement:0}),Mu=Fi(xu),Uu=Be({},sl,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Ig=Fi(Uu),xE=Be({},sl,{data:0}),Mn=Fi(xE),Bf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Lo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ME={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function UE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=ME[p])?!!g[p]:!1}function lc(){return UE}var C=Be({},cc,{key:function(p){if(p.key){var g=Bf[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=ko(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Lo[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lc,charCode:function(p){return p.type==="keypress"?ko(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?ko(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),B=Fi(C),J=Be({},Fl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pe=Fi(J),Ke=Be({},cc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lc}),ot=Fi(Ke),xt=Be({},sl,{propertyName:0,elapsedTime:0,pseudoElement:0}),zr=Fi(xt),ri=Be({},Fl,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),gr=Fi(ri),xs=[9,13,27,32],ss=E&&"CompositionEvent"in window,Ua=null;E&&"documentMode"in document&&(Ua=document.documentMode);var xo=E&&"TextEvent"in window&&!Ua,ap=E&&(!ss||Ua&&8<Ua&&11>=Ua),Wf=" ",Va=!1;function YR(p,g){switch(p){case"keyup":return xs.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var zf=!1;function kN(p,g){switch(p){case"compositionend":return XR(g);case"keypress":return g.which!==32?null:(Va=!0,Wf);case"textInput":return p=g.data,p===Wf&&Va?null:p;default:return null}}function JR(p,g){if(zf)return p==="compositionend"||!ss&&YR(p,g)?(p=Ss(),hi=Or=cn=null,zf=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return ap&&g.locale!=="ko"?null:g.data;default:return null}}var NN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function QR(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!NN[p.type]:g==="textarea"}function T0(p,g,b,P){nc(P),g=zE(g,"onChange"),0<g.length&&(b=new Md("onChange","change",null,b,P),p.push({event:b,listeners:g}))}var cp=null,Ag=null;function DN(p){P0(p,0)}function lp(p){var g=mp(p);if(Vt(g))return p}function LN(p,g){if(p==="change")return g}var ZR=!1;if(E){var b0;if(E){var uc="oninput"in document;if(!uc){var eC=document.createElement("div");eC.setAttribute("oninput","return;"),uc=typeof eC.oninput=="function"}b0=uc}else b0=!1;ZR=b0&&(!document.documentMode||9<document.documentMode)}function tC(){cp&&(cp.detachEvent("onpropertychange",aa),Ag=cp=null)}function aa(p){if(p.propertyName==="value"&&lp(Ag)){var g=[];T0(g,Ag,p,oo(p)),bo(DN,g)}}function xN(p,g,b){p==="focusin"?(tC(),cp=g,Ag=b,cp.attachEvent("onpropertychange",aa)):p==="focusout"&&tC()}function MN(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return lp(Ag)}function UN(p,g){if(p==="click")return lp(g)}function VN(p,g){if(p==="input"||p==="change")return lp(g)}function nC(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var ol=typeof Object.is=="function"?Object.is:nC;function Pg(p,g){if(ol(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var b=Object.keys(p),P=Object.keys(g);if(b.length!==P.length)return!1;for(P=0;P<b.length;P++){var M=b[P];if(!v.call(g,M)||!ol(p[M],g[M]))return!1}return!0}function rC(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function w0(p,g){var b=rC(p);p=0;for(var P;b;){if(b.nodeType===3){if(P=p+b.textContent.length,p<=g&&P>=g)return{node:b,offset:g-p};p=P}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=rC(b)}}function iC(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?iC(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function sC(){for(var p=window,g=ln();g instanceof p.HTMLIFrameElement;){try{var b=typeof g.contentWindow.location.href=="string"}catch{b=!1}if(b)p=g.contentWindow;else break;g=ln(p.document)}return g}function Og(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function R0(p){var g=sC(),b=p.focusedElem,P=p.selectionRange;if(g!==b&&b&&b.ownerDocument&&iC(b.ownerDocument.documentElement,b)){if(P!==null&&Og(b)){if(g=P.start,p=P.end,p===void 0&&(p=g),"selectionStart"in b)b.selectionStart=g,b.selectionEnd=Math.min(p,b.value.length);else if(p=(g=b.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var M=b.textContent.length,z=Math.min(P.start,M);P=P.end===void 0?z:Math.min(P.end,M),!p.extend&&z>P&&(M=P,P=z,z=M),M=w0(b,z);var oe=w0(b,P);M&&oe&&(p.rangeCount!==1||p.anchorNode!==M.node||p.anchorOffset!==M.offset||p.focusNode!==oe.node||p.focusOffset!==oe.offset)&&(g=g.createRange(),g.setStart(M.node,M.offset),p.removeAllRanges(),z>P?(p.addRange(g),p.extend(oe.node,oe.offset)):(g.setEnd(oe.node,oe.offset),p.addRange(g)))}}for(g=[],p=b;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<g.length;b++)p=g[b],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var FN=E&&"documentMode"in document&&11>=document.documentMode,st=null,C0=null,kg=null,I0=!1;function oC(p,g,b){var P=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;I0||st==null||st!==ln(P)||(P=st,"selectionStart"in P&&Og(P)?P={start:P.selectionStart,end:P.selectionEnd}:(P=(P.ownerDocument&&P.ownerDocument.defaultView||window).getSelection(),P={anchorNode:P.anchorNode,anchorOffset:P.anchorOffset,focusNode:P.focusNode,focusOffset:P.focusOffset}),kg&&Pg(kg,P)||(kg=P,P=zE(C0,"onSelect"),0<P.length&&(g=new Md("onSelect","select",null,g,b),p.push({event:g,listeners:P}),g.target=st)))}function VE(p,g){var b={};return b[p.toLowerCase()]=g.toLowerCase(),b["Webkit"+p]="webkit"+g,b["Moz"+p]="moz"+g,b}var Gf={animationend:VE("Animation","AnimationEnd"),animationiteration:VE("Animation","AnimationIteration"),animationstart:VE("Animation","AnimationStart"),transitionend:VE("Transition","TransitionEnd")},A0={},aC={};E&&(aC=document.createElement("div").style,"AnimationEvent"in window||(delete Gf.animationend.animation,delete Gf.animationiteration.animation,delete Gf.animationstart.animation),"TransitionEvent"in window||delete Gf.transitionend.transition);function up(p){if(A0[p])return A0[p];if(!Gf[p])return p;var g=Gf[p],b;for(b in g)if(g.hasOwnProperty(b)&&b in aC)return A0[p]=g[b];return p}var dp=up("animationend"),cC=up("animationiteration"),lC=up("animationstart"),uC=up("transitionend"),dC=new Map,FE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ud(p,g){dC.set(p,g),d(g,[p])}for(var jE=0;jE<FE.length;jE++){var Fa=FE[jE],jN=Fa.toLowerCase(),Ng=Fa[0].toUpperCase()+Fa.slice(1);Ud(jN,"on"+Ng)}Ud(dp,"onAnimationEnd"),Ud(cC,"onAnimationIteration"),Ud(lC,"onAnimationStart"),Ud("dblclick","onDoubleClick"),Ud("focusin","onFocus"),Ud("focusout","onBlur"),Ud(uC,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),BN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dg));function hC(p,g,b){var P=p.type||"unknown-event";p.currentTarget=b,tp(P,g,void 0,p),p.currentTarget=null}function P0(p,g){g=(g&4)!==0;for(var b=0;b<p.length;b++){var P=p[b],M=P.event;P=P.listeners;e:{var z=void 0;if(g)for(var oe=P.length-1;0<=oe;oe--){var Ie=P[oe],Le=Ie.instance,nt=Ie.currentTarget;if(Ie=Ie.listener,Le!==z&&M.isPropagationStopped())break e;hC(M,Ie,nt),z=Le}else for(oe=0;oe<P.length;oe++){if(Ie=P[oe],Le=Ie.instance,nt=Ie.currentTarget,Ie=Ie.listener,Le!==z&&M.isPropagationStopped())break e;hC(M,Ie,nt),z=Le}}}if(na)throw p=Id,na=!1,Id=null,p}function Ei(p,g){var b=g[Ug];b===void 0&&(b=g[Ug]=new Set);var P=p+"__bubble";b.has(P)||(pC(g,p,2,!1),b.add(P))}function O0(p,g,b){var P=0;g&&(P|=4),pC(b,p,P,g)}var BE="_reactListening"+Math.random().toString(36).slice(2);function hp(p){if(!p[BE]){p[BE]=!0,a.forEach(function(b){b!=="selectionchange"&&(BN.has(b)||O0(b,!1,p),O0(b,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[BE]||(g[BE]=!0,O0("selectionchange",!1,g))}}function pC(p,g,b,P){switch(Fr(g)){case 1:var M=Ne;break;case 4:M=Ze;break;default:M=Kt}b=M.bind(null,g,b,p),M=void 0,!rs||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(M=!0),P?M!==void 0?p.addEventListener(g,b,{capture:!0,passive:M}):p.addEventListener(g,b,!0):M!==void 0?p.addEventListener(g,b,{passive:M}):p.addEventListener(g,b,!1)}function WE(p,g,b,P,M){var z=P;if((g&1)===0&&(g&2)===0&&P!==null)e:for(;;){if(P===null)return;var oe=P.tag;if(oe===3||oe===4){var Ie=P.stateNode.containerInfo;if(Ie===M||Ie.nodeType===8&&Ie.parentNode===M)break;if(oe===4)for(oe=P.return;oe!==null;){var Le=oe.tag;if((Le===3||Le===4)&&(Le=oe.stateNode.containerInfo,Le===M||Le.nodeType===8&&Le.parentNode===M))return;oe=oe.return}for(;Ie!==null;){if(oe=fp(Ie),oe===null)return;if(Le=oe.tag,Le===5||Le===6){P=z=oe;continue e}Ie=Ie.parentNode}}P=P.return}bo(function(){var nt=z,It=oo(b),At=[];e:{var wt=dC.get(p);if(wt!==void 0){var Ht=Md,Zt=p;switch(p){case"keypress":if(ko(b)===0)break e;case"keydown":case"keyup":Ht=B;break;case"focusin":Zt="focus",Ht=jf;break;case"focusout":Zt="blur",Ht=jf;break;case"beforeblur":case"afterblur":Ht=jf;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ht=Vf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ht=LE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ht=ot;break;case dp:case cC:case lC:Ht=Mu;break;case uC:Ht=zr;break;case"scroll":Ht=Rg;break;case"wheel":Ht=gr;break;case"copy":case"cut":case"paste":Ht=Ig;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ht=pe}var en=(g&4)!==0,Bi=!en&&p==="scroll",Ye=en?wt!==null?wt+"Capture":null:wt;en=[];for(var Ve=nt,Je;Ve!==null;){Je=Ve;var Nt=Je.stateNode;if(Je.tag===5&&Nt!==null&&(Je=Nt,Ye!==null&&(Nt=Ci(Ve,Ye),Nt!=null&&en.push(Hf(Ve,Nt,Je)))),Bi)break;Ve=Ve.return}0<en.length&&(wt=new Ht(wt,Zt,null,b,It),At.push({event:wt,listeners:en}))}}if((g&7)===0){e:{if(wt=p==="mouseover"||p==="pointerover",Ht=p==="mouseout"||p==="pointerout",wt&&b!==so&&(Zt=b.relatedTarget||b.fromElement)&&(fp(Zt)||Zt[dc]))break e;if((Ht||wt)&&(wt=It.window===It?It:(wt=It.ownerDocument)?wt.defaultView||wt.parentWindow:window,Ht?(Zt=b.relatedTarget||b.toElement,Ht=nt,Zt=Zt?fp(Zt):null,Zt!==null&&(Bi=Ls(Zt),Zt!==Bi||Zt.tag!==5&&Zt.tag!==6)&&(Zt=null)):(Ht=null,Zt=nt),Ht!==Zt)){if(en=Vf,Nt="onMouseLeave",Ye="onMouseEnter",Ve="mouse",(p==="pointerout"||p==="pointerover")&&(en=pe,Nt="onPointerLeave",Ye="onPointerEnter",Ve="pointer"),Bi=Ht==null?wt:mp(Ht),Je=Zt==null?wt:mp(Zt),wt=new en(Nt,Ve+"leave",Ht,b,It),wt.target=Bi,wt.relatedTarget=Je,Nt=null,fp(It)===nt&&(en=new en(Ye,Ve+"enter",Zt,b,It),en.target=Je,en.relatedTarget=Bi,Nt=en),Bi=Nt,Ht&&Zt)t:{for(en=Ht,Ye=Zt,Ve=0,Je=en;Je;Je=pp(Je))Ve++;for(Je=0,Nt=Ye;Nt;Nt=pp(Nt))Je++;for(;0<Ve-Je;)en=pp(en),Ve--;for(;0<Je-Ve;)Ye=pp(Ye),Je--;for(;Ve--;){if(en===Ye||Ye!==null&&en===Ye.alternate)break t;en=pp(en),Ye=pp(Ye)}en=null}else en=null;Ht!==null&&Lg(At,wt,Ht,en,!1),Zt!==null&&Bi!==null&&Lg(At,Bi,Zt,en,!0)}}e:{if(wt=nt?mp(nt):window,Ht=wt.nodeName&&wt.nodeName.toLowerCase(),Ht==="select"||Ht==="input"&&wt.type==="file")var nn=LN;else if(QR(wt))if(ZR)nn=VN;else{nn=MN;var pn=xN}else(Ht=wt.nodeName)&&Ht.toLowerCase()==="input"&&(wt.type==="checkbox"||wt.type==="radio")&&(nn=UN);if(nn&&(nn=nn(p,nt))){T0(At,nn,b,It);break e}pn&&pn(p,wt,nt),p==="focusout"&&(pn=wt._wrapperState)&&pn.controlled&&wt.type==="number"&&Ue(wt,"number",wt.value)}switch(pn=nt?mp(nt):window,p){case"focusin":(QR(pn)||pn.contentEditable==="true")&&(st=pn,C0=nt,kg=null);break;case"focusout":kg=C0=st=null;break;case"mousedown":I0=!0;break;case"contextmenu":case"mouseup":case"dragend":I0=!1,oC(At,b,It);break;case"selectionchange":if(FN)break;case"keydown":case"keyup":oC(At,b,It)}var En;if(ss)e:{switch(p){case"compositionstart":var kn="onCompositionStart";break e;case"compositionend":kn="onCompositionEnd";break e;case"compositionupdate":kn="onCompositionUpdate";break e}kn=void 0}else zf?YR(p,b)&&(kn="onCompositionEnd"):p==="keydown"&&b.keyCode===229&&(kn="onCompositionStart");kn&&(ap&&b.locale!=="ko"&&(zf||kn!=="onCompositionStart"?kn==="onCompositionEnd"&&zf&&(En=Ss()):(cn=It,Or="value"in cn?cn.value:cn.textContent,zf=!0)),pn=zE(nt,kn),0<pn.length&&(kn=new Mn(kn,p,null,b,It),At.push({event:kn,listeners:pn}),En?kn.data=En:(En=XR(b),En!==null&&(kn.data=En)))),(En=xo?kN(p,b):JR(p,b))&&(nt=zE(nt,"onBeforeInput"),0<nt.length&&(It=new Mn("onBeforeInput","beforeinput",null,b,It),At.push({event:It,listeners:nt}),It.data=En))}P0(At,g)})}function Hf(p,g,b){return{instance:p,listener:g,currentTarget:b}}function zE(p,g){for(var b=g+"Capture",P=[];p!==null;){var M=p,z=M.stateNode;M.tag===5&&z!==null&&(M=z,z=Ci(p,b),z!=null&&P.unshift(Hf(p,z,M)),z=Ci(p,g),z!=null&&P.push(Hf(p,z,M))),p=p.return}return P}function pp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function Lg(p,g,b,P,M){for(var z=g._reactName,oe=[];b!==null&&b!==P;){var Ie=b,Le=Ie.alternate,nt=Ie.stateNode;if(Le!==null&&Le===P)break;Ie.tag===5&&nt!==null&&(Ie=nt,M?(Le=Ci(b,z),Le!=null&&oe.unshift(Hf(b,Le,Ie))):M||(Le=Ci(b,z),Le!=null&&oe.push(Hf(b,Le,Ie)))),b=b.return}oe.length!==0&&p.push({event:g,listeners:oe})}var WN=/\r\n?/g,zN=/\u0000|\uFFFD/g;function fC(p){return(typeof p=="string"?p:""+p).replace(WN,`
`).replace(zN,"")}function GE(p,g,b){if(g=fC(g),fC(p)!==g&&b)throw Error(s(425))}function HE(){}var $E=null,xg=null;function k0(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Mg=typeof setTimeout=="function"?setTimeout:void 0,GN=typeof clearTimeout=="function"?clearTimeout:void 0,mC=typeof Promise=="function"?Promise:void 0,HN=typeof queueMicrotask=="function"?queueMicrotask:typeof mC<"u"?function(p){return mC.resolve(null).then(p).catch($N)}:Mg;function $N(p){setTimeout(function(){throw p})}function N0(p,g){var b=g,P=0;do{var M=b.nextSibling;if(p.removeChild(b),M&&M.nodeType===8)if(b=M.data,b==="/$"){if(P===0){p.removeChild(M),oa(g);return}P--}else b!=="$"&&b!=="$?"&&b!=="$!"||P++;b=M}while(b);oa(g)}function Vd(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function gC(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var b=p.data;if(b==="$"||b==="$!"||b==="$?"){if(g===0)return p;g--}else b==="/$"&&g++}p=p.previousSibling}return null}var $f=Math.random().toString(36).slice(2),jl="__reactFiber$"+$f,Fd="__reactProps$"+$f,dc="__reactContainer$"+$f,Ug="__reactEvents$"+$f,KN="__reactListeners$"+$f,qN="__reactHandles$"+$f;function fp(p){var g=p[jl];if(g)return g;for(var b=p.parentNode;b;){if(g=b[dc]||b[jl]){if(b=g.alternate,g.child!==null||b!==null&&b.child!==null)for(p=gC(p);p!==null;){if(b=p[jl])return b;p=gC(p)}return g}p=b,b=p.parentNode}return null}function Kf(p){return p=p[jl]||p[dc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function mp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function qf(p){return p[Fd]||null}var D0=[],Yf=-1;function hc(p){return{current:p}}function yi(p){0>Yf||(p.current=D0[Yf],D0[Yf]=null,Yf--)}function pi(p,g){Yf++,D0[Yf]=p.current,p.current=g}var jd={},co=hc(jd),ca=hc(!1),gp=jd;function _p(p,g){var b=p.type.contextTypes;if(!b)return jd;var P=p.stateNode;if(P&&P.__reactInternalMemoizedUnmaskedChildContext===g)return P.__reactInternalMemoizedMaskedChildContext;var M={},z;for(z in b)M[z]=g[z];return P&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=M),M}function la(p){return p=p.childContextTypes,p!=null}function KE(){yi(ca),yi(co)}function _C(p,g,b){if(co.current!==jd)throw Error(s(168));pi(co,g),pi(ca,b)}function qE(p,g,b){var P=p.stateNode;if(g=g.childContextTypes,typeof P.getChildContext!="function")return b;P=P.getChildContext();for(var M in P)if(!(M in g))throw Error(s(108,et(p)||"Unknown",M));return Be({},b,P)}function YE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||jd,gp=co.current,pi(co,p),pi(ca,ca.current),!0}function EC(p,g,b){var P=p.stateNode;if(!P)throw Error(s(169));b?(p=qE(p,g,gp),P.__reactInternalMemoizedMergedChildContext=p,yi(ca),yi(co),pi(co,p)):yi(ca),pi(ca,b)}var pc=null,XE=!1,L0=!1;function yC(p){pc===null?pc=[p]:pc.push(p)}function YN(p){XE=!0,yC(p)}function Bd(){if(!L0&&pc!==null){L0=!0;var p=0,g=rr;try{var b=pc;for(rr=1;p<b.length;p++){var P=b[p];do P=P(!0);while(P!==null)}pc=null,XE=!1}catch(M){throw pc!==null&&(pc=pc.slice(p+1)),Od(sc,Bd),M}finally{rr=g,L0=!1}}return null}var Xf=[],Vu=0,Vg=null,JE=0,fc=[],ja=0,Ep=null,Fu=1,ju="";function Bu(p,g){Xf[Vu++]=JE,Xf[Vu++]=Vg,Vg=p,JE=g}function QE(p,g,b){fc[ja++]=Fu,fc[ja++]=ju,fc[ja++]=Ep,Ep=p;var P=Fu;p=ju;var M=32-Hs(P)-1;P&=~(1<<M),b+=1;var z=32-Hs(g)+M;if(30<z){var oe=M-M%5;z=(P&(1<<oe)-1).toString(32),P>>=oe,M-=oe,Fu=1<<32-Hs(g)+M|b<<M|P,ju=z+p}else Fu=1<<z|b<<M|P,ju=p}function ZE(p){p.return!==null&&(Bu(p,1),QE(p,1,0))}function Fg(p){for(;p===Vg;)Vg=Xf[--Vu],Xf[Vu]=null,JE=Xf[--Vu],Xf[Vu]=null;for(;p===Ep;)Ep=fc[--ja],fc[ja]=null,ju=fc[--ja],fc[ja]=null,Fu=fc[--ja],fc[ja]=null}var ua=null,da=null,ii=!1,Mo=null;function vC(p,g){var b=za(5,null,null,0);b.elementType="DELETED",b.stateNode=g,b.return=p,g=p.deletions,g===null?(p.deletions=[b],p.flags|=16):g.push(b)}function SC(p,g){switch(p.tag){case 5:var b=p.type;return g=g.nodeType!==1||b.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,ua=p,da=Vd(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,ua=p,da=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(b=Ep!==null?{id:Fu,overflow:ju}:null,p.memoizedState={dehydrated:g,treeContext:b,retryLane:1073741824},b=za(18,null,null,0),b.stateNode=g,b.return=p,p.child=b,ua=p,da=null,!0):!1;default:return!1}}function ey(p){return(p.mode&1)!==0&&(p.flags&128)===0}function x0(p){if(ii){var g=da;if(g){var b=g;if(!SC(p,g)){if(ey(p))throw Error(s(418));g=Vd(b.nextSibling);var P=ua;g&&SC(p,g)?vC(P,b):(p.flags=p.flags&-4097|2,ii=!1,ua=p)}}else{if(ey(p))throw Error(s(418));p.flags=p.flags&-4097|2,ii=!1,ua=p}}}function TC(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;ua=p}function jg(p){if(p!==ua)return!1;if(!ii)return TC(p),ii=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!k0(p.type,p.memoizedProps)),g&&(g=da)){if(ey(p))throw bC(),Error(s(418));for(;g;)vC(p,g),g=Vd(g.nextSibling)}if(TC(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var b=p.data;if(b==="/$"){if(g===0){da=Vd(p.nextSibling);break e}g--}else b!=="$"&&b!=="$!"&&b!=="$?"||g++}p=p.nextSibling}da=null}}else da=ua?Vd(p.stateNode.nextSibling):null;return!0}function bC(){for(var p=da;p;)p=Vd(p.nextSibling)}function Jf(){da=ua=null,ii=!1}function M0(p){Mo===null?Mo=[p]:Mo.push(p)}var XN=de.ReactCurrentBatchConfig;function Bg(p,g,b){if(p=b.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(s(309));var P=b.stateNode}if(!P)throw Error(s(147,p));var M=P,z=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===z?g.ref:(g=function(oe){var Ie=M.refs;oe===null?delete Ie[z]:Ie[z]=oe},g._stringRef=z,g)}if(typeof p!="string")throw Error(s(284));if(!b._owner)throw Error(s(290,p))}return p}function ty(p,g){throw p=Object.prototype.toString.call(g),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function U0(p){var g=p._init;return g(p._payload)}function Wd(p){function g(Ye,Ve){if(p){var Je=Ye.deletions;Je===null?(Ye.deletions=[Ve],Ye.flags|=16):Je.push(Ve)}}function b(Ye,Ve){if(!p)return null;for(;Ve!==null;)g(Ye,Ve),Ve=Ve.sibling;return null}function P(Ye,Ve){for(Ye=new Map;Ve!==null;)Ve.key!==null?Ye.set(Ve.key,Ve):Ye.set(Ve.index,Ve),Ve=Ve.sibling;return Ye}function M(Ye,Ve){return Ye=Yu(Ye,Ve),Ye.index=0,Ye.sibling=null,Ye}function z(Ye,Ve,Je){return Ye.index=Je,p?(Je=Ye.alternate,Je!==null?(Je=Je.index,Je<Ve?(Ye.flags|=2,Ve):Je):(Ye.flags|=2,Ve)):(Ye.flags|=1048576,Ve)}function oe(Ye){return p&&Ye.alternate===null&&(Ye.flags|=2),Ye}function Ie(Ye,Ve,Je,Nt){return Ve===null||Ve.tag!==6?(Ve=vT(Je,Ye.mode,Nt),Ve.return=Ye,Ve):(Ve=M(Ve,Je),Ve.return=Ye,Ve)}function Le(Ye,Ve,Je,Nt){var nn=Je.type;return nn===ee?It(Ye,Ve,Je.props.children,Nt,Je.key):Ve!==null&&(Ve.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===tt&&U0(nn)===Ve.type)?(Nt=M(Ve,Je.props),Nt.ref=Bg(Ye,Ve,Je),Nt.return=Ye,Nt):(Nt=By(Je.type,Je.key,Je.props,null,Ye.mode,Nt),Nt.ref=Bg(Ye,Ve,Je),Nt.return=Ye,Nt)}function nt(Ye,Ve,Je,Nt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==Je.containerInfo||Ve.stateNode.implementation!==Je.implementation?(Ve=ST(Je,Ye.mode,Nt),Ve.return=Ye,Ve):(Ve=M(Ve,Je.children||[]),Ve.return=Ye,Ve)}function It(Ye,Ve,Je,Nt,nn){return Ve===null||Ve.tag!==7?(Ve=Op(Je,Ye.mode,Nt,nn),Ve.return=Ye,Ve):(Ve=M(Ve,Je),Ve.return=Ye,Ve)}function At(Ye,Ve,Je){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=vT(""+Ve,Ye.mode,Je),Ve.return=Ye,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case se:return Je=By(Ve.type,Ve.key,Ve.props,null,Ye.mode,Je),Je.ref=Bg(Ye,null,Ve),Je.return=Ye,Je;case ge:return Ve=ST(Ve,Ye.mode,Je),Ve.return=Ye,Ve;case tt:var Nt=Ve._init;return At(Ye,Nt(Ve._payload),Je)}if($e(Ve)||ve(Ve))return Ve=Op(Ve,Ye.mode,Je,null),Ve.return=Ye,Ve;ty(Ye,Ve)}return null}function wt(Ye,Ve,Je,Nt){var nn=Ve!==null?Ve.key:null;if(typeof Je=="string"&&Je!==""||typeof Je=="number")return nn!==null?null:Ie(Ye,Ve,""+Je,Nt);if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case se:return Je.key===nn?Le(Ye,Ve,Je,Nt):null;case ge:return Je.key===nn?nt(Ye,Ve,Je,Nt):null;case tt:return nn=Je._init,wt(Ye,Ve,nn(Je._payload),Nt)}if($e(Je)||ve(Je))return nn!==null?null:It(Ye,Ve,Je,Nt,null);ty(Ye,Je)}return null}function Ht(Ye,Ve,Je,Nt,nn){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Ye=Ye.get(Je)||null,Ie(Ve,Ye,""+Nt,nn);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case se:return Ye=Ye.get(Nt.key===null?Je:Nt.key)||null,Le(Ve,Ye,Nt,nn);case ge:return Ye=Ye.get(Nt.key===null?Je:Nt.key)||null,nt(Ve,Ye,Nt,nn);case tt:var pn=Nt._init;return Ht(Ye,Ve,Je,pn(Nt._payload),nn)}if($e(Nt)||ve(Nt))return Ye=Ye.get(Je)||null,It(Ve,Ye,Nt,nn,null);ty(Ve,Nt)}return null}function Zt(Ye,Ve,Je,Nt){for(var nn=null,pn=null,En=Ve,kn=Ve=0,us=null;En!==null&&kn<Je.length;kn++){En.index>kn?(us=En,En=null):us=En.sibling;var _r=wt(Ye,En,Je[kn],Nt);if(_r===null){En===null&&(En=us);break}p&&En&&_r.alternate===null&&g(Ye,En),Ve=z(_r,Ve,kn),pn===null?nn=_r:pn.sibling=_r,pn=_r,En=us}if(kn===Je.length)return b(Ye,En),ii&&Bu(Ye,kn),nn;if(En===null){for(;kn<Je.length;kn++)En=At(Ye,Je[kn],Nt),En!==null&&(Ve=z(En,Ve,kn),pn===null?nn=En:pn.sibling=En,pn=En);return ii&&Bu(Ye,kn),nn}for(En=P(Ye,En);kn<Je.length;kn++)us=Ht(En,Ye,kn,Je[kn],Nt),us!==null&&(p&&us.alternate!==null&&En.delete(us.key===null?kn:us.key),Ve=z(us,Ve,kn),pn===null?nn=us:pn.sibling=us,pn=us);return p&&En.forEach(function(Zd){return g(Ye,Zd)}),ii&&Bu(Ye,kn),nn}function en(Ye,Ve,Je,Nt){var nn=ve(Je);if(typeof nn!="function")throw Error(s(150));if(Je=nn.call(Je),Je==null)throw Error(s(151));for(var pn=nn=null,En=Ve,kn=Ve=0,us=null,_r=Je.next();En!==null&&!_r.done;kn++,_r=Je.next()){En.index>kn?(us=En,En=null):us=En.sibling;var Zd=wt(Ye,En,_r.value,Nt);if(Zd===null){En===null&&(En=us);break}p&&En&&Zd.alternate===null&&g(Ye,En),Ve=z(Zd,Ve,kn),pn===null?nn=Zd:pn.sibling=Zd,pn=Zd,En=us}if(_r.done)return b(Ye,En),ii&&Bu(Ye,kn),nn;if(En===null){for(;!_r.done;kn++,_r=Je.next())_r=At(Ye,_r.value,Nt),_r!==null&&(Ve=z(_r,Ve,kn),pn===null?nn=_r:pn.sibling=_r,pn=_r);return ii&&Bu(Ye,kn),nn}for(En=P(Ye,En);!_r.done;kn++,_r=Je.next())_r=Ht(En,Ye,kn,_r.value,Nt),_r!==null&&(p&&_r.alternate!==null&&En.delete(_r.key===null?kn:_r.key),Ve=z(_r,Ve,kn),pn===null?nn=_r:pn.sibling=_r,pn=_r);return p&&En.forEach(function(h1){return g(Ye,h1)}),ii&&Bu(Ye,kn),nn}function Bi(Ye,Ve,Je,Nt){if(typeof Je=="object"&&Je!==null&&Je.type===ee&&Je.key===null&&(Je=Je.props.children),typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case se:e:{for(var nn=Je.key,pn=Ve;pn!==null;){if(pn.key===nn){if(nn=Je.type,nn===ee){if(pn.tag===7){b(Ye,pn.sibling),Ve=M(pn,Je.props.children),Ve.return=Ye,Ye=Ve;break e}}else if(pn.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===tt&&U0(nn)===pn.type){b(Ye,pn.sibling),Ve=M(pn,Je.props),Ve.ref=Bg(Ye,pn,Je),Ve.return=Ye,Ye=Ve;break e}b(Ye,pn);break}else g(Ye,pn);pn=pn.sibling}Je.type===ee?(Ve=Op(Je.props.children,Ye.mode,Nt,Je.key),Ve.return=Ye,Ye=Ve):(Nt=By(Je.type,Je.key,Je.props,null,Ye.mode,Nt),Nt.ref=Bg(Ye,Ve,Je),Nt.return=Ye,Ye=Nt)}return oe(Ye);case ge:e:{for(pn=Je.key;Ve!==null;){if(Ve.key===pn)if(Ve.tag===4&&Ve.stateNode.containerInfo===Je.containerInfo&&Ve.stateNode.implementation===Je.implementation){b(Ye,Ve.sibling),Ve=M(Ve,Je.children||[]),Ve.return=Ye,Ye=Ve;break e}else{b(Ye,Ve);break}else g(Ye,Ve);Ve=Ve.sibling}Ve=ST(Je,Ye.mode,Nt),Ve.return=Ye,Ye=Ve}return oe(Ye);case tt:return pn=Je._init,Bi(Ye,Ve,pn(Je._payload),Nt)}if($e(Je))return Zt(Ye,Ve,Je,Nt);if(ve(Je))return en(Ye,Ve,Je,Nt);ty(Ye,Je)}return typeof Je=="string"&&Je!==""||typeof Je=="number"?(Je=""+Je,Ve!==null&&Ve.tag===6?(b(Ye,Ve.sibling),Ve=M(Ve,Je),Ve.return=Ye,Ye=Ve):(b(Ye,Ve),Ve=vT(Je,Ye.mode,Nt),Ve.return=Ye,Ye=Ve),oe(Ye)):b(Ye,Ve)}return Bi}var Qf=Wd(!0),wC=Wd(!1),ny=hc(null),Wg=null,Zf=null,ry=null;function V0(){ry=Zf=Wg=null}function F0(p){var g=ny.current;yi(ny),p._currentValue=g}function j0(p,g,b){for(;p!==null;){var P=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,P!==null&&(P.childLanes|=g)):P!==null&&(P.childLanes&g)!==g&&(P.childLanes|=g),p===b)break;p=p.return}}function Wu(p,g){Wg=p,ry=Zf=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(pa=!0),p.firstContext=null)}function mc(p){var g=p._currentValue;if(ry!==p)if(p={context:p,memoizedValue:g,next:null},Zf===null){if(Wg===null)throw Error(s(308));Zf=p,Wg.dependencies={lanes:0,firstContext:p}}else Zf=Zf.next=p;return g}var yp=null;function B0(p){yp===null?yp=[p]:yp.push(p)}function RC(p,g,b,P){var M=g.interleaved;return M===null?(b.next=b,B0(g)):(b.next=M.next,M.next=b),g.interleaved=b,zu(p,P)}function zu(p,g){p.lanes|=g;var b=p.alternate;for(b!==null&&(b.lanes|=g),b=p,p=p.return;p!==null;)p.childLanes|=g,b=p.alternate,b!==null&&(b.childLanes|=g),b=p,p=p.return;return b.tag===3?b.stateNode:null}var zd=!1;function zg(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function CC(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Bl(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function Gd(p,g,b){var P=p.updateQueue;if(P===null)return null;if(P=P.shared,(Sr&2)!==0){var M=P.pending;return M===null?g.next=g:(g.next=M.next,M.next=g),P.pending=g,zu(p,b)}return M=P.interleaved,M===null?(g.next=g,B0(P)):(g.next=M.next,M.next=g),P.interleaved=g,zu(p,b)}function Gg(p,g,b){if(g=g.updateQueue,g!==null&&(g=g.shared,(b&4194240)!==0)){var P=g.lanes;P&=p.pendingLanes,b|=P,g.lanes=b,Ma(p,b)}}function IC(p,g){var b=p.updateQueue,P=p.alternate;if(P!==null&&(P=P.updateQueue,b===P)){var M=null,z=null;if(b=b.firstBaseUpdate,b!==null){do{var oe={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};z===null?M=z=oe:z=z.next=oe,b=b.next}while(b!==null);z===null?M=z=g:z=z.next=g}else M=z=g;b={baseState:P.baseState,firstBaseUpdate:M,lastBaseUpdate:z,shared:P.shared,effects:P.effects},p.updateQueue=b;return}p=b.lastBaseUpdate,p===null?b.firstBaseUpdate=g:p.next=g,b.lastBaseUpdate=g}function iy(p,g,b,P){var M=p.updateQueue;zd=!1;var z=M.firstBaseUpdate,oe=M.lastBaseUpdate,Ie=M.shared.pending;if(Ie!==null){M.shared.pending=null;var Le=Ie,nt=Le.next;Le.next=null,oe===null?z=nt:oe.next=nt,oe=Le;var It=p.alternate;It!==null&&(It=It.updateQueue,Ie=It.lastBaseUpdate,Ie!==oe&&(Ie===null?It.firstBaseUpdate=nt:Ie.next=nt,It.lastBaseUpdate=Le))}if(z!==null){var At=M.baseState;oe=0,It=nt=Le=null,Ie=z;do{var wt=Ie.lane,Ht=Ie.eventTime;if((P&wt)===wt){It!==null&&(It=It.next={eventTime:Ht,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var Zt=p,en=Ie;switch(wt=g,Ht=b,en.tag){case 1:if(Zt=en.payload,typeof Zt=="function"){At=Zt.call(Ht,At,wt);break e}At=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=en.payload,wt=typeof Zt=="function"?Zt.call(Ht,At,wt):Zt,wt==null)break e;At=Be({},At,wt);break e;case 2:zd=!0}}Ie.callback!==null&&Ie.lane!==0&&(p.flags|=64,wt=M.effects,wt===null?M.effects=[Ie]:wt.push(Ie))}else Ht={eventTime:Ht,lane:wt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},It===null?(nt=It=Ht,Le=At):It=It.next=Ht,oe|=wt;if(Ie=Ie.next,Ie===null){if(Ie=M.shared.pending,Ie===null)break;wt=Ie,Ie=wt.next,wt.next=null,M.lastBaseUpdate=wt,M.shared.pending=null}}while(!0);if(It===null&&(Le=At),M.baseState=Le,M.firstBaseUpdate=nt,M.lastBaseUpdate=It,g=M.shared.interleaved,g!==null){M=g;do oe|=M.lane,M=M.next;while(M!==g)}else z===null&&(M.shared.lanes=0);Rp|=oe,p.lanes=oe,p.memoizedState=At}}function AC(p,g,b){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var P=p[g],M=P.callback;if(M!==null){if(P.callback=null,P=b,typeof M!="function")throw Error(s(191,M));M.call(P)}}}var Hg={},Wl=hc(Hg),$g=hc(Hg),em=hc(Hg);function vp(p){if(p===Hg)throw Error(s(174));return p}function W0(p,g){switch(pi(em,g),pi($g,p),pi(Wl,Hg),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Yt(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=Yt(g,p)}yi(Wl),pi(Wl,g)}function Sp(){yi(Wl),yi($g),yi(em)}function PC(p){vp(em.current);var g=vp(Wl.current),b=Yt(g,p.type);g!==b&&(pi($g,p),pi(Wl,b))}function tm(p){$g.current===p&&(yi(Wl),yi($g))}var Ti=hc(0);function Hd(p){for(var g=p;g!==null;){if(g.tag===13){var b=g.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var z0=[];function G0(){for(var p=0;p<z0.length;p++)z0[p]._workInProgressVersionPrimary=null;z0.length=0}var sy=de.ReactCurrentDispatcher,H0=de.ReactCurrentBatchConfig,zl=0,Ii=null,os=null,as=null,nm=!1,Kg=!1,qg=0,JN=0;function lo(){throw Error(s(321))}function $0(p,g){if(g===null)return!1;for(var b=0;b<g.length&&b<p.length;b++)if(!ol(p[b],g[b]))return!1;return!0}function rm(p,g,b,P,M,z){if(zl=z,Ii=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,sy.current=p===null||p.memoizedState===null?e1:jC,p=b(P,M),Kg){z=0;do{if(Kg=!1,qg=0,25<=z)throw Error(s(301));z+=1,as=os=null,g.updateQueue=null,sy.current=t1,p=b(P,M)}while(Kg)}if(sy.current=ly,g=os!==null&&os.next!==null,zl=0,as=os=Ii=null,nm=!1,g)throw Error(s(300));return p}function K0(){var p=qg!==0;return qg=0,p}function Uo(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return as===null?Ii.memoizedState=as=p:as=as.next=p,as}function ha(){if(os===null){var p=Ii.alternate;p=p!==null?p.memoizedState:null}else p=os.next;var g=as===null?Ii.memoizedState:as.next;if(g!==null)as=g,os=p;else{if(p===null)throw Error(s(310));os=p,p={memoizedState:os.memoizedState,baseState:os.baseState,baseQueue:os.baseQueue,queue:os.queue,next:null},as===null?Ii.memoizedState=as=p:as=as.next=p}return as}function $d(p,g){return typeof g=="function"?g(p):g}function Tp(p){var g=ha(),b=g.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=p;var P=os,M=P.baseQueue,z=b.pending;if(z!==null){if(M!==null){var oe=M.next;M.next=z.next,z.next=oe}P.baseQueue=M=z,b.pending=null}if(M!==null){z=M.next,P=P.baseState;var Ie=oe=null,Le=null,nt=z;do{var It=nt.lane;if((zl&It)===It)Le!==null&&(Le=Le.next={lane:0,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null}),P=nt.hasEagerState?nt.eagerState:p(P,nt.action);else{var At={lane:It,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null};Le===null?(Ie=Le=At,oe=P):Le=Le.next=At,Ii.lanes|=It,Rp|=It}nt=nt.next}while(nt!==null&&nt!==z);Le===null?oe=P:Le.next=Ie,ol(P,g.memoizedState)||(pa=!0),g.memoizedState=P,g.baseState=oe,g.baseQueue=Le,b.lastRenderedState=P}if(p=b.interleaved,p!==null){M=p;do z=M.lane,Ii.lanes|=z,Rp|=z,M=M.next;while(M!==p)}else M===null&&(b.lanes=0);return[g.memoizedState,b.dispatch]}function im(p){var g=ha(),b=g.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=p;var P=b.dispatch,M=b.pending,z=g.memoizedState;if(M!==null){b.pending=null;var oe=M=M.next;do z=p(z,oe.action),oe=oe.next;while(oe!==M);ol(z,g.memoizedState)||(pa=!0),g.memoizedState=z,g.baseQueue===null&&(g.baseState=z),b.lastRenderedState=z}return[z,P]}function OC(){}function q0(p,g){var b=Ii,P=ha(),M=g(),z=!ol(P.memoizedState,M);if(z&&(P.memoizedState=M,pa=!0),P=P.queue,gc(NC.bind(null,b,P,p),[p]),P.getSnapshot!==g||z||as!==null&&as.memoizedState.tag&1){if(b.flags|=2048,Yg(9,Y0.bind(null,b,P,M,g),void 0,null),Ms===null)throw Error(s(349));(zl&30)!==0||kC(b,g,M)}return M}function kC(p,g,b){p.flags|=16384,p={getSnapshot:g,value:b},g=Ii.updateQueue,g===null?(g={lastEffect:null,stores:null},Ii.updateQueue=g,g.stores=[p]):(b=g.stores,b===null?g.stores=[p]:b.push(p))}function Y0(p,g,b,P){g.value=b,g.getSnapshot=P,DC(g)&&oy(p)}function NC(p,g,b){return b(function(){DC(g)&&oy(p)})}function DC(p){var g=p.getSnapshot;p=p.value;try{var b=g();return!ol(p,b)}catch{return!0}}function oy(p){var g=zu(p,1);g!==null&&vc(g,p,1,-1)}function ay(p){var g=Uo();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$d,lastRenderedState:p},g.queue=p,p=p.dispatch=ZN.bind(null,Ii,p),[g.memoizedState,p]}function Yg(p,g,b,P){return p={tag:p,create:g,destroy:b,deps:P,next:null},g=Ii.updateQueue,g===null?(g={lastEffect:null,stores:null},Ii.updateQueue=g,g.lastEffect=p.next=p):(b=g.lastEffect,b===null?g.lastEffect=p.next=p:(P=b.next,b.next=p,p.next=P,g.lastEffect=p)),p}function LC(){return ha().memoizedState}function Xg(p,g,b,P){var M=Uo();Ii.flags|=p,M.memoizedState=Yg(1|g,b,void 0,P===void 0?null:P)}function sm(p,g,b,P){var M=ha();P=P===void 0?null:P;var z=void 0;if(os!==null){var oe=os.memoizedState;if(z=oe.destroy,P!==null&&$0(P,oe.deps)){M.memoizedState=Yg(g,b,z,P);return}}Ii.flags|=p,M.memoizedState=Yg(1|g,b,z,P)}function xC(p,g){return Xg(8390656,8,p,g)}function gc(p,g){return sm(2048,8,p,g)}function bp(p,g){return sm(4,2,p,g)}function Kd(p,g){return sm(4,4,p,g)}function X0(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function J0(p,g,b){return b=b!=null?b.concat([p]):null,sm(4,4,X0.bind(null,g,p),b)}function Gu(){}function cy(p,g){var b=ha();g=g===void 0?null:g;var P=b.memoizedState;return P!==null&&g!==null&&$0(g,P[1])?P[0]:(b.memoizedState=[p,g],p)}function MC(p,g){var b=ha();g=g===void 0?null:g;var P=b.memoizedState;return P!==null&&g!==null&&$0(g,P[1])?P[0]:(p=p(),b.memoizedState=[p,g],p)}function Q0(p,g,b){return(zl&21)===0?(p.baseState&&(p.baseState=!1,pa=!0),p.memoizedState=b):(ol(b,g)||(b=ku(),Ii.lanes|=b,Rp|=b,p.baseState=!0),g)}function QN(p,g){var b=rr;rr=b!==0&&4>b?b:4,p(!0);var P=H0.transition;H0.transition={};try{p(!1),g()}finally{rr=b,H0.transition=P}}function Z0(){return ha().memoizedState}function UC(p,g,b){var P=yc(p);if(b={lane:P,action:b,hasEagerState:!1,eagerState:null,next:null},Hu(p))VC(g,b);else if(b=RC(p,g,b,P),b!==null){var M=qs();vc(b,p,P,M),FC(b,g,P)}}function ZN(p,g,b){var P=yc(p),M={lane:P,action:b,hasEagerState:!1,eagerState:null,next:null};if(Hu(p))VC(g,M);else{var z=p.alternate;if(p.lanes===0&&(z===null||z.lanes===0)&&(z=g.lastRenderedReducer,z!==null))try{var oe=g.lastRenderedState,Ie=z(oe,b);if(M.hasEagerState=!0,M.eagerState=Ie,ol(Ie,oe)){var Le=g.interleaved;Le===null?(M.next=M,B0(g)):(M.next=Le.next,Le.next=M),g.interleaved=M;return}}catch{}finally{}b=RC(p,g,M,P),b!==null&&(M=qs(),vc(b,p,P,M),FC(b,g,P))}}function Hu(p){var g=p.alternate;return p===Ii||g!==null&&g===Ii}function VC(p,g){Kg=nm=!0;var b=p.pending;b===null?g.next=g:(g.next=b.next,b.next=g),p.pending=g}function FC(p,g,b){if((b&4194240)!==0){var P=g.lanes;P&=p.pendingLanes,b|=P,g.lanes=b,Ma(p,b)}}var ly={readContext:mc,useCallback:lo,useContext:lo,useEffect:lo,useImperativeHandle:lo,useInsertionEffect:lo,useLayoutEffect:lo,useMemo:lo,useReducer:lo,useRef:lo,useState:lo,useDebugValue:lo,useDeferredValue:lo,useTransition:lo,useMutableSource:lo,useSyncExternalStore:lo,useId:lo,unstable_isNewReconciler:!1},e1={readContext:mc,useCallback:function(p,g){return Uo().memoizedState=[p,g===void 0?null:g],p},useContext:mc,useEffect:xC,useImperativeHandle:function(p,g,b){return b=b!=null?b.concat([p]):null,Xg(4194308,4,X0.bind(null,g,p),b)},useLayoutEffect:function(p,g){return Xg(4194308,4,p,g)},useInsertionEffect:function(p,g){return Xg(4,2,p,g)},useMemo:function(p,g){var b=Uo();return g=g===void 0?null:g,p=p(),b.memoizedState=[p,g],p},useReducer:function(p,g,b){var P=Uo();return g=b!==void 0?b(g):g,P.memoizedState=P.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},P.queue=p,p=p.dispatch=UC.bind(null,Ii,p),[P.memoizedState,p]},useRef:function(p){var g=Uo();return p={current:p},g.memoizedState=p},useState:ay,useDebugValue:Gu,useDeferredValue:function(p){return Uo().memoizedState=p},useTransition:function(){var p=ay(!1),g=p[0];return p=QN.bind(null,p[1]),Uo().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,b){var P=Ii,M=Uo();if(ii){if(b===void 0)throw Error(s(407));b=b()}else{if(b=g(),Ms===null)throw Error(s(349));(zl&30)!==0||kC(P,g,b)}M.memoizedState=b;var z={value:b,getSnapshot:g};return M.queue=z,xC(NC.bind(null,P,z,p),[p]),P.flags|=2048,Yg(9,Y0.bind(null,P,z,b,g),void 0,null),b},useId:function(){var p=Uo(),g=Ms.identifierPrefix;if(ii){var b=ju,P=Fu;b=(P&~(1<<32-Hs(P)-1)).toString(32)+b,g=":"+g+"R"+b,b=qg++,0<b&&(g+="H"+b.toString(32)),g+=":"}else b=JN++,g=":"+g+"r"+b.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},jC={readContext:mc,useCallback:cy,useContext:mc,useEffect:gc,useImperativeHandle:J0,useInsertionEffect:bp,useLayoutEffect:Kd,useMemo:MC,useReducer:Tp,useRef:LC,useState:function(){return Tp($d)},useDebugValue:Gu,useDeferredValue:function(p){var g=ha();return Q0(g,os.memoizedState,p)},useTransition:function(){var p=Tp($d)[0],g=ha().memoizedState;return[p,g]},useMutableSource:OC,useSyncExternalStore:q0,useId:Z0,unstable_isNewReconciler:!1},t1={readContext:mc,useCallback:cy,useContext:mc,useEffect:gc,useImperativeHandle:J0,useInsertionEffect:bp,useLayoutEffect:Kd,useMemo:MC,useReducer:im,useRef:LC,useState:function(){return im($d)},useDebugValue:Gu,useDeferredValue:function(p){var g=ha();return os===null?g.memoizedState=p:Q0(g,os.memoizedState,p)},useTransition:function(){var p=im($d)[0],g=ha().memoizedState;return[p,g]},useMutableSource:OC,useSyncExternalStore:q0,useId:Z0,unstable_isNewReconciler:!1};function Ba(p,g){if(p&&p.defaultProps){g=Be({},g),p=p.defaultProps;for(var b in p)g[b]===void 0&&(g[b]=p[b]);return g}return g}function uy(p,g,b,P){g=p.memoizedState,b=b(P,g),b=b==null?g:Be({},g,b),p.memoizedState=b,p.lanes===0&&(p.updateQueue.baseState=b)}var dy={isMounted:function(p){return(p=p._reactInternals)?Ls(p)===p:!1},enqueueSetState:function(p,g,b){p=p._reactInternals;var P=qs(),M=yc(p),z=Bl(P,M);z.payload=g,b!=null&&(z.callback=b),g=Gd(p,z,M),g!==null&&(vc(g,p,M,P),Gg(g,p,M))},enqueueReplaceState:function(p,g,b){p=p._reactInternals;var P=qs(),M=yc(p),z=Bl(P,M);z.tag=1,z.payload=g,b!=null&&(z.callback=b),g=Gd(p,z,M),g!==null&&(vc(g,p,M,P),Gg(g,p,M))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var b=qs(),P=yc(p),M=Bl(b,P);M.tag=2,g!=null&&(M.callback=g),g=Gd(p,M,P),g!==null&&(vc(g,p,P,b),Gg(g,p,P))}};function eT(p,g,b,P,M,z,oe){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(P,z,oe):g.prototype&&g.prototype.isPureReactComponent?!Pg(b,P)||!Pg(M,z):!0}function BC(p,g,b){var P=!1,M=jd,z=g.contextType;return typeof z=="object"&&z!==null?z=mc(z):(M=la(g)?gp:co.current,P=g.contextTypes,z=(P=P!=null)?_p(p,M):jd),g=new g(b,z),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=dy,p.stateNode=g,g._reactInternals=p,P&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=M,p.__reactInternalMemoizedMaskedChildContext=z),g}function WC(p,g,b,P){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(b,P),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(b,P),g.state!==p&&dy.enqueueReplaceState(g,g.state,null)}function tT(p,g,b,P){var M=p.stateNode;M.props=b,M.state=p.memoizedState,M.refs={},zg(p);var z=g.contextType;typeof z=="object"&&z!==null?M.context=mc(z):(z=la(g)?gp:co.current,M.context=_p(p,z)),M.state=p.memoizedState,z=g.getDerivedStateFromProps,typeof z=="function"&&(uy(p,g,z,b),M.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(g=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),g!==M.state&&dy.enqueueReplaceState(M,M.state,null),iy(p,b,M,P),M.state=p.memoizedState),typeof M.componentDidMount=="function"&&(p.flags|=4194308)}function om(p,g){try{var b="",P=g;do b+=ze(P),P=P.return;while(P);var M=b}catch(z){M=`
Error generating stack: `+z.message+`
`+z.stack}return{value:p,source:g,stack:M,digest:null}}function nT(p,g,b){return{value:p,source:null,stack:b??null,digest:g??null}}function rT(p,g){try{console.error(g.value)}catch(b){setTimeout(function(){throw b})}}var n1=typeof WeakMap=="function"?WeakMap:Map;function iT(p,g,b){b=Bl(-1,b),b.tag=3,b.payload={element:null};var P=g.value;return b.callback=function(){Py||(Py=!0,mT=P),rT(p,g)},b}function $u(p,g,b){b=Bl(-1,b),b.tag=3;var P=p.type.getDerivedStateFromError;if(typeof P=="function"){var M=g.value;b.payload=function(){return P(M)},b.callback=function(){rT(p,g)}}var z=p.stateNode;return z!==null&&typeof z.componentDidCatch=="function"&&(b.callback=function(){rT(p,g),typeof P!="function"&&(qd===null?qd=new Set([this]):qd.add(this));var oe=g.stack;this.componentDidCatch(g.value,{componentStack:oe!==null?oe:""})}),b}function zC(p,g,b){var P=p.pingCache;if(P===null){P=p.pingCache=new n1;var M=new Set;P.set(g,M)}else M=P.get(g),M===void 0&&(M=new Set,P.set(g,M));M.has(b)||(M.add(b),p=pI.bind(null,p,g,b),g.then(p,p))}function GC(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function HC(p,g,b,P,M){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(g=Bl(-1,1),g.tag=2,Gd(b,g,1))),b.lanes|=1),p):(p.flags|=65536,p.lanes=M,p)}var r1=de.ReactCurrentOwner,pa=!1;function Vo(p,g,b,P){g.child=p===null?wC(g,null,b,P):Qf(g,p.child,b,P)}function hy(p,g,b,P,M){b=b.render;var z=g.ref;return Wu(g,M),P=rm(p,g,b,P,z,M),b=K0(),p!==null&&!pa?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~M,Gl(p,g,M)):(ii&&b&&ZE(g),g.flags|=1,Vo(p,g,P,M),g.child)}function $C(p,g,b,P,M){if(p===null){var z=b.type;return typeof z=="function"&&!Xd(z)&&z.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(g.tag=15,g.type=z,KC(p,g,z,P,M)):(p=By(b.type,null,P,g,g.mode,M),p.ref=g.ref,p.return=g,g.child=p)}if(z=p.child,(p.lanes&M)===0){var oe=z.memoizedProps;if(b=b.compare,b=b!==null?b:Pg,b(oe,P)&&p.ref===g.ref)return Gl(p,g,M)}return g.flags|=1,p=Yu(z,P),p.ref=g.ref,p.return=g,g.child=p}function KC(p,g,b,P,M){if(p!==null){var z=p.memoizedProps;if(Pg(z,P)&&p.ref===g.ref)if(pa=!1,g.pendingProps=P=z,(p.lanes&M)!==0)(p.flags&131072)!==0&&(pa=!0);else return g.lanes=p.lanes,Gl(p,g,M)}return sT(p,g,b,P,M)}function qC(p,g,b){var P=g.pendingProps,M=P.children,z=p!==null?p.memoizedState:null;if(P.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},pi(al,Wa),Wa|=b;else{if((b&1073741824)===0)return p=z!==null?z.baseLanes|b:b,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,pi(al,Wa),Wa|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},P=z!==null?z.baseLanes:b,pi(al,Wa),Wa|=P}else z!==null?(P=z.baseLanes|b,g.memoizedState=null):P=b,pi(al,Wa),Wa|=P;return Vo(p,g,M,b),g.child}function YC(p,g){var b=g.ref;(p===null&&b!==null||p!==null&&p.ref!==b)&&(g.flags|=512,g.flags|=2097152)}function sT(p,g,b,P,M){var z=la(b)?gp:co.current;return z=_p(g,z),Wu(g,M),b=rm(p,g,b,P,z,M),P=K0(),p!==null&&!pa?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~M,Gl(p,g,M)):(ii&&P&&ZE(g),g.flags|=1,Vo(p,g,b,M),g.child)}function XC(p,g,b,P,M){if(la(b)){var z=!0;YE(g)}else z=!1;if(Wu(g,M),g.stateNode===null)Ey(p,g),BC(g,b,P),tT(g,b,P,M),P=!0;else if(p===null){var oe=g.stateNode,Ie=g.memoizedProps;oe.props=Ie;var Le=oe.context,nt=b.contextType;typeof nt=="object"&&nt!==null?nt=mc(nt):(nt=la(b)?gp:co.current,nt=_p(g,nt));var It=b.getDerivedStateFromProps,At=typeof It=="function"||typeof oe.getSnapshotBeforeUpdate=="function";At||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(Ie!==P||Le!==nt)&&WC(g,oe,P,nt),zd=!1;var wt=g.memoizedState;oe.state=wt,iy(g,P,oe,M),Le=g.memoizedState,Ie!==P||wt!==Le||ca.current||zd?(typeof It=="function"&&(uy(g,b,It,P),Le=g.memoizedState),(Ie=zd||eT(g,b,Ie,P,wt,Le,nt))?(At||typeof oe.UNSAFE_componentWillMount!="function"&&typeof oe.componentWillMount!="function"||(typeof oe.componentWillMount=="function"&&oe.componentWillMount(),typeof oe.UNSAFE_componentWillMount=="function"&&oe.UNSAFE_componentWillMount()),typeof oe.componentDidMount=="function"&&(g.flags|=4194308)):(typeof oe.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=P,g.memoizedState=Le),oe.props=P,oe.state=Le,oe.context=nt,P=Ie):(typeof oe.componentDidMount=="function"&&(g.flags|=4194308),P=!1)}else{oe=g.stateNode,CC(p,g),Ie=g.memoizedProps,nt=g.type===g.elementType?Ie:Ba(g.type,Ie),oe.props=nt,At=g.pendingProps,wt=oe.context,Le=b.contextType,typeof Le=="object"&&Le!==null?Le=mc(Le):(Le=la(b)?gp:co.current,Le=_p(g,Le));var Ht=b.getDerivedStateFromProps;(It=typeof Ht=="function"||typeof oe.getSnapshotBeforeUpdate=="function")||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(Ie!==At||wt!==Le)&&WC(g,oe,P,Le),zd=!1,wt=g.memoizedState,oe.state=wt,iy(g,P,oe,M);var Zt=g.memoizedState;Ie!==At||wt!==Zt||ca.current||zd?(typeof Ht=="function"&&(uy(g,b,Ht,P),Zt=g.memoizedState),(nt=zd||eT(g,b,nt,P,wt,Zt,Le)||!1)?(It||typeof oe.UNSAFE_componentWillUpdate!="function"&&typeof oe.componentWillUpdate!="function"||(typeof oe.componentWillUpdate=="function"&&oe.componentWillUpdate(P,Zt,Le),typeof oe.UNSAFE_componentWillUpdate=="function"&&oe.UNSAFE_componentWillUpdate(P,Zt,Le)),typeof oe.componentDidUpdate=="function"&&(g.flags|=4),typeof oe.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof oe.componentDidUpdate!="function"||Ie===p.memoizedProps&&wt===p.memoizedState||(g.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&wt===p.memoizedState||(g.flags|=1024),g.memoizedProps=P,g.memoizedState=Zt),oe.props=P,oe.state=Zt,oe.context=Le,P=nt):(typeof oe.componentDidUpdate!="function"||Ie===p.memoizedProps&&wt===p.memoizedState||(g.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&wt===p.memoizedState||(g.flags|=1024),P=!1)}return py(p,g,b,P,z,M)}function py(p,g,b,P,M,z){YC(p,g);var oe=(g.flags&128)!==0;if(!P&&!oe)return M&&EC(g,b,!1),Gl(p,g,z);P=g.stateNode,r1.current=g;var Ie=oe&&typeof b.getDerivedStateFromError!="function"?null:P.render();return g.flags|=1,p!==null&&oe?(g.child=Qf(g,p.child,null,z),g.child=Qf(g,null,Ie,z)):Vo(p,g,Ie,z),g.memoizedState=P.state,M&&EC(g,b,!0),g.child}function oT(p){var g=p.stateNode;g.pendingContext?_C(p,g.pendingContext,g.pendingContext!==g.context):g.context&&_C(p,g.context,!1),W0(p,g.containerInfo)}function JC(p,g,b,P,M){return Jf(),M0(M),g.flags|=256,Vo(p,g,b,P),g.child}var aT={dehydrated:null,treeContext:null,retryLane:0};function am(p){return{baseLanes:p,cachePool:null,transitions:null}}function fy(p,g,b){var P=g.pendingProps,M=Ti.current,z=!1,oe=(g.flags&128)!==0,Ie;if((Ie=oe)||(Ie=p!==null&&p.memoizedState===null?!1:(M&2)!==0),Ie?(z=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(M|=1),pi(Ti,M&1),p===null)return x0(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(oe=P.children,p=P.fallback,z?(P=g.mode,z=g.child,oe={mode:"hidden",children:oe},(P&1)===0&&z!==null?(z.childLanes=0,z.pendingProps=oe):z=Jd(oe,P,0,null),p=Op(p,P,b,null),z.return=g,p.return=g,z.sibling=p,g.child=z,g.child.memoizedState=am(b),g.memoizedState=aT,p):my(g,oe));if(M=p.memoizedState,M!==null&&(Ie=M.dehydrated,Ie!==null))return QC(p,g,oe,P,Ie,M,b);if(z){z=P.fallback,oe=g.mode,M=p.child,Ie=M.sibling;var Le={mode:"hidden",children:P.children};return(oe&1)===0&&g.child!==M?(P=g.child,P.childLanes=0,P.pendingProps=Le,g.deletions=null):(P=Yu(M,Le),P.subtreeFlags=M.subtreeFlags&14680064),Ie!==null?z=Yu(Ie,z):(z=Op(z,oe,b,null),z.flags|=2),z.return=g,P.return=g,P.sibling=z,g.child=P,P=z,z=g.child,oe=p.child.memoizedState,oe=oe===null?am(b):{baseLanes:oe.baseLanes|b,cachePool:null,transitions:oe.transitions},z.memoizedState=oe,z.childLanes=p.childLanes&~b,g.memoizedState=aT,P}return z=p.child,p=z.sibling,P=Yu(z,{mode:"visible",children:P.children}),(g.mode&1)===0&&(P.lanes=b),P.return=g,P.sibling=null,p!==null&&(b=g.deletions,b===null?(g.deletions=[p],g.flags|=16):b.push(p)),g.child=P,g.memoizedState=null,P}function my(p,g){return g=Jd({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function wp(p,g,b,P){return P!==null&&M0(P),Qf(g,p.child,null,b),p=my(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function QC(p,g,b,P,M,z,oe){if(b)return g.flags&256?(g.flags&=-257,P=nT(Error(s(422))),wp(p,g,oe,P)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(z=P.fallback,M=g.mode,P=Jd({mode:"visible",children:P.children},M,0,null),z=Op(z,M,oe,null),z.flags|=2,P.return=g,z.return=g,P.sibling=z,g.child=P,(g.mode&1)!==0&&Qf(g,p.child,null,oe),g.child.memoizedState=am(oe),g.memoizedState=aT,z);if((g.mode&1)===0)return wp(p,g,oe,null);if(M.data==="$!"){if(P=M.nextSibling&&M.nextSibling.dataset,P)var Ie=P.dgst;return P=Ie,z=Error(s(419)),P=nT(z,P,void 0),wp(p,g,oe,P)}if(Ie=(oe&p.childLanes)!==0,pa||Ie){if(P=Ms,P!==null){switch(oe&-oe){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(P.suspendedLanes|oe))!==0?0:M,M!==0&&M!==z.retryLane&&(z.retryLane=M,zu(p,M),vc(P,p,M,-1))}return ET(),P=nT(Error(s(421))),wp(p,g,oe,P)}return M.data==="$?"?(g.flags|=128,g.child=p.child,g=Vy.bind(null,p),M._reactRetry=g,null):(p=z.treeContext,da=Vd(M.nextSibling),ua=g,ii=!0,Mo=null,p!==null&&(fc[ja++]=Fu,fc[ja++]=ju,fc[ja++]=Ep,Fu=p.id,ju=p.overflow,Ep=g),g=my(g,P.children),g.flags|=4096,g)}function ZC(p,g,b){p.lanes|=g;var P=p.alternate;P!==null&&(P.lanes|=g),j0(p.return,g,b)}function gy(p,g,b,P,M){var z=p.memoizedState;z===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:P,tail:b,tailMode:M}:(z.isBackwards=g,z.rendering=null,z.renderingStartTime=0,z.last=P,z.tail=b,z.tailMode=M)}function _y(p,g,b){var P=g.pendingProps,M=P.revealOrder,z=P.tail;if(Vo(p,g,P.children,b),P=Ti.current,(P&2)!==0)P=P&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&ZC(p,b,g);else if(p.tag===19)ZC(p,b,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}P&=1}if(pi(Ti,P),(g.mode&1)===0)g.memoizedState=null;else switch(M){case"forwards":for(b=g.child,M=null;b!==null;)p=b.alternate,p!==null&&Hd(p)===null&&(M=b),b=b.sibling;b=M,b===null?(M=g.child,g.child=null):(M=b.sibling,b.sibling=null),gy(g,!1,M,b,z);break;case"backwards":for(b=null,M=g.child,g.child=null;M!==null;){if(p=M.alternate,p!==null&&Hd(p)===null){g.child=M;break}p=M.sibling,M.sibling=b,b=M,M=p}gy(g,!0,b,null,z);break;case"together":gy(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Ey(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function Gl(p,g,b){if(p!==null&&(g.dependencies=p.dependencies),Rp|=g.lanes,(b&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(s(153));if(g.child!==null){for(p=g.child,b=Yu(p,p.pendingProps),g.child=b,b.return=g;p.sibling!==null;)p=p.sibling,b=b.sibling=Yu(p,p.pendingProps),b.return=g;b.sibling=null}return g.child}function eI(p,g,b){switch(g.tag){case 3:oT(g),Jf();break;case 5:PC(g);break;case 1:la(g.type)&&YE(g);break;case 4:W0(g,g.stateNode.containerInfo);break;case 10:var P=g.type._context,M=g.memoizedProps.value;pi(ny,P._currentValue),P._currentValue=M;break;case 13:if(P=g.memoizedState,P!==null)return P.dehydrated!==null?(pi(Ti,Ti.current&1),g.flags|=128,null):(b&g.child.childLanes)!==0?fy(p,g,b):(pi(Ti,Ti.current&1),p=Gl(p,g,b),p!==null?p.sibling:null);pi(Ti,Ti.current&1);break;case 19:if(P=(b&g.childLanes)!==0,(p.flags&128)!==0){if(P)return _y(p,g,b);g.flags|=128}if(M=g.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),pi(Ti,Ti.current),P)break;return null;case 22:case 23:return g.lanes=0,qC(p,g,b)}return Gl(p,g,b)}var tI,yy,cT,nI;tI=function(p,g){for(var b=g.child;b!==null;){if(b.tag===5||b.tag===6)p.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===g)break;for(;b.sibling===null;){if(b.return===null||b.return===g)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},yy=function(){},cT=function(p,g,b,P){var M=p.memoizedProps;if(M!==P){p=g.stateNode,vp(Wl.current);var z=null;switch(b){case"input":M=xn(p,M),P=xn(p,P),z=[];break;case"select":M=Be({},M,{value:void 0}),P=Be({},P,{value:void 0}),z=[];break;case"textarea":M=Et(p,M),P=Et(p,P),z=[];break;default:typeof M.onClick!="function"&&typeof P.onClick=="function"&&(p.onclick=HE)}Na(b,P);var oe;b=null;for(nt in M)if(!P.hasOwnProperty(nt)&&M.hasOwnProperty(nt)&&M[nt]!=null)if(nt==="style"){var Ie=M[nt];for(oe in Ie)Ie.hasOwnProperty(oe)&&(b||(b={}),b[oe]="")}else nt!=="dangerouslySetInnerHTML"&&nt!=="children"&&nt!=="suppressContentEditableWarning"&&nt!=="suppressHydrationWarning"&&nt!=="autoFocus"&&(l.hasOwnProperty(nt)?z||(z=[]):(z=z||[]).push(nt,null));for(nt in P){var Le=P[nt];if(Ie=M!=null?M[nt]:void 0,P.hasOwnProperty(nt)&&Le!==Ie&&(Le!=null||Ie!=null))if(nt==="style")if(Ie){for(oe in Ie)!Ie.hasOwnProperty(oe)||Le&&Le.hasOwnProperty(oe)||(b||(b={}),b[oe]="");for(oe in Le)Le.hasOwnProperty(oe)&&Ie[oe]!==Le[oe]&&(b||(b={}),b[oe]=Le[oe])}else b||(z||(z=[]),z.push(nt,b)),b=Le;else nt==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Ie=Ie?Ie.__html:void 0,Le!=null&&Ie!==Le&&(z=z||[]).push(nt,Le)):nt==="children"?typeof Le!="string"&&typeof Le!="number"||(z=z||[]).push(nt,""+Le):nt!=="suppressContentEditableWarning"&&nt!=="suppressHydrationWarning"&&(l.hasOwnProperty(nt)?(Le!=null&&nt==="onScroll"&&Ei("scroll",p),z||Ie===Le||(z=[])):(z=z||[]).push(nt,Le))}b&&(z=z||[]).push("style",b);var nt=z;(g.updateQueue=nt)&&(g.flags|=4)}},nI=function(p,g,b,P){b!==P&&(g.flags|=4)};function Jg(p,g){if(!ii)switch(p.tailMode){case"hidden":g=p.tail;for(var b=null;g!==null;)g.alternate!==null&&(b=g),g=g.sibling;b===null?p.tail=null:b.sibling=null;break;case"collapsed":b=p.tail;for(var P=null;b!==null;)b.alternate!==null&&(P=b),b=b.sibling;P===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:P.sibling=null}}function uo(p){var g=p.alternate!==null&&p.alternate.child===p.child,b=0,P=0;if(g)for(var M=p.child;M!==null;)b|=M.lanes|M.childLanes,P|=M.subtreeFlags&14680064,P|=M.flags&14680064,M.return=p,M=M.sibling;else for(M=p.child;M!==null;)b|=M.lanes|M.childLanes,P|=M.subtreeFlags,P|=M.flags,M.return=p,M=M.sibling;return p.subtreeFlags|=P,p.childLanes=b,g}function vy(p,g,b){var P=g.pendingProps;switch(Fg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return uo(g),null;case 1:return la(g.type)&&KE(),uo(g),null;case 3:return P=g.stateNode,Sp(),yi(ca),yi(co),G0(),P.pendingContext&&(P.context=P.pendingContext,P.pendingContext=null),(p===null||p.child===null)&&(jg(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Mo!==null&&(Ly(Mo),Mo=null))),yy(p,g),uo(g),null;case 5:tm(g);var M=vp(em.current);if(b=g.type,p!==null&&g.stateNode!=null)cT(p,g,b,P,M),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!P){if(g.stateNode===null)throw Error(s(166));return uo(g),null}if(p=vp(Wl.current),jg(g)){P=g.stateNode,b=g.type;var z=g.memoizedProps;switch(P[jl]=g,P[Fd]=z,p=(g.mode&1)!==0,b){case"dialog":Ei("cancel",P),Ei("close",P);break;case"iframe":case"object":case"embed":Ei("load",P);break;case"video":case"audio":for(M=0;M<Dg.length;M++)Ei(Dg[M],P);break;case"source":Ei("error",P);break;case"img":case"image":case"link":Ei("error",P),Ei("load",P);break;case"details":Ei("toggle",P);break;case"input":Xt(P,z),Ei("invalid",P);break;case"select":P._wrapperState={wasMultiple:!!z.multiple},Ei("invalid",P);break;case"textarea":yt(P,z),Ei("invalid",P)}Na(b,z),M=null;for(var oe in z)if(z.hasOwnProperty(oe)){var Ie=z[oe];oe==="children"?typeof Ie=="string"?P.textContent!==Ie&&(z.suppressHydrationWarning!==!0&&GE(P.textContent,Ie,p),M=["children",Ie]):typeof Ie=="number"&&P.textContent!==""+Ie&&(z.suppressHydrationWarning!==!0&&GE(P.textContent,Ie,p),M=["children",""+Ie]):l.hasOwnProperty(oe)&&Ie!=null&&oe==="onScroll"&&Ei("scroll",P)}switch(b){case"input":_n(P),Te(P,z,!0);break;case"textarea":_n(P),dn(P);break;case"select":case"option":break;default:typeof z.onClick=="function"&&(P.onclick=HE)}P=M,g.updateQueue=P,P!==null&&(g.flags|=4)}else{oe=M.nodeType===9?M:M.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=hn(b)),p==="http://www.w3.org/1999/xhtml"?b==="script"?(p=oe.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof P.is=="string"?p=oe.createElement(b,{is:P.is}):(p=oe.createElement(b),b==="select"&&(oe=p,P.multiple?oe.multiple=!0:P.size&&(oe.size=P.size))):p=oe.createElementNS(p,b),p[jl]=g,p[Fd]=P,tI(p,g,!1,!1),g.stateNode=p;e:{switch(oe=Jc(b,P),b){case"dialog":Ei("cancel",p),Ei("close",p),M=P;break;case"iframe":case"object":case"embed":Ei("load",p),M=P;break;case"video":case"audio":for(M=0;M<Dg.length;M++)Ei(Dg[M],p);M=P;break;case"source":Ei("error",p),M=P;break;case"img":case"image":case"link":Ei("error",p),Ei("load",p),M=P;break;case"details":Ei("toggle",p),M=P;break;case"input":Xt(p,P),M=xn(p,P),Ei("invalid",p);break;case"option":M=P;break;case"select":p._wrapperState={wasMultiple:!!P.multiple},M=Be({},P,{value:void 0}),Ei("invalid",p);break;case"textarea":yt(p,P),M=Et(p,P),Ei("invalid",p);break;default:M=P}Na(b,M),Ie=M;for(z in Ie)if(Ie.hasOwnProperty(z)){var Le=Ie[z];z==="style"?Gs(p,Le):z==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Le!=null&&ec(p,Le)):z==="children"?typeof Le=="string"?(b!=="textarea"||Le!=="")&&jt(p,Le):typeof Le=="number"&&jt(p,""+Le):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(l.hasOwnProperty(z)?Le!=null&&z==="onScroll"&&Ei("scroll",p):Le!=null&&Q(p,z,Le,oe))}switch(b){case"input":_n(p),Te(p,P,!1);break;case"textarea":_n(p),dn(p);break;case"option":P.value!=null&&p.setAttribute("value",""+ut(P.value));break;case"select":p.multiple=!!P.multiple,z=P.value,z!=null?mt(p,!!P.multiple,z,!1):P.defaultValue!=null&&mt(p,!!P.multiple,P.defaultValue,!0);break;default:typeof M.onClick=="function"&&(p.onclick=HE)}switch(b){case"button":case"input":case"select":case"textarea":P=!!P.autoFocus;break e;case"img":P=!0;break e;default:P=!1}}P&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return uo(g),null;case 6:if(p&&g.stateNode!=null)nI(p,g,p.memoizedProps,P);else{if(typeof P!="string"&&g.stateNode===null)throw Error(s(166));if(b=vp(em.current),vp(Wl.current),jg(g)){if(P=g.stateNode,b=g.memoizedProps,P[jl]=g,(z=P.nodeValue!==b)&&(p=ua,p!==null))switch(p.tag){case 3:GE(P.nodeValue,b,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&GE(P.nodeValue,b,(p.mode&1)!==0)}z&&(g.flags|=4)}else P=(b.nodeType===9?b:b.ownerDocument).createTextNode(P),P[jl]=g,g.stateNode=P}return uo(g),null;case 13:if(yi(Ti),P=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(ii&&da!==null&&(g.mode&1)!==0&&(g.flags&128)===0)bC(),Jf(),g.flags|=98560,z=!1;else if(z=jg(g),P!==null&&P.dehydrated!==null){if(p===null){if(!z)throw Error(s(318));if(z=g.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(s(317));z[jl]=g}else Jf(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;uo(g),z=!1}else Mo!==null&&(Ly(Mo),Mo=null),z=!0;if(!z)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=b,g):(P=P!==null,P!==(p!==null&&p.memoizedState!==null)&&P&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(Ti.current&1)!==0?ls===0&&(ls=3):ET())),g.updateQueue!==null&&(g.flags|=4),uo(g),null);case 4:return Sp(),yy(p,g),p===null&&hp(g.stateNode.containerInfo),uo(g),null;case 10:return F0(g.type._context),uo(g),null;case 17:return la(g.type)&&KE(),uo(g),null;case 19:if(yi(Ti),z=g.memoizedState,z===null)return uo(g),null;if(P=(g.flags&128)!==0,oe=z.rendering,oe===null)if(P)Jg(z,!1);else{if(ls!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(oe=Hd(p),oe!==null){for(g.flags|=128,Jg(z,!1),P=oe.updateQueue,P!==null&&(g.updateQueue=P,g.flags|=4),g.subtreeFlags=0,P=b,b=g.child;b!==null;)z=b,p=P,z.flags&=14680066,oe=z.alternate,oe===null?(z.childLanes=0,z.lanes=p,z.child=null,z.subtreeFlags=0,z.memoizedProps=null,z.memoizedState=null,z.updateQueue=null,z.dependencies=null,z.stateNode=null):(z.childLanes=oe.childLanes,z.lanes=oe.lanes,z.child=oe.child,z.subtreeFlags=0,z.deletions=null,z.memoizedProps=oe.memoizedProps,z.memoizedState=oe.memoizedState,z.updateQueue=oe.updateQueue,z.type=oe.type,p=oe.dependencies,z.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),b=b.sibling;return pi(Ti,Ti.current&1|2),g.child}p=p.sibling}z.tail!==null&&Vr()>um&&(g.flags|=128,P=!0,Jg(z,!1),g.lanes=4194304)}else{if(!P)if(p=Hd(oe),p!==null){if(g.flags|=128,P=!0,b=p.updateQueue,b!==null&&(g.updateQueue=b,g.flags|=4),Jg(z,!0),z.tail===null&&z.tailMode==="hidden"&&!oe.alternate&&!ii)return uo(g),null}else 2*Vr()-z.renderingStartTime>um&&b!==1073741824&&(g.flags|=128,P=!0,Jg(z,!1),g.lanes=4194304);z.isBackwards?(oe.sibling=g.child,g.child=oe):(b=z.last,b!==null?b.sibling=oe:g.child=oe,z.last=oe)}return z.tail!==null?(g=z.tail,z.rendering=g,z.tail=g.sibling,z.renderingStartTime=Vr(),g.sibling=null,b=Ti.current,pi(Ti,P?b&1|2:b&1),g):(uo(g),null);case 22:case 23:return s_(),P=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==P&&(g.flags|=8192),P&&(g.mode&1)!==0?(Wa&1073741824)!==0&&(uo(g),g.subtreeFlags&6&&(g.flags|=8192)):uo(g),null;case 24:return null;case 25:return null}throw Error(s(156,g.tag))}function i1(p,g){switch(Fg(g),g.tag){case 1:return la(g.type)&&KE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Sp(),yi(ca),yi(co),G0(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return tm(g),null;case 13:if(yi(Ti),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(s(340));Jf()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return yi(Ti),null;case 4:return Sp(),null;case 10:return F0(g.type._context),null;case 22:case 23:return s_(),null;case 24:return null;default:return null}}var Sy=!1,ho=!1,rI=typeof WeakSet=="function"?WeakSet:Set,Jt=null;function cm(p,g){var b=p.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(P){Ai(p,g,P)}else b.current=null}function Qg(p,g,b){try{b()}catch(P){Ai(p,g,P)}}var iI=!1;function lT(p,g){if($E=Se,p=sC(),Og(p)){if("selectionStart"in p)var b={start:p.selectionStart,end:p.selectionEnd};else e:{b=(b=p.ownerDocument)&&b.defaultView||window;var P=b.getSelection&&b.getSelection();if(P&&P.rangeCount!==0){b=P.anchorNode;var M=P.anchorOffset,z=P.focusNode;P=P.focusOffset;try{b.nodeType,z.nodeType}catch{b=null;break e}var oe=0,Ie=-1,Le=-1,nt=0,It=0,At=p,wt=null;t:for(;;){for(var Ht;At!==b||M!==0&&At.nodeType!==3||(Ie=oe+M),At!==z||P!==0&&At.nodeType!==3||(Le=oe+P),At.nodeType===3&&(oe+=At.nodeValue.length),(Ht=At.firstChild)!==null;)wt=At,At=Ht;for(;;){if(At===p)break t;if(wt===b&&++nt===M&&(Ie=oe),wt===z&&++It===P&&(Le=oe),(Ht=At.nextSibling)!==null)break;At=wt,wt=At.parentNode}At=Ht}b=Ie===-1||Le===-1?null:{start:Ie,end:Le}}else b=null}b=b||{start:0,end:0}}else b=null;for(xg={focusedElem:p,selectionRange:b},Se=!1,Jt=g;Jt!==null;)if(g=Jt,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,Jt=p;else for(;Jt!==null;){g=Jt;try{var Zt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Zt!==null){var en=Zt.memoizedProps,Bi=Zt.memoizedState,Ye=g.stateNode,Ve=Ye.getSnapshotBeforeUpdate(g.elementType===g.type?en:Ba(g.type,en),Bi);Ye.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var Je=g.stateNode.containerInfo;Je.nodeType===1?Je.textContent="":Je.nodeType===9&&Je.documentElement&&Je.removeChild(Je.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Nt){Ai(g,g.return,Nt)}if(p=g.sibling,p!==null){p.return=g.return,Jt=p;break}Jt=g.return}return Zt=iI,iI=!1,Zt}function Zg(p,g,b){var P=g.updateQueue;if(P=P!==null?P.lastEffect:null,P!==null){var M=P=P.next;do{if((M.tag&p)===p){var z=M.destroy;M.destroy=void 0,z!==void 0&&Qg(g,b,z)}M=M.next}while(M!==P)}}function e_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var b=g=g.next;do{if((b.tag&p)===p){var P=b.create;b.destroy=P()}b=b.next}while(b!==g)}}function uT(p){var g=p.ref;if(g!==null){var b=p.stateNode;switch(p.tag){case 5:p=b;break;default:p=b}typeof g=="function"?g(p):g.current=p}}function sI(p){var g=p.alternate;g!==null&&(p.alternate=null,sI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[jl],delete g[Fd],delete g[Ug],delete g[KN],delete g[qN])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function dT(p){return p.tag===5||p.tag===3||p.tag===4}function oI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||dT(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function hT(p,g,b){var P=p.tag;if(P===5||P===6)p=p.stateNode,g?b.nodeType===8?b.parentNode.insertBefore(p,g):b.insertBefore(p,g):(b.nodeType===8?(g=b.parentNode,g.insertBefore(p,b)):(g=b,g.appendChild(p)),b=b._reactRootContainer,b!=null||g.onclick!==null||(g.onclick=HE));else if(P!==4&&(p=p.child,p!==null))for(hT(p,g,b),p=p.sibling;p!==null;)hT(p,g,b),p=p.sibling}function Ty(p,g,b){var P=p.tag;if(P===5||P===6)p=p.stateNode,g?b.insertBefore(p,g):b.appendChild(p);else if(P!==4&&(p=p.child,p!==null))for(Ty(p,g,b),p=p.sibling;p!==null;)Ty(p,g,b),p=p.sibling}var $s=null,_c=!1;function Hl(p,g,b){for(b=b.child;b!==null;)aI(p,g,b),b=b.sibling}function aI(p,g,b){if(ao&&typeof ao.onCommitFiberUnmount=="function")try{ao.onCommitFiberUnmount(Nl,b)}catch{}switch(b.tag){case 5:ho||cm(b,g);case 6:var P=$s,M=_c;$s=null,Hl(p,g,b),$s=P,_c=M,$s!==null&&(_c?(p=$s,b=b.stateNode,p.nodeType===8?p.parentNode.removeChild(b):p.removeChild(b)):$s.removeChild(b.stateNode));break;case 18:$s!==null&&(_c?(p=$s,b=b.stateNode,p.nodeType===8?N0(p.parentNode,b):p.nodeType===1&&N0(p,b),oa(p)):N0($s,b.stateNode));break;case 4:P=$s,M=_c,$s=b.stateNode.containerInfo,_c=!0,Hl(p,g,b),$s=P,_c=M;break;case 0:case 11:case 14:case 15:if(!ho&&(P=b.updateQueue,P!==null&&(P=P.lastEffect,P!==null))){M=P=P.next;do{var z=M,oe=z.destroy;z=z.tag,oe!==void 0&&((z&2)!==0||(z&4)!==0)&&Qg(b,g,oe),M=M.next}while(M!==P)}Hl(p,g,b);break;case 1:if(!ho&&(cm(b,g),P=b.stateNode,typeof P.componentWillUnmount=="function"))try{P.props=b.memoizedProps,P.state=b.memoizedState,P.componentWillUnmount()}catch(Ie){Ai(b,g,Ie)}Hl(p,g,b);break;case 21:Hl(p,g,b);break;case 22:b.mode&1?(ho=(P=ho)||b.memoizedState!==null,Hl(p,g,b),ho=P):Hl(p,g,b);break;default:Hl(p,g,b)}}function cI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var b=p.stateNode;b===null&&(b=p.stateNode=new rI),g.forEach(function(P){var M=fI.bind(null,p,P);b.has(P)||(b.add(P),P.then(M,M))})}}function Fo(p,g){var b=g.deletions;if(b!==null)for(var P=0;P<b.length;P++){var M=b[P];try{var z=p,oe=g,Ie=oe;e:for(;Ie!==null;){switch(Ie.tag){case 5:$s=Ie.stateNode,_c=!1;break e;case 3:$s=Ie.stateNode.containerInfo,_c=!0;break e;case 4:$s=Ie.stateNode.containerInfo,_c=!0;break e}Ie=Ie.return}if($s===null)throw Error(s(160));aI(z,oe,M),$s=null,_c=!1;var Le=M.alternate;Le!==null&&(Le.return=null),M.return=null}catch(nt){Ai(M,g,nt)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)pT(g,p),g=g.sibling}function pT(p,g){var b=p.alternate,P=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Fo(g,p),fa(p),P&4){try{Zg(3,p,p.return),e_(3,p)}catch(en){Ai(p,p.return,en)}try{Zg(5,p,p.return)}catch(en){Ai(p,p.return,en)}}break;case 1:Fo(g,p),fa(p),P&512&&b!==null&&cm(b,b.return);break;case 5:if(Fo(g,p),fa(p),P&512&&b!==null&&cm(b,b.return),p.flags&32){var M=p.stateNode;try{jt(M,"")}catch(en){Ai(p,p.return,en)}}if(P&4&&(M=p.stateNode,M!=null)){var z=p.memoizedProps,oe=b!==null?b.memoizedProps:z,Ie=p.type,Le=p.updateQueue;if(p.updateQueue=null,Le!==null)try{Ie==="input"&&z.type==="radio"&&z.name!=null&&Pt(M,z),Jc(Ie,oe);var nt=Jc(Ie,z);for(oe=0;oe<Le.length;oe+=2){var It=Le[oe],At=Le[oe+1];It==="style"?Gs(M,At):It==="dangerouslySetInnerHTML"?ec(M,At):It==="children"?jt(M,At):Q(M,It,At,nt)}switch(Ie){case"input":Dt(M,z);break;case"textarea":zt(M,z);break;case"select":var wt=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!z.multiple;var Ht=z.value;Ht!=null?mt(M,!!z.multiple,Ht,!1):wt!==!!z.multiple&&(z.defaultValue!=null?mt(M,!!z.multiple,z.defaultValue,!0):mt(M,!!z.multiple,z.multiple?[]:"",!1))}M[Fd]=z}catch(en){Ai(p,p.return,en)}}break;case 6:if(Fo(g,p),fa(p),P&4){if(p.stateNode===null)throw Error(s(162));M=p.stateNode,z=p.memoizedProps;try{M.nodeValue=z}catch(en){Ai(p,p.return,en)}}break;case 3:if(Fo(g,p),fa(p),P&4&&b!==null&&b.memoizedState.isDehydrated)try{oa(g.containerInfo)}catch(en){Ai(p,p.return,en)}break;case 4:Fo(g,p),fa(p);break;case 13:Fo(g,p),fa(p),M=p.child,M.flags&8192&&(z=M.memoizedState!==null,M.stateNode.isHidden=z,!z||M.alternate!==null&&M.alternate.memoizedState!==null||(Ay=Vr())),P&4&&cI(p);break;case 22:if(It=b!==null&&b.memoizedState!==null,p.mode&1?(ho=(nt=ho)||It,Fo(g,p),ho=nt):Fo(g,p),fa(p),P&8192){if(nt=p.memoizedState!==null,(p.stateNode.isHidden=nt)&&!It&&(p.mode&1)!==0)for(Jt=p,It=p.child;It!==null;){for(At=Jt=It;Jt!==null;){switch(wt=Jt,Ht=wt.child,wt.tag){case 0:case 11:case 14:case 15:Zg(4,wt,wt.return);break;case 1:cm(wt,wt.return);var Zt=wt.stateNode;if(typeof Zt.componentWillUnmount=="function"){P=wt,b=wt.return;try{g=P,Zt.props=g.memoizedProps,Zt.state=g.memoizedState,Zt.componentWillUnmount()}catch(en){Ai(P,b,en)}}break;case 5:cm(wt,wt.return);break;case 22:if(wt.memoizedState!==null){t_(At);continue}}Ht!==null?(Ht.return=wt,Jt=Ht):t_(At)}It=It.sibling}e:for(It=null,At=p;;){if(At.tag===5){if(It===null){It=At;try{M=At.stateNode,nt?(z=M.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none"):(Ie=At.stateNode,Le=At.memoizedProps.style,oe=Le!=null&&Le.hasOwnProperty("display")?Le.display:null,Ie.style.display=Ns("display",oe))}catch(en){Ai(p,p.return,en)}}}else if(At.tag===6){if(It===null)try{At.stateNode.nodeValue=nt?"":At.memoizedProps}catch(en){Ai(p,p.return,en)}}else if((At.tag!==22&&At.tag!==23||At.memoizedState===null||At===p)&&At.child!==null){At.child.return=At,At=At.child;continue}if(At===p)break e;for(;At.sibling===null;){if(At.return===null||At.return===p)break e;It===At&&(It=null),At=At.return}It===At&&(It=null),At.sibling.return=At.return,At=At.sibling}}break;case 19:Fo(g,p),fa(p),P&4&&cI(p);break;case 21:break;default:Fo(g,p),fa(p)}}function fa(p){var g=p.flags;if(g&2){try{e:{for(var b=p.return;b!==null;){if(dT(b)){var P=b;break e}b=b.return}throw Error(s(160))}switch(P.tag){case 5:var M=P.stateNode;P.flags&32&&(jt(M,""),P.flags&=-33);var z=oI(p);Ty(p,z,M);break;case 3:case 4:var oe=P.stateNode.containerInfo,Ie=oI(p);hT(p,Ie,oe);break;default:throw Error(s(161))}}catch(Le){Ai(p,p.return,Le)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function lm(p,g,b){Jt=p,fT(p)}function fT(p,g,b){for(var P=(p.mode&1)!==0;Jt!==null;){var M=Jt,z=M.child;if(M.tag===22&&P){var oe=M.memoizedState!==null||Sy;if(!oe){var Ie=M.alternate,Le=Ie!==null&&Ie.memoizedState!==null||ho;Ie=Sy;var nt=ho;if(Sy=oe,(ho=Le)&&!nt)for(Jt=M;Jt!==null;)oe=Jt,Le=oe.child,oe.tag===22&&oe.memoizedState!==null?lI(M):Le!==null?(Le.return=oe,Jt=Le):lI(M);for(;z!==null;)Jt=z,fT(z),z=z.sibling;Jt=M,Sy=Ie,ho=nt}by(p)}else(M.subtreeFlags&8772)!==0&&z!==null?(z.return=M,Jt=z):by(p)}}function by(p){for(;Jt!==null;){var g=Jt;if((g.flags&8772)!==0){var b=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:ho||e_(5,g);break;case 1:var P=g.stateNode;if(g.flags&4&&!ho)if(b===null)P.componentDidMount();else{var M=g.elementType===g.type?b.memoizedProps:Ba(g.type,b.memoizedProps);P.componentDidUpdate(M,b.memoizedState,P.__reactInternalSnapshotBeforeUpdate)}var z=g.updateQueue;z!==null&&AC(g,z,P);break;case 3:var oe=g.updateQueue;if(oe!==null){if(b=null,g.child!==null)switch(g.child.tag){case 5:b=g.child.stateNode;break;case 1:b=g.child.stateNode}AC(g,oe,b)}break;case 5:var Ie=g.stateNode;if(b===null&&g.flags&4){b=Ie;var Le=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Le.autoFocus&&b.focus();break;case"img":Le.src&&(b.src=Le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var nt=g.alternate;if(nt!==null){var It=nt.memoizedState;if(It!==null){var At=It.dehydrated;At!==null&&oa(At)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}ho||g.flags&512&&uT(g)}catch(wt){Ai(g,g.return,wt)}}if(g===p){Jt=null;break}if(b=g.sibling,b!==null){b.return=g.return,Jt=b;break}Jt=g.return}}function t_(p){for(;Jt!==null;){var g=Jt;if(g===p){Jt=null;break}var b=g.sibling;if(b!==null){b.return=g.return,Jt=b;break}Jt=g.return}}function lI(p){for(;Jt!==null;){var g=Jt;try{switch(g.tag){case 0:case 11:case 15:var b=g.return;try{e_(4,g)}catch(Le){Ai(g,b,Le)}break;case 1:var P=g.stateNode;if(typeof P.componentDidMount=="function"){var M=g.return;try{P.componentDidMount()}catch(Le){Ai(g,M,Le)}}var z=g.return;try{uT(g)}catch(Le){Ai(g,z,Le)}break;case 5:var oe=g.return;try{uT(g)}catch(Le){Ai(g,oe,Le)}}}catch(Le){Ai(g,g.return,Le)}if(g===p){Jt=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,Jt=Ie;break}Jt=g.return}}var s1=Math.ceil,wy=de.ReactCurrentDispatcher,Ry=de.ReactCurrentOwner,Ec=de.ReactCurrentBatchConfig,Sr=0,Ms=null,ji=null,cs=0,Wa=0,al=hc(0),ls=0,Ks=null,Rp=0,Cy=0,Iy=0,n_=null,jo=null,Ay=0,um=1/0,$l=null,Py=!1,mT=null,qd=null,dm=!1,Kl=null,Oy=0,Cp=0,gT=null,r_=-1,ky=0;function qs(){return(Sr&6)!==0?Vr():r_!==-1?r_:r_=Vr()}function yc(p){return(p.mode&1)===0?1:(Sr&2)!==0&&cs!==0?cs&-cs:XN.transition!==null?(ky===0&&(ky=ku()),ky):(p=rr,p!==0||(p=window.event,p=p===void 0?16:Fr(p.type)),p)}function vc(p,g,b,P){if(50<Cp)throw Cp=0,gT=null,Error(s(185));xl(p,b,P),((Sr&2)===0||p!==Ms)&&(p===Ms&&((Sr&2)===0&&(Cy|=b),ls===4&&Ku(p,cs)),po(p,P),b===1&&Sr===0&&(g.mode&1)===0&&(um=Vr()+500,XE&&Bd()))}function po(p,g){var b=p.callbackNode;xa(p,g);var P=Ll(p,p===Ms?cs:0);if(P===0)b!==null&&Pu(b),p.callbackNode=null,p.callbackPriority=0;else if(g=P&-P,p.callbackPriority!==g){if(b!=null&&Pu(b),g===1)p.tag===0?YN(Ip.bind(null,p)):yC(Ip.bind(null,p)),HN(function(){(Sr&6)===0&&Bd()}),b=null;else{switch(oc(P)){case 1:b=sc;break;case 4:b=el;break;case 16:b=ia;break;case 536870912:b=Nd;break;default:b=ia}b=o_(b,Ny.bind(null,p))}p.callbackPriority=g,p.callbackNode=b}}function Ny(p,g){if(r_=-1,ky=0,(Sr&6)!==0)throw Error(s(327));var b=p.callbackNode;if(hm()&&p.callbackNode!==b)return null;var P=Ll(p,p===Ms?cs:0);if(P===0)return null;if((P&30)!==0||(P&p.expiredLanes)!==0||g)g=ql(p,P);else{g=P;var M=Sr;Sr|=2;var z=uI();(Ms!==p||cs!==g)&&($l=null,um=Vr()+500,Yd(p,g));do try{o1();break}catch(Ie){_T(p,Ie)}while(!0);V0(),wy.current=z,Sr=M,ji!==null?g=0:(Ms=null,cs=0,g=ls)}if(g!==0){if(g===2&&(M=Ro(p),M!==0&&(P=M,g=Dy(p,M))),g===1)throw b=Ks,Yd(p,0),Ku(p,P),po(p,Vr()),b;if(g===6)Ku(p,P);else{if(M=p.current.alternate,(P&30)===0&&!xy(M)&&(g=ql(p,P),g===2&&(z=Ro(p),z!==0&&(P=z,g=Dy(p,z))),g===1))throw b=Ks,Yd(p,0),Ku(p,P),po(p,Vr()),b;switch(p.finishedWork=M,p.finishedLanes=P,g){case 0:case 1:throw Error(s(345));case 2:Ap(p,jo,$l);break;case 3:if(Ku(p,P),(P&130023424)===P&&(g=Ay+500-Vr(),10<g)){if(Ll(p,0)!==0)break;if(M=p.suspendedLanes,(M&P)!==P){qs(),p.pingedLanes|=p.suspendedLanes&M;break}p.timeoutHandle=Mg(Ap.bind(null,p,jo,$l),g);break}Ap(p,jo,$l);break;case 4:if(Ku(p,P),(P&4194240)===P)break;for(g=p.eventTimes,M=-1;0<P;){var oe=31-Hs(P);z=1<<oe,oe=g[oe],oe>M&&(M=oe),P&=~z}if(P=M,P=Vr()-P,P=(120>P?120:480>P?480:1080>P?1080:1920>P?1920:3e3>P?3e3:4320>P?4320:1960*s1(P/1960))-P,10<P){p.timeoutHandle=Mg(Ap.bind(null,p,jo,$l),P);break}Ap(p,jo,$l);break;case 5:Ap(p,jo,$l);break;default:throw Error(s(329))}}}return po(p,Vr()),p.callbackNode===b?Ny.bind(null,p):null}function Dy(p,g){var b=n_;return p.current.memoizedState.isDehydrated&&(Yd(p,g).flags|=256),p=ql(p,g),p!==2&&(g=jo,jo=b,g!==null&&Ly(g)),p}function Ly(p){jo===null?jo=p:jo.push.apply(jo,p)}function xy(p){for(var g=p;;){if(g.flags&16384){var b=g.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var P=0;P<b.length;P++){var M=b[P],z=M.getSnapshot;M=M.value;try{if(!ol(z(),M))return!1}catch{return!1}}}if(b=g.child,g.subtreeFlags&16384&&b!==null)b.return=g,g=b;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Ku(p,g){for(g&=~Iy,g&=~Cy,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var b=31-Hs(g),P=1<<b;p[b]=-1,g&=~P}}function Ip(p){if((Sr&6)!==0)throw Error(s(327));hm();var g=Ll(p,0);if((g&1)===0)return po(p,Vr()),null;var b=ql(p,g);if(p.tag!==0&&b===2){var P=Ro(p);P!==0&&(g=P,b=Dy(p,P))}if(b===1)throw b=Ks,Yd(p,0),Ku(p,g),po(p,Vr()),b;if(b===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Ap(p,jo,$l),po(p,Vr()),null}function i_(p,g){var b=Sr;Sr|=1;try{return p(g)}finally{Sr=b,Sr===0&&(um=Vr()+500,XE&&Bd())}}function qu(p){Kl!==null&&Kl.tag===0&&(Sr&6)===0&&hm();var g=Sr;Sr|=1;var b=Ec.transition,P=rr;try{if(Ec.transition=null,rr=1,p)return p()}finally{rr=P,Ec.transition=b,Sr=g,(Sr&6)===0&&Bd()}}function s_(){Wa=al.current,yi(al)}function Yd(p,g){p.finishedWork=null,p.finishedLanes=0;var b=p.timeoutHandle;if(b!==-1&&(p.timeoutHandle=-1,GN(b)),ji!==null)for(b=ji.return;b!==null;){var P=b;switch(Fg(P),P.tag){case 1:P=P.type.childContextTypes,P!=null&&KE();break;case 3:Sp(),yi(ca),yi(co),G0();break;case 5:tm(P);break;case 4:Sp();break;case 13:yi(Ti);break;case 19:yi(Ti);break;case 10:F0(P.type._context);break;case 22:case 23:s_()}b=b.return}if(Ms=p,ji=p=Yu(p.current,null),cs=Wa=g,ls=0,Ks=null,Iy=Cy=Rp=0,jo=n_=null,yp!==null){for(g=0;g<yp.length;g++)if(b=yp[g],P=b.interleaved,P!==null){b.interleaved=null;var M=P.next,z=b.pending;if(z!==null){var oe=z.next;z.next=M,P.next=oe}b.pending=P}yp=null}return p}function _T(p,g){do{var b=ji;try{if(V0(),sy.current=ly,nm){for(var P=Ii.memoizedState;P!==null;){var M=P.queue;M!==null&&(M.pending=null),P=P.next}nm=!1}if(zl=0,as=os=Ii=null,Kg=!1,qg=0,Ry.current=null,b===null||b.return===null){ls=1,Ks=g,ji=null;break}e:{var z=p,oe=b.return,Ie=b,Le=g;if(g=cs,Ie.flags|=32768,Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var nt=Le,It=Ie,At=It.tag;if((It.mode&1)===0&&(At===0||At===11||At===15)){var wt=It.alternate;wt?(It.updateQueue=wt.updateQueue,It.memoizedState=wt.memoizedState,It.lanes=wt.lanes):(It.updateQueue=null,It.memoizedState=null)}var Ht=GC(oe);if(Ht!==null){Ht.flags&=-257,HC(Ht,oe,Ie,z,g),Ht.mode&1&&zC(z,nt,g),g=Ht,Le=nt;var Zt=g.updateQueue;if(Zt===null){var en=new Set;en.add(Le),g.updateQueue=en}else Zt.add(Le);break e}else{if((g&1)===0){zC(z,nt,g),ET();break e}Le=Error(s(426))}}else if(ii&&Ie.mode&1){var Bi=GC(oe);if(Bi!==null){(Bi.flags&65536)===0&&(Bi.flags|=256),HC(Bi,oe,Ie,z,g),M0(om(Le,Ie));break e}}z=Le=om(Le,Ie),ls!==4&&(ls=2),n_===null?n_=[z]:n_.push(z),z=oe;do{switch(z.tag){case 3:z.flags|=65536,g&=-g,z.lanes|=g;var Ye=iT(z,Le,g);IC(z,Ye);break e;case 1:Ie=Le;var Ve=z.type,Je=z.stateNode;if((z.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||Je!==null&&typeof Je.componentDidCatch=="function"&&(qd===null||!qd.has(Je)))){z.flags|=65536,g&=-g,z.lanes|=g;var Nt=$u(z,Ie,g);IC(z,Nt);break e}}z=z.return}while(z!==null)}hI(b)}catch(nn){g=nn,ji===b&&b!==null&&(ji=b=b.return);continue}break}while(!0)}function uI(){var p=wy.current;return wy.current=ly,p===null?ly:p}function ET(){(ls===0||ls===3||ls===2)&&(ls=4),Ms===null||(Rp&268435455)===0&&(Cy&268435455)===0||Ku(Ms,cs)}function ql(p,g){var b=Sr;Sr|=2;var P=uI();(Ms!==p||cs!==g)&&($l=null,Yd(p,g));do try{dI();break}catch(M){_T(p,M)}while(!0);if(V0(),Sr=b,wy.current=P,ji!==null)throw Error(s(261));return Ms=null,cs=0,ls}function dI(){for(;ji!==null;)My(ji)}function o1(){for(;ji!==null&&!wo();)My(ji)}function My(p){var g=Fy(p.alternate,p,Wa);p.memoizedProps=p.pendingProps,g===null?hI(p):ji=g,Ry.current=null}function hI(p){var g=p;do{var b=g.alternate;if(p=g.return,(g.flags&32768)===0){if(b=vy(b,g,Wa),b!==null){ji=b;return}}else{if(b=i1(b,g),b!==null){b.flags&=32767,ji=b;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{ls=6,ji=null;return}}if(g=g.sibling,g!==null){ji=g;return}ji=g=p}while(g!==null);ls===0&&(ls=5)}function Ap(p,g,b){var P=rr,M=Ec.transition;try{Ec.transition=null,rr=1,a1(p,g,b,P)}finally{Ec.transition=M,rr=P}return null}function a1(p,g,b,P){do hm();while(Kl!==null);if((Sr&6)!==0)throw Error(s(327));b=p.finishedWork;var M=p.finishedLanes;if(b===null)return null;if(p.finishedWork=null,p.finishedLanes=0,b===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var z=b.lanes|b.childLanes;if(Wr(p,z),p===Ms&&(ji=Ms=null,cs=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||dm||(dm=!0,o_(ia,function(){return hm(),null})),z=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||z){z=Ec.transition,Ec.transition=null;var oe=rr;rr=1;var Ie=Sr;Sr|=4,Ry.current=null,lT(p,b),pT(b,p),R0(xg),Se=!!$E,xg=$E=null,p.current=b,lm(b),kd(),Sr=Ie,rr=oe,Ec.transition=z}else p.current=b;if(dm&&(dm=!1,Kl=p,Oy=M),z=p.pendingLanes,z===0&&(qd=null),Nf(b.stateNode),po(p,Vr()),g!==null)for(P=p.onRecoverableError,b=0;b<g.length;b++)M=g[b],P(M.value,{componentStack:M.stack,digest:M.digest});if(Py)throw Py=!1,p=mT,mT=null,p;return(Oy&1)!==0&&p.tag!==0&&hm(),z=p.pendingLanes,(z&1)!==0?p===gT?Cp++:(Cp=0,gT=p):Cp=0,Bd(),null}function hm(){if(Kl!==null){var p=oc(Oy),g=Ec.transition,b=rr;try{if(Ec.transition=null,rr=16>p?16:p,Kl===null)var P=!1;else{if(p=Kl,Kl=null,Oy=0,(Sr&6)!==0)throw Error(s(331));var M=Sr;for(Sr|=4,Jt=p.current;Jt!==null;){var z=Jt,oe=z.child;if((Jt.flags&16)!==0){var Ie=z.deletions;if(Ie!==null){for(var Le=0;Le<Ie.length;Le++){var nt=Ie[Le];for(Jt=nt;Jt!==null;){var It=Jt;switch(It.tag){case 0:case 11:case 15:Zg(8,It,z)}var At=It.child;if(At!==null)At.return=It,Jt=At;else for(;Jt!==null;){It=Jt;var wt=It.sibling,Ht=It.return;if(sI(It),It===nt){Jt=null;break}if(wt!==null){wt.return=Ht,Jt=wt;break}Jt=Ht}}}var Zt=z.alternate;if(Zt!==null){var en=Zt.child;if(en!==null){Zt.child=null;do{var Bi=en.sibling;en.sibling=null,en=Bi}while(en!==null)}}Jt=z}}if((z.subtreeFlags&2064)!==0&&oe!==null)oe.return=z,Jt=oe;else e:for(;Jt!==null;){if(z=Jt,(z.flags&2048)!==0)switch(z.tag){case 0:case 11:case 15:Zg(9,z,z.return)}var Ye=z.sibling;if(Ye!==null){Ye.return=z.return,Jt=Ye;break e}Jt=z.return}}var Ve=p.current;for(Jt=Ve;Jt!==null;){oe=Jt;var Je=oe.child;if((oe.subtreeFlags&2064)!==0&&Je!==null)Je.return=oe,Jt=Je;else e:for(oe=Ve;Jt!==null;){if(Ie=Jt,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:e_(9,Ie)}}catch(nn){Ai(Ie,Ie.return,nn)}if(Ie===oe){Jt=null;break e}var Nt=Ie.sibling;if(Nt!==null){Nt.return=Ie.return,Jt=Nt;break e}Jt=Ie.return}}if(Sr=M,Bd(),ao&&typeof ao.onPostCommitFiberRoot=="function")try{ao.onPostCommitFiberRoot(Nl,p)}catch{}P=!0}return P}finally{rr=b,Ec.transition=g}}return!1}function Uy(p,g,b){g=om(b,g),g=iT(p,g,1),p=Gd(p,g,1),g=qs(),p!==null&&(xl(p,1,g),po(p,g))}function Ai(p,g,b){if(p.tag===3)Uy(p,p,b);else for(;g!==null;){if(g.tag===3){Uy(g,p,b);break}else if(g.tag===1){var P=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof P.componentDidCatch=="function"&&(qd===null||!qd.has(P))){p=om(b,p),p=$u(g,p,1),g=Gd(g,p,1),p=qs(),g!==null&&(xl(g,1,p),po(g,p));break}}g=g.return}}function pI(p,g,b){var P=p.pingCache;P!==null&&P.delete(g),g=qs(),p.pingedLanes|=p.suspendedLanes&b,Ms===p&&(cs&b)===b&&(ls===4||ls===3&&(cs&130023424)===cs&&500>Vr()-Ay?Yd(p,0):Iy|=b),po(p,g)}function yT(p,g){g===0&&((p.mode&1)===0?g=1:(g=ur,ur<<=1,(ur&130023424)===0&&(ur=4194304)));var b=qs();p=zu(p,g),p!==null&&(xl(p,g,b),po(p,b))}function Vy(p){var g=p.memoizedState,b=0;g!==null&&(b=g.retryLane),yT(p,b)}function fI(p,g){var b=0;switch(p.tag){case 13:var P=p.stateNode,M=p.memoizedState;M!==null&&(b=M.retryLane);break;case 19:P=p.stateNode;break;default:throw Error(s(314))}P!==null&&P.delete(g),yT(p,b)}var Fy;Fy=function(p,g,b){if(p!==null)if(p.memoizedProps!==g.pendingProps||ca.current)pa=!0;else{if((p.lanes&b)===0&&(g.flags&128)===0)return pa=!1,eI(p,g,b);pa=(p.flags&131072)!==0}else pa=!1,ii&&(g.flags&1048576)!==0&&QE(g,JE,g.index);switch(g.lanes=0,g.tag){case 2:var P=g.type;Ey(p,g),p=g.pendingProps;var M=_p(g,co.current);Wu(g,b),M=rm(null,g,P,p,M,b);var z=K0();return g.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,la(P)?(z=!0,YE(g)):z=!1,g.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,zg(g),M.updater=dy,g.stateNode=M,M._reactInternals=g,tT(g,P,p,b),g=py(null,g,P,!0,z,b)):(g.tag=0,ii&&z&&ZE(g),Vo(null,g,M,b),g=g.child),g;case 16:P=g.elementType;e:{switch(Ey(p,g),p=g.pendingProps,M=P._init,P=M(P._payload),g.type=P,M=g.tag=Pp(P),p=Ba(P,p),M){case 0:g=sT(null,g,P,p,b);break e;case 1:g=XC(null,g,P,p,b);break e;case 11:g=hy(null,g,P,p,b);break e;case 14:g=$C(null,g,P,Ba(P.type,p),b);break e}throw Error(s(306,P,""))}return g;case 0:return P=g.type,M=g.pendingProps,M=g.elementType===P?M:Ba(P,M),sT(p,g,P,M,b);case 1:return P=g.type,M=g.pendingProps,M=g.elementType===P?M:Ba(P,M),XC(p,g,P,M,b);case 3:e:{if(oT(g),p===null)throw Error(s(387));P=g.pendingProps,z=g.memoizedState,M=z.element,CC(p,g),iy(g,P,null,b);var oe=g.memoizedState;if(P=oe.element,z.isDehydrated)if(z={element:P,isDehydrated:!1,cache:oe.cache,pendingSuspenseBoundaries:oe.pendingSuspenseBoundaries,transitions:oe.transitions},g.updateQueue.baseState=z,g.memoizedState=z,g.flags&256){M=om(Error(s(423)),g),g=JC(p,g,P,b,M);break e}else if(P!==M){M=om(Error(s(424)),g),g=JC(p,g,P,b,M);break e}else for(da=Vd(g.stateNode.containerInfo.firstChild),ua=g,ii=!0,Mo=null,b=wC(g,null,P,b),g.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Jf(),P===M){g=Gl(p,g,b);break e}Vo(p,g,P,b)}g=g.child}return g;case 5:return PC(g),p===null&&x0(g),P=g.type,M=g.pendingProps,z=p!==null?p.memoizedProps:null,oe=M.children,k0(P,M)?oe=null:z!==null&&k0(P,z)&&(g.flags|=32),YC(p,g),Vo(p,g,oe,b),g.child;case 6:return p===null&&x0(g),null;case 13:return fy(p,g,b);case 4:return W0(g,g.stateNode.containerInfo),P=g.pendingProps,p===null?g.child=Qf(g,null,P,b):Vo(p,g,P,b),g.child;case 11:return P=g.type,M=g.pendingProps,M=g.elementType===P?M:Ba(P,M),hy(p,g,P,M,b);case 7:return Vo(p,g,g.pendingProps,b),g.child;case 8:return Vo(p,g,g.pendingProps.children,b),g.child;case 12:return Vo(p,g,g.pendingProps.children,b),g.child;case 10:e:{if(P=g.type._context,M=g.pendingProps,z=g.memoizedProps,oe=M.value,pi(ny,P._currentValue),P._currentValue=oe,z!==null)if(ol(z.value,oe)){if(z.children===M.children&&!ca.current){g=Gl(p,g,b);break e}}else for(z=g.child,z!==null&&(z.return=g);z!==null;){var Ie=z.dependencies;if(Ie!==null){oe=z.child;for(var Le=Ie.firstContext;Le!==null;){if(Le.context===P){if(z.tag===1){Le=Bl(-1,b&-b),Le.tag=2;var nt=z.updateQueue;if(nt!==null){nt=nt.shared;var It=nt.pending;It===null?Le.next=Le:(Le.next=It.next,It.next=Le),nt.pending=Le}}z.lanes|=b,Le=z.alternate,Le!==null&&(Le.lanes|=b),j0(z.return,b,g),Ie.lanes|=b;break}Le=Le.next}}else if(z.tag===10)oe=z.type===g.type?null:z.child;else if(z.tag===18){if(oe=z.return,oe===null)throw Error(s(341));oe.lanes|=b,Ie=oe.alternate,Ie!==null&&(Ie.lanes|=b),j0(oe,b,g),oe=z.sibling}else oe=z.child;if(oe!==null)oe.return=z;else for(oe=z;oe!==null;){if(oe===g){oe=null;break}if(z=oe.sibling,z!==null){z.return=oe.return,oe=z;break}oe=oe.return}z=oe}Vo(p,g,M.children,b),g=g.child}return g;case 9:return M=g.type,P=g.pendingProps.children,Wu(g,b),M=mc(M),P=P(M),g.flags|=1,Vo(p,g,P,b),g.child;case 14:return P=g.type,M=Ba(P,g.pendingProps),M=Ba(P.type,M),$C(p,g,P,M,b);case 15:return KC(p,g,g.type,g.pendingProps,b);case 17:return P=g.type,M=g.pendingProps,M=g.elementType===P?M:Ba(P,M),Ey(p,g),g.tag=1,la(P)?(p=!0,YE(g)):p=!1,Wu(g,b),BC(g,P,M),tT(g,P,M,b),py(null,g,P,!0,p,b);case 19:return _y(p,g,b);case 22:return qC(p,g,b)}throw Error(s(156,g.tag))};function o_(p,g){return Od(p,g)}function jy(p,g,b,P){this.tag=p,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=P,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function za(p,g,b,P){return new jy(p,g,b,P)}function Xd(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Pp(p){if(typeof p=="function")return Xd(p)?1:0;if(p!=null){if(p=p.$$typeof,p===he)return 11;if(p===Ge)return 14}return 2}function Yu(p,g){var b=p.alternate;return b===null?(b=za(p.tag,g,p.key,p.mode),b.elementType=p.elementType,b.type=p.type,b.stateNode=p.stateNode,b.alternate=p,p.alternate=b):(b.pendingProps=g,b.type=p.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=p.flags&14680064,b.childLanes=p.childLanes,b.lanes=p.lanes,b.child=p.child,b.memoizedProps=p.memoizedProps,b.memoizedState=p.memoizedState,b.updateQueue=p.updateQueue,g=p.dependencies,b.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},b.sibling=p.sibling,b.index=p.index,b.ref=p.ref,b}function By(p,g,b,P,M,z){var oe=2;if(P=p,typeof p=="function")Xd(p)&&(oe=1);else if(typeof p=="string")oe=5;else e:switch(p){case ee:return Op(b.children,M,z,g);case Z:oe=8,M|=8;break;case ne:return p=za(12,b,g,M|2),p.elementType=ne,p.lanes=z,p;case le:return p=za(13,b,g,M),p.elementType=le,p.lanes=z,p;case Me:return p=za(19,b,g,M),p.elementType=Me,p.lanes=z,p;case Ee:return Jd(b,M,z,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ae:oe=10;break e;case me:oe=9;break e;case he:oe=11;break e;case Ge:oe=14;break e;case tt:oe=16,P=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return g=za(oe,b,g,M),g.elementType=p,g.type=P,g.lanes=z,g}function Op(p,g,b,P){return p=za(7,p,P,g),p.lanes=b,p}function Jd(p,g,b,P){return p=za(22,p,P,g),p.elementType=Ee,p.lanes=b,p.stateNode={isHidden:!1},p}function vT(p,g,b){return p=za(6,p,null,g),p.lanes=b,p}function ST(p,g,b){return g=za(4,p.children!==null?p.children:[],p.key,g),g.lanes=b,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function c1(p,g,b,P,M){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nl(0),this.expirationTimes=nl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nl(0),this.identifierPrefix=P,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function TT(p,g,b,P,M,z,oe,Ie,Le){return p=new c1(p,g,b,Ie,Le),g===1?(g=1,z===!0&&(g|=8)):g=0,z=za(3,null,null,g),p.current=z,z.stateNode=p,z.memoizedState={element:P,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},zg(z),p}function l1(p,g,b){var P=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ge,key:P==null?null:""+P,children:p,containerInfo:g,implementation:b}}function mI(p){if(!p)return jd;p=p._reactInternals;e:{if(Ls(p)!==p||p.tag!==1)throw Error(s(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(la(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(s(171))}if(p.tag===1){var b=p.type;if(la(b))return qE(p,b,g)}return g}function Wy(p,g,b,P,M,z,oe,Ie,Le){return p=TT(b,P,!0,p,M,z,oe,Ie,Le),p.context=mI(null),b=p.current,P=qs(),M=yc(b),z=Bl(P,M),z.callback=g??null,Gd(b,z,M),p.current.lanes=M,xl(p,M,P),po(p,P),p}function a_(p,g,b,P){var M=g.current,z=qs(),oe=yc(M);return b=mI(b),g.context===null?g.context=b:g.pendingContext=b,g=Bl(z,oe),g.payload={element:p},P=P===void 0?null:P,P!==null&&(g.callback=P),p=Gd(M,g,oe),p!==null&&(vc(p,M,oe,z),Gg(p,M,oe)),oe}function zy(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function bT(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var b=p.retryLane;p.retryLane=b!==0&&b<g?b:g}}function wT(p,g){bT(p,g),(p=p.alternate)&&bT(p,g)}function c_(){return null}var cl=typeof reportError=="function"?reportError:function(p){console.error(p)};function Gy(p){this._internalRoot=p}Hy.prototype.render=Gy.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(s(409));a_(p,g,null,null)},Hy.prototype.unmount=Gy.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;qu(function(){a_(null,p,null,null)}),g[dc]=null}};function Hy(p){this._internalRoot=p}Hy.prototype.unstable_scheduleHydration=function(p){if(p){var g=ip();p={blockedOn:null,target:p,priority:g};for(var b=0;b<Oo.length&&g!==0&&g<Oo[b].priority;b++);Oo.splice(b,0,p),b===0&&op(p)}};function RT(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function pm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function CT(){}function u1(p,g,b,P,M){if(M){if(typeof P=="function"){var z=P;P=function(){var nt=zy(oe);z.call(nt)}}var oe=Wy(g,P,p,0,null,!1,!1,"",CT);return p._reactRootContainer=oe,p[dc]=oe.current,hp(p.nodeType===8?p.parentNode:p),qu(),oe}for(;M=p.lastChild;)p.removeChild(M);if(typeof P=="function"){var Ie=P;P=function(){var nt=zy(Le);Ie.call(nt)}}var Le=TT(p,0,!1,null,null,!1,!1,"",CT);return p._reactRootContainer=Le,p[dc]=Le.current,hp(p.nodeType===8?p.parentNode:p),qu(function(){a_(g,Le,b,P)}),Le}function kp(p,g,b,P,M){var z=b._reactRootContainer;if(z){var oe=z;if(typeof M=="function"){var Ie=M;M=function(){var Le=zy(oe);Ie.call(Le)}}a_(g,oe,p,M)}else oe=u1(b,g,p,M,P);return zy(oe)}Df=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var b=Dl(g.pendingLanes);b!==0&&(Ma(g,b|1),po(g,Vr()),(Sr&6)===0&&(um=Vr()+500,Bd()))}break;case 13:qu(function(){var P=zu(p,1);if(P!==null){var M=qs();vc(P,p,1,M)}}),wT(p,1)}},Ml=function(p){if(p.tag===13){var g=zu(p,134217728);if(g!==null){var b=qs();vc(g,p,134217728,b)}wT(p,134217728)}},xd=function(p){if(p.tag===13){var g=yc(p),b=zu(p,g);if(b!==null){var P=qs();vc(b,p,g,P)}wT(p,g)}},ip=function(){return rr},Lf=function(p,g){var b=rr;try{return rr=p,g()}finally{rr=b}},kl=function(p,g,b){switch(g){case"input":if(Dt(p,b),g=b.name,b.type==="radio"&&g!=null){for(b=p;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<b.length;g++){var P=b[g];if(P!==p&&P.form===p.form){var M=qf(P);if(!M)throw Error(s(90));Vt(P),Dt(P,M)}}}break;case"textarea":zt(p,b);break;case"select":g=b.value,g!=null&&mt(p,!!b.multiple,g,!1)}},Ru=i_,rc=qu;var Qd={usingClientEntryPoint:!1,Events:[Kf,mp,qf,nc,Qc,i_]},Xu={findFiberByHostInstance:fp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},d1={bundleType:Xu.bundleType,version:Xu.version,rendererPackageName:Xu.rendererPackageName,rendererConfig:Xu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:de.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Pd(p),p===null?null:p.stateNode},findFiberByHostInstance:Xu.findFiberByHostInstance||c_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $y=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$y.isDisabled&&$y.supportsFiber)try{Nl=$y.inject(d1),ao=$y}catch{}}return Lc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qd,Lc.createPortal=function(p,g){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!RT(g))throw Error(s(200));return l1(p,g,null,b)},Lc.createRoot=function(p,g){if(!RT(p))throw Error(s(299));var b=!1,P="",M=cl;return g!=null&&(g.unstable_strictMode===!0&&(b=!0),g.identifierPrefix!==void 0&&(P=g.identifierPrefix),g.onRecoverableError!==void 0&&(M=g.onRecoverableError)),g=TT(p,1,!1,null,null,b,!1,P,M),p[dc]=g.current,hp(p.nodeType===8?p.parentNode:p),new Gy(g)},Lc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=Pd(g),p=p===null?null:p.stateNode,p},Lc.flushSync=function(p){return qu(p)},Lc.hydrate=function(p,g,b){if(!pm(g))throw Error(s(200));return kp(null,p,g,!0,b)},Lc.hydrateRoot=function(p,g,b){if(!RT(p))throw Error(s(405));var P=b!=null&&b.hydratedSources||null,M=!1,z="",oe=cl;if(b!=null&&(b.unstable_strictMode===!0&&(M=!0),b.identifierPrefix!==void 0&&(z=b.identifierPrefix),b.onRecoverableError!==void 0&&(oe=b.onRecoverableError)),g=Wy(g,null,p,1,b??null,M,!1,z,oe),p[dc]=g.current,hp(p),P)for(p=0;p<P.length;p++)b=P[p],M=b._getVersion,M=M(b._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[b,M]:g.mutableSourceEagerHydrationData.push(b,M);return new Hy(g)},Lc.render=function(p,g,b){if(!pm(g))throw Error(s(200));return kp(null,p,g,!1,b)},Lc.unmountComponentAtNode=function(p){if(!pm(p))throw Error(s(40));return p._reactRootContainer?(qu(function(){kp(null,null,p,!1,function(){p._reactRootContainer=null,p[dc]=null})}),!0):!1},Lc.unstable_batchedUpdates=i_,Lc.unstable_renderSubtreeIntoContainer=function(p,g,b,P){if(!pm(b))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return kp(p,g,b,!1,P)},Lc.version="18.3.1-next-f1338f8080-20240426",Lc}var J7;function gJ(){if(J7)return iM.exports;J7=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),iM.exports=Fge(),iM.exports}var Q7;function jge(){if(Q7)return LP;Q7=1;var r=gJ();return LP.createRoot=r.createRoot,LP.hydrateRoot=r.hydrateRoot,LP}var Bge=jge();const Wge=a0(Bge);function zge(r,t,s,a){return r.addEventListener(t,s,a),()=>{r.removeEventListener(t,s,a)}}function Lk(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}function Gge(){return!!(globalThis!=null&&globalThis.document)}function _J(r){return r.parentElement&&_J(r.parentElement)?!0:r.hidden}function Hge(r){const t=r.getAttribute("contenteditable");return t!=="false"&&t!=null}function $ge(r){return!!r.getAttribute("disabled")||!!r.getAttribute("aria-disabled")}function Kge(r){var t;return((t=EJ(r))==null?void 0:t.defaultView)??window}function EJ(r){return Lk(r)?r.ownerDocument:document}function qge(r){return r.view??window}function Yge(r){return EJ(r).activeElement}function Xge(r){const t=qge(r);return typeof t.PointerEvent<"u"&&r instanceof t.PointerEvent?r.pointerType==="mouse":r instanceof t.MouseEvent}function yJ(r){return!!r.touches}function Jge(r){return yJ(r)&&r.touches.length>1}function Qge(r,t="page"){const s=r.touches[0]||r.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function Zge(r,t="page"){return{x:r[`${t}X`],y:r[`${t}Y`]}}function vJ(r,t="page"){return yJ(r)?Qge(r,t):Zge(r,t)}function e_e(r){return t=>{const s=Xge(t);(!s||s&&t.button===0)&&r(t)}}function t_e(r,t=!1){function s(l){r(l,{point:vJ(l)})}return t?e_e(s):s}function dO(r,t,s,a){return zge(r,t,t_e(s,t==="pointerdown"),a)}function n_e(r,...t){if(r==null)throw new TypeError("Cannot convert undefined or null to object");const s={...r};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const Yn=r=>r?"":void 0,SS=r=>r?!0:void 0;function r_e(r){return Array.isArray(r)}function Eu(r){const t=typeof r;return r!=null&&(t==="object"||t==="function")&&!r_e(r)}function i_e(r){const t=r==null?0:r.length;return t?r[t-1]:void 0}function s_e(r){const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function C2(r){if(r==null)return r;const{unitless:t}=s_e(r);return t||typeof r=="number"?`${r}px`:r}const SJ=(r,t)=>parseInt(r[1],10)>parseInt(t[1],10)?1:-1,aV=r=>Object.fromEntries(Object.entries(r).sort(SJ));function Z7(r){const t=aV(r);return Object.assign(Object.values(t),t)}function o_e(r){const t=Object.keys(aV(r));return new Set(t)}function e$(r){if(!r)return r;r=C2(r)??r;const t=-.02;return typeof r=="number"?`${r+t}`:r.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function iw(r,t){const s=["@media screen"];return r&&s.push("and",`(min-width: ${C2(r)})`),t&&s.push("and",`(max-width: ${C2(t)})`),s.join(" ")}function a_e(r){if(!r)return null;r.base=r.base??"0px";const t=Z7(r),s=Object.entries(r).sort(SJ).map(([d,f],E,v)=>{let[,T]=v[E+1]??[];return T=parseFloat(T)>0?e$(T):void 0,{_minW:e$(f),breakpoint:d,minW:f,maxW:T,maxWQuery:iw(null,T),minWQuery:iw(f),minMaxQuery:iw(f,T)}}),a=o_e(r),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(E=>a.has(E))},asObject:aV(r),asArray:Z7(r),details:s,get(d){return s.find(f=>f.breakpoint===d)},media:[null,...t.map(d=>iw(d)).slice(1)],toArrayValue(d){if(!Eu(d))throw new Error("toArrayValue: value must be an object");const f=l.map(E=>d[E]??null);for(;i_e(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,E,v)=>{const T=l[v];return T!=null&&E!=null&&(f[T]=E),f},{})}}}function TJ(...r){return function(...s){r.forEach(a=>a==null?void 0:a(...s))}}function Zn(...r){return function(s){r.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function cV(r){return L.Children.toArray(r).filter(t=>L.isValidElement(t))}function xk(r){const t=Object.assign({},r);for(let s in t)t[s]===void 0&&delete t[s];return t}function c_e(r,t){return`${r} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Vi(r={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=r,E=L.createContext(f);E.displayName=t;function v(){var w;const T=L.useContext(E);if(!T&&s){const I=new Error(d??c_e(a,l));throw I.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,I,v),I}return T}return[E.Provider,v,E]}const Sn=(...r)=>r.filter(Boolean).join(" "),bJ=r=>r.hasAttribute("tabindex"),l_e=r=>bJ(r)&&r.tabIndex===-1;function $O(r){if(!Lk(r)||_J(r)||$ge(r))return!1;const{localName:t}=r;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>r.hasAttribute("href"),audio:()=>r.hasAttribute("controls"),video:()=>r.hasAttribute("controls")};return t in a?a[t]():Hge(r)?!0:bJ(r)}function u_e(r){return r?Lk(r)&&$O(r)&&!l_e(r):!1}const d_e=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],h_e=d_e.join(),p_e=r=>r.offsetWidth>0&&r.offsetHeight>0;function wJ(r){const t=Array.from(r.querySelectorAll(h_e));return t.unshift(r),t.filter(s=>$O(s)&&p_e(s))}function f_e(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}const m_e=r=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=r(a,l,d,f);return E.set(l,v),v}},RJ=m_e(f_e),g_e=r=>r.default||r;function lV(r){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=r;return!!(!s||a||l==="keepMounted"&&t)}function __e(r){const t=parseFloat(r);return typeof t!="number"||Number.isNaN(t)?0:t}function E_e(r,t){let s=__e(r);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function y_e(r){if(!Number.isFinite(r))return 0;let t=1,s=0;for(;Math.round(r*t)/t!==r;)t*=10,s+=1;return s}function t$(r,t,s){return(r-t)*100/(s-t)}function v_e(r,t,s){return(s-t)*r+t}function n$(r,t,s){const a=Math.round((r-t)/s)*s+t,l=y_e(s);return E_e(a,l)}function aM(r,t,s){return r==null?r:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(r,t),s))}function _R(r,t=[]){const s=Object.assign({},r);for(const a of t)a in s&&delete s[a];return s}function CJ(r,t){const s={};for(const a of t)a in r&&(s[a]=r[a]);return s}function uV(r,t){return Array.isArray(r)?r.map(s=>s===null?null:t(s)):Eu(r)?Object.keys(r).reduce((s,a)=>(s[a]=t(r[a]),s),{}):r!=null?t(r):null}const S_e=r=>typeof r=="function";function jc(r,...t){return S_e(r)?r(...t):r}function T_e(r){const t=r.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(r);return/auto|scroll|overlay|hidden/.test(s+l+a)}function b_e(r){return r.localName==="html"?r:r.assignedSlot||r.parentElement||r.ownerDocument.documentElement}function IJ(r){return["html","body","#document"].includes(r.localName)?r.ownerDocument.body:Lk(r)&&T_e(r)?r:IJ(b_e(r))}function w_e(r,t){const s={},a={};for(const[l,d]of Object.entries(r))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function R_e(r,...t){const s=Object.getOwnPropertyDescriptors(r),a=Object.keys(s),l=f=>{const E={};for(let v=0;v<f.length;v++){const T=f[v];s[T]&&(Object.defineProperty(E,T,s[T]),delete s[T])}return E},d=f=>l(Array.isArray(f)?f:a.filter(f));return t.map(d).concat(l(a))}function r$(r,t,s={}){const{stop:a,getKey:l}=s;function d(f,E=[]){if(Eu(f)||Array.isArray(f)){const v={};for(const[T,w]of Object.entries(f)){const I=(l==null?void 0:l(T))??T,N=[...E,I];if(a!=null&&a(f,N))return t(f,E);v[I]=d(w,N)}return v}return t(f,E)}return d(r)}var sw={exports:{}};sw.exports;var i$;function C_e(){return i$||(i$=1,function(r,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,E="[object Arguments]",v="[object Array]",T="[object AsyncFunction]",w="[object Boolean]",I="[object Date]",N="[object Error]",F="[object Function]",j="[object GeneratorFunction]",G="[object Map]",H="[object Number]",te="[object Null]",K="[object Object]",Q="[object Proxy]",de="[object RegExp]",se="[object Set]",ge="[object String]",ee="[object Undefined]",Z="[object WeakMap]",ne="[object ArrayBuffer]",ae="[object DataView]",me="[object Float32Array]",he="[object Float64Array]",le="[object Int8Array]",Me="[object Int16Array]",Ge="[object Int32Array]",tt="[object Uint8Array]",Ee="[object Uint8ClampedArray]",we="[object Uint16Array]",ve="[object Uint32Array]",Be=/[\\^$.*+?()[\]{}|]/g,Oe=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,Ce={};Ce[me]=Ce[he]=Ce[le]=Ce[Me]=Ce[Ge]=Ce[tt]=Ce[Ee]=Ce[we]=Ce[ve]=!0,Ce[E]=Ce[v]=Ce[ne]=Ce[w]=Ce[ae]=Ce[I]=Ce[N]=Ce[F]=Ce[G]=Ce[H]=Ce[K]=Ce[de]=Ce[se]=Ce[ge]=Ce[Z]=!1;var xe=typeof Z_=="object"&&Z_&&Z_.Object===Object&&Z_,ze=typeof self=="object"&&self&&self.Object===Object&&self,Qe=xe||ze||Function("return this")(),et=t&&!t.nodeType&&t,ut=et&&!0&&r&&!r.nodeType&&r,it=ut&&ut.exports===et,Ct=it&&xe.process,_n=function(){try{var Se=ut&&ut.require&&ut.require("util").types;return Se||Ct&&Ct.binding&&Ct.binding("util")}catch{}}(),Vt=_n&&_n.isTypedArray;function ln(Se,Ne,Ze){switch(Ze.length){case 0:return Se.call(Ne);case 1:return Se.call(Ne,Ze[0]);case 2:return Se.call(Ne,Ze[0],Ze[1]);case 3:return Se.call(Ne,Ze[0],Ze[1],Ze[2])}return Se.apply(Ne,Ze)}function xn(Se,Ne){for(var Ze=-1,Kt=Array(Se);++Ze<Se;)Kt[Ze]=Ne(Ze);return Kt}function Xt(Se){return function(Ne){return Se(Ne)}}function Pt(Se,Ne){return Se==null?void 0:Se[Ne]}function Dt(Se,Ne){return function(Ze){return Se(Ne(Ze))}}var Te=Array.prototype,Ue=Function.prototype,$e=Object.prototype,mt=Qe["__core-js_shared__"],Et=Ue.toString,yt=$e.hasOwnProperty,zt=function(){var Se=/[^.]+$/.exec(mt&&mt.keys&&mt.keys.IE_PROTO||"");return Se?"Symbol(src)_1."+Se:""}(),dn=$e.toString,hn=Et.call(Object),Yt=RegExp("^"+Et.call(yt).replace(Be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bn=it?Qe.Buffer:void 0,ec=Qe.Symbol,jt=Qe.Uint8Array;Bn&&Bn.allocUnsafe;var an=Dt(Object.getPrototypeOf,Object),qi=Object.create,Ns=$e.propertyIsEnumerable,Gs=Te.splice,ui=ec?ec.toStringTag:void 0,Na=function(){try{var Se=xa(Object,"defineProperty");return Se({},"",{}),Se}catch{}}(),Jc=Bn?Bn.isBuffer:void 0,so=Math.max,oo=Date.now,kl=xa(Qe,"Map"),Ds=xa(Object,"create"),tc=function(){function Se(){}return function(Ne){if(!ac(Ne))return{};if(qi)return qi(Ne);Se.prototype=Ne;var Ze=new Se;return Se.prototype=void 0,Ze}}();function ea(Se){var Ne=-1,Ze=Se==null?0:Se.length;for(this.clear();++Ne<Ze;){var Kt=Se[Ne];this.set(Kt[0],Kt[1])}}function nc(){this.__data__=Ds?Ds(null):{},this.size=0}function Qc(Se){var Ne=this.has(Se)&&delete this.__data__[Se];return this.size-=Ne?1:0,Ne}function Ru(Se){var Ne=this.__data__;if(Ds){var Ze=Ne[Se];return Ze===a?void 0:Ze}return yt.call(Ne,Se)?Ne[Se]:void 0}function rc(Se){var Ne=this.__data__;return Ds?Ne[Se]!==void 0:yt.call(Ne,Se)}function Zc(Se,Ne){var Ze=this.__data__;return this.size+=this.has(Se)?0:1,Ze[Se]=Ds&&Ne===void 0?a:Ne,this}ea.prototype.clear=nc,ea.prototype.delete=Qc,ea.prototype.get=Ru,ea.prototype.has=rc,ea.prototype.set=Zc;function bo(Se){var Ne=-1,Ze=Se==null?0:Se.length;for(this.clear();++Ne<Ze;){var Kt=Se[Ne];this.set(Kt[0],Kt[1])}}function Ci(){this.__data__=[],this.size=0}function rs(Se){var Ne=this.__data__,Ze=kd(Ne,Se);if(Ze<0)return!1;var Kt=Ne.length-1;return Ze==Kt?Ne.pop():Gs.call(Ne,Ze,1),--this.size,!0}function Da(Se){var Ne=this.__data__,Ze=kd(Ne,Se);return Ze<0?void 0:Ne[Ze][1]}function Cu(Se){return kd(this.__data__,Se)>-1}function ic(Se,Ne){var Ze=this.__data__,Kt=kd(Ze,Se);return Kt<0?(++this.size,Ze.push([Se,Ne])):Ze[Kt][1]=Ne,this}bo.prototype.clear=Ci,bo.prototype.delete=rs,bo.prototype.get=Da,bo.prototype.has=Cu,bo.prototype.set=ic;function ta(Se){var Ne=-1,Ze=Se==null?0:Se.length;for(this.clear();++Ne<Ze;){var Kt=Se[Ne];this.set(Kt[0],Kt[1])}}function na(){this.size=0,this.__data__={hash:new ea,map:new(kl||bo),string:new ea}}function Id(Se){var Ne=Ou(this,Se).delete(Se);return this.size-=Ne?1:0,Ne}function wg(Se){return Ou(this,Se).get(Se)}function Iu(Se){return Ou(this,Se).has(Se)}function tp(Se,Ne){var Ze=Ou(this,Se),Kt=Ze.size;return Ze.set(Se,Ne),this.size+=Ze.size==Kt?0:1,this}ta.prototype.clear=na,ta.prototype.delete=Id,ta.prototype.get=wg,ta.prototype.has=Iu,ta.prototype.set=tp;function Ls(Se){var Ne=this.__data__=new bo(Se);this.size=Ne.size}function Au(){this.__data__=new bo,this.size=0}function ra(Se){var Ne=this.__data__,Ze=Ne.delete(Se);return this.size=Ne.size,Ze}function Ad(Se){return this.__data__.get(Se)}function Pd(Se){return this.__data__.has(Se)}function La(Se,Ne){var Ze=this.__data__;if(Ze instanceof bo){var Kt=Ze.__data__;if(!kl||Kt.length<s-1)return Kt.push([Se,Ne]),this.size=++Ze.size,this;Ze=this.__data__=new ta(Kt)}return Ze.set(Se,Ne),this.size=Ze.size,this}Ls.prototype.clear=Au,Ls.prototype.delete=ra,Ls.prototype.get=Ad,Ls.prototype.has=Pd,Ls.prototype.set=La;function Od(Se,Ne){var Ze=Io(Se),Kt=!Ze&&Yi(Se),Kn=!Ze&&!Kt&&Po(Se),mr=!Ze&&!Kt&&!Kn&&op(Se),Fr=Ze||Kt||Kn||mr,cn=Fr?xn(Se.length,String):[],Or=cn.length;for(var hi in Se)Fr&&(hi=="length"||Kn&&(hi=="offset"||hi=="parent")||mr&&(hi=="buffer"||hi=="byteLength"||hi=="byteOffset")||nl(hi,Or))||cn.push(hi);return cn}function Pu(Se,Ne,Ze){(Ze!==void 0&&!Co(Se[Ne],Ze)||Ze===void 0&&!(Ne in Se))&&Vr(Se,Ne,Ze)}function wo(Se,Ne,Ze){var Kt=Se[Ne];(!(yt.call(Se,Ne)&&Co(Kt,Ze))||Ze===void 0&&!(Ne in Se))&&Vr(Se,Ne,Ze)}function kd(Se,Ne){for(var Ze=Se.length;Ze--;)if(Co(Se[Ze][0],Ne))return Ze;return-1}function Vr(Se,Ne,Ze){Ne=="__proto__"&&Na?Na(Se,Ne,{configurable:!0,enumerable:!0,value:Ze,writable:!0}):Se[Ne]=Ze}var di=Ll();function sc(Se){return Se==null?Se===void 0?ee:te:ui&&ui in Object(Se)?Ro(Se):Df(Se)}function el(Se){return is(Se)&&sc(Se)==E}function ia(Se){if(!ac(Se)||Ma(Se))return!1;var Ne=Oo(Se)?Yt:Oe;return Ne.test(sp(Se))}function np(Se){return is(Se)&&xf(Se.length)&&!!Ce[sc(Se)]}function Nd(Se){if(!ac(Se))return oc(Se);var Ne=rr(Se),Ze=[];for(var Kt in Se)Kt=="constructor"&&(Ne||!yt.call(Se,Kt))||Ze.push(Kt);return Ze}function Nl(Se,Ne,Ze,Kt,Kn){Se!==Ne&&di(Ne,function(mr,Fr){if(Kn||(Kn=new Ls),ac(mr))ao(Se,Ne,Fr,Ze,Nl,Kt,Kn);else{var cn=Kt?Kt(xd(Se,Fr),mr,Fr+"",Se,Ne,Kn):void 0;cn===void 0&&(cn=mr),Pu(Se,Fr,cn)}},Vl)}function ao(Se,Ne,Ze,Kt,Kn,mr,Fr){var cn=xd(Se,Ze),Or=xd(Ne,Ze),hi=Fr.get(Or);if(hi){Pu(Se,Ze,hi);return}var Ss=mr?mr(cn,Or,Ze+"",Se,Ne,Fr):void 0,ko=Ss===void 0;if(ko){var No=Io(Or),Du=!No&&Po(Or),Fi=!No&&!Du&&op(Or);Ss=Or,No||Du||Fi?Io(cn)?Ss=cn:Ul(cn)?Ss=Ld(cn):Du?(ko=!1,Ss=rp(Or)):Fi?(ko=!1,Ss=Dd(Or)):Ss=[]:Nu(Or)||Yi(Or)?(Ss=cn,Yi(cn)?Ss=rl(cn):(!ac(cn)||Oo(cn))&&(Ss=ku(Or))):ko=!1}ko&&(Fr.set(Or,Ss),Kn(Ss,Or,Kt,mr,Fr),Fr.delete(Or)),Pu(Se,Ze,Ss)}function Nf(Se,Ne){return ip(Ml(Se,Ne,oa),Se+"")}var Hs=Na?function(Se,Ne){return Na(Se,"toString",{configurable:!0,enumerable:!1,value:sa(Ne),writable:!0})}:oa;function rp(Se,Ne){return Se.slice()}function tl(Se){var Ne=new Se.constructor(Se.byteLength);return new jt(Ne).set(new jt(Se)),Ne}function Dd(Se,Ne){var Ze=tl(Se.buffer);return new Se.constructor(Ze,Se.byteOffset,Se.length)}function Ld(Se,Ne){var Ze=-1,Kt=Se.length;for(Ne||(Ne=Array(Kt));++Ze<Kt;)Ne[Ze]=Se[Ze];return Ne}function ur(Se,Ne,Ze,Kt){var Kn=!Ze;Ze||(Ze={});for(var mr=-1,Fr=Ne.length;++mr<Fr;){var cn=Ne[mr],Or=void 0;Or===void 0&&(Or=Se[cn]),Kn?Vr(Ze,cn,Or):wo(Ze,cn,Or)}return Ze}function Dl(Se){return Nf(function(Ne,Ze){var Kt=-1,Kn=Ze.length,mr=Kn>1?Ze[Kn-1]:void 0,Fr=Kn>2?Ze[2]:void 0;for(mr=Se.length>3&&typeof mr=="function"?(Kn--,mr):void 0,Fr&&xl(Ze[0],Ze[1],Fr)&&(mr=Kn<3?void 0:mr,Kn=1),Ne=Object(Ne);++Kt<Kn;){var cn=Ze[Kt];cn&&Se(Ne,cn,Kt,mr)}return Ne})}function Ll(Se){return function(Ne,Ze,Kt){for(var Kn=-1,mr=Object(Ne),Fr=Kt(Ne),cn=Fr.length;cn--;){var Or=Fr[++Kn];if(Ze(mr[Or],Or,mr)===!1)break}return Ne}}function Ou(Se,Ne){var Ze=Se.__data__;return Wr(Ne)?Ze[typeof Ne=="string"?"string":"hash"]:Ze.map}function xa(Se,Ne){var Ze=Pt(Se,Ne);return ia(Ze)?Ze:void 0}function Ro(Se){var Ne=yt.call(Se,ui),Ze=Se[ui];try{Se[ui]=void 0;var Kt=!0}catch{}var Kn=dn.call(Se);return Kt&&(Ne?Se[ui]=Ze:delete Se[ui]),Kn}function ku(Se){return typeof Se.constructor=="function"&&!rr(Se)?tc(an(Se)):{}}function nl(Se,Ne){var Ze=typeof Se;return Ne=Ne??f,!!Ne&&(Ze=="number"||Ze!="symbol"&&be.test(Se))&&Se>-1&&Se%1==0&&Se<Ne}function xl(Se,Ne,Ze){if(!ac(Ze))return!1;var Kt=typeof Ne;return(Kt=="number"?Ao(Ze)&&nl(Ne,Ze.length):Kt=="string"&&Ne in Ze)?Co(Ze[Ne],Se):!1}function Wr(Se){var Ne=typeof Se;return Ne=="string"||Ne=="number"||Ne=="symbol"||Ne=="boolean"?Se!=="__proto__":Se===null}function Ma(Se){return!!zt&&zt in Se}function rr(Se){var Ne=Se&&Se.constructor,Ze=typeof Ne=="function"&&Ne.prototype||$e;return Se===Ze}function oc(Se){var Ne=[];if(Se!=null)for(var Ze in Object(Se))Ne.push(Ze);return Ne}function Df(Se){return dn.call(Se)}function Ml(Se,Ne,Ze){return Ne=so(Ne===void 0?Se.length-1:Ne,0),function(){for(var Kt=arguments,Kn=-1,mr=so(Kt.length-Ne,0),Fr=Array(mr);++Kn<mr;)Fr[Kn]=Kt[Ne+Kn];Kn=-1;for(var cn=Array(Ne+1);++Kn<Ne;)cn[Kn]=Kt[Kn];return cn[Ne]=Ze(Fr),ln(Se,this,cn)}}function xd(Se,Ne){if(!(Ne==="constructor"&&typeof Se[Ne]=="function")&&Ne!="__proto__")return Se[Ne]}var ip=Lf(Hs);function Lf(Se){var Ne=0,Ze=0;return function(){var Kt=oo(),Kn=d-(Kt-Ze);if(Ze=Kt,Kn>0){if(++Ne>=l)return arguments[0]}else Ne=0;return Se.apply(void 0,arguments)}}function sp(Se){if(Se!=null){try{return Et.call(Se)}catch{}try{return Se+""}catch{}}return""}function Co(Se,Ne){return Se===Ne||Se!==Se&&Ne!==Ne}var Yi=el(function(){return arguments}())?el:function(Se){return is(Se)&&yt.call(Se,"callee")&&!Ns.call(Se,"callee")},Io=Array.isArray;function Ao(Se){return Se!=null&&xf(Se.length)&&!Oo(Se)}function Ul(Se){return is(Se)&&Ao(Se)}var Po=Jc||il;function Oo(Se){if(!ac(Se))return!1;var Ne=sc(Se);return Ne==F||Ne==j||Ne==T||Ne==Q}function xf(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=f}function ac(Se){var Ne=typeof Se;return Se!=null&&(Ne=="object"||Ne=="function")}function is(Se){return Se!=null&&typeof Se=="object"}function Nu(Se){if(!is(Se)||sc(Se)!=K)return!1;var Ne=an(Se);if(Ne===null)return!0;var Ze=yt.call(Ne,"constructor")&&Ne.constructor;return typeof Ze=="function"&&Ze instanceof Ze&&Et.call(Ze)==hn}var op=Vt?Xt(Vt):np;function rl(Se){return ur(Se,Vl(Se))}function Vl(Se){return Ao(Se)?Od(Se):Nd(Se)}var Mf=Dl(function(Se,Ne,Ze,Kt){Nl(Se,Ne,Ze,Kt)});function sa(Se){return function(){return Se}}function oa(Se){return Se}function il(){return!1}r.exports=Mf}(sw,sw.exports)),sw.exports}var I_e=C_e();const Nh=a0(I_e);function Bc(r,t=[]){const s=L.useRef(r);return L.useEffect(()=>{s.current=r}),L.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function TS(r,t,s,a){const l=Bc(s);return L.useEffect(()=>{const d=typeof r=="function"?r():r??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,r,a,l,s]),()=>{const d=typeof r=="function"?r():r??document;d==null||d.removeEventListener(t,l,a)}}function AJ(r){const{isOpen:t,ref:s}=r,[a,l]=L.useState(t),[d,f]=L.useState(!1);return L.useEffect(()=>{d||(l(t),f(!0))},[t,d,a]),TS(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var w;const v=Kge(s.current),T=new v.CustomEvent("animationend",{bubbles:!0});(w=s.current)==null||w.dispatchEvent(T)}}}function PJ(r){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(N,F)=>N!==F}=r,d=Bc(a),f=Bc(l),[E,v]=L.useState(s),T=t!==void 0,w=T?t:E,I=Bc(N=>{const j=typeof N=="function"?N(w):N;f(w,j)&&(T||v(j),d(j))},[T,d,w,f]);return[w,I]}function ag(r={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=r,d=Bc(s),f=Bc(t),[E,v]=L.useState(r.defaultIsOpen||!1),T=a!==void 0?a:E,w=a!==void 0,I=L.useId(),N=l??`disclosure-${I}`,F=L.useCallback(()=>{w||v(!1),f==null||f()},[w,f]),j=L.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),G=L.useCallback(()=>{T?F():j()},[T,j,F]);function H(K={}){return{...K,"aria-expanded":T,"aria-controls":N,onClick(Q){var de;(de=K.onClick)==null||de.call(K,Q),G()}}}function te(K={}){return{...K,hidden:!T,id:N}}return{isOpen:T,onOpen:j,onClose:F,onToggle:G,isControlled:w,getButtonProps:H,getDisclosureProps:te}}const hf=globalThis!=null&&globalThis.document?L.useLayoutEffect:L.useEffect,cg=(r,t)=>{const s=L.useRef(!1),a=L.useRef(!1);L.useEffect(()=>{if(s.current&&a.current)return r();a.current=!0},t),L.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function A_e(r){const t=r.current;if(!t)return!1;const s=Yge(t);return!s||t.contains(s)?!1:!!u_e(s)}function OJ(r,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;cg(()=>{if(!d||A_e(r))return;const f=(l==null?void 0:l.current)||r.current;let E;if(f)return E=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,r,l])}const P_e={preventScroll:!0,shouldFocus:!1};function O_e(r,t=P_e){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,f=k_e(r)?r.current:r,E=l&&d,v=L.useRef(E),T=L.useRef(d);hf(()=>{!T.current&&d&&(v.current=E),T.current=d},[d,E]);const w=L.useCallback(()=>{if(!(!d||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var I;(I=s.current)==null||I.focus({preventScroll:a})});else{const I=wJ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[d,a,f,s]);cg(()=>{w()},[w]),TS(f,"transitionend",w)}function k_e(r){return"current"in r}function N_e(r){return"current"in r}const kJ=()=>typeof window<"u";function D_e(){const r=navigator.userAgentData;return(r==null?void 0:r.platform)??navigator.platform}const L_e=r=>kJ()&&r.test(navigator.vendor),x_e=r=>kJ()&&r.test(D_e()),M_e=()=>x_e(/mac|iphone|ipad|ipod/i),U_e=()=>M_e()&&L_e(/apple/i);function V_e(r){const{ref:t,elements:s,enabled:a}=r,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};TS(l,"pointerdown",d=>{var T,w;if(!U_e()||!a)return;const f=((w=(T=d.composedPath)==null?void 0:T.call(d))==null?void 0:w[0])??d.target,v=(s??[t]).some(I=>{const N=N_e(I)?I.current:I;return(N==null?void 0:N.contains(f))||N===f});l().activeElement!==f&&v&&(d.preventDefault(),f.focus())})}function F_e(r,t){const s=L.useId();return L.useMemo(()=>r||[t,s].filter(Boolean).join("-"),[r,t,s])}function j_e(r,...t){const s=F_e(r);return L.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function NJ(r){const t=L.useRef(null);return t.current=r,t}function B_e(r,t){if(r!=null){if(typeof r=="function"){r(t);return}try{r.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${r}'`)}}}function Hi(...r){return t=>{r.forEach(s=>{B_e(s,t)})}}function W_e(...r){return L.useMemo(()=>Hi(...r),r)}function DJ(r){const{ref:t,handler:s,enabled:a=!0}=r,l=Bc(s),f=L.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;L.useEffect(()=>{if(!a)return;const E=I=>{cM(I,t)&&(f.isPointerDown=!0)},v=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&s&&cM(I,t)&&(f.isPointerDown=!1,l(I))},T=I=>{f.ignoreEmulatedMouseEvents=!0,s&&f.isPointerDown&&cM(I,t)&&(f.isPointerDown=!1,l(I))},w=LJ(t.current);return w.addEventListener("mousedown",E,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",E,!0),w.addEventListener("touchend",T,!0),()=>{w.removeEventListener("mousedown",E,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",E,!0),w.removeEventListener("touchend",T,!0)}},[s,t,l,f,a])}function cM(r,t){var a,l;const s=((a=r.composedPath)==null?void 0:a.call(r)[0])??r.target;return s&&!LJ(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function LJ(r){return(r==null?void 0:r.ownerDocument)??document}function z_e(r,t){const s=Bc(r);L.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const xJ=1/60*1e3,G_e=typeof performance<"u"?()=>performance.now():()=>Date.now(),MJ=typeof window<"u"?r=>window.requestAnimationFrame(r):r=>setTimeout(()=>r(G_e()),xJ);function H_e(r){let t=[],s=[],a=0,l=!1,d=!1;const f=new WeakSet,E={schedule:(v,T=!1,w=!1)=>{const I=w&&l,N=I?t:s;return T&&f.add(v),N.indexOf(v)===-1&&(N.push(v),I&&l&&(a=t.length)),v},cancel:v=>{const T=s.indexOf(v);T!==-1&&s.splice(T,1),f.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let T=0;T<a;T++){const w=t[T];w(v),f.has(w)&&(E.schedule(w),r())}l=!1,d&&(d=!1,E.process(v))}};return E}const $_e=40;let I2=!0,Ww=!1,A2=!1;const bS={delta:0,timestamp:0},ER=["read","update","preRender","render","postRender"],Mk=ER.reduce((r,t)=>(r[t]=H_e(()=>Ww=!0),r),{}),K_e=ER.reduce((r,t)=>{const s=Mk[t];return r[t]=(a,l=!1,d=!1)=>(Ww||X_e(),s.schedule(a,l,d)),r},{}),q_e=ER.reduce((r,t)=>(r[t]=Mk[t].cancel,r),{});ER.reduce((r,t)=>(r[t]=()=>Mk[t].process(bS),r),{});const Y_e=r=>Mk[r].process(bS),UJ=r=>{Ww=!1,bS.delta=I2?xJ:Math.max(Math.min(r-bS.timestamp,$_e),1),bS.timestamp=r,A2=!0,ER.forEach(Y_e),A2=!1,Ww&&(I2=!1,MJ(UJ))},X_e=()=>{Ww=!0,I2=!0,A2||MJ(UJ)},s$=()=>bS;var J_e=Object.defineProperty,Q_e=(r,t,s)=>t in r?J_e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,pd=(r,t,s)=>(Q_e(r,typeof t!="symbol"?t+"":t,s),s);class Z_e{constructor(t,s,a){if(pd(this,"history",[]),pd(this,"startEvent",null),pd(this,"lastEvent",null),pd(this,"lastEventInfo",null),pd(this,"handlers",{}),pd(this,"removeListeners",()=>{}),pd(this,"threshold",3),pd(this,"win"),pd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=lM(this.lastEventInfo,this.history),v=this.startEvent!==null,T=rEe(E.offset,{x:0,y:0})>=this.threshold;if(!v&&!T)return;const{timestamp:w}=s$();this.history.push({...E.point,timestamp:w});const{onStart:I,onMove:N}=this.handlers;v||(I==null||I(this.lastEvent,E),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,E)}),pd(this,"onPointerMove",(E,v)=>{this.lastEvent=E,this.lastEventInfo=v,K_e.update(this.updatePoint,!0)}),pd(this,"onPointerUp",(E,v)=>{const T=lM(v,this.history),{onEnd:w,onSessionEnd:I}=this.handlers;I==null||I(E,T),this.end(),!(!w||!this.startEvent)&&(w==null||w(E,T))}),this.win=t.view??window,Jge(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:vJ(t)},{timestamp:d}=s$();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=s;f==null||f(t,lM(l,this.history)),this.removeListeners=nEe(dO(this.win,"pointermove",this.onPointerMove),dO(this.win,"pointerup",this.onPointerUp),dO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),q_e.update(this.updatePoint)}}function o$(r,t){return{x:r.x-t.x,y:r.y-t.y}}function lM(r,t){return{point:r.point,delta:o$(r.point,t[t.length-1]),offset:o$(r.point,t[0]),velocity:tEe(t,.1)}}const eEe=r=>r*1e3;function tEe(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=r[r.length-1];for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>eEe(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function nEe(...r){return t=>r.reduce((s,a)=>a(s),t)}function uM(r,t){return Math.abs(r-t)}function a$(r){return"x"in r&&"y"in r}function rEe(r,t){if(typeof r=="number"&&typeof t=="number")return uM(r,t);if(a$(r)&&a$(t)){const s=uM(r.x,t.x),a=uM(r.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function iEe(r,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:E}=t,v=!!(s||a||l||d||f),T=L.useRef(null),w=NJ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:s,onEnd(I,N){T.current=null,l==null||l(I,N)}});L.useEffect(()=>{var I;(I=T.current)==null||I.updateHandlers(w.current)}),L.useEffect(()=>{const I=r.current;if(!I||!v)return;function N(F){T.current=new Z_e(F,w.current,E)}return dO(I,"pointerdown",N)},[r,v,w,E]),L.useEffect(()=>()=>{var I;(I=T.current)==null||I.end(),T.current=null},[])}const eo={open:(r,t)=>`${r}[data-open], ${r}[open], ${r}[data-state=open] ${t}`,closed:(r,t)=>`${r}[data-closed], ${r}[data-state=closed] ${t}`,hover:(r,t)=>`${r}:hover ${t}, ${r}[data-hover] ${t}`,focus:(r,t)=>`${r}:focus ${t}, ${r}[data-focus] ${t}`,focusVisible:(r,t)=>`${r}:focus-visible ${t}`,focusWithin:(r,t)=>`${r}:focus-within ${t}`,active:(r,t)=>`${r}:active ${t}, ${r}[data-active] ${t}`,disabled:(r,t)=>`${r}:disabled ${t}, ${r}[data-disabled] ${t}`,invalid:(r,t)=>`${r}:invalid ${t}, ${r}[data-invalid] ${t}`,checked:(r,t)=>`${r}:checked ${t}, ${r}[data-checked] ${t}`,placeholderShown:(r,t)=>`${r}:placeholder-shown ${t}`},Sh=r=>VJ(t=>r(t,"&"),"[role=group]","[data-group]",".group"),Jp=r=>VJ(t=>r(t,"~ &"),"[data-peer]",".peer"),VJ=(r,...t)=>t.map(r).join(", "),wS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Sh(eo.open),_groupClosed:Sh(eo.closed),_groupHover:Sh(eo.hover),_peerHover:Jp(eo.hover),_groupFocus:Sh(eo.focus),_peerFocus:Jp(eo.focus),_groupFocusVisible:Sh(eo.focusVisible),_peerFocusVisible:Jp(eo.focusVisible),_groupActive:Sh(eo.active),_peerActive:Jp(eo.active),_groupDisabled:Sh(eo.disabled),_peerDisabled:Jp(eo.disabled),_groupInvalid:Sh(eo.invalid),_peerInvalid:Jp(eo.invalid),_groupChecked:Sh(eo.checked),_peerChecked:Jp(eo.checked),_groupFocusWithin:Sh(eo.focusWithin),_peerFocusWithin:Jp(eo.focusWithin),_peerPlaceholderShown:Jp(eo.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},FJ=Object.keys(wS),sEe=r=>/!(important)?$/.test(r),c$=r=>typeof r=="string"?r.replace(/!(important)?$/,"").trim():r,oEe=(r,t)=>s=>{const a=String(t),l=sEe(a),d=c$(a),f=r?`${r}.${d}`:d;let E=Eu(s.__cssMap)&&f in s.__cssMap?s.__cssMap[f].varRef:t;return E=c$(E),l?`${E} !important`:E};function dV(r){const{scale:t,transform:s,compose:a}=r;return(d,f)=>{const E=oEe(t,d)(f);let v=(s==null?void 0:s(E,f))??E;return a&&(v=a(v,f)),v}}const xP=(...r)=>t=>r.reduce((s,a)=>a(s),t);function pu(r,t){return s=>{const a={property:s,scale:r};return a.transform=dV({scale:r,transform:t}),a}}const aEe=({rtl:r,ltr:t})=>s=>s.direction==="rtl"?r:t;function cEe(r){const{property:t,scale:s,transform:a}=r;return{scale:s,property:aEe(t),transform:s?dV({scale:s,compose:a}):a}}const jJ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function lEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...jJ].join(" ")}function uEe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...jJ].join(" ")}const dEe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},hEe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function pEe(r){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":r,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const fEe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},P2={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},mEe=new Set(Object.values(P2)),O2=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),gEe=r=>r.trim();function _Ee(r,t){if(r==null||O2.has(r))return r;if(!(k2(r)||O2.has(r)))return`url('${r}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(r),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return r;const E=d.includes("-gradient")?d:`${d}-gradient`,[v,...T]=f.split(",").map(gEe).filter(Boolean);if((T==null?void 0:T.length)===0)return r;const w=v in P2?P2[v]:v;T.unshift(w);const I=T.map(N=>{if(mEe.has(N))return N;const F=N.indexOf(" "),[j,G]=F!==-1?[N.substr(0,F),N.substr(F+1)]:[N],H=k2(G)?G:G&&G.split(" "),te=`colors.${j}`,K=te in t.__cssMap?t.__cssMap[te].varRef:j;return H?[K,...Array.isArray(H)?H:[H]].join(" "):K});return`${E}(${I.join(", ")})`}const k2=r=>typeof r=="string"&&r.includes("(")&&r.includes(")"),EEe=(r,t)=>_Ee(r,t??{});function yEe(r){return/^var\(--.+\)$/.test(r)}const vEe=r=>{const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},Th=r=>t=>`${r}(${t})`,Rr={filter(r){return r!=="auto"?r:dEe},backdropFilter(r){return r!=="auto"?r:hEe},ring(r){return pEe(Rr.px(r))},bgClip(r){return r==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:r}},transform(r){return r==="auto"?lEe():r==="auto-gpu"?uEe():r},vh(r){return r==="$100vh"?"var(--chakra-vh)":r},px(r){if(r==null)return r;const{unitless:t}=vEe(r);return t||typeof r=="number"?`${r}px`:r},fraction(r){return typeof r!="number"||r>1?r:`${r*100}%`},float(r,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[r]:r},degree(r){if(yEe(r)||r==null)return r;const t=typeof r=="string"&&!r.endsWith("deg");return typeof r=="number"||t?`${r}deg`:r},gradient:EEe,blur:Th("blur"),opacity:Th("opacity"),brightness:Th("brightness"),contrast:Th("contrast"),dropShadow:Th("drop-shadow"),grayscale:Th("grayscale"),hueRotate:r=>Th("hue-rotate")(Rr.degree(r)),invert:Th("invert"),saturate:Th("saturate"),sepia:Th("sepia"),bgImage(r){return r==null||k2(r)||O2.has(r)?r:`url(${r})`},outline(r){const t=String(r)==="0"||String(r)==="none";return r!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:r}},flexDirection(r){const{space:t,divide:s}=fEe[r]??{},a={flexDirection:r};return t&&(a[t]=1),s&&(a[s]=1),a}},je={borderWidths:pu("borderWidths"),borderStyles:pu("borderStyles"),colors:pu("colors"),borders:pu("borders"),gradients:pu("gradients",Rr.gradient),radii:pu("radii",Rr.px),space:pu("space",xP(Rr.vh,Rr.px)),spaceT:pu("space",xP(Rr.vh,Rr.px)),degreeT(r){return{property:r,transform:Rr.degree}},prop(r,t,s){return{property:r,scale:t,...t&&{transform:dV({scale:t,transform:s})}}},propT(r,t){return{property:r,transform:t}},sizes:pu("sizes",xP(Rr.vh,Rr.px)),sizesT:pu("sizes",xP(Rr.vh,Rr.fraction)),shadows:pu("shadows"),logical:cEe,blur:pu("blur",Rr.blur)},hO={background:je.colors("background"),backgroundColor:je.colors("backgroundColor"),backgroundImage:je.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Rr.bgClip},bgSize:je.prop("backgroundSize"),bgPosition:je.prop("backgroundPosition"),bg:je.colors("background"),bgColor:je.colors("backgroundColor"),bgPos:je.prop("backgroundPosition"),bgRepeat:je.prop("backgroundRepeat"),bgAttachment:je.prop("backgroundAttachment"),bgGradient:je.gradients("backgroundImage"),bgClip:{transform:Rr.bgClip}};Object.assign(hO,{bgImage:hO.backgroundImage,bgImg:hO.backgroundImage});const Hr={border:je.borders("border"),borderWidth:je.borderWidths("borderWidth"),borderStyle:je.borderStyles("borderStyle"),borderColor:je.colors("borderColor"),borderRadius:je.radii("borderRadius"),borderTop:je.borders("borderTop"),borderBlockStart:je.borders("borderBlockStart"),borderTopLeftRadius:je.radii("borderTopLeftRadius"),borderStartStartRadius:je.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:je.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:je.radii("borderTopRightRadius"),borderStartEndRadius:je.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:je.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:je.borders("borderRight"),borderInlineEnd:je.borders("borderInlineEnd"),borderBottom:je.borders("borderBottom"),borderBlockEnd:je.borders("borderBlockEnd"),borderBottomLeftRadius:je.radii("borderBottomLeftRadius"),borderBottomRightRadius:je.radii("borderBottomRightRadius"),borderLeft:je.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:je.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:je.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:je.borders(["borderLeft","borderRight"]),borderInline:je.borders("borderInline"),borderY:je.borders(["borderTop","borderBottom"]),borderBlock:je.borders("borderBlock"),borderTopWidth:je.borderWidths("borderTopWidth"),borderBlockStartWidth:je.borderWidths("borderBlockStartWidth"),borderTopColor:je.colors("borderTopColor"),borderBlockStartColor:je.colors("borderBlockStartColor"),borderTopStyle:je.borderStyles("borderTopStyle"),borderBlockStartStyle:je.borderStyles("borderBlockStartStyle"),borderBottomWidth:je.borderWidths("borderBottomWidth"),borderBlockEndWidth:je.borderWidths("borderBlockEndWidth"),borderBottomColor:je.colors("borderBottomColor"),borderBlockEndColor:je.colors("borderBlockEndColor"),borderBottomStyle:je.borderStyles("borderBottomStyle"),borderBlockEndStyle:je.borderStyles("borderBlockEndStyle"),borderLeftWidth:je.borderWidths("borderLeftWidth"),borderInlineStartWidth:je.borderWidths("borderInlineStartWidth"),borderLeftColor:je.colors("borderLeftColor"),borderInlineStartColor:je.colors("borderInlineStartColor"),borderLeftStyle:je.borderStyles("borderLeftStyle"),borderInlineStartStyle:je.borderStyles("borderInlineStartStyle"),borderRightWidth:je.borderWidths("borderRightWidth"),borderInlineEndWidth:je.borderWidths("borderInlineEndWidth"),borderRightColor:je.colors("borderRightColor"),borderInlineEndColor:je.colors("borderInlineEndColor"),borderRightStyle:je.borderStyles("borderRightStyle"),borderInlineEndStyle:je.borderStyles("borderInlineEndStyle"),borderTopRadius:je.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:je.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:je.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:je.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Hr,{rounded:Hr.borderRadius,roundedTop:Hr.borderTopRadius,roundedTopLeft:Hr.borderTopLeftRadius,roundedTopRight:Hr.borderTopRightRadius,roundedTopStart:Hr.borderStartStartRadius,roundedTopEnd:Hr.borderStartEndRadius,roundedBottom:Hr.borderBottomRadius,roundedBottomLeft:Hr.borderBottomLeftRadius,roundedBottomRight:Hr.borderBottomRightRadius,roundedBottomStart:Hr.borderEndStartRadius,roundedBottomEnd:Hr.borderEndEndRadius,roundedLeft:Hr.borderLeftRadius,roundedRight:Hr.borderRightRadius,roundedStart:Hr.borderInlineStartRadius,roundedEnd:Hr.borderInlineEndRadius,borderStart:Hr.borderInlineStart,borderEnd:Hr.borderInlineEnd,borderTopStartRadius:Hr.borderStartStartRadius,borderTopEndRadius:Hr.borderStartEndRadius,borderBottomStartRadius:Hr.borderEndStartRadius,borderBottomEndRadius:Hr.borderEndEndRadius,borderStartRadius:Hr.borderInlineStartRadius,borderEndRadius:Hr.borderInlineEndRadius,borderStartWidth:Hr.borderInlineStartWidth,borderEndWidth:Hr.borderInlineEndWidth,borderStartColor:Hr.borderInlineStartColor,borderEndColor:Hr.borderInlineEndColor,borderStartStyle:Hr.borderInlineStartStyle,borderEndStyle:Hr.borderInlineEndStyle});const SEe={color:je.colors("color"),textColor:je.colors("color"),fill:je.colors("fill"),stroke:je.colors("stroke"),accentColor:je.colors("accentColor"),textFillColor:je.colors("textFillColor")},KO={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Rr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:je.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:je.space("gap"),rowGap:je.space("rowGap"),columnGap:je.space("columnGap")};Object.assign(KO,{flexDir:KO.flexDirection});const gu={width:je.sizesT("width"),inlineSize:je.sizesT("inlineSize"),height:je.sizes("height"),blockSize:je.sizes("blockSize"),boxSize:je.sizes(["width","height"]),minWidth:je.sizes("minWidth"),minInlineSize:je.sizes("minInlineSize"),minHeight:je.sizes("minHeight"),minBlockSize:je.sizes("minBlockSize"),maxWidth:je.sizes("maxWidth"),maxInlineSize:je.sizes("maxInlineSize"),maxHeight:je.sizes("maxHeight"),maxBlockSize:je.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(r,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(r))==null?void 0:d.minW)??r})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(r,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(r))==null?void 0:d._minW)??r})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:je.propT("float",Rr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(gu,{w:gu.width,h:gu.height,minW:gu.minWidth,maxW:gu.maxWidth,minH:gu.minHeight,maxH:gu.maxHeight,overscroll:gu.overscrollBehavior,overscrollX:gu.overscrollBehaviorX,overscrollY:gu.overscrollBehaviorY});const TEe={filter:{transform:Rr.filter},blur:je.blur("--chakra-blur"),brightness:je.propT("--chakra-brightness",Rr.brightness),contrast:je.propT("--chakra-contrast",Rr.contrast),hueRotate:je.propT("--chakra-hue-rotate",Rr.hueRotate),invert:je.propT("--chakra-invert",Rr.invert),saturate:je.propT("--chakra-saturate",Rr.saturate),dropShadow:je.propT("--chakra-drop-shadow",Rr.dropShadow),backdropFilter:{transform:Rr.backdropFilter},backdropBlur:je.blur("--chakra-backdrop-blur"),backdropBrightness:je.propT("--chakra-backdrop-brightness",Rr.brightness),backdropContrast:je.propT("--chakra-backdrop-contrast",Rr.contrast),backdropHueRotate:je.propT("--chakra-backdrop-hue-rotate",Rr.hueRotate),backdropInvert:je.propT("--chakra-backdrop-invert",Rr.invert),backdropSaturate:je.propT("--chakra-backdrop-saturate",Rr.saturate)},bEe={ring:{transform:Rr.ring},ringColor:je.colors("--chakra-ring-color"),ringOffset:je.prop("--chakra-ring-offset-width"),ringOffsetColor:je.colors("--chakra-ring-offset-color"),ringInset:je.prop("--chakra-ring-inset")},wEe={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Rr.outline},outlineOffset:!0,outlineColor:je.colors("outlineColor")},BJ={gridGap:je.space("gridGap"),gridColumnGap:je.space("gridColumnGap"),gridRowGap:je.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function REe(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}const CEe=r=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=r(a,l,d,f);return E.set(l,v),v}},IEe=CEe(REe),AEe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},PEe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},dM=(r,t,s)=>{const a={},l=IEe(r,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},OEe={srOnly:{transform(r){return r===!0?AEe:r==="focusable"?PEe:{}}},layerStyle:{processResult:!0,transform:(r,t,s)=>dM(t,`layerStyles.${r}`,s)},textStyle:{processResult:!0,transform:(r,t,s)=>dM(t,`textStyles.${r}`,s)},apply:{processResult:!0,transform:(r,t,s)=>dM(t,r,s)}},Tw={position:!0,pos:je.prop("position"),zIndex:je.prop("zIndex","zIndices"),inset:je.spaceT("inset"),insetX:je.spaceT(["left","right"]),insetInline:je.spaceT("insetInline"),insetY:je.spaceT(["top","bottom"]),insetBlock:je.spaceT("insetBlock"),top:je.spaceT("top"),insetBlockStart:je.spaceT("insetBlockStart"),bottom:je.spaceT("bottom"),insetBlockEnd:je.spaceT("insetBlockEnd"),left:je.spaceT("left"),insetInlineStart:je.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:je.spaceT("right"),insetInlineEnd:je.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Tw,{insetStart:Tw.insetInlineStart,insetEnd:Tw.insetInlineEnd});const N2={boxShadow:je.shadows("boxShadow"),mixBlendMode:!0,blendMode:je.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:je.prop("backgroundBlendMode"),opacity:!0};Object.assign(N2,{shadow:N2.boxShadow});const Li={margin:je.spaceT("margin"),marginTop:je.spaceT("marginTop"),marginBlockStart:je.spaceT("marginBlockStart"),marginRight:je.spaceT("marginRight"),marginInlineEnd:je.spaceT("marginInlineEnd"),marginBottom:je.spaceT("marginBottom"),marginBlockEnd:je.spaceT("marginBlockEnd"),marginLeft:je.spaceT("marginLeft"),marginInlineStart:je.spaceT("marginInlineStart"),marginX:je.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:je.spaceT("marginInline"),marginY:je.spaceT(["marginTop","marginBottom"]),marginBlock:je.spaceT("marginBlock"),padding:je.space("padding"),paddingTop:je.space("paddingTop"),paddingBlockStart:je.space("paddingBlockStart"),paddingRight:je.space("paddingRight"),paddingBottom:je.space("paddingBottom"),paddingBlockEnd:je.space("paddingBlockEnd"),paddingLeft:je.space("paddingLeft"),paddingInlineStart:je.space("paddingInlineStart"),paddingInlineEnd:je.space("paddingInlineEnd"),paddingX:je.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:je.space("paddingInline"),paddingY:je.space(["paddingTop","paddingBottom"]),paddingBlock:je.space("paddingBlock")};Object.assign(Li,{m:Li.margin,mt:Li.marginTop,mr:Li.marginRight,me:Li.marginInlineEnd,marginEnd:Li.marginInlineEnd,mb:Li.marginBottom,ml:Li.marginLeft,ms:Li.marginInlineStart,marginStart:Li.marginInlineStart,mx:Li.marginX,my:Li.marginY,p:Li.padding,pt:Li.paddingTop,py:Li.paddingY,px:Li.paddingX,pb:Li.paddingBottom,pl:Li.paddingLeft,ps:Li.paddingInlineStart,paddingStart:Li.paddingInlineStart,pr:Li.paddingRight,pe:Li.paddingInlineEnd,paddingEnd:Li.paddingInlineEnd});const kEe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:je.spaceT("scrollMargin"),scrollMarginTop:je.spaceT("scrollMarginTop"),scrollMarginBottom:je.spaceT("scrollMarginBottom"),scrollMarginLeft:je.spaceT("scrollMarginLeft"),scrollMarginRight:je.spaceT("scrollMarginRight"),scrollMarginX:je.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:je.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:je.spaceT("scrollPadding"),scrollPaddingTop:je.spaceT("scrollPaddingTop"),scrollPaddingBottom:je.spaceT("scrollPaddingBottom"),scrollPaddingLeft:je.spaceT("scrollPaddingLeft"),scrollPaddingRight:je.spaceT("scrollPaddingRight"),scrollPaddingX:je.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:je.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},NEe={fontFamily:je.prop("fontFamily","fonts"),fontSize:je.prop("fontSize","fontSizes",Rr.px),fontWeight:je.prop("fontWeight","fontWeights"),lineHeight:je.prop("lineHeight","lineHeights"),letterSpacing:je.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(r){if(r===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},DEe={textDecorationColor:je.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:je.shadows("textShadow")},LEe={clipPath:!0,transform:je.propT("transform",Rr.transform),transformOrigin:!0,translateX:je.spaceT("--chakra-translate-x"),translateY:je.spaceT("--chakra-translate-y"),skewX:je.degreeT("--chakra-skew-x"),skewY:je.degreeT("--chakra-skew-y"),scaleX:je.prop("--chakra-scale-x"),scaleY:je.prop("--chakra-scale-y"),scale:je.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:je.degreeT("--chakra-rotate")},xEe={listStyleType:!0,listStylePosition:!0,listStylePos:je.prop("listStylePosition"),listStyleImage:!0,listStyleImg:je.prop("listStyleImage")},MEe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:je.prop("transitionDuration","transition.duration"),transitionProperty:je.prop("transitionProperty","transition.property"),transitionTimingFunction:je.prop("transitionTimingFunction","transition.easing")},hV=Nh({},hO,Hr,SEe,KO,gu,TEe,bEe,wEe,BJ,OEe,Tw,N2,Li,kEe,NEe,DEe,LEe,xEe,MEe),UEe=Object.assign({},Li,gu,KO,BJ,Tw),VEe=Object.keys(UEe),FEe=[...Object.keys(hV),...FJ],jEe={...hV,...wS},BEe=r=>r in jEe,WEe=r=>t=>{if(!t.__breakpoints)return r;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const f in r){let E=jc(r[f],t);if(E==null)continue;if(E=Eu(E)&&s(E)?a(E):E,!Array.isArray(E)){d[f]=E;continue}const v=E.slice(0,l.length).length;for(let T=0;T<v;T+=1){const w=l==null?void 0:l[T];if(!w){d[f]=E[T];continue}d[w]=d[w]||{},E[T]!=null&&(d[w][f]=E[T])}}return d};function zEe(r){const t=[];let s="",a=!1;for(let l=0;l<r.length;l++){const d=r[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function GEe(r){return/^var\(--.+\)$/.test(r)}const HEe=(r,t)=>r.startsWith("--")&&typeof t=="string"&&!GEe(t),$Ee=(r,t)=>{if(t==null)return t;const s=f=>{var E,v;return(v=(E=r.__cssMap)==null?void 0:E[f])==null?void 0:v.varRef},a=f=>s(f)??f,[l,d]=zEe(t);return t=s(l)??a(d)??a(t),t};function KEe(r){const{configs:t={},pseudos:s={},theme:a}=r,l=(d,f=!1)=>{var w;const E=jc(d,a),v=WEe(E)(a);let T={};for(let I in v){const N=v[I];let F=jc(N,a);I in s&&(I=s[I]),HEe(I,F)&&(F=$Ee(a,F));let j=t[I];if(j===!0&&(j={property:I}),Eu(F)){T[I]=T[I]??{},T[I]=Nh({},T[I],l(F,!0));continue}let G=((w=j==null?void 0:j.transform)==null?void 0:w.call(j,F,a,E))??F;G=j!=null&&j.processResult?l(G,!0):G;const H=jc(j==null?void 0:j.property,a);if(!f&&(j!=null&&j.static)){const te=jc(j.static,a);T=Nh({},T,te)}if(H&&Array.isArray(H)){for(const te of H)T[te]=G;continue}if(H){H==="&"&&Eu(G)?T=Nh({},T,G):T[H]=G;continue}if(Eu(G)){T=Nh({},T,G);continue}T[I]=G}return T};return l}const WJ=r=>t=>KEe({theme:t,pseudos:wS,configs:hV})(r);function u6e(r){return r}function d6e(r){return r}function Ri(r){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:r,...t}}}}function qEe(r,t,s){var a,l;return((l=(a=r.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function YEe(r,t){if(Array.isArray(r))return r;if(Eu(r))return t(r);if(r!=null)return[r]}function XEe(r,t){for(let s=t+1;s<r.length;s++)if(r[s]!=null)return s;return-1}function JEe(r){const t=r.__breakpoints;return function(a,l,d,f){var N,F;if(!t)return;const E={},v=YEe(d,t.toArrayValue);if(!v)return E;const T=v.length,w=T===1,I=!!a.parts;for(let j=0;j<T;j++){const G=t.details[j],H=t.details[XEe(v,j)],te=iw(G.minW,H==null?void 0:H._minW),K=jc((N=a[l])==null?void 0:N[v[j]],f);if(K){if(I){(F=a.parts)==null||F.forEach(Q=>{Nh(E,{[Q]:w?K[Q]:{[te]:K[Q]}})});continue}if(!I){w?Nh(E,K):E[te]=K;continue}E[te]=K}}return E}}function QEe(r){return t=>{const{variant:s,size:a,theme:l}=t,d=JEe(l);return Nh({},jc(r.baseStyle??{},t),d(r,"sizes",a,t),d(r,"variants",s,t))}}function ns(r){return _R(r,["styleConfig","size","variant","colorScheme"])}function zJ(r){return Eu(r)&&r.reference?r.reference:String(r)}const Uk=(r,...t)=>t.map(zJ).join(` ${r} `).replace(/calc/g,""),l$=(...r)=>`calc(${Uk("+",...r)})`,u$=(...r)=>`calc(${Uk("-",...r)})`,D2=(...r)=>`calc(${Uk("*",...r)})`,d$=(...r)=>`calc(${Uk("/",...r)})`,h$=r=>{const t=zJ(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:D2(t,-1)},nf=Object.assign(r=>({add:(...t)=>nf(l$(r,...t)),subtract:(...t)=>nf(u$(r,...t)),multiply:(...t)=>nf(D2(r,...t)),divide:(...t)=>nf(d$(r,...t)),negate:()=>nf(h$(r)),toString:()=>r.toString()}),{add:l$,subtract:u$,multiply:D2,divide:d$,negate:h$});function ZEe(r,t="-"){return r.replace(/\s+/g,t)}function eye(r){const t=ZEe(r.toString());return nye(tye(t))}function tye(r){return r.includes("\\.")?r:!Number.isInteger(parseFloat(r.toString()))?r.replace(".","\\."):r}function nye(r){return r.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function rye(r,t=""){return[t,r].filter(Boolean).join("-")}function iye(r,t){return`var(${r}${t?`, ${t}`:""})`}function sye(r,t=""){return eye(`--${rye(r,t)}`)}function On(r,t,s){const a=sye(r,s);return{variable:a,reference:iye(a,t)}}function oye(r,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=On(`${r}-${l}`,d);continue}s[a]=On(`${r}-${a}`)}return s}const aye=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function cye(r){return CJ(r,aye)}function lye(r){return r.semanticTokens}function uye(r){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=r;return l}function dye(r){const t=cye(r),s=lye(r),a=d=>FJ.includes(d)||d==="default",l={};return r$(t,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),r$(s,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function p$(r,t){return On(String(r).replace(/\./g,"-"),void 0,t)}function hye(r){var f;const t=dye(r),s=(f=r.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(E,v){const w=[String(E).split(".")[0],v].join(".");if(!t[w])return v;const{reference:N}=p$(w,s);return N}for(const[E,v]of Object.entries(t)){const{isSemantic:T,value:w}=v,{variable:I,reference:N}=p$(E,s);if(!T){if(E.startsWith("space")){const j=E.split("."),[G,...H]=j,te=`${G}.-${H.join(".")}`,K=nf.negate(w),Q=nf.negate(N);l[te]={value:K,var:I,varRef:Q}}a[I]=w,l[E]={value:w,var:I,varRef:N};continue}const F=Eu(w)?w:{default:w};a=Nh(a,Object.entries(F).reduce((j,[G,H])=>{if(!H)return j;const te=d(E,`${H}`);if(G==="default")return j[I]=te,j;const K=(wS==null?void 0:wS[G])??G;return j[K]={[I]:te},j},{})),l[E]={value:N,var:I,varRef:N}}return{cssVars:a,cssMap:l}}function pye(r){const t=uye(r),{cssMap:s,cssVars:a}=hye(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:a_e(t.breakpoints)}),t}function Yr(r,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const I of w)t[I]=v(I);return Yr(r,t)}function d(...w){for(const I of w)I in t||(t[I]=v(I));return Yr(r,t)}function f(){return Object.fromEntries(Object.entries(t).map(([I,N])=>[I,N.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([I,N])=>[I,N.className]))}function v(w){const F=`chakra-${(["container","root"].includes(w??"")?[r]:[r,w]).filter(Boolean).join("__")}`;return{className:F,selector:`.${F}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:f,classnames:E,get keys(){return Object.keys(t)},__type:{}}}const fye=Yr("accordion").parts("root","container","button","panel","icon"),mye=Yr("alert").parts("title","description","container","icon","spinner"),gye=Yr("avatar").parts("label","badge","container","excessLabel","group"),_ye=Yr("breadcrumb").parts("link","item","container","separator");Yr("button").parts();const Eye=Yr("checkbox").parts("control","icon","container","label");Yr("progress").parts("track","filledTrack","label");const yye=Yr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),vye=Yr("editable").parts("preview","input","textarea"),Sye=Yr("form").parts("container","requiredIndicator","helperText"),Tye=Yr("formError").parts("text","icon"),bye=Yr("input").parts("addon","field","element","group"),wye=Yr("list").parts("container","item","icon"),Rye=Yr("menu").parts("button","list","item","groupTitle","icon","command","divider"),Cye=Yr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Iye=Yr("numberinput").parts("root","field","stepperGroup","stepper");Yr("pininput").parts("field");const Aye=Yr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),Pye=Yr("progress").parts("label","filledTrack","track"),Oye=Yr("radio").parts("container","control","label"),kye=Yr("select").parts("field","icon"),Nye=Yr("slider").parts("container","track","thumb","filledTrack","mark"),Dye=Yr("stat").parts("container","label","helpText","number","icon"),Lye=Yr("switch").parts("container","track","thumb","label"),xye=Yr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Mye=Yr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),Uye=Yr("tag").parts("container","label","closeButton"),Vye=Yr("card").parts("container","header","body","footer");Yr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:Fye,defineMultiStyleConfig:jye}=Ri(fye.keys),Bye={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},Wye={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},zye={pt:"2",px:"4",pb:"5"},Gye={fontSize:"1.25em"},Hye=Fye({container:Bye,button:Wye,panel:zye,icon:Gye}),$ye=jye({baseStyle:Hye});function eE(r,t,s){return Math.min(Math.max(r,s),t)}class Kye extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var ow=Kye;function pV(r){if(typeof r!="string")throw new ow(r);if(r.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=r.trim();t=tve.test(r)?Xye(r):r;const s=Jye.exec(t);if(s){const f=Array.from(s).slice(1);return[...f.slice(0,3).map(E=>parseInt(zw(E,2),16)),parseInt(zw(f[3]||"f",2),16)/255]}const a=Qye.exec(t);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(E=>parseInt(E,16)),parseInt(f[3]||"ff",16)/255]}const l=Zye.exec(t);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(E=>parseInt(E,10)),parseFloat(f[3]||"1")]}const d=eve.exec(t);if(d){const[f,E,v,T]=Array.from(d).slice(1).map(parseFloat);if(eE(0,100,E)!==E)throw new ow(r);if(eE(0,100,v)!==v)throw new ow(r);return[...nve(f,E,v),Number.isNaN(T)?1:T]}throw new ow(r)}function qye(r){let t=5381,s=r.length;for(;s;)t=t*33^r.charCodeAt(--s);return(t>>>0)%2341}const f$=r=>parseInt(r.replace(/_/g,""),36),Yye="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((r,t)=>{const s=f$(t.substring(0,3)),a=f$(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return r[s]=`${l}${a}`,r},{});function Xye(r){const t=r.toLowerCase().trim(),s=Yye[qye(t)];if(!s)throw new ow(r);return`#${s}`}const zw=(r,t)=>Array.from(Array(t)).map(()=>r).join(""),Jye=new RegExp(`^#${zw("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Qye=new RegExp(`^#${zw("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Zye=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${zw(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),eve=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,tve=/^[a-z]+$/i,m$=r=>Math.round(r*255),nve=(r,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(m$);const l=(r%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),f=d*(1-Math.abs(l%2-1));let E=0,v=0,T=0;l>=0&&l<1?(E=d,v=f):l>=1&&l<2?(E=f,v=d):l>=2&&l<3?(v=d,T=f):l>=3&&l<4?(v=f,T=d):l>=4&&l<5?(E=f,T=d):l>=5&&l<6&&(E=d,T=f);const w=a-d/2,I=E+w,N=v+w,F=T+w;return[I,N,F].map(m$)};function rve(r,t,s,a){return`rgba(${eE(0,255,r).toFixed()}, ${eE(0,255,t).toFixed()}, ${eE(0,255,s).toFixed()}, ${parseFloat(eE(0,1,a).toFixed(3))})`}function ive(r,t){const[s,a,l,d]=pV(r);return rve(s,a,l,d-t)}function sve(r){const[t,s,a,l]=pV(r);let d=f=>{const E=eE(0,255,f).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const ove=r=>Object.keys(r).length===0;function ave(r,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)r=r?r[t[a]]:l;return r===l?s:r}const Ja=(r,t,s)=>{const a=ave(r,`colors.${t}`,t);try{return sve(a),a}catch{return s??"#000000"}},cve=r=>{const[t,s,a]=pV(r);return(t*299+s*587+a*114)/1e3},lve=r=>t=>{const s=Ja(t,r);return cve(s)<128?"dark":"light"},uve=r=>t=>lve(r)(t)==="dark",VS=(r,t)=>s=>{const a=Ja(s,r);return ive(a,1-t)};function g$(r="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${r} ${r}`}}const dve=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function hve(r){const t=dve();return!r||ove(r)?t:r.string&&r.colors?fve(r.string,r.colors):r.string&&!r.colors?pve(r.string):r.colors&&!r.string?mve(r.colors):t}function pve(r){let t=0;if(r.length===0)return t.toString();for(let a=0;a<r.length;a+=1)t=r.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function fve(r,t){let s=0;if(r.length===0)return t[0];for(let a=0;a<r.length;a+=1)s=r.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function mve(r){return r[Math.floor(Math.random()*r.length)]}function Pn(r,t){return s=>s.colorMode==="dark"?t:r}function fV(r){const{orientation:t,vertical:s,horizontal:a}=r;return t?t==="vertical"?s:a:{}}function GJ(r){return Eu(r)&&r.reference?r.reference:String(r)}const Vk=(r,...t)=>t.map(GJ).join(` ${r} `).replace(/calc/g,""),_$=(...r)=>`calc(${Vk("+",...r)})`,E$=(...r)=>`calc(${Vk("-",...r)})`,L2=(...r)=>`calc(${Vk("*",...r)})`,y$=(...r)=>`calc(${Vk("/",...r)})`,v$=r=>{const t=GJ(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:L2(t,-1)},rf=Object.assign(r=>({add:(...t)=>rf(_$(r,...t)),subtract:(...t)=>rf(E$(r,...t)),multiply:(...t)=>rf(L2(r,...t)),divide:(...t)=>rf(y$(r,...t)),negate:()=>rf(v$(r)),toString:()=>r.toString()}),{add:_$,subtract:E$,multiply:L2,divide:y$,negate:v$});function gve(r){return!Number.isInteger(parseFloat(r.toString()))}function _ve(r,t="-"){return r.replace(/\s+/g,t)}function HJ(r){const t=_ve(r.toString());return t.includes("\\.")?r:gve(r)?t.replace(".","\\."):r}function Eve(r,t=""){return[t,HJ(r)].filter(Boolean).join("-")}function yve(r,t){return`var(${HJ(r)}${t?`, ${t}`:""})`}function vve(r,t=""){return`--${Eve(r,t)}`}function io(r,t){const s=vve(r,t==null?void 0:t.prefix);return{variable:s,reference:yve(s,Sve(t==null?void 0:t.fallback))}}function Sve(r){return r==null?void 0:r.reference}const{definePartsStyle:yR,defineMultiStyleConfig:Tve}=Ri(mye.keys),Rl=On("alert-fg"),Ef=On("alert-bg"),bve=yR({container:{bg:Ef.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Rl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Rl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function mV(r){const{theme:t,colorScheme:s}=r,a=VS(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const wve=yR(r=>{const{colorScheme:t}=r,s=mV(r);return{container:{[Rl.variable]:`colors.${t}.600`,[Ef.variable]:s.light,_dark:{[Rl.variable]:`colors.${t}.200`,[Ef.variable]:s.dark}}}}),Rve=yR(r=>{const{colorScheme:t}=r,s=mV(r);return{container:{[Rl.variable]:`colors.${t}.600`,[Ef.variable]:s.light,_dark:{[Rl.variable]:`colors.${t}.200`,[Ef.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Rl.reference}}}),Cve=yR(r=>{const{colorScheme:t}=r,s=mV(r);return{container:{[Rl.variable]:`colors.${t}.600`,[Ef.variable]:s.light,_dark:{[Rl.variable]:`colors.${t}.200`,[Ef.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Rl.reference}}}),Ive=yR(r=>{const{colorScheme:t}=r;return{container:{[Rl.variable]:"colors.white",[Ef.variable]:`colors.${t}.600`,_dark:{[Rl.variable]:"colors.gray.900",[Ef.variable]:`colors.${t}.200`},color:Rl.reference}}}),Ave={subtle:wve,"left-accent":Rve,"top-accent":Cve,solid:Ive},Pve=Tve({baseStyle:bve,variants:Ave,defaultProps:{variant:"subtle",colorScheme:"blue"}}),$J={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},Ove={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},kve={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},KJ={...$J,...Ove,container:kve},Nve=r=>typeof r=="function";function Qa(r,...t){return Nve(r)?r(...t):r}const{definePartsStyle:qJ,defineMultiStyleConfig:Dve}=Ri(gye.keys),RS=On("avatar-border-color"),bw=On("avatar-bg"),Gw=On("avatar-font-size"),FS=On("avatar-size"),Lve={borderRadius:"full",border:"0.2em solid",borderColor:RS.reference,[RS.variable]:"white",_dark:{[RS.variable]:"colors.gray.800"}},xve={bg:bw.reference,fontSize:Gw.reference,width:FS.reference,height:FS.reference,lineHeight:"1",[bw.variable]:"colors.gray.200",_dark:{[bw.variable]:"colors.whiteAlpha.400"}},Mve=r=>{const{name:t,theme:s}=r,a=t?hve({string:t}):"colors.gray.400",l=uve(a)(s);let d="white";return l||(d="gray.800"),{bg:bw.reference,fontSize:Gw.reference,color:d,borderColor:RS.reference,verticalAlign:"top",width:FS.reference,height:FS.reference,"&:not([data-loaded])":{[bw.variable]:a},[RS.variable]:"colors.white",_dark:{[RS.variable]:"colors.gray.800"}}},Uve={fontSize:Gw.reference,lineHeight:"1"},Vve=qJ(r=>({badge:Qa(Lve,r),excessLabel:Qa(xve,r),container:Qa(Mve,r),label:Uve}));function Fm(r){const t=r!=="100%"?KJ[r]:void 0;return qJ({container:{[FS.variable]:t??r,[Gw.variable]:`calc(${t??r} / 2.5)`},excessLabel:{[FS.variable]:t??r,[Gw.variable]:`calc(${t??r} / 2.5)`}})}const Fve={"2xs":Fm(4),xs:Fm(6),sm:Fm(8),md:Fm(12),lg:Fm(16),xl:Fm(24),"2xl":Fm(32),full:Fm("100%")},jve=Dve({baseStyle:Vve,sizes:Fve,defaultProps:{size:"md"}}),Os=oye("badge",["bg","color","shadow"]),Bve={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Os.bg.reference,color:Os.color.reference,boxShadow:Os.shadow.reference},Wve=r=>{const{colorScheme:t,theme:s}=r,a=VS(`${t}.500`,.6)(s);return{[Os.bg.variable]:`colors.${t}.500`,[Os.color.variable]:"colors.white",_dark:{[Os.bg.variable]:a,[Os.color.variable]:"colors.whiteAlpha.800"}}},zve=r=>{const{colorScheme:t,theme:s}=r,a=VS(`${t}.200`,.16)(s);return{[Os.bg.variable]:`colors.${t}.100`,[Os.color.variable]:`colors.${t}.800`,_dark:{[Os.bg.variable]:a,[Os.color.variable]:`colors.${t}.200`}}},Gve=r=>{const{colorScheme:t,theme:s}=r,a=VS(`${t}.200`,.8)(s);return{[Os.color.variable]:`colors.${t}.500`,_dark:{[Os.color.variable]:a},[Os.shadow.variable]:`inset 0 0 0px 1px ${Os.color.reference}`}},Hve={solid:Wve,subtle:zve,outline:Gve},ww={baseStyle:Bve,variants:Hve,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:$ve,definePartsStyle:Kve}=Ri(_ye.keys),hM=On("breadcrumb-link-decor"),qve={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:hM.reference,[hM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[hM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},Yve=Kve({link:qve}),Xve=$ve({baseStyle:Yve}),Jve={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},YJ=r=>{const{colorScheme:t,theme:s}=r;if(t==="gray")return{color:Pn("gray.800","whiteAlpha.900")(r),_hover:{bg:Pn("gray.100","whiteAlpha.200")(r)},_active:{bg:Pn("gray.200","whiteAlpha.300")(r)}};const a=VS(`${t}.200`,.12)(s),l=VS(`${t}.200`,.24)(s);return{color:Pn(`${t}.600`,`${t}.200`)(r),bg:"transparent",_hover:{bg:Pn(`${t}.50`,a)(r)},_active:{bg:Pn(`${t}.100`,l)(r)}}},Qve=r=>{const{colorScheme:t}=r,s=Pn("gray.200","whiteAlpha.300")(r);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Qa(YJ,r)}},Zve={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},eSe=r=>{const{colorScheme:t}=r;if(t==="gray"){const E=Pn("gray.100","whiteAlpha.200")(r);return{bg:E,color:Pn("gray.800","whiteAlpha.900")(r),_hover:{bg:Pn("gray.200","whiteAlpha.300")(r),_disabled:{bg:E}},_active:{bg:Pn("gray.300","whiteAlpha.400")(r)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=Zve[t]??{},f=Pn(s,`${t}.200`)(r);return{bg:f,color:Pn(a,"gray.800")(r),_hover:{bg:Pn(l,`${t}.300`)(r),_disabled:{bg:f}},_active:{bg:Pn(d,`${t}.400`)(r)}}},tSe=r=>{const{colorScheme:t}=r;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Pn(`${t}.500`,`${t}.200`)(r),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Pn(`${t}.700`,`${t}.500`)(r)}}},nSe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},rSe={ghost:YJ,outline:Qve,solid:eSe,link:tSe,unstyled:nSe},iSe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},sSe={baseStyle:Jve,variants:rSe,sizes:iSe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:iE,defineMultiStyleConfig:oSe}=Ri(Vye.keys),qO=On("card-bg"),pf=On("card-padding"),XJ=On("card-shadow"),pO=On("card-radius"),JJ=On("card-border-width","0"),QJ=On("card-border-color"),aSe=iE({container:{[qO.variable]:"colors.chakra-body-bg",backgroundColor:qO.reference,boxShadow:XJ.reference,borderRadius:pO.reference,color:"chakra-body-text",borderWidth:JJ.reference,borderColor:QJ.reference},body:{padding:pf.reference,flex:"1 1 0%"},header:{padding:pf.reference},footer:{padding:pf.reference}}),cSe={sm:iE({container:{[pO.variable]:"radii.base",[pf.variable]:"space.3"}}),md:iE({container:{[pO.variable]:"radii.md",[pf.variable]:"space.5"}}),lg:iE({container:{[pO.variable]:"radii.xl",[pf.variable]:"space.7"}})},lSe={elevated:iE({container:{[XJ.variable]:"shadows.base",_dark:{[qO.variable]:"colors.gray.700"}}}),outline:iE({container:{[JJ.variable]:"1px",[QJ.variable]:"colors.chakra-border-color"}}),filled:iE({container:{[qO.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[pf.variable]:0},header:{[pf.variable]:0},footer:{[pf.variable]:0}}},uSe=oSe({baseStyle:aSe,variants:lSe,sizes:cSe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:fO,defineMultiStyleConfig:dSe}=Ri(Eye.keys),Rw=On("checkbox-size"),hSe=r=>{const{colorScheme:t}=r;return{w:Rw.reference,h:Rw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Pn(`${t}.500`,`${t}.200`)(r),borderColor:Pn(`${t}.500`,`${t}.200`)(r),color:Pn("white","gray.900")(r),_hover:{bg:Pn(`${t}.600`,`${t}.300`)(r),borderColor:Pn(`${t}.600`,`${t}.300`)(r)},_disabled:{borderColor:Pn("gray.200","transparent")(r),bg:Pn("gray.200","whiteAlpha.300")(r),color:Pn("gray.500","whiteAlpha.500")(r)}},_indeterminate:{bg:Pn(`${t}.500`,`${t}.200`)(r),borderColor:Pn(`${t}.500`,`${t}.200`)(r),color:Pn("white","gray.900")(r)},_disabled:{bg:Pn("gray.100","whiteAlpha.100")(r),borderColor:Pn("gray.100","transparent")(r)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Pn("red.500","red.300")(r)}}},pSe={_disabled:{cursor:"not-allowed"}},fSe={userSelect:"none",_disabled:{opacity:.4}},mSe={transitionProperty:"transform",transitionDuration:"normal"},gSe=fO(r=>({icon:mSe,container:pSe,control:Qa(hSe,r),label:fSe})),_Se={sm:fO({control:{[Rw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:fO({control:{[Rw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:fO({control:{[Rw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},Gm=dSe({baseStyle:gSe,sizes:_Se,defaultProps:{size:"md",colorScheme:"blue"}}),Cw=io("close-button-size"),Fb=io("close-button-bg"),ESe={w:[Cw.reference],h:[Cw.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[Fb.variable]:"colors.blackAlpha.100",_dark:{[Fb.variable]:"colors.whiteAlpha.100"}},_active:{[Fb.variable]:"colors.blackAlpha.200",_dark:{[Fb.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:Fb.reference},ySe={lg:{[Cw.variable]:"sizes.10",fontSize:"md"},md:{[Cw.variable]:"sizes.8",fontSize:"xs"},sm:{[Cw.variable]:"sizes.6",fontSize:"2xs"}},vSe={baseStyle:ESe,sizes:ySe,defaultProps:{size:"md"}},{variants:SSe,defaultProps:TSe}=ww,bSe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Os.bg.reference,color:Os.color.reference,boxShadow:Os.shadow.reference},wSe={baseStyle:bSe,variants:SSe,defaultProps:TSe},RSe={w:"100%",mx:"auto",maxW:"prose",px:"4"},CSe={baseStyle:RSe},ISe={opacity:.6,borderColor:"inherit"},ASe={borderStyle:"solid"},PSe={borderStyle:"dashed"},OSe={solid:ASe,dashed:PSe},kSe={baseStyle:ISe,variants:OSe,defaultProps:{variant:"solid"}},{definePartsStyle:x2,defineMultiStyleConfig:NSe}=Ri(yye.keys),pM=On("drawer-bg"),fM=On("drawer-box-shadow");function Xv(r){return x2(r==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:r}})}const DSe={bg:"blackAlpha.600",zIndex:"modal"},LSe={display:"flex",zIndex:"modal",justifyContent:"center"},xSe=r=>{const{isFullHeight:t}=r;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[pM.variable]:"colors.white",[fM.variable]:"shadows.lg",_dark:{[pM.variable]:"colors.gray.700",[fM.variable]:"shadows.dark-lg"},bg:pM.reference,boxShadow:fM.reference}},MSe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},USe={position:"absolute",top:"2",insetEnd:"3"},VSe={px:"6",py:"2",flex:"1",overflow:"auto"},FSe={px:"6",py:"4"},jSe=x2(r=>({overlay:DSe,dialogContainer:LSe,dialog:Qa(xSe,r),header:MSe,closeButton:USe,body:VSe,footer:FSe})),BSe={xs:Xv("xs"),sm:Xv("md"),md:Xv("lg"),lg:Xv("2xl"),xl:Xv("4xl"),full:Xv("full")},WSe=NSe({baseStyle:jSe,sizes:BSe,defaultProps:{size:"xs"}}),{definePartsStyle:zSe,defineMultiStyleConfig:GSe}=Ri(vye.keys),HSe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},$Se={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},KSe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},qSe=zSe({preview:HSe,input:$Se,textarea:KSe}),YSe=GSe({baseStyle:qSe}),{definePartsStyle:XSe,defineMultiStyleConfig:JSe}=Ri(Sye.keys),CS=On("form-control-color"),QSe={marginStart:"1",[CS.variable]:"colors.red.500",_dark:{[CS.variable]:"colors.red.300"},color:CS.reference},ZSe={mt:"2",[CS.variable]:"colors.gray.600",_dark:{[CS.variable]:"colors.whiteAlpha.600"},color:CS.reference,lineHeight:"normal",fontSize:"sm"},e0e=XSe({container:{width:"100%",position:"relative"},requiredIndicator:QSe,helperText:ZSe}),t0e=JSe({baseStyle:e0e}),{definePartsStyle:n0e,defineMultiStyleConfig:r0e}=Ri(Tye.keys),IS=On("form-error-color"),i0e={[IS.variable]:"colors.red.500",_dark:{[IS.variable]:"colors.red.300"},color:IS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},s0e={marginEnd:"0.5em",[IS.variable]:"colors.red.500",_dark:{[IS.variable]:"colors.red.300"},color:IS.reference},o0e=n0e({text:i0e,icon:s0e}),a0e=r0e({baseStyle:o0e}),c0e={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},l0e={baseStyle:c0e},u0e={fontFamily:"heading",fontWeight:"bold"},d0e={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},h0e={baseStyle:u0e,sizes:d0e,defaultProps:{size:"xl"}},{definePartsStyle:of,defineMultiStyleConfig:p0e}=Ri(bye.keys),lS=On("input-height"),uS=On("input-font-size"),dS=On("input-padding"),hS=On("input-border-radius"),f0e=of({addon:{height:lS.reference,fontSize:uS.reference,px:dS.reference,borderRadius:hS.reference},field:{width:"100%",height:lS.reference,fontSize:uS.reference,px:dS.reference,borderRadius:hS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),jm={lg:{[uS.variable]:"fontSizes.lg",[dS.variable]:"space.4",[hS.variable]:"radii.md",[lS.variable]:"sizes.12"},md:{[uS.variable]:"fontSizes.md",[dS.variable]:"space.4",[hS.variable]:"radii.md",[lS.variable]:"sizes.10"},sm:{[uS.variable]:"fontSizes.sm",[dS.variable]:"space.3",[hS.variable]:"radii.sm",[lS.variable]:"sizes.8"},xs:{[uS.variable]:"fontSizes.xs",[dS.variable]:"space.2",[hS.variable]:"radii.sm",[lS.variable]:"sizes.6"}},m0e={lg:of({field:jm.lg,group:jm.lg}),md:of({field:jm.md,group:jm.md}),sm:of({field:jm.sm,group:jm.sm}),xs:of({field:jm.xs,group:jm.xs})};function gV(r){const{focusBorderColor:t,errorBorderColor:s}=r;return{focusBorderColor:t||Pn("blue.500","blue.300")(r),errorBorderColor:s||Pn("red.500","red.300")(r)}}const g0e=of(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=gV(r);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Pn("gray.300","whiteAlpha.400")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ja(t,a),boxShadow:`0 0 0 1px ${Ja(t,a)}`},_focusVisible:{zIndex:1,borderColor:Ja(t,s),boxShadow:`0 0 0 1px ${Ja(t,s)}`}},addon:{border:"1px solid",borderColor:Pn("inherit","whiteAlpha.50")(r),bg:Pn("gray.100","whiteAlpha.300")(r)}}}),_0e=of(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=gV(r);return{field:{border:"2px solid",borderColor:"transparent",bg:Pn("gray.100","whiteAlpha.50")(r),_hover:{bg:Pn("gray.200","whiteAlpha.100")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ja(t,a)},_focusVisible:{bg:"transparent",borderColor:Ja(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:Pn("gray.100","whiteAlpha.50")(r)}}}),E0e=of(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=gV(r);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ja(t,a),boxShadow:`0px 1px 0px 0px ${Ja(t,a)}`},_focusVisible:{borderColor:Ja(t,s),boxShadow:`0px 1px 0px 0px ${Ja(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),y0e=of({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),v0e={outline:g0e,filled:_0e,flushed:E0e,unstyled:y0e},qr=p0e({baseStyle:f0e,sizes:m0e,variants:v0e,defaultProps:{size:"md",variant:"outline"}}),mM=On("kbd-bg"),S0e={[mM.variable]:"colors.gray.100",_dark:{[mM.variable]:"colors.whiteAlpha.100"},bg:mM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},T0e={baseStyle:S0e},b0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},w0e={baseStyle:b0e},{defineMultiStyleConfig:R0e,definePartsStyle:C0e}=Ri(wye.keys),I0e={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},A0e=C0e({icon:I0e}),P0e=R0e({baseStyle:A0e}),{defineMultiStyleConfig:O0e,definePartsStyle:k0e}=Ri(Rye.keys),bh=On("menu-bg"),gM=On("menu-shadow"),N0e={[bh.variable]:"#fff",[gM.variable]:"shadows.sm",_dark:{[bh.variable]:"colors.gray.700",[gM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:bh.reference,boxShadow:gM.reference},D0e={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[bh.variable]:"colors.gray.100",_dark:{[bh.variable]:"colors.whiteAlpha.100"}},_active:{[bh.variable]:"colors.gray.200",_dark:{[bh.variable]:"colors.whiteAlpha.200"}},_expanded:{[bh.variable]:"colors.gray.100",_dark:{[bh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:bh.reference},L0e={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},x0e={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},M0e={opacity:.6},U0e={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},V0e={transitionProperty:"common",transitionDuration:"normal"},F0e=k0e({button:V0e,list:N0e,item:D0e,groupTitle:L0e,icon:x0e,command:M0e,divider:U0e}),j0e=O0e({baseStyle:F0e}),{defineMultiStyleConfig:B0e,definePartsStyle:M2}=Ri(Cye.keys),_M=On("modal-bg"),EM=On("modal-shadow"),W0e={bg:"blackAlpha.600",zIndex:"modal"},z0e=r=>{const{isCentered:t,scrollBehavior:s}=r;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},G0e=r=>{const{isCentered:t,scrollBehavior:s}=r;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[_M.variable]:"colors.white",[EM.variable]:"shadows.lg",_dark:{[_M.variable]:"colors.gray.700",[EM.variable]:"shadows.dark-lg"},bg:_M.reference,boxShadow:EM.reference}},H0e={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},$0e={position:"absolute",top:"2",insetEnd:"3"},K0e=r=>{const{scrollBehavior:t}=r;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},q0e={px:"6",py:"4"},Y0e=M2(r=>({overlay:W0e,dialogContainer:Qa(z0e,r),dialog:Qa(G0e,r),header:H0e,closeButton:$0e,body:Qa(K0e,r),footer:q0e}));function fd(r){return M2(r==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:r}})}const X0e={xs:fd("xs"),sm:fd("sm"),md:fd("md"),lg:fd("lg"),xl:fd("xl"),"2xl":fd("2xl"),"3xl":fd("3xl"),"4xl":fd("4xl"),"5xl":fd("5xl"),"6xl":fd("6xl"),full:fd("full")},J0e=B0e({baseStyle:Y0e,sizes:X0e,defaultProps:{size:"md"}}),ZJ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:Q0e,definePartsStyle:eQ}=Ri(Iye.keys),_V=io("number-input-stepper-width"),tQ=io("number-input-input-padding"),Z0e=rf(_V).add("0.5rem").toString(),yM=io("number-input-bg"),vM=io("number-input-color"),SM=io("number-input-border-color"),eTe={[_V.variable]:"sizes.6",[tQ.variable]:Z0e},tTe=r=>{var t;return((t=Qa(qr.baseStyle,r))==null?void 0:t.field)??{}},nTe={width:_V.reference},rTe={borderStart:"1px solid",borderStartColor:SM.reference,color:vM.reference,bg:yM.reference,[vM.variable]:"colors.chakra-body-text",[SM.variable]:"colors.chakra-border-color",_dark:{[vM.variable]:"colors.whiteAlpha.800",[SM.variable]:"colors.whiteAlpha.300"},_active:{[yM.variable]:"colors.gray.200",_dark:{[yM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},iTe=eQ(r=>({root:eTe,field:Qa(tTe,r)??{},stepperGroup:nTe,stepper:rTe}));function MP(r){var d,f;const t=(d=qr.sizes)==null?void 0:d[r],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=t.field)==null?void 0:f.fontSize)??"md",l=ZJ.fontSizes[a];return eQ({field:{...t.field,paddingInlineEnd:tQ.reference,verticalAlign:"top"},stepper:{fontSize:rf(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[r]},_last:{borderBottomEndRadius:s[r],mt:"-1px",borderTopWidth:1}}})}const sTe={xs:MP("xs"),sm:MP("sm"),md:MP("md"),lg:MP("lg")},oTe=Q0e({baseStyle:iTe,sizes:sTe,variants:qr.variants,defaultProps:qr.defaultProps});var ZX;const aTe={...(ZX=qr.baseStyle)==null?void 0:ZX.field,textAlign:"center"},cTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var eJ;const lTe={outline:r=>{var t,s;return((s=Qa((t=qr.variants)==null?void 0:t.outline,r))==null?void 0:s.field)??{}},flushed:r=>{var t,s;return((s=Qa((t=qr.variants)==null?void 0:t.flushed,r))==null?void 0:s.field)??{}},filled:r=>{var t,s;return((s=Qa((t=qr.variants)==null?void 0:t.filled,r))==null?void 0:s.field)??{}},unstyled:((eJ=qr.variants)==null?void 0:eJ.unstyled.field)??{}},uTe={baseStyle:aTe,sizes:cTe,variants:lTe,defaultProps:qr.defaultProps},{defineMultiStyleConfig:dTe,definePartsStyle:hTe}=Ri(Aye.keys),UP=io("popper-bg"),pTe=io("popper-arrow-bg"),S$=io("popper-arrow-shadow-color"),fTe={zIndex:"popover"},mTe={[UP.variable]:"colors.white",bg:UP.reference,[pTe.variable]:UP.reference,[S$.variable]:"colors.gray.200",_dark:{[UP.variable]:"colors.gray.700",[S$.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},gTe={px:3,py:2,borderBottomWidth:"1px"},_Te={px:3,py:2},ETe={px:3,py:2,borderTopWidth:"1px"},yTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},vTe=hTe({popper:fTe,content:mTe,header:gTe,body:_Te,footer:ETe,closeButton:yTe}),STe=dTe({baseStyle:vTe}),{defineMultiStyleConfig:TTe,definePartsStyle:aw}=Ri(Pye.keys),bTe=r=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=r,d=Pn(g$(),g$("1rem","rgba(0,0,0,0.1)"))(r),f=Pn(`${t}.500`,`${t}.200`)(r),E=`linear-gradient(
    to right,
    transparent 0%,
    ${Ja(s,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:f}}},wTe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},RTe=r=>({bg:Pn("gray.100","whiteAlpha.300")(r)}),CTe=r=>({transitionProperty:"common",transitionDuration:"slow",...bTe(r)}),ITe=aw(r=>({label:wTe,filledTrack:CTe(r),track:RTe(r)})),ATe={xs:aw({track:{h:"1"}}),sm:aw({track:{h:"2"}}),md:aw({track:{h:"3"}}),lg:aw({track:{h:"4"}})},PTe=TTe({sizes:ATe,baseStyle:ITe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:OTe,definePartsStyle:mO}=Ri(Oye.keys),kTe=r=>{var s;const t=(s=Qa(Gm.baseStyle,r))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},NTe=mO(r=>{var t,s;return{label:(t=Gm.baseStyle)==null?void 0:t.call(Gm,r).label,container:(s=Gm.baseStyle)==null?void 0:s.call(Gm,r).container,control:kTe(r)}}),DTe={md:mO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:mO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:mO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},LTe=OTe({baseStyle:NTe,sizes:DTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:xTe,definePartsStyle:MTe}=Ri(kye.keys),VP=On("select-bg");var tJ;const UTe={...(tJ=qr.baseStyle)==null?void 0:tJ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:VP.reference,[VP.variable]:"colors.white",_dark:{[VP.variable]:"colors.gray.700"},"> option, > optgroup":{bg:VP.reference}},VTe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},FTe=MTe({field:UTe,icon:VTe}),FP={paddingInlineEnd:"8"};var nJ,rJ,iJ,sJ,oJ,aJ,cJ,lJ;const jTe={lg:{...(nJ=qr.sizes)==null?void 0:nJ.lg,field:{...(rJ=qr.sizes)==null?void 0:rJ.lg.field,...FP}},md:{...(iJ=qr.sizes)==null?void 0:iJ.md,field:{...(sJ=qr.sizes)==null?void 0:sJ.md.field,...FP}},sm:{...(oJ=qr.sizes)==null?void 0:oJ.sm,field:{...(aJ=qr.sizes)==null?void 0:aJ.sm.field,...FP}},xs:{...(cJ=qr.sizes)==null?void 0:cJ.xs,field:{...(lJ=qr.sizes)==null?void 0:lJ.xs.field,...FP},icon:{insetEnd:"1"}}},BTe=xTe({baseStyle:FTe,sizes:jTe,variants:qr.variants,defaultProps:qr.defaultProps}),TM=On("skeleton-start-color"),bM=On("skeleton-end-color"),WTe={[TM.variable]:"colors.gray.100",[bM.variable]:"colors.gray.400",_dark:{[TM.variable]:"colors.gray.800",[bM.variable]:"colors.gray.600"},background:TM.reference,borderColor:bM.reference,opacity:.7,borderRadius:"sm"},zTe={baseStyle:WTe},wM=On("skip-link-bg"),GTe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[wM.variable]:"colors.white",_dark:{[wM.variable]:"colors.gray.700"},bg:wM.reference}},HTe={baseStyle:GTe},{defineMultiStyleConfig:$Te,definePartsStyle:Fk}=Ri(Nye.keys),fE=On("slider-thumb-size"),Hw=On("slider-track-size"),Hm=On("slider-bg"),KTe=r=>{const{orientation:t}=r;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...fV({orientation:t,vertical:{h:"100%",px:nf(fE.reference).divide(2).toString()},horizontal:{w:"100%",py:nf(fE.reference).divide(2).toString()}})}},qTe=r=>({...fV({orientation:r.orientation,horizontal:{h:Hw.reference},vertical:{w:Hw.reference}}),overflow:"hidden",borderRadius:"sm",[Hm.variable]:"colors.gray.200",_dark:{[Hm.variable]:"colors.whiteAlpha.200"},_disabled:{[Hm.variable]:"colors.gray.300",_dark:{[Hm.variable]:"colors.whiteAlpha.300"}},bg:Hm.reference}),YTe=r=>{const{orientation:t}=r;return{...fV({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:fE.reference,h:fE.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},XTe=r=>{const{colorScheme:t}=r;return{width:"inherit",height:"inherit",[Hm.variable]:`colors.${t}.500`,_dark:{[Hm.variable]:`colors.${t}.200`},bg:Hm.reference}},JTe=Fk(r=>({container:KTe(r),track:qTe(r),thumb:YTe(r),filledTrack:XTe(r)})),QTe=Fk({container:{[fE.variable]:"sizes.4",[Hw.variable]:"sizes.1"}}),ZTe=Fk({container:{[fE.variable]:"sizes.3.5",[Hw.variable]:"sizes.1"}}),ebe=Fk({container:{[fE.variable]:"sizes.2.5",[Hw.variable]:"sizes.0.5"}}),tbe={lg:QTe,md:ZTe,sm:ebe},nbe=$Te({baseStyle:JTe,sizes:tbe,defaultProps:{size:"md",colorScheme:"blue"}}),Q_=io("spinner-size"),rbe={width:[Q_.reference],height:[Q_.reference]},ibe={xs:{[Q_.variable]:"sizes.3"},sm:{[Q_.variable]:"sizes.4"},md:{[Q_.variable]:"sizes.6"},lg:{[Q_.variable]:"sizes.8"},xl:{[Q_.variable]:"sizes.12"}},sbe={baseStyle:rbe,sizes:ibe,defaultProps:{size:"md"}},{defineMultiStyleConfig:obe,definePartsStyle:nQ}=Ri(Dye.keys),abe={fontWeight:"medium"},cbe={opacity:.8,marginBottom:"2"},lbe={verticalAlign:"baseline",fontWeight:"semibold"},ube={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},dbe=nQ({container:{},label:abe,helpText:cbe,number:lbe,icon:ube}),hbe={md:nQ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},pbe=obe({baseStyle:dbe,sizes:hbe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:fbe,definePartsStyle:cw}=Ri(["stepper","step","title","description","indicator","separator","icon","number"]),sf=On("stepper-indicator-size"),pS=On("stepper-icon-size"),fS=On("stepper-title-font-size"),lw=On("stepper-description-font-size"),jb=On("stepper-accent-color"),mbe=cw(({colorScheme:r})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[jb.variable]:`colors.${r}.500`,_dark:{[jb.variable]:`colors.${r}.200`}},title:{fontSize:fS.reference,fontWeight:"medium"},description:{fontSize:lw.reference,color:"chakra-subtle-text"},number:{fontSize:fS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:pS.reference,height:pS.reference},indicator:{flexShrink:0,borderRadius:"full",width:sf.reference,height:sf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:jb.reference},"&[data-status=complete]":{bg:jb.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:jb.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${sf.reference} - 8px)`,top:`calc(${sf.reference} + 4px)`,insetStart:`calc(${sf.reference} / 2 - 1px)`}}})),gbe=fbe({baseStyle:mbe,sizes:{xs:cw({stepper:{[sf.variable]:"sizes.4",[pS.variable]:"sizes.3",[fS.variable]:"fontSizes.xs",[lw.variable]:"fontSizes.xs"}}),sm:cw({stepper:{[sf.variable]:"sizes.6",[pS.variable]:"sizes.4",[fS.variable]:"fontSizes.sm",[lw.variable]:"fontSizes.xs"}}),md:cw({stepper:{[sf.variable]:"sizes.8",[pS.variable]:"sizes.5",[fS.variable]:"fontSizes.md",[lw.variable]:"fontSizes.sm"}}),lg:cw({stepper:{[sf.variable]:"sizes.10",[pS.variable]:"sizes.6",[fS.variable]:"fontSizes.lg",[lw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:_be,definePartsStyle:gO}=Ri(Lye.keys),Iw=io("switch-track-width"),sE=io("switch-track-height"),RM=io("switch-track-diff"),Ebe=rf.subtract(Iw,sE),U2=io("switch-thumb-x"),Bb=io("switch-bg"),ybe=r=>{const{colorScheme:t}=r;return{borderRadius:"full",p:"0.5",width:[Iw.reference],height:[sE.reference],transitionProperty:"common",transitionDuration:"fast",[Bb.variable]:"colors.gray.300",_dark:{[Bb.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Bb.variable]:`colors.${t}.500`,_dark:{[Bb.variable]:`colors.${t}.200`}},bg:Bb.reference}},vbe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[sE.reference],height:[sE.reference],_checked:{transform:`translateX(${U2.reference})`}},Sbe=gO(r=>({container:{[RM.variable]:Ebe,[U2.variable]:RM.reference,_rtl:{[U2.variable]:rf(RM).negate().toString()}},track:ybe(r),thumb:vbe})),Tbe={sm:gO({container:{[Iw.variable]:"1.375rem",[sE.variable]:"sizes.3"}}),md:gO({container:{[Iw.variable]:"1.875rem",[sE.variable]:"sizes.4"}}),lg:gO({container:{[Iw.variable]:"2.875rem",[sE.variable]:"sizes.6"}})},bbe=_be({baseStyle:Sbe,sizes:Tbe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:wbe,definePartsStyle:AS}=Ri(xye.keys),Rbe=AS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),YO={"&[data-is-numeric=true]":{textAlign:"end"}},Cbe=AS(r=>{const{colorScheme:t}=r;return{th:{color:Pn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(r),...YO},td:{borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(r),...YO},caption:{color:Pn("gray.600","gray.100")(r)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Ibe=AS(r=>{const{colorScheme:t}=r;return{th:{color:Pn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(r),...YO},td:{borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(r),...YO},caption:{color:Pn("gray.600","gray.100")(r)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(r)},td:{background:Pn(`${t}.100`,`${t}.700`)(r)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Abe={simple:Cbe,striped:Ibe,unstyled:{}},Pbe={sm:AS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:AS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:AS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Obe=wbe({baseStyle:Rbe,variants:Abe,sizes:Pbe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Vc=On("tabs-color"),_d=On("tabs-bg"),jP=On("tabs-border-color"),{defineMultiStyleConfig:kbe,definePartsStyle:Mh}=Ri(Mye.keys),Nbe=r=>{const{orientation:t}=r;return{display:t==="vertical"?"flex":"block"}},Dbe=r=>{const{isFitted:t}=r;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},Lbe=r=>{const{align:t="start",orientation:s}=r;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},xbe={p:4},Mbe=Mh(r=>({root:Nbe(r),tab:Dbe(r),tablist:Lbe(r),tabpanel:xbe})),Ube={sm:Mh({tab:{py:1,px:4,fontSize:"sm"}}),md:Mh({tab:{fontSize:"md",py:2,px:4}}),lg:Mh({tab:{fontSize:"lg",py:3,px:4}})},Vbe=Mh(r=>{const{colorScheme:t,orientation:s}=r,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Vc.variable]:`colors.${t}.600`,_dark:{[Vc.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[_d.variable]:"colors.gray.200",_dark:{[_d.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Vc.reference,bg:_d.reference}}}),Fbe=Mh(r=>{const{colorScheme:t}=r;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[jP.variable]:"transparent",_selected:{[Vc.variable]:`colors.${t}.600`,[jP.variable]:"colors.white",_dark:{[Vc.variable]:`colors.${t}.300`,[jP.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:jP.reference},color:Vc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),jbe=Mh(r=>{const{colorScheme:t}=r;return{tab:{border:"1px solid",borderColor:"inherit",[_d.variable]:"colors.gray.50",_dark:{[_d.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[_d.variable]:"colors.white",[Vc.variable]:`colors.${t}.600`,_dark:{[_d.variable]:"colors.gray.800",[Vc.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Vc.reference,bg:_d.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Bbe=Mh(r=>{const{colorScheme:t,theme:s}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Ja(s,`${t}.700`),bg:Ja(s,`${t}.100`)}}}}),Wbe=Mh(r=>{const{colorScheme:t}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",[Vc.variable]:"colors.gray.600",_dark:{[Vc.variable]:"inherit"},_selected:{[Vc.variable]:"colors.white",[_d.variable]:`colors.${t}.600`,_dark:{[Vc.variable]:"colors.gray.800",[_d.variable]:`colors.${t}.300`}},color:Vc.reference,bg:_d.reference}}}),zbe=Mh({}),Gbe={line:Vbe,enclosed:Fbe,"enclosed-colored":jbe,"soft-rounded":Bbe,"solid-rounded":Wbe,unstyled:zbe},Hbe=kbe({baseStyle:Mbe,sizes:Ube,variants:Gbe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:$be,definePartsStyle:oE}=Ri(Uye.keys),T$=On("tag-bg"),b$=On("tag-color"),CM=On("tag-shadow"),_O=On("tag-min-height"),EO=On("tag-min-width"),yO=On("tag-font-size"),vO=On("tag-padding-inline"),Kbe={fontWeight:"medium",lineHeight:1.2,outline:0,[b$.variable]:Os.color.reference,[T$.variable]:Os.bg.reference,[CM.variable]:Os.shadow.reference,color:b$.reference,bg:T$.reference,boxShadow:CM.reference,borderRadius:"md",minH:_O.reference,minW:EO.reference,fontSize:yO.reference,px:vO.reference,_focusVisible:{[CM.variable]:"shadows.outline"}},qbe={lineHeight:1.2,overflow:"visible"},Ybe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},Xbe=oE({container:Kbe,label:qbe,closeButton:Ybe}),Jbe={sm:oE({container:{[_O.variable]:"sizes.5",[EO.variable]:"sizes.5",[yO.variable]:"fontSizes.xs",[vO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:oE({container:{[_O.variable]:"sizes.6",[EO.variable]:"sizes.6",[yO.variable]:"fontSizes.sm",[vO.variable]:"space.2"}}),lg:oE({container:{[_O.variable]:"sizes.8",[EO.variable]:"sizes.8",[yO.variable]:"fontSizes.md",[vO.variable]:"space.3"}})},Qbe={subtle:oE(r=>{var t;return{container:(t=ww.variants)==null?void 0:t.subtle(r)}}),solid:oE(r=>{var t;return{container:(t=ww.variants)==null?void 0:t.solid(r)}}),outline:oE(r=>{var t;return{container:(t=ww.variants)==null?void 0:t.outline(r)}})},Zbe=$be({variants:Qbe,baseStyle:Xbe,sizes:Jbe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var uJ;const ewe={...(uJ=qr.baseStyle)==null?void 0:uJ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var dJ;const twe={outline:r=>{var t;return((t=qr.variants)==null?void 0:t.outline(r).field)??{}},flushed:r=>{var t;return((t=qr.variants)==null?void 0:t.flushed(r).field)??{}},filled:r=>{var t;return((t=qr.variants)==null?void 0:t.filled(r).field)??{}},unstyled:((dJ=qr.variants)==null?void 0:dJ.unstyled.field)??{}};var hJ,pJ,fJ,mJ;const nwe={xs:((hJ=qr.sizes)==null?void 0:hJ.xs.field)??{},sm:((pJ=qr.sizes)==null?void 0:pJ.sm.field)??{},md:((fJ=qr.sizes)==null?void 0:fJ.md.field)??{},lg:((mJ=qr.sizes)==null?void 0:mJ.lg.field)??{}},rwe={baseStyle:ewe,sizes:nwe,variants:twe,defaultProps:{size:"md",variant:"outline"}},BP=io("tooltip-bg"),IM=io("tooltip-fg"),iwe=io("popper-arrow-bg"),swe={bg:BP.reference,color:IM.reference,[BP.variable]:"colors.gray.700",[IM.variable]:"colors.whiteAlpha.900",_dark:{[BP.variable]:"colors.gray.300",[IM.variable]:"colors.gray.900"},[iwe.variable]:BP.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},owe={baseStyle:swe},awe={Accordion:$ye,Alert:Pve,Avatar:jve,Badge:ww,Breadcrumb:Xve,Button:sSe,Checkbox:Gm,CloseButton:vSe,Code:wSe,Container:CSe,Divider:kSe,Drawer:WSe,Editable:YSe,Form:t0e,FormError:a0e,FormLabel:l0e,Heading:h0e,Input:qr,Kbd:T0e,Link:w0e,List:P0e,Menu:j0e,Modal:J0e,NumberInput:oTe,PinInput:uTe,Popover:STe,Progress:PTe,Radio:LTe,Select:BTe,Skeleton:zTe,SkipLink:HTe,Slider:nbe,Spinner:sbe,Stat:pbe,Switch:bbe,Table:Obe,Tabs:Hbe,Tag:Zbe,Textarea:rwe,Tooltip:owe,Card:uSe,Stepper:gbe},cwe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},lwe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},uwe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},dwe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},hwe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},pwe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},fwe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},mwe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},gwe={property:pwe,easing:fwe,duration:mwe},_we={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},Ewe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},ywe={breakpoints:lwe,zIndices:_we,radii:dwe,blur:Ewe,colors:uwe,...ZJ,sizes:KJ,shadows:hwe,space:$J,borders:cwe,transition:gwe},vwe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},Swe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},Twe="ltr",bwe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},wwe={semanticTokens:vwe,direction:Twe,...ywe,components:awe,styles:Swe,config:bwe};function Rwe(r){if(r.sheet)return r.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===r)return document.styleSheets[t]}function Cwe(r){var t=document.createElement("style");return t.setAttribute("data-emotion",r.key),r.nonce!==void 0&&t.setAttribute("nonce",r.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var Iwe=function(){function r(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=r.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Cwe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=Rwe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},r}(),ba="-ms-",XO="-moz-",$r="-webkit-",rQ="comm",EV="rule",yV="decl",Awe="@import",iQ="@keyframes",Pwe="@layer",Owe=Math.abs,jk=String.fromCharCode,kwe=Object.assign;function Nwe(r,t){return Xo(r,0)^45?(((t<<2^Xo(r,0))<<2^Xo(r,1))<<2^Xo(r,2))<<2^Xo(r,3):0}function sQ(r){return r.trim()}function Dwe(r,t){return(r=t.exec(r))?r[0]:r}function Kr(r,t,s){return r.replace(t,s)}function V2(r,t){return r.indexOf(t)}function Xo(r,t){return r.charCodeAt(t)|0}function $w(r,t,s){return r.slice(t,s)}function Ch(r){return r.length}function vV(r){return r.length}function WP(r,t){return t.push(r),r}function Lwe(r,t){return r.map(t).join("")}var Bk=1,jS=1,oQ=0,Gc=0,Bs=0,c0="";function Wk(r,t,s,a,l,d,f){return{value:r,root:t,parent:s,type:a,props:l,children:d,line:Bk,column:jS,length:f,return:""}}function Wb(r,t){return kwe(Wk("",null,null,"",null,null,0),r,{length:-r.length},t)}function xwe(){return Bs}function Mwe(){return Bs=Gc>0?Xo(c0,--Gc):0,jS--,Bs===10&&(jS=1,Bk--),Bs}function Cl(){return Bs=Gc<oQ?Xo(c0,Gc++):0,jS++,Bs===10&&(jS=1,Bk++),Bs}function Uh(){return Xo(c0,Gc)}function SO(){return Gc}function vR(r,t){return $w(c0,r,t)}function Kw(r){switch(r){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function aQ(r){return Bk=jS=1,oQ=Ch(c0=r),Gc=0,[]}function cQ(r){return c0="",r}function TO(r){return sQ(vR(Gc-1,F2(r===91?r+2:r===40?r+1:r)))}function Uwe(r){for(;(Bs=Uh())&&Bs<33;)Cl();return Kw(r)>2||Kw(Bs)>3?"":" "}function Vwe(r,t){for(;--t&&Cl()&&!(Bs<48||Bs>102||Bs>57&&Bs<65||Bs>70&&Bs<97););return vR(r,SO()+(t<6&&Uh()==32&&Cl()==32))}function F2(r){for(;Cl();)switch(Bs){case r:return Gc;case 34:case 39:r!==34&&r!==39&&F2(Bs);break;case 40:r===41&&F2(r);break;case 92:Cl();break}return Gc}function Fwe(r,t){for(;Cl()&&r+Bs!==57;)if(r+Bs===84&&Uh()===47)break;return"/*"+vR(t,Gc-1)+"*"+jk(r===47?r:Cl())}function jwe(r){for(;!Kw(Uh());)Cl();return vR(r,Gc)}function Bwe(r){return cQ(bO("",null,null,null,[""],r=aQ(r),0,[0],r))}function bO(r,t,s,a,l,d,f,E,v){for(var T=0,w=0,I=f,N=0,F=0,j=0,G=1,H=1,te=1,K=0,Q="",de=l,se=d,ge=a,ee=Q;H;)switch(j=K,K=Cl()){case 40:if(j!=108&&Xo(ee,I-1)==58){V2(ee+=Kr(TO(K),"&","&\f"),"&\f")!=-1&&(te=-1);break}case 34:case 39:case 91:ee+=TO(K);break;case 9:case 10:case 13:case 32:ee+=Uwe(j);break;case 92:ee+=Vwe(SO()-1,7);continue;case 47:switch(Uh()){case 42:case 47:WP(Wwe(Fwe(Cl(),SO()),t,s),v);break;default:ee+="/"}break;case 123*G:E[T++]=Ch(ee)*te;case 125*G:case 59:case 0:switch(K){case 0:case 125:H=0;case 59+w:te==-1&&(ee=Kr(ee,/\f/g,"")),F>0&&Ch(ee)-I&&WP(F>32?R$(ee+";",a,s,I-1):R$(Kr(ee," ","")+";",a,s,I-2),v);break;case 59:ee+=";";default:if(WP(ge=w$(ee,t,s,T,w,l,E,Q,de=[],se=[],I),d),K===123)if(w===0)bO(ee,t,ge,ge,de,d,I,E,se);else switch(N===99&&Xo(ee,3)===110?100:N){case 100:case 108:case 109:case 115:bO(r,ge,ge,a&&WP(w$(r,ge,ge,0,0,l,E,Q,l,de=[],I),se),l,se,I,E,a?de:se);break;default:bO(ee,ge,ge,ge,[""],se,0,E,se)}}T=w=F=0,G=te=1,Q=ee="",I=f;break;case 58:I=1+Ch(ee),F=j;default:if(G<1){if(K==123)--G;else if(K==125&&G++==0&&Mwe()==125)continue}switch(ee+=jk(K),K*G){case 38:te=w>0?1:(ee+="\f",-1);break;case 44:E[T++]=(Ch(ee)-1)*te,te=1;break;case 64:Uh()===45&&(ee+=TO(Cl())),N=Uh(),w=I=Ch(Q=ee+=jwe(SO())),K++;break;case 45:j===45&&Ch(ee)==2&&(G=0)}}return d}function w$(r,t,s,a,l,d,f,E,v,T,w){for(var I=l-1,N=l===0?d:[""],F=vV(N),j=0,G=0,H=0;j<a;++j)for(var te=0,K=$w(r,I+1,I=Owe(G=f[j])),Q=r;te<F;++te)(Q=sQ(G>0?N[te]+" "+K:Kr(K,/&\f/g,N[te])))&&(v[H++]=Q);return Wk(r,t,s,l===0?EV:E,v,T,w)}function Wwe(r,t,s){return Wk(r,t,s,rQ,jk(xwe()),$w(r,2,-2),0)}function R$(r,t,s,a){return Wk(r,t,s,yV,$w(r,0,a),$w(r,a+1,-1),a)}function PS(r,t){for(var s="",a=vV(r),l=0;l<a;l++)s+=t(r[l],l,r,t)||"";return s}function zwe(r,t,s,a){switch(r.type){case Pwe:if(r.children.length)break;case Awe:case yV:return r.return=r.return||r.value;case rQ:return"";case iQ:return r.return=r.value+"{"+PS(r.children,a)+"}";case EV:r.value=r.props.join(",")}return Ch(s=PS(r.children,a))?r.return=r.value+"{"+s+"}":""}function Gwe(r){var t=vV(r);return function(s,a,l,d){for(var f="",E=0;E<t;E++)f+=r[E](s,a,l,d)||"";return f}}function Hwe(r){return function(t){t.root||(t=t.return)&&r(t)}}var C$=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function lQ(r){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=r(s)),t[s]}}var $we=function(t,s,a){for(var l=0,d=0;l=d,d=Uh(),l===38&&d===12&&(s[a]=1),!Kw(d);)Cl();return vR(t,Gc)},Kwe=function(t,s){var a=-1,l=44;do switch(Kw(l)){case 0:l===38&&Uh()===12&&(s[a]=1),t[a]+=$we(Gc-1,s,a);break;case 2:t[a]+=TO(l);break;case 4:if(l===44){t[++a]=Uh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=jk(l)}while(l=Cl());return t},qwe=function(t,s){return cQ(Kwe(aQ(t),s))},I$=new WeakMap,Ywe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!I$.get(a))&&!l){I$.set(t,!0);for(var d=[],f=qwe(s,d),E=a.props,v=0,T=0;v<f.length;v++)for(var w=0;w<E.length;w++,T++)t.props[T]=d[v]?f[v].replace(/&\f/g,E[w]):E[w]+" "+f[v]}}},Xwe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function uQ(r,t){switch(Nwe(r,t)){case 5103:return $r+"print-"+r+r;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return $r+r+r;case 5349:case 4246:case 4810:case 6968:case 2756:return $r+r+XO+r+ba+r+r;case 6828:case 4268:return $r+r+ba+r+r;case 6165:return $r+r+ba+"flex-"+r+r;case 5187:return $r+r+Kr(r,/(\w+).+(:[^]+)/,$r+"box-$1$2"+ba+"flex-$1$2")+r;case 5443:return $r+r+ba+"flex-item-"+Kr(r,/flex-|-self/,"")+r;case 4675:return $r+r+ba+"flex-line-pack"+Kr(r,/align-content|flex-|-self/,"")+r;case 5548:return $r+r+ba+Kr(r,"shrink","negative")+r;case 5292:return $r+r+ba+Kr(r,"basis","preferred-size")+r;case 6060:return $r+"box-"+Kr(r,"-grow","")+$r+r+ba+Kr(r,"grow","positive")+r;case 4554:return $r+Kr(r,/([^-])(transform)/g,"$1"+$r+"$2")+r;case 6187:return Kr(Kr(Kr(r,/(zoom-|grab)/,$r+"$1"),/(image-set)/,$r+"$1"),r,"")+r;case 5495:case 3959:return Kr(r,/(image-set\([^]*)/,$r+"$1$`$1");case 4968:return Kr(Kr(r,/(.+:)(flex-)?(.*)/,$r+"box-pack:$3"+ba+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+$r+r+r;case 4095:case 3583:case 4068:case 2532:return Kr(r,/(.+)-inline(.+)/,$r+"$1$2")+r;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ch(r)-1-t>6)switch(Xo(r,t+1)){case 109:if(Xo(r,t+4)!==45)break;case 102:return Kr(r,/(.+:)(.+)-([^]+)/,"$1"+$r+"$2-$3$1"+XO+(Xo(r,t+3)==108?"$3":"$2-$3"))+r;case 115:return~V2(r,"stretch")?uQ(Kr(r,"stretch","fill-available"),t)+r:r}break;case 4949:if(Xo(r,t+1)!==115)break;case 6444:switch(Xo(r,Ch(r)-3-(~V2(r,"!important")&&10))){case 107:return Kr(r,":",":"+$r)+r;case 101:return Kr(r,/(.+:)([^;!]+)(;|!.+)?/,"$1"+$r+(Xo(r,14)===45?"inline-":"")+"box$3$1"+$r+"$2$3$1"+ba+"$2box$3")+r}break;case 5936:switch(Xo(r,t+11)){case 114:return $r+r+ba+Kr(r,/[svh]\w+-[tblr]{2}/,"tb")+r;case 108:return $r+r+ba+Kr(r,/[svh]\w+-[tblr]{2}/,"tb-rl")+r;case 45:return $r+r+ba+Kr(r,/[svh]\w+-[tblr]{2}/,"lr")+r}return $r+r+ba+r+r}return r}var Jwe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case yV:t.return=uQ(t.value,t.length);break;case iQ:return PS([Wb(t,{value:Kr(t.value,"@","@"+$r)})],l);case EV:if(t.length)return Lwe(t.props,function(d){switch(Dwe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return PS([Wb(t,{props:[Kr(d,/:(read-\w+)/,":"+XO+"$1")]})],l);case"::placeholder":return PS([Wb(t,{props:[Kr(d,/:(plac\w+)/,":"+$r+"input-$1")]}),Wb(t,{props:[Kr(d,/:(plac\w+)/,":"+XO+"$1")]}),Wb(t,{props:[Kr(d,/:(plac\w+)/,ba+"input-$1")]})],l)}return""})}},Qwe=[Jwe],Zwe=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(G){var H=G.getAttribute("data-emotion");H.indexOf(" ")!==-1&&(document.head.appendChild(G),G.setAttribute("data-s",""))})}var l=t.stylisPlugins||Qwe,d={},f,E=[];f=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(G){for(var H=G.getAttribute("data-emotion").split(" "),te=1;te<H.length;te++)d[H[te]]=!0;E.push(G)});var v,T=[Ywe,Xwe];{var w,I=[zwe,Hwe(function(G){w.insert(G)})],N=Gwe(T.concat(l,I)),F=function(H){return PS(Bwe(H),N)};v=function(H,te,K,Q){w=K,F(H?H+"{"+te.styles+"}":te.styles),Q&&(j.inserted[te.name]=!0)}}var j={key:s,sheet:new Iwe({key:s,container:f,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return j.sheet.hydrate(E),j};function mE(){return mE=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},mE.apply(null,arguments)}var AM={exports:{}},ei={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A$;function eRe(){if(A$)return ei;A$=1;var r=typeof Symbol=="function"&&Symbol.for,t=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,d=r?Symbol.for("react.profiler"):60114,f=r?Symbol.for("react.provider"):60109,E=r?Symbol.for("react.context"):60110,v=r?Symbol.for("react.async_mode"):60111,T=r?Symbol.for("react.concurrent_mode"):60111,w=r?Symbol.for("react.forward_ref"):60112,I=r?Symbol.for("react.suspense"):60113,N=r?Symbol.for("react.suspense_list"):60120,F=r?Symbol.for("react.memo"):60115,j=r?Symbol.for("react.lazy"):60116,G=r?Symbol.for("react.block"):60121,H=r?Symbol.for("react.fundamental"):60117,te=r?Symbol.for("react.responder"):60118,K=r?Symbol.for("react.scope"):60119;function Q(se){if(typeof se=="object"&&se!==null){var ge=se.$$typeof;switch(ge){case t:switch(se=se.type,se){case v:case T:case a:case d:case l:case I:return se;default:switch(se=se&&se.$$typeof,se){case E:case w:case j:case F:case f:return se;default:return ge}}case s:return ge}}}function de(se){return Q(se)===T}return ei.AsyncMode=v,ei.ConcurrentMode=T,ei.ContextConsumer=E,ei.ContextProvider=f,ei.Element=t,ei.ForwardRef=w,ei.Fragment=a,ei.Lazy=j,ei.Memo=F,ei.Portal=s,ei.Profiler=d,ei.StrictMode=l,ei.Suspense=I,ei.isAsyncMode=function(se){return de(se)||Q(se)===v},ei.isConcurrentMode=de,ei.isContextConsumer=function(se){return Q(se)===E},ei.isContextProvider=function(se){return Q(se)===f},ei.isElement=function(se){return typeof se=="object"&&se!==null&&se.$$typeof===t},ei.isForwardRef=function(se){return Q(se)===w},ei.isFragment=function(se){return Q(se)===a},ei.isLazy=function(se){return Q(se)===j},ei.isMemo=function(se){return Q(se)===F},ei.isPortal=function(se){return Q(se)===s},ei.isProfiler=function(se){return Q(se)===d},ei.isStrictMode=function(se){return Q(se)===l},ei.isSuspense=function(se){return Q(se)===I},ei.isValidElementType=function(se){return typeof se=="string"||typeof se=="function"||se===a||se===T||se===d||se===l||se===I||se===N||typeof se=="object"&&se!==null&&(se.$$typeof===j||se.$$typeof===F||se.$$typeof===f||se.$$typeof===E||se.$$typeof===w||se.$$typeof===H||se.$$typeof===te||se.$$typeof===K||se.$$typeof===G)},ei.typeOf=Q,ei}var P$;function tRe(){return P$||(P$=1,AM.exports=eRe()),AM.exports}var PM,O$;function nRe(){if(O$)return PM;O$=1;var r=tRe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[r.ForwardRef]=a,d[r.Memo]=l;function f(j){return r.isMemo(j)?l:d[j.$$typeof]||t}var E=Object.defineProperty,v=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,N=Object.prototype;function F(j,G,H){if(typeof G!="string"){if(N){var te=I(G);te&&te!==N&&F(j,te,H)}var K=v(G);T&&(K=K.concat(T(G)));for(var Q=f(j),de=f(G),se=0;se<K.length;++se){var ge=K[se];if(!s[ge]&&!(H&&H[ge])&&!(de&&de[ge])&&!(Q&&Q[ge])){var ee=w(G,ge);try{E(j,ge,ee)}catch{}}}}return j}return PM=F,PM}nRe();var rRe=!0;function dQ(r,t,s){var a="";return s.split(" ").forEach(function(l){r[l]!==void 0?t.push(r[l]+";"):l&&(a+=l+" ")}),a}var SV=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||rRe===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},TV=function(t,s,a){SV(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function iRe(r){for(var t=0,s,a=0,l=r.length;l>=4;++a,l-=4)s=r.charCodeAt(a)&255|(r.charCodeAt(++a)&255)<<8|(r.charCodeAt(++a)&255)<<16|(r.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(r.charCodeAt(a+2)&255)<<16;case 2:t^=(r.charCodeAt(a+1)&255)<<8;case 1:t^=r.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var sRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},oRe=/[A-Z]|^ms/g,aRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,hQ=function(t){return t.charCodeAt(1)===45},k$=function(t){return t!=null&&typeof t!="boolean"},OM=lQ(function(r){return hQ(r)?r:r.replace(oRe,"-$&").toLowerCase()}),N$=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(aRe,function(a,l,d){return Ih={name:l,styles:d,next:Ih},l})}return sRe[t]!==1&&!hQ(t)&&typeof s=="number"&&s!==0?s+"px":s};function qw(r,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return Ih={name:l.name,styles:l.styles,next:Ih},l.name;var d=s;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)Ih={name:f.name,styles:f.styles,next:Ih},f=f.next;var E=d.styles+";";return E}return cRe(r,t,s)}case"function":{if(r!==void 0){var v=Ih,T=s(r);return Ih=v,qw(r,t,T)}break}}var w=s;if(t==null)return w;var I=t[w];return I!==void 0?I:w}function cRe(r,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=qw(r,t,s[l])+";";else for(var d in s){var f=s[d];if(typeof f!="object"){var E=f;t!=null&&t[E]!==void 0?a+=d+"{"+t[E]+"}":k$(E)&&(a+=OM(d)+":"+N$(d,E)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(t==null||t[f[0]]===void 0))for(var v=0;v<f.length;v++)k$(f[v])&&(a+=OM(d)+":"+N$(d,f[v])+";");else{var T=qw(r,t,f);switch(d){case"animation":case"animationName":{a+=OM(d)+":"+T+";";break}default:a+=d+"{"+T+"}"}}}return a}var D$=/label:\s*([^\s;{]+)\s*(;|$)/g,Ih;function zk(r,t,s){if(r.length===1&&typeof r[0]=="object"&&r[0]!==null&&r[0].styles!==void 0)return r[0];var a=!0,l="";Ih=void 0;var d=r[0];if(d==null||d.raw===void 0)a=!1,l+=qw(s,t,d);else{var f=d;l+=f[0]}for(var E=1;E<r.length;E++)if(l+=qw(s,t,r[E]),a){var v=d;l+=v[E]}D$.lastIndex=0;for(var T="",w;(w=D$.exec(l))!==null;)T+="-"+w[1];var I=iRe(l)+T;return{name:I,styles:l,next:Ih}}var lRe=function(t){return t()},pQ=K7.useInsertionEffect?K7.useInsertionEffect:!1,fQ=pQ||lRe,L$=pQ||L.useLayoutEffect,bV=L.createContext(typeof HTMLElement<"u"?Zwe({key:"css"}):null);bV.Provider;var uRe=function(){return L.useContext(bV)},wV=function(t){return L.forwardRef(function(s,a){var l=L.useContext(bV);return t(s,l,a)})},BS=L.createContext({}),dRe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return mE({},t,s)},hRe=C$(function(r){return C$(function(t){return dRe(r,t)})}),pRe=function(t){var s=L.useContext(BS);return t.theme!==s&&(s=hRe(s)(t.theme)),L.createElement(BS.Provider,{value:s},t.children)},RV={}.hasOwnProperty,j2="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",fRe=function(t,s){var a={};for(var l in s)RV.call(s,l)&&(a[l]=s[l]);return a[j2]=t,a},mRe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return SV(s,a,l),fQ(function(){return TV(s,a,l)}),null},gRe=wV(function(r,t,s){var a=r.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=r[j2],d=[a],f="";typeof r.className=="string"?f=dQ(t.registered,d,r.className):r.className!=null&&(f=r.className+" ");var E=zk(d,void 0,L.useContext(BS));f+=t.key+"-"+E.name;var v={};for(var T in r)RV.call(r,T)&&T!=="css"&&T!==j2&&(v[T]=r[T]);return v.className=f,s&&(v.ref=s),L.createElement(L.Fragment,null,L.createElement(mRe,{cache:t,serialized:E,isStringTag:typeof l=="string"}),L.createElement(l,v))}),_Re=gRe,x$=function(t,s){var a=arguments;if(s==null||!RV.call(s,"css"))return L.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=_Re,d[1]=fRe(t,s);for(var f=2;f<l;f++)d[f]=a[f];return L.createElement.apply(null,d)};(function(r){var t;t||(t=r.JSX||(r.JSX={}))})(x$||(x$={}));var Gk=wV(function(r,t){var s=r.styles,a=zk([s],void 0,L.useContext(BS)),l=L.useRef();return L$(function(){var d=t.key+"-global",f=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(f.before=t.sheet.tags[0]),v!==null&&(E=!0,v.setAttribute("data-emotion",d),f.hydrate([v])),l.current=[f,E],function(){f.flush()}},[t]),L$(function(){var d=l.current,f=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&TV(t,a.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}t.insert("",a,f,!1)},[t,a.name]),null});function ERe(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return zk(t)}function SR(){var r=ERe.apply(void 0,arguments),t="animation-"+r.name;return{name:t,styles:"@keyframes "+t+"{"+r.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const CV=L.createContext({});CV.displayName="ColorModeContext";function Hk(){const r=L.useContext(CV);if(r===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return r}function yRe(r,t){const{colorMode:s}=Hk();return s==="dark"?t:r}const zP={light:"chakra-ui-light",dark:"chakra-ui-dark"};function vRe(r={}){const{preventTransition:t=!0,nonce:s}=r,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?zP.dark:zP.light),document.body.classList.remove(l?zP.light:zP.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=E=>{l(E.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const SRe="chakra-ui-color-mode";function TRe(r){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(r)||t}catch{}return s||t},set(t){try{localStorage.setItem(r,t)}catch{}}}}const bRe=TRe(SRe),M$=()=>{},wRe=Gge()?L.useLayoutEffect:L.useEffect;function U$(r,t){return r.type==="cookie"&&r.ssr?r.get(t):t}const mQ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:E=bRe}=t,v=uRe(),T=d==="dark"?"dark":"light",[w,I]=L.useState(()=>U$(E,T)),[N,F]=L.useState(()=>U$(E)),{getSystemTheme:j,setClassName:G,setDataset:H,addListener:te}=L.useMemo(()=>vRe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),K=d==="system"&&!w?N:w,Q=L.useCallback(ge=>{const ee=ge==="system"?j():ge;I(ee),G(ee==="dark"),H(ee),E.set(ee)},[E,j,G,H]);wRe(()=>{d==="system"&&F(j())},[]),L.useEffect(()=>{const ge=E.get();if(ge){Q(ge);return}if(d==="system"){Q("system");return}Q(T)},[E,T,d,Q]);const de=L.useCallback(()=>{Q(K==="dark"?"light":"dark")},[K,Q]);L.useEffect(()=>{if(l)return te(Q)},[l,te,Q]);const se=L.useMemo(()=>({colorMode:s??K,toggleColorMode:s?M$:de,setColorMode:s?M$:Q,forced:s!==void 0}),[K,de,Q,s]);return O.jsx(CV.Provider,{value:se,children:a})};mQ.displayName="ColorModeProvider";const gQ=String.raw,_Q=gQ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,RRe=()=>O.jsx(Gk,{styles:_Q}),CRe=({scope:r=""})=>O.jsx(Gk,{styles:gQ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${r} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${r} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${r} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${r} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${r} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${r} :where(b, strong) {
        font-weight: bold;
      }

      ${r} small {
        font-size: 80%;
      }

      ${r} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${r} sub {
        bottom: -0.25em;
      }

      ${r} sup {
        top: -0.5em;
      }

      ${r} img {
        border-style: none;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${r} :where(button, input) {
        overflow: visible;
      }

      ${r} :where(button, select) {
        text-transform: none;
      }

      ${r} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${r} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${r} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${r} progress {
        vertical-align: baseline;
      }

      ${r} textarea {
        overflow: auto;
      }

      ${r} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${r} input[type="number"]::-webkit-inner-spin-button,
      ${r} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${r} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${r} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${r} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${r} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${r} details {
        display: block;
      }

      ${r} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${r} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${r} button {
        background: transparent;
        padding: 0;
      }

      ${r} fieldset {
        margin: 0;
        padding: 0;
      }

      ${r} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${r} textarea {
        resize: vertical;
      }

      ${r} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${r} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${r} table {
        border-collapse: collapse;
      }

      ${r} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${r} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${r} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${r} select::-ms-expand {
        display: none;
      }

      ${_Q}
    `});function IRe(r){const{cssVarsRoot:t,theme:s,children:a}=r,l=L.useMemo(()=>pye(s),[s]);return O.jsxs(pRe,{theme:l,children:[O.jsx(ARe,{root:t}),a]})}function ARe({root:r=":host, :root"}){const t=[r,"[data-theme]"].join(",");return O.jsx(Gk,{styles:s=>({[t]:s.__cssVars})})}Vi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function PRe(){const{colorMode:r}=Hk();return O.jsx(Gk,{styles:t=>{const s=RJ(t,"styles.global"),a=jc(s,{theme:t,colorMode:r});return a?WJ(a)(t):void 0}})}const[ORe,kRe]=Vi({strict:!1,name:"PortalManagerContext"});function IV(r){const{children:t,zIndex:s}=r;return O.jsx(ORe,{value:{zIndex:s},children:t})}IV.displayName="PortalManager";const AV=L.createContext({getDocument(){return document},getWindow(){return window}});AV.displayName="EnvironmentContext";function NRe({defer:r}={}){const[,t]=L.useReducer(s=>s+1,0);return hf(()=>{r&&t()},[r]),L.useContext(AV)}function EQ(r){const{children:t,environment:s,disabled:a}=r,l=L.useRef(null),d=L.useMemo(()=>s||{getDocument:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument)??document},getWindow:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument.defaultView)??window}},[s]),f=!a||!s;return O.jsxs(AV.Provider,{value:d,children:[t,f&&O.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}EQ.displayName="EnvironmentProvider";const DRe=r=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:E,cssVarsRoot:v,disableEnvironment:T,disableGlobalStyle:w}=r,I=O.jsx(EQ,{environment:E,disabled:T,children:t});return O.jsx(IRe,{theme:f,cssVarsRoot:v,children:O.jsxs(mQ,{colorModeManager:s,options:f.config,children:[d?O.jsx(CRe,{scope:l}):O.jsx(RRe,{}),!w&&O.jsx(PRe,{}),a?O.jsx(IV,{zIndex:a,children:I}):I]})})},PV=L.createContext({});function OV(r){const t=L.useRef(null);return t.current===null&&(t.current=r()),t.current}const TR=L.createContext(null),kV=L.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});class LRe extends L.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function xRe({children:r,isPresent:t}){const s=L.useId(),a=L.useRef(null),l=L.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=L.useContext(kV);return L.useInsertionEffect(()=>{const{width:f,height:E,top:v,left:T}=l.current;if(t||!a.current||!f||!E)return;a.current.dataset.motionPopId=s;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${E}px !important;
            top: ${v}px !important;
            left: ${T}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[t]),O.jsx(LRe,{isPresent:t,childRef:a,sizeRef:l,children:L.cloneElement(r,{ref:a})})}const MRe=({children:r,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const E=OV(URe),v=L.useId(),T=L.useCallback(I=>{E.set(I,!0);for(const N of E.values())if(!N)return;a&&a()},[E,a]),w=L.useMemo(()=>({id:v,initial:t,isPresent:s,custom:l,onExitComplete:T,register:I=>(E.set(I,!1),()=>E.delete(I))}),d?[Math.random(),T]:[s,T]);return L.useMemo(()=>{E.forEach((I,N)=>E.set(N,!1))},[s]),L.useEffect(()=>{!s&&!E.size&&a&&a()},[s]),f==="popLayout"&&(r=O.jsx(xRe,{isPresent:s,children:r})),O.jsx(TR.Provider,{value:w,children:r})};function URe(){return new Map}function NV(r=!0){const t=L.useContext(TR);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=L.useId();L.useEffect(()=>{r&&l(d)},[r]);const f=L.useCallback(()=>r&&a&&a(d),[d,a,r]);return!s&&a?[!1,f]:[!0]}function VRe(){return FRe(L.useContext(TR))}function FRe(r){return r===null?!0:r.isPresent}const GP=r=>r.key||"";function V$(r){const t=[];return L.Children.forEach(r,s=>{L.isValidElement(s)&&t.push(s)}),t}const DV=typeof window<"u",yQ=DV?L.useLayoutEffect:L.useEffect,l0=({children:r,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[E,v]=NV(f),T=L.useMemo(()=>V$(r),[r]),w=f&&!E?[]:T.map(GP),I=L.useRef(!0),N=L.useRef(T),F=OV(()=>new Map),[j,G]=L.useState(T),[H,te]=L.useState(T);yQ(()=>{I.current=!1,N.current=T;for(let de=0;de<H.length;de++){const se=GP(H[de]);w.includes(se)?F.delete(se):F.get(se)!==!0&&F.set(se,!1)}},[H,w.length,w.join("-")]);const K=[];if(T!==j){let de=[...T];for(let se=0;se<H.length;se++){const ge=H[se],ee=GP(ge);w.includes(ee)||(de.splice(se,0,ge),K.push(ge))}d==="wait"&&K.length&&(de=K),te(V$(de)),G(T);return}const{forceRender:Q}=L.useContext(PV);return O.jsx(O.Fragment,{children:H.map(de=>{const se=GP(de),ge=f&&!E?!1:T===H||w.includes(se),ee=()=>{if(F.has(se))F.set(se,!0);else return;let Z=!0;F.forEach(ne=>{ne||(Z=!1)}),Z&&(Q==null||Q(),te(N.current),f&&(v==null||v()),a&&a())};return O.jsx(MRe,{isPresent:ge,initial:!I.current||s?void 0:!1,custom:ge?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:ge?void 0:ee,children:de},se)})})},Il=r=>r;let vQ=Il;function LV(r){let t;return()=>(t===void 0&&(t=r()),t)}const WS=(r,t,s)=>{const a=t-r;return a===0?1:(s-r)/a},ff=r=>r*1e3,mf=r=>r/1e3,jRe={useManualTiming:!1};function BRe(r){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function E(T){d.has(T)&&(v.schedule(T),r()),T(f)}const v={schedule:(T,w=!1,I=!1)=>{const F=I&&a?t:s;return w&&d.add(T),F.has(T)||F.add(T),T},cancel:T=>{s.delete(T),d.delete(T)},process:T=>{if(f=T,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(E),t.clear(),a=!1,l&&(l=!1,v.process(T))}};return v}const HP=["read","resolveKeyframes","update","preRender","render","postRender"],WRe=40;function SQ(r,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,f=HP.reduce((te,K)=>(te[K]=BRe(d),te),{}),{read:E,resolveKeyframes:v,update:T,preRender:w,render:I,postRender:N}=f,F=()=>{const te=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(te-l.timestamp,WRe),1),l.timestamp=te,l.isProcessing=!0,E.process(l),v.process(l),T.process(l),w.process(l),I.process(l),N.process(l),l.isProcessing=!1,s&&t&&(a=!1,r(F))},j=()=>{s=!0,a=!0,l.isProcessing||r(F)};return{schedule:HP.reduce((te,K)=>{const Q=f[K];return te[K]=(de,se=!1,ge=!1)=>(s||j(),Q.schedule(de,se,ge)),te},{}),cancel:te=>{for(let K=0;K<HP.length;K++)f[HP[K]].cancel(te)},state:l,steps:f}}const{schedule:Ui,cancel:lg,state:qo,steps:kM}=SQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Il,!0),TQ=L.createContext({strict:!1}),F$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},zS={};for(const r in F$)zS[r]={isEnabled:t=>F$[r].some(s=>!!t[s])};function zRe(r){for(const t in r)zS[t]={...zS[t],...r[t]}}const GRe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function JO(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||GRe.has(r)}let bQ=r=>!JO(r);function HRe(r){r&&(bQ=t=>t.startsWith("on")?!JO(t):r(t))}try{HRe(require("@emotion/is-prop-valid").default)}catch{}function $Re(r,t,s){const a={};for(const l in r)l==="values"&&typeof r.values=="object"||(bQ(l)||s===!0&&JO(l)||!t&&!JO(l)||r.draggable&&l.startsWith("onDrag"))&&(a[l]=r[l]);return a}function KRe(r){if(typeof Proxy>"u")return r;const t=new Map,s=(...a)=>r(...a);return new Proxy(s,{get:(a,l)=>l==="create"?r:(t.has(l)||t.set(l,r(l)),t.get(l))})}const $k=L.createContext({});function Yw(r){return typeof r=="string"||Array.isArray(r)}function Kk(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}const xV=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],MV=["initial",...xV];function qk(r){return Kk(r.animate)||MV.some(t=>Yw(r[t]))}function wQ(r){return!!(qk(r)||r.variants)}function qRe(r,t){if(qk(r)){const{initial:s,animate:a}=r;return{initial:s===!1||Yw(s)?s:void 0,animate:Yw(a)?a:void 0}}return r.inherit!==!1?t:{}}function YRe(r){const{initial:t,animate:s}=qRe(r,L.useContext($k));return L.useMemo(()=>({initial:t,animate:s}),[j$(t),j$(s)])}function j$(r){return Array.isArray(r)?r.join(" "):r}const XRe=Symbol.for("motionComponentSymbol");function mS(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function JRe(r,t,s){return L.useCallback(a=>{a&&r.onMount&&r.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):mS(s)&&(s.current=a))},[t])}const UV=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),QRe="framerAppearId",RQ="data-"+UV(QRe),{schedule:VV}=SQ(queueMicrotask,!1),CQ=L.createContext({});function ZRe(r,t,s,a,l){var d,f;const{visualElement:E}=L.useContext($k),v=L.useContext(TQ),T=L.useContext(TR),w=L.useContext(kV).reducedMotion,I=L.useRef(null);a=a||v.renderer,!I.current&&a&&(I.current=a(r,{visualState:t,parent:E,props:s,presenceContext:T,blockInitialAnimation:T?T.initial===!1:!1,reducedMotionConfig:w}));const N=I.current,F=L.useContext(CQ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&eCe(I.current,s,l,F);const j=L.useRef(!1);L.useInsertionEffect(()=>{N&&j.current&&N.update(s,T)});const G=s[RQ],H=L.useRef(!!G&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,G))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,G)));return yQ(()=>{N&&(j.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),VV.render(N.render),H.current&&N.animationState&&N.animationState.animateChanges())}),L.useEffect(()=>{N&&(!H.current&&N.animationState&&N.animationState.animateChanges(),H.current&&(queueMicrotask(()=>{var te;(te=window.MotionHandoffMarkAsComplete)===null||te===void 0||te.call(window,G)}),H.current=!1))}),N}function eCe(r,t,s,a){const{layoutId:l,layout:d,drag:f,dragConstraints:E,layoutScroll:v,layoutRoot:T}=t;r.projection=new s(r.latestValues,t["data-framer-portal-id"]?void 0:IQ(r.parent)),r.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||E&&mS(E),visualElement:r,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:T})}function IQ(r){if(r)return r.options.allowProjection!==!1?r.projection:IQ(r.parent)}function tCe({preloadedFeatures:r,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,f;r&&zRe(r);function E(T,w){let I;const N={...L.useContext(kV),...T,layoutId:nCe(T)},{isStatic:F}=N,j=YRe(T),G=a(T,F);if(!F&&DV){rCe();const H=iCe(N);I=H.MeasureLayout,j.visualElement=ZRe(l,G,N,t,H.ProjectionNode)}return O.jsxs($k.Provider,{value:j,children:[I&&j.visualElement?O.jsx(I,{visualElement:j.visualElement,...N}):null,s(l,T,JRe(G,j.visualElement,w),G,F,j.visualElement)]})}E.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const v=L.forwardRef(E);return v[XRe]=l,v}function nCe({layoutId:r}){const t=L.useContext(PV).id;return t&&r!==void 0?t+"-"+r:r}function rCe(r,t){L.useContext(TQ).strict}function iCe(r){const{drag:t,layout:s}=zS;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(r)||s!=null&&s.isEnabled(r)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const sCe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function FV(r){return typeof r!="string"||r.includes("-")?!1:!!(sCe.indexOf(r)>-1||/[A-Z]/u.test(r))}function B$(r){const t=[{},{}];return r==null||r.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function jV(r,t,s,a){if(typeof t=="function"){const[l,d]=B$(a);t=t(s!==void 0?s:r.custom,l,d)}if(typeof t=="string"&&(t=r.variants&&r.variants[t]),typeof t=="function"){const[l,d]=B$(a);t=t(s!==void 0?s:r.custom,l,d)}return t}const B2=r=>Array.isArray(r),oCe=r=>!!(r&&typeof r=="object"&&r.mix&&r.toValue),aCe=r=>B2(r)?r[r.length-1]||0:r,Pa=r=>!!(r&&r.getVelocity);function wO(r){const t=Pa(r)?r.get():r;return oCe(t)?t.toValue():t}function cCe({scrapeMotionValuesFromProps:r,createRenderState:t,onUpdate:s},a,l,d){const f={latestValues:lCe(a,l,d,r),renderState:t()};return s&&(f.onMount=E=>s({props:a,current:E,...f}),f.onUpdate=E=>s(E)),f}const AQ=r=>(t,s)=>{const a=L.useContext($k),l=L.useContext(TR),d=()=>cCe(r,t,a,l);return s?d():OV(d)};function lCe(r,t,s,a){const l={},d=a(r,{});for(const N in d)l[N]=wO(d[N]);let{initial:f,animate:E}=r;const v=qk(r),T=wQ(r);t&&T&&!v&&r.inherit!==!1&&(f===void 0&&(f=t.initial),E===void 0&&(E=t.animate));let w=s?s.initial===!1:!1;w=w||f===!1;const I=w?E:f;if(I&&typeof I!="boolean"&&!Kk(I)){const N=Array.isArray(I)?I:[I];for(let F=0;F<N.length;F++){const j=jV(r,N[F]);if(j){const{transitionEnd:G,transition:H,...te}=j;for(const K in te){let Q=te[K];if(Array.isArray(Q)){const de=w?Q.length-1:0;Q=Q[de]}Q!==null&&(l[K]=Q)}for(const K in G)l[K]=G[K]}}}return l}const u0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],IE=new Set(u0),PQ=r=>t=>typeof t=="string"&&t.startsWith(r),OQ=PQ("--"),uCe=PQ("var(--"),BV=r=>uCe(r)?dCe.test(r.split("/*")[0].trim()):!1,dCe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,kQ=(r,t)=>t&&typeof r=="number"?t.transform(r):r,yf=(r,t,s)=>s>t?t:s<r?r:s,d0={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},Xw={...d0,transform:r=>yf(0,1,r)},$P={...d0,default:1},bR=r=>({test:t=>typeof t=="string"&&t.endsWith(r)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${r}`}),Wm=bR("deg"),Vh=bR("%"),Dn=bR("px"),hCe=bR("vh"),pCe=bR("vw"),W$={...Vh,parse:r=>Vh.parse(r)/100,transform:r=>Vh.transform(r*100)},fCe={borderWidth:Dn,borderTopWidth:Dn,borderRightWidth:Dn,borderBottomWidth:Dn,borderLeftWidth:Dn,borderRadius:Dn,radius:Dn,borderTopLeftRadius:Dn,borderTopRightRadius:Dn,borderBottomRightRadius:Dn,borderBottomLeftRadius:Dn,width:Dn,maxWidth:Dn,height:Dn,maxHeight:Dn,top:Dn,right:Dn,bottom:Dn,left:Dn,padding:Dn,paddingTop:Dn,paddingRight:Dn,paddingBottom:Dn,paddingLeft:Dn,margin:Dn,marginTop:Dn,marginRight:Dn,marginBottom:Dn,marginLeft:Dn,backgroundPositionX:Dn,backgroundPositionY:Dn},mCe={rotate:Wm,rotateX:Wm,rotateY:Wm,rotateZ:Wm,scale:$P,scaleX:$P,scaleY:$P,scaleZ:$P,skew:Wm,skewX:Wm,skewY:Wm,distance:Dn,translateX:Dn,translateY:Dn,translateZ:Dn,x:Dn,y:Dn,z:Dn,perspective:Dn,transformPerspective:Dn,opacity:Xw,originX:W$,originY:W$,originZ:Dn},z$={...d0,transform:Math.round},WV={...fCe,...mCe,zIndex:z$,size:Dn,fillOpacity:Xw,strokeOpacity:Xw,numOctaves:z$},gCe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},_Ce=u0.length;function ECe(r,t,s){let a="",l=!0;for(let d=0;d<_Ce;d++){const f=u0[d],E=r[f];if(E===void 0)continue;let v=!0;if(typeof E=="number"?v=E===(f.startsWith("scale")?1:0):v=parseFloat(E)===0,!v||s){const T=kQ(E,WV[f]);if(!v){l=!1;const w=gCe[f]||f;a+=`${w}(${T}) `}s&&(t[f]=T)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function zV(r,t,s){const{style:a,vars:l,transformOrigin:d}=r;let f=!1,E=!1;for(const v in t){const T=t[v];if(IE.has(v)){f=!0;continue}else if(OQ(v)){l[v]=T;continue}else{const w=kQ(T,WV[v]);v.startsWith("origin")?(E=!0,d[v]=w):a[v]=w}}if(t.transform||(f||s?a.transform=ECe(t,r.transform,s):a.transform&&(a.transform="none")),E){const{originX:v="50%",originY:T="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${T} ${w}`}}const yCe={offset:"stroke-dashoffset",array:"stroke-dasharray"},vCe={offset:"strokeDashoffset",array:"strokeDasharray"};function SCe(r,t,s=1,a=0,l=!0){r.pathLength=1;const d=l?yCe:vCe;r[d.offset]=Dn.transform(-a);const f=Dn.transform(t),E=Dn.transform(s);r[d.array]=`${f} ${E}`}function G$(r,t,s){return typeof r=="string"?r:Dn.transform(t+s*r)}function TCe(r,t,s){const a=G$(t,r.x,r.width),l=G$(s,r.y,r.height);return`${a} ${l}`}function GV(r,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:E=1,pathOffset:v=0,...T},w,I){if(zV(r,T,I),w){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:N,style:F,dimensions:j}=r;N.transform&&(j&&(F.transform=N.transform),delete N.transform),j&&(l!==void 0||d!==void 0||F.transform)&&(F.transformOrigin=TCe(j,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(N.x=t),s!==void 0&&(N.y=s),a!==void 0&&(N.scale=a),f!==void 0&&SCe(N,f,E,v,!1)}const HV=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),NQ=()=>({...HV(),attrs:{}}),$V=r=>typeof r=="string"&&r.toLowerCase()==="svg";function DQ(r,{style:t,vars:s},a,l){Object.assign(r.style,t,l&&l.getProjectionStyles(a));for(const d in s)r.style.setProperty(d,s[d])}const LQ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function xQ(r,t,s,a){DQ(r,t,void 0,a);for(const l in t.attrs)r.setAttribute(LQ.has(l)?l:UV(l),t.attrs[l])}const QO={};function bCe(r){Object.assign(QO,r)}function MQ(r,{layout:t,layoutId:s}){return IE.has(r)||r.startsWith("origin")||(t||s!==void 0)&&(!!QO[r]||r==="opacity")}function KV(r,t,s){var a;const{style:l}=r,d={};for(const f in l)(Pa(l[f])||t.style&&Pa(t.style[f])||MQ(f,r)||((a=s==null?void 0:s.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function UQ(r,t,s){const a=KV(r,t,s);for(const l in r)if(Pa(r[l])||Pa(t[l])){const d=u0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=r[l]}return a}function wCe(r,t){try{t.dimensions=typeof r.getBBox=="function"?r.getBBox():r.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const H$=["x","y","width","height","cx","cy","r"],RCe={useVisualState:AQ({scrapeMotionValuesFromProps:UQ,createRenderState:NQ,onUpdate:({props:r,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!r.drag;if(!d){for(const E in l)if(IE.has(E)){d=!0;break}}if(!d)return;let f=!t;if(t)for(let E=0;E<H$.length;E++){const v=H$[E];r[v]!==t[v]&&(f=!0)}f&&Ui.read(()=>{wCe(s,a),Ui.render(()=>{GV(a,l,$V(s.tagName),r.transformTemplate),xQ(s,a)})})}})},CCe={useVisualState:AQ({scrapeMotionValuesFromProps:KV,createRenderState:HV})};function VQ(r,t,s){for(const a in t)!Pa(t[a])&&!MQ(a,s)&&(r[a]=t[a])}function ICe({transformTemplate:r},t){return L.useMemo(()=>{const s=HV();return zV(s,t,r),Object.assign({},s.vars,s.style)},[t])}function ACe(r,t){const s=r.style||{},a={};return VQ(a,s,r),Object.assign(a,ICe(r,t)),a}function PCe(r,t){const s={},a=ACe(r,t);return r.drag&&r.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(s.tabIndex=0),s.style=a,s}function OCe(r,t,s,a){const l=L.useMemo(()=>{const d=NQ();return GV(d,t,$V(a),r.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(r.style){const d={};VQ(d,r.style,r),l.style={...d,...l.style}}return l}function kCe(r=!1){return(s,a,l,{latestValues:d},f)=>{const v=(FV(s)?OCe:PCe)(a,d,f,s),T=$Re(a,typeof s=="string",r),w=s!==L.Fragment?{...T,...v,ref:l}:{},{children:I}=a,N=L.useMemo(()=>Pa(I)?I.get():I,[I]);return L.createElement(s,{...w,children:N})}}function NCe(r,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...FV(a)?RCe:CCe,preloadedFeatures:r,useRender:kCe(l),createVisualElement:t,Component:a};return tCe(f)}}function FQ(r,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==r.length)return!1;for(let a=0;a<s;a++)if(t[a]!==r[a])return!1;return!0}function Yk(r,t,s){const a=r.getProps();return jV(a,t,s!==void 0?s:a.custom,r)}const DCe=LV(()=>window.ScrollTimeline!==void 0);class LCe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(DCe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class xCe extends LCe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function qV(r,t){return r?r[t]||r.default||r:void 0}const W2=2e4;function jQ(r){let t=0;const s=50;let a=r.next(t);for(;!a.done&&t<W2;)t+=s,a=r.next(t);return t>=W2?1/0:t}function YV(r){return typeof r=="function"}function $$(r,t){r.timeline=t,r.onfinish=null}const XV=r=>Array.isArray(r)&&typeof r[0]=="number",MCe={linearEasing:void 0};function UCe(r,t){const s=LV(r);return()=>{var a;return(a=MCe[t])!==null&&a!==void 0?a:s()}}const ZO=UCe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),BQ=(r,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=r(WS(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function WQ(r){return!!(typeof r=="function"&&ZO()||!r||typeof r=="string"&&(r in z2||ZO())||XV(r)||Array.isArray(r)&&r.every(WQ))}const uw=([r,t,s,a])=>`cubic-bezier(${r}, ${t}, ${s}, ${a})`,z2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:uw([0,.65,.55,1]),circOut:uw([.55,0,1,.45]),backIn:uw([.31,.01,.66,-.59]),backOut:uw([.33,1.53,.69,.99])};function zQ(r,t){if(r)return typeof r=="function"&&ZO()?BQ(r,t):XV(r)?uw(r):Array.isArray(r)?r.map(s=>zQ(s,t)||z2.easeOut):z2[r]}const gd={x:!1,y:!1};function GQ(){return gd.x||gd.y}function VCe(r,t,s){var a;if(r instanceof Element)return[r];if(typeof r=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(r);return d?Array.from(d):[]}return Array.from(r)}function HQ(r,t){const s=VCe(r),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function K$(r){return t=>{t.pointerType==="touch"||GQ()||r(t)}}function FCe(r,t,s={}){const[a,l,d]=HQ(r,s),f=K$(E=>{const{target:v}=E,T=t(E);if(typeof T!="function"||!v)return;const w=K$(I=>{T(I),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(E=>{E.addEventListener("pointerenter",f,l)}),d}const $Q=(r,t)=>t?r===t?!0:$Q(r,t.parentElement):!1,JV=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,jCe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function BCe(r){return jCe.has(r.tagName)||r.tabIndex!==-1}const dw=new WeakSet;function q$(r){return t=>{t.key==="Enter"&&r(t)}}function NM(r,t){r.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const WCe=(r,t)=>{const s=r.currentTarget;if(!s)return;const a=q$(()=>{if(dw.has(s))return;NM(s,"down");const l=q$(()=>{NM(s,"up")}),d=()=>NM(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function Y$(r){return JV(r)&&!GQ()}function zCe(r,t,s={}){const[a,l,d]=HQ(r,s),f=E=>{const v=E.currentTarget;if(!Y$(E)||dw.has(v))return;dw.add(v);const T=t(E),w=(F,j)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",N),!(!Y$(F)||!dw.has(v))&&(dw.delete(v),typeof T=="function"&&T(F,{success:j}))},I=F=>{w(F,s.useGlobalTarget||$Q(v,F.target))},N=F=>{w(F,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",N,l)};return a.forEach(E=>{!BCe(E)&&E.getAttribute("tabindex")===null&&(E.tabIndex=0),(s.useGlobalTarget?window:E).addEventListener("pointerdown",f,l),E.addEventListener("focus",T=>WCe(T,l),l)}),d}function GCe(r){return r==="x"||r==="y"?gd[r]?null:(gd[r]=!0,()=>{gd[r]=!1}):gd.x||gd.y?null:(gd.x=gd.y=!0,()=>{gd.x=gd.y=!1})}const KQ=new Set(["width","height","top","left","right","bottom",...u0]);let RO;function HCe(){RO=void 0}const Fh={now:()=>(RO===void 0&&Fh.set(qo.isProcessing||jRe.useManualTiming?qo.timestamp:performance.now()),RO),set:r=>{RO=r,queueMicrotask(HCe)}};function QV(r,t){r.indexOf(t)===-1&&r.push(t)}function ZV(r,t){const s=r.indexOf(t);s>-1&&r.splice(s,1)}class eF{constructor(){this.subscriptions=[]}add(t){return QV(this.subscriptions,t),()=>ZV(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function qQ(r,t){return t?r*(1e3/t):0}const X$=30,$Ce=r=>!isNaN(parseFloat(r));class KCe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Fh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Fh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=$Ce(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new eF);const a=this.events[t].add(s);return t==="change"?()=>{a(),Ui.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Fh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>X$)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,X$);return qQ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Jw(r,t){return new KCe(r,t)}function qCe(r,t,s){r.hasValue(t)?r.getValue(t).set(s):r.addValue(t,Jw(s))}function YCe(r,t){const s=Yk(r,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const f in d){const E=aCe(d[f]);qCe(r,f,E)}}function XCe(r){return!!(Pa(r)&&r.add)}function G2(r,t){const s=r.getValue("willChange");if(XCe(s))return s.add(t)}function YQ(r){return r.props[RQ]}const XQ=(r,t,s)=>(((1-3*s+3*t)*r+(3*s-6*t))*r+3*t)*r,JCe=1e-7,QCe=12;function ZCe(r,t,s,a,l){let d,f,E=0;do f=t+(s-t)/2,d=XQ(f,a,l)-r,d>0?s=f:t=f;while(Math.abs(d)>JCe&&++E<QCe);return f}function wR(r,t,s,a){if(r===t&&s===a)return Il;const l=d=>ZCe(d,0,1,r,s);return d=>d===0||d===1?d:XQ(l(d),t,a)}const JQ=r=>t=>t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2,QQ=r=>t=>1-r(1-t),ZQ=wR(.33,1.53,.69,.99),tF=QQ(ZQ),eZ=JQ(tF),tZ=r=>(r*=2)<1?.5*tF(r):.5*(2-Math.pow(2,-10*(r-1))),nF=r=>1-Math.sin(Math.acos(r)),nZ=QQ(nF),rZ=JQ(nF),iZ=r=>/^0[^.\s]+$/u.test(r);function eIe(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||iZ(r):!0}const Aw=r=>Math.round(r*1e5)/1e5,rF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function tIe(r){return r==null}const nIe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,iF=(r,t)=>s=>!!(typeof s=="string"&&nIe.test(s)&&s.startsWith(r)||t&&!tIe(s)&&Object.prototype.hasOwnProperty.call(s,t)),sZ=(r,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,f,E]=a.match(rF);return{[r]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(f),alpha:E!==void 0?parseFloat(E):1}},rIe=r=>yf(0,255,r),DM={...d0,transform:r=>Math.round(rIe(r))},tE={test:iF("rgb","red"),parse:sZ("red","green","blue"),transform:({red:r,green:t,blue:s,alpha:a=1})=>"rgba("+DM.transform(r)+", "+DM.transform(t)+", "+DM.transform(s)+", "+Aw(Xw.transform(a))+")"};function iIe(r){let t="",s="",a="",l="";return r.length>5?(t=r.substring(1,3),s=r.substring(3,5),a=r.substring(5,7),l=r.substring(7,9)):(t=r.substring(1,2),s=r.substring(2,3),a=r.substring(3,4),l=r.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const H2={test:iF("#"),parse:iIe,transform:tE.transform},gS={test:iF("hsl","hue"),parse:sZ("hue","saturation","lightness"),transform:({hue:r,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(r)+", "+Vh.transform(Aw(t))+", "+Vh.transform(Aw(s))+", "+Aw(Xw.transform(a))+")"},wa={test:r=>tE.test(r)||H2.test(r)||gS.test(r),parse:r=>tE.test(r)?tE.parse(r):gS.test(r)?gS.parse(r):H2.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?tE.transform(r):gS.transform(r)},sIe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function oIe(r){var t,s;return isNaN(r)&&typeof r=="string"&&(((t=r.match(rF))===null||t===void 0?void 0:t.length)||0)+(((s=r.match(sIe))===null||s===void 0?void 0:s.length)||0)>0}const oZ="number",aZ="color",aIe="var",cIe="var(",J$="${}",lIe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Qw(r){const t=r.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(lIe,v=>(wa.test(v)?(a.color.push(d),l.push(aZ),s.push(wa.parse(v))):v.startsWith(cIe)?(a.var.push(d),l.push(aIe),s.push(v)):(a.number.push(d),l.push(oZ),s.push(parseFloat(v))),++d,J$)).split(J$);return{values:s,split:E,indexes:a,types:l}}function cZ(r){return Qw(r).values}function lZ(r){const{split:t,types:s}=Qw(r),a=t.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=t[f],l[f]!==void 0){const E=s[f];E===oZ?d+=Aw(l[f]):E===aZ?d+=wa.transform(l[f]):d+=l[f]}return d}}const uIe=r=>typeof r=="number"?0:r;function dIe(r){const t=cZ(r);return lZ(r)(t.map(uIe))}const ug={test:oIe,parse:cZ,createTransformer:lZ,getAnimatableNone:dIe},hIe=new Set(["brightness","contrast","saturate","opacity"]);function pIe(r){const[t,s]=r.slice(0,-1).split("(");if(t==="drop-shadow")return r;const[a]=s.match(rF)||[];if(!a)return r;const l=s.replace(a,"");let d=hIe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const fIe=/\b([a-z-]*)\(.*?\)/gu,$2={...ug,getAnimatableNone:r=>{const t=r.match(fIe);return t?t.map(pIe).join(" "):r}},mIe={...WV,color:wa,backgroundColor:wa,outlineColor:wa,fill:wa,stroke:wa,borderColor:wa,borderTopColor:wa,borderRightColor:wa,borderBottomColor:wa,borderLeftColor:wa,filter:$2,WebkitFilter:$2},sF=r=>mIe[r];function uZ(r,t){let s=sF(r);return s!==$2&&(s=ug),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const gIe=new Set(["auto","none","0"]);function _Ie(r,t,s){let a=0,l;for(;a<r.length&&!l;){const d=r[a];typeof d=="string"&&!gIe.has(d)&&Qw(d).values.length&&(l=r[a]),a++}if(l&&s)for(const d of t)r[d]=uZ(s,l)}const Q$=r=>r===d0||r===Dn,Z$=(r,t)=>parseFloat(r.split(", ")[t]),eK=(r,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return Z$(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?Z$(d[1],r):0}},EIe=new Set(["x","y","z"]),yIe=u0.filter(r=>!EIe.has(r));function vIe(r){const t=[];return yIe.forEach(s=>{const a=r.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const GS={width:({x:r},{paddingLeft:t="0",paddingRight:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),height:({y:r},{paddingTop:t="0",paddingBottom:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),top:(r,{top:t})=>parseFloat(t),left:(r,{left:t})=>parseFloat(t),bottom:({y:r},{top:t})=>parseFloat(t)+(r.max-r.min),right:({x:r},{left:t})=>parseFloat(t)+(r.max-r.min),x:eK(4,13),y:eK(5,14)};GS.translateX=GS.x;GS.translateY=GS.y;const aE=new Set;let K2=!1,q2=!1;function dZ(){if(q2){const r=Array.from(aE).filter(a=>a.needsMeasurement),t=new Set(r.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=vIe(a);l.length&&(s.set(a,l),a.render())}),r.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,f])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(f)})}),r.forEach(a=>a.measureEndState()),r.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}q2=!1,K2=!1,aE.forEach(r=>r.complete()),aE.clear()}function hZ(){aE.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(q2=!0)})}function SIe(){hZ(),dZ()}class oF{constructor(t,s,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(aE.add(this),K2||(K2=!0,Ui.read(hZ),Ui.resolveKeyframes(dZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const f=l==null?void 0:l.get(),E=t[t.length-1];if(f!==void 0)t[0]=f;else if(a&&s){const v=a.readValue(s,E);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=E),l&&f===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),aE.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,aE.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const pZ=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r),TIe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function bIe(r){const t=TIe.exec(r);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function fZ(r,t,s=1){const[a,l]=bIe(r);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const f=d.trim();return pZ(f)?parseFloat(f):f}return BV(l)?fZ(l,t,s+1):l}const mZ=r=>t=>t.test(r),wIe={test:r=>r==="auto",parse:r=>r},gZ=[d0,Dn,Vh,Wm,pCe,hCe,wIe],tK=r=>gZ.find(mZ(r));class _Z extends oF{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let T=t[v];if(typeof T=="string"&&(T=T.trim(),BV(T))){const w=fZ(T,s.current);w!==void 0&&(t[v]=w),v===t.length-1&&(this.finalKeyframe=T)}}if(this.resolveNoneKeyframes(),!KQ.has(a)||t.length!==2)return;const[l,d]=t,f=tK(l),E=tK(d);if(f!==E)if(Q$(f)&&Q$(E))for(let v=0;v<t.length;v++){const T=t[v];typeof T=="string"&&(t[v]=parseFloat(T))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)eIe(t[l])&&a.push(l);a.length&&_Ie(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=GS[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,E=l[f];l[f]=GS[a](s.measureViewportBox(),window.getComputedStyle(s.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,T])=>{s.getValue(v).set(T)}),this.resolveNoneKeyframes()}}const nK=(r,t)=>t==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(ug.test(r)||r==="0")&&!r.startsWith("url("));function RIe(r){const t=r[0];if(r.length===1)return!0;for(let s=0;s<r.length;s++)if(r[s]!==t)return!0}function CIe(r,t,s,a){const l=r[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=r[r.length-1],f=nK(l,t),E=nK(d,t);return!f||!E?!1:RIe(r)||(s==="spring"||YV(s))&&a}const IIe=r=>r!==null;function Xk(r,{repeat:t,repeatType:s="loop"},a){const l=r.filter(IIe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const AIe=40;class EZ{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Fh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:f,...E},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>AIe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&SIe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Fh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:E,onUpdate:v,isGenerator:T}=this.options;if(!T&&!CIe(t,a,l,d))if(f)this.options.duration=0;else{v&&v(Xk(t,this.options,s)),E&&E(),this.resolveFinishedPromise();return}const w=this.initPlayback(t,s);w!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...w},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const es=(r,t,s)=>r+(t-r)*s;function LM(r,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?r+(t-r)*6*s:s<1/2?t:s<2/3?r+(t-r)*(2/3-s)*6:r}function PIe({hue:r,saturation:t,lightness:s,alpha:a}){r/=360,t/=100,s/=100;let l=0,d=0,f=0;if(!t)l=d=f=s;else{const E=s<.5?s*(1+t):s+t-s*t,v=2*s-E;l=LM(v,E,r+1/3),d=LM(v,E,r),f=LM(v,E,r-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function ek(r,t){return s=>s>0?t:r}const xM=(r,t,s)=>{const a=r*r,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},OIe=[H2,tE,gS],kIe=r=>OIe.find(t=>t.test(r));function rK(r){const t=kIe(r);if(!t)return!1;let s=t.parse(r);return t===gS&&(s=PIe(s)),s}const iK=(r,t)=>{const s=rK(r),a=rK(t);if(!s||!a)return ek(r,t);const l={...s};return d=>(l.red=xM(s.red,a.red,d),l.green=xM(s.green,a.green,d),l.blue=xM(s.blue,a.blue,d),l.alpha=es(s.alpha,a.alpha,d),tE.transform(l))},NIe=(r,t)=>s=>t(r(s)),RR=(...r)=>r.reduce(NIe),Y2=new Set(["none","hidden"]);function DIe(r,t){return Y2.has(r)?s=>s<=0?r:t:s=>s>=1?t:r}function LIe(r,t){return s=>es(r,t,s)}function aF(r){return typeof r=="number"?LIe:typeof r=="string"?BV(r)?ek:wa.test(r)?iK:UIe:Array.isArray(r)?yZ:typeof r=="object"?wa.test(r)?iK:xIe:ek}function yZ(r,t){const s=[...r],a=s.length,l=r.map((d,f)=>aF(d)(d,t[f]));return d=>{for(let f=0;f<a;f++)s[f]=l[f](d);return s}}function xIe(r,t){const s={...r,...t},a={};for(const l in s)r[l]!==void 0&&t[l]!==void 0&&(a[l]=aF(r[l])(r[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function MIe(r,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],E=r.indexes[f][l[f]],v=(s=r.values[E])!==null&&s!==void 0?s:0;a[d]=v,l[f]++}return a}const UIe=(r,t)=>{const s=ug.createTransformer(t),a=Qw(r),l=Qw(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?Y2.has(r)&&!l.values.length||Y2.has(t)&&!a.values.length?DIe(r,t):RR(yZ(MIe(a,l),l.values),s):ek(r,t)};function vZ(r,t,s){return typeof r=="number"&&typeof t=="number"&&typeof s=="number"?es(r,t,s):aF(r)(r,t)}const VIe=5;function SZ(r,t,s){const a=Math.max(t-VIe,0);return qQ(s-r(a),t-a)}const Es={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},sK=.001;function FIe({duration:r=Es.duration,bounce:t=Es.bounce,velocity:s=Es.velocity,mass:a=Es.mass}){let l,d,f=1-t;f=yf(Es.minDamping,Es.maxDamping,f),r=yf(Es.minDuration,Es.maxDuration,mf(r)),f<1?(l=T=>{const w=T*f,I=w*r,N=w-s,F=X2(T,f),j=Math.exp(-I);return sK-N/F*j},d=T=>{const I=T*f*r,N=I*s+s,F=Math.pow(f,2)*Math.pow(T,2)*r,j=Math.exp(-I),G=X2(Math.pow(T,2),f);return(-l(T)+sK>0?-1:1)*((N-F)*j)/G}):(l=T=>{const w=Math.exp(-T*r),I=(T-s)*r+1;return-.001+w*I},d=T=>{const w=Math.exp(-T*r),I=(s-T)*(r*r);return w*I});const E=5/r,v=BIe(l,d,E);if(r=ff(r),isNaN(v))return{stiffness:Es.stiffness,damping:Es.damping,duration:r};{const T=Math.pow(v,2)*a;return{stiffness:T,damping:f*2*Math.sqrt(a*T),duration:r}}}const jIe=12;function BIe(r,t,s){let a=s;for(let l=1;l<jIe;l++)a=a-r(a)/t(a);return a}function X2(r,t){return r*Math.sqrt(1-t*t)}const WIe=["duration","bounce"],zIe=["stiffness","damping","mass"];function oK(r,t){return t.some(s=>r[s]!==void 0)}function GIe(r){let t={velocity:Es.velocity,stiffness:Es.stiffness,damping:Es.damping,mass:Es.mass,isResolvedFromDuration:!1,...r};if(!oK(r,zIe)&&oK(r,WIe))if(r.visualDuration){const s=r.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*yf(.05,1,1-(r.bounce||0))*Math.sqrt(l);t={...t,mass:Es.mass,stiffness:l,damping:d}}else{const s=FIe(r);t={...t,...s,mass:Es.mass},t.isResolvedFromDuration=!0}return t}function TZ(r=Es.visualDuration,t=Es.bounce){const s=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:t}:r;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],f=s.keyframes[s.keyframes.length-1],E={done:!1,value:d},{stiffness:v,damping:T,mass:w,duration:I,velocity:N,isResolvedFromDuration:F}=GIe({...s,velocity:-mf(s.velocity||0)}),j=N||0,G=T/(2*Math.sqrt(v*w)),H=f-d,te=mf(Math.sqrt(v/w)),K=Math.abs(H)<5;a||(a=K?Es.restSpeed.granular:Es.restSpeed.default),l||(l=K?Es.restDelta.granular:Es.restDelta.default);let Q;if(G<1){const se=X2(te,G);Q=ge=>{const ee=Math.exp(-G*te*ge);return f-ee*((j+G*te*H)/se*Math.sin(se*ge)+H*Math.cos(se*ge))}}else if(G===1)Q=se=>f-Math.exp(-te*se)*(H+(j+te*H)*se);else{const se=te*Math.sqrt(G*G-1);Q=ge=>{const ee=Math.exp(-G*te*ge),Z=Math.min(se*ge,300);return f-ee*((j+G*te*H)*Math.sinh(Z)+se*H*Math.cosh(Z))/se}}const de={calculatedDuration:F&&I||null,next:se=>{const ge=Q(se);if(F)E.done=se>=I;else{let ee=0;G<1&&(ee=se===0?ff(j):SZ(Q,se,ge));const Z=Math.abs(ee)<=a,ne=Math.abs(f-ge)<=l;E.done=Z&&ne}return E.value=E.done?f:ge,E},toString:()=>{const se=Math.min(jQ(de),W2),ge=BQ(ee=>de.next(se*ee).value,se,30);return se+"ms "+ge}};return de}function aK({keyframes:r,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:E,max:v,restDelta:T=.5,restSpeed:w}){const I=r[0],N={done:!1,value:I},F=Z=>E!==void 0&&Z<E||v!==void 0&&Z>v,j=Z=>E===void 0?v:v===void 0||Math.abs(E-Z)<Math.abs(v-Z)?E:v;let G=s*t;const H=I+G,te=f===void 0?H:f(H);te!==H&&(G=te-I);const K=Z=>-G*Math.exp(-Z/a),Q=Z=>te+K(Z),de=Z=>{const ne=K(Z),ae=Q(Z);N.done=Math.abs(ne)<=T,N.value=N.done?te:ae};let se,ge;const ee=Z=>{F(N.value)&&(se=Z,ge=TZ({keyframes:[N.value,j(N.value)],velocity:SZ(Q,Z,N.value),damping:l,stiffness:d,restDelta:T,restSpeed:w}))};return ee(0),{calculatedDuration:null,next:Z=>{let ne=!1;return!ge&&se===void 0&&(ne=!0,de(Z),ee(Z)),se!==void 0&&Z>=se?ge.next(Z-se):(!ne&&de(Z),N)}}}const HIe=wR(.42,0,1,1),$Ie=wR(0,0,.58,1),bZ=wR(.42,0,.58,1),KIe=r=>Array.isArray(r)&&typeof r[0]!="number",qIe={linear:Il,easeIn:HIe,easeInOut:bZ,easeOut:$Ie,circIn:nF,circInOut:rZ,circOut:nZ,backIn:tF,backInOut:eZ,backOut:ZQ,anticipate:tZ},cK=r=>{if(XV(r)){vQ(r.length===4);const[t,s,a,l]=r;return wR(t,s,a,l)}else if(typeof r=="string")return qIe[r];return r};function YIe(r,t,s){const a=[],l=s||vZ,d=r.length-1;for(let f=0;f<d;f++){let E=l(r[f],r[f+1]);if(t){const v=Array.isArray(t)?t[f]||Il:t;E=RR(v,E)}a.push(E)}return a}function XIe(r,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=r.length;if(vQ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const f=r[0]===r[1];r[0]>r[d-1]&&(r=[...r].reverse(),t=[...t].reverse());const E=YIe(t,a,l),v=E.length,T=w=>{if(f&&w<r[0])return t[0];let I=0;if(v>1)for(;I<r.length-2&&!(w<r[I+1]);I++);const N=WS(r[I],r[I+1],w);return E[I](N)};return s?w=>T(yf(r[0],r[d-1],w)):T}function JIe(r,t){const s=r[r.length-1];for(let a=1;a<=t;a++){const l=WS(0,t,a);r.push(es(s,1,l))}}function QIe(r){const t=[0];return JIe(t,r.length-1),t}function ZIe(r,t){return r.map(s=>s*t)}function eAe(r,t){return r.map(()=>t||bZ).splice(0,r.length-1)}function tk({duration:r=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=KIe(a)?a.map(cK):cK(a),d={done:!1,value:t[0]},f=ZIe(s&&s.length===t.length?s:QIe(t),r),E=XIe(f,t,{ease:Array.isArray(l)?l:eAe(t,l)});return{calculatedDuration:r,next:v=>(d.value=E(v),d.done=v>=r,d)}}const tAe=r=>{const t=({timestamp:s})=>r(s);return{start:()=>Ui.update(t,!0),stop:()=>lg(t),now:()=>qo.isProcessing?qo.timestamp:Fh.now()}},nAe={decay:aK,inertia:aK,tween:tk,keyframes:tk,spring:TZ},rAe=r=>r/100;class cF extends EZ{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||oF,E=(v,T)=>this.onKeyframesResolved(v,T);this.resolver=new f(d,E,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,E=YV(s)?s:nAe[s]||tk;let v,T;E!==tk&&typeof t[0]!="number"&&(v=RR(rAe,vZ(t[0],t[1])),t=[0,100]);const w=E({...this.options,keyframes:t});d==="mirror"&&(T=E({...this.options,keyframes:[...t].reverse(),velocity:-f})),w.calculatedDuration===null&&(w.calculatedDuration=jQ(w));const{calculatedDuration:I}=w,N=I+l,F=N*(a+1)-l;return{generator:w,mirroredGenerator:T,mapPercentToKeyframes:v,calculatedDuration:I,resolvedDuration:N,totalDuration:F}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:Z}=this.options;return{done:!0,value:Z[Z.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:E,keyframes:v,calculatedDuration:T,totalDuration:w,resolvedDuration:I}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:F,repeatType:j,repeatDelay:G,onUpdate:H}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-w/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const te=this.currentTime-N*(this.speed>=0?1:-1),K=this.speed>=0?te<0:te>w;this.currentTime=Math.max(te,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let Q=this.currentTime,de=d;if(F){const Z=Math.min(this.currentTime,w)/I;let ne=Math.floor(Z),ae=Z%1;!ae&&Z>=1&&(ae=1),ae===1&&ne--,ne=Math.min(ne,F+1),!!(ne%2)&&(j==="reverse"?(ae=1-ae,G&&(ae-=G/I)):j==="mirror"&&(de=f)),Q=yf(0,1,ae)*I}const se=K?{done:!1,value:v[0]}:de.next(Q);E&&(se.value=E(se.value));let{done:ge}=se;!K&&T!==null&&(ge=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const ee=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ge);return ee&&l!==void 0&&(se.value=Xk(v,this.options,l)),H&&H(se.value),ee&&this.finish(),se}get duration(){const{resolved:t}=this;return t?mf(t.calculatedDuration):0}get time(){return mf(this.currentTime)}set time(t){t=ff(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=mf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=tAe,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const iAe=new Set(["opacity","clipPath","filter","transform"]);function sAe(r,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:E="easeInOut",times:v}={}){const T={[t]:s};v&&(T.offset=v);const w=zQ(E,l);return Array.isArray(w)&&(T.easing=w),r.animate(T,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const oAe=LV(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),nk=10,aAe=2e4;function cAe(r){return YV(r.type)||r.type==="spring"||!WQ(r.ease)}function lAe(r,t){const s=new cF({...t,keyframes:r,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:r[0]};const l=[];let d=0;for(;!a.done&&d<aAe;)a=s.sample(d),l.push(a.value),d+=nk;return{times:void 0,keyframes:l,duration:d-nk,ease:"linear"}}const wZ={anticipate:tZ,backInOut:eZ,circInOut:rZ};function uAe(r){return r in wZ}class lK extends EZ{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new _Z(d,(f,E)=>this.onKeyframesResolved(f,E),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:f,motionValue:E,name:v,startTime:T}=this.options;if(!E.owner||!E.owner.current)return!1;if(typeof d=="string"&&ZO()&&uAe(d)&&(d=wZ[d]),cAe(this.options)){const{onComplete:I,onUpdate:N,motionValue:F,element:j,...G}=this.options,H=lAe(t,G);t=H.keyframes,t.length===1&&(t[1]=t[0]),a=H.duration,l=H.times,d=H.ease,f="keyframes"}const w=sAe(E.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return w.startTime=T??this.calcStartTime(),this.pendingTimeline?($$(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:I}=this.options;E.set(Xk(t,this.options,s)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:f,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return mf(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return mf(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=ff(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Il;const{animation:a}=s;$$(a,t)}return Il}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:f,times:E}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:T,onUpdate:w,onComplete:I,element:N,...F}=this.options,j=new cF({...F,keyframes:a,duration:l,type:d,ease:f,times:E,isGenerator:!0}),G=ff(this.time);T.setWithVelocity(j.sample(G-nk).value,j.sample(G).value,nk)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:f,type:E}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:T}=s.owner.getProps();return oAe()&&a&&iAe.has(a)&&!v&&!T&&!l&&d!=="mirror"&&f!==0&&E!=="inertia"}}const dAe={type:"spring",stiffness:500,damping:25,restSpeed:10},hAe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),pAe={type:"keyframes",duration:.8},fAe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},mAe=(r,{keyframes:t})=>t.length>2?pAe:IE.has(r)?r.startsWith("scale")?hAe(t[1]):dAe:fAe;function gAe({when:r,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:E,from:v,elapsed:T,...w}){return!!Object.keys(w).length}const lF=(r,t,s,a={},l,d)=>f=>{const E=qV(a,r)||{},v=E.delay||a.delay||0;let{elapsed:T=0}=a;T=T-ff(v);let w={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-T,onUpdate:N=>{t.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{f(),E.onComplete&&E.onComplete()},name:r,motionValue:t,element:d?void 0:l};gAe(E)||(w={...w,...mAe(r,w)}),w.duration&&(w.duration=ff(w.duration)),w.repeatDelay&&(w.repeatDelay=ff(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let I=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(I=!0)),I&&!d&&t.get()!==void 0){const N=Xk(w.keyframes,E);if(N!==void 0)return Ui.update(()=>{w.onUpdate(N),w.onComplete()}),new xCe([])}return!d&&lK.supports(w)?new lK(w):new cF(w)};function _Ae({protectedKeys:r,needsAnimating:t},s){const a=r.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function RZ(r,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:f=r.getDefaultTransition(),transitionEnd:E,...v}=t;a&&(f=a);const T=[],w=l&&r.animationState&&r.animationState.getState()[l];for(const I in v){const N=r.getValue(I,(d=r.latestValues[I])!==null&&d!==void 0?d:null),F=v[I];if(F===void 0||w&&_Ae(w,I))continue;const j={delay:s,...qV(f||{},I)};let G=!1;if(window.MotionHandoffAnimation){const te=YQ(r);if(te){const K=window.MotionHandoffAnimation(te,I,Ui);K!==null&&(j.startTime=K,G=!0)}}G2(r,I),N.start(lF(I,N,F,r.shouldReduceMotion&&KQ.has(I)?{type:!1}:j,r,G));const H=N.animation;H&&T.push(H)}return E&&Promise.all(T).then(()=>{Ui.update(()=>{E&&YCe(r,E)})}),T}function J2(r,t,s={}){var a;const l=Yk(r,t,s.type==="exit"?(a=r.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=r.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const f=l?()=>Promise.all(RZ(r,l,s)):()=>Promise.resolve(),E=r.variantChildren&&r.variantChildren.size?(T=0)=>{const{delayChildren:w=0,staggerChildren:I,staggerDirection:N}=d;return EAe(r,t,w+T,I,N,s)}:()=>Promise.resolve(),{when:v}=d;if(v){const[T,w]=v==="beforeChildren"?[f,E]:[E,f];return T().then(()=>w())}else return Promise.all([f(),E(s.delay)])}function EAe(r,t,s=0,a=0,l=1,d){const f=[],E=(r.variantChildren.size-1)*a,v=l===1?(T=0)=>T*a:(T=0)=>E-T*a;return Array.from(r.variantChildren).sort(yAe).forEach((T,w)=>{T.notify("AnimationStart",t),f.push(J2(T,t,{...d,delay:s+v(w)}).then(()=>T.notify("AnimationComplete",t)))}),Promise.all(f)}function yAe(r,t){return r.sortNodePosition(t)}function vAe(r,t,s={}){r.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>J2(r,d,s));a=Promise.all(l)}else if(typeof t=="string")a=J2(r,t,s);else{const l=typeof t=="function"?Yk(r,t,s.custom):t;a=Promise.all(RZ(r,l,s))}return a.then(()=>{r.notify("AnimationComplete",t)})}const SAe=MV.length;function CZ(r){if(!r)return;if(!r.isControllingVariants){const s=r.parent?CZ(r.parent)||{}:{};return r.props.initial!==void 0&&(s.initial=r.props.initial),s}const t={};for(let s=0;s<SAe;s++){const a=MV[s],l=r.props[a];(Yw(l)||l===!1)&&(t[a]=l)}return t}const TAe=[...xV].reverse(),bAe=xV.length;function wAe(r){return t=>Promise.all(t.map(({animation:s,options:a})=>vAe(r,s,a)))}function RAe(r){let t=wAe(r),s=uK(),a=!0;const l=v=>(T,w)=>{var I;const N=Yk(r,w,v==="exit"?(I=r.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(N){const{transition:F,transitionEnd:j,...G}=N;T={...T,...G,...j}}return T};function d(v){t=v(r)}function f(v){const{props:T}=r,w=CZ(r.parent)||{},I=[],N=new Set;let F={},j=1/0;for(let H=0;H<bAe;H++){const te=TAe[H],K=s[te],Q=T[te]!==void 0?T[te]:w[te],de=Yw(Q),se=te===v?K.isActive:null;se===!1&&(j=H);let ge=Q===w[te]&&Q!==T[te]&&de;if(ge&&a&&r.manuallyAnimateOnMount&&(ge=!1),K.protectedKeys={...F},!K.isActive&&se===null||!Q&&!K.prevProp||Kk(Q)||typeof Q=="boolean")continue;const ee=CAe(K.prevProp,Q);let Z=ee||te===v&&K.isActive&&!ge&&de||H>j&&de,ne=!1;const ae=Array.isArray(Q)?Q:[Q];let me=ae.reduce(l(te),{});se===!1&&(me={});const{prevResolvedValues:he={}}=K,le={...he,...me},Me=Ee=>{Z=!0,N.has(Ee)&&(ne=!0,N.delete(Ee)),K.needsAnimating[Ee]=!0;const we=r.getValue(Ee);we&&(we.liveStyle=!1)};for(const Ee in le){const we=me[Ee],ve=he[Ee];if(F.hasOwnProperty(Ee))continue;let Be=!1;B2(we)&&B2(ve)?Be=!FQ(we,ve):Be=we!==ve,Be?we!=null?Me(Ee):N.add(Ee):we!==void 0&&N.has(Ee)?Me(Ee):K.protectedKeys[Ee]=!0}K.prevProp=Q,K.prevResolvedValues=me,K.isActive&&(F={...F,...me}),a&&r.blockInitialAnimation&&(Z=!1),Z&&(!(ge&&ee)||ne)&&I.push(...ae.map(Ee=>({animation:Ee,options:{type:te}})))}if(N.size){const H={};N.forEach(te=>{const K=r.getBaseTarget(te),Q=r.getValue(te);Q&&(Q.liveStyle=!0),H[te]=K??null}),I.push({animation:H})}let G=!!I.length;return a&&(T.initial===!1||T.initial===T.animate)&&!r.manuallyAnimateOnMount&&(G=!1),a=!1,G?t(I):Promise.resolve()}function E(v,T){var w;if(s[v].isActive===T)return Promise.resolve();(w=r.variantChildren)===null||w===void 0||w.forEach(N=>{var F;return(F=N.animationState)===null||F===void 0?void 0:F.setActive(v,T)}),s[v].isActive=T;const I=f(v);for(const N in s)s[N].protectedKeys={};return I}return{animateChanges:f,setActive:E,setAnimateFunction:d,getState:()=>s,reset:()=>{s=uK(),a=!0}}}function CAe(r,t){return typeof t=="string"?t!==r:Array.isArray(t)?!FQ(t,r):!1}function $_(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function uK(){return{animate:$_(!0),whileInView:$_(),whileHover:$_(),whileTap:$_(),whileDrag:$_(),whileFocus:$_(),exit:$_()}}class yg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class IAe extends yg{constructor(t){super(t),t.animationState||(t.animationState=RAe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();Kk(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let AAe=0;class PAe extends yg{constructor(){super(...arguments),this.id=AAe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const OAe={animation:{Feature:IAe},exit:{Feature:PAe}};function Zw(r,t,s,a={passive:!0}){return r.addEventListener(t,s,a),()=>r.removeEventListener(t,s)}function CR(r){return{point:{x:r.pageX,y:r.pageY}}}const kAe=r=>t=>JV(t)&&r(t,CR(t));function Pw(r,t,s,a){return Zw(r,t,kAe(s),a)}const dK=(r,t)=>Math.abs(r-t);function NAe(r,t){const s=dK(r.x,t.x),a=dK(r.y,t.y);return Math.sqrt(s**2+a**2)}class IZ{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=UM(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,F=NAe(I.offset,{x:0,y:0})>=3;if(!N&&!F)return;const{point:j}=I,{timestamp:G}=qo;this.history.push({...j,timestamp:G});const{onStart:H,onMove:te}=this.handlers;N||(H&&H(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),te&&te(this.lastMoveEvent,I)},this.handlePointerMove=(I,N)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=MM(N,this.transformPagePoint),Ui.update(this.updatePoint,!0)},this.handlePointerUp=(I,N)=>{this.end();const{onEnd:F,onSessionEnd:j,resumeAnimation:G}=this.handlers;if(this.dragSnapToOrigin&&G&&G(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const H=UM(I.type==="pointercancel"?this.lastMoveEventInfo:MM(N,this.transformPagePoint),this.history);this.startEvent&&F&&F(I,H),j&&j(I,H)},!JV(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const f=CR(t),E=MM(f,this.transformPagePoint),{point:v}=E,{timestamp:T}=qo;this.history=[{...v,timestamp:T}];const{onSessionStart:w}=s;w&&w(t,UM(E,this.history)),this.removeListeners=RR(Pw(this.contextWindow,"pointermove",this.handlePointerMove),Pw(this.contextWindow,"pointerup",this.handlePointerUp),Pw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),lg(this.updatePoint)}}function MM(r,t){return t?{point:t(r.point)}:r}function hK(r,t){return{x:r.x-t.x,y:r.y-t.y}}function UM({point:r},t){return{point:r,delta:hK(r,AZ(t)),offset:hK(r,DAe(t)),velocity:LAe(t,.1)}}function DAe(r){return r[0]}function AZ(r){return r[r.length-1]}function LAe(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=AZ(r);for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>ff(t)));)s--;if(!a)return{x:0,y:0};const d=mf(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const PZ=1e-4,xAe=1-PZ,MAe=1+PZ,OZ=.01,UAe=0-OZ,VAe=0+OZ;function Al(r){return r.max-r.min}function FAe(r,t,s){return Math.abs(r-t)<=s}function pK(r,t,s,a=.5){r.origin=a,r.originPoint=es(t.min,t.max,r.origin),r.scale=Al(s)/Al(t),r.translate=es(s.min,s.max,r.origin)-r.originPoint,(r.scale>=xAe&&r.scale<=MAe||isNaN(r.scale))&&(r.scale=1),(r.translate>=UAe&&r.translate<=VAe||isNaN(r.translate))&&(r.translate=0)}function Ow(r,t,s,a){pK(r.x,t.x,s.x,a?a.originX:void 0),pK(r.y,t.y,s.y,a?a.originY:void 0)}function fK(r,t,s){r.min=s.min+t.min,r.max=r.min+Al(t)}function jAe(r,t,s){fK(r.x,t.x,s.x),fK(r.y,t.y,s.y)}function mK(r,t,s){r.min=t.min-s.min,r.max=r.min+Al(t)}function kw(r,t,s){mK(r.x,t.x,s.x),mK(r.y,t.y,s.y)}function BAe(r,{min:t,max:s},a){return t!==void 0&&r<t?r=a?es(t,r,a.min):Math.max(r,t):s!==void 0&&r>s&&(r=a?es(s,r,a.max):Math.min(r,s)),r}function gK(r,t,s){return{min:t!==void 0?r.min+t:void 0,max:s!==void 0?r.max+s-(r.max-r.min):void 0}}function WAe(r,{top:t,left:s,bottom:a,right:l}){return{x:gK(r.x,s,l),y:gK(r.y,t,a)}}function _K(r,t){let s=t.min-r.min,a=t.max-r.max;return t.max-t.min<r.max-r.min&&([s,a]=[a,s]),{min:s,max:a}}function zAe(r,t){return{x:_K(r.x,t.x),y:_K(r.y,t.y)}}function GAe(r,t){let s=.5;const a=Al(r),l=Al(t);return l>a?s=WS(t.min,t.max-a,r.min):a>l&&(s=WS(r.min,r.max-l,t.min)),yf(0,1,s)}function HAe(r,t){const s={};return t.min!==void 0&&(s.min=t.min-r.min),t.max!==void 0&&(s.max=t.max-r.min),s}const Q2=.35;function $Ae(r=Q2){return r===!1?r=0:r===!0&&(r=Q2),{x:EK(r,"left","right"),y:EK(r,"top","bottom")}}function EK(r,t,s){return{min:yK(r,t),max:yK(r,s)}}function yK(r,t){return typeof r=="number"?r:r[t]||0}const vK=()=>({translate:0,scale:1,origin:0,originPoint:0}),_S=()=>({x:vK(),y:vK()}),SK=()=>({min:0,max:0}),Is=()=>({x:SK(),y:SK()});function _u(r){return[r("x"),r("y")]}function kZ({top:r,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:r,max:a}}}function KAe({x:r,y:t}){return{top:t.min,right:r.max,bottom:t.max,left:r.min}}function qAe(r,t){if(!t)return r;const s=t({x:r.left,y:r.top}),a=t({x:r.right,y:r.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function VM(r){return r===void 0||r===1}function Z2({scale:r,scaleX:t,scaleY:s}){return!VM(r)||!VM(t)||!VM(s)}function q_(r){return Z2(r)||NZ(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function NZ(r){return TK(r.x)||TK(r.y)}function TK(r){return r&&r!=="0%"}function rk(r,t,s){const a=r-s,l=t*a;return s+l}function bK(r,t,s,a,l){return l!==void 0&&(r=rk(r,l,a)),rk(r,s,a)+t}function eU(r,t=0,s=1,a,l){r.min=bK(r.min,t,s,a,l),r.max=bK(r.max,t,s,a,l)}function DZ(r,{x:t,y:s}){eU(r.x,t.translate,t.scale,t.originPoint),eU(r.y,s.translate,s.scale,s.originPoint)}const wK=.999999999999,RK=1.0000000000001;function YAe(r,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,f;for(let E=0;E<l;E++){d=s[E],f=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&yS(r,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,DZ(r,f)),a&&q_(d.latestValues)&&yS(r,d.latestValues))}t.x<RK&&t.x>wK&&(t.x=1),t.y<RK&&t.y>wK&&(t.y=1)}function ES(r,t){r.min=r.min+t,r.max=r.max+t}function CK(r,t,s,a,l=.5){const d=es(r.min,r.max,l);eU(r,t,s,d,a)}function yS(r,t){CK(r.x,t.x,t.scaleX,t.scale,t.originX),CK(r.y,t.y,t.scaleY,t.scale,t.originY)}function LZ(r,t){return kZ(qAe(r.getBoundingClientRect(),t))}function XAe(r,t,s){const a=LZ(r,s),{scroll:l}=t;return l&&(ES(a.x,l.offset.x),ES(a.y,l.offset.y)),a}const xZ=({current:r})=>r?r.ownerDocument.defaultView:null,JAe=new WeakMap;class QAe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Is(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(CR(w).point)},d=(w,I)=>{const{drag:N,dragPropagation:F,onDragStart:j}=this.getProps();if(N&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=GCe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),_u(H=>{let te=this.getAxisMotionValue(H).get()||0;if(Vh.test(te)){const{projection:K}=this.visualElement;if(K&&K.layout){const Q=K.layout.layoutBox[H];Q&&(te=Al(Q)*(parseFloat(te)/100))}}this.originPoint[H]=te}),j&&Ui.postRender(()=>j(w,I)),G2(this.visualElement,"transform");const{animationState:G}=this.visualElement;G&&G.setActive("whileDrag",!0)},f=(w,I)=>{const{dragPropagation:N,dragDirectionLock:F,onDirectionLock:j,onDrag:G}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:H}=I;if(F&&this.currentDirection===null){this.currentDirection=ZAe(H),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",I.point,H),this.updateAxis("y",I.point,H),this.visualElement.render(),G&&G(w,I)},E=(w,I)=>this.stop(w,I),v=()=>_u(w=>{var I;return this.getAnimationState(w)==="paused"&&((I=this.getAxisMotionValue(w).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:T}=this.getProps();this.panSession=new IZ(t,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:E,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,contextWindow:xZ(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Ui.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!KP(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let f=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(f=BAe(f,this.constraints[t],this.elastic[t])),d.set(f)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&mS(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=WAe(l.layoutBox,s):this.constraints=!1,this.elastic=$Ae(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&_u(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=HAe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!mS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=XAe(a,l.root,this.visualElement.getTransformPagePoint());let f=zAe(l.layout.layoutBox,d);if(s){const E=s(KAe(f));this.hasMutatedConstraints=!!E,E&&(f=kZ(E))}return f}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:E}=this.getProps(),v=this.constraints||{},T=_u(w=>{if(!KP(w,s,this.currentDirection))return;let I=v&&v[w]||{};f&&(I={min:0,max:0});const N=l?200:1e6,F=l?40:1e7,j={type:"inertia",velocity:a?t[w]:0,bounceStiffness:N,bounceDamping:F,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(w,j)});return Promise.all(T).then(E)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return G2(this.visualElement,t),a.start(lF(t,a,0,s,this.visualElement,!1))}stopAnimation(){_u(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){_u(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){_u(s=>{const{drag:a}=this.getProps();if(!KP(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:f,max:E}=l.layout.layoutBox[s];d.set(t[s]-es(f,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!mS(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};_u(f=>{const E=this.getAxisMotionValue(f);if(E&&this.constraints!==!1){const v=E.get();l[f]=GAe({min:v,max:v},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),_u(f=>{if(!KP(f,t,null))return;const E=this.getAxisMotionValue(f),{min:v,max:T}=this.constraints[f];E.set(es(v,T,l[f]))})}addListeners(){if(!this.visualElement.current)return;JAe.set(this.visualElement,this);const t=this.visualElement.current,s=Pw(t,"pointerdown",v=>{const{drag:T,dragListener:w=!0}=this.getProps();T&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();mS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Ui.read(a);const f=Zw(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:T})=>{this.isDragging&&T&&(_u(w=>{const I=this.getAxisMotionValue(w);I&&(this.originPoint[w]+=v[w].translate,I.set(I.get()+v[w].translate))}),this.visualElement.render())});return()=>{f(),s(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=Q2,dragMomentum:E=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:E}}}function KP(r,t,s){return(t===!0||t===r)&&(s===null||s===r)}function ZAe(r,t=10){let s=null;return Math.abs(r.y)>t?s="y":Math.abs(r.x)>t&&(s="x"),s}class ePe extends yg{constructor(t){super(t),this.removeGroupControls=Il,this.removeListeners=Il,this.controls=new QAe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Il}unmount(){this.removeGroupControls(),this.removeListeners()}}const IK=r=>(t,s)=>{r&&Ui.postRender(()=>r(t,s))};class tPe extends yg{constructor(){super(...arguments),this.removePointerDownListener=Il}onPointerDown(t){this.session=new IZ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:xZ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:IK(t),onStart:IK(s),onMove:a,onEnd:(d,f)=>{delete this.session,l&&Ui.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=Pw(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const CO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function AK(r,t){return t.max===t.min?0:r/(t.max-t.min)*100}const zb={correct:(r,t)=>{if(!t.target)return r;if(typeof r=="string")if(Dn.test(r))r=parseFloat(r);else return r;const s=AK(r,t.target.x),a=AK(r,t.target.y);return`${s}% ${a}%`}},nPe={correct:(r,{treeScale:t,projectionDelta:s})=>{const a=r,l=ug.parse(r);if(l.length>5)return a;const d=ug.createTransformer(r),f=typeof l[0]!="number"?1:0,E=s.x.scale*t.x,v=s.y.scale*t.y;l[0+f]/=E,l[1+f]/=v;const T=es(E,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=T),typeof l[3+f]=="number"&&(l[3+f]/=T),d(l)}};class rPe extends L.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;bCe(iPe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),CO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||t.layoutDependency!==s||s===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?f.promote():f.relegate()||Ui.postRender(()=>{const E=f.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),VV.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function MZ(r){const[t,s]=NV(),a=L.useContext(PV);return O.jsx(rPe,{...r,layoutGroup:a,switchLayoutGroup:L.useContext(CQ),isPresent:t,safeToRemove:s})}const iPe={borderRadius:{...zb,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:zb,borderTopRightRadius:zb,borderBottomLeftRadius:zb,borderBottomRightRadius:zb,boxShadow:nPe};function sPe(r,t,s){const a=Pa(r)?r:Jw(r);return a.start(lF("",a,t,s)),a.animation}function oPe(r){return r instanceof SVGElement&&r.tagName!=="svg"}const aPe=(r,t)=>r.depth-t.depth;class cPe{constructor(){this.children=[],this.isDirty=!1}add(t){QV(this.children,t),this.isDirty=!0}remove(t){ZV(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(aPe),this.isDirty=!1,this.children.forEach(t)}}function lPe(r,t){const s=Fh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(lg(a),r(d-t))};return Ui.read(a,!0),()=>lg(a)}const UZ=["TopLeft","TopRight","BottomLeft","BottomRight"],uPe=UZ.length,PK=r=>typeof r=="string"?parseFloat(r):r,OK=r=>typeof r=="number"||Dn.test(r);function dPe(r,t,s,a,l,d){l?(r.opacity=es(0,s.opacity!==void 0?s.opacity:1,hPe(a)),r.opacityExit=es(t.opacity!==void 0?t.opacity:1,0,pPe(a))):d&&(r.opacity=es(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let f=0;f<uPe;f++){const E=`border${UZ[f]}Radius`;let v=kK(t,E),T=kK(s,E);if(v===void 0&&T===void 0)continue;v||(v=0),T||(T=0),v===0||T===0||OK(v)===OK(T)?(r[E]=Math.max(es(PK(v),PK(T),a),0),(Vh.test(T)||Vh.test(v))&&(r[E]+="%")):r[E]=T}(t.rotate||s.rotate)&&(r.rotate=es(t.rotate||0,s.rotate||0,a))}function kK(r,t){return r[t]!==void 0?r[t]:r.borderRadius}const hPe=VZ(0,.5,nZ),pPe=VZ(.5,.95,Il);function VZ(r,t,s){return a=>a<r?0:a>t?1:s(WS(r,t,a))}function NK(r,t){r.min=t.min,r.max=t.max}function fu(r,t){NK(r.x,t.x),NK(r.y,t.y)}function DK(r,t){r.translate=t.translate,r.scale=t.scale,r.originPoint=t.originPoint,r.origin=t.origin}function LK(r,t,s,a,l){return r-=t,r=rk(r,1/s,a),l!==void 0&&(r=rk(r,1/l,a)),r}function fPe(r,t=0,s=1,a=.5,l,d=r,f=r){if(Vh.test(t)&&(t=parseFloat(t),t=es(f.min,f.max,t/100)-f.min),typeof t!="number")return;let E=es(d.min,d.max,a);r===d&&(E-=t),r.min=LK(r.min,t,s,E,l),r.max=LK(r.max,t,s,E,l)}function xK(r,t,[s,a,l],d,f){fPe(r,t[s],t[a],t[l],t.scale,d,f)}const mPe=["x","scaleX","originX"],gPe=["y","scaleY","originY"];function MK(r,t,s,a){xK(r.x,t,mPe,s?s.x:void 0,a?a.x:void 0),xK(r.y,t,gPe,s?s.y:void 0,a?a.y:void 0)}function UK(r){return r.translate===0&&r.scale===1}function FZ(r){return UK(r.x)&&UK(r.y)}function VK(r,t){return r.min===t.min&&r.max===t.max}function _Pe(r,t){return VK(r.x,t.x)&&VK(r.y,t.y)}function FK(r,t){return Math.round(r.min)===Math.round(t.min)&&Math.round(r.max)===Math.round(t.max)}function jZ(r,t){return FK(r.x,t.x)&&FK(r.y,t.y)}function jK(r){return Al(r.x)/Al(r.y)}function BK(r,t){return r.translate===t.translate&&r.scale===t.scale&&r.originPoint===t.originPoint}class EPe{constructor(){this.members=[]}add(t){QV(this.members,t),t.scheduleRender()}remove(t){if(ZV(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function yPe(r,t,s){let a="";const l=r.x.translate/t.x,d=r.y.translate/t.y,f=(s==null?void 0:s.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:T,rotate:w,rotateX:I,rotateY:N,skewX:F,skewY:j}=s;T&&(a=`perspective(${T}px) ${a}`),w&&(a+=`rotate(${w}deg) `),I&&(a+=`rotateX(${I}deg) `),N&&(a+=`rotateY(${N}deg) `),F&&(a+=`skewX(${F}deg) `),j&&(a+=`skewY(${j}deg) `)}const E=r.x.scale*t.x,v=r.y.scale*t.y;return(E!==1||v!==1)&&(a+=`scale(${E}, ${v})`),a||"none"}const Y_={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},hw=typeof window<"u"&&window.MotionDebug!==void 0,FM=["","X","Y","Z"],vPe={visibility:"hidden"},WK=1e3;let SPe=0;function jM(r,t,s,a){const{latestValues:l}=t;l[r]&&(s[r]=l[r],t.setStaticValue(r,0),a&&(a[r]=0))}function BZ(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:t}=r.options;if(!t)return;const s=YQ(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=r.options;window.MotionCancelOptimisedAnimation(s,"transform",Ui,!(l||d))}const{parent:a}=r;a&&!a.hasCheckedOptimisedAppear&&BZ(a)}function WZ({attachResizeListener:r,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},E=t==null?void 0:t()){this.id=SPe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,hw&&(Y_.totalNodes=Y_.resolvedTargetDeltas=Y_.recalculatedProjection=0),this.nodes.forEach(wPe),this.nodes.forEach(PPe),this.nodes.forEach(OPe),this.nodes.forEach(RPe),hw&&window.MotionDebug.record(Y_)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new cPe)}addEventListener(f,E){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new eF),this.eventHandlers.get(f).add(E)}notifyListeners(f,...E){const v=this.eventHandlers.get(f);v&&v.notify(...E)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=oPe(f),this.instance=f;const{layoutId:v,layout:T,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(T||v)&&(this.isLayoutDirty=!0),r){let I;const N=()=>this.root.updateBlockedByResize=!1;r(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=lPe(N,250),CO.hasAnimatedSinceResize&&(CO.hasAnimatedSinceResize=!1,this.nodes.forEach(GK))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||T)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:N,hasRelativeTargetChanged:F,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||w.getDefaultTransition()||xPe,{onLayoutAnimationStart:H,onLayoutAnimationComplete:te}=w.getProps(),K=!this.targetLayout||!jZ(this.targetLayout,j)||F,Q=!N&&F;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||Q||N&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,Q);const de={...qV(G,"layout"),onPlay:H,onComplete:te};(w.shouldReduceMotion||this.options.layoutRoot)&&(de.delay=0,de.type=!1),this.startAnimation(de)}else N||GK(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,lg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(kPe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&BZ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const I=this.path[w];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:E,layout:v}=this.options;if(E===void 0&&!v)return;const T=this.getTransformTemplate();this.prevTransformTemplateValue=T?T(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(zK);return}this.isUpdating||this.nodes.forEach(IPe),this.isUpdating=!1,this.nodes.forEach(APe),this.nodes.forEach(TPe),this.nodes.forEach(bPe),this.clearAllSnapshots();const E=Fh.now();qo.delta=yf(0,1e3/60,E-qo.timestamp),qo.timestamp=E,qo.isProcessing=!0,kM.update.process(qo),kM.preRender.process(qo),kM.render.process(qo),qo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,VV.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(CPe),this.sharedNodes.forEach(NPe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ui.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ui.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Is(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(E=!1),E){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!FZ(this.projectionDelta),v=this.getTransformTemplate(),T=v?v(this.latestValues,""):void 0,w=T!==this.prevTransformTemplateValue;f&&(E||q_(this.latestValues)||w)&&(l(this.instance,T),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const E=this.measurePageBox();let v=this.removeElementScroll(E);return f&&(v=this.removeTransform(v)),MPe(v),{animationId:this.root.animationId,measuredBox:E,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:E}=this.options;if(!E)return Is();const v=E.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(UPe))){const{scroll:w}=this.root;w&&(ES(v.x,w.offset.x),ES(v.y,w.offset.y))}return v}removeElementScroll(f){var E;const v=Is();if(fu(v,f),!((E=this.scroll)===null||E===void 0)&&E.wasRoot)return v;for(let T=0;T<this.path.length;T++){const w=this.path[T],{scroll:I,options:N}=w;w!==this.root&&I&&N.layoutScroll&&(I.wasRoot&&fu(v,f),ES(v.x,I.offset.x),ES(v.y,I.offset.y))}return v}applyTransform(f,E=!1){const v=Is();fu(v,f);for(let T=0;T<this.path.length;T++){const w=this.path[T];!E&&w.options.layoutScroll&&w.scroll&&w!==w.root&&yS(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),q_(w.latestValues)&&yS(v,w.latestValues)}return q_(this.latestValues)&&yS(v,this.latestValues),v}removeTransform(f){const E=Is();fu(E,f);for(let v=0;v<this.path.length;v++){const T=this.path[v];if(!T.instance||!q_(T.latestValues))continue;Z2(T.latestValues)&&T.updateSnapshot();const w=Is(),I=T.measurePageBox();fu(w,I),MK(E,T.latestValues,T.snapshot?T.snapshot.layoutBox:void 0,w)}return q_(this.latestValues)&&MK(E,this.latestValues),E}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==qo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var E;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const T=!!this.resumingFrom||this!==v;if(!(f||T&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:N}=this.options;if(!(!this.layout||!(I||N))){if(this.resolvedRelativeTargetAt=qo.timestamp,!this.targetDelta&&!this.relativeTarget){const F=this.getClosestProjectingParent();F&&F.layout&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Is(),this.relativeTargetOrigin=Is(),kw(this.relativeTargetOrigin,this.layout.layoutBox,F.layout.layoutBox),fu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Is(),this.targetWithTransforms=Is()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),jAe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):fu(this.target,this.layout.layoutBox),DZ(this.target,this.targetDelta)):fu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const F=this.getClosestProjectingParent();F&&!!F.resumingFrom==!!this.resumingFrom&&!F.options.layoutScroll&&F.target&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Is(),this.relativeTargetOrigin=Is(),kw(this.relativeTargetOrigin,this.target,F.target),fu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}hw&&Y_.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Z2(this.parent.latestValues)||NZ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const E=this.getLead(),v=!!this.resumingFrom||this!==E;let T=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(T=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(T=!1),this.resolvedRelativeTargetAt===qo.timestamp&&(T=!1),T)return;const{layout:w,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||I))return;fu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,F=this.treeScale.y;YAe(this.layoutCorrected,this.treeScale,this.path,v),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=Is());const{target:j}=E;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(DK(this.prevProjectionDelta.x,this.projectionDelta.x),DK(this.prevProjectionDelta.y,this.projectionDelta.y)),Ow(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==F||!BK(this.projectionDelta.x,this.prevProjectionDelta.x)||!BK(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j)),hw&&Y_.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var E;if((E=this.options.visualElement)===null||E===void 0||E.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=_S(),this.projectionDelta=_S(),this.projectionDeltaWithTransform=_S()}setAnimationOrigin(f,E=!1){const v=this.snapshot,T=v?v.latestValues:{},w={...this.latestValues},I=_S();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=Is(),F=v?v.source:void 0,j=this.layout?this.layout.source:void 0,G=F!==j,H=this.getStack(),te=!H||H.members.length<=1,K=!!(G&&!te&&this.options.crossfade===!0&&!this.path.some(LPe));this.animationProgress=0;let Q;this.mixTargetDelta=de=>{const se=de/1e3;HK(I.x,f.x,se),HK(I.y,f.y,se),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(kw(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),DPe(this.relativeTarget,this.relativeTargetOrigin,N,se),Q&&_Pe(this.relativeTarget,Q)&&(this.isProjectionDirty=!1),Q||(Q=Is()),fu(Q,this.relativeTarget)),G&&(this.animationValues=w,dPe(w,T,this.latestValues,se,K,te)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=se},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(lg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ui.update(()=>{CO.hasAnimatedSinceResize=!0,this.currentAnimation=sPe(0,WK,{...f,onUpdate:E=>{this.mixTargetDelta(E),f.onUpdate&&f.onUpdate(E)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(WK),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:E,target:v,layout:T,latestValues:w}=f;if(!(!E||!v||!T)){if(this!==f&&this.layout&&T&&zZ(this.options.animationType,this.layout.layoutBox,T.layoutBox)){v=this.target||Is();const I=Al(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+I;const N=Al(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+N}fu(E,v),yS(E,w),Ow(this.projectionDeltaWithTransform,this.layoutCorrected,E,w)}}registerSharedNode(f,E){this.sharedNodes.has(f)||this.sharedNodes.set(f,new EPe),this.sharedNodes.get(f).add(E);const T=E.options.initialPromotionConfig;E.promote({transition:T?T.transition:void 0,preserveFollowOpacity:T&&T.shouldPreserveFollowOpacity?T.shouldPreserveFollowOpacity(E):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:E}=this.options;return E?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:E}=this.options;return E?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:E,preserveFollowOpacity:v}={}){const T=this.getStack();T&&T.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let E=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(E=!0),!E)return;const T={};v.z&&jM("z",f,T,this.animationValues);for(let w=0;w<FM.length;w++)jM(`rotate${FM[w]}`,f,T,this.animationValues),jM(`skew${FM[w]}`,f,T,this.animationValues);f.render();for(const w in T)f.setStaticValue(w,T[w]),this.animationValues&&(this.animationValues[w]=T[w]);f.scheduleRender()}getProjectionStyles(f){var E,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return vPe;const T={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,T.opacity="",T.pointerEvents=wO(f==null?void 0:f.pointerEvents)||"",T.transform=w?w(this.latestValues,""):"none",T;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const G={};return this.options.layoutId&&(G.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,G.pointerEvents=wO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!q_(this.latestValues)&&(G.transform=w?w({},""):"none",this.hasProjected=!1),G}const N=I.animationValues||I.latestValues;this.applyTransformsToTarget(),T.transform=yPe(this.projectionDeltaWithTransform,this.treeScale,N),w&&(T.transform=w(N,T.transform));const{x:F,y:j}=this.projectionDelta;T.transformOrigin=`${F.origin*100}% ${j.origin*100}% 0`,I.animationValues?T.opacity=I===this?(v=(E=N.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:T.opacity=I===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const G in QO){if(N[G]===void 0)continue;const{correct:H,applyTo:te}=QO[G],K=T.transform==="none"?N[G]:H(N[G],I);if(te){const Q=te.length;for(let de=0;de<Q;de++)T[te[de]]=K}else T[G]=K}return this.options.layoutId&&(T.pointerEvents=I===this?wO(f==null?void 0:f.pointerEvents)||"":"none"),T}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var E;return(E=f.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(zK),this.root.sharedNodes.clear()}}}function TPe(r){r.updateLayout()}function bPe(r){var t;const s=((t=r.resumeFrom)===null||t===void 0?void 0:t.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&s&&r.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=r.layout,{animationType:d}=r.options,f=s.source!==r.layout.source;d==="size"?_u(I=>{const N=f?s.measuredBox[I]:s.layoutBox[I],F=Al(N);N.min=a[I].min,N.max=N.min+F}):zZ(d,s.layoutBox,a)&&_u(I=>{const N=f?s.measuredBox[I]:s.layoutBox[I],F=Al(a[I]);N.max=N.min+F,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[I].max=r.relativeTarget[I].min+F)});const E=_S();Ow(E,a,s.layoutBox);const v=_S();f?Ow(v,r.applyTransform(l,!0),s.measuredBox):Ow(v,a,s.layoutBox);const T=!FZ(E);let w=!1;if(!r.resumeFrom){const I=r.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:N,layout:F}=I;if(N&&F){const j=Is();kw(j,s.layoutBox,N.layoutBox);const G=Is();kw(G,a,F.layoutBox),jZ(j,G)||(w=!0),I.options.layoutRoot&&(r.relativeTarget=G,r.relativeTargetOrigin=j,r.relativeParent=I)}}}r.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:v,layoutDelta:E,hasLayoutChanged:T,hasRelativeTargetChanged:w})}else if(r.isLead()){const{onExitComplete:a}=r.options;a&&a()}r.options.transition=void 0}function wPe(r){hw&&Y_.totalNodes++,r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function RPe(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function CPe(r){r.clearSnapshot()}function zK(r){r.clearMeasurements()}function IPe(r){r.isLayoutDirty=!1}function APe(r){const{visualElement:t}=r.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),r.resetTransform()}function GK(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function PPe(r){r.resolveTargetDelta()}function OPe(r){r.calcProjection()}function kPe(r){r.resetSkewAndRotation()}function NPe(r){r.removeLeadSnapshot()}function HK(r,t,s){r.translate=es(t.translate,0,s),r.scale=es(t.scale,1,s),r.origin=t.origin,r.originPoint=t.originPoint}function $K(r,t,s,a){r.min=es(t.min,s.min,a),r.max=es(t.max,s.max,a)}function DPe(r,t,s,a){$K(r.x,t.x,s.x,a),$K(r.y,t.y,s.y,a)}function LPe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const xPe={duration:.45,ease:[.4,0,.1,1]},KK=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),qK=KK("applewebkit/")&&!KK("chrome/")?Math.round:Il;function YK(r){r.min=qK(r.min),r.max=qK(r.max)}function MPe(r){YK(r.x),YK(r.y)}function zZ(r,t,s){return r==="position"||r==="preserve-aspect"&&!FAe(jK(t),jK(s),.2)}function UPe(r){var t;return r!==r.root&&((t=r.scroll)===null||t===void 0?void 0:t.wasRoot)}const VPe=WZ({attachResizeListener:(r,t)=>Zw(r,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),BM={current:void 0},GZ=WZ({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!BM.current){const r=new VPe({});r.mount(window),r.setOptions({layoutScroll:!0}),BM.current=r}return BM.current},resetTransform:(r,t)=>{r.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),FPe={pan:{Feature:tPe},drag:{Feature:ePe,ProjectionNode:GZ,MeasureLayout:MZ}};function XK(r,t,s){const{props:a}=r;r.animationState&&a.whileHover&&r.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&Ui.postRender(()=>d(t,CR(t)))}class jPe extends yg{mount(){const{current:t}=this.node;t&&(this.unmount=FCe(t,s=>(XK(this.node,s,"Start"),a=>XK(this.node,a,"End"))))}unmount(){}}class BPe extends yg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=RR(Zw(this.node.current,"focus",()=>this.onFocus()),Zw(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function JK(r,t,s){const{props:a}=r;r.animationState&&a.whileTap&&r.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&Ui.postRender(()=>d(t,CR(t)))}class WPe extends yg{mount(){const{current:t}=this.node;t&&(this.unmount=zCe(t,s=>(JK(this.node,s,"Start"),(a,{success:l})=>JK(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const tU=new WeakMap,WM=new WeakMap,zPe=r=>{const t=tU.get(r.target);t&&t(r)},GPe=r=>{r.forEach(zPe)};function HPe({root:r,...t}){const s=r||document;WM.has(s)||WM.set(s,{});const a=WM.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(GPe,{root:r,...t})),a[l]}function $Pe(r,t,s){const a=HPe(t);return tU.set(r,s),a.observe(r),()=>{tU.delete(r),a.unobserve(r)}}const KPe={some:0,all:1};class qPe extends yg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,f={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:KPe[l]},E=v=>{const{isIntersecting:T}=v;if(this.isInView===T||(this.isInView=T,d&&!T&&this.hasEnteredView))return;T&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",T);const{onViewportEnter:w,onViewportLeave:I}=this.node.getProps(),N=T?w:I;N&&N(v)};return $Pe(this.node.current,f,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(YPe(t,s))&&this.startObserver()}unmount(){}}function YPe({viewport:r={}},{viewport:t={}}={}){return s=>r[s]!==t[s]}const XPe={inView:{Feature:qPe},tap:{Feature:WPe},focus:{Feature:BPe},hover:{Feature:jPe}},JPe={layout:{ProjectionNode:GZ,MeasureLayout:MZ}},nU={current:null},HZ={current:!1};function QPe(){if(HZ.current=!0,!!DV)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),t=()=>nU.current=r.matches;r.addListener(t),t()}else nU.current=!1}const ZPe=[...gZ,wa,ug],eOe=r=>ZPe.find(mZ(r)),QK=new WeakMap;function tOe(r,t,s){for(const a in t){const l=t[a],d=s[a];if(Pa(l))r.addValue(a,l);else if(Pa(d))r.addValue(a,Jw(l,{owner:r}));else if(d!==l)if(r.hasValue(a)){const f=r.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=r.getStaticValue(a);r.addValue(a,Jw(f!==void 0?f:l,{owner:r}))}}for(const a in s)t[a]===void 0&&r.removeValue(a);return t}const ZK=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class nOe{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=oF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const F=Fh.now();this.renderScheduledAt<F&&(this.renderScheduledAt=F,Ui.render(this.render,!1,!0))};const{latestValues:v,renderState:T,onUpdate:w}=f;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=s.initial?{...v}:{},this.renderState=T,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=qk(s),this.isVariantNode=wQ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:I,...N}=this.scrapeMotionValuesFromProps(s,{},this);for(const F in N){const j=N[F];v[F]!==void 0&&Pa(j)&&j.set(v[F],!1)}}mount(t){this.current=t,QK.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),HZ.current||QPe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:nU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){QK.delete(this.current),this.projection&&this.projection.unmount(),lg(this.notifyUpdate),lg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=IE.has(t),l=s.on("change",E=>{this.latestValues[t]=E,this.props.onUpdate&&Ui.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),f&&f(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in zS){const s=zS[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Is()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<ZK.length;a++){const l=ZK[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=t[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=tOe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=Jw(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(pZ(l)||iZ(l))?l=parseFloat(l):!eOe(l)&&ug.test(s)&&(l=uZ(t,s)),this.setBaseTarget(t,Pa(l)?l.get():l)),Pa(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=jV(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);f&&(l=f[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Pa(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new eF),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class $Z extends nOe{constructor(){super(...arguments),this.KeyframeResolver=_Z}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Pa(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function rOe(r){return window.getComputedStyle(r)}class iOe extends $Z{constructor(){super(...arguments),this.type="html",this.renderInstance=DQ}readValueFromInstance(t,s){if(IE.has(s)){const a=sF(s);return a&&a.default||0}else{const a=rOe(t),l=(OQ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return LZ(t,s)}build(t,s,a){zV(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return KV(t,s,a)}}class sOe extends $Z{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Is}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(IE.has(s)){const a=sF(s);return a&&a.default||0}return s=LQ.has(s)?s:UV(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return UQ(t,s,a)}build(t,s,a){GV(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){xQ(t,s,a,l)}mount(t){this.isSVGTag=$V(t.tagName),super.mount(t)}}const oOe=(r,t)=>FV(r)?new sOe(t):new iOe(t,{allowProjection:r!==L.Fragment}),aOe=NCe({...OAe,...XPe,...FPe,...JPe},oOe),If=KRe(aOe),cOe=(r,t)=>r.find(s=>s.id===t);function eq(r,t){const s=KZ(r,t),a=s?r[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function KZ(r,t){for(const[s,a]of Object.entries(r))if(cOe(a,t))return s}function lOe(r){const t=r.includes("right"),s=r.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function uOe(r){const s=r==="top"||r==="bottom"?"0 auto":void 0,a=r.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=r.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=r.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=r.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:f}}var dOe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,hOe=lQ(function(r){return dOe.test(r)||r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)<91}),pOe=hOe,fOe=function(t){return t!=="theme"},tq=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?pOe:fOe},nq=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(f){return t.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},mOe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return SV(s,a,l),fQ(function(){return TV(s,a,l)}),null},gOe=function r(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,f;s!==void 0&&(d=s.label,f=s.target);var E=nq(t,s,a),v=E||tq(l),T=!v("as");return function(){var w=arguments,I=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)I.push.apply(I,w);else{var N=w[0];I.push(N[0]);for(var F=w.length,j=1;j<F;j++)I.push(w[j],N[j])}var G=wV(function(H,te,K){var Q=T&&H.as||l,de="",se=[],ge=H;if(H.theme==null){ge={};for(var ee in H)ge[ee]=H[ee];ge.theme=L.useContext(BS)}typeof H.className=="string"?de=dQ(te.registered,se,H.className):H.className!=null&&(de=H.className+" ");var Z=zk(I.concat(se),te.registered,ge);de+=te.key+"-"+Z.name,f!==void 0&&(de+=" "+f);var ne=T&&E===void 0?tq(Q):v,ae={};for(var me in H)T&&me==="as"||ne(me)&&(ae[me]=H[me]);return ae.className=de,K&&(ae.ref=K),L.createElement(L.Fragment,null,L.createElement(mOe,{cache:te,serialized:Z,isStringTag:typeof Q=="string"}),L.createElement(Q,ae))});return G.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",G.defaultProps=t.defaultProps,G.__emotion_real=G,G.__emotion_base=l,G.__emotion_styles=I,G.__emotion_forwardProp=E,Object.defineProperty(G,"toString",{value:function(){return"."+f}}),G.withComponent=function(H,te){var K=r(H,mE({},s,te,{shouldForwardProp:nq(G,te,!0)}));return K.apply(void 0,I)},G}},_Oe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],rU=gOe.bind(null);_Oe.forEach(function(r){rU[r]=rU(r)});const EOe=new Set([...FEe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),yOe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function vOe(r){return(yOe.has(r)||!EOe.has(r))&&r[0]!=="_"}const SOe=g_e(rU),TOe=({baseStyle:r})=>t=>{const{theme:s,css:a,__css:l,sx:d,...f}=t,[E]=R_e(f,BEe),v=jc(r,t),T=n_e({},l,v,xk(E),d),w=WJ(T)(t.theme);return a?[w,a]:w};function zM(r,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=vOe);const l=TOe({baseStyle:s}),d=SOe(r,a)(l);return L.forwardRef(function(v,T){const{children:w,...I}=v,{colorMode:N,forced:F}=Hk(),j=F?N:void 0;return L.createElement(d,{ref:T,"data-theme":j,...I},w)})}function bOe(){const r=new Map;return new Proxy(zM,{apply(t,s,a){return zM(...a)},get(t,s){return r.has(s)||r.set(s,zM(s)),r.get(s)}})}const Ut=bOe(),wOe={initial:r=>{const{position:t}=r,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},qZ=L.memo(r=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:E=5e3,containerStyle:v,motionVariants:T=wOe,toastSpacing:w="0.5rem"}=r,[I,N]=L.useState(E),F=VRe();cg(()=>{F||a==null||a()},[F]),cg(()=>{N(E)},[E]);const j=()=>N(null),G=()=>N(E),H=()=>{F&&l()};L.useEffect(()=>{F&&d&&l()},[F,d,l]),z_e(H,I);const te=L.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),K=L.useMemo(()=>lOe(f),[f]);return O.jsx(If.div,{layout:!0,className:"chakra-toast",variants:T,initial:"initial",animate:"animate",exit:"exit",onHoverStart:j,onHoverEnd:G,custom:{position:f},style:K,children:O.jsx(Ut.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:te,children:jc(s,{id:t,onClose:H})})})});qZ.displayName="ToastComponent";function tn(r){return L.forwardRef(r)}var GM,rq;function ROe(){if(rq)return GM;rq=1;var r=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var E,v,T;if(Array.isArray(d)){if(E=d.length,E!=f.length)return!1;for(v=E;v--!==0;)if(!l(d[v],f[v]))return!1;return!0}var w;if(t&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(s&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(E=d.length,E!=f.length)return!1;for(v=E;v--!==0;)if(d[v]!==f[v])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(T=Object.keys(d),E=T.length,E!==Object.keys(f).length)return!1;for(v=E;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,T[v]))return!1;if(r&&d instanceof Element)return!1;for(v=E;v--!==0;)if(!((T[v]==="_owner"||T[v]==="__v"||T[v]==="__o")&&d.$$typeof)&&!l(d[T[v]],f[T[v]]))return!1;return!0}return d!==d&&f!==f}return GM=function(f,E){try{return l(f,E)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},GM}var COe=ROe();const IOe=a0(COe);function h0(){const r=L.useContext(BS);if(!r)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return r}function YZ(){const r=Hk(),t=h0();return{...r,theme:t}}function AOe(r,t,s){if(t==null)return t;const a=l=>{var d,f;return(f=(d=r.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(t)??a(s)??s}function POe(r,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const f=l.filter(Boolean),E=a.map((v,T)=>{const w=`${r}.${v}`;return AOe(d,w,f[T]??v)});return Array.isArray(t)?E:E[0]}}function XZ(r,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=YZ(),f=r?RJ(l,`components.${r}`):void 0,E=s||f,v=Nh({theme:l,colorMode:d},(E==null?void 0:E.defaultProps)??{},xk(_R(a,["children"])),(w,I)=>w?void 0:I),T=L.useRef({});if(E){const I=QEe(E)(v);IOe(T.current,I)||(T.current=I)}return T.current}function Rd(r,t={}){return XZ(r,t)}function qc(r,t={}){return XZ(r,t)}const iq={path:O.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[O.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),O.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),O.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Hn=tn((r,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:E,__css:v,...T}=r,w=Sn("chakra-icon",E),I=Rd("Icon",r),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...I},F={ref:t,focusable:d,className:w,__css:N},j=a??iq.viewBox;if(s&&typeof s!="string")return O.jsx(Ut.svg,{as:s,...F,...T});const G=f??iq.path;return O.jsx(Ut.svg,{verticalAlign:"middle",viewBox:j,...F,...T,children:G})});Hn.displayName="Icon";function OOe(r){return O.jsx(Hn,{viewBox:"0 0 24 24",...r,children:O.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function kOe(r){return O.jsx(Hn,{viewBox:"0 0 24 24",...r,children:O.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function sq(r){return O.jsx(Hn,{viewBox:"0 0 24 24",...r,children:O.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const NOe=SR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),Af=tn((r,t)=>{const s=Rd("Spinner",r),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:E,...v}=ns(r),T=Sn("chakra-spinner",E),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${NOe} ${d} linear infinite`,...s};return O.jsx(Ut.div,{ref:t,__css:w,className:T,...v,children:a&&O.jsx(Ut.span,{srOnly:!0,children:a})})});Af.displayName="Spinner";const[DOe,uF]=Vi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[LOe,dF]=Vi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),JZ={info:{icon:kOe,colorScheme:"blue"},warning:{icon:sq,colorScheme:"orange"},success:{icon:OOe,colorScheme:"green"},error:{icon:sq,colorScheme:"red"},loading:{icon:Af,colorScheme:"blue"}};function xOe(r){return JZ[r].colorScheme}function MOe(r){return JZ[r].icon}const HS=tn(function(t,s){const{status:a="info",addRole:l=!0,...d}=ns(t),f=t.colorScheme??xOe(a),E=qc("Alert",{...t,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...E.container};return O.jsx(DOe,{value:{status:a},children:O.jsx(LOe,{value:E,children:O.jsx(Ut.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:Sn("chakra-alert",t.className),__css:v})})})});HS.displayName="Alert";function $S(r){const{status:t}=uF(),s=MOe(t),a=dF(),l=t==="loading"?a.spinner:a.icon;return O.jsx(Ut.span,{display:"inherit","data-status":t,...r,className:Sn("chakra-alert__icon",r.className),__css:l,children:r.children||O.jsx(s,{h:"100%",w:"100%"})})}$S.displayName="AlertIcon";const ik=tn(function(t,s){const a=dF(),{status:l}=uF();return O.jsx(Ut.div,{ref:s,"data-status":l,...t,className:Sn("chakra-alert__title",t.className),__css:a.title})});ik.displayName="AlertTitle";const sk=tn(function(t,s){const{status:a}=uF(),l=dF(),d={display:"inline",...l.description};return O.jsx(Ut.div,{ref:s,"data-status":a,...t,className:Sn("chakra-alert__desc",t.className),__css:d})});sk.displayName="AlertDescription";function UOe(r){return O.jsx(Hn,{focusable:"false","aria-hidden":!0,...r,children:O.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const hF=tn(function(t,s){const a=Rd("CloseButton",t),{children:l,isDisabled:d,__css:f,...E}=ns(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return O.jsx(Ut.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...v,...a,...f},...E,children:l||O.jsx(UOe,{width:"1em",height:"1em"})})});hF.displayName="CloseButton";const VOe=r=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:f,description:E,colorScheme:v,icon:T}=r,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return O.jsxs(HS,{addRole:!1,status:t,variant:s,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[O.jsx($S,{children:T}),O.jsxs(Ut.div,{flex:"1",maxWidth:"100%",children:[l&&O.jsx(ik,{id:w==null?void 0:w.title,children:l}),E&&O.jsx(sk,{id:w==null?void 0:w.description,display:"block",children:E})]}),d&&O.jsx(hF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function QZ(r={}){const{render:t,toastComponent:s=VOe}=r;return l=>typeof t=="function"?t({...l,...r}):O.jsx(s,{...l,...r})}const FOe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Ph=jOe(FOe);function jOe(r){let t=r;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>r),s.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const f=BOe(l,d),{position:E,id:v}=f;return a(T=>{const I=E.includes("top")?[f,...T[E]??[]]:[...T[E]??[],f];return{...T,[E]:I}}),v},update:(l,d)=>{l&&a(f=>{const E={...f},{position:v,index:T}=eq(E,l);return v&&T!==-1&&(E[v][T]={...E[v][T],...d,message:QZ(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,T)=>(v[T]=d[T].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const f=KZ(d,l);return f?{...d,[f]:d[f].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!eq(Ph.getState(),l).position}}let oq=0;function BOe(r,t={}){oq+=1;const s=t.id??oq,a=t.position??"bottom";return{id:s,message:r,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>Ph.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var ZZ=gJ();const[eee,WOe]=Vi({strict:!1,name:"PortalContext"}),pF="chakra-portal",zOe=".chakra-portal",GOe=r=>O.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:r.zIndex,top:0,left:0,right:0},children:r.children}),HOe=r=>{const{appendToParentPortal:t,children:s}=r,[a,l]=L.useState(null),d=L.useRef(null),[,f]=L.useState({});L.useEffect(()=>f({}),[]);const E=WOe(),v=kRe();hf(()=>{if(!a)return;const w=a.ownerDocument,I=t?E??w.body:w.body;if(!I)return;d.current=w.createElement("div"),d.current.className=pF,I.appendChild(d.current),f({});const N=d.current;return()=>{I.contains(N)&&I.removeChild(N)}},[a]);const T=v!=null&&v.zIndex?O.jsx(GOe,{zIndex:v==null?void 0:v.zIndex,children:s}):s;return d.current?ZZ.createPortal(O.jsx(eee,{value:d.current,children:T}),d.current):O.jsx("span",{ref:w=>{w&&l(w)}})},$Oe=r=>{const{children:t,containerRef:s,appendToParentPortal:a}=r,l=s.current,d=l??(typeof window<"u"?document.body:void 0),f=L.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=pF),v},[l]),[,E]=L.useState({});return hf(()=>E({}),[]),hf(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?ZZ.createPortal(O.jsx(eee,{value:a?f:null,children:t}),f):null};function bu(r){const t={appendToParentPortal:!0,...r},{containerRef:s,...a}=t;return s?O.jsx($Oe,{containerRef:s,...a}):O.jsx(HOe,{...a})}bu.className=pF;bu.selector=zOe;bu.displayName="Portal";const[KOe,qOe]=Vi({name:"ToastOptionsContext",strict:!1}),YOe=r=>{const t=L.useSyncExternalStore(Ph.subscribe,Ph.getState,Ph.getState),{motionVariants:s,component:a=qZ,portalProps:l,animatePresenceProps:d}=r,E=Object.keys(t).map(v=>{const T=t[v];return O.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:uOe(v),children:O.jsx(l0,{...d,initial:!1,children:T.map(w=>O.jsx(a,{motionVariants:s,...w},w.id))})},v)});return O.jsx(bu,{...l,children:E})},XOe=r=>function({children:s,theme:a=r,toastOptions:l,...d}){return O.jsxs(DRe,{theme:a,...d,children:[O.jsx(KOe,{value:l==null?void 0:l.defaultOptions,children:s}),O.jsx(YOe,{...l})]})},JOe=XOe(wwe);function aq(r){return r.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const QOe=r=>typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE;function cq(r,t,s){let a=r+1;return s&&a>=t&&(a=0),a}function lq(r,t,s){let a=r-1;return s&&a<0&&(a=t),a}const HM=typeof window<"u"?L.useLayoutEffect:L.useEffect,uq=r=>r;var ZOe=Object.defineProperty,eke=(r,t,s)=>t in r?ZOe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,_s=(r,t,s)=>(eke(r,typeof t!="symbol"?t+"":t,s),s);class tke{constructor(){_s(this,"descendants",new Map),_s(this,"register",t=>{if(t!=null)return QOe(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),_s(this,"unregister",t=>{this.descendants.delete(t);const s=aq(Array.from(this.descendants.keys()));this.assignIndex(s)}),_s(this,"destroy",()=>{this.descendants.clear()}),_s(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),_s(this,"count",()=>this.descendants.size),_s(this,"enabledCount",()=>this.enabledValues().length),_s(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),_s(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),_s(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),_s(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),_s(this,"first",()=>this.item(0)),_s(this,"firstEnabled",()=>this.enabledItem(0)),_s(this,"last",()=>this.item(this.descendants.size-1)),_s(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),_s(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),_s(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),_s(this,"next",(t,s=!0)=>{const a=cq(t,this.count(),s);return this.item(a)}),_s(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=cq(l,this.enabledCount(),s);return this.enabledItem(d)}),_s(this,"prev",(t,s=!0)=>{const a=lq(t,this.count()-1,s);return this.item(a)}),_s(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=lq(l,this.enabledCount()-1,s);return this.enabledItem(d)}),_s(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=aq(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function tee(){const[r,t]=Vi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[r,t,()=>{const l=L.useRef(new tke);return HM(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[f,E]=L.useState(-1),v=L.useRef(null);HM(()=>()=>{v.current&&d.unregister(v.current)},[]),HM(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);f!=w&&!Number.isNaN(w)&&E(w)});const T=uq(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(v.current),register:Hi(T,v)}}]}const dq={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},cE={enter:{duration:.2,ease:dq.easeOut},exit:{duration:.1,ease:dq.easeIn}},lE={enter:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[nke,rke]=Vi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function ike(r){const t=r.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function nee(r){const{name:t,getInitials:s,...a}=r,l=rke();return O.jsx(Ut.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}nee.displayName="AvatarName";const ree=r=>O.jsxs(Ut.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...r,children:[O.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),O.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function iee(r){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:E,ignoreFallback:v}=r,[T,w]=L.useState("pending");L.useEffect(()=>{w(s?"loading":"pending")},[s]);const I=L.useRef(null),N=L.useCallback(()=>{if(!s)return;F();const j=new Image;j.src=s,f&&(j.crossOrigin=f),a&&(j.srcset=a),E&&(j.sizes=E),t&&(j.loading=t),j.onload=G=>{F(),w("loaded"),l==null||l(G)},j.onerror=G=>{F(),w("failed"),d==null||d(G)},I.current=j},[s,f,a,E,l,d,t]),F=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return hf(()=>{if(!v)return T==="loading"&&N(),()=>{F()}},[T,N,v]),v?"loaded":T}const ske=(r,t)=>r!=="loaded"&&t==="beforeLoadOrError"||r==="failed"&&t==="onError";function see(r){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:E,loading:v,iconLabel:T,icon:w=O.jsx(ree,{}),ignoreFallback:I,referrerPolicy:N,crossOrigin:F}=r,G=iee({src:t,onError:a,crossOrigin:F,ignoreFallback:I})==="loaded";return!t||!G?f?O.jsx(nee,{className:"chakra-avatar__initials",getInitials:d,name:f}):L.cloneElement(w,{role:"img","aria-label":T}):O.jsx(Ut.img,{src:t,srcSet:s,alt:f??T,onLoad:l,referrerPolicy:N,crossOrigin:F??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}see.displayName="AvatarImage";const oke={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},vf=tn((r,t)=>{const s=qc("Avatar",r),[a,l]=L.useState(!1),{src:d,srcSet:f,name:E,showBorder:v,borderRadius:T="full",onError:w,onLoad:I,getInitials:N=ike,icon:F=O.jsx(ree,{}),iconLabel:j=" avatar",loading:G,children:H,borderColor:te,ignoreFallback:K,crossOrigin:Q,referrerPolicy:de,...se}=ns(r),ge={borderRadius:T,borderWidth:v?"2px":void 0,...oke,...s.container};return te&&(ge.borderColor=te),O.jsx(Ut.span,{ref:t,...se,className:Sn("chakra-avatar",r.className),"data-loaded":Yn(a),__css:ge,children:O.jsxs(nke,{value:s,children:[O.jsx(see,{src:d,srcSet:f,loading:G,onLoad:Zn(I,()=>{l(!0)}),onError:w,getInitials:N,name:E,borderRadius:T,icon:F,iconLabel:j,ignoreFallback:K,crossOrigin:Q,referrerPolicy:de}),H]})})});vf.displayName="Avatar";const af=tn(function(t,s){const a=Rd("Badge",t),{className:l,...d}=ns(t);return O.jsx(Ut.span,{ref:s,className:Sn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});af.displayName="Badge";const kt=Ut("div");kt.displayName="Box";const[p6e,ake]=Vi({strict:!1,name:"ButtonGroupContext"});function pw(r){const{children:t,className:s,...a}=r,l=L.isValidElement(t)?L.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=Sn("chakra-button__icon",s);return O.jsx(Ut.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}pw.displayName="ButtonIcon";function iU(r){const{label:t,placement:s,spacing:a="0.5rem",children:l=O.jsx(Af,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,...E}=r,v=Sn("chakra-button__spinner",d),T=s==="start"?"marginEnd":"marginStart",w=L.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[T]:t?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,t,T,a]);return O.jsx(Ut.div,{className:v,...E,__css:w,children:l})}iU.displayName="ButtonSpinner";function cke(r){const[t,s]=L.useState(!r);return{ref:L.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const Ps=tn((r,t)=>{const s=ake(),a=Rd("Button",{...s,...r}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:f,children:E,leftIcon:v,rightIcon:T,loadingText:w,iconSpacing:I="0.5rem",type:N,spinner:F,spinnerPlacement:j="start",className:G,as:H,shouldWrapChildren:te,...K}=ns(r),Q=L.useMemo(()=>{const ee={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:ee}}},[a,s]),{ref:de,type:se}=cke(H),ge={rightIcon:T,leftIcon:v,iconSpacing:I,children:E,shouldWrapChildren:te};return O.jsxs(Ut.button,{disabled:l||d,ref:W_e(t,de),as:H,type:N??se,"data-active":Yn(f),"data-loading":Yn(d),__css:Q,className:Sn("chakra-button",G),...K,children:[d&&j==="start"&&O.jsx(iU,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:I,children:F}),d?w||O.jsx(Ut.span,{opacity:0,children:O.jsx(hq,{...ge})}):O.jsx(hq,{...ge}),d&&j==="end"&&O.jsx(iU,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:I,children:F})]})});Ps.displayName="Button";function hq(r){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=r;return d?O.jsxs("span",{style:{display:"contents"},children:[t&&O.jsx(pw,{marginEnd:l,children:t}),a,s&&O.jsx(pw,{marginStart:l,children:s})]}):O.jsxs(O.Fragment,{children:[t&&O.jsx(pw,{marginEnd:l,children:t}),a,s&&O.jsx(pw,{marginStart:l,children:s})]})}const Ia=tn((r,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...f}=r,E=s||a,v=L.isValidElement(E)?L.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return O.jsx(Ps,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...f,children:v})});Ia.displayName="IconButton";const oee=Ut("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});oee.displayName="Center";const lke={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};tn(function(t,s){const{axis:a="both",...l}=t;return O.jsx(Ut.div,{ref:s,__css:lke[a],...l,position:"absolute"})});var uke=()=>typeof document<"u",pq=!1,IR=null,gE=!1,sU=!1,oU=new Set;function fF(r,t){oU.forEach(s=>s(r,t))}var dke=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function hke(r){return!(r.metaKey||!dke&&r.altKey||r.ctrlKey||r.key==="Control"||r.key==="Shift"||r.key==="Meta")}function fq(r){gE=!0,hke(r)&&(IR="keyboard",fF("keyboard",r))}function Jv(r){if(IR="pointer",r.type==="mousedown"||r.type==="pointerdown"){gE=!0;const t=r.composedPath?r.composedPath()[0]:r.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;fF("pointer",r)}}function pke(r){return r.mozInputSource===0&&r.isTrusted?!0:r.detail===0&&!r.pointerType}function fke(r){pke(r)&&(gE=!0,IR="virtual")}function mke(r){r.target===window||r.target===document||r.target instanceof Element&&r.target.hasAttribute("tabindex")||(!gE&&!sU&&(IR="virtual",fF("virtual",r)),gE=!1,sU=!1)}function gke(){gE=!1,sU=!0}function mq(){return IR!=="pointer"}function _ke(){if(!uke()||pq)return;const{focus:r}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){gE=!0,r.apply(this,s)},document.addEventListener("keydown",fq,!0),document.addEventListener("keyup",fq,!0),document.addEventListener("click",fke,!0),window.addEventListener("focus",mke,!0),window.addEventListener("blur",gke,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",Jv,!0),document.addEventListener("pointermove",Jv,!0),document.addEventListener("pointerup",Jv,!0)):(document.addEventListener("mousedown",Jv,!0),document.addEventListener("mousemove",Jv,!0),document.addEventListener("mouseup",Jv,!0)),pq=!0}function Eke(r){_ke(),r(mq());const t=()=>r(mq());return oU.add(t),()=>{oU.delete(t)}}const[yke,aee]=Vi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[vke,p0]=Vi({strict:!1,name:"FormControlContext"});function Ske(r){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=r,E=L.useId(),v=t||`field-${E}`,T=`${v}-label`,w=`${v}-feedback`,I=`${v}-helptext`,[N,F]=L.useState(!1),[j,G]=L.useState(!1),[H,te]=L.useState(!1),K=L.useCallback((ee={},Z=null)=>({id:I,...ee,ref:Hi(Z,ne=>{ne&&G(!0)})}),[I]),Q=L.useCallback((ee={},Z=null)=>({...ee,ref:Z,"data-focus":Yn(H),"data-disabled":Yn(l),"data-invalid":Yn(a),"data-readonly":Yn(d),id:ee.id!==void 0?ee.id:T,htmlFor:ee.htmlFor!==void 0?ee.htmlFor:v}),[v,l,H,a,d,T]),de=L.useCallback((ee={},Z=null)=>({id:w,...ee,ref:Hi(Z,ne=>{ne&&F(!0)}),"aria-live":"polite"}),[w]),se=L.useCallback((ee={},Z=null)=>({...ee,...f,ref:Z,role:"group","data-focus":Yn(H),"data-disabled":Yn(l),"data-invalid":Yn(a),"data-readonly":Yn(d)}),[f,l,H,a,d]),ge=L.useCallback((ee={},Z=null)=>({...ee,ref:Z,role:"presentation","aria-hidden":!0,children:ee.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!H,onFocus:()=>te(!0),onBlur:()=>te(!1),hasFeedbackText:N,setHasFeedbackText:F,hasHelpText:j,setHasHelpText:G,id:v,labelId:T,feedbackId:w,helpTextId:I,htmlProps:f,getHelpTextProps:K,getErrorMessageProps:de,getRootProps:se,getLabelProps:Q,getRequiredIndicatorProps:ge}}const Fs=tn(function(t,s){const a=qc("Form",t),l=ns(t),{getRootProps:d,htmlProps:f,...E}=Ske(l),v=Sn("chakra-form-control",t.className);return O.jsx(vke,{value:E,children:O.jsx(yke,{value:a,children:O.jsx(Ut.div,{...d({},s),className:v,__css:a.container})})})});Fs.displayName="FormControl";const aU=tn(function(t,s){const a=p0(),l=aee(),d=Sn("chakra-form__helper-text",t.className);return O.jsx(Ut.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});aU.displayName="FormHelperText";function cee(r){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=lee(r);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":SS(s),"aria-required":SS(l),"aria-readonly":SS(a)}}function lee(r){const t=p0(),{id:s,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:E,isReadOnly:v,isDisabled:T,onFocus:w,onBlur:I,...N}=r,F=r["aria-describedby"]?[r["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&F.push(t.feedbackId),t!=null&&t.hasHelpText&&F.push(t.helpTextId),{...N,"aria-describedby":F.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??T??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??f??(t==null?void 0:t.isRequired),isInvalid:E??(t==null?void 0:t.isInvalid),onFocus:Zn(t==null?void 0:t.onFocus,w),onBlur:Zn(t==null?void 0:t.onBlur,I)}}const Tke={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function bke(r={}){const t=lee(r),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:E,onFocus:v,"aria-describedby":T}=t,{defaultChecked:w,isChecked:I,isFocusable:N,onChange:F,isIndeterminate:j,name:G,value:H,tabIndex:te=void 0,"aria-label":K,"aria-labelledby":Q,"aria-invalid":de,...se}=r,ge=_R(se,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),ee=Bc(F),Z=Bc(E),ne=Bc(v),[ae,me]=L.useState(!1),[he,le]=L.useState(!1),[Me,Ge]=L.useState(!1),[tt,Ee]=L.useState(!1);L.useEffect(()=>Eke(me),[]);const we=L.useRef(null),[ve,Be]=L.useState(!0),[Oe,be]=L.useState(!!w),Ce=I!==void 0,xe=Ce?I:Oe,ze=L.useCallback(Xt=>{if(a||s){Xt.preventDefault();return}Ce||be(xe?Xt.currentTarget.checked:j?!0:Xt.currentTarget.checked),ee==null||ee(Xt)},[a,s,xe,Ce,j,ee]);hf(()=>{we.current&&(we.current.indeterminate=!!j)},[j]),cg(()=>{s&&le(!1)},[s,le]),hf(()=>{const Xt=we.current;if(!(Xt!=null&&Xt.form))return;const Pt=()=>{be(!!w)};return Xt.form.addEventListener("reset",Pt),()=>{var Dt;return(Dt=Xt.form)==null?void 0:Dt.removeEventListener("reset",Pt)}},[]);const Qe=s&&!N,et=L.useCallback(Xt=>{Xt.key===" "&&Ee(!0)},[Ee]),ut=L.useCallback(Xt=>{Xt.key===" "&&Ee(!1)},[Ee]);hf(()=>{if(!we.current)return;we.current.checked!==xe&&be(we.current.checked)},[we.current]);const it=L.useCallback((Xt={},Pt=null)=>{const Dt=Te=>{he&&Te.preventDefault(),Ee(!0)};return{...Xt,ref:Pt,"data-active":Yn(tt),"data-hover":Yn(Me),"data-checked":Yn(xe),"data-focus":Yn(he),"data-focus-visible":Yn(he&&ae),"data-indeterminate":Yn(j),"data-disabled":Yn(s),"data-invalid":Yn(d),"data-readonly":Yn(a),"aria-hidden":!0,onMouseDown:Zn(Xt.onMouseDown,Dt),onMouseUp:Zn(Xt.onMouseUp,()=>Ee(!1)),onMouseEnter:Zn(Xt.onMouseEnter,()=>Ge(!0)),onMouseLeave:Zn(Xt.onMouseLeave,()=>Ge(!1))}},[tt,xe,s,he,ae,Me,j,d,a]),Ct=L.useCallback((Xt={},Pt=null)=>({...Xt,ref:Pt,"data-active":Yn(tt),"data-hover":Yn(Me),"data-checked":Yn(xe),"data-focus":Yn(he),"data-focus-visible":Yn(he&&ae),"data-indeterminate":Yn(j),"data-disabled":Yn(s),"data-invalid":Yn(d),"data-readonly":Yn(a)}),[tt,xe,s,he,ae,Me,j,d,a]),_n=L.useCallback((Xt={},Pt=null)=>({...ge,htmlFor:ve?f:void 0,...Xt,ref:Hi(Pt,Dt=>{Dt&&Be(Dt.tagName==="LABEL")}),onClick:Zn(Xt.onClick,()=>{var Dt;ve||((Dt=we.current)==null||Dt.click(),requestAnimationFrame(()=>{var Te;(Te=we.current)==null||Te.focus({preventScroll:!0})}))}),"data-disabled":Yn(s),"data-checked":Yn(xe),"data-invalid":Yn(d)}),[ge,s,xe,d,ve,f]),Vt=L.useCallback((Xt={},Pt=null)=>({...Xt,ref:Hi(we,Pt),type:"checkbox",name:G,value:H,id:f,tabIndex:te,onChange:Zn(Xt.onChange,ze),onBlur:Zn(Xt.onBlur,Z,()=>le(!1)),onFocus:Zn(Xt.onFocus,ne,()=>le(!0)),onKeyDown:Zn(Xt.onKeyDown,et),onKeyUp:Zn(Xt.onKeyUp,ut),required:l,checked:xe,disabled:Qe,readOnly:a,"aria-label":K,"aria-labelledby":Q,"aria-invalid":de?!!de:d,"aria-describedby":T,"aria-disabled":s,"aria-checked":j?"mixed":xe,style:Tke}),[G,H,f,te,ze,Z,ne,et,ut,l,xe,Qe,a,K,Q,de,d,T,s,j]),ln=L.useCallback((Xt={},Pt=null)=>({...Xt,ref:Pt,onMouseDown:Zn(Xt.onMouseDown,wke),"data-disabled":Yn(s),"data-checked":Yn(xe),"data-invalid":Yn(d)}),[xe,s,d]);return{state:{isInvalid:d,isFocused:he,isChecked:xe,isActive:tt,isHovered:Me,isIndeterminate:j,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:_n,getCheckboxProps:it,getIndicatorProps:Ct,getInputProps:Vt,getLabelProps:ln,htmlProps:ge}}function wke(r){r.preventDefault(),r.stopPropagation()}const uE=tn(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:E,borderStyle:v,borderColor:T,...w}=Rd("Divider",t),{className:I,orientation:N="horizontal",__css:F,...j}=ns(t),G={vertical:{borderLeftWidth:a||f||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return O.jsx(Ut.hr,{ref:s,"aria-orientation":N,...j,__css:{...w,border:"0",borderColor:T,borderStyle:v,...G[N],...F},className:Sn("chakra-divider",I)})});uE.displayName="Divider";const Jo=tn(function(t,s){const{direction:a,align:l,justify:d,wrap:f,basis:E,grow:v,shrink:T,...w}=t,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:E,flexGrow:v,flexShrink:T};return O.jsx(Ut.div,{ref:s,__css:I,...w})});Jo.displayName="Flex";function Rke(r,t){if(r==null)return{};var s={};for(var a in r)if({}.hasOwnProperty.call(r,a)){if(t.indexOf(a)!==-1)continue;s[a]=r[a]}return s}var $M={exports:{}},KM,gq;function Cke(){if(gq)return KM;gq=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return KM=r,KM}var qM,_q;function Ike(){if(_q)return qM;_q=1;var r=Cke();function t(){}function s(){}return s.resetWarningCache=t,qM=function(){function a(f,E,v,T,w,I){if(I!==r){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},qM}var Eq;function Ake(){return Eq||(Eq=1,$M.exports=Ike()()),$M.exports}var Pke=Ake();const Mr=a0(Pke);var cU="data-focus-lock",uee="data-focus-lock-disabled",Oke="data-no-focus-lock",kke="data-autofocus-inside",Nke="data-no-autofocus";function YM(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function Dke(r,t){var s=L.useState(function(){return{value:r,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var Lke=typeof window<"u"?L.useLayoutEffect:L.useEffect,yq=new WeakMap;function dee(r,t){var s=Dke(null,function(a){return r.forEach(function(l){return YM(l,a)})});return Lke(function(){var a=yq.get(s);if(a){var l=new Set(a),d=new Set(r),f=s.current;l.forEach(function(E){d.has(E)||YM(E,null)}),d.forEach(function(E){l.has(E)||YM(E,f)})}yq.set(s,r)},[r]),s}var XM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Oh=function(){return Oh=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},Oh.apply(this,arguments)};function AR(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s}function xke(r,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return r.concat(d||Array.prototype.slice.call(t))}function hee(r){return r}function pee(r,t){t===void 0&&(t=hee);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:r},useMedium:function(d){var f=t(d,a);return s.push(f),function(){s=s.filter(function(E){return E!==f})}},assignSyncMedium:function(d){for(a=!0;s.length;){var f=s;s=[],f.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var f=[];if(s.length){var E=s;s=[],E.forEach(d),f=s}var v=function(){var w=f;f=[],w.forEach(d)},T=function(){return Promise.resolve().then(v)};T(),s={push:function(w){f.push(w),T()},filter:function(w){return f=f.filter(w),s}}}};return l}function mF(r,t){return t===void 0&&(t=hee),pee(r,t)}function fee(r){r===void 0&&(r={});var t=pee(null);return t.options=Oh({async:!0,ssr:!1},r),t}var mee=function(r){var t=r.sideCar,s=AR(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return L.createElement(a,Oh({},s))};mee.isSideCarExport=!0;function Mke(r,t){return r.useMedium(t),mee}var gee=mF({},function(r){var t=r.target,s=r.currentTarget;return{target:t,currentTarget:s}}),_ee=mF(),Uke=mF(),Vke=fee({async:!0,ssr:typeof document<"u"}),Fke=L.createContext(void 0),jke=[],gF=L.forwardRef(function(t,s){var a,l=L.useState(),d=l[0],f=l[1],E=L.useRef(),v=L.useRef(!1),T=L.useRef(null),w=L.useState({}),I=w[1],N=t.children,F=t.disabled,j=F===void 0?!1:F,G=t.noFocusGuards,H=G===void 0?!1:G,te=t.persistentFocus,K=te===void 0?!1:te,Q=t.crossFrame,de=Q===void 0?!0:Q,se=t.autoFocus,ge=se===void 0?!0:se;t.allowTextSelection;var ee=t.group,Z=t.className,ne=t.whiteList,ae=t.hasPositiveIndices,me=t.shards,he=me===void 0?jke:me,le=t.as,Me=le===void 0?"div":le,Ge=t.lockProps,tt=Ge===void 0?{}:Ge,Ee=t.sideCar,we=t.returnFocus,ve=we===void 0?!1:we,Be=t.focusOptions,Oe=t.onActivation,be=t.onDeactivation,Ce=L.useState({}),xe=Ce[0],ze=L.useCallback(function(Pt){var Dt=Pt.captureFocusRestore;if(!T.current){var Te,Ue=(Te=document)==null?void 0:Te.activeElement;T.current=Ue,Ue!==document.body&&(T.current=Dt(Ue))}E.current&&Oe&&Oe(E.current),v.current=!0,I()},[Oe]),Qe=L.useCallback(function(){v.current=!1,be&&be(E.current),I()},[be]),et=L.useCallback(function(Pt){var Dt=T.current;if(Dt){var Te=(typeof Dt=="function"?Dt():Dt)||document.body,Ue=typeof ve=="function"?ve(Te):ve;if(Ue){var $e=typeof Ue=="object"?Ue:void 0;T.current=null,Pt?Promise.resolve().then(function(){return Te.focus($e)}):Te.focus($e)}}},[ve]),ut=L.useCallback(function(Pt){v.current&&gee.useMedium(Pt)},[]),it=_ee.useMedium,Ct=L.useCallback(function(Pt){E.current!==Pt&&(E.current=Pt,f(Pt))},[]),_n=mE((a={},a[uee]=j&&"disabled",a[cU]=ee,a),tt),Vt=H!==!0,ln=Vt&&H!=="tail",xn=dee([s,Ct]),Xt=L.useMemo(function(){return{observed:E,shards:he,enabled:!j,active:v.current}},[j,v.current,he,d]);return ti.createElement(L.Fragment,null,Vt&&[ti.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:j?-1:0,style:XM}),ae?ti.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:j?-1:1,style:XM}):null],!j&&ti.createElement(Ee,{id:xe,sideCar:Vke,observed:d,disabled:j,persistentFocus:K,crossFrame:de,autoFocus:ge,whiteList:ne,shards:he,onActivation:ze,onDeactivation:Qe,returnFocus:et,focusOptions:Be,noFocusGuards:H}),ti.createElement(Me,mE({ref:xn},_n,{className:Z,onBlur:it,onFocus:ut}),ti.createElement(Fke.Provider,{value:Xt},N)),ln&&ti.createElement("div",{"data-focus-guard":!0,tabIndex:j?-1:0,style:XM}))});gF.propTypes={};function lU(r,t){return lU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},lU(r,t)}function Bke(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,lU(r,t)}function eR(r){"@babel/helpers - typeof";return eR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eR(r)}function Wke(r,t){if(eR(r)!="object"||!r)return r;var s=r[Symbol.toPrimitive];if(s!==void 0){var a=s.call(r,t);if(eR(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function zke(r){var t=Wke(r,"string");return eR(t)=="symbol"?t:t+""}function Gke(r,t,s){return(t=zke(t))in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function Hke(r,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function E(){f=r(d.map(function(T){return T.props})),t(f)}var v=function(T){Bke(w,T);function w(){return T.apply(this,arguments)||this}w.peek=function(){return f};var I=w.prototype;return I.componentDidMount=function(){d.push(this),E()},I.componentDidUpdate=function(){E()},I.componentWillUnmount=function(){var F=d.indexOf(this);d.splice(F,1),E()},I.render=function(){return ti.createElement(l,this.props)},w}(L.PureComponent);return Gke(v,"displayName","SideEffect("+s(l)+")"),v}}var Qh=function(r){for(var t=Array(r.length),s=0;s<r.length;++s)t[s]=r[s];return t},_E=function(r){return Array.isArray(r)?r:[r]},Eee=function(r){return Array.isArray(r)?r[0]:r},$ke=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(r,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},yee=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},vee=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},Kke=function(r){return r.hasAttribute("inert")},qke=function(r,t){return!r||vee(r)||!$ke(r)&&!Kke(r)&&t(yee(r))},See=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=qke(t,See.bind(void 0,r));return r.set(t,a),a},Yke=function(r,t){return r&&!vee(r)?Qke(r)?t(yee(r)):!1:!0},Tee=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=Yke(t,Tee.bind(void 0,r));return r.set(t,a),a},bee=function(r){return r.dataset},Xke=function(r){return r.tagName==="BUTTON"},wee=function(r){return r.tagName==="INPUT"},Ree=function(r){return wee(r)&&r.type==="radio"},Jke=function(r){return!((wee(r)||Xke(r))&&(r.type==="hidden"||r.disabled))},Qke=function(r){var t=r.getAttribute(Nke);return![!0,"true",""].includes(t)},_F=function(r){var t;return!!(r&&(!((t=bee(r))===null||t===void 0)&&t.focusGuard))},uU=function(r){return!_F(r)},Zke=function(r){return!!r},eNe=function(r,t){var s=Math.max(0,r.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=r.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},tNe=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},EF=function(r,t,s){return Qh(r).map(function(a,l){var d=tNe(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(eNe)},nNe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],yF=nNe.join(","),rNe="".concat(yF,", [data-focus-guard]"),Cee=function(r,t){return Qh((r.shadowRoot||r).children).reduce(function(s,a){return s.concat(a.matches(t?rNe:yF)?[a]:[],Cee(a))},[])},iNe=function(r,t){var s;return r instanceof HTMLIFrameElement&&(!((s=r.contentDocument)===null||s===void 0)&&s.body)?KS([r.contentDocument.body],t):[r]},KS=function(r,t){return r.reduce(function(s,a){var l,d=Cee(a,t),f=(l=[]).concat.apply(l,d.map(function(E){return iNe(E,t)}));return s.concat(f,a.parentNode?Qh(a.parentNode.querySelectorAll(yF)).filter(function(E){return E===a}):[])},[])},sNe=function(r){var t=r.querySelectorAll("[".concat(kke,"]"));return Qh(t).map(function(s){return KS([s])}).reduce(function(s,a){return s.concat(a)},[])},vF=function(r,t){return Qh(r).filter(function(s){return See(t,s)}).filter(function(s){return Jke(s)})},vq=function(r,t){return t===void 0&&(t=new Map),Qh(r).filter(function(s){return Tee(t,s)})},SF=function(r,t,s){return EF(vF(KS(r,s),t),!0,s)},tR=function(r,t){return EF(vF(KS(r),t),!1)},oNe=function(r,t){return vF(sNe(r),t)},dE=function(r,t){return r.shadowRoot?dE(r.shadowRoot,t):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,t)?!0:Qh(r.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?dE(l,t):!1}return dE(s,t)})},aNe=function(r){for(var t=new Set,s=r.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=r[a].compareDocumentPosition(r[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return r.filter(function(f,E){return!t.has(E)})},Iee=function(r){return r.parentNode?Iee(r.parentNode):r},TF=function(r){var t=_E(r);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(cU);return s.push.apply(s,l?aNe(Qh(Iee(a).querySelectorAll("[".concat(cU,'="').concat(l,'"]:not([').concat(uee,'="disabled"])')))):[a]),s},[])},cNe=function(r){try{return r()}catch{return}},nR=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var t=r.activeElement;return t.shadowRoot?nR(t.shadowRoot):t instanceof HTMLIFrameElement&&cNe(function(){return t.contentWindow.document})?nR(t.contentWindow.document):t}},lNe=function(r,t){return r===t},uNe=function(r,t){return!!Qh(r.querySelectorAll("iframe")).some(function(s){return lNe(s,t)})},Aee=function(r,t){return t===void 0&&(t=nR(Eee(r).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:TF(r).some(function(s){return dE(s,t)||uNe(s,t)})},dNe=function(r){r===void 0&&(r=document);var t=nR(r);return t?Qh(r.querySelectorAll("[".concat(Oke,"]"))).some(function(s){return dE(s,t)}):!1},hNe=function(r,t){return t.filter(Ree).filter(function(s){return s.name===r.name}).filter(function(s){return s.checked})[0]||r},bF=function(r,t){return Ree(r)&&r.name?hNe(r,t):r},pNe=function(r){var t=new Set;return r.forEach(function(s){return t.add(bF(s,r))}),r.filter(function(s){return t.has(s)})},Sq=function(r){return r[0]&&r.length>1?bF(r[0],r):r[0]},Tq=function(r,t){return r.indexOf(bF(t,r))},dU="NEW_FOCUS",fNe=function(r,t,s,a,l){var d=r.length,f=r[0],E=r[d-1],v=_F(a);if(!(a&&r.indexOf(a)>=0)){var T=a!==void 0?s.indexOf(a):-1,w=l?s.indexOf(l):T,I=l?r.indexOf(l):-1;if(T===-1)return I!==-1?I:dU;if(I===-1)return dU;var N=T-w,F=s.indexOf(f),j=s.indexOf(E),G=pNe(s),H=a!==void 0?G.indexOf(a):-1,te=l?G.indexOf(l):H,K=G.filter(function(Z){return Z.tabIndex>=0}),Q=a!==void 0?K.indexOf(a):-1,de=l?K.indexOf(l):Q,se=Q>=0&&de>=0?de-Q:te-H;if(!N&&I>=0||t.length===0)return I;var ge=Tq(r,t[0]),ee=Tq(r,t[t.length-1]);if(T<=F&&v&&Math.abs(N)>1)return ee;if(T>=j&&v&&Math.abs(N)>1)return ge;if(N&&Math.abs(se)>1)return I;if(T<=F)return ee;if(T>j)return ge;if(N)return Math.abs(N)>1?I:(d+I+N)%d}},mNe=function(r){return function(t){var s,a=(s=bee(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||r.indexOf(t)>=0}},bq=function(r,t,s){var a=r.map(function(d){var f=d.node;return f}),l=vq(a.filter(mNe(s)));return l&&l.length?Sq(l):Sq(vq(t))},hU=function(r,t){return t===void 0&&(t=[]),t.push(r),r.parentNode&&hU(r.parentNode.host||r.parentNode,t),t},JM=function(r,t){for(var s=hU(r),a=hU(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},Pee=function(r,t,s){var a=_E(r),l=_E(t),d=a[0],f=!1;return l.filter(Boolean).forEach(function(E){f=JM(f||E,E)||f,s.filter(Boolean).forEach(function(v){var T=JM(d,v);T&&(!f||dE(T,f)?f=T:f=JM(T,f))})}),f},wq=function(r,t){return r.reduce(function(s,a){return s.concat(oNe(a,t))},[])},gNe=function(r,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),r.map(function(a){return s.get(a)}).filter(Zke)},_Ne=function(r,t){var s=nR(_E(r).length>0?document:Eee(r).ownerDocument),a=TF(r).filter(uU),l=Pee(s||r,r,a),d=new Map,f=tR(a,d),E=f.filter(function(j){var G=j.node;return uU(G)});if(E[0]){var v=tR([l],d).map(function(j){var G=j.node;return G}),T=gNe(v,E),w=T.map(function(j){var G=j.node;return G}),I=T.filter(function(j){var G=j.tabIndex;return G>=0}).map(function(j){var G=j.node;return G}),N=fNe(w,I,v,s,t);if(N===dU){var F=bq(f,I,wq(a,d))||bq(f,w,wq(a,d));if(F)return{node:F};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:T[N]}},ENe=function(r){var t=TF(r).filter(uU),s=Pee(r,r,t),a=EF(KS([s],!0),!0,!0),l=KS(t,!1);return a.map(function(d){var f=d.node,E=d.index;return{node:f,index:E,lockItem:l.indexOf(f)>=0,guard:_F(f)}})},wF=function(r,t){r&&("focus"in r&&r.focus(t),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},QM=0,ZM=!1,Oee=function(r,t,s){s===void 0&&(s={});var a=_Ne(r,t);if(!ZM&&a){if(QM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),ZM=!0,setTimeout(function(){ZM=!1},1);return}QM++,wF(a.node,s.focusOptions),QM--}};function Gb(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var t=r?new WeakRef(r):null;return function(){return(t==null?void 0:t.deref())||null}}var yNe=function(r){if(!r)return null;for(var t=[],s=r;s&&s!==document.body;)t.push({current:Gb(s),parent:Gb(s.parentElement),left:Gb(s.previousElementSibling),right:Gb(s.nextElementSibling)}),s=s.parentElement;return{element:Gb(r),stack:t,ownerDocument:r.ownerDocument}},vNe=function(r){var t,s,a,l,d;if(r)for(var f=r.stack,E=r.ownerDocument,v=new Map,T=0,w=f;T<w.length;T++){var I=w[T],N=(t=I.parent)===null||t===void 0?void 0:t.call(I);if(N&&E.contains(N)){for(var F=(s=I.left)===null||s===void 0?void 0:s.call(I),j=I.current(),G=N.contains(j)?j:void 0,H=(a=I.right)===null||a===void 0?void 0:a.call(I),te=SF([N],v),K=(d=(l=G??(F==null?void 0:F.nextElementSibling))!==null&&l!==void 0?l:H)!==null&&d!==void 0?d:F;K;){for(var Q=0,de=te;Q<de.length;Q++){var se=de[Q];if(K!=null&&K.contains(se.node))return se.node}K=K.nextElementSibling}if(te.length)return te[0].node}}},kee=function(r){var t=yNe(r);return function(){return vNe(t)}},SNe=function(r,t,s){if(!r||!t)return console.error("no element or scope given"),{};var a=_E(t);if(a.every(function(f){return!dE(f,r)}))return console.error("Active element is not contained in the scope"),{};var l=s?SF(a,new Map):tR(a,new Map),d=l.findIndex(function(f){var E=f.node;return E===r});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},TNe=function(r,t){var s=t?SF(_E(r),new Map):tR(_E(r),new Map);return{first:s[0],last:s[s.length-1]}},bNe=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},Nee=function(r,t,s){t===void 0&&(t={});var a=bNe(t),l=SNe(r,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&wF(d.node,a.focusOptions)}},wNe=function(r,t){t===void 0&&(t={}),Nee(r,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},RNe=function(r,t){t===void 0&&(t={}),Nee(r,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},Dee=function(r,t,s){var a,l=TNe(r,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&wF(d.node,t.focusOptions)},CNe=function(r,t){t===void 0&&(t={}),Dee(r,t,"first")},INe=function(r,t){t===void 0&&(t={}),Dee(r,t,"last")};function RF(r){setTimeout(r,1)}var ANe=function(t){return t&&"current"in t?t.current:t},Lee=function(){return document&&document.activeElement===document.body},PNe=function(){return Lee()||dNe()},OS=null,xc=null,Rq=function(){return null},kS=null,rR=!1,CF=!1,ONe=function(){return!0},kNe=function(t){return(OS.whiteList||ONe)(t)},NNe=function(t,s){kS={observerNode:t,portaledElement:s}},DNe=function(t){return kS&&kS.portaledElement===t};function Cq(r,t,s,a){var l=null,d=r;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==r)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var LNe=function(t){return t?!!rR:rR==="meanwhile"},xNe=function r(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&r(t,s.parentNode,a))},MNe=function(t,s){return s.some(function(a){return xNe(t,a,a)})},xee=function(t){return tR(t,new Map)},UNe=function(t){return!xee([t.parentNode]).some(function(s){return s.node===t})},ok=function(){var t=!1;if(OS){var s=OS,a=s.observed,l=s.persistentFocus,d=s.autoFocus,f=s.shards,E=s.crossFrame,v=s.focusOptions,T=s.noFocusGuards,w=a||kS&&kS.portaledElement;if(Lee()&&xc&&xc!==document.body&&(!document.body.contains(xc)||UNe(xc))){var I=Rq();I&&I.focus()}var N=document&&document.activeElement;if(w){var F=[w].concat(f.map(ANe).filter(Boolean)),j=function(){if(!LNe(E)||!T||!xc||CF)return!1;var Q=xee(F),de=Q.findIndex(function(se){var ge=se.node;return ge===xc});return de===0||de===Q.length-1};if((!N||kNe(N))&&(l||j()||!PNe()||!xc&&d)&&(w&&!(Aee(F)||N&&MNe(N,F)||DNe(N))&&(document&&!xc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(t=Oee(F,xc,{focusOptions:v}),kS={})),xc=document&&document.activeElement,xc!==document.body&&(Rq=kee(xc)),rR=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var G=document&&document.activeElement,H=ENe(F),te=H.map(function(K){var Q=K.node;return Q}).indexOf(G);te>-1&&(H.filter(function(K){var Q=K.guard,de=K.node;return Q&&de.dataset.focusAutoGuard}).forEach(function(K){var Q=K.node;return Q.removeAttribute("tabIndex")}),Cq(te,H.length,1,H),Cq(te,-1,-1,H))}}}return t},Mee=function(t){ok()&&t&&(t.stopPropagation(),t.preventDefault())},IF=function(){return RF(ok)},VNe=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||NNe(a,s)},FNe=function(){return null},Uee=function(){CF=!0},Vee=function(){CF=!1,rR="just",RF(function(){rR="meanwhile"})},jNe=function(){document.addEventListener("focusin",Mee),document.addEventListener("focusout",IF),window.addEventListener("focus",Uee),window.addEventListener("blur",Vee)},BNe=function(){document.removeEventListener("focusin",Mee),document.removeEventListener("focusout",IF),window.removeEventListener("focus",Uee),window.removeEventListener("blur",Vee)};function WNe(r){return r.filter(function(t){var s=t.disabled;return!s})}var Fee={moveFocusInside:Oee,focusInside:Aee,focusNextElement:wNe,focusPrevElement:RNe,focusFirstElement:CNe,focusLastElement:INe,captureFocusRestore:kee};function zNe(r){var t=r.slice(-1)[0];t&&!OS&&jNe();var s=OS,a=s&&t&&t.id===s.id;OS=t,s&&!a&&(s.onDeactivation(),r.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(xc=null,(!a||s.observed!==t.observed)&&t.onActivation(Fee),ok(),RF(ok)):(BNe(),xc=null)}gee.assignSyncMedium(VNe);_ee.assignMedium(IF);Uke.assignMedium(function(r){return r(Fee)});const GNe=Hke(WNe,zNe)(FNe);var pU=L.forwardRef(function(t,s){return ti.createElement(gF,mE({sideCar:GNe,ref:s},t))}),jee=gF.propTypes||{};jee.sideCar;Rke(jee,["sideCar"]);pU.propTypes={};const HNe=pU.default??pU,Bee=r=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:E,persistentFocus:v,lockFocusAcrossFrames:T}=r,w=L.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&wJ(a.current).length===0&&requestAnimationFrame(()=>{var j;(j=a.current)==null||j.focus()})},[t,a]),I=L.useCallback(()=>{var F;(F=s==null?void 0:s.current)==null||F.focus()},[s]),N=l&&!s;return O.jsx(HNe,{crossFrame:T,persistentFocus:v,autoFocus:E,disabled:f,onActivation:w,onDeactivation:I,returnFocus:N,children:d})};Bee.displayName="FocusLock";const[$Ne,KNe]=Vi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),tf=tn((r,t)=>{const s=qc("FormError",r),a=ns(r),l=p0();return l!=null&&l.isInvalid?O.jsx($Ne,{value:s,children:O.jsx(Ut.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:Sn("chakra-form__error-message",r.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});tf.displayName="FormErrorMessage";const qNe=tn((r,t)=>{const s=KNe(),a=p0();if(!(a!=null&&a.isInvalid))return null;const l=Sn("chakra-form__error-icon",r.className);return O.jsx(Hn,{ref:t,"aria-hidden":!0,...r,__css:s.icon,className:l,children:O.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});qNe.displayName="FormErrorIcon";const Ah=tn(function(t,s){const a=Rd("FormLabel",t),l=ns(t),{className:d,children:f,requiredIndicator:E=O.jsx(Wee,{}),optionalIndicator:v=null,...T}=l,w=p0(),I=(w==null?void 0:w.getLabelProps(T,s))??{ref:s,...T};return O.jsxs(Ut.label,{...I,className:Sn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,w!=null&&w.isRequired?E:v]})});Ah.displayName="FormLabel";const Wee=tn(function(t,s){const a=p0(),l=aee();if(!(a!=null&&a.isRequired))return null;const d=Sn("chakra-form__required-indicator",t.className);return O.jsx(Ut.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});Wee.displayName="RequiredIndicator";const zee=tn(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:E,row:v,autoFlow:T,autoRows:w,templateRows:I,autoColumns:N,templateColumns:F,...j}=t,G={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:N,gridColumn:E,gridRow:v,gridAutoFlow:T,gridAutoRows:w,gridTemplateRows:I,gridTemplateColumns:F};return O.jsx(Ut.div,{ref:s,__css:G,...j})});zee.displayName="Grid";const Gee=tn(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:E,...v}=t,T=h0(),w=E?XNe(E,T):JNe(a);return O.jsx(zee,{ref:s,gap:f,columnGap:l,rowGap:d,templateColumns:w,...v})});Gee.displayName="SimpleGrid";function YNe(r){return typeof r=="number"?`${r}px`:r}function XNe(r,t){return uV(r,s=>{const a=POe("sizes",s,YNe(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function JNe(r){return uV(r,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function PR(r){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=r,d=L.Children.toArray(r.path),f=tn((E,v)=>O.jsx(Hn,{ref:v,viewBox:t,...l,...E,children:d.length?d:O.jsx("path",{fill:"currentColor",d:s})}));return f.displayName=a,f}const fU=tn(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=t;return O.jsx("img",{width:a,height:l,ref:s,alt:d,...f})});fU.displayName="NativeImage";const Dh=tn(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:E,fit:v,loading:T,ignoreFallback:w,crossOrigin:I,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:F,...j}=t,G=a!==void 0||l!==void 0,H=T!=null||w||!G,te=iee({...t,crossOrigin:I,ignoreFallback:H}),K=ske(te,N),Q={ref:s,objectFit:v,objectPosition:E,...H?j:_R(j,["onError","onLoad"])};return K?l||O.jsx(Ut.img,{as:fU,className:"chakra-image__placeholder",src:a,...Q}):O.jsx(Ut.img,{as:fU,src:d,srcSet:f,crossOrigin:I,loading:T,referrerPolicy:F,className:"chakra-image",...Q})});Dh.displayName="Image";const Ra=tn(function(t,s){const{htmlSize:a,...l}=t,d=qc("Input",l),f=ns(l),E=cee(f),v=Sn("chakra-input",t.className);return O.jsx(Ut.input,{size:a,...E,__css:d.field,ref:s,className:v})});Ra.displayName="Input";Ra.id="Input";const[QNe,ZNe]=Vi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),mU=tn(function(t,s){const a=qc("Input",t),{children:l,className:d,...f}=ns(t),E=Sn("chakra-input__group",d),v={},T=cV(l),w=a.field;T.forEach(N=>{a&&(w&&N.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&N.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const I=T.map(N=>{var j,G;const F=xk({size:((j=N.props)==null?void 0:j.size)||t.size,variant:((G=N.props)==null?void 0:G.variant)||t.variant});return N.type.id!=="Input"?L.cloneElement(N,F):L.cloneElement(N,Object.assign(F,v,N.props))});return O.jsx(Ut.div,{className:E,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:O.jsx(QNe,{value:a,children:I})})});mU.displayName="InputGroup";const e1e=Ut("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),Jk=tn(function(t,s){const{placement:a="left",...l}=t,d=ZNe(),f=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return O.jsx(e1e,{ref:s,__css:v,...l})});Jk.id="InputElement";Jk.displayName="InputElement";const ak=tn(function(t,s){const{className:a,...l}=t,d=Sn("chakra-input__left-element",a);return O.jsx(Jk,{ref:s,placement:"left",className:d,...l})});ak.id="InputLeftElement";ak.displayName="InputLeftElement";const Hee=tn(function(t,s){const{className:a,...l}=t,d=Sn("chakra-input__right-element",a);return O.jsx(Jk,{ref:s,placement:"right",className:d,...l})});Hee.id="InputRightElement";Hee.displayName="InputRightElement";const Kh=tn(function(t,s){const a=Rd("Link",t),{className:l,isExternal:d,...f}=ns(t);return O.jsx(Ut.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:Sn("chakra-link",l),...f,__css:a})});Kh.displayName="Link";function t1e(r,t={}){const{ssr:s=!0,fallback:a}=t,{getWindow:l}=NRe(),d=Array.isArray(r)?r:[r];let f=Array.isArray(a)?a:[a];f=f.filter(T=>T!=null);const[E,v]=L.useState(()=>d.map((T,w)=>({media:T,matches:s?!!f[w]:l().matchMedia(T).matches})));return L.useEffect(()=>{const T=l();v(d.map(N=>({media:N,matches:T.matchMedia(N).matches})));const w=d.map(N=>T.matchMedia(N)),I=N=>{v(F=>F.slice().map(j=>j.media===N.media?{...j,matches:N.matches}:j))};return w.forEach(N=>{typeof N.addListener=="function"?N.addListener(I):N.addEventListener("change",I)}),()=>{w.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(I):N.removeEventListener("change",I)})}},[l]),E.map(T=>T.matches)}function n1e(r,t,s,a){if(t==null)return a;if(!a)return r.find(f=>s(f).toLowerCase().startsWith(t.toLowerCase()));const l=r.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=r.indexOf(l[0]),r[d])}return a}function r1e(r){const{key:t}=r;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function i1e(r={}){const{timeout:t=300,preventDefault:s=()=>!0}=r,[a,l]=L.useState([]),d=L.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},t)};L.useEffect(()=>f,[]);function v(T){return w=>{if(w.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(r1e(w)){const I=a.concat(w.key);s(w)&&(w.preventDefault(),w.stopPropagation()),l(I),T(I.join("")),E()}}}return v}var Wc="top",Su="bottom",Tu="right",zc="left",AF="auto",OR=[Wc,Su,Tu,zc],qS="start",iR="end",s1e="clippingParents",$ee="viewport",Hb="popper",o1e="reference",Iq=OR.reduce(function(r,t){return r.concat([t+"-"+qS,t+"-"+iR])},[]),Kee=[].concat(OR,[AF]).reduce(function(r,t){return r.concat([t,t+"-"+qS,t+"-"+iR])},[]),a1e="beforeRead",c1e="read",l1e="afterRead",u1e="beforeMain",d1e="main",h1e="afterMain",p1e="beforeWrite",f1e="write",m1e="afterWrite",g1e=[a1e,c1e,l1e,u1e,d1e,h1e,p1e,f1e,m1e];function qh(r){return r?(r.nodeName||"").toLowerCase():null}function Pl(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var t=r.ownerDocument;return t&&t.defaultView||window}return r}function EE(r){var t=Pl(r).Element;return r instanceof t||r instanceof Element}function yu(r){var t=Pl(r).HTMLElement;return r instanceof t||r instanceof HTMLElement}function PF(r){if(typeof ShadowRoot>"u")return!1;var t=Pl(r).ShadowRoot;return r instanceof t||r instanceof ShadowRoot}function _1e(r){var t=r.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!yu(d)||!qh(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var E=l[f];E===!1?d.removeAttribute(f):d.setAttribute(f,E===!0?"":E)}))})}function E1e(r){var t=r.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},f=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),E=f.reduce(function(v,T){return v[T]="",v},{});!yu(l)||!qh(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const y1e={name:"applyStyles",enabled:!0,phase:"write",fn:_1e,effect:E1e,requires:["computeStyles"]};function jh(r){return r.split("-")[0]}var hE=Math.max,ck=Math.min,YS=Math.round;function gU(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function qee(){return!/^((?!chrome|android).)*safari/i.test(gU())}function XS(r,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=r.getBoundingClientRect(),l=1,d=1;t&&yu(r)&&(l=r.offsetWidth>0&&YS(a.width)/r.offsetWidth||1,d=r.offsetHeight>0&&YS(a.height)/r.offsetHeight||1);var f=EE(r)?Pl(r):window,E=f.visualViewport,v=!qee()&&s,T=(a.left+(v&&E?E.offsetLeft:0))/l,w=(a.top+(v&&E?E.offsetTop:0))/d,I=a.width/l,N=a.height/d;return{width:I,height:N,top:w,right:T+I,bottom:w+N,left:T,x:T,y:w}}function OF(r){var t=XS(r),s=r.offsetWidth,a=r.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:r.offsetLeft,y:r.offsetTop,width:s,height:a}}function Yee(r,t){var s=t.getRootNode&&t.getRootNode();if(r.contains(t))return!0;if(s&&PF(s)){var a=t;do{if(a&&r.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Sf(r){return Pl(r).getComputedStyle(r)}function v1e(r){return["table","td","th"].indexOf(qh(r))>=0}function vg(r){return((EE(r)?r.ownerDocument:r.document)||window.document).documentElement}function Qk(r){return qh(r)==="html"?r:r.assignedSlot||r.parentNode||(PF(r)?r.host:null)||vg(r)}function Aq(r){return!yu(r)||Sf(r).position==="fixed"?null:r.offsetParent}function S1e(r){var t=/firefox/i.test(gU()),s=/Trident/i.test(gU());if(s&&yu(r)){var a=Sf(r);if(a.position==="fixed")return null}var l=Qk(r);for(PF(l)&&(l=l.host);yu(l)&&["html","body"].indexOf(qh(l))<0;){var d=Sf(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function kR(r){for(var t=Pl(r),s=Aq(r);s&&v1e(s)&&Sf(s).position==="static";)s=Aq(s);return s&&(qh(s)==="html"||qh(s)==="body"&&Sf(s).position==="static")?t:s||S1e(r)||t}function kF(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Nw(r,t,s){return hE(r,ck(t,s))}function T1e(r,t,s){var a=Nw(r,t,s);return a>s?s:a}function Xee(){return{top:0,right:0,bottom:0,left:0}}function Jee(r){return Object.assign({},Xee(),r)}function Qee(r,t){return t.reduce(function(s,a){return s[a]=r,s},{})}var b1e=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,Jee(typeof t!="number"?t:Qee(t,OR))};function w1e(r){var t,s=r.state,a=r.name,l=r.options,d=s.elements.arrow,f=s.modifiersData.popperOffsets,E=jh(s.placement),v=kF(E),T=[zc,Tu].indexOf(E)>=0,w=T?"height":"width";if(!(!d||!f)){var I=b1e(l.padding,s),N=OF(d),F=v==="y"?Wc:zc,j=v==="y"?Su:Tu,G=s.rects.reference[w]+s.rects.reference[v]-f[v]-s.rects.popper[w],H=f[v]-s.rects.reference[v],te=kR(d),K=te?v==="y"?te.clientHeight||0:te.clientWidth||0:0,Q=G/2-H/2,de=I[F],se=K-N[w]-I[j],ge=K/2-N[w]/2+Q,ee=Nw(de,ge,se),Z=v;s.modifiersData[a]=(t={},t[Z]=ee,t.centerOffset=ee-ge,t)}}function R1e(r){var t=r.state,s=r.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||Yee(t.elements.popper,l)&&(t.elements.arrow=l))}const C1e={name:"arrow",enabled:!0,phase:"main",fn:w1e,effect:R1e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function JS(r){return r.split("-")[1]}var I1e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function A1e(r,t){var s=r.x,a=r.y,l=t.devicePixelRatio||1;return{x:YS(s*l)/l||0,y:YS(a*l)/l||0}}function Pq(r){var t,s=r.popper,a=r.popperRect,l=r.placement,d=r.variation,f=r.offsets,E=r.position,v=r.gpuAcceleration,T=r.adaptive,w=r.roundOffsets,I=r.isFixed,N=f.x,F=N===void 0?0:N,j=f.y,G=j===void 0?0:j,H=typeof w=="function"?w({x:F,y:G}):{x:F,y:G};F=H.x,G=H.y;var te=f.hasOwnProperty("x"),K=f.hasOwnProperty("y"),Q=zc,de=Wc,se=window;if(T){var ge=kR(s),ee="clientHeight",Z="clientWidth";if(ge===Pl(s)&&(ge=vg(s),Sf(ge).position!=="static"&&E==="absolute"&&(ee="scrollHeight",Z="scrollWidth")),ge=ge,l===Wc||(l===zc||l===Tu)&&d===iR){de=Su;var ne=I&&ge===se&&se.visualViewport?se.visualViewport.height:ge[ee];G-=ne-a.height,G*=v?1:-1}if(l===zc||(l===Wc||l===Su)&&d===iR){Q=Tu;var ae=I&&ge===se&&se.visualViewport?se.visualViewport.width:ge[Z];F-=ae-a.width,F*=v?1:-1}}var me=Object.assign({position:E},T&&I1e),he=w===!0?A1e({x:F,y:G},Pl(s)):{x:F,y:G};if(F=he.x,G=he.y,v){var le;return Object.assign({},me,(le={},le[de]=K?"0":"",le[Q]=te?"0":"",le.transform=(se.devicePixelRatio||1)<=1?"translate("+F+"px, "+G+"px)":"translate3d("+F+"px, "+G+"px, 0)",le))}return Object.assign({},me,(t={},t[de]=K?G+"px":"",t[Q]=te?F+"px":"",t.transform="",t))}function P1e(r){var t=r.state,s=r.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,f=d===void 0?!0:d,E=s.roundOffsets,v=E===void 0?!0:E,T={placement:jh(t.placement),variation:JS(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Pq(Object.assign({},T,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Pq(Object.assign({},T,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const O1e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:P1e,data:{}};var qP={passive:!0};function k1e(r){var t=r.state,s=r.instance,a=r.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,E=f===void 0?!0:f,v=Pl(t.elements.popper),T=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&T.forEach(function(w){w.addEventListener("scroll",s.update,qP)}),E&&v.addEventListener("resize",s.update,qP),function(){d&&T.forEach(function(w){w.removeEventListener("scroll",s.update,qP)}),E&&v.removeEventListener("resize",s.update,qP)}}const N1e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:k1e,data:{}};var D1e={left:"right",right:"left",bottom:"top",top:"bottom"};function IO(r){return r.replace(/left|right|bottom|top/g,function(t){return D1e[t]})}var L1e={start:"end",end:"start"};function Oq(r){return r.replace(/start|end/g,function(t){return L1e[t]})}function NF(r){var t=Pl(r),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function DF(r){return XS(vg(r)).left+NF(r).scrollLeft}function x1e(r,t){var s=Pl(r),a=vg(r),l=s.visualViewport,d=a.clientWidth,f=a.clientHeight,E=0,v=0;if(l){d=l.width,f=l.height;var T=qee();(T||!T&&t==="fixed")&&(E=l.offsetLeft,v=l.offsetTop)}return{width:d,height:f,x:E+DF(r),y:v}}function M1e(r){var t,s=vg(r),a=NF(r),l=(t=r.ownerDocument)==null?void 0:t.body,d=hE(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=hE(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+DF(r),v=-a.scrollTop;return Sf(l||s).direction==="rtl"&&(E+=hE(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:E,y:v}}function LF(r){var t=Sf(r),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function Zee(r){return["html","body","#document"].indexOf(qh(r))>=0?r.ownerDocument.body:yu(r)&&LF(r)?r:Zee(Qk(r))}function Dw(r,t){var s;t===void 0&&(t=[]);var a=Zee(r),l=a===((s=r.ownerDocument)==null?void 0:s.body),d=Pl(a),f=l?[d].concat(d.visualViewport||[],LF(a)?a:[]):a,E=t.concat(f);return l?E:E.concat(Dw(Qk(f)))}function _U(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function U1e(r,t){var s=XS(r,!1,t==="fixed");return s.top=s.top+r.clientTop,s.left=s.left+r.clientLeft,s.bottom=s.top+r.clientHeight,s.right=s.left+r.clientWidth,s.width=r.clientWidth,s.height=r.clientHeight,s.x=s.left,s.y=s.top,s}function kq(r,t,s){return t===$ee?_U(x1e(r,s)):EE(t)?U1e(t,s):_U(M1e(vg(r)))}function V1e(r){var t=Dw(Qk(r)),s=["absolute","fixed"].indexOf(Sf(r).position)>=0,a=s&&yu(r)?kR(r):r;return EE(a)?t.filter(function(l){return EE(l)&&Yee(l,a)&&qh(l)!=="body"}):[]}function F1e(r,t,s,a){var l=t==="clippingParents"?V1e(r):[].concat(t),d=[].concat(l,[s]),f=d[0],E=d.reduce(function(v,T){var w=kq(r,T,a);return v.top=hE(w.top,v.top),v.right=ck(w.right,v.right),v.bottom=ck(w.bottom,v.bottom),v.left=hE(w.left,v.left),v},kq(r,f,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function ete(r){var t=r.reference,s=r.element,a=r.placement,l=a?jh(a):null,d=a?JS(a):null,f=t.x+t.width/2-s.width/2,E=t.y+t.height/2-s.height/2,v;switch(l){case Wc:v={x:f,y:t.y-s.height};break;case Su:v={x:f,y:t.y+t.height};break;case Tu:v={x:t.x+t.width,y:E};break;case zc:v={x:t.x-s.width,y:E};break;default:v={x:t.x,y:t.y}}var T=l?kF(l):null;if(T!=null){var w=T==="y"?"height":"width";switch(d){case qS:v[T]=v[T]-(t[w]/2-s[w]/2);break;case iR:v[T]=v[T]+(t[w]/2-s[w]/2);break}}return v}function sR(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?r.placement:a,d=s.strategy,f=d===void 0?r.strategy:d,E=s.boundary,v=E===void 0?s1e:E,T=s.rootBoundary,w=T===void 0?$ee:T,I=s.elementContext,N=I===void 0?Hb:I,F=s.altBoundary,j=F===void 0?!1:F,G=s.padding,H=G===void 0?0:G,te=Jee(typeof H!="number"?H:Qee(H,OR)),K=N===Hb?o1e:Hb,Q=r.rects.popper,de=r.elements[j?K:N],se=F1e(EE(de)?de:de.contextElement||vg(r.elements.popper),v,w,f),ge=XS(r.elements.reference),ee=ete({reference:ge,element:Q,placement:l}),Z=_U(Object.assign({},Q,ee)),ne=N===Hb?Z:ge,ae={top:se.top-ne.top+te.top,bottom:ne.bottom-se.bottom+te.bottom,left:se.left-ne.left+te.left,right:ne.right-se.right+te.right},me=r.modifiersData.offset;if(N===Hb&&me){var he=me[l];Object.keys(ae).forEach(function(le){var Me=[Tu,Su].indexOf(le)>=0?1:-1,Ge=[Wc,Su].indexOf(le)>=0?"y":"x";ae[le]+=he[Ge]*Me})}return ae}function j1e(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,f=s.padding,E=s.flipVariations,v=s.allowedAutoPlacements,T=v===void 0?Kee:v,w=JS(a),I=w?E?Iq:Iq.filter(function(j){return JS(j)===w}):OR,N=I.filter(function(j){return T.indexOf(j)>=0});N.length===0&&(N=I);var F=N.reduce(function(j,G){return j[G]=sR(r,{placement:G,boundary:l,rootBoundary:d,padding:f})[jh(G)],j},{});return Object.keys(F).sort(function(j,G){return F[j]-F[G]})}function B1e(r){if(jh(r)===AF)return[];var t=IO(r);return[Oq(r),t,Oq(t)]}function W1e(r){var t=r.state,s=r.options,a=r.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,E=f===void 0?!0:f,v=s.fallbackPlacements,T=s.padding,w=s.boundary,I=s.rootBoundary,N=s.altBoundary,F=s.flipVariations,j=F===void 0?!0:F,G=s.allowedAutoPlacements,H=t.options.placement,te=jh(H),K=te===H,Q=v||(K||!j?[IO(H)]:B1e(H)),de=[H].concat(Q).reduce(function(xe,ze){return xe.concat(jh(ze)===AF?j1e(t,{placement:ze,boundary:w,rootBoundary:I,padding:T,flipVariations:j,allowedAutoPlacements:G}):ze)},[]),se=t.rects.reference,ge=t.rects.popper,ee=new Map,Z=!0,ne=de[0],ae=0;ae<de.length;ae++){var me=de[ae],he=jh(me),le=JS(me)===qS,Me=[Wc,Su].indexOf(he)>=0,Ge=Me?"width":"height",tt=sR(t,{placement:me,boundary:w,rootBoundary:I,altBoundary:N,padding:T}),Ee=Me?le?Tu:zc:le?Su:Wc;se[Ge]>ge[Ge]&&(Ee=IO(Ee));var we=IO(Ee),ve=[];if(d&&ve.push(tt[he]<=0),E&&ve.push(tt[Ee]<=0,tt[we]<=0),ve.every(function(xe){return xe})){ne=me,Z=!1;break}ee.set(me,ve)}if(Z)for(var Be=j?3:1,Oe=function(ze){var Qe=de.find(function(et){var ut=ee.get(et);if(ut)return ut.slice(0,ze).every(function(it){return it})});if(Qe)return ne=Qe,"break"},be=Be;be>0;be--){var Ce=Oe(be);if(Ce==="break")break}t.placement!==ne&&(t.modifiersData[a]._skip=!0,t.placement=ne,t.reset=!0)}}const z1e={name:"flip",enabled:!0,phase:"main",fn:W1e,requiresIfExists:["offset"],data:{_skip:!1}};function Nq(r,t,s){return s===void 0&&(s={x:0,y:0}),{top:r.top-t.height-s.y,right:r.right-t.width+s.x,bottom:r.bottom-t.height+s.y,left:r.left-t.width-s.x}}function Dq(r){return[Wc,Tu,Su,zc].some(function(t){return r[t]>=0})}function G1e(r){var t=r.state,s=r.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,f=sR(t,{elementContext:"reference"}),E=sR(t,{altBoundary:!0}),v=Nq(f,a),T=Nq(E,l,d),w=Dq(v),I=Dq(T);t.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:T,isReferenceHidden:w,hasPopperEscaped:I},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":I})}const H1e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:G1e};function $1e(r,t,s){var a=jh(r),l=[zc,Wc].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:r})):s,f=d[0],E=d[1];return f=f||0,E=(E||0)*l,[zc,Tu].indexOf(a)>=0?{x:E,y:f}:{x:f,y:E}}function K1e(r){var t=r.state,s=r.options,a=r.name,l=s.offset,d=l===void 0?[0,0]:l,f=Kee.reduce(function(w,I){return w[I]=$1e(I,t.rects,d),w},{}),E=f[t.placement],v=E.x,T=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=T),t.modifiersData[a]=f}const q1e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:K1e};function Y1e(r){var t=r.state,s=r.name;t.modifiersData[s]=ete({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const X1e={name:"popperOffsets",enabled:!0,phase:"read",fn:Y1e,data:{}};function J1e(r){return r==="x"?"y":"x"}function Q1e(r){var t=r.state,s=r.options,a=r.name,l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,E=f===void 0?!1:f,v=s.boundary,T=s.rootBoundary,w=s.altBoundary,I=s.padding,N=s.tether,F=N===void 0?!0:N,j=s.tetherOffset,G=j===void 0?0:j,H=sR(t,{boundary:v,rootBoundary:T,padding:I,altBoundary:w}),te=jh(t.placement),K=JS(t.placement),Q=!K,de=kF(te),se=J1e(de),ge=t.modifiersData.popperOffsets,ee=t.rects.reference,Z=t.rects.popper,ne=typeof G=="function"?G(Object.assign({},t.rects,{placement:t.placement})):G,ae=typeof ne=="number"?{mainAxis:ne,altAxis:ne}:Object.assign({mainAxis:0,altAxis:0},ne),me=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,he={x:0,y:0};if(ge){if(d){var le,Me=de==="y"?Wc:zc,Ge=de==="y"?Su:Tu,tt=de==="y"?"height":"width",Ee=ge[de],we=Ee+H[Me],ve=Ee-H[Ge],Be=F?-Z[tt]/2:0,Oe=K===qS?ee[tt]:Z[tt],be=K===qS?-Z[tt]:-ee[tt],Ce=t.elements.arrow,xe=F&&Ce?OF(Ce):{width:0,height:0},ze=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Xee(),Qe=ze[Me],et=ze[Ge],ut=Nw(0,ee[tt],xe[tt]),it=Q?ee[tt]/2-Be-ut-Qe-ae.mainAxis:Oe-ut-Qe-ae.mainAxis,Ct=Q?-ee[tt]/2+Be+ut+et+ae.mainAxis:be+ut+et+ae.mainAxis,_n=t.elements.arrow&&kR(t.elements.arrow),Vt=_n?de==="y"?_n.clientTop||0:_n.clientLeft||0:0,ln=(le=me==null?void 0:me[de])!=null?le:0,xn=Ee+it-ln-Vt,Xt=Ee+Ct-ln,Pt=Nw(F?ck(we,xn):we,Ee,F?hE(ve,Xt):ve);ge[de]=Pt,he[de]=Pt-Ee}if(E){var Dt,Te=de==="x"?Wc:zc,Ue=de==="x"?Su:Tu,$e=ge[se],mt=se==="y"?"height":"width",Et=$e+H[Te],yt=$e-H[Ue],zt=[Wc,zc].indexOf(te)!==-1,dn=(Dt=me==null?void 0:me[se])!=null?Dt:0,hn=zt?Et:$e-ee[mt]-Z[mt]-dn+ae.altAxis,Yt=zt?$e+ee[mt]+Z[mt]-dn-ae.altAxis:yt,Bn=F&&zt?T1e(hn,$e,Yt):Nw(F?hn:Et,$e,F?Yt:yt);ge[se]=Bn,he[se]=Bn-$e}t.modifiersData[a]=he}}const Z1e={name:"preventOverflow",enabled:!0,phase:"main",fn:Q1e,requiresIfExists:["offset"]};function eDe(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function tDe(r){return r===Pl(r)||!yu(r)?NF(r):eDe(r)}function nDe(r){var t=r.getBoundingClientRect(),s=YS(t.width)/r.offsetWidth||1,a=YS(t.height)/r.offsetHeight||1;return s!==1||a!==1}function rDe(r,t,s){s===void 0&&(s=!1);var a=yu(t),l=yu(t)&&nDe(t),d=vg(t),f=XS(r,l,s),E={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((qh(t)!=="body"||LF(d))&&(E=tDe(t)),yu(t)?(v=XS(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=DF(d))),{x:f.left+E.scrollLeft-v.x,y:f.top+E.scrollTop-v.y,width:f.width,height:f.height}}function iDe(r){var t=new Map,s=new Set,a=[];r.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(E){if(!s.has(E)){var v=t.get(E);v&&l(v)}}),a.push(d)}return r.forEach(function(d){s.has(d.name)||l(d)}),a}function sDe(r){var t=iDe(r);return g1e.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function oDe(r){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(r())})})),t}}function aDe(r){var t=r.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var Lq={placement:"bottom",modifiers:[],strategy:"absolute"};function xq(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function cDe(r){r===void 0&&(r={});var t=r,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?Lq:l;return function(E,v,T){T===void 0&&(T=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},Lq,d),modifiersData:{},elements:{reference:E,popper:v},attributes:{},styles:{}},I=[],N=!1,F={state:w,setOptions:function(te){var K=typeof te=="function"?te(w.options):te;G(),w.options=Object.assign({},d,w.options,K),w.scrollParents={reference:EE(E)?Dw(E):E.contextElement?Dw(E.contextElement):[],popper:Dw(v)};var Q=sDe(aDe([].concat(a,w.options.modifiers)));return w.orderedModifiers=Q.filter(function(de){return de.enabled}),j(),F.update()},forceUpdate:function(){if(!N){var te=w.elements,K=te.reference,Q=te.popper;if(xq(K,Q)){w.rects={reference:rDe(K,kR(Q),w.options.strategy==="fixed"),popper:OF(Q)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(ae){return w.modifiersData[ae.name]=Object.assign({},ae.data)});for(var de=0;de<w.orderedModifiers.length;de++){if(w.reset===!0){w.reset=!1,de=-1;continue}var se=w.orderedModifiers[de],ge=se.fn,ee=se.options,Z=ee===void 0?{}:ee,ne=se.name;typeof ge=="function"&&(w=ge({state:w,options:Z,name:ne,instance:F})||w)}}}},update:oDe(function(){return new Promise(function(H){F.forceUpdate(),H(w)})}),destroy:function(){G(),N=!0}};if(!xq(E,v))return F;F.setOptions(T).then(function(H){!N&&T.onFirstUpdate&&T.onFirstUpdate(H)});function j(){w.orderedModifiers.forEach(function(H){var te=H.name,K=H.options,Q=K===void 0?{}:K,de=H.effect;if(typeof de=="function"){var se=de({state:w,name:te,instance:F,options:Q}),ge=function(){};I.push(se||ge)}})}function G(){I.forEach(function(H){return H()}),I=[]}return F}}var lDe=[N1e,X1e,O1e,y1e,q1e,z1e,Z1e,C1e,H1e],uDe=cDe({defaultModifiers:lDe});const Qv=(r,t)=>({var:r,varRef:t?`var(${r}, ${t})`:`var(${r})`}),Ws={arrowShadowColor:Qv("--popper-arrow-shadow-color"),arrowSize:Qv("--popper-arrow-size","8px"),arrowSizeHalf:Qv("--popper-arrow-size-half"),arrowBg:Qv("--popper-arrow-bg"),transformOrigin:Qv("--popper-transform-origin"),arrowOffset:Qv("--popper-arrow-offset")};function dDe(r){if(r.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const hDe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},pDe=r=>hDe[r],Mq={scroll:!0,resize:!0};function fDe(r){let t;return typeof r=="object"?t={enabled:!0,options:{...Mq,...r}}:t={enabled:r,options:Mq},t}const mDe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:r})=>{r.styles.popper.width=`${r.rects.reference.width}px`},effect:({state:r})=>()=>{const t=r.elements.reference;r.elements.popper.style.width=`${t.offsetWidth}px`}},gDe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:r})=>{Uq(r)},effect:({state:r})=>()=>{Uq(r)}},Uq=r=>{r.elements.popper.style.setProperty(Ws.transformOrigin.var,pDe(r.placement))},_De={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:r})=>{EDe(r)}},EDe=r=>{var s;if(!r.placement)return;const t=yDe(r.placement);if((s=r.elements)!=null&&s.arrow&&t){Object.assign(r.elements.arrow.style,{[t.property]:t.value,width:Ws.arrowSize.varRef,height:Ws.arrowSize.varRef,zIndex:-1});const a={[Ws.arrowSizeHalf.var]:`calc(${Ws.arrowSize.varRef} / 2 - 1px)`,[Ws.arrowOffset.var]:`calc(${Ws.arrowSizeHalf.varRef} * -1)`};for(const l in a)r.elements.arrow.style.setProperty(l,a[l])}},yDe=r=>{if(r.startsWith("top"))return{property:"bottom",value:Ws.arrowOffset.varRef};if(r.startsWith("bottom"))return{property:"top",value:Ws.arrowOffset.varRef};if(r.startsWith("left"))return{property:"right",value:Ws.arrowOffset.varRef};if(r.startsWith("right"))return{property:"left",value:Ws.arrowOffset.varRef}},vDe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:r})=>{Vq(r)},effect:({state:r})=>()=>{Vq(r)}},Vq=r=>{if(!r.elements.arrow)return;const t=r.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=dDe(r.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:Ws.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},SDe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},TDe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function bDe(r,t="ltr"){var a;const s=((a=SDe[r])==null?void 0:a[t])||r;return t==="ltr"?s:TDe[r]??s}function xF(r={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:E,gutter:v=8,flip:T=!0,boundary:w="clippingParents",preventOverflow:I=!0,matchWidth:N,direction:F="ltr"}=r,j=L.useRef(null),G=L.useRef(null),H=L.useRef(null),te=bDe(a,F),K=L.useRef(()=>{}),Q=L.useCallback(()=>{var ae;!t||!j.current||!G.current||((ae=K.current)==null||ae.call(K),H.current=uDe(j.current,G.current,{placement:te,modifiers:[vDe,_De,gDe,{...mDe,enabled:!!N},{name:"eventListeners",...fDe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,v]}},{name:"flip",enabled:!!T,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:w}},...s??[]],strategy:l}),H.current.forceUpdate(),K.current=H.current.destroy)},[te,t,s,N,f,d,E,v,T,I,w,l]);L.useEffect(()=>()=>{var ae;!j.current&&!G.current&&((ae=H.current)==null||ae.destroy(),H.current=null)},[]);const de=L.useCallback(ae=>{j.current=ae,Q()},[Q]),se=L.useCallback((ae={},me=null)=>({...ae,ref:Hi(de,me)}),[de]),ge=L.useCallback(ae=>{G.current=ae,Q()},[Q]),ee=L.useCallback((ae={},me=null)=>({...ae,ref:Hi(ge,me),style:{...ae.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ge,N]),Z=L.useCallback((ae={},me=null)=>{const{size:he,shadowColor:le,bg:Me,style:Ge,...tt}=ae;return{...tt,ref:me,"data-popper-arrow":"",style:wDe(ae)}},[]),ne=L.useCallback((ae={},me=null)=>({...ae,ref:me,"data-popper-arrow-inner":""}),[]);return{update(){var ae;(ae=H.current)==null||ae.update()},forceUpdate(){var ae;(ae=H.current)==null||ae.forceUpdate()},transformOrigin:Ws.transformOrigin.varRef,referenceRef:de,popperRef:ge,getPopperProps:ee,getArrowProps:Z,getArrowInnerProps:ne,getReferenceProps:se}}function wDe(r){const{size:t,shadowColor:s,bg:a,style:l}=r,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function RDe(){const r=L.useRef(new Map),t=r.current,s=L.useCallback((l,d,f,E)=>{r.current.set(f,{type:d,el:l,options:E}),l.addEventListener(d,f,E)},[]),a=L.useCallback((l,d,f,E)=>{l.removeEventListener(d,f,E),r.current.delete(f)},[]);return L.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function e2(r){var l,d;const t=((d=(l=r.composedPath)==null?void 0:l.call(r))==null?void 0:d[0])??r.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function tte(r={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:E,onClick:v,onKeyDown:T,onKeyUp:w,tabIndex:I,onMouseOver:N,onMouseLeave:F,...j}=r,[G,H]=L.useState(!0),[te,K]=L.useState(!1),Q=RDe(),de=Ee=>{Ee&&Ee.tagName!=="BUTTON"&&H(!1)},se=G?I:I||0,ge=s&&!a,ee=L.useCallback(Ee=>{if(s){Ee.stopPropagation(),Ee.preventDefault();return}Ee.currentTarget.focus(),v==null||v(Ee)},[s,v]),Z=L.useCallback(Ee=>{te&&e2(Ee)&&(Ee.preventDefault(),Ee.stopPropagation(),K(!1),Q.remove(document,"keyup",Z,!1))},[te,Q]),ne=L.useCallback(Ee=>{if(T==null||T(Ee),s||Ee.defaultPrevented||Ee.metaKey||!e2(Ee.nativeEvent)||G)return;const we=l&&Ee.key==="Enter";d&&Ee.key===" "&&(Ee.preventDefault(),K(!0)),we&&(Ee.preventDefault(),Ee.currentTarget.click()),Q.add(document,"keyup",Z,!1)},[s,G,T,l,d,Q,Z]),ae=L.useCallback(Ee=>{if(w==null||w(Ee),s||Ee.defaultPrevented||Ee.metaKey||!e2(Ee.nativeEvent)||G)return;d&&Ee.key===" "&&(Ee.preventDefault(),K(!1),Ee.currentTarget.click())},[d,G,s,w]),me=L.useCallback(Ee=>{Ee.button===0&&(K(!1),Q.remove(document,"mouseup",me,!1))},[Q]),he=L.useCallback(Ee=>{if(Ee.button!==0)return;if(s){Ee.stopPropagation(),Ee.preventDefault();return}G||K(!0),Ee.currentTarget.focus({preventScroll:!0}),Q.add(document,"mouseup",me,!1),f==null||f(Ee)},[s,G,f,Q,me]),le=L.useCallback(Ee=>{Ee.button===0&&(G||K(!1),E==null||E(Ee))},[E,G]),Me=L.useCallback(Ee=>{if(s){Ee.preventDefault();return}N==null||N(Ee)},[s,N]),Ge=L.useCallback(Ee=>{te&&(Ee.preventDefault(),K(!1)),F==null||F(Ee)},[te,F]),tt=Hi(t,de);return G?{...j,ref:tt,type:"button","aria-disabled":ge?void 0:s,disabled:ge,onClick:ee,onMouseDown:f,onMouseUp:E,onKeyUp:w,onKeyDown:T,onMouseOver:N,onMouseLeave:F}:{...j,ref:tt,role:"button","data-active":Yn(te),"aria-disabled":s?"true":void 0,tabIndex:ge?void 0:se,onClick:ee,onMouseDown:he,onMouseUp:le,onKeyUp:ae,onKeyDown:ne,onMouseOver:Me,onMouseLeave:Ge}}const[CDe,IDe,ADe,PDe]=tee(),[ODe,NR]=Vi({strict:!1,name:"MenuContext"});function nte(r){return(r==null?void 0:r.ownerDocument)??document}function kDe(r){return nte(r).activeElement===r}function NDe(r={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:E,defaultIsOpen:v,onClose:T,onOpen:w,placement:I="bottom-start",lazyBehavior:N="unmount",direction:F,computePositionOnMount:j=!1,...G}=r,H=L.useRef(null),te=L.useRef(null),K=L.useRef(!0),Q=ADe(),de=L.useCallback(()=>{requestAnimationFrame(()=>{var Ce;(Ce=H.current)==null||Ce.focus({preventScroll:!1})})},[]),se=L.useCallback(()=>{const Ce=setTimeout(()=>{var xe,ze;if(l)(xe=l.current)==null||xe.focus();else if(!Q.count())(ze=H.current)==null||ze.focus({preventScroll:!1});else{const Qe=Q.firstEnabled();Qe&&Me(Qe.index)}});ve.current.add(Ce)},[Q,l]),ge=L.useCallback(()=>{const Ce=setTimeout(()=>{var xe;if(!Q.count())(xe=H.current)==null||xe.focus({preventScroll:!1});else{const ze=Q.lastEnabled();ze&&Me(ze.index)}});ve.current.add(Ce)},[Q]),ee=L.useCallback(()=>{w==null||w(),d?se():de()},[d,se,de,w]),{isOpen:Z,onOpen:ne,onClose:ae,onToggle:me}=ag({isOpen:E,defaultIsOpen:v,onClose:T,onOpen:ee});DJ({enabled:Z&&a,ref:H,handler:Ce=>{var ze,Qe,et;const xe=((Qe=(ze=Ce.composedPath)==null?void 0:ze.call(Ce))==null?void 0:Qe[0])??Ce.target;(et=te.current)!=null&&et.contains(xe)||ae()}});const he=xF({...G,enabled:Z||j,placement:I,direction:F}),[le,Me]=L.useState(-1);OJ(H,{focusRef:te,visible:Z,shouldFocus:!0});const Ge=AJ({isOpen:Z,ref:H}),[tt,Ee]=j_e(t,"menu-button","menu-list"),we=L.useCallback(()=>{ne(),de()},[ne,de]),ve=L.useRef(new Set([]));L.useEffect(()=>{const Ce=ve.current;return()=>{Ce.forEach(xe=>clearTimeout(xe)),Ce.clear()}},[]),cg(()=>{var Ce;Z||(Me(-1),(Ce=H.current)==null||Ce.scrollTo(0,0))},[Z]),cg(()=>{Z&&le===-1&&de()},[le,Z]),L.useEffect(()=>{var xe;if(!Z)return;const Ce=Q.item(le);(xe=Ce==null?void 0:Ce.node)==null||xe.focus({preventScroll:!K.current})},[Q,le,Z]);const Be=L.useCallback(()=>{ne(),se()},[se,ne]),Oe=L.useCallback(()=>{K.current=!0,ne(),ge()},[ne,ge]),be=L.useCallback(()=>{var et,ut;const Ce=nte(H.current),xe=(et=H.current)==null?void 0:et.contains(Ce.activeElement);if(!(Z&&!xe))return;const Qe=(ut=Q.item(le))==null?void 0:ut.node;Qe==null||Qe.focus({preventScroll:!K.current})},[Z,le,Q]);return{openAndFocusMenu:we,openAndFocusFirstItem:Be,openAndFocusLastItem:Oe,onTransitionEnd:be,unstable__animationState:Ge,descendants:Q,popper:he,buttonId:tt,menuId:Ee,forceUpdate:he.forceUpdate,orientation:"vertical",isOpen:Z,onToggle:me,onOpen:ne,onClose:ae,menuRef:H,buttonRef:te,focusedIndex:le,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:f,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:K}}function DDe(r={},t=null){const s=NR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:E}=s,v=L.useCallback(T=>{const w=T.key,N={Enter:d,ArrowDown:d,ArrowUp:f}[w];N&&(E.current=!0,T.preventDefault(),T.stopPropagation(),N(T))},[d,f,E]);return{...r,ref:Hi(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":Yn(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:Zn(r.onClick,a),onKeyDown:Zn(r.onKeyDown,v)}}function EU(r){var t;return UDe(r)&&!!((t=r==null?void 0:r.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function LDe(r={},t=null){const s=NR();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:E,menuId:v,isLazy:T,lazyBehavior:w,scrollIntoViewRef:I,unstable__animationState:N}=s,F=IDe(),j=i1e({preventDefault:K=>K.key!==" "&&EU(K.target)}),G=L.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const Q=K.key,se={Tab:ee=>ee.preventDefault(),Escape:ee=>{ee.stopPropagation(),E()},ArrowDown:()=>{I.current=!0;const ee=F.nextEnabled(a)??F.firstEnabled();ee&&l(ee.index)},ArrowUp:()=>{I.current=!0;const ee=F.prevEnabled(a)??F.firstEnabled();ee&&l(ee.index)}}[Q];if(se){K.preventDefault(),se(K);return}const ge=j(ee=>{const Z=n1e(F.values(),ee,ne=>{var ae;return((ae=ne==null?void 0:ne.node)==null?void 0:ae.textContent)??""},F.item(a));if(Z){const ne=F.indexOf(Z.node);l(ne)}});EU(K.target)&&ge(K)},[F,a,j,E,l,I]),H=L.useRef(!1);f&&(H.current=!0);const te=lV({wasSelected:H.current,enabled:T,mode:w,isSelected:N.present});return{...r,ref:Hi(d,t),children:te?r.children:null,tabIndex:-1,role:"menu",id:v,style:{...r.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Zn(r.onKeyDown,G)}}function xDe(r={}){const{popper:t,isOpen:s}=NR();return t.getPopperProps({...r,style:{visibility:s?"visible":"hidden",...r.style}})}function MDe(r={},t=null){const{onMouseEnter:s,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:E,isFocusable:v,closeOnSelect:T,type:w,...I}=r,N=NR(),{setFocusedIndex:F,focusedIndex:j,closeOnSelect:G,onClose:H,menuId:te,scrollIntoViewRef:K}=N,Q=L.useRef(null),de=`${te}-menuitem-${L.useId()}`,{index:se,register:ge}=PDe({disabled:E&&!v}),ee=L.useCallback(Me=>{s==null||s(Me),!E&&(K.current=!1,F(se))},[F,se,E,s,K]),Z=L.useCallback(Me=>{a==null||a(Me),Q.current&&!kDe(Q.current)&&ee(Me)},[ee,a]),ne=L.useCallback(Me=>{l==null||l(Me),!E&&F(-1)},[F,E,l]),ae=L.useCallback(Me=>{d==null||d(Me),EU(Me.currentTarget)&&(T??G)&&H()},[H,d,G,T]),me=L.useCallback(Me=>{f==null||f(Me),F(se)},[F,f,se]),he=se===j,le=tte({onClick:ae,onFocus:me,onMouseEnter:ee,onMouseMove:Z,onMouseLeave:ne,ref:Hi(ge,Q,t),isDisabled:E,isFocusable:v});return{...I,...le,type:w??le.type,id:de,role:"menuitem",tabIndex:he?0:-1}}function UDe(r){if(!VDe(r))return!1;const t=r.ownerDocument.defaultView??window;return r instanceof t.HTMLElement}function VDe(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}const[FDe,f0]=Vi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),MF=r=>{const{children:t}=r,s=qc("Menu",r),a=ns(r),{direction:l}=h0(),{descendants:d,...f}=NDe({...a,direction:l}),E=L.useMemo(()=>f,[f]),{isOpen:v,onClose:T,forceUpdate:w}=E;return O.jsx(CDe,{value:d,children:O.jsx(ODe,{value:E,children:O.jsx(FDe,{value:s,children:jc(t,{isOpen:v,onClose:T,forceUpdate:w})})})})};MF.displayName="Menu";const jDe=tn((r,t)=>{const s=f0();return O.jsx(Ut.button,{ref:t,...r,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),UF=tn((r,t)=>{const{children:s,as:a,...l}=r,d=DDe(l,t),f=a||jDe;return O.jsx(f,{...d,className:Sn("chakra-menu__menu-button",r.className),children:O.jsx(Ut.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:r.children})})});UF.displayName="MenuButton";const rte=tn((r,t)=>{const s=f0();return O.jsx(Ut.span,{ref:t,...r,__css:s.command,className:"chakra-menu__command"})});rte.displayName="MenuCommand";const ite=r=>{const{className:t,...s}=r,a=f0();return O.jsx(Ut.hr,{"aria-orientation":"horizontal",className:Sn("chakra-menu__divider",t),...s,__css:a.divider})};ite.displayName="MenuDivider";const ste=r=>{const{className:t,children:s,...a}=r,l=f0(),d=L.Children.only(s),f=L.isValidElement(d)?L.cloneElement(d,{focusable:"false","aria-hidden":!0,className:Sn("chakra-menu__icon",d.props.className)}):null,E=Sn("chakra-menu__icon-wrapper",t);return O.jsx(Ut.span,{className:E,...a,__css:l.icon,children:f})};ste.displayName="MenuIcon";const BDe=tn((r,t)=>{const{type:s,...a}=r,l=f0(),d=a.as||s?s??void 0:"button",f=L.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return O.jsx(Ut.button,{ref:t,type:d,...a,__css:f})}),AO=tn((r,t)=>{const{icon:s,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,...E}=r,v=MDe(E,t),w=s||l?O.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return O.jsxs(BDe,{...v,className:Sn("chakra-menu__menuitem",v.className),children:[s&&O.jsx(ste,{fontSize:"0.8em",marginEnd:a,children:s}),w,l&&O.jsx(rte,{marginStart:d,children:l})]})});AO.displayName="MenuItem";const WDe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},zDe=Ut(If.div),VF=tn(function(t,s){var N;const{rootProps:a,motionProps:l,...d}=t,{isOpen:f,onTransitionEnd:E,unstable__animationState:v}=NR(),T=LDe(d,s),w=xDe(a),I=f0();return O.jsx(Ut.div,{...w,__css:{zIndex:t.zIndex??((N=I.list)==null?void 0:N.zIndex)},children:O.jsx(zDe,{variants:WDe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...T,className:Sn("chakra-menu__menu-list",T.className),onUpdate:E,onAnimationComplete:TJ(v.onComplete,T.onAnimationComplete)})})});VF.displayName="MenuList";var GDe=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},Zv=new WeakMap,YP=new WeakMap,XP={},t2=0,ote=function(r){return r&&(r.host||ote(r.parentNode))},HDe=function(r,t){return t.map(function(s){if(r.contains(s))return s;var a=ote(s);return a&&r.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",r,". Doing nothing"),null)}).filter(function(s){return!!s})},$De=function(r,t,s,a){var l=HDe(t,Array.isArray(r)?r:[r]);XP[s]||(XP[s]=new WeakMap);var d=XP[s],f=[],E=new Set,v=new Set(l),T=function(I){!I||E.has(I)||(E.add(I),T(I.parentNode))};l.forEach(T);var w=function(I){!I||v.has(I)||Array.prototype.forEach.call(I.children,function(N){if(E.has(N))w(N);else try{var F=N.getAttribute(a),j=F!==null&&F!=="false",G=(Zv.get(N)||0)+1,H=(d.get(N)||0)+1;Zv.set(N,G),d.set(N,H),f.push(N),G===1&&j&&YP.set(N,!0),H===1&&N.setAttribute(s,"true"),j||N.setAttribute(a,"true")}catch(te){console.error("aria-hidden: cannot operate on ",N,te)}})};return w(t),E.clear(),t2++,function(){f.forEach(function(I){var N=Zv.get(I)-1,F=d.get(I)-1;Zv.set(I,N),d.set(I,F),N||(YP.has(I)||I.removeAttribute(a),YP.delete(I)),F||I.removeAttribute(s)}),t2--,t2||(Zv=new WeakMap,Zv=new WeakMap,YP=new WeakMap,XP={})}},KDe=function(r,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(r)?r:[r]),l=GDe(r);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),$De(a,l,s,"aria-hidden")):function(){return null}},qDe=Object.defineProperty,YDe=(r,t,s)=>t in r?qDe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,XDe=(r,t,s)=>(YDe(r,t+"",s),s);class JDe{constructor(){XDe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const yU=new JDe;function ate(r,t){const[s,a]=L.useState(0);return L.useEffect(()=>{const l=r.current;if(l){if(t){const d=yU.add(l);a(d)}return()=>{yU.remove(l),a(0)}}},[t,r]),s}function QDe(r){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:E,onEsc:v}=r,T=L.useRef(null),w=L.useRef(null),[I,N,F]=eLe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");ZDe(T,t&&f);const j=ate(T,t),G=L.useRef(null),H=L.useCallback(ne=>{G.current=ne.target},[]),te=L.useCallback(ne=>{ne.key==="Escape"&&(ne.stopPropagation(),d&&(s==null||s()),v==null||v())},[d,s,v]),[K,Q]=L.useState(!1),[de,se]=L.useState(!1),ge=L.useCallback((ne={},ae=null)=>({role:"dialog",...ne,ref:Hi(ae,T),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?N:void 0,"aria-describedby":de?F:void 0,onClick:Zn(ne.onClick,me=>me.stopPropagation())}),[F,de,I,N,K]),ee=L.useCallback(ne=>{ne.stopPropagation(),G.current===ne.target&&yU.isTopModal(T.current)&&(l&&(s==null||s()),E==null||E())},[s,l,E]),Z=L.useCallback((ne={},ae=null)=>({...ne,ref:Hi(ae,w),onClick:Zn(ne.onClick,ee),onKeyDown:Zn(ne.onKeyDown,te),onMouseDown:Zn(ne.onMouseDown,H)}),[te,H,ee]);return{isOpen:t,onClose:s,headerId:N,bodyId:F,setBodyMounted:se,setHeaderMounted:Q,dialogRef:T,overlayRef:w,getDialogProps:ge,getDialogContainerProps:Z,index:j}}function ZDe(r,t){const s=r.current;L.useEffect(()=>{if(!(!r.current||!t))return KDe(r.current)},[t,r,s])}function eLe(r,...t){const s=L.useId(),a=r||s;return L.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[tLe,m0]=Vi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[nLe,yE]=Vi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Yc=r=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...r,lockFocusAcrossFrames:r.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:T,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:N,lockFocusAcrossFrames:F,animatePresenceProps:j,onCloseComplete:G}=t,H=qc("Modal",t),K={...QDe(t),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:T,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:N,lockFocusAcrossFrames:F};return O.jsx(nLe,{value:K,children:O.jsx(tLe,{value:H,children:O.jsx(l0,{...j,onExitComplete:G,children:K.isOpen&&O.jsx(bu,{...s,children:a})})})})};Yc.displayName="Modal";var PO="right-scroll-bar-position",OO="width-before-scroll-bar",rLe="with-scroll-bars-hidden",iLe="--removed-body-scroll-bar-size",cte=fee(),n2=function(){},Zk=L.forwardRef(function(r,t){var s=L.useRef(null),a=L.useState({onScrollCapture:n2,onWheelCapture:n2,onTouchMoveCapture:n2}),l=a[0],d=a[1],f=r.forwardProps,E=r.children,v=r.className,T=r.removeScrollBar,w=r.enabled,I=r.shards,N=r.sideCar,F=r.noIsolation,j=r.inert,G=r.allowPinchZoom,H=r.as,te=H===void 0?"div":H,K=r.gapMode,Q=AR(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),de=N,se=dee([s,t]),ge=Oh(Oh({},Q),l);return L.createElement(L.Fragment,null,w&&L.createElement(de,{sideCar:cte,removeScrollBar:T,shards:I,noIsolation:F,inert:j,setCallbacks:d,allowPinchZoom:!!G,lockRef:s,gapMode:K}),f?L.cloneElement(L.Children.only(E),Oh(Oh({},ge),{ref:se})):L.createElement(te,Oh({},ge,{className:v,ref:se}),E))});Zk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Zk.classNames={fullWidth:OO,zeroRight:PO};var sLe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function oLe(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=sLe();return t&&r.setAttribute("nonce",t),r}function aLe(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function cLe(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var lLe=function(){var r=0,t=null;return{add:function(s){r==0&&(t=oLe())&&(aLe(t,s),cLe(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},uLe=function(){var r=lLe();return function(t,s){L.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&s])}},lte=function(){var r=uLe(),t=function(s){var a=s.styles,l=s.dynamic;return r(a,l),null};return t},dLe={left:0,top:0,right:0,gap:0},r2=function(r){return parseInt(r||"",10)||0},hLe=function(r){var t=window.getComputedStyle(document.body),s=t[r==="padding"?"paddingLeft":"marginLeft"],a=t[r==="padding"?"paddingTop":"marginTop"],l=t[r==="padding"?"paddingRight":"marginRight"];return[r2(s),r2(a),r2(l)]},pLe=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return dLe;var t=hLe(r),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},fLe=lte(),NS="data-scroll-locked",mLe=function(r,t,s,a){var l=r.left,d=r.top,f=r.right,E=r.gap;return s===void 0&&(s="margin"),`
  .`.concat(rLe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(NS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(PO,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(OO,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(PO," .").concat(PO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(OO," .").concat(OO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(NS,`] {
    `).concat(iLe,": ").concat(E,`px;
  }
`)},Fq=function(){var r=parseInt(document.body.getAttribute(NS)||"0",10);return isFinite(r)?r:0},gLe=function(){L.useEffect(function(){return document.body.setAttribute(NS,(Fq()+1).toString()),function(){var r=Fq()-1;r<=0?document.body.removeAttribute(NS):document.body.setAttribute(NS,r.toString())}},[])},_Le=function(r){var t=r.noRelative,s=r.noImportant,a=r.gapMode,l=a===void 0?"margin":a;gLe();var d=L.useMemo(function(){return pLe(l)},[l]);return L.createElement(fLe,{styles:mLe(d,!t,l,s?"":"!important")})},vU=!1;if(typeof window<"u")try{var JP=Object.defineProperty({},"passive",{get:function(){return vU=!0,!0}});window.addEventListener("test",JP,JP),window.removeEventListener("test",JP,JP)}catch{vU=!1}var eS=vU?{passive:!1}:!1,ELe=function(r){return r.tagName==="TEXTAREA"},ute=function(r,t){if(!(r instanceof Element))return!1;var s=window.getComputedStyle(r);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!ELe(r)&&s[t]==="visible")},yLe=function(r){return ute(r,"overflowY")},vLe=function(r){return ute(r,"overflowX")},jq=function(r,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=dte(r,a);if(l){var d=hte(r,a),f=d[1],E=d[2];if(f>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},SLe=function(r){var t=r.scrollTop,s=r.scrollHeight,a=r.clientHeight;return[t,s,a]},TLe=function(r){var t=r.scrollLeft,s=r.scrollWidth,a=r.clientWidth;return[t,s,a]},dte=function(r,t){return r==="v"?yLe(t):vLe(t)},hte=function(r,t){return r==="v"?SLe(t):TLe(t)},bLe=function(r,t){return r==="h"&&t==="rtl"?-1:1},wLe=function(r,t,s,a,l){var d=bLe(r,window.getComputedStyle(t).direction),f=d*a,E=s.target,v=t.contains(E),T=!1,w=f>0,I=0,N=0;do{var F=hte(r,E),j=F[0],G=F[1],H=F[2],te=G-H-d*j;(j||te)&&dte(r,E)&&(I+=te,N+=j),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!v&&E!==document.body||v&&(t.contains(E)||t===E));return(w&&Math.abs(I)<1||!w&&Math.abs(N)<1)&&(T=!0),T},QP=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},Bq=function(r){return[r.deltaX,r.deltaY]},Wq=function(r){return r&&"current"in r?r.current:r},RLe=function(r,t){return r[0]===t[0]&&r[1]===t[1]},CLe=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},ILe=0,tS=[];function ALe(r){var t=L.useRef([]),s=L.useRef([0,0]),a=L.useRef(),l=L.useState(ILe++)[0],d=L.useState(lte)[0],f=L.useRef(r);L.useEffect(function(){f.current=r},[r]),L.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(l));var G=xke([r.lockRef.current],(r.shards||[]).map(Wq),!0).filter(Boolean);return G.forEach(function(H){return H.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),G.forEach(function(H){return H.classList.remove("allow-interactivity-".concat(l))})}}},[r.inert,r.lockRef.current,r.shards]);var E=L.useCallback(function(G,H){if("touches"in G&&G.touches.length===2||G.type==="wheel"&&G.ctrlKey)return!f.current.allowPinchZoom;var te=QP(G),K=s.current,Q="deltaX"in G?G.deltaX:K[0]-te[0],de="deltaY"in G?G.deltaY:K[1]-te[1],se,ge=G.target,ee=Math.abs(Q)>Math.abs(de)?"h":"v";if("touches"in G&&ee==="h"&&ge.type==="range")return!1;var Z=jq(ee,ge);if(!Z)return!0;if(Z?se=ee:(se=ee==="v"?"h":"v",Z=jq(ee,ge)),!Z)return!1;if(!a.current&&"changedTouches"in G&&(Q||de)&&(a.current=se),!se)return!0;var ne=a.current||se;return wLe(ne,H,G,ne==="h"?Q:de)},[]),v=L.useCallback(function(G){var H=G;if(!(!tS.length||tS[tS.length-1]!==d)){var te="deltaY"in H?Bq(H):QP(H),K=t.current.filter(function(se){return se.name===H.type&&(se.target===H.target||H.target===se.shadowParent)&&RLe(se.delta,te)})[0];if(K&&K.should){H.cancelable&&H.preventDefault();return}if(!K){var Q=(f.current.shards||[]).map(Wq).filter(Boolean).filter(function(se){return se.contains(H.target)}),de=Q.length>0?E(H,Q[0]):!f.current.noIsolation;de&&H.cancelable&&H.preventDefault()}}},[]),T=L.useCallback(function(G,H,te,K){var Q={name:G,delta:H,target:te,should:K,shadowParent:PLe(te)};t.current.push(Q),setTimeout(function(){t.current=t.current.filter(function(de){return de!==Q})},1)},[]),w=L.useCallback(function(G){s.current=QP(G),a.current=void 0},[]),I=L.useCallback(function(G){T(G.type,Bq(G),G.target,E(G,r.lockRef.current))},[]),N=L.useCallback(function(G){T(G.type,QP(G),G.target,E(G,r.lockRef.current))},[]);L.useEffect(function(){return tS.push(d),r.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:N}),document.addEventListener("wheel",v,eS),document.addEventListener("touchmove",v,eS),document.addEventListener("touchstart",w,eS),function(){tS=tS.filter(function(G){return G!==d}),document.removeEventListener("wheel",v,eS),document.removeEventListener("touchmove",v,eS),document.removeEventListener("touchstart",w,eS)}},[]);var F=r.removeScrollBar,j=r.inert;return L.createElement(L.Fragment,null,j?L.createElement(d,{styles:CLe(l)}):null,F?L.createElement(_Le,{gapMode:r.gapMode}):null)}function PLe(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const OLe=Mke(cte,ALe);var pte=L.forwardRef(function(r,t){return L.createElement(Zk,Oh({},r,{ref:t,sideCar:OLe}))});pte.classNames=Zk.classNames;function kLe(r){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:E,returnFocusOnClose:v,preserveScrollBarGap:T,lockFocusAcrossFrames:w,isOpen:I}=yE(),[N,F]=NV();L.useEffect(()=>{!N&&F&&setTimeout(F)},[N,F]);const j=ate(a,I);return O.jsx(Bee,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:E,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:O.jsx(pte,{removeScrollBar:!T,allowPinchZoom:f,enabled:j===1&&d,forwardProps:!0,children:r.children})})}const NLe={initial:({offsetX:r,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:r,y:t,transition:(s==null?void 0:s.exit)??lE.exit(cE.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:r,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(r==null?void 0:r.enter)??lE.enter(cE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:r,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const f={x:t,y:r};return{opacity:0,transition:(s==null?void 0:s.exit)??lE.exit(cE.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},fw={initial:"initial",animate:"enter",exit:"exit",variants:NLe},DLe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:E=0,offsetY:v=8,transition:T,transitionEnd:w,delay:I,animatePresenceProps:N,...F}=t,j=a?l&&a:!0,G=l||a?"enter":"exit",H={offsetX:E,offsetY:v,reverse:d,transition:T,transitionEnd:w,delay:I};return O.jsx(l0,{...N,custom:H,children:j&&O.jsx(If.div,{ref:s,className:Sn("chakra-offset-slide",f),custom:H,...fw,animate:G,...F})})});DLe.displayName="SlideFade";const LLe={exit:({reverse:r,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...r?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??lE.exit(cE.exit,l)}),enter:({transitionEnd:r,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??lE.enter(cE.enter,s),transitionEnd:r==null?void 0:r.enter})},fte={initial:"exit",animate:"enter",exit:"exit",variants:LLe},xLe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:E,transition:v,transitionEnd:T,delay:w,animatePresenceProps:I,...N}=t,F=a?l&&a:!0,j=l||a?"enter":"exit",G={initialScale:f,reverse:d,transition:v,transitionEnd:T,delay:w};return O.jsx(l0,{...I,custom:G,children:F&&O.jsx(If.div,{ref:s,className:Sn("chakra-offset-slide",E),...fte,animate:j,custom:G,...N})})});xLe.displayName="ScaleFade";const MLe={slideInBottom:{...fw,custom:{offsetY:16,reverse:!0}},slideInRight:{...fw,custom:{offsetX:16,reverse:!0}},slideInTop:{...fw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...fw,custom:{offsetX:-16,reverse:!0}},scale:{...fte,custom:{initialScale:.95,reverse:!0}},none:{}},ULe=Ut(If.section),VLe=r=>MLe[r||"none"],mte=L.forwardRef((r,t)=>{const{preset:s,motionProps:a=VLe(s),...l}=r;return O.jsx(ULe,{ref:t,...a,...l})});mte.displayName="ModalTransition";const Xc=tn((r,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...f}=r,{getDialogProps:E,getDialogContainerProps:v}=yE(),T=E(f,t),w=v(l),I=Sn("chakra-modal__content",s),N=m0(),F={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},j={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:G}=yE();return O.jsx(kLe,{children:O.jsx(Ut.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:j,children:O.jsx(mte,{preset:G,motionProps:d,className:I,...T,__css:F,children:a})})})});Xc.displayName="ModalContent";const Hc=tn((r,t)=>{const{className:s,...a}=r,{bodyId:l,setBodyMounted:d}=yE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=Sn("chakra-modal__body",s),E=m0();return O.jsx(Ut.div,{ref:t,className:f,id:l,...a,__css:E.body})});Hc.displayName="ModalBody";const Ol=tn((r,t)=>{const{onClick:s,className:a,...l}=r,{onClose:d}=yE(),f=Sn("chakra-modal__close-btn",a),E=m0();return O.jsx(hF,{ref:t,__css:E.closeButton,className:f,onClick:Zn(s,v=>{v.stopPropagation(),d()}),...l})});Ol.displayName="ModalCloseButton";const QS=tn((r,t)=>{const{className:s,...a}=r,l=Sn("chakra-modal__footer",s),d=m0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return O.jsx(Ut.footer,{ref:t,...a,__css:f,className:l})});QS.displayName="ModalFooter";const Td=tn((r,t)=>{const{className:s,...a}=r,{headerId:l,setHeaderMounted:d}=yE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=Sn("chakra-modal__header",s),E=m0(),v={flex:0,...E.header};return O.jsx(Ut.header,{ref:t,className:f,id:l,...a,__css:v})});Td.displayName="ModalHeader";const FLe={enter:({transition:r,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(r==null?void 0:r.enter)??lE.enter(cE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:r,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(r==null?void 0:r.exit)??lE.exit(cE.exit,s),transitionEnd:t==null?void 0:t.exit})},gte={initial:"exit",animate:"enter",exit:"exit",variants:FLe},jLe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:E,delay:v,animatePresenceProps:T,...w}=t,I=l||a?"enter":"exit",N=a?l&&a:!0,F={transition:f,transitionEnd:E,delay:v};return O.jsx(l0,{...T,custom:F,children:N&&O.jsx(If.div,{ref:s,className:Sn("chakra-fade",d),custom:F,...gte,animate:I,...w})})});jLe.displayName="Fade";const BLe=Ut(If.div),$c=tn((r,t)=>{const{className:s,transition:a,motionProps:l,...d}=r,f=Sn("chakra-modal__overlay",s),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...m0().overlay},{motionPreset:T}=yE(),I=l||(T==="none"?{}:gte);return O.jsx(BLe,{...I,__css:v,ref:t,className:f,...d})});$c.displayName="ModalOverlay";function WLe(r){const{leastDestructiveRef:t,...s}=r;return O.jsx(Yc,{...s,initialFocusRef:t})}const zLe=tn((r,t)=>O.jsx(Xc,{ref:t,role:"alertdialog",...r})),[GLe,eN]=Vi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[HLe,_te]=Vi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),nS={click:"click",hover:"hover"};function $Le(r={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:E,arrowShadowColor:v,trigger:T=nS.click,openDelay:w=200,closeDelay:I=200,isLazy:N,lazyBehavior:F="unmount",computePositionOnMount:j,...G}=r,{isOpen:H,onClose:te,onOpen:K,onToggle:Q}=ag(r),[de,se]=L.useState(d);L.useEffect(()=>se(d),[d]);const ge=L.useRef(null),ee=L.useRef(null),Z=L.useRef(null),ne=L.useRef(!1),ae=L.useRef(!1);H&&(ae.current=!0);const[me,he]=L.useState(!1),[le,Me]=L.useState(!1),Ge=L.useId(),tt=l??Ge,[Ee,we,ve,Be]=["popover-trigger","popover-content","popover-header","popover-body"].map(Dt=>`${Dt}-${tt}`),{referenceRef:Oe,getArrowProps:be,getPopperProps:Ce,getArrowInnerProps:xe,forceUpdate:ze}=xF({...G,enabled:H||!!j}),Qe=AJ({isOpen:H,ref:Z});V_e({enabled:H,ref:ee}),OJ(Z,{focusRef:ee,visible:H,shouldFocus:de&&T===nS.click}),O_e(Z,{focusRef:a,visible:H,shouldFocus:f&&T===nS.click}),DJ({enabled:H&&t,ref:Z,handler(Dt){var Ue;const Te=((Ue=Dt.composedPath)==null?void 0:Ue.call(Dt)[0])??[Dt.target];ZP(ee.current,Te)||(Te&&se(!$O(Te)),te())}});const et=lV({wasSelected:ae.current,enabled:N,mode:F,isSelected:Qe.present}),ut=L.useCallback((Dt={},Te=null)=>{const Ue={...Dt,style:{...Dt.style,transformOrigin:Ws.transformOrigin.varRef,[Ws.arrowSize.var]:E?`${E}px`:void 0,[Ws.arrowShadowColor.var]:v},ref:Hi(Z,Te),children:et?Dt.children:null,id:we,tabIndex:-1,role:"dialog",onKeyDown:Zn(Dt.onKeyDown,$e=>{$e.nativeEvent.isComposing||s&&$e.key==="Escape"&&($e.preventDefault(),$e.stopPropagation(),te())}),onBlur:Zn(Dt.onBlur,$e=>{const mt=zq($e),Et=ZP(Z.current,mt),yt=ZP(ee.current,mt),zt=!Et&&!yt;mt&&se(!$O(mt)),H&&t&&zt&&te()}),"aria-labelledby":me?ve:void 0,"aria-describedby":le?Be:void 0};return T===nS.hover&&(Ue.role="tooltip",Ue.onMouseEnter=Zn(Dt.onMouseEnter,()=>{ne.current=!0}),Ue.onMouseLeave=Zn(Dt.onMouseLeave,$e=>{$e.nativeEvent.relatedTarget!==null&&(ne.current=!1,setTimeout(()=>te(),I))})),Ue},[et,we,me,ve,le,Be,T,s,te,H,t,I,v,E]),it=L.useCallback((Dt={},Te=null)=>Ce({...Dt,style:{visibility:H?"visible":"hidden",...Dt.style}},Te),[H,Ce]),Ct=L.useCallback((Dt,Te=null)=>({...Dt,ref:Hi(Te,ge,Oe)}),[ge,Oe]),_n=L.useRef(void 0),Vt=L.useRef(void 0),ln=L.useCallback(Dt=>{ge.current==null&&Oe(Dt)},[Oe]),xn=L.useCallback((Dt={},Te=null)=>{const Ue={...Dt,ref:Hi(ee,Te,ln),id:Ee,"aria-haspopup":"dialog","aria-expanded":H,"aria-controls":we};return T===nS.click&&(Ue.onClick=Zn(Dt.onClick,Q)),T===nS.hover&&(Ue.onFocus=Zn(Dt.onFocus,()=>{_n.current===void 0&&K()}),Ue.onBlur=Zn(Dt.onBlur,$e=>{const mt=zq($e),Et=!ZP(Z.current,mt);H&&t&&Et&&te()}),Ue.onKeyDown=Zn(Dt.onKeyDown,$e=>{$e.key==="Escape"&&te()}),Ue.onMouseEnter=Zn(Dt.onMouseEnter,()=>{ne.current=!0,_n.current=window.setTimeout(()=>K(),w)}),Ue.onMouseLeave=Zn(Dt.onMouseLeave,()=>{ne.current=!1,_n.current&&(clearTimeout(_n.current),_n.current=void 0),Vt.current=window.setTimeout(()=>{ne.current===!1&&te()},I)})),Ue},[Ee,H,we,T,ln,Q,K,t,te,w,I]);L.useEffect(()=>()=>{_n.current&&clearTimeout(_n.current),Vt.current&&clearTimeout(Vt.current)},[]);const Xt=L.useCallback((Dt={},Te=null)=>({...Dt,id:ve,ref:Hi(Te,Ue=>{he(!!Ue)})}),[ve]),Pt=L.useCallback((Dt={},Te=null)=>({...Dt,id:Be,ref:Hi(Te,Ue=>{Me(!!Ue)})}),[Be]);return{forceUpdate:ze,isOpen:H,onAnimationComplete:Qe.onComplete,onClose:te,getAnchorProps:Ct,getArrowProps:be,getArrowInnerProps:xe,getPopoverPositionerProps:it,getPopoverProps:ut,getTriggerProps:xn,getHeaderProps:Xt,getBodyProps:Pt}}function ZP(r,t){return r===t||(r==null?void 0:r.contains(t))}function zq(r){const t=r.currentTarget.ownerDocument.activeElement;return r.relatedTarget??t}function Ete(r){const t=qc("Popover",r),{children:s,...a}=ns(r),l=h0(),d=$Le({...a,direction:l.direction});return O.jsx(GLe,{value:d,children:O.jsx(HLe,{value:t,children:jc(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Ete.displayName="Popover";function yte(r){var s;const t=L.version;return typeof t!="string"||t.startsWith("18.")?r==null?void 0:r.ref:(s=r==null?void 0:r.props)==null?void 0:s.ref}const vte=tn(function(t,s){const{getBodyProps:a}=eN(),l=_te();return O.jsx(Ut.div,{...a(t,s),className:Sn("chakra-popover__body",t.className),__css:l.body})});vte.displayName="PopoverBody";function KLe(r){if(r)return{enter:{...r.enter,visibility:"visible"},exit:{...r.exit,transitionEnd:{visibility:"hidden"}}}}const qLe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},YLe=Ut(If.section),Ste=tn(function(t,s){const{variants:a=qLe,...l}=t,{isOpen:d}=eN();return O.jsx(YLe,{ref:s,variants:KLe(a),initial:!1,animate:d?"enter":"exit",...l})});Ste.displayName="PopoverTransition";const Tte=tn(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:f,getPopoverPositionerProps:E,onAnimationComplete:v}=eN(),T=_te(),w={position:"relative",display:"flex",flexDirection:"column",...T.content};return O.jsx(Ut.div,{...E(a),__css:T.popper,className:"chakra-popover__popper",children:O.jsx(Ste,{...l,...f(d,s),onAnimationComplete:TJ(v,d.onAnimationComplete),className:Sn("chakra-popover__content",t.className),__css:w})})});Tte.displayName="PopoverContent";function bte(r){const t=L.Children.only(r.children),{getTriggerProps:s}=eN();return O.jsx(O.Fragment,{children:L.cloneElement(t,s(t.props,yte(t)))})}bte.displayName="PopoverTrigger";function XLe(r,t,s){return(r-t)*100/(s-t)}SR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});SR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const JLe=SR({"0%":{left:"-40%"},"100%":{left:"100%"}}),QLe=SR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function ZLe(r){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:E="progressbar"}=r,v=XLe(t,s,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":f?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:E},percent:v,value:t}}const[exe,txe]=Vi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),nxe=tn((r,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:f,...E}=r,v=ZLe({value:l,min:s,max:a,isIndeterminate:d,role:f}),w={height:"100%",...txe().filledTrack};return O.jsx(Ut.div,{ref:t,style:{width:`${v.percent}%`,...E.style},...v.bind,...E,__css:w})}),ZS=tn((r,t)=>{var ee;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:E,borderRadius:v,isIndeterminate:T,"aria-label":w,"aria-labelledby":I,"aria-valuetext":N,title:F,role:j,...G}=ns(r),H=qc("Progress",r),te=v??((ee=H.track)==null?void 0:ee.borderRadius),K={animation:`${QLe} 1s linear infinite`},se={...!T&&d&&f&&K,...T&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${JLe} 1s ease infinite normal none running`}},ge={overflow:"hidden",position:"relative",...H.track};return O.jsx(Ut.div,{ref:t,borderRadius:te,__css:ge,...G,children:O.jsxs(exe,{value:H,children:[O.jsx(nxe,{"aria-label":w,"aria-labelledby":I,"aria-valuetext":N,min:a,max:l,value:s,isIndeterminate:T,css:se,borderRadius:te,title:F,role:j}),E]})})});ZS.displayName="Progress";const wte=tn(function(t,s){const{children:a,placeholder:l,className:d,...f}=t;return O.jsxs(Ut.select,{...f,ref:s,className:Sn("chakra-select",d),children:[l&&O.jsx("option",{value:"",children:l}),a]})});wte.displayName="SelectField";const Rte=tn((r,t)=>{var Q;const s=qc("Select",r),{rootProps:a,placeholder:l,icon:d,color:f,height:E,h:v,minH:T,minHeight:w,iconColor:I,iconSize:N,...F}=ns(r),[j,G]=w_e(F,VEe),H=cee(G),te={width:"100%",height:"fit-content",position:"relative",color:f},K={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(Q=s.field)==null?void 0:Q._focus}};return O.jsxs(Ut.div,{className:"chakra-select__wrapper",__css:te,...j,...a,children:[O.jsx(wte,{ref:t,height:v??E,minH:T??w,placeholder:l,...H,__css:K,children:r.children}),O.jsx(Cte,{"data-disabled":Yn(H.disabled),...(I||f)&&{color:I||f},__css:s.icon,...N&&{fontSize:N},children:d})]})});Rte.displayName="Select";const rxe=r=>O.jsx("svg",{viewBox:"0 0 24 24",...r,children:O.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),ixe=Ut("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Cte=r=>{const{children:t=O.jsx(rxe,{}),...s}=r,a=L.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return O.jsx(ixe,{...s,className:"chakra-select__icon-wrapper",children:L.isValidElement(t)?a:null})};Cte.displayName="SelectIcon";function i2(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function sxe(r){const{orientation:t,thumbPercents:s,isReversed:a}=r,l=F=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...i2({orientation:t,vertical:{bottom:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...i2({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=s.length===1,v=[0,a?100-s[0]:s[0]],T=E?v:s;let w=T[0];!E&&a&&(w=100-w);const I=Math.abs(T[T.length-1]-T[0]),N={...f,...i2({orientation:t,vertical:a?{height:`${I}%`,top:`${w}%`}:{height:`${I}%`,bottom:`${w}%`},horizontal:a?{width:`${I}%`,right:`${w}%`}:{width:`${I}%`,left:`${w}%`}})};return{trackStyle:f,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function oxe(r){const{isReversed:t,direction:s,orientation:a}=r;return s==="ltr"||a==="vertical"?t:!t}function axe(r){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:E="ltr",orientation:v="horizontal",id:T,isDisabled:w,isReadOnly:I,onChangeStart:N,onChangeEnd:F,step:j=1,getAriaValueText:G,"aria-valuetext":H,"aria-label":te,"aria-labelledby":K,name:Q,focusThumbOnChange:de=!0,...se}=r,ge=Bc(N),ee=Bc(F),Z=Bc(G),ne=oxe({isReversed:f,direction:E,orientation:v}),[ae,me]=PJ({value:l,defaultValue:d??lxe(t,s),onChange:a}),[he,le]=L.useState(!1),[Me,Ge]=L.useState(!1),tt=!(w||I),Ee=(s-t)/10,we=j||(s-t)/100,ve=aM(ae,t,s),Be=s-ve+t,be=t$(ne?Be:ve,t,s),Ce=v==="vertical",xe=NJ({min:t,max:s,step:j,isDisabled:w,value:ve,isInteractive:tt,isReversed:ne,isVertical:Ce,eventSource:null,focusThumbOnChange:de,orientation:v}),ze=L.useRef(null),Qe=L.useRef(null),et=L.useRef(null),ut=L.useId(),it=T??ut,[Ct,_n]=[`slider-thumb-${it}`,`slider-track-${it}`],Vt=L.useCallback(jt=>{var oo;if(!ze.current)return;const an=xe.current;an.eventSource="pointer";const qi=ze.current.getBoundingClientRect(),{clientX:Ns,clientY:Gs}=((oo=jt.touches)==null?void 0:oo[0])??jt,ui=Ce?qi.bottom-Gs:Ns-qi.left,Na=Ce?qi.height:qi.width;let Jc=ui/Na;ne&&(Jc=1-Jc);let so=v_e(Jc,an.min,an.max);return an.step&&(so=parseFloat(n$(so,an.min,an.step))),so=aM(so,an.min,an.max),so},[Ce,ne,xe]),ln=L.useCallback(jt=>{const an=xe.current;an.isInteractive&&(jt=parseFloat(n$(jt,an.min,we)),jt=aM(jt,an.min,an.max),me(jt))},[we,me,xe]),xn=L.useMemo(()=>({stepUp(jt=we){const an=ne?ve-jt:ve+jt;ln(an)},stepDown(jt=we){const an=ne?ve+jt:ve-jt;ln(an)},reset(){ln(d||0)},stepTo(jt){ln(jt)}}),[ln,ne,ve,we,d]),Xt=L.useCallback(jt=>{const an=xe.current,Ns={ArrowRight:()=>xn.stepUp(),ArrowUp:()=>xn.stepUp(),ArrowLeft:()=>xn.stepDown(),ArrowDown:()=>xn.stepDown(),PageUp:()=>xn.stepUp(Ee),PageDown:()=>xn.stepDown(Ee),Home:()=>ln(an.min),End:()=>ln(an.max)}[jt.key];Ns&&(jt.preventDefault(),jt.stopPropagation(),Ns(jt),an.eventSource="keyboard")},[xn,ln,Ee,xe]),Pt=(Z==null?void 0:Z(ve))??H,{getThumbStyle:Dt,rootStyle:Te,trackStyle:Ue,innerTrackStyle:$e}=L.useMemo(()=>{const jt=xe.current;return sxe({isReversed:ne,orientation:jt.orientation,thumbPercents:[be]})},[ne,be,xe]),mt=L.useCallback(()=>{xe.current.focusThumbOnChange&&setTimeout(()=>{var an;return(an=Qe.current)==null?void 0:an.focus()})},[xe]);cg(()=>{const jt=xe.current;mt(),jt.eventSource==="keyboard"&&(ee==null||ee(jt.value))},[ve,ee]);function Et(jt){const an=Vt(jt);an!=null&&an!==xe.current.value&&me(an)}iEe(et,{onPanSessionStart(jt){const an=xe.current;an.isInteractive&&(le(!0),mt(),Et(jt),ge==null||ge(an.value))},onPanSessionEnd(){const jt=xe.current;jt.isInteractive&&(le(!1),ee==null||ee(jt.value))},onPan(jt){xe.current.isInteractive&&Et(jt)}});const yt=L.useCallback((jt={},an=null)=>({...jt,...se,ref:Hi(an,et),tabIndex:-1,"aria-disabled":SS(w),"data-focused":Yn(Me),style:{...jt.style,...Te}}),[se,w,Me,Te]),zt=L.useCallback((jt={},an=null)=>({...jt,ref:Hi(an,ze),id:_n,"data-disabled":Yn(w),style:{...jt.style,...Ue}}),[w,_n,Ue]),dn=L.useCallback((jt={},an=null)=>({...jt,ref:an,style:{...jt.style,...$e}}),[$e]),hn=L.useCallback((jt={},an=null)=>({...jt,ref:Hi(an,Qe),role:"slider",tabIndex:tt?0:void 0,id:Ct,"data-active":Yn(he),"aria-valuetext":Pt,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":ve,"aria-orientation":v,"aria-disabled":SS(w),"aria-readonly":SS(I),"aria-label":te,"aria-labelledby":te?void 0:K,style:{...jt.style,...Dt(0)},onKeyDown:Zn(jt.onKeyDown,Xt),onFocus:Zn(jt.onFocus,()=>Ge(!0)),onBlur:Zn(jt.onBlur,()=>Ge(!1))}),[tt,Ct,he,Pt,t,s,ve,v,w,I,te,K,Dt,Xt]),Yt=L.useCallback((jt,an=null)=>{const qi=!(jt.value<t||jt.value>s),Ns=ve>=jt.value,Gs=t$(jt.value,t,s),ui={position:"absolute",pointerEvents:"none",...cxe({orientation:v,vertical:{bottom:ne?`${100-Gs}%`:`${Gs}%`},horizontal:{left:ne?`${100-Gs}%`:`${Gs}%`}})};return{...jt,ref:an,role:"presentation","aria-hidden":!0,"data-disabled":Yn(w),"data-invalid":Yn(!qi),"data-highlighted":Yn(Ns),style:{...jt.style,...ui}}},[w,ne,s,t,v,ve]),Bn=L.useCallback((jt={},an=null)=>({...jt,ref:an,type:"hidden",value:ve,name:Q}),[Q,ve]);return{state:{value:ve,isFocused:Me,isDragging:he},actions:xn,getRootProps:yt,getTrackProps:zt,getInnerTrackProps:dn,getThumbProps:hn,getMarkerProps:Yt,getInputProps:Bn}}function cxe(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function lxe(r,t){return t<r?r:r+(t-r)/2}const[uxe,tN]=Vi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[dxe,nN]=Vi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),SU=tn((r,t)=>{const s={...r,orientation:(r==null?void 0:r.orientation)??"horizontal"},a=qc("Slider",s),l=ns(s),{direction:d}=h0();l.direction=d;const{getInputProps:f,getRootProps:E,...v}=axe(l),T=E(),w=f({},t);return O.jsx(uxe,{value:v,children:O.jsx(dxe,{value:a,children:O.jsxs(Ut.div,{...T,className:Sn("chakra-slider",s.className),__css:a.container,children:[s.children,O.jsx("input",{...w})]})})})});SU.displayName="Slider";const TU=tn((r,t)=>{const{getThumbProps:s}=tN(),a=nN(),l=s(r,t);return O.jsx(Ut.div,{...l,className:Sn("chakra-slider__thumb",r.className),__css:a.thumb})});TU.displayName="SliderThumb";const bU=tn((r,t)=>{const{getTrackProps:s}=tN(),a=nN(),l=s(r,t);return O.jsx(Ut.div,{...l,className:Sn("chakra-slider__track",r.className),__css:a.track})});bU.displayName="SliderTrack";const wU=tn((r,t)=>{const{getInnerTrackProps:s}=tN(),a=nN(),l=s(r,t);return O.jsx(Ut.div,{...l,className:Sn("chakra-slider__filled-track",r.className),__css:a.filledTrack})});wU.displayName="SliderFilledTrack";const hxe=tn((r,t)=>{const{getMarkerProps:s}=tN(),a=nN(),l=s(r,t);return O.jsx(Ut.div,{...l,className:Sn("chakra-slider__marker",r.className),__css:a.mark})});hxe.displayName="SliderMark";const lk=Ut("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});lk.displayName="Spacer";const Ite=r=>O.jsx(Ut.div,{className:"chakra-stack__item",...r,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...r.__css}});Ite.displayName="StackItem";function pxe(r){const{spacing:t,direction:s}=r,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":uV(s,l=>a[l])}}const FF=tn((r,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:E,children:v,divider:T,className:w,shouldWrapChildren:I,...N}=r,F=s?"row":a??"column",j=L.useMemo(()=>pxe({spacing:f,direction:F}),[f,F]),G=!!T,H=!I&&!G,te=L.useMemo(()=>{const Q=cV(v);return H?Q:Q.map((de,se)=>{const ge=typeof de.key<"u"?de.key:se,ee=se+1===Q.length,ne=I?O.jsx(Ite,{children:de},ge):de;if(!G)return ne;const ae=L.cloneElement(T,{__css:j}),me=ee?null:ae;return O.jsxs(L.Fragment,{children:[ne,me]},ge)})},[T,j,G,H,I,v]),K=Sn("chakra-stack",w);return O.jsx(Ut.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:F,flexWrap:E,gap:G?void 0:f,className:K,...N,children:te})});FF.displayName="Stack";const wi=tn((r,t)=>O.jsx(FF,{align:"center",...r,direction:"row",ref:t}));wi.displayName="HStack";const $i=tn((r,t)=>O.jsx(FF,{align:"center",...r,direction:"column",ref:t}));$i.displayName="VStack";const Zm=tn(function(t,s){const a=qc("Switch",t),{spacing:l="0.5rem",children:d,...f}=ns(t),{getIndicatorProps:E,getInputProps:v,getCheckboxProps:T,getRootProps:w,getLabelProps:I}=bke(f),N=L.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),F=L.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),j=L.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return O.jsxs(Ut.label,{...w(),className:Sn("chakra-switch",t.className),__css:N,children:[O.jsx("input",{className:"chakra-switch__input",...v({},s)}),O.jsx(Ut.span,{...T(),className:"chakra-switch__track",__css:F,children:O.jsx(Ut.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&O.jsx(Ut.span,{className:"chakra-switch__label",...I(),__css:j,children:d})]})});Zm.displayName="Switch";const[fxe,mxe,gxe,_xe]=tee();function Exe(r){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:E="horizontal",direction:v="ltr",...T}=r,[w,I]=L.useState(t??0),[N,F]=PJ({defaultValue:t??0,value:a,onChange:s});L.useEffect(()=>{a!=null&&I(a)},[a]);const j=gxe(),G=L.useId();return{id:`tabs-${r.id??G}`,selectedIndex:N,focusedIndex:w,setSelectedIndex:F,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:f,orientation:E,descendants:j,direction:v,htmlProps:T}}const[yxe,rN]=Vi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function vxe(r){const{focusedIndex:t,orientation:s,direction:a}=rN(),l=mxe(),d=L.useCallback(f=>{const E=()=>{var Q;const K=l.nextEnabled(t);K&&((Q=K.node)==null||Q.focus())},v=()=>{var Q;const K=l.prevEnabled(t);K&&((Q=K.node)==null||Q.focus())},T=()=>{var Q;const K=l.firstEnabled();K&&((Q=K.node)==null||Q.focus())},w=()=>{var Q;const K=l.lastEnabled();K&&((Q=K.node)==null||Q.focus())},I=s==="horizontal",N=s==="vertical",F=f.key,j=a==="ltr"?"ArrowLeft":"ArrowRight",G=a==="ltr"?"ArrowRight":"ArrowLeft",te={[j]:()=>I&&v(),[G]:()=>I&&E(),ArrowDown:()=>N&&E(),ArrowUp:()=>N&&v(),Home:T,End:w}[F];te&&(f.preventDefault(),te(f))},[l,t,s,a]);return{...r,role:"tablist","aria-orientation":s,onKeyDown:Zn(r.onKeyDown,d)}}function Sxe(r){const{isDisabled:t=!1,isFocusable:s=!1,...a}=r,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:E,selectedIndex:v}=rN(),{index:T,register:w}=_xe({disabled:t&&!s}),I=T===v,N=()=>{l(T)},F=()=>{E(T),!d&&!(t&&s)&&l(T)};return{...tte({...a,ref:Hi(w,r.ref),isDisabled:t,isFocusable:s,onClick:Zn(r.onClick,N)}),id:Ate(f,T),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":Pte(f,T),onFocus:t?void 0:Zn(r.onFocus,F)}}const[Txe,bxe]=Vi({});function wxe(r){const t=rN(),{id:s,selectedIndex:a}=t,d=cV(r.children).map((f,E)=>L.createElement(Txe,{key:f.key??E,value:{isSelected:E===a,id:Pte(s,E),tabId:Ate(s,E),selectedIndex:a}},f));return{...r,children:d}}function Rxe(r){const{children:t,...s}=r,{isLazy:a,lazyBehavior:l}=rN(),{isSelected:d,id:f,tabId:E}=bxe(),v=L.useRef(!1);d&&(v.current=!0);const T=lV({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:T?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:f}}function Ate(r,t){return`${r}--tab-${t}`}function Pte(r,t){return`${r}--tabpanel-${t}`}const[Cxe,iN]=Vi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),DR=tn(function(t,s){const a=qc("Tabs",t),{children:l,className:d,...f}=ns(t),{htmlProps:E,descendants:v,...T}=Exe(f),w=L.useMemo(()=>T,[T]),{isFitted:I,...N}=E,F={position:"relative",...a.root};return O.jsx(fxe,{value:v,children:O.jsx(yxe,{value:w,children:O.jsx(Cxe,{value:a,children:O.jsx(Ut.div,{className:Sn("chakra-tabs",d),ref:s,...N,__css:F,children:l})})})})});DR.displayName="Tabs";const Tl=tn(function(t,s){const a=iN(),l=Sxe({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return O.jsx(Ut.button,{...l,className:Sn("chakra-tabs__tab",t.className),__css:d})});Tl.displayName="Tab";const LR=tn(function(t,s){const a=vxe({...t,ref:s}),l=iN(),d={display:"flex",...l.tablist};return O.jsx(Ut.div,{...a,className:Sn("chakra-tabs__tablist",t.className),__css:d})});LR.displayName="TabList";const yd=tn(function(t,s){const a=Rxe({...t,ref:s}),l=iN();return O.jsx(Ut.div,{outline:"0",...a,className:Sn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});yd.displayName="TabPanel";const sN=tn(function(t,s){const a=wxe(t),l=iN();return O.jsx(Ut.div,{...a,width:"100%",ref:s,className:Sn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});sN.displayName="TabPanels";function Ixe(r,t){const s=r??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function Axe(r,t){const s=l=>({...t,...l,position:Ixe((l==null?void 0:l.position)??(t==null?void 0:t.position),r)}),a=l=>{const d=s(l),f=QZ(d);return Ph.notify(f,d)};return a.update=(l,d)=>{Ph.update(l,s(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(f,{status:"success",duration:5e3,...jc(d.success,E)})).catch(E=>a.update(f,{status:"error",duration:5e3,...jc(d.error,E)}))},a.closeAll=Ph.closeAll,a.close=Ph.close,a.isActive=Ph.isActive,a}function Zh(r){const{theme:t}=YZ(),s=qOe();return L.useMemo(()=>Axe(t.direction,{...s,...r}),[r,t.direction,s])}const Pxe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},RU=r=>{var t;return((t=r.current)==null?void 0:t.ownerDocument)||document},kO=r=>{var t,s;return((s=(t=r.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function Oxe(r={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:E=!0,onOpen:v,onClose:T,placement:w,id:I,isOpen:N,defaultIsOpen:F,arrowSize:j=10,arrowShadowColor:G,arrowPadding:H,modifiers:te,isDisabled:K,gutter:Q,offset:de,direction:se,...ge}=r,{isOpen:ee,onOpen:Z,onClose:ne}=ag({isOpen:N,defaultIsOpen:F,onOpen:v,onClose:T}),{referenceRef:ae,getPopperProps:me,getArrowInnerProps:he,getArrowProps:le}=xF({enabled:ee,placement:w,arrowPadding:H,modifiers:te,gutter:Q,offset:de,direction:se}),Me=L.useId(),tt=`tooltip-${I??Me}`,Ee=L.useRef(null),we=L.useRef(void 0),ve=L.useCallback(()=>{we.current&&(clearTimeout(we.current),we.current=void 0)},[]),Be=L.useRef(void 0),Oe=L.useCallback(()=>{Be.current&&(clearTimeout(Be.current),Be.current=void 0)},[]),be=L.useCallback(()=>{Oe(),ne()},[ne,Oe]),Ce=kxe(Ee,be),xe=L.useCallback(()=>{if(!K&&!we.current){ee&&Ce();const Vt=kO(Ee);we.current=Vt.setTimeout(Z,t)}},[Ce,K,ee,Z,t]),ze=L.useCallback(()=>{ve();const Vt=kO(Ee);Be.current=Vt.setTimeout(be,s)},[s,be,ve]),Qe=L.useCallback(()=>{ee&&a&&ze()},[a,ze,ee]),et=L.useCallback(()=>{ee&&f&&ze()},[f,ze,ee]),ut=L.useCallback(Vt=>{ee&&Vt.key==="Escape"&&ze()},[ee,ze]);TS(()=>RU(Ee),"keydown",E?ut:void 0),TS(()=>{if(!d)return null;const Vt=Ee.current;if(!Vt)return null;const ln=IJ(Vt);return ln.localName==="body"?kO(Ee):ln},"scroll",()=>{ee&&d&&be()},{passive:!0,capture:!0}),L.useEffect(()=>{K&&(ve(),ee&&ne())},[K,ee,ne,ve]),L.useEffect(()=>()=>{ve(),Oe()},[ve,Oe]),TS(()=>Ee.current,"pointerleave",ze);const it=L.useCallback((Vt={},ln=null)=>({...Vt,ref:Hi(Ee,ln,ae),onPointerEnter:Zn(Vt.onPointerEnter,Xt=>{Xt.pointerType!=="touch"&&xe()}),onClick:Zn(Vt.onClick,Qe),onPointerDown:Zn(Vt.onPointerDown,et),onFocus:Zn(Vt.onFocus,xe),onBlur:Zn(Vt.onBlur,ze),"aria-describedby":ee?tt:void 0}),[xe,ze,et,ee,tt,Qe,ae]),Ct=L.useCallback((Vt={},ln=null)=>me({...Vt,style:{...Vt.style,[Ws.arrowSize.var]:j?`${j}px`:void 0,[Ws.arrowShadowColor.var]:G}},ln),[me,j,G]),_n=L.useCallback((Vt={},ln=null)=>{const xn={...Vt.style,position:"relative",transformOrigin:Ws.transformOrigin.varRef};return{ref:ln,...ge,...Vt,id:tt,role:"tooltip",style:xn}},[ge,tt]);return{isOpen:ee,show:xe,hide:ze,getTriggerProps:it,getTooltipProps:_n,getTooltipPositionerProps:Ct,getArrowProps:le,getArrowInnerProps:he}}const s2="chakra-ui:close-tooltip";function kxe(r,t){return L.useEffect(()=>{const s=RU(r);return s.addEventListener(s2,t),()=>s.removeEventListener(s2,t)},[t,r]),()=>{const s=RU(r),a=kO(r);s.dispatchEvent(new a.CustomEvent(s2))}}const Nxe=Ut(If.div),eg=tn((r,t)=>{const s=Rd("Tooltip",r),a=ns(r),l=h0(),{children:d,label:f,shouldWrapChildren:E,"aria-label":v,hasArrow:T,bg:w,portalProps:I,background:N,backgroundColor:F,bgColor:j,motionProps:G,animatePresenceProps:H,...te}=a,K=N??F??w??j;if(K){s.bg=K;const ae=qEe(l,"colors",K);s[Ws.arrowBg.var]=ae}const Q=Oxe({...te,direction:l.direction}),de=!L.isValidElement(d)||E;let se;if(de)se=O.jsx(Ut.span,{display:"inline-block",tabIndex:0,...Q.getTriggerProps(),children:d});else{const ae=L.Children.only(d);se=L.cloneElement(ae,Q.getTriggerProps(ae.props,yte(ae)))}const ge=!!v,ee=Q.getTooltipProps({},t),Z=ge?_R(ee,["role","id"]):ee,ne=CJ(ee,["role","id"]);return f?O.jsxs(O.Fragment,{children:[se,O.jsx(l0,{...H,children:Q.isOpen&&O.jsx(bu,{...I,children:O.jsx(Ut.div,{...Q.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:O.jsxs(Nxe,{variants:Pxe,initial:"exit",animate:"enter",exit:"exit",...G,...Z,__css:s,children:[f,ge&&O.jsx(Ut.span,{srOnly:!0,...ne,children:v}),T&&O.jsx(Ut.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:O.jsx(Ut.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):O.jsx(O.Fragment,{children:d})});eg.displayName="Tooltip";const jF=tn(function(t,s){const a=Rd("Heading",t),{className:l,...d}=ns(t);return O.jsx(Ut.h2,{ref:s,className:Sn("chakra-heading",t.className),...d,__css:a})});jF.displayName="Heading";const Rt=tn(function(t,s){const a=Rd("Text",t),{className:l,align:d,decoration:f,casing:E,...v}=ns(t),T=xk({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return O.jsx(Ut.p,{ref:s,className:Sn("chakra-text",t.className),...T,...v,__css:a})});Rt.displayName="Text";const Dxe="modulepreload",Lxe=function(r,t){return new URL(r,t).href},Gq={},o2=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const f=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),v=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(s.map(T=>{if(T=Lxe(T,a),T in Gq)return;Gq[T]=!0;const w=T.endsWith(".css"),I=w?'[rel="stylesheet"]':"";if(!!a)for(let j=f.length-1;j>=0;j--){const G=f[j];if(G.href===T&&(!w||G.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${I}`))return;const F=document.createElement("link");if(F.rel=w?"stylesheet":Dxe,w||(F.as="script"),F.crossOrigin="",F.href=T,v&&F.setAttribute("nonce",v),document.head.appendChild(F),w)return new Promise((j,G)=>{F.addEventListener("load",j),F.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${T}`)))})}))}function d(f){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=f,window.dispatchEvent(E),!E.defaultPrevented)throw f}return l.then(f=>{for(const E of f||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},eO=()=>{const r=new Date,t=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0"),a=r.getSeconds().toString().padStart(2,"0"),l=r.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},Re={log:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${eO()}] `,...t)}},error:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${eO()}] `,...t)}},warn:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${eO()}]`,...t)}},trace:r=>{console.trace(`[TRACE] [${eO()}] ${r}`)}};async function xxe(r){let t;try{switch(r){case"default":t=await o2(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await o2(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(s){return Re.error("Failed to load theme:",s),t=await o2(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const Mxe=()=>{};var Hq={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ote=function(r){const t=[];let s=0;for(let a=0;a<r.length;a++){let l=r.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<r.length&&(r.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(r.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},Uxe=function(r){const t=[];let s=0,a=0;for(;s<r.length;){const l=r[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=r[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=r[s++],f=r[s++],E=r[s++],v=((l&7)<<18|(d&63)<<12|(f&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=r[s++],f=r[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return t.join("")},kte={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<r.length;l+=3){const d=r[l],f=l+1<r.length,E=f?r[l+1]:0,v=l+2<r.length,T=v?r[l+2]:0,w=d>>2,I=(d&3)<<4|E>>4;let N=(E&15)<<2|T>>6,F=T&63;v||(F=64,f||(N=64)),a.push(s[w],s[I],s[N],s[F])}return a.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Ote(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):Uxe(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<r.length;){const d=s[r.charAt(l++)],E=l<r.length?s[r.charAt(l)]:0;++l;const T=l<r.length?s[r.charAt(l)]:64;++l;const I=l<r.length?s[r.charAt(l)]:64;if(++l,d==null||E==null||T==null||I==null)throw new Vxe;const N=d<<2|E>>4;if(a.push(N),T!==64){const F=E<<4&240|T>>2;if(a.push(F),I!==64){const j=T<<6&192|I;a.push(j)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Vxe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Fxe=function(r){const t=Ote(r);return kte.encodeByteArray(t,!0)},uk=function(r){return Fxe(r).replace(/\./g,"")},Nte=function(r){try{return kte.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jxe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bxe=()=>jxe().__FIREBASE_DEFAULTS__,Wxe=()=>{if(typeof process>"u"||typeof Hq>"u")return;const r=Hq.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},zxe=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&Nte(r[1]);return t&&JSON.parse(t)},oN=()=>{try{return Mxe()||Bxe()||Wxe()||zxe()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Dte=r=>{var t,s;return(s=(t=oN())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[r]},Lte=r=>{const t=Dte(r);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},xte=()=>{var r;return(r=oN())===null||r===void 0?void 0:r.config},Mte=r=>{var t;return(t=oN())===null||t===void 0?void 0:t[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gxe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ute(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=r.iat||0,d=r.sub||r.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},r);return[uk(JSON.stringify(s)),uk(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Hxe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Oa())}function $xe(){var r;const t=(r=oN())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Kxe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function qxe(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Yxe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Xxe(){const r=Oa();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function Jxe(){return!$xe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Qxe(){try{return typeof indexedDB=="object"}catch{return!1}}function Zxe(){return new Promise((r,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),r(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eMe="FirebaseError";class ep extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=eMe,Object.setPrototypeOf(this,ep.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xR.prototype.create)}}class xR{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],f=d?tMe(d,a):"Error",E=`${this.serviceName}: ${f} (${l}).`;return new ep(l,E,a)}}function tMe(r,t){return r.replace(nMe,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const nMe=/\{\$([^}]+)}/g;function rMe(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function vE(r,t){if(r===t)return!0;const s=Object.keys(r),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=r[l],f=t[l];if($q(d)&&$q(f)){if(!vE(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function $q(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MR(r){const t=[];for(const[s,a]of Object.entries(r))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function mw(r){const t={};return r.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function gw(r){const t=r.indexOf("?");if(!t)return"";const s=r.indexOf("#",t);return r.substring(t,s>0?s:void 0)}function iMe(r,t){const s=new sMe(r,t);return s.subscribe.bind(s)}class sMe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");oMe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=a2),l.error===void 0&&(l.error=a2),l.complete===void 0&&(l.complete=a2);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function oMe(r,t){if(typeof r!="object"||r===null)return!1;for(const s of t)if(s in r&&typeof r[s]=="function")return!0;return!1}function a2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(r){return r&&r._delegate?r._delegate:r}class dg{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aMe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new Gxe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(lMe(t))try{this.getOrInitializeService({instanceIdentifier:X_})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=X_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=X_){return this.instances.has(t)}getOptions(t=X_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,f]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&f.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&t(f,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:cMe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=X_){return this.component?this.component.multipleInstances?t:X_:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function cMe(r){return r===X_?void 0:r}function lMe(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uMe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new aMe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yr;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(yr||(yr={}));const dMe={debug:yr.DEBUG,verbose:yr.VERBOSE,info:yr.INFO,warn:yr.WARN,error:yr.ERROR,silent:yr.SILENT},hMe=yr.INFO,pMe={[yr.DEBUG]:"log",[yr.VERBOSE]:"log",[yr.INFO]:"info",[yr.WARN]:"warn",[yr.ERROR]:"error"},fMe=(r,t,...s)=>{if(t<r.logLevel)return;const a=new Date().toISOString(),l=pMe[t];if(l)console[l](`[${a}]  ${r.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class BF{constructor(t){this.name=t,this._logLevel=hMe,this._logHandler=fMe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in yr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?dMe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,yr.DEBUG,...t),this._logHandler(this,yr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,yr.VERBOSE,...t),this._logHandler(this,yr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,yr.INFO,...t),this._logHandler(this,yr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,yr.WARN,...t),this._logHandler(this,yr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,yr.ERROR,...t),this._logHandler(this,yr.ERROR,...t)}}const mMe=(r,t)=>t.some(s=>r instanceof s);let Kq,qq;function gMe(){return Kq||(Kq=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _Me(){return qq||(qq=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vte=new WeakMap,CU=new WeakMap,Fte=new WeakMap,c2=new WeakMap,WF=new WeakMap;function EMe(r){const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("success",d),r.removeEventListener("error",f)},d=()=>{s(tg(r.result)),l()},f=()=>{a(r.error),l()};r.addEventListener("success",d),r.addEventListener("error",f)});return t.then(s=>{s instanceof IDBCursor&&Vte.set(s,r)}).catch(()=>{}),WF.set(t,r),t}function yMe(r){if(CU.has(r))return;const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("complete",d),r.removeEventListener("error",f),r.removeEventListener("abort",f)},d=()=>{s(),l()},f=()=>{a(r.error||new DOMException("AbortError","AbortError")),l()};r.addEventListener("complete",d),r.addEventListener("error",f),r.addEventListener("abort",f)});CU.set(r,t)}let IU={get(r,t,s){if(r instanceof IDBTransaction){if(t==="done")return CU.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Fte.get(r);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return tg(r[t])},set(r,t,s){return r[t]=s,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function vMe(r){IU=r(IU)}function SMe(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=r.call(l2(this),t,...s);return Fte.set(a,t.sort?t.sort():[t]),tg(a)}:_Me().includes(r)?function(...t){return r.apply(l2(this),t),tg(Vte.get(this))}:function(...t){return tg(r.apply(l2(this),t))}}function TMe(r){return typeof r=="function"?SMe(r):(r instanceof IDBTransaction&&yMe(r),mMe(r,gMe())?new Proxy(r,IU):r)}function tg(r){if(r instanceof IDBRequest)return EMe(r);if(c2.has(r))return c2.get(r);const t=TMe(r);return t!==r&&(c2.set(r,t),WF.set(t,r)),t}const l2=r=>WF.get(r);function bMe(r,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(r,t),E=tg(f);return a&&f.addEventListener("upgradeneeded",v=>{a(tg(f.result),v.oldVersion,v.newVersion,tg(f.transaction),v)}),s&&f.addEventListener("blocked",v=>s(v.oldVersion,v.newVersion,v)),E.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",T=>l(T.oldVersion,T.newVersion,T))}).catch(()=>{}),E}const wMe=["get","getKey","getAll","getAllKeys","count"],RMe=["put","add","delete","clear"],u2=new Map;function Yq(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(u2.get(t))return u2.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=RMe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||wMe.includes(s)))return;const d=async function(f,...E){const v=this.transaction(f,l?"readwrite":"readonly");let T=v.store;return a&&(T=T.index(E.shift())),(await Promise.all([T[s](...E),l&&v.done]))[0]};return u2.set(t,d),d}vMe(r=>({...r,get:(t,s,a)=>Yq(t,s)||r.get(t,s,a),has:(t,s)=>!!Yq(t,s)||r.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CMe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(IMe(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function IMe(r){const t=r.getComponent();return(t==null?void 0:t.type)==="VERSION"}const AU="@firebase/app",Xq="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tf=new BF("@firebase/app"),AMe="@firebase/app-compat",PMe="@firebase/analytics-compat",OMe="@firebase/analytics",kMe="@firebase/app-check-compat",NMe="@firebase/app-check",DMe="@firebase/auth",LMe="@firebase/auth-compat",xMe="@firebase/database",MMe="@firebase/data-connect",UMe="@firebase/database-compat",VMe="@firebase/functions",FMe="@firebase/functions-compat",jMe="@firebase/installations",BMe="@firebase/installations-compat",WMe="@firebase/messaging",zMe="@firebase/messaging-compat",GMe="@firebase/performance",HMe="@firebase/performance-compat",$Me="@firebase/remote-config",KMe="@firebase/remote-config-compat",qMe="@firebase/storage",YMe="@firebase/storage-compat",XMe="@firebase/firestore",JMe="@firebase/vertexai",QMe="@firebase/firestore-compat",ZMe="firebase",e2e="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PU="[DEFAULT]",t2e={[AU]:"fire-core",[AMe]:"fire-core-compat",[OMe]:"fire-analytics",[PMe]:"fire-analytics-compat",[NMe]:"fire-app-check",[kMe]:"fire-app-check-compat",[DMe]:"fire-auth",[LMe]:"fire-auth-compat",[xMe]:"fire-rtdb",[MMe]:"fire-data-connect",[UMe]:"fire-rtdb-compat",[VMe]:"fire-fn",[FMe]:"fire-fn-compat",[jMe]:"fire-iid",[BMe]:"fire-iid-compat",[WMe]:"fire-fcm",[zMe]:"fire-fcm-compat",[GMe]:"fire-perf",[HMe]:"fire-perf-compat",[$Me]:"fire-rc",[KMe]:"fire-rc-compat",[qMe]:"fire-gcs",[YMe]:"fire-gcs-compat",[XMe]:"fire-fst",[QMe]:"fire-fst-compat",[JMe]:"fire-vertex","fire-js":"fire-js",[ZMe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk=new Map,n2e=new Map,OU=new Map;function Jq(r,t){try{r.container.addComponent(t)}catch(s){Tf.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,s)}}function SE(r){const t=r.name;if(OU.has(t))return Tf.debug(`There were multiple attempts to register component ${t}.`),!1;OU.set(t,r);for(const s of dk.values())Jq(s,r);for(const s of n2e.values())Jq(s,r);return!0}function aN(r,t){const s=r.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),r.container.getProvider(t)}function Sl(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r2e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ng=new xR("app","Firebase",r2e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i2e{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new dg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ng.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AE=e2e;function jte(r,t={}){let s=r;typeof t!="object"&&(t={name:t});const a=Object.assign({name:PU,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw ng.create("bad-app-name",{appName:String(l)});if(s||(s=xte()),!s)throw ng.create("no-options");const d=dk.get(l);if(d){if(vE(s,d.options)&&vE(a,d.config))return d;throw ng.create("duplicate-app",{appName:l})}const f=new uMe(l);for(const v of OU.values())f.addComponent(v);const E=new i2e(s,a,f);return dk.set(l,E),E}function zF(r=PU){const t=dk.get(r);if(!t&&r===PU&&xte())return jte();if(!t)throw ng.create("no-app",{appName:r});return t}function Bh(r,t,s){var a;let l=(a=t2e[r])!==null&&a!==void 0?a:r;s&&(l+=`-${s}`);const d=l.match(/\s|\//),f=t.match(/\s|\//);if(d||f){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&E.push("and"),f&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Tf.warn(E.join(" "));return}SE(new dg(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s2e="firebase-heartbeat-database",o2e=1,oR="firebase-heartbeat-store";let d2=null;function Bte(){return d2||(d2=bMe(s2e,o2e,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(oR)}catch(s){console.warn(s)}}}}).catch(r=>{throw ng.create("idb-open",{originalErrorMessage:r.message})})),d2}async function a2e(r){try{const s=(await Bte()).transaction(oR),a=await s.objectStore(oR).get(Wte(r));return await s.done,a}catch(t){if(t instanceof ep)Tf.warn(t.message);else{const s=ng.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Tf.warn(s.message)}}}async function Qq(r,t){try{const a=(await Bte()).transaction(oR,"readwrite");await a.objectStore(oR).put(t,Wte(r)),await a.done}catch(s){if(s instanceof ep)Tf.warn(s.message);else{const a=ng.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Tf.warn(a.message)}}}function Wte(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c2e=1024,l2e=30;class u2e{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new h2e(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=Zq();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>l2e){const f=p2e(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Tf.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=Zq(),{heartbeatsToSend:a,unsentEntries:l}=d2e(this._heartbeatsCache.heartbeats),d=uk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return Tf.warn(s),""}}}function Zq(){return new Date().toISOString().substring(0,10)}function d2e(r,t=c2e){const s=[];let a=r.slice();for(const l of r){const d=s.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),eY(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),eY(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class h2e{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Qxe()?Zxe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await a2e(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return Qq(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return Qq(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function eY(r){return uk(JSON.stringify({version:2,heartbeats:r})).length}function p2e(r){if(r.length===0)return-1;let t=0,s=r[0].date;for(let a=1;a<r.length;a++)r[a].date<s&&(s=r[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f2e(r){SE(new dg("platform-logger",t=>new CMe(t),"PRIVATE")),SE(new dg("heartbeat",t=>new u2e(t),"PRIVATE")),Bh(AU,Xq,r),Bh(AU,Xq,"esm2017"),Bh("fire-js","")}f2e("");function zte(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const m2e=zte,Gte=new xR("auth","Firebase",zte());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk=new BF("@firebase/auth");function g2e(r,...t){hk.logLevel<=yr.WARN&&hk.warn(`Auth (${AE}): ${r}`,...t)}function NO(r,...t){hk.logLevel<=yr.ERROR&&hk.error(`Auth (${AE}): ${r}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bd(r,...t){throw GF(r,...t)}function Wh(r,...t){return GF(r,...t)}function Hte(r,t,s){const a=Object.assign(Object.assign({},m2e()),{[t]:s});return new xR("auth","Firebase",a).create(t,{appName:r.name})}function gf(r){return Hte(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function GF(r,...t){if(typeof r!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=r.name),r._errorFactory.create(s,...a)}return Gte.create(r,...t)}function Ln(r,t,...s){if(!r)throw GF(t,...s)}function cf(r){const t="INTERNAL ASSERTION FAILED: "+r;throw NO(t),new Error(t)}function bf(r,t){r||cf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kU(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function _2e(){return tY()==="http:"||tY()==="https:"}function tY(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E2e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_2e()||qxe()||"connection"in navigator)?navigator.onLine:!0}function y2e(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{constructor(t,s){this.shortDelay=t,this.longDelay=s,bf(s>t,"Short delay should be less than long delay!"),this.isMobile=Hxe()||Yxe()}get(){return E2e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HF(r,t){bf(r.emulator,"Emulator should always be set here");const{url:s}=r.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $te{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;cf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;cf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;cf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v2e={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S2e=new UR(3e4,6e4);function Pf(r,t){return r.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:r.tenantId}):t}async function Of(r,t,s,a,l={}){return Kte(r,l,async()=>{let d={},f={};a&&(t==="GET"?f=a:d={body:JSON.stringify(a)});const E=MR(Object.assign({key:r.config.apiKey},f)).slice(1),v=await r._getAdditionalHeaders();v["Content-Type"]="application/json",r.languageCode&&(v["X-Firebase-Locale"]=r.languageCode);const T=Object.assign({method:t,headers:v},d);return Kxe()||(T.referrerPolicy="no-referrer"),$te.fetch()(qte(r,r.config.apiHost,s,E),T)})}async function Kte(r,t,s){r._canInitEmulator=!1;const a=Object.assign(Object.assign({},v2e),t);try{const l=new b2e(r),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw tO(r,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const E=d.ok?f.errorMessage:f.error.message,[v,T]=E.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw tO(r,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw tO(r,"email-already-in-use",f);if(v==="USER_DISABLED")throw tO(r,"user-disabled",f);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(T)throw Hte(r,w,T);bd(r,w)}}catch(l){if(l instanceof ep)throw l;bd(r,"network-request-failed",{message:String(l)})}}async function VR(r,t,s,a,l={}){const d=await Of(r,t,s,a,l);return"mfaPendingCredential"in d&&bd(r,"multi-factor-auth-required",{_serverResponse:d}),d}function qte(r,t,s,a){const l=`${t}${s}?${a}`;return r.config.emulator?HF(r.config,l):`${r.config.apiScheme}://${l}`}function T2e(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class b2e{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(Wh(this.auth,"network-request-failed")),S2e.get())})}}function tO(r,t,s){const a={appName:r.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=Wh(r,t,a);return l.customData._tokenResponse=s,l}function nY(r){return r!==void 0&&r.enterprise!==void 0}class w2e{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return T2e(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function R2e(r,t){return Of(r,"GET","/v2/recaptchaConfig",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C2e(r,t){return Of(r,"POST","/v1/accounts:delete",t)}async function Yte(r,t){return Of(r,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lw(r){if(r)try{const t=new Date(Number(r));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function I2e(r,t=!1){const s=Ki(r),a=await s.getIdToken(t),l=$F(a);Ln(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:Lw(h2(l.auth_time)),issuedAtTime:Lw(h2(l.iat)),expirationTime:Lw(h2(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function h2(r){return Number(r)*1e3}function $F(r){const[t,s,a]=r.split(".");if(t===void 0||s===void 0||a===void 0)return NO("JWT malformed, contained fewer than 3 sections"),null;try{const l=Nte(s);return l?JSON.parse(l):(NO("Failed to decode base64 JWT payload"),null)}catch(l){return NO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function rY(r){const t=$F(r);return Ln(t,"internal-error"),Ln(typeof t.exp<"u","internal-error"),Ln(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aR(r,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof ep&&A2e(a)&&r.auth.currentUser===r&&await r.auth.signOut(),a}}function A2e({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P2e{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NU{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Lw(this.lastLoginAt),this.creationTime=Lw(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pk(r){var t;const s=r.auth,a=await r.getIdToken(),l=await aR(r,Yte(s,{idToken:a}));Ln(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];r._notifyReloadListener(d);const f=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?Xte(d.providerUserInfo):[],E=k2e(r.providerData,f),v=r.isAnonymous,T=!(r.email&&d.passwordHash)&&!(E!=null&&E.length),w=v?T:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new NU(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(r,I)}async function O2e(r){const t=Ki(r);await pk(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function k2e(r,t){return[...r.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function Xte(r){return r.map(t=>{var{providerId:s}=t,a=AR(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N2e(r,t){const s=await Kte(r,{},async()=>{const a=MR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=r.config,f=qte(r,l,"/v1/token",`key=${d}`),E=await r._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",$te.fetch()(f,{method:"POST",headers:E,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function D2e(r,t){return Of(r,"POST","/v2/accounts:revokeToken",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ln(t.idToken,"internal-error"),Ln(typeof t.idToken<"u","internal-error"),Ln(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):rY(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Ln(t.length!==0,"internal-error");const s=rY(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Ln(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await N2e(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,f=new DS;return a&&(Ln(typeof a=="string","internal-error",{appName:t}),f.refreshToken=a),l&&(Ln(typeof l=="string","internal-error",{appName:t}),f.accessToken=l),d&&(Ln(typeof d=="number","internal-error",{appName:t}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new DS,this.toJSON())}_performRefresh(){return cf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bm(r,t){Ln(typeof r=="string"||typeof r>"u","internal-error",{appName:t})}class lf{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=AR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new P2e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new NU(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await aR(this,this.stsTokenManager.getToken(this.auth,t));return Ln(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return I2e(this,t)}reload(){return O2e(this)}_assign(t){this!==t&&(Ln(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new lf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Ln(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await pk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Sl(this.auth.app))return Promise.reject(gf(this.auth));const t=await this.getIdToken();return await aR(this,C2e(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,f,E,v,T,w;const I=(a=s.displayName)!==null&&a!==void 0?a:void 0,N=(l=s.email)!==null&&l!==void 0?l:void 0,F=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,j=(f=s.photoURL)!==null&&f!==void 0?f:void 0,G=(E=s.tenantId)!==null&&E!==void 0?E:void 0,H=(v=s._redirectEventId)!==null&&v!==void 0?v:void 0,te=(T=s.createdAt)!==null&&T!==void 0?T:void 0,K=(w=s.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:Q,emailVerified:de,isAnonymous:se,providerData:ge,stsTokenManager:ee}=s;Ln(Q&&ee,t,"internal-error");const Z=DS.fromJSON(this.name,ee);Ln(typeof Q=="string",t,"internal-error"),Bm(I,t.name),Bm(N,t.name),Ln(typeof de=="boolean",t,"internal-error"),Ln(typeof se=="boolean",t,"internal-error"),Bm(F,t.name),Bm(j,t.name),Bm(G,t.name),Bm(H,t.name),Bm(te,t.name),Bm(K,t.name);const ne=new lf({uid:Q,auth:t,email:N,emailVerified:de,displayName:I,isAnonymous:se,photoURL:j,phoneNumber:F,tenantId:G,stsTokenManager:Z,createdAt:te,lastLoginAt:K});return ge&&Array.isArray(ge)&&(ne.providerData=ge.map(ae=>Object.assign({},ae))),H&&(ne._redirectEventId=H),ne}static async _fromIdTokenResponse(t,s,a=!1){const l=new DS;l.updateFromServerResponse(s);const d=new lf({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await pk(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Ln(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Xte(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new DS;E.updateFromIdToken(a);const v=new lf({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:f}),T={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new NU(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,T),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iY=new Map;function uf(r){bf(r instanceof Function,"Expected a class definition");let t=iY.get(r);return t?(bf(t instanceof r,"Instance stored in cache mismatched with class"),t):(t=new r,iY.set(r,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jte{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}Jte.type="NONE";const sY=Jte;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DO(r,t,s){return`firebase:${r}:${t}:${s}`}class LS{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=DO(this.userKey,l.apiKey,d),this.fullPersistenceKey=DO("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?lf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new LS(uf(sY),t,a);const l=(await Promise.all(s.map(async T=>{if(await T._isAvailable())return T}))).filter(T=>T);let d=l[0]||uf(sY);const f=DO(a,t.config.apiKey,t.name);let E=null;for(const T of s)try{const w=await T._get(f);if(w){const I=lf._fromJSON(t,w);T!==d&&(E=I),d=T;break}}catch{}const v=l.filter(T=>T._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new LS(d,t,a):(d=v[0],E&&await d._set(f,E.toJSON()),await Promise.all(s.map(async T=>{if(T!==d)try{await T._remove(f)}catch{}})),new LS(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oY(r){const t=r.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(tne(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Qte(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(rne(t))return"Blackberry";if(ine(t))return"Webos";if(Zte(t))return"Safari";if((t.includes("chrome/")||ene(t))&&!t.includes("edge/"))return"Chrome";if(nne(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=r.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Qte(r=Oa()){return/firefox\//i.test(r)}function Zte(r=Oa()){const t=r.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ene(r=Oa()){return/crios\//i.test(r)}function tne(r=Oa()){return/iemobile/i.test(r)}function nne(r=Oa()){return/android/i.test(r)}function rne(r=Oa()){return/blackberry/i.test(r)}function ine(r=Oa()){return/webos/i.test(r)}function KF(r=Oa()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function L2e(r=Oa()){var t;return KF(r)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function x2e(){return Xxe()&&document.documentMode===10}function sne(r=Oa()){return KF(r)||nne(r)||ine(r)||rne(r)||/windows phone/i.test(r)||tne(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function one(r,t=[]){let s;switch(r){case"Browser":s=oY(Oa());break;case"Worker":s=`${oY(Oa())}-${r}`;break;default:s=r}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${AE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M2e{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((f,E)=>{try{const v=t(d);f(v)}catch(v){E(v)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U2e(r,t={}){return Of(r,"GET","/v2/passwordPolicy",Pf(r,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2e=6;class F2e{constructor(t){var s,a,l,d;const f=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=f.minPasswordLength)!==null&&s!==void 0?s:V2e,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,f,E;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(s=v.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(E=v.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),v}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2e{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new aY(this),this.idTokenSubscription=new aY(this),this.beforeStateQueue=new M2e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Gte,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=uf(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await LS.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await Yte(this,{idToken:t}),a=await lf._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(Sl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,E=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!f||f===E)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Ln(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await pk(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=y2e()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Sl(this.app))return Promise.reject(gf(this));const s=t?Ki(t):null;return s&&Ln(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Ln(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Sl(this.app)?Promise.reject(gf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Sl(this.app)?Promise.reject(gf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(uf(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await U2e(this),s=new F2e(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new xR("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await D2e(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&uf(t)||this._popupRedirectResolver;Ln(s,this,"argument-error"),this.redirectPersistenceManager=await LS.create(this,[uf(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let f=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ln(E,this,"internal-error"),E.then(()=>{f||d(this.currentUser)}),typeof s=="function"){const v=t.addObserver(s,a,l);return()=>{f=!0,v()}}else{const v=t.addObserver(s);return()=>{f=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ln(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=one(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(Sl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&g2e(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function PE(r){return Ki(r)}class aY{constructor(t){this.auth=t,this.observer=null,this.addObserver=iMe(s=>this.observer=s)}get next(){return Ln(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function B2e(r){cN=r}function ane(r){return cN.loadJS(r)}function W2e(){return cN.recaptchaEnterpriseScript}function z2e(){return cN.gapiScript}function G2e(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class H2e{constructor(){this.enterprise=new $2e}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class $2e{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const K2e="recaptcha-enterprise",cne="NO_RECAPTCHA";class q2e{constructor(t){this.type=K2e,this.auth=PE(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,E)=>{R2e(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const T=new w2e(v);return d.tenantId==null?d._agentRecaptchaConfig=T:d._tenantRecaptchaConfigs[d.tenantId]=T,f(T.siteKey)}}).catch(v=>{E(v)})})}function l(d,f,E){const v=window.grecaptcha;nY(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(T=>{f(T)}).catch(()=>{f(cne)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new H2e().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(E=>{if(!s&&nY(window.grecaptcha))l(E,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=W2e();v.length!==0&&(v+=E),ane(v).then(()=>{l(E,d,f)}).catch(T=>{f(T)})}}).catch(E=>{f(E)})})}}async function cY(r,t,s,a=!1,l=!1){const d=new q2e(r);let f;if(l)f=cne;else try{f=await d.verify(s)}catch{f=await d.verify(s,!0)}const E=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const v=E.phoneEnrollmentInfo.phoneNumber,T=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:T,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const v=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:f}):Object.assign(E,{captchaResponse:f}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function DU(r,t,s,a,l){var d;if(!((d=r._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await cY(r,t,s,s==="getOobCode");return a(r,f)}else return a(r,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await cY(r,t,s,s==="getOobCode");return a(r,E)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2e(r,t){const s=aN(r,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(vE(d,t??{}))return l;bd(l,"already-initialized")}return s.initialize({options:t})}function X2e(r,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(uf);t!=null&&t.errorMap&&r._updateErrorMap(t.errorMap),r._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function J2e(r,t,s){const a=PE(r);Ln(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=lne(t),{host:f,port:E}=Q2e(t),v=E===null?"":`:${E}`,T={url:`${d}//${f}${v}/`},w=Object.freeze({host:f,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Ln(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Ln(vE(T,a.config.emulator)&&vE(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=T,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,Z2e()}function lne(r){const t=r.indexOf(":");return t<0?"":r.substr(0,t+1)}function Q2e(r){const t=lne(r),s=/(\/\/)?([^?#/]+)/.exec(r.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:lY(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:lY(f)}}}function lY(r){if(!r)return null;const t=Number(r);return isNaN(t)?null:t}function Z2e(){function r(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return cf("not implemented")}_getIdTokenResponse(t){return cf("not implemented")}_linkToIdToken(t,s){return cf("not implemented")}_getReauthenticationResolver(t){return cf("not implemented")}}async function eUe(r,t){return Of(r,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tUe(r,t){return VR(r,"POST","/v1/accounts:signInWithPassword",Pf(r,t))}async function nUe(r,t){return Of(r,"POST","/v1/accounts:sendOobCode",Pf(r,t))}async function rUe(r,t){return nUe(r,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iUe(r,t){return VR(r,"POST","/v1/accounts:signInWithEmailLink",Pf(r,t))}async function sUe(r,t){return VR(r,"POST","/v1/accounts:signInWithEmailLink",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR extends qF{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new cR(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new cR(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return DU(t,s,"signInWithPassword",tUe);case"emailLink":return iUe(t,{email:this._email,oobCode:this._password});default:bd(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return DU(t,a,"signUpPassword",eUe);case"emailLink":return sUe(t,{idToken:s,email:this._email,oobCode:this._password});default:bd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xS(r,t){return VR(r,"POST","/v1/accounts:signInWithIdp",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oUe="http://localhost";class TE extends qF{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new TE(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):bd("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=AR(s,["providerId","signInMethod"]);if(!a||!l)return null;const f=new TE(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(t){const s=this.buildRequest();return xS(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,xS(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,xS(t,s)}buildRequest(){const t={requestUri:oUe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=MR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aUe(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function cUe(r){const t=mw(gw(r)).link,s=t?mw(gw(t)).deep_link_id:null,a=mw(gw(r)).deep_link_id;return(a?mw(gw(a)).link:null)||a||s||t||r}class YF{constructor(t){var s,a,l,d,f,E;const v=mw(gw(t)),T=(s=v.apiKey)!==null&&s!==void 0?s:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,I=aUe((l=v.mode)!==null&&l!==void 0?l:null);Ln(T&&w&&I,"argument-error"),this.apiKey=T,this.operation=I,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=v.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(E=v.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const s=cUe(t);try{return new YF(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(){this.providerId=g0.PROVIDER_ID}static credential(t,s){return cR._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=YF.parseLink(s);return Ln(a,"argument-error"),cR._fromEmailAndCode(t,a.code,a.tenantId)}}g0.PROVIDER_ID="password";g0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";g0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class une{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR extends une{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m extends FR{constructor(){super("facebook.com")}static credential(t){return TE._fromParams({providerId:$m.PROVIDER_ID,signInMethod:$m.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return $m.credentialFromTaggedObject(t)}static credentialFromError(t){return $m.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return $m.credential(t.oauthAccessToken)}catch{return null}}}$m.FACEBOOK_SIGN_IN_METHOD="facebook.com";$m.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km extends FR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return TE._fromParams({providerId:Km.PROVIDER_ID,signInMethod:Km.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return Km.credentialFromTaggedObject(t)}static credentialFromError(t){return Km.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return Km.credential(s,a)}catch{return null}}}Km.GOOGLE_SIGN_IN_METHOD="google.com";Km.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm extends FR{constructor(){super("github.com")}static credential(t){return TE._fromParams({providerId:qm.PROVIDER_ID,signInMethod:qm.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return qm.credentialFromTaggedObject(t)}static credentialFromError(t){return qm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return qm.credential(t.oauthAccessToken)}catch{return null}}}qm.GITHUB_SIGN_IN_METHOD="github.com";qm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym extends FR{constructor(){super("twitter.com")}static credential(t,s){return TE._fromParams({providerId:Ym.PROVIDER_ID,signInMethod:Ym.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return Ym.credentialFromTaggedObject(t)}static credentialFromError(t){return Ym.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return Ym.credential(s,a)}catch{return null}}}Ym.TWITTER_SIGN_IN_METHOD="twitter.com";Ym.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lUe(r,t){return VR(r,"POST","/v1/accounts:signUp",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await lf._fromIdTokenResponse(t,a,l),f=uY(a);return new bE({user:d,providerId:f,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=uY(a);return new bE({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function uY(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk extends ep{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,fk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new fk(t,s,a,l)}}function dne(r,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(r):s._getIdTokenResponse(r)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?fk._fromErrorAndOperation(r,d,t,a):d})}async function uUe(r,t,s=!1){const a=await aR(r,t._linkToIdToken(r.auth,await r.getIdToken()),s);return bE._forOperation(r,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dUe(r,t,s=!1){const{auth:a}=r;if(Sl(a.app))return Promise.reject(gf(a));const l="reauthenticate";try{const d=await aR(r,dne(a,l,t,r),s);Ln(d.idToken,a,"internal-error");const f=$F(d.idToken);Ln(f,a,"internal-error");const{sub:E}=f;return Ln(r.uid===E,a,"user-mismatch"),bE._forOperation(r,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&bd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hne(r,t,s=!1){if(Sl(r.app))return Promise.reject(gf(r));const a="signIn",l=await dne(r,a,t),d=await bE._fromIdTokenResponse(r,a,l);return s||await r._updateCurrentUser(d.user),d}async function hUe(r,t){return hne(PE(r),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pne(r){const t=PE(r);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function pUe(r,t,s){if(Sl(r.app))return Promise.reject(gf(r));const a=PE(r),f=await DU(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",lUe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&pne(r),v}),E=await bE._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(E.user),E}function fUe(r,t,s){return Sl(r.app)?Promise.reject(gf(r)):hUe(Ki(r),g0.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&pne(r),a})}async function mUe(r,t){const s=Ki(r),l={requestType:"VERIFY_EMAIL",idToken:await r.getIdToken()},{email:d}=await rUe(s.auth,l);d!==r.email&&await r.reload()}function gUe(r,t,s,a){return Ki(r).onIdTokenChanged(t,s,a)}function _Ue(r,t,s){return Ki(r).beforeAuthStateChanged(t,s)}function EUe(r,t,s,a){return Ki(r).onAuthStateChanged(t,s,a)}function yUe(r){return Ki(r).signOut()}const mk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fne{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(mk,"1"),this.storage.removeItem(mk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vUe=1e3,SUe=10;class mne extends fne{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=sne(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((f,E,v)=>{this.notifyListeners(f,v)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!s&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);x2e()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,SUe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},vUe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}mne.type="LOCAL";const TUe=mne;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gne extends fne{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}gne.type="SESSION";const _ne=gne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bUe(r){return Promise.all(r.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new lN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(f).map(async T=>T(s.origin,d)),v=await bUe(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}lN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XF(r="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return r+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wUe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((E,v)=>{const T=XF("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const N=I;if(N.data.eventId===T)switch(N.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:t,eventId:T,data:s},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zh(){return window}function RUe(r){zh().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ene(){return typeof zh().WorkerGlobalScope<"u"&&typeof zh().importScripts=="function"}async function CUe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function IUe(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function AUe(){return Ene()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yne="firebaseLocalStorageDb",PUe=1,gk="firebaseLocalStorage",vne="fbase_key";class jR{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function uN(r,t){return r.transaction([gk],t?"readwrite":"readonly").objectStore(gk)}function OUe(){const r=indexedDB.deleteDatabase(yne);return new jR(r).toPromise()}function LU(){const r=indexedDB.open(yne,PUe);return new Promise((t,s)=>{r.addEventListener("error",()=>{s(r.error)}),r.addEventListener("upgradeneeded",()=>{const a=r.result;try{a.createObjectStore(gk,{keyPath:vne})}catch(l){s(l)}}),r.addEventListener("success",async()=>{const a=r.result;a.objectStoreNames.contains(gk)?t(a):(a.close(),await OUe(),t(await LU()))})})}async function dY(r,t,s){const a=uN(r,!0).put({[vne]:t,value:s});return new jR(a).toPromise()}async function kUe(r,t){const s=uN(r,!1).get(t),a=await new jR(s).toPromise();return a===void 0?null:a.value}function hY(r,t){const s=uN(r,!0).delete(t);return new jR(s).toPromise()}const NUe=800,DUe=3;class Sne{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await LU(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>DUe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ene()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=lN._getInstance(AUe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await CUe(),!this.activeServiceWorker)return;this.sender=new wUe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||IUe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await LU();return await dY(t,mk,"1"),await hY(t,mk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>dY(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>kUe(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>hY(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=uN(l,!1).getAll();return new jR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),NUe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Sne.type="LOCAL";const LUe=Sne;new UR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xUe(r,t){return t?uf(t):(Ln(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF extends qF{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return xS(t,this._buildIdpRequest())}_linkToIdToken(t,s){return xS(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return xS(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function MUe(r){return hne(r.auth,new JF(r),r.bypassAuthState)}function UUe(r){const{auth:t,user:s}=r;return Ln(s,t,"internal-error"),dUe(s,new JF(r),r.bypassAuthState)}async function VUe(r){const{auth:t,user:s}=r;return Ln(s,t,"internal-error"),uUe(s,new JF(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tne{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:f,type:E}=t;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(v))}catch(T){this.reject(T)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return MUe;case"linkViaPopup":case"linkViaRedirect":return VUe;case"reauthViaPopup":case"reauthViaRedirect":return UUe;default:bd(this.auth,"internal-error")}}resolve(t){bf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){bf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FUe=new UR(2e3,1e4);class vS extends Tne{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,vS.currentPopupAction&&vS.currentPopupAction.cancel(),vS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Ln(t,this.auth,"internal-error"),t}async onExecution(){bf(this.filter.length===1,"Popup operations only handle one event");const t=XF();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(Wh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Wh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,vS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Wh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,FUe.get())};t()}}vS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jUe="pendingRedirect",LO=new Map;class BUe extends Tne{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=LO.get(this.auth._key());if(!t){try{const a=await WUe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}LO.set(this.auth._key(),t)}return this.bypassAuthState||LO.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function WUe(r,t){const s=HUe(t),a=GUe(r);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function zUe(r,t){LO.set(r._key(),t)}function GUe(r){return uf(r._redirectPersistence)}function HUe(r){return DO(jUe,r.config.apiKey,r.name)}async function $Ue(r,t,s=!1){if(Sl(r.app))return Promise.reject(gf(r));const a=PE(r),l=xUe(a,t),f=await new BUe(a,l,s).execute();return f&&!s&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,t)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KUe=10*60*1e3;class qUe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!YUe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!bne(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(Wh(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=KUe&&this.cachedEventUids.clear(),this.cachedEventUids.has(pY(t))}saveEventToCache(t){this.cachedEventUids.add(pY(t)),this.lastProcessedEventTime=Date.now()}}function pY(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(t=>t).join("-")}function bne({type:r,error:t}){return r==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function YUe(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return bne(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XUe(r,t={}){return Of(r,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JUe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,QUe=/^https?/;async function ZUe(r){if(r.config.emulator)return;const{authorizedDomains:t}=await XUe(r);for(const s of t)try{if(eVe(s))return}catch{}bd(r,"unauthorized-domain")}function eVe(r){const t=kU(),{protocol:s,hostname:a}=new URL(t);if(r.startsWith("chrome-extension://")){const f=new URL(r);return f.hostname===""&&a===""?s==="chrome-extension:"&&r.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&f.hostname===a}if(!QUe.test(s))return!1;if(JUe.test(r))return a===r;const l=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tVe=new UR(3e4,6e4);function fY(){const r=zh().___jsl;if(r!=null&&r.H){for(const t of Object.keys(r.H))if(r.H[t].r=r.H[t].r||[],r.H[t].L=r.H[t].L||[],r.H[t].r=[...r.H[t].L],r.CP)for(let s=0;s<r.CP.length;s++)r.CP[s]=null}}function nVe(r){return new Promise((t,s)=>{var a,l,d;function f(){fY(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{fY(),s(Wh(r,"network-request-failed"))},timeout:tVe.get()})}if(!((l=(a=zh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=zh().gapi)===null||d===void 0)&&d.load)f();else{const E=G2e("iframefcb");return zh()[E]=()=>{gapi.load?f():s(Wh(r,"network-request-failed"))},ane(`${z2e()}?onload=${E}`).catch(v=>s(v))}}).catch(t=>{throw xO=null,t})}let xO=null;function rVe(r){return xO=xO||nVe(r),xO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iVe=new UR(5e3,15e3),sVe="__/auth/iframe",oVe="emulator/auth/iframe",aVe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},cVe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function lVe(r){const t=r.config;Ln(t.authDomain,r,"auth-domain-config-required");const s=t.emulator?HF(t,oVe):`https://${r.config.authDomain}/${sVe}`,a={apiKey:t.apiKey,appName:r.name,v:AE},l=cVe.get(r.config.apiHost);l&&(a.eid=l);const d=r._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${MR(a).slice(1)}`}async function uVe(r){const t=await rVe(r),s=zh().gapi;return Ln(s,r,"internal-error"),t.open({where:document.body,url:lVe(r),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:aVe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=Wh(r,"network-request-failed"),E=zh().setTimeout(()=>{d(f)},iVe.get());function v(){zh().clearTimeout(E),l(a)}a.ping(v).then(v,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dVe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},hVe=500,pVe=600,fVe="_blank",mVe="http://localhost";class mY{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function gVe(r,t,s,a=hVe,l=pVe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const v=Object.assign(Object.assign({},dVe),{width:a.toString(),height:l.toString(),top:d,left:f}),T=Oa().toLowerCase();s&&(E=ene(T)?fVe:s),Qte(T)&&(t=t||mVe,v.scrollbars="yes");const w=Object.entries(v).reduce((N,[F,j])=>`${N}${F}=${j},`,"");if(L2e(T)&&E!=="_self")return _Ve(t||"",E),new mY(null);const I=window.open(t||"",E,w);Ln(I,r,"popup-blocked");try{I.focus()}catch{}return new mY(I)}function _Ve(r,t){const s=document.createElement("a");s.href=r,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EVe="__/auth/handler",yVe="emulator/auth/handler",vVe=encodeURIComponent("fac");async function gY(r,t,s,a,l,d){Ln(r.config.authDomain,r,"auth-domain-config-required"),Ln(r.config.apiKey,r,"invalid-api-key");const f={apiKey:r.config.apiKey,appName:r.name,authType:s,redirectUrl:a,v:AE,eventId:l};if(t instanceof une){t.setDefaultLanguage(r.languageCode),f.providerId=t.providerId||"",rMe(t.getCustomParameters())||(f.customParameters=JSON.stringify(t.getCustomParameters()));for(const[w,I]of Object.entries({}))f[w]=I}if(t instanceof FR){const w=t.getScopes().filter(I=>I!=="");w.length>0&&(f.scopes=w.join(","))}r.tenantId&&(f.tid=r.tenantId);const E=f;for(const w of Object.keys(E))E[w]===void 0&&delete E[w];const v=await r._getAppCheckToken(),T=v?`#${vVe}=${encodeURIComponent(v)}`:"";return`${SVe(r)}?${MR(E).slice(1)}${T}`}function SVe({config:r}){return r.emulator?HF(r,yVe):`https://${r.authDomain}/${EVe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p2="webStorageSupport";class TVe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_ne,this._completeRedirectFn=$Ue,this._overrideRedirectResult=zUe}async _openPopup(t,s,a,l){var d;bf((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await gY(t,s,a,kU(),l);return gVe(t,f,XF())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await gY(t,s,a,kU(),l);return RUe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(bf(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await uVe(t),a=new qUe(t);return s.register("authEvent",l=>(Ln(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(p2,{type:p2},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[p2];f!==void 0&&s(!!f),bd(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=ZUe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return sne()||Zte()||KF()}}const bVe=TVe;var _Y="@firebase/auth",EY="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wVe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Ln(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RVe(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function CVe(r){SE(new dg("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:f,authDomain:E}=a.options;Ln(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:f,authDomain:E,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:one(r)},T=new j2e(a,l,d,v);return X2e(T,s),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),SE(new dg("auth-internal",t=>{const s=PE(t.getProvider("auth").getImmediate());return(a=>new wVe(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bh(_Y,EY,RVe(r)),Bh(_Y,EY,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IVe=5*60,AVe=Mte("authIdTokenMaxAge")||IVe;let yY=null;const PVe=r=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>AVe)return;const l=s==null?void 0:s.token;yY!==l&&(yY=l,await fetch(r,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function wne(r=zF()){const t=aN(r,"auth");if(t.isInitialized())return t.getImmediate();const s=Y2e(r,{popupRedirectResolver:bVe,persistence:[LUe,TUe,_ne]}),a=Mte("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=PVe(d.toString());_Ue(s,f,()=>f(s.currentUser)),gUe(s,E=>f(E))}}const l=Dte("auth");return l&&J2e(s,`http://${l}`),s}function OVe(){var r,t;return(t=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&t!==void 0?t:document}B2e({loadJS(r){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",r),a.onload=t,a.onerror=l=>{const d=Wh("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",OVe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});CVe("Browser");var vY=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var rg,Rne;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(ee,Z){function ne(){}ne.prototype=Z.prototype,ee.D=Z.prototype,ee.prototype=new ne,ee.prototype.constructor=ee,ee.C=function(ae,me,he){for(var le=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)le[Me-2]=arguments[Me];return Z.prototype[me].apply(ae,le)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(ee,Z,ne){ne||(ne=0);var ae=Array(16);if(typeof Z=="string")for(var me=0;16>me;++me)ae[me]=Z.charCodeAt(ne++)|Z.charCodeAt(ne++)<<8|Z.charCodeAt(ne++)<<16|Z.charCodeAt(ne++)<<24;else for(me=0;16>me;++me)ae[me]=Z[ne++]|Z[ne++]<<8|Z[ne++]<<16|Z[ne++]<<24;Z=ee.g[0],ne=ee.g[1],me=ee.g[2];var he=ee.g[3],le=Z+(he^ne&(me^he))+ae[0]+3614090360&4294967295;Z=ne+(le<<7&4294967295|le>>>25),le=he+(me^Z&(ne^me))+ae[1]+3905402710&4294967295,he=Z+(le<<12&4294967295|le>>>20),le=me+(ne^he&(Z^ne))+ae[2]+606105819&4294967295,me=he+(le<<17&4294967295|le>>>15),le=ne+(Z^me&(he^Z))+ae[3]+3250441966&4294967295,ne=me+(le<<22&4294967295|le>>>10),le=Z+(he^ne&(me^he))+ae[4]+4118548399&4294967295,Z=ne+(le<<7&4294967295|le>>>25),le=he+(me^Z&(ne^me))+ae[5]+1200080426&4294967295,he=Z+(le<<12&4294967295|le>>>20),le=me+(ne^he&(Z^ne))+ae[6]+2821735955&4294967295,me=he+(le<<17&4294967295|le>>>15),le=ne+(Z^me&(he^Z))+ae[7]+4249261313&4294967295,ne=me+(le<<22&4294967295|le>>>10),le=Z+(he^ne&(me^he))+ae[8]+1770035416&4294967295,Z=ne+(le<<7&4294967295|le>>>25),le=he+(me^Z&(ne^me))+ae[9]+2336552879&4294967295,he=Z+(le<<12&4294967295|le>>>20),le=me+(ne^he&(Z^ne))+ae[10]+4294925233&4294967295,me=he+(le<<17&4294967295|le>>>15),le=ne+(Z^me&(he^Z))+ae[11]+2304563134&4294967295,ne=me+(le<<22&4294967295|le>>>10),le=Z+(he^ne&(me^he))+ae[12]+1804603682&4294967295,Z=ne+(le<<7&4294967295|le>>>25),le=he+(me^Z&(ne^me))+ae[13]+4254626195&4294967295,he=Z+(le<<12&4294967295|le>>>20),le=me+(ne^he&(Z^ne))+ae[14]+2792965006&4294967295,me=he+(le<<17&4294967295|le>>>15),le=ne+(Z^me&(he^Z))+ae[15]+1236535329&4294967295,ne=me+(le<<22&4294967295|le>>>10),le=Z+(me^he&(ne^me))+ae[1]+4129170786&4294967295,Z=ne+(le<<5&4294967295|le>>>27),le=he+(ne^me&(Z^ne))+ae[6]+3225465664&4294967295,he=Z+(le<<9&4294967295|le>>>23),le=me+(Z^ne&(he^Z))+ae[11]+643717713&4294967295,me=he+(le<<14&4294967295|le>>>18),le=ne+(he^Z&(me^he))+ae[0]+3921069994&4294967295,ne=me+(le<<20&4294967295|le>>>12),le=Z+(me^he&(ne^me))+ae[5]+3593408605&4294967295,Z=ne+(le<<5&4294967295|le>>>27),le=he+(ne^me&(Z^ne))+ae[10]+38016083&4294967295,he=Z+(le<<9&4294967295|le>>>23),le=me+(Z^ne&(he^Z))+ae[15]+3634488961&4294967295,me=he+(le<<14&4294967295|le>>>18),le=ne+(he^Z&(me^he))+ae[4]+3889429448&4294967295,ne=me+(le<<20&4294967295|le>>>12),le=Z+(me^he&(ne^me))+ae[9]+568446438&4294967295,Z=ne+(le<<5&4294967295|le>>>27),le=he+(ne^me&(Z^ne))+ae[14]+3275163606&4294967295,he=Z+(le<<9&4294967295|le>>>23),le=me+(Z^ne&(he^Z))+ae[3]+4107603335&4294967295,me=he+(le<<14&4294967295|le>>>18),le=ne+(he^Z&(me^he))+ae[8]+1163531501&4294967295,ne=me+(le<<20&4294967295|le>>>12),le=Z+(me^he&(ne^me))+ae[13]+2850285829&4294967295,Z=ne+(le<<5&4294967295|le>>>27),le=he+(ne^me&(Z^ne))+ae[2]+4243563512&4294967295,he=Z+(le<<9&4294967295|le>>>23),le=me+(Z^ne&(he^Z))+ae[7]+1735328473&4294967295,me=he+(le<<14&4294967295|le>>>18),le=ne+(he^Z&(me^he))+ae[12]+2368359562&4294967295,ne=me+(le<<20&4294967295|le>>>12),le=Z+(ne^me^he)+ae[5]+4294588738&4294967295,Z=ne+(le<<4&4294967295|le>>>28),le=he+(Z^ne^me)+ae[8]+2272392833&4294967295,he=Z+(le<<11&4294967295|le>>>21),le=me+(he^Z^ne)+ae[11]+1839030562&4294967295,me=he+(le<<16&4294967295|le>>>16),le=ne+(me^he^Z)+ae[14]+4259657740&4294967295,ne=me+(le<<23&4294967295|le>>>9),le=Z+(ne^me^he)+ae[1]+2763975236&4294967295,Z=ne+(le<<4&4294967295|le>>>28),le=he+(Z^ne^me)+ae[4]+1272893353&4294967295,he=Z+(le<<11&4294967295|le>>>21),le=me+(he^Z^ne)+ae[7]+4139469664&4294967295,me=he+(le<<16&4294967295|le>>>16),le=ne+(me^he^Z)+ae[10]+3200236656&4294967295,ne=me+(le<<23&4294967295|le>>>9),le=Z+(ne^me^he)+ae[13]+681279174&4294967295,Z=ne+(le<<4&4294967295|le>>>28),le=he+(Z^ne^me)+ae[0]+3936430074&4294967295,he=Z+(le<<11&4294967295|le>>>21),le=me+(he^Z^ne)+ae[3]+3572445317&4294967295,me=he+(le<<16&4294967295|le>>>16),le=ne+(me^he^Z)+ae[6]+76029189&4294967295,ne=me+(le<<23&4294967295|le>>>9),le=Z+(ne^me^he)+ae[9]+3654602809&4294967295,Z=ne+(le<<4&4294967295|le>>>28),le=he+(Z^ne^me)+ae[12]+3873151461&4294967295,he=Z+(le<<11&4294967295|le>>>21),le=me+(he^Z^ne)+ae[15]+530742520&4294967295,me=he+(le<<16&4294967295|le>>>16),le=ne+(me^he^Z)+ae[2]+3299628645&4294967295,ne=me+(le<<23&4294967295|le>>>9),le=Z+(me^(ne|~he))+ae[0]+4096336452&4294967295,Z=ne+(le<<6&4294967295|le>>>26),le=he+(ne^(Z|~me))+ae[7]+1126891415&4294967295,he=Z+(le<<10&4294967295|le>>>22),le=me+(Z^(he|~ne))+ae[14]+2878612391&4294967295,me=he+(le<<15&4294967295|le>>>17),le=ne+(he^(me|~Z))+ae[5]+4237533241&4294967295,ne=me+(le<<21&4294967295|le>>>11),le=Z+(me^(ne|~he))+ae[12]+1700485571&4294967295,Z=ne+(le<<6&4294967295|le>>>26),le=he+(ne^(Z|~me))+ae[3]+2399980690&4294967295,he=Z+(le<<10&4294967295|le>>>22),le=me+(Z^(he|~ne))+ae[10]+4293915773&4294967295,me=he+(le<<15&4294967295|le>>>17),le=ne+(he^(me|~Z))+ae[1]+2240044497&4294967295,ne=me+(le<<21&4294967295|le>>>11),le=Z+(me^(ne|~he))+ae[8]+1873313359&4294967295,Z=ne+(le<<6&4294967295|le>>>26),le=he+(ne^(Z|~me))+ae[15]+4264355552&4294967295,he=Z+(le<<10&4294967295|le>>>22),le=me+(Z^(he|~ne))+ae[6]+2734768916&4294967295,me=he+(le<<15&4294967295|le>>>17),le=ne+(he^(me|~Z))+ae[13]+1309151649&4294967295,ne=me+(le<<21&4294967295|le>>>11),le=Z+(me^(ne|~he))+ae[4]+4149444226&4294967295,Z=ne+(le<<6&4294967295|le>>>26),le=he+(ne^(Z|~me))+ae[11]+3174756917&4294967295,he=Z+(le<<10&4294967295|le>>>22),le=me+(Z^(he|~ne))+ae[2]+718787259&4294967295,me=he+(le<<15&4294967295|le>>>17),le=ne+(he^(me|~Z))+ae[9]+3951481745&4294967295,ee.g[0]=ee.g[0]+Z&4294967295,ee.g[1]=ee.g[1]+(me+(le<<21&4294967295|le>>>11))&4294967295,ee.g[2]=ee.g[2]+me&4294967295,ee.g[3]=ee.g[3]+he&4294967295}a.prototype.u=function(ee,Z){Z===void 0&&(Z=ee.length);for(var ne=Z-this.blockSize,ae=this.B,me=this.h,he=0;he<Z;){if(me==0)for(;he<=ne;)l(this,ee,he),he+=this.blockSize;if(typeof ee=="string"){for(;he<Z;)if(ae[me++]=ee.charCodeAt(he++),me==this.blockSize){l(this,ae),me=0;break}}else for(;he<Z;)if(ae[me++]=ee[he++],me==this.blockSize){l(this,ae),me=0;break}}this.h=me,this.o+=Z},a.prototype.v=function(){var ee=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ee[0]=128;for(var Z=1;Z<ee.length-8;++Z)ee[Z]=0;var ne=8*this.o;for(Z=ee.length-8;Z<ee.length;++Z)ee[Z]=ne&255,ne/=256;for(this.u(ee),ee=Array(16),Z=ne=0;4>Z;++Z)for(var ae=0;32>ae;ae+=8)ee[ne++]=this.g[Z]>>>ae&255;return ee};function d(ee,Z){var ne=E;return Object.prototype.hasOwnProperty.call(ne,ee)?ne[ee]:ne[ee]=Z(ee)}function f(ee,Z){this.h=Z;for(var ne=[],ae=!0,me=ee.length-1;0<=me;me--){var he=ee[me]|0;ae&&he==Z||(ne[me]=he,ae=!1)}this.g=ne}var E={};function v(ee){return-128<=ee&&128>ee?d(ee,function(Z){return new f([Z|0],0>Z?-1:0)}):new f([ee|0],0>ee?-1:0)}function T(ee){if(isNaN(ee)||!isFinite(ee))return I;if(0>ee)return H(T(-ee));for(var Z=[],ne=1,ae=0;ee>=ne;ae++)Z[ae]=ee/ne|0,ne*=4294967296;return new f(Z,0)}function w(ee,Z){if(ee.length==0)throw Error("number format error: empty string");if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(ee.charAt(0)=="-")return H(w(ee.substring(1),Z));if(0<=ee.indexOf("-"))throw Error('number format error: interior "-" character');for(var ne=T(Math.pow(Z,8)),ae=I,me=0;me<ee.length;me+=8){var he=Math.min(8,ee.length-me),le=parseInt(ee.substring(me,me+he),Z);8>he?(he=T(Math.pow(Z,he)),ae=ae.j(he).add(T(le))):(ae=ae.j(ne),ae=ae.add(T(le)))}return ae}var I=v(0),N=v(1),F=v(16777216);r=f.prototype,r.m=function(){if(G(this))return-H(this).m();for(var ee=0,Z=1,ne=0;ne<this.g.length;ne++){var ae=this.i(ne);ee+=(0<=ae?ae:4294967296+ae)*Z,Z*=4294967296}return ee},r.toString=function(ee){if(ee=ee||10,2>ee||36<ee)throw Error("radix out of range: "+ee);if(j(this))return"0";if(G(this))return"-"+H(this).toString(ee);for(var Z=T(Math.pow(ee,6)),ne=this,ae="";;){var me=de(ne,Z).g;ne=te(ne,me.j(Z));var he=((0<ne.g.length?ne.g[0]:ne.h)>>>0).toString(ee);if(ne=me,j(ne))return he+ae;for(;6>he.length;)he="0"+he;ae=he+ae}},r.i=function(ee){return 0>ee?0:ee<this.g.length?this.g[ee]:this.h};function j(ee){if(ee.h!=0)return!1;for(var Z=0;Z<ee.g.length;Z++)if(ee.g[Z]!=0)return!1;return!0}function G(ee){return ee.h==-1}r.l=function(ee){return ee=te(this,ee),G(ee)?-1:j(ee)?0:1};function H(ee){for(var Z=ee.g.length,ne=[],ae=0;ae<Z;ae++)ne[ae]=~ee.g[ae];return new f(ne,~ee.h).add(N)}r.abs=function(){return G(this)?H(this):this},r.add=function(ee){for(var Z=Math.max(this.g.length,ee.g.length),ne=[],ae=0,me=0;me<=Z;me++){var he=ae+(this.i(me)&65535)+(ee.i(me)&65535),le=(he>>>16)+(this.i(me)>>>16)+(ee.i(me)>>>16);ae=le>>>16,he&=65535,le&=65535,ne[me]=le<<16|he}return new f(ne,ne[ne.length-1]&-2147483648?-1:0)};function te(ee,Z){return ee.add(H(Z))}r.j=function(ee){if(j(this)||j(ee))return I;if(G(this))return G(ee)?H(this).j(H(ee)):H(H(this).j(ee));if(G(ee))return H(this.j(H(ee)));if(0>this.l(F)&&0>ee.l(F))return T(this.m()*ee.m());for(var Z=this.g.length+ee.g.length,ne=[],ae=0;ae<2*Z;ae++)ne[ae]=0;for(ae=0;ae<this.g.length;ae++)for(var me=0;me<ee.g.length;me++){var he=this.i(ae)>>>16,le=this.i(ae)&65535,Me=ee.i(me)>>>16,Ge=ee.i(me)&65535;ne[2*ae+2*me]+=le*Ge,K(ne,2*ae+2*me),ne[2*ae+2*me+1]+=he*Ge,K(ne,2*ae+2*me+1),ne[2*ae+2*me+1]+=le*Me,K(ne,2*ae+2*me+1),ne[2*ae+2*me+2]+=he*Me,K(ne,2*ae+2*me+2)}for(ae=0;ae<Z;ae++)ne[ae]=ne[2*ae+1]<<16|ne[2*ae];for(ae=Z;ae<2*Z;ae++)ne[ae]=0;return new f(ne,0)};function K(ee,Z){for(;(ee[Z]&65535)!=ee[Z];)ee[Z+1]+=ee[Z]>>>16,ee[Z]&=65535,Z++}function Q(ee,Z){this.g=ee,this.h=Z}function de(ee,Z){if(j(Z))throw Error("division by zero");if(j(ee))return new Q(I,I);if(G(ee))return Z=de(H(ee),Z),new Q(H(Z.g),H(Z.h));if(G(Z))return Z=de(ee,H(Z)),new Q(H(Z.g),Z.h);if(30<ee.g.length){if(G(ee)||G(Z))throw Error("slowDivide_ only works with positive integers.");for(var ne=N,ae=Z;0>=ae.l(ee);)ne=se(ne),ae=se(ae);var me=ge(ne,1),he=ge(ae,1);for(ae=ge(ae,2),ne=ge(ne,2);!j(ae);){var le=he.add(ae);0>=le.l(ee)&&(me=me.add(ne),he=le),ae=ge(ae,1),ne=ge(ne,1)}return Z=te(ee,me.j(Z)),new Q(me,Z)}for(me=I;0<=ee.l(Z);){for(ne=Math.max(1,Math.floor(ee.m()/Z.m())),ae=Math.ceil(Math.log(ne)/Math.LN2),ae=48>=ae?1:Math.pow(2,ae-48),he=T(ne),le=he.j(Z);G(le)||0<le.l(ee);)ne-=ae,he=T(ne),le=he.j(Z);j(he)&&(he=N),me=me.add(he),ee=te(ee,le)}return new Q(me,ee)}r.A=function(ee){return de(this,ee).h},r.and=function(ee){for(var Z=Math.max(this.g.length,ee.g.length),ne=[],ae=0;ae<Z;ae++)ne[ae]=this.i(ae)&ee.i(ae);return new f(ne,this.h&ee.h)},r.or=function(ee){for(var Z=Math.max(this.g.length,ee.g.length),ne=[],ae=0;ae<Z;ae++)ne[ae]=this.i(ae)|ee.i(ae);return new f(ne,this.h|ee.h)},r.xor=function(ee){for(var Z=Math.max(this.g.length,ee.g.length),ne=[],ae=0;ae<Z;ae++)ne[ae]=this.i(ae)^ee.i(ae);return new f(ne,this.h^ee.h)};function se(ee){for(var Z=ee.g.length+1,ne=[],ae=0;ae<Z;ae++)ne[ae]=ee.i(ae)<<1|ee.i(ae-1)>>>31;return new f(ne,ee.h)}function ge(ee,Z){var ne=Z>>5;Z%=32;for(var ae=ee.g.length-ne,me=[],he=0;he<ae;he++)me[he]=0<Z?ee.i(he+ne)>>>Z|ee.i(he+ne+1)<<32-Z:ee.i(he+ne);return new f(me,ee.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Rne=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=T,f.fromString=w,rg=f}).apply(typeof vY<"u"?vY:typeof self<"u"?self:typeof window<"u"?window:{});var nO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Cne,_w,Ine,MO,xU,Ane,Pne,One;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(C,B,J){return C==Array.prototype||C==Object.prototype||(C[B]=J.value),C};function s(C){C=[typeof globalThis=="object"&&globalThis,C,typeof window=="object"&&window,typeof self=="object"&&self,typeof nO=="object"&&nO];for(var B=0;B<C.length;++B){var J=C[B];if(J&&J.Math==Math)return J}throw Error("Cannot find global object")}var a=s(this);function l(C,B){if(B)e:{var J=a;C=C.split(".");for(var pe=0;pe<C.length-1;pe++){var Ke=C[pe];if(!(Ke in J))break e;J=J[Ke]}C=C[C.length-1],pe=J[C],B=B(pe),B!=pe&&B!=null&&t(J,C,{configurable:!0,writable:!0,value:B})}}function d(C,B){C instanceof String&&(C+="");var J=0,pe=!1,Ke={next:function(){if(!pe&&J<C.length){var ot=J++;return{value:B(ot,C[ot]),done:!1}}return pe=!0,{done:!0,value:void 0}}};return Ke[Symbol.iterator]=function(){return Ke},Ke}l("Array.prototype.values",function(C){return C||function(){return d(this,function(B,J){return J})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},E=this||self;function v(C){var B=typeof C;return B=B!="object"?B:C?Array.isArray(C)?"array":B:"null",B=="array"||B=="object"&&typeof C.length=="number"}function T(C){var B=typeof C;return B=="object"&&C!=null||B=="function"}function w(C,B,J){return C.call.apply(C.bind,arguments)}function I(C,B,J){if(!C)throw Error();if(2<arguments.length){var pe=Array.prototype.slice.call(arguments,2);return function(){var Ke=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ke,pe),C.apply(B,Ke)}}return function(){return C.apply(B,arguments)}}function N(C,B,J){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:I,N.apply(null,arguments)}function F(C,B){var J=Array.prototype.slice.call(arguments,1);return function(){var pe=J.slice();return pe.push.apply(pe,arguments),C.apply(this,pe)}}function j(C,B){function J(){}J.prototype=B.prototype,C.aa=B.prototype,C.prototype=new J,C.prototype.constructor=C,C.Qb=function(pe,Ke,ot){for(var xt=Array(arguments.length-2),zr=2;zr<arguments.length;zr++)xt[zr-2]=arguments[zr];return B.prototype[Ke].apply(pe,xt)}}function G(C){const B=C.length;if(0<B){const J=Array(B);for(let pe=0;pe<B;pe++)J[pe]=C[pe];return J}return[]}function H(C,B){for(let J=1;J<arguments.length;J++){const pe=arguments[J];if(v(pe)){const Ke=C.length||0,ot=pe.length||0;C.length=Ke+ot;for(let xt=0;xt<ot;xt++)C[Ke+xt]=pe[xt]}else C.push(pe)}}class te{constructor(B,J){this.i=B,this.j=J,this.h=0,this.g=null}get(){let B;return 0<this.h?(this.h--,B=this.g,this.g=B.next,B.next=null):B=this.i(),B}}function K(C){return/^[\s\xa0]*$/.test(C)}function Q(){var C=E.navigator;return C&&(C=C.userAgent)?C:""}function de(C){return de[" "](C),C}de[" "]=function(){};var se=Q().indexOf("Gecko")!=-1&&!(Q().toLowerCase().indexOf("webkit")!=-1&&Q().indexOf("Edge")==-1)&&!(Q().indexOf("Trident")!=-1||Q().indexOf("MSIE")!=-1)&&Q().indexOf("Edge")==-1;function ge(C,B,J){for(const pe in C)B.call(J,C[pe],pe,C)}function ee(C,B){for(const J in C)B.call(void 0,C[J],J,C)}function Z(C){const B={};for(const J in C)B[J]=C[J];return B}const ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(C,B){let J,pe;for(let Ke=1;Ke<arguments.length;Ke++){pe=arguments[Ke];for(J in pe)C[J]=pe[J];for(let ot=0;ot<ne.length;ot++)J=ne[ot],Object.prototype.hasOwnProperty.call(pe,J)&&(C[J]=pe[J])}}function me(C){var B=1;C=C.split(":");const J=[];for(;0<B&&C.length;)J.push(C.shift()),B--;return C.length&&J.push(C.join(":")),J}function he(C){E.setTimeout(()=>{throw C},0)}function le(){var C=ve;let B=null;return C.g&&(B=C.g,C.g=C.g.next,C.g||(C.h=null),B.next=null),B}class Me{constructor(){this.h=this.g=null}add(B,J){const pe=Ge.get();pe.set(B,J),this.h?this.h.next=pe:this.g=pe,this.h=pe}}var Ge=new te(()=>new tt,C=>C.reset());class tt{constructor(){this.next=this.g=this.h=null}set(B,J){this.h=B,this.g=J,this.next=null}reset(){this.next=this.g=this.h=null}}let Ee,we=!1,ve=new Me,Be=()=>{const C=E.Promise.resolve(void 0);Ee=()=>{C.then(Oe)}};var Oe=()=>{for(var C;C=le();){try{C.h.call(C.g)}catch(J){he(J)}var B=Ge;B.j(C),100>B.h&&(B.h++,C.next=B.g,B.g=C)}we=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ce(C,B){this.type=C,this.g=this.target=B,this.defaultPrevented=!1}Ce.prototype.h=function(){this.defaultPrevented=!0};var xe=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var C=!1,B=Object.defineProperty({},"passive",{get:function(){C=!0}});try{const J=()=>{};E.addEventListener("test",J,B),E.removeEventListener("test",J,B)}catch{}return C}();function ze(C,B){if(Ce.call(this,C?C.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,C){var J=this.type=C.type,pe=C.changedTouches&&C.changedTouches.length?C.changedTouches[0]:null;if(this.target=C.target||C.srcElement,this.g=B,B=C.relatedTarget){if(se){e:{try{de(B.nodeName);var Ke=!0;break e}catch{}Ke=!1}Ke||(B=null)}}else J=="mouseover"?B=C.fromElement:J=="mouseout"&&(B=C.toElement);this.relatedTarget=B,pe?(this.clientX=pe.clientX!==void 0?pe.clientX:pe.pageX,this.clientY=pe.clientY!==void 0?pe.clientY:pe.pageY,this.screenX=pe.screenX||0,this.screenY=pe.screenY||0):(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0),this.button=C.button,this.key=C.key||"",this.ctrlKey=C.ctrlKey,this.altKey=C.altKey,this.shiftKey=C.shiftKey,this.metaKey=C.metaKey,this.pointerId=C.pointerId||0,this.pointerType=typeof C.pointerType=="string"?C.pointerType:Qe[C.pointerType]||"",this.state=C.state,this.i=C,C.defaultPrevented&&ze.aa.h.call(this)}}j(ze,Ce);var Qe={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var C=this.i;C.preventDefault?C.preventDefault():C.returnValue=!1};var et="closure_listenable_"+(1e6*Math.random()|0),ut=0;function it(C,B,J,pe,Ke){this.listener=C,this.proxy=null,this.src=B,this.type=J,this.capture=!!pe,this.ha=Ke,this.key=++ut,this.da=this.fa=!1}function Ct(C){C.da=!0,C.listener=null,C.proxy=null,C.src=null,C.ha=null}function _n(C){this.src=C,this.g={},this.h=0}_n.prototype.add=function(C,B,J,pe,Ke){var ot=C.toString();C=this.g[ot],C||(C=this.g[ot]=[],this.h++);var xt=ln(C,B,pe,Ke);return-1<xt?(B=C[xt],J||(B.fa=!1)):(B=new it(B,this.src,ot,!!pe,Ke),B.fa=J,C.push(B)),B};function Vt(C,B){var J=B.type;if(J in C.g){var pe=C.g[J],Ke=Array.prototype.indexOf.call(pe,B,void 0),ot;(ot=0<=Ke)&&Array.prototype.splice.call(pe,Ke,1),ot&&(Ct(B),C.g[J].length==0&&(delete C.g[J],C.h--))}}function ln(C,B,J,pe){for(var Ke=0;Ke<C.length;++Ke){var ot=C[Ke];if(!ot.da&&ot.listener==B&&ot.capture==!!J&&ot.ha==pe)return Ke}return-1}var xn="closure_lm_"+(1e6*Math.random()|0),Xt={};function Pt(C,B,J,pe,Ke){if(Array.isArray(B)){for(var ot=0;ot<B.length;ot++)Pt(C,B[ot],J,pe,Ke);return null}return J=dn(J),C&&C[et]?C.K(B,J,T(pe)?!!pe.capture:!1,Ke):Dt(C,B,J,!1,pe,Ke)}function Dt(C,B,J,pe,Ke,ot){if(!B)throw Error("Invalid event type");var xt=T(Ke)?!!Ke.capture:!!Ke,zr=yt(C);if(zr||(C[xn]=zr=new _n(C)),J=zr.add(B,J,pe,xt,ot),J.proxy)return J;if(pe=Te(),J.proxy=pe,pe.src=C,pe.listener=J,C.addEventListener)xe||(Ke=xt),Ke===void 0&&(Ke=!1),C.addEventListener(B.toString(),pe,Ke);else if(C.attachEvent)C.attachEvent(mt(B.toString()),pe);else if(C.addListener&&C.removeListener)C.addListener(pe);else throw Error("addEventListener and attachEvent are unavailable.");return J}function Te(){function C(J){return B.call(C.src,C.listener,J)}const B=Et;return C}function Ue(C,B,J,pe,Ke){if(Array.isArray(B))for(var ot=0;ot<B.length;ot++)Ue(C,B[ot],J,pe,Ke);else pe=T(pe)?!!pe.capture:!!pe,J=dn(J),C&&C[et]?(C=C.i,B=String(B).toString(),B in C.g&&(ot=C.g[B],J=ln(ot,J,pe,Ke),-1<J&&(Ct(ot[J]),Array.prototype.splice.call(ot,J,1),ot.length==0&&(delete C.g[B],C.h--)))):C&&(C=yt(C))&&(B=C.g[B.toString()],C=-1,B&&(C=ln(B,J,pe,Ke)),(J=-1<C?B[C]:null)&&$e(J))}function $e(C){if(typeof C!="number"&&C&&!C.da){var B=C.src;if(B&&B[et])Vt(B.i,C);else{var J=C.type,pe=C.proxy;B.removeEventListener?B.removeEventListener(J,pe,C.capture):B.detachEvent?B.detachEvent(mt(J),pe):B.addListener&&B.removeListener&&B.removeListener(pe),(J=yt(B))?(Vt(J,C),J.h==0&&(J.src=null,B[xn]=null)):Ct(C)}}}function mt(C){return C in Xt?Xt[C]:Xt[C]="on"+C}function Et(C,B){if(C.da)C=!0;else{B=new ze(B,this);var J=C.listener,pe=C.ha||C.src;C.fa&&$e(C),C=J.call(pe,B)}return C}function yt(C){return C=C[xn],C instanceof _n?C:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function dn(C){return typeof C=="function"?C:(C[zt]||(C[zt]=function(B){return C.handleEvent(B)}),C[zt])}function hn(){be.call(this),this.i=new _n(this),this.M=this,this.F=null}j(hn,be),hn.prototype[et]=!0,hn.prototype.removeEventListener=function(C,B,J,pe){Ue(this,C,B,J,pe)};function Yt(C,B){var J,pe=C.F;if(pe)for(J=[];pe;pe=pe.F)J.push(pe);if(C=C.M,pe=B.type||B,typeof B=="string")B=new Ce(B,C);else if(B instanceof Ce)B.target=B.target||C;else{var Ke=B;B=new Ce(pe,C),ae(B,Ke)}if(Ke=!0,J)for(var ot=J.length-1;0<=ot;ot--){var xt=B.g=J[ot];Ke=Bn(xt,pe,!0,B)&&Ke}if(xt=B.g=C,Ke=Bn(xt,pe,!0,B)&&Ke,Ke=Bn(xt,pe,!1,B)&&Ke,J)for(ot=0;ot<J.length;ot++)xt=B.g=J[ot],Ke=Bn(xt,pe,!1,B)&&Ke}hn.prototype.N=function(){if(hn.aa.N.call(this),this.i){var C=this.i,B;for(B in C.g){for(var J=C.g[B],pe=0;pe<J.length;pe++)Ct(J[pe]);delete C.g[B],C.h--}}this.F=null},hn.prototype.K=function(C,B,J,pe){return this.i.add(String(C),B,!1,J,pe)},hn.prototype.L=function(C,B,J,pe){return this.i.add(String(C),B,!0,J,pe)};function Bn(C,B,J,pe){if(B=C.i.g[String(B)],!B)return!0;B=B.concat();for(var Ke=!0,ot=0;ot<B.length;++ot){var xt=B[ot];if(xt&&!xt.da&&xt.capture==J){var zr=xt.listener,ri=xt.ha||xt.src;xt.fa&&Vt(C.i,xt),Ke=zr.call(ri,pe)!==!1&&Ke}}return Ke&&!pe.defaultPrevented}function ec(C,B,J){if(typeof C=="function")J&&(C=N(C,J));else if(C&&typeof C.handleEvent=="function")C=N(C.handleEvent,C);else throw Error("Invalid listener argument");return 2147483647<Number(B)?-1:E.setTimeout(C,B||0)}function jt(C){C.g=ec(()=>{C.g=null,C.i&&(C.i=!1,jt(C))},C.l);const B=C.h;C.h=null,C.m.apply(null,B)}class an extends be{constructor(B,J){super(),this.m=B,this.l=J,this.h=null,this.i=!1,this.g=null}j(B){this.h=arguments,this.g?this.i=!0:jt(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qi(C){be.call(this),this.h=C,this.g={}}j(qi,be);var Ns=[];function Gs(C){ge(C.g,function(B,J){this.g.hasOwnProperty(J)&&$e(B)},C),C.g={}}qi.prototype.N=function(){qi.aa.N.call(this),Gs(this)},qi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ui=E.JSON.stringify,Na=E.JSON.parse,Jc=class{stringify(C){return E.JSON.stringify(C,void 0)}parse(C){return E.JSON.parse(C,void 0)}};function so(){}so.prototype.h=null;function oo(C){return C.h||(C.h=C.i())}function kl(){}var Ds={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function tc(){Ce.call(this,"d")}j(tc,Ce);function ea(){Ce.call(this,"c")}j(ea,Ce);var nc={},Qc=null;function Ru(){return Qc=Qc||new hn}nc.La="serverreachability";function rc(C){Ce.call(this,nc.La,C)}j(rc,Ce);function Zc(C){const B=Ru();Yt(B,new rc(B))}nc.STAT_EVENT="statevent";function bo(C,B){Ce.call(this,nc.STAT_EVENT,C),this.stat=B}j(bo,Ce);function Ci(C){const B=Ru();Yt(B,new bo(B,C))}nc.Ma="timingevent";function rs(C,B){Ce.call(this,nc.Ma,C),this.size=B}j(rs,Ce);function Da(C,B){if(typeof C!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){C()},B)}function Cu(){this.g=!0}Cu.prototype.xa=function(){this.g=!1};function ic(C,B,J,pe,Ke,ot){C.info(function(){if(C.g)if(ot)for(var xt="",zr=ot.split("&"),ri=0;ri<zr.length;ri++){var gr=zr[ri].split("=");if(1<gr.length){var xs=gr[0];gr=gr[1];var ss=xs.split("_");xt=2<=ss.length&&ss[1]=="type"?xt+(xs+"="+gr+"&"):xt+(xs+"=redacted&")}}else xt=null;else xt=ot;return"XMLHTTP REQ ("+pe+") [attempt "+Ke+"]: "+B+`
`+J+`
`+xt})}function ta(C,B,J,pe,Ke,ot,xt){C.info(function(){return"XMLHTTP RESP ("+pe+") [ attempt "+Ke+"]: "+B+`
`+J+`
`+ot+" "+xt})}function na(C,B,J,pe){C.info(function(){return"XMLHTTP TEXT ("+B+"): "+wg(C,J)+(pe?" "+pe:"")})}function Id(C,B){C.info(function(){return"TIMEOUT: "+B})}Cu.prototype.info=function(){};function wg(C,B){if(!C.g)return B;if(!B)return null;try{var J=JSON.parse(B);if(J){for(C=0;C<J.length;C++)if(Array.isArray(J[C])){var pe=J[C];if(!(2>pe.length)){var Ke=pe[1];if(Array.isArray(Ke)&&!(1>Ke.length)){var ot=Ke[0];if(ot!="noop"&&ot!="stop"&&ot!="close")for(var xt=1;xt<Ke.length;xt++)Ke[xt]=""}}}}return ui(J)}catch{return B}}var Iu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},tp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ls;function Au(){}j(Au,so),Au.prototype.g=function(){return new XMLHttpRequest},Au.prototype.i=function(){return{}},Ls=new Au;function ra(C,B,J,pe){this.j=C,this.i=B,this.l=J,this.R=pe||1,this.U=new qi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ad}function Ad(){this.i=null,this.g="",this.h=!1}var Pd={},La={};function Od(C,B,J){C.L=1,C.v=Ma(Ro(B)),C.m=J,C.P=!0,Pu(C,null)}function Pu(C,B){C.F=Date.now(),Vr(C),C.A=Ro(C.v);var J=C.A,pe=C.R;Array.isArray(pe)||(pe=[String(pe)]),Ul(J.i,"t",pe),C.C=0,J=C.j.J,C.h=new Ad,C.g=xE(C.j,J?B:null,!C.m),0<C.O&&(C.M=new an(N(C.Y,C,C.g),C.O)),B=C.U,J=C.g,pe=C.ca;var Ke="readystatechange";Array.isArray(Ke)||(Ke&&(Ns[0]=Ke.toString()),Ke=Ns);for(var ot=0;ot<Ke.length;ot++){var xt=Pt(J,Ke[ot],pe||B.handleEvent,!1,B.h||B);if(!xt)break;B.g[xt.key]=xt}B=C.H?Z(C.H):{},C.m?(C.u||(C.u="POST"),B["Content-Type"]="application/x-www-form-urlencoded",C.g.ea(C.A,C.u,C.m,B)):(C.u="GET",C.g.ea(C.A,C.u,null,B)),Zc(),ic(C.i,C.u,C.A,C.l,C.R,C.m)}ra.prototype.ca=function(C){C=C.target;const B=this.M;B&&hi(C)==3?B.j():this.Y(C)},ra.prototype.Y=function(C){try{if(C==this.g)e:{const ss=hi(this.g);var B=this.g.Ba();const Ua=this.g.Z();if(!(3>ss)&&(ss!=3||this.g&&(this.h.h||this.g.oa()||Ss(this.g)))){this.J||ss!=4||B==7||(B==8||0>=Ua?Zc(3):Zc(2)),sc(this);var J=this.g.Z();this.X=J;t:if(wo(this)){var pe=Ss(this.g);C="";var Ke=pe.length,ot=hi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ia(this),el(this);var xt="";break t}this.h.i=new E.TextDecoder}for(B=0;B<Ke;B++)this.h.h=!0,C+=this.h.i.decode(pe[B],{stream:!(ot&&B==Ke-1)});pe.length=0,this.h.g+=C,this.C=0,xt=this.h.g}else xt=this.g.oa();if(this.o=J==200,ta(this.i,this.u,this.A,this.l,this.R,ss,J),this.o){if(this.T&&!this.K){t:{if(this.g){var zr,ri=this.g;if((zr=ri.g?ri.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(zr)){var gr=zr;break t}}gr=null}if(J=gr)na(this.i,this.l,J,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,np(this,J);else{this.o=!1,this.s=3,Ci(12),ia(this),el(this);break e}}if(this.P){J=!0;let xo;for(;!this.J&&this.C<xt.length;)if(xo=kd(this,xt),xo==La){ss==4&&(this.s=4,Ci(14),J=!1),na(this.i,this.l,null,"[Incomplete Response]");break}else if(xo==Pd){this.s=4,Ci(15),na(this.i,this.l,xt,"[Invalid Chunk]"),J=!1;break}else na(this.i,this.l,xo,null),np(this,xo);if(wo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ss!=4||xt.length!=0||this.h.h||(this.s=1,Ci(16),J=!1),this.o=this.o&&J,!J)na(this.i,this.l,xt,"[Invalid Chunked Response]"),ia(this),el(this);else if(0<xt.length&&!this.W){this.W=!0;var xs=this.j;xs.g==this&&xs.ba&&!xs.M&&(xs.j.info("Great, no buffering proxy detected. Bytes received: "+xt.length),Cg(xs),xs.M=!0,Ci(11))}}else na(this.i,this.l,xt,null),np(this,xt);ss==4&&ia(this),this.o&&!this.J&&(ss==4?jf(this.j,this):(this.o=!1,Vr(this)))}else ko(this.g),J==400&&0<xt.indexOf("Unknown SID")?(this.s=3,Ci(12)):(this.s=0,Ci(13)),ia(this),el(this)}}}catch{}finally{}};function wo(C){return C.g?C.u=="GET"&&C.L!=2&&C.j.Ca:!1}function kd(C,B){var J=C.C,pe=B.indexOf(`
`,J);return pe==-1?La:(J=Number(B.substring(J,pe)),isNaN(J)?Pd:(pe+=1,pe+J>B.length?La:(B=B.slice(pe,pe+J),C.C=pe+J,B)))}ra.prototype.cancel=function(){this.J=!0,ia(this)};function Vr(C){C.S=Date.now()+C.I,di(C,C.I)}function di(C,B){if(C.B!=null)throw Error("WatchDog timer not null");C.B=Da(N(C.ba,C),B)}function sc(C){C.B&&(E.clearTimeout(C.B),C.B=null)}ra.prototype.ba=function(){this.B=null;const C=Date.now();0<=C-this.S?(Id(this.i,this.A),this.L!=2&&(Zc(),Ci(17)),ia(this),this.s=2,el(this)):di(this,this.S-C)};function el(C){C.j.G==0||C.J||jf(C.j,C)}function ia(C){sc(C);var B=C.M;B&&typeof B.ma=="function"&&B.ma(),C.M=null,Gs(C.U),C.g&&(B=C.g,C.g=null,B.abort(),B.ma())}function np(C,B){try{var J=C.j;if(J.G!=0&&(J.g==C||Hs(J.h,C))){if(!C.K&&Hs(J.h,C)&&J.G==3){try{var pe=J.Da.g.parse(B)}catch{pe=null}if(Array.isArray(pe)&&pe.length==3){var Ke=pe;if(Ke[0]==0){e:if(!J.u){if(J.g)if(J.g.F+3e3<C.F)Ff(J),sl(J);else break e;Vf(J),Ci(18)}}else J.za=Ke[1],0<J.za-J.T&&37500>Ke[2]&&J.F&&J.v==0&&!J.C&&(J.C=Da(N(J.Za,J),6e3));if(1>=Nf(J.h)&&J.ca){try{J.ca()}catch{}J.ca=void 0}}else Mu(J,11)}else if((C.K||J.g==C)&&Ff(J),!K(B))for(Ke=J.Da.g.parse(B),B=0;B<Ke.length;B++){let gr=Ke[B];if(J.T=gr[0],gr=gr[1],J.G==2)if(gr[0]=="c"){J.K=gr[1],J.ia=gr[2];const xs=gr[3];xs!=null&&(J.la=xs,J.j.info("VER="+J.la));const ss=gr[4];ss!=null&&(J.Aa=ss,J.j.info("SVER="+J.Aa));const Ua=gr[5];Ua!=null&&typeof Ua=="number"&&0<Ua&&(pe=1.5*Ua,J.L=pe,J.j.info("backChannelRequestTimeoutMs_="+pe)),pe=J;const xo=C.g;if(xo){const ap=xo.g?xo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ap){var ot=pe.h;ot.g||ap.indexOf("spdy")==-1&&ap.indexOf("quic")==-1&&ap.indexOf("h2")==-1||(ot.j=ot.l,ot.g=new Set,ot.h&&(rp(ot,ot.h),ot.h=null))}if(pe.D){const Wf=xo.g?xo.g.getResponseHeader("X-HTTP-Session-Id"):null;Wf&&(pe.ya=Wf,Wr(pe.I,pe.D,Wf))}}J.G=3,J.l&&J.l.ua(),J.ba&&(J.R=Date.now()-C.F,J.j.info("Handshake RTT: "+J.R+"ms")),pe=J;var xt=C;if(pe.qa=Ig(pe,pe.J?pe.ia:null,pe.W),xt.K){tl(pe.h,xt);var zr=xt,ri=pe.L;ri&&(zr.I=ri),zr.B&&(sc(zr),Vr(zr)),pe.g=xt}else Fl(pe);0<J.i.length&&cc(J)}else gr[0]!="stop"&&gr[0]!="close"||Mu(J,7);else J.G==3&&(gr[0]=="stop"||gr[0]=="close"?gr[0]=="stop"?Mu(J,7):Fi(J):gr[0]!="noop"&&J.l&&J.l.ta(gr),J.v=0)}}Zc(4)}catch{}}var Nd=class{constructor(C,B){this.g=C,this.map=B}};function Nl(C){this.l=C||10,E.PerformanceNavigationTiming?(C=E.performance.getEntriesByType("navigation"),C=0<C.length&&(C[0].nextHopProtocol=="hq"||C[0].nextHopProtocol=="h2")):C=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=C?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ao(C){return C.h?!0:C.g?C.g.size>=C.j:!1}function Nf(C){return C.h?1:C.g?C.g.size:0}function Hs(C,B){return C.h?C.h==B:C.g?C.g.has(B):!1}function rp(C,B){C.g?C.g.add(B):C.h=B}function tl(C,B){C.h&&C.h==B?C.h=null:C.g&&C.g.has(B)&&C.g.delete(B)}Nl.prototype.cancel=function(){if(this.i=Dd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const C of this.g.values())C.cancel();this.g.clear()}};function Dd(C){if(C.h!=null)return C.i.concat(C.h.D);if(C.g!=null&&C.g.size!==0){let B=C.i;for(const J of C.g.values())B=B.concat(J.D);return B}return G(C.i)}function Ld(C){if(C.V&&typeof C.V=="function")return C.V();if(typeof Map<"u"&&C instanceof Map||typeof Set<"u"&&C instanceof Set)return Array.from(C.values());if(typeof C=="string")return C.split("");if(v(C)){for(var B=[],J=C.length,pe=0;pe<J;pe++)B.push(C[pe]);return B}B=[],J=0;for(pe in C)B[J++]=C[pe];return B}function ur(C){if(C.na&&typeof C.na=="function")return C.na();if(!C.V||typeof C.V!="function"){if(typeof Map<"u"&&C instanceof Map)return Array.from(C.keys());if(!(typeof Set<"u"&&C instanceof Set)){if(v(C)||typeof C=="string"){var B=[];C=C.length;for(var J=0;J<C;J++)B.push(J);return B}B=[],J=0;for(const pe in C)B[J++]=pe;return B}}}function Dl(C,B){if(C.forEach&&typeof C.forEach=="function")C.forEach(B,void 0);else if(v(C)||typeof C=="string")Array.prototype.forEach.call(C,B,void 0);else for(var J=ur(C),pe=Ld(C),Ke=pe.length,ot=0;ot<Ke;ot++)B.call(void 0,pe[ot],J&&J[ot],C)}var Ll=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ou(C,B){if(C){C=C.split("&");for(var J=0;J<C.length;J++){var pe=C[J].indexOf("="),Ke=null;if(0<=pe){var ot=C[J].substring(0,pe);Ke=C[J].substring(pe+1)}else ot=C[J];B(ot,Ke?decodeURIComponent(Ke.replace(/\+/g," ")):"")}}}function xa(C){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,C instanceof xa){this.h=C.h,ku(this,C.j),this.o=C.o,this.g=C.g,nl(this,C.s),this.l=C.l;var B=C.i,J=new Co;J.i=B.i,B.g&&(J.g=new Map(B.g),J.h=B.h),xl(this,J),this.m=C.m}else C&&(B=String(C).match(Ll))?(this.h=!1,ku(this,B[1]||"",!0),this.o=rr(B[2]||""),this.g=rr(B[3]||"",!0),nl(this,B[4]),this.l=rr(B[5]||"",!0),xl(this,B[6]||"",!0),this.m=rr(B[7]||"")):(this.h=!1,this.i=new Co(null,this.h))}xa.prototype.toString=function(){var C=[],B=this.j;B&&C.push(oc(B,Ml,!0),":");var J=this.g;return(J||B=="file")&&(C.push("//"),(B=this.o)&&C.push(oc(B,Ml,!0),"@"),C.push(encodeURIComponent(String(J)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),J=this.s,J!=null&&C.push(":",String(J))),(J=this.l)&&(this.g&&J.charAt(0)!="/"&&C.push("/"),C.push(oc(J,J.charAt(0)=="/"?ip:xd,!0))),(J=this.i.toString())&&C.push("?",J),(J=this.m)&&C.push("#",oc(J,sp)),C.join("")};function Ro(C){return new xa(C)}function ku(C,B,J){C.j=J?rr(B,!0):B,C.j&&(C.j=C.j.replace(/:$/,""))}function nl(C,B){if(B){if(B=Number(B),isNaN(B)||0>B)throw Error("Bad port number "+B);C.s=B}else C.s=null}function xl(C,B,J){B instanceof Co?(C.i=B,Oo(C.i,C.h)):(J||(B=oc(B,Lf)),C.i=new Co(B,C.h))}function Wr(C,B,J){C.i.set(B,J)}function Ma(C){return Wr(C,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),C}function rr(C,B){return C?B?decodeURI(C.replace(/%25/g,"%2525")):decodeURIComponent(C):""}function oc(C,B,J){return typeof C=="string"?(C=encodeURI(C).replace(B,Df),J&&(C=C.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C):null}function Df(C){return C=C.charCodeAt(0),"%"+(C>>4&15).toString(16)+(C&15).toString(16)}var Ml=/[#\/\?@]/g,xd=/[#\?:]/g,ip=/[#\?]/g,Lf=/[#\?@]/g,sp=/#/g;function Co(C,B){this.h=this.g=null,this.i=C||null,this.j=!!B}function Yi(C){C.g||(C.g=new Map,C.h=0,C.i&&Ou(C.i,function(B,J){C.add(decodeURIComponent(B.replace(/\+/g," ")),J)}))}r=Co.prototype,r.add=function(C,B){Yi(this),this.i=null,C=Po(this,C);var J=this.g.get(C);return J||this.g.set(C,J=[]),J.push(B),this.h+=1,this};function Io(C,B){Yi(C),B=Po(C,B),C.g.has(B)&&(C.i=null,C.h-=C.g.get(B).length,C.g.delete(B))}function Ao(C,B){return Yi(C),B=Po(C,B),C.g.has(B)}r.forEach=function(C,B){Yi(this),this.g.forEach(function(J,pe){J.forEach(function(Ke){C.call(B,Ke,pe,this)},this)},this)},r.na=function(){Yi(this);const C=Array.from(this.g.values()),B=Array.from(this.g.keys()),J=[];for(let pe=0;pe<B.length;pe++){const Ke=C[pe];for(let ot=0;ot<Ke.length;ot++)J.push(B[pe])}return J},r.V=function(C){Yi(this);let B=[];if(typeof C=="string")Ao(this,C)&&(B=B.concat(this.g.get(Po(this,C))));else{C=Array.from(this.g.values());for(let J=0;J<C.length;J++)B=B.concat(C[J])}return B},r.set=function(C,B){return Yi(this),this.i=null,C=Po(this,C),Ao(this,C)&&(this.h-=this.g.get(C).length),this.g.set(C,[B]),this.h+=1,this},r.get=function(C,B){return C?(C=this.V(C),0<C.length?String(C[0]):B):B};function Ul(C,B,J){Io(C,B),0<J.length&&(C.i=null,C.g.set(Po(C,B),G(J)),C.h+=J.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const C=[],B=Array.from(this.g.keys());for(var J=0;J<B.length;J++){var pe=B[J];const ot=encodeURIComponent(String(pe)),xt=this.V(pe);for(pe=0;pe<xt.length;pe++){var Ke=ot;xt[pe]!==""&&(Ke+="="+encodeURIComponent(String(xt[pe]))),C.push(Ke)}}return this.i=C.join("&")};function Po(C,B){return B=String(B),C.j&&(B=B.toLowerCase()),B}function Oo(C,B){B&&!C.j&&(Yi(C),C.i=null,C.g.forEach(function(J,pe){var Ke=pe.toLowerCase();pe!=Ke&&(Io(this,pe),Ul(this,Ke,J))},C)),C.j=B}function xf(C,B){const J=new Cu;if(E.Image){const pe=new Image;pe.onload=F(is,J,"TestLoadImage: loaded",!0,B,pe),pe.onerror=F(is,J,"TestLoadImage: error",!1,B,pe),pe.onabort=F(is,J,"TestLoadImage: abort",!1,B,pe),pe.ontimeout=F(is,J,"TestLoadImage: timeout",!1,B,pe),E.setTimeout(function(){pe.ontimeout&&pe.ontimeout()},1e4),pe.src=C}else B(!1)}function ac(C,B){const J=new Cu,pe=new AbortController,Ke=setTimeout(()=>{pe.abort(),is(J,"TestPingServer: timeout",!1,B)},1e4);fetch(C,{signal:pe.signal}).then(ot=>{clearTimeout(Ke),ot.ok?is(J,"TestPingServer: ok",!0,B):is(J,"TestPingServer: server error",!1,B)}).catch(()=>{clearTimeout(Ke),is(J,"TestPingServer: error",!1,B)})}function is(C,B,J,pe,Ke){try{Ke&&(Ke.onload=null,Ke.onerror=null,Ke.onabort=null,Ke.ontimeout=null),pe(J)}catch{}}function Nu(){this.g=new Jc}function op(C,B,J){const pe=J||"";try{Dl(C,function(Ke,ot){let xt=Ke;T(Ke)&&(xt=ui(Ke)),B.push(pe+ot+"="+encodeURIComponent(xt))})}catch(Ke){throw B.push(pe+"type="+encodeURIComponent("_badmap")),Ke}}function rl(C){this.l=C.Ub||null,this.j=C.eb||!1}j(rl,so),rl.prototype.g=function(){return new Vl(this.l,this.j)},rl.prototype.i=function(C){return function(){return C}}({});function Vl(C,B){hn.call(this),this.D=C,this.o=B,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j(Vl,hn),r=Vl.prototype,r.open=function(C,B){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=C,this.A=B,this.readyState=1,oa(this)},r.send=function(C){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const B={headers:this.u,method:this.B,credentials:this.m,cache:void 0};C&&(B.body=C),(this.D||E).fetch(new Request(this.A,B)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,sa(this)),this.readyState=0},r.Sa=function(C){if(this.g&&(this.l=C,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=C.headers,this.readyState=2,oa(this)),this.g&&(this.readyState=3,oa(this),this.g)))if(this.responseType==="arraybuffer")C.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in C){if(this.j=C.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Mf(this)}else C.text().then(this.Ra.bind(this),this.ga.bind(this))};function Mf(C){C.j.read().then(C.Pa.bind(C)).catch(C.ga.bind(C))}r.Pa=function(C){if(this.g){if(this.o&&C.value)this.response.push(C.value);else if(!this.o){var B=C.value?C.value:new Uint8Array(0);(B=this.v.decode(B,{stream:!C.done}))&&(this.response=this.responseText+=B)}C.done?sa(this):oa(this),this.readyState==3&&Mf(this)}},r.Ra=function(C){this.g&&(this.response=this.responseText=C,sa(this))},r.Qa=function(C){this.g&&(this.response=C,sa(this))},r.ga=function(){this.g&&sa(this)};function sa(C){C.readyState=4,C.l=null,C.j=null,C.v=null,oa(C)}r.setRequestHeader=function(C,B){this.u.append(C,B)},r.getResponseHeader=function(C){return this.h&&this.h.get(C.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const C=[],B=this.h.entries();for(var J=B.next();!J.done;)J=J.value,C.push(J[0]+": "+J[1]),J=B.next();return C.join(`\r
`)};function oa(C){C.onreadystatechange&&C.onreadystatechange.call(C)}Object.defineProperty(Vl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(C){this.m=C?"include":"same-origin"}});function il(C){let B="";return ge(C,function(J,pe){B+=pe,B+=":",B+=J,B+=`\r
`}),B}function Se(C,B,J){e:{for(pe in J){var pe=!1;break e}pe=!0}pe||(J=il(J),typeof C=="string"?J!=null&&encodeURIComponent(String(J)):Wr(C,B,J))}function Ne(C){hn.call(this),this.headers=new Map,this.o=C||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(Ne,hn);var Ze=/^https?$/i,Kt=["POST","PUT"];r=Ne.prototype,r.Ha=function(C){this.J=C},r.ea=function(C,B,J,pe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+C);B=B?B.toUpperCase():"GET",this.D=C,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ls.g(),this.v=this.o?oo(this.o):oo(Ls),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(B,String(C),!0),this.B=!1}catch(ot){Kn(this,ot);return}if(C=J||"",J=new Map(this.headers),pe)if(Object.getPrototypeOf(pe)===Object.prototype)for(var Ke in pe)J.set(Ke,pe[Ke]);else if(typeof pe.keys=="function"&&typeof pe.get=="function")for(const ot of pe.keys())J.set(ot,pe.get(ot));else throw Error("Unknown input type for opt_headers: "+String(pe));pe=Array.from(J.keys()).find(ot=>ot.toLowerCase()=="content-type"),Ke=E.FormData&&C instanceof E.FormData,!(0<=Array.prototype.indexOf.call(Kt,B,void 0))||pe||Ke||J.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ot,xt]of J)this.g.setRequestHeader(ot,xt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Or(this),this.u=!0,this.g.send(C),this.u=!1}catch(ot){Kn(this,ot)}};function Kn(C,B){C.h=!1,C.g&&(C.j=!0,C.g.abort(),C.j=!1),C.l=B,C.m=5,mr(C),cn(C)}function mr(C){C.A||(C.A=!0,Yt(C,"complete"),Yt(C,"error"))}r.abort=function(C){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=C||7,Yt(this,"complete"),Yt(this,"abort"),cn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),cn(this,!0)),Ne.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Fr(this):this.bb())},r.bb=function(){Fr(this)};function Fr(C){if(C.h&&typeof f<"u"&&(!C.v[1]||hi(C)!=4||C.Z()!=2)){if(C.u&&hi(C)==4)ec(C.Ea,0,C);else if(Yt(C,"readystatechange"),hi(C)==4){C.h=!1;try{const xt=C.Z();e:switch(xt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var B=!0;break e;default:B=!1}var J;if(!(J=B)){var pe;if(pe=xt===0){var Ke=String(C.D).match(Ll)[1]||null;!Ke&&E.self&&E.self.location&&(Ke=E.self.location.protocol.slice(0,-1)),pe=!Ze.test(Ke?Ke.toLowerCase():"")}J=pe}if(J)Yt(C,"complete"),Yt(C,"success");else{C.m=6;try{var ot=2<hi(C)?C.g.statusText:""}catch{ot=""}C.l=ot+" ["+C.Z()+"]",mr(C)}}finally{cn(C)}}}}function cn(C,B){if(C.g){Or(C);const J=C.g,pe=C.v[0]?()=>{}:null;C.g=null,C.v=null,B||Yt(C,"ready");try{J.onreadystatechange=pe}catch{}}}function Or(C){C.I&&(E.clearTimeout(C.I),C.I=null)}r.isActive=function(){return!!this.g};function hi(C){return C.g?C.g.readyState:0}r.Z=function(){try{return 2<hi(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(C){if(this.g){var B=this.g.responseText;return C&&B.indexOf(C)==0&&(B=B.substring(C.length)),Na(B)}};function Ss(C){try{if(!C.g)return null;if("response"in C.g)return C.g.response;switch(C.H){case"":case"text":return C.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in C.g)return C.g.mozResponseArrayBuffer}return null}catch{return null}}function ko(C){const B={};C=(C.g&&2<=hi(C)&&C.g.getAllResponseHeaders()||"").split(`\r
`);for(let pe=0;pe<C.length;pe++){if(K(C[pe]))continue;var J=me(C[pe]);const Ke=J[0];if(J=J[1],typeof J!="string")continue;J=J.trim();const ot=B[Ke]||[];B[Ke]=ot,ot.push(J)}ee(B,function(pe){return pe.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function No(C,B,J){return J&&J.internalChannelParams&&J.internalChannelParams[C]||B}function Du(C){this.Aa=0,this.i=[],this.j=new Cu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=No("failFast",!1,C),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=No("baseRetryDelayMs",5e3,C),this.cb=No("retryDelaySeedMs",1e4,C),this.Wa=No("forwardChannelMaxRetries",2,C),this.wa=No("forwardChannelRequestTimeoutMs",2e4,C),this.pa=C&&C.xmlHttpFactory||void 0,this.Xa=C&&C.Tb||void 0,this.Ca=C&&C.useFetchStreams||!1,this.L=void 0,this.J=C&&C.supportsCrossDomainXhr||!1,this.K="",this.h=new Nl(C&&C.concurrentRequestLimit),this.Da=new Nu,this.P=C&&C.fastHandshake||!1,this.O=C&&C.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=C&&C.Rb||!1,C&&C.xa&&this.j.xa(),C&&C.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&C&&C.detectBufferingProxy||!1,this.ja=void 0,C&&C.longPollingTimeout&&0<C.longPollingTimeout&&(this.ja=C.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Du.prototype,r.la=8,r.G=1,r.connect=function(C,B,J,pe){Ci(0),this.W=C,this.H=B||{},J&&pe!==void 0&&(this.H.OSID=J,this.H.OAID=pe),this.F=this.X,this.I=Ig(this,null,this.W),cc(this)};function Fi(C){if(Md(C),C.G==3){var B=C.U++,J=Ro(C.I);if(Wr(J,"SID",C.K),Wr(J,"RID",B),Wr(J,"TYPE","terminate"),Lu(C,J),B=new ra(C,C.j,B),B.L=2,B.v=Ma(Ro(J)),J=!1,E.navigator&&E.navigator.sendBeacon)try{J=E.navigator.sendBeacon(B.v.toString(),"")}catch{}!J&&E.Image&&(new Image().src=B.v,J=!0),J||(B.g=xE(B.j,null),B.g.ea(B.v)),B.F=Date.now(),Vr(B)}Uu(C)}function sl(C){C.g&&(Cg(C),C.g.cancel(),C.g=null)}function Md(C){sl(C),C.u&&(E.clearTimeout(C.u),C.u=null),Ff(C),C.h.cancel(),C.s&&(typeof C.s=="number"&&E.clearTimeout(C.s),C.s=null)}function cc(C){if(!ao(C.h)&&!C.s){C.s=!0;var B=C.Ga;Ee||Be(),we||(Ee(),we=!0),ve.add(B,C),C.B=0}}function Rg(C,B){return Nf(C.h)>=C.h.j-(C.s?1:0)?!1:C.s?(C.i=B.D.concat(C.i),!0):C.G==1||C.G==2||C.B>=(C.Va?0:C.Wa)?!1:(C.s=Da(N(C.Ga,C,B),xu(C,C.B)),C.B++,!0)}r.Ga=function(C){if(this.s)if(this.s=null,this.G==1){if(!C){this.U=Math.floor(1e5*Math.random()),C=this.U++;const Ke=new ra(this,this.j,C);let ot=this.o;if(this.S&&(ot?(ot=Z(ot),ae(ot,this.S)):ot=this.S),this.m!==null||this.O||(Ke.H=ot,ot=null),this.P)e:{for(var B=0,J=0;J<this.i.length;J++){t:{var pe=this.i[J];if("__data__"in pe.map&&(pe=pe.map.__data__,typeof pe=="string")){pe=pe.length;break t}pe=void 0}if(pe===void 0)break;if(B+=pe,4096<B){B=J;break e}if(B===4096||J===this.i.length-1){B=J+1;break e}}B=1e3}else B=1e3;B=Do(this,Ke,B),J=Ro(this.I),Wr(J,"RID",C),Wr(J,"CVER",22),this.D&&Wr(J,"X-HTTP-Session-Id",this.D),Lu(this,J),ot&&(this.O?B="headers="+encodeURIComponent(String(il(ot)))+"&"+B:this.m&&Se(J,this.m,ot)),rp(this.h,Ke),this.Ua&&Wr(J,"TYPE","init"),this.P?(Wr(J,"$req",B),Wr(J,"SID","null"),Ke.T=!0,Od(Ke,J,null)):Od(Ke,J,B),this.G=2}}else this.G==3&&(C?Uf(this,C):this.i.length==0||ao(this.h)||Uf(this))};function Uf(C,B){var J;B?J=B.l:J=C.U++;const pe=Ro(C.I);Wr(pe,"SID",C.K),Wr(pe,"RID",J),Wr(pe,"AID",C.T),Lu(C,pe),C.m&&C.o&&Se(pe,C.m,C.o),J=new ra(C,C.j,J,C.B+1),C.m===null&&(J.H=C.o),B&&(C.i=B.D.concat(C.i)),B=Do(C,J,1e3),J.I=Math.round(.5*C.wa)+Math.round(.5*C.wa*Math.random()),rp(C.h,J),Od(J,pe,B)}function Lu(C,B){C.H&&ge(C.H,function(J,pe){Wr(B,pe,J)}),C.l&&Dl({},function(J,pe){Wr(B,pe,J)})}function Do(C,B,J){J=Math.min(C.i.length,J);var pe=C.l?N(C.l.Na,C.l,C):null;e:{var Ke=C.i;let ot=-1;for(;;){const xt=["count="+J];ot==-1?0<J?(ot=Ke[0].g,xt.push("ofs="+ot)):ot=0:xt.push("ofs="+ot);let zr=!0;for(let ri=0;ri<J;ri++){let gr=Ke[ri].g;const xs=Ke[ri].map;if(gr-=ot,0>gr)ot=Math.max(0,Ke[ri].g-100),zr=!1;else try{op(xs,xt,"req"+gr+"_")}catch{pe&&pe(xs)}}if(zr){pe=xt.join("&");break e}}}return C=C.i.splice(0,J),B.D=C,pe}function Fl(C){if(!C.g&&!C.u){C.Y=1;var B=C.Fa;Ee||Be(),we||(Ee(),we=!0),ve.add(B,C),C.v=0}}function Vf(C){return C.g||C.u||3<=C.v?!1:(C.Y++,C.u=Da(N(C.Fa,C),xu(C,C.v)),C.v++,!0)}r.Fa=function(){if(this.u=null,LE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var C=2*this.R;this.j.info("BP detection timer enabled: "+C),this.A=Da(N(this.ab,this),C)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ci(10),sl(this),LE(this))};function Cg(C){C.A!=null&&(E.clearTimeout(C.A),C.A=null)}function LE(C){C.g=new ra(C,C.j,"rpc",C.Y),C.m===null&&(C.g.H=C.o),C.g.O=0;var B=Ro(C.qa);Wr(B,"RID","rpc"),Wr(B,"SID",C.K),Wr(B,"AID",C.T),Wr(B,"CI",C.F?"0":"1"),!C.F&&C.ja&&Wr(B,"TO",C.ja),Wr(B,"TYPE","xmlhttp"),Lu(C,B),C.m&&C.o&&Se(B,C.m,C.o),C.L&&(C.g.I=C.L);var J=C.g;C=C.ia,J.L=1,J.v=Ma(Ro(B)),J.m=null,J.P=!0,Pu(J,C)}r.Za=function(){this.C!=null&&(this.C=null,sl(this),Vf(this),Ci(19))};function Ff(C){C.C!=null&&(E.clearTimeout(C.C),C.C=null)}function jf(C,B){var J=null;if(C.g==B){Ff(C),Cg(C),C.g=null;var pe=2}else if(Hs(C.h,B))J=B.D,tl(C.h,B),pe=1;else return;if(C.G!=0){if(B.o)if(pe==1){J=B.m?B.m.length:0,B=Date.now()-B.F;var Ke=C.B;pe=Ru(),Yt(pe,new rs(pe,J)),cc(C)}else Fl(C);else if(Ke=B.s,Ke==3||Ke==0&&0<B.X||!(pe==1&&Rg(C,B)||pe==2&&Vf(C)))switch(J&&0<J.length&&(B=C.h,B.i=B.i.concat(J)),Ke){case 1:Mu(C,5);break;case 4:Mu(C,10);break;case 3:Mu(C,6);break;default:Mu(C,2)}}}function xu(C,B){let J=C.Ta+Math.floor(Math.random()*C.cb);return C.isActive()||(J*=2),J*B}function Mu(C,B){if(C.j.info("Error code "+B),B==2){var J=N(C.fb,C),pe=C.Xa;const Ke=!pe;pe=new xa(pe||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||ku(pe,"https"),Ma(pe),Ke?xf(pe.toString(),J):ac(pe.toString(),J)}else Ci(2);C.G=0,C.l&&C.l.sa(B),Uu(C),Md(C)}r.fb=function(C){C?(this.j.info("Successfully pinged google.com"),Ci(2)):(this.j.info("Failed to ping google.com"),Ci(1))};function Uu(C){if(C.G=0,C.ka=[],C.l){const B=Dd(C.h);(B.length!=0||C.i.length!=0)&&(H(C.ka,B),H(C.ka,C.i),C.h.i.length=0,G(C.i),C.i.length=0),C.l.ra()}}function Ig(C,B,J){var pe=J instanceof xa?Ro(J):new xa(J);if(pe.g!="")B&&(pe.g=B+"."+pe.g),nl(pe,pe.s);else{var Ke=E.location;pe=Ke.protocol,B=B?B+"."+Ke.hostname:Ke.hostname,Ke=+Ke.port;var ot=new xa(null);pe&&ku(ot,pe),B&&(ot.g=B),Ke&&nl(ot,Ke),J&&(ot.l=J),pe=ot}return J=C.D,B=C.ya,J&&B&&Wr(pe,J,B),Wr(pe,"VER",C.la),Lu(C,pe),pe}function xE(C,B,J){if(B&&!C.J)throw Error("Can't create secondary domain capable XhrIo object.");return B=C.Ca&&!C.pa?new Ne(new rl({eb:J})):new Ne(C.pa),B.Ha(C.J),B}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Mn(){}r=Mn.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Bf(){}Bf.prototype.g=function(C,B){return new Lo(C,B)};function Lo(C,B){hn.call(this),this.g=new Du(B),this.l=C,this.h=B&&B.messageUrlParams||null,C=B&&B.messageHeaders||null,B&&B.clientProtocolHeaderRequired&&(C?C["X-Client-Protocol"]="webchannel":C={"X-Client-Protocol":"webchannel"}),this.g.o=C,C=B&&B.initMessageHeaders||null,B&&B.messageContentType&&(C?C["X-WebChannel-Content-Type"]=B.messageContentType:C={"X-WebChannel-Content-Type":B.messageContentType}),B&&B.va&&(C?C["X-WebChannel-Client-Profile"]=B.va:C={"X-WebChannel-Client-Profile":B.va}),this.g.S=C,(C=B&&B.Sb)&&!K(C)&&(this.g.m=C),this.v=B&&B.supportsCrossDomainXhr||!1,this.u=B&&B.sendRawJson||!1,(B=B&&B.httpSessionIdParam)&&!K(B)&&(this.g.D=B,C=this.h,C!==null&&B in C&&(C=this.h,B in C&&delete C[B])),this.j=new lc(this)}j(Lo,hn),Lo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Lo.prototype.close=function(){Fi(this.g)},Lo.prototype.o=function(C){var B=this.g;if(typeof C=="string"){var J={};J.__data__=C,C=J}else this.u&&(J={},J.__data__=ui(C),C=J);B.i.push(new Nd(B.Ya++,C)),B.G==3&&cc(B)},Lo.prototype.N=function(){this.g.l=null,delete this.j,Fi(this.g),delete this.g,Lo.aa.N.call(this)};function ME(C){tc.call(this),C.__headers__&&(this.headers=C.__headers__,this.statusCode=C.__status__,delete C.__headers__,delete C.__status__);var B=C.__sm__;if(B){e:{for(const J in B){C=J;break e}C=void 0}(this.i=C)&&(C=this.i,B=B!==null&&C in B?B[C]:void 0),this.data=B}else this.data=C}j(ME,tc);function UE(){ea.call(this),this.status=1}j(UE,ea);function lc(C){this.g=C}j(lc,Mn),lc.prototype.ua=function(){Yt(this.g,"a")},lc.prototype.ta=function(C){Yt(this.g,new ME(C))},lc.prototype.sa=function(C){Yt(this.g,new UE)},lc.prototype.ra=function(){Yt(this.g,"b")},Bf.prototype.createWebChannel=Bf.prototype.g,Lo.prototype.send=Lo.prototype.o,Lo.prototype.open=Lo.prototype.m,Lo.prototype.close=Lo.prototype.close,One=function(){return new Bf},Pne=function(){return Ru()},Ane=nc,xU={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Iu.NO_ERROR=0,Iu.TIMEOUT=8,Iu.HTTP_ERROR=6,MO=Iu,tp.COMPLETE="complete",Ine=tp,kl.EventType=Ds,Ds.OPEN="a",Ds.CLOSE="b",Ds.ERROR="c",Ds.MESSAGE="d",hn.prototype.listen=hn.prototype.K,_w=kl,Ne.prototype.listenOnce=Ne.prototype.L,Ne.prototype.getLastError=Ne.prototype.Ka,Ne.prototype.getLastErrorCode=Ne.prototype.Ba,Ne.prototype.getStatus=Ne.prototype.Z,Ne.prototype.getResponseJson=Ne.prototype.Oa,Ne.prototype.getResponseText=Ne.prototype.oa,Ne.prototype.send=Ne.prototype.ea,Ne.prototype.setWithCredentials=Ne.prototype.Ha,Cne=Ne}).apply(typeof nO<"u"?nO:typeof self<"u"?self:typeof window<"u"?window:{});const SY="@firebase/firestore",TY="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ca.UNAUTHENTICATED=new Ca(null),Ca.GOOGLE_CREDENTIALS=new Ca("google-credentials-uid"),Ca.FIRST_PARTY=new Ca("first-party-uid"),Ca.MOCK_USER=new Ca("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _0="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE=new BF("@firebase/firestore");function iS(){return wE.logLevel}function Qt(r,...t){if(wE.logLevel<=yr.DEBUG){const s=t.map(QF);wE.debug(`Firestore (${_0}): ${r}`,...s)}}function wf(r,...t){if(wE.logLevel<=yr.ERROR){const s=t.map(QF);wE.error(`Firestore (${_0}): ${r}`,...s)}}function e0(r,...t){if(wE.logLevel<=yr.WARN){const s=t.map(QF);wE.warn(`Firestore (${_0}): ${r}`,...s)}}function QF(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(r="Unexpected state"){const t=`FIRESTORE (${_0}) INTERNAL ASSERTION FAILED: `+r;throw wf(t),new Error(t)}function ni(r,t){r||jn()}function Xn(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class sn extends ep{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kne{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class kVe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(Ca.UNAUTHENTICATED))}shutdown(){}}class NVe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class DVe{constructor(t){this.t=t,this.currentUser=Ca.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){ni(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,s(v)):Promise.resolve();let d=new _f;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new _f,t.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},E=v=>{Qt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(v=>E(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?E(v):(Qt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new _f)}},0),f()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(Qt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(ni(typeof a.accessToken=="string"),new kne(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ni(t===null||typeof t=="string"),new Ca(t)}}class LVe{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=Ca.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class xVe{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new LVe(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(Ca.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class bY{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class MVe{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Sl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){ni(this.o===void 0);const a=d=>{d.error!=null&&Qt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,Qt("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{Qt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Qt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new bY(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(ni(typeof s.token=="string"),this.R=s.token,new bY(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UVe(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<r;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nne{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=UVe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function Cr(r,t){return r<t?-1:r>t?1:0}function t0(r,t,s){return r.length===t.length&&r.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wY=-62135596800,RY=1e6;class no{static now(){return no.fromMillis(Date.now())}static fromDate(t){return no.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*RY);return new no(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<wY)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/RY}_compareTo(t){return this.seconds===t.seconds?Cr(this.nanoseconds,t.nanoseconds):Cr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-wY;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{static fromTimestamp(t){return new $n(t)}static min(){return new $n(new no(0,0))}static max(){return new $n(new no(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CY="__name__";class wh{constructor(t,s,a){s===void 0?s=0:s>t.length&&jn(),a===void 0?a=t.length-s:a>t.length-s&&jn(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return wh.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof wh?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=wh.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return Math.sign(t.length-s.length)}static compareSegments(t,s){const a=wh.isNumericId(t),l=wh.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?wh.extractNumericId(t).compare(wh.extractNumericId(s)):t<s?-1:t>s?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return rg.fromString(t.substring(4,t.length-2))}}class Mi extends wh{construct(t,s,a){return new Mi(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new Mi(s)}static emptyPath(){return new Mi([])}}const VVe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Qo extends wh{construct(t,s,a){return new Qo(t,s,a)}static isValidIdentifier(t){return VVe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Qo.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===CY}static keyField(){return new Qo([CY])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let f=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new sn(Tt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new sn(Tt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else E==="`"?(f=!f,l++):E!=="."||f?(a+=E,l++):(d(),l++)}if(d(),f)throw new sn(Tt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Qo(s)}static emptyPath(){return new Qo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(t){this.path=t}static fromPath(t){return new Tn(Mi.fromString(t))}static fromName(t){return new Tn(Mi.fromString(t).popFirst(5))}static empty(){return new Tn(Mi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Mi.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return Mi.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Tn(new Mi(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lR=-1;function FVe(r,t){const s=r.toTimestamp().seconds,a=r.toTimestamp().nanoseconds+1,l=$n.fromTimestamp(a===1e9?new no(s+1,0):new no(s,a));return new hg(l,Tn.empty(),t)}function jVe(r){return new hg(r.readTime,r.key,lR)}class hg{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new hg($n.min(),Tn.empty(),lR)}static max(){return new hg($n.max(),Tn.empty(),lR)}}function BVe(r,t){let s=r.readTime.compareTo(t.readTime);return s!==0?s:(s=Tn.comparator(r.documentKey,t.documentKey),s!==0?s:Cr(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WVe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class zVe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E0(r){if(r.code!==Tt.FAILED_PRECONDITION||r.message!==WVe)throw r;Qt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&jn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new St((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof St?s:St.resolve(s)}catch(s){return St.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):St.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):St.reject(s)}static resolve(t){return new St((s,a)=>{s(t)})}static reject(t){return new St((s,a)=>{a(t)})}static waitFor(t){return new St((s,a)=>{let l=0,d=0,f=!1;t.forEach(E=>{++l,E.next(()=>{++d,f&&d===l&&s()},v=>a(v))}),f=!0,d===l&&s()})}static or(t){let s=St.resolve(!1);for(const a of t)s=s.next(l=>l?St.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new St((a,l)=>{const d=t.length,f=new Array(d);let E=0;for(let v=0;v<d;v++){const T=v;s(t[T]).next(w=>{f[T]=w,++E,E===d&&a(f)},w=>l(w))}})}static doWhile(t,s){return new St((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function GVe(r){const t=r.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function y0(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}dN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZF=-1;function hN(r){return r==null}function _k(r){return r===0&&1/r==-1/0}function HVe(r){return typeof r=="number"&&Number.isInteger(r)&&!_k(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dne="";function $Ve(r){let t="";for(let s=0;s<r.length;s++)t.length>0&&(t=IY(t)),t=KVe(r.get(s),t);return IY(t)}function KVe(r,t){let s=t;const a=r.length;for(let l=0;l<a;l++){const d=r.charAt(l);switch(d){case"\0":s+="";break;case Dne:s+="";break;default:s+=d}}return s}function IY(r){return r+Dne+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AY(r){let t=0;for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t++;return t}function Sg(r,t){for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t(s,r[s])}function Lne(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(t,s){this.comparator=t,this.root=s||Yo.EMPTY}insert(t,s){return new ts(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,Yo.BLACK,null,null))}remove(t){return new ts(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Yo.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new rO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new rO(this.root,t,this.comparator,!1)}getReverseIterator(){return new rO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new rO(this.root,t,this.comparator,!0)}}class rO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Yo{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??Yo.RED,this.left=l??Yo.EMPTY,this.right=d??Yo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new Yo(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Yo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return Yo.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Yo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Yo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw jn();const t=this.left.check();if(t!==this.right.check())throw jn();return t+(this.isRed()?0:1)}}Yo.EMPTY=null,Yo.RED=!0,Yo.BLACK=!1;Yo.EMPTY=new class{constructor(){this.size=0}get key(){throw jn()}get value(){throw jn()}get color(){throw jn()}get left(){throw jn()}get right(){throw jn()}copy(t,s,a,l,d){return this}insert(t,s,a){return new Yo(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(t){this.comparator=t,this.data=new ts(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new PY(this.data.getIterator())}getIteratorFrom(t){return new PY(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof ro)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new ro(this.comparator);return s.data=t,s}}class PY{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl{constructor(t){this.fields=t,t.sort(Qo.comparator)}static empty(){return new bl([])}unionWith(t){let s=new ro(Qo.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new bl(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return t0(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xne extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new xne("Invalid base64 string: "+d):d}}(t);return new Zo(s)}static fromUint8Array(t){const s=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(t);return new Zo(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Cr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Zo.EMPTY_BYTE_STRING=new Zo("");const qVe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pg(r){if(ni(!!r),typeof r=="string"){let t=0;const s=qVe.exec(r);if(ni(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(r);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:As(r.seconds),nanos:As(r.nanos)}}function As(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function fg(r){return typeof r=="string"?Zo.fromBase64String(r):Zo.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mne="server_timestamp",Une="__type__",Vne="__previous_value__",Fne="__local_write_time__";function ej(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{})[Une])===null||s===void 0?void 0:s.stringValue)===Mne}function pN(r){const t=r.mapValue.fields[Vne];return ej(t)?pN(t):t}function uR(r){const t=pg(r.mapValue.fields[Fne].timestampValue);return new no(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YVe{constructor(t,s,a,l,d,f,E,v,T){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=E,this.longPollingOptions=v,this.useFetchStreams=T}}const Ek="(default)";class dR{constructor(t,s){this.projectId=t,this.database=s||Ek}static empty(){return new dR("","")}get isDefaultDatabase(){return this.database===Ek}isEqual(t){return t instanceof dR&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jne="__type__",XVe="__max__",iO={mapValue:{}},Bne="__vector__",yk="value";function mg(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?ej(r)?4:QVe(r)?9007199254740991:JVe(r)?10:11:jn()}function Yh(r,t){if(r===t)return!0;const s=mg(r);if(s!==mg(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return uR(r).isEqual(uR(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=pg(l.timestampValue),E=pg(d.timestampValue);return f.seconds===E.seconds&&f.nanos===E.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(l,d){return fg(l.bytesValue).isEqual(fg(d.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(l,d){return As(l.geoPointValue.latitude)===As(d.geoPointValue.latitude)&&As(l.geoPointValue.longitude)===As(d.geoPointValue.longitude)}(r,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return As(l.integerValue)===As(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=As(l.doubleValue),E=As(d.doubleValue);return f===E?_k(f)===_k(E):isNaN(f)&&isNaN(E)}return!1}(r,t);case 9:return t0(r.arrayValue.values||[],t.arrayValue.values||[],Yh);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},E=d.mapValue.fields||{};if(AY(f)!==AY(E))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(E[v]===void 0||!Yh(f[v],E[v])))return!1;return!0}(r,t);default:return jn()}}function hR(r,t){return(r.values||[]).find(s=>Yh(s,t))!==void 0}function n0(r,t){if(r===t)return 0;const s=mg(r),a=mg(t);if(s!==a)return Cr(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return Cr(r.booleanValue,t.booleanValue);case 2:return function(d,f){const E=As(d.integerValue||d.doubleValue),v=As(f.integerValue||f.doubleValue);return E<v?-1:E>v?1:E===v?0:isNaN(E)?isNaN(v)?0:-1:1}(r,t);case 3:return OY(r.timestampValue,t.timestampValue);case 4:return OY(uR(r),uR(t));case 5:return Cr(r.stringValue,t.stringValue);case 6:return function(d,f){const E=fg(d),v=fg(f);return E.compareTo(v)}(r.bytesValue,t.bytesValue);case 7:return function(d,f){const E=d.split("/"),v=f.split("/");for(let T=0;T<E.length&&T<v.length;T++){const w=Cr(E[T],v[T]);if(w!==0)return w}return Cr(E.length,v.length)}(r.referenceValue,t.referenceValue);case 8:return function(d,f){const E=Cr(As(d.latitude),As(f.latitude));return E!==0?E:Cr(As(d.longitude),As(f.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return kY(r.arrayValue,t.arrayValue);case 10:return function(d,f){var E,v,T,w;const I=d.fields||{},N=f.fields||{},F=(E=I[yk])===null||E===void 0?void 0:E.arrayValue,j=(v=N[yk])===null||v===void 0?void 0:v.arrayValue,G=Cr(((T=F==null?void 0:F.values)===null||T===void 0?void 0:T.length)||0,((w=j==null?void 0:j.values)===null||w===void 0?void 0:w.length)||0);return G!==0?G:kY(F,j)}(r.mapValue,t.mapValue);case 11:return function(d,f){if(d===iO.mapValue&&f===iO.mapValue)return 0;if(d===iO.mapValue)return 1;if(f===iO.mapValue)return-1;const E=d.fields||{},v=Object.keys(E),T=f.fields||{},w=Object.keys(T);v.sort(),w.sort();for(let I=0;I<v.length&&I<w.length;++I){const N=Cr(v[I],w[I]);if(N!==0)return N;const F=n0(E[v[I]],T[w[I]]);if(F!==0)return F}return Cr(v.length,w.length)}(r.mapValue,t.mapValue);default:throw jn()}}function OY(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return Cr(r,t);const s=pg(r),a=pg(t),l=Cr(s.seconds,a.seconds);return l!==0?l:Cr(s.nanos,a.nanos)}function kY(r,t){const s=r.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=n0(s[l],a[l]);if(d)return d}return Cr(s.length,a.length)}function r0(r){return MU(r)}function MU(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(s){const a=pg(s);return`time(${a.seconds},${a.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(s){return fg(s).toBase64()}(r.bytesValue):"referenceValue"in r?function(s){return Tn.fromName(s).toString()}(r.referenceValue):"geoPointValue"in r?function(s){return`geo(${s.latitude},${s.longitude})`}(r.geoPointValue):"arrayValue"in r?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=MU(d);return a+"]"}(r.arrayValue):"mapValue"in r?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${MU(s.fields[f])}`;return l+"}"}(r.mapValue):jn()}function UO(r){switch(mg(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=pN(r);return t?16+UO(t):16;case 5:return 2*r.stringValue.length;case 6:return fg(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+UO(d),0)}(r.arrayValue);case 10:case 11:return function(a){let l=0;return Sg(a.fields,(d,f)=>{l+=d.length+UO(f)}),l}(r.mapValue);default:throw jn()}}function NY(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function UU(r){return!!r&&"integerValue"in r}function tj(r){return!!r&&"arrayValue"in r}function DY(r){return!!r&&"nullValue"in r}function LY(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function VO(r){return!!r&&"mapValue"in r}function JVe(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{})[jne])===null||s===void 0?void 0:s.stringValue)===Bne}function xw(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return Sg(r.mapValue.fields,(s,a)=>t.mapValue.fields[s]=xw(a)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(r.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=xw(r.arrayValue.values[s]);return t}return Object.assign({},r)}function QVe(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===XVe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(t){this.value=t}static empty(){return new Fc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!VO(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=xw(s)}setAll(t){let s=Qo.emptyPath(),a={},l=[];t.forEach((f,E)=>{if(!s.isImmediateParentOf(E)){const v=this.getFieldsMap(s);this.applyChanges(v,a,l),a={},l=[],s=E.popLast()}f?a[E.lastSegment()]=xw(f):l.push(E.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());VO(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return Yh(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];VO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){Sg(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new Fc(xw(this.value))}}function Wne(r){const t=[];return Sg(r.fields,(s,a)=>{const l=new Qo([s]);if(VO(a)){const d=Wne(a.mapValue).fields;if(d.length===0)t.push(l);else for(const f of d)t.push(l.child(f))}else t.push(l)}),new bl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(t,s,a,l,d,f,E){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=E}static newInvalidDocument(t){return new Aa(t,0,$n.min(),$n.min(),$n.min(),Fc.empty(),0)}static newFoundDocument(t,s,a,l){return new Aa(t,1,s,$n.min(),a,l,0)}static newNoDocument(t,s){return new Aa(t,2,s,$n.min(),$n.min(),Fc.empty(),0)}static newUnknownDocument(t,s){return new Aa(t,3,s,$n.min(),$n.min(),Fc.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual($n.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Fc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Fc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$n.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Aa&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Aa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(t,s){this.position=t,this.inclusive=s}}function xY(r,t,s){let a=0;for(let l=0;l<r.position.length;l++){const d=t[l],f=r.position[l];if(d.field.isKeyField()?a=Tn.comparator(Tn.fromName(f.referenceValue),s.key):a=n0(f,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function MY(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let s=0;s<r.position.length;s++)if(!Yh(r.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(t,s="asc"){this.field=t,this.dir=s}}function ZVe(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zne{}class zs extends zne{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new tFe(t,s,a):s==="array-contains"?new iFe(t,a):s==="in"?new sFe(t,a):s==="not-in"?new oFe(t,a):s==="array-contains-any"?new aFe(t,a):new zs(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new nFe(t,a):new rFe(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(n0(s,this.value)):s!==null&&mg(this.value)===mg(s)&&this.matchesComparison(n0(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return jn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class wd extends zne{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new wd(t,s)}matches(t){return Gne(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Gne(r){return r.op==="and"}function Hne(r){return eFe(r)&&Gne(r)}function eFe(r){for(const t of r.filters)if(t instanceof wd)return!1;return!0}function VU(r){if(r instanceof zs)return r.field.canonicalString()+r.op.toString()+r0(r.value);if(Hne(r))return r.filters.map(t=>VU(t)).join(",");{const t=r.filters.map(s=>VU(s)).join(",");return`${r.op}(${t})`}}function $ne(r,t){return r instanceof zs?function(a,l){return l instanceof zs&&a.op===l.op&&a.field.isEqual(l.field)&&Yh(a.value,l.value)}(r,t):r instanceof wd?function(a,l){return l instanceof wd&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,E)=>d&&$ne(f,l.filters[E]),!0):!1}(r,t):void jn()}function Kne(r){return r instanceof zs?function(s){return`${s.field.canonicalString()} ${s.op} ${r0(s.value)}`}(r):r instanceof wd?function(s){return s.op.toString()+" {"+s.getFilters().map(Kne).join(" ,")+"}"}(r):"Filter"}class tFe extends zs{constructor(t,s,a){super(t,s,a),this.key=Tn.fromName(a.referenceValue)}matches(t){const s=Tn.comparator(t.key,this.key);return this.matchesComparison(s)}}class nFe extends zs{constructor(t,s){super(t,"in",s),this.keys=qne("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class rFe extends zs{constructor(t,s){super(t,"not-in",s),this.keys=qne("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function qne(r,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>Tn.fromName(a.referenceValue))}class iFe extends zs{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return tj(s)&&hR(s.arrayValue,this.value)}}class sFe extends zs{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&hR(this.value.arrayValue,s)}}class oFe extends zs{constructor(t,s){super(t,"not-in",s)}matches(t){if(hR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!hR(this.value.arrayValue,s)}}class aFe extends zs{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!tj(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>hR(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cFe{constructor(t,s=null,a=[],l=[],d=null,f=null,E=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=E,this.le=null}}function UY(r,t=null,s=[],a=[],l=null,d=null,f=null){return new cFe(r,t,s,a,l,d,f)}function nj(r){const t=Xn(r);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>VU(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),hN(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>r0(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>r0(a)).join(",")),t.le=s}return t.le}function rj(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<r.orderBy.length;s++)if(!ZVe(r.orderBy[s],t.orderBy[s]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let s=0;s<r.filters.length;s++)if(!$ne(r.filters[s],t.filters[s]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!MY(r.startAt,t.startAt)&&MY(r.endAt,t.endAt)}function FU(r){return Tn.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR{constructor(t,s=null,a=[],l=[],d=null,f="F",E=null,v=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=E,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function lFe(r,t,s,a,l,d,f,E){return new BR(r,t,s,a,l,d,f,E)}function ij(r){return new BR(r)}function VY(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Yne(r){return r.collectionGroup!==null}function Mw(r){const t=Xn(r);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(f){let E=new ro(Qo.comparator);return f.filters.forEach(v=>{v.getFlattenedFilters().forEach(T=>{T.isInequality()&&(E=E.add(T.field))})}),E})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new Sk(d,a))}),s.has(Qo.keyField().canonicalString())||t.he.push(new Sk(Qo.keyField(),a))}return t.he}function Gh(r){const t=Xn(r);return t.Pe||(t.Pe=uFe(t,Mw(r))),t.Pe}function uFe(r,t){if(r.limitType==="F")return UY(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new Sk(l.field,d)});const s=r.endAt?new vk(r.endAt.position,r.endAt.inclusive):null,a=r.startAt?new vk(r.startAt.position,r.startAt.inclusive):null;return UY(r.path,r.collectionGroup,t,r.filters,r.limit,s,a)}}function jU(r,t){const s=r.filters.concat([t]);return new BR(r.path,r.collectionGroup,r.explicitOrderBy.slice(),s,r.limit,r.limitType,r.startAt,r.endAt)}function BU(r,t,s){return new BR(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,s,r.startAt,r.endAt)}function fN(r,t){return rj(Gh(r),Gh(t))&&r.limitType===t.limitType}function Xne(r){return`${nj(Gh(r))}|lt:${r.limitType}`}function sS(r){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>Kne(l)).join(", ")}]`),hN(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>r0(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>r0(l)).join(",")),`Target(${a})`}(Gh(r))}; limitType=${r.limitType})`}function mN(r,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):Tn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(r,t)&&function(a,l){for(const d of Mw(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(r,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(r,t)&&function(a,l){return!(a.startAt&&!function(f,E,v){const T=xY(f,E,v);return f.inclusive?T<=0:T<0}(a.startAt,Mw(a),l)||a.endAt&&!function(f,E,v){const T=xY(f,E,v);return f.inclusive?T>=0:T>0}(a.endAt,Mw(a),l))}(r,t)}function dFe(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Jne(r){return(t,s)=>{let a=!1;for(const l of Mw(r)){const d=hFe(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function hFe(r,t,s){const a=r.field.isKeyField()?Tn.comparator(t.key,s.key):function(d,f,E){const v=f.data.field(d),T=E.data.field(d);return v!==null&&T!==null?n0(v,T):jn()}(r.field,t,s);switch(r.dir){case"asc":return a;case"desc":return-1*a;default:return jn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Sg(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return Lne(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pFe=new ts(Tn.comparator);function Rf(){return pFe}const Qne=new ts(Tn.comparator);function Ew(...r){let t=Qne;for(const s of r)t=t.insert(s.key,s);return t}function Zne(r){let t=Qne;return r.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function nE(){return Uw()}function ere(){return Uw()}function Uw(){return new OE(r=>r.toString(),(r,t)=>r.isEqual(t))}const fFe=new ts(Tn.comparator),mFe=new ro(Tn.comparator);function vr(...r){let t=mFe;for(const s of r)t=t.add(s);return t}const gFe=new ro(Cr);function _Fe(){return gFe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sj(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_k(t)?"-0":t}}function tre(r){return{integerValue:""+r}}function EFe(r,t){return HVe(t)?tre(t):sj(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(){this._=void 0}}function yFe(r,t,s){return r instanceof Tk?function(l,d){const f={fields:{[Une]:{stringValue:Mne},[Fne]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&ej(d)&&(d=pN(d)),d&&(f.fields[Vne]=d),{mapValue:f}}(s,t):r instanceof pR?rre(r,t):r instanceof fR?ire(r,t):function(l,d){const f=nre(l,d),E=FY(f)+FY(l.Ie);return UU(f)&&UU(l.Ie)?tre(E):sj(l.serializer,E)}(r,t)}function vFe(r,t,s){return r instanceof pR?rre(r,t):r instanceof fR?ire(r,t):s}function nre(r,t){return r instanceof bk?function(a){return UU(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class Tk extends gN{}class pR extends gN{constructor(t){super(),this.elements=t}}function rre(r,t){const s=sre(t);for(const a of r.elements)s.some(l=>Yh(l,a))||s.push(a);return{arrayValue:{values:s}}}class fR extends gN{constructor(t){super(),this.elements=t}}function ire(r,t){let s=sre(t);for(const a of r.elements)s=s.filter(l=>!Yh(l,a));return{arrayValue:{values:s}}}class bk extends gN{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function FY(r){return As(r.integerValue||r.doubleValue)}function sre(r){return tj(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function SFe(r,t){return r.field.isEqual(t.field)&&function(a,l){return a instanceof pR&&l instanceof pR||a instanceof fR&&l instanceof fR?t0(a.elements,l.elements,Yh):a instanceof bk&&l instanceof bk?Yh(a.Ie,l.Ie):a instanceof Tk&&l instanceof Tk}(r.transform,t.transform)}class TFe{constructor(t,s){this.version=t,this.transformResults=s}}class Hh{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new Hh}static exists(t){return new Hh(void 0,t)}static updateTime(t){return new Hh(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function FO(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class _N{}function ore(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new cre(r.key,Hh.none()):new WR(r.key,r.data,Hh.none());{const s=r.data,a=Fc.empty();let l=new ro(Qo.comparator);for(let d of t.fields)if(!l.has(d)){let f=s.field(d);f===null&&d.length>1&&(d=d.popLast(),f=s.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new Tg(r.key,a,new bl(l.toArray()),Hh.none())}}function bFe(r,t,s){r instanceof WR?function(l,d,f){const E=l.value.clone(),v=BY(l.fieldTransforms,d,f.transformResults);E.setAll(v),d.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(r,t,s):r instanceof Tg?function(l,d,f){if(!FO(l.precondition,d))return void d.convertToUnknownDocument(f.version);const E=BY(l.fieldTransforms,d,f.transformResults),v=d.data;v.setAll(are(l)),v.setAll(E),d.convertToFoundDocument(f.version,v).setHasCommittedMutations()}(r,t,s):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,t,s)}function Vw(r,t,s,a){return r instanceof WR?function(d,f,E,v){if(!FO(d.precondition,f))return E;const T=d.value.clone(),w=WY(d.fieldTransforms,v,f);return T.setAll(w),f.convertToFoundDocument(f.version,T).setHasLocalMutations(),null}(r,t,s,a):r instanceof Tg?function(d,f,E,v){if(!FO(d.precondition,f))return E;const T=WY(d.fieldTransforms,v,f),w=f.data;return w.setAll(are(d)),w.setAll(T),f.convertToFoundDocument(f.version,w).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(r,t,s,a):function(d,f,E){return FO(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):E}(r,t,s)}function wFe(r,t){let s=null;for(const a of r.fieldTransforms){const l=t.data.field(a.field),d=nre(a.transform,l||null);d!=null&&(s===null&&(s=Fc.empty()),s.set(a.field,d))}return s||null}function jY(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&t0(a,l,(d,f)=>SFe(d,f))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class WR extends _N{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Tg extends _N{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function are(r){const t=new Map;return r.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=r.data.field(s);t.set(s,a)}}),t}function BY(r,t,s){const a=new Map;ni(r.length===s.length);for(let l=0;l<s.length;l++){const d=r[l],f=d.transform,E=t.data.field(d.field);a.set(d.field,vFe(f,E,s[l]))}return a}function WY(r,t,s){const a=new Map;for(const l of r){const d=l.transform,f=s.data.field(l.field);a.set(l.field,yFe(d,f,t))}return a}class cre extends _N{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class RFe extends _N{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CFe{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&bFe(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=Vw(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=Vw(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=ere();return this.mutations.forEach(l=>{const d=t.get(l.key),f=d.overlayedDocument;let E=this.applyToLocalView(f,d.mutatedFields);E=s.has(l.key)?null:E;const v=ore(f,E);v!==null&&a.set(l.key,v),f.isValidDocument()||f.convertToNoDocument($n.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),vr())}isEqual(t){return this.batchId===t.batchId&&t0(this.mutations,t.mutations,(s,a)=>jY(s,a))&&t0(this.baseMutations,t.baseMutations,(s,a)=>jY(s,a))}}class oj{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){ni(t.mutations.length===a.length);let l=function(){return fFe}();const d=t.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new oj(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IFe{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AFe{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vs,Pr;function PFe(r){switch(r){case Tt.OK:return jn();case Tt.CANCELLED:case Tt.UNKNOWN:case Tt.DEADLINE_EXCEEDED:case Tt.RESOURCE_EXHAUSTED:case Tt.INTERNAL:case Tt.UNAVAILABLE:case Tt.UNAUTHENTICATED:return!1;case Tt.INVALID_ARGUMENT:case Tt.NOT_FOUND:case Tt.ALREADY_EXISTS:case Tt.PERMISSION_DENIED:case Tt.FAILED_PRECONDITION:case Tt.ABORTED:case Tt.OUT_OF_RANGE:case Tt.UNIMPLEMENTED:case Tt.DATA_LOSS:return!0;default:return jn()}}function lre(r){if(r===void 0)return wf("GRPC error has no .code"),Tt.UNKNOWN;switch(r){case Vs.OK:return Tt.OK;case Vs.CANCELLED:return Tt.CANCELLED;case Vs.UNKNOWN:return Tt.UNKNOWN;case Vs.DEADLINE_EXCEEDED:return Tt.DEADLINE_EXCEEDED;case Vs.RESOURCE_EXHAUSTED:return Tt.RESOURCE_EXHAUSTED;case Vs.INTERNAL:return Tt.INTERNAL;case Vs.UNAVAILABLE:return Tt.UNAVAILABLE;case Vs.UNAUTHENTICATED:return Tt.UNAUTHENTICATED;case Vs.INVALID_ARGUMENT:return Tt.INVALID_ARGUMENT;case Vs.NOT_FOUND:return Tt.NOT_FOUND;case Vs.ALREADY_EXISTS:return Tt.ALREADY_EXISTS;case Vs.PERMISSION_DENIED:return Tt.PERMISSION_DENIED;case Vs.FAILED_PRECONDITION:return Tt.FAILED_PRECONDITION;case Vs.ABORTED:return Tt.ABORTED;case Vs.OUT_OF_RANGE:return Tt.OUT_OF_RANGE;case Vs.UNIMPLEMENTED:return Tt.UNIMPLEMENTED;case Vs.DATA_LOSS:return Tt.DATA_LOSS;default:return jn()}}(Pr=Vs||(Vs={}))[Pr.OK=0]="OK",Pr[Pr.CANCELLED=1]="CANCELLED",Pr[Pr.UNKNOWN=2]="UNKNOWN",Pr[Pr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Pr[Pr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Pr[Pr.NOT_FOUND=5]="NOT_FOUND",Pr[Pr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Pr[Pr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Pr[Pr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Pr[Pr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Pr[Pr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Pr[Pr.ABORTED=10]="ABORTED",Pr[Pr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Pr[Pr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Pr[Pr.INTERNAL=13]="INTERNAL",Pr[Pr.UNAVAILABLE=14]="UNAVAILABLE",Pr[Pr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OFe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kFe=new rg([4294967295,4294967295],0);function zY(r){const t=OFe().encode(r),s=new Rne;return s.update(t),new Uint8Array(s.digest())}function GY(r){const t=new DataView(r.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new rg([s,a],0),new rg([l,d],0)]}class aj{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new yw(`Invalid padding: ${s}`);if(a<0)throw new yw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new yw(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new yw(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=rg.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(rg.fromNumber(a)));return l.compare(kFe)===1&&(l=new rg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=zY(t),[a,l]=GY(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),f=new aj(d,l,s);return a.forEach(E=>f.insert(E)),f}insert(t){if(this.Ee===0)return;const s=zY(t),[a,l]=GY(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class yw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,zR.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new EN($n.min(),l,new ts(Cr),Rf(),vr())}}class zR{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new zR(a,s,vr(),vr(),vr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jO{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class ure{constructor(t,s){this.targetId=t,this.ge=s}}class dre{constructor(t,s,a=Zo.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class HY{constructor(){this.pe=0,this.ye=$Y(),this.we=Zo.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.we=t)}Fe(){let t=vr(),s=vr(),a=vr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:jn()}}),new zR(this.we,this.be,t,s,a)}Me(){this.Se=!1,this.ye=$Y()}xe(t,s){this.Se=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.Se=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,ni(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class NFe{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Rf(),this.$e=sO(),this.Ke=sO(),this.Ue=new ts(Cr)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:jn()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(FU(d))if(a===0){const f=new Tn(d.path);this.ze(s,f,Aa.newNoDocument(f,$n.min()))}else ni(a===1);else{const f=this.et(s);if(f!==a){const E=this.tt(t),v=E?this.nt(E,t,f):1;if(v!==0){this.Ye(s);const T=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(s,T)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let f,E;try{f=fg(a).toUint8Array()}catch(v){if(v instanceof xne)return e0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{E=new aj(f,l,d)}catch(v){return e0(v instanceof yw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return E.Ee===0?null:E}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const f=this.ke.it(),E=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,f)=>{const E=this.Xe(f);if(E){if(d.current&&FU(E.target)){const v=new Tn(E.target.path);this._t(v).has(f)||this.ut(f,v)||this.ze(f,v,Aa.newNoDocument(v,t))}d.ve&&(s.set(f,d.Fe()),d.Me())}});let a=vr();this.Ke.forEach((d,f)=>{let E=!0;f.forEachWhile(v=>{const T=this.Xe(v);return!T||T.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(t));const l=new EN(t,s,this.Ue,this.Qe,a);return this.Qe=Rf(),this.$e=sO(),this.Ke=sO(),this.Ue=new ts(Cr),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ke=this.Ke.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ke=this.Ke.insert(s,this.ct(s).delete(t)),this.Ke=this.Ke.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new HY,this.qe.set(t,s)),s}ct(t){let s=this.Ke.get(t);return s||(s=new ro(Cr),this.Ke=this.Ke.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new ro(Cr),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||Qt("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new HY),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function sO(){return new ts(Tn.comparator)}function $Y(){return new ts(Tn.comparator)}const DFe={asc:"ASCENDING",desc:"DESCENDING"},LFe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xFe={and:"AND",or:"OR"};class MFe{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function WU(r,t){return r.useProto3Json||hN(t)?t:{value:t}}function wk(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function hre(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function UFe(r,t){return wk(r,t.toTimestamp())}function $h(r){return ni(!!r),$n.fromTimestamp(function(s){const a=pg(s);return new no(a.seconds,a.nanos)}(r))}function cj(r,t){return zU(r,t).canonicalString()}function zU(r,t){const s=function(l){return new Mi(["projects",l.projectId,"databases",l.database])}(r).child("documents");return t===void 0?s:s.child(t)}function pre(r){const t=Mi.fromString(r);return ni(Ere(t)),t}function GU(r,t){return cj(r.databaseId,t.path)}function f2(r,t){const s=pre(t);if(s.get(1)!==r.databaseId.projectId)throw new sn(Tt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+r.databaseId.projectId);if(s.get(3)!==r.databaseId.database)throw new sn(Tt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+r.databaseId.database);return new Tn(mre(s))}function fre(r,t){return cj(r.databaseId,t)}function VFe(r){const t=pre(r);return t.length===4?Mi.emptyPath():mre(t)}function HU(r){return new Mi(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function mre(r){return ni(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function KY(r,t,s){return{name:GU(r,t),fields:s.value.mapValue.fields}}function FFe(r,t){let s;if("targetChange"in t){t.targetChange;const a=function(T){return T==="NO_CHANGE"?0:T==="ADD"?1:T==="REMOVE"?2:T==="CURRENT"?3:T==="RESET"?4:jn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(T,w){return T.useProto3Json?(ni(w===void 0||typeof w=="string"),Zo.fromBase64String(w||"")):(ni(w===void 0||w instanceof Buffer||w instanceof Uint8Array),Zo.fromUint8Array(w||new Uint8Array))}(r,t.targetChange.resumeToken),f=t.targetChange.cause,E=f&&function(T){const w=T.code===void 0?Tt.UNKNOWN:lre(T.code);return new sn(w,T.message||"")}(f);s=new dre(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=f2(r,a.document.name),d=$h(a.document.updateTime),f=a.document.createTime?$h(a.document.createTime):$n.min(),E=new Fc({mapValue:{fields:a.document.fields}}),v=Aa.newFoundDocument(l,d,f,E),T=a.targetIds||[],w=a.removedTargetIds||[];s=new jO(T,w,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=f2(r,a.document),d=a.readTime?$h(a.readTime):$n.min(),f=Aa.newNoDocument(l,d),E=a.removedTargetIds||[];s=new jO([],E,f.key,f)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=f2(r,a.document),d=a.removedTargetIds||[];s=new jO([],d,l,null)}else{if(!("filter"in t))return jn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new AFe(l,d),E=a.targetId;s=new ure(E,f)}}return s}function jFe(r,t){let s;if(t instanceof WR)s={update:KY(r,t.key,t.value)};else if(t instanceof cre)s={delete:GU(r,t.key)};else if(t instanceof Tg)s={update:KY(r,t.key,t.data),updateMask:YFe(t.fieldMask)};else{if(!(t instanceof RFe))return jn();s={verify:GU(r,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,f){const E=f.transform;if(E instanceof Tk)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof pR)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof fR)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof bk)return{fieldPath:f.field.canonicalString(),increment:E.Ie};throw jn()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:UFe(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:jn()}(r,t.precondition)),s}function BFe(r,t){return r&&r.length>0?(ni(t!==void 0),r.map(s=>function(l,d){let f=l.updateTime?$h(l.updateTime):$h(d);return f.isEqual($n.min())&&(f=$h(d)),new TFe(f,l.transformResults||[])}(s,t))):[]}function WFe(r,t){return{documents:[fre(r,t.path)]}}function zFe(r,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=fre(r,l);const d=function(T){if(T.length!==0)return _re(wd.create(T,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const f=function(T){if(T.length!==0)return T.map(w=>function(N){return{field:oS(N.field),direction:$Fe(N.dir)}}(w))}(t.orderBy);f&&(s.structuredQuery.orderBy=f);const E=WU(r,t.limit);return E!==null&&(s.structuredQuery.limit=E),t.startAt&&(s.structuredQuery.startAt=function(T){return{before:T.inclusive,values:T.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(T){return{before:!T.inclusive,values:T.position}}(t.endAt)),{ht:s,parent:l}}function GFe(r){let t=VFe(r.parent);const s=r.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){ni(a===1);const w=s.from[0];w.allDescendants?l=w.collectionId:t=t.child(w.collectionId)}let d=[];s.where&&(d=function(I){const N=gre(I);return N instanceof wd&&Hne(N)?N.getFilters():[N]}(s.where));let f=[];s.orderBy&&(f=function(I){return I.map(N=>function(j){return new Sk(aS(j.field),function(H){switch(H){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(N))}(s.orderBy));let E=null;s.limit&&(E=function(I){let N;return N=typeof I=="object"?I.value:I,hN(N)?null:N}(s.limit));let v=null;s.startAt&&(v=function(I){const N=!!I.before,F=I.values||[];return new vk(F,N)}(s.startAt));let T=null;return s.endAt&&(T=function(I){const N=!I.before,F=I.values||[];return new vk(F,N)}(s.endAt)),lFe(t,l,f,d,E,"F",v,T)}function HFe(r,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return jn()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function gre(r){return r.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=aS(s.unaryFilter.field);return zs.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=aS(s.unaryFilter.field);return zs.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=aS(s.unaryFilter.field);return zs.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=aS(s.unaryFilter.field);return zs.create(f,"!=",{nullValue:"NULL_VALUE"});default:return jn()}}(r):r.fieldFilter!==void 0?function(s){return zs.create(aS(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return jn()}}(s.fieldFilter.op),s.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(s){return wd.create(s.compositeFilter.filters.map(a=>gre(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return jn()}}(s.compositeFilter.op))}(r):jn()}function $Fe(r){return DFe[r]}function KFe(r){return LFe[r]}function qFe(r){return xFe[r]}function oS(r){return{fieldPath:r.canonicalString()}}function aS(r){return Qo.fromServerFormat(r.fieldPath)}function _re(r){return r instanceof zs?function(s){if(s.op==="=="){if(LY(s.value))return{unaryFilter:{field:oS(s.field),op:"IS_NAN"}};if(DY(s.value))return{unaryFilter:{field:oS(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(LY(s.value))return{unaryFilter:{field:oS(s.field),op:"IS_NOT_NAN"}};if(DY(s.value))return{unaryFilter:{field:oS(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oS(s.field),op:KFe(s.op),value:s.value}}}(r):r instanceof wd?function(s){const a=s.getFilters().map(l=>_re(l));return a.length===1?a[0]:{compositeFilter:{op:qFe(s.op),filters:a}}}(r):jn()}function YFe(r){const t=[];return r.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function Ere(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(t,s,a,l,d=$n.min(),f=$n.min(),E=Zo.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=E,this.expectedCount=v}withSequenceNumber(t){return new Qm(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new Qm(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Qm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Qm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XFe{constructor(t){this.Tt=t}}function JFe(r){const t=GFe({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?BU(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QFe{constructor(){this.Tn=new ZFe}addToCollectionParentIndex(t,s){return this.Tn.add(s),St.resolve()}getCollectionParents(t,s){return St.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return St.resolve()}deleteFieldIndex(t,s){return St.resolve()}deleteAllFieldIndexes(t){return St.resolve()}createTargetIndexes(t,s){return St.resolve()}getDocumentsMatchingTarget(t,s){return St.resolve(null)}getIndexType(t,s){return St.resolve(0)}getFieldIndexes(t,s){return St.resolve([])}getNextCollectionGroupToUpdate(t){return St.resolve(null)}getMinOffset(t,s){return St.resolve(hg.min())}getMinOffsetFromCollectionGroup(t,s){return St.resolve(hg.min())}updateCollectionGroup(t,s,a){return St.resolve()}updateIndexEntries(t,s){return St.resolve()}}class ZFe{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new ro(Mi.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new ro(Mi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qY={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},yre=41943040;class Uc{static withCacheSize(t){return new Uc(t,Uc.DEFAULT_COLLECTION_PERCENTILE,Uc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Uc.DEFAULT_COLLECTION_PERCENTILE=10,Uc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Uc.DEFAULT=new Uc(yre,Uc.DEFAULT_COLLECTION_PERCENTILE,Uc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Uc.DISABLED=new Uc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Kn(){return new i0(0)}static Un(){return new i0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YY="LruGarbageCollector",eje=1048576;function XY([r,t],[s,a]){const l=Cr(r,s);return l===0?Cr(t,a):l}class tje{constructor(t){this.Hn=t,this.buffer=new ro(XY),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();XY(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class nje{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){Qt(YY,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){y0(s)?Qt(YY,"Ignoring IndexedDB error during garbage collection: ",s):await E0(s)}await this.er(3e5)})}}class rje{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return St.resolve(dN.ae);const a=new tje(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(Qt("LruGarbageCollector","Garbage collection skipped; disabled"),St.resolve(qY)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(Qt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qY):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,f,E,v,T;const w=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(Qt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(t,l))).next(I=>(a=I,E=Date.now(),this.removeTargets(t,a,s))).next(I=>(d=I,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(I=>(T=Date.now(),iS()<=yr.DEBUG&&Qt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-w}ms
	Determined least recently used ${l} in `+(E-f)+`ms
	Removed ${d} targets in `+(v-E)+`ms
	Removed ${I} documents in `+(T-v)+`ms
Total Duration: ${T-w}ms`),St.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function ije(r,t){return new rje(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sje{constructor(){this.changes=new OE(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,Aa.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?St.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oje{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aje{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&Vw(a.mutation,l,bl.empty(),no.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,vr()).next(()=>a))}getLocalViewOfDocuments(t,s,a=vr()){const l=nE();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let f=Ew();return d.forEach((E,v)=>{f=f.insert(E,v.overlayedDocument)}),f}))}getOverlayedDocuments(t,s){const a=nE();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,vr()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((f,E)=>{s.set(f,E)})})}computeViews(t,s,a,l){let d=Rf();const f=Uw(),E=function(){return Uw()}();return s.forEach((v,T)=>{const w=a.get(T.key);l.has(T.key)&&(w===void 0||w.mutation instanceof Tg)?d=d.insert(T.key,T):w!==void 0?(f.set(T.key,w.mutation.getFieldMask()),Vw(w.mutation,T,w.mutation.getFieldMask(),no.now())):f.set(T.key,bl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((T,w)=>f.set(T,w)),s.forEach((T,w)=>{var I;return E.set(T,new oje(w,(I=f.get(T))!==null&&I!==void 0?I:null))}),E))}recalculateAndSaveOverlays(t,s){const a=Uw();let l=new ts((f,E)=>f-E),d=vr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(f=>{for(const E of f)E.keys().forEach(v=>{const T=s.get(v);if(T===null)return;let w=a.get(v)||bl.empty();w=E.applyToLocalView(T,w),a.set(v,w);const I=(l.get(E.batchId)||vr()).add(v);l=l.insert(E.batchId,I)})}).next(()=>{const f=[],E=l.getReverseIterator();for(;E.hasNext();){const v=E.getNext(),T=v.key,w=v.value,I=ere();w.forEach(N=>{if(!d.has(N)){const F=ore(s.get(N),a.get(N));F!==null&&I.set(N,F),d=d.add(N)}}),f.push(this.documentOverlayCache.saveOverlays(t,T,I))}return St.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(f){return Tn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):Yne(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):St.resolve(nE());let E=lR,v=d;return f.next(T=>St.forEach(T,(w,I)=>(E<I.largestBatchId&&(E=I.largestBatchId),d.get(w)?St.resolve():this.remoteDocumentCache.getEntry(t,w).next(N=>{v=v.insert(w,N)}))).next(()=>this.populateOverlays(t,T,d)).next(()=>this.computeViews(t,v,T,vr())).next(w=>({batchId:E,changes:Zne(w)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new Tn(s)).next(a=>{let l=Ew();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let f=Ew();return this.indexManager.getCollectionParents(t,d).next(E=>St.forEach(E,v=>{const T=function(I,N){return new BR(N,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(s,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,T,a,l).next(w=>{w.forEach((I,N)=>{f=f.insert(I,N)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(f=>{d.forEach((v,T)=>{const w=T.getKey();f.get(w)===null&&(f=f.insert(w,Aa.newInvalidDocument(w)))});let E=Ew();return f.forEach((v,T)=>{const w=d.get(v);w!==void 0&&Vw(w.mutation,T,bl.empty(),no.now()),mN(s,T)&&(E=E.insert(v,T))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cje{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return St.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:$h(l.createTime)}}(s)),St.resolve()}getNamedQuery(t,s){return St.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:JFe(l.bundledQuery),readTime:$h(l.readTime)}}(s)),St.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lje{constructor(){this.overlays=new ts(Tn.comparator),this.Rr=new Map}getOverlay(t,s){return St.resolve(this.overlays.get(s))}getOverlays(t,s){const a=nE();return St.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),St.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),St.resolve()}getOverlaysForCollection(t,s,a){const l=nE(),d=s.length+1,f=new Tn(s.child("")),E=this.overlays.getIteratorFrom(f);for(;E.hasNext();){const v=E.getNext().value,T=v.getKey();if(!s.isPrefixOf(T.path))break;T.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return St.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new ts((T,w)=>T-w);const f=this.overlays.getIterator();for(;f.hasNext();){const T=f.getNext().value;if(T.getKey().getCollectionGroup()===s&&T.largestBatchId>a){let w=d.get(T.largestBatchId);w===null&&(w=nE(),d=d.insert(T.largestBatchId,w)),w.set(T.getKey(),T)}}const E=nE(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((T,w)=>E.set(T,w)),!(E.size()>=l)););return St.resolve(E)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new IFe(s,a));let d=this.Rr.get(s);d===void 0&&(d=vr(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uje{constructor(){this.sessionToken=Zo.EMPTY_BYTE_STRING}getSessionToken(t){return St.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,St.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lj{constructor(){this.Vr=new ro(So.mr),this.gr=new ro(So.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new So(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new So(t,s))}br(t,s){t.forEach(a=>this.removeReference(a,s))}Sr(t){const s=new Tn(new Mi([])),a=new So(s,t),l=new So(s,t+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new Tn(new Mi([])),a=new So(s,t),l=new So(s,t+1);let d=vr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(t){const s=new So(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class So{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return Tn.comparator(t.key,s.key)||Cr(t.Cr,s.Cr)}static pr(t,s){return Cr(t.Cr,s.Cr)||Tn.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dje{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new ro(So.mr)}checkEmpty(t){return St.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new CFe(d,s,a,l);this.mutationQueue.push(f);for(const E of l)this.Mr=this.Mr.add(new So(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return St.resolve(f)}lookupMutationBatch(t,s){return St.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return St.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return St.resolve(this.mutationQueue.length===0?ZF:this.Fr-1)}getAllMutationBatches(t){return St.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new So(s,0),l=new So(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const E=this.Or(f.Cr);d.push(E)}),St.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new ro(Cr);return s.forEach(l=>{const d=new So(l,0),f=new So(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],E=>{a=a.add(E.Cr)})}),St.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;Tn.isDocumentKey(d)||(d=d.child(""));const f=new So(new Tn(d),0);let E=new ro(Cr);return this.Mr.forEachWhile(v=>{const T=v.key.path;return!!a.isPrefixOf(T)&&(T.length===l&&(E=E.add(v.Cr)),!0)},f),St.resolve(this.Br(E))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){ni(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return St.forEach(s.mutations,l=>{const d=new So(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new So(s,0),l=this.Mr.firstAfterOrEqual(a);return St.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,St.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hje{constructor(t){this.kr=t,this.docs=function(){return new ts(Tn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return St.resolve(a?a.document.mutableCopy():Aa.newInvalidDocument(s))}getEntries(t,s){let a=Rf();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Aa.newInvalidDocument(l))}),St.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=Rf();const f=s.path,E=new Tn(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(E);for(;v.hasNext();){const{key:T,value:{document:w}}=v.getNext();if(!f.isPrefixOf(T.path))break;T.path.length>f.length+1||BVe(jVe(w),a)<=0||(l.has(w.key)||mN(s,w))&&(d=d.insert(w.key,w.mutableCopy()))}return St.resolve(d)}getAllFromCollectionGroup(t,s,a,l){jn()}qr(t,s){return St.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new pje(this)}getSize(t){return St.resolve(this.size)}}class pje extends sje{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),St.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fje{constructor(t){this.persistence=t,this.Qr=new OE(s=>nj(s),rj),this.lastRemoteSnapshotVersion=$n.min(),this.highestTargetId=0,this.$r=0,this.Kr=new lj,this.targetCount=0,this.Ur=i0.Kn()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),St.resolve()}getLastRemoteSnapshotVersion(t){return St.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return St.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Ur.next(),St.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),St.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Ur=new i0(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,St.resolve()}updateTargetData(t,s){return this.zn(s),St.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Kr.Sr(s.targetId),this.targetCount-=1,St.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((f,E)=>{E.sequenceNumber<=s&&a.get(E.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),St.waitFor(d).next(()=>l)}getTargetCount(t){return St.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return St.resolve(a)}addMatchingKeys(t,s,a){return this.Kr.yr(s,a),St.resolve()}removeMatchingKeys(t,s,a){this.Kr.br(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(f=>{d.push(l.markPotentiallyOrphaned(t,f))}),St.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Kr.Sr(s),St.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Kr.vr(s);return St.resolve(a)}containsKey(t,s){return St.resolve(this.Kr.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vre{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new dN(0),this.zr=!1,this.zr=!0,this.jr=new uje,this.referenceDelegate=t(this),this.Hr=new fje(this),this.indexManager=new QFe,this.remoteDocumentCache=function(l){return new hje(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new XFe(s),this.Yr=new cje(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new lje,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new dje(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){Qt("MemoryPersistence","Starting transaction:",t);const l=new mje(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return St.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class mje extends zVe{constructor(t){super(),this.currentSequenceNumber=t}}class uj{constructor(t){this.persistence=t,this.ti=new lj,this.ni=null}static ri(t){return new uj(t)}get ii(){if(this.ni)return this.ni;throw jn()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),St.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),St.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),St.resolve()}removeTarget(t,s){this.ti.Sr(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return St.forEach(this.ii,a=>{const l=Tn.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,$n.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return St.or([()=>St.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class Rk{constructor(t,s){this.persistence=t,this.oi=new OE(a=>$Ve(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=ije(this,s)}static ri(t,s){return new Rk(t,s)}Zr(){}Xr(t){return St.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return St.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?St.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,f=>this.ar(t,f,s).next(E=>{E||(a++,d.removeEntry(f,$n.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),St.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),St.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),St.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),St.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=UO(t.data.value)),s}ar(t,s,a){return St.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return St.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dj{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=vr(),l=vr();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new dj(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gje{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _je{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return Jxe()?8:GVe(Oa())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new gje;return this._s(t,s,f).next(E=>{if(d.result=E,this.Xi)return this.us(t,s,f,E.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(iS()<=yr.DEBUG&&Qt("QueryEngine","SDK will not create cache indexes for query:",sS(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),St.resolve()):(iS()<=yr.DEBUG&&Qt("QueryEngine","Query:",sS(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(iS()<=yr.DEBUG&&Qt("QueryEngine","The SDK decides to create cache indexes for query:",sS(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Gh(s))):St.resolve())}rs(t,s){if(VY(s))return St.resolve(null);let a=Gh(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=BU(s,null,"F"),a=Gh(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const f=vr(...d);return this.ns.getDocuments(t,f).next(E=>this.indexManager.getMinOffset(t,a).next(v=>{const T=this.cs(s,E);return this.ls(s,T,f,v.readTime)?this.rs(t,BU(s,null,"F")):this.hs(t,T,s,v)}))})))}ss(t,s,a,l){return VY(s)||l.isEqual($n.min())?St.resolve(null):this.ns.getDocuments(t,a).next(d=>{const f=this.cs(s,d);return this.ls(s,f,a,l)?St.resolve(null):(iS()<=yr.DEBUG&&Qt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),sS(s)),this.hs(t,f,s,FVe(l,lR)).next(E=>E))})}cs(t,s){let a=new ro(Jne(t));return s.forEach((l,d)=>{mN(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return iS()<=yr.DEBUG&&Qt("QueryEngine","Using full collection scan to execute query:",sS(s)),this.ns.getDocumentsMatchingQuery(t,s,hg.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hj="LocalStore",Eje=3e8;class yje{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new ts(Cr),this.Is=new OE(d=>nj(d),rj),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new aje(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function vje(r,t,s,a){return new yje(r,t,s,a)}async function Sre(r,t){const s=Xn(r);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],E=[];let v=vr();for(const T of l){f.push(T.batchId);for(const w of T.mutations)v=v.add(w.key)}for(const T of d){E.push(T.batchId);for(const w of T.mutations)v=v.add(w.key)}return s.localDocuments.getDocuments(a,v).next(T=>({Rs:T,removedBatchIds:f,addedBatchIds:E}))})})}function Sje(r,t){const s=Xn(r);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(E,v,T,w){const I=T.batch,N=I.keys();let F=St.resolve();return N.forEach(j=>{F=F.next(()=>w.getEntry(v,j)).next(G=>{const H=T.docVersions.get(j);ni(H!==null),G.version.compareTo(H)<0&&(I.applyToRemoteDocument(G,T),G.isValidDocument()&&(G.setReadTime(T.commitVersion),w.addEntry(G)))})}),F.next(()=>E.mutationQueue.removeMutationBatch(v,I))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let v=vr();for(let T=0;T<E.mutationResults.length;++T)E.mutationResults[T].transformResults.length>0&&(v=v.add(E.batch.mutations[T].key));return v}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function Tre(r){const t=Xn(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function Tje(r,t){const s=Xn(r),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const E=[];t.targetChanges.forEach((w,I)=>{const N=l.get(I);if(!N)return;E.push(s.Hr.removeMatchingKeys(d,w.removedDocuments,I).next(()=>s.Hr.addMatchingKeys(d,w.addedDocuments,I)));let F=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(I)!==null?F=F.withResumeToken(Zo.EMPTY_BYTE_STRING,$n.min()).withLastLimboFreeSnapshotVersion($n.min()):w.resumeToken.approximateByteSize()>0&&(F=F.withResumeToken(w.resumeToken,a)),l=l.insert(I,F),function(G,H,te){return G.resumeToken.approximateByteSize()===0||H.snapshotVersion.toMicroseconds()-G.snapshotVersion.toMicroseconds()>=Eje?!0:te.addedDocuments.size+te.modifiedDocuments.size+te.removedDocuments.size>0}(N,F,w)&&E.push(s.Hr.updateTargetData(d,F))});let v=Rf(),T=vr();if(t.documentUpdates.forEach(w=>{t.resolvedLimboDocuments.has(w)&&E.push(s.persistence.referenceDelegate.updateLimboDocument(d,w))}),E.push(bje(d,f,t.documentUpdates).next(w=>{v=w.Vs,T=w.fs})),!a.isEqual($n.min())){const w=s.Hr.getLastRemoteSnapshotVersion(d).next(I=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(w)}return St.waitFor(E).next(()=>f.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,v,T)).next(()=>v)}).then(d=>(s.Ts=l,d))}function bje(r,t,s){let a=vr(),l=vr();return s.forEach(d=>a=a.add(d)),t.getEntries(r,a).next(d=>{let f=Rf();return s.forEach((E,v)=>{const T=d.get(E);v.isFoundDocument()!==T.isFoundDocument()&&(l=l.add(E)),v.isNoDocument()&&v.version.isEqual($n.min())?(t.removeEntry(E,v.readTime),f=f.insert(E,v)):!T.isValidDocument()||v.version.compareTo(T.version)>0||v.version.compareTo(T.version)===0&&T.hasPendingWrites?(t.addEntry(v),f=f.insert(E,v)):Qt(hj,"Ignoring outdated watch update for ",E,". Current version:",T.version," Watch version:",v.version)}),{Vs:f,fs:l}})}function wje(r,t){const s=Xn(r);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=ZF),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function Rje(r,t){const s=Xn(r);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,St.resolve(l)):s.Hr.allocateTargetId(a).next(f=>(l=new Qm(t,f,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function $U(r,t,s){const a=Xn(r),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!y0(f))throw f;Qt(hj,`Failed to update sequence numbers for target ${t}: ${f}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function JY(r,t,s){const a=Xn(r);let l=$n.min(),d=vr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(v,T,w){const I=Xn(v),N=I.Is.get(w);return N!==void 0?St.resolve(I.Ts.get(N)):I.Hr.getTargetData(T,w)}(a,f,Gh(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,E.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,t,s?l:$n.min(),s?d:vr())).next(E=>(Cje(a,dFe(t),E),{documents:E,gs:d})))}function Cje(r,t,s){let a=r.Es.get(t)||$n.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),r.Es.set(t,a)}class QY{constructor(){this.activeTargetIds=_Fe()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ije{constructor(){this.ho=new QY,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new QY,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aje{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZY="ConnectivityMonitor";class eX{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Qt(ZY,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){Qt(ZY,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oO=null;function KU(){return oO===null?oO=function(){return 268435456+Math.round(2147483648*Math.random())}():oO++,"0x"+oO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m2="RestConnection",Pje={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Oje{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===Ek?`project_id=${a}`:`project_id=${a}&database_id=${l}`}bo(t,s,a,l,d){const f=KU(),E=this.So(t,s.toUriEncodedString());Qt(m2,`Sending RPC '${t}' ${f}:`,E,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,E,v,a).then(T=>(Qt(m2,`Received RPC '${t}' ${f}: `,T),T),T=>{throw e0(m2,`RPC '${t}' ${f} failed with error: `,T,"url: ",E,"request:",a),T})}Co(t,s,a,l,d,f){return this.bo(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+_0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}So(t,s){const a=Pje[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kje{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Ko(t){this.ko(t)}Uo(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ta="WebChannelConnection";class Nje extends Oje{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=KU();return new Promise((f,E)=>{const v=new Cne;v.setWithCredentials(!0),v.listenOnce(Ine.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case MO.NO_ERROR:const w=v.getResponseJson();Qt(Ta,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(w)),f(w);break;case MO.TIMEOUT:Qt(Ta,`RPC '${t}' ${d} timed out`),E(new sn(Tt.DEADLINE_EXCEEDED,"Request time out"));break;case MO.HTTP_ERROR:const I=v.getStatus();if(Qt(Ta,`RPC '${t}' ${d} failed with status:`,I,"response text:",v.getResponseText()),I>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const F=N==null?void 0:N.error;if(F&&F.status&&F.message){const j=function(H){const te=H.toLowerCase().replace(/_/g,"-");return Object.values(Tt).indexOf(te)>=0?te:Tt.UNKNOWN}(F.status);E(new sn(j,F.message))}else E(new sn(Tt.UNKNOWN,"Server responded with status "+v.getStatus()))}else E(new sn(Tt.UNAVAILABLE,"Connection failed."));break;default:jn()}}finally{Qt(Ta,`RPC '${t}' ${d} completed.`)}});const T=JSON.stringify(l);Qt(Ta,`RPC '${t}' ${d} sending request:`,l),v.send(s,"POST",T,a,15)})}Wo(t,s,a){const l=KU(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],f=One(),E=Pne(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},T=this.longPollingOptions.timeoutSeconds;T!==void 0&&(v.longPollingTimeout=Math.round(1e3*T)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,s,a),v.encodeInitMessageHeaders=!0;const w=d.join("");Qt(Ta,`Creating RPC '${t}' stream ${l}: ${w}`,v);const I=f.createWebChannel(w,v);let N=!1,F=!1;const j=new kje({Fo:H=>{F?Qt(Ta,`Not sending because RPC '${t}' stream ${l} is closed:`,H):(N||(Qt(Ta,`Opening RPC '${t}' stream ${l} transport.`),I.open(),N=!0),Qt(Ta,`RPC '${t}' stream ${l} sending:`,H),I.send(H))},Mo:()=>I.close()}),G=(H,te,K)=>{H.listen(te,Q=>{try{K(Q)}catch(de){setTimeout(()=>{throw de},0)}})};return G(I,_w.EventType.OPEN,()=>{F||(Qt(Ta,`RPC '${t}' stream ${l} transport opened.`),j.Qo())}),G(I,_w.EventType.CLOSE,()=>{F||(F=!0,Qt(Ta,`RPC '${t}' stream ${l} transport closed`),j.Ko())}),G(I,_w.EventType.ERROR,H=>{F||(F=!0,e0(Ta,`RPC '${t}' stream ${l} transport errored:`,H),j.Ko(new sn(Tt.UNAVAILABLE,"The operation could not be completed")))}),G(I,_w.EventType.MESSAGE,H=>{var te;if(!F){const K=H.data[0];ni(!!K);const Q=K,de=(Q==null?void 0:Q.error)||((te=Q[0])===null||te===void 0?void 0:te.error);if(de){Qt(Ta,`RPC '${t}' stream ${l} received error:`,de);const se=de.status;let ge=function(ne){const ae=Vs[ne];if(ae!==void 0)return lre(ae)}(se),ee=de.message;ge===void 0&&(ge=Tt.INTERNAL,ee="Unknown error status: "+se+" with message "+de.message),F=!0,j.Ko(new sn(ge,ee)),I.close()}else Qt(Ta,`RPC '${t}' stream ${l} received:`,K),j.Uo(K)}}),G(E,Ane.STAT_EVENT,H=>{H.stat===xU.PROXY?Qt(Ta,`RPC '${t}' stream ${l} detected buffering proxy`):H.stat===xU.NOPROXY&&Qt(Ta,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{j.$o()},0),j}}function g2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yN(r){return new MFe(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bre{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&Qt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tX="PersistentStream";class wre{constructor(t,s,a,l,d,f,E,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=E,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new bre(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===Tt.RESOURCE_EXHAUSTED?(wf(s.toString()),wf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===Tt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new sn(Tt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return Qt(tX,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(Qt(tX,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Dje extends wre{constructor(t,s,a,l,d,f){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=FFe(this.serializer,t),a=function(d){if(!("targetChange"in d))return $n.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?$n.min():f.readTime?$h(f.readTime):$n.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=HU(this.serializer),s.addTarget=function(d,f){let E;const v=f.target;if(E=FU(v)?{documents:WFe(d,v)}:{query:zFe(d,v).ht},E.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){E.resumeToken=hre(d,f.resumeToken);const T=WU(d,f.expectedCount);T!==null&&(E.expectedCount=T)}else if(f.snapshotVersion.compareTo($n.min())>0){E.readTime=wk(d,f.snapshotVersion.toTimestamp());const T=WU(d,f.expectedCount);T!==null&&(E.expectedCount=T)}return E}(this.serializer,t);const a=HFe(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=HU(this.serializer),s.removeTarget=t,this.I_(s)}}class Lje extends wre{constructor(t,s,a,l,d,f){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return ni(!!t.streamToken),this.lastStreamToken=t.streamToken,ni(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){ni(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=BFe(t.writeResults,t.commitTime),a=$h(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=HU(this.serializer),this.I_(t)}S_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>jFe(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xje{}class Mje extends xje{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new sn(Tt.FAILED_PRECONDITION,"The client has already been terminated.")}bo(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.bo(t,zU(s,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===Tt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new sn(Tt.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,E])=>this.connection.Co(t,zU(s,a),l,f,E,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Tt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new sn(Tt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class Uje{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(wf(s),this.N_=!1):Qt("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RE="RemoteStore";class Vje{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{kE(this)&&(Qt(RE,"Restarting streams for network reachability change."),await async function(v){const T=Xn(v);T.W_.add(4),await GR(T),T.j_.set("Unknown"),T.W_.delete(4),await vN(T)}(this))})}),this.j_=new Uje(a,l)}}async function vN(r){if(kE(r))for(const t of r.G_)await t(!0)}async function GR(r){for(const t of r.G_)await t(!1)}function Rre(r,t){const s=Xn(r);s.U_.has(t.targetId)||(s.U_.set(t.targetId,t),gj(s)?mj(s):v0(s).c_()&&fj(s,t))}function pj(r,t){const s=Xn(r),a=v0(s);s.U_.delete(t),a.c_()&&Cre(s,t),s.U_.size===0&&(a.c_()?a.P_():kE(s)&&s.j_.set("Unknown"))}function fj(r,t){if(r.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo($n.min())>0){const s=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}v0(r).y_(t)}function Cre(r,t){r.H_.Ne(t),v0(r).w_(t)}function mj(r){r.H_=new NFe({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>r.U_.get(t)||null,it:()=>r.datastore.serializer.databaseId}),v0(r).start(),r.j_.B_()}function gj(r){return kE(r)&&!v0(r).u_()&&r.U_.size>0}function kE(r){return Xn(r).W_.size===0}function Ire(r){r.H_=void 0}async function Fje(r){r.j_.set("Online")}async function jje(r){r.U_.forEach((t,s)=>{fj(r,t)})}async function Bje(r,t){Ire(r),gj(r)?(r.j_.q_(t),mj(r)):r.j_.set("Unknown")}async function Wje(r,t,s){if(r.j_.set("Online"),t instanceof dre&&t.state===2&&t.cause)try{await async function(l,d){const f=d.cause;for(const E of d.targetIds)l.U_.has(E)&&(await l.remoteSyncer.rejectListen(E,f),l.U_.delete(E),l.H_.removeTarget(E))}(r,t)}catch(a){Qt(RE,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await Ck(r,a)}else if(t instanceof jO?r.H_.We(t):t instanceof ure?r.H_.Ze(t):r.H_.je(t),!s.isEqual($n.min()))try{const a=await Tre(r.localStore);s.compareTo(a)>=0&&await function(d,f){const E=d.H_.ot(f);return E.targetChanges.forEach((v,T)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.U_.get(T);w&&d.U_.set(T,w.withResumeToken(v.resumeToken,f))}}),E.targetMismatches.forEach((v,T)=>{const w=d.U_.get(v);if(!w)return;d.U_.set(v,w.withResumeToken(Zo.EMPTY_BYTE_STRING,w.snapshotVersion)),Cre(d,v);const I=new Qm(w.target,v,T,w.sequenceNumber);fj(d,I)}),d.remoteSyncer.applyRemoteEvent(E)}(r,s)}catch(a){Qt(RE,"Failed to raise snapshot:",a),await Ck(r,a)}}async function Ck(r,t,s){if(!y0(t))throw t;r.W_.add(1),await GR(r),r.j_.set("Offline"),s||(s=()=>Tre(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Qt(RE,"Retrying IndexedDB access"),await s(),r.W_.delete(1),await vN(r)})}function Are(r,t){return t().catch(s=>Ck(r,s,t))}async function SN(r){const t=Xn(r),s=gg(t);let a=t.K_.length>0?t.K_[t.K_.length-1].batchId:ZF;for(;zje(t);)try{const l=await wje(t.localStore,a);if(l===null){t.K_.length===0&&s.P_();break}a=l.batchId,Gje(t,l)}catch(l){await Ck(t,l)}Pre(t)&&Ore(t)}function zje(r){return kE(r)&&r.K_.length<10}function Gje(r,t){r.K_.push(t);const s=gg(r);s.c_()&&s.b_&&s.S_(t.mutations)}function Pre(r){return kE(r)&&!gg(r).u_()&&r.K_.length>0}function Ore(r){gg(r).start()}async function Hje(r){gg(r).C_()}async function $je(r){const t=gg(r);for(const s of r.K_)t.S_(s.mutations)}async function Kje(r,t,s){const a=r.K_.shift(),l=oj.from(a,t,s);await Are(r,()=>r.remoteSyncer.applySuccessfulWrite(l)),await SN(r)}async function qje(r,t){t&&gg(r).b_&&await async function(a,l){if(function(f){return PFe(f)&&f!==Tt.ABORTED}(l.code)){const d=a.K_.shift();gg(a).h_(),await Are(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await SN(a)}}(r,t),Pre(r)&&Ore(r)}async function nX(r,t){const s=Xn(r);s.asyncQueue.verifyOperationInProgress(),Qt(RE,"RemoteStore received new credentials");const a=kE(s);s.W_.add(3),await GR(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await vN(s)}async function Yje(r,t){const s=Xn(r);t?(s.W_.delete(2),await vN(s)):t||(s.W_.add(2),await GR(s),s.j_.set("Unknown"))}function v0(r){return r.J_||(r.J_=function(s,a,l){const d=Xn(s);return d.M_(),new Dje(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{xo:Fje.bind(null,r),No:jje.bind(null,r),Lo:Bje.bind(null,r),p_:Wje.bind(null,r)}),r.G_.push(async t=>{t?(r.J_.h_(),gj(r)?mj(r):r.j_.set("Unknown")):(await r.J_.stop(),Ire(r))})),r.J_}function gg(r){return r.Y_||(r.Y_=function(s,a,l){const d=Xn(s);return d.M_(),new Lje(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:Hje.bind(null,r),Lo:qje.bind(null,r),D_:$je.bind(null,r),v_:Kje.bind(null,r)}),r.G_.push(async t=>{t?(r.Y_.h_(),await SN(r)):(await r.Y_.stop(),r.K_.length>0&&(Qt(RE,`Stopping write stream with ${r.K_.length} pending writes`),r.K_=[]))})),r.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _j{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new _f,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const f=Date.now()+a,E=new _j(t,s,f,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new sn(Tt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ej(r,t){if(wf("AsyncQueue",`${t}: ${r}`),y0(r))return new sn(Tt.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS{static emptySet(t){return new MS(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||Tn.comparator(s.key,a.key):(s,a)=>Tn.comparator(s.key,a.key),this.keyedMap=Ew(),this.sortedSet=new ts(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof MS)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new MS;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rX{constructor(){this.Z_=new ts(Tn.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):jn():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class s0{constructor(t,s,a,l,d,f,E,v,T){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=E,this.excludesMetadataChanges=v,this.hasCachedResults=T}static fromInitialDocuments(t,s,a,l,d){const f=[];return s.forEach(E=>{f.push({type:0,doc:E})}),new s0(t,s,MS.emptySet(s),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&fN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xje{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class Jje{constructor(){this.queries=iX(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=Xn(s),d=l.queries;l.queries=iX(),d.forEach((f,E)=>{for(const v of E.ta)v.onError(a)})})(this,new sn(Tt.ABORTED,"Firestore shutting down"))}}function iX(){return new OE(r=>Xne(r),fN)}async function kre(r,t){const s=Xn(r);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new Xje,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(f){const E=Ej(f,`Initialization of query '${sS(t.query)}' failed`);return void t.onError(E)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&yj(s)}async function Nre(r,t){const s=Xn(r),a=t.query;let l=3;const d=s.queries.get(a);if(d){const f=d.ta.indexOf(t);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function Qje(r,t){const s=Xn(r);let a=!1;for(const l of t){const d=l.query,f=s.queries.get(d);if(f){for(const E of f.ta)E.oa(l)&&(a=!0);f.ea=l}}a&&yj(s)}function Zje(r,t,s){const a=Xn(r),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function yj(r){r.ia.forEach(t=>{t.next()})}var qU,sX;(sX=qU||(qU={}))._a="default",sX.Cache="cache";class Dre{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new s0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=s0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==qU.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lre{constructor(t){this.key=t}}class xre{constructor(t){this.key=t}}class e4e{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=vr(),this.mutatedKeys=vr(),this.ya=Jne(t),this.wa=new MS(this.ya)}get ba(){return this.fa}Sa(t,s){const a=s?s.Da:new rX,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,f=l,E=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,T=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((w,I)=>{const N=l.get(w),F=mN(this.query,I)?I:null,j=!!N&&this.mutatedKeys.has(N.key),G=!!F&&(F.hasLocalMutations||this.mutatedKeys.has(F.key)&&F.hasCommittedMutations);let H=!1;N&&F?N.data.isEqual(F.data)?j!==G&&(a.track({type:3,doc:F}),H=!0):this.va(N,F)||(a.track({type:2,doc:F}),H=!0,(v&&this.ya(F,v)>0||T&&this.ya(F,T)<0)&&(E=!0)):!N&&F?(a.track({type:0,doc:F}),H=!0):N&&!F&&(a.track({type:1,doc:N}),H=!0,(v||T)&&(E=!0)),H&&(F?(f=f.add(F),d=G?d.add(w):d.delete(w)):(f=f.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const w=this.query.limitType==="F"?f.last():f.first();f=f.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:f,Da:a,ls:E,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const f=t.Da.X_();f.sort((w,I)=>function(F,j){const G=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return jn()}};return G(F)-G(j)}(w.type,I.type)||this.ya(w.doc,I.doc)),this.Ca(a),l=l!=null&&l;const E=s&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,T=v!==this.ga;return this.ga=v,f.length!==0||T?{snapshot:new s0(this.query,t.wa,d,f,t.mutatedKeys,v===0,T,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:E}:{Ma:E}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new rX,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=vr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new xre(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new Lre(a))}),s}Oa(t){this.fa=t.gs,this.pa=vr();const s=this.Sa(t.documents);return this.applyChanges(s,!0)}Na(){return s0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const vj="SyncEngine";class t4e{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class n4e{constructor(t){this.key=t,this.Ba=!1}}class r4e{constructor(t,s,a,l,d,f){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new OE(E=>Xne(E),fN),this.qa=new Map,this.Qa=new Set,this.$a=new ts(Tn.comparator),this.Ka=new Map,this.Ua=new lj,this.Wa={},this.Ga=new Map,this.za=i0.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function i4e(r,t,s=!0){const a=Bre(r);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await Mre(a,t,s,!0),l}async function s4e(r,t){const s=Bre(r);await Mre(s,t,!0,!1)}async function Mre(r,t,s,a){const l=await Rje(r.localStore,Gh(t)),d=l.targetId,f=r.sharedClientState.addLocalQueryTarget(d,s);let E;return a&&(E=await o4e(r,t,d,f==="current",l.resumeToken)),r.isPrimaryClient&&s&&Rre(r.remoteStore,l),E}async function o4e(r,t,s,a,l){r.Ha=(I,N,F)=>async function(G,H,te,K){let Q=H.view.Sa(te);Q.ls&&(Q=await JY(G.localStore,H.query,!1).then(({documents:ee})=>H.view.Sa(ee,Q)));const de=K&&K.targetChanges.get(H.targetId),se=K&&K.targetMismatches.get(H.targetId)!=null,ge=H.view.applyChanges(Q,G.isPrimaryClient,de,se);return aX(G,H.targetId,ge.Ma),ge.snapshot}(r,I,N,F);const d=await JY(r.localStore,t,!0),f=new e4e(t,d.gs),E=f.Sa(d.documents),v=zR.createSynthesizedTargetChangeForCurrentChange(s,a&&r.onlineState!=="Offline",l),T=f.applyChanges(E,r.isPrimaryClient,v);aX(r,s,T.Ma);const w=new t4e(t,s,f);return r.ka.set(t,w),r.qa.has(s)?r.qa.get(s).push(t):r.qa.set(s,[t]),T.snapshot}async function a4e(r,t,s){const a=Xn(r),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!fN(f,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await $U(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&pj(a.remoteStore,l.targetId),YU(a,l.targetId)}).catch(E0)):(YU(a,l.targetId),await $U(a.localStore,l.targetId,!0))}async function c4e(r,t){const s=Xn(r),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),pj(s.remoteStore,a.targetId))}async function l4e(r,t,s){const a=g4e(r);try{const l=await function(f,E){const v=Xn(f),T=no.now(),w=E.reduce((F,j)=>F.add(j.key),vr());let I,N;return v.persistence.runTransaction("Locally write mutations","readwrite",F=>{let j=Rf(),G=vr();return v.ds.getEntries(F,w).next(H=>{j=H,j.forEach((te,K)=>{K.isValidDocument()||(G=G.add(te))})}).next(()=>v.localDocuments.getOverlayedDocuments(F,j)).next(H=>{I=H;const te=[];for(const K of E){const Q=wFe(K,I.get(K.key).overlayedDocument);Q!=null&&te.push(new Tg(K.key,Q,Wne(Q.value.mapValue),Hh.exists(!0)))}return v.mutationQueue.addMutationBatch(F,T,te,E)}).next(H=>{N=H;const te=H.applyToLocalDocumentSet(I,G);return v.documentOverlayCache.saveOverlays(F,H.batchId,te)})}).then(()=>({batchId:N.batchId,changes:Zne(I)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(f,E,v){let T=f.Wa[f.currentUser.toKey()];T||(T=new ts(Cr)),T=T.insert(E,v),f.Wa[f.currentUser.toKey()]=T}(a,l.batchId,s),await HR(a,l.changes),await SN(a.remoteStore)}catch(l){const d=Ej(l,"Failed to persist write");s.reject(d)}}async function Ure(r,t){const s=Xn(r);try{const a=await Tje(s.localStore,t);t.targetChanges.forEach((l,d)=>{const f=s.Ka.get(d);f&&(ni(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?ni(f.Ba):l.removedDocuments.size>0&&(ni(f.Ba),f.Ba=!1))}),await HR(s,a,t)}catch(a){await E0(a)}}function oX(r,t,s){const a=Xn(r);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,f)=>{const E=f.view.sa(t);E.snapshot&&l.push(E.snapshot)}),function(f,E){const v=Xn(f);v.onlineState=E;let T=!1;v.queries.forEach((w,I)=>{for(const N of I.ta)N.sa(E)&&(T=!0)}),T&&yj(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function u4e(r,t,s){const a=Xn(r);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ka.get(t),d=l&&l.key;if(d){let f=new ts(Tn.comparator);f=f.insert(d,Aa.newNoDocument(d,$n.min()));const E=vr().add(d),v=new EN($n.min(),new Map,new ts(Cr),f,E);await Ure(a,v),a.$a=a.$a.remove(d),a.Ka.delete(t),Sj(a)}else await $U(a.localStore,t,!1).then(()=>YU(a,t,s)).catch(E0)}async function d4e(r,t){const s=Xn(r),a=t.batch.batchId;try{const l=await Sje(s.localStore,t);Fre(s,a,null),Vre(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await HR(s,l)}catch(l){await E0(l)}}async function h4e(r,t,s){const a=Xn(r);try{const l=await function(f,E){const v=Xn(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",T=>{let w;return v.mutationQueue.lookupMutationBatch(T,E).next(I=>(ni(I!==null),w=I.keys(),v.mutationQueue.removeMutationBatch(T,I))).next(()=>v.mutationQueue.performConsistencyCheck(T)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(T,w,E)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(T,w)).next(()=>v.localDocuments.getDocuments(T,w))})}(a.localStore,t);Fre(a,t,s),Vre(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await HR(a,l)}catch(l){await E0(l)}}function Vre(r,t){(r.Ga.get(t)||[]).forEach(s=>{s.resolve()}),r.Ga.delete(t)}function Fre(r,t,s){const a=Xn(r);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function YU(r,t,s=null){r.sharedClientState.removeLocalQueryTarget(t);for(const a of r.qa.get(t))r.ka.delete(a),s&&r.La.Ja(a,s);r.qa.delete(t),r.isPrimaryClient&&r.Ua.Sr(t).forEach(a=>{r.Ua.containsKey(a)||jre(r,a)})}function jre(r,t){r.Qa.delete(t.path.canonicalString());const s=r.$a.get(t);s!==null&&(pj(r.remoteStore,s),r.$a=r.$a.remove(t),r.Ka.delete(s),Sj(r))}function aX(r,t,s){for(const a of s)a instanceof Lre?(r.Ua.addReference(a.key,t),p4e(r,a)):a instanceof xre?(Qt(vj,"Document no longer in limbo: "+a.key),r.Ua.removeReference(a.key,t),r.Ua.containsKey(a.key)||jre(r,a.key)):jn()}function p4e(r,t){const s=t.key,a=s.path.canonicalString();r.$a.get(s)||r.Qa.has(a)||(Qt(vj,"New document in limbo: "+s),r.Qa.add(a),Sj(r))}function Sj(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){const t=r.Qa.values().next().value;r.Qa.delete(t);const s=new Tn(Mi.fromString(t)),a=r.za.next();r.Ka.set(a,new n4e(s)),r.$a=r.$a.insert(s,a),Rre(r.remoteStore,new Qm(Gh(ij(s.path)),a,"TargetPurposeLimboResolution",dN.ae))}}async function HR(r,t,s){const a=Xn(r),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((E,v)=>{f.push(a.Ha(v,t,s).then(T=>{var w;if((T||s)&&a.isPrimaryClient){const I=T?!T.fromCache:(w=s==null?void 0:s.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,I?"current":"not-current")}if(T){l.push(T);const I=dj.Yi(v.targetId,T);d.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(v,T){const w=Xn(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>St.forEach(T,N=>St.forEach(N.Hi,F=>w.persistence.referenceDelegate.addReference(I,N.targetId,F)).next(()=>St.forEach(N.Ji,F=>w.persistence.referenceDelegate.removeReference(I,N.targetId,F)))))}catch(I){if(!y0(I))throw I;Qt(hj,"Failed to update sequence numbers: "+I)}for(const I of T){const N=I.targetId;if(!I.fromCache){const F=w.Ts.get(N),j=F.snapshotVersion,G=F.withLastLimboFreeSnapshotVersion(j);w.Ts=w.Ts.insert(N,G)}}}(a.localStore,d))}async function f4e(r,t){const s=Xn(r);if(!s.currentUser.isEqual(t)){Qt(vj,"User change. New user:",t.toKey());const a=await Sre(s.localStore,t);s.currentUser=t,function(d,f){d.Ga.forEach(E=>{E.forEach(v=>{v.reject(new sn(Tt.CANCELLED,f))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await HR(s,a.Rs)}}function m4e(r,t){const s=Xn(r),a=s.Ka.get(t);if(a&&a.Ba)return vr().add(a.key);{let l=vr();const d=s.qa.get(t);if(!d)return l;for(const f of d){const E=s.ka.get(f);l=l.unionWith(E.view.ba)}return l}}function Bre(r){const t=Xn(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ure.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=m4e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=u4e.bind(null,t),t.La.p_=Qje.bind(null,t.eventManager),t.La.Ja=Zje.bind(null,t.eventManager),t}function g4e(r){const t=Xn(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=d4e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=h4e.bind(null,t),t}class Ik{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=yN(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return vje(this.persistence,new _je,t.initialUser,this.serializer)}Xa(t){return new vre(uj.ri,this.serializer)}Za(t){return new Ije}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ik.provider={build:()=>new Ik};class _4e extends Ik{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){ni(this.persistence.referenceDelegate instanceof Rk);const a=this.persistence.referenceDelegate.garbageCollector;return new nje(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?Uc.withCacheSize(this.cacheSizeBytes):Uc.DEFAULT;return new vre(a=>Rk.ri(a,s),this.serializer)}}class XU{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>oX(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=f4e.bind(null,this.syncEngine),await Yje(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new Jje}()}createDatastore(t){const s=yN(t.databaseInfo.databaseId),a=function(d){return new Nje(d)}(t.databaseInfo);return function(d,f,E,v){return new Mje(d,f,E,v)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,f,E){return new Vje(a,l,d,f,E)}(this.localStore,this.datastore,t.asyncQueue,s=>oX(this.syncEngine,s,0),function(){return eX.D()?new eX:new Aje}())}createSyncEngine(t,s){return function(l,d,f,E,v,T,w){const I=new r4e(l,d,f,E,v,T);return w&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=Xn(l);Qt(RE,"RemoteStore shutting down."),d.W_.add(5),await GR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}XU.provider={build:()=>new XU};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wre{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):wf("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _g="FirestoreClient";class E4e{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=Ca.UNAUTHENTICATED,this.clientId=Nne.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{Qt(_g,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(Qt(_g,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new _f;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=Ej(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function _2(r,t){r.asyncQueue.verifyOperationInProgress(),Qt(_g,"Initializing OfflineComponentProvider");const s=r.configuration;await t.initialize(s);let a=s.initialUser;r.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Sre(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function cX(r,t){r.asyncQueue.verifyOperationInProgress();const s=await y4e(r);Qt(_g,"Initializing OnlineComponentProvider"),await t.initialize(s,r.configuration),r.setCredentialChangeListener(a=>nX(t.remoteStore,a)),r.setAppCheckTokenChangeListener((a,l)=>nX(t.remoteStore,l)),r._onlineComponents=t}async function y4e(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Qt(_g,"Using user provided OfflineComponentProvider");try{await _2(r,r._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===Tt.FAILED_PRECONDITION||l.code===Tt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;e0("Error using user provided cache. Falling back to memory cache: "+s),await _2(r,new Ik)}}else Qt(_g,"Using default OfflineComponentProvider"),await _2(r,new _4e(void 0));return r._offlineComponents}async function zre(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Qt(_g,"Using user provided OnlineComponentProvider"),await cX(r,r._uninitializedComponentsProvider._online)):(Qt(_g,"Using default OnlineComponentProvider"),await cX(r,new XU))),r._onlineComponents}function v4e(r){return zre(r).then(t=>t.syncEngine)}async function Gre(r){const t=await zre(r),s=t.eventManager;return s.onListen=i4e.bind(null,t.syncEngine),s.onUnlisten=a4e.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=s4e.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=c4e.bind(null,t.syncEngine),s}function S4e(r,t,s={}){const a=new _f;return r.asyncQueue.enqueueAndForget(async()=>function(d,f,E,v,T){const w=new Wre({next:N=>{w.su(),f.enqueueAndForget(()=>Nre(d,I));const F=N.docs.has(E);!F&&N.fromCache?T.reject(new sn(Tt.UNAVAILABLE,"Failed to get document because the client is offline.")):F&&N.fromCache&&v&&v.source==="server"?T.reject(new sn(Tt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):T.resolve(N)},error:N=>T.reject(N)}),I=new Dre(ij(E.path),w,{includeMetadataChanges:!0,Ta:!0});return kre(d,I)}(await Gre(r),r.asyncQueue,t,s,a)),a.promise}function T4e(r,t,s={}){const a=new _f;return r.asyncQueue.enqueueAndForget(async()=>function(d,f,E,v,T){const w=new Wre({next:N=>{w.su(),f.enqueueAndForget(()=>Nre(d,I)),N.fromCache&&v.source==="server"?T.reject(new sn(Tt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):T.resolve(N)},error:N=>T.reject(N)}),I=new Dre(E,w,{includeMetadataChanges:!0,Ta:!0});return kre(d,I)}(await Gre(r),r.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hre(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lX=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $re(r,t,s){if(!s)throw new sn(Tt.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function b4e(r,t,s,a){if(t===!0&&a===!0)throw new sn(Tt.INVALID_ARGUMENT,`${r} and ${s} cannot be used together.`)}function uX(r){if(!Tn.isDocumentKey(r))throw new sn(Tt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function dX(r){if(Tn.isDocumentKey(r))throw new sn(Tt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function TN(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":jn()}function Cf(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new sn(Tt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=TN(r);throw new sn(Tt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kre="firestore.googleapis.com",hX=!0;class pX{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new sn(Tt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Kre,this.ssl=hX}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:hX;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=yre;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<eje)throw new sn(Tt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}b4e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Hre((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class bN{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pX({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new sn(Tt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new sn(Tt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pX(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new kVe;switch(a.type){case"firstParty":return new xVe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new sn(Tt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=lX.get(s);a&&(Qt("ComponentProvider","Removing Datastore"),lX.delete(s),a.terminate())}(this),Promise.resolve()}}function w4e(r,t,s,a={}){var l;const d=(r=Cf(r,bN))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:r._getEmulatorOptions()}),E=`${t}:${s}`;d.host!==Kre&&d.host!==E&&e0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:E,ssl:!1,emulatorOptions:a});if(!vE(v,f)&&(r._setSettings(v),a.mockUserToken)){let T,w;if(typeof a.mockUserToken=="string")T=a.mockUserToken,w=Ca.MOCK_USER;else{T=Ute(a.mockUserToken,(l=r._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new sn(Tt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Ca(I)}r._authCredentials=new NVe(new kne(T,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new S0(this.firestore,t,this._query)}}class Za{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ig(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Za(this.firestore,t,this._key)}}class ig extends S0{constructor(t,s,a){super(t,s,ij(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Za(this.firestore,null,new Tn(t))}withConverter(t){return new ig(this.firestore,t,this._path)}}function Ak(r,t,...s){if(r=Ki(r),$re("collection","path",t),r instanceof bN){const a=Mi.fromString(t,...s);return dX(a),new ig(r,null,a)}{if(!(r instanceof Za||r instanceof ig))throw new sn(Tt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(Mi.fromString(t,...s));return dX(a),new ig(r.firestore,null,a)}}function ka(r,t,...s){if(r=Ki(r),arguments.length===1&&(t=Nne.newId()),$re("doc","path",t),r instanceof bN){const a=Mi.fromString(t,...s);return uX(a),new Za(r,null,new Tn(a))}{if(!(r instanceof Za||r instanceof ig))throw new sn(Tt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(Mi.fromString(t,...s));return uX(a),new Za(r.firestore,r instanceof ig?r.converter:null,new Tn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fX="AsyncQueue";class mX{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new bre(this,"async_queue_retry"),this.bu=()=>{const a=g2();a&&Qt(fX,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.Su=t;const s=g2();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=g2();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.bu)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new _f;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!y0(t))throw t;Qt(fX,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.Su.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let E=f.message||"";return f.stack&&(E=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),E}(a);throw wf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.Su=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=_j.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&jn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.Su,await t;while(t!==this.Su)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}class $R extends bN{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new mX,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new mX(t),this._firestoreClient=void 0,await t}}}function qre(r,t){const s=typeof r=="object"?r:zF(),a=typeof r=="string"?r:Ek,l=aN(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=Lte("firestore");d&&w4e(l,...d)}return l}function Tj(r){if(r._terminated)throw new sn(Tt.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||R4e(r),r._firestoreClient}function R4e(r){var t,s,a;const l=r._freezeSettings(),d=function(E,v,T,w){return new YVe(E,v,T,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,Hre(w.experimentalLongPollingOptions),w.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,l);r._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(r._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),r._firestoreClient=new E4e(r._authCredentials,r._appCheckCredentials,r._queue,d,r._componentsProvider&&function(E){const v=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(v),_online:v}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new o0(Zo.fromBase64String(t))}catch(s){throw new sn(Tt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new o0(Zo.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wN{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new sn(Tt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Qo(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bj{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wj{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new sn(Tt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new sn(Tt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Cr(this._lat,t._lat)||Cr(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rj{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C4e=/^__.*__$/;class I4e{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new Tg(t,this.data,this.fieldMask,s,this.fieldTransforms):new WR(t,this.data,s,this.fieldTransforms)}}class Yre{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new Tg(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function Xre(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw jn()}}class Cj{constructor(t,s,a,l,d,f){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new Cj(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Ku(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Uu(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return Pk(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Xre(this.Lu)&&C4e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class A4e{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||yN(t)}ju(t,s,a,l=!1){return new Cj({Lu:t,methodName:s,zu:a,path:Qo.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ij(r){const t=r._freezeSettings(),s=yN(r._databaseId);return new A4e(r._databaseId,!!t.ignoreUndefinedProperties,s)}function P4e(r,t,s,a,l,d={}){const f=r.ju(d.merge||d.mergeFields?2:0,t,s,l);Aj("Data must be an object, but it was:",f,a);const E=Jre(a,f);let v,T;if(d.merge)v=new bl(f.fieldMask),T=f.fieldTransforms;else if(d.mergeFields){const w=[];for(const I of d.mergeFields){const N=JU(t,I,s);if(!f.contains(N))throw new sn(Tt.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Zre(w,N)||w.push(N)}v=new bl(w),T=f.fieldTransforms.filter(I=>v.covers(I.field))}else v=null,T=f.fieldTransforms;return new I4e(new Fc(E),v,T)}class RN extends bj{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof RN}}function O4e(r,t,s,a){const l=r.ju(1,t,s);Aj("Data must be an object, but it was:",l,a);const d=[],f=Fc.empty();Sg(a,(v,T)=>{const w=Pj(t,v,s);T=Ki(T);const I=l.Ku(w);if(T instanceof RN)d.push(w);else{const N=KR(T,I);N!=null&&(d.push(w),f.set(w,N))}});const E=new bl(d);return new Yre(f,E,l.fieldTransforms)}function k4e(r,t,s,a,l,d){const f=r.ju(1,t,s),E=[JU(t,a,s)],v=[l];if(d.length%2!=0)throw new sn(Tt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)E.push(JU(t,d[N])),v.push(d[N+1]);const T=[],w=Fc.empty();for(let N=E.length-1;N>=0;--N)if(!Zre(T,E[N])){const F=E[N];let j=v[N];j=Ki(j);const G=f.Ku(F);if(j instanceof RN)T.push(F);else{const H=KR(j,G);H!=null&&(T.push(F),w.set(F,H))}}const I=new bl(T);return new Yre(w,I,f.fieldTransforms)}function N4e(r,t,s,a=!1){return KR(s,r.ju(a?4:3,t))}function KR(r,t){if(Qre(r=Ki(r)))return Aj("Unsupported field value:",t,r),Jre(r,t);if(r instanceof bj)return function(a,l){if(!Xre(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const E of a){let v=KR(E,l.Uu(f));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),f++}return{arrayValue:{values:d}}}(r,t)}return function(a,l){if((a=Ki(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return EFe(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=no.fromDate(a);return{timestampValue:wk(l.serializer,d)}}if(a instanceof no){const d=new no(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:wk(l.serializer,d)}}if(a instanceof wj)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof o0)return{bytesValue:hre(l.serializer,a._byteString)};if(a instanceof Za){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:cj(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof Rj)return function(f,E){return{mapValue:{fields:{[jne]:{stringValue:Bne},[yk]:{arrayValue:{values:f.toArray().map(T=>{if(typeof T!="number")throw E.Wu("VectorValues must only contain numeric values.");return sj(E.serializer,T)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${TN(a)}`)}(r,t)}function Jre(r,t){const s={};return Lne(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Sg(r,(a,l)=>{const d=KR(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function Qre(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof no||r instanceof wj||r instanceof o0||r instanceof Za||r instanceof bj||r instanceof Rj)}function Aj(r,t,s){if(!Qre(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=TN(s);throw a==="an object"?t.Wu(r+" a custom object"):t.Wu(r+" "+a)}}function JU(r,t,s){if((t=Ki(t))instanceof wN)return t._internalPath;if(typeof t=="string")return Pj(r,t);throw Pk("Field path arguments must be of type string or ",r,!1,void 0,s)}const D4e=new RegExp("[~\\*/\\[\\]]");function Pj(r,t,s){if(t.search(D4e)>=0)throw Pk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,s);try{return new wN(...t.split("."))._internalPath}catch{throw Pk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,s)}}function Pk(r,t,s,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let E=`Function ${t}() called with invalid data`;s&&(E+=" (via `toFirestore()`)"),E+=". ";let v="";return(d||f)&&(v+=" (found",d&&(v+=` in field ${a}`),f&&(v+=` in document ${l}`),v+=")"),new sn(Tt.INVALID_ARGUMENT,E+r+v)}function Zre(r,t){return r.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eie{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Za(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new L4e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(Oj("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class L4e extends eie{data(){return super.data()}}function Oj(r,t){return typeof t=="string"?Pj(r,t):t instanceof wN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x4e(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new sn(Tt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class kj{}class M4e extends kj{}function gX(r,t,...s){let a=[];t instanceof kj&&a.push(t),a=a.concat(s),function(d){const f=d.filter(v=>v instanceof Nj).length,E=d.filter(v=>v instanceof CN).length;if(f>1||f>0&&E>0)throw new sn(Tt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)r=l._apply(r);return r}class CN extends M4e{constructor(t,s,a){super(),this._field=t,this._op=s,this._value=a,this.type="where"}static _create(t,s,a){return new CN(t,s,a)}_apply(t){const s=this._parse(t);return tie(t._query,s),new S0(t.firestore,t.converter,jU(t._query,s))}_parse(t){const s=Ij(t.firestore);return function(d,f,E,v,T,w,I){let N;if(T.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new sn(Tt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){yX(I,w);const j=[];for(const G of I)j.push(EX(v,d,G));N={arrayValue:{values:j}}}else N=EX(v,d,I)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||yX(I,w),N=N4e(E,f,I,w==="in"||w==="not-in");return zs.create(T,w,N)}(t._query,"where",s,t.firestore._databaseId,this._field,this._op,this._value)}}function _X(r,t,s){const a=t,l=Oj("where",r);return CN._create(l,a,s)}class Nj extends kj{constructor(t,s){super(),this.type=t,this._queryConstraints=s}static _create(t,s){return new Nj(t,s)}_parse(t){const s=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return s.length===1?s[0]:wd.create(s,this._getOperator())}_apply(t){const s=this._parse(t);return s.getFilters().length===0?t:(function(l,d){let f=l;const E=d.getFlattenedFilters();for(const v of E)tie(f,v),f=jU(f,v)}(t._query,s),new S0(t.firestore,t.converter,jU(t._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function EX(r,t,s){if(typeof(s=Ki(s))=="string"){if(s==="")throw new sn(Tt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yne(t)&&s.indexOf("/")!==-1)throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const a=t.path.child(Mi.fromString(s));if(!Tn.isDocumentKey(a))throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return NY(r,new Tn(a))}if(s instanceof Za)return NY(r,s._key);throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${TN(s)}.`)}function yX(r,t){if(!Array.isArray(r)||r.length===0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function tie(r,t){const s=function(l,d){for(const f of l)for(const E of f.getFlattenedFilters())if(d.indexOf(E.op)>=0)return E.op;return null}(r.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(s!==null)throw s===t.op?new sn(Tt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new sn(Tt.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class U4e{convertValue(t,s="none"){switch(mg(t)){case 0:return null;case 1:return t.booleanValue;case 2:return As(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(fg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw jn()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return Sg(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[yk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>As(f.doubleValue));return new Rj(d)}convertGeoPoint(t){return new wj(As(t.latitude),As(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=pN(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(uR(t));default:return null}}convertTimestamp(t){const s=pg(t);return new no(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=Mi.fromString(t);ni(Ere(a));const l=new dR(a.get(1),a.get(3)),d=new Tn(a.popFirst(5));return l.isEqual(s)||wf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V4e(r,t,s){let a;return a=r?s&&(s.merge||s.mergeFields)?r.toFirestore(t,s):r.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class nie extends eie{constructor(t,s,a,l,d,f){super(t,s,a,l,f),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new BO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(Oj("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class BO extends nie{data(t={}){return super.data(t)}}class F4e{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new vw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new BO(this._firestore,this._userDataWriter,a.key,a,new vw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new sn(Tt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(E=>{const v=new BO(l._firestore,l._userDataWriter,E.doc.key,E.doc,new vw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const v=new BO(l._firestore,l._userDataWriter,E.doc.key,E.doc,new vw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let T=-1,w=-1;return E.type!==0&&(T=f.indexOf(E.doc.key),f=f.delete(E.doc.key)),E.type!==1&&(f=f.add(E.doc),w=f.indexOf(E.doc.key)),{type:j4e(E.type),doc:v,oldIndex:T,newIndex:w}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function j4e(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return jn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(r){r=Cf(r,Za);const t=Cf(r.firestore,$R);return S4e(Tj(t),r._key).then(s=>B4e(t,r,s))}class rie extends U4e{constructor(t){super(),this.firestore=t}convertBytes(t){return new o0(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new Za(this.firestore,null,s)}}function Ok(r){r=Cf(r,S0);const t=Cf(r.firestore,$R),s=Tj(t),a=new rie(t);return x4e(r._query),T4e(s,r._query).then(l=>new F4e(t,a,r,l))}function QU(r,t,s){r=Cf(r,Za);const a=Cf(r.firestore,$R),l=V4e(r.converter,t,s);return iie(a,[P4e(Ij(a),"setDoc",r._key,l,r.converter!==null,s).toMutation(r._key,Hh.none())])}function Xh(r,t,s,...a){r=Cf(r,Za);const l=Cf(r.firestore,$R),d=Ij(l);let f;return f=typeof(t=Ki(t))=="string"||t instanceof wN?k4e(d,"updateDoc",r._key,t,s,a):O4e(d,"updateDoc",r._key,t),iie(l,[f.toMutation(r._key,Hh.exists(!0))])}function iie(r,t){return function(a,l){const d=new _f;return a.asyncQueue.enqueueAndForget(async()=>l4e(await v4e(a),l,d)),d.promise}(Tj(r),t)}function B4e(r,t,s){const a=s.docs.get(t._key),l=new rie(r);return new nie(r,l,t._key,a,new vw(s.hasPendingWrites,s.fromCache),t.converter)}(function(t,s=!0){(function(l){_0=l})(AE),SE(new dg("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),E=new $R(new DVe(a.getProvider("auth-internal")),new MVe(f,a.getProvider("app-check-internal")),function(T,w){if(!Object.prototype.hasOwnProperty.apply(T.options,["projectId"]))throw new sn(Tt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new dR(T.options.projectId,w)}(f,l),f);return d=Object.assign({useFetchStreams:s},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),Bh(SY,TY,t),Bh(SY,TY,"esm2017")})();var W4e="firebase",z4e="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bh(W4e,z4e,"app");const G4e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!0);console.log("import.meta.env:",G4e);const zm={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:zm.apiKey?`${zm.apiKey.substring(0,5)}...`:"missing",authDomain:zm.authDomain,projectId:zm.projectId,storageBucket:zm.storageBucket,messagingSenderId:zm.messagingSenderId?"present":"missing",appId:zm.appId?"present":"missing"});const sie=jte(zm),H4e=wne(sie),To=qre(sie),Jh=async r=>{try{Re.log("userFirestore: Get user Profile data for user ID: "+r);const t=ka(To,"users",r),s=await Eg(t);return s.exists()?(Re.log("userFirestore: Found Profile for : "+s.data().Nickname),s.data()):(Re.error("userFirestore: user profile document not found"),null)}catch(t){throw Re.error("userFirestore: Error fetching user profile data:",t),t}},$4e=async(r,t,s)=>{try{Re.log("userFirestore: Registering new user with email:",r);const l=(await pUe(H4e,r,t)).user,d={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!0,...s};Re.log("userFirestore: Creating user document with data:",d);const f=ka(To,"users",l.uid);return await QU(f,d),Re.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw Re.error("userFirestore: Error creating user:",a),a}},oie=async(r,t)=>{try{Re.log(`userFirestore: Updating rpmURL for user ID: ${r}`);const s=ka(To,"users",r);await Xh(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),Re.log("userFirestore: rpmURL updated successfully.")}catch(s){throw Re.error("userFirestore: Error updating rpmURL:",s),s}},K4e=(r,t)=>{if(t==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${r} and group ${t} - Returning true`),!0;if(t==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(r);return console.log(`OVERRIDE: userBelongsToGroup check for user ${r} and admin group ${t} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${r} and group ${t} - Returning false`),!1},aie=async(r,t)=>K4e(r,t),q4e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],vd={sendUserToUnity:"sendUserToUnity"};class Y4e{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),Re.log(`EventBus: Published event '${t}'`)):Re.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const Sd=new Y4e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cie="firebasestorage.googleapis.com",lie="storageBucket",X4e=2*60*1e3,J4e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs extends ep{constructor(t,s,a=0){super(E2(t),`Firebase Storage: ${s} (${E2(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,vs.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return E2(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ys;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ys||(ys={}));function E2(r){return"storage/"+r}function Dj(){const r="An unknown error occurred, please check the error payload for server response.";return new vs(ys.UNKNOWN,r)}function Q4e(r){return new vs(ys.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function Z4e(r){return new vs(ys.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function e3e(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new vs(ys.UNAUTHENTICATED,r)}function t3e(){return new vs(ys.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function n3e(r){return new vs(ys.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function r3e(){return new vs(ys.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function i3e(){return new vs(ys.CANCELED,"User canceled the upload/download.")}function s3e(r){return new vs(ys.INVALID_URL,"Invalid URL '"+r+"'.")}function o3e(r){return new vs(ys.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function a3e(){return new vs(ys.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+lie+"' property when initializing the app?")}function c3e(){return new vs(ys.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function l3e(){return new vs(ys.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function u3e(r){return new vs(ys.UNSUPPORTED_ENVIRONMENT,`${r} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function ZU(r){return new vs(ys.INVALID_ARGUMENT,r)}function uie(){return new vs(ys.APP_DELETED,"The Firebase app was deleted.")}function d3e(r){return new vs(ys.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Fw(r,t){return new vs(ys.INVALID_FORMAT,"String does not match format '"+r+"': "+t)}function $b(r){throw new vs(ys.INTERNAL_ERROR,"Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=wl.makeFromUrl(t,s)}catch{return new wl(t,"")}if(a.path==="")return a;throw o3e(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(de){de.path.charAt(de.path.length-1)==="/"&&(de.path_=de.path_.slice(0,-1))}const f="(/(.*))?$",E=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function T(de){de.path_=decodeURIComponent(de.path)}const w="v[A-Za-z0-9_]+",I=s.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",F=new RegExp(`^https?://${I}/${w}/b/${l}/o${N}`,"i"),j={bucket:1,path:3},G=s===cie?"(?:storage.googleapis.com|storage.cloud.google.com)":s,H="([^?#]*)",te=new RegExp(`^https?://${G}/${l}/${H}`,"i"),Q=[{regex:E,indices:v,postModify:d},{regex:F,indices:j,postModify:T},{regex:te,indices:{bucket:1,path:2},postModify:T}];for(let de=0;de<Q.length;de++){const se=Q[de],ge=se.regex.exec(t);if(ge){const ee=ge[se.indices.bucket];let Z=ge[se.indices.path];Z||(Z=""),a=new wl(ee,Z),se.postModify(a);break}}if(a==null)throw s3e(t);return a}}class h3e{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p3e(r,t,s){let a=1,l=null,d=null,f=!1,E=0;function v(){return E===2}let T=!1;function w(...H){T||(T=!0,t.apply(null,H))}function I(H){l=setTimeout(()=>{l=null,r(F,v())},H)}function N(){d&&clearTimeout(d)}function F(H,...te){if(T){N();return}if(H){N(),w.call(null,H,...te);return}if(v()||f){N(),w.call(null,H,...te);return}a<64&&(a*=2);let Q;E===1?(E=2,Q=0):Q=(a+Math.random())*1e3,I(Q)}let j=!1;function G(H){j||(j=!0,N(),!T&&(l!==null?(H||(E=2),clearTimeout(l),I(0)):H||(E=1)))}return I(0),d=setTimeout(()=>{f=!0,G(!0)},s),G}function f3e(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m3e(r){return r!==void 0}function g3e(r){return typeof r=="object"&&!Array.isArray(r)}function Lj(r){return typeof r=="string"||r instanceof String}function vX(r){return xj()&&r instanceof Blob}function xj(){return typeof Blob<"u"}function SX(r,t,s,a){if(a<t)throw ZU(`Invalid value for '${r}'. Expected ${t} or greater.`);if(a>s)throw ZU(`Invalid value for '${r}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IN(r,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${r}`}function die(r){const t=encodeURIComponent;let s="?";for(const a in r)if(r.hasOwnProperty(a)){const l=t(a)+"="+t(r[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var pE;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(pE||(pE={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _3e(r,t){const s=r>=500&&r<600,l=[408,429].indexOf(r)!==-1,d=t.indexOf(r)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E3e{constructor(t,s,a,l,d,f,E,v,T,w,I,N=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=E,this.errorCallback_=v,this.timeout_=T,this.progressCallback_=w,this.connectionFactory_=I,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((F,j)=>{this.resolve_=F,this.reject_=j,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new aO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=E=>{const v=E.loaded,T=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,T)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const E=d.getErrorCode()===pE.NO_ERROR,v=d.getStatus();if(!E||_3e(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===pE.ABORT;a(!1,new aO(!1,null,w));return}const T=this.successCodes_.indexOf(v)!==-1;a(!0,new aO(T,d))})},s=(a,l)=>{const d=this.resolve_,f=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(E,E.getResponse());m3e(v)?d(v):d()}catch(v){f(v)}else if(E!==null){const v=Dj();v.serverResponse=E.getErrorText(),this.errorCallback_?f(this.errorCallback_(E,v)):f(v)}else if(l.canceled){const v=this.appDelete_?uie():i3e();f(v)}else{const v=r3e();f(v)}};this.canceled_?s(!1,new aO(!1,null,!0)):this.backoffId_=p3e(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&f3e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class aO{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function y3e(r,t){t!==null&&t.length>0&&(r.Authorization="Firebase "+t)}function v3e(r,t){r["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function S3e(r,t){t&&(r["X-Firebase-GMPID"]=t)}function T3e(r,t){t!==null&&(r["X-Firebase-AppCheck"]=t)}function b3e(r,t,s,a,l,d,f=!0){const E=die(r.urlParams),v=r.url+E,T=Object.assign({},r.headers);return S3e(T,t),y3e(T,s),v3e(T,d),T3e(T,a),new E3e(v,r.method,T,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w3e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function R3e(...r){const t=w3e();if(t!==void 0){const s=new t;for(let a=0;a<r.length;a++)s.append(r[a]);return s.getBlob()}else{if(xj())return new Blob(r);throw new vs(ys.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function C3e(r,t,s){return r.webkitSlice?r.webkitSlice(t,s):r.mozSlice?r.mozSlice(t,s):r.slice?r.slice(t,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I3e(r){if(typeof atob>"u")throw u3e("base-64");return atob(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class y2{constructor(t,s){this.data=t,this.contentType=s||null}}function A3e(r,t){switch(r){case Lh.RAW:return new y2(hie(t));case Lh.BASE64:case Lh.BASE64URL:return new y2(pie(r,t));case Lh.DATA_URL:return new y2(O3e(t),k3e(t))}throw Dj()}function hie(r){const t=[];for(let s=0;s<r.length;s++){let a=r.charCodeAt(s);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(s<r.length-1&&(r.charCodeAt(s+1)&64512)===56320))t.push(239,191,189);else{const d=a,f=r.charCodeAt(++s);a=65536|(d&1023)<<10|f&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function P3e(r){let t;try{t=decodeURIComponent(r)}catch{throw Fw(Lh.DATA_URL,"Malformed data URL.")}return hie(t)}function pie(r,t){switch(r){case Lh.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw Fw(r,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Lh.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw Fw(r,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=I3e(t)}catch(l){throw l.message.includes("polyfill")?l:Fw(r,"Invalid character found")}const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}class fie{constructor(t){this.base64=!1,this.contentType=null;const s=t.match(/^data:([^,]+)?,/);if(s===null)throw Fw(Lh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=s[1]||null;a!=null&&(this.base64=N3e(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function O3e(r){const t=new fie(r);return t.base64?pie(Lh.BASE64,t.rest):P3e(t.rest)}function k3e(r){return new fie(r).contentType}function N3e(r,t){return r.length>=t.length?r.substring(r.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(t,s){let a=0,l="";vX(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(s?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(s?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,s){if(vX(this.data_)){const a=this.data_,l=C3e(a,t,s);return l===null?null:new Xm(l)}else{const a=new Uint8Array(this.data_.buffer,t,s-t);return new Xm(a,!0)}}static getBlob(...t){if(xj()){const s=t.map(a=>a instanceof Xm?a.data_:a);return new Xm(R3e.apply(null,s))}else{const s=t.map(f=>Lj(f)?A3e(Lh.RAW,f).data:f.data_);let a=0;s.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return s.forEach(f=>{for(let E=0;E<f.length;E++)l[d++]=f[E]}),new Xm(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mie(r){let t;try{t=JSON.parse(r)}catch{return null}return g3e(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D3e(r){if(r.length===0)return null;const t=r.lastIndexOf("/");return t===-1?"":r.slice(0,t)}function L3e(r,t){const s=t.split("/").filter(a=>a.length>0).join("/");return r.length===0?s:r+"/"+s}function gie(r){const t=r.lastIndexOf("/",r.length-2);return t===-1?r:r.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x3e(r,t){return t}class Ya{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||x3e}}let cO=null;function M3e(r){return!Lj(r)||r.length<2?r:gie(r)}function _ie(){if(cO)return cO;const r=[];r.push(new Ya("bucket")),r.push(new Ya("generation")),r.push(new Ya("metageneration")),r.push(new Ya("name","fullPath",!0));function t(d,f){return M3e(f)}const s=new Ya("name");s.xform=t,r.push(s);function a(d,f){return f!==void 0?Number(f):f}const l=new Ya("size");return l.xform=a,r.push(l),r.push(new Ya("timeCreated")),r.push(new Ya("updated")),r.push(new Ya("md5Hash",null,!0)),r.push(new Ya("cacheControl",null,!0)),r.push(new Ya("contentDisposition",null,!0)),r.push(new Ya("contentEncoding",null,!0)),r.push(new Ya("contentLanguage",null,!0)),r.push(new Ya("contentType",null,!0)),r.push(new Ya("metadata","customMetadata",!0)),cO=r,cO}function U3e(r,t){function s(){const a=r.bucket,l=r.fullPath,d=new wl(a,l);return t._makeStorageReference(d)}Object.defineProperty(r,"ref",{get:s})}function V3e(r,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const f=s[d];a[f.local]=f.xform(a,t[f.server])}return U3e(a,r),a}function Eie(r,t,s){const a=mie(t);return a===null?null:V3e(r,a,s)}function F3e(r,t,s,a){const l=mie(t);if(l===null||!Lj(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(T=>{const w=r.bucket,I=r.fullPath,N="/b/"+f(w)+"/o/"+f(I),F=IN(N,s,a),j=die({alt:"media",token:T});return F+j})[0]}function j3e(r,t){const s={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(s[d.server]=r[d.local])}return JSON.stringify(s)}class Mj{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yie(r){if(!r)throw Dj()}function B3e(r,t){function s(a,l){const d=Eie(r,l,t);return yie(d!==null),d}return s}function W3e(r,t){function s(a,l){const d=Eie(r,l,t);return yie(d!==null),F3e(d,l,r.host,r._protocol)}return s}function vie(r){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=t3e():l=e3e():s.getStatus()===402?l=Z4e(r.bucket):s.getStatus()===403?l=n3e(r.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function Sie(r){const t=vie(r);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=Q4e(r.path)),d.serverResponse=l.serverResponse,d}return s}function z3e(r,t,s){const a=t.fullServerUrl(),l=IN(a,r.host,r._protocol),d="GET",f=r.maxOperationRetryTime,E=new Mj(l,d,W3e(r,s),f);return E.errorHandler=Sie(t),E}function G3e(r,t){const s=t.fullServerUrl(),a=IN(s,r.host,r._protocol),l="DELETE",d=r.maxOperationRetryTime;function f(v,T){}const E=new Mj(a,l,f,d);return E.successCodes=[200,204],E.errorHandler=Sie(t),E}function H3e(r,t){return r&&r.contentType||t&&t.type()||"application/octet-stream"}function $3e(r,t,s){const a=Object.assign({},s);return a.fullPath=r.path,a.size=t.size(),a.contentType||(a.contentType=H3e(null,t)),a}function K3e(r,t,s,a,l){const d=t.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function E(){let Q="";for(let de=0;de<2;de++)Q=Q+Math.random().toString().slice(2);return Q}const v=E();f["Content-Type"]="multipart/related; boundary="+v;const T=$3e(t,a,l),w=j3e(T,s),I="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+T.contentType+`\r
\r
`,N=`\r
--`+v+"--",F=Xm.getBlob(I,a,N);if(F===null)throw c3e();const j={name:T.fullPath},G=IN(d,r.host,r._protocol),H="POST",te=r.maxUploadRetryTime,K=new Mj(G,H,B3e(r,s),te);return K.urlParams=j,K.headers=f,K.body=F.uploadData(),K.errorHandler=vie(t),K}class q3e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=pE.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=pE.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=pE.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw $b("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw $b("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw $b("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw $b("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw $b("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class Y3e extends q3e{initXhr(){this.xhr_.responseType="text"}}function Uj(){return new Y3e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(t,s){this._service=t,s instanceof wl?this._location=s:this._location=wl.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new CE(t,s)}get root(){const t=new wl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return gie(this._location.path)}get storage(){return this._service}get parent(){const t=D3e(this._location.path);if(t===null)return null;const s=new wl(this._location.bucket,t);return new CE(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw d3e(t)}}function X3e(r,t,s){r._throwIfRoot("uploadBytes");const a=K3e(r.storage,r._location,_ie(),new Xm(t,!0),s);return r.storage.makeRequestWithTokens(a,Uj).then(l=>({metadata:l,ref:r}))}function J3e(r){r._throwIfRoot("getDownloadURL");const t=z3e(r.storage,r._location,_ie());return r.storage.makeRequestWithTokens(t,Uj).then(s=>{if(s===null)throw l3e();return s})}function Q3e(r){r._throwIfRoot("deleteObject");const t=G3e(r.storage,r._location);return r.storage.makeRequestWithTokens(t,Uj)}function Z3e(r,t){const s=L3e(r._location.path,t),a=new wl(r._location.bucket,s);return new CE(r.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eBe(r){return/^[A-Za-z]+:\/\//.test(r)}function tBe(r,t){return new CE(r,t)}function Tie(r,t){if(r instanceof Vj){const s=r;if(s._bucket==null)throw a3e();const a=new CE(s,s._bucket);return t!=null?Tie(a,t):a}else return t!==void 0?Z3e(r,t):r}function nBe(r,t){if(t&&eBe(t)){if(r instanceof Vj)return tBe(r,t);throw ZU("To use ref(service, url), the first argument must be a Storage instance.")}else return Tie(r,t)}function TX(r,t){const s=t==null?void 0:t[lie];return s==null?null:wl.makeFromBucketSpec(s,r)}function rBe(r,t,s,a={}){r.host=`${t}:${s}`,r._protocol="http";const{mockUserToken:l}=a;l&&(r._overrideAuthToken=typeof l=="string"?l:Ute(l,r.app.options.projectId))}class Vj{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=cie,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=X4e,this._maxUploadRetryTime=J4e,this._requests=new Set,l!=null?this._bucket=wl.makeFromBucketSpec(l,this._host):this._bucket=TX(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=wl.makeFromBucketSpec(this._url,t):this._bucket=TX(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){SX("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){SX("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(Sl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new CE(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new h3e(uie());{const f=b3e(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const bX="@firebase/storage",wX="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bie="storage";function Fj(r,t,s){return r=Ki(r),X3e(r,t,s)}function AN(r){return r=Ki(r),J3e(r)}function jj(r){return r=Ki(r),Q3e(r)}function NE(r,t){return r=Ki(r),nBe(r,t)}function DE(r=zF(),t){r=Ki(r);const a=aN(r,bie).getImmediate({identifier:t}),l=Lte("storage");return l&&iBe(a,...l),a}function iBe(r,t,s,a={}){rBe(r,t,s,a)}function sBe(r,{instanceIdentifier:t}){const s=r.getProvider("app").getImmediate(),a=r.getProvider("auth-internal"),l=r.getProvider("app-check-internal");return new Vj(s,a,l,t,AE)}function oBe(){SE(new dg(bie,sBe,"PUBLIC").setMultipleInstances(!0)),Bh(bX,wX,""),Bh(bX,wX,"esm2017")}oBe();const WO=async r=>{const t=DE(),s=NE(t,r);try{return await AN(s)}catch(a){throw Re.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let mR={};const sg=async r=>{try{const t=ka(To,"spaces",r),s=await Eg(t);if(s.exists()){let a=s.data();if(a.webglBuildId){const l=ka(To,"webglBuilds",a.webglBuildId),d=await Eg(l);if(d.exists()){const f=d.data();a={...a,...f}}else Re.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await aBe(a),a=cBe(a),console.log("Space data:",a),Re.log(`spacesFirestore: Caching space data for: ${r}`),mR[r]=a,a}else return Re.warn(`spacesFirestore: No document found for item ID: ${r}`),null}catch(t){throw Re.error("spacesFirestore: Error fetching item data:",t),t}},aBe=async r=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=r[a];l&&l.startsWith("gs://")&&(r[a]=await WO(l))});return await Promise.all(s),r},cBe=r=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=r;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let v2={};const wie=async r=>{Re.log("spacesFirestore: Get Videos from Firestore for space: ",r);try{if(v2[r])return Re.log("spacesFirestore: Returning cached videos for space:",r),v2[r];const t=Ak(To,`spaces/${r}/videos`),s=await Ok(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),v2[r]=a,a}catch(t){throw Re.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},lBe=async(r,t)=>{try{if(!r||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=DE(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,f=NE(s,`spaces/${r}/logo/${d}`);Re.log(`Uploading logo for space ${r}`);const E=await Fj(f,t),v=await AN(E.ref),T=ka(To,"spaces",r);return await Xh(T,{logoUrl:v,logoGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),Re.log(`Successfully uploaded logo for space ${r}`),v}catch(s){throw Re.error("Error uploading space logo:",s),s}},uBe=async r=>{try{const t=ka(To,"spaces",r),s=await Eg(t);if(!s.exists())return Re.warn(`No space found with ID: ${r}`),!1;const a=s.data();if(a.logoGsUrl){const l=DE(),d=NE(l,a.logoGsUrl);try{await jj(d),Re.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){Re.warn(`Could not delete logo file from storage: ${f.message}`)}}return await Xh(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),Re.log(`Successfully removed logo for space ${r}`),!0}catch(t){throw Re.error("Error deleting space logo:",t),t}},dBe=async(r,t)=>{try{if(!r||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=DE(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,f=NE(s,`spaces/${r}/background/${d}`);Re.log(`Uploading background for space ${r}`);const E=await Fj(f,t),v=await AN(E.ref),T=ka(To,"spaces",r);return await Xh(T,{backgroundUrl:v,backgroundGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${E.ref.bucket}/${E.ref.fullPath}`,updatedAt:new Date().toISOString()}),Re.log(`Successfully uploaded background for space ${r}`),v}catch(s){throw Re.error("Error uploading space background:",s),s}},hBe=async r=>{try{const t=ka(To,"spaces",r),s=await Eg(t);if(!s.exists())return Re.warn(`No space found with ID: ${r}`),!1;const a=s.data();if(a.backgroundGsUrl){const l=DE(),d=NE(l,a.backgroundGsUrl);try{await jj(d),Re.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){Re.warn(`Could not delete background file from storage: ${f.message}`)}}return await Xh(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),Re.log(`Successfully removed background references for space ${r}`),!0}catch(t){throw Re.error("Error deleting space background:",t),t}},pBe=async(r,t)=>{try{Re.log(`spacesFirestore: Updating settings for space: ${r}`,t);const s=ka(To,"spaces",r),a=await Eg(s);if(!a.exists())throw new Error(`Space with ID ${r} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Xh(s,d),mR[r]&&delete mR[r],Re.log(`spacesFirestore: Successfully updated settings for space: ${r}`)}catch(s){throw Re.error(`spacesFirestore: Error updating settings for space: ${r}`,s),s}},fBe=async(r,t)=>{try{Re.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${r}`);const s=ka(To,"spaces",r);if(!(await Eg(s)).exists())throw new Error(`Space with ID ${r} not found`);await Xh(s,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),mR[r]&&delete mR[r],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:r,accessibleToAllUsers:t}})),Re.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${r}`)}catch(s){throw Re.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${r}`,s),s}},wu=L.createContext(null),mBe=({children:r})=>{const[t,s]=L.useState(null),a=L.useRef(null),[l,d]=L.useState(!0),f=wne(),E=K=>K?K.Nickname?K.Nickname:`${K.firstName} ${K.lastName}`:"Anon";L.useEffect(()=>{const K=EUe(f,async Q=>{if(Re.log("UserProvider: Firebase onAuthStateChanged() fired"),Q)try{const de=await Jh(Q.uid),se=E(de),ge={uid:Q.uid,email:Q.email,emailVerified:Q.emailVerified,...de,displayName:se};console.log(ge),s(ge),a.current=ge,I(ge)}catch(de){Re.error("UserProvider: Error fetching user profile data:",de)}else s(null),a.current=null;d(!1)});return()=>{K&&K()}},[]);const v=async(K,Q,de)=>{try{const{firstName:se,lastName:ge}=de,ee=`${se}${ge.charAt(0).toUpperCase()}`,Z={...de,Nickname:ee,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},ne=await $4e(K,Q,Z),ae=E(Z),me={uid:ne.uid,email:ne.email,...Z,displayName:ae};return s(me),a.current=me,Re.log("UserProvider: User registered successfully with groups:",Z.groups),me}catch(se){throw Re.error("UserProvider: Error creating user:",se),se}},T=async(K,Q)=>{try{const de=await fUe(f,K,Q),se=await Jh(de.user.uid),ge=E(se),ee={uid:de.user.uid,email:de.user.email,emailVerified:de.user.emailVerified,...se,displayName:ge};s(ee),I(ee)}catch(de){throw Re.error("UserProvider: Error signing in:",de),de}},w=async()=>{try{await yUe(f),s(null),Re.log("UserProvider: User signed out.")}catch(K){throw Re.error("UserProvider: Error signing out:",K),K}},I=()=>{const K=a.current;if(K){const Q=N(K);Re.log("UserProvider: sendUserToUnity() using the eventBus",Q),Sd.publish(vd.sendUserToUnity,Q)}else Re.log("UserProvider: No current user to send to Unity.")},N=K=>{const Q={};return[...q4e,"uid"].forEach(se=>{K.hasOwnProperty(se)&&(Q[se]=K[se])}),Q},F=async K=>!t||!t.uid?!1:await aie(t.uid,K),j=async K=>{if(!t||!t.uid)return!1;try{const Q=await sg(K);if(Q.usersAllowed.includes(t.uid)||Q.userAdmin.includes(t.uid)||Q.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const se=`space_${K}_owners`,ge=`space_${K}_hosts`;if(t.groups.includes(se)||t.groups.includes(ge))return Re.log(`UserProvider: User ${t.uid} has access to space ${K} as owner/host`),!0}return Q.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(Q){return Re.error("UserProvider: Error verifying user access to space:",Q),!1}},G=async K=>{if(!t||!t.uid)return!1;try{return(await sg(K)).userAdmin.includes(t.uid)}catch(Q){return Re.error("UserProvider: Error verifying user admin status for space:",Q),!1}},H=async K=>{if(!t||!t.uid)return!1;try{return(await sg(K)).usersModerators.includes(t.uid)}catch(Q){return Re.error("UserProvider: Error verifying user moderator status for space:",Q),!1}},te=async()=>{try{const K=f.currentUser;return K&&!K.emailVerified?(await mUe(K),Re.log("UserProvider: Verification email resent to:",K.email),!0):!1}catch(K){throw Re.error("UserProvider: Error resending verification email:",K),K}};return O.jsx(wu.Provider,{value:{user:t,loading:l,register:v,signIn:T,signOut:w,sendUserToUnity:I,isUserInGroup:F,userHasAccessToSpace:j,userIsAdminOfSpace:G,userIsModeratorOfSpace:H,resendVerificationEmail:te},children:r})},Rie=L.createContext(),Cd=()=>L.useContext(Rie),gBe=({children:r})=>{const[t,s]=L.useState(!1),a=L.useRef(null),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{const T=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(T)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=L.useCallback(v=>{a.current=v},[]),E=L.useCallback(()=>{const v=a.current;if(!v)return;const T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),s(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),s(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{T?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),s(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{T?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{s(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),s(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),s(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),s(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return L.useEffect(()=>{const v=()=>{const T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!T)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),O.jsx(Rie.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:O.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:r})})};var S2={},Kb={},qb={},RX;function _Be(){if(RX)return qb;RX=1,Object.defineProperty(qb,"__esModule",{value:!0}),qb.useUnityCanvasId=void 0;var r=vu(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,r.useMemo)(function(){return[s,++t].join("-")},[]);return d};return qb.useUnityCanvasId=a,qb}var Qp={},Yb={},CX;function Cie(){if(CX)return Yb;CX=1,Object.defineProperty(Yb,"__esModule",{value:!0}),Yb.UnityLoaderStatus=void 0;var r;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(r||(Yb.UnityLoaderStatus=r={})),Yb}var Xb={},IX;function Bj(){return IX||(IX=1,Object.defineProperty(Xb,"__esModule",{value:!0}),Xb.isBrowserEnvironment=void 0,Xb.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),Xb}var AX;function EBe(){if(AX)return Qp;AX=1;var r=Qp&&Qp.__awaiter||function(f,E,v,T){function w(I){return I instanceof v?I:new v(function(N){N(I)})}return new(v||(v=Promise))(function(I,N){function F(H){try{G(T.next(H))}catch(te){N(te)}}function j(H){try{G(T.throw(H))}catch(te){N(te)}}function G(H){H.done?I(H.value):w(H.value).then(F,j)}G((T=T.apply(f,E||[])).next())})},t=Qp&&Qp.__generator||function(f,E){var v={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},T,w,I,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=F(0),N.throw=F(1),N.return=F(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function F(G){return function(H){return j([G,H])}}function j(G){if(T)throw new TypeError("Generator is already executing.");for(;N&&(N=0,G[0]&&(v=0)),v;)try{if(T=1,w&&(I=G[0]&2?w.return:G[0]?w.throw||((I=w.return)&&I.call(w),0):w.next)&&!(I=I.call(w,G[1])).done)return I;switch(w=0,I&&(G=[G[0]&2,I.value]),G[0]){case 0:case 1:I=G;break;case 4:return v.label++,{value:G[1],done:!1};case 5:v.label++,w=G[1],G=[0];continue;case 7:G=v.ops.pop(),v.trys.pop();continue;default:if(I=v.trys,!(I=I.length>0&&I[I.length-1])&&(G[0]===6||G[0]===2)){v=0;continue}if(G[0]===3&&(!I||G[1]>I[0]&&G[1]<I[3])){v.label=G[1];break}if(G[0]===6&&v.label<I[1]){v.label=I[1],I=G;break}if(I&&v.label<I[2]){v.label=I[2],v.ops.push(G);break}I[2]&&v.ops.pop(),v.trys.pop();continue}G=E.call(f,v)}catch(H){G=[6,H],w=0}finally{T=I=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}};Object.defineProperty(Qp,"__esModule",{value:!0}),Qp.useUnityInstance=void 0;var s=vu(),a=Cie(),l=Bj(),d=function(f,E,v,T){(0,s.useEffect)(function(){(function(){return r(void 0,void 0,void 0,function(){var w,I;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||E===null)return T.setUnityInstance(null),T.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(E,v,T.setLoadingProgression)];case 2:return w=N.sent(),T.setUnityInstance(w),T.setInitialisationError(null),[3,4];case 3:return I=N.sent(),T.setUnityInstance(null),T.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,E,v,T])};return Qp.useUnityInstance=d,Qp}var Jb={},PX;function yBe(){if(PX)return Jb;PX=1,Object.defineProperty(Jb,"__esModule",{value:!0}),Jb.useUnityArguments=void 0;var r=vu(),t=function(s){return(0,r.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return Jb.useUnityArguments=t,Jb}var Qb={},OX;function vBe(){if(OX)return Qb;OX=1,Object.defineProperty(Qb,"__esModule",{value:!0}),Qb.useUnityLoader=void 0;var r=vu(),t=Bj(),s=Cie(),a=function(l){var d=(0,r.useState)(s.UnityLoaderStatus.Loading),f=d[0],E=d[1];return(0,r.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(s.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):E(v.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var T=function(w){return E(w.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return v.addEventListener("load",T),v.addEventListener("error",T),function(){v!==null&&(v.removeEventListener("load",T),v.removeEventListener("error",T),window.document.body.removeChild(v))}}},[l.loaderUrl]),f};return Qb.useUnityLoader=a,Qb}var kX;function SBe(){if(kX)return Kb;kX=1,Object.defineProperty(Kb,"__esModule",{value:!0}),Kb.Unity=void 0;var r=vu(),t=vu(),s=_Be(),a=EBe(),l=yBe(),d=vBe(),f=(0,t.forwardRef)(function(E,v){var T=(0,t.useRef)(null),w=(0,s.useUnityCanvasId)(E),I=(0,l.useUnityArguments)(E),N=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,T.current,I,E.unityProvider),(0,r.useImperativeHandle)(v,function(){return T.current}),(0,r.createElement)("canvas",{ref:T,id:w,style:E.style,className:E.className,tabIndex:E.tabIndex})});return Kb.Unity=f,Kb}var Zp={},Zb={},NX;function Iie(){if(NX)return Zb;NX=1,Object.defineProperty(Zb,"__esModule",{value:!0}),Zb.errorMessages=void 0;var r={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Zb.errorMessages=r,Zb}var K_={},DX;function TBe(){if(DX)return K_;DX=1;var r=K_&&K_.__spreadArray||function(E,v,T){if(T||arguments.length===2)for(var w=0,I=v.length,N;w<I;w++)(N||!(w in v))&&(N||(N=Array.prototype.slice.call(v,0,w)),N[w]=v[w]);return E.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(K_,"__esModule",{value:!0}),K_.useEventSystem=void 0;var t=vu(),s=Iie(),a=Bj(),l=[],d=function(E){for(var v=[],T=1;T<arguments.length;T++)v[T-1]=arguments[T];var w=void 0;return l.forEach(function(I){w=I.apply(void 0,r([E],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var f=function(){var E=(0,t.useRef)([]),v=(0,t.useCallback)(function(I,N){E.current=r(r([],E.current,!0),[{eventName:I,callback:N}],!1)},[E]),T=(0,t.useCallback)(function(I,N){E.current=E.current.filter(function(F){return F.eventName!==I&&F.callback!==N})},[E]),w=(0,t.useCallback)(function(I){for(var N=[],F=1;F<arguments.length;F++)N[F-1]=arguments[F];var j=E.current.find(function(G){return G.eventName===I});if(typeof j>"u"){console.warn(s.errorMessages.noEventListener,{eventName:I});return}return j.callback.apply(j,N)},[E]);return(0,t.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:T}};return K_.useEventSystem=f,K_}var ew={},LX;function bBe(){if(LX)return ew;LX=1,Object.defineProperty(ew,"__esModule",{value:!0}),ew.useNullableState=void 0;var r=vu(),t=function(s){return(0,r.useState)(s||null)};return ew.useNullableState=t,ew}var xX;function wBe(){if(xX)return Zp;xX=1;var r=Zp&&Zp.__awaiter||function(E,v,T,w){function I(N){return N instanceof T?N:new T(function(F){F(N)})}return new(T||(T=Promise))(function(N,F){function j(te){try{H(w.next(te))}catch(K){F(K)}}function G(te){try{H(w.throw(te))}catch(K){F(K)}}function H(te){te.done?N(te.value):I(te.value).then(j,G)}H((w=w.apply(E,v||[])).next())})},t=Zp&&Zp.__generator||function(E,v){var T={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},w,I,N,F=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return F.next=j(0),F.throw=j(1),F.return=j(2),typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function j(H){return function(te){return G([H,te])}}function G(H){if(w)throw new TypeError("Generator is already executing.");for(;F&&(F=0,H[0]&&(T=0)),T;)try{if(w=1,I&&(N=H[0]&2?I.return:H[0]?I.throw||((N=I.return)&&N.call(I),0):I.next)&&!(N=N.call(I,H[1])).done)return N;switch(I=0,N&&(H=[H[0]&2,N.value]),H[0]){case 0:case 1:N=H;break;case 4:return T.label++,{value:H[1],done:!1};case 5:T.label++,I=H[1],H=[0];continue;case 7:H=T.ops.pop(),T.trys.pop();continue;default:if(N=T.trys,!(N=N.length>0&&N[N.length-1])&&(H[0]===6||H[0]===2)){T=0;continue}if(H[0]===3&&(!N||H[1]>N[0]&&H[1]<N[3])){T.label=H[1];break}if(H[0]===6&&T.label<N[1]){T.label=N[1],N=H;break}if(N&&T.label<N[2]){T.label=N[2],T.ops.push(H);break}N[2]&&T.ops.pop(),T.trys.pop();continue}H=v.call(E,T)}catch(te){H=[6,te],I=0}finally{w=N=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}};Object.defineProperty(Zp,"__esModule",{value:!0}),Zp.useUnityContext=void 0;var s=vu(),a=Iie(),l=TBe(),d=bBe(),f=function(E){var v=(0,d.useNullableState)(),T=v[0],w=v[1],I=(0,s.useState)(0),N=I[0],F=I[1],j=(0,s.useState)(!1),G=j[0],H=j[1],te=(0,d.useNullableState)(),K=te[0],Q=te[1],de=(0,l.useEventSystem)(),se=(0,s.useRef)({setLoadingProgression:F,setInitialisationError:Q,setUnityInstance:w,setIsLoaded:H,unityConfig:E}),ge=(0,s.useCallback)(function(he){if(T===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}T.SetFullscreen(he===!0?1:0)},[T]),ee=(0,s.useCallback)(function(){if(T===null||typeof T.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return T.Module.canvas.requestPointerLock()},[T]),Z=(0,s.useCallback)(function(he,le,Me){if(T===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}T.SendMessage(he,le,Me)},[T]),ne=(0,s.useCallback)(function(he,le){if(T===null||typeof T.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return T.Module.canvas.toDataURL(he,le)},[T]),ae=(0,s.useCallback)(function(){return T===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):T.Quit()},[T]),me=(0,s.useCallback)(function(){return r(void 0,void 0,void 0,function(){var he;return t(this,function(le){switch(le.label){case 0:return T===null||typeof T.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(he=T.Module.canvas,document.body.appendChild(he),he.style.display="none",[4,ae()]);case 1:return le.sent(),he.remove(),[2]}})})},[T]);return(0,s.useEffect)(function(){H(N===1)},[N]),{unityProvider:se.current,loadingProgression:N,initialisationError:K,isLoaded:G,UNSAFE__unityInstance:T,requestFullscreen:ge,requestPointerLock:ee,sendMessage:Z,takeScreenshot:ne,unload:ae,UNSAFE__detachAndUnloadImmediate:me,addEventListener:de.addEventListener,removeEventListener:de.removeEventListener}};return Zp.useUnityContext=f,Zp}var MX;function RBe(){return MX||(MX=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.useUnityContext=r.Unity=void 0;var t=SBe();Object.defineProperty(r,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=wBe();Object.defineProperty(r,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(S2)),S2}var Aie=RBe();const md="[UnityProvider]",eV=L.createContext(),CBe=({spaceID:r,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:E,showDisruptiveLogo:v})=>{Re.log(`${md} Initializing with spaceID:`,r),Re.log(`${md} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:T,loadingProgression:w,isLoaded:I,sendMessage:N,addEventListener:F,removeEventListener:j,error:G}=Aie.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),H={unityProvider:T,loadingProgression:w,isLoaded:I,sendMessage:N,addEventListener:F,removeEventListener:j,error:G,spaceID:r},te=L.useRef(null),K=L.useRef(Date.now());L.useEffect(()=>{const ge=()=>{document.hidden?(Re.log(`${md} Page hidden, starting keep-alive`),Q()):(Re.log(`${md} Page visible, stopping keep-alive`),de())};return document.addEventListener("visibilitychange",ge),()=>{document.removeEventListener("visibilitychange",ge),de()}},[]),L.useEffect(()=>{const ge=()=>{K.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ge),window.addEventListener("keydown",ge),window.addEventListener("touchstart",ge),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("keydown",ge),window.removeEventListener("touchstart",ge)}},[N]);const Q=()=>{te.current||(te.current=setInterval(()=>{I&&document.hidden&&(N("WebGLInputManager","KeepAlive"),Re.debug(`${md} Sent keep-alive message`))},1e4))},de=()=>{te.current&&(clearInterval(te.current),te.current=null)};L.useEffect(()=>(Re.log(`${md} Component mounted`),()=>{Re.log(`${md} Component unmounting`),de()}),[]),L.useEffect(()=>{Re.log(`${md} Loading progress:`,w)},[w]),L.useEffect(()=>{I&&(Re.log(`${md} Unity instance loaded for:`,r),document.hidden&&Q())},[I,r]),L.useEffect(()=>{G&&Re.error(`${md} Unity error:`,G)},[G]),Re.log(`${md} Rendering provider with instance:`,H),L.useEffect(()=>{Re.log("UnityProvider: Unity build URLs:",{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d})},[s,a,l,d]);const se=[];if(s||se.push("loaderUrl"),a||se.push("dataUrl"),l||se.push("frameworkUrl"),d||se.push("codeUrl"),se.length>0)return Re.error(`UnityProvider: Missing required Unity build URLs: ${se.join(", ")}`),O.jsx(eV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${se.join(", ")}`),spaceID:r},children:t});try{return L.useEffect(()=>{Re.log("UnityProvider: Unity context created:",T),T?Re.log("UnityProvider: Unity provider is available"):Re.error("UnityProvider: Unity provider is not available"),I?Re.log("UnityProvider: Unity is loaded"):Re.log("UnityProvider: Unity is not loaded yet")},[T,I]),O.jsx(eV.Provider,{value:H,children:t})}catch(ge){return Re.error("UnityProvider: Error creating Unity context:",ge),O.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[O.jsx("h3",{children:"Unity Error"}),O.jsxs("p",{children:["Error creating Unity context: ",ge.message]}),O.jsx("p",{children:"Please check the console for more details."})]})}},Kc=()=>L.useContext(eV),bg=()=>{const{sendMessage:r,isLoaded:t}=Kc(),s=L.useRef([]),a=L.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:f}=s.current.shift();Re.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{r("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(E){Re.error("useSendUnityEvent: Error sending event to Unity:",E),s.current.unshift({eventName:d,data:f});break}}},[r,t]);return L.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),L.useCallback((d,f)=>{Re.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:f}),a()},[a])},kf=()=>{const{addEventListener:r,removeEventListener:t}=Kc();return L.useCallback((s,a)=>{const l=d=>{Re.log(s+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(E){Re.warn("Failed to parse JSON data from Unity message:",E)}a(f)};return r(s,l),()=>{t(s,l)}},[r,t])},IBe=()=>{const[r,t]=L.useState(!1),s=kf();return L.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{Re.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),r},ABe=r=>{const[t,s]=L.useState(null),a=kf(),{spaceID:l}=Kc();return L.useEffect(()=>{let f=!0;const v=a("PlayVideo",async T=>{try{const{gameObjectName:w}=T;if(!w){Re.error("Game object name is missing in Unity event data.");return}const I=await wie(l);Re.log("SPACES VIDEOS",I);const N=I.find(F=>F.id===w);N&&f?(s(N.url),Re.log("Video URL set to:",N.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{f=!1,v()}},[a,l,r]),[t,()=>{s(null)}]},PBe=()=>{const r=kf(),{sendUserToUnity:t}=L.useContext(wu);return L.useEffect(()=>{const a=r("RequestUserForUnity",()=>{Re.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[r,t]),!0},OBe=()=>{const{spaceID:r}=Kc(),t=bg(),[s,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Re.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{Re.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!s){Re.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}Re.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!r)throw new Error("spaceID is not defined.");const d=await wie(r),f=async T=>{const w=`https://vimeo.com/api/oembed.json?url=${T}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const N=await I.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let G=null;for(let H of j){const te=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(te,{method:"HEAD"})).ok){G=te;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${te}`,K)}}return G||N.thumbnail_url},E=d.map(async T=>{const w=await f(T.url);return{gameObjectName:T.id,thumbnailUrl:w}}),v=await Promise.all(E);Re.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:T,thumbnailUrl:w})=>{t("SetThumbnail",{gameObjectName:T,thumbnailUrl:w})})}catch(d){Re.error("Error fetching thumbnails:",d)}})()},[t,r,s])},kBe=()=>{const[r,t]=L.useState(null),s=kf();return console.log(" Nameplate click hook initialized"),L.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof f=="string"?JSON.parse(f):f;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[r,()=>{console.log(" Resetting nameplate data"),t(null)}]},Pie=()=>{const[r,t]=L.useState([]),s=kf();return L.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(Re.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=F=>{if(a){Re.log("UpdatePlayerList unity message received.");try{let j=[];if(typeof F=="object"&&F!==null?j=F.players||[]:j=JSON.parse(F).players||[],Array.isArray(j)){const G=Array.from(new Map(j.map(H=>[H.playerId,H])).values());t(G),l&&(clearTimeout(l),l=null)}}catch(j){Re.error("Error handling player list data:",j),l||(l=setTimeout(d,1e3))}}},E=()=>{Re.log("Player disconnected, requesting fresh player list"),d()},v=()=>{Re.log("Player left, requesting fresh player list"),d()};d();const T=s("UpdatePlayerList",f),w=s("PlayerDisconnected",E),I=s("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof T=="function"&&T(),typeof w=="function"&&w(),typeof I=="function"&&I(),clearInterval(N)}},[s]),r},UX=async(r,t,s,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!r||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let E=null;if(s){if(!s.type.startsWith("image/"))throw new Error("File must be an image");const v=DE(),T=Date.now(),w=s.name.split(".").pop(),I=`${t}_${T}.${w}`,N=NE(v,`spaces/${r}/mediaScreens/${I}`);Re.log(`Uploading image for media screen ${t} in space ${r}`);const F=await Fj(N,s);E=await AN(F.ref);const j=ka(To,`spaces/${r}/mediaScreens`,t);await QU(j,{imageUrl:E,gsUrl:`gs://${F.ref.bucket}/${F.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){E=f;const v=ka(To,`spaces/${r}/mediaScreens`,t);await QU(v,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return Re.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),E}catch(l){throw Re.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},Wj=async r=>{Re.log(`Getting media screen images for space: ${r}`);try{const t=Ak(To,`spaces/${r}/mediaScreens`),s=await Ok(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw Re.error("Error fetching media screen images from Firestore:",t),t}},df=async(r,t)=>{try{const s=ka(To,`spaces/${r}/mediaScreens`,t),a=await Eg(s);return a.exists()?{id:a.id,...a.data()}:(Re.warn(`No media screen found with ID: ${t}`),null)}catch(s){throw Re.error("Error fetching media screen image:",s),s}},NBe=async(r,t)=>{try{const s=await df(r,t);if(!s)return Re.warn(`No media screen found with ID: ${t} to delete`),!1;if(s.gsUrl){const l=DE(),d=NE(l,s.gsUrl);try{await jj(d),Re.log(`Deleted file from storage: ${s.gsUrl}`)}catch(f){Re.warn(`Could not delete file from storage: ${f.message}`)}}const a=ka(To,`spaces/${r}/mediaScreens`,t);return s.mediaType==="video"?(await Xh(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Re.log(`Successfully removed video for media screen ${t}`)):(await Xh(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Re.log(`Successfully removed image for media screen ${t}`)),!0}catch(s){throw Re.error("Error deleting media screen image:",s),s}},DBe=async(r,t,s)=>{try{if(!r||!t||typeof s!="boolean")throw new Error("Missing or invalid required parameters");const a=await df(r,t);if(!a||!a.imageUrl&&!a.videoUrl)return Re.warn(`No media screen content found with ID: ${t} to update`),!1;const l=ka(To,`spaces/${r}/mediaScreens`,t);return await Xh(l,{displayAsVideo:s,updatedAt:new Date().toISOString()}),Re.log(`Successfully updated display mode for media screen ${t} to ${s?"video":"image"}`),!0}catch(a){throw Re.error("Error updating media screen display mode:",a),a}},LBe=r=>{if(!r)return null;try{if(r.includes("firebasestorage.googleapis.com")){const t=new URL(r),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${r} to ${t.toString()}`),t.toString()}return r}catch(t){return console.error("Error cleaning Firebase URL:",t),r}},Oie=()=>{const{spaceID:r}=Kc(),t=bg(),[s,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Re.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{Re.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!s){Re.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}Re.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!r)throw new Error("spaceID is not defined.");const d=await Wj(r);Re.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:E,imageUrl:v,displayAsVideo:T,videoUrl:w}=f;let I=null;(!T||!w)&&(I=v?LBe(v):null),t("SetMediaScreenImage",{mediaScreenId:E,imageUrl:I,videoUrl:w||null,displayAsVideo:T||!1,timestamp:Date.now()}),Re.log(`Sent media screen data for ${E} to Unity (displayAsVideo: ${T})`),T&&w&&(t("SetMediaScreenDisplayMode",{mediaScreenId:E,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),Re.log(`Set display mode to video for screen ${E}`))})}catch(d){Re.error("Error fetching media screen images:",d)}})()},[t,r,s])},xBe=r=>({opacity:1});var qR=r=>r.type==="checkbox",rE=r=>r instanceof Date,Xa=r=>r==null;const kie=r=>typeof r=="object";var ks=r=>!Xa(r)&&!Array.isArray(r)&&kie(r)&&!rE(r),MBe=r=>ks(r)&&r.target?qR(r.target)?r.target.checked:r.target.value:r,UBe=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,VBe=(r,t)=>r.has(UBe(t)),FBe=r=>{const t=r.constructor&&r.constructor.prototype;return ks(t)&&t.hasOwnProperty("isPrototypeOf")},zj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function mu(r){let t;const s=Array.isArray(r),a=typeof FileList<"u"?r instanceof FileList:!1;if(r instanceof Date)t=new Date(r);else if(r instanceof Set)t=new Set(r);else if(!(zj&&(r instanceof Blob||a))&&(s||ks(r)))if(t=s?[]:{},!s&&!FBe(r))t=r;else for(const l in r)r.hasOwnProperty(l)&&(t[l]=mu(r[l]));else return r;return t}var PN=r=>Array.isArray(r)?r.filter(Boolean):[],js=r=>r===void 0,on=(r,t,s)=>{if(!t||!ks(r))return s;const a=PN(t.split(/[,[\].]+?/)).reduce((l,d)=>Xa(l)?l:l[d],r);return js(a)||a===r?js(r[t])?s:r[t]:a},Rh=r=>typeof r=="boolean",Gj=r=>/^\w*$/.test(r),Nie=r=>PN(r.replace(/["|']|\]/g,"").split(/\.|\[/)),xi=(r,t,s)=>{let a=-1;const l=Gj(t)?[t]:Nie(t),d=l.length,f=d-1;for(;++a<d;){const E=l[a];let v=s;if(a!==f){const T=r[E];v=ks(T)||Array.isArray(T)?T:isNaN(+l[a+1])?{}:[]}if(E==="__proto__"||E==="constructor"||E==="prototype")return;r[E]=v,r=r[E]}return r};const VX={BLUR:"blur",FOCUS_OUT:"focusout"},Ed={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ef={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ti.createContext(null);var jBe=(r,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in r)Object.defineProperty(l,d,{get:()=>{const f=d;return t._proxyFormState[f]!==Ed.all&&(t._proxyFormState[f]=!a||Ed.all),r[f]}});return l},Mc=r=>ks(r)&&!Object.keys(r).length,BBe=(r,t,s,a)=>{s(r);const{name:l,...d}=r;return Mc(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(f=>t[f]===Ed.all)},zO=r=>Array.isArray(r)?r:[r];function WBe(r){const t=ti.useRef(r);t.current=r,ti.useEffect(()=>{const s=!r.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[r.disabled])}var xh=r=>typeof r=="string",zBe=(r,t,s,a,l)=>xh(r)?(a&&t.watch.add(r),on(s,r,l)):Array.isArray(r)?r.map(d=>(a&&t.watch.add(d),on(s,d))):(a&&(t.watchAll=!0),s),GBe=(r,t,s,a,l)=>t?{...s[r],types:{...s[r]&&s[r].types?s[r].types:{},[a]:l||!0}}:{},FX=r=>({isOnSubmit:!r||r===Ed.onSubmit,isOnBlur:r===Ed.onBlur,isOnChange:r===Ed.onChange,isOnAll:r===Ed.all,isOnTouch:r===Ed.onTouched}),jX=(r,t,s)=>!s&&(t.watchAll||t.watch.has(r)||[...t.watch].some(a=>r.startsWith(a)&&/^\.\w+/.test(r.slice(a.length))));const jw=(r,t,s,a)=>{for(const l of s||Object.keys(r)){const d=on(r,l);if(d){const{_f:f,...E}=d;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!a)return!0;if(f.ref&&t(f.ref,f.name)&&!a)return!0;if(jw(E,t))break}else if(ks(E)&&jw(E,t))break}}};var HBe=(r,t,s)=>{const a=zO(on(r,s));return xi(a,"root",t[s]),xi(r,s,a),r},Hj=r=>r.type==="file",kh=r=>typeof r=="function",kk=r=>{if(!zj)return!1;const t=r?r.ownerDocument:0;return r instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},GO=r=>xh(r),$j=r=>r.type==="radio",Nk=r=>r instanceof RegExp;const BX={value:!1,isValid:!1},WX={value:!0,isValid:!0};var Die=r=>{if(Array.isArray(r)){if(r.length>1){const t=r.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!js(r[0].attributes.value)?js(r[0].value)||r[0].value===""?WX:{value:r[0].value,isValid:!0}:WX:BX}return BX};const zX={isValid:!1,value:null};var Lie=r=>Array.isArray(r)?r.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,zX):zX;function GX(r,t,s="validate"){if(GO(r)||Array.isArray(r)&&r.every(GO)||Rh(r)&&!r)return{type:s,message:GO(r)?r:"",ref:t}}var rS=r=>ks(r)&&!Nk(r)?r:{value:r,message:""},HX=async(r,t,s,a,l,d)=>{const{ref:f,refs:E,required:v,maxLength:T,minLength:w,min:I,max:N,pattern:F,validate:j,name:G,valueAsNumber:H,mount:te}=r._f,K=on(s,G);if(!te||t.has(G))return{};const Q=E?E[0]:f,de=he=>{l&&Q.reportValidity&&(Q.setCustomValidity(Rh(he)?"":he||""),Q.reportValidity())},se={},ge=$j(f),ee=qR(f),Z=ge||ee,ne=(H||Hj(f))&&js(f.value)&&js(K)||kk(f)&&f.value===""||K===""||Array.isArray(K)&&!K.length,ae=GBe.bind(null,G,a,se),me=(he,le,Me,Ge=ef.maxLength,tt=ef.minLength)=>{const Ee=he?le:Me;se[G]={type:he?Ge:tt,message:Ee,ref:f,...ae(he?Ge:tt,Ee)}};if(d?!Array.isArray(K)||!K.length:v&&(!Z&&(ne||Xa(K))||Rh(K)&&!K||ee&&!Die(E).isValid||ge&&!Lie(E).isValid)){const{value:he,message:le}=GO(v)?{value:!!v,message:v}:rS(v);if(he&&(se[G]={type:ef.required,message:le,ref:Q,...ae(ef.required,le)},!a))return de(le),se}if(!ne&&(!Xa(I)||!Xa(N))){let he,le;const Me=rS(N),Ge=rS(I);if(!Xa(K)&&!isNaN(K)){const tt=f.valueAsNumber||K&&+K;Xa(Me.value)||(he=tt>Me.value),Xa(Ge.value)||(le=tt<Ge.value)}else{const tt=f.valueAsDate||new Date(K),Ee=Be=>new Date(new Date().toDateString()+" "+Be),we=f.type=="time",ve=f.type=="week";xh(Me.value)&&K&&(he=we?Ee(K)>Ee(Me.value):ve?K>Me.value:tt>new Date(Me.value)),xh(Ge.value)&&K&&(le=we?Ee(K)<Ee(Ge.value):ve?K<Ge.value:tt<new Date(Ge.value))}if((he||le)&&(me(!!he,Me.message,Ge.message,ef.max,ef.min),!a))return de(se[G].message),se}if((T||w)&&!ne&&(xh(K)||d&&Array.isArray(K))){const he=rS(T),le=rS(w),Me=!Xa(he.value)&&K.length>+he.value,Ge=!Xa(le.value)&&K.length<+le.value;if((Me||Ge)&&(me(Me,he.message,le.message),!a))return de(se[G].message),se}if(F&&!ne&&xh(K)){const{value:he,message:le}=rS(F);if(Nk(he)&&!K.match(he)&&(se[G]={type:ef.pattern,message:le,ref:f,...ae(ef.pattern,le)},!a))return de(le),se}if(j){if(kh(j)){const he=await j(K,s),le=GX(he,Q);if(le&&(se[G]={...le,...ae(ef.validate,le.message)},!a))return de(le.message),se}else if(ks(j)){let he={};for(const le in j){if(!Mc(he)&&!a)break;const Me=GX(await j[le](K,s),Q,le);Me&&(he={...Me,...ae(le,Me.message)},de(Me.message),a&&(se[G]=he))}if(!Mc(he)&&(se[G]={ref:Q,...he},!a))return se}}return de(!0),se};function $Be(r,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)r=js(r)?a++:r[t[a++]];return r}function KBe(r){for(const t in r)if(r.hasOwnProperty(t)&&!js(r[t]))return!1;return!0}function to(r,t){const s=Array.isArray(t)?t:Gj(t)?[t]:Nie(t),a=s.length===1?r:$Be(r,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(ks(a)&&Mc(a)||Array.isArray(a)&&KBe(a))&&to(r,s.slice(0,-1)),r}var T2=()=>{let r=[];return{get observers(){return r},next:l=>{for(const d of r)d.next&&d.next(l)},subscribe:l=>(r.push(l),{unsubscribe:()=>{r=r.filter(d=>d!==l)}}),unsubscribe:()=>{r=[]}}},tV=r=>Xa(r)||!kie(r);function Jm(r,t){if(tV(r)||tV(t))return r===t;if(rE(r)&&rE(t))return r.getTime()===t.getTime();const s=Object.keys(r),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=r[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=t[l];if(rE(d)&&rE(f)||ks(d)&&ks(f)||Array.isArray(d)&&Array.isArray(f)?!Jm(d,f):d!==f)return!1}}return!0}var xie=r=>r.type==="select-multiple",qBe=r=>$j(r)||qR(r),b2=r=>kk(r)&&r.isConnected,Mie=r=>{for(const t in r)if(kh(r[t]))return!0;return!1};function Dk(r,t={}){const s=Array.isArray(r);if(ks(r)||s)for(const a in r)Array.isArray(r[a])||ks(r[a])&&!Mie(r[a])?(t[a]=Array.isArray(r[a])?[]:{},Dk(r[a],t[a])):Xa(r[a])||(t[a]=!0);return t}function Uie(r,t,s){const a=Array.isArray(r);if(ks(r)||a)for(const l in r)Array.isArray(r[l])||ks(r[l])&&!Mie(r[l])?js(t)||tV(s[l])?s[l]=Array.isArray(r[l])?Dk(r[l],[]):{...Dk(r[l])}:Uie(r[l],Xa(t)?{}:t[l],s[l]):s[l]=!Jm(r[l],t[l]);return s}var tw=(r,t)=>Uie(r,t,Dk(t)),Vie=(r,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>js(r)?r:t?r===""?NaN:r&&+r:s&&xh(r)?new Date(r):a?a(r):r;function w2(r){const t=r.ref;return Hj(t)?t.files:$j(t)?Lie(r.refs).value:xie(t)?[...t.selectedOptions].map(({value:s})=>s):qR(t)?Die(r.refs).value:Vie(js(t.value)?r.ref.value:t.value,r)}var YBe=(r,t,s,a)=>{const l={};for(const d of r){const f=on(t,d);f&&xi(l,d,f._f)}return{criteriaMode:s,names:[...r],fields:l,shouldUseNativeValidation:a}},nw=r=>js(r)?r:Nk(r)?r.source:ks(r)?Nk(r.value)?r.value.source:r.value:r;const $X="AsyncFunction";var XBe=r=>!!r&&!!r.validate&&!!(kh(r.validate)&&r.validate.constructor.name===$X||ks(r.validate)&&Object.values(r.validate).find(t=>t.constructor.name===$X)),JBe=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate);function KX(r,t,s){const a=on(r,s);if(a||Gj(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),f=on(t,d),E=on(r,d);if(f&&!Array.isArray(f)&&s!==d)return{name:s};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:s}}var QBe=(r,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||r):(s?a.isOnBlur:l.isOnBlur)?!r:(s?a.isOnChange:l.isOnChange)?r:!0,ZBe=(r,t)=>!PN(on(r,t)).length&&to(r,t);const e5e={mode:Ed.onSubmit,reValidateMode:Ed.onChange,shouldFocusError:!0};function t5e(r={}){let t={...e5e,...r},s={submitCount:0,isDirty:!1,isLoading:kh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=ks(t.defaultValues)||ks(t.values)?mu(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:mu(l),f={action:!1,mount:!1,watch:!1},E={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,T=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:T2(),array:T2(),state:T2()},N=FX(t.mode),F=FX(t.reValidateMode),j=t.criteriaMode===Ed.all,G=Te=>Ue=>{clearTimeout(T),T=setTimeout(Te,Ue)},H=async Te=>{if(!t.disabled&&(w.isValid||Te)){const Ue=t.resolver?Mc((await Z()).errors):await ae(a,!0);Ue!==s.isValid&&I.state.next({isValid:Ue})}},te=(Te,Ue)=>{!t.disabled&&(w.isValidating||w.validatingFields)&&((Te||Array.from(E.mount)).forEach($e=>{$e&&(Ue?xi(s.validatingFields,$e,Ue):to(s.validatingFields,$e))}),I.state.next({validatingFields:s.validatingFields,isValidating:!Mc(s.validatingFields)}))},K=(Te,Ue=[],$e,mt,Et=!0,yt=!0)=>{if(mt&&$e&&!t.disabled){if(f.action=!0,yt&&Array.isArray(on(a,Te))){const zt=$e(on(a,Te),mt.argA,mt.argB);Et&&xi(a,Te,zt)}if(yt&&Array.isArray(on(s.errors,Te))){const zt=$e(on(s.errors,Te),mt.argA,mt.argB);Et&&xi(s.errors,Te,zt),ZBe(s.errors,Te)}if(w.touchedFields&&yt&&Array.isArray(on(s.touchedFields,Te))){const zt=$e(on(s.touchedFields,Te),mt.argA,mt.argB);Et&&xi(s.touchedFields,Te,zt)}w.dirtyFields&&(s.dirtyFields=tw(l,d)),I.state.next({name:Te,isDirty:he(Te,Ue),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else xi(d,Te,Ue)},Q=(Te,Ue)=>{xi(s.errors,Te,Ue),I.state.next({errors:s.errors})},de=Te=>{s.errors=Te,I.state.next({errors:s.errors,isValid:!1})},se=(Te,Ue,$e,mt)=>{const Et=on(a,Te);if(Et){const yt=on(d,Te,js($e)?on(l,Te):$e);js(yt)||mt&&mt.defaultChecked||Ue?xi(d,Te,Ue?yt:w2(Et._f)):Ge(Te,yt),f.mount&&H()}},ge=(Te,Ue,$e,mt,Et)=>{let yt=!1,zt=!1;const dn={name:Te};if(!t.disabled){const hn=!!(on(a,Te)&&on(a,Te)._f&&on(a,Te)._f.disabled);if(!$e||mt){w.isDirty&&(zt=s.isDirty,s.isDirty=dn.isDirty=he(),yt=zt!==dn.isDirty);const Yt=hn||Jm(on(l,Te),Ue);zt=!!(!hn&&on(s.dirtyFields,Te)),Yt||hn?to(s.dirtyFields,Te):xi(s.dirtyFields,Te,!0),dn.dirtyFields=s.dirtyFields,yt=yt||w.dirtyFields&&zt!==!Yt}if($e){const Yt=on(s.touchedFields,Te);Yt||(xi(s.touchedFields,Te,$e),dn.touchedFields=s.touchedFields,yt=yt||w.touchedFields&&Yt!==$e)}yt&&Et&&I.state.next(dn)}return yt?dn:{}},ee=(Te,Ue,$e,mt)=>{const Et=on(s.errors,Te),yt=w.isValid&&Rh(Ue)&&s.isValid!==Ue;if(t.delayError&&$e?(v=G(()=>Q(Te,$e)),v(t.delayError)):(clearTimeout(T),v=null,$e?xi(s.errors,Te,$e):to(s.errors,Te)),($e?!Jm(Et,$e):Et)||!Mc(mt)||yt){const zt={...mt,...yt&&Rh(Ue)?{isValid:Ue}:{},errors:s.errors,name:Te};s={...s,...zt},I.state.next(zt)}},Z=async Te=>{te(Te,!0);const Ue=await t.resolver(d,t.context,YBe(Te||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return te(Te),Ue},ne=async Te=>{const{errors:Ue}=await Z(Te);if(Te)for(const $e of Te){const mt=on(Ue,$e);mt?xi(s.errors,$e,mt):to(s.errors,$e)}else s.errors=Ue;return Ue},ae=async(Te,Ue,$e={valid:!0})=>{for(const mt in Te){const Et=Te[mt];if(Et){const{_f:yt,...zt}=Et;if(yt){const dn=E.array.has(yt.name),hn=Et._f&&XBe(Et._f);hn&&w.validatingFields&&te([mt],!0);const Yt=await HX(Et,E.disabled,d,j,t.shouldUseNativeValidation&&!Ue,dn);if(hn&&w.validatingFields&&te([mt]),Yt[yt.name]&&($e.valid=!1,Ue))break;!Ue&&(on(Yt,yt.name)?dn?HBe(s.errors,Yt,yt.name):xi(s.errors,yt.name,Yt[yt.name]):to(s.errors,yt.name))}!Mc(zt)&&await ae(zt,Ue,$e)}}return $e.valid},me=()=>{for(const Te of E.unMount){const Ue=on(a,Te);Ue&&(Ue._f.refs?Ue._f.refs.every($e=>!b2($e)):!b2(Ue._f.ref))&&Qe(Te)}E.unMount=new Set},he=(Te,Ue)=>!t.disabled&&(Te&&Ue&&xi(d,Te,Ue),!Jm(Oe(),l)),le=(Te,Ue,$e)=>zBe(Te,E,{...f.mount?d:js(Ue)?l:xh(Te)?{[Te]:Ue}:Ue},$e,Ue),Me=Te=>PN(on(f.mount?d:l,Te,t.shouldUnregister?on(l,Te,[]):[])),Ge=(Te,Ue,$e={})=>{const mt=on(a,Te);let Et=Ue;if(mt){const yt=mt._f;yt&&(!yt.disabled&&xi(d,Te,Vie(Ue,yt)),Et=kk(yt.ref)&&Xa(Ue)?"":Ue,xie(yt.ref)?[...yt.ref.options].forEach(zt=>zt.selected=Et.includes(zt.value)):yt.refs?qR(yt.ref)?yt.refs.length>1?yt.refs.forEach(zt=>(!zt.defaultChecked||!zt.disabled)&&(zt.checked=Array.isArray(Et)?!!Et.find(dn=>dn===zt.value):Et===zt.value)):yt.refs[0]&&(yt.refs[0].checked=!!Et):yt.refs.forEach(zt=>zt.checked=zt.value===Et):Hj(yt.ref)?yt.ref.value="":(yt.ref.value=Et,yt.ref.type||I.values.next({name:Te,values:{...d}})))}($e.shouldDirty||$e.shouldTouch)&&ge(Te,Et,$e.shouldTouch,$e.shouldDirty,!0),$e.shouldValidate&&Be(Te)},tt=(Te,Ue,$e)=>{for(const mt in Ue){const Et=Ue[mt],yt=`${Te}.${mt}`,zt=on(a,yt);(E.array.has(Te)||ks(Et)||zt&&!zt._f)&&!rE(Et)?tt(yt,Et,$e):Ge(yt,Et,$e)}},Ee=(Te,Ue,$e={})=>{const mt=on(a,Te),Et=E.array.has(Te),yt=mu(Ue);xi(d,Te,yt),Et?(I.array.next({name:Te,values:{...d}}),(w.isDirty||w.dirtyFields)&&$e.shouldDirty&&I.state.next({name:Te,dirtyFields:tw(l,d),isDirty:he(Te,yt)})):mt&&!mt._f&&!Xa(yt)?tt(Te,yt,$e):Ge(Te,yt,$e),jX(Te,E)&&I.state.next({...s}),I.values.next({name:f.mount?Te:void 0,values:{...d}})},we=async Te=>{f.mount=!0;const Ue=Te.target;let $e=Ue.name,mt=!0;const Et=on(a,$e),yt=()=>Ue.type?w2(Et._f):MBe(Te),zt=dn=>{mt=Number.isNaN(dn)||rE(dn)&&isNaN(dn.getTime())||Jm(dn,on(d,$e,dn))};if(Et){let dn,hn;const Yt=yt(),Bn=Te.type===VX.BLUR||Te.type===VX.FOCUS_OUT,ec=!JBe(Et._f)&&!t.resolver&&!on(s.errors,$e)&&!Et._f.deps||QBe(Bn,on(s.touchedFields,$e),s.isSubmitted,F,N),jt=jX($e,E,Bn);xi(d,$e,Yt),Bn?(Et._f.onBlur&&Et._f.onBlur(Te),v&&v(0)):Et._f.onChange&&Et._f.onChange(Te);const an=ge($e,Yt,Bn,!1),qi=!Mc(an)||jt;if(!Bn&&I.values.next({name:$e,type:Te.type,values:{...d}}),ec)return w.isValid&&(t.mode==="onBlur"&&Bn?H():Bn||H()),qi&&I.state.next({name:$e,...jt?{}:an});if(!Bn&&jt&&I.state.next({...s}),t.resolver){const{errors:Ns}=await Z([$e]);if(zt(Yt),mt){const Gs=KX(s.errors,a,$e),ui=KX(Ns,a,Gs.name||$e);dn=ui.error,$e=ui.name,hn=Mc(Ns)}}else te([$e],!0),dn=(await HX(Et,E.disabled,d,j,t.shouldUseNativeValidation))[$e],te([$e]),zt(Yt),mt&&(dn?hn=!1:w.isValid&&(hn=await ae(a,!0)));mt&&(Et._f.deps&&Be(Et._f.deps),ee($e,hn,dn,an))}},ve=(Te,Ue)=>{if(on(s.errors,Ue)&&Te.focus)return Te.focus(),1},Be=async(Te,Ue={})=>{let $e,mt;const Et=zO(Te);if(t.resolver){const yt=await ne(js(Te)?Te:Et);$e=Mc(yt),mt=Te?!Et.some(zt=>on(yt,zt)):$e}else Te?(mt=(await Promise.all(Et.map(async yt=>{const zt=on(a,yt);return await ae(zt&&zt._f?{[yt]:zt}:zt)}))).every(Boolean),!(!mt&&!s.isValid)&&H()):mt=$e=await ae(a);return I.state.next({...!xh(Te)||w.isValid&&$e!==s.isValid?{}:{name:Te},...t.resolver||!Te?{isValid:$e}:{},errors:s.errors}),Ue.shouldFocus&&!mt&&jw(a,ve,Te?Et:E.mount),mt},Oe=Te=>{const Ue={...f.mount?d:l};return js(Te)?Ue:xh(Te)?on(Ue,Te):Te.map($e=>on(Ue,$e))},be=(Te,Ue)=>({invalid:!!on((Ue||s).errors,Te),isDirty:!!on((Ue||s).dirtyFields,Te),error:on((Ue||s).errors,Te),isValidating:!!on(s.validatingFields,Te),isTouched:!!on((Ue||s).touchedFields,Te)}),Ce=Te=>{Te&&zO(Te).forEach(Ue=>to(s.errors,Ue)),I.state.next({errors:Te?s.errors:{}})},xe=(Te,Ue,$e)=>{const mt=(on(a,Te,{_f:{}})._f||{}).ref,Et=on(s.errors,Te)||{},{ref:yt,message:zt,type:dn,...hn}=Et;xi(s.errors,Te,{...hn,...Ue,ref:mt}),I.state.next({name:Te,errors:s.errors,isValid:!1}),$e&&$e.shouldFocus&&mt&&mt.focus&&mt.focus()},ze=(Te,Ue)=>kh(Te)?I.values.subscribe({next:$e=>Te(le(void 0,Ue),$e)}):le(Te,Ue,!0),Qe=(Te,Ue={})=>{for(const $e of Te?zO(Te):E.mount)E.mount.delete($e),E.array.delete($e),Ue.keepValue||(to(a,$e),to(d,$e)),!Ue.keepError&&to(s.errors,$e),!Ue.keepDirty&&to(s.dirtyFields,$e),!Ue.keepTouched&&to(s.touchedFields,$e),!Ue.keepIsValidating&&to(s.validatingFields,$e),!t.shouldUnregister&&!Ue.keepDefaultValue&&to(l,$e);I.values.next({values:{...d}}),I.state.next({...s,...Ue.keepDirty?{isDirty:he()}:{}}),!Ue.keepIsValid&&H()},et=({disabled:Te,name:Ue,field:$e,fields:mt})=>{(Rh(Te)&&f.mount||Te||E.disabled.has(Ue))&&(Te?E.disabled.add(Ue):E.disabled.delete(Ue),ge(Ue,w2($e?$e._f:on(mt,Ue)._f),!1,!1,!0))},ut=(Te,Ue={})=>{let $e=on(a,Te);const mt=Rh(Ue.disabled)||Rh(t.disabled);return xi(a,Te,{...$e||{},_f:{...$e&&$e._f?$e._f:{ref:{name:Te}},name:Te,mount:!0,...Ue}}),E.mount.add(Te),$e?et({field:$e,disabled:Rh(Ue.disabled)?Ue.disabled:t.disabled,name:Te}):se(Te,!0,Ue.value),{...mt?{disabled:Ue.disabled||t.disabled}:{},...t.progressive?{required:!!Ue.required,min:nw(Ue.min),max:nw(Ue.max),minLength:nw(Ue.minLength),maxLength:nw(Ue.maxLength),pattern:nw(Ue.pattern)}:{},name:Te,onChange:we,onBlur:we,ref:Et=>{if(Et){ut(Te,Ue),$e=on(a,Te);const yt=js(Et.value)&&Et.querySelectorAll&&Et.querySelectorAll("input,select,textarea")[0]||Et,zt=qBe(yt),dn=$e._f.refs||[];if(zt?dn.find(hn=>hn===yt):yt===$e._f.ref)return;xi(a,Te,{_f:{...$e._f,...zt?{refs:[...dn.filter(b2),yt,...Array.isArray(on(l,Te))?[{}]:[]],ref:{type:yt.type,name:Te}}:{ref:yt}}}),se(Te,!1,void 0,yt)}else $e=on(a,Te,{}),$e._f&&($e._f.mount=!1),(t.shouldUnregister||Ue.shouldUnregister)&&!(VBe(E.array,Te)&&f.action)&&E.unMount.add(Te)}}},it=()=>t.shouldFocusError&&jw(a,ve,E.mount),Ct=Te=>{Rh(Te)&&(I.state.next({disabled:Te}),jw(a,(Ue,$e)=>{const mt=on(a,$e);mt&&(Ue.disabled=mt._f.disabled||Te,Array.isArray(mt._f.refs)&&mt._f.refs.forEach(Et=>{Et.disabled=mt._f.disabled||Te}))},0,!1))},_n=(Te,Ue)=>async $e=>{let mt;$e&&($e.preventDefault&&$e.preventDefault(),$e.persist&&$e.persist());let Et=mu(d);if(E.disabled.size)for(const yt of E.disabled)xi(Et,yt,void 0);if(I.state.next({isSubmitting:!0}),t.resolver){const{errors:yt,values:zt}=await Z();s.errors=yt,Et=zt}else await ae(a);if(to(s.errors,"root"),Mc(s.errors)){I.state.next({errors:{}});try{await Te(Et,$e)}catch(yt){mt=yt}}else Ue&&await Ue({...s.errors},$e),it(),setTimeout(it);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Mc(s.errors)&&!mt,submitCount:s.submitCount+1,errors:s.errors}),mt)throw mt},Vt=(Te,Ue={})=>{on(a,Te)&&(js(Ue.defaultValue)?Ee(Te,mu(on(l,Te))):(Ee(Te,Ue.defaultValue),xi(l,Te,mu(Ue.defaultValue))),Ue.keepTouched||to(s.touchedFields,Te),Ue.keepDirty||(to(s.dirtyFields,Te),s.isDirty=Ue.defaultValue?he(Te,mu(on(l,Te))):he()),Ue.keepError||(to(s.errors,Te),w.isValid&&H()),I.state.next({...s}))},ln=(Te,Ue={})=>{const $e=Te?mu(Te):l,mt=mu($e),Et=Mc(Te),yt=Et?l:mt;if(Ue.keepDefaultValues||(l=$e),!Ue.keepValues){if(Ue.keepDirtyValues){const zt=new Set([...E.mount,...Object.keys(tw(l,d))]);for(const dn of Array.from(zt))on(s.dirtyFields,dn)?xi(yt,dn,on(d,dn)):Ee(dn,on(yt,dn))}else{if(zj&&js(Te))for(const zt of E.mount){const dn=on(a,zt);if(dn&&dn._f){const hn=Array.isArray(dn._f.refs)?dn._f.refs[0]:dn._f.ref;if(kk(hn)){const Yt=hn.closest("form");if(Yt){Yt.reset();break}}}}a={}}d=t.shouldUnregister?Ue.keepDefaultValues?mu(l):{}:mu(yt),I.array.next({values:{...yt}}),I.values.next({values:{...yt}})}E={mount:Ue.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!w.isValid||!!Ue.keepIsValid||!!Ue.keepDirtyValues,f.watch=!!t.shouldUnregister,I.state.next({submitCount:Ue.keepSubmitCount?s.submitCount:0,isDirty:Et?!1:Ue.keepDirty?s.isDirty:!!(Ue.keepDefaultValues&&!Jm(Te,l)),isSubmitted:Ue.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:Et?{}:Ue.keepDirtyValues?Ue.keepDefaultValues&&d?tw(l,d):s.dirtyFields:Ue.keepDefaultValues&&Te?tw(l,Te):Ue.keepDirty?s.dirtyFields:{},touchedFields:Ue.keepTouched?s.touchedFields:{},errors:Ue.keepErrors?s.errors:{},isSubmitSuccessful:Ue.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},xn=(Te,Ue)=>ln(kh(Te)?Te(d):Te,Ue);return{control:{register:ut,unregister:Qe,getFieldState:be,handleSubmit:_n,setError:xe,_executeSchema:Z,_getWatch:le,_getDirty:he,_updateValid:H,_removeUnmounted:me,_updateFieldArray:K,_updateDisabledField:et,_getFieldArray:Me,_reset:ln,_resetDefaultValues:()=>kh(t.defaultValues)&&t.defaultValues().then(Te=>{xn(Te,t.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Te=>{s={...s,...Te}},_disableForm:Ct,_subjects:I,_proxyFormState:w,_setErrors:de,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(Te){f=Te},get _defaultValues(){return l},get _names(){return E},set _names(Te){E=Te},get _formState(){return s},set _formState(Te){s=Te},get _options(){return t},set _options(Te){t={...t,...Te}}},trigger:Be,register:ut,handleSubmit:_n,watch:ze,setValue:Ee,getValues:Oe,reset:xn,resetField:Vt,clearErrors:Ce,unregister:Qe,setError:xe,setFocus:(Te,Ue={})=>{const $e=on(a,Te),mt=$e&&$e._f;if(mt){const Et=mt.refs?mt.refs[0]:mt.ref;Et.focus&&(Et.focus(),Ue.shouldSelect&&kh(Et.select)&&Et.select())}},getFieldState:be}}function Fie(r={}){const t=ti.useRef(void 0),s=ti.useRef(void 0),[a,l]=ti.useState({isDirty:!1,isValidating:!1,isLoading:kh(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,defaultValues:kh(r.defaultValues)?void 0:r.defaultValues});t.current||(t.current={...t5e(r),formState:a});const d=t.current.control;return d._options=r,WBe({subject:d._subjects.state,next:f=>{BBe(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),ti.useEffect(()=>d._disableForm(r.disabled),[d,r.disabled]),ti.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),ti.useEffect(()=>{r.values&&!Jm(r.values,s.current)?(d._reset(r.values,d._options.resetOptions),s.current=r.values,l(f=>({...f}))):d._resetDefaultValues()},[r.values,d]),ti.useEffect(()=>{r.errors&&d._setErrors(r.errors)},[r.errors,d]),ti.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),ti.useEffect(()=>{r.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[r.shouldUnregister,d]),t.current.formState=jBe(a,d),t.current}const ON=(r,t="generic-modal")=>{L.useEffect(()=>{if(!window.unityInstance)return;const s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Re.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){Re.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),Re.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):Re.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){Re.error(`Failed to enable Unity input for ${t}:`,l)}};return r?s():a(),()=>{r&&a()}},[r,t])};function Kj({mode:r,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:E}}=Fie(),{register:v}=L.useContext(wu),T=Zh(),{fullscreenRef:w}=Cd(),[I,N]=L.useState(!1),[F,j]=L.useState(!1),G=a!==void 0?a:I,H=l||(()=>N(!1));ON(G);const te=async de=>{const{email:se,password:ge,confirmPassword:ee,...Z}=de;if(ge!==ee){T({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}j(!0);try{const ne=await v(se,ge,Z);Re.log("User: Registration process complete."),H(),T({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(ne){Re.error("User: Registration Error:",ne),T({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{j(!1)}},K=()=>{l?l():N(!I)},Q=r==="link"?O.jsx(Kh,{variant:"header",onClick:K,children:t}):O.jsx(Ps,{onClick:K,...s,children:t});return O.jsxs(O.Fragment,{children:[!a&&Q,O.jsxs(Yc,{isOpen:G,onClose:H,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[O.jsx($c,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),O.jsxs(Xc,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:de=>{de.stopPropagation()},children:[O.jsxs(Td,{p:8,textAlign:"center",children:[O.jsx(jF,{size:"lg",mb:2,children:"Create Account"}),O.jsx(Rt,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),O.jsx(Ol,{color:"gray.400"}),O.jsx(Hc,{px:8,children:O.jsx("form",{onSubmit:f(te),children:O.jsxs($i,{spacing:4,children:[O.jsxs(Fs,{isInvalid:E.companyName,isRequired:!0,children:[O.jsx(Ra,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),O.jsx(tf,{children:E.companyName&&E.companyName.message})]}),O.jsxs(Jo,{gap:4,w:"100%",children:[O.jsxs(Fs,{isInvalid:E.firstName,isRequired:!0,children:[O.jsx(Ra,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),O.jsx(tf,{children:E.firstName&&E.firstName.message})]}),O.jsxs(Fs,{isInvalid:E.lastName,isRequired:!0,children:[O.jsx(Ra,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),O.jsx(tf,{children:E.lastName&&E.lastName.message})]})]}),O.jsxs(Fs,{isInvalid:E.email,isRequired:!0,children:[O.jsx(Ra,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),O.jsx(tf,{children:E.email&&E.email.message})]}),O.jsxs(Jo,{gap:4,w:"100%",children:[O.jsxs(Fs,{isInvalid:E.password,isRequired:!0,children:[O.jsx(Ra,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),O.jsx(tf,{children:E.password&&E.password.message})]}),O.jsxs(Fs,{isInvalid:E.confirmPassword,isRequired:!0,children:[O.jsx(Ra,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),O.jsx(tf,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),O.jsx(Fs,{children:O.jsx(Ra,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),O.jsx(Fs,{children:O.jsx(Ra,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),O.jsxs(QS,{px:8,pb:8,flexDirection:"column",gap:4,children:[O.jsx(Ps,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(te),isLoading:F,loadingText:"Creating Account",children:"Create Account"}),O.jsxs(Rt,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",O.jsx(Kh,{color:"blue.400",onClick:()=>{H(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}Kj.propTypes={mode:Mr.oneOf(["button","link"]),label:Mr.string,buttonProps:Mr.object,isOpen:Mr.bool,onClose:Mr.func};const n5e=PR({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),r5e=PR({displayName:"EmailIcon",path:O.jsxs("g",{fill:"currentColor",children:[O.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),O.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),i5e=PR({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),s5e=PR({displayName:"QuestionOutlineIcon",path:O.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[O.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),O.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),O.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),o5e=PR({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});function qj({mode:r="button",label:t="Sign In",buttonProps:s={},initialIsOpen:a=!1}){const{signIn:l}=L.useContext(wu),{fullscreenRef:d}=Cd(),f=Zh(),{register:E,handleSubmit:v,formState:{errors:T,isSubmitting:w}}=Fie({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[I,N]=L.useState(a),[F,j]=L.useState(!1);ON(I),L.useEffect(()=>{const Q=()=>{N(!0)};return window.addEventListener("openSignInModal",Q),()=>{window.removeEventListener("openSignInModal",Q)}},[]);const G=async Q=>{try{await l(Q.email,Q.password),Re.log("User: Sign-in process complete."),N(!1),window.location.reload()}catch(de){Re.error("User: SignIn Error:",de);const se=de.message||"An error occurred while logging in. Please check your credentials.",ge=se.includes("verify your email");f({title:ge?"Email Verification Required":"Error",description:se,status:ge?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}},H=()=>N(Q=>!Q),te=()=>{N(!1),j(!0)},K=r==="link"?O.jsx(Kh,{variant:"header",onClick:H,children:t}):O.jsx(Ps,{onClick:H,...s,children:t});return O.jsxs(O.Fragment,{children:[K,O.jsxs(Yc,{isOpen:I,onClose:H,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[O.jsx($c,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),O.jsx("form",{onSubmit:v(G),children:O.jsxs(Xc,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Q=>{Q.stopPropagation()},children:[O.jsxs(Td,{p:8,textAlign:"center",children:[O.jsx(jF,{size:"lg",mb:2,children:"Welcome Back"}),O.jsx(Rt,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),O.jsx(Ol,{color:"gray.400"}),O.jsx(Hc,{px:8,pb:8,children:O.jsxs($i,{spacing:4,children:[O.jsxs(Fs,{isInvalid:T.email,children:[O.jsxs(mU,{children:[O.jsx(ak,{pointerEvents:"none",children:O.jsx(r5e,{color:"gray.500"})}),O.jsx(Ra,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("email",{required:"Email is required."})})]}),O.jsx(tf,{children:T.email&&T.email.message})]}),O.jsxs(Fs,{isInvalid:T.password,children:[O.jsxs(mU,{children:[O.jsx(ak,{pointerEvents:"none",children:O.jsx(n5e,{color:"gray.500"})}),O.jsx(Ra,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("password",{required:"Password is required."})})]}),O.jsx(tf,{children:T.password&&T.password.message})]})]})}),O.jsxs(QS,{px:8,pb:8,flexDirection:"column",gap:4,children:[O.jsx(Ps,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",children:"Sign In"}),O.jsxs(Rt,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",O.jsx(Kh,{color:"blue.400",onClick:te,children:"Sign Up"})]})]})]})})]}),O.jsx(Kj,{mode:"link",isOpen:F,onClose:()=>j(!1)})]})}qj.propTypes={mode:Mr.oneOf(["button","link"]),label:Mr.string,buttonProps:Mr.object,initialIsOpen:Mr.bool};function a5e(){const{loadingProgression:r,isLoaded:t,error:s}=Kc(),{user:a}=L.useContext(wu),[l,d]=L.useState(!1),[f,E]=L.useState(!1),[v,T]=L.useState(!1),[w,I]=L.useState(!1),N=L.useRef(!1),F=L.useRef(!1),j=L.useRef(null),G=L.useRef(null),H=L.useRef(null),te=kf(),K=L.useRef(null),Q=L.useRef(null),de=L.useRef(null),se=L.useRef(null);L.useEffect(()=>{d(!a&&r===0)},[a,r]),L.useEffect(()=>{const Z=document.createElement("style");return Z.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Z),K.current=Z,()=>{K.current&&document.head.removeChild(K.current)}},[]),L.useEffect(()=>{const Z=()=>{const ne=document.getElementById("unity-canvas"),ae=document.getElementById("unity-container");ne&&(j.current=ne,console.log("LoaderProgress: Found Unity canvas"),ne.style.zIndex="1"),ae&&(G.current=ae,console.log("LoaderProgress: Found Unity container"),ae.style.zIndex="1"),ne&&ae&&de.current&&(clearInterval(de.current),de.current=null)};return Z(),de.current=setInterval(Z,100),()=>{de.current&&(clearInterval(de.current),de.current=null)}},[]),L.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),F.current=!0,I(!0));const ne=te("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0}),ae=setTimeout(()=>{F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{ne(),clearTimeout(ae)}},[te]),L.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0));const Z=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Z);const ne=te("PlayerInstantiated",Z),ae=setTimeout(()=>{N.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Z),ne(),clearTimeout(ae)}},[te]),L.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:v}),w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),j.current&&(j.current.style.opacity="1",j.current.style.removeProperty("opacity")),G.current&&(G.current.style.opacity="1",G.current.style.removeProperty("opacity")),H.current&&(H.current.style.opacity="0",H.current.style.pointerEvents="none",setTimeout(()=>{H.current&&(H.current.style.display="none")},1500))},2e3)),()=>{Q.current&&clearTimeout(Q.current)}),[w,v]),L.useEffect(()=>(se.current=setInterval(()=>{var Z,ne;console.log("LoaderProgress: Debug interval",{isLoaded:t,isFirstSceneLoaded:F.current,isPlayerInstantiated:N.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(Z=j.current)==null?void 0:Z.style.zIndex,loaderZIndex:(ne=H.current)==null?void 0:ne.style.zIndex})},5e3),()=>{se.current&&clearInterval(se.current)}),[t]),L.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:t,isFirstSceneLoaded:w,isPlayerInstantiated:v,loadingProgression:r})},[t,w,v,r]);const ge=()=>t?t&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",ee=()=>t?t&&!w&&!v?85:w&&!v?95:100:r*80;return O.jsx(O.Fragment,{children:l?O.jsx(kt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:O.jsxs($i,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[O.jsx(Rt,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),O.jsx(Rt,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),O.jsx(Ps,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):O.jsx(kt,{ref:H,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:O.jsxs(Jo,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[O.jsx(Rt,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),O.jsx(Rt,{fontSize:"sm",children:ge()}),O.jsx(ZS,{value:ee(),size:"lg",width:"100%",marginY:2})]})})})}function jie({mode:r="button",label:t="Sign Out"}){const s=Zh(),{signOut:a}=L.useContext(wu),{fullscreenRef:l}=Cd(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=r==="link"?O.jsx(Kh,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return O.jsx(O.Fragment,{children:f})}jie.propTypes={mode:Mr.oneOf(["button","link"]),label:Mr.string};function c5e(){const{user:r}=L.useContext(wu);return O.jsx("div",{children:r!==null?O.jsx("div",{children:O.jsx(jie,{})}):O.jsxs("div",{children:[O.jsx(Kj,{}),O.jsx(qj,{})]})})}function l5e(){const{fullscreenRef:r}=Cd(),[t,s]=L.useState(!1),a=()=>{s(!t)};return O.jsxs(O.Fragment,{children:[O.jsx(eg,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:r},children:O.jsx(Ia,{"aria-label":"Controller Help",icon:O.jsx(s5e,{}),onClick:a,variant:"iconButton"})}),O.jsxs(Yc,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:r},children:[O.jsx($c,{}),O.jsxs(Xc,{children:[O.jsx(Td,{children:"Notes"}),O.jsx(Ol,{}),O.jsx(Hc,{children:O.jsx(Rt,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),O.jsx(QS,{children:O.jsx(Ps,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Bie={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},qX=ti.createContext&&ti.createContext(Bie),og=function(){return og=Object.assign||function(r){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(r[l]=t[l])}return r},og.apply(this,arguments)},u5e=function(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s};function Wie(r){return r&&r.map(function(t,s){return ti.createElement(t.tag,og({key:s},t.attr),Wie(t.child))})}function Ur(r){return function(t){return ti.createElement(d5e,og({attr:og({},r.attr)},t),Wie(r.child))}}function d5e(r){var t=function(s){var a=r.attr,l=r.size,d=r.title,f=u5e(r,["attr","size","title"]),E=l||s.size||"1em",v;return s.className&&(v=s.className),r.className&&(v=(v?v+" ":"")+r.className),ti.createElement("svg",og({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,f,{className:v,style:og(og({color:r.color||s.color},s.style),r.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&ti.createElement("title",null,d),r.children)};return qX!==void 0?ti.createElement(qX.Consumer,null,function(s){return t(s)}):t(Bie)}function zie(r){return Ur({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(r)}function h5e(r){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(r)}function nV(r){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(r)}function p5e(r){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(r)}function f5e(r){return Ur({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(r)}function m5e(r){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(r)}function Gie(r){return Ur({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(r)}function g5e(r){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(r)}function _5e(r){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(r)}function rV(r){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(r)}function iV(r){return Ur({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(r)}function E5e(r){return Ur({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(r)}function y5e(r){return Ur({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(r)}function v5e(r){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(r)}function sV(r){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(r)}function S5e(r){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(r)}function T5e(r){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(r)}function b5e(r){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(r)}function w5e(r){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(r)}function Hie({open:r,onClose:t}){const s=L.useRef(null),a=bg(),{user:l}=L.useContext(wu),d=v=>{s.current&&!s.current.contains(v.target)&&t()},f=async v=>{const T=E(v);if((T==null?void 0:T.source)==="readyplayerme"&&(T.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),T.eventName==="v1.avatar.exported")){const w=T.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await oie(l.uid,w),t()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},E=v=>{try{return JSON.parse(v.data)}catch{return null}};return L.useEffect(()=>(r&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[r]),r&&O.jsx(bu,{children:O.jsx(kt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:O.jsx(kt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:O.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function R5e({isOpen:r,onClose:t}){const[s,a]=L.useState(!1),[l,d]=L.useState(null),{user:f}=L.useContext(wu),E=bg(),v=j=>{j.stopPropagation(),a(!0)},T=()=>{a(!1),t()},w=async j=>{if(d(j),f&&f.uid)try{await oie(f.uid,j.url),E("AvatarUrlFromReact",{url:j.url}),t()}catch(G){console.error("Error updating RPM URL:",G)}else console.error("No authenticated user found to update rpmURL.")},I=yRe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",F=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return O.jsxs(O.Fragment,{children:[O.jsx(bu,{children:O.jsxs(Yc,{isOpen:r,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[O.jsx($c,{bg:"rgba(0, 0, 0, 0.7)"}),O.jsxs(Xc,{bg:"gray.800",color:"white",maxW:"900px",children:[O.jsx(Td,{fontSize:"lg",children:"Customise Your Avatar"}),O.jsx(Ol,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),O.jsx(Hc,{pb:4,children:O.jsxs($i,{spacing:4,align:"stretch",children:[O.jsx(Rt,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),O.jsxs(Gee,{columns:5,spacing:2,children:[O.jsx(kt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:O.jsxs($i,{spacing:1,children:[O.jsx(Hn,{as:y5e,boxSize:4}),O.jsx(Rt,{fontSize:"xs",children:"Create Custom Avatar"})]})}),F.map(j=>O.jsxs(kt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===j.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>w(j),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[O.jsx(Dh,{src:j.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:j.name,width:"100%",height:"100%",objectFit:"cover"}),O.jsx(kt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:O.jsx(Rt,{fontSize:"xs",children:j.name})})]},j.id))]})]})})]})]})}),s&&O.jsx(Hie,{open:s,onClose:T})]})}function C5e(){const{fullscreenRef:r}=Cd(),[t,s]=L.useState(!1),[a,l]=L.useState(!1),[d,f]=L.useState(!1),[E,v]=L.useState(!1),{user:T}=L.useContext(wu),[w,I]=L.useState(null),[N,F]=L.useState(!0),j=(K,Q)=>!K||!Q?"?":`${K.charAt(0)}${Q.charAt(0)}`.toUpperCase(),G=async()=>{if(T!=null&&T.uid){F(!0);try{const K=await Jh(T.uid);I({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{F(!1)}}};L.useEffect(()=>{G()},[T==null?void 0:T.uid]),L.useEffect(()=>{const K=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const H=()=>l(!a),te=()=>{l(!1),G()};return t?O.jsxs(O.Fragment,{children:[O.jsx(eg,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:r},children:O.jsxs(kt,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:"pointer",onClick:H,children:[O.jsx(vf,{src:N||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?j(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&O.jsx(kt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:O.jsx(Rt,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),O.jsx(R5e,{isOpen:a,onClose:te})]}):null}function I5e(r){return Ur({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(r)}function A5e(r){return Ur({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(r)}function P5e(){const{isFullscreen:r,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=Cd(),l=Zh();L.useEffect(()=>{const f=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!r&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return O.jsx(eg,{label:r?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:O.jsx(Ia,{"aria-label":r?"Exit Fullscreen":"Enter Fullscreen",icon:r?O.jsx(I5e,{}):O.jsx(A5e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const YX={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function O5e(){const{isOpen:r,onOpen:t,onClose:s}=ag(),{fullscreenRef:a}=Cd(),[l,d]=ABe(!1);L.useEffect(()=>{Re.log("VideoPlayer: Current video URL:",l),l&&(Re.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const f=()=>{Re.log("VideoPlayer: Closing modal"),d(),s()};return O.jsx(bu,{containerRef:a,children:O.jsxs(Yc,{isOpen:r,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[O.jsx($c,{bg:"rgba(0, 0, 0, 0.8)"}),O.jsxs(Xc,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[O.jsx(Ol,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),O.jsx(Hc,{p:0,width:"100%",children:l&&O.jsx(kt,{style:YX.iframeContainer,children:O.jsx("iframe",{src:l,style:YX.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function k5e({isOpen:r,onClose:t,playerName:s,playerId:a,uid:l}){const[d,f]=L.useState(null),[E,v]=L.useState(!0),[T,w]=L.useState(null);return L.useEffect(()=>{r&&(async()=>{if(v(!0),w(null),!l){Re.warn("NameplateModal: No UID provided for player:",s),w("No user ID available for this player"),v(!1);return}try{Re.log("NameplateModal: Fetching profile for UID:",l);const N=await Jh(l);N?f({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(N){Re.error("Error fetching profile data:",N),w("Error loading profile data")}finally{v(!1)}})()},[l,r,s]),O.jsxs(Yc,{isOpen:r,onClose:t,isCentered:!0,size:"md",children:[O.jsx($c,{backdropFilter:"blur(10px)"}),O.jsxs(Xc,{bg:"gray.900",color:"white",borderRadius:"xl",children:[O.jsx(Td,{children:"Player Info"}),O.jsx(Ol,{}),O.jsx(Hc,{pb:6,children:E?O.jsx(oee,{py:8,children:O.jsx(Af,{size:"xl",color:"blue.400"})}):T?O.jsxs(HS,{status:"warning",variant:"solid",borderRadius:"md",children:[O.jsx($S,{}),T]}):O.jsxs($i,{spacing:4,align:"center",children:[O.jsx(vf,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),O.jsxs($i,{spacing:1,children:[O.jsx(Rt,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&O.jsxs(Rt,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),O.jsxs(Rt,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&O.jsxs(O.Fragment,{children:[O.jsx(uE,{borderColor:"whiteAlpha.300"}),O.jsxs(wi,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&O.jsx(Kh,{href:d.linkedinUrl,isExternal:!0,children:O.jsx(Ia,{icon:O.jsx(zie,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&O.jsx(Kh,{href:d.websiteUrl,isExternal:!0,children:O.jsx(Ia,{icon:O.jsx(Gie,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const N5e=({isVisible:r,onToggleVisibility:t,spaceID:s})=>{const[a]=t1e("(max-width: 768px)"),[l,d]=L.useState(!1);L.useEffect(()=>{(()=>{const we=navigator.userAgent||navigator.vendor||window.opera,Be=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(we);d(Be),Be&&Re.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,E=Pie(),[v,T]=L.useState(!1),[w,I]=L.useState([]),[N,F]=L.useState(!1),[j,G]=L.useState({}),[H,te]=L.useState({}),[K,Q]=L.useState(null),[de,se]=L.useState(!1),ge=Zh(),ee=window.currentUser||{},ne=(()=>{if(s)return s;if(window.spaceID)return window.spaceID;const we=(window.location.pathname||"").split("/"),ve=we[we.length-1];if(ve&&ve.length>5)return ve;const Be=document.body.getAttribute("data-space-id");if(Be)return Be;const Oe=localStorage.getItem("currentSpaceId");return Oe||"fallback-space-id"})();L.useEffect(()=>{(async()=>{try{const ve=await sg(ne);ve&&ve.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),se(!0)):se(!1)}catch(ve){console.error("UnityPlayerList: Error checking if voice is disabled:",ve)}})();const we=ve=>{ve.detail&&typeof ve.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ve.detail.voiceDisabled),se(ve.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",we),()=>{window.removeEventListener("SpaceVoiceSettingChanged",we)}},[ne]),L.useEffect(()=>{const Ee={};E.forEach(we=>{if(we.uid){if(we.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)Ee[we.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,Be=ve.find(Oe=>String(Oe.uid)===String(we.uid));if(Be)Ee[we.uid]=Be.uid;else{const Oe=ve.find(be=>typeof be.uid=="string"&&be.uid.includes(we.uid));if(Oe)Ee[we.uid]=Oe.uid;else{const be=ve.find(Ce=>typeof we.uid=="string"&&we.uid.includes(String(Ce.uid)));if(be)Ee[we.uid]=be.uid;else{const Ce=ve.filter(xe=>!(typeof xe.uid=="string"&&xe.uid.startsWith("screen-")));Ce.length===1&&!we.isLocalPlayer&&(Ee[we.uid]=Ce[0].uid)}}}}}}),te(Ee)},[E]);const ae=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const Ee=window.agoraClient.isVoiceEnabled;Ee!==N&&F(Ee)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const Ee=window.agoraClient.client.remoteUsers,we={};Ee.forEach(ve=>{typeof ve.uid=="string"&&ve.uid.startsWith("screen-")||(we[ve.uid]=!!ve.audioTrack&&!ve.audioTrack.muted)}),JSON.stringify(we)!==JSON.stringify(j)&&G(we)}};L.useEffect(()=>{const Ee=setInterval(ae,500),we=ve=>{ve.detail&&typeof ve.detail.enabled=="boolean"&&F(ve.detail.enabled)};return window.addEventListener("VoiceToggled",we),ae(),()=>{clearInterval(Ee),window.removeEventListener("VoiceToggled",we)}},[]),L.useEffect(()=>{const Ee=()=>{Re.log("UnityPlayerList: Player instantiated, showing list"),T(!0)};return window.addEventListener("PlayerInstantiated",Ee),window.isPlayerInstantiated&&(Re.log("UnityPlayerList: Player was already instantiated"),T(!0)),()=>{window.removeEventListener("PlayerInstantiated",Ee)}},[]),L.useEffect(()=>{(async()=>{const we=await Promise.all(E.map(async ve=>{if(ve.uid)try{const Be=await Jh(ve.uid);let Oe=null;if(Be.groups){const be=`space_${ne}_owners`,Ce=`space_${ne}_hosts`;Be.groups.includes(be)?Oe="owner":Be.groups.includes(Ce)&&(Oe="host")}return le({uid:ve.uid})&&Q(Oe),{...ve,firstName:Be.firstName,lastName:Be.lastName,linkedInProfile:Be.linkedInProfile,websiteUrl:Be.websiteUrl,rpmURL:Be.rpmURL?Be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Oe}}catch(Be){return Re.error(`Error fetching data for player ${ve.playerName}:`,Be),ve}return ve}));I(we)})()},[E,ne]);const me=[...w].sort((Ee,we)=>Ee.isLocalPlayer?-1:we.isLocalPlayer?1:0),he=()=>{Re.log("UnityPlayerList: Toggling visibility"),t&&t()},le=Ee=>!!(Ee.isLocalPlayer||ee&&ee.uid&&Ee.uid===ee.uid),Me=Ee=>{try{if(le(Ee))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:N;if(Ee.uid){if(j[Ee.uid])return!0;const we=H[Ee.uid];if(we&&j[we])return!0;const ve=parseInt(Ee.uid);if(!isNaN(ve)&&j[ve])return!0}return!1}catch(we){return console.error("Error in hasActiveMic:",we),!1}},Ge=({player:Ee})=>{const we=Ee.role;return we==="owner"?O.jsxs(wi,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[O.jsx(Hn,{as:nV,color:"green.400",boxSize:5}),O.jsx(af,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):we==="host"?O.jsxs(wi,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[O.jsx(Hn,{as:sV,color:"purple.400",boxSize:5}),O.jsx(af,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},tt=(Ee,we)=>{switch(console.log(`Action "${Ee}" performed on player: ${we.playerName}`),Ee){case"mute":ge({title:"Player Muted",description:`${we.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":ge({title:"Player Kicked",description:`${we.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":ge({title:"Player Promoted",description:`${we.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return O.jsxs(kt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&r&&!f?"visible":"hidden",role:"group",children:[O.jsx(kt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:O.jsx(Ia,{icon:O.jsx(i5e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:he,_hover:{opacity:.8}})}),O.jsxs(Rt,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",E.length]}),O.jsx(kt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:O.jsx($i,{align:"stretch",spacing:1,width:"100%",children:me.map((Ee,we)=>{const ve=le(Ee),Be=!de&&Me(Ee);return O.jsx(kt,{children:O.jsxs(Ete,{placement:"left",trigger:"hover",children:[O.jsx(bte,{children:O.jsxs(wi,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[O.jsx(vf,{size:"xs",src:Ee.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),O.jsx(Rt,{fontSize:"xs",children:Ee.playerName}),Ee.role==="owner"&&O.jsx(Hn,{as:nV,color:"green.400",boxSize:2.5}),Ee.role==="host"&&O.jsx(Hn,{as:sV,color:"purple.400",boxSize:2.5}),O.jsx(lk,{}),K==="owner"&&O.jsxs(MF,{closeOnSelect:!0,placement:"bottom-end",children:[O.jsx(UF,{as:Ia,"aria-label":"Options",icon:O.jsx(f5e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:Oe=>Oe.stopPropagation()}),O.jsxs(VF,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[O.jsx(AO,{icon:O.jsx(w5e,{}),onClick:()=>tt("mute",Ee),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:de,children:"Mute Player"}),O.jsx(AO,{icon:O.jsx(S5e,{}),onClick:()=>tt("promote",Ee),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),O.jsx(ite,{borderColor:"whiteAlpha.300"}),O.jsx(AO,{icon:O.jsx(h5e,{}),onClick:()=>tt("kick",Ee),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!de&&(Be?O.jsx(kt,{color:"green.400",children:O.jsx(iV,{})}):O.jsx(kt,{color:"red.400",children:O.jsx(rV,{})})),ve&&O.jsx(Rt,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),O.jsx(Tte,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:O.jsx(vte,{children:O.jsxs($i,{align:"center",spacing:3,children:[O.jsx(vf,{size:"xl",src:Ee.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),O.jsx(Rt,{fontSize:"xl",fontWeight:"bold",children:Ee.playerName}),O.jsx(Ge,{player:Ee}),Ee.firstName&&O.jsxs(Rt,{fontSize:"sm",color:"gray.300",children:[Ee.firstName," ",Ee.lastName]}),O.jsxs(wi,{spacing:4,pt:2,children:[Ee.linkedInProfile&&O.jsx(Kh,{href:Ee.linkedInProfile,isExternal:!0,children:O.jsx(Ia,{icon:O.jsx(zie,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),Ee.websiteUrl&&O.jsx(Kh,{href:Ee.websiteUrl,isExternal:!0,children:O.jsx(Ia,{icon:O.jsx(Gie,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!de&&O.jsx(Ia,{icon:Be?O.jsx(iV,{}):O.jsx(rV,{}),variant:"ghost",colorScheme:Be?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),de&&O.jsx(Ia,{icon:O.jsx(b5e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},we)})})})]})};var HO={exports:{}},D5e=HO.exports,XX;function L5e(){return XX||(XX=1,function(r,t){(function(s,a){r.exports=a()})(D5e,function(){function s(e,n){return n.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Z_<"u"?Z_:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=f,v=Function.prototype,T=v.call,w=E&&v.bind.bind(T,T),I=E?w:function(e){return function(){return T.apply(e,arguments)}},N=I({}.isPrototypeOf),F=function(e){return e&&e.Math==Math&&e},j=F(typeof globalThis=="object"&&globalThis)||F(typeof window=="object"&&window)||F(typeof self=="object"&&self)||F(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),G=f,H=Function.prototype,te=H.apply,K=H.call,Q=typeof Reflect=="object"&&Reflect.apply||(G?K.bind(te):function(){return K.apply(te,arguments)}),de=I,se=de({}.toString),ge=de("".slice),ee=function(e){return ge(se(e),8,-1)},Z=ee,ne=I,ae=function(e){if(Z(e)==="Function")return ne(e)},me=typeof document=="object"&&document.all,he={all:me,IS_HTMLDDA:me===void 0&&me!==void 0},le=he.all,Me=he.IS_HTMLDDA?function(e){return typeof e=="function"||e===le}:function(e){return typeof e=="function"},Ge={},tt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ee=f,we=Function.prototype.call,ve=Ee?we.bind(we):function(){return we.apply(we,arguments)},Be={},Oe={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,Ce=be&&!Oe.call({1:2},1);Be.f=Ce?function(e){var n=be(this,e);return!!n&&n.enumerable}:Oe;var xe,ze,Qe=function(e,n){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:n}},et=d,ut=ee,it=Object,Ct=I("".split),_n=et(function(){return!it("z").propertyIsEnumerable(0)})?function(e){return ut(e)=="String"?Ct(e,""):it(e)}:it,Vt=function(e){return e==null},ln=Vt,xn=TypeError,Xt=function(e){if(ln(e))throw xn("Can't call method on "+e);return e},Pt=_n,Dt=Xt,Te=function(e){return Pt(Dt(e))},Ue=Me,$e=he.all,mt=he.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Ue(e)||e===$e}:function(e){return typeof e=="object"?e!==null:Ue(e)},Et={},yt=Et,zt=j,dn=Me,hn=function(e){return dn(e)?e:void 0},Yt=function(e,n){return arguments.length<2?hn(yt[e])||hn(zt[e]):yt[e]&&yt[e][n]||zt[e]&&zt[e][n]},Bn=typeof navigator<"u"&&String(navigator.userAgent)||"",ec=j,jt=Bn,an=ec.process,qi=ec.Deno,Ns=an&&an.versions||qi&&qi.version,Gs=Ns&&Ns.v8;Gs&&(ze=(xe=Gs.split("."))[0]>0&&xe[0]<4?1:+(xe[0]+xe[1])),!ze&&jt&&(!(xe=jt.match(/Edge\/(\d+)/))||xe[1]>=74)&&(xe=jt.match(/Chrome\/(\d+)/))&&(ze=+xe[1]);var ui=ze,Na=ui,Jc=d,so=j.String,oo=!!Object.getOwnPropertySymbols&&!Jc(function(){var e=Symbol();return!so(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Na&&Na<41}),kl=oo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ds=Yt,tc=Me,ea=N,nc=Object,Qc=kl?function(e){return typeof e=="symbol"}:function(e){var n=Ds("Symbol");return tc(n)&&ea(n.prototype,nc(e))},Ru=String,rc=function(e){try{return Ru(e)}catch{return"Object"}},Zc=Me,bo=rc,Ci=TypeError,rs=function(e){if(Zc(e))return e;throw Ci(bo(e)+" is not a function")},Da=rs,Cu=Vt,ic=function(e,n){var i=e[n];return Cu(i)?void 0:Da(i)},ta=ve,na=Me,Id=mt,wg=TypeError,Iu={exports:{}},tp=j,Ls=Object.defineProperty,Au=function(e,n){try{Ls(tp,e,{value:n,configurable:!0,writable:!0})}catch{tp[e]=n}return n},ra="__core-js_shared__",Ad=j[ra]||Au(ra,{}),Pd=Ad;(Iu.exports=function(e,n){return Pd[e]||(Pd[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var La=Iu.exports,Od=Xt,Pu=Object,wo=function(e){return Pu(Od(e))},kd=wo,Vr=I({}.hasOwnProperty),di=Object.hasOwn||function(e,n){return Vr(kd(e),n)},sc=I,el=0,ia=Math.random(),np=sc(1 .toString),Nd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+np(++el+ia,36)},Nl=La,ao=di,Nf=Nd,Hs=oo,rp=kl,tl=j.Symbol,Dd=Nl("wks"),Ld=rp?tl.for||tl:tl&&tl.withoutSetter||Nf,ur=function(e){return ao(Dd,e)||(Dd[e]=Hs&&ao(tl,e)?tl[e]:Ld("Symbol."+e)),Dd[e]},Dl=ve,Ll=mt,Ou=Qc,xa=ic,Ro=function(e,n){var i,o;if(na(i=e.toString)&&!Id(o=ta(i,e))||na(i=e.valueOf)&&!Id(o=ta(i,e)))return o;throw wg("Can't convert object to primitive value")},ku=TypeError,nl=ur("toPrimitive"),xl=function(e,n){if(!Ll(e)||Ou(e))return e;var i,o=xa(e,nl);if(o){if(i=Dl(o,e,n),!Ll(i)||Ou(i))return i;throw ku("Can't convert object to primitive value")}return Ro(e)},Wr=Qc,Ma=function(e){var n=xl(e,"string");return Wr(n)?n:n+""},rr=mt,oc=j.document,Df=rr(oc)&&rr(oc.createElement),Ml=function(e){return Df?oc.createElement(e):{}},xd=Ml,ip=!tt&&!d(function(){return Object.defineProperty(xd("div"),"a",{get:function(){return 7}}).a!=7}),Lf=tt,sp=ve,Co=Be,Yi=Qe,Io=Te,Ao=Ma,Ul=di,Po=ip,Oo=Object.getOwnPropertyDescriptor;Ge.f=Lf?Oo:function(e,n){if(e=Io(e),n=Ao(n),Po)try{return Oo(e,n)}catch{}if(Ul(e,n))return Yi(!sp(Co.f,e,n),e[n])};var xf=d,ac=Me,is=/#|\.prototype\./,Nu=function(e,n){var i=rl[op(e)];return i==Mf||i!=Vl&&(ac(n)?xf(n):!!n)},op=Nu.normalize=function(e){return String(e).replace(is,".").toLowerCase()},rl=Nu.data={},Vl=Nu.NATIVE="N",Mf=Nu.POLYFILL="P",sa=Nu,oa=rs,il=f,Se=ae(ae.bind),Ne=function(e,n){return oa(e),n===void 0?e:il?Se(e,n):function(){return e.apply(n,arguments)}},Ze={},Kt=tt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Kn=mt,mr=String,Fr=TypeError,cn=function(e){if(Kn(e))return e;throw Fr(mr(e)+" is not an object")},Or=tt,hi=ip,Ss=Kt,ko=cn,No=Ma,Du=TypeError,Fi=Object.defineProperty,sl=Object.getOwnPropertyDescriptor,Md="enumerable",cc="configurable",Rg="writable";Ze.f=Or?Ss?function(e,n,i){if(ko(e),n=No(n),ko(i),typeof e=="function"&&n==="prototype"&&"value"in i&&Rg in i&&!i[Rg]){var o=sl(e,n);o&&o[Rg]&&(e[n]=i.value,i={configurable:cc in i?i[cc]:o[cc],enumerable:Md in i?i[Md]:o[Md],writable:!1})}return Fi(e,n,i)}:Fi:function(e,n,i){if(ko(e),n=No(n),ko(i),hi)try{return Fi(e,n,i)}catch{}if("get"in i||"set"in i)throw Du("Accessors not supported");return"value"in i&&(e[n]=i.value),e};var Uf=Ze,Lu=Qe,Do=tt?function(e,n,i){return Uf.f(e,n,Lu(1,i))}:function(e,n,i){return e[n]=i,e},Fl=j,Vf=Q,Cg=ae,LE=Me,Ff=Ge.f,jf=sa,xu=Et,Mu=Ne,Uu=Do,Ig=di,xE=function(e){var n=function(i,o,c){if(this instanceof n){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return Vf(e,this,arguments)};return n.prototype=e.prototype,n},Mn=function(e,n){var i,o,c,u,h,m,_,y,S,R=e.target,A=e.global,k=e.stat,W=e.proto,U=A?Fl:k?Fl[R]:(Fl[R]||{}).prototype,V=A?xu:xu[R]||Uu(xu,R,{})[R],q=V.prototype;for(u in n)o=!(i=jf(A?u:R+(k?".":"#")+u,e.forced))&&U&&Ig(U,u),m=V[u],o&&(_=e.dontCallGetSet?(S=Ff(U,u))&&S.value:U[u]),h=o&&_?_:n[u],o&&typeof m==typeof h||(y=e.bind&&o?Mu(h,Fl):e.wrap&&o?xE(h):W&&LE(h)?Cg(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Uu(y,"sham",!0),Uu(V,u,y),W&&(Ig(xu,c=R+"Prototype")||Uu(xu,c,{}),Uu(xu[c],u,h),e.real&&q&&(i||!q[u])&&Uu(q,u,h)))},Bf=Math.ceil,Lo=Math.floor,ME=Math.trunc||function(e){var n=+e;return(n>0?Lo:Bf)(n)},UE=ME,lc=function(e){var n=+e;return n!=n||n===0?0:UE(n)},C=lc,B=Math.max,J=Math.min,pe=function(e,n){var i=C(e);return i<0?B(i+n,0):J(i,n)},Ke=lc,ot=Math.min,xt=function(e){return e>0?ot(Ke(e),9007199254740991):0},zr=xt,ri=function(e){return zr(e.length)},gr=Te,xs=pe,ss=ri,Ua=function(e){return function(n,i,o){var c,u=gr(n),h=ss(u),m=xs(o,h);if(e&&i!=i){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===i)return e||m||0;return!e&&-1}},xo={includes:Ua(!0),indexOf:Ua(!1)},ap=xo.includes;Mn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return ap(this,e,arguments.length>1?arguments[1]:void 0)}});var Wf=Et,Va=function(e){return Wf[e+"Prototype"]},YR=Va("Array").includes,XR=mt,zf=ee,kN=ur("match"),JR=function(e){var n;return XR(e)&&((n=e[kN])!==void 0?!!n:zf(e)=="RegExp")},NN=JR,QR=TypeError,T0={};T0[ur("toStringTag")]="z";var cp=String(T0)==="[object z]",Ag=cp,DN=Me,lp=ee,LN=ur("toStringTag"),ZR=Object,b0=lp(function(){return arguments}())=="Arguments",uc=Ag?lp:function(e){var n,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(n=ZR(e),LN))=="string"?i:b0?lp(n):(o=lp(n))=="Object"&&DN(n.callee)?"Arguments":o},eC=uc,tC=String,aa=function(e){if(eC(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return tC(e)},xN=ur("match"),MN=Mn,UN=function(e){if(NN(e))throw QR("The method doesn't accept regular expressions");return e},VN=Xt,nC=aa,ol=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[xN]=!1,"/./"[e](n)}catch{}}return!1},Pg=I("".indexOf);MN({target:"String",proto:!0,forced:!ol("includes")},{includes:function(e){return!!~Pg(nC(VN(this)),nC(UN(e)),arguments.length>1?arguments[1]:void 0)}});var rC=Va("String").includes,w0=N,iC=YR,sC=rC,Og=Array.prototype,R0=String.prototype,FN=function(e){var n=e.includes;return e===Og||w0(Og,e)&&n===Og.includes?iC:typeof e=="string"||e===R0||w0(R0,e)&&n===R0.includes?sC:n},st=l(FN),C0=rs,kg=wo,I0=_n,oC=ri,VE=TypeError,Gf=function(e){return function(n,i,o,c){C0(i);var u=kg(n),h=I0(u),m=oC(u),_=e?m-1:0,y=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=y;break}if(_+=y,e?_<0:m<=_)throw VE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=y)_ in h&&(c=i(c,h[_],_,u));return c}},A0={left:Gf(!1)},aC=d,up=function(e,n){var i=[][e];return!!i&&aC(function(){i.call(null,n||function(){return 1},1)})},dp=typeof process<"u"&&ee(process)=="process",cC=A0.left;Mn({target:"Array",proto:!0,forced:!dp&&ui>79&&ui<83||!up("reduce")},{reduce:function(e){var n=arguments.length;return cC(this,e,n,n>1?arguments[1]:void 0)}});var lC=Va("Array").reduce,uC=N,dC=lC,FE=Array.prototype,Ud=function(e){var n=e.reduce;return e===FE||uC(FE,e)&&n===FE.reduce?dC:n},jE=Ud,Fa=l(jE),jN=ee,Ng=Array.isArray||function(e){return jN(e)=="Array"},Dg=Mn,BN=Ng,hC=I([].reverse),P0=[1,2];Dg({target:"Array",proto:!0,forced:String(P0)===String(P0.reverse())},{reverse:function(){return BN(this)&&(this.length=this.length),hC(this)}});var Ei=Va("Array").reverse,O0=N,BE=Ei,hp=Array.prototype,pC=function(e){var n=e.reverse;return e===hp||O0(hp,e)&&n===hp.reverse?BE:n},WE=pC,Hf=l(WE),zE=Nd,pp=La("keys"),Lg=function(e){return pp[e]||(pp[e]=zE(e))},WN=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),zN=di,fC=Me,GE=wo,HE=WN,$E=Lg("IE_PROTO"),xg=Object,k0=xg.prototype,Mg=HE?xg.getPrototypeOf:function(e){var n=GE(e);if(zN(n,$E))return n[$E];var i=n.constructor;return fC(i)&&n instanceof i?i.prototype:n instanceof xg?k0:null},GN=I,mC=rs,HN=Me,$N=String,N0=TypeError,Vd=function(e,n,i){try{return GN(mC(Object.getOwnPropertyDescriptor(e,n)[i]))}catch{}},gC=cn,$f=function(e){if(typeof e=="object"||HN(e))return e;throw N0("Can't set "+$N(e)+" as a prototype")},jl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,n=!1,i={};try{(e=Vd(Object.prototype,"__proto__","set"))(i,[]),n=i instanceof Array}catch{}return function(o,c){return gC(o),$f(c),n?e(o,c):o.__proto__=c,o}}():void 0),Fd={},dc={},Ug=di,KN=Te,qN=xo.indexOf,fp=dc,Kf=I([].push),mp=function(e,n){var i,o=KN(e),c=0,u=[];for(i in o)!Ug(fp,i)&&Ug(o,i)&&Kf(u,i);for(;n.length>c;)Ug(o,i=n[c++])&&(~qN(u,i)||Kf(u,i));return u},qf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],D0=mp,Yf=qf.concat("length","prototype");Fd.f=Object.getOwnPropertyNames||function(e){return D0(e,Yf)};var hc={};hc.f=Object.getOwnPropertySymbols;var yi=Yt,pi=Fd,jd=hc,co=cn,ca=I([].concat),gp=yi("Reflect","ownKeys")||function(e){var n=pi.f(co(e)),i=jd.f;return i?ca(n,i(e)):n},_p=di,la=gp,KE=Ge,_C=Ze,qE={},YE=mp,EC=qf,pc=Object.keys||function(e){return YE(e,EC)},XE=tt,L0=Kt,yC=Ze,YN=cn,Bd=Te,Xf=pc;qE.f=XE&&!L0?Object.defineProperties:function(e,n){YN(e);for(var i,o=Bd(n),c=Xf(n),u=c.length,h=0;u>h;)yC.f(e,i=c[h++],o[i]);return e};var Vu,Vg=Yt("document","documentElement"),JE=cn,fc=qE,ja=qf,Ep=dc,Fu=Vg,ju=Ml,Bu="prototype",QE="script",ZE=Lg("IE_PROTO"),Fg=function(){},ua=function(e){return"<"+QE+">"+e+"</"+QE+">"},da=function(e){e.write(ua("")),e.close();var n=e.parentWindow.Object;return e=null,n},ii=function(){try{Vu=new ActiveXObject("htmlfile")}catch{}var e,n,i;ii=typeof document<"u"?document.domain&&Vu?da(Vu):(n=ju("iframe"),i="java"+QE+":",n.style.display="none",Fu.appendChild(n),n.src=String(i),(e=n.contentWindow.document).open(),e.write(ua("document.F=Object")),e.close(),e.F):da(Vu);for(var o=ja.length;o--;)delete ii[Bu][ja[o]];return ii()};Ep[ZE]=!0;var Mo=Object.create||function(e,n){var i;return e!==null?(Fg[Bu]=JE(e),i=new Fg,Fg[Bu]=null,i[ZE]=e):i=ii(),n===void 0?i:fc.f(i,n)},vC=mt,SC=Do,ey=Error,x0=I("".replace),TC=String(ey("zxcasd").stack),jg=/\n\s*at [^:]*:[^\n]*/,bC=jg.test(TC),Jf=Qe,M0=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Jf(1,7)),e.stack!==7)}),XN=Do,Bg=function(e,n){if(bC&&typeof e=="string"&&!ey.prepareStackTrace)for(;n--;)e=x0(e,jg,"");return e},ty=M0,U0=Error.captureStackTrace,Wd={},Qf=Wd,wC=ur("iterator"),ny=Array.prototype,Wg=function(e){return e!==void 0&&(Qf.Array===e||ny[wC]===e)},Zf=uc,ry=ic,V0=Vt,F0=Wd,j0=ur("iterator"),Wu=function(e){if(!V0(e))return ry(e,j0)||ry(e,"@@iterator")||F0[Zf(e)]},mc=ve,yp=rs,B0=cn,RC=rc,zu=Wu,zd=TypeError,zg=function(e,n){var i=arguments.length<2?zu(e):n;if(yp(i))return B0(mc(i,e));throw zd(RC(e)+" is not iterable")},CC=ve,Bl=cn,Gd=ic,Gg=function(e,n,i){var o,c;Bl(e);try{if(!(o=Gd(e,"return"))){if(n==="throw")throw i;return i}o=CC(o,e)}catch(u){c=!0,o=u}if(n==="throw")throw i;if(c)throw o;return Bl(o),i},IC=Ne,iy=ve,AC=cn,Hg=rc,Wl=Wg,$g=ri,em=N,vp=zg,W0=Wu,Sp=Gg,PC=TypeError,tm=function(e,n){this.stopped=e,this.result=n},Ti=tm.prototype,Hd=function(e,n,i){var o,c,u,h,m,_,y,S=i&&i.that,R=!(!i||!i.AS_ENTRIES),A=!(!i||!i.IS_RECORD),k=!(!i||!i.IS_ITERATOR),W=!(!i||!i.INTERRUPTED),U=IC(n,S),V=function(Y){return o&&Sp(o,"normal",Y),new tm(!0,Y)},q=function(Y){return R?(AC(Y),W?U(Y[0],Y[1],V):U(Y[0],Y[1])):W?U(Y,V):U(Y)};if(A)o=e.iterator;else if(k)o=e;else{if(!(c=W0(e)))throw PC(Hg(e)+" is not iterable");if(Wl(c)){for(u=0,h=$g(e);h>u;u++)if((m=q(e[u]))&&em(Ti,m))return m;return new tm(!1)}o=vp(e,c)}for(_=A?e.next:o.next;!(y=iy(_,o)).done;){try{m=q(y.value)}catch(Y){Sp(o,"throw",Y)}if(typeof m=="object"&&m&&em(Ti,m))return m}return new tm(!1)},z0=aa,G0=Mn,sy=N,H0=Mg,zl=jl,Ii=function(e,n,i){for(var o=la(n),c=_C.f,u=KE.f,h=0;h<o.length;h++){var m=o[h];_p(e,m)||i&&_p(i,m)||c(e,m,u(n,m))}},os=Mo,as=Do,nm=Qe,Kg=function(e,n){vC(n)&&"cause"in n&&SC(e,"cause",n.cause)},qg=function(e,n,i,o){ty&&(U0?U0(e,n):XN(e,"stack",Bg(i,o)))},JN=Hd,lo=function(e,n){return e===void 0?arguments.length<2?"":n:z0(e)},$0=ur("toStringTag"),rm=Error,K0=[].push,Uo=function(e,n){var i,o=sy(ha,this);zl?i=zl(rm(),o?H0(this):ha):(i=o?this:os(ha),as(i,$0,"Error")),n!==void 0&&as(i,"message",lo(n)),qg(i,Uo,i.stack,1),arguments.length>2&&Kg(i,arguments[2]);var c=[];return JN(e,K0,{that:c}),as(i,"errors",c),i};zl?zl(Uo,rm):Ii(Uo,rm,{name:!0});var ha=Uo.prototype=os(rm.prototype,{constructor:nm(1,Uo),message:nm(1,""),name:nm(1,"AggregateError")});G0({global:!0},{AggregateError:Uo});var $d,Tp,im,OC=Me,q0=j.WeakMap,kC=OC(q0)&&/native code/.test(String(q0)),Y0=j,NC=mt,DC=Do,oy=di,ay=Ad,Yg=Lg,LC=dc,Xg="Object already initialized",sm=Y0.TypeError,xC=Y0.WeakMap;if(kC||ay.state){var gc=ay.state||(ay.state=new xC);gc.get=gc.get,gc.has=gc.has,gc.set=gc.set,$d=function(e,n){if(gc.has(e))throw sm(Xg);return n.facade=e,gc.set(e,n),n},Tp=function(e){return gc.get(e)||{}},im=function(e){return gc.has(e)}}else{var bp=Yg("state");LC[bp]=!0,$d=function(e,n){if(oy(e,bp))throw sm(Xg);return n.facade=e,DC(e,bp,n),n},Tp=function(e){return oy(e,bp)?e[bp]:{}},im=function(e){return oy(e,bp)}}var Kd,X0,J0,Gu={set:$d,get:Tp,has:im,enforce:function(e){return im(e)?Tp(e):$d(e,{})},getterFor:function(e){return function(n){var i;if(!NC(n)||(i=Tp(n)).type!==e)throw sm("Incompatible receiver, "+e+" required");return i}}},cy=tt,MC=di,Q0=Function.prototype,QN=cy&&Object.getOwnPropertyDescriptor,Z0=MC(Q0,"name"),UC={PROPER:Z0&&(function(){}).name==="something",CONFIGURABLE:Z0&&(!cy||cy&&QN(Q0,"name").configurable)},ZN=Do,Hu=function(e,n,i,o){return o&&o.enumerable?e[n]=i:ZN(e,n,i),e},VC=d,FC=Me,ly=mt,e1=Mo,jC=Mg,t1=Hu,Ba=ur("iterator"),uy=!1;[].keys&&("next"in(J0=[].keys())?(X0=jC(jC(J0)))!==Object.prototype&&(Kd=X0):uy=!0);var dy=!ly(Kd)||VC(function(){var e={};return Kd[Ba].call(e)!==e});FC((Kd=dy?{}:e1(Kd))[Ba])||t1(Kd,Ba,function(){return this});var eT={IteratorPrototype:Kd,BUGGY_SAFARI_ITERATORS:uy},BC=uc,WC=cp?{}.toString:function(){return"[object "+BC(this)+"]"},tT=cp,om=Ze.f,nT=Do,rT=di,n1=WC,iT=ur("toStringTag"),$u=function(e,n,i,o){if(e){var c=i?e:e.prototype;rT(c,iT)||om(c,iT,{configurable:!0,value:n}),o&&!tT&&nT(c,"toString",n1)}},zC=eT.IteratorPrototype,GC=Mo,HC=Qe,r1=$u,pa=Wd,Vo=function(){return this},hy=function(e,n,i,o){var c=n+" Iterator";return e.prototype=GC(zC,{next:HC(+!o,i)}),r1(e,c,!1,!0),pa[c]=Vo,e},$C=Mn,KC=ve,qC=UC,YC=hy,sT=Mg,XC=$u,py=Hu,oT=Wd,JC=eT,aT=qC.PROPER,am=JC.BUGGY_SAFARI_ITERATORS,fy=ur("iterator"),my="keys",wp="values",QC="entries",ZC=function(){return this},gy=function(e,n,i,o,c,u,h){YC(i,n,o);var m,_,y,S=function(q){if(q===c&&U)return U;if(!am&&q in k)return k[q];switch(q){case my:case wp:case QC:return function(){return new i(this,q)}}return function(){return new i(this)}},R=n+" Iterator",A=!1,k=e.prototype,W=k[fy]||k["@@iterator"]||c&&k[c],U=!am&&W||S(c),V=n=="Array"&&k.entries||W;if(V&&(m=sT(V.call(new e)))!==Object.prototype&&m.next&&(XC(m,R,!0,!0),oT[R]=ZC),aT&&c==wp&&W&&W.name!==wp&&(A=!0,U=function(){return KC(W,this)}),c)if(_={values:S(wp),keys:u?U:S(my),entries:S(QC)},h)for(y in _)(am||A||!(y in k))&&py(k,y,_[y]);else $C({target:n,proto:!0,forced:am||A},_);return h&&k[fy]!==U&&py(k,fy,U,{}),oT[n]=U,_},_y=function(e,n){return{value:e,done:n}},Ey=Te,Gl=Wd,eI=Gu;Ze.f;var tI=gy,yy=_y,cT="Array Iterator",nI=eI.set,Jg=eI.getterFor(cT);tI(Array,"Array",function(e,n){nI(this,{type:cT,target:Ey(e),index:0,kind:n})},function(){var e=Jg(this),n=e.target,i=e.kind,o=e.index++;return!n||o>=n.length?(e.target=void 0,yy(void 0,!0)):yy(i=="keys"?o:i=="values"?n[o]:[o,n[o]],!1)},"values"),Gl.Arguments=Gl.Array;var uo=Ze,vy=function(e,n,i){return uo.f(e,n,i)},i1=Yt,Sy=vy,ho=tt,rI=ur("species"),Jt=N,cm=TypeError,Qg=function(e,n){if(Jt(n,e))return e;throw cm("Incorrect invocation")},iI=Me,lT=Ad,Zg=I(Function.toString);iI(lT.inspectSource)||(lT.inspectSource=function(e){return Zg(e)});var e_=lT.inspectSource,uT=I,sI=d,dT=Me,oI=uc,hT=e_,Ty=function(){},$s=[],_c=Yt("Reflect","construct"),Hl=/^\s*(?:class|function)\b/,aI=uT(Hl.exec),cI=!Hl.exec(Ty),Fo=function(e){if(!dT(e))return!1;try{return _c(Ty,$s,e),!0}catch{return!1}},pT=function(e){if(!dT(e))return!1;switch(oI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return cI||!!aI(Hl,hT(e))}catch{return!0}};pT.sham=!0;var fa,lm,fT,by,t_=!_c||sI(function(){var e;return Fo(Fo.call)||!Fo(Object)||!Fo(function(){e=!0})||e})?pT:Fo,lI=t_,s1=rc,wy=TypeError,Ry=cn,Ec=function(e){if(lI(e))return e;throw wy(s1(e)+" is not a constructor")},Sr=Vt,Ms=ur("species"),ji=function(e,n){var i,o=Ry(e).constructor;return o===void 0||Sr(i=Ry(o)[Ms])?n:Ec(i)},cs=I([].slice),Wa=TypeError,al=function(e,n){if(e<n)throw Wa("Not enough arguments");return e},ls=/(?:ipad|iphone|ipod).*applewebkit/i.test(Bn),Ks=j,Rp=Q,Cy=Ne,Iy=Me,n_=di,jo=d,Ay=Vg,um=cs,$l=Ml,Py=al,mT=ls,qd=dp,dm=Ks.setImmediate,Kl=Ks.clearImmediate,Oy=Ks.process,Cp=Ks.Dispatch,gT=Ks.Function,r_=Ks.MessageChannel,ky=Ks.String,qs=0,yc={},vc="onreadystatechange";jo(function(){fa=Ks.location});var po=function(e){if(n_(yc,e)){var n=yc[e];delete yc[e],n()}},Ny=function(e){return function(){po(e)}},Dy=function(e){po(e.data)},Ly=function(e){Ks.postMessage(ky(e),fa.protocol+"//"+fa.host)};dm&&Kl||(dm=function(e){Py(arguments.length,1);var n=Iy(e)?e:gT(e),i=um(arguments,1);return yc[++qs]=function(){Rp(n,void 0,i)},lm(qs),qs},Kl=function(e){delete yc[e]},qd?lm=function(e){Oy.nextTick(Ny(e))}:Cp&&Cp.now?lm=function(e){Cp.now(Ny(e))}:r_&&!mT?(by=(fT=new r_).port2,fT.port1.onmessage=Dy,lm=Cy(by.postMessage,by)):Ks.addEventListener&&Iy(Ks.postMessage)&&!Ks.importScripts&&fa&&fa.protocol!=="file:"&&!jo(Ly)?(lm=Ly,Ks.addEventListener("message",Dy,!1)):lm=vc in $l("script")?function(e){Ay.appendChild($l("script"))[vc]=function(){Ay.removeChild(this),po(e)}}:function(e){setTimeout(Ny(e),0)});var xy={set:dm,clear:Kl},Ku=function(){this.head=null,this.tail=null};Ku.prototype={add:function(e){var n={item:e,next:null},i=this.tail;i?i.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Ip,i_,qu,s_,Yd,_T=Ku,uI=/ipad|iphone|ipod/i.test(Bn)&&typeof Pebble<"u",ET=/web0s(?!.*chrome)/i.test(Bn),ql=j,dI=Ne,o1=Ge.f,My=xy.set,hI=_T,Ap=ls,a1=uI,hm=ET,Uy=dp,Ai=ql.MutationObserver||ql.WebKitMutationObserver,pI=ql.document,yT=ql.process,Vy=ql.Promise,fI=o1(ql,"queueMicrotask"),Fy=fI&&fI.value;if(!Fy){var o_=new hI,jy=function(){var e,n;for(Uy&&(e=yT.domain)&&e.exit();n=o_.get();)try{n()}catch(i){throw o_.head&&Ip(),i}e&&e.enter()};Ap||Uy||hm||!Ai||!pI?!a1&&Vy&&Vy.resolve?((s_=Vy.resolve(void 0)).constructor=Vy,Yd=dI(s_.then,s_),Ip=function(){Yd(jy)}):Uy?Ip=function(){yT.nextTick(jy)}:(My=dI(My,ql),Ip=function(){My(jy)}):(i_=!0,qu=pI.createTextNode(""),new Ai(jy).observe(qu,{characterData:!0}),Ip=function(){qu.data=i_=!i_}),Fy=function(e){o_.head||Ip(),o_.add(e)}}var za=Fy,Xd=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},Pp=j.Promise,Yu=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",By=!Yu&&!dp&&typeof window=="object"&&typeof document=="object",Op=j,Jd=Pp,vT=Me,ST=sa,c1=e_,TT=ur,l1=By,mI=Yu,Wy=ui,a_=Jd&&Jd.prototype,zy=TT("species"),bT=vT(Op.PromiseRejectionEvent),wT=ST("Promise",function(){var e=c1(Jd),n=e!==String(Jd);if(!n&&Wy===66||!a_.catch||!a_.finally)return!0;if(!Wy||Wy<51||!/native code/.test(e)){var i=new Jd(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[zy]=o,!(i.then(function(){})instanceof o))return!0}return!n&&(l1||mI)&&!bT}),c_={CONSTRUCTOR:wT,REJECTION_EVENT:bT},cl={},Gy=rs,Hy=TypeError,RT=function(e){var n,i;this.promise=new e(function(o,c){if(n!==void 0||i!==void 0)throw Hy("Bad Promise constructor");n=o,i=c}),this.resolve=Gy(n),this.reject=Gy(i)};cl.f=function(e){return new RT(e)};var pm,CT,u1=Mn,kp=dp,Qd=j,Xu=ve,d1=Hu,$y=$u,p=function(e){var n=i1(e);ho&&n&&!n[rI]&&Sy(n,rI,{configurable:!0,get:function(){return this}})},g=rs,b=Me,P=mt,M=Qg,z=ji,oe=xy.set,Ie=za,Le=function(e,n){try{arguments.length==1?console.error(e):console.error(e,n)}catch{}},nt=Xd,It=_T,At=Gu,wt=Pp,Ht=c_,Zt=cl,en="Promise",Bi=Ht.CONSTRUCTOR,Ye=Ht.REJECTION_EVENT,Ve=At.getterFor(en),Je=At.set,Nt=wt&&wt.prototype,nn=wt,pn=Nt,En=Qd.TypeError,kn=Qd.document,us=Qd.process,_r=Zt.f,Zd=_r,h1=!!(kn&&kn.createEvent&&Qd.dispatchEvent),Xj="unhandledrejection",Jj=function(e){var n;return!(!P(e)||!b(n=e.then))&&n},Qj=function(e,n){var i,o,c,u=n.value,h=n.state==1,m=h?e.ok:e.fail,_=e.resolve,y=e.reject,S=e.domain;try{m?(h||(n.rejection===2&&nse(n),n.rejection=1),m===!0?i=u:(S&&S.enter(),i=m(u),S&&(S.exit(),c=!0)),i===e.promise?y(En("Promise-chain cycle")):(o=Jj(i))?Xu(o,i,_,y):_(i)):y(u)}catch(R){S&&!c&&S.exit(),y(R)}},Zj=function(e,n){e.notified||(e.notified=!0,Ie(function(){for(var i,o=e.reactions;i=o.get();)Qj(i,e);e.notified=!1,n&&!e.rejection&&tse(e)}))},e4=function(e,n,i){var o,c;h1?((o=kn.createEvent("Event")).promise=n,o.reason=i,o.initEvent(e,!1,!0),Qd.dispatchEvent(o)):o={promise:n,reason:i},!Ye&&(c=Qd["on"+e])?c(o):e===Xj&&Le("Unhandled promise rejection",i)},tse=function(e){Xu(oe,Qd,function(){var n,i=e.facade,o=e.value;if(t4(e)&&(n=nt(function(){kp?us.emit("unhandledRejection",o,i):e4(Xj,i,o)}),e.rejection=kp||t4(e)?2:1,n.error))throw n.value})},t4=function(e){return e.rejection!==1&&!e.parent},nse=function(e){Xu(oe,Qd,function(){var n=e.facade;kp?us.emit("rejectionHandled",n):e4("rejectionhandled",n,e.value)})},Ky=function(e,n,i){return function(o){e(n,o,i)}},qy=function(e,n,i){e.done||(e.done=!0,i&&(e=i),e.value=n,e.state=2,Zj(e,!0))},p1=function(e,n,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===n)throw En("Promise can't be resolved itself");var o=Jj(n);o?Ie(function(){var c={done:!1};try{Xu(o,n,Ky(p1,c,e),Ky(qy,c,e))}catch(u){qy(c,u,e)}}):(e.value=n,e.state=1,Zj(e,!1))}catch(c){qy({done:!1},c,e)}}};Bi&&(pn=(nn=function(e){M(this,pn),g(e),Xu(pm,this);var n=Ve(this);try{e(Ky(p1,n),Ky(qy,n))}catch(i){qy(n,i)}}).prototype,(pm=function(e){Je(this,{type:en,done:!1,notified:!1,parent:!1,reactions:new It,rejection:!1,state:0,value:void 0})}).prototype=d1(pn,"then",function(e,n){var i=Ve(this),o=_r(z(this,nn));return i.parent=!0,o.ok=!b(e)||e,o.fail=b(n)&&n,o.domain=kp?us.domain:void 0,i.state==0?i.reactions.add(o):Ie(function(){Qj(o,i)}),o.promise}),CT=function(){var e=new pm,n=Ve(e);this.promise=e,this.resolve=Ky(p1,n),this.reject=Ky(qy,n)},Zt.f=_r=function(e){return e===nn||e===void 0?new CT(e):Zd(e)}),u1({global:!0,wrap:!0,forced:Bi},{Promise:nn}),$y(nn,en,!1,!0),p(en);var n4=ur("iterator"),r4=!1;try{var rse=0,i4={next:function(){return{done:!!rse++}},return:function(){r4=!0}};i4[n4]=function(){return this},Array.from(i4,function(){throw 2})}catch{}var ise=Pp,sse=function(e,n){if(!r4)return!1;var i=!1;try{var o={};o[n4]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},gI=c_.CONSTRUCTOR||!sse(function(e){ise.all(e).then(void 0,function(){})}),ose=ve,ase=rs,cse=cl,lse=Xd,use=Hd;Mn({target:"Promise",stat:!0,forced:gI},{all:function(e){var n=this,i=cse.f(n),o=i.resolve,c=i.reject,u=lse(function(){var h=ase(n.resolve),m=[],_=0,y=1;use(e,function(S){var R=_++,A=!1;y++,ose(h,n,S).then(function(k){A||(A=!0,m[R]=k,--y||o(m))},c)}),--y||o(m)});return u.error&&c(u.value),i.promise}});var dse=Mn,hse=c_.CONSTRUCTOR;Pp&&Pp.prototype,dse({target:"Promise",proto:!0,forced:hse,real:!0},{catch:function(e){return this.then(void 0,e)}});var pse=ve,fse=rs,mse=cl,gse=Xd,_se=Hd;Mn({target:"Promise",stat:!0,forced:gI},{race:function(e){var n=this,i=mse.f(n),o=i.reject,c=gse(function(){var u=fse(n.resolve);_se(e,function(h){pse(u,n,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var Ese=ve,yse=cl;Mn({target:"Promise",stat:!0,forced:c_.CONSTRUCTOR},{reject:function(e){var n=yse.f(this);return Ese(n.reject,void 0,e),n.promise}});var vse=cn,Sse=mt,Tse=cl,s4=function(e,n){if(vse(e),Sse(n)&&n.constructor===e)return n;var i=Tse.f(e);return(0,i.resolve)(n),i.promise},bse=Mn,wse=Pp,Rse=c_.CONSTRUCTOR,Cse=s4,Ise=Yt("Promise"),Ase=!Rse;bse({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Cse(Ase&&this===Ise?wse:this,e)}});var Pse=ve,Ose=rs,kse=cl,Nse=Xd,Dse=Hd;Mn({target:"Promise",stat:!0,forced:gI},{allSettled:function(e){var n=this,i=kse.f(n),o=i.resolve,c=i.reject,u=Nse(function(){var h=Ose(n.resolve),m=[],_=0,y=1;Dse(e,function(S){var R=_++,A=!1;y++,Pse(h,n,S).then(function(k){A||(A=!0,m[R]={status:"fulfilled",value:k},--y||o(m))},function(k){A||(A=!0,m[R]={status:"rejected",reason:k},--y||o(m))})}),--y||o(m)});return u.error&&c(u.value),i.promise}});var Lse=ve,xse=rs,Mse=Yt,Use=cl,Vse=Xd,Fse=Hd,o4="No one promise resolved";Mn({target:"Promise",stat:!0,forced:gI},{any:function(e){var n=this,i=Mse("AggregateError"),o=Use.f(n),c=o.resolve,u=o.reject,h=Vse(function(){var m=xse(n.resolve),_=[],y=0,S=1,R=!1;Fse(e,function(A){var k=y++,W=!1;S++,Lse(m,n,A).then(function(U){W||R||(R=!0,c(U))},function(U){W||R||(W=!0,_[k]=U,--S||u(new i(_,o4)))})}),--S||u(new i(_,o4))});return h.error&&u(h.value),o.promise}});var jse=Mn,f1=Pp,Bse=d,Wse=Yt,zse=Me,Gse=ji,a4=s4,Hse=f1&&f1.prototype;jse({target:"Promise",proto:!0,real:!0,forced:!!f1&&Bse(function(){Hse.finally.call({then:function(){}},function(){})})},{finally:function(e){var n=Gse(this,Wse("Promise")),i=zse(e);return this.then(i?function(o){return a4(n,e()).then(function(){return o})}:e,i?function(o){return a4(n,e()).then(function(){throw o})}:e)}});var m1=I,$se=lc,Kse=aa,qse=Xt,Yse=m1("".charAt),c4=m1("".charCodeAt),Xse=m1("".slice),l4=function(e){return function(n,i){var o,c,u=Kse(qse(n)),h=$se(i),m=u.length;return h<0||h>=m?e?"":void 0:(o=c4(u,h))<55296||o>56319||h+1===m||(c=c4(u,h+1))<56320||c>57343?e?Yse(u,h):o:e?Xse(u,h,h+2):c-56320+(o-55296<<10)+65536}},g1={codeAt:l4(!1),charAt:l4(!0)},Jse=g1.charAt,Qse=aa,u4=Gu,Zse=gy,d4=_y,h4="String Iterator",eoe=u4.set,toe=u4.getterFor(h4);Zse(String,"String",function(e){eoe(this,{type:h4,string:Qse(e),index:0})},function(){var e,n=toe(this),i=n.string,o=n.index;return o>=i.length?d4(void 0,!0):(e=Jse(i,o),n.index+=e.length,d4(e,!1))});var noe=Et.Promise,roe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ioe=j,soe=uc,ooe=Do,p4=Wd,f4=ur("toStringTag");for(var _1 in roe){var m4=ioe[_1],E1=m4&&m4.prototype;E1&&soe(E1)!==f4&&ooe(E1,f4,_1),p4[_1]=p4.Array}var g4=noe,ct=l(g4),aoe=Va("Array").values,coe=uc,loe=di,uoe=N,doe=aoe,y1=Array.prototype,hoe={DOMTokenList:!0,NodeList:!0},poe=function(e){var n=e.values;return e===y1||uoe(y1,e)&&n===y1.values||loe(hoe,coe(e))?doe:n},Sc=l(poe),foe=d,moe=ur("iterator"),v1=!foe(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),n=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",n.forEach(function(c,u){n.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!n.size&&!0||!n.sort||e.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[moe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),goe=Hu,_oe=Ma,Eoe=Ze,yoe=Qe,_I=function(e,n,i){var o=_oe(n);o in e?Eoe.f(e,o,yoe(0,i)):e[o]=i},_4=pe,voe=ri,Soe=_I,Toe=Array,boe=Math.max,S1=function(e,n,i){for(var o=voe(e),c=_4(n,o),u=_4(i===void 0?o:i,o),h=Toe(boe(u-c,0)),m=0;c<u;c++,m++)Soe(h,m,e[c]);return h.length=m,h},E4=S1,woe=Math.floor,T1=function(e,n){var i=e.length,o=woe(i/2);return i<8?Roe(e,n):Coe(e,T1(E4(e,0,o),n),T1(E4(e,o),n),n)},Roe=function(e,n){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&n(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},Coe=function(e,n,i,o){for(var c=n.length,u=i.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(n[h],i[m])<=0?n[h++]:i[m++]:h<c?n[h++]:i[m++];return e},y4=T1,b1=Mn,Yy=j,EI=ve,eh=I,Xy=tt,v4=v1,S4=Hu,Ioe=vy,Aoe=function(e,n,i){for(var o in n)i&&i.unsafe&&e[o]?e[o]=n[o]:goe(e,o,n[o],i);return e},Poe=$u,Ooe=hy,w1=Gu,T4=Qg,R1=Me,koe=di,Noe=Ne,Doe=uc,Loe=cn,b4=mt,Ga=aa,xoe=Mo,w4=Qe,C1=zg,Moe=Wu,Jy=al,Uoe=y4,Voe=ur("iterator"),IT="URLSearchParams",R4=IT+"Iterator",C4=w1.set,Yl=w1.getterFor(IT),Foe=w1.getterFor(R4),joe=Object.getOwnPropertyDescriptor,I1=function(e){if(!Xy)return Yy[e];var n=joe(Yy,e);return n&&n.value},I4=I1("fetch"),yI=I1("Request"),AT=I1("Headers"),A1=yI&&yI.prototype,A4=AT&&AT.prototype,Boe=Yy.RegExp,Woe=Yy.TypeError,P4=Yy.decodeURIComponent,zoe=Yy.encodeURIComponent,Goe=eh("".charAt),O4=eh([].join),l_=eh([].push),P1=eh("".replace),Hoe=eh([].shift),k4=eh([].splice),N4=eh("".split),$oe=eh("".slice),Koe=/\+/g,D4=Array(4),qoe=function(e){return D4[e-1]||(D4[e-1]=Boe("((?:%[\\da-f]{2}){"+e+"})","gi"))},Yoe=function(e){try{return P4(e)}catch{return e}},L4=function(e){var n=P1(e,Koe," "),i=4;try{return P4(n)}catch{for(;i;)n=P1(n,qoe(i--),Yoe);return n}},Xoe=/[!'()~]|%20/g,Joe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Qoe=function(e){return Joe[e]},x4=function(e){return P1(zoe(e),Xoe,Qoe)},O1=Ooe(function(e,n){C4(this,{type:R4,iterator:C1(Yl(e).entries),kind:n})},"Iterator",function(){var e=Foe(this),n=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=n==="keys"?o.key:n==="values"?o.value:[o.key,o.value]),i},!0),M4=function(e){this.entries=[],this.url=null,e!==void 0&&(b4(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Goe(e,0)==="?"?$oe(e,1):e:Ga(e)))};M4.prototype={type:IT,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n,i,o,c,u,h,m,_=Moe(e);if(_)for(i=(n=C1(e,_)).next;!(o=EI(i,n)).done;){if(u=(c=C1(Loe(o.value))).next,(h=EI(u,c)).done||(m=EI(u,c)).done||!EI(u,c).done)throw Woe("Expected sequence with length 2");l_(this.entries,{key:Ga(h.value),value:Ga(m.value)})}else for(var y in e)koe(e,y)&&l_(this.entries,{key:y,value:Ga(e[y])})},parseQuery:function(e){if(e)for(var n,i,o=N4(e,"&"),c=0;c<o.length;)(n=o[c++]).length&&(i=N4(n,"="),l_(this.entries,{key:L4(Hoe(i)),value:L4(O4(i,"="))}))},serialize:function(){for(var e,n=this.entries,i=[],o=0;o<n.length;)e=n[o++],l_(i,x4(e.key)+"="+x4(e.value));return O4(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var vI=function(){T4(this,Qy);var e=C4(this,new M4(arguments.length>0?arguments[0]:void 0));Xy||(this.size=e.entries.length)},Qy=vI.prototype;if(Aoe(Qy,{append:function(e,n){var i=Yl(this);Jy(arguments.length,2),l_(i.entries,{key:Ga(e),value:Ga(n)}),Xy||this.length++,i.updateURL()},delete:function(e){for(var n=Yl(this),i=Jy(arguments.length,1),o=n.entries,c=Ga(e),u=i<2?void 0:arguments[1],h=u===void 0?u:Ga(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(k4(o,m,1),h!==void 0)break}Xy||(this.size=o.length),n.updateURL()},get:function(e){var n=Yl(this).entries;Jy(arguments.length,1);for(var i=Ga(e),o=0;o<n.length;o++)if(n[o].key===i)return n[o].value;return null},getAll:function(e){var n=Yl(this).entries;Jy(arguments.length,1);for(var i=Ga(e),o=[],c=0;c<n.length;c++)n[c].key===i&&l_(o,n[c].value);return o},has:function(e){for(var n=Yl(this).entries,i=Jy(arguments.length,1),o=Ga(e),c=i<2?void 0:arguments[1],u=c===void 0?c:Ga(c),h=0;h<n.length;){var m=n[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,n){var i=Yl(this);Jy(arguments.length,1);for(var o,c=i.entries,u=!1,h=Ga(e),m=Ga(n),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?k4(c,_--,1):(u=!0,o.value=m));u||l_(c,{key:h,value:m}),Xy||(this.size=c.length),i.updateURL()},sort:function(){var e=Yl(this);Uoe(e.entries,function(n,i){return n.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var n,i=Yl(this).entries,o=Noe(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((n=i[c++]).value,n.key,this)},keys:function(){return new O1(this,"keys")},values:function(){return new O1(this,"values")},entries:function(){return new O1(this,"entries")}},{enumerable:!0}),S4(Qy,Voe,Qy.entries,{}),S4(Qy,"toString",function(){return Yl(this).serialize()},{enumerable:!0}),Xy&&Ioe(Qy,"size",{get:function(){return Yl(this).entries.length},configurable:!0,enumerable:!0}),Poe(vI,IT),b1({global:!0,forced:!v4},{URLSearchParams:vI}),!v4&&R1(AT)){var Zoe=eh(A4.has),eae=eh(A4.set),U4=function(e){if(b4(e)){var n,i=e.body;if(Doe(i)===IT)return n=e.headers?new AT(e.headers):new AT,Zoe(n,"content-type")||eae(n,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),xoe(e,{body:w4(0,Ga(i)),headers:w4(0,n)})}return e};if(R1(I4)&&b1({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return I4(e,arguments.length>1?U4(arguments[1]):{})}}),R1(yI)){var k1=function(e){return T4(this,A1),new yI(e,arguments.length>1?U4(arguments[1]):{})};A1.constructor=k1,k1.prototype=A1,b1({global:!0,dontCallGetSet:!0,forced:!0},{Request:k1})}}var Xl,tae={URLSearchParams:vI,getState:Yl},nae=Et.URLSearchParams,V4=tt,rae=I,iae=ve,sae=d,N1=pc,oae=hc,aae=Be,cae=wo,lae=_n,Zy=Object.assign,F4=Object.defineProperty,uae=rae([].concat),dae=!Zy||sae(function(){if(V4&&Zy({b:1},Zy(F4({},"a",{enumerable:!0,get:function(){F4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){n[c]=c}),Zy({},e)[i]!=7||N1(Zy({},n)).join("")!=o})?function(e,n){for(var i=cae(e),o=arguments.length,c=1,u=oae.f,h=aae.f;o>c;)for(var m,_=lae(arguments[c++]),y=u?uae(N1(_),u(_)):N1(_),S=y.length,R=0;S>R;)m=y[R++],V4&&!iae(h,_,m)||(i[m]=_[m]);return i}:Zy,hae=cn,pae=Gg,fae=Ne,mae=ve,gae=wo,_ae=function(e,n,i,o){try{return o?n(hae(i)[0],i[1]):n(i)}catch(c){pae(e,"throw",c)}},Eae=Wg,yae=t_,vae=ri,j4=_I,Sae=zg,Tae=Wu,B4=Array,u_=I,D1=2147483647,bae=/[^\0-\u007E]/,W4=/[.\u3002\uFF0E\uFF61]/g,z4="Overflow: input needs wider integers to process",G4=RangeError,wae=u_(W4.exec),ev=Math.floor,L1=String.fromCharCode,H4=u_("".charCodeAt),$4=u_([].join),fm=u_([].push),Rae=u_("".replace),Cae=u_("".split),Iae=u_("".toLowerCase),K4=function(e){return e+22+75*(e<26)},Aae=function(e,n,i){var o=0;for(e=i?ev(e/700):e>>1,e+=ev(e/n);e>455;)e=ev(e/35),o+=36;return ev(o+36*e/(e+38))},Pae=function(e){var n=[];e=function(q){for(var Y=[],ce=0,_e=q.length;ce<_e;){var ye=H4(q,ce++);if(ye>=55296&&ye<=56319&&ce<_e){var fe=H4(q,ce++);(64512&fe)==56320?fm(Y,((1023&ye)<<10)+(1023&fe)+65536):(fm(Y,ye),ce--)}else fm(Y,ye)}return Y}(e);var i,o,c=e.length,u=128,h=0,m=72;for(i=0;i<e.length;i++)(o=e[i])<128&&fm(n,L1(o));var _=n.length,y=_;for(_&&fm(n,"-");y<c;){var S=D1;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<S&&(S=o);var R=y+1;if(S-u>ev((D1-h)/R))throw G4(z4);for(h+=(S-u)*R,u=S,i=0;i<e.length;i++){if((o=e[i])<u&&++h>D1)throw G4(z4);if(o==u){for(var A=h,k=36;;){var W=k<=m?1:k>=m+26?26:k-m;if(A<W)break;var U=A-W,V=36-W;fm(n,L1(K4(W+U%V))),A=ev(U/V),k+=36}fm(n,L1(K4(A))),m=Aae(h,R,y==_),h=0,y++}}h++,u++}return $4(n,"")},Oae=Mn,x1=tt,kae=v1,M1=j,q4=Ne,Jl=I,SI=Hu,Ql=vy,Nae=Qg,U1=di,V1=dae,tv=function(e){var n=gae(e),i=yae(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=fae(c,o>2?arguments[2]:void 0));var h,m,_,y,S,R,A=Tae(n),k=0;if(!A||this===B4&&Eae(A))for(h=vae(n),m=i?new this(h):B4(h);h>k;k++)R=u?c(n[k],k):n[k],j4(m,k,R);else for(S=(y=Sae(n,A)).next,m=i?new this:[];!(_=mae(S,y)).done;k++)R=u?_ae(y,c,[_.value,k],!0):_.value,j4(m,k,R);return m.length=k,m},Ju=S1,Dae=g1.codeAt,Lae=function(e){var n,i,o=[],c=Cae(Rae(Iae(e),W4,"."),".");for(n=0;n<c.length;n++)i=c[n],fm(o,wae(bae,i)?"xn--"+Pae(i):i);return $4(o,".")},Np=aa,xae=$u,Mae=al,Y4=tae,X4=Gu,Uae=X4.set,TI=X4.getterFor("URL"),Vae=Y4.URLSearchParams,Fae=Y4.getState,PT=M1.URL,F1=M1.TypeError,bI=M1.parseInt,jae=Math.floor,J4=Math.pow,Zl=Jl("".charAt),Qu=Jl(/./.exec),OT=Jl([].join),Bae=Jl(1 .toString),Wae=Jl([].pop),nv=Jl([].push),j1=Jl("".replace),zae=Jl([].shift),Gae=Jl("".split),kT=Jl("".slice),wI=Jl("".toLowerCase),Hae=Jl([].unshift),B1="Invalid scheme",d_="Invalid host",Q4="Invalid port",Z4=/[a-z]/i,$ae=/[\d+-.a-z]/i,W1=/\d/,Kae=/^0x/i,qae=/^[0-7]+$/,Yae=/^\d+$/,e3=/^[\da-f]+$/i,Xae=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Jae=/[\0\t\n\r #/:<>?@[\\\]^|]/,Qae=/^[\u0000-\u0020]+/,Zae=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,ece=/[\t\n\r]/g,NT=function(e){var n,i,o,c;if(typeof e=="number"){for(n=[],i=0;i<4;i++)Hae(n,e%256),e=jae(e/256);return OT(n,".")}if(typeof e=="object"){for(n="",o=function(u){for(var h=null,m=1,_=null,y=0,S=0;S<8;S++)u[S]!==0?(y>m&&(h=_,m=y),_=null,y=0):(_===null&&(_=S),++y);return y>m&&(h=_,m=y),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(n+=i?":":"::",c=!0):(n+=Bae(e[i],16),i<7&&(n+=":")));return"["+n+"]"}return e},RI={},t3=V1({},RI,{" ":1,'"':1,"<":1,">":1,"`":1}),n3=V1({},t3,{"#":1,"?":1,"{":1,"}":1}),z1=V1({},n3,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),mm=function(e,n){var i=Dae(e,0);return i>32&&i<127&&!U1(n,e)?e:encodeURIComponent(e)},CI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},DT=function(e,n){var i;return e.length==2&&Qu(Z4,Zl(e,0))&&((i=Zl(e,1))==":"||!n&&i=="|")},r3=function(e){var n;return e.length>1&&DT(kT(e,0,2))&&(e.length==2||(n=Zl(e,2))==="/"||n==="\\"||n==="?"||n==="#")},tce=function(e){return e==="."||wI(e)==="%2e"},G1={},i3={},H1={},s3={},o3={},$1={},a3={},c3={},II={},AI={},K1={},q1={},Y1={},X1={},l3={},J1={},rv={},th={},u3={},h_={},Dp={},Q1=function(e,n,i){var o,c,u,h=Np(e);if(n){if(c=this.parse(h))throw F1(c);this.searchParams=null}else{if(i!==void 0&&(o=new Q1(i,!0)),c=this.parse(h,null,o))throw F1(c);(u=Fae(new Vae)).bindURL(this),this.searchParams=u}};Q1.prototype={type:"URL",parse:function(e,n,i){var o,c,u,h,m,_=this,y=n||G1,S=0,R="",A=!1,k=!1,W=!1;for(e=Np(e),n||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=j1(e,Qae,""),e=j1(e,Zae,"$1")),e=j1(e,ece,""),o=tv(e);S<=o.length;){switch(c=o[S],y){case G1:if(!c||!Qu(Z4,c)){if(n)return B1;y=H1;continue}R+=wI(c),y=i3;break;case i3:if(c&&(Qu($ae,c)||c=="+"||c=="-"||c=="."))R+=wI(c);else{if(c!=":"){if(n)return B1;R="",y=H1,S=0;continue}if(n&&(_.isSpecial()!=U1(CI,R)||R=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=R,n)return void(_.isSpecial()&&CI[_.scheme]==_.port&&(_.port=null));R="",_.scheme=="file"?y=X1:_.isSpecial()&&i&&i.scheme==_.scheme?y=s3:_.isSpecial()?y=c3:o[S+1]=="/"?(y=o3,S++):(_.cannotBeABaseURL=!0,nv(_.path,""),y=u3)}break;case H1:if(!i||i.cannotBeABaseURL&&c!="#")return B1;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=Ju(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,y=Dp;break}y=i.scheme=="file"?X1:$1;continue;case s3:if(c!="/"||o[S+1]!="/"){y=$1;continue}y=II,S++;break;case o3:if(c=="/"){y=AI;break}y=th;continue;case $1:if(_.scheme=i.scheme,c==Xl)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Ju(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())y=a3;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Ju(i.path),_.query="",y=h_;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Ju(i.path),_.path.length--,y=th;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Ju(i.path),_.query=i.query,_.fragment="",y=Dp}break;case a3:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,y=th;continue}y=AI}else y=II;break;case c3:if(y=II,c!="/"||Zl(R,S+1)!="/")continue;S++;break;case II:if(c!="/"&&c!="\\"){y=AI;continue}break;case AI:if(c=="@"){A&&(R="%40"+R),A=!0,u=tv(R);for(var U=0;U<u.length;U++){var V=u[U];if(V!=":"||W){var q=mm(V,z1);W?_.password+=q:_.username+=q}else W=!0}R=""}else if(c==Xl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(A&&R=="")return"Invalid authority";S-=tv(R).length+1,R="",y=K1}else R+=c;break;case K1:case q1:if(n&&_.scheme=="file"){y=J1;continue}if(c!=":"||k){if(c==Xl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&R=="")return d_;if(n&&R==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(R))return h;if(R="",y=rv,n)return;continue}c=="["?k=!0:c=="]"&&(k=!1),R+=c}else{if(R=="")return d_;if(h=_.parseHost(R))return h;if(R="",y=Y1,n==q1)return}break;case Y1:if(!Qu(W1,c)){if(c==Xl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||n){if(R!=""){var Y=bI(R,10);if(Y>65535)return Q4;_.port=_.isSpecial()&&Y===CI[_.scheme]?null:Y,R=""}if(n)return;y=rv;continue}return Q4}R+=c;break;case X1:if(_.scheme="file",c=="/"||c=="\\")y=l3;else{if(!i||i.scheme!="file"){y=th;continue}if(c==Xl)_.host=i.host,_.path=Ju(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=Ju(i.path),_.query="",y=h_;else{if(c!="#"){r3(OT(Ju(o,S),""))||(_.host=i.host,_.path=Ju(i.path),_.shortenPath()),y=th;continue}_.host=i.host,_.path=Ju(i.path),_.query=i.query,_.fragment="",y=Dp}}break;case l3:if(c=="/"||c=="\\"){y=J1;break}i&&i.scheme=="file"&&!r3(OT(Ju(o,S),""))&&(DT(i.path[0],!0)?nv(_.path,i.path[0]):_.host=i.host),y=th;continue;case J1:if(c==Xl||c=="/"||c=="\\"||c=="?"||c=="#"){if(!n&&DT(R))y=th;else if(R==""){if(_.host="",n)return;y=rv}else{if(h=_.parseHost(R))return h;if(_.host=="localhost"&&(_.host=""),n)return;R="",y=rv}continue}R+=c;break;case rv:if(_.isSpecial()){if(y=th,c!="/"&&c!="\\")continue}else if(n||c!="?")if(n||c!="#"){if(c!=Xl&&(y=th,c!="/"))continue}else _.fragment="",y=Dp;else _.query="",y=h_;break;case th:if(c==Xl||c=="/"||c=="\\"&&_.isSpecial()||!n&&(c=="?"||c=="#")){if((m=wI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||nv(_.path,"")):tce(R)?c=="/"||c=="\\"&&_.isSpecial()||nv(_.path,""):(_.scheme=="file"&&!_.path.length&&DT(R)&&(_.host&&(_.host=""),R=Zl(R,0)+":"),nv(_.path,R)),R="",_.scheme=="file"&&(c==Xl||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)zae(_.path);c=="?"?(_.query="",y=h_):c=="#"&&(_.fragment="",y=Dp)}else R+=mm(c,n3);break;case u3:c=="?"?(_.query="",y=h_):c=="#"?(_.fragment="",y=Dp):c!=Xl&&(_.path[0]+=mm(c,RI));break;case h_:n||c!="#"?c!=Xl&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":mm(c,RI)):(_.fragment="",y=Dp);break;case Dp:c!=Xl&&(_.fragment+=mm(c,t3))}S++}},parseHost:function(e){var n,i,o;if(Zl(e,0)=="["){if(Zl(e,e.length-1)!="]"||(n=function(c){var u,h,m,_,y,S,R,A=[0,0,0,0,0,0,0,0],k=0,W=null,U=0,V=function(){return Zl(c,U)};if(V()==":"){if(Zl(c,1)!=":")return;U+=2,W=++k}for(;V();){if(k==8)return;if(V()!=":"){for(u=h=0;h<4&&Qu(e3,V());)u=16*u+bI(V(),16),U++,h++;if(V()=="."){if(h==0||(U-=h,k>6))return;for(m=0;V();){if(_=null,m>0){if(!(V()=="."&&m<4))return;U++}if(!Qu(W1,V()))return;for(;Qu(W1,V());){if(y=bI(V(),10),_===null)_=y;else{if(_==0)return;_=10*_+y}if(_>255)return;U++}A[k]=256*A[k]+_,++m!=2&&m!=4||k++}if(m!=4)return;break}if(V()==":"){if(U++,!V())return}else if(V())return;A[k++]=u}else{if(W!==null)return;U++,W=++k}}if(W!==null)for(S=k-W,k=7;k!=0&&S>0;)R=A[k],A[k--]=A[W+S-1],A[W+--S]=R;else if(k!=8)return;return A}(kT(e,1,-1)),!n))return d_;this.host=n}else if(this.isSpecial()){if(e=Lae(e),Qu(Xae,e)||(n=function(c){var u,h,m,_,y,S,R,A=Gae(c,".");if(A.length&&A[A.length-1]==""&&A.length--,(u=A.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=A[m])=="")return c;if(y=10,_.length>1&&Zl(_,0)=="0"&&(y=Qu(Kae,_)?16:8,_=kT(_,y==8?1:2)),_==="")S=0;else{if(!Qu(y==10?Yae:y==8?qae:e3,_))return c;S=bI(_,y)}nv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=J4(256,5-u))return null}else if(S>255)return null;for(R=Wae(h),m=0;m<h.length;m++)R+=h[m]*J4(256,3-m);return R}(e),n===null))return d_;this.host=n}else{if(Qu(Jae,e))return d_;for(n="",i=tv(e),o=0;o<i.length;o++)n+=mm(i[o],RI);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return U1(CI,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;!n||this.scheme=="file"&&n==1&&DT(e[0],!0)||e.length--},serialize:function(){var e=this,n=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,y=n+":";return c!==null?(y+="//",e.includesCredentials()&&(y+=i+(o?":"+o:"")+"@"),y+=NT(c),u!==null&&(y+=":"+u)):n=="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+OT(h,"/"):"",m!==null&&(y+="?"+m),_!==null&&(y+="#"+_),y},setHref:function(e){var n=this.parse(e);if(n)throw F1(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e=="blob")try{return new iv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+NT(this.host)+(n!==null?":"+n:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Np(e)+":",G1)},getUsername:function(){return this.username},setUsername:function(e){var n=tv(Np(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<n.length;i++)this.username+=mm(n[i],z1)}},getPassword:function(){return this.password},setPassword:function(e){var n=tv(Np(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<n.length;i++)this.password+=mm(n[i],z1)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?NT(e):NT(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,K1)},getHostname:function(){var e=this.host;return e===null?"":NT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,q1)},getPort:function(){var e=this.port;return e===null?"":Np(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Np(e))==""?this.port=null:this.parse(e,Y1))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+OT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,rv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Np(e))==""?this.query=null:(Zl(e,0)=="?"&&(e=kT(e,1)),this.query="",this.parse(e,h_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Np(e))!=""?(Zl(e,0)=="#"&&(e=kT(e,1)),this.fragment="",this.parse(e,Dp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var iv=function(e){var n=Nae(this,Ha),i=Mae(arguments.length,1)>1?arguments[1]:void 0,o=Uae(n,new Q1(e,!1,i));x1||(n.href=o.serialize(),n.origin=o.getOrigin(),n.protocol=o.getProtocol(),n.username=o.getUsername(),n.password=o.getPassword(),n.host=o.getHost(),n.hostname=o.getHostname(),n.port=o.getPort(),n.pathname=o.getPathname(),n.search=o.getSearch(),n.searchParams=o.getSearchParams(),n.hash=o.getHash())},Ha=iv.prototype,eu=function(e,n){return{get:function(){return TI(this)[e]()},set:n&&function(i){return TI(this)[n](i)},configurable:!0,enumerable:!0}};if(x1&&(Ql(Ha,"href",eu("serialize","setHref")),Ql(Ha,"origin",eu("getOrigin")),Ql(Ha,"protocol",eu("getProtocol","setProtocol")),Ql(Ha,"username",eu("getUsername","setUsername")),Ql(Ha,"password",eu("getPassword","setPassword")),Ql(Ha,"host",eu("getHost","setHost")),Ql(Ha,"hostname",eu("getHostname","setHostname")),Ql(Ha,"port",eu("getPort","setPort")),Ql(Ha,"pathname",eu("getPathname","setPathname")),Ql(Ha,"search",eu("getSearch","setSearch")),Ql(Ha,"searchParams",eu("getSearchParams")),Ql(Ha,"hash",eu("getHash","setHash"))),SI(Ha,"toJSON",function(){return TI(this).serialize()},{enumerable:!0}),SI(Ha,"toString",function(){return TI(this).serialize()},{enumerable:!0}),PT){var d3=PT.createObjectURL,h3=PT.revokeObjectURL;d3&&SI(iv,"createObjectURL",q4(d3,PT)),h3&&SI(iv,"revokeObjectURL",q4(h3,PT))}xae(iv,"URL"),Oae({global:!0,forced:!kae,sham:!x1},{URL:iv});var nce=Mn,rce=d,ice=al,p3=aa,sce=v1,f3=Yt("URL");nce({target:"URL",stat:!0,forced:!(sce&&rce(function(){f3.canParse()}))},{canParse:function(e){var n=ice(arguments.length,1),i=p3(e),o=n<2||arguments[1]===void 0?void 0:p3(arguments[1]);try{return!!new f3(i,o)}catch{return!1}}});var PI=l(Et.URL);let m3=!0,g3=!0;function OI(e,n,i){const o=e.match(n);return o&&o.length>=i&&parseInt(o[i],10)}function p_(e,n,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==n)return c.apply(this,arguments);const _=y=>{const S=i(y);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==n||!this._eventMap||!this._eventMap[n])return u.apply(this,arguments);if(!this._eventMap[n].has(m))return u.apply(this,arguments);const _=this._eventMap[n].get(m);return this._eventMap[n].delete(m),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function oce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(m3=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ace(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(g3=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function _3(){if(typeof window=="object"){if(m3)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Z1(e,n){g3&&console.warn(e+" is deprecated, please use "+n+" instead.")}function E3(e){return Object.prototype.toString.call(e)==="[object Object]"}function y3(e){var n;return E3(e)?Fa(n=Object.keys(e)).call(n,function(i,o){const c=E3(e[o]),u=c?y3(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function eD(e,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(o=>{o.endsWith("Id")?eD(e,e.get(n[o]),i):o.endsWith("Ids")&&n[o].forEach(c=>{eD(e,e.get(c),i)})}))}function v3(e,n,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(n===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===n.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&eD(e,m,c)})}),c}const S3=_3;function T3(e,n){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const y=typeof h[_]=="object"?h[_]:{ideal:h[_]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const S=function(R,A){return R?R+A.charAt(0).toUpperCase()+A.slice(1):A==="deviceId"?"sourceId":A};if(y.ideal!==void 0){m.optional=m.optional||[];let R={};typeof y.ideal=="number"?(R[S("min",_)]=y.ideal,m.optional.push(R),R={},R[S("max",_)]=y.ideal,m.optional.push(R)):(R[S("",_)]=y.ideal,m.optional.push(R))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=y.exact):["min","max"].forEach(R=>{y[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,_)]=y[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(n.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(y,S,R){S in y&&!(R in y)&&(y[R]=y[S],delete y[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const y=n.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||y)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(R=>{let A=(R=R.filter(k=>k.kind==="videoinput")).find(k=>S.some(W=>{var U;return st(U=k.label.toLowerCase()).call(U,W)}));return!A&&R.length&&st(S).call(S,"back")&&(A=R[R.length-1]),A&&(h.video.deviceId=_.exact?{exact:A.deviceId}:{ideal:A.deviceId}),h.video=o(h.video),S3("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return S3("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,_){c(h,y=>{i.webkitGetUserMedia(y,m,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(y=>{if(_.audio&&!y.getAudioTracks().length||_.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return y},y=>ct.reject(u(y))))}}}function b3(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function w3(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else p_(e,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function R3(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const n=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=n(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(n(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function C3(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof i!="function"))return n.apply(this,[]);const u=function(m){const _={};return m.result().forEach(y=>{const S={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(R=>{S[R]=y.stat(R)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return n.apply(this,[m,i])}return new ct((m,_)=>{n.apply(this,[function(y){m(h(u(y)))},_])}).then(o,c)}}function I3(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>v3(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),p_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>v3(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?ct.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():ct.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function A3(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function P3(e,n){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return A3(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(R=>R.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new e.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const A=_._reverseStreams[R],k=_._streams[A.id];S=S.replace(new RegExp(k.id,"g"),A.id)}),new RTCSessionDescription({type:y.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[y.id];if(A)A.addTrack(_),ct.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new e.MediaStream([_]);this._streams[y.id]=k,this._reverseStreams[k.id]=y,this.addStream(k)}return this.getSenders().find(k=>k.track===_)},["createOffer","createAnswer"].forEach(function(_){const y=e.RTCPeerConnection.prototype[_],S={[_](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[A=>{const k=u(this,A);R[0].apply(null,[k])},A=>{R[1]&&R[1].apply(null,A)},arguments[2]]):y.apply(this,arguments).then(A=>u(this,A))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const A=_._reverseStreams[R],k=_._streams[A.id];S=S.replace(new RegExp(A.id,"g"),k.id)}),new RTCSessionDescription({type:y.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>_.track===R)&&(y=this._streams[S])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function tD(e,n){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function O3(e,n){p_(e,"negotiationneeded",i=>{const o=i.target;if(!(n.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var k3=Object.freeze({__proto__:null,fixNegotiationNeeded:O3,shimAddTrackRemoveTrack:P3,shimAddTrackRemoveTrackWithNative:A3,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof n=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return n(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:R3,shimGetStats:C3,shimGetUserMedia:T3,shimMediaStream:b3,shimOnTrack:w3,shimPeerConnection:tD,shimSenderReceiverGetStats:I3});function N3(e,n){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){Z1("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function D3(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function nD(e,n){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(n.version<53&&!u)try{m.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((y,S)=>{m.set(S,Object.assign({},y,{type:i[y.type]||y.type}))})}return m}).then(u,h)}}function L3(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ct.resolve(new Map)}}function x3(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),p_(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function M3(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(n){Z1("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&st(o=n.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function U3(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function V3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function F3(e){if(typeof e!="object"||!e.RTCRtpSender)return;const n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){const i=n.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function j3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ct.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function B3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ct.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var W3=Object.freeze({__proto__:null,shimAddTransceiver:V3,shimCreateAnswer:B3,shimCreateOffer:j3,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ct.reject(o)}return i.video===!0?i.video={mediaSource:n}:i.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:F3,shimGetUserMedia:N3,shimOnTrack:D3,shimPeerConnection:nD,shimRTCDataChannel:U3,shimReceiverGetStats:x3,shimRemoveStream:M3,shimSenderGetStats:L3});function z3(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),st(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>n.call(this,c,i)),i.getVideoTracks().forEach(c=>n.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?st(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const o=n.getTracks();this.getSenders().forEach(c=>{st(o).call(o,c.track)&&this.removeTrack(c)})})}}function G3(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),st(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),n.apply(i,arguments)}}}function H3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.createOffer,o=n.createAnswer,c=n.setLocalDescription,u=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=i.apply(this,[S]);return y?(R.then(_,y),ct.resolve()):R},n.createAnswer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return y?(R.then(_,y),ct.resolve()):R};let m=function(_,y,S){const R=c.apply(this,[_]);return S?(R.then(y,S),ct.resolve()):R};n.setLocalDescription=m,m=function(_,y,S){const R=u.apply(this,[_]);return S?(R.then(y,S),ct.resolve()):R},n.setRemoteDescription=m,m=function(_,y,S){const R=h.apply(this,[_]);return S?(R.then(y,S),ct.resolve()):R},n.addIceCandidate=m}function $3(e){const n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const i=n.mediaDevices,o=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=c=>o(K3(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=(function(i,o,c){n.mediaDevices.getUserMedia(i).then(o,c)}).bind(n))}function K3(e){return e&&e.video!==void 0?Object.assign({},e,{video:y3(e.video)}):e}function q3(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Z1("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new n(i,o)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function Y3(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function X3(e){const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function J3(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Q3=Object.freeze({__proto__:null,shimAudioContext:J3,shimCallbacksAPI:H3,shimConstraints:K3,shimCreateOfferLegacy:X3,shimGetUserMedia:$3,shimLocalStreamsAPI:z3,shimRTCIceServerUrls:q3,shimRemoteStreamsAPI:G3,shimTrackEventTransceiver:Y3}),Z3=`	
\v\f\r \u2028\u2029\uFEFF`,cce=Xt,lce=aa,rD=Z3,eB=I("".replace),uce=RegExp("^["+rD+"]+"),dce=RegExp("(^|[^"+rD+"])["+rD+"]+$"),hce=function(e){return function(n){var i=lce(cce(n));return 1&e&&(i=eB(i,uce,"")),2&e&&(i=eB(i,dce,"$1")),i}},pce={trim:hce(3)},fce=UC.PROPER,mce=d,tB=Z3,gce=pce.trim;Mn({target:"String",proto:!0,forced:function(e){return mce(function(){return!!tB[e]()||""[e]()!==""||fce&&tB[e].name!==e})}("trim")},{trim:function(){return gce(this)}});var _ce=Va("String").trim,Ece=N,yce=_ce,iD=String.prototype,vce=function(e){var n=e.trim;return typeof e=="string"||e===iD||Ece(iD,e)&&n===iD.trim?yce:n},Ys=l(vce),nB={exports:{}};(function(e){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},n.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},n.getDescription=function(i){const o=n.splitSections(i);return o&&o[0]},n.getMediaSections=function(i){const o=n.splitSections(i);return o.shift(),o},n.matchPrefix=function(i,o){return n.splitLines(i).filter(c=>c.indexOf(o)===0)},n.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},n.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},n.parseIceOptions=function(i){return i.substring(14).split(" ")},n.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},n.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},n.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},n.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},n.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},n.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},n.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},n.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},n.getMid=function(i){const o=n.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},n.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},n.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:n.matchPrefix(i+o,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},n.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,o){return n.matchPrefix(i+o,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,o){const c=n.matchPrefix(i+o,"a=ice-ufrag:")[0],u=n.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},n.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},n.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=n.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(_){const y=n.parseRtpMap(_),S=n.matchPrefix(i,"a=fmtp:"+m+" ");switch(y.parameters=S.length?n.parseFmtp(S[0]):{},y.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(n.parseRtcpFb),o.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(y.name.toUpperCase())}}}n.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(n.parseExtmap(h))});const u=n.matchPrefix(i,"a=rtcp-fb:* ").map(n.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},n.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(i){const o=[],c=n.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=n.matchPrefix(i,"a=ssrc:").map(A=>n.parseSsrcMedia(A)).filter(A=>A.attribute==="cname"),_=m.length>0&&m[0].ssrc;let y;const S=n.matchPrefix(i,"a=ssrc-group:FID").map(A=>A.substring(17).split(" ").map(k=>parseInt(k,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(y=S[0][1]),c.codecs.forEach(A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let k={ssrc:_,codecPayloadType:parseInt(A.parameters.apt,10)};_&&y&&(k.rtx={ssrc:y}),o.push(k),u&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(k))}}),o.length===0&&_&&o.push({ssrc:_});let R=n.matchPrefix(i,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(A=>{A.maxBitrate=R})),o},n.parseRtcpParameters=function(i){const o={},c=n.matchPrefix(i,"a=ssrc:").map(m=>n.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=n.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=n.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},n.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},n.parseMsid=function(i){let o;const c=n.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=n.matchPrefix(i,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},n.parseSctpDescription=function(i){const o=n.parseMLine(i),c=n.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=n.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=n.matchPrefix(i,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},n.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||n.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(i,o){const c=n.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?n.getDirection(o):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substring(2)},n.isRejected=function(i){return i.split(" ",2)[1]==="0"},n.parseMLine=function(i){const o=n.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},n.parseOLine=function(i){const o=n.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},n.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=n.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=n})(nB);var rB=nB.exports,sv=l(rB),Sce=s({__proto__:null,default:sv},[rB]);function kI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const n=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new n(i),c=sv.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new n(i)},e.RTCIceCandidate.prototype=n.prototype,p_(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function sD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||p_(e,"icecandidate",n=>{if(n.candidate){const i=sv.parseCandidate(n.candidate.candidate);i.type==="relay"&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function NI(e,n){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const _=sv.splitSections(m.sdp);return _.shift(),_.some(y=>{const S=sv.parseMLine(y);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const y=parseInt(_[1],10);return y!=y?-1:y},c=function(m){let _=65536;return n.browser==="firefox"&&(_=n.version<57?m===-1?16384:2147483637:n.version<60?n.version===57?65535:65536:2147483637),_},u=function(m,_){let y=65536;n.browser==="firefox"&&n.version===57&&(y=65535);const S=sv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?y=parseInt(S[0].substr(19),10):n.browser==="firefox"&&_!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=o(arguments[0]),_=c(m),y=u(arguments[0],m);let S;S=_===0&&y===0?Number.POSITIVE_INFINITY:_===0||y===0?Math.max(_,y):Math.min(_,y);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function DI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function n(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return n(o,this),o},p_(e,"datachannel",o=>(n(o.channel,o.target),o))}function oD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function aD(e,n){if(!e.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>Ys(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function LI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ct.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ct.resolve())})}function xI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Tce=Object.freeze({__proto__:null,removeExtmapAllowMixed:aD,shimAddIceCandidateNullOrEmpty:LI,shimConnectionState:oD,shimMaxMessageSize:NI,shimParameterlessSetLocalDescription:xI,shimRTCIceCandidate:kI,shimRTCIceCandidateRelayProtocol:sD,shimSendThrowTypeError:DI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=_3,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=OI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=OI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=OI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:Tce,extractVersion:OI,disableLog:oce,disableWarnings:ace,sdp:Sce};switch(o.browser){case"chrome":if(!k3||!tD||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=k3,LI(e,o),xI(e),T3(e,o),b3(e),tD(e,o),w3(e),P3(e,o),R3(e),C3(e),I3(e),O3(e,o),kI(e),sD(e),oD(e),NI(e,o),DI(e),aD(e,o);break;case"firefox":if(!W3||!nD||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=W3,LI(e,o),xI(e),N3(e,o),nD(e,o),D3(e),M3(e),L3(e),x3(e),U3(e),V3(e),F3(e),j3(e),B3(e),kI(e),oD(e),NI(e,o),DI(e);break;case"safari":if(!Q3||!n.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=Q3,LI(e,o),xI(e),q3(e),X3(e),H3(e),z3(e),G3(e),Y3(e),$3(e),J3(e),kI(e),sD(e),NI(e,o),DI(e),aD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var iB=rc,bce=TypeError,sB=Bn.match(/firefox\/(\d+)/i),wce=!!sB&&+sB[1],Rce=/MSIE|Trident/.test(Bn),oB=Bn.match(/AppleWebKit\/(\d+)\./),Cce=!!oB&&+oB[1],Ice=Mn,aB=I,Ace=rs,Pce=wo,cB=ri,Oce=function(e,n){if(!delete e[n])throw bce("Cannot delete property "+iB(n)+" of "+iB(e))},lB=aa,cD=d,kce=y4,Nce=up,uB=wce,Dce=Rce,dB=ui,hB=Cce,gm=[],pB=aB(gm.sort),Lce=aB(gm.push),xce=cD(function(){gm.sort(void 0)}),Mce=cD(function(){gm.sort(null)}),Uce=Nce("sort"),fB=!cD(function(){if(dB)return dB<70;if(!(uB&&uB>3)){if(Dce)return!0;if(hB)return hB<603;var e,n,i,o,c="";for(e=65;e<76;e++){switch(n=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)gm.push({k:n+o,v:i})}for(gm.sort(function(u,h){return h.v-u.v}),o=0;o<gm.length;o++)n=gm[o].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return c!=="DGBEFHACIJK"}});Ice({target:"Array",proto:!0,forced:xce||!Mce||!Uce||!fB},{sort:function(e){e!==void 0&&Ace(e);var n=Pce(this);if(fB)return e===void 0?pB(n):pB(n,e);var i,o,c=[],u=cB(n);for(o=0;o<u;o++)o in n&&Lce(c,n[o]);for(kce(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:lB(m)>lB(_)?1:-1}}(e)),i=cB(c),o=0;o<i;)n[o]=c[o++];for(;o<u;)Oce(n,o++);return n}});var Vce=Va("Array").sort,Fce=N,jce=Vce,lD=Array.prototype,Bce=function(e){var n=e.sort;return e===lD||Fce(lD,e)&&n===lD.sort?jce:n},LT=l(Bce),uD=j;Mn({global:!0,forced:uD.globalThis!==uD},{globalThis:uD});var mB=l(j),dD={exports:{}};(function(e,n){(function(i,o){var c="function",u="undefined",h="object",m="string",_="major",y="model",S="name",R="type",A="vendor",k="version",W="architecture",U="console",V="mobile",q="tablet",Y="smarttv",ce="wearable",_e="embedded",ye="Amazon",fe="Apple",ke="ASUS",qe="BlackBerry",lt="Browser",ht="Chrome",yn="Firefox",vn="Google",cr="Huawei",Qr="LG",Br="Microsoft",Ko="Motorola",Fe="Opera",rt="Samsung",vt="Sharp",We="Sony",x="Xiaomi",ie="Zebra",ue="Facebook",Xe="Chromium OS",$t="Mac OS",nr=function(_i){for(var Di={},Er=0;Er<_i.length;Er++)Di[_i[Er].toUpperCase()]=_i[Er];return Di},Ni=function(_i,Di){return typeof _i===m&&va(Di).indexOf(va(_i))!==-1},va=function(_i){return _i.toLowerCase()},Xp=function(_i,Di){if(typeof _i===m)return _i=_i.replace(/^\s\s*/,""),typeof Di===u?_i:_i.substring(0,350)},G_=function(_i,Di){for(var Er,qa,vh,Zr,Fn,Sa,Vm=0;Vm<Di.length&&!Fn;){var hd=Di[Vm],W7=Di[Vm+1];for(Er=qa=0;Er<hd.length&&!Fn&&hd[Er];)if(Fn=hd[Er++].exec(_i))for(vh=0;vh<W7.length;vh++)Sa=Fn[++qa],typeof(Zr=W7[vh])===h&&Zr.length>0?Zr.length===2?typeof Zr[1]==c?this[Zr[0]]=Zr[1].call(this,Sa):this[Zr[0]]=Zr[1]:Zr.length===3?typeof Zr[1]!==c||Zr[1].exec&&Zr[1].test?this[Zr[0]]=Sa?Sa.replace(Zr[1],Zr[2]):o:this[Zr[0]]=Sa?Zr[1].call(this,Sa,Zr[2]):o:Zr.length===4&&(this[Zr[0]]=Sa?Zr[3].call(this,Sa.replace(Zr[1],Zr[2])):o):this[Zr]=Sa||o;Vm+=2}},Ub=function(_i,Di){for(var Er in Di)if(typeof Di[Er]===h&&Di[Er].length>0){for(var qa=0;qa<Di[Er].length;qa++)if(Ni(Di[Er][qa],_i))return Er==="?"?o:Er}else if(Ni(Di[Er],_i))return Er==="?"?o:Er;return _i},NP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},DP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,k],[/opios[\/ ]+([\w\.]+)/i],[k,[S,Fe+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[S,Fe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[S,"UC"+lt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+lt],k],[/\bfocus\/([\w\.]+)/i],[k,[S,yn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[S,Fe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[S,Fe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[S,"MIUI "+lt]],[/fxios\/([-\w\.]+)/i],[k,[S,yn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+lt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+lt],k],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,ue],k],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[S,ht+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,ht+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[S,"Android "+lt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[k,Ub,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[S,yn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,k],[/(cobalt)\/([\w\.]+)/i],[S,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[W,"amd64"]],[/(ia32(?=;))/i],[[W,va]],[/((?:i[346]|x)86)[;\)]/i],[[W,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[W,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[W,"armhf"]],[/windows (ce|mobile); ppc;/i],[[W,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[W,/ower/,"",va]],[/(sun4\w)[;\)]/i],[[W,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[W,va]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[A,rt],[R,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[A,rt],[R,V]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[A,fe],[R,V]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[A,fe],[R,q]],[/(macintosh);/i],[y,[A,fe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[A,vt],[R,V]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[A,cr],[R,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[A,cr],[R,V]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[A,x],[R,V]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[A,x],[R,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[A,"OPPO"],[R,V]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[A,"Vivo"],[R,V]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[A,"Realme"],[R,V]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[A,Ko],[R,V]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[A,Ko],[R,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[A,Qr],[R,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[A,Qr],[R,V]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[A,"Lenovo"],[R,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[A,"Nokia"],[R,V]],[/(pixel c)\b/i],[y,[A,vn],[R,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[A,vn],[R,V]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[A,We],[R,V]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[A,We],[R,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[A,"OnePlus"],[R,V]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[A,ye],[R,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[A,ye],[R,V]],[/(playbook);[-\w\),; ]+(rim)/i],[y,A,[R,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[A,qe],[R,V]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[A,ke],[R,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[A,ke],[R,V]],[/(nexus 9)/i],[y,[A,"HTC"],[R,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[y,/_/g," "],[R,V]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[A,"Acer"],[R,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[A,"Meizu"],[R,V]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,y,[R,V]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,y,[R,q]],[/(surface duo)/i],[y,[A,Br],[R,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[A,"Fairphone"],[R,V]],[/(u304aa)/i],[y,[A,"AT&T"],[R,V]],[/\bsie-(\w*)/i],[y,[A,"Siemens"],[R,V]],[/\b(rct\w+) b/i],[y,[A,"RCA"],[R,q]],[/\b(venue[\d ]{2,7}) b/i],[y,[A,"Dell"],[R,q]],[/\b(q(?:mv|ta)\w+) b/i],[y,[A,"Verizon"],[R,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[A,"Barnes & Noble"],[R,q]],[/\b(tm\d{3}\w+) b/i],[y,[A,"NuVision"],[R,q]],[/\b(k88) b/i],[y,[A,"ZTE"],[R,q]],[/\b(nx\d{3}j) b/i],[y,[A,"ZTE"],[R,V]],[/\b(gen\d{3}) b.+49h/i],[y,[A,"Swiss"],[R,V]],[/\b(zur\d{3}) b/i],[y,[A,"Swiss"],[R,q]],[/\b((zeki)?tb.*\b) b/i],[y,[A,"Zeki"],[R,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],y,[R,q]],[/\b(ns-?\w{0,9}) b/i],[y,[A,"Insignia"],[R,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[A,"NextBook"],[R,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],y,[R,V]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],y,[R,V]],[/\b(ph-1) /i],[y,[A,"Essential"],[R,V]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[A,"Envizen"],[R,q]],[/\b(trio[-\w\. ]+) b/i],[y,[A,"MachSpeed"],[R,q]],[/\btu_(1491) b/i],[y,[A,"Rotor"],[R,q]],[/(shield[\w ]+) b/i],[y,[A,"Nvidia"],[R,q]],[/(sprint) (\w+)/i],[A,y,[R,V]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[A,Br],[R,V]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[A,ie],[R,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[A,ie],[R,V]],[/smart-tv.+(samsung)/i],[A,[R,Y]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[A,rt],[R,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,Qr],[R,Y]],[/(apple) ?tv/i],[A,[y,fe+" TV"],[R,Y]],[/crkey/i],[[y,ht+"cast"],[A,vn],[R,Y]],[/droid.+aft(\w)( bui|\))/i],[y,[A,ye],[R,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[A,vt],[R,Y]],[/(bravia[\w ]+)( bui|\))/i],[y,[A,We],[R,Y]],[/(mitv-\w{5}) bui/i],[y,[A,x],[R,Y]],[/Hbbtv.*(technisat) (.*);/i],[A,y,[R,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,Xp],[y,Xp],[R,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,y,[R,U]],[/droid.+; (shield) bui/i],[y,[A,"Nvidia"],[R,U]],[/(playstation [345portablevi]+)/i],[y,[A,We],[R,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[A,Br],[R,U]],[/((pebble))app/i],[A,y,[R,ce]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[A,fe],[R,ce]],[/droid.+; (glass) \d/i],[y,[A,vn],[R,ce]],[/droid.+; (wt63?0{2,3})\)/i],[y,[A,ie],[R,ce]],[/(quest( 2| pro)?)/i],[y,[A,ue],[R,ce]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[R,_e]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[R,V]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[R,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,V]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[k,Ub,NP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[k,Ub,NP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,$t],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,k],[/\(bb(10);/i],[k,[S,qe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[S,yn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[S,ht+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Xe],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,k],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,k]]},yl=function(_i,Di){if(typeof _i===h&&(Di=_i,_i=o),!(this instanceof yl))return new yl(_i,Di).getResult();var Er=typeof i!==u&&i.navigator?i.navigator:o,qa=_i||(Er&&Er.userAgent?Er.userAgent:""),vh=Er&&Er.userAgentData?Er.userAgentData:o,Zr=Di?function(Fn,Sa){var Vm={};for(var hd in Fn)Sa[hd]&&Sa[hd].length%2==0?Vm[hd]=Sa[hd].concat(Fn[hd]):Vm[hd]=Fn[hd];return Vm}(DP,Di):DP;return this.getBrowser=function(){var Fn={};return Fn[S]=o,Fn[k]=o,G_.call(Fn,qa,Zr.browser),Fn[_]=function(Sa){return typeof Sa===m?Sa.replace(/[^\d\.]/g,"").split(".")[0]:o}(Fn[k]),Er&&Er.brave&&typeof Er.brave.isBrave==c&&(Fn[S]="Brave"),Fn},this.getCPU=function(){var Fn={};return Fn[W]=o,G_.call(Fn,qa,Zr.cpu),Fn},this.getDevice=function(){var Fn={};return Fn[A]=o,Fn[y]=o,Fn[R]=o,G_.call(Fn,qa,Zr.device),!Fn[R]&&vh&&vh.mobile&&(Fn[R]=V),Fn[y]=="Macintosh"&&Er&&typeof Er.standalone!==u&&Er.maxTouchPoints&&Er.maxTouchPoints>2&&(Fn[y]="iPad",Fn[R]=q),Fn},this.getEngine=function(){var Fn={};return Fn[S]=o,Fn[k]=o,G_.call(Fn,qa,Zr.engine),Fn},this.getOS=function(){var Fn={};return Fn[S]=o,Fn[k]=o,G_.call(Fn,qa,Zr.os),!Fn[S]&&vh&&vh.platform!="Unknown"&&(Fn[S]=vh.platform.replace(/chrome os/i,Xe).replace(/macos/i,$t)),Fn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return qa},this.setUA=function(Fn){return qa=typeof Fn===m&&Fn.length>350?Xp(Fn,350):Fn,this},this.setUA(qa),this};yl.VERSION="0.7.34",yl.BROWSER=nr([S,k,_]),yl.CPU=nr([W]),yl.DEVICE=nr([y,A,R,U,V,Y,q,ce,_e]),yl.ENGINE=yl.OS=nr([S,k]),e.exports&&(n=e.exports=yl),n.UAParser=yl;var Um=typeof i!==u&&(i.jQuery||i.Zepto);if(Um&&!Um.ua){var H_=new yl;Um.ua=H_.getResult(),Um.ua.get=function(){return H_.getUA()},Um.ua.set=function(_i){H_.setUA(_i);var Di=H_.getResult();for(var Er in Di)Um.ua[Er]=Di[Er]}}})(typeof window=="object"?window:a)})(dD,dD.exports);var Wce=l(dD.exports),zce=uc,Gce=di,Hce=Vt,$ce=Wd,Kce=ur("iterator"),qce=Object,Yce=function(e){if(Hce(e))return!1;var n=qce(e);return n[Kce]!==void 0||"@@iterator"in n||Gce($ce,zce(n))},Xce=l(Yce),gB=xy.clear;Mn({global:!0,bind:!0,forced:j.clearImmediate!==gB},{clearImmediate:gB});var Jce=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",_B=j,Qce=Q,Zce=Me,ele=Jce,tle=Bn,nle=cs,rle=al,ile=_B.Function,sle=/MSIE .\./.test(tle)||ele&&function(){var e=_B.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),ole=Mn,EB=j,yB=xy.set,ale=function(e,n){var i=1;return sle?function(o,c){var u=rle(arguments.length,1)>i,h=Zce(o)?o:ile(o),m=u?nle(arguments,i):[],_=u?function(){Qce(h,this,m)}:h;return e(_)}:e},vB=EB.setImmediate?ale(yB):yB;ole({global:!0,bind:!0,forced:EB.setImmediate!==vB},{setImmediate:vB});var SB=l(Et.setImmediate),cle=Mn,lle=za,ule=rs,dle=al,hle=dp,ple=j.process;cle({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){dle(arguments.length,1),ule(e);var n=hle&&ple.domain;lle(n?n.bind(e):e)}});var TB=l(Et.queueMicrotask);function bB(e,n){return function(){return e.apply(n,arguments)}}const{toString:fle}=Object.prototype,{getPrototypeOf:hD}=Object,MI=(pD=Object.create(null),e=>{const n=fle.call(e);return pD[n]||(pD[n]=n.slice(8,-1).toLowerCase())});var pD;const Zu=e=>(e=e.toLowerCase(),n=>MI(n)===e),UI=e=>n=>typeof n===e,{isArray:ov}=Array,xT=UI("undefined"),wB=Zu("ArrayBuffer"),mle=UI("string"),ll=UI("function"),RB=UI("number"),VI=e=>e!==null&&typeof e=="object",FI=e=>{if(MI(e)!=="object")return!1;const n=hD(e);return!(n!==null&&n!==Object.prototype&&Object.getPrototypeOf(n)!==null||Symbol.toStringTag in e||Xce(e))},gle=Zu("Date"),_le=Zu("File"),Ele=Zu("Blob"),yle=Zu("FileList"),vle=Zu("URLSearchParams"),[Sle,Tle,ble,wle]=["ReadableStream","Request","Response","Headers"].map(Zu);function MT(e,n){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),ov(e))for(i=0,o=e.length;i<o;i++)n.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(i=0;i<h;i++)m=u[i],n.call(null,e[m],m,e)}}function CB(e,n){n=n.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],n===o.toLowerCase())return o;return null}const f_=mB!==void 0?mB:typeof self<"u"?self:typeof window<"u"?window:Z_,IB=e=>!xT(e)&&e!==f_,Rle=(fD=typeof Uint8Array<"u"&&hD(Uint8Array),e=>fD&&e instanceof fD);var fD;const Cle=Zu("HTMLFormElement"),AB=(e=>{let{hasOwnProperty:n}=e;return(i,o)=>n.call(i,o)})(Object.prototype),Ile=Zu("RegExp"),PB=(e,n)=>{const i=Object.getOwnPropertyDescriptors(e),o={};MT(i,(c,u)=>{let h;(h=n(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},mD="abcdefghijklmnopqrstuvwxyz",OB="0123456789",kB={DIGIT:OB,ALPHA:mD,ALPHA_DIGIT:mD+mD.toUpperCase()+OB},Ale=Zu("AsyncFunction"),NB=(DB=typeof SB=="function",LB=ll(f_.postMessage),DB?SB:LB?(gD="axios@".concat(Math.random()),jI=[],f_.addEventListener("message",e=>{let{source:n,data:i}=e;n===f_&&i===gD&&jI.length&&jI.shift()()},!1),e=>{jI.push(e),f_.postMessage(gD,"*")}):e=>setTimeout(e));var DB,LB,gD,jI;const Ple=TB!==void 0?TB.bind(f_):typeof process<"u"&&process.nextTick||NB;var at={isArray:ov,isArrayBuffer:wB,isBuffer:function(e){return e!==null&&!xT(e)&&e.constructor!==null&&!xT(e.constructor)&&ll(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||ll(e.append)&&((n=MI(e))==="formdata"||n==="object"&&ll(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let n;return n=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&wB(e.buffer),n},isString:mle,isNumber:RB,isBoolean:e=>e===!0||e===!1,isObject:VI,isPlainObject:FI,isReadableStream:Sle,isRequest:Tle,isResponse:ble,isHeaders:wle,isUndefined:xT,isDate:gle,isFile:_le,isBlob:Ele,isRegExp:Ile,isFunction:ll,isStream:e=>VI(e)&&ll(e.pipe),isURLSearchParams:vle,isTypedArray:Rle,isFileList:yle,forEach:MT,merge:function e(){const{caseless:n}=IB(this)&&this||{},i={},o=(c,u)=>{const h=n&&CB(i,u)||u;FI(i[h])&&FI(c)?i[h]=e(i[h],c):FI(c)?i[h]=e({},c):ov(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&MT(arguments[c],o);return i},extend:function(e,n,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return MT(n,(c,u)=>{i&&ll(c)?e[u]=bB(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>Ys(e)?Ys(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,n,i,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,n,i,o)=>{let c,u,h;const m={};if(n=n||{},e==null)return n;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,n)||m[h]||(n[h]=e[h],m[h]=!0);e=i!==!1&&hD(e)}while(e&&(!i||i(e,n))&&e!==Object.prototype);return n},kindOf:MI,kindOfTest:Zu,endsWith:(e,n,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=n.length;const o=e.indexOf(n,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(ov(e))return e;let n=e.length;if(!RB(n))return null;const i=new Array(n);for(;n-- >0;)i[n]=e[n];return i},forEachEntry:(e,n)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;n.call(e,c[0],c[1])}},matchAll:(e,n)=>{let i;const o=[];for(;(i=e.exec(n))!==null;)o.push(i);return o},isHTMLForm:Cle,hasOwnProperty:AB,hasOwnProp:AB,reduceDescriptors:PB,freezeMethods:e=>{PB(e,(n,i)=>{if(ll(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];ll(o)&&(n.enumerable=!1,"writable"in n?n.writable=!1:n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,n)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return ov(e)?o(e):o(String(e).split(n)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n,findKey:CB,global:f_,isContextDefined:IB,ALPHABET:kB,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kB.ALPHA_DIGIT,i="";const{length:o}=n;for(;e--;)i+=n[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&ll(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const n=new Array(10),i=(o,c)=>{if(VI(o)){if(n.indexOf(o)>=0)return;if(!("toJSON"in o)){n[c]=o;const u=ov(o)?[]:{};return MT(o,(h,m)=>{const _=i(h,c+1);!xT(_)&&(u[m]=_)}),n[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:Ale,isThenable:e=>e&&(VI(e)||ll(e))&&ll(e.then)&&ll(e.catch),setImmediate:NB,asap:Ple};function er(e,n,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}at.inherits(er,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:at.toJSONObject(this.config),code:this.code,status:this.status}}});const xB=er.prototype,MB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{MB[e]={value:e}}),Object.defineProperties(er,MB),Object.defineProperty(xB,"isAxiosError",{value:!0}),er.from=(e,n,i,o,c,u)=>{const h=Object.create(xB);return at.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),er.call(h,e.message,n,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function _D(e){return at.isPlainObject(e)||at.isArray(e)}function UB(e){return at.endsWith(e,"[]")?e.slice(0,-2):e}function VB(e,n,i){return e?e.concat(n).map(function(o,c){return o=UB(o),!i&&c?"["+o+"]":o}).join(i?".":""):n}const Ole=at.toFlatObject(at,{},null,function(e){return/^is[A-Z]/.test(e)});function BI(e,n,i){if(!at.isObject(e))throw new TypeError("target must be an object");n=n||new FormData;const o=(i=at.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(A,k){return!at.isUndefined(k[A])})).metaTokens,c=i.visitor||y,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&at.isSpecCompliantForm(n);if(!at.isFunction(c))throw new TypeError("visitor must be a function");function _(A){if(A===null)return"";if(at.isDate(A))return A.toISOString();if(!m&&at.isBlob(A))throw new er("Blob is not supported. Use a Buffer instead.");return at.isArrayBuffer(A)||at.isTypedArray(A)?m&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function y(A,k,W){let U=A;if(A&&!W&&typeof A=="object"){if(at.endsWith(k,"{}"))k=o?k:k.slice(0,-2),A=JSON.stringify(A);else if(at.isArray(A)&&function(V){return at.isArray(V)&&!V.some(_D)}(A)||(at.isFileList(A)||at.endsWith(k,"[]"))&&(U=at.toArray(A)))return k=UB(k),U.forEach(function(V,q){!at.isUndefined(V)&&V!==null&&n.append(h===!0?VB([k],q,u):h===null?k:k+"[]",_(V))}),!1}return!!_D(A)||(n.append(VB(W,k,u),_(A)),!1)}const S=[],R=Object.assign(Ole,{defaultVisitor:y,convertValue:_,isVisitable:_D});if(!at.isObject(e))throw new TypeError("data must be an object");return function A(k,W){if(!at.isUndefined(k)){if(S.indexOf(k)!==-1)throw Error("Circular reference detected in "+W.join("."));S.push(k),at.forEach(k,function(U,V){(!(at.isUndefined(U)||U===null)&&c.call(n,U,at.isString(V)?Ys(V).call(V):V,W,R))===!0&&A(U,W?W.concat(V):[V])}),S.pop()}}(e),n}function FB(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return n[i]})}function ED(e,n){this._pairs=[],e&&BI(e,this,n)}const jB=ED.prototype;function kle(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function BB(e,n,i){if(!n)return e;const o=i&&i.encode||kle;at.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(n,i):at.isURLSearchParams(n)?n.toString():new ED(n,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}jB.append=function(e,n){this._pairs.push([e,n])},jB.toString=function(e){const n=e?function(i){return e.call(this,i,FB)}:FB;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};var WB=class{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){at.forEach(this.handlers,function(n){n!==null&&e(n)})}},zB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},GB={exports:{}},Nle=Mn,Dle=tt,HB=Ze.f;Nle({target:"Object",stat:!0,forced:Object.defineProperty!==HB,sham:!Dle},{defineProperty:HB});var $B=Et.Object,Lle=GB.exports=function(e,n,i){return $B.defineProperty(e,n,i)};$B.defineProperty.sham&&(Lle.sham=!0);var KB=l(GB.exports),xle=TypeError,qB=Ng,Mle=t_,Ule=mt,Vle=ur("species"),YB=Array,Fle=function(e){var n;return qB(e)&&(n=e.constructor,(Mle(n)&&(n===YB||qB(n.prototype))||Ule(n)&&(n=n[Vle])===null)&&(n=void 0)),n===void 0?YB:n},XB=function(e,n){return new(Fle(e))(n===0?0:n)},jle=d,Ble=ui,Wle=ur("species"),JB=function(e){return Ble>=51||!jle(function(){var n=[];return(n.constructor={})[Wle]=function(){return{foo:1}},n[e](Boolean).foo!==1})},zle=Mn,Gle=d,Hle=Ng,$le=mt,Kle=wo,qle=ri,QB=function(e){if(e>9007199254740991)throw xle("Maximum allowed index exceeded");return e},ZB=_I,Yle=XB,Xle=JB,Jle=ui,e5=ur("isConcatSpreadable"),Qle=Jle>=51||!Gle(function(){var e=[];return e[e5]=!1,e.concat()[0]!==e}),Zle=function(e){if(!$le(e))return!1;var n=e[e5];return n!==void 0?!!n:Hle(e)};zle({target:"Array",proto:!0,forced:!Qle||!Xle("concat")},{concat:function(e){var n,i,o,c,u,h=Kle(this),m=Yle(h,0),_=0;for(n=-1,o=arguments.length;n<o;n++)if(Zle(u=n===-1?h:arguments[n]))for(c=qle(u),QB(_+c),i=0;i<c;i++,_++)i in u&&ZB(m,_,u[i]);else QB(_+1),ZB(m,_++,u);return m.length=_,m}});var t5={},eue=ee,tue=Te,n5=Fd.f,nue=S1,r5=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t5.f=function(e){return r5&&eue(e)=="Window"?function(n){try{return n5(n)}catch{return nue(r5)}}(e):n5(tue(e))};var av={},rue=ur;av.f=rue;var i5=Et,iue=di,sue=av,oue=Ze.f,ds=function(e){var n=i5.Symbol||(i5.Symbol={});iue(n,e)||oue(n,e,{value:sue.f(e)})},aue=ve,cue=Yt,lue=ur,uue=Hu,s5=function(){var e=cue("Symbol"),n=e&&e.prototype,i=n&&n.valueOf,o=lue("toPrimitive");n&&!n[o]&&uue(n,o,function(c){return aue(i,this)},{})},due=Ne,hue=_n,pue=wo,fue=ri,mue=XB,o5=I([].push),gue=function(e){var n=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,y,S,R){for(var A,k,W=pue(_),U=hue(W),V=due(y,S),q=fue(U),Y=0,ce=R||mue,_e=n?ce(_,q):i||h?ce(_,0):void 0;q>Y;Y++)if((m||Y in U)&&(k=V(A=U[Y],Y,W),e))if(n)_e[Y]=k;else if(k)switch(e){case 3:return!0;case 5:return A;case 6:return Y;case 2:o5(_e,A)}else switch(e){case 4:return!1;case 7:o5(_e,A)}return u?-1:o||c?c:_e}},a5={forEach:gue(0)},WI=Mn,yD=j,vD=ve,_ue=I,cv=tt,lv=oo,Eue=d,fo=di,yue=N,SD=cn,zI=Te,TD=Ma,vue=aa,bD=Qe,UT=Mo,c5=pc,Sue=Fd,l5=t5,Tue=hc,u5=Ge,d5=Ze,bue=qE,h5=Be,p5=Hu,wue=vy,wD=La,f5=dc,m5=Nd,Rue=ur,Cue=av,Iue=ds,Aue=s5,Pue=$u,g5=Gu,GI=a5.forEach,Tc=Lg("hidden"),HI="Symbol",VT="prototype",Oue=g5.set,_5=g5.getterFor(HI),ed=Object[VT],m_=yD.Symbol,$I=m_&&m_[VT],kue=yD.TypeError,RD=yD.QObject,E5=u5.f,g_=d5.f,y5=l5.f,Nue=h5.f,v5=_ue([].push),Lp=wD("symbols"),FT=wD("op-symbols"),Due=wD("wks"),CD=!RD||!RD[VT]||!RD[VT].findChild,ID=cv&&Eue(function(){return UT(g_({},"a",{get:function(){return g_(this,"a",{value:7}).a}})).a!=7})?function(e,n,i){var o=E5(ed,n);o&&delete ed[n],g_(e,n,i),o&&e!==ed&&g_(ed,n,o)}:g_,AD=function(e,n){var i=Lp[e]=UT($I);return Oue(i,{type:HI,tag:e,description:n}),cv||(i.description=n),i},KI=function(e,n,i){e===ed&&KI(FT,n,i),SD(e);var o=TD(n);return SD(i),fo(Lp,o)?(i.enumerable?(fo(e,Tc)&&e[Tc][o]&&(e[Tc][o]=!1),i=UT(i,{enumerable:bD(0,!1)})):(fo(e,Tc)||g_(e,Tc,bD(1,{})),e[Tc][o]=!0),ID(e,o,i)):g_(e,o,i)},PD=function(e,n){SD(e);var i=zI(n),o=c5(i).concat(w5(i));return GI(o,function(c){cv&&!vD(S5,i,c)||KI(e,c,i[c])}),e},S5=function(e){var n=TD(e),i=vD(Nue,this,n);return!(this===ed&&fo(Lp,n)&&!fo(FT,n))&&(!(i||!fo(this,n)||!fo(Lp,n)||fo(this,Tc)&&this[Tc][n])||i)},T5=function(e,n){var i=zI(e),o=TD(n);if(i!==ed||!fo(Lp,o)||fo(FT,o)){var c=E5(i,o);return!c||!fo(Lp,o)||fo(i,Tc)&&i[Tc][o]||(c.enumerable=!0),c}},b5=function(e){var n=y5(zI(e)),i=[];return GI(n,function(o){fo(Lp,o)||fo(f5,o)||v5(i,o)}),i},w5=function(e){var n=e===ed,i=y5(n?FT:zI(e)),o=[];return GI(i,function(c){!fo(Lp,c)||n&&!fo(ed,c)||v5(o,Lp[c])}),o};lv||(m_=function(){if(yue($I,this))throw kue("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?vue(arguments[0]):void 0,n=m5(e),i=function(o){this===ed&&vD(i,FT,o),fo(this,Tc)&&fo(this[Tc],n)&&(this[Tc][n]=!1),ID(this,n,bD(1,o))};return cv&&CD&&ID(ed,n,{configurable:!0,set:i}),AD(n,e)},p5($I=m_[VT],"toString",function(){return _5(this).tag}),p5(m_,"withoutSetter",function(e){return AD(m5(e),e)}),h5.f=S5,d5.f=KI,bue.f=PD,u5.f=T5,Sue.f=l5.f=b5,Tue.f=w5,Cue.f=function(e){return AD(Rue(e),e)},cv&&wue($I,"description",{configurable:!0,get:function(){return _5(this).description}})),WI({global:!0,wrap:!0,forced:!lv,sham:!lv},{Symbol:m_}),GI(c5(Due),function(e){Iue(e)}),WI({target:HI,stat:!0,forced:!lv},{useSetter:function(){CD=!0},useSimple:function(){CD=!1}}),WI({target:"Object",stat:!0,forced:!lv,sham:!cv},{create:function(e,n){return n===void 0?UT(e):PD(UT(e),n)},defineProperty:KI,defineProperties:PD,getOwnPropertyDescriptor:T5}),WI({target:"Object",stat:!0,forced:!lv},{getOwnPropertyNames:b5}),Aue(),Pue(m_,HI),f5[Tc]=!0;var R5=oo&&!!Symbol.for&&!!Symbol.keyFor,Lue=Mn,xue=Yt,Mue=di,Uue=aa,C5=La,Vue=R5,OD=C5("string-to-symbol-registry"),Fue=C5("symbol-to-string-registry");Lue({target:"Symbol",stat:!0,forced:!Vue},{for:function(e){var n=Uue(e);if(Mue(OD,n))return OD[n];var i=xue("Symbol")(n);return OD[n]=i,Fue[i]=n,i}});var jue=Mn,Bue=di,Wue=Qc,zue=rc,Gue=R5,I5=La("symbol-to-string-registry");jue({target:"Symbol",stat:!0,forced:!Gue},{keyFor:function(e){if(!Wue(e))throw TypeError(zue(e)+" is not a symbol");if(Bue(I5,e))return I5[e]}});var A5=Ng,Hue=Me,P5=ee,$ue=aa,O5=I([].push),Kue=Mn,k5=Yt,N5=Q,que=ve,jT=I,D5=d,L5=Me,x5=Qc,M5=cs,Yue=function(e){if(Hue(e))return e;if(A5(e)){for(var n=e.length,i=[],o=0;o<n;o++){var c=e[o];typeof c=="string"?O5(i,c):typeof c!="number"&&P5(c)!="Number"&&P5(c)!="String"||O5(i,$ue(c))}var u=i.length,h=!0;return function(m,_){if(h)return h=!1,_;if(A5(this))return _;for(var y=0;y<u;y++)if(i[y]===m)return _}}},Xue=oo,Jue=String,_m=k5("JSON","stringify"),qI=jT(/./.exec),U5=jT("".charAt),Que=jT("".charCodeAt),Zue=jT("".replace),ede=jT(1 .toString),tde=/[\uD800-\uDFFF]/g,V5=/^[\uD800-\uDBFF]$/,F5=/^[\uDC00-\uDFFF]$/,j5=!Xue||D5(function(){var e=k5("Symbol")();return _m([e])!="[null]"||_m({a:e})!="{}"||_m(Object(e))!="{}"}),B5=D5(function(){return _m("\uDF06\uD834")!=='"\\udf06\\ud834"'||_m("\uDEAD")!=='"\\udead"'}),nde=function(e,n){var i=M5(arguments),o=Yue(n);if(L5(o)||e!==void 0&&!x5(e))return i[1]=function(c,u){if(L5(o)&&(u=que(o,this,Jue(c),u)),!x5(u))return u},N5(_m,null,i)},rde=function(e,n,i){var o=U5(i,n-1),c=U5(i,n+1);return qI(V5,e)&&!qI(F5,c)||qI(F5,e)&&!qI(V5,o)?"\\u"+ede(Que(e,0),16):e};_m&&Kue({target:"JSON",stat:!0,forced:j5||B5},{stringify:function(e,n,i){var o=M5(arguments),c=N5(j5?nde:_m,null,o);return B5&&typeof c=="string"?Zue(c,tde,rde):c}});var W5=hc,ide=wo;Mn({target:"Object",stat:!0,forced:!oo||d(function(){W5.f(1)})},{getOwnPropertySymbols:function(e){var n=W5.f;return n?n(ide(e)):[]}}),ds("asyncIterator"),ds("hasInstance"),ds("isConcatSpreadable"),ds("iterator"),ds("match"),ds("matchAll"),ds("replace"),ds("search"),ds("species"),ds("split");var sde=s5;ds("toPrimitive"),sde();var ode=Yt,ade=$u;ds("toStringTag"),ade(ode("Symbol"),"Symbol"),ds("unscopables"),$u(j.JSON,"JSON",!0);var cde=Et.Symbol,lde=ur,ude=Ze.f,z5=lde("metadata"),G5=Function.prototype;G5[z5]===void 0&&ude(G5,z5,{value:null}),ds("dispose"),ds("metadata");var dde=cde;ds("asyncDispose");var hde=I,kD=Yt("Symbol"),pde=kD.keyFor,fde=hde(kD.prototype.valueOf),H5=kD.isRegisteredSymbol||function(e){try{return pde(fde(e))!==void 0}catch{return!1}};Mn({target:"Symbol",stat:!0},{isRegisteredSymbol:H5});for(var mde=La,$5=Yt,gde=I,_de=Qc,Ede=ur,YI=$5("Symbol"),K5=YI.isWellKnownSymbol,q5=$5("Object","getOwnPropertyNames"),yde=gde(YI.prototype.valueOf),Y5=mde("wks"),ND=0,X5=q5(YI),vde=X5.length;ND<vde;ND++)try{var J5=X5[ND];_de(YI[J5])&&Ede(J5)}catch{}var Q5=function(e){if(K5&&K5(e))return!0;try{for(var n=yde(e),i=0,o=q5(Y5),c=o.length;i<c;i++)if(Y5[o[i]]==n)return!0}catch{}return!1};Mn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Q5}),ds("matcher"),ds("observable"),Mn({target:"Symbol",stat:!0},{isRegistered:H5}),Mn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Q5}),ds("metadataKey"),ds("patternMatch"),ds("replaceAll");var uv=l(dde),Z5=l(av.f("iterator"));function BT(e){return BT=typeof uv=="function"&&typeof Z5=="symbol"?function(n){return typeof n}:function(n){return n&&typeof uv=="function"&&n.constructor===uv&&n!==uv.prototype?"symbol":typeof n},BT(e)}var Sde=l(av.f("toPrimitive"));function Tde(e){var n=function(i,o){if(BT(i)!=="object"||i===null)return i;var c=i[Sde];if(c!==void 0){var u=c.call(i,o);if(BT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return BT(n)==="symbol"?n:String(n)}function $(e,n,i){return(n=Tde(n))in e?KB(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}var e6=l(nae),bde={isBrowser:!0,classes:{URLSearchParams:e6!==void 0?e6:ED,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const DD=typeof window<"u"&&typeof document<"u",LD=typeof navigator=="object"&&navigator||void 0,wde=DD&&(!LD||["ReactNative","NativeScript","NS"].indexOf(LD.product)<0),Rde=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Cde=DD&&window.location.href||"http://localhost";function t6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function n6(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?t6(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var ma=n6(n6({},Object.freeze({__proto__:null,hasBrowserEnv:DD,hasStandardBrowserEnv:wde,hasStandardBrowserWebWorkerEnv:Rde,navigator:LD,origin:Cde})),bde),Ide=cn,Ade=ve,Pde=di,Ode=N,kde=function(){var e=Ide(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},r6=RegExp.prototype,i6=function(e){var n=e.flags;return n!==void 0||"flags"in r6||Pde(e,"flags")||!Ode(r6,e)?n:Ade(kde,e)},Nde=g1.charAt,s6=ve,Dde=cn,Lde=Me,xde=ee,Mde=/./.exec,Ude=TypeError,Vde=Mn,o6=ve,a6=ae,Fde=hy,XI=_y,c6=Xt,l6=xt,WT=aa,jde=cn,Bde=Vt,Wde=ee,zde=JR,u6=i6,Gde=ic,Hde=d,$de=ji,Kde=function(e,n,i){return n+(i?Nde(e,n).length:1)},qde=function(e,n){var i=e.exec;if(Lde(i)){var o=s6(i,e,n);return o!==null&&Dde(o),o}if(xde(e)==="RegExp")return s6(Mde,e,n);throw Ude("RegExp#exec called on incompatible receiver")},d6=Gu,Yde=ur("matchAll"),h6="RegExp String",p6=h6+" Iterator",Xde=d6.set,Jde=d6.getterFor(p6),Qde=TypeError,xD=a6("".indexOf),JI=a6("".matchAll),MD=!!JI&&!Hde(function(){JI("a",/./)}),Zde=Fde(function(e,n,i,o){Xde(this,{type:p6,regexp:e,string:n,global:i,unicode:o,done:!1})},h6,function(){var e=Jde(this);if(e.done)return XI(void 0,!0);var n=e.regexp,i=e.string,o=qde(n,i);return o===null?(e.done=!0,XI(void 0,!0)):e.global?(WT(o[0])===""&&(n.lastIndex=Kde(i,l6(n.lastIndex),e.unicode)),XI(o,!1)):(e.done=!0,XI(o,!1))}),f6=function(e){var n,i,o,c=jde(this),u=WT(e),h=$de(c,RegExp),m=WT(u6(c));return n=new h(h===RegExp?c.source:c,m),i=!!~xD(m,"g"),o=!!~xD(m,"u"),n.lastIndex=l6(c.lastIndex),new Zde(n,u,i,o)};Vde({target:"String",proto:!0,forced:MD},{matchAll:function(e){var n,i,o,c,u=c6(this);if(Bde(e)){if(MD)return JI(u,e)}else{if(zde(e)&&(n=WT(c6(u6(e))),!~xD(n,"g")))throw Qde("`.matchAll` does not allow non-global regexes");if(MD)return JI(u,e);if((o=Gde(e,Yde))===void 0&&Wde(e)=="RegExp"&&(o=f6),o)return o6(o,e,u)}return i=WT(u),c=new RegExp(e,"g"),o6(f6,c,i)}});var ehe=Va("String").matchAll,the=N,nhe=ehe,UD=String.prototype,rhe=function(e){var n=e.matchAll;return typeof e=="string"||e===UD||the(UD,e)&&n===UD.matchAll?nhe:n},ihe=l(rhe);function m6(e){function n(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=i.length;return h=!h&&at.isArray(c)?c.length:h,_?(at.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&at.isObject(c[h])||(c[h]=[]),n(i,o,c[h],u)&&at.isArray(c[h])&&(c[h]=function(y){const S={},R=Object.keys(y);let A;const k=R.length;let W;for(A=0;A<k;A++)W=R[A],S[W]=y[W];return S}(c[h])),!m)}if(at.isFormData(e)&&at.isFunction(e.entries)){const i={};return at.forEachEntry(e,(o,c)=>{n(function(u){return ihe(at).call(at,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const VD={transitional:zB,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",o=i.indexOf("application/json")>-1,c=at.isObject(e);if(c&&at.isHTMLForm(e)&&(e=new FormData(e)),at.isFormData(e))return o?JSON.stringify(m6(e)):e;if(at.isArrayBuffer(e)||at.isBuffer(e)||at.isStream(e)||at.isFile(e)||at.isBlob(e)||at.isReadableStream(e))return e;if(at.isArrayBufferView(e))return e.buffer;if(at.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return BI(h,new ma.classes.URLSearchParams,Object.assign({visitor:function(_,y,S,R){return ma.isNode&&at.isBuffer(_)?(this.append(y,_.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=at.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return BI(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(n.setContentType("application/json",!1),function(h,m,_){if(at.isString(h))try{return(m||JSON.parse)(h),Ys(at).call(at,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const n=this.transitional||VD.transitional,i=n&&n.forcedJSONParsing,o=this.responseType==="json";if(at.isResponse(e)||at.isReadableStream(e))return e;if(e&&at.isString(e)&&(i&&!this.responseType||o)){const c=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?er.from(u,er.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ma.classes.FormData,Blob:ma.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};at.forEach(["delete","get","head","post","put","patch"],e=>{VD.headers[e]={}});var FD=VD;const she=at.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),g6=Symbol("internals");function zT(e){var n;return e&&Ys(n=String(e)).call(n).toLowerCase()}function QI(e){return e===!1||e==null?e:at.isArray(e)?e.map(QI):String(e)}function jD(e,n,i,o,c){return at.isFunction(o)?o.call(this,n,i):(c&&(n=i),at.isString(n)?at.isString(o)?n.indexOf(o)!==-1:at.isRegExp(o)?o.test(n):void 0:void 0)}class ZI{constructor(n){n&&this.set(n)}set(n,i,o){const c=this;function u(_,y,S){const R=zT(y);if(!R)throw new Error("header name must be a non-empty string");const A=at.findKey(c,R);(!A||c[A]===void 0||S===!0||S===void 0&&c[A]!==!1)&&(c[A||y]=QI(_))}const h=(_,y)=>at.forEach(_,(S,R)=>u(S,R,y));if(at.isPlainObject(n)||n instanceof this.constructor)h(n,i);else if(at.isString(n)&&(n=Ys(n).call(n))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ys(m=n).call(m)))h((_=>{const y={};let S,R,A;return _&&_.split(`
`).forEach(function(k){var W,U;A=k.indexOf(":"),S=Ys(W=k.substring(0,A)).call(W).toLowerCase(),R=Ys(U=k.substring(A+1)).call(U),!S||y[S]&&she[S]||(S==="set-cookie"?y[S]?y[S].push(R):y[S]=[R]:y[S]=y[S]?y[S]+", "+R:R)}),y})(n),i);else if(at.isHeaders(n))for(const[_,y]of n.entries())u(y,_,o);else n!=null&&u(i,n,o);var m;return this}get(n,i){if(n=zT(n)){const o=at.findKey(this,n);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(at.isFunction(i))return i.call(this,c,o);if(at.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,i){if(n=zT(n)){const o=at.findKey(this,n);return!(!o||this[o]===void 0||i&&!jD(0,this[o],o,i))}return!1}delete(n,i){const o=this;let c=!1;function u(h){if(h=zT(h)){const m=at.findKey(o,h);!m||i&&!jD(0,o[m],m,i)||(delete o[m],c=!0)}}return at.isArray(n)?n.forEach(u):u(n),c}clear(n){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];n&&!jD(0,this[u],u,n,!0)||(delete this[u],c=!0)}return c}normalize(n){const i=this,o={};return at.forEach(this,(c,u)=>{var h;const m=at.findKey(o,u);if(m)return i[m]=QI(c),void delete i[u];const _=n?function(y){return Ys(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,A)=>R.toUpperCase()+A)}(u):Ys(h=String(u)).call(h);_!==u&&delete i[u],i[_]=QI(c),o[_]=!0}),this}concat(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(n){const i=Object.create(null);return at.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=n&&at.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(n=>{let[i,o]=n;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n){const i=new this(n);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(n){const i=(this[g6]=this[g6]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=zT(u);i[h]||(function(m,_){const y=at.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+y,{value:function(R,A,k){return this[S].call(this,_,R,A,k)},configurable:!0})})}(o,u),i[h]=!0)}return at.isArray(n)?n.forEach(c):c(n),this}}ZI.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),at.reduceDescriptors(ZI.prototype,(e,n)=>{let{value:i}=e,o=n[0].toUpperCase()+n.slice(1);return{get:()=>i,set(c){this[o]=c}}}),at.freezeMethods(ZI);var td=ZI;function BD(e,n){const i=this||FD,o=n||i,c=td.from(o.headers);let u=o.data;return at.forEach(e,function(h){u=h.call(i,u,c.normalize(),n?n.status:void 0)}),c.normalize(),u}function _6(e){return!(!e||!e.__CANCEL__)}function dv(e,n,i){er.call(this,e??"canceled",er.ERR_CANCELED,n,i),this.name="CanceledError"}function E6(e,n,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?n(new er("Request failed with status code "+i.status,[er.ERR_BAD_REQUEST,er.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}at.inherits(dv,er,{__CANCEL__:!0});const eA=function(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let y,S=0,R=0;return h=h!==void 0?h:1e3,function(A){const k=Date.now(),W=_[R];y||(y=k),m[S]=A,_[S]=k;let U=R,V=0;for(;U!==S;)V+=m[U++],U%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),k-y<h)return;const q=W&&k-W;return q?Math.round(1e3*V/q):void 0}}(50,250);return function(u,h){let m,_,y=0,S=1e3/h;const R=function(A){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,A)};return[function(){const A=Date.now(),k=A-y;for(var W=arguments.length,U=new Array(W),V=0;V<W;V++)U[V]=arguments[V];k>=S?R(U,A):(m=U,_||(_=setTimeout(()=>{_=null,R(m)},S-k)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,y=c(_);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[n?"download":"upload"]:!0})},i)},y6=(e,n)=>{const i=e!=null;return[o=>n[0]({lengthComputable:i,total:e,loaded:o}),n[1]]},v6=e=>function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return at.asap(()=>e(...i))};var ohe=ma.hasStandardBrowserEnv?((e,n)=>i=>(i=new PI(i,ma.origin),e.protocol===i.protocol&&e.host===i.host&&(n||e.port===i.port)))(new PI(ma.origin),ma.navigator&&/(msie|trident)/i.test(ma.navigator.userAgent)):()=>!0,ahe=ma.hasStandardBrowserEnv?{write(e,n,i,o,c,u){const h=[e+"="+encodeURIComponent(n)];at.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),at.isString(o)&&h.push("path="+o),at.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function S6(e,n){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(n)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,n):n}function T6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const b6=e=>e instanceof td?function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?T6(Object(o),!0).forEach(function(c){$(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):T6(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e):e;function __(e,n){n=n||{};const i={};function o(y,S,R,A){return at.isPlainObject(y)&&at.isPlainObject(S)?at.merge.call({caseless:A},y,S):at.isPlainObject(S)?at.merge({},S):at.isArray(S)?S.slice():S}function c(y,S,R,A){return at.isUndefined(S)?at.isUndefined(y)?void 0:o(void 0,y,0,A):o(y,S,0,A)}function u(y,S){if(!at.isUndefined(S))return o(void 0,S)}function h(y,S){return at.isUndefined(S)?at.isUndefined(y)?void 0:o(void 0,y):o(void 0,S)}function m(y,S,R){return R in n?o(y,S):R in e?o(void 0,y):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,S,R)=>c(b6(y),b6(S),0,!0)};return at.forEach(Object.keys(Object.assign({},e,n)),function(y){const S=_[y]||c,R=S(e[y],n[y],y);at.isUndefined(R)&&S!==m||(i[y]=R)}),i}var w6=e=>{const n=__({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=n;if(n.headers=m=td.from(m),n.url=BB(S6(n.baseURL,n.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),at.isFormData(o)){if(ma.hasStandardBrowserEnv||ma.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((i=m.getContentType())!==!1){const[y,...S]=i?i.split(";").map(R=>Ys(R).call(R)).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...S].join("; "))}}if(ma.hasStandardBrowserEnv&&(c&&at.isFunction(c)&&(c=c(n)),c||c!==!1&&ohe(n.url))){const y=u&&h&&ahe.read(h);y&&m.set(u,y)}return n},che=typeof XMLHttpRequest<"u"&&function(e){return new ct(function(n,i){const o=w6(e);let c=o.data;const u=td.from(o.headers).normalize();let h,m,_,y,S,{responseType:R,onUploadProgress:A,onDownloadProgress:k}=o;function W(){y&&y(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function V(){if(!U)return;const Y=td.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());E6(function(ce){n(ce),W()},function(ce){i(ce),W()},{data:R&&R!=="text"&&R!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Y,config:e,request:U}),U=null}U.open(o.method.toUpperCase(),o.url,!0),U.timeout=o.timeout,"onloadend"in U?U.onloadend=V:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(V)},U.onabort=function(){U&&(i(new er("Request aborted",er.ECONNABORTED,e,U)),U=null)},U.onerror=function(){i(new er("Network Error",er.ERR_NETWORK,e,U)),U=null},U.ontimeout=function(){let Y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const ce=o.transitional||zB;o.timeoutErrorMessage&&(Y=o.timeoutErrorMessage),i(new er(Y,ce.clarifyTimeoutError?er.ETIMEDOUT:er.ECONNABORTED,e,U)),U=null},c===void 0&&u.setContentType(null),"setRequestHeader"in U&&at.forEach(u.toJSON(),function(Y,ce){U.setRequestHeader(ce,Y)}),at.isUndefined(o.withCredentials)||(U.withCredentials=!!o.withCredentials),R&&R!=="json"&&(U.responseType=o.responseType),k&&([_,S]=eA(k,!0),U.addEventListener("progress",_)),A&&U.upload&&([m,y]=eA(A),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(h=Y=>{U&&(i(!Y||Y.type?new dv(null,e,U):Y),U.abort(),U=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function(Y){const ce=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return ce&&ce[1]||""}(o.url);q&&ma.protocols.indexOf(q)===-1?i(new er("Unsupported protocol "+q+":",er.ERR_BAD_REQUEST,e)):U.send(c||null)})},lhe=(e,n)=>{const{length:i}=e=e?e.filter(Boolean):[];if(n||i){let o,c=new AbortController;const u=function(y){if(!o){o=!0,m();const S=y instanceof Error?y:this.reason;c.abort(S instanceof er?S:new dv(S instanceof Error?S.message:S))}};let h=n&&setTimeout(()=>{h=null,u(new er("timeout ".concat(n," of ms exceeded"),er.ETIMEDOUT))},n);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>at.asap(m),_}},uhe=g4,dhe=cl;Mn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=dhe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var hhe=cl,phe=Xd;Mn({target:"Promise",stat:!0,forced:!0},{try:function(e){var n=hhe.f(this),i=phe(e);return(i.error?n.reject:n.resolve)(i.value),n.promise}});var WD=l(uhe),R6=av.f("asyncIterator"),fhe=l(R6);function zD(e,n){this.v=e,this.k=n}function GT(e){var n,i;function o(u,h){try{var m=e[u](h),_=m.value,y=_ instanceof zD;WD.resolve(y?_.v:_).then(function(S){if(y){var R=u==="return"?"return":"next";if(!_.k||S.done)return o(R,S);S=e[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?o(n.key,n.arg):i=null}this._invoke=function(u,h){return new WD(function(m,_){var y={key:u,arg:h,resolve:m,reject:_,next:null};i?i=i.next=y:(n=i=y,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function ul(e){return function(){return new GT(e.apply(this,arguments))}}function Rn(e){return new zD(e,0)}function tA(e){var n={},i=!1;function o(c,u){return i=!0,{done:!1,value:new zD(u=new WD(function(h){h(e[c](u))}),1)}}return n[uv!==void 0&&Z5||"@@iterator"]=function(){return this},n.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(n.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(n.return=function(c){return i?(i=!1,c):o("return",c)}),n}GT.prototype[typeof uv=="function"&&fhe||"@@asyncIterator"]=function(){return this},GT.prototype.next=function(e){return this._invoke("next",e)},GT.prototype.throw=function(e){return this._invoke("throw",e)},GT.prototype.return=function(e){return this._invoke("return",e)};var GD=l(R6);function HD(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=GD,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new nA(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function nA(e){function n(i){if(Object(i)!==i)return ct.reject(new TypeError(i+" is not an object."));var o=i.done;return ct.resolve(i.value).then(function(c){return{value:c,done:o}})}return nA=function(i){this.s=i,this.n=i.next},nA.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?ct.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?ct.reject(i):n(o.apply(this.s,arguments))}},new nA(e)}const mhe=function*(e,n){let i=e.byteLength;if(!n||i<n)return void(yield e);let o,c=0;for(;c<i;)o=c+n,yield e.slice(c,o),c=o},ghe=function(){var e=ul(function*(n,i){var o,c=!1,u=!1;try{for(var h,m=HD(_he(n));c=!(h=yield Rn(m.next())).done;c=!1){const _=h.value;yield*tA(HD(mhe(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield Rn(m.return()))}finally{if(u)throw o}}});return function(n,i){return e.apply(this,arguments)}}(),_he=function(){var e=ul(function*(n){if(n[GD])return void(yield*tA(HD(n)));const i=n.getReader();try{for(;;){const{done:o,value:c}=yield Rn(i.read());if(o)break;yield c}}finally{yield Rn(i.cancel())}});return function(n){return e.apply(this,arguments)}}(),C6=(e,n,i,o)=>{const c=ghe(e,n);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:y,value:S}=await c.next();if(y)return m(),void _.close();let R=S.byteLength;if(i){let A=h+=R;i(A)}_.enqueue(new Uint8Array(S))}catch(y){throw m(y),y}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function I6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function A6(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?I6(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):I6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const rA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",P6=rA&&typeof ReadableStream=="function",Ehe=rA&&(typeof TextEncoder=="function"?(O6=new TextEncoder,e=>O6.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var O6;const k6=function(e){try{for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},yhe=P6&&k6(()=>{let e=!1;const n=new Request(ma.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!n}),$D=P6&&k6(()=>at.isReadableStream(new Response("").body)),iA={stream:$D&&(e=>e.body)};var N6;rA&&(N6=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!iA[e]&&(iA[e]=at.isFunction(N6[e])?n=>n[e]():(n,i)=>{throw new er("Response type '".concat(e,"' is not supported"),er.ERR_NOT_SUPPORT,i)})}));const vhe=async(e,n)=>{const i=at.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:at.isBlob(o)?o.size:at.isSpecCompliantForm(o)?(await new Request(ma.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:at.isArrayBufferView(o)||at.isArrayBuffer(o)?o.byteLength:(at.isURLSearchParams(o)&&(o+=""),at.isString(o)?(await Ehe(o)).byteLength:void 0))(n)};var She=rA&&(async e=>{let{url:n,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:y,headers:S,withCredentials:R="same-origin",fetchOptions:A}=w6(e);y=y?(y+"").toLowerCase():"text";let k,W=lhe([c,u&&u.toAbortSignal()],h);const U=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let V;try{if(_&&yhe&&i!=="get"&&i!=="head"&&(V=await vhe(S,o))!==0){let ye,fe=new Request(n,{method:"POST",body:o,duplex:"half"});if(at.isFormData(o)&&(ye=fe.headers.get("content-type"))&&S.setContentType(ye),fe.body){const[ke,qe]=y6(V,eA(v6(_)));o=C6(fe.body,65536,ke,qe)}}at.isString(R)||(R=R?"include":"omit");const q="credentials"in Request.prototype;k=new Request(n,A6(A6({},A),{},{signal:W,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?R:void 0}));let Y=await fetch(k);const ce=$D&&(y==="stream"||y==="response");if($D&&(m||ce&&U)){const ye={};["status","statusText","headers"].forEach(lt=>{ye[lt]=Y[lt]});const fe=at.toFiniteNumber(Y.headers.get("content-length")),[ke,qe]=m&&y6(fe,eA(v6(m),!0))||[];Y=new Response(C6(Y.body,65536,ke,()=>{qe&&qe(),U&&U()}),ye)}y=y||"text";let _e=await iA[at.findKey(iA,y)||"text"](Y,e);return!ce&&U&&U(),await new ct((ye,fe)=>{E6(ye,fe,{data:_e,headers:td.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:k})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new er("Network Error",er.ERR_NETWORK,e,k),{cause:q.cause||q}):er.from(q,q&&q.code,e,k)}});const KD={http:null,xhr:che,fetch:She};at.forEach(KD,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const D6=e=>"- ".concat(e),The=e=>at.isFunction(e)||e===null||e===!1;var L6={getAdapter:e=>{e=at.isArray(e)?e:[e];const{length:n}=e;let i,o;const c={};for(let u=0;u<n;u++){let h;if(i=e[u],o=i,!The(i)&&(o=KD[(h=String(i)).toLowerCase()],o===void 0))throw new er("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new er("There is no suitable adapter to dispatch the request "+(n?u.length>1?`since :
`+u.map(D6).join(`
`):" "+D6(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:KD};function qD(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new dv(null,e)}function x6(e){return qD(e),e.headers=td.from(e.headers),e.data=BD.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),L6.getAdapter(e.adapter||FD.adapter)(e).then(function(n){return qD(e),n.data=BD.call(e,e.transformResponse,n),n.headers=td.from(n.headers),n},function(n){return _6(n)||(qD(e),n&&n.response&&(n.response.data=BD.call(e,e.transformResponse,n.response),n.response.headers=td.from(n.response.headers))),ct.reject(n)})}const M6="1.7.9",sA={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{sA[e]=function(i){return typeof i===e||"a"+(n<1?"n ":" ")+e}});const U6={};sA.transitional=function(e,n,i){function o(c,u){return"[Axios v"+M6+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new er(o(u," has been removed"+(n?" in "+n:"")),er.ERR_DEPRECATED);return n&&!U6[u]&&(U6[u]=!0,console.warn(o(u," has been deprecated since v"+n+" and will be removed in the near future"))),!e||e(c,u,h)}},sA.spelling=function(e){return(n,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var oA={assertOptions:function(e,n,i){if(typeof e!="object")throw new er("options must be an object",er.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=n[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new er("option "+u+" must be "+_,er.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new er("Unknown option "+u,er.ERR_BAD_OPTION)}},validators:sA};const nh=oA.validators;let aA=class{constructor(e){this.defaults=e,this.interceptors={request:new WB,response:new WB}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{}).url=e:n=e||{},n=__(this.defaults,n);const{transitional:i,paramsSerializer:o,headers:c}=n;i!==void 0&&oA.assertOptions(i,{silentJSONParsing:nh.transitional(nh.boolean),forcedJSONParsing:nh.transitional(nh.boolean),clarifyTimeoutError:nh.transitional(nh.boolean)},!1),o!=null&&(at.isFunction(o)?n.paramsSerializer={serialize:o}:oA.assertOptions(o,{encode:nh.function,serialize:nh.function},!0)),oA.assertOptions(n,{baseUrl:nh.spelling("baseURL"),withXsrfToken:nh.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=c&&at.merge(c.common,c[n.method]);c&&at.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),n.headers=td.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(n)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const _=[];let y;this.interceptors.response.forEach(function(k){_.push(k.fulfilled,k.rejected)});let S,R=0;if(!m){const k=[x6.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,_),S=k.length,y=ct.resolve(n);R<S;)y=y.then(k[R++],k[R++]);return y}S=h.length;let A=n;for(R=0;R<S;){const k=h[R++],W=h[R++];try{A=k(A)}catch(U){W.call(this,U);break}}try{y=x6.call(this,A)}catch(k){return ct.reject(k)}for(R=0,S=_.length;R<S;)y=y.then(_[R++],_[R++]);return y}getUri(e){return BB(S6((e=__(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};at.forEach(["delete","get","head","options"],function(e){aA.prototype[e]=function(n,i){return this.request(__(i||{},{method:e,url:n,data:(i||{}).data}))}}),at.forEach(["post","put","patch"],function(e){function n(i){return function(o,c,u){return this.request(__(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}aA.prototype[e]=n(),aA.prototype[e+"Form"]=n(!0)});var cA=aA;class YD{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let i;this.promise=new ct(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new ct(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},n(function(c,u,h){o.reason||(o.reason=new dv(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){this.reason?n(this.reason):this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const n=new AbortController,i=o=>{n.abort(o)};return this.subscribe(i),n.signal.unsubscribe=()=>this.unsubscribe(i),n.signal}static source(){let n;return{token:new YD(function(o){n=o}),cancel:n}}}var bhe=YD;const XD={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(XD).forEach(e=>{let[n,i]=e;XD[i]=n});var whe=XD;const Us=function e(n){const i=new cA(n),o=bB(cA.prototype.request,i);return at.extend(o,cA.prototype,i,{allOwnKeys:!0}),at.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(__(n,c))},o}(FD);Us.Axios=cA,Us.CanceledError=dv,Us.CancelToken=bhe,Us.isCancel=_6,Us.VERSION=M6,Us.toFormData=BI,Us.AxiosError=er,Us.Cancel=Us.CanceledError,Us.all=function(e){return ct.all(e)},Us.spread=function(e){return function(n){return e.apply(null,n)}},Us.isAxiosError=function(e){return at.isObject(e)&&e.isAxiosError===!0},Us.mergeConfig=__,Us.AxiosHeaders=td,Us.formToJSON=e=>m6(at.isHTMLForm(e)?new FormData(e):e),Us.getAdapter=L6.getAdapter,Us.HttpStatusCode=whe,Us.default=Us;var Bo=Us;const Rhe=()=>{};function HT(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Rhe};return e.promise=new ct((n,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,n(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const lA=new Map,uA=new Map,rh=new Map;let Pi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Un=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const V6=new Wce;let nd=V6.getResult(),JD=null;function Cn(e){if(!JD){nd=V6.getResult();const n=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Un.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Un.CHROME;case"Safari":case"Mobile Safari":return Un.SAFARI;case"Edge":return Un.EDGE;case"Firefox":return Un.FIREFOX;case"QQ":case"QQBrowser":return Un.QQ;case"Opera":return Un.OPERA;case"WeChat":return Un.WECHAT;default:return m.browser.name||""}}(nd),i=F6(nd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(nd),c=nd.os.version,u=F6(nd,!1),h=nd.device.type;if(!(n&&i&&o&&c))return{name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};JD={name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return JD}function F6(e){let n,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return n=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?n.split(".")[0]:n}function dA(){return Cn().os}function j6(){const e=Cn();return"".concat(e.os," ").concat(e.osVersion)}function hA(){const e=Cn();return!!(nd.engine.name==="WebKit"&&e.os===Pi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Un.SAFARI||mo()&&e.name!==Un.SAFARI)}function xp(){return Cn().name===Un.CHROME}function hs(){return Cn().name===Un.SAFARI}function B6(){return Cn().name===Un.EDGE}function kr(){return Cn().name===Un.FIREFOX}function mo(){return Cn().os===Pi.IOS}function $T(e){const n=Cn();return!(n.name!==Un.CHROME||!n.osVersion)&&Number(n.version)>=e}function W6(e){const n=Cn();return!(n.name!==Un.CHROME||!n.osVersion)&&Number(n.version)<e}function QD(e,n,i){const o=Cn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=n&&Number(o.version)<=i:Number(o.version)===n)}function ZD(e){const n=Cn();return!(n.name!==Un.EDGE||!n.osVersion)&&Number(n.version)>=e}function z6(e){const n=Cn();return!(n.name!==Un.SAFARI||!n.osVersion)&&Number(n.version)>=e}function G6(e,n,i){const o=Cn();if(o.os!==Pi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e}function H6(e,n,i){const o=Cn();if(o.name!==Un.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e:n?Number(c[0])===e&&Number(c[1])<=n||Number(c[0])<e:Number(c[0])<=e}function eL(e){const n=Cn();return!(n.name!==Un.OPERA||!n.osVersion)&&Number(n.version)>=e}function $6(){const e=Cn();if(e.os!==Pi.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])<14||Number(n[0])===14&&Number(n[1])<=6}function hv(){const e=Cn();if(e.os!==Pi.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15}function tL(){const e=Cn();if(e.os!==Pi.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===16}function K6(){const e=Cn();if(e.os!==Pi.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15&&Number(n[1])>=1}function tu(){return hs()&&navigator.maxTouchPoints>0}function q6(){return Cn().name===Un.WECHAT}function Y6(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function nL(){const e=dA();return function(){const{deviceType:n}=Cn();return n==="mobile"||n==="tablet"}()||e===Pi.ANDROID||e===Pi.IOS||e===Pi.HARMONY_OS}function Mp(){const e=Cn();return e.name!==Un.EDGE&&e.name!==Un.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function pA(){return dA()===Pi.ANDROID}function KT(){const e=Cn();return pA()&&(e.name===Un.CHROME||e.name===Un.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function X6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function pt(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?X6(Object(i),!0).forEach(function(o){Gt(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):X6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Gt(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}let X=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),De=class extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),Gt(this,"code",void 0),Gt(this,"message",void 0),Gt(this,"data",void 0),Gt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Up(e,n){if(typeof e!="boolean")throw new De(X.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function bi(e,n,i){if(!st(i).call(i,e))throw new De(X.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(i)))}function tr(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new De(X.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function rL(e,n){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new De(X.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));e.min!==void 0&&tr(e.min,"".concat(n,".min"),0,1/0),e.max!==void 0&&tr(e.max,"".concat(n,".max"),1,1/0),e.exact!==void 0&&tr(e.exact,"".concat(n,".exact"),1,1/0),e.ideal!==void 0&&tr(e.ideal,"".concat(n,".ideal"),1,1/0)}else tr(e,n,1,1/0)}function Xi(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new De(X.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!J6(e,i,o,c))throw new De(X.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Vp(e,n){if(!Array.isArray(e))throw new De(X.INVALID_PARAMS,"".concat(n," should be an array"))}function Nr(e){return e==null}function J6(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=n&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var qT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(qT||{}),iL=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(iL||{});const Q6=new class{constructor(){Gt(this,"_clientSize",null),Gt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Gt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Gt(this,"getStyle",e=>window.getComputedStyle(e,null)),Gt(this,"checkCssVisibleProperty",e=>{var n;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||st(n=["hidden","collapse"]).call(n,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(_=>{var y;const S=_.split("(")[0];return st(y=["brightness","blur","opacity"]).call(y,S)}).map(_=>{const[y,S]=_.split(/\(|\)/);return[y,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[y,S]=_;switch(y){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),Gt(this,"checkPropertyUpToAllParentNodes",(e,n)=>{let i=!0,o=!0;const c=h=>n(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),Gt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Gt(this,"getSizeAboutClient",e=>{const{width:n,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:n,height:i,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),Gt(this,"checkActualSize",()=>{const{width:e,height:n,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,n,i)}),Gt(this,"elementFromPoint",(e,n)=>document.elementFromPoint?document.elementFromPoint(e,n):null),Gt(this,"checkCoverForAPoint",(e,n,i)=>{const o=this.elementFromPoint(e,n);return o!==null&&o!==i}),Gt(this,"getPointPositionList",()=>{const{width:e,height:n,left:i,top:o}=this._clientSize,c=e/6,u=n/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let y=0;y<5;y++){const S=(i*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,R=(o*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:S,y:R})}return[...h]}),Gt(this,"checkElementCover",e=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,e)).filter(n=>!!n).length>6),Gt(this,"checkSizeIsVisible",(e,n,i)=>(e>50||i/e<=10)&&(n>50||i/n<=10)),Gt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:n,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,y,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(n<0)return!1;if(_=n<u?n:u,i<0)y=0;else{if(!(i<c))return!1;y=i}if(o<0)return!1;S=o<c?o:c;const R=_-m,A=S-y;return this.checkSizeIsVisible(R,A,h)}),Gt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Gt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(qT.COVERED);{const n=this.checkActualSize(),i=this.checkSizeOfPartInClient();return n&&!i?this.returnHiddenResult(qT.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(qT.SIZE)}}return this.returnHiddenResult(qT.STYLE)}return this.returnHiddenResult(iL.UNMOUNTED)}return this.returnHiddenResult(iL.INVALID_HTML_ELEMENT)}),Gt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,n=>n.nodeName.toUpperCase()!=="HTML"?n.parentElement!==null:!!document.documentElement))}};function sL(e){return new TextEncoder().encode(e)}const Z6=function(e,n){const i=new Uint8Array(e.byteLength+n.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(n),e.byteLength),i},oL=async e=>function(n,i){let o="";return new Uint8Array(n).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",sL(e)),16);let Ir=class{constructor(){Gt(this,"_events",{}),Gt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<n.length;u+=1){const h=n[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,n){let i=e.length;for(;i--;)if(e[i].listener===n)return i;return-1}},YT=null;function e8(){if(YT)return YT;if(window.electron)return YT=window.electron;if(!window.require)return null;try{return YT=window.require("electron"),YT}catch{return null}}let fi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Dr=function(e){return e.TRACER="tracer",e}({});function t8(e){return tr(e.timeout,"config.timeout",0,1e5),tr(e.timeoutFactor,"config.timeoutFactor",0,100,!1),tr(e.maxRetryCount,"config.maxRetryConfig",0,1/0),tr(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Che=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Wn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function XT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function n8(e){return Xi(e.turnServerURL,"turnServerURL"),Xi(e.username,"username"),Xi(e.password,"password"),e.udpport&&tr(e.udpport,"udpport",1,99999,!0),e.forceturn&&Up(e.forceturn,"forceturn"),e.security&&Up(e.security,"security"),e.tcpport&&tr(e.tcpport,"tcpport",1,99999,!0),!0}function aL(e){return e.level!==void 0&&bi(e.level,"level",[1,2,3]),e.delay!==void 0&&tr(e.delay,"delay",0,3e3,!0),!0}let fn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ps=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),$a=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),pv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function fs(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(n).length===0?ct.reject(new De(X.UNEXPECTED_ERROR,"can not emit promise")):new ct((u,h)=>{e.emit(n,...o,u,h)})}function sr(e,n){if(e.getListeners(n).length===0)return ct.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return fs(e,n,...o)}function bc(e,n){if(e.getListeners(n).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return JT(e,n,...o)}function JT(e,n){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(n,...u,m=>{i=m},m=>{o=m}),o!==null)throw o;if(i===null)throw new De(X.UNEXPECTED_ERROR,"handler is not sync");return i}const si=new class extends Ir{set networkState(e){this.emit(pv.NETWORK_STATE_CHANGE,e,this._networkState),e===$a.ONLINE?this.emit(pv.ONLINE):e===$a.OFFLINE&&(this.onlineWaiter=new ct(n=>{this.once(pv.ONLINE,()=>{this.onlineWaiter=void 0,n($a.ONLINE)})}),this.emit(pv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===$a.ONLINE}constructor(){super(),Gt(this,"_moduleName","network-indicator"),Gt(this,"_networkState",$a.ONLINE),Gt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=$a.ONLINE}),window.addEventListener("offline",()=>{this.networkState=$a.OFFLINE})}};function fA(e,n){const i=e.indexOf(n);i!==-1&&e.splice(i,1)}function fv(e){const n=[];return e.forEach(i=>{n.indexOf(i)===-1&&n.push(i)}),n}function mA(e){ct!==void 0?ct.resolve().then(e):setTimeout(e,0)}function Lr(e){return JSON.parse(JSON.stringify(e))}function E_(e){try{return Lr(e)}catch{return e}}const r8={};function Em(e,n){r8[n]||(r8[n]=!0,e())}function y_(e){const n=window.atob(e),i=new Uint8Array(new ArrayBuffer(n.length));for(let o=0;o<n.length;o+=1)i[o]=n.charCodeAt(o);return i}function ym(e){let n="";for(let i=0;i<e.length;i+=1)n+=String.fromCharCode(e[i]);return window.btoa(n)}function i8(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>n)i=i.slice(0,n);else if(i.length<n){const o=new Uint8Array(n);o.set(i),i=o}return i}function s8(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=Fa(n).call(n,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return n.forEach(h=>{c.set(h,u),u+=h.length}),c}function ih(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function o8(e){let n=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{n+=typeof i=="string"?ih(i):i.size}),n+138}function Ihe(e){const n=new De(X.TIMEOUT,"timeout");return new ct((i,o)=>{window.setTimeout(()=>o(n),e)})}function Ji(e){return new ct(n=>{window.setTimeout(n,e)})}function or(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(n).concat(i):"".concat(n).concat(i)+or(e-i.length,"")}function v_(){return or(32,"").toUpperCase()}const gA=()=>{},a8=new class{constructor(){Gt(this,"fnMap",new Map)}throttleByKey(e,n,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(n)){const m=this.fnMap.get(n);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const y=this.fnMap.get(n);y&&y.fn(...y.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(n,pt(pt({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:m,args:u,skipFn:o})}}},c8=a8.throttleByKey.bind(a8);function l8(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function cL(e,n){if(!l8(e)||!l8(n)||Array.isArray(e)&&!Array.isArray(n)||!Array.isArray(e)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(e)){const i=[...e];for(let o=0;o<n.length;o++)i[o]=cL(e[o],n[o]);return i}{const i=pt({},e);for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=cL(e[o],n[o]):i[o]=n[o]);return i}}function u8(e,n){let i=[0];if(i=new Array(n).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==n););return i}function lL(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function d8(e){const n="0123456789abcdef";function i(ce){let _e,ye="";for(_e=0;_e<=3;_e++)ye+=n.charAt(ce>>8*_e+4&15)+n.charAt(ce>>8*_e&15);return ye}function o(ce,_e){const ye=(65535&ce)+(65535&_e);return(ce>>16)+(_e>>16)+(ye>>16)<<16|65535&ye}function c(ce,_e,ye,fe,ke,qe){return o(function(lt,ht){return lt<<ht|lt>>>32-ht}(o(o(_e,ce),o(fe,qe)),ke),ye)}function u(ce,_e,ye,fe,ke,qe,lt){return c(_e&ye|~_e&fe,ce,_e,ke,qe,lt)}function h(ce,_e,ye,fe,ke,qe,lt){return c(_e&fe|ye&~fe,ce,_e,ke,qe,lt)}function m(ce,_e,ye,fe,ke,qe,lt){return c(_e^ye^fe,ce,_e,ke,qe,lt)}function _(ce,_e,ye,fe,ke,qe,lt){return c(ye^(_e|~fe),ce,_e,ke,qe,lt)}const y=function(ce){let _e;const ye=1+(ce.length+8>>6),fe=new Array(16*ye);for(_e=0;_e<16*ye;_e++)fe[_e]=0;for(_e=0;_e<ce.length;_e++)fe[_e>>2]|=ce.charCodeAt(_e)<<_e%4*8;return fe[_e>>2]|=128<<_e%4*8,fe[16*ye-2]=8*ce.length,fe}(e);let S,R,A,k,W,U=1732584193,V=-271733879,q=-1732584194,Y=271733878;for(S=0;S<y.length;S+=16)R=U,A=V,k=q,W=Y,U=u(U,V,q,Y,y[S+0],7,-680876936),Y=u(Y,U,V,q,y[S+1],12,-389564586),q=u(q,Y,U,V,y[S+2],17,606105819),V=u(V,q,Y,U,y[S+3],22,-1044525330),U=u(U,V,q,Y,y[S+4],7,-176418897),Y=u(Y,U,V,q,y[S+5],12,1200080426),q=u(q,Y,U,V,y[S+6],17,-1473231341),V=u(V,q,Y,U,y[S+7],22,-45705983),U=u(U,V,q,Y,y[S+8],7,1770035416),Y=u(Y,U,V,q,y[S+9],12,-1958414417),q=u(q,Y,U,V,y[S+10],17,-42063),V=u(V,q,Y,U,y[S+11],22,-1990404162),U=u(U,V,q,Y,y[S+12],7,1804603682),Y=u(Y,U,V,q,y[S+13],12,-40341101),q=u(q,Y,U,V,y[S+14],17,-1502002290),V=u(V,q,Y,U,y[S+15],22,1236535329),U=h(U,V,q,Y,y[S+1],5,-165796510),Y=h(Y,U,V,q,y[S+6],9,-1069501632),q=h(q,Y,U,V,y[S+11],14,643717713),V=h(V,q,Y,U,y[S+0],20,-373897302),U=h(U,V,q,Y,y[S+5],5,-701558691),Y=h(Y,U,V,q,y[S+10],9,38016083),q=h(q,Y,U,V,y[S+15],14,-660478335),V=h(V,q,Y,U,y[S+4],20,-405537848),U=h(U,V,q,Y,y[S+9],5,568446438),Y=h(Y,U,V,q,y[S+14],9,-1019803690),q=h(q,Y,U,V,y[S+3],14,-187363961),V=h(V,q,Y,U,y[S+8],20,1163531501),U=h(U,V,q,Y,y[S+13],5,-1444681467),Y=h(Y,U,V,q,y[S+2],9,-51403784),q=h(q,Y,U,V,y[S+7],14,1735328473),V=h(V,q,Y,U,y[S+12],20,-1926607734),U=m(U,V,q,Y,y[S+5],4,-378558),Y=m(Y,U,V,q,y[S+8],11,-2022574463),q=m(q,Y,U,V,y[S+11],16,1839030562),V=m(V,q,Y,U,y[S+14],23,-35309556),U=m(U,V,q,Y,y[S+1],4,-1530992060),Y=m(Y,U,V,q,y[S+4],11,1272893353),q=m(q,Y,U,V,y[S+7],16,-155497632),V=m(V,q,Y,U,y[S+10],23,-1094730640),U=m(U,V,q,Y,y[S+13],4,681279174),Y=m(Y,U,V,q,y[S+0],11,-358537222),q=m(q,Y,U,V,y[S+3],16,-722521979),V=m(V,q,Y,U,y[S+6],23,76029189),U=m(U,V,q,Y,y[S+9],4,-640364487),Y=m(Y,U,V,q,y[S+12],11,-421815835),q=m(q,Y,U,V,y[S+15],16,530742520),V=m(V,q,Y,U,y[S+2],23,-995338651),U=_(U,V,q,Y,y[S+0],6,-198630844),Y=_(Y,U,V,q,y[S+7],10,1126891415),q=_(q,Y,U,V,y[S+14],15,-1416354905),V=_(V,q,Y,U,y[S+5],21,-57434055),U=_(U,V,q,Y,y[S+12],6,1700485571),Y=_(Y,U,V,q,y[S+3],10,-1894986606),q=_(q,Y,U,V,y[S+10],15,-1051523),V=_(V,q,Y,U,y[S+1],21,-2054922799),U=_(U,V,q,Y,y[S+8],6,1873313359),Y=_(Y,U,V,q,y[S+15],10,-30611744),q=_(q,Y,U,V,y[S+6],15,-1560198380),V=_(V,q,Y,U,y[S+13],21,1309151649),U=_(U,V,q,Y,y[S+4],6,-145523070),Y=_(Y,U,V,q,y[S+11],10,-1120210379),q=_(q,Y,U,V,y[S+2],15,718787259),V=_(V,q,Y,U,y[S+9],21,-343485551),U=o(U,R),V=o(V,A),q=o(q,k),Y=o(Y,W);return i(U)+i(V)+i(q)+i(Y)}let Ahe=1,h8=console,Ts=class{static setLogger(e){h8=e}constructor(e,n){Gt(this,"id",void 0),Gt(this,"lockingPromise",ct.resolve()),Gt(this,"locks",0),Gt(this,"name",""),Gt(this,"lockId",void 0),this.lockId=Ahe++,e&&(this.name=e),n&&(this.id=n),this.logger("created")}logger(e,n){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(n??"");h8.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let n;this.locks+=1,this.logger("locked",e);const i=new ct(c=>{n=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function mv(e,n){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,y=new Array(_),S=0;S<_;S++)y[S]=arguments[S];return await u.apply(this,y)}finally{m()}},c}}const mi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function uL(e,n){const i=Math.floor(n.timeout*Math.pow(n.timeoutFactor,e));return Math.min(n.maxRetryTimeout,i)}function rd(e,n,i,o){const c=Object.assign({},mi,o);let u=c.timeout;const h=async()=>{await function(y){return new ct(S=>{window.setTimeout(S,y)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new ct(async(y,S)=>{n=n||(()=>!1),i=i||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new De(X.OPERATION_ABORTED));try{const A=await e();if(!n(A,R)||R+1===c.maxRetryCount)return y(A);await h()}catch(A){if(!i(A,R)||R+1===c.maxRetryCount)return S(A);await h()}}});return _.cancel=()=>m=!0,_}let _A,p8=class{constructor(e){Gt(this,"input",[]),Gt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Fa(e=this.input).call(e,(n,i)=>n+i)/this.input.length}},EA=0,dL=0;function hL(e,n,i,o){return new ct((c,u)=>{n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),EA+=ih(n.data)):i&&(n.data.size?EA+=n.data.size:n.data instanceof FormData?EA+=o8(n.data):EA+=ih(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Bo.request(n).then(h=>{typeof h.data=="string"?dL+=ih(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?dL+=h.data.byteLength:dL+=ih(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Bo.isCancel(h)?u(new De(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new De(X.NETWORK_TIMEOUT,h.message)):h.response?u(new De(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new De(X.NETWORK_ERROR,h.message))})})}async function Phe(e,n){const i=new Blob([n.data],{type:"buffer"});return await hL(e,pt(pt({},n),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const f8=()=>window.isSecureContext!==void 0;function nu(e){if(Array.isArray(e))return e.map(i=>i);if(!m8(e))return e;const n={};for(const i in e){const o=e[i];m8(o)||Array.isArray(o)?n[i]=nu(o):n[i]=o}return n}function m8(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let pL=class{constructor(e){Gt(this,"input",[]),Gt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const sh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},QT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:sh,remoteCandidate:sh},updateInterval:0},g8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},_8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},E8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},y8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let fL=class{constructor(e,n){Gt(this,"onFirstVideoReceived",void 0),Gt(this,"onFirstVideoDecoded",void 0),Gt(this,"onFirstAudioReceived",void 0),Gt(this,"onFirstVideoDecodedTimeout",void 0),Gt(this,"onFirstAudioDecoded",void 0),Gt(this,"onSelectedLocalCandidateChanged",void 0),Gt(this,"onSelectedRemoteCandidateChanged",void 0),Gt(this,"videoIsReady",!1),Gt(this,"videoIsReady2",{}),Gt(this,"pc",void 0),Gt(this,"options",void 0),Gt(this,"intervalTimer",void 0),Gt(this,"stats",nu(QT)),Gt(this,"isFirstVideoReceived",{}),Gt(this,"isFirstVideoDecoded",{}),Gt(this,"isFirstAudioReceived",{}),Gt(this,"isFirstAudioDecoded",{}),Gt(this,"isFirstVideoDecodedTimeout",{}),Gt(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ct(e=>{e({local:pt({},sh),remote:pt({},sh)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of i)e[m].forEach((_,y)=>{if(!this.lossRateWindowStats[n-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const S=this.lossRateWindowStats[n-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,R=this.lossRateWindowStats[n-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Ohe=class extends fL{constructor(){super(...arguments),Gt(this,"_stats",QT),Gt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=nu(QT);const i=n.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=n.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var i;const o=st(i=n.id).call(i,"send");switch("".concat(n.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=nu(_8);c.codec=n.googCodecName,c.adaptionChangeReason="none",n.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(n.googAvgEncodeMs),c.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.firsCount=Number(n.googFirReceived),c.nacksCount=Number(n.googNacksReceived),c.plisCount=Number(n.googPlisReceived),c.frameCount=Number(n.framesEncoded),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=nu(g8),u=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(c.codec=n.googCodecName,c.targetDelayMs=Number(n.googTargetDelayMs),c.renderDelayMs=Number(n.googRenderDelayMs),c.currentDelayMs=Number(n.googCurrentDelayMs),c.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),c.decodeMs=Number(n.googDecodeMs),c.maxDecodeMs=Number(n.googMaxDecodeMs),c.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},c.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},c.decodeFrameRate=Number(n.googFrameRateDecoded),c.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},c.jitterBufferMs=Number(n.googJitterBufferMs),c.firsCount=Number(n.googFirsSent),c.nacksCount=Number(n.googNacksSent),c.plisCount=Number(n.googPlisSent),c.framesDecodeCount=Number(n.framesDecoded),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:pt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=nu(y8);c.codec=n.googCodecName,c.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,c.decodingCNG=Number(n.googDecodingCNG),c.decodingCTN=Number(n.googDecodingCTN),c.decodingCTSG=Number(n.googDecodingCTSG),c.decodingNormal=Number(n.googDecodingNormal),c.decodingPLC=Number(n.googDecodingPLC),c.decodingPLCCNG=Number(n.googDecodingPLCCNG),c.expandRate=Number(n.googExpandRate),c.accelerateRate=Number(n.googAccelerateRate),c.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),c.speechExpandRate=Number(n.googSpeechExpandRate),c.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),c.jitterBufferMs=Number(n.googJitterBufferMs),c.jitterMs=Number(n.googJitterReceived),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),c.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=nu(E8);c.codec=n.googCodecName,c.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,c.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ct((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),n.push(o)}),n}},ZT=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),yA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),mL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),wc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var gv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(gv||{});function eb(e,n,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:gv.kNone;if(!n)return;const u=Number(n[i]);if(typeof u!="number")return;const h=Number(n[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[i]);if(typeof m!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const y=h-_;return y?(u-m)/y*c:void 0}let v8=class extends fL{constructor(){super(...arguments),Gt(this,"_stats",QT),Gt(this,"report",void 0),Gt(this,"lastDecodeVideoReceiverStats",new Map),Gt(this,"lastVideoFramesRecv",new Map),Gt(this,"lastVideoFramesSent",new Map),Gt(this,"lastVideoFramesDecode",new Map),Gt(this,"lastVideoFramesOutput",new Map),Gt(this,"lastVideoJBDelay",new Map),Gt(this,"lastAudioJBDelay",new Map),Gt(this,"mediaBytesSent",new Map),Gt(this,"mediaBytesRetransmit",new Map),Gt(this,"mediaBytesTargetEncode",new Map),Gt(this,"lastDecodeAudioReceiverStats",new Map),Gt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=nu(QT),this.report.forEach(e=>{switch(e.type){case wc.OUTBOUND:case wc.INBOUND:{const n=e.mediaType||e.kind,i=!n&&"frameWidth"in e,o=!n&&!("frameWidth"in e);e.type===wc.OUTBOUND?n==="audio"||o?this.processAudioOutboundStats(e):(n==="video"||i)&&this.processVideoOutboundStats(e):e.type===wc.INBOUND&&(n==="audio"||o?this.processAudioInboundStats(e):(n==="video"||i)&&this.processVideoInboundStats(e));break}case wc.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case wc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:pt({},sh),remote:pt({},sh)};return e.forEach(i=>{let o;if(i.type===wc.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===wc.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(n.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(n.remote,u)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===wc.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===wc.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===wc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(pt({},n),pt({},this.stats.selectedCandidatePair.localCandidate)),e.type===wc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(pt({},n),pt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);n||(n=nu(y8),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived,n.totalProcessingDelay=e.totalProcessingDelay,n.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(n.ssrc);n.avgProcessingDelayMs=eb(i,n,"totalProcessingDelay","jitterBufferEmittedCount",gv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(n.ssrc,pt({},n))}processVideoInboundStats(e){let n=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);n||(n=nu(g8),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration,n.totalProcessingDelay=e.totalProcessingDelay,n.packetsDiscarded=e.packetsDiscarded,n.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,n.totalAssemblyTime=e.totalAssemblyTime,n.keyFramesDecoded=e.keyFramesDecoded,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),c=this.lastVideoFramesOutput.get(n.ssrc),u=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const h=n.decodedFrame?n.decodedFrame.width:0,m=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,h,m),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;n.framesDecodeFreezeTime=h.framesDecodeFreezeTime,n.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=m,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<h.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime,n.avgDecodeMs=eb(i==null?void 0:i.stats,n,"decodeMs","framesDecodeCount")),n.avgProcessingDelayMs=eb(i==null?void 0:i.stats,n,"totalProcessingDelay","framesDecodeCount",gv.kMillisecondsFromSeconds),n.avgFramesAssembledFromMultiplePacketsMs=eb(i==null?void 0:i.stats,n,"totalAssemblyTime","framesAssembledFromMultiplePackets",gv.kMillisecondsFromSeconds),n.avgInterFrameDelayMs=eb(i==null?void 0:i.stats,n,"totalInterFrameDelay","framesDecodeCount",gv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:0}),n.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:Math.max(n.outputFrameRate,0)})):c?n.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:pt({},n),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);n||(n=nu(_8),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new pL(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new pL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new pL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,n.hugeFramesSent=e.hugeFramesSent,n.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const o=this.findRemoteStatsId(e.ssrc,wc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(n||(n=nu(E8),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,wc.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(e,n){var i;const o=Array.from(Sc(i=this.report).call(i)).find(c=>c.type===n&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,n){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,n){const i=this.report.get(e);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,n,i){var o,c,u,h;const m=n?this.report.get(n):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let y=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof S=="number"||(y=0,S=0),R==null){const A=Date.now(),k=this.lastVideoFramesSent.get(i.ssrc);k&&A-k.lts>=800?(R=Math.round((_-k.count)/((A-k.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:A,rate:R})):k?R=k.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:A,rate:0})}i.sentFrame={width:y,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,n,i){var o,c,u,h,m;const _=n?this.report.get(n):void 0,y=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,A=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,k=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){const W=this.lastVideoFramesRecv.get(i.ssrc),U=Date.now();i.framesReceivedCount=y;let V=0;W&&U-W.lts>=800?(V=Math.round((y-W.count)/((U-W.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:V})):W?V=W.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:0}),i.receivedFrame={width:S||0,height:R||0,frameRate:V||0},i.decodedFrame={width:S||0,height:R||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:R||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(A&&k){const W=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=W.jitterBufferMs;const V=k-W.jitterBufferEmittedCount;V>0&&(U=1e3*(A-W.jitterBufferDelay)/V),i.jitterBufferMs=U,i.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:k,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,n,i){var o,c,u,h;const m=n?this.report.get(n):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,y=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,n,i){var o,c,u,h,m,_,y;const S=n?this.report.get(n):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,A=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,W=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,U=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,V=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,q=(y=S==null?void 0:S.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples;if(typeof A=="number"&&(i.totalSamplesReceived=A),R&&A&&(i.accelerateRate=R/A),k&&W){const ce=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _e=ce.jitterBufferMs;const ye=W-ce.jitterBufferEmittedCount;ye>0&&(_e=1e3*(k-ce.jitterBufferDelay)/ye),i.jitterBufferMs=Math.round(_e),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:W,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=U;let Y=1920;V&&A&&(Y=A/V/50,i.receivedFrames=Math.round(A/Y)),q&&(i.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(e,n){const i=this.report.get(e);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime),i.jitter&&(n.jitterMs=1e3*i.jitter),i.timestamp&&(n.timestamp=i.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,n=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{n=n===null?c.diffMean():n+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},khe=class extends fL{updateStats(){return ct.resolve()}};function gL(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Ohe(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new v8(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof ct||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new v8(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new khe(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const S8="websdk_ng_install_id";function _L(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let e=window.localStorage.getItem(S8);return e||(e=v_(),window.localStorage.setItem(S8,e)),Jn("INSTALL_ID",e),e}catch{return}}const dl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],o=n[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),EL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let S_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const ms=function(){const e="us".concat("erna","me"),n="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[n]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ms;const vA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},yL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},vL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",SL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},pr=pt(pt(pt({},SL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:yL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},vA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Jn(e,n,i){var o,c,u;st(o=Object.keys(pr)).call(o,e)&&(!i&&st(c=Object.keys(id)).call(c,e)||(pr[e]=n,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||n!==!0||(pr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(pr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&n&&(u=!!n,pr.USE_NEW_NETWORK_CONFIG=u,u&&(pr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],pr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],pr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],pr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],pr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",pr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",pr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&n&&(pr.ENABLE_INSTANT_VIDEO=!0,pr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&n&&(pr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&n&&(pr.NEW_TURN_MODE||(pr.NEW_TURN_MODE=4))))}function re(e){return pr[e]}EL||(pr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],pr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],pr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],pr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],pr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],pr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],pr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",pr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",pr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",pr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",pr.AREAS=["NORTH_AMERICA","OVERSEA"]);let T8=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const id={};var mn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(mn||{});let SA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const b8=128,Nhe=96,w8=1e3,_v=10;let Dhe=0;var R8=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>lt,Printer:()=>Qr,parse:()=>rt,print:()=>vt});const h=`
`,m="".concat("\r").concat(h),_=" ";let y;function S(We){return We>="0"&&We<="9"}function R(We){return We>="!"&&We<="~"}function A(We){return R(We)||We>=""&&We<=""}function k(We){return We==="!"||We>="#"&&We<="'"||We>="*"&&We<="+"||We>="-"&&We<="."||We>="0"&&We<="9"||We>="A"&&We<="Z"||We>="^"&&We<="~"}function W(We){return We>="1"&&We<="9"}function U(We){return We>="A"&&We<="Z"||We>="a"&&We<="z"}function V(We){return We==="d"||We==="h"||We==="m"||We==="s"}function q(We){return We>""&&We<"	"||We>"\v"&&We<"\f"||We>""&&We<""}function Y(We){return U(We)||S(We)||We==="+"||We==="/"}function ce(We){return S(We)||U(We)||We==="+"||We==="/"||We==="-"||We==="_"}function _e(We){return U(We)||S(We)||We==="+"||We==="/"}function ye(We,x){var ie=Object.keys(We);if(Object.getOwnPropertySymbols){var ue=Object.getOwnPropertySymbols(We);x&&(ue=ue.filter(function(Xe){return Object.getOwnPropertyDescriptor(We,Xe).enumerable})),ie.push.apply(ie,ue)}return ie}function fe(We){for(var x=1;x<arguments.length;x++){var ie=arguments[x]!=null?arguments[x]:{};x%2?ye(Object(ie),!0).forEach(function(ue){ke(We,ue,ie[ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(We,Object.getOwnPropertyDescriptors(ie)):ye(Object(ie)).forEach(function(ue){Object.defineProperty(We,ue,Object.getOwnPropertyDescriptor(ie,ue))})}return We}function ke(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}(function(We){We.VERSION="v",We.ORIGIN="o",We.SESSION_NAME="s",We.INFORMATION="i",We.URI="u",We.EMAIL="e",We.PHONE="p",We.CONNECTION="c",We.BANDWIDTH="b",We.TIME="t",We.REPEAT="r",We.ZONE_ADJUSTMENTS="z",We.KEY="k",We.ATTRIBUTE="a",We.MEDIA="m"})(y||(y={}));class qe{consumeText(x,ie){let ue=ie;for(;ue<x.length;){const Xe=x[ue];if(Xe==="\0"||Xe==="\r"||Xe===h)break;ue+=1}if(ue-ie==0)throw new Error("Invalid text, at ".concat(x));return ue}consumeUnicastAddress(x,ie,ue){return this.consumeTill(x,ie,_)}consumeOneOrMore(x,ie,ue){let Xe=ie;for(;ue(x[Xe]);)Xe++;if(Xe-ie==0)throw new Error("Invalid rule at ".concat(ie,"."));return Xe}consumeSpace(x,ie){if(x[ie]===_)return ie+1;throw new Error("Invalid space at ".concat(ie,"."))}consumeIP4Address(x,ie){let ue=ie;for(let Xe=0;Xe<4;Xe++)if(ue=this.consumeDecimalUChar(x,ue),Xe!==3){if(x[ue]!==".")throw new Error("Invalid IP4 address.");ue++}return ue}consumeDecimalUChar(x,ie){let ue=ie;for(let $t=0;$t<3&&S(x[ue]);$t++,ue++);if(ue-ie==0)throw new Error("Invalid decimal uchar.");const Xe=parseInt(x.slice(ie,ue));if(Xe>=0&&Xe<=255)return ue;throw new Error("Invalid decimal uchar")}consumeIP6Address(x,ie){let ue=this.consumeHexpart(x,ie);return x[ue]===":"&&(ue+=1,ue=this.consumeIP4Address(x,ue)),ue}consumeHexpart(x,ie){let ue=ie;if(x[ue]===":"&&x[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(x,ue)}catch{}return ue}if(ue=this.consumeHexseq(x,ue),x[ue]===":"&&x[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(x,ue)}catch{}return ue}return ue}consumeHexseq(x,ie){let ue=ie;for(;ue=this.consumeHex4(x,ue),x[ue]===":"&&x[ue+1]!==":";)ue+=1;return ue}consumeHex4(x,ie){let ue=0;for(;ue<4;ue++)if(!((Xe=x[ie+ue])>="0"&&Xe<="9"||Xe>="a"&&Xe<="f"||Xe>="A"&&Xe<="F")){if(ue===0)throw new Error("Invalid hex 4");break}var Xe;return ie+ue}consumeFQDN(x,ie){let ue=ie;for(;S(x[ue])||U(x[ue])||x[ue]==="-"||x[ue]===".";)ue+=1;if(ue-ie<4)throw new Error("Invalid FQDN");return ue}consumeExtnAddr(x,ie){return this.consumeOneOrMore(x,ie,A)}consumeMulticastAddress(x,ie,ue){switch(ue){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(x,ie);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(x,ie);default:try{return this.consumeFQDN(x,ie)}catch{return this.consumeExtnAddr(x,ie)}}}consumeIP6MulticastAddress(x,ie){const ue=this.consumeHexpart(x,ie);return x[ue]==="/"?this.consumeInteger(x,ue+1):ue}consumeIP4MulticastAddress(x,ie){let ue=ie+3;const Xe=x.slice(ie,ue),$t=parseInt(Xe);if($t<224||$t>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let nr=0;nr<3;nr++){if(x[ue]!==".")throw new Error("Invalid IP4 multicast address.");ue+=1,ue=this.consumeDecimalUChar(x,ue)}return x[ue]==="/"&&(ue+=1),ue=this.consumeTTL(x,ue),x[ue]==="/"&&(ue=this.consumeInteger(x,ue)),ue}consumeInteger(x,ie){if(!W(x[ie]))throw new Error("Invalid integer.");for(ie+=1;S(x[ie]);)ie+=1;return ie}consumeTTL(x,ie){if(x[ie]==="0")return ie+1;if(!W(x[ie]))throw new Error("Invalid TTL.");ie+=1;for(let ue=0;ue<2&&S(x[ie]);ue++)ie+=1;return ie}consumeToken(x,ie){return this.consumeOneOrMore(x,ie,k)}consumeTime(x,ie){let ue=ie;if(x[ue]==="0")return ue+1;for(W(x[ue])&&(ue+=1);S(x[ue]);)ue++;if(ue-ie<10)throw new Error("Invalid time");return ue}consumeAddress(x,ie){return this.consumeTill(x,ie,_)}consumeTypedTime(x,ie){let ue=ie;return ue=this.consumeOneOrMore(x,ue,S),V(x[ue])?ue+1:ue}consumeRepeatInterval(x,ie){if(!W(x[ie]))throw new Error("Invalid repeat interval");for(ie+=1;S(x[ie]);)ie+=1;return V(x[ie])&&(ie+=1),ie}consumePort(x,ie){return this.consumeOneOrMore(x,ie,S)}consume(x,ie,ue){for(let Xe=0;Xe<ue.length;Xe++){if(ie+Xe>=x.length)throw new Error("consume exceeding value length");if(x[ie+Xe]!==ue[Xe])throw new Error("consume ".concat(ue," failed at ").concat(Xe))}return ie+ue.length}consumeTill(x,ie,ue){let Xe=ie;for(;Xe<x.length&&(typeof ue!="string"||x[Xe]!==ue)&&(typeof ue!="function"||!ue(x[Xe]));)Xe++;return Xe}}class lt extends qe{constructor(){super(),ke(this,"records",[]),ke(this,"currentLine",0)}parse(x){const ie=this.probeEOL(x);this.records=x.split(ie).filter(H_=>!!Ys(H_).call(H_)).map(this.parseLine),this.currentLine=0;const ue=this.parseVersion(),Xe=this.parseOrigin(),$t=this.parseSessionName(),nr=this.parseInformation(),Ni=this.parseUri(),va=this.parseEmail(),Xp=this.parsePhone(),G_=this.parseConnection(),Ub=this.parseBandWidth(),NP=this.parseTimeFields(),DP=this.parseKey(),yl=this.parseSessionAttribute(),Um=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ue,origin:Xe,sessionName:$t,information:nr,uri:Ni,emails:va,phones:Xp,connection:G_,bandwidths:Ub,timeFields:NP,key:DP,attributes:yl,mediaDescriptions:Um}}getCurrentRecord(){const x=this.records[this.currentLine];if(!x)throw new Error("Record doesn't exit.");return x}probeEOL(x){for(let ie=0;ie<x.length;ie++)if(x[ie]===h)return x[ie-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(x,ie){if(x.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ue=x[0];if(x[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ue,value:x.slice(2),line:ie,cur:0}}parseSessionAttribute(){const x=new yn;for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(ie,Xe=>k(Xe)&&Xe!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,ue.attValue=this.extractOneOrMore(ie,q)),x.parse(ue),this.currentLine++}return x.digest()}parseMediaAttributes(x){const ie=new vn(x);for(;this.currentLine<this.records.length;){const ue=this.getCurrentRecord();if(ue.type!==y.ATTRIBUTE)break;const Xe={attField:this.extractOneOrMore(ue,$t=>k($t)&&$t!==":"),_cur:0};ue.value[ue.cur]===":"&&(ue.cur+=1,Xe.attValue=this.extractOneOrMore(ue,q)),ie.parse(Xe),this.currentLine++}return ie.digest()}parseKey(){const x=this.getCurrentRecord();if(x.type===y.KEY){if(x.value==="prompt"||x.value==="clear:"||x.value==="base64:"||x.value==="uri:")return x.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const x=this.getCurrentRecord();if(x.type===y.ZONE_ADJUSTMENTS){const ie=[];for(;;)try{const ue=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);let Xe=!1;x.value[x.cur]==="-"&&(Xe=!0,x.cur+=1);const $t=this.extract(x,this.consumeTypedTime);ie.push({time:ue,typedTime:$t,back:Xe})}catch{break}if(ie.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ie}return[]}parseRepeat(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.REPEAT)break;{const ue=this.extract(ie,this.consumeRepeatInterval),Xe=this.parseTypedTime(ie);x.push({repeatInterval:ue,typedTimes:Xe}),this.currentLine++}}return x}parseTypedTime(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeTypedTime))}catch{break}if(ie.length===0)throw new Error("Invalid typed time.");return ie}parseTime(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);const ue=this.extract(x,this.consumeTime);return this.currentLine++,{startTime:ie,stopTime:ue}}parseBandWidth(){const x=[];for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.BANDWIDTH)break;{const ue=this.extractOneOrMore(ie,k);if(ie.value[ie.cur]!==":")throw new Error("Invalid bandwidth field.");ie.cur++;const Xe=this.extractOneOrMore(ie,S);x.push({bwtype:ue,bandwidth:Xe}),this.currentLine++}}return x}parseVersion(){const x=this.getCurrentRecord();if(x.type!==y.VERSION)throw new Error("first sdp record must be version");const ie=x.value.slice(0,this.consumeOneOrMore(x.value,0,S));if(ie.length!==x.value.length)throw new Error('invalid proto version, "v='.concat(x.value,'"'));return this.currentLine++,ie}parseOrigin(){const x=this.getCurrentRecord();if(x.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const ie=this.extractOneOrMore(x,A);this.consumeSpaceForRecord(x);const ue=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Xe=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const $t=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const nr=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Ni=this.extract(x,this.consumeUnicastAddress);return this.currentLine++,{username:ie,sessId:ue,sessVersion:Xe,nettype:$t,addrtype:nr,unicastAddress:Ni}}parseSessionName(){const x=this.getCurrentRecord();if(x.type===y.SESSION_NAME){const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}}parseInformation(){const x=this.getCurrentRecord();if(x.type!==y.INFORMATION)return;const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}parseUri(){const x=this.getCurrentRecord();if(x.type===y.URI)return this.currentLine++,x.value}parseEmail(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.EMAIL)break;x.push(ie.value),this.currentLine++}return x}parsePhone(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.PHONE)break;x.push(ie.value),this.currentLine++}return x}parseConnection(){const x=this.getCurrentRecord();if(x.type===y.CONNECTION){const ie=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const ue=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Xe=this.extract(x,this.consumeAddress);return this.currentLine++,{nettype:ie,addrtype:ue,address:Xe}}}parseMedia(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeToken);this.consumeSpaceForRecord(x);let ue=this.extract(x,this.consumePort);x.value[x.cur]==="/"&&(x.cur+=1,ue+=this.extract(x,this.consumeInteger)),this.consumeSpaceForRecord(x);const Xe=[];for(Xe.push(this.extract(x,this.consumeToken));x.value[x.cur]==="/";)x.cur+=1,Xe.push(this.extract(x,this.consumeToken));if(Xe.length===0)throw new Error("Invalid proto");const $t=this.parseFmt(x);return this.currentLine++,{mediaType:ie,port:ue,protos:Xe,fmts:$t}}parseTimeFields(){const x=[];for(;this.getCurrentRecord().type===y.TIME;){const ie=this.parseTime(),ue=this.parseRepeat(),Xe=this.parseZone();x.push({time:ie,repeats:ue,zones:Xe})}return x}parseMediaDescription(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const ie=this.parseMedia(),ue=this.parseInformation(),Xe=this.parseConnections(),$t=this.parseBandWidth(),nr=this.parseKey(),Ni=this.parseMediaAttributes(ie);x.push({media:ie,information:ue,connections:Xe,bandwidths:$t,key:nr,attributes:Ni})}return x}parseConnections(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)x.push(this.parseConnection());return x}parseFmt(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeToken))}catch{break}if(ie.length===0)throw new Error("Invalid fmts");return ie}extract(x,ie){for(var ue=arguments.length,Xe=new Array(ue>2?ue-2:0),$t=2;$t<ue;$t++)Xe[$t-2]=arguments[$t];const nr=ie.call(this,x.value,x.cur,...Xe),Ni=x.value.slice(x.cur,nr);return x.cur=nr,Ni}extractOneOrMore(x,ie){const ue=this.consumeOneOrMore(x.value,x.cur,ie),Xe=x.value.slice(x.cur,ue);return x.cur=ue,Xe}consumeSpaceForRecord(x){if(x.value[x.cur]!==_)throw new Error("Invalid space at ".concat(x.cur,"."));x.cur+=1}}class ht extends qe{constructor(){super(...arguments),ke(this,"attributes",void 0),ke(this,"digested",!1)}extractOneOrMore(x,ie,ue){const Xe=this.consumeOneOrMore(x.attValue,x._cur,ie),$t=x.attValue.slice(x._cur,Xe),[nr,Ni]=ue||[];if(typeof nr=="number"&&$t.length<nr)throw new Error("error in length, should be more or equal than ".concat(nr," characters."));if(typeof Ni=="number"&&$t.length>Ni)throw new Error("error in length, should be less or equal than ".concat(Ni," characters."));return x._cur=Xe,$t}consumeAttributeSpace(x){if(x.attValue[x._cur]!==_)throw new Error("Invalid space at ".concat(x._cur,"."));x._cur+=1}extract(x,ie){if(!x.attValue)throw new Error("Nothing to extract from attValue.");for(var ue=arguments.length,Xe=new Array(ue>2?ue-2:0),$t=2;$t<ue;$t++)Xe[$t-2]=arguments[$t];const nr=ie.call(this,x.attValue,x._cur,...Xe),Ni=x.attValue.slice(x._cur,nr);return x._cur=nr,Ni}atEnd(x){if(!x.attValue)throw new Error;return x._cur>=x.attValue.length}peekChar(x){if(!x.attValue)throw new Error;return x.attValue[x._cur]}peek(x,ie){if(!x.attValue)throw new Error;for(let ue=0;ue<ie.length;ue++)if(ie[ue]!==x.attValue[x._cur+ue])return!1;return!0}parseIceUfrag(x){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(x,Y,[4,256])}parseIcePwd(x){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(x,Y,[22,256])}parseIceOptions(x){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ie=[];for(;!this.atEnd(x);){ie.push(this.extractOneOrMore(x,Y));try{this.consumeAttributeSpace(x)}catch(ue){if(this.atEnd(x))break;throw ue}}this.attributes.iceOptions=ie}parseFingerprint(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ie,fingerprint:ue})}parseExtmap(x){const ie=this.extractOneOrMore(x,S);let ue;this.peekChar(x)==="/"&&(this.extract(x,this.consume,"/"),ue=this.extract(x,this.consumeToken)),this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeTill,_),$t=fe(fe({entry:parseInt(ie,10)},ue&&{direction:ue}),{},{extensionName:Xe});this.peekChar(x)===_&&(this.consumeAttributeSpace(x),$t.extensionAttributes=this.extract(x,this.consumeTill)),this.attributes.extmaps.push($t)}parseSetup(x){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ie=this.extract(x,this.consumeTill);if(ie!=="active"&&ie!=="passive"&&ie!=="actpass"&&ie!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ie}}class yn extends ht{constructor(){super(...arguments),ke(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"group":this.parseGroup(x);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"fingerprint":this.parseFingerprint(x);break;case"setup":this.parseSetup(x);break;case"tls-id":this.parseTlsId(x);break;case"identity":this.parseIdentity(x);break;case"extmap":this.parseExtmap(x);break;case"msid-semantic":this.parseMsidSemantic(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing session attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(x){const ie=this.extract(x,this.consumeToken),ue=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;)this.consumeAttributeSpace(x),ue.push(this.extract(x,this.consumeToken));this.attributes.groups.push({semantic:ie,identificationTag:ue})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(x){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(x,ce)}parseIdentity(x){const ie=this.extractOneOrMore(x,_e),ue=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeToken);this.extract(x,this.consume,"=");const $t=this.extractOneOrMore(x,nr=>nr!==_&&q(nr));ue.push({name:Xe,value:$t})}this.attributes.identities.push({assertionValue:ie,extensions:ue})}parseMsidSemantic(x){this.peekChar(x)===_&&this.consumeAttributeSpace(x);const ie={semantic:this.extract(x,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(x)}catch{break}if(this.peekChar(x)==="*"){this.extract(x,this.consume,"*"),ie.applyForAll=!0;break}{const ue=this.extract(x,this.consumeTill,_);ie.identifierList.push(ue)}}this.attributes.msidSemantic=ie}}class vn extends ht{constructor(x){super(),ke(this,"attributes",void 0),x.protos.indexOf("RTP")!==-1||x.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"extmap":this.parseExtmap(x);break;case"setup":this.parseSetup(x);break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"candidate":this.parseCandidate(x);break;case"remote-candidate":this.parseRemoteCandidate(x);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(x);break;case"rtpmap":this.parseRtpmap(x);break;case"ptime":this.parsePtime(x);break;case"maxptime":this.parseMaxPtime(x);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(x);break;case"ssrc":this.parseSSRC(x);break;case"fmtp":this.parseFmtp(x);break;case"rtcp-fb":this.parseRtcpFb(x);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(x);break;case"mid":this.parseMid(x);break;case"msid":this.parseMsid(x);break;case"imageattr":this.parseImageAttr(x);break;case"rid":this.parseRid(x);break;case"simulcast":this.parseSimulcast(x);break;case"sctp-port":this.parseSctpPort(x);break;case"max-message-size":this.parseMaxMessageSize(x);break;case"ssrc-group":this.parseSSRCGroup(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing media attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}parseCandidate(x){const ie=this.extractOneOrMore(x,Y,[1,32]);this.consumeAttributeSpace(x);const ue=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const $t=this.extractOneOrMore(x,S,[1,10]);this.consumeAttributeSpace(x);const nr=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const Ni=this.extract(x,this.consumePort);this.consumeAttributeSpace(x),this.extract(x,this.consume,"typ"),this.consumeAttributeSpace(x);const va={foundation:ie,componentId:ue,transport:Xe,priority:$t,connectionAddress:nr,port:Ni,type:this.extract(x,this.consumeToken),extension:{}};for(this.peek(x," raddr")&&(this.extract(x,this.consume," raddr"),this.consumeAttributeSpace(x),va.relAddr=this.extract(x,this.consumeAddress)),this.peek(x," rport")&&(this.extract(x,this.consume," rport"),this.consumeAttributeSpace(x),va.relPort=this.extract(x,this.consumePort));this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Xp=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x),va.extension[Xp]=this.extractOneOrMore(x,R)}this.attributes.candidates.push(va)}parseRemoteCandidate(x){const ie=[];for(;;){const ue=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const $t=this.extract(x,this.consumePort);ie.push({componentId:ue,connectionAddress:Xe,port:$t});try{this.consumeAttributeSpace(x)}catch{break}}this.attributes.remoteCandidatesList.push(ie)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,"/");this.extract(x,this.consume,"/");const Xe={encodingName:ue,clockRate:this.extractOneOrMore(x,S)};this.atEnd(x)||this.peekChar(x)!=="/"||(this.extract(x,this.consume,"/"),Xe.encodingParameters=parseInt(this.extract(x,this.consumeTill),10));const $t=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(ie,10));$t?$t.rtpMap=Xe:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtpMap:Xe,rtcpFeedbacks:[]})}parsePtime(x){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(x,this.consumeTill)}parseMaxPtime(x){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(x,this.consumeTill)}parseDirection(x){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=x.attField}parseSSRC(x){const ie=this.extractOneOrMore(x,S);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,":");let Xe;this.peekChar(x)===":"&&(this.extract(x,this.consume,":"),Xe=this.extract(x,this.consumeTill));const $t=this.attributes.ssrcs.find(nr=>nr.ssrcId===parseInt(ie,10));$t?$t.attributes[ue]=Xe:this.attributes.ssrcs.push({ssrcId:parseInt(ie,10),attributes:{[ue]:Xe}})}parseFmtp(x){const ie=this.extract(x,this.consumeTill,_);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill),Xe={};ue.split(";").forEach(nr=>{let[Ni,va]=nr.split("=");Ni=Ys(Ni).call(Ni);const Xp=typeof va=="string"?Ys(va).call(va):null;typeof Ni=="string"&&Ni.length>0&&(Xe[Ni]=Xp)});const $t=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(ie,10));$t?$t.fmtp={parameters:Xe}:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[],fmtp:{parameters:Xe}})}parseFmtParameters(x){const ie={},ue=this.extract(x,this.consumeTill,"=");x._cur++;const Xe=this.extract(x,this.consumeTill,";");for(ie[ue]=Xe;x.attValue[x._cur]===";";){const $t=this.extract(x,this.consumeTill,"=");x._cur++;const nr=this.extract(x,this.consumeTill,";");ie[$t]=nr}return ie}parseRtcpFb(x){let ie="";ie=this.peekChar(x)==="*"?this.extract(x,this.consume,"*"):this.extract(x,this.consumeTill,_),this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,_);let Xe;if(ue==="trr-int")Xe={type:ue,interval:this.extract(x,this.consumeTill)};else{const $t={type:ue};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),$t.parameter=this.extract(x,this.consumeToken),this.peekChar(x)===_&&($t.additional=this.extract(x,this.consumeTill))),Xe=$t}if(ie==="*")this.attributes.rtcpFeedbackWildcards.push(Xe);else{const $t=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(ie,10));$t?$t.rtcpFeedbacks.push(Xe):this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[Xe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(x){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ie={port:this.extract(x,this.consumePort)};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.netType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.addressType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.address=this.extract(x,this.consumeAddress)),this.attributes.rtcp=ie}parseMsid(x){const ie={id:this.extractOneOrMore(x,k,[1,64])};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.appdata=this.extractOneOrMore(x,k,[1,64])),this.attributes.msids.push(ie)}parseImageAttr(x){this.attributes.imageattr.push(x.attValue)}parseRid(x){const ie=this.extractOneOrMore(x,Xe=>U(Xe)||S(Xe)||Xe==="_"||Xe==="-");this.consumeAttributeSpace(x);const ue={id:ie,direction:this.extract(x,this.consumeToken),params:[]};if(this.peekChar(x)===_){if(this.consumeAttributeSpace(x),this.peek(x,"pt=")){this.extract(x,this.consume,"pt=");const Xe=[];for(;;){const $t=this.extract(x,this.consumeToken);Xe.push($t);try{this.extract(x,this.consume,",")}catch{break}}ue.payloads=Xe,this.peekChar(x)===_&&this.extract(x,this.consume,_)}for(;;){const Xe=this.extract(x,this.consumeToken);switch(Xe){case"depend":{const $t={type:Xe,rids:this.extract(x,this.consume,"=").split(",")};ue.params.push($t);break}default:{const $t={type:Xe};this.peekChar(x)==="="&&(this.extract(x,this.consume,"="),$t.val=this.extract(x,this.consumeTill,";")),ue.params.push($t)}}try{this.extract(x,this.consume,";")}catch{break}}}this.attributes.rids.push(ue)}parseSimulcast(x){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=x.attValue,this.extract(x,this.consumeTill)}parseSctpPort(x){this.attributes.sctpPort=this.extractOneOrMore(x,S,[1,5])}parseMaxMessageSize(x){this.attributes.maxMessageSize=this.extractOneOrMore(x,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(x){this.attributes.mid=this.extract(x,this.consumeToken)}parseSSRCGroup(x){const ie=this.extract(x,this.consumeToken),ue=[];for(;;)try{this.consumeAttributeSpace(x);const Xe=this.extract(x,this.consumeInteger);ue.push(parseInt(Xe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ie,ssrcIds:ue})}}function cr(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}class Qr{constructor(){cr(this,"eol",m)}print(x,ie){let ue="";return ie&&(this.eol=ie),ue+=this.printVersion(x.version),ue+=this.printOrigin(x.origin),ue+=this.printSessionName(x.sessionName),ue+=this.printInformation(x.information),ue+=this.printUri(x.uri),ue+=this.printEmail(x.emails),ue+=this.printPhone(x.phones),ue+=this.printConnection(x.connection),ue+=this.printBandwidth(x.bandwidths),ue+=this.printTimeFields(x.timeFields),ue+=this.printKey(x.key),ue+=this.printSessionAttributes(x.attributes),ue+=this.printMediaDescription(x.mediaDescriptions),ue}printVersion(x){return"v=".concat(x).concat(this.eol)}printOrigin(x){return"o=".concat(x.username," ").concat(x.sessId," ").concat(x.sessVersion," ").concat(x.nettype," ").concat(x.addrtype," ").concat(x.unicastAddress).concat(this.eol)}printSessionName(x){return x?"s=".concat(x).concat(this.eol):""}printInformation(x){return x?"i=".concat(x).concat(this.eol):""}printUri(x){return x?"u=".concat(x).concat(this.eol):""}printEmail(x){let ie="";for(const ue of x)ie+="e=".concat(ue).concat(this.eol);return ie}printPhone(x){let ie="";for(const ue of x)ie+="e=".concat(ue).concat(this.eol);return ie}printConnection(x){return x?"c=".concat(x.nettype," ").concat(x.addrtype," ").concat(x.address).concat(this.eol):""}printBandwidth(x){let ie="";for(const ue of x)ie+="b=".concat(ue.bwtype,":").concat(ue.bandwidth).concat(this.eol);return ie}printTimeFields(x){let ie="";for(const ue of x){ie+="t=".concat(ue.time.startTime," ").concat(ue.time.startTime).concat(this.eol);for(const Xe of ue.repeats)ie+="r=".concat(Xe.repeatInterval," ").concat(Xe.typedTimes.join(" ")).concat(this.eol);ue.zoneAdjustments&&(ie+="z=",ie+="z=".concat(ue.zoneAdjustments.map(Xe=>"".concat(Xe.time," ").concat(Xe.back?"-":""," ").concat(Xe.typedTime)).join(" ")).concat(this.eol),ie+=this.eol)}return ie}printKey(x){return x?"k=".concat(x).concat(this.eol):""}printAttributes(x){let ie="";for(const ue of x)ie+="a=".concat(ue.attField).concat(ue.attValue?":".concat(ue.attValue):"").concat(this.eol);return ie}printMediaDescription(x){let ie="";for(const ue of x)ie+=this.printMedia(ue.media),ie+=this.printInformation(ue.information),ie+=this.printConnections(ue.connections),ie+=this.printBandwidth(ue.bandwidths),ie+=this.printKey(ue.key),ie+=this.printMediaAttributes(ue);return ie}printConnections(x){let ie="";for(const ue of x)ie+=this.printConnection(ue);return ie}printMedia(x){return"m=".concat(x.mediaType," ").concat(x.port," ").concat(x.protos.join("/")," ").concat(x.fmts.join(" ")).concat(this.eol)}printSessionAttributes(x){return new Ko(this.eol).print(x)}printMediaAttributes(x){return new Fe(this.eol).print(x)}}class Br{constructor(x){cr(this,"eol",void 0),this.eol=x}printIceUfrag(x){return x===void 0?"":"a=ice-ufrag:".concat(x).concat(this.eol)}printIcePwd(x){return x===void 0?"":"a=ice-pwd:".concat(x).concat(this.eol)}printIceOptions(x){return x===void 0?"":"a=ice-options:".concat(x.join(_)).concat(this.eol)}printFingerprints(x){return x.length>0?x.map(ie=>"a=fingerprint:".concat(ie.hashFunction).concat(_).concat(ie.fingerprint)).join(this.eol)+this.eol:""}printExtmap(x){return x.map(ie=>"a=extmap:".concat(ie.entry).concat(ie.direction?"/".concat(ie.direction):"").concat(_).concat(ie.extensionName).concat(ie.extensionAttributes?"".concat(_).concat(ie.extensionAttributes):"").concat(this.eol)).join("")}printSetup(x){return x===void 0?"":"a=setup:".concat(x).concat(this.eol)}printUnrecognized(x){return x.map(ie=>"a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol)).join("")}}class Ko extends Br{print(x){let ie="";return ie+=this.printGroups(x.groups),ie+=this.printMsidSemantic(x.msidSemantic),ie+=this.printIceLite(x.iceLite),ie+=this.printIceUfrag(x.iceUfrag),ie+=this.printIcePwd(x.icePwd),ie+=this.printIceOptions(x.iceOptions),ie+=this.printFingerprints(x.fingerprints),ie+=this.printSetup(x.setup),ie+=this.printTlsId(x.tlsId),ie+=this.printIdentity(x.identities),ie+=this.printExtmap(x.extmaps),ie+=this.printUnrecognized(x.unrecognized),ie}printGroups(x){let ie="";return x.length>0&&(ie+=x.map(ue=>"a=group:".concat(ue.semantic).concat(ue.identificationTag.map(Xe=>"".concat(_).concat(Xe)).join("")).concat(this.eol)).join("")),ie}printIceLite(x){return x===void 0?"":"a=ice-lite"+this.eol}printTlsId(x){return x?"a=tls-id:".concat(x).concat(this.eol):""}printIdentity(x){return x.length===0?"":x.map(ie=>"a=identity:".concat(ie.assertionValue).concat(ie.extensions.map(ue=>"".concat(_).concat(ue.name).concat(ue.value?"=".concat(ue.value):"")))).join(this.eol)+this.eol}printMsidSemantic(x){if(!x)return"";let ie="a=msid-semantic:".concat(x.semantic);return x.applyForAll?ie+="".concat(_,"*"):x.identifierList.length>0&&(ie+=x.identifierList.map(ue=>"".concat(_).concat(ue))),ie+this.eol}}class Fe extends Br{print(x){const ie=x.attributes;let ue="";return ue+=this.printRTCP(ie.rtcp),ue+=this.printIceUfrag(ie.iceUfrag),ue+=this.printIcePwd(ie.icePwd),ue+=this.printIceOptions(ie.iceOptions),ue+=this.printCandidates(ie.candidates),ue+=this.printRemoteCandidatesList(ie.remoteCandidatesList),ue+=this.printEndOfCandidates(ie.endOfCandidates),ue+=this.printFingerprints(ie.fingerprints),ue+=this.printSetup(ie.setup),ue+=this.printMid(ie.mid),ue+=this.printExtmap(ie.extmaps),ue+=this.printRTPRelated(ie),ue+=this.printPtime(ie.ptime),ue+=this.printMaxPtime(ie.maxPtime),ue+=this.printDirection(ie.direction),ue+=this.printSSRCGroups(ie.ssrcGroups),ue+=this.printSSRC(ie.ssrcs),ue+=this.printRTCPMux(ie.rtcpMux),ue+=this.printRTCPMuxOnly(ie.rtcpMuxOnly),ue+=this.printRTCPRsize(ie.rtcpRsize),ue+=this.printMSId(ie.msids),ue+=this.printImageattr(ie.imageattr),ue+=this.printRid(ie.rids),ue+=this.printSimulcast(ie.simulcast),ue+=this.printSCTPPort(ie.sctpPort),ue+=this.printMaxMessageSize(ie.maxMessageSize),ue+=this.printUnrecognized(ie.unrecognized),ue}printCandidates(x){return x.map(ie=>"a=candidate:".concat(ie.foundation).concat(_).concat(ie.componentId).concat(_).concat(ie.transport).concat(_).concat(ie.priority).concat(_).concat(ie.connectionAddress).concat(_).concat(ie.port).concat(_,"typ").concat(_).concat(ie.type).concat(ie.relAddr?"".concat(_,"raddr").concat(_).concat(ie.relAddr):"").concat(ie.relPort?"".concat(_,"rport").concat(_).concat(ie.relPort):"").concat(Object.keys(ie.extension).map(ue=>"".concat(_).concat(ue).concat(_).concat(ie.extension[ue])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(x){return x.map(ie=>"a=remote-candidates:".concat(ie.join(_)).concat(this.eol)).join("")}printEndOfCandidates(x){return x===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(x){if(!x.payloads)return"";const ie=x.payloads;let ue="";ue+=x.rtcpFeedbackWildcards.map(Xe=>this.printRTCPFeedback("*",Xe)).join("");for(const Xe of ie)ue+=this.printRtpMap(Xe.payloadType,Xe.rtpMap),ue+=this.printFmtp(Xe.payloadType,Xe.fmtp),ue+=Xe.rtcpFeedbacks.map($t=>this.printRTCPFeedback(Xe.payloadType,$t)).join("");return ue}printFmtp(x,ie){if(!ie)return"";const ue=Object.keys(ie.parameters);return ue.length===1&&ie.parameters[ue[0]]===null?"a=fmtp:".concat(x).concat(_).concat(ue[0]).concat(this.eol):"a=fmtp:".concat(x).concat(_).concat(Object.keys(ie.parameters).map(Xe=>"".concat(Xe,"=").concat(ie.parameters[Xe])).join(";")).concat(this.eol)}printRtpMap(x,ie){return ie?"a=rtpmap:".concat(x).concat(_).concat(ie.encodingName,"/").concat(ie.clockRate).concat(ie.encodingParameters?"/".concat(ie.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(x,ie){let ue="a=rtcp-fb:".concat(x).concat(_),Xe=ie;return Xe.type==="trr-int"?ue+="ttr-int".concat(_).concat(Xe.interval):(ue+="".concat(Xe.type),Xe.parameter&&(ue+="".concat(_).concat(Xe.parameter),Xe.additional&&(ue+="".concat(_).concat(Xe.additional)))),ue+this.eol}printPtime(x){return x===void 0?"":"a=ptime:".concat(x).concat(this.eol)}printMaxPtime(x){return x===void 0?"":"a=maxptime:".concat(x).concat(this.eol)}printDirection(x){return x===void 0?"":"a=".concat(x).concat(this.eol)}printSSRC(x){return x.map(ie=>Object.keys(ie.attributes).map(ue=>"a=ssrc:".concat(ie.ssrcId.toString(10)).concat(_).concat(ue).concat(ie.attributes[ue]?":".concat(ie.attributes[ue]):"").concat(this.eol)).join("")).join("")}printRTCPMux(x){return x===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(x){return x===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(x){return x===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(x){if(x===void 0)return"";let ie="a=rtcp:".concat(x.port);return x.netType&&(ie+="".concat(_).concat(x.netType)),x.addressType&&(ie+="".concat(_).concat(x.addressType)),x.address&&(ie+="".concat(_).concat(x.address)),ie+this.eol}printMSId(x){return x.map(ie=>"a=msid:".concat(ie.id).concat(ie.appdata?"".concat(_).concat(ie.appdata):"").concat(this.eol)).join("")}printImageattr(x){return x.map(ie=>"a=imageattr:".concat(ie).concat(this.eol)).join("")}printRid(x){return x.map(ie=>{let ue="a=rid:".concat(ie.id).concat(_).concat(ie.direction);return ie.payloads&&(ue+="".concat(_,"pt=").concat(ie.payloads.join(","))),ie.params.length>0&&(ue+="".concat(_).concat(ie.params.map(Xe=>Xe.type==="depend"?"depend=".concat(Xe.rids.join(",")):"".concat(Xe.type,"=").concat(Xe.val)).join(";"))),ue+this.eol}).join("")}printSimulcast(x){return x===void 0?"":"a=simulcast:".concat(x).concat(this.eol)}printSCTPPort(x){return x===void 0?"":"a=sctp-port:".concat(x).concat(this.eol)}printMaxMessageSize(x){return x===void 0?"":"a=max-message-size:".concat(x).concat(this.eol)}printMid(x){return x===void 0?"":"a=mid:".concat(x).concat(this.eol)}printSSRCGroups(x){return x.map(ie=>"a=ssrc-group:".concat(ie.semantic).concat(ie.ssrcIds.map(ue=>"".concat(_).concat(ue.toString(10))).join("")).concat(this.eol)).join("")}}function rt(We){return new lt().parse(We)}function vt(We,x){return new Qr().print(We,x)}}},n={};function i(o){if(n[o])return n[o].exports;var c=n[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function ga(e){return R8.parse(e)}function vm(e,n){return R8.print(e,n)}var Lhe=Va("Array").keys,xhe=uc,Mhe=di,Uhe=N,Vhe=Lhe,TL=Array.prototype,Fhe={DOMTokenList:!0,NodeList:!0},jhe=function(e){var n=e.keys;return e===TL||Uhe(TL,e)&&n===TL.keys||Mhe(Fhe,xhe(e))?Vhe:n},Rc=l(jhe);function C8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function rn(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?C8(Object(i),!0).forEach(function(o){xr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):C8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function xr(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const I8=new class extends Ir{constructor(){super(...arguments),xr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:n}=e;n[n.length-1]&&n[n.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=n[n.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Bhe{constructor(n){xr(this,"logger",void 0),xr(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function bL(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function A8(){const e=new Date,n=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return n?(n==null?void 0:n[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const hl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},TA=Date.now(),tb=e=>{for(const n in hl)if(Object.prototype.hasOwnProperty.call(hl,n)&&hl[n]===e)return n;return"DEFAULT"},D=new class{constructor(){xr(this,"proxyServerURL",void 0),xr(this,"logLevel",hl.DEBUG),xr(this,"uploadState","collecting"),xr(this,"uploadLogWaitingList",[]),xr(this,"uploadLogUploadingList",[]),xr(this,"uploadErrorCount",0),xr(this,"currentLogID",0),xr(this,"url",void 0),xr(this,"extLog",(e,n)=>{this.appendLogToWaitingList(e,...n)})}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[hl.DEBUG].concat(n);this.log.apply(this,o)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[hl.INFO].concat(n);this.log.apply(this,o)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[hl.WARNING].concat(n);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[hl.ERROR].concat(n);this.log.apply(this,o)}upload(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[hl.DEBUG].concat(n);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Jn("UPLOAD_LOG",!0)}disableLogUpload(){Jn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Bhe(this).prefix(e)}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-TA<100)return void setTimeout(()=>{this.log(...n)},Date.now()-TA);const o=Math.max(0,Math.min(4,n[0]));if(n[0]=bL()+" Agora-SDK [".concat(tb(o),"]:"),this.appendLogToWaitingList(o,...n),o<this.logLevel)return;const c=bL()+" %cAgora-SDK [".concat(tb(o),"]:");let u=[];if(!re("USE_NEW_LOG"))switch(o){case hl.DEBUG:u=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,u);break;case hl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,u);break;case hl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,u);break;case hl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-TA<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-TA);const o=Math.max(0,Math.min(4,n[0]));n[0]=bL()+" Agora-SDK [".concat(tb(o),"]:"),this.appendLogToWaitingList(o,...n)}appendLogToWaitingList(e){if(!re("UPLOAD_LOG"))return;for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=A8()+" Agora-SDK [".concat(tb(e),"]:"):i[0]=A8()+" Agora-SDK [".concat(tb(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,n={sdk_version:dl,process_id:re("PROCESS_ID"),payload:JSON.stringify(e)};return rd(async()=>{const i=await Bo.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),I8.reportLogUploadError(o),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var P8;function Whe(e){return Xi(e.reportId,"params.reportId",0,100,!1),Xi(e.category,"params.category",0,100,!1),Xi(e.event,"params.event",0,100,!1),Xi(e.label,"params.label",0,100,!1),tr(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(P8={}).FREE="free",P8.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const zhe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Oi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Tr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Ghe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Mt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(n,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||n.__className__||(n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),y=0;y<m;y++)_[y]=arguments[y];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(A){D.warning(A),S=[]}try{JSON.stringify(S)}catch{D.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const R=(e.report||bt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:Dr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const A=c.apply(this,_);return A instanceof ct?A.then(k=>(R.onSuccess(e.reportResult&&k),k)).catch(k=>{throw R.onError(k),k}):(R.onSuccess(e.reportResult&&A),A)}catch(A){throw R.onError(A),A}}}return o}}const bt=new class{constructor(){xr(this,"baseInfoMap",new Map),xr(this,"proxyServer",void 0),xr(this,"eventUploadTimer",void 0),xr(this,"setSessionIdTimer",void 0),xr(this,"url",void 0),xr(this,"sids",new Set),xr(this,"backupUrl",void 0),xr(this,"_appId",void 0),xr(this,"_aid",0),xr(this,"keyEventUploadPendingItems",[]),xr(this,"normalEventUploadPendingItems",[]),xr(this,"apiInvokeUploadPendingItems",[]),xr(this,"apiInvokeCount",0),xr(this,"apiInvokeLoggedCount",0),xr(this,"ltsList",[]),xr(this,"lastSendNormalEventTime",Date.now()),xr(this,"customReportCounterTimer",void 0),xr(this,"customReportCount",0),xr(this,"extApiInvoke",async e=>{for(const n of e){const i=rn(rn({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Dr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,n=>{let[i,o]=n;return i+o}),16)||0}reportApiInvoke(e,n,i){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!re("SHOW_REPORT_INVOKER_LOG"),h=!!re("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&n.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function y(k,W){if(m){let U="[apiInvoke-".concat(_,"]");n.id&&(U+="[".concat(n.id,"]")),n.name&&(U+="[".concat(n.name,"]")),D.info("".concat(U," ").concat(k),k==="start"?n.options:W||"")}}const S=()=>({tag:n.tag,invokeId:c,sid:e,name:n.name,apiInvokeTime:o,options:n.options,states:n.states||null});y("start");let R=!1;Ji(n.timeout).then(()=>{R||(this.sendApiInvoke(rn(rn({},S()),{},{error:X.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const A=new De(X.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:k=>{const W=()=>{if(R)throw A;return R=!0,this.sendApiInvoke(rn(rn({},S()),{},{success:!0},n.reportResult&&{result:k})),y("onSuccess"),k};return i?c8(W,n.name+"Success",i,()=>R=!0):W()},onError:k=>{const W=()=>{if(R)throw k;R=!0,this.sendApiInvoke(rn(rn({},S()),{},{success:!1,error:k})),y("onFailure",k.toString())};return i?c8(W,n.name+"Error",i,()=>R=!0):W()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=n.cname;const c=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:EL?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},n.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientRole:S}=n,R=Date.now(),A=rn(rn({},o),{},{eventType:Oi.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:vL,lts:R,elapse:R-i,extend:JSON.stringify(c),mode:n.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:dl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientType:st(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:S,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var k;this.send({type:Tr.SESSION,data:A},!0)}joinChooseServer(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{role:n.role,eventType:Oi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:n.elapse||c-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:c-i.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3,corssRegionTagReq:n.corssRegionTagReq||void 0,corssRegionTagRes:n.corssRegionTagRes||void 0});this.send({type:Tr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Oi.REQ_USER_ACCOUNT,lts:c,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||c-i.startTime,eventElapse:c-n.lts,extend:JSON.stringify(n.extend)});this.send({type:Tr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;n.vid&&(o.vid=n.vid),o.uid=n.uid,o.cid=n.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=n,y=c-(u&&h?h:i.startTime),S=rn(rn({},o),{},{eventType:Oi.JOIN_GATEWAY,lts:c,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,errorMsg:n.errorMsg||"",elapse:y,eventElapse:c-n.lts,firstSuccess:u,signalChannel:n.signalChannel,preload:n.preload?1:0,installId:_L(),isABTestSuccess:n.isABTestSuccess?1:0}),R=S.success?1:0;if(n.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:Tr.JOIN_GATEWAY,data:S},!0);else{let A;if(m)if(_){const W=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=m.match(/p=[0-9]{1,6}/g);A={isSuccess:R,gatewayIp:W&&W.length?W[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:_?1:0}}else{const W=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=m.match(/(:|p=)[0-9]{1,6}/g);A={isSuccess:R,gatewayIp:W&&W.length?W[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else A={isSuccess:R,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const k=Object.assign({},S,A,{eventType:Oi.REJOIN_GATEWAY});this.send({type:Tr.RE_JOIN_GATEWAY,data:k},!0)}}joinChannelTimeout(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=rn(rn({},i.info),{},{lts:o,timeout:n,elapse:o-i.startTime});this.send({type:Tr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Oi.PUBLISH,lts:c,eventElapse:n.eventElapse,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:Tr.PUBLISH,data:u},!0)}subscribe(e,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=rn(rn({},c),{},{eventType:Oi.SUBSCRIBE,lts:u,eventElapse:n.eventElapse,elapse:u-o.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid,preSsrc:n.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?h.peerSuid=n.peerid:h.peer=n.peerid,this.send({type:Tr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var n;const i=[...Rc(n=this.baseInfoMap).call(n)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn({},u),{},{eventType:Oi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:Tr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h});this.send({type:i,data:m},!0)}abTest(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Oi.AB_TEST,lts:c});this.send({type:Tr.AB_TEST,data:u},!0)}pcStats(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Oi.PC_STATS,lts:c,preallocation:n.preallocation?1:0});this.send({type:Tr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,n){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Oi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Tr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{eventType:n,lts:h});this.send({type:i,data:m},!0)}streamSwitch(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Oi.STREAM_SWITCH,lts:c,isDual:n.isdual,elapse:c-i.startTime,success:n.succ});this.send({type:Tr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Oi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Tr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Oi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Tr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?D.debug("reportProxyServerurl: ".concat(e)):D.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn({},o),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:Tr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const y=ih(JSON.stringify(u));let S=0;const R=[];let A=0;for(let k=0;k<_.length;k++)A+=_.charCodeAt(k)<=127?1:3,A<=m-y||(R[R.length]=pt(pt({},u),{},{[h]:_.substring(S,k)}),S=k,A=_.charCodeAt(k)<=127?1:3);return S!==_.length-1&&(R[R.length]=pt(pt({},u),{},{[h]:_.substring(S)})),R})(rn(rn(rn({},o),n),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Tr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:Tr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),n),{},{elapse:c-i.startTime,lts:c,extend:n.extend||void 0});this.send({type:Tr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=rn(rn(rn({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:Tr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new De(X.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=n.map(c=>({type:Tr.USER_ANALYTICS,data:rn(rn({sid:e},c),{},{lts:i})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw D.error("send custom report message failed",c.toString()),new De(X.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const n=re("NOT_REPORT_EVENT");if(e.tag&&st(n)&&st(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof De){const{code:_,message:y}=e.error;h=_||y||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Tr.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const n=Array.from(this.sids).find(i=>i!==null);n&&e.forEach(i=>{i&&(i.sid=n,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),LT(c=this.ltsList).call(c,(h,m)=>h-m))}return n||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&i.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{re("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),D.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){si.networkState===$a.OFFLINE&&await ct.race([si.onlineWaiter,Ji(2*mi.maxRetryTimeout)]);const n=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=sL(JSON.stringify(h.data)),_=new ArrayBuffer(5),y=(R=>{let A=0;return Object.entries(Tr).forEach(k=>{let[W,U]=k;U===R.type&&(A=Ghe[W])}),A})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&y),S.setUint8(3,y>>>8&255),S.setUint8(4,y>>>16&255),u=Z6(u,new Uint8Array(_)),u=Z6(u,m)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await hL(o,{timeout:1e4,data:n(e),headers:rn(rn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:i,aid:o};si.networkState===$a.OFFLINE&&await ct.race([si.onlineWaiter,Ji(2*mi.maxRetryTimeout)]);const u=n?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u)));try{n?await Phe(h,{timeout:1e4,data:c}):await hL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,n){const i=Object.assign({},zhe);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:n}),i}reportResourceTiming(e,n){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:o,tag:Dr.TRACER}).onSuccess()}};I8.on("REPORT_LOG_UPLOAD",e=>{e.networkState=si.networkState,bt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Dr.TRACER}).onSuccess("logUploadError")});class Pe extends De{constructor(n){super(n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),xr(this,"name","AgoraRTCException")}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(n,D)}throw(){super.throw(D)}}const Qi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Nn(){return Qi}function O8(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(xp()||B6())&&!nL())}function k8(){return!Qi.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Mp()}let Zi=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Ev(e,n,i){return{sampleRate:e,stereo:n,bitrate:i}}function In(e,n,i,o,c){return{width:e,height:n,frameRate:i,bitrateMin:o,bitrateMax:c}}function ru(e,n,i,o,c){return{width:{max:e},height:{max:n},frameRate:i,bitrateMin:o,bitrateMax:c}}function wL(e,n){return{numSpatialLayers:e,numTemporalLayers:n}}const Hhe={"90p":In(160,90),"90p_1":In(160,90),"120p":In(160,120,15,30,65),"120p_1":In(160,120,15,30,65),"120p_3":In(120,120,15,30,50),"120p_4":In(212,120),"180p":In(320,180,15,30,140),"180p_1":In(320,180,15,30,140),"180p_3":In(180,180,15,30,100),"180p_4":In(240,180,15,30,120),"240p":In(320,240,15,40,200),"240p_1":In(320,240,15,40,200),"240p_3":In(240,240,15,40,140),"240p_4":In(424,240,15,40,220),"360p":In(640,360,15,80,400),"360p_1":In(640,360,15,80,400),"360p_3":In(360,360,15,80,260),"360p_4":In(640,360,30,80,600),"360p_6":In(360,360,30,80,400),"360p_7":In(480,360,15,80,320),"360p_8":In(480,360,30,80,490),"360p_9":In(640,360,15,80,800),"360p_10":In(640,360,24,80,800),"360p_11":In(640,360,24,80,1e3),"480p":In(640,480,15,100,500),"480p_1":In(640,480,15,100,500),"480p_2":In(640,480,30,100,1e3),"480p_3":In(480,480,15,100,400),"480p_4":In(640,480,30,100,750),"480p_6":In(480,480,30,100,600),"480p_8":In(848,480,15,100,610),"480p_9":In(848,480,30,100,930),"480p_10":In(640,480,10,100,400),"720p":In(1280,720,15,120,1130),"720p_auto":In(1280,720,30,900,3e3),"720p_1":In(1280,720,15,120,1130),"720p_2":In(1280,720,30,120,2e3),"720p_3":In(1280,720,30,120,1710),"720p_5":In(960,720,15,120,910),"720p_6":In(960,720,30,120,1380),"1080p":In(1920,1080,15,120,2080),"1080p_1":In(1920,1080,15,120,2080),"1080p_2":In(1920,1080,30,120,3e3),"1080p_3":In(1920,1080,30,120,3150),"1080p_5":In(1920,1080,60,120,4780),"1440p":In(2560,1440,30,120,4850),"1440p_1":In(2560,1440,30,120,4850),"1440p_2":In(2560,1440,60,120,7350),"4k":In(3840,2160,30,120,8910),"4k_1":In(3840,2160,30,120,8910),"4k_3":In(3840,2160,60,120,13500)},$he={"480p":ru(640,480,5),"480p_1":ru(640,480,5),"480p_2":ru(640,480,30),"480p_3":ru(640,480,15),"720p":ru(1280,720,5),"720p_auto":In(1280,720,30,900,3e3),"720p_1":ru(1280,720,5),"720p_2":ru(1280,720,30),"720p_3":ru(1280,720,15),"1080p":ru(1920,1080,5),"1080p_1":ru(1920,1080,5),"1080p_2":ru(1920,1080,30),"1080p_3":ru(1920,1080,15)},Khe={"1SL1TL":wL(1,1),"3SL3TL":wL(3,3),"2SL3TL":wL(2,3)};function oh(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Hhe[e]):e}function RL(e){return typeof e=="string"?Object.assign({},$he[e]):e}function bA(e){return typeof e=="string"?Object.assign({},Khe[e]):e}const qhe={speech_low_quality:Ev(16e3,!1),speech_standard:Ev(32e3,!1,18),music_standard:Ev(48e3,!1),standard_stereo:Ev(48e3,!0,56),high_quality:Ev(48e3,!1,128),high_quality_stereo:Ev(48e3,!0,192)};function wA(e){return typeof e=="string"?Object.assign({},qhe[e]):e}const yv=[];function N8(e){return bi(e,"mediaSource",["screen","window","application"]),!0}let gt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),ar=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),vv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Yhe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Xhe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),T_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Sv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Tv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),bv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Cc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const CL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},IL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},D8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Jhe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},L8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let go=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Ic=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),nb=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),b_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Xs=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ah=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const AL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let RA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function x8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function br(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?x8(Object(i),!0).forEach(function(o){Ae(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Ae(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function An(e,n,i,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Fa(u=Hf(h=i.slice()).call(h)).call(u,function(_,y){return y(e,n,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,n,m),m=null),m}class M8 extends Ir{set _mediaStreamTrack(n){n!==this.mediaStreamTrack&&(this.safeEmit(T_.TRACK_UPDATED,n),this.mediaStreamTrack=n)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(n,i){super(),Ae(this,"trackMediaType",void 0),Ae(this,"_ID",void 0),Ae(this,"_rtpTransceiver",void 0),Ae(this,"_lowRtpTransceiver",void 0),Ae(this,"_hints",[]),Ae(this,"_isClosed",!1),Ae(this,"_originMediaStreamTrack",void 0),Ae(this,"mediaStreamTrack",void 0),Ae(this,"_external",{}),this._ID=i||or(8,"track-"),this._originMediaStreamTrack=n,this.mediaStreamTrack=n,function(o){st(yv).call(yv,o)||yv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){return n||Em(()=>{var i;bt.reportApiInvoke(null,{name:fi.GET_MEDIA_STREAM_TRACK,options:[],tag:Dr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===vv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const i=yv.indexOf(n);i!==-1&&yv.splice(i,1)}(this),this.emit(Sv.CLOSED),this.removeAllListeners(T_.SEI_RECEIVED)}_updateRtpTransceiver(n,i){if(i===vv.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(T_.TRANSCEIVER_UPDATED,n,i)}}class wv extends M8{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(n,i){super(n,i),Ae(this,"_enabled",!0),Ae(this,"_muted",!1),Ae(this,"_isExternalTrack",!1),Ae(this,"_isClosed",!1),Ae(this,"_enabledMutex",void 0),Ae(this,"processor",void 0),Ae(this,"_processorContext",void 0),Ae(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ts("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,i;return(n=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&n!==void 0?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,D.debug("[".concat(this.getTrackId(),"] close")),this.emit(gt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,n!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sv.TRACK_ENDED)}stateCheck(n,i){if(D.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(i,"]")),Up(i,n),this._enabled&&this._muted&&n==="enabled"&&i===!1)throw new De(X.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",D);if(!this._enabled&&!this._muted&&n==="muted"&&i===!0)throw new De(X.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",D)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ct.resolve([])}}const U8=window.AudioContext||window.webkitAudioContext;let Ac=null;const Qn=new class extends Ir{constructor(){super(...arguments),Ae(this,"prevState",void 0),Ae(this,"curState",void 0),Ae(this,"currentTime",void 0),Ae(this,"currentTimeStuckAt",void 0),Ae(this,"interruptDetectorTrack",void 0),Ae(this,"onLocalAudioTrackMute",()=>{D.info("ios15-interruption-start"),this.emit(Zi.IOS_15_16_INTERRUPTION_START)}),Ae(this,"onLocalAudioTrackUnmute",async()=>{D.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?D.info("ios15-interruption-end-canceled"):(Ac&&await Ac.suspend(),this.emit(Zi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){D.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){D.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Rv(){if(!Ac){if(function(){if(!U8)return void D.error("your browser is not support web audio");D.info("create audio context");const e=br({},re("WEBAUDIO_INIT_OPTIONS"));D.debug("audio context init option:",JSON.stringify(e)),Ac=new U8(e),Qn.curState=Ac.state,Ac.onstatechange=()=>{Qn.prevState=Qn.curState,Qn.curState=Ac?Ac.state:void 0;const{prevState:n,curState:i}=Qn,o=i==="running",c=i==="interrupted",u=n==="running",h=n==="suspended",m=n==="interrupted",_=Cn().osVersion;(mo()||tu())&&u&&c&&(D.info("ios".concat(_,"-interruption-start")),Qn.emit(Zi.IOS_INTERRUPTION_START)),(mo()||tu())&&(h||m)&&o&&(D.info("ios".concat(_,"-interruption-end")),Qn.emit(Zi.IOS_INTERRUPTION_END)),n!==i&&Qn.emit(Zi.STATE_CHANGE,i,n)},setInterval(()=>{var n;const i=(n=Ac)===null||n===void 0?void 0:n.currentTime;Qn.currentTime!==i?(Qn.currentTimeStuckAt&&(D.debug("AudioContext current time resume at ".concat(i)),Qn.currentTimeStuckAt=void 0),Qn.currentTime=i):(i!==Qn.currentTimeStuckAt&&(bt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Dr.TRACER}).onSuccess(),D.warning("AudioContext current time stuck at ".concat(i))),Qn.currentTimeStuckAt=i)},5e3),async function(n){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(U){n.state==="running"?_(!1):mo()||tu()?n.state==="suspended"&&(_(!0),U&&n.resume().then(y,y)):n.state!=="closed"&&(_(!0),U&&n.resume().then(y,y))}function _(U){if(c!==U){c=U;for(let V=0,q=i;V<q.length;V+=1){const Y=q[V];U?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function y(){m(!1)}function S(){m(!0)}function R(U){if(!h)if(o.paused)if(U){let V;A(!1),h=!0;try{V=o.play(),V?V.then(k,k):(o.addEventListener("playing",k),o.addEventListener("abort",k),o.addEventListener("error",k))}catch{k()}}else A(!0);else A(!1)}function A(U){if(u!==U){u=U;for(let V=0,q=i;V<q.length;V++){const Y=q[V];U?window.addEventListener(Y,W,{capture:!0,passive:!0}):window.removeEventListener(Y,W,{capture:!0,passive:!0})}}}function k(){o.removeEventListener("playing",k),o.removeEventListener("abort",k),o.removeEventListener("error",k),h=!1,R(!1)}function W(){R(!0)}if(mo()){const U=n.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=V.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=U.stream,R(!0)}Qn.on(Zi.STATE_CHANGE,function(){m(!0)}),m(!1)}(Ac)}(),!Ac)throw new De(X.NOT_SUPPORTED,"can not create audio context");return Ac}return Ac}function w_(e){if(function(){if(PL!==null)return PL;const o=Rv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),PL=m,m}())return;const n=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),st(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),n.call(e,o,c,u)):n.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?fA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)n.call(e,h)}}let PL=null;function OL(e,n){let i=!1;const o=1/n;if(re("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Rv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class V8{constructor(){Ae(this,"context",void 0),Ae(this,"analyserNode",void 0),Ae(this,"sourceNode",void 0),this.context=Rv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n==null||n.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||mo()||tu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<n.length;++c)n[c]=o[c]/128-1}const i=Fa(n).call(n,(o,c)=>o+c*c,0)/n.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,i;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{D.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class F8 extends Ir{get processSourceNode(){return this.sourceNode}set processedNode(n){var i;if(!this.isDestroyed&&this._processedNode!==n){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ae(this,"outputNode",void 0),Ae(this,"outputTrack",void 0),Ae(this,"isPlayed",!1),Ae(this,"sourceNode",void 0),Ae(this,"context",void 0),Ae(this,"audioBufferNode",void 0),Ae(this,"destNode",void 0),Ae(this,"audioOutputLevel",0),Ae(this,"volumeLevelAnalyser",void 0),Ae(this,"_processedNode",void 0),Ae(this,"playNode",void 0),Ae(this,"isDestroyed",!1),Ae(this,"onNoAudioInput",void 0),Ae(this,"isNoAudioInput",!1),Ae(this,"_noAudioInputCount",0),this.context=Rv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),w_(this.outputNode),this.volumeLevelAnalyser=new V8}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Cc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Nn().webAudioMediaStreamDest)throw new De(X.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){this.context.state!=="running"&&mA(()=>{Qn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(n>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;mo()||tu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Ji(200),await this.checkHasAudioInput(n?n+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,i;(n=this.processedNode)===null||n===void 0||n.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?(n=this.processedNode)===null||n===void 0||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class j8 extends F8{get isFreeze(){return!1}constructor(n,i,o){var c;if(super(),Ae(this,"sourceNode",void 0),Ae(this,"track",void 0),Ae(this,"clonedTrack",void 0),Ae(this,"audioElement",void 0),Ae(this,"isCurrentTrackCloned",!1),Ae(this,"isRemoteTrack",!1),Ae(this,"originVolumeLevelAnalyser",void 0),Ae(this,"rebuildWebAudio",async()=>{if(D.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void D.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>D.info("resume success")),D.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),w_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),w_(this.outputNode),this.emit(Cc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),n.kind!=="audio")throw new De(X.UNEXPECTED_ERROR);this.track=n;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),w_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,D.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));w_(_),this.originVolumeLevelAnalyser=new V8,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Cn();i&&h.os===Pi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Qn.on(Zi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const i=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(i),w_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Cc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),Qn.off("state-change",this.rebuildWebAudio),(n=this.originVolumeLevelAnalyser)===null||n===void 0||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const i=n.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),D.debug("create an unmuted track ".concat(i.id," from the original track ").concat(n.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));w_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function B8(e,n,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(n.height,1080),maxWidth:o(n.width,1920)}}};return n.frameRate&&typeof n.frameRate!="number"?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):typeof n.frameRate=="number"&&(c.video.mandatory.maxFrameRate=n.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Qhe(e,n){const i=await W8(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ct((m,_)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const A=document.createElement("div");A.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const W=document.createElement("button");W.innerHTML="cancel",W.setAttribute("style","width: 85px;"),W.onclick=()=>{document.body.removeChild(q);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",_(Y)};let U=h;const V=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const ce=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),ce.innerText="Share audio",Y.checked=U,Y.onchange=()=>{U=Y.checked},V.appendChild(Y),V.appendChild(ce)}k.appendChild(V),k.appendChild(W),S.appendChild(R),S.appendChild(A),S.appendChild(k);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(y),q.appendChild(S),document.body.appendChild(q),u.map(Y=>{if(Y.id){const ce=document.createElement("div");ce.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _e=Y.thumbnail;try{const{width:ye}=_e.getSize();ye>1920&&(_e=_e.resize({width:1920}))}catch(ye){throw ye&&ye.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ye}ce.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_e.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(ye){return"&#"+ye.charCodeAt(0)+";"})+"</span>",ce.onclick=()=>{document.body.removeChild(q),m({sourceId:Y.id,audio:U})},A.appendChild(ce)}})})}(i,n);return await B8(o,e,c)}async function W8(e){let n=["window","screen"];e!=="application"&&e!=="window"||(n=["window"]),e==="screen"&&(n=["screen"]);const i=e8();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new De(X.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:n}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{o=null}o&&o.then||(o=new ct((u,h)=>{i.desktopCapturer.getSources({types:n},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new De(X.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const kL=new Ts("safari");let z8=!1,G8=!1;async function Pc(e,n){let i=0,o=null;for(;i<2;)try{o=await Zhe(e,n,i>0);break}catch(c){if(c instanceof De)throw D.error("[".concat(n,"] ").concat(c.toString())),c;const u=CA(c.name||c.code||c,c.message);if(u.code===X.MEDIA_OPTION_INVALID){D.debug("[".concat(n,"] detect media option invalid, retry")),i+=1,await Ji(500);continue}throw D.error("[".concat(n,"] ").concat(u.toString())),u}if(!o)throw new De(X.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Zhe(e,n,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new De(X.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=Nn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return D.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(e8())e.screen.sourceId?Cv(c,await B8(e.screen.sourceId,e.screen,!!e.screenAudio)):Cv(c,await Qhe(e.screen,!!e.screenAudio));else if(xp()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new De(X.NOT_SUPPORTED,"This browser does not support screen sharing");D.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const A=await(h=e.screen.extensionId,m=n,new ct((k,W)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},U=>{if(!U||!U.streamId)return D.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void W(new De(X.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(U.streamId)})}catch(U){D.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),W(new De(X.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=A,Cv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&N8(e.screen.mediaSource);const A={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:W,systemAudio:U,preferCurrentTab:V}=e.screen,q={selfBrowserSurface:k,surfaceSwitching:W,systemAudio:U,preferCurrentTab:V};!k&&delete q.selfBrowserSurface,!W&&delete q.surfaceSwitching,!U&&delete q.systemAudio,!V&&delete q.preferCurrentTab,D.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:A,audio:e.screenAudio,controls:q})),Cv(c,await navigator.mediaDevices.getDisplayMedia(br({video:A,audio:e.screenAudio},q)))}else{if(!kr())throw D.error("[".concat(n,"] This browser does not support screenSharing")),new De(X.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&N8(e.screen.mediaSource);const A={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};D.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(A))),Cv(c,await navigator.mediaDevices.getUserMedia(A))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},y=re("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),_=cL(_,y)}catch{}D.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(_)),Cn();let S,R=null;(hs()||mo()||hA())&&(R=await kL.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(A){throw R&&R(),A}return _.audio&&(z8=!0),_.video&&(G8=!0),Cv(c,S),R&&R(),c}function CA(e,n){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new De(X.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new De(X.DEVICE_NOT_FOUND,"".concat(e,": ").concat(n));case"NotSupportedError":return new De(X.NOT_SUPPORTED,"".concat(e,": ").concat(n));case"NotReadableError":return new De(X.NOT_READABLE,"".concat(e,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new De(X.PERMISSION_DENIED,"".concat(e,": ").concat(n));case"ConstraintNotSatisfiedError":return new De(X.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(n));default:return D.error("getUserMedia unexpected error",e),new De(X.UNEXPECTED_ERROR,"".concat(e,": ").concat(n))}}function Cv(e,n){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=n.getVideoTracks()[0],u=n.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const Oc=new class extends Ir{get state(){return this._state}set state(e){e!==this._state&&(this.emit(b_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Ae(this,"_state",nb.IDLE),Ae(this,"isAccessMicrophonePermission",!1),Ae(this,"isAccessCameraPermission",!1),Ae(this,"lastAccessMicrophonePermission",!1),Ae(this,"lastAccessCameraPermission",!1),Ae(this,"checkdeviceMatched",!1),Ae(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(pA()||dA()===Pi.HARMONY_OS)&&Mp())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>D.error(e.toString()))}async enumerateDevices(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new De(X.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&n;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,y=null;if(!i&&(u||h)){if(kL.isLocked&&(D.debug("[device manager] wait GUM lock"),(await kL.lock())(),D.debug("[device manager] GUM unlock")),z8&&(u=!1,this.isAccessMicrophonePermission=!0),G8&&(h=!1,this.isAccessCameraPermission=!0),D.debug("[device manager] check media device permissions",e,n,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=CA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=CA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:n})}catch(S){const R=CA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}D.debug("[device manager] mic permission",e,"cam permission",n)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,new De(X.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(n=>n.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audiooutput")}searchDeviceIdByName(e){let n=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(n=i.device.deviceId)}),n}async getDeviceById(e){const n=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!n)throw new De(X.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return n}async init(){this.state=nb.INITING;try{await this.updateDevicesInfo(),this.state=nb.INITEND}catch(e){throw D.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=nb.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new De(X.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),n=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):D.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:n,updateAt:n,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=n)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==n&&(c.state="INACTIVE",i.push(c))}),this.state!==nb.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(b_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(b_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(b_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const n=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let NL=!1;const kc=new class extends Ir{constructor(){super(...arguments),Ae(this,"onAutoplayFailed",void 0),Ae(this,"onAudioAutoplayFailed",void 0)}};function H8(){if(Cn(),!NL){const e=n=>{n.preventDefault(),NL=!1,KT()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};NL=!0,KT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),D.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),kc.onAutoplayFailed?kc.onAutoplayFailed():kc.onAudioAutoplayFailed?D.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):D.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),kc.emit("autoplay-failed")}}function $8(e,n,i,o){if(!e)return;const c=bt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=br(br({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:kc.onAutoplayFailed||kc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:n,trackId:o,extend:void 0});bt.send({type:Tr.AUTOPLAY_FAILED,data:m},!0)}const epe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Wo=new class{constructor(){Ae(this,"onAutoplayFailed",void 0),Ae(this,"elementMap",new Map),Ae(this,"elementStateMap",new Map),Ae(this,"elementsNeedToResume",[]),Ae(this,"sinkIdMap",new Map),Ae(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(n=>{let[i,o]=n;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(D.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(Qn.curState==="running")return hv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Ae(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(D.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Qn.on(Zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qn.on(Zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Qn.on(Zi.STATE_CHANGE,()=>{mo()&&Qn.prevState==="suspended"&&Qn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,n){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,n),i)try{await i.setSinkId(n)}catch(o){throw new De(X.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,n,i,o){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,Xs.INIT),this.setVolume(n,i);const u=this.sinkIdMap.get(n);if(u)try{c.setSinkId(u).catch(m=>{D.warning("[".concat(n,"] set sink id failed"),m.toString())})}catch(m){D.warning("[".concat(n,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&$8(o,"audio",m.message,n),D.warning("audio element play warning",m.toString()),this.elementMap.has(n)&&m.name==="NotAllowedError"&&(D.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),mA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),H8()}))})}updateTrack(e,n){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([n]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,n){const i=this.elementMap.get(e);i&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(e){const n=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!n)return;const i=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(i,1),n.srcObject=null,n.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,n){epe.forEach(i=>{n.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(D.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=n==null?void 0:n.error;h&&D.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(i=>{D.debug("Auto resume audio element success")}).catch(i=>{D.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new ct(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{KT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Xr(){return function(e,n,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new De(X.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",D);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof ct?new ct((_,y)=>{m.then(_).catch(y)}):m}),i}}class K8 extends Ir{constructor(n){super(),Ae(this,"name","VideoProcessorDestination"),Ae(this,"ID","0"),Ae(this,"_source",void 0),Ae(this,"videoContext",void 0),Ae(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new De(X.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new De(X.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(go.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(go.ON_TRACK,void 0)}}class q8 extends Ir{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i){super(),Ae(this,"constraintsMap",new Map),Ae(this,"statsRegistry",[]),Ae(this,"usageRegistry",[]),Ae(this,"trackId",void 0),Ae(this,"direction",void 0),Ae(this,"_chained",!1),this.trackId=n,this.direction=i}async getConstraints(){return await fs(this,Ic.REQUEST_CONSTRAINTS)}async requestApplyConstraints(n,i){var o;return D.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),sr(this,Ic.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return D.info("processor ".concat(n.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(n),sr(this,Ic.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){D.error(new De(X.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof ct&&(o=await o),n.push(br(br({},o),{},{direction:this.direction}))}catch(o){D.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class Y8 extends Ir{constructor(n){super(),Ae(this,"name","AudioProcessorDestination"),Ae(this,"ID","0"),Ae(this,"inputTrack",void 0),Ae(this,"inputNode",void 0),Ae(this,"audioProcessorContext",void 0),Ae(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new De(X.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new De(X.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(go.ON_TRACK,void 0),this.emit(go.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(go.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(go.ON_NODE,this.inputNode))}}class X8 extends Ir{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i,o){super(),Ae(this,"constraintsMap",new Map),Ae(this,"statsRegistry",[]),Ae(this,"audioContext",void 0),Ae(this,"trackId",void 0),Ae(this,"direction",void 0),Ae(this,"usageRegistry",[]),Ae(this,"_chained",!1),this.audioContext=n,this.trackId=i,this.direction=o}async getConstraints(){return fs(this,Ic.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(n,i){var o;return D.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),sr(this,Ic.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return this.constraintsMap.delete(n),sr(this,Ic.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){D.error(new De(X.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof ct&&(o=await o),n.push(br(br({},o),{},{direction:this.direction}))}catch(o){D.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class DL extends Ir{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ae(this,"context",void 0),Ae(this,"processSourceNode",void 0),Ae(this,"outputTrack",void 0),Ae(this,"processedNode",void 0),Ae(this,"clonedTrack",void 0),Ae(this,"outputNode",void 0),this.outputNode=new tpe}setVolume(){}createOutputTrack(){throw new De(X.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class tpe{disconnect(){}connect(){}}function J8(e){return new ct((n,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=mo()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&kr()||(o=!0,c.srcObject=null,c.remove(),n([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(gA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}function IA(e){const n={};e.facingMode&&(n.facingMode=e.facingMode),e.cameraId&&(n.deviceId={exact:e.cameraId});const i=oh(e.encoderConfig);return i.width!=null&&(n.width=i.width),i.height!=null&&(n.height=i.height),!Y6()&&i.frameRate&&(n.frameRate=i.frameRate),B6()&&typeof n.frameRate=="object"&&(n.frameRate.max=60),kr()&&(n.frameRate={ideal:30,max:30}),n}function Q8(e){const n={};return Y6()||(e.AGC!==void 0&&(n.autoGainControl=e.AGC),e.AEC!==void 0&&(n.echoCancellation=e.AEC),e.ANS!==void 0&&(n.noiseSuppression=e.ANS,xp()&&e.ANS&&(n.googHighpassFilter=e.ANS))),n}function Z8(e){const n=Q8(e);if(e.encoderConfig){const i=wA(e.encoderConfig);n.channelCount=i.stereo?2:1,n.sampleRate=i.sampleRate,n.sampleSize=i.sampleSize}return e.microphoneId&&(n.deviceId={exact:e.microphoneId}),pA()&&(n.sampleRate=void 0),n}const npe=e=>{const n=e._encoderConfig;if(!n)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:m=c}=n;if(!u||!h||!m)return;h=lL(h),m=lL(m),u=lL(u);const{max:_,min:y}=function(k,W,U){const V=200*Math.pow(U/15,.6)*Math.pow(k*W/640/360,.75);return{min:Math.floor(V),max:Math.floor(4*V)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=n||{};S||D.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:A}=re("ENCODER_CONFIG_LIMIT");return A&&typeof A=="number"&&(u=Math.min(u,A)),{frameRate:u,bitrateMax:S||_,bitrateMin:R||y,scaleResolutionDownBy:1,scale:0}},eW=async(e,n,i)=>await(async(o,c,u)=>{const h=function(y){const S=[];for(let R=0;R<y.length;R+=2)S.push(parseInt(y.slice(R,R+2),16));return Uint8Array.from(S)}(d8(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(e.buffer,n,i),LL=e=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new ct((i,o)=>{n.toBlob(async c=>{if(n.remove(),c){const u=await tW(c);i({buffer:u,width:n.width,height:n.height})}else o(new De(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},tW=async e=>{const n=await e.arrayBuffer();return new Uint8Array(n)};var nW,rW,iW,sW,oW,aW,cW,lW,uW,dW,hW,pW,fW,mW,gW,_W,EW,yW,Ar,vW,SW,TW,bW,wW,RW,ch,CW,IW,AW,PW,OW,kW,NW,DW,LW,xW,MW,UW,VW,gs;let jr=(nW=Mt({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),rW=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),iW=Xr(),sW=mv("LocalAudioTrack","_enabledMutex"),oW=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),aW=Xr(),cW=mv("LocalAudioTrack","_enabledMutex"),lW=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),uW=Xr(),dW=Xr(),hW=Xr(),pW=Mt({argsMap:e=>[e.getTrackId()]}),fW=Xr(),mW=Mt({argsMap:e=>[e.getTrackId()]}),gW=Xr(),_W=Mt({argsMap:e=>[e.getTrackId()]}),EW=Mt({argsMap:(e,n)=>[e.getTrackId(),n.name]}),yW=Mt({argsMap:e=>[e.getTrackId()]}),An((Ar=class extends wv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Wo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,n,i,o){super(e,i),Ae(this,"trackMediaType",bv.AUDIO),Ae(this,"_encoderConfig",void 0),Ae(this,"_trackSource",void 0),Ae(this,"metadata",[]),Ae(this,"_enabled",!0),Ae(this,"_volume",100),Ae(this,"_useAudioElement",!0),Ae(this,"_bypassWebAudio",!1),Ae(this,"processor",void 0),Ae(this,"_processorContext",void 0),Ae(this,"_processorDestination",void 0),Ae(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=n,this._getOriginVolumeLevel=!!o,this._trackSource=new DL,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),hs()&&!Ac?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){tr(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Wo.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void D.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,sr(this,gt.NEED_REPLACE_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{D.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!O8())throw new De(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Wo.setSinkID(this.getTrackId(),e)}async setEnabled(e,n,i){return this._setEnabled(e,n,i)}async _setEnabled(e,n,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await sr(this,gt.NEED_ENABLE_TRACK,this),D.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await sr(this,gt.NEED_MUTE_TRACK,this):await sr(this,gt.NEED_UNMUTE_TRACK,this))}getStats(){return Em(()=>{D.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),bc(this,gt.GET_STATS)||br({},CL)}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Cc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(Cc.ON_AUDIO_BUFFER),this._source.on(Cc.ON_AUDIO_BUFFER,i=>e(i))}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Wo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Wo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Wo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,n){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ct.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new De(X.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new De(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(e){e.on(go.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this))}),e.on(go.ON_NODE,n=>{this._source.processedNode=n})}unbindProcessorDestinationEvents(e){e.removeAllListeners(go.ON_TRACK),e.removeAllListeners(go.ON_NODE)}bindProcessorContextEvents(e){e.on(Ic.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ic.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof DL&&(this._trackSource=new j8(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new X8(this._source.context,this.getTrackId(),"local"),n=new Y8(e);return this._processorContext=e,this._processorDestination=n,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(n),this._source.on(Cc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Wo.stop(this.getTrackId()),this._source.play()),sr(this,gt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{D.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:n}}}).prototype,"setVolume",[nW],Object.getOwnPropertyDescriptor(Ar.prototype,"setVolume"),Ar.prototype),An(Ar.prototype,"setPlaybackDevice",[rW,iW],Object.getOwnPropertyDescriptor(Ar.prototype,"setPlaybackDevice"),Ar.prototype),An(Ar.prototype,"setEnabled",[sW,oW,aW],Object.getOwnPropertyDescriptor(Ar.prototype,"setEnabled"),Ar.prototype),An(Ar.prototype,"setMuted",[cW,lW,uW],Object.getOwnPropertyDescriptor(Ar.prototype,"setMuted"),Ar.prototype),An(Ar.prototype,"getStats",[dW],Object.getOwnPropertyDescriptor(Ar.prototype,"getStats"),Ar.prototype),An(Ar.prototype,"setAudioFrameCallback",[hW],Object.getOwnPropertyDescriptor(Ar.prototype,"setAudioFrameCallback"),Ar.prototype),An(Ar.prototype,"play",[pW,fW],Object.getOwnPropertyDescriptor(Ar.prototype,"play"),Ar.prototype),An(Ar.prototype,"stop",[mW,gW],Object.getOwnPropertyDescriptor(Ar.prototype,"stop"),Ar.prototype),An(Ar.prototype,"close",[_W],Object.getOwnPropertyDescriptor(Ar.prototype,"close"),Ar.prototype),An(Ar.prototype,"pipe",[EW],Object.getOwnPropertyDescriptor(Ar.prototype,"pipe"),Ar.prototype),An(Ar.prototype,"unpipe",[yW],Object.getOwnPropertyDescriptor(Ar.prototype,"unpipe"),Ar.prototype),Ar),AA=(vW=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),SW=Xr(),TW=mv("MicrophoneAudioTrack","_enabledMutex"),bW=Mt({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),wW=Xr(),RW=Mt({argsMap:e=>[e.getTrackId()]}),An((ch=class extends jr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,n,i,o){super(e,n.encoderConfig?wA(n.encoderConfig):{},o,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ae(this,"_config",void 0),Ae(this,"_deviceName","default"),Ae(this,"_constraints",void 0),Ae(this,"_originalConstraints",void 0),Ae(this,"_enabled",!0),this._config=n,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),(hv()||tL())&&Qn.bindInterruptDetectorTrack(this)}async setDevice(e){if(D.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const n=await Oc.getDeviceById(e),i={};i.audio=br({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await Pc(i,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Pc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Oc.getDeviceById(e);this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}D.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,n,i){if(n)return D.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),re("AUTO_RESET_AUDIO_ROUTE")&&(mo()||tu())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(h){throw D.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=br({},this._constraints),u=Oc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await Pc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}D.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(hv()||tL())&&Qn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((mo()||tu())&&this._enabled&&!this._isClosed&&Qn.duringInterruption){const e=async()=>{Qn.off(Zi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Qn.on(Zi.IOS_INTERRUPTION_END,e)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sv.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=Oc.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId=i),this._constraints=n,this._enabled){this._originMediaStreamTrack.stop();const o=await Pc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ic.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ic.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[vW,SW],Object.getOwnPropertyDescriptor(ch.prototype,"setDevice"),ch.prototype),An(ch.prototype,"setEnabled",[TW,bW,wW],Object.getOwnPropertyDescriptor(ch.prototype,"setEnabled"),ch.prototype),An(ch.prototype,"close",[RW],Object.getOwnPropertyDescriptor(ch.prototype,"close"),ch.prototype),ch),rpe=(CW=Mt({argsMap:(e,n)=>[e.getTrackId(),n,e.duration]}),IW=Xr(),AW=Mt({argsMap:e=>[e.getTrackId()]}),PW=Xr(),OW=Mt({argsMap:e=>[e.getTrackId()]}),kW=Xr(),NW=Mt({argsMap:e=>[e.getTrackId()]}),DW=Xr(),LW=Mt({argsMap:e=>[e.getTrackId()]}),xW=Xr(),MW=Mt({argsMap:e=>[e.getTrackId()]}),UW=Mt({argsMap:e=>[e.getTrackId()]}),VW=Xr(),An((gs=class extends jr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,n,i,o){super(n.createOutputTrack(),i,o),Ae(this,"source",void 0),Ae(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=n,this._bufferSource.on(Cc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Sv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){tr(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[CW,IW],Object.getOwnPropertyDescriptor(gs.prototype,"startProcessAudioBuffer"),gs.prototype),An(gs.prototype,"pauseProcessAudioBuffer",[AW,PW],Object.getOwnPropertyDescriptor(gs.prototype,"pauseProcessAudioBuffer"),gs.prototype),An(gs.prototype,"seekAudioBuffer",[OW,kW],Object.getOwnPropertyDescriptor(gs.prototype,"seekAudioBuffer"),gs.prototype),An(gs.prototype,"resumeProcessAudioBuffer",[NW,DW],Object.getOwnPropertyDescriptor(gs.prototype,"resumeProcessAudioBuffer"),gs.prototype),An(gs.prototype,"stopProcessAudioBuffer",[LW,xW],Object.getOwnPropertyDescriptor(gs.prototype,"stopProcessAudioBuffer"),gs.prototype),An(gs.prototype,"close",[MW],Object.getOwnPropertyDescriptor(gs.prototype,"close"),gs.prototype),An(gs.prototype,"setAudioBufferPlaybackSpeed",[UW,VW],Object.getOwnPropertyDescriptor(gs.prototype,"setAudioBufferPlaybackSpeed"),gs.prototype),gs);class vi extends jr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=Rv().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,or(8,"track-mix-")),Ae(this,"trackList",void 0),Ae(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return this.trackList.indexOf(n)!==-1}addAudioTrack(n){this.trackList.indexOf(n)===-1?(D.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):D.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(this.trackList.indexOf(n)!==-1){D.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}fA(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(i=>{i instanceof vi?i.emit(T_.TRANSCEIVER_UPDATED,n):i._updateRtpTransceiver(n)}))}}class ipe extends F8{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(Cc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ae(this,"audioBuffer",void 0),Ae(this,"sourceNode",void 0),Ae(this,"startPlayTime",0),Ae(this,"startPlayOffset",0),Ae(this,"pausePlayTime",0),Ae(this,"options",void 0),Ae(this,"currentLoopCount",0),Ae(this,"currentPlaybackSpeed",100),Ae(this,"_currentState","stopped"),this.audioBuffer=n,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){this.currentState==="stopped"?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):D.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=n,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const FW=new Map;class xL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const n=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/n;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(D.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}get videoState(){return this._videoState}set videoState(n){var i;n!==this._videoState&&(this._videoState=n,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(n){Ae(this,"trackId",void 0),Ae(this,"config",void 0),Ae(this,"onFirstVideoFrameDecoded",void 0),Ae(this,"onVideoStateChanged",void 0),Ae(this,"freezeTimeCounterList",[]),Ae(this,"renderFreezeAccTime",0),Ae(this,"isKeepLastFrame",!1),Ae(this,"timeUpdatedCount",0),Ae(this,"freezeTime",0),Ae(this,"playbackTime",0),Ae(this,"lastTimeUpdatedTime",0),Ae(this,"autoplayFailed",!1),Ae(this,"videoTrack",void 0),Ae(this,"videoElement",void 0),Ae(this,"cacheVideoElement",void 0),Ae(this,"renderStats",void 0),Ae(this,"_videoState",ah.VideoStateStopped),Ae(this,"videoElementCheckInterval",void 0),Ae(this,"videoElementFreezeTimeout",void 0),Ae(this,"_videoElementStatus",Xs.NONE),Ae(this,"isGettingVideoDimensions",!1),Ae(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return D.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Ae(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Qn.curState==="running"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(j6())),K6()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ae(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Xs.PLAYING;break;case"loadeddata":if(this.videoState=ah.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Xs.CANPLAY;break;case"stalled":this.videoElementStatus=Xs.STALLED;break;case"suspend":this.videoElementStatus=Xs.SUSPEND;break;case"pause":this.videoElementStatus=Xs.PAUSED,mo()||tu()||hs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Xs.WAITING;break;case"abort":this.videoElementStatus=Xs.ABORT;break;case"ended":this.videoElementStatus=Xs.ENDED;break;case"emptied":this.videoElementStatus=Xs.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Xs.ERROR,D.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Fp.lastVisibleTime<Fp.lastHiddenTime||u<Fp.lastHiddenTime||u<Fp.lastVisibleTime)return;for(c>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ae(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(j6())),K6()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,n.element instanceof HTMLVideoElement?this.videoElement=n.element:this.videoElement=document.createElement("video"),Qn.on(Zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qn.on(Zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return(n=this.videoElement.parentElement)!==null&&n!==void 0?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{n&&$8(n,"video",c.message,this.trackId),c.name==="NotAllowedError"?(D.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):D.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Cn();if((o.name==="Safari"&&Number(o.version)===15||hv())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");if(!i)return D.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,n.width,n.height);const o=i.getImageData(0,0,n.width,n.height);return n.remove(),o}async getCurrentFrameToUint8Array(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ct((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await tW(m);u({buffer:_,width:o.width,height:o.height})}else h(new De(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,i<0?.1:i>1?1:i)})):await LL(n)}destroy(){this.renderStats=void 0,Qn.off(Zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qn.off(Zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ah.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Xs.INIT,!this.videoElementCheckInterval&&(jW.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=Xs.DESTROYED)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ah.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ah.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(y,S)=>{if(this.videoElementStatus===Xs.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const k=S.presentationTime-u.presentationTime;this.videoState===ah.VideoStateStarting&&(this.videoState=ah.VideoStateDecoding),this.videoState===ah.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION"))),k<re("VIDEO_FREEZE_DURATION")&&this.videoState===ah.VideoStateFrozen&&(this.videoState=ah.VideoStateDecoding),k>re("VIDEO_FREEZE_DURATION")&&Fp.lastVisibleTime>=Fp.lastHiddenTime&&u.timestamp>Fp.lastVisibleTime&&u.timestamp>Fp.lastHiddenTime&&(this.renderFreezeAccTime+=k)}u=br(br({},S),{},{timestamp:y})}var R,A;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(A=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(A,_))};(n=(i=this.videoElement).requestVideoFrameCallback)===null||n===void 0||n.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),pA()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Cn();o.name==="Safari"&&Number(o.version)===15||hv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,kr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,kr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{D.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){jW.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Xs.NONE}handleAutoPlayFailed(){const n=i=>{i.preventDefault(),this.videoElement.play().then(()=>{D.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{D.error(o)}),this.autoplayFailed=!1,KT()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};KT()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),H8()}}const jW=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class BW extends xL{constructor(n){super(n),Ae(this,"container",void 0),Ae(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const i=n.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(n){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(n,o):await LL(n)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if((n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var WW,zW,GW,HW,$W,KW,qW,YW,XW,JW,QW,ZW,ez,tz,nz,rz,iz,sz,oz,az,cz,lz,uz,dz,bn,hz,pz,fz,mz,gz,_z,Ez,yz,Nc;let fr=(WW=Mt({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),zW=Xr(),GW=Mt({argsMap:e=>[e.getTrackId()]}),HW=mv("LocalVideoTrack","_enabledMutex"),$W=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),KW=Xr(),qW=mv("LocalVideoTrack","_enabledMutex"),YW=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),XW=Xr(),JW=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),QW=Xr(),ZW=Xr(),ez=Mt({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),tz=Xr(),nz=Xr(),rz=Xr(),iz=Xr(),sz=Xr(),oz=Xr(),az=Xr(),cz=Mt({argsMap:(e,n)=>[e.getTrackId(),n.name]}),lz=Mt({argsMap:e=>[e.getTrackId()]}),uz=Mt({argsMap:e=>[e.getTrackId()]}),dz=Mt({argsMap:(e,n,i)=>[e.getTrackId(),n.label,i]}),bn=class $ie extends wv{get videoHeight(){if(hs()){const{height:n}=this._mediaStreamTrack.getSettings();return this._videoHeight=n,this._videoHeight}return this._videoHeight}get videoWidth(){if(hs()){const{width:n}=this._mediaStreamTrack.getSettings();return this._videoWidth=n,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Xs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,i,o,c,u,h){if(super(n,u),Ae(this,"trackMediaType",bv.VIDEO),Ae(this,"_player",void 0),Ae(this,"isUseScaleResolutionDownBy",!1),Ae(this,"_videoVisibleTimer",null),Ae(this,"_previousVideoVisibleStatus",void 0),Ae(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ae(this,"_encoderConfig",void 0),Ae(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ae(this,"_optimizationMode",void 0),Ae(this,"_videoHeight",void 0),Ae(this,"_videoWidth",void 0),Ae(this,"_forceBitrateLimit",void 0),Ae(this,"_enabled",!0),Ae(this,"_processorDestination",void 0),Ae(this,"_processorContext",void 0),hs()){const{width:m,height:_}=n.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(ar.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(QD(Un.CHROME,115)&&dA().indexOf("Windows")!==-1){const m=function(_,y){if("VideoFrame"in window&&"TransformStream"in window&&Nn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),R=new MediaStreamTrackGenerator({kind:"video"});let A,k,W=Date.now();const U=()=>{V&&(clearInterval(V),V=void 0),A&&(A.close(),A=void 0),_.stop(),k=void 0,R.removeEventListener("ended",U)};let V=window.setInterval(()=>{if(k&&A&&Date.now()-W>1e3)try{R.readyState==="live"?k.enqueue(A.clone()):U()}catch{U()}},1e3);const q=new TransformStream({transform:(Y,ce)=>{R.readyState==="live"?(k=ce,W=Date.now(),A===void 0?(A=Y,ce.enqueue(Y.clone())):(ce.enqueue(A),A=Y)):Y.close()}});return R.addEventListener("ended",U),S.readable.pipeThrough(q).pipeTo(R.writable),R}}(n);m&&(D.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(ar.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new q8(this.getTrackId(),"local"),this._processorDestination=new K8(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof n=="string"){const c=document.getElementById(n);c?n=c:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=br(br(br({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(o):(n instanceof HTMLVideoElement?this._player=new xL(o):this._player=new BW(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Sv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),n),!n){this._originMediaStreamTrack.enabled=!1;try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await sr(this,gt.NEED_MUTE_TRACK,this):await sr(this,gt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(n,i){if(!this._enabled)throw new De(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=oh(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const o=IA({encoderConfig:n});(hs()||mo()||tu())&&(o.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new De(X.UNEXPECTED_ERROR,c.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=n,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(D)}}getStats(){return Em(()=>{D.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),bc(this,gt.GET_STATS)||br({},IL)}async setBeautyEffect(n){D.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(n,i):await LL(n)}async setBitrateLimit(n){D.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n&&(this._forceBitrateLimit=n,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<n.max_bitrate?this._encoderConfig.bitrateMax:n.max_bitrate:this._encoderConfig.bitrateMax=n.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=n.min_bitrate))}async setOptimizationMode(n){if(n!=="motion"&&n!=="detail"&&n!=="balanced")return void D.error(X.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=n,await sr(this,gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,D.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(n,")"))}setScalabiltyMode(n){if(n.numSpatialLayers===1&&n.numTemporalLayers!==1)return D.error(X.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,D.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){J8(this._originMediaStreamTrack).then(n=>{let[i,o]=n;this._videoHeight=o,this._videoWidth=i}).catch(gA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(n){if(!this._enabled)throw new De(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");D.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(n)),n=oh(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),this._encoderConfig=n,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(D)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!n||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,y,S,R,A){const k=re("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:R,max:A};if(A===void 0){var W;const V=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*y/640/360,.75));A=k==="STANDARD_BITRATE"?4*V:2*V,R=(W=R)!==null&&W!==void 0?W:V}else{var U;R=(U=R)!==null&&U!==void 0?U:Math.floor(A/10)}return{min:R,max:A}}(n,i,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,D.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var n,i;const o=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=Q6.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const y=bt.reportApiInvoke(null,{tag:Dr.TRACER,name:fi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new De(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(n){}pipe(n){if(this.processor===n)return n;if(n._source)throw new De(X.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=br(br({},o),oh(n))),o=E_(o);const c=or(8,"track-video-cloned-"),u=new $ie(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,E_(this._scalabilityMode),this._optimizationMode,c,E_(this._hints));return n&&o&&u.setEncoderConfiguration(o),D.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(n,i){if(!(n instanceof MediaStreamTrack))throw new De(X.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(n.kind!=="video")throw new De(X.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(n,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(n){if(Em(()=>{bt.reportApiInvoke(null,{name:fi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Dr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void D.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(n instanceof Uint8Array==0)return new De(X.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void D.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",n):D.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(go.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(go.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ic.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ic.REQUEST_CONSTRAINTS)}},An(bn.prototype,"play",[WW,zW],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),An(bn.prototype,"stop",[GW],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),An(bn.prototype,"setEnabled",[HW,$W,KW],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),An(bn.prototype,"setMuted",[qW,YW,XW],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),An(bn.prototype,"setEncoderConfiguration",[JW,QW],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),An(bn.prototype,"getStats",[ZW],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),An(bn.prototype,"setBeautyEffect",[ez,tz],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),An(bn.prototype,"getCurrentFrameData",[nz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),An(bn.prototype,"getCurrentFrameImage",[rz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),An(bn.prototype,"setBitrateLimit",[iz],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),An(bn.prototype,"setOptimizationMode",[sz],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),An(bn.prototype,"setScalabiltyMode",[oz],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),An(bn.prototype,"updateMediaStreamTrackResolution",[az],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),An(bn.prototype,"pipe",[cz],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),An(bn.prototype,"unpipe",[lz],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),An(bn.prototype,"close",[uz],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),An(bn.prototype,"replaceTrack",[dz],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),ML=(hz=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),pz=Xr(),fz=mv("CameraVideoTrack","_enabledMutex"),mz=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),gz=Xr(),_z=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),Ez=Xr(),yz=Mt({argsMap:e=>[e.getTrackId()]}),Nc=class Kie extends fr{get __className__(){return"CameraVideoTrack"}constructor(n,i,o,c,u,h){super(n,oh(i.encoderConfig),c,u,h),Ae(this,"_config",void 0),Ae(this,"_originalConstraints",void 0),Ae(this,"_constraints",void 0),Ae(this,"_enabled",!0),Ae(this,"_deviceName","default"),Ae(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(hv()||tL())&&!function(){const m=Cn();if(m.os!==Pi.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&q6()&&this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=n.label,this._encoderConfig=oh(this._config.encoderConfig),Qn.on(Zi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Qn.on(Zi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(n){return typeof n=="string"?this._setDeviceById(n):n.deviceId?this._setDeviceById(n.deviceId):n.facingMode?this._setDeviceByFacingModel(n.facingMode):void 0}async _setDeviceById(n){if(D.info("[".concat(this.getTrackId(),"] set device to ").concat(n)),this._enabled)try{const i=await Oc.getDeviceById(n),o={};o.video=br({},this._constraints),o.video.deviceId={exact:n},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Pc(o,this.getTrackId())}catch(u){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Pc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Oc.getDeviceById(n);this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}D.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(n){D.info("[".concat(this.getTrackId(),"] set facingMode ").concat(n));const i={video:br(br({},this._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Pc(i,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await Pc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=n,this._config.cameraId=void 0,this._constraints=br({},i.video),D.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Pc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(n,i){if(!this._enabled)throw new De(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=oh(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate||n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate||n.bitrateMin);const o=Lr(this._config);o.encoderConfig=n;const c=IA(o);(hs()||mo()||tu())&&(c.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new De(X.UNEXPECTED_ERROR,u.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=n,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(D)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((mo()||tu())&&this._enabled&&!this._isClosed&&Qn.duringInterruption){const n=async()=>{Qn.off(Zi.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Qn.on(Zi.IOS_INTERRUPTION_END,n)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sv.TRACK_ENDED)}async renewMediaStreamTrack(n){const i=n||this._constraints,o=Oc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await Pc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Qn.off(Zi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Qn.off(Zi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=br(br({},o),oh(n))),o=E_(o);const c=or(8,"track-cam-cloned-"),u=new Kie(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,E_(br(br({},this._config),{},{encoderConfig:o})),E_(this._constraints),E_(this._scalabilityMode),this._optimizationMode,c);return n&&o&&u.setEncoderConfiguration(o),D.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Ic.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(Ic.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}},An(Nc.prototype,"setDevice",[hz,pz],Object.getOwnPropertyDescriptor(Nc.prototype,"setDevice"),Nc.prototype),An(Nc.prototype,"setEnabled",[fz,mz,gz],Object.getOwnPropertyDescriptor(Nc.prototype,"setEnabled"),Nc.prototype),An(Nc.prototype,"setEncoderConfiguration",[_z,Ez],Object.getOwnPropertyDescriptor(Nc.prototype,"setEncoderConfiguration"),Nc.prototype),An(Nc.prototype,"close",[yz],Object.getOwnPropertyDescriptor(Nc.prototype,"close"),Nc.prototype),Nc);function UL(e,n,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=br(br({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(n.contentHint=i.optimizationMode,n.contentHint===i.optimizationMode?D.debug("[".concat(e,"] set content hint to"),i.optimizationMode):D.debug("[".concat(e,"] set content hint failed")))):D.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var vz,Sz,Tz,bz,pl,wz,Rz,Cz,Iz,Az,Pz,Js;class Oz extends M8{getUserId(){return this._userId}constructor(n,i,o,c){super(n,"track-".concat(n.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(or(5,""))),Ae(this,"_userId",void 0),Ae(this,"_uintId",void 0),Ae(this,"_isDestroyed",!1),Ae(this,"store",void 0),Ae(this,"processor",void 0),Ae(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,D.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Iv=(vz=Mt({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Sz=Mt({argsMap:e=>[e.getTrackId()]}),Tz=Mt({argsMap:(e,n)=>[e.getTrackId(),n.name]}),bz=Mt({argsMap:e=>[e.getTrackId()]}),An((pl=class extends Oz{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Xs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,n,i,o){super(e,n,i,o),Ae(this,"_videoVisibleTimer",null),Ae(this,"_previousVideoVisibleStatus",void 0),Ae(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ae(this,"trackMediaType",bv.VIDEO),Ae(this,"_videoWidth",void 0),Ae(this,"_videoHeight",void 0),Ae(this,"_player",void 0),Ae(this,"processorDestination",void 0),Ae(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new q8(this.getTrackId(),"remote"),this.processorDestination=new K8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Em(()=>{D.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),bc(this,gt.GET_STATS)||br({},L8)}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=br(br({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new xL(i):this._player=new BW(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Tv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Tv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Tv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){J8(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(gA)}_updatePlayerSource(){D.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=Q6.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=bt.reportApiInvoke(null,{tag:Dr.TRACER,name:fi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new De(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new De(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(go.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(go.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(T_.SEI_RECEIVED,e)}}).prototype,"play",[vz],Object.getOwnPropertyDescriptor(pl.prototype,"play"),pl.prototype),An(pl.prototype,"stop",[Sz],Object.getOwnPropertyDescriptor(pl.prototype,"stop"),pl.prototype),An(pl.prototype,"pipe",[Tz],Object.getOwnPropertyDescriptor(pl.prototype,"pipe"),pl.prototype),An(pl.prototype,"unpipe",[bz],Object.getOwnPropertyDescriptor(pl.prototype,"unpipe"),pl.prototype),pl),Av=(wz=Mt({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),Rz=Mt({argsMap:(e,n)=>[e.getTrackId(),n]}),Cz=Mt({argsMap:e=>[e.getTrackId()]}),Iz=Mt({argsMap:e=>[e.getTrackId()]}),Az=Mt({argsMap:(e,n)=>[e.getTrackId(),n.name]}),Pz=Mt({argsMap:e=>[e.getTrackId()]}),An((Js=class extends Oz{get isPlaying(){return this._useAudioElement?Wo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,n,i,o){super(e,n,i,o),Ae(this,"trackMediaType",bv.AUDIO),Ae(this,"_source",void 0),Ae(this,"_useAudioElement",!0),Ae(this,"_volume",100),Ae(this,"processorContext",void 0),Ae(this,"processorDestination",void 0),Ae(this,"_played",!1),Ae(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new DL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new j8(e,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Cc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Tv.FIRST_FRAME_DECODED)}),this.processorContext=new X8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Y8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Cc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Cc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(Cc.ON_AUDIO_BUFFER),this._source.on(Cc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?Wo.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!O8())throw new De(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Wo.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Em(()=>{D.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),bc(this,gt.GET_STATS)||br({},D8)}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] use audio element to play")),Wo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Wo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Wo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new De(X.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new De(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new De(X.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(go.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(go.ON_NODE,e=>{this._source.processedNode=e;const n=!e;this._useAudioElement!==n&&(this._played?(this.stop(),this._useAudioElement=n,this.play()):this._useAudioElement=n)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(go.ON_TRACK),this.processorDestination.removeAllListeners(go.ON_NODE)}}).prototype,"setVolume",[wz],Object.getOwnPropertyDescriptor(Js.prototype,"setVolume"),Js.prototype),An(Js.prototype,"setPlaybackDevice",[Rz],Object.getOwnPropertyDescriptor(Js.prototype,"setPlaybackDevice"),Js.prototype),An(Js.prototype,"play",[Cz],Object.getOwnPropertyDescriptor(Js.prototype,"play"),Js.prototype),An(Js.prototype,"stop",[Iz],Object.getOwnPropertyDescriptor(Js.prototype,"stop"),Js.prototype),An(Js.prototype,"pipe",[Az],Object.getOwnPropertyDescriptor(Js.prototype,"pipe"),Js.prototype),An(Js.prototype,"unpipe",[Pz],Object.getOwnPropertyDescriptor(Js.prototype,"unpipe"),Js.prototype),Js);const Fp=new class extends Ir{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ae(this,"_lastHiddenTime",0),Ae(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),D.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class kz extends Ir{constructor(n,i){super(),Ae(this,"trackMediaType",bv.DATA),Ae(this,"_version",1),Ae(this,"_type",3),Ae(this,"_config",void 0),Ae(this,"_originDataChannel",void 0),Ae(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ae(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Ae(this,"_datachannelEventMap",new Map),this._config=n,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(n){this._dataStreamPacketHandler=n}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&n!==void 0?n:"connecting"}get _originDataChannelId(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&n!==void 0?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ct((n,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&n();const o=setTimeout(()=>{var c;i(new De(X.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),n()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new De(X.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new De(X.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[RA.OPEN,RA.CLOSE,RA.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),n.addEventListener(i,o)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;n.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class spe extends kz{constructor(n){super(n),Ae(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&D.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(RA.MESSAGE,u)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class ope extends kz{send(n){if(this._originDataChannel){let i=n;i=this._dataStreamPacketHandler.serialize(n);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function PA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>PI.revokeObjectURL(e),0),new Worker(PI.createObjectURL(e))}const Nz=71,VL=1,FL=2,jL=1,Dz=2;var jp=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(jp||{});function Lz(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==Nz)return;const o=e.getUint16(1),c=VL+FL+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let m=VL+FL;for(;m<c;){const _=e.getUint8(m),y=e.getUint16(m+jL),S=jL+Dz;if(_===jp.AUDIO_LEVEL){let R=e.getUint8(m+S);for(let A=1;A<y;A++)R=R<<8|e.getUint8(m+S+A);h.tlv.push({tag:_,length:y,value:n?127^R>>1:127&R})}else if(_===jp.METADATA||_===jp.AUDIO_64_BIT_PTS){const R=new Uint8Array(y);for(let A=0;A<y;A++)R[A]=e.getUint8(m+S+A);h.tlv.push({tag:_,length:y,value:R})}m+=S+y}return h}const OA=new Map,kA=127,R_=1e-10,BL=139/13,NA=new Map;function WL(e,n,i){const o="".concat(e,"-").concat(n,"-").concat(i);let c=0;return NA.has(o)?c=NA.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let y=1;for(let S=h,R=1;S>m;S--,R++)y=y*S/R;return y}(n,e))+e*Math.log(.5)+(n-e)*Math.log(1-.5)-Math.log(i)+i*e,NA.set(o,c)),c<R_&&(c=R_),c}function xz(e,n,i){const o=n.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let y=m+c;m<y;m++)e[m]>i&&_++;n[h]!==_&&(n[h]=_,u=!0)}return u}window.cache=NA;let ape=0;class Mz{constructor(n){Ae(this,"id",void 0),Ae(this,"immediates",[]),Ae(this,"lastNonSilence",-1),Ae(this,"immediateSpeechActivityScore",R_),Ae(this,"lastLevelChangedTime",Date.now()),Ae(this,"levels",[]),Ae(this,"longs",[]),Ae(this,"longSpeechActivityScore",R_),Ae(this,"mediums",[]),Ae(this,"mediumSpeechActivityScore",R_),Ae(this,"minLevel",0),Ae(this,"nextMinLevel",0),Ae(this,"nextMinLevelWindowLength",0),Ae(this,"energyScore",0),this.id=n||"".concat(ape++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const n=this.immediates,i=this.levels,o=this.minLevel+BL;let c=!1;for(let u=0;u<n.length;++u){let h=i[u];h<o&&(h=0);const m=Math.floor(h/BL);n[u]!==m&&(n[u]=m,c=!0)}return c}computeLongs(){return xz(this.mediums,this.longs,4)}computeMediums(){return xz(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=WL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(n){this.longSpeechActivityScore=WL(this.longs[0],10,47),this.longSpeechActivityScore>R_&&(this.lastNonSilence=n)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=WL(this.mediums[0],5,24)}evaluateSpeechActivityScores(n){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(n)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var n;return"[".concat(Hf(n=[...this.levels]).call(n).join(),"]")}getSpeechActivityScore(n){switch(n){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+n)}}levelChanged(n,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=n;return n<0&&(o=0),n>kA&&(o=kA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+BL?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(n){if(n!==0){if(this.minLevel===0||this.minLevel>n)return this.minLevel=n,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=n,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>n&&(this.nextMinLevel=n),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>kA&&(i=kA),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class cpe{constructor(n){Ae(this,"algorithm",void 0),this.algorithm=n}execute(){let n=!this.algorithm;if(!n)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?n=!0:setTimeout(this.execute.bind(this),i)}catch{n=!0}n&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class zL{constructor(n,i,o){Ae(this,"isDominant",void 0),Ae(this,"energyRanking",void 0),Ae(this,"energyScore",void 0),this.isDominant=n,this.energyRanking=i,this.energyScore=o}}class lpe extends Ir{constructor(n){super(),Ae(this,"dominantId",null),Ae(this,"lastDecisionTime",0),Ae(this,"lastLevelChangedTime",0),Ae(this,"lastLevelIdleTime",0),Ae(this,"relativeSpeechActivities",[]),Ae(this,"speakers",new Map),Ae(this,"enableSilence",!1),Ae(this,"timeoutToSilenceInterval",0),Ae(this,"decisionMaker",null),Ae(this,"loudest",[]),Ae(this,"numLoudestToTrack",3),Ae(this,"energyExpireTimeMs",250),Ae(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=n,this.enableSilence=n>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=n,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>n&&this.loudest.splice(n)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(n){return this.loudest.some(i=>i.id===n)}levelChanged(n,i){const o=Date.now(),c=this.getOrCreateSpeaker(n);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(n){return this.decisionMaker!==n||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(n){this.decisionMaker===n&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(n){n.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(n){n.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(n){let i=this.speakers.get(n);return i||(i=new Mz(n),this.speakers.set(n,i),this.maybeStartDecisionMaker()),i}updateLoudestList(n,i,o){const c=n.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==n;)++_;return new zL(c,_,n.energyScore)}if(n.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*n.energyScore+50)/100),this.numLoudestToTrack===0)return new zL(c,0,n.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==n.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<n.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,n),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new zL(c,m,n.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new cpe(this),this.decisionMaker.execute())}makeDecision(n){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Sc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(n),n-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(n);const _=this.relativeSpeechActivities;let y=2;for(const S of this.speakers.entries()){const[R,A]=S;if(A===m)continue;A.evaluateSpeechActivityScores(n);for(let V=0;V<_.length;++V){const q=m==null?R_:m.getSpeechActivityScore(V);_[V]=Math.log(A.getSpeechActivityScore(V)/q)}const k=_[0],W=_[1],U=_[2];k>3&&W>2&&U>0&&W>y&&(y=W,u=R)}this.enableSilence&&m!=null&&u===m.id&&n-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const n=Date.now(),i=300-(n-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(n),this.lastLevelIdleTime=n):o=i;let c=300-(n-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=n,this.makeDecision(n),c=300-(Date.now()-n)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(n){const i=[];for(const c of Sc(o=this.speakers).call(o)){var o;const u=n-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Pv=new Map;let sd=null,DA=null;const Uz=3;let C_=[];const od=new Map,LA=new Map;class upe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(n,i){Ae(this,"id",void 0),Ae(this,"track",void 0),Ae(this,"score",0),Ae(this,"active",!0),Ae(this,"muted",!1),Ae(this,"timer",0),Ae(this,"actives",0),Ae(this,"inactives",0),this.id=n,this.track=i,this.setActive(od.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const n=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(Sc(od).call(od)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&n&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(n){this.active=n,this.resetTimer(),this.setMuted(!n)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const n=function(i){let o;return Array.from(Sc(od).call(od)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);n&&this.activeRate-n.activeRate>.4&&(n.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const n=function(i){let o;return Array.from(Sc(od).call(od)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);n&&n.activeRate-this.activeRate>.4&&(n.setActive(!0),this.setActive(!1))}addSample(n){n?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(n){this.track&&(this.track.enabled=!n,this.muted=n)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let xA;function Vz(e){const n=od.get(e);n&&(od.delete(e),n.clearTimer())}const MA=new Map,dpe=new Map;function hpe(e,n,i){let o=new Uint8Array(e,n,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const UA=new Map,rb=new Map;(function(){const e=Cn();Qi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Qi.getStreamFromExtension=e.name===Un.CHROME&&Number(e.version)>34,Qi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let i=!1;try{n.addTransceiver("audio"),i=!0}catch{}return n.close(),i}(),Qi.supportMinBitrate=e.name===Un.CHROME||e.name===Un.EDGE,Qi.supportSetRtpSenderParameters=function(){const n=Cn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Mp()||!(!hs()&&!hA())||n.name===Un.FIREFOX&&Number(n.version)>=64)}(),e.name===Un.SAFARI&&(Number(e.version)>=14?Qi.supportDualStream=!0:Qi.supportDualStream=!1),Qi.webAudioMediaStreamDest=function(){const n=Cn();return!(n.name===Un.SAFARI&&Number(n.version)<12)}(),Qi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Qi.supportWebGL=typeof WebGLRenderingContext<"u",Qi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Mp()||(Qi.webAudioWithAEC=!0),Qi.supportShareAudio=function(){const n=Cn();return(n.os===Pi.WIN_10||n.os===Pi.WIN_81||n.os===Pi.WIN_7||n.os===Pi.LINUX||n.os===Pi.MAC_OS||n.os===Pi.CHROMIUM_OS)&&n.name===Un.CHROME&&Number(n.version)>=74}(),Qi.supportDataChannel=!!($T(76)||function(n){const i=Cn();return!(i.name!==Un.FIREFOX||!i.osVersion)&&Number(i.version)>=n}(68)||z6(14)),Qi.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!kr()&&!!n&&n.prototype.setConfiguration instanceof Function}(),Qi.supportWebRTCEncodedTransform=function(){const n=Cn();return n.name==="Chrome"&&Number(n.version)>=87||n.name==="Safari"&&Number(n.version)>=15}(),Qi.supportWebRTCInsertableStream=function(){const n=Cn();return(n.name===Un.CHROME||n.name===Un.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Qi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Qi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,mA(()=>{Qi.supportDualStreamEncoding=function(){const n=Cn();return!!re("DISABLE_WEBAUDIO")||n.name==="Safari"&&Number(n.version)>=14||!!(n.name==="Chrome"&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),D.debug("browser ua: ",navigator.userAgent),D.info("browser info: ",e),D.info("browser compatibility: ",Qi)})})();const ppe=["CHINA","GLOBAL"],Fz=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],I_=[],Ov=[];function A_(e,n){return!!n&&I_.some(i=>i.uid===e&&i.channelName===n)}function GL(){return Ov.length>0}var fpe=a5.forEach,jz=up("forEach")?[].forEach:function(e){return fpe(this,e,arguments.length>1?arguments[1]:void 0)};Mn({target:"Array",proto:!0,forced:[].forEach!=jz},{forEach:jz});var mpe=Va("Array").forEach,gpe=uc,_pe=di,Epe=N,ype=mpe,HL=Array.prototype,vpe={DOMTokenList:!0,NodeList:!0},Spe=function(e){var n=e.forEach;return e===HL||Epe(HL,e)&&n===HL.forEach||_pe(vpe,gpe(e))?ype:n},Tpe=l(Spe),bpe=wo,Bz=pc;Mn({target:"Object",stat:!0,forced:d(function(){Bz(1)})},{keys:function(e){return Bz(bpe(e))}});var Wz=l(Et.Object.keys),wpe=l(jE),Rpe=l(WE),Cpe=Mn,zz=Ng,Ipe=t_,Ape=mt,Gz=pe,Ppe=ri,Ope=Te,kpe=_I,Npe=ur,Dpe=cs,Lpe=JB("slice"),xpe=Npe("species"),$L=Array,Mpe=Math.max;Cpe({target:"Array",proto:!0,forced:!Lpe},{slice:function(e,n){var i,o,c,u=Ope(this),h=Ppe(u),m=Gz(e,h),_=Gz(n===void 0?h:n,h);if(zz(u)&&(i=u.constructor,(Ipe(i)&&(i===$L||zz(i.prototype))||Ape(i)&&(i=i[xpe])===null)&&(i=void 0),i===$L||i===void 0))return Dpe(u,m,_);for(o=new(i===void 0?$L:i)(Mpe(_-m,0)),c=0;m<_;m++,c++)m in u&&kpe(o,c,u[m]);return o.length=c,o}});var Upe=Va("Array").slice,Vpe=N,Fpe=Upe,KL=Array.prototype,jpe=function(e){var n=e.slice;return e===KL||Vpe(KL,e)&&n===KL.slice?Fpe:n},Bpe=l(jpe);function _t(e,n,i,o,c){var u,h,m,_={};return Tpe(u=Wz(o)).call(u,function(y){_[y]=o[y]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=wpe(h=Rpe(m=Bpe(i).call(i)).call(m)).call(h,function(y,S){return S(e,n,y)||y},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(KB(e,n,_),_=null),_}let VA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),qL=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),iu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),_o=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Lt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),lr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Wt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Bt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),ib=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),gn=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Eo=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),qt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function FA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw D.error("Invalid Channel Name ".concat(e)),new Pe(X.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function jA(e){if(n=e,!(typeof n=="number"&&Math.floor(n)===n&&0<=n&&n<=4294967295||J6(e,1,255)))throw new Pe(X.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;typeof e=="string"&&D.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Bp=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Wpe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},YL={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function XL(e,n){Xi(e.url,"".concat(n,".url"),1,1e3,!1),Nr(e.x)||tr(e.x,"".concat(n,".x"),0,1e4),Nr(e.y)||tr(e.y,"".concat(n,".y"),0,1e4),Nr(e.width)||tr(e.width,"".concat(n,".width"),0,1e4),Nr(e.height)||tr(e.height,"".concat(n,".height"),0,1e4),Nr(e.zOrder)||tr(e.zOrder,"".concat(n,".zOrder"),0,255),Nr(e.alpha)||tr(e.alpha,"".concat(n,".alpha"),0,1,!1)}const zpe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Sm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),JL=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Si=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Hz(e){if(!e.channelName)throw new Pe(X.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Pe(X.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Xi(e.token,"info.token",1,2047),jA(e.uid),FA(e.channelName),!0}let yo=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Wp=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),_a=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),kv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Gn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Wi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),BA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ki=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Vn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const $z=[Vn.AFRICA,Vn.ASIA,Vn.CHINA,Vn.EUROPE,Vn.GLOBAL,Vn.INDIA,Vn.JAPAN,Vn.NORTH_AMERICA,Vn.OCEANIA,Vn.OVERSEA,Vn.SOUTH_AMERICA];let bs=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const WA={CHINA:{},ASIA:{CODE:bs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:bs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:bs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:bs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:bs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:bs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:bs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:bs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:bs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:bs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:bs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:bs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:bs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};EL&&(WA.CHINA={CODE:bs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let sb=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function Kz(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class qz extends Ir{constructor(n,i){super(),$(this,"onICEConnectionStateChange",void 0),$(this,"onConnectionStateChange",void 0),$(this,"onDTLSTransportStateChange",void 0),$(this,"onDTLSTransportError",void 0),$(this,"onICETransportStateChange",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoReceived",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"onICECandidateError",void 0),$(this,"getLocalVideoStats",void 0)}}class Yz extends qz{constructor(n,i){super(n,i),$(this,"establishPromise",void 0)}}let ft=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),ws=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),zp=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const Xz=["disconnected","failed"];let He=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),zn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ot=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),su=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ou=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),zi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Jz=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),lh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),fl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ad=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Nv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Jr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Dv=function(e){return e.ABORT="abort",e}({}),Tm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Gpe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Hpe={[VA.ACCESS_POINT]:{[_o.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[_o.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[_o.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[_o.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[_o.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[_o.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[VA.UNILBS]:{[iu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[iu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[iu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[iu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[iu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[iu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[iu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[iu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[iu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[iu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[iu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[iu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[VA.STRING_UID_ALLOCATOR]:{[qL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[qL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[qL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Lv(e){const n=Hpe[Math.floor(e/1e4)];if(!n)return{desc:"unknown error",retry:!1};const i=n[e%1e4];if(!i){if(Math.floor(e/1e4)===VA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const $pe={[Lt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Lt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Lt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Lt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Lt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Lt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Lt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Lt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Lt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Lt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Lt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Lt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Lt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Lt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Lt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Lt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Lt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Lt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Lt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Lt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Lt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Lt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Lt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Lt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Lt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Lt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Lt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Lt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Lt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Lt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Lt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Lt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Lt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Lt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Lt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Lt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Lt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Lt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Lt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Lt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Lt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Lt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Lt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Lt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Lt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Lt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Lt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Lt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Lt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Lt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Lt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Lt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Lt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Lt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Lt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Lt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function ob(e){return $pe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function Qz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function QL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Qz(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Qz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Zz(e,n){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(n){const u=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Kpe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,qpe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Ype=/wss:\/\/(.+):([0-9]+)\/?/,Xpe=/wss:\/\/(.[^\/]+)\/?/;let Jpe=0;class Qpe{constructor(n,i){$(this,"id",0),$(this,"store",void 0),$(this,"recordIndex",void 0),$(this,"websockets",[]),$(this,"try443PortDuration",2e3),$(this,"forceCloseWSDuration",5e3),$(this,"try443PortTimeout",null),$(this,"forceCloseTimeout",null),$(this,"isTry443PortFailed",!1),$(this,"isNormalPortFailed",!1),$(this,"useDoubleDomain",!1),$(this,"useProxy",!1),$(this,"startTime",Date.now()),this.id=++Jpe,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var n;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];D.debug("[choose-best-ws ".concat((n=this.store)===null||n===void 0?void 0:n.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(n,i,o){this.logger("createWebSocket:",n,{isTry443Port:i,hasTimeoutDetection:o});const c=re("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(A=>{var k;return st(k=n.host).call(k,A)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(A=>{_.push(Zz(QL(QL({},n),{},{host:n.host.replace(m,A)}),i))});else{const A=QL({},n);if(i&&m){const k=c.find(W=>W!==m);k&&(A.host=A.host.replace(m,k))}_.push(Zz(A,i))}try{_.forEach(A=>{const k=new WebSocket(A);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(A){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,i,o);if(!i&&Number(n.port)!==443)return this.createWebSocket(n,!0,o);throw new Pe(X.WS_ERR,"init websocket failed! Error: ".concat(A.toString()))}const y=HT();this.store&&this.store.recordJoinChannelService({urls:h.map(A=>A.url),service:"gateway"},this.recordIndex),h.forEach(A=>{A.onopen=()=>{this.logger("onopen: ws ".concat(A.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(k=>{k!==A&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,y.resolve(A)},A.onclose=k=>{this.logger("onclose: ws ".concat(A.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(A.readyState));const W=h.every(U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(W)),W&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),y.reject({code:k.code,reason:BA.A_ROUND_WS_FAILED})):!i&&W&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),i?this.isTry443PortFailed=W:this.isNormalPortFailed=W},A.onmessage=k=>this.logger("".concat(A.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(A=>A.readyState!==WebSocket.OPEN&&A.close())},R=()=>{if(y.isResolved)return S();Cn().os===Pi.MAC_OS&&kr()&&S(),this.createWebSocket(n,!0,!0).then(A=>{y.resolve(A)}).catch(A=>{this.isNormalPortFailed&&y.reject(A),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(n,i,o,c){return this.useDoubleDomain=!!i,typeof n=="string"&&(n=function(u){let h,m,_;return[,h,m,_]=u.match(Kpe)||[],h||([,m,_]=u.match(qpe)||[]),m&&_||([,m,_]=u.match(Ype)||[]),m&&_||([,m]=u.match(Xpe)||[]),m||D.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,o&&this.useProxy&&(D.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(n,!!o,!1).finally(()=>this.clearTimeout())}}function eG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class tG extends Ir{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;st(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,this._state==="reconnecting"?this.emit(qt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(qt.CONNECTED):this._state==="closed"?this.emit(qt.CLOSED):this._state==="failed"&&this.emit(qt.FAILED))}resetReconnectCount(n){D.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"urls",[]),$(this,"_reconnectMode","tryNext"),$(this,"reconnectReason",void 0),$(this,"_initMutex",void 0),$(this,"name",void 0),$(this,"_state","closed"),$(this,"reconnectInterrupter",void 0),$(this,"websocket",void 0),$(this,"retryConfig",void 0),$(this,"reconnectCount",0),$(this,"forceCloseTimeout",5e3),$(this,"onlineReconnectListener",void 0),$(this,"useCompress",void 0),$(this,"tryDoubleDomain",!1),$(this,"use443PortOnly",!1),$(this,"wsInflateLength",0),$(this,"wsDeflateLength",0),$(this,"closeEstablishingWs",()=>{}),$(this,"store",void 0),$(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(R){for(var A=1;A<arguments.length;A++){var k=arguments[A]!=null?arguments[A]:{};A%2?eG(Object(k),!0).forEach(function(W){$(R,W,k[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(k)):eG(Object(k)).forEach(function(W){Object.defineProperty(R,W,Object.getOwnPropertyDescriptor(k,W))})}return R}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Ts("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=i,y=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);$a.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S),si.on(pv.NETWORK_STATE_CHANGE,(R,A)=>{R!==A&&(this.resetReconnectCount("network state change: ".concat(A," -> ").concat(R)),R===$a.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=n,this.state="connecting";try{const c=HT(),u=this.urls[this.currentURLIndex];re("ENABLE_PREALLOC_PC")&&this.emit(Jz.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(qt.CLOSED,()=>{c.reject(new De(X.WS_DISCONNECT))}),this.once(qt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,i){if(!this.websocket)return void D.warning("[".concat(this.name,"] can not reconnect, no websocket"));n!==void 0&&(this.reconnectMode=n),D.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new De(X.WS_ABORT,"websocket is not ready");try{i||(n=JSON.stringify(n)),this.websocket.send(n)}catch(o){throw new De(X.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(n){var i;const o=HT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),D.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(D.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new De(X.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const A=bc(this,qt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,k=await this.reconnectWithAction(A);if(this.state==="closed")return void D.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return o.reject(new De(X.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(qt.ON_MESSAGE,S)},m=S=>{D.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(n=re("GATEWAY_WSS_ADDRESS")),D.debug("[".concat(this.name,"] start connect, url:"),n);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;const S=await this.chooseBestWebsocketConnection(n);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const R=this.state==="closed",A=S instanceof De,k=A&&S.code===X.WS_ABORT,W=A&&S.code===X.WS_ERR,U=A?S.message:S&&(S.reason||S.toString());D.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[S]},_),R||W?(o.reject(R?new De(X.WS_DISCONNECT,"websocket is closed: ".concat(U)):new De(X.WS_ERR,"init websocket failed: ".concat(U))),W&&D.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(S)}return o.promise}async reconnectWithAction(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;D.warning("[choose-best-ws] action: =>",n),this.onlineReconnectListener||si.isOnline||!si.onlineWaiter||(this.onlineReconnectListener=si.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=uL(this.reconnectCount,this.retryConfig);D.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(n)),await ct.race([Ji(h),this.onlineReconnectListener||new ct(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(qt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(n==="retry")await c(this.urls[this.currentURLIndex],n);else if(n==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);D.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],n)}else n==="recover"&&(D.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await fs(this,qt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],n))}catch(h){var u;D.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&st(m).call(m,"dynamic key expired")?(this.emit(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(n,i)}return!0}}class ZL extends tG{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){const o=HT(),c=function(h,m){return new Qpe(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new De(X.WS_ABORT,"choose best websocket aborted"))};const u=re("GATEWAY_DOMAINS");return D.debug("[choose-best-ws] currentDomain: ",n,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(n,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class ab extends tG{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){return new ct((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),h.forEach(W=>{W.onclose=null,W.onopen=null,W.onmessage=null,W.close()}),c(new De(X.WS_ABORT,"choose best websocket aborted"))};const m=re("GATEWAY_DOMAINS");let _;const y=n.indexOf("?h="),S=m.find(W=>y!==-1?st(n).call(n,W,y):st(n).call(n,W));D.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var A;const W=Date.now();try{m.forEach(U=>{const V=y===-1?n.replace(S,U):n.substr(0,y)+n.substr(y).replace(S,U),q=new WebSocket(V);q.binaryType="arraybuffer",h.push(q),D.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(D.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(V=>V.close());h.length;)h.pop();R=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:h.map(U=>U.url),service:"gateway"},i),h.forEach(U=>{U.onopen=()=>{if(u)return;const V=Date.now()-W;D.debug("[choose-best-ws] ws open cost ".concat(V,"ms")),h.filter(q=>q!==U).forEach(q=>{D.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(U)},U.onclose=V=>{_=V,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(D.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},U.onmessage=V=>{D.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(V.data))}}),Ji(this.forceCloseTimeout).then(()=>{h.forEach(U=>{U.readyState!==WebSocket.OPEN&&U.close()})})}if(R){var k;let W;D.debug("[choose-best-ws] use single url: ",n),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[n],service:"gateway"},i);try{W=new WebSocket(n),h.push(W),W.binaryType="arraybuffer"}catch(U){const V=new De(X.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return D.error("[".concat(this.name,"]").concat(V)),void c(V)}W.onopen=()=>{o(W)},W.onclose=U=>{c(U)},W.onmessage=U=>{D.debug("[choose-best-ws]".concat(W.url," onmessage: ").concat(U.data))},Ji(this.forceCloseTimeout).then(()=>{W&&W.readyState!==WebSocket.OPEN&&W.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Zpe extends Ir{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===lr.CONNECTED?this.emit(Wt.WS_CONNECTED):n===lr.RECONNECTING?this.emit(Wt.WS_RECONNECTING,this._websocketReconnectReason):n===lr.CLOSED&&this.emit(Wt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new p8(5)),$(this,"pingpongTimer",void 0),$(this,"wsInflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Wt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===gn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===gn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Wn.UID_BANNED);break;case 15:this.close(Wn.IP_BANNED);break;case 16:this.close(Wn.CHANNEL_BANNED)}if(c._type===gn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Wn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Wn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Wn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Wn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Wn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Wn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new ZL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",ps.OFFLINE)})}async request(n,i,o,c){const u=or(6,""),h={_id:u,_type:n,_message:i},m=this.websocket.connectionID,_=()=>new ct((W,U)=>{if(this.connectionState===lr.CONNECTED)return W();const V=()=>{this.off(Wt.WS_CLOSED,q),W()},q=()=>{this.off(Wt.WS_CONNECTED,V),U(new Pe(X.WS_ABORT))};this.once(Wt.WS_CONNECTED,V),this.once(Wt.WS_CLOSED,q),n!==Bt.PUBLISH&&n!==Bt.PUBLISH_DATASTREAM&&n!==Bt.SUBSCRIBE&&n!==Bt.SUBSCRIBE_DATASTREAM&&n!==Bt.UNSUBSCRIBE&&n!==Bt.UNSUBSCRIBE_DATASTREAM&&n!==Bt.UNPUBLISH&&n!==Bt.UNPUBLISH_DATASTREAM&&n!==Bt.CONTROL&&n!==Bt.RESTART_ICE||this.once(Wt.DISCONNECT_P2P,()=>{U(new Pe(X.DISCONNECT_P2P))}),n!==Bt.PUBLISH&&n!==Bt.RESTART_ICE||this.once(Wt.ABORT_P2P_EXECUTION,()=>{U(new Pe(X.DISCONNECT_P2P))})});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||n===Bt.JOIN||n===Bt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new ct((W,U)=>{let V=!1;const q=(ce,_e)=>{V=!0,W({isSuccess:ce==="success",message:_e||{}}),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.emit(Wt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Pe(X.WS_ABORT,"type: ".concat(n))),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Wt.WS_CLOSED,Y),this.once(Wt.WS_RECONNECTING,Y),Ji(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(Wt.REQUEST_TIMEOUT,n,i))})});let S=null;try{S=await y}catch(W){if(this.connectionState===lr.CLOSED||n===Bt.LEAVE)throw new Pe(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?W.throw():n===Bt.JOIN||n===Bt.REJOIN?null:(await _(),await this.request(n,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),A=ob(R),k=new Pe(X.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:A.desc});return A.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(R,", message: ").concat(A.desc,", action: ").concat(A.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((n===Bt.JOIN||n===Bt.REJOIN)&&(this.initError=k,this.close()),k.throw()):A.action==="failed"?k.throw():A.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ps.MULTI_IP)):this.reconnect(A.action,ps.SERVER_ERROR),n===Bt.JOIN||n===Bt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new ct(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(ib.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ct((i,o)=>{this.once(Wt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Wt.WS_CLOSED,c=>o(this.initError||new Pe(X.WS_ABORT,c))),this.connectionState=lr.CONNECTING,this.websocket.init(n).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Wn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Wt.ABORT_P2P_EXECUTION);const n=await fs(this,Wt.REQUEST_JOIN_INFO),i=await this.request(Bt.JOIN,n);if(!i)return this.emit(Wt.REPORT_JOIN_GATEWAY,BA.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Wt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Pe(X.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const n=JT(this,Wt.REQUEST_REJOIN_INFO);n.token=this.reconnectToken;const i=await this.request(Bt.REJOIN,n);return!!i&&(this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(gn.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(gn.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(gn.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(gn.MUTE_AUDIO,{uid:o.uid}):this.emit(gn.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(gn.MUTE_VIDEO,{uid:o.uid}):this.emit(gn.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(gn.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(gn.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(gn.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(gn.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(gn.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){D.debug("[".concat(this.clientId,"] receive notification: "),n);const i=ob(n.code);if(n.code===28&&"detail"in n&&(D.info("[".concat(this.clientId,"] receive recover notification: "),n.detail),this.emit(Wt.RECOVER_NOTIFICATION,n.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Wn.UID_BANNED),void this.close()):void this.reconnect(i.action,ps.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(D.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ps.TIMEOUT):this.request(Bt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(Bt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();n!==0&&i!==0&&this.upload(ib.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(qt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(Wt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(qt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(qt.FAILED,()=>{this._disconnectedReason=Wn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(qt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(qt.WILL_RECONNECT,(n,i,o)=>{const c=JT(this,Wt.IS_P2P_DISCONNECTED),u=c||n!=="retry";c&&n==="retry"&&(D.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",i=BA.P2P_DISCONNECTED),u&&(D.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(Wt.REPORT_JOIN_GATEWAY,i||BA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Wt.DISCONNECT_P2P)),o(n)}),this.websocket.on(qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{D.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",ps.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(Wt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof Pe){if(n.code===X.UNEXPECTED_RESPONSE&&n.data.code===Lt.ERR_NO_AUTHORIZED)return this.initError=new Pe(X.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Wn.TOKEN_EXPIRE);D.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ps.SERVER_ERROR):(this.initError=n,this.close())}})}),this.websocket.on(qt.REQUEST_NEW_URLS,(n,i)=>{fs(this,Wt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Jz.PRE_CONNECT_PC,()=>{this.emit(Wt.PRE_CONNECT_PC)})}}let efe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),oi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function nG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function zA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?nG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function bm(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(D.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function ex(e,n){e.addresses||(e.addresses=[]);const i=function(m,_){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:A,port:k}=R;return{address:"".concat(A,":").concat(k)}});const y=re("GATEWAY_DOMAINS");let S=y[1]&&st(_).call(_,y[1])?1:0;return m.map(R=>{let{domain_prefix:A,port:k,ip:W}=R;if(A)return{address:"".concat(A,".").concat(y[S++%y.length],":").concat(k)};const U=/^[\.\:\d]+$/.test(W),V=U?"".concat(W.replace(/[^\d]/g,"-"),".").concat(y[S++%y.length],":").concat(k):"".concat(W,":").concat(k);return U||D.debug("Cannot recognized as ip address: ".concat(W,", use as host")),{ip:W,port:k,address:V}})}(e.addresses,n),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const y=Ys(c=m[_]).call(c);i[_]&&y&&(i[_].ip6=y)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ka(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function rG(e){const n=e._encoderConfig;if(!n)return{};const i={resolution:n.width&&n.height?"".concat(Ka(n.width),"x").concat(Ka(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return typeof n.frameRate=="number"?(i.maxFrameRate=n.frameRate,i.minFrameRate=n.frameRate):n.frameRate&&(i.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,i.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),i}function iG(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function cb(e,n){let i,o,c;switch(n){case oi.CHOOSE_SERVER:o=4096,c="choose server";break;case oi.CLOUD_PROXY:o=1048576,c="proxy";break;case oi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case oi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Pe(X.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>zA(zA({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:zA(zA({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new Pe(X.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function sG(e,n){return await ct.all(e.addresses.map(async i=>({address:re("USE_TURN_IP")?i.ip:bm(i.ip),tcpport:i.port,udpport:i.port,username:n&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():ms.username,password:n&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await oL(n.toString()):ms.password})))}function tx(e,n){const i=n.getMediaStreamTrack(!0).getSettings(),o=n.videoHeight||i.height,c=n.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Ka(e.height),Ka(e.width)),1):(D.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function wm(e){let{candidateType:n,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:n,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function GA(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(n){return n in yA}(e)?e:yA.L1T3}const oG={[ft.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ft.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function HA(e,n,i){n.forEach(o=>{var c;const u=oG[e].find(m=>{var _;let{key:y}=m;return st(_=o.extensionName).call(_,y)});if(!u)return;const h=i.find(m=>{let{extensionName:_}=m;return st(_).call(_,u.key)});h&&st(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function xv(e,n){n.forEach(i=>{var o;const c=oG[e].find(u=>{var h;let{key:m}=u;return st(h=i.extensionName).call(h,m)});st(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function aG(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||st(e).call(e,"abs-send-time")}function $A(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||st(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function cG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function lG(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?cG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function lb(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=n,{useXR:y}=i;let S=[],R=[],A=[],k=[],W=!1,U=!1;if(ga(e).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||W||(R=q.attributes.payloads,k=q.attributes.extmaps,W=!0),q.media.mediaType!=="audio"||U||(S=q.attributes.payloads,A=q.attributes.extmaps,U=!0))}),!k||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!A||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(S=S.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var Y;return st(m).call(m,((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=R.filter(Y=>{var ce;return st(_).call(_,((ce=Y.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLowerCase())||"")});R=q.concat(c?[]:ix(q,R))}const V=re("UNSUPPORTED_VIDEO_CODEC");return V&&V.length>0&&(R=R.filter(q=>!(q.rtpMap&&st(V).call(V,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:A,videoExtensions:k}}function Rm(e){const n=ga(e);let i,o;for(const c of n.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&n.attributes.fingerprints.length>0&&(o={fingerprints:n.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function uG(e,n){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:n?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:n?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function dG(e,n,i){const{cname:o}=e;let c=[];n&&(c=hG(n)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),D.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=qA(e.rtpCapabilities),y=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{y.push({kind:ft.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:ft.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:y}}function hG(e){let n=[];return e.ip&&typeof e.port=="number"&&(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],D.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),D.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),n}function P_(e,n,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=or(8,"track-"),y={ssrcId:h,attributes:lG({label:_,mslabel:i=i||or(10,""),msid:"".concat(i," ").concat(_)},n&&{cname:n})};if(o.push(y),m!==void 0){const S={ssrcId:m,attributes:lG({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},n&&{cname:n})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function Mv(e,n){n instanceof jr&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=n._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!kr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function nx(e){const n=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");n!==-1&&e.attributes.unrecognized.splice(n,1)}function rx(e,n){var i;if(!(n instanceof fr&&n._encoderConfig&&n._hints.indexOf(ar.SCREEN_TRACK)===-1))return;const o=n._encoderConfig;Nn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Nn().supportMinBitrate&&!st(i=n._hints).call(i,ar.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function pG(e){if(e.media.mediaType!=="video")return;const n=Cn();if(n.name!==Un.SAFARI&&n.os!==Pi.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function KA(e,n,i){if(!n)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),n.twcc===!0){const u=o.find(h=>$A(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>$A(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(A=>A.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(n.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>$A(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(n.remb===!0){const u=o.find(h=>aG(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(A=>A.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(n.remb===!1){const u=e.attributes.extmaps.findIndex(h=>aG(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function fG(e,n,i){if(kr()||e.media.mediaType!=="video"||!(n instanceof fr)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!re("SIMULCAST")||i==="vp9"&&re("ENABLE_SVC")||n._scalabilityMode===void 0||n._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:n._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Lr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Lr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function mG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=lb(y,m,_,"sendonly"),R=lb(y,m,_,"recvonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(au(S,R,"videoExtensions",A,k,W),au(S,R,"videoCodecs",A,k,W),au(S,R,"audioExtensions",A,k,W),au(S,R,"audioCodecs",A,k,W),re("RAISE_H264_BASELINE_PRIORITY")){const U=[],V=[];W.videoCodecs.forEach((q,Y)=>{var ce;if(((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){var _e,ye;const fe=W.videoCodecs[Y+1],ke=fe&&vG(q,fe),qe=(_e=q.fmtp)===null||_e===void 0?void 0:_e.parameters["profile-level-id"],lt=(ye=q.fmtp)===null||ye===void 0?void 0:ye.parameters["packetization-mode"];!qe||qe!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&lt!==re("FIRST_PACKETIZATION_MODE")?ke?V.push([q,fe]):V.push([q]):ke?U.push([q,fe]):U.push([q])}}),U.length>0&&V.length>0&&(D.debug("raising H264 baseline profile priority"),W.videoCodecs.forEach((q,Y)=>{var ce;if(((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){const _e=vG(q,W.videoCodecs[Y+1]),ye=U.shift()||V.shift()||[];ye.length>0&&(_e?W.videoCodecs.splice(Y,2,...ye):W.videoCodecs.splice(Y,1,...ye))}}),k.videoCodecs=k.videoCodecs.filter(q=>{var Y,ce;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((ce=q.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}),re("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(q=>{var Y,ce;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((ce=q.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:A,recv:k,sendrecv:W}}(e,n,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function gG(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},n=lb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(au(e,n,"videoExtensions",i,o,c),au(e,n,"videoCodecs",i,o,c),au(e,n,"audioExtensions",i,o,c),au(e,n,"audioCodecs",i,o,c),re("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){D.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function au(e,n,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(m=>{n[i].some((_,y)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void n[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(m=>{n[i].some((_,y)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void n[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}}function qA(e){const{send:n,recv:i,sendrecv:o}=e;if(!o){if(!n||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:i}}let c,u;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...o.audioCodecs],c.videoCodecs=[...n.videoCodecs,...o.videoCodecs],c.audioExtensions=[...n.audioExtensions,...o.audioExtensions],c.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function Uv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(n=>{var i;return((i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function ub(e,n,i,o){let c=[];if(e===ft.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=n.videoCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(i.videoCodecs.forEach(y=>{const S=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";st(S).call(S,o)?u.push(y):st(S).call(S,"vp9")?h.push(y):st(S).call(S,"vp8")?m.push(y):st(S).call(S,"h264")&&_.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):_.length!==0&&(u=_,y="h264"),D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=n.videoCodecs.filter(y=>u.some(S=>S.payloadType===y.payloadType)))}if(c.length===0&&(D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(n.videoCodecs[0].rtpMap&&n.videoCodecs[0].rtpMap.encodingName)),c=n.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const u=ix(c,n.videoCodecs);c=[...c,...u]}}else c=n.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=n.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function ix(e,n){const i=e.map(o=>o.payloadType.toString());return n.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&st(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function db(e,n,i){const o=n.toString(),c=EG(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=_G(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function _G(e,n,i){const o=ga(e),{useXR:c}=n;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!st(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&Uv(u),c&&st(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),vm(o)}function EG(e,n,i,o){if(re("SDP_LOGGING"))return D.upload("exchanging ".concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),e),n==="offer"?c=>{EG(c,"answer",i==="local"?"remote":"local",o)}:void 0}function yG(e){const n=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(n)&&n.length>0)&&n.some(i=>st(e).call(e,i))}function vG(e,n){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===n.payloadType.toString()}catch{return!1}}function SG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ml(e,n){return typeof re(e)===n?re(e):void 0}function tfe(){try{const e=re("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?SG(Object(o),!0).forEach(function(c){$(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):SG(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e)}catch(e){return D.debug("handle gateway attributes failed: ",e),{}}}const TG={};function Cm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&D.debug("install service ".concat(e.name)),TG[e.name]=e}function Gp(e){const n=TG[e];if(!n)throw new De(X.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return n}function bG(e,n){return Gp("DataStream").create(e,n)}function YA(){return Gp("InterceptFrame").create()}function wG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Hp(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?wG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const sx=new Map;class nfe extends Ir{get state(){return this._state}set state(n){if(n===this._state)return;const i=this._state;this._state=n,n==="DISCONNECTED"&&this._disconnectedReason?this.emit(Wi.CONNECTION_STATE_CHANGE,n,i,this._disconnectedReason):this.emit(Wi.CONNECTION_STATE_CHANGE,n,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){D.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,i){var o,c,u;super(),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"key",void 0),$(this,"ntpOffset",0),$(this,"signal",void 0),$(this,"role",void 0),$(this,"inChannelInfo",{joinAt:null,duration:0}),$(this,"spec",void 0),$(this,"_state","DISCONNECTED"),$(this,"_statsCollector",void 0),$(this,"_disconnectedReason",void 0),$(this,"isSignalRecover",!1),$(this,"hasChangeBGPAddress",!1),$(this,"trafficStatsInterval",void 0),$(this,"networkQualityInterval",void 0),$(this,"_joinGatewayStartTime",0),$(this,"_signalTimeout",!1),$(this,"_clientRoleOptions",void 0),$(this,"_isProactiveJoin",!1),this.store=n,this.spec=i,this.signal=this.store.useP2P?(o={spec:Hp(Hp({},i),{},{retryConfig:i.websocketRetryConfig}),store:n},(c=(u=Gp("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Zpe(Hp(Hp({},i),{},{retryConfig:i.websocketRetryConfig}),n),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(n,i,o){this.store.joinGatewayStart(),n.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=sx.get(n.cname);if(u||(u=new Map,sx.set(n.cname,u)),this._isProactiveJoin=!0,u.has(n.uid)){const y=new Pe(X.UID_CONFLICT);throw bt.joinGateway(n.sid,{lts:c,succ:!1,ec:y.code,addr:null,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:"0",preload:n.preload}),y}u.set(n.uid,!0),this.joinInfo=n,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=n.proxyServer;try{D.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const y=n.gatewayAddrs.map(S=>{let{address:R}=S;const[A,k]=R.split(":"),W={host:A,port:k};return n.proxyServer&&(W.proxy=n.proxyServer),W});h=(await this.signal.init(y)).uid,D.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var _;throw D.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),bt.joinGateway(n.sid,{lts:c,succ:!1,ec:((_=y.data)===null||_===void 0?void 0:_.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:n.preload}),u.delete(n.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),D.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{D.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Wi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Wi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Wi.NETWORK_QUALITY,{uplinkNetworkQuality:iG(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:iG(this._statsCollector.trafficStats.B_dnq)}):this.emit(Wi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Wn.FALLBACK&&(this.state="DISCONNECTING");try{n||this.signal.connectionState!==lr.CONNECTED||await function(o,c){return c===1/0?o:ct.race([o,Ihe(c)])}(this.signal.request(Bt.LEAVE,void 0,!0),3e3)}catch(o){D.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Wn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(Bt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(n,i),this.publish(n,i,!1);throw u}}async publishDataChannel(n,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Bt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(n,i),this.publishDataChannel(n,i,!1);throw h}}async unpublish(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Bt.UNPUBLISH,{stream_id:i,ortc:n},!0)}catch(o){D.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ct.all(n.map(i=>this.signal.request(Bt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){D.warning("unpublish datachannels warning: ",i)}}async presubscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(Bt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(n,i,!1);throw u}}async subscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(Bt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(n,i),await this.subscribe(n,i,!1);throw u}}async subscribeDataChannel(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:n,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Bt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(n,i),await this.subscribeDataChannel(n,i,!1);throw u}}async subscribeAll(n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:n,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(Bt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(n),await this.subscribeAll(n,!1);throw c}}async setVideoProfile(n){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(n);if(i)return this.signal.request(Bt.SET_VIDEO_PROFILE,i);D.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(n,i){try{await this.signal.request(Bt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:n,stream_id:i},!0)}catch(o){D.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ct.all(n.map(o=>this.signal.request(Bt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){D.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(n){try{await this.signal.request(Bt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){D.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(n){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=n;return{gatewayEstablishParams:await this.signal.request(Bt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Bt.GATEWAY_INFO)}async renewToken(n){await this.signal.request(Bt.RENEW_TOKEN,n),this.key=n.token}updateClientRole(n,i){i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=n}async setClientRole(n,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=n);let o,c=0;n==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Bt.SET_CLIENT_ROLE,{role:n,level:c,delay:o,client_ts:Date.now()}),this.role=n}async setRemoteVideoStreamType(n,i){await this.signal.request(Bt.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:i})}async setDefaultRemoteVideoStreamType(n){await this.signal.request(Bt.DEFAULT_VIDEO_STREAM,{stream_type:n})}async setStreamFallbackOption(n,i){await this.signal.request(Bt.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:i})}async pickSVCLayer(n,i){await this.signal.request(Bt.PICK_SVC_LAYER,{stream_id:n,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(n){await this.signal.request(Bt.SET_RTM2_FLAG,{rtm2_flag:n})}async sendExtensionMessage(n,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(n,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Hp({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Bt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=sx.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:ms.username,password:ms.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Hp(Hp({},ms),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const n=await this.signal.request(Bt.TRAFFIC_STATS,void 0,!0);n.timestamp=Date.now(),n.ntp_offset!=null&&(this.ntpOffset=n.ntp_offset),n.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&mA(()=>{this.emit(Wi.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(n)}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new Pe(X.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=re("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Wi.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,st(Ov).call(Ov,c)||Ov.push(c);const u=!(kr()||W6(87)||k8())&&typeof re("ENABLE_PRE_SUB")=="boolean"&&re("ENABLE_PRE_SUB"),h=!k8()&&ml("ENABLE_PREALLOC_PC","boolean"),m=tfe(),_=$T(87)||function(){const S=Cn();if(S.name!==Un.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),y=Hp({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:dl,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:Hp({enableEncodedTransform:!!re("ENABLE_AUDIO_METADATA")&&_||!!re("ENABLE_AUDIO_TOPN")&&QD(Un.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!re("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:ml("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:ml("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:ml("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!re("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ml("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ml("USE_XR","boolean"),enableLossbasedBwe:ml("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("ENABLE_AUT_CC")||void 0,enableCCFallback:ml("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?ml("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ml("PUBLISH_TWCC","boolean"),enableSubTWCC:ml("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ml("USE_PUB_RTX","boolean"),enableSubRTX:ml("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new Pe(X.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Wt.WS_RECONNECT_CREATE_CONNECTION,n=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Wt.WS_RECONNECTING,n=>{this.joinInfo&&bt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||ps.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",bt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Wt.WS_CLOSED,n=>{let i;switch(n){case Wn.LEAVE:i=ps.LEAVE;break;case Wn.UID_BANNED:case Wn.IP_BANNED:case Wn.CHANNEL_BANNED:case Wn.SERVER_ERROR:i=ps.SERVER_ERROR;break;case Wn.FALLBACK:i=ps.FALLBACK;break;case Wn.LICENSE_MISSING:case Wn.LICENSE_EXPIRED:case Wn.LICENSE_MINUTES_EXCEEDED:case Wn.LICENSE_PERIOD_INVALID:case Wn.LICENSE_MULTIPLE_SDK_SERVICE:case Wn.LICENSE_ILLEGAL:case Wn.TOKEN_EXPIRE:i=n;break;default:i=ps.NETWORK_ERROR}D.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+ps.NETWORK_ERROR)),this.joinInfo&&bt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:n===Wn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=n,n!==Wn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Wt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const n=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;n&&(n.level||n.delay)&&(D.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(n.level,", delay: ").concat(n.delay)),this.setClientRole(this.role,n))}if(bt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const n=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!n)return void D.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(n));Jn("EVENT_REPORT_DOMAIN",n[1]),Jn("EVENT_REPORT_BACKUP_DOMAIN",n[1]),Jn("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}}),this.signal.on(gn.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on(Wt.REQUEST_RECOVER,(n,i,o)=>{if(!this.joinInfo)return o(new Pe(X.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,fs(this,Wi.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Wt.REQUEST_JOIN_INFO,async(n,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void n(this.getJoinMessage({ortc:{}}));const u=Lr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(re("NEW_TURN_MODE")&&u){let y=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;y.length>0&&(y=[y[R%y.length]],u.servers=y),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),D.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await fs(this,Wi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{n(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(y){i(y)}}),this.signal.on(Wt.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on(Wt.REPORT_JOIN_GATEWAY,(n,i)=>{if(!this.joinInfo)return;let o,c="";var u;n instanceof Pe?(o=((u=n.data)===null||u===void 0?void 0:u.desc)||n.code,c=n.message):o=n,bt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Wt.IS_P2P_DISCONNECTED,n=>{n(JT(this,Wi.IS_P2P_DISCONNECTED))}),this.signal.on(Wt.DISCONNECT_P2P,()=>{this.emit(Wi.DISCONNECT_P2P)}),this.signal.on(Wt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Wt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Wt.JOIN_RESPONSE,n=>{const i=this.getCurrentGatewayAddress();this.emit(Wi.JOIN_RESPONSE,n,i)}),this.signal.on(Wt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const n=this.getCurrentGatewayAddress(),i=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(n&&i){const o=hG(n);this.emit(Wi.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(Wt.RECOVER_NOTIFICATION,n=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(n))})}async tryUnsubBeforeResub(n,i){try{await this.signal.request(Bt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:n,ortc:[i]},!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(n,i){try{await this.signal.request(Bt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw D.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(n,i){try{await this.signal.request(Bt.UNPUBLISH,{stream_id:n,ortc:i},!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(n,i){try{await this.signal.request(Bt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw D.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(n){const i={users:n.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Bt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(n,i){const o={action:n.find(c=>c.stream_type===Gn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(Bt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(n,i){const o={action:n.find(c=>c.stream_type===Gn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(Bt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(n,i){const o={action:n===ft.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Bt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(n,i){const o={action:n===ft.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Bt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(n){this.signal.uploadWRTCStats(n)}upload(n,i){this.signal.upload(n,i)}getSignalRTT(){return this.signal.rtt}async restartICE(n){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:n};try{return await this.signal.request(Bt.RESTART_ICE,i,!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(n,i){this.state==="CONNECTED"&&this.signal.reconnect(n||void 0,i||ps.P2P_FAILED)}getCurrentGatewayAddress(){var n,i;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(n=this.joinInfo)!==null&&n!==void 0&&n.apGatewayAddress?(D.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(n){await this.signal.request(Bt.SET_PARAMETER,{enablePublishAudioFilter:n})}}let XA=0,ox=0;function cd(e,n,i,o){return new ct((c,u)=>{n.timeout=n.timeout||re("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),XA+=ih(n.data)):i&&(n.data.size?XA+=n.data.size:n.data instanceof FormData?XA+=o8(n.data):XA+=ih(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Bo.request(n).then(h=>{typeof h.data=="string"?ox+=ih(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?ox+=h.data.byteLength:ox+=ih(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Bo.isCancel(h)?u(new Pe(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Pe(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Pe(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Pe(X.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function n(Fe){var rt=0;return function(){return rt<Fe.length?{done:!1,value:Fe[rt++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(Fe,rt,vt){return Fe==Array.prototype||Fe==Object.prototype||(Fe[rt]=vt.value),Fe},o,c=function(Fe){Fe=[typeof globalThis=="object"&&globalThis,Fe,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var rt=0;rt<Fe.length;++rt){var vt=Fe[rt];if(vt&&vt.Math==Math)return vt}throw Error("Cannot find global object")}(this);function u(Fe,rt){if(rt)e:{var vt=c;Fe=Fe.split(".");for(var We=0;We<Fe.length-1;We++){var x=Fe[We];if(!(x in vt))break e;vt=vt[x]}(rt=rt(We=vt[Fe=Fe[Fe.length-1]]))!=We&&rt!=null&&i(vt,Fe,{configurable:!0,writable:!0,value:rt})}}function h(Fe){return(Fe={next:Fe})[Symbol.iterator]=function(){return this},Fe}function m(Fe){var rt=typeof Symbol<"u"&&Symbol.iterator&&Fe[Symbol.iterator];return rt?rt.call(Fe):{next:n(Fe)}}if(u("Symbol",function(Fe){function rt(x,ie){this.A=x,i(this,"description",{configurable:!0,writable:!0,value:ie})}if(Fe)return Fe;rt.prototype.toString=function(){return this.A};var vt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",We=0;return function x(ie){if(this instanceof x)throw new TypeError("Symbol is not a constructor");return new rt(vt+(ie||"")+"_"+We++,ie)}}),u("Symbol.iterator",function(Fe){if(Fe)return Fe;Fe=Symbol("Symbol.iterator");for(var rt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),vt=0;vt<rt.length;vt++){var We=c[rt[vt]];typeof We=="function"&&typeof We.prototype[Fe]!="function"&&i(We.prototype,Fe,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return Fe}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var y={};try{y.__proto__={a:!0},_=y.a;break e}catch{}_=!1}o=_?function(Fe,rt){if(Fe.__proto__=rt,Fe.__proto__!==rt)throw new TypeError(Fe+" is not extensible");return Fe}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function A(Fe){if(Fe.m)throw new TypeError("Generator is already running");Fe.m=!0}function k(Fe,rt){return Fe.h=3,{value:rt}}function W(Fe){this.g=new R,this.G=Fe}function U(Fe,rt,vt,We){try{var x=rt.call(Fe.g.j,vt);if(!(x instanceof Object))throw new TypeError("Iterator result "+x+" is not an object");if(!x.done)return Fe.g.m=!1,x;var ie=x.value}catch(ue){return Fe.g.j=null,Fe.g.s(ue),V(Fe)}return Fe.g.j=null,We.call(Fe.g,ie),V(Fe)}function V(Fe){for(;Fe.g.h;)try{var rt=Fe.G(Fe.g);if(rt)return Fe.g.m=!1,{value:rt.value,done:!1}}catch(vt){Fe.g.v=void 0,Fe.g.s(vt)}if(Fe.g.m=!1,Fe.g.l){if(rt=Fe.g.l,Fe.g.l=null,rt.F)throw rt.D;return{value:rt.return,done:!0}}return{value:void 0,done:!0}}function q(Fe){this.next=function(rt){return Fe.o(rt)},this.throw=function(rt){return Fe.s(rt)},this.return=function(rt){return function(vt,We){A(vt.g);var x=vt.g.j;return x?U(vt,"return"in x?x.return:function(ie){return{value:ie,done:!0}},We,vt.g.return):(vt.g.return(We),V(vt))}(Fe,rt)},this[Symbol.iterator]=function(){return this}}function Y(Fe,rt){return rt=new q(new W(rt)),S&&Fe.prototype&&S(rt,Fe.prototype),rt}if(R.prototype.o=function(Fe){this.v=Fe},R.prototype.s=function(Fe){this.l={D:Fe,F:!0},this.h=this.C||this.u},R.prototype.return=function(Fe){this.l={return:Fe},this.h=this.u},W.prototype.o=function(Fe){return A(this.g),this.g.j?U(this,this.g.j.next,Fe,this.g.o):(this.g.o(Fe),V(this))},W.prototype.s=function(Fe){return A(this.g),this.g.j?U(this,this.g.j.throw,Fe,this.g.o):(this.g.s(Fe),V(this))},u("Array.prototype.entries",function(Fe){return Fe||function(){return function(rt,vt){rt instanceof String&&(rt+="");var We=0,x=!1,ie={next:function(){if(!x&&We<rt.length){var ue=We++;return{value:vt(ue,rt[ue]),done:!1}}return x=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(rt,vt){return[rt,vt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ce=function(Fe,rt){for(var vt=0;vt<Fe.length;vt++)rt(Fe[vt])},_e=function(Fe){return Fe.replace(/\r?\n|\r/g,`\r
`)},ye=function(Fe,rt,vt){return rt instanceof Blob?(vt=vt!==void 0?vt+"":typeof rt.name=="string"?rt.name:"blob",rt.name===vt&&Object.prototype.toString.call(rt)!=="[object Blob]"||(rt=new File([rt],vt)),[String(Fe),rt]):[String(Fe),String(rt)]},fe=function(Fe,rt){if(Fe.length<rt)throw new TypeError(rt+" argument required, but only "+Fe.length+" present.")},ke=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,qe=ke.FormData,lt=ke.XMLHttpRequest&&ke.XMLHttpRequest.prototype.send,ht=ke.Request&&ke.fetch,yn=ke.navigator&&ke.navigator.sendBeacon,vn=ke.Element&&ke.Element.prototype,cr=ke.Symbol&&Symbol.toStringTag;cr&&(Blob.prototype[cr]||(Blob.prototype[cr]="Blob"),"File"in ke&&!File.prototype[cr]&&(File.prototype[cr]="File"));try{new File([],"")}catch{ke.File=function(rt,vt,We){return rt=new Blob(rt,We||{}),Object.defineProperties(rt,{name:{value:vt},lastModified:{value:+(We&&We.lastModified!==void 0?new Date(We.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),cr&&Object.defineProperty(rt,cr,{value:"File"}),rt}}var Qr=function(Fe){return Fe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Br=function(Fe){this.i=[];var rt=this;Fe&&ce(Fe.elements,function(vt){if(vt.name&&!vt.disabled&&vt.type!=="submit"&&vt.type!=="button"&&!vt.matches("form fieldset[disabled] *"))if(vt.type==="file"){var We=vt.files&&vt.files.length?vt.files:[new File([],"",{type:"application/octet-stream"})];ce(We,function(x){rt.append(vt.name,x)})}else vt.type==="select-multiple"||vt.type==="select-one"?ce(vt.options,function(x){!x.disabled&&x.selected&&rt.append(vt.name,x.value)}):vt.type==="checkbox"||vt.type==="radio"?vt.checked&&rt.append(vt.name,vt.value):(We=vt.type==="textarea"?_e(vt.value):vt.value,rt.append(vt.name,We))})};if((e=Br.prototype).append=function(Fe,rt,vt){fe(arguments,2),this.i.push(ye(Fe,rt,vt))},e.delete=function(Fe){fe(arguments,1);var rt=[];Fe=String(Fe),ce(this.i,function(vt){vt[0]!==Fe&&rt.push(vt)}),this.i=rt},e.entries=function Fe(){var rt,vt=this;return Y(Fe,function(We){if(We.h==1&&(rt=0),We.h!=3)return rt<vt.i.length?We=k(We,vt.i[rt]):(We.h=0,We=void 0),We;rt++,We.h=2})},e.forEach=function(Fe,rt){fe(arguments,1);for(var vt=m(this),We=vt.next();!We.done;We=vt.next()){var x=m(We.value);We=x.next().value,x=x.next().value,Fe.call(rt,x,We,this)}},e.get=function(Fe){fe(arguments,1);var rt=this.i;Fe=String(Fe);for(var vt=0;vt<rt.length;vt++)if(rt[vt][0]===Fe)return rt[vt][1];return null},e.getAll=function(Fe){fe(arguments,1);var rt=[];return Fe=String(Fe),ce(this.i,function(vt){vt[0]===Fe&&rt.push(vt[1])}),rt},e.has=function(Fe){fe(arguments,1),Fe=String(Fe);for(var rt=0;rt<this.i.length;rt++)if(this.i[rt][0]===Fe)return!0;return!1},e.keys=function Fe(){var rt,vt,We,x,ie=this;return Y(Fe,function(ue){if(ue.h==1&&(rt=m(ie),vt=rt.next()),ue.h!=3)return vt.done?void(ue.h=0):(We=vt.value,x=m(We),k(ue,x.next().value));vt=rt.next(),ue.h=2})},e.set=function(Fe,rt,vt){fe(arguments,2),Fe=String(Fe);var We=[],x=ye(Fe,rt,vt),ie=!0;ce(this.i,function(ue){ue[0]===Fe?ie&&(ie=!We.push(x)):We.push(ue)}),ie&&We.push(x),this.i=We},e.values=function Fe(){var rt,vt,We,x,ie=this;return Y(Fe,function(ue){if(ue.h==1&&(rt=m(ie),vt=rt.next()),ue.h!=3)return vt.done?void(ue.h=0):(We=vt.value,(x=m(We)).next(),k(ue,x.next().value));vt=rt.next(),ue.h=2})},Br.prototype._asNative=function(){for(var Fe=new qe,rt=m(this),vt=rt.next();!vt.done;vt=rt.next()){var We=m(vt.value);vt=We.next().value,We=We.next().value,Fe.append(vt,We)}return Fe},Br.prototype._blob=function(){var Fe="----formdata-polyfill-"+Math.random(),rt=[],vt="--"+Fe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(We,x){return typeof We=="string"?rt.push(vt+Qr(_e(x))+`"\r
\r
`+_e(We)+`\r
`):rt.push(vt+Qr(_e(x))+'"; filename="'+Qr(We.name)+`"\r
Content-Type: `+(We.type||"application/octet-stream")+`\r
\r
`,We,`\r
`)}),rt.push("--"+Fe+"--"),new Blob(rt,{type:"multipart/form-data; boundary="+Fe})},Br.prototype[Symbol.iterator]=function(){return this.entries()},Br.prototype.toString=function(){return"[object FormData]"},vn&&!vn.matches&&(vn.matches=vn.matchesSelector||vn.mozMatchesSelector||vn.msMatchesSelector||vn.oMatchesSelector||vn.webkitMatchesSelector||function(Fe){for(var rt=(Fe=(this.document||this.ownerDocument).querySelectorAll(Fe)).length;0<=--rt&&Fe.item(rt)!==this;);return-1<rt}),cr&&(Br.prototype[cr]="FormData"),lt){var Ko=ke.XMLHttpRequest.prototype.setRequestHeader;ke.XMLHttpRequest.prototype.setRequestHeader=function(Fe,rt){Ko.call(this,Fe,rt),Fe.toLowerCase()==="content-type"&&(this.B=!0)},ke.XMLHttpRequest.prototype.send=function(Fe){Fe instanceof Br?(Fe=Fe._blob(),this.B||this.setRequestHeader("Content-Type",Fe.type),lt.call(this,Fe)):lt.call(this,Fe)}}ht&&(ke.fetch=function(Fe,rt){return rt&&rt.body&&rt.body instanceof Br&&(rt.body=rt.body._blob()),ht.call(this,Fe,rt)}),yn&&(ke.navigator.sendBeacon=function(Fe,rt){return rt instanceof Br&&(rt=rt._asNative()),yn.call(this,Fe,rt)}),ke.FormData=Br}})();const hb=()=>{const e=re("AREAS");return e.length===0&&e.push(Vn.GLOBAL),Fa(e).call(e,(n,i,o)=>{const c=RG(i);return c?o===0?c:"".concat(n,",").concat(c):n},"")},RG=e=>e===Vn.OVERSEA?"".concat(bs.ASIA,",").concat(bs.EUROPE,",").concat(bs.AFRICA,",").concat(bs.NORTH_AMERICA,",").concat(bs.SOUTH_AMERICA,",").concat(bs.OCEANIA):bs[e],rfe=e=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=WA[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(n[u]=n[u].concat(o[u]))})}),n},JA={GLOBAL:{ASIA:[Vn.CHINA,Vn.JAPAN,Vn.INDIA,Vn.KOREA,Vn.HKMC],EUROPE:[],NORTH_AMERICA:[Vn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},QA=Object.keys(JA[Vn.GLOBAL]),ax=[Vn.CHINA,Vn.NORTH_AMERICA,Vn.EUROPE,Vn.ASIA,Vn.JAPAN,Vn.INDIA,Vn.OCEANIA,Vn.SOUTH_AMERICA,Vn.AFRICA,Vn.KOREA,Vn.HKMC,Vn.US],ife=function(e,n){let i=[];if(st(e).call(e,Vn.GLOBAL)){const u=[Vn.GLOBAL,Vn.OVERSEA],h=Object.keys(WA);if(n===Vn.GLOBAL)throw new Pe(X.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===Vn.CHINA)i=[Vn.OVERSEA];else if(c=n,st(QA).call(QA,c)){const m=(o=n,JA[Vn.GLOBAL][o]||[]),_=[...u,n,...m];i=h.filter(y=>!st(_).call(_,y))}else if(function(m){let _=!1;return QA.forEach(y=>{var S;st(S=JA[Vn.GLOBAL][y]).call(S,m)&&(_=!0)}),_}(n)){const m=function(y){let S;return QA.forEach(R=>{var A;st(A=JA[Vn.GLOBAL][R]).call(A,y)&&(S=R)}),S}(n),_=[...u,m,n];i=h.filter(y=>!st(_).call(_,y))}else i=e;i=function(m){const _=[];return ax.forEach(y=>{st(m).call(m,y)&&_.push(y)}),_.concat(m.filter(y=>!st(ax).call(ax,y)))}(i)}else i=e;var o,c;return i};function CG(e){var n,i;if(!e&&st(n=re("AREAS")).call(n,Vn.EXTENSIONS))return D.debug("update area from ap : reset"),void cx(ppe,!0);if(!st(i=re("AREAS")).call(i,Vn.GLOBAL)||!e)return;let o=WA.EXTENSIONS;o&&(o={CODE:RG(Vn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},D.debug("update area from ap success: ".concat(e,",config is "),o),Jn("AREAS",[Vn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Jn(c,o[c][0]):Jn(c,o[c])}))}function cx(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=bt.reportApiInvoke(null,{name:fi.SET_AREA,options:e,tag:Dr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!st($z).call($z,u))throw new Pe(X.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Pe(X.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?ife(m,h):m}if(!n){if(id.AREAS){const u=new Pe(X.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void D.warning("setArea is prohibited because of config-distribute")}if(st(o).call(o,Vn.GLOBAL)&&re("AREAS")===Vn.EXTENSIONS){const u=new Pe(X.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void D.warning("setArea is prohibited because of ap extensions")}}Jn("AREAS",o,n);const c=rfe(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Jn(u,c[u][0]):Jn(u,c[u])}),D.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function IG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function uh(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?IG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):IG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let lx=1;function sfe(e,n,i,o,c){lx+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:lx,requestId:lx,version:dl,cname:i.cname},h={service_name:n,json_body:JSON.stringify(u)};let m,_,y=e[0];return rd(async()=>{m=Date.now();const S=await cd(y,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const k=new Pe(X.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw D.error(k.toString()),k}const R=JSON.parse(S.json_body);if(R.code!==200){const k=new Pe(X.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:_});throw D.error(k.toString()),k}if(!R.servers||R.servers.length===0){const k=new Pe(X.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:_});throw D.error(k.toString()),k}const A=function(k,W){return{addressList:k.servers.map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(W))),workerToken:k.workerToken,vid:k.vid}}(R,n);return re("LIVE_STREAMING_ADDRESS")&&(A.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),uh(uh({},A),{},{responseTime:_})},(S,R)=>(bt.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:_,serverIp:e[R%e.length]}),!1),(S,R)=>(bt.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:n,responseTime:_,serverIp:e[R%e.length]}),!!(S.code!==X.OPERATION_ABORTED&&S.code!==X.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(y=e[(R+1)%e.length],!0)),c)}let ux=1;function AG(e,n,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=n,_=Date.now();let y;const S=n.role,[R,A]=hx(n,u,[oi.CHOOSE_SERVER]);let k=si.networkState;return rd(async()=>{k&&si.networkState===$a.OFFLINE&&si.onlineWaiter&&await ct.race([si.onlineWaiter,Ji(o&&o.maxRetryTimeout||mi.maxRetryTimeout)]),k=si.networkState;const{data:W,headers:U}=await cd(c,{data:R,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=U.http3==="1"?1:-1,bt.reportResourceTiming(c,m),OG(W,c,n,_,[oi.CHOOSE_SERVER],y);const V=cb(W,oi.CHOOSE_SERVER);return dx(V),ex(V,c)},W=>(W&&bt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:A,serverList:W.gatewayAddrs.map(U=>U.address),ec:null,cid:W.cid.toString(),uid:W.uid.toString(),csIp:W.csIp,unilbsServerIds:[oi.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:W.res.detail&&W.res.detail[38]}),!1),W=>W.code!==X.OPERATION_ABORTED&&(W.code===X.CAN_NOT_GET_GATEWAY_SERVER?W.data.retry:(bt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:A,ec:W.code,csIp:W.data&&W.data.csIp,unilbsServerIds:[oi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:y,corssRegionTagReq:n.apRequestDetail}),D.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),W),!0)),o)}function PG(e,n,i,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),y=n.role,[S,R]=hx(n,h,m);let A;return rd(async()=>{A&&si.networkState===$a.OFFLINE&&si.onlineWaiter&&await ct.race([si.onlineWaiter,Ji(o&&o.maxRetryTimeout||mi.maxRetryTimeout)]),A=si.networkState;const{data:k,headers:W}=await cd(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=W.http3==="1"?1:-1,bt.reportResourceTiming(u,n.sid),OG(k,u,n,_,m,c);const U=cb(k,oi.CHOOSE_SERVER),V=cb(k,n.cloudProxyServer==="proxy5"?oi.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?oi.CLOUD_PROXY:oi.CLOUD_PROXY_FALLBACK);return dx(U),{gatewayInfo:ex(U,u),proxyInfo:V,url:u}},k=>(k.gatewayInfo&&bt.joinChooseServer(n.sid,{role:y,lts:_,succ:!0,csAddr:u,serverList:k.gatewayInfo.gatewayAddrs.map(W=>W.address),ec:null,opid:R,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38]}),k.proxyInfo&&bt.joinWebProxyAP(n.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:k.proxyInfo.addresses.map(W=>W.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==X.OPERATION_ABORTED&&(k.code===X.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(bt.joinWebProxyAP(n.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:k.code,eventType:n.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:A})}),D.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),k),!0)),o)}const OG=(e,n,i,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=i,y=[],S=R=>{R.flag===4096?bt.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:n,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||bt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:R.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const A=R.buffer.code;if(R.uri===23&&A===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const k={error:new Pe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};y.push(k),S(k)}if(A!==0){const k=Lv(A),W={error:new Pe(X.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?D.warning(W.error.toString()):y.push(W),S(W)}}),y.length)throw D.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(n," failed, ").concat(y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Pe(X.CAN_NOT_GET_GATEWAY_SERVER,y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!y.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(R=>{var A;return R==null||(A=R.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc}).filter(R=>!!R))]})},dx=e=>{var n,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Pe(X.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(re("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?CG(e.detail[23].toLowerCase()):CG()),(n=e.detail)!==null&&n!==void 0&&n[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const y=Ys(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=y)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){D.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const h=re("GATEWAY_ADDRESS").map(m=>{var _,y;const S=(_=(y=e.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},ofe=(e,n)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=Lv(i.buffer.code);throw new Pe(X.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw D.debug("update ticket request received ap response without response body:",n),new Pe(X.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},hx=(e,n,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:uh(uh(uh({6:e.stringUid,11:n,12:re("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:n},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},afe=(e,n)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:n,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let Vv=0;function Fv(e){return ct.all(e.map(n=>n.then(i=>{throw i},i=>i))).then(n=>{throw n},n=>n)}const pb=async e=>{let{fragementLength:n,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=n;let _,y=0;const S=async()=>{const R=(()=>{const A=h*m,k=A+m;return i.slice(A,k).map(o)})();u&&u.push(...R);try{_=await Fv(R)}catch(A){if(y+=m,h++,!(y>=i.length))return void await S();c(A)}R.forEach(A=>A.cancel())};return await S(),_},kG=async e=>{let{referenceList:n,asyncMapHandler:i,closeFn:o}=e;const c=n.length;let u=0;const h=async()=>{const m=i(n.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function px(e,n,i,o){return{gatewayInfo:await async function(u,h,m,_){let y=null;const S=[],R=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:hb()})),W=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await pb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to choose_server:"),V.url),AG(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U},A=async()=>{if(await Ji(1e3),y!==null)return y;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:hb()})),W=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await pb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),V.url),AG(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U};try{return y=await Fv([R(),A()]),S.length&&S.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),y}catch(k){throw k[0]}}(e,n,i,o)}}async function NG(e,n,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await px(e,n,i,c);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:A,proxyInfo:k}=await xG(e,n,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:A};const W=k.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||ms.tcpport,udpport:U.udpport||ms.udpport,username:U.username||ms.username,password:U.password||ms.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const U=(h=e.uid)!==null&&h!==void 0?h:A.uid,V="glb:".concat(U.toString()),q=await oL(V),Y=k.map(ce=>({turnServerURL:ce.address,tcpport:ce.tcpport||ms.tcpport,udpport:ce.udpport||ms.udpport,username:V,password:q,forceturn:!1,security:!0}));W.push(...Y)}return e.turnServer={mode:"manual",servers:W},{gatewayInfo:A}}return await px(e,n,i,c)}const{proxyInfo:m,gatewayInfo:_}=await xG(e,n,i,c),y={gatewayInfo:_},S=m.map(A=>({turnServerURL:A.address,tcpport:u==="proxy3"?void 0:A.tcpport?A.tcpport:ms.tcpport,udpport:u==="proxy4"?void 0:A.udpport?A.udpport:ms.udpport,username:A.username||ms.username,password:A.password||ms.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const A=(R=e.uid)!==null&&R!==void 0?R:_.uid,k="glb:".concat(A.toString()),W=await oL(k),U=m.map(V=>({turnServerURL:V.address,tcpport:u==="proxy3"?void 0:V.tcpport||ms.tcpport,udpport:u==="proxy4"?void 0:V.udpport||ms.udpport,username:k,password:W,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...U)}return e.turnServer={mode:"manual",servers:S},D.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function DG(e,n,i,o,c){const u=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let h=[];h=n.proxyServer?u.map(_=>"https://".concat(n.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(y,S,R,A,k){const W=Date.now(),U={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let V=y[0];const q=await rd(()=>cd(V+"".concat(V.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,ce)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw D.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),bt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:X.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new Pe(X.INVALID_UINT_UID_FROM_STRING_UID);return bt.reqUserAccount(U.sid,{lts:W,success:!0,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:null,extend:U}),!1}const _e=Lv(Y.code);return _e.retry&&(V=y[(ce+1)%y.length]),bt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:_e.desc,extend:U}),_e.retry},(Y,ce)=>Y.code!==X.OPERATION_ABORTED&&(bt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:null,errorCode:Y.code,extend:U}),V=y[(ce+1)%y.length],!0),k);if(q.code!==0){const Y=Lv(q.code);throw new Pe(X.UNEXPECTED_RESPONSE,Y.desc)}return q}(h,e,n,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function cfe(e,n,i){const o=re("ACCOUNT_REGISTER");let c=[];c=n.proxyServer?o.map(u=>"https://".concat(n.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await kG({referenceList:c,asyncMapHandler:h=>async function(m,_,y,S){const R=Date.now(),A={sid:y.sid,opid:10,appid:y.appId,string_uid:_};try{const k=await cd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const W=Lv(k.code);throw new Pe(X.UNEXPECTED_RESPONSE,"preload sua error:".concat(W.desc),W)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Pe(X.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:A,uid:k.uid,elapse:Date.now()-R}}catch(k){throw k}}(h,e,n,i),closeFn:h=>h.code===X.OPERATION_ABORTED||h.code===X.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function lfe(e,n,i){const o=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(y,S,R,A){const k=Cn(),W={flag:64,cipher_method:0,features:uh(uh(uh(uh(uh({install_id:_L(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:S.appId,version:dl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:efe.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return rd(()=>cd(y,{data:W,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,U=>U.code!==X.OPERATION_ABORTED,A)}(_,e,n,i));let u=null,h=null,m={};try{u=await Fv(c)}catch(_){if(_.code===X.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),bt.reportApiInvoke(e.sid,{name:fi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const y=_.test_tags,S=Object.keys(y),R={};return S.forEach(A=>{var k;const W=Ys(k=A.slice(4)).call(k),U=JSON.parse(y[A]),V=U[1];R[W]={tag:U[0]||"",value:V}}),R}(u)}catch{}return m}async function LG(e,n){const i=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:hb(),serviceIds:[oi.CHOOSE_SERVER,oi.CLOUD_PROXY_FALLBACK]}));try{return await kG({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let _,{url:y,areaCode:S,serviceIds:R}=u;const A=Date.now(),[k,W]=hx(h,S,R);let U=si.networkState;try{U&&si.networkState===$a.OFFLINE&&si.onlineWaiter&&await ct.race([si.onlineWaiter,Ji(mi.maxRetryTimeout)]),U=si.networkState;const{data:V,headers:q}=await cd(y,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(ye=>{const fe=[];if(ye.response_body.forEach(ke=>{const qe=ke.buffer.code;if(ke.uri===23&&qe===0&&!ke.buffer.edges_services)if(ke.buffer.flag===4194310)ke.buffer.edges_services=[];else{const lt={error:new Pe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ye.detail[502]}),flag:ke.buffer.flag};fe.push(lt)}if(qe!==0){const lt=Lv(qe),ht={error:new Pe(X.CAN_NOT_GET_GATEWAY_SERVER,lt.desc,{desc:lt.desc,retry:lt.retry,csIp:ye.detail[502]}),flag:ke.buffer.flag};ke.buffer.flag===4194310?D.warning(ht.error.toString()):fe.push(ht)}}),fe.length)throw new Pe(X.CAN_NOT_GET_GATEWAY_SERVER,fe.map(ke=>"flag: ".concat(ke.flag,", message: ").concat(ke.error.message)).join(" | "),{retry:!!fe.find(ke=>ke.error.data.retry),csIp:ye.detail[502],desc:[...new Set(fe.map(ke=>{var qe;return ke==null||(qe=ke.error)===null||qe===void 0||(qe=qe.data)===null||qe===void 0?void 0:qe.desc}).filter(ke=>!!ke))]})})(V);const ce=cb(V,oi.CHOOSE_SERVER),_e=cb(V,oi.CLOUD_PROXY_FALLBACK);return dx(ce),{gatewayInfo:ex(ce,y),proxyInfo:_e,opid:W,requestTime:A,url:y,isHttp3:_,elapse:Date.now()-A}}catch(V){throw V}}(c,e,n),closeFn:c=>c.code===X.OPERATION_ABORTED||c.code===X.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function xG(e,n,i,o){const c=re("PROXY_SERVER_TYPE3"),u=(k,W,U)=>{let V=U||c;return Array.isArray(V)&&(V=W%2==0?c[1]:c[0]),"https://".concat(V,"/ap/?url=").concat(k)};let h=null;const m=[],_=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:hb(),serviceIds:[oi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?oi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?oi.CLOUD_PROXY:oi.CLOUD_PROXY_FALLBACK]}}),W=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await pb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to choose_server:"),V.url),PG(V,e,n,i)),allFailedhandler:V=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U},y=async()=>{if(await Ji(1e3),h!==null)return h;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:hb(),serviceIds:[oi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?oi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?oi.CLOUD_PROXY:oi.CLOUD_PROXY_FALLBACK]}}),W=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await pb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),V.url),PG(V,e,n,i)),allFailedhandler:V=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U};let S,R,A;try{({gatewayInfo:S,proxyInfo:R,url:A}=await Fv([_(),y()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!S||!R)throw new Pe(X.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=A,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&A){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(A)[1];st(c).call(c,k)&&(e.proxyServer=k,D.setProxyServer(k),bt.setProxyServer(k))}return h={gatewayInfo:S,proxyInfo:await sG(R,S.uid)},h}async function ufe(e,n,i){const o=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,y){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:dl,cname:m.cname,uid:m.uid.toString(),requestId:ux,seq:ux};ux+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return rd(async()=>{const A=await cd(h,{data:R,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(A.code!==0){const W=new Pe(X.UNEXPECTED_RESPONSE,"cross channel ap error, code"+A.code,{retry:!0});throw D.error(W.toString()),W}const k=JSON.parse(A.json_body);if(k.code!==200){const W=new Pe(X.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw D.error(W.toString()),W}if(!k.servers||k.servers.length===0){const W=new Pe(X.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw D.error(W.toString()),W}return{vid:k.vid,workerToken:k.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(W=>"wss://".concat(W.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(W.wss))}},void 0,A=>!!(A.code!==X.OPERATION_ABORTED&&A.code!==X.UNEXPECTED_RESPONSE||A.data&&A.data.retry),y)}(u,e,n,i));try{const u=await Fv(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function dfe(e,n,i){let o=null;const c=[],u=async h=>{const m=re(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await Ji(1e3),o!==null)?o:await pb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(D.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(y,S,R,A){const[k]=afe(S,[oi.CHOOSE_SERVER]);let W=si.networkState;return rd(async()=>{W&&si.networkState===$a.OFFLINE&&si.onlineWaiter&&await ct.race([si.onlineWaiter,Ji(A&&A.maxRetryTimeout||mi.maxRetryTimeout)]),W=si.networkState;const U=await cd(y,{data:k,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return ofe(U,y)},()=>!1,U=>U.code!==X.OPERATION_ABORTED&&(U.code===X.UPDATE_TICKET_FAILED?U.data.retry:(D.warning("[".concat(S.clientId,"] update ticket network error, retry"),U),!0)),A)}(_,e,n,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await Fv([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function MG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function fx(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?MG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):MG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class hfe extends Ir{get isSuccess(){return!!this.configs}constructor(n,i){super(),$(this,"configs",void 0),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"cancelToken",void 0),$(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),$(this,"interval",void 0),$(this,"mutex",void 0),$(this,"mutableParamsRead",!1),$(this,"configCache",{}),$(this,"limit_bitrate",void 0),this.mutex=new Ts("config-distribute",n),this.store=i}startGetConfigDistribute(n,i){this.joinInfo=n,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,bt.reportApiInvoke(null,{options:void 0,name:fi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Dr.TRACER}).onSuccess(JSON.stringify(id))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void D.debug("[config-distribute] get config distribute interrupted have no joininfo");let n;const i=await this.mutex.lock();try{n=await lfe(this.joinInfo,this.cancelToken,this.retryConfig),D.debug("[config-distribute] get config distribute",JSON.stringify(n));const o=function(c){var u;const h=LT(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let S=h.length-1;S>y;S--){const R=h[S],A=c[R].value;if(typeof A.__priority=="number"){const k=A.__priority,W=h[S-1],U=c[W].value;if(typeof U.__priority=="number"){if(!(k>U.__priority))continue;{const V=R;h[S]=h[S-1],h[S-1]=V}}else{const V=R;h[S]=h[S-1],h[S-1]=V}}}const m=Date.now();let _={};return h.forEach(y=>{const S=c[y].value.__expires;S&&S<=m||(_[y]=c[y])}),_}(n);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Pe(X.NETWORK_RESPONSE_ERROR,o);D.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(n){Kz(n)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==n.id&&this.emit(sb.UPDATE_BITRATE_LIMIT,n):this.emit(sb.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.limit_bitrate&&fx({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(n){try{const i={},o=Object.keys(n),c=[];o.forEach(u=>{const h=n[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,y=n[u].value,S=n[u].tag;let R=0;_?_===T8.REALTIME&&(R=1):Object.keys(y).some(A=>Object.prototype.hasOwnProperty.call(SL,A)||!GL()&&Object.prototype.hasOwnProperty.call(vA,A)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:y}=u;this.store.sessionId&&bt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){D.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(n){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,y=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=fx(fx({value:m[S]},_&&{expires:_}),y&&{type:y}))})}),u}(n);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&Kz(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(n),function(m){try{const _=Date.now();Object.keys(m).forEach(y=>{const{value:S,type:R,expires:A}=m[y];A&&A<=_||((R===T8.REALTIME||Object.prototype.hasOwnProperty.call(SL,y))&&(id[y]=S,pr[y]=S,D.debug("Update realtime parameters from config distribute",y,S)),R||GL()||!Object.prototype.hasOwnProperty.call(vA,y)||(id[y]=S,pr[y]=S,D.debug("Update gateway parameters from config distribute",y,S)))})}catch(_){D.error("Error update config immediately: ".concat(m),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),D.debug("Caching global parameters ".concat(u))}catch(c){D.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(n){try{const i=Date.now();Object.keys(n).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(pr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(pr[o],c)||(id[o]=c,pr[o]=c,this.emit(sb.UPDATE_CLIENT_ROLE_OPTIONS,c),D.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){D.error("Error handling global parameter config:",i.message)}}}class pfe extends Ir{constructor(){super(...arguments),$(this,"resultStorage",new Map)}setLocalAudioStats(n,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(n,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(o))}setRemoteAudioStats(n,i){const o=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(n,i){const o=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(n,i,o){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=st(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",UG[n],n,i),!c.isPrevNormal&&h&&this.emit("exception",UG[n]+2e3,n+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&n.receiveLevel===0)}checkAudioInputLevel(n,i){return i instanceof vi&&!i.isActive||!!i.muted||n.sendVolumeLevel!==0}checkFramerateInput(n,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=Ka(i._encoderConfig.frameRate));const c=n.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,i){return!!i.muted||n.sendBitrate!==0}checkSendAudioBitrate(n,i){return i instanceof vi&&!i.isActive||!!i.muted||n.sendBitrate!==0}checkVideoDecode(n){return n.receiveBitrate===0||n.decodeFrameRate!==0}}const UG={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Rs=new class{markSubscribeStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(n))}markPublishStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(n))}measureFromSubscribeStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function VG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function O_(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?VG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):VG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class fb{constructor(n){$(this,"store",void 0),$(this,"onStatsException",void 0),$(this,"onUploadPublishDuration",void 0),$(this,"onStatsChanged",void 0),$(this,"localStats",new Map),$(this,"remoteStats",new Map),$(this,"updateStatsInterval",void 0),$(this,"trafficStats",void 0),$(this,"trafficStatsPeerList",[]),$(this,"uplinkStats",void 0),$(this,"exceptionMonitor",void 0),$(this,"p2pChannel",void 0),$(this,"scalabilityMode",yA.L1T1),$(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.exceptionMonitor=new pfe,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(He.LocalAudioTrack)||O_({},CL)}getLocalVideoTrackStats(){return this.localStats.get(He.LocalVideoTrack)||O_({},IL)}getRemoteAudioTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.audioStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRemoteNetworkQualityStats(n){const i={};if(n){var o;const c=(o=this.remoteStats.get(n))===null||o===void 0?void 0:o.networkStats;c&&(i[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.videoStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRTCStats(){let n=0,i=0,o=0,c=0;const u=this.localStats.get(He.LocalAudioTrack);u&&(n+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(He.LocalVideoTrack);h&&(n+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get(He.LocalVideoLowTrack);m&&(n+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:S,videoStats:R}=y;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:n,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),n.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Rs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Rs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&D.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,i,o){if(!n)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case He.LocalVideoTrack:case He.LocalVideoLowTrack:{const h=c,m=O_({},IL),_=n.getStats(),y=n.getLocalMedia(o);if(_){const S=_.videoSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){const R=n.getLocalVideoSize(),A=n.getEncoderConfig(He.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),A&&A.bitrateMax&&(m.targetSendBitrate=1e3*A.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(D.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case He.LocalAudioTrack:{const h=c,m=O_({},CL),_=n.getStats(),y=n.getLocalMedia(o);if(_){const S=_.audioSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=n.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(He.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=i;const y=m,S=h,R=_,A=O_({},D8),k=O_({},L8),W=O_({},Jhe),{audioTrack:U,videoTrack:V,audioSSRC:q,videoSSRC:Y}=n.getRemoteMedia(u);let ce;ce=this.store.useP2P?n.getStats(!0):n.getStats();const _e=(o=ce)===null||o===void 0?void 0:o.audioRecv.find(qe=>qe.ssrc===q),ye=(c=ce)===null||c===void 0?void 0:c.videoRecv.find(qe=>qe.ssrc===Y),fe=this.trafficStats&&this.trafficStats.peer_delay.find(qe=>qe.peer_uid===u);if(_e&&(_e.codec!=="opus"&&_e.codec!=="aac"&&_e.codec!=="PCMU"&&_e.codec!=="PCMA"&&_e.codec!=="G722"||(A.codecType=_e.codec),_e.outputLevel?A.receiveLevel=Math.round(32767*_e.outputLevel):U&&(A.receiveLevel=Math.round(32767*U.getVolumeLevel())),A.receiveBytes=_e.bytes,A.receivePackets=_e.packets,A.receivePacketsLost=_e.packetsLost,A.receivePacketsDiscarded=_e.packetsDiscarded,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost),A.receiveBitrate=y?8*Math.max(0,A.receiveBytes-y.receiveBytes):0,A.totalDuration=y?y.totalDuration+1:1,A.totalFreezeTime=y?y.totalFreezeTime:0,A.freezeRate=A.totalFreezeTime/A.totalDuration,A.receiveDelay=_e.jitterBufferMs,A.totalDuration>10&&fb.isRemoteAudioFreeze(U)&&(A.totalFreezeTime+=1)),ye){var ke;ye.codec!=="H264"&&ye.codec!=="H265"&&ye.codec!=="VP8"&&ye.codec!=="VP9"&&ye.codec!=="AV1X"&&ye.codec!=="AV1"||(k.codecType=ye.codec),k.receiveBytes=ye.bytes,k.receiveBitrate=S?8*Math.max(0,k.receiveBytes-S.receiveBytes):0,k.decodeFrameRate=ye.decodeFrameRate<0?0:ye.decodeFrameRate,k.renderFrameRate=ye.decodeFrameRate<0?0:ye.decodeFrameRate,ye.outputFrame&&(k.renderFrameRate=ye.outputFrame.frameRate),ye.receivedFrame?(k.receiveFrameRate=ye.receivedFrame.frameRate,k.receiveResolutionHeight=ye.receivedFrame.height,k.receiveResolutionWidth=ye.receivedFrame.width):V&&(k.receiveResolutionHeight=V._videoHeight||0,k.receiveResolutionWidth=V._videoWidth||0),ye.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(ye.framesRateFirefox)),k.receivePackets=ye.packets,k.receivePacketsLost=ye.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const qe=S?S.totalFreezeTime:0,lt=S?S.totalDuration:0;k.totalDuration=S?S.totalDuration+1:1,k.totalFreezeTime=(ke=ye.totalFreezesDuration)!==null&&ke!==void 0?ke:qe||0,k.receiveDelay=ye.jitterBufferMs||0;const ht=!!Y&&n.getRemoteVideoIsReady(Y);ye.totalFreezesDuration===void 0&&V&&ht&&fb.isRemoteVideoFreeze(V,ye,R)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-qe)/(k.totalDuration-lt),1))}fe&&(A.end2EndDelay=fe.B_ad,k.end2EndDelay=fe.B_vd,A.transportDelay=fe.B_ed,k.transportDelay=fe.B_ed,A.currentPacketLossRate=fe.B_ealr4/100,k.currentPacketLossRate=fe.B_evlr4/100,W.uplinkNetworkQuality=fe.B_punq?fe.B_punq:0,W.downlinkNetworkQuality=fe.B_pdnq?fe.B_pdnq:0),this.remoteStats.set(u,{audioStats:A,videoStats:k,videoPcStats:ye,networkStats:W}),U&&this.exceptionMonitor.setRemoteAudioStats(U,A),V&&this.exceptionMonitor.setRemoteVideoStats(V,k)})}}class FG{constructor(){$(this,"destChannelMediaInfos",new Map),$(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){Hz(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){Hz(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){FA(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function jG(e){if(!(e instanceof FG))return new Pe(X.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!n)return new Pe(X.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new Pe(X.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Im{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,i){$(this,"uid",void 0),$(this,"_uintid",void 0),$(this,"_trust_in_room_",!0),$(this,"_trust_audio_enabled_state_",!0),$(this,"_trust_video_enabled_state_",!0),$(this,"_trust_audio_mute_state_",!0),$(this,"_trust_video_mute_state_",!0),$(this,"_audio_muted_",!1),$(this,"_video_muted_",!1),$(this,"_audio_enabled_",!0),$(this,"_video_enabled_",!0),$(this,"_audio_added_",!1),$(this,"_video_added_",!1),$(this,"_is_pre_created",!1),$(this,"_video_pre_subscribed",!1),$(this,"_audio_pre_subscribed",!1),$(this,"_trust_video_stream_added_state_",!0),$(this,"_trust_audio_stream_added_state_",!0),$(this,"_audioTrack",void 0),$(this,"_videoTrack",void 0),$(this,"_dataChannels",[]),$(this,"_audioSSRC",void 0),$(this,"_videoSSRC",void 0),$(this,"_audioOrtc",void 0),$(this,"_videoOrtc",void 0),$(this,"_cname",void 0),$(this,"_rtxSsrcId",void 0),$(this,"_videoMid",void 0),$(this,"_audioMid",void 0),this.uid=n,this._uintid=i}}function BG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function WG(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?BG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const mb="9",zG=4e4;function GG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function $p(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?GG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):GG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var jv=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(jv||{});const ZA=new Map;function HG(e,n,i,o){let{scale:c}=e;if(c===0&&o===jv.UP||c>=n.length-1&&o===jv.DOWN)return e;let u=$p($p({},e),{},{scale:o===jv.DOWN?++c:--c});switch(i){case"maintain-framerate":u=$p($p({},u),n[c].motion);break;case"maintain-resolution":u=$p($p({},u),n[c].detail);break;case"balanced":u=$p($p({},u),n[c].balanced)}return u}function $G(e,n){if(n){const i={overUse:0,underUse:0,adaptationList:KG(n)};ZA.set(e,i)}else ZA.delete(e)}function KG(e){const n=$p({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=n,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:W,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:V,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:ce,DETAIL_FRAMERATE_FACTOR:_e,DETAIL_BITRATE_FACTOR:ye}=yL,fe=Math.min(n.frameRate,m),ke=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(A,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(k,1)*fe),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let qe=1;qe<=_;qe++){const lt={bwe_up:Math.round(Math.pow(R,qe)*i),bwe_down:Math.round(Math.pow(A,qe+1)*i),fps_up:Math.round(Math.pow(W,qe)*fe),fps_down:Math.round(Math.pow(k,qe+1)*fe)},ht={scaleResolutionDownBy:c/Math.pow(q,qe),frameRate:Math.max(Math.round(Math.pow(V,qe)*o),h),bitrateMax:Math.max(Math.round(Math.pow(U,qe)*i),S),bitrateMin:Math.max(Math.round(Math.pow(U,qe)*u),y)},yn={scaleResolutionDownBy:c/Math.pow(Y,qe),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ce,qe)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ce,qe)*u),y)},vn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_e,qe)*o),h),bitrateMax:Math.max(Math.round(Math.pow(ye,qe)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ye,qe)*u),y)};ke.push({scale:qe,threshold:lt,balanced:ht,motion:yn,detail:vn})}return ke}function ffe(e,n,i,o,c,u){const h=ZA.get(e)||{overUse:0,underUse:0,adaptationList:KG(c)},{adaptationList:m}=h;ZA.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:y}=yL,{scale:S}=o;let R,A;return typeof n=="number"&&n>0&&function(k,W,U,V){if(W>=U.length)return!1;let{threshold:{fps_down:q}}=U[W];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[0].threshold.fps_down),k<q}(n,S,m,u)&&(h.overUse++,A=ZT.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(k,W,U){if(W>=U.length)return!1;const{threshold:{bwe_down:V}}=U[W];return k<V}(i,S,m)&&(h.overUse++,A=ZT.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,R=HG(o,m,u,jv.DOWN),[R,A]):(typeof n=="number"&&n>0&&typeof i=="number"&&i>0&&function(k,W,U,V){if(W===0)return;let{threshold:{fps_up:q}}=U[W];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[1].threshold.fps_up),k>q}(n,S,m,u)&&function(k,W,U){if(W===0)return;const{threshold:{bwe_up:V}}=U[W];return k>V}(i,S,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,R=HG(o,m,u,jv.UP),R.scale===0&&(A=ZT.NONE))),[R,A])}function qG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function mx(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?qG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function mfe(e){var n;return!!re("ENABLE_AG_ADAPTATION")&&!!(e instanceof ML||st(n=e._hints).call(n,ar.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=Cn();if(o.os!==Pi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&G6(17,4)||z6(14)&&H6(17,4,!0)))}const eP=new Map;function tP(e,n){const i=eP.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),eP.delete(e)}n.qualityLimitationReason=ZT.NONE,$G(e)}function gfe(e,n){var i;let o;switch(n){case He.LocalAudioTrack:o=Gn.Audio;break;case He.LocalVideoTrack:o=st(i=e._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case He.LocalVideoLowTrack:o=Gn.Low}return o}function gx(e){const n=Nn();if(e.some(i=>i._bypassWebAudio))throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!n.webAudioMediaStreamDest)throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function _x(e,n){gx(e);const i=new vi;return e.forEach(o=>i.addAudioTrack(o)),i}const _fe=!Nn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Mp();function nP(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return _fe?(i={spec:n,store:e},Gp("PlanBConnection").create(i)):new dh(n,e)}function Ex(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function YG(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(XT(e.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(n=>n.forceturn))return!0}return!1}catch{return!1}}var wn;function XG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ld(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?XG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let dh=(wn=class J_ extends Yz{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return st(i=Object.keys(SA)).call(i,n)}))]}constructor(n,i){super(n,i),$(this,"id",or(5,"connection-")),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"forceTurn",!1),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"extension",{useXR:re("USE_XR")}),$(this,"localCapabilities",void 0),$(this,"remoteCodecs",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"isPreallocation",!1),$(this,"preSSRCMap",new Map),$(this,"dataStreamChannelMap",new Map),$(this,"establishPromise",void 0),$(this,"recoveredDataChannelIds",[]),$(this,"currentDataChannelId",1),$(this,"supportAV1RtpSpec",!1),$(this,"mutex",void 0),$(this,"qualityLimitationReason",ZT.NONE),$(this,"isFirstConnected",!1),this.store=i,this.forceTurn=YG(n),this.mutex=new Ts("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(J_.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=gL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(n){const i=this.preSSRCMap.get(n);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(n,i){if(this.remoteCodecs=i,!this.remoteSDP)return void D.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(n,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else D.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Rm(o.sdp),u=await mG({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=qA(u),this.initialOffer=o,re("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:yA.L1T3}]});const y=await _.createOffer();if(!y.sdp)return void _.close();const S=ga(y.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(A=>A.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),R}catch{return}}();var n;m&&(this.supportAV1RtpSpec=!0,(n=u.send)===null||n===void 0||n.videoExtensions.push(m))}let h;return o.sdp&&yG(o.sdp)&&(h=Lr(u),(i=h).send&&(xv(ft.VIDEO,i.send.videoExtensions),xv(ft.AUDIO,i.send.audioExtensions)),i.recv&&(xv(ft.VIDEO,i.recv.videoExtensions),xv(ft.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(xv(ft.VIDEO,i.sendrecv.videoExtensions),xv(ft.AUDIO,i.sendrecv.audioExtensions))),ld(ld({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new De(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&yG(this.initialOffer.sdp)&&(i=n.rtpCapabilities,o=this.localCapabilities,i.send&&(HA(ft.VIDEO,i.send.videoExtensions,o.send.videoExtensions),HA(ft.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(HA(ft.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),HA(ft.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Lr(this._localCapabilities)}get rtpCapabilities(){return Lr(this._rtpCapabilities)}get candidates(){return Lr(this._candidates)}get iceParameters(){return Lr(this._iceParameters)}get dtlsParameters(){return Lr(this._dtlsParameters)}constructor(y){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_originCandidates",void 0),$(this,"_iceParameters",void 0),$(this,"_isUseExtmapAllowMixed",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,y=Lr(y);const{iceParameters:R,dtlsParameters:A,candidates:k,rtpCapabilities:W,setup:U,localCapabilities:V,cname:q}=y;this._rtpCapabilities=W,this._candidates=k,this._originCandidates=Lr(k),this._iceParameters=R,this._dtlsParameters=A,this._localCapabilities=V,this.setup=U,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(W),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(y){const S=this.candidates,R=this.dtlsParameters,A=this.iceParameters,k=this.rtpCapabilities.send;let W=this.sessionDesc.mediaDescriptions.length-1;for(let U=1;U<y;U++){const V=2*U+2e4,q=2*U+zG,{ssrcs:Y,ssrcGroups:ce}=P_([{ssrcId:V}],this.cname),{ssrcs:_e,ssrcGroups:ye}=P_([{ssrcId:q,rtx:re("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:mb,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.videoCodecs.map(fe=>fe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:A.iceUfrag,icePwd:A.icePwd,unrecognized:[],candidates:S,extmaps:k.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_e,ssrcGroups:ye,rtcpFeedbackWildcards:[],payloads:k.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++W)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:mb,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.audioCodecs.map(fe=>fe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:A.iceUfrag,icePwd:A.icePwd,unrecognized:[],candidates:S,extmaps:k.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:ce,rtcpFeedbackWildcards:[],payloads:k.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++W)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return vm(this.sessionDesc)}send(y,S,R,A){const{ssrcs:k,ssrcGroups:W}=P_(S,this.cname,re("SYNC_GROUP")?R:void 0),U=this.findPreloadMediaDesc(k);if(U){if(kr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,U.attributes.mid),A&&(A.twcc||A.remb)){const V=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(U,A),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const V=this.findAvailableMediaIndex(y,k);let q;return V===-1||V===1&&(hs()||function(){const Y=Cn();return!(Y.name!==Un.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||re("ENABLE_ENCODED_TRANSFORM")&&xp())||V===0&&re("USE_SUB_RTX")||$6()?(q=this.createOrRecycleSendMedia(y,k,W,"sendonly",A),this.updateBundleMids()):(q=Lr(this.sessionDesc.mediaDescriptions[V]),q.attributes.direction="sendonly",q.attributes.ssrcs=k,q.attributes.ssrcGroups=W,this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(q,A)),kr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:S}}batchSend(y){const S=y.map(k=>{let{kind:W,ssrcMsg:U,mslabel:V}=k;return this.send(W,U,V)}),R=[];let A=!1;return S.forEach(k=>{let{mid:W,needExchangeSDP:U}=k;U&&(A=!0),R.push(W)}),{mids:R,needExchangeSDP:A}}stopSending(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||kr()||$6()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(y,S,R,A){y.forEach((k,W)=>{this.createOrRecycleRecvMedia(k,[],"recvonly",S,R,A[W])}),this.updateBundleMids()}stopReceiving(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(y){const S=this.sessionDesc||ga((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=y;const A=this.rtpCapabilities.send,k=this.localCapabilities.send;for(const W of S.mediaDescriptions){if(W.attributes.iceUfrag=this._iceParameters.iceUfrag,W.attributes.icePwd=this._iceParameters.icePwd,W.attributes.fingerprints=this._dtlsParameters.fingerprints,W.attributes.candidates=this._candidates,W.attributes.setup=this.setup,W.media.mediaType==="application"&&(W.attributes.sctpPort="5000"),W.media.mediaType==="video"){if(A.videoCodecs.length===0){const U=k.videoCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"vp8")})||[k.videoCodecs[0]];W.media.fmts=U.map(V=>V.payloadType.toString(10)),W.attributes.payloads=U,W.attributes.extmaps=[]}else if(W.media.fmts=A.videoCodecs.map(U=>U.payloadType.toString(10)),W.attributes.payloads=A.videoCodecs,W.attributes.extmaps=A.videoExtensions,re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=P_([{ssrcId:zG,rtx:re("USE_SUB_RTX")?40001:void 0}],this.cname);W.attributes.ssrcs=U,W.attributes.ssrcGroups=V}}if(W.media.mediaType==="audio"){if(A.audioCodecs.length===0){const U=k.audioCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"opus")})||[k.audioCodecs[0]];W.media.fmts=U.map(V=>V.payloadType.toString(10)),W.attributes.payloads=U,W.attributes.extmaps=[]}else if(W.media.fmts=A.audioCodecs.map(U=>U.payloadType.toString(10)),W.attributes.payloads=A.audioCodecs,W.attributes.extmaps=A.audioExtensions,Uv(W),re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=P_([{ssrcId:2e4}],this.cname);W.attributes.ssrcs=U,W.attributes.ssrcGroups=V}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(y){const S=this._originCandidates.filter(A=>A.transport==="udp"),R=[];if(S.forEach(A=>{R.push(WG(WG({},A),{},{foundation:"tcpcandidate",priority:Number(A.priority)-1+"",transport:"tcp",port:Number(A.port)+90+""}))}),S.length!==0){switch(y){case ws.TCP_RELAY:this._candidates=R;break;case ws.UDP_TCP_RELAY:case ws.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const A of this.sessionDesc.mediaDescriptions)A.attributes.candidates=this.candidates}}restartICE(y){y=Lr(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=y.iceUfrag,S.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const S=[];for(let R=0;R<y;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(y,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const A=R.media.mediaType===y&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(kr()){if(A){const k=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(k||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!k||k!==R.attributes.mid)}return!1}return A})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:mb,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,S,R,A,k,W){const U=y._mediaStreamTrack.kind,V=this.rtpCapabilities.recv,q=ub(U,V,this.localCapabilities.send,U===ft.VIDEO?A:k),Y=U===ft.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const ce="".concat(this.currentMidIndex);let _e={media:{mediaType:U,port:mb,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(fe=>fe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ce)}};_e=this.mungRecvMediaDsec(_e,y,W);const ye=this.findFirstClosedMedia(U);if(ye){const fe=this.sessionDesc.mediaDescriptions.indexOf(ye);this.sessionDesc.mediaDescriptions[fe]=_e}else this.sessionDesc.mediaDescriptions.push(_e);return _e}updateRemoteCodec(y,S,R){const A=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").filter(_e=>{var ye;return st(ye=Object.keys(SA)).call(ye,_e)}))],k=new Set(S);if(A.every(_e=>k.has(_e)))return D.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const W=this._rtpCapabilities.recv.videoCodecs.filter(_e=>S.some(ye=>{var fe;return st(fe=_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").call(fe,ye)}));if(W.length===0)return D.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(A," codecs: ").concat(S)),!1;const U=[...new Set(W.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||""))];let V;if(D.debug("updateRemoteCodec, from ".concat(A," to ").concat(U)),y.length===0)V=this.sessionDesc.mediaDescriptions.filter(_e=>_e.media.mediaType==="video"&&_e.attributes.direction==="recvonly");else if(V=this.sessionDesc.mediaDescriptions.filter(_e=>_e.attributes.mid&&st(y).call(y,_e.attributes.mid)&&_e.attributes.direction==="recvonly"),V.length!==y.length)return D.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(S)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const _e=ix(W,this.rtpCapabilities.recv.videoCodecs);W.push(..._e)}this._rtpCapabilities.recv.videoCodecs=W;const q=this.localCapabilities.send,Y=this.rtpCapabilities.recv,ce=ub(ft.VIDEO,Y,q,R);return V.forEach(_e=>{const ye=ce.map(fe=>fe.payloadType.toString(10));D.debug("updateRemoteCodec mid: ".concat(_e.attributes.mid,", from"),_e.attributes.payloads,"to",ce),_e.attributes.payloads=ce,_e.media.fmts=ye}),!0}createOrRecycleSendMedia(y,S,R,A,k){const W=this.rtpCapabilities.send,U=y===ft.VIDEO?W.videoCodecs:W.audioCodecs,V=y===ft.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Y={media:{mediaType:y,port:mb,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:V,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:A,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Y=this.mungSendMediaDesc(Y,k);const ce=this.findFirstClosedMedia(y);if(ce){const _e=this.sessionDesc.mediaDescriptions.indexOf(ce);this.sessionDesc.mediaDescriptions[_e]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,S,R){const A=Lr(y);return nx(A),Mv(A,S),rx(A,S),pG(A),KA(A,R,this.localCapabilities.send),A}mungSendMediaDesc(y,S){const R=Lr(y);return KA(R,S,this.localCapabilities.recv),Uv(R),R}updateRecvMedia(y,S){const R=this.sessionDesc.mediaDescriptions.findIndex(A=>A.attributes.mid===y);if(R!==-1){const A=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=A}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(S=>kr()?S.media.port==="0"&&S.media.mediaType===y:S.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===y[0].ssrcId})}getSSRC(y){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y))===null||S===void 0?void 0:S.attributes.ssrcs}}(ld(ld({},n),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),n.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=_G(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),re("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(re("PRELOAD_MEDIA_COUNT"));const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=n;if(Array.isArray(_)&&_.length>0){const{mids:y}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));y.forEach((S,R)=>{this.preSSRCMap.set(_[R].ssrcId,S)}),await db(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=n;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=n;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await db(this.peerConnection,this.remoteSDP,this.extension),D.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return ul(function*(){const u=yield Rn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=GA();n.forEach(V=>{const q=c.peerConnection.addTransceiver(V._mediaStreamTrack,ld({direction:"sendonly"},V.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),V._updateRtpTransceiver(q)}),kr()&&re("SIMULCAST")===!0&&(yield Rn(c.applySimulcastForFirefox(h,n)));const _=yield Rn(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(n.length),S=c.mungSendOfferSDP(_.sdp,n,y),R=ga(S),A=y.map(V=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return uG(q,re("USE_PUB_RTX"))});let k;try{k=yield A}catch(V){k=[],c.remoteSDP.receive(n,i,o,k);const q=c.remoteSDP.toString();throw yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Rn(c.stopSending(y,!0)),V}c.remoteSDP.receive(n,i,o,k);const W=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.applySimulcastEncodings(h,n)),yield Rn(c.applySendEncodings(h,n)),U==null||U(W),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),h.map((V,q)=>{const Y=y[q];return{localSSRC:A[q],id:Y,transceiver:V}})}catch(h){throw h instanceof De?h:new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(n);if(o&&o.readyState==="open")D.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(n,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),D.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else D.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof De?o:new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(n){try{const i=this.dataStreamChannelMap.get(n);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(n)}catch(i){throw i instanceof De?i:new De(X.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var y;tP(this.id+_.mid,this),_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);h&&(await db(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(n);return o&&(await db(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");n.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.mute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.unmute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(n,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return ul(function*(){const o=yield Rn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Nn().supportPCSetConfiguration,u=re("FORCE_TURN_TCP")||i.forceTurn;if(n===ws.RELAY&&!c)return;if(c&&!u){const R=n===ws.RELAY?"relay":"all",A=i.peerConnection.getConfiguration();A.iceTransportPolicy!==R&&(D.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(R,"]")),A.iceTransportPolicy=R,i.peerConnection.setConfiguration(A))}i.remoteSDP.updateCandidates(n);const h=yield Rn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Rm(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;i.remoteSDP.restartICE(_);const y=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Rn(i.peerConnection.setLocalDescription(h)),S==null||S(y),yield Rn(i.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){D.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const n=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(ws.TCP_RELAY),await db(this.peerConnection,this.remoteSDP,this.extension)}catch(i){D.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{n()}}close(){var n;this.peerConnection.getTransceivers().forEach(i=>{tP(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return ld(ld({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new De(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?kr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:ld(ld({},sh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:ld(ld({},sh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=n=>{if(n&&(n.errorCode||n.errorText)){var i;const o="code: ".concat(n.errorCode,", message: ").concat(n.errorText),c=n.port?"local: ".concat(n.port):"";D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(n.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=n=>{n&&n.target&&"iceGatheringState"in n.target&&D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(n.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&(XT(n.turnServer.servers)?i.iceServers=n.turnServer.servers:re("NEW_TURN_MODE")&&i.iceServers?(re("USE_TURN_SERVER_OF_GATEWAY")?n.turnServer.serversFromGateway&&i.iceServers.push(...J_.newTurnServerConfigToIceServers(n.turnServer.serversFromGateway)):i.iceServers.push(...J_.newTurnServerConfigToIceServers(n.turnServer.servers)),re("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):n.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...J_.turnServerConfigToIceServers(n.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...J_.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&Nn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{const c=re("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bm(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bm(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(V=>V.track===n._mediaStreamTrack)),!i)return D.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Nn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(n._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(U,V){return U.getTransceivers().find(q=>q.sender.track===V||q.receiver.track===V)}(this.peerConnection,n._mediaStreamTrack),_=npe(n);if(mfe(n)&&m&&i&&_&&this.getLocalVideoStats&&st(o=["vp8","vp9"]).call(o,this.store.codec)){var y;const U=u.degradationPreference||(st(y=n._hints).call(y,ar.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(V,q,Y,ce,_e,ye){if(tP(V,Y),_e(q),ce!=="balanced"&&ce!=="maintain-framerate"&&ce!=="maintain-resolution")return;let fe=-1;$G(V,q);const ke=window.setInterval(()=>{const lt=eP.get(V);if(!re("ENABLE_AG_ADAPTATION")||!lt)return tP(V,Y),void _e(q);const ht=ye();if(ht.sendPackets>0&&ht.OutgoingAvailableBandwidth>0){if(fe===-1)return void(fe=Date.now());if(Date.now()-fe<1e3)return;const yn=ht.sendFrameRate,vn=ht.OutgoingAvailableBandwidth,[cr,Qr]=ffe(V,yn,vn,lt.adaptationConfig,q,ce);Qr&&(Y.qualityLimitationReason=Qr),cr&&lt.adaptationConfig.scale!==cr.scale&&(D.debug("[".concat(V,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(yn,", bwe ").concat(vn,", switch from ").concat(lt.adaptationConfig.scale," to ").concat(cr.scale," ")),lt.adaptationConfig=mx(mx({},lt.adaptationConfig),cr),_e(cr))}},re("CHECK_LOCAL_STATS_INTERVAL")),qe=mx({},q);eP.set(V,{timer:ke,adaptationConfig:qe,originConfig:q,adaptationFunc:_e}),D.debug("[".concat(V,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(ce))})(this.id+m.mid,_,this,U,V=>{i&&this.updateAdaptation(i,V)},this.getLocalVideoStats.bind(this))}if(n._encoderConfig){var S;const{bitrateMax:U,frameRate:V,scaleResolutionDownBy:q}=n._encoderConfig;U&&(h.maxBitrate=1e3*U),(st(S=n._hints).call(S,ar.LOW_STREAM)||n.isUseScaleResolutionDownBy)&&(V&&(h.maxFramerate=Ka(V)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:R}=re("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),re("DSCP_TYPE")&&Mp()){var A;const U=re("DSCP_TYPE");st(A=["very-low","low","medium","high"]).call(A,U)&&(h.networkPriority=U)}const k=i.getParameters(),W=(c=k.encodings)===null||c===void 0?void 0:c[0];kr()&&!W&&(u.encodings=[h]),W&&Object.assign(W,h),Object.assign(k,u),D.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await i.setParameters(k),await async function(U,V,q){try{var Y;if(!Nn().supportSetRtpSenderParameters||!function(ke){return ke==="vp9"||ke==="av1"}(U)||!re("ENABLE_SVC"))return;const ce={},_e={},ye=V.getParameters(),fe=(Y=ye.encodings)===null||Y===void 0?void 0:Y[0];_e.scalabilityMode=GA(q),fe&&Object.assign(fe,_e),Object.assign(ye,ce),await V.setParameters(ye),D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ye.encodings)))}catch(ce){D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ce)}}(this.store.codec,i,re("SVC_MODE"))}async updateAdaptation(n,i){var o,c;if(!n)return D.debug("[updateAdaptation] no rtpSender found");if(!Nn().supportSetRtpSenderParameters)return D.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=Ka(m)),_&&_>=1&&st(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const y=n.getParameters(),S=(c=y.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(y,{});try{await n.setParameters(y),D.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in n)||n.transport&&n.transport.state==="connected"?this.peerConnectionState!=="connected"?D.debug("[updateAdaptation] peerConnection not connected}"):D.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):D.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(n,i){try{if(!Nn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof fr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=ga(n);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(Mv(_,u),fG(_,u,this.store.codec))}),vm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,m;const y=n[_],S=i[_];if(S instanceof fr&&!st(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},A={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(n,i){if(!kr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof fr&&this.isVP8Simulcast(c)){const u=n[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof fr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=n._hints).call(i,ar.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(n){if(Nn().supportPCSetConfiguration){const i=J_.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},_t(wn.prototype,"updateRemoteRTPCapabilities",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteRTPCapabilities"),wn.prototype),_t(wn.prototype,"connect",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),_t(wn.prototype,"updateRemoteConnect",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteConnect"),wn.prototype),_t(wn.prototype,"createDataChannels",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"createDataChannels"),wn.prototype),_t(wn.prototype,"receive",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"receive"),wn.prototype),_t(wn.prototype,"batchReceive",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"batchReceive"),wn.prototype),_t(wn.prototype,"stopReceiving",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"stopReceiving"),wn.prototype),_t(wn.prototype,"muteRemote",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),_t(wn.prototype,"unmuteRemote",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),_t(wn.prototype,"muteLocal",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"muteLocal"),wn.prototype),_t(wn.prototype,"unmuteLocal",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteLocal"),wn.prototype),_t(wn.prototype,"close",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"close"),wn.prototype),_t(wn.prototype,"updateEncoderConfig",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"updateEncoderConfig"),wn.prototype),_t(wn.prototype,"updateSendParameters",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"updateSendParameters"),wn.prototype),_t(wn.prototype,"replaceTrack",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"replaceTrack"),wn.prototype),_t(wn.prototype,"updateAdaptation",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"updateAdaptation"),wn.prototype),_t(wn.prototype,"getRemoteSSRC",[zo],Object.getOwnPropertyDescriptor(wn.prototype,"getRemoteSSRC"),wn.prototype),wn);function zo(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function yx(e,n){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=Ka(n.width),o.height=Ka(n.height);const c=Ka(n.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new Pe(X.UNEXPECTED_ERROR,"can not get canvas context");const m=Nn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,R=i.videoHeight/S,A=o.width*R;Math.abs(A-o.height)>=2&&(D.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(A)),o.height=A)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=OL(()=>o.startCapture&&o.startCapture(),c);const y=_.stop;return _.stop=()=>{y.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),D.debug("clean low stream renderer")},_}var rP=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(rP||{}),ai=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(ai||{}),k_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(k_||{}),ci=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(ci||{}),N_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(N_||{}),JG=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(JG||{}),hh=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(hh||{}),Go=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Go||{}),QG=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(QG||{}),Ho=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Ho||{}),iP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(iP||{});const D_=1e3,L_=6,sP=3,Efe=Math.max(L_,sP);function Ft(e,n,i){i!=null&&Number.isFinite(i)&&(e[n]=Math.round(Math.max(0,i)))}function ZG(e){const n={[Ho.CONN_TYPE]:0,[Ho.RTT]:e.rtt,[Ho.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(n[Ho.CONN_TYPE]=1),i==="tcp"&&(n[Ho.CONN_TYPE]=3),i==="tls"&&(n[Ho.CONN_TYPE]=4);break}case"srflx":n[Ho.CONN_TYPE]=2;break;case"unknown":n[Ho.CONN_TYPE]=5;break;default:n[Ho.CONN_TYPE]=0}return n}function e9(e){let n=0;switch(e){case"none":n=0;break;case"cpu":n=1;break;case"bandwidth":n=2;break;case"other":n=3}return n}class t9 extends Ir{constructor(n){super(),$(this,"store",void 0),$(this,"uploadWRTCStatsTimer",void 0),$(this,"uploadOutboundDenoiserStatsTimer",void 0),$(this,"uploadExtStatsTimer",void 0),$(this,"uploadExtUsageStatsTimer",void 0),$(this,"uploadInboundExtStatsTimer",void 0),$(this,"requestStats",void 0),$(this,"requestTransportStats",void 0),$(this,"requestLocalMedia",void 0),$(this,"requestRemoteMedia",void 0),$(this,"requestAllTracks",void 0),$(this,"requestVideoIsReady",void 0),$(this,"requestUploadStats",void 0),$(this,"requestUpload",void 0),$(this,"uploadOutboundStarted",!1),$(this,"uploadInboundStarted",!1),$(this,"uploadTransportStarted",!1),$(this,"uploadBaseStatsStarted",!1),$(this,"uploadExtensionUsageStarted",!1),$(this,"lastRecvStats",void 0),$(this,"lastSendStats",void 0),$(this,"lastRefRecvStats",void 0),$(this,"lastRefSendStats",void 0),$(this,"lastFullRecvStats",void 0),$(this,"lastFullSendStats",void 0),$(this,"needUploadRenderFreezeTime",!0),this.store=n}uploadWRTCStats(n){if(!this.requestStats||!this.requestUploadStats)return;const i=n%sP==0,o=n%L_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const y=this.getTransportStats(c,u,i);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&c){const y=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&u){const y=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);y&&(m.inbound=y)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[iP.RTC_PEER_CONNECTION_STATE]=mL[_]):m.misc=[{addition:{[iP.RTC_PEER_CONNECTION_STATE]:mL[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let n=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[iP.RTC_PEER_CONNECTION_STATE]:mL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(n),++n===Efe+1&&(n=1)},D_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(n,i,o){if(!this.requestStats)return;if(!o)return n.rtt==null?void 0:{addition:{[Ho.RTT]:n.rtt,[Ho.CONN_TYPE]:void 0,[Ho.STATS_UPDATE_INTERVAL]:n.updateInterval||void 0}};const c=ZG(n);if(this.store.useP2P){if(i){const u=ZG(i);c[Ho.CONN_TYPE]+=u[Ho.CONN_TYPE]<<3}c[Ho.CONN_TYPE]+=110}else c[Ho.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(n,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(y=>{let[S,{track:R,ssrcs:A}]=y;switch(S){case He.LocalVideoLowTrack:case He.LocalVideoTrack:if(S===He.LocalVideoTrack){const k=function(V,q,Y,ce,_e,ye){const fe=q.videoSend.find(ht=>ht.ssrc===V);if(!fe)return;const ke={},{sentFrame:qe,inputFrame:lt}=fe;if(ye&&(Ft(ke,ai.QP_SUM,fe.qpSumPerFrame),lt&&qe)){const ht=lt.frameRate,yn=qe.frameRate;ke[ai.FREEZE]=function(vn,cr){let Qr=!0;return Qr=!(vn<=5)&&(vn<=10?cr<3:vn<=20?cr<4:cr<5),Qr}(ht,yn)?1:0}if(_e){switch(qe&&(Ft(ke,ai.HEIGHT,qe.height),Ft(ke,ai.WIDTH,qe.width),Ft(ke,ai.FRAME_RATE,qe.frameRate)),ke[ai.DISABLED]=ce._originMediaStreamTrack&&!ce._originMediaStreamTrack.enabled||ce._mediaStreamTrack&&!ce._mediaStreamTrack.enabled?1:0,fe.adaptionChangeReason){case"none":ke[ai.ADAPTATION]=0;break;case"cpu":ke[ai.ADAPTATION]=1;break;case"bandwidth":ke[ai.ADAPTATION]=2;break;case"other":ke[ai.ADAPTATION]=3}let ht=0;fe.adaptionChangeReason&&(ht+=e9(fe.adaptionChangeReason)),q.qualityLimitationReason&&(ht+=e9(q.qualityLimitationReason)<<3),ke[ai.ADAPTATION]=ht,ke[ai.PLAYER_STATUS]=AL[ce._player?ce._player.videoElementStatus:"uninit"],Ft(ke,ai.NACKS,fe.nacksCount),Ft(ke,ai.PLIS,fe.plisCount),Ft(ke,ai.FIRS,fe.firsCount),Ft(ke,ai.AVG_ENCODE,fe.avgEncodeMs),Ft(ke,ai.HUGE_FRAME_SENT,fe.hugeFramesSent),Ft(ke,ai.BYTES_RETRANSMIT,fe.retransmittedBytesSent),Ft(ke,ai.PACKAGES_RETRANSMIT,fe.retransmittedPacketsSent),Ft(ke,ai.KEY_FRAMES_ENCODED,fe.keyFramesEncoded);const yn=Y&&Y.videoSend.find(vn=>vn.ssrc===V);if(yn){let vn=_e?D_:D_*L_;yn.timestamp&&fe.timestamp&&(vn=fe.timestamp-yn.timestamp),yn.packets!=null&&fe.packets!=null&&Ft(ke,ai.PACKAGE_RATE,1e3*(fe.packets-yn.packets)/vn),fe.packetsLost!=null&&yn.packetsLost!=null&&Ft(ke,ai.PACKAGE_LOST,fe.packetsLost-yn.packetsLost),yn.bytes!=null&&fe.bytes!=null&&Ft(ke,ai.BITRATE,8*(fe.bytes-yn.bytes)/vn)}}return ke}(A[0].ssrcId,n,i,R,o,c),W=R&&function(V,q,Y,ce){const _e=q.videoSend.find(fe=>fe.ssrc===V);if(!_e)return null;const ye={};if(ce){const fe=_e.inputFrame,ke=fe&&fe.height||Y.videoHeight||0,qe=fe&&fe.width||Y.videoWidth||0,lt=fe&&fe.frameRate||0;Ft(ye,rP.HEIGHT,ke),Ft(ye,rP.WIDTH,qe),Ft(ye,rP.FRAME_RATE,lt)}return ye}(A[0].ssrcId,n,R,o),U=function(V,q){const Y={};return q&&(Ft(Y,ai.RETRANSMIT,V.bitrate.retransmit),Ft(Y,ai.TARGET_ENCODED,V.bitrate.targetEncoded),Ft(Y,ai.ACTUAL_ENCODED,V.bitrate.actualEncoded),Ft(Y,ai.TRANSMIT,V.bitrate.transmit),Ft(Y,ai.BANDWIDTH,V.sendBandwidth)),Y}(n,o);m=Object.assign({},k,W,U)}else _=function(k,W,U,V){const q=W.videoSend.find(ce=>ce.ssrc===k);if(!q)return;const Y={};if(V){const ce=q.sentFrame;if(ce&&(Ft(Y,k_.HEIGHT,ce.height),Ft(Y,k_.WIDTH,ce.width),Ft(Y,k_.FRAME_RATE,ce.frameRate)),U){const _e=U.videoSend.find(ye=>ye.ssrc===k);if(_e){let ye=D_*L_;_e.timestamp&&q.timestamp&&(ye=q.timestamp-_e.timestamp),_e.packets!=null&&q.packets!=null&&Ft(Y,k_.PACKAGE_RATE,1e3*(q.packets-_e.packets)/ye),q.packetsLost!=null&&_e.packetsLost!=null&&Ft(Y,k_.PACKAGE_LOST,q.packetsLost-_e.packetsLost),_e.bytes!=null&&q.bytes!=null&&Ft(Y,k_.BITRATE,8*(q.bytes-_e.bytes)/ye)}}}return Y}(A[0].ssrcId,n,i,o);break;case He.LocalAudioTrack:h=R&&function(k,W,U,V,q){const Y=W.audioSend.find(_e=>_e.ssrc===k);if(!Y)return;const ce={};if(q){ce[hh.DISABLED]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0;const _e=100*V._source.getAccurateVolumeLevel(),ye=Y.inputLevel;if(ye!=null){const ke=Math.ceil(50*Math.log10(100*ye+1));Ft(ce,hh.LEVEL,ke)}Ft(ce,JG.PCM_LEVEL,_e),Ft(ce,hh.AEC_RETURN_LOSS,Y.aecReturnLoss),Ft(ce,hh.AEC_RETURN_LOSS_ENH,Y.aecReturnLossEnhancement),Ft(ce,hh.BYTES_RETRANSMIT,Y.retransmittedBytesSent),Ft(ce,hh.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),ce[hh.FREEZE]=0;const fe=U&&U.audioSend.find(ke=>ke.ssrc===k);if(fe){let ke=D_*L_;fe.timestamp&&Y.timestamp&&(ke=Y.timestamp-fe.timestamp),fe.bytes!=null&&Y.bytes!=null&&Ft(ce,hh.BITRATE,8*(Y.bytes-fe.bytes)/ke),fe.packets!=null&&Y.packets!=null&&Ft(ce,hh.PACKAGE_RATE,1e3*(Y.packets-fe.packets)/ke)}}return ce}(A[0].ssrcId,n,i,R,o)}}),{high:m,low:_,audio:h}}getInboundStats(n,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,y]=m;const S={peer:_.uid};if(y.has(ft.VIDEO)&&_.videoTrack){const R=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,A=_.videoTrack?function(k,W,U,V,q,Y,ce,_e){const ye=W.videoRecv.find(vn=>vn.ssrc===k);if(!ye)return;const fe={},{receivedFrame:ke,outputFrame:qe,decodeFrameRate:lt}=ye,ht=U&&U.videoRecv.find(vn=>vn.ssrc===k);if(Ft(fe,N_.FRAME_RATE_DECODE,lt),ye.framesRateFirefox&&Ft(fe,ci.FRAME_RATE,ye.framesRateFirefox),ke&&Ft(fe,ci.FRAME_RATE,ke.frameRate),Ft(fe,ci.FRAMES_DROPPED,ye.framesDroppedCount),Ft(fe,ci.BYTES_RETRANSMIT,ye.retransmittedBytesReceived),Ft(fe,ci.PACKAGES_RETRANSMIT,ye.retransmittedPacketsReceived),Ft(fe,ci.PACKAGES_DISCARDED,ye.packetsDiscarded),Ft(fe,ci.AVG_DECODE,ye.avgDecodeMs),Ft(fe,ci.AVG_PROCESSING_DELAY,ye.avgProcessingDelayMs),Ft(fe,ci.AVG_ASSEMBLY_TIME,ye.avgFramesAssembledFromMultiplePacketsMs),Ft(fe,ci.AVG_INTER_FRAME_DELAY,ye.avgInterFrameDelayMs),Ft(fe,ci.KEY_FRAMES_DECODED,ye.keyFramesDecoded),ht){const vn=W.timestamp-U.timestamp||D_*(_e?L_:ce?sP:1);ye.packetsLost!=null&&ht.packetsLost!=null&&Ft(fe,ci.PACKAGE_LOST,ye.packetsLost-ht.packetsLost),ht.bytes!=null&&ye.bytes!=null&&Ft(fe,ci.BITRATE,8*(ye.bytes-ht.bytes)/vn),ht.packets!=null&&ye.packets!=null&&Ft(fe,ci.PACKAGE_RATE,1e3*(ye.packets-ht.packets)/vn)}if(_e&&(Ft(fe,ci.QP_SUM,ye.qpSumPerFrame),fe[ci.FREEZE]=q&&fb.isRemoteVideoFreeze(V,ye,ht)?1:0),ce){var yn;ke?(Ft(fe,ci.HEIGHT,ke.height),Ft(fe,ci.WIDTH,ke.width)):V&&(Ft(fe,ci.HEIGHT,V._videoHeight||0),Ft(fe,ci.WIDTH,V._videoWidth||0)),qe&&Ft(fe,N_.FRAME_RATE_OUTPUT,qe.frameRate);const vn=(yn=V._player)===null||yn===void 0?void 0:yn.rendFrameRate.toFixed(0);if(vn&&Ft(fe,N_.FRAME_RATE_RENDER,+vn),Ft(fe,ci.JITTER_BUFFER,ye.jitterBufferMs),Ft(fe,ci.CURRENT_DELAY,ye.currentDelayMs),Ft(fe,ci.FIRS,ye.firsCount),Ft(fe,ci.NACKS,ye.nacksCount),Ft(fe,ci.PLIS,ye.plisCount),V){fe[ci.DISABLED]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1;const cr=V._player;if(cr){const{freezeTimeCounterList:Qr,renderFreezeAccTime:Br,videoElementStatus:Ko}=cr;if(Qr&&Qr.length>0&&Ft(fe,N_.FREEZE_TIME,Qr.splice(0,1)[0]),Y&&Fp.visibility==="visible"&&Ko===Xs.PLAYING&&Nn().supportRequestVideoFrameCallback){const Fe=Math.min(6e3,Br);cr.renderFreezeAccTime=Math.max(0,Br-Fe),Ft(fe,N_.FREEZE_TIME_RENDER,Fe)}if(typeof ye.totalFreezesDuration=="number"){const Fe=ht&&ht.totalFreezesDuration?ye.totalFreezesDuration-ht.totalFreezesDuration:ye.totalFreezesDuration;Ft(fe,N_.FREEZE_DURATION,1e3*Fe)}}}if(fe[ci.PLAYER_STATUS]=AL[V._player?V._player.videoElementStatus:"uninit"],ht&&ye.totalInterFrameDelay!==void 0&&ye.totalSquaredInterFrameDelay!==void 0&&ht.totalInterFrameDelay!==void 0&&ht.totalSquaredInterFrameDelay!==void 0){const cr=ye.totalInterFrameDelay-ht.totalInterFrameDelay,Qr=ye.totalSquaredInterFrameDelay-ht.totalSquaredInterFrameDelay,Br=ye.framesDecodeCount-ht.framesDecodeCount,Ko=cr/Br*1e3,Fe=Math.round(1e3*Math.sqrt((Qr-Math.pow(cr,2)/Br)/Br));!isNaN(Fe)&&Ko+Fe>Math.max(3*Ko,Ko+150)&&(fe[ci.I_FRAME_DELAY]=Fe)}}return fe}(_._videoSSRC,n,i,_.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;A&&(S.video=A)}if(y.has(ft.AUDIO)&&_.audioTrack){const R=_.audioTrack?function(A,k,W,U,V,q){const Y=k.audioRecv.find(fe=>fe.ssrc===A);if(!Y)return;const ce={},_e=W&&W.audioRecv.find(fe=>fe.ssrc===A);if(Ft(ce,Go.JITTER,Y.jitterMs),Ft(ce,Go.BYTES_RETRANSMIT,Y.retransmittedBytesReceived),Ft(ce,Go.PACKAGES_RETRANSMIT,Y.retransmittedPacketsReceived),Ft(ce,Go.PACKAGES_DISCARDED,Y.packetsDiscarded),Ft(ce,Go.AVG_PROCESSING_DELAY,Y.avgProcessingDelayMs),_e){const fe=k.timestamp-W.timestamp||D_*(q?L_:V?sP:1);Y.packets!=null&&_e.packets!=null&&Ft(ce,Go.PACKAGE_RATE,1e3*(Y.packets-_e.packets)/fe),V&&_e.bytes!=null&&Y.bytes!=null&&Ft(ce,Go.BITRATE,8*(Y.bytes-_e.bytes)/fe),Y.packetsLost!=null&&_e.packetsLost!=null&&Ft(ce,Go.PACKAGE_LOST,Y.packetsLost-_e.packetsLost)}if(q){const{receivedFrames:fe,droppedFrames:ke}=Y;fe!=null&&ke!=null&&(ce[Go.FREEZE]=(ye=fe)===0||100*ke/ye>20?1:0)}var ye;if(V){const fe=100*U._source.getAccurateVolumeLevel(),ke=Y.outputLevel;if(ke!=null){const qe=Math.ceil(50*Math.log10(100*ke+1));Ft(ce,QG.LEVEL,qe)}if(Ft(ce,Go.PCM_LEVEL,fe),U&&(ce[Go.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),Ft(ce,Go.JITTER_BUFFER,Y.jitterBufferMs),Ft(ce,Go.CURRENT_DELAY,Y.jitterBufferMs),ce[Go.PLAYER_STATUS]=AL[Wo.getPlayerState(U.getTrackId())],_e){const qe=Y.concealedSamples-_e.concealedSamples;qe>0&&Ft(ce,Go.CONCEALED_SAMPLES,qe);const lt=Y.totalSamplesReceived-_e.totalSamplesReceived;lt>0&&Ft(ce,Go.TOTAL_SAMPLES_RECEIVED,lt)}}return ce}(_._audioSSRC,n,i,_.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const n=(this.requestAllTracks()||[]).find(i=>i instanceof AA);if(n&&n._external.getDenoiserStats){const i=n._external.getDenoiserStats();i&&this.requestUpload(ib.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(n=>{n.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(n=>{let[i,o]=n;o.has(ft.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(ft.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const n=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,S]of h)S.has(ft.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),S.has(ft.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(y,S){const R={};for(const{id:U,value:V,level:q,direction:Y}of y){var A;const ce=(A=S.get(U))!==null&&A!==void 0?A:0,_e=V===2?ce+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ce;var k,W;S.set(U,_e),R[U]?(V===2&&(R[U].value=V),q>R[U].level&&(R[U].level=q),Y==="remote"&&(R[U].remoteUidCount+=1),R[U].totalTs=(k=S.get(U))!==null&&k!==void 0?k:0):R[U]={value:V,level:q,remoteUidCount:Y==="local"?0:1,totalTs:(W=S.get(U))!==null&&W!==void 0?W:0}}return Object.keys(R).map(U=>{const{level:V,value:q,totalTs:Y}=R[U];return{id:U,level:V,value:q,totalTs:Y}})}(c,n);const m=Date.now(),_=m>i?m:i+1;this.requestUpload&&this.requestUpload(ib.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const yfe=re("ICE_RESTART_INTERVAL");let oP=new Map,Bv=new Map,Am=[ws.UDP_TCP_RELAY,ws.TCP_RELAY,ws.RELAY],vx=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Nn().supportPCSetConfiguration;function n9(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=oP.get(e.id);i&&(window.clearTimeout(i),oP.delete(e.id));const o=Bv.get(e.id);n&&o&&o.index===Am.length-1&&(D.debug("[".concat(e.id,"] reset ICE restart policy")),Bv.delete(e.id))}function r9(e,n,i){if(oP.size===0&&Bv.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let y=0;y<m.length;y+=1){const S=m[y];if(m.filter(R=>R===S).length!==_.filter(R=>R===S).length)return!1}return!0}(Am,re("RESTART_SEQUENCE"))&&(Am=re("RESTART_SEQUENCE").filter(m=>{var _;if(st(_=Object.values(ws)).call(_,m))return!0}),D.debug("use reconnection policy from config distribution, queues: ".concat(Am.join(" => ")))),vx=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Nn().supportPCSetConfiguration),Am.length===0)return void i();let o,{index:c=0,type:u}=Bv.get(e.id)||{};if(vx&&u===ws.RELAY)return void i();let h=u&&c>=Am.length-1;if(vx)u=ws.RELAY;else{if(h)return void i();u?(c++,u=Am[c]):(u=Am[0],c=0)}D.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),n(u),Bv.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>r9(e,n,i),yfe),oP.set(e.id,o)}var un;function i9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ph(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?i9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):i9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function s9(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=GD,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new aP(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function aP(e){function n(i){if(Object(i)!==i)return ct.reject(new TypeError(i+" is not an object."));var o=i.done;return ct.resolve(i.value).then(function(c){return{value:c,done:o}})}return aP=function(i){this.s=i,this.n=i.next},aP.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?ct.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?ct.reject(i):n(o.apply(this.s,arguments))}},new aP(e)}let gb=(un=class extends Ir{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(Ot.StateChange,n,this._state)}constructor(e,n){super(),$(this,"isPlanB",void 0),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"connection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"remoteDataChannelMap",new Map),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"pendingLocalDataChannels",[]),$(this,"pendingRemoteDataChannels",[]),$(this,"statsCollector",void 0),$(this,"shouldForwardP2PCreation",void 0),$(this,"iceFailedCount",0),$(this,"dtlsFailedCount",0),$(this,"mutex",void 0),$(this,"_state",zn.Disconnected),$(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?zp.FIRST_CONNECTION:zp.OLD_FIRST_CONNECTION),$(this,"_isStartRestartIce",!1),$(this,"_restartTimer",void 0),$(this,"_isTryConnecting",!1),$(this,"_iceError",null),$(this,"_forceTurn",!1),$(this,"_isWaitPcToRePub",!1),$(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==zn.Connected)return void c(new De(X.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createMuteMessage(h);await sr(this,Ot.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==zn.Connected)return void c(new De(X.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(y.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}else{const S=yx(i,JT(this,Ot.RequestLowStreamParameter));y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}await new ct((S,R)=>{this.handleReplaceTrack(y.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createUnmuteMessage(h);await sr(this,Ot.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(He.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==zn.Connected)return void o();const{id:y,track:S}=_;await this.connection.updateSendParameters(y,S),await this.connection.updateEncoderConfig(y,S),this.emit(Ot.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(He.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==zn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==zn.Connected)return void o();const h=_x([i]);let m;D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(y){c(y)}finally{var _;(_=m)===null||_===void 0||_()}}),$(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.connection||!y||this.state!==zn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),this.isPlanB){const S=y[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(y[0],S)}if(y[0]===He.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding){const S=this.localTrackMap.get(He.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ct((A,k)=>{this.handleReplaceTrack(S.track,A,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new t9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ts("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Nn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Mp(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&Nn().supportPCSetConfiguration&&nL(),this.shouldForwardP2PCreation&&(this.connection=nP(this.store),this.emit(Ot.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var n;this.state=zn.New,this._forceTurn=YG(e),D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=nP(this.store,e),this.emit(Ot.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new De(X.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?zp.FIRST_CONNECTION:zp.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new De(X.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");re("ENABLE_PREALLOC_PC")&&this.state===zn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=zn.Connected)}updateRemoteRTPCapabilities(e){const n=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return st(u=[He.LocalVideoLowTrack,He.LocalVideoTrack]).call(u,h)}),i=n.map(c=>{let[,{id:u}]=c;return u}),o=n.map(c=>{let[u]=c;return u});if(this.connection instanceof dh){if(bt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!st(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>st(e).call(e,u));c&&(this.store.codec=c,D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof dh&&this.connection.peerConnectionState!=="closed"&&st(e=[zn.New,zn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==zn.Connected){if(this.state===zn.Disconnected)throw new De(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;st(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const n=this.filterTobePublishedDataChannels(e);return n.length===0?[]:(n.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,n),n.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,n,i){var o=this;return ul(function*(){const c=yield Rn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&st(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==zn.Connected||h){if(o.state===zn.Disconnected)throw new De(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Rs.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,n,i);if(m.length===0)return void(yield Rn(o.tryToUnmuteAudio(e)));yield*tA(s9(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,n){var i=this;return ul(function*(){n.forEach(A=>{let{track:k,type:W}=A;const U=Date.now();i.store.publish(k.getTrackId(),W===He.LocalAudioTrack?"audio":"video",U)}),i.bindLocalTrackEvents(n);const o=n.map(A=>{let{track:k}=A;return k}),c=yield Rn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield Rn(c.next())).value,h=i.createGatewayPublishMessage(n,u);let m;try{m=yield h}catch(A){throw c.throw(A),(A==null?void 0:A.code)===X.WS_ABORT&&n.forEach(k=>{let{track:W}=k;i.pendingLocalTracks.indexOf(W)===-1&&i.pendingLocalTracks.push(W)}),i.unbindLocalTrackEvents(n),A}const _=i.mapPubResToRemoteConfig(h,m,o),y=(yield Rn(c.next(_))).value;if(i.state===zn.Disconnected)throw new De(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const S=re("ENABLE_ENCODED_TRANSFORM"),R=re("ENABLE_AUDIO_METADATA");o.forEach(async A=>{const k=A.getRTCRtpTransceiver();if(!k||!S)return;const{interceptLocalVideoFrame:W,interceptLocalAudioFrame:U}=YA();A.trackMediaType===ft.VIDEO?await W(k.sender,A):A.trackMediaType===ft.AUDIO&&await U(k.sender,{metadata:R?()=>{const V=A.metadata.shift();return V&&V.value}:void 0})}),n.forEach(A=>{let{type:k}=A;i.statsCollector.addLocalStats(k)}),i.assignLocalTracks(n,y),i.statsUploader.startUploadOutboundStats(),n.forEach(A=>{let{track:k,type:W}=A;const U=Date.now();i.store.publish(k.getTrackId(),W===He.LocalAudioTrack?"audio":"video",void 0,U)})})()}async updateVideoStreamParameter(e,n){const i=this.localTrackMap.get(n);if(!i||!this.connection)return;if(!(i.track instanceof fr))return D.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=tx(u,h)),m.maxFramerate=u.framerate?Ka(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),n!==He.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return D.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=Ka(m.width)),m.height&&(_.height=Ka(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=OL(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},Ka(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),D.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var n=this;return ul(function*(){if(!n.connection||n.state!==zn.Connected)return;const i=yield Rn(n.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=n.localTrackMap.get(He.LocalVideoTrack);if(!c)throw new De(X.UNEXPECTED_ERROR,"Could not find high stream");if(n.localTrackMap.has(He.LocalVideoLowTrack))throw new De(X.UNEXPECTED_ERROR,"[".concat(n.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:n.getLowVideoTrack(c.track,e),type:He.LocalVideoLowTrack}];if(yield*tA(s9(n.doPublish(n.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=n.localTrackMap.get(He.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Rn(n.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await fs(this,Ot.RequestRePublish,this.pendingLocalTracks),this.emit(Ot.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(D.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await fs(this,Ot.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let n=this.pendingRemoteTracks.length-1;n>=0;n--){const{user:i,kind:o}=this.pendingRemoteTracks[n];(o!==ft.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==ft.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1)}if(e)await fs(this,Ot.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:n,kind:i}of this.pendingRemoteTracks)await this.subscribe(n,i,i===ft.VIDEO?n._videoSSRC:n._audioSSRC);this.pendingRemoteTracks.forEach(n=>{let{user:i}=n;this.emit(Ot.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==zn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,n)}async unpublishDataChannel(e){if(!this.connection||this.state!==zn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const n=this.filterTobeUnpublishedDataChannels(e);return n.length!==0?(n.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),n.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==zn.Connected)return;const e=this.localTrackMap.get(He.LocalVideoLowTrack);if(!e)return;e.track.close();const n=[[He.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,n)}async doUnpublish(e,n){const i=this.createGatewayUnpublishMessage(n);return await e.stopSending(n.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),n.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,n){if(!this.connection||this.state!==zn.Connected)throw new De(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=n.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,n,i,o,c){var u;if(!this.connection||this.state!==zn.Connected)throw new De(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(n))return;let h,m,_;const y=this.connection.getPreMedia(i);if(y)D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=y.transceiver,h=y.track,m=y.id;else if(c){const A=c.find(W=>{let{stream_type:U}=W;return U===n});if(!A)throw new De(X.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));const k=await this.connection.receive(n,A.ssrcs,String(e._uintid),A.attributes);this.connection instanceof dh&&(_=k.transceiver),h=k.track,m=k.id}else{const A=await this.connection.receive(n,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof dh&&(_=A.transceiver),h=A.track,m=A.id}if(n===ft.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Av(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Iv(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:k}=YA();n==ft.VIDEO?await A(_.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(W=>{var U;return(U=e._videoTrack)===null||U===void 0?void 0:U._onSei(W)})}):n==ft.AUDIO&&await k(_.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:W=>{this.safeEmit(Ot.AudioMetadata,W)}})}const S=this.remoteUserMap.get(e);S?S.set(n,m):this.remoteUserMap.set(e,new Map([[n,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(A=>{let{user:k,kind:W}=A;return k.uid===e.uid&&n===W});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Ot.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==zn.Connected)throw new De(X.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const n=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):n.push(c)});const o=await this.connection.batchReceive(n.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));n.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=i.get(h);if(!m)return void D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:y,transceiver:S}=m;if(S&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:W}=YA();u==ft.VIDEO?await k(S.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(U=>{var V;return(V=c._videoTrack)===null||V===void 0?void 0:V._onSei(U)})}):u==ft.AUDIO&&await W(S.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(Ot.AudioMetadata,U)}})}if(u===ft.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new Av(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Iv(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),re("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:W}=YA();u==ft.VIDEO?await k(S.receiver,{onSei:U=>{var V;(V=c._videoTrack)===null||V===void 0||V._onSei(U)}}):u==ft.AUDIO&&await W(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex(k=>{let{user:W,kind:U}=k;return W.uid===c.uid&&u===U});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Ot.MediaReconnectEnd,c.uid))}}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return n!==void 0?m.uid===e.uid&&n===_:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===zn.Connected||i||o.forEach(h=>{let{kind:m}=h;var _;if(m===ft.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===ft.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==zn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,n);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var y,S;if(_===ft.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===ft.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===ft.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,n){if(n.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,n);if(i.length===0)return;n.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let n=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:y}=m;return u!==void 0?_.uid===c.uid&&u===y:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),n=n.concat(h)}if(!this.connection||this.state!==zn.Connected)return void n.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===ft.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===ft.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=Fa(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===ft.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===ft.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===ft.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==zn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===ft.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}addAudioMetadata(e){const n=this.localTrackMap.get(He.LocalAudioTrack),i=n&&n.track;i&&i.metadata.push(e)}getAllTracks(e){const n=this.localTrackMap.get(He.LocalAudioTrack);if((n==null?void 0:n.track)instanceof vi){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==He.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===He.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===He.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get(He.LocalAudioTrack),m=o?this.localTrackMap.get(He.LocalVideoLowTrack):this.localTrackMap.get(He.LocalVideoTrack);bt.publish(this.store.sessionId,{eventElapse:Rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof jr),m=o?(u=this.localTrackMap.get(He.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof fr);bt.publish(this.store.sessionId,{eventElapse:Rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===ft.VIDEO?i._videoSSRC:i._audioSSRC;c&&bt.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===ft.VIDEO,audio:o===ft.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Rs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ts("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=nP(this.store),this.emit(Ot.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(He.LocalAudioTrack);if((e==null?void 0:e.track)instanceof vi){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=zn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.connection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(He.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(He.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof fr||n&&n.track instanceof jr?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(Rc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(He.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=LT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=zn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=nP(this.store),this.emit(Ot.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case He.LocalVideoTrack:st(n=o._hints).call(n,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case He.LocalAudioTrack:o instanceof vi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case He.LocalVideoLowTrack:}}),this.emit(Ot.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(Rc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(Ot.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[n,i]=e;Array.from(Rc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(n,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,n){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof Im?e.uid:e)===o.uid&&c===n)return!0}return!1}setPendingRemoteDataChannel(e,n){this.hasPendingRemoteDataChannel(e,n)||this.pendingRemoteDataChannels.push({user:e,id:n})}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Im?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}restartICE(e){var n=this;return ul(function*(){if(!n.connection||n.state!==zn.Connected)return;const i=yield Rn(n.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Rn(n.connection.restartICE(e));const u=yield Rn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(Ex(n.connection)&&n.reportPCStats(Date.now(),!1,n._pcStatsUploadType),e){case ws.UDP_TCP_RELAY:n._pcStatsUploadType=zp.UDP_TCP_RESTART;break;case ws.TCP_RELAY:n._pcStatsUploadType=zp.TCP_RESTART;break;case ws.RELAY:n._pcStatsUploadType=zp.RELAY_RESTART;break;default:n._pcStatsUploadType=zp.OLD_RESTART}n._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),n=this.localTrackMap.get(He.LocalVideoTrack),i=this.localTrackMap.get(He.LocalAudioTrack),o=e.videoSend.find(k=>k.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId)),c=e.audioSend.find(k=>k.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=bc(this,Ot.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,A=n==null?void 0:n.track;if(A&&A._encoderConfig&&A._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=A._encoderConfig.bitrateMax,W=e.bitrate.actualEncoded;if(k&&W){const U=(1e3*k-W)/(1e3*k);return Fz[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(W=>W.ssrc===c),m=e.videoRecv.find(W=>W.ssrc===u);if(!h&&!m)return void(n+=1);const _=bc(this,Ot.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,A=e.recvPacketLossRate;let k=.7*A*100/50+.3*S/1500;R&&(k=.6*A*100/50+.2*S/1500+.2*R/400),n+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new ct((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}async replaceTrack(e,n){var i;if(D.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(n.getTrackId(),"]")),!this.connection||this.state!==zn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==n&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:n,type:c}]),o[1].track=n),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(n,o[1].id)),this.isPlanB){const u=o[1];u.id=n._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===He.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding){const u=this.localTrackMap.get(He.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new ct((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,n,i){const o=[],c=this.getAllTracks();e=fv(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get(He.LocalAudioTrack);for(const _ of e){if(_ instanceof fr&&(this.localTrackMap.has(He.LocalVideoTrack)||h?new De(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:He.LocalVideoTrack}),h=!0),n)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:He.LocalVideoLowTrack})}if(_ instanceof jr)if(m){const y=m.track;if(y instanceof vi)gx([_]),y.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=_x([y,_]);D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(y,S)}}else u instanceof vi?(gx([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&Nn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=_x(u?[_,u]:[_]):u=_}return u&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:He.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=fv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof jr){const c=this.localTrackMap.get(He.LocalAudioTrack);if(!c)continue;c.track instanceof vi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([He.LocalAudioTrack,c]),c.track.close())):n.push([He.LocalAudioTrack,c])}if(o instanceof fr){const c=this.localTrackMap.get(He.LocalVideoTrack);if(!c)continue;n.push([He.LocalVideoTrack,c]);const u=this.localTrackMap.get(He.LocalVideoLowTrack);u&&n.push([He.LocalVideoLowTrack,u])}}return n}filterTobePublishedDataChannels(e){return e=(e=fv(e)).filter(n=>this.localDataChannels.findIndex(i=>i.id===n.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=fv(e)).filter(n=>this.localDataChannels.indexOf(n)!==-1)).filter(n=>n._originDataChannel)}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case He.LocalVideoTrack:i.addListener(gt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(gt.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case He.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof vi?e.trackList.forEach(i=>{i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||(e.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(gt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case He.LocalVideoTrack:i.off(gt.GET_STATS,this.handleGetLocalVideoStats),i.off(gt.GET_RTC_STATS,this.handleGetRTCStats),i.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case He.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof vi?e.trackList.forEach(n=>{n.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(gt.GET_STATS,this.handleGetLocalAudioStats),n.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(gt.GET_STATS,this.handleGetLocalAudioStats),e.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(gt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof Iv&&n.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof Av&&n.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(gt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(ft.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(ft.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,h,{track:m,type:_}=i;switch(_){case He.LocalAudioTrack:u=Gn.Audio,h={dtx:m instanceof AA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case He.LocalVideoTrack:u=st(c=m._hints).call(c,ar.SCREEN_TRACK)?Gn.Screen:Gn.High,h=ph(ph({},rG(m)),{},{codec:this.store.codec,svc_mode:GA()});break;case He.LocalVideoLowTrack:u=Gn.Low,h=ph(ph({},rG(m)),{},{codec:this.store.codec,svc_mode:GA()})}return{stream_type:u,attributes:h,ssrcs:n[o]}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case He.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case He.LocalAudioTrack:o=Gn.Audio;break;case He.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{if(D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(n,")")),this.emit(Ot.PeerConnectionStateChange,n),n==="connecting"&&e instanceof dh&&!kr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{n==="connecting"&&e.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof dh&&n9(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=zp.DISCONNECTED_OR_FAILED,bc(this,Ot.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));bt.reportApiInvoke(this.store.sessionId,{name:fi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:Dr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&e instanceof dh&&!kr()&&!this._forceTurn){if(st(Xz).call(Xz,n)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{Ex(e)&&(D.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),bc(this,Ot.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ot.RequestRestartICE,c))},o=()=>{Ex(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),D.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ot.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{r9(e,i,o)},800))}}else{if(n==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&bc(this,Ot.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ot.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ot.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);n==="failed"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ot.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),bt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:Dr.TRACER}).onSuccess(),this.emit(Ot.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(Rc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Tv.FIRST_FRAME_DECODED),bt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_DECODE,Tr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Rs.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(Rc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&bt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_RECEIVED,Tr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Rs.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(Rc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&bt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_VIDEO_RECEIVED,Tr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Rs.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(Ot.ConnectionTypeChange,o),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wm(i))," -> ").concat(JSON.stringify(wm(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wm(i))," -> ").concat(JSON.stringify(wm(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const n=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return ph(ph({},n),i)},e.onICECandidateError=n=>{this._iceError=n}}resetConnection(e){e instanceof dh&&function(n){Bv.delete(n.id),n9(n)}(e),e.close(),this.emit(Ot.PeerConnectionStateChange,"closed"),function(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(He.LocalAudioTrack);if(e instanceof jr&&(i==null?void 0:i.track)instanceof vi)return i.track.isActive||n.push([He.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===He.LocalVideoTrack)){const c=this.localTrackMap.get(He.LocalVideoLowTrack);c&&n.push([He.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(He.LocalAudioTrack);if(e instanceof jr&&(i==null?void 0:i.track)instanceof vi)return i.track.isActive&&n.push([He.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===He.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get(He.LocalVideoLowTrack);c&&n.push([He.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case He.LocalAudioTrack:o=Gn.Audio;break;case He.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case He.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case He.LocalAudioTrack:o=Gn.Audio;break;case He.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case He.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,n){const i=[];return n.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case ft.VIDEO:return void(o._videoSSRC&&n.push({stream_type:ft.VIDEO,ssrcId:o._videoSSRC}));case ft.AUDIO:return void(o._audioSSRC&&n.push({stream_type:ft.AUDIO,ssrcId:o._audioSSRC}))}}),n}createUnsubscribeAllMessage(e){const n=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(n.has(o)){let u=n.get(o);c===ft.VIDEO?u|=ki.Video:u|=ki.Audio,n.set(o,u)}else c===ft.VIDEO?n.set(o,ki.Video):n.set(o,ki.Audio)}),{users:Array.from(n.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(He.LocalVideoTrack),i=this.localTrackMap.get(He.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new ct((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ct((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,n,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=n.find(_=>{let{stream_type:y}=_;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&re("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(st(_).call(_,ar.SCREEN_TRACK)||st(_).call(_,ar.SCREEN_LOW_TRACK))&&(m.remb=!1,D.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof jr){var n;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((n=this.connection)===null||n===void 0?void 0:n.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await sr(this,Ot.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.connection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(Ot.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(Ot.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ji(uL(this.dtlsFailedCount,mi)),this.emit(Ot.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),n.length>0&&await fs(this,Ot.RequestUnpublishForReconnectPC,n),this.disconnectForReconnect(),this.emit(Ot.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(He.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof fr)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof fr).length>1)throw new De(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof jr).length>1&&(e.some(n=>n instanceof jr&&n._bypassWebAudio)||!Nn().webAudioMediaStreamDest))throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof fr&&this.pendingLocalTracks.some(i=>i instanceof fr))throw new De(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof jr&&this.pendingLocalTracks.some(i=>i instanceof jr)&&(!Nn().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof jr&&i._bypassWebAudio)))throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){var i;const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding,c=ph(ph({},{width:160,height:120,framerate:15,bitrate:50}),n);let u;u=o?e._mediaStreamTrack.clone():yx(e,c);const h=or(8,"track-low-"),m=new fr(u,ph(ph({},o&&{scaleResolutionDownBy:tx(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(T_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,vv.LOW_STREAM)}),m._hints.push(ar.LOW_STREAM),st(i=e._hints).call(i,ar.SCREEN_TRACK)&&m._hints.push(ar.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(gt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,n,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof dh){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:A,remote:k}=await this.connection.getSelectedCandidatePair();bt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:y,dtlsstate:S,connectionstate:R,intSucc:n?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=A==null?void 0:A.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=A.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(A.address,":").concat(A.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(Rc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");bt.firstRemoteVideoDecode(this.store.sessionId,Oi.FIRST_VIDEO_DECODE,Tr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Rs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===He.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,vv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},_t(un.prototype,"startP2PConnection",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"startP2PConnection"),un.prototype),_t(un.prototype,"connect",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"connect"),un.prototype),_t(un.prototype,"updateRemoteRTPCapabilities",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"updateRemoteRTPCapabilities"),un.prototype),_t(un.prototype,"publishDataChannel",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"publishDataChannel"),un.prototype),_t(un.prototype,"unpublish",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unpublish"),un.prototype),_t(un.prototype,"unpublishDataChannel",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unpublishDataChannel"),un.prototype),_t(un.prototype,"unpublishLowStream",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unpublishLowStream"),un.prototype),_t(un.prototype,"subscribeDataChannel",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"subscribeDataChannel"),un.prototype),_t(un.prototype,"subscribe",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"subscribe"),un.prototype),_t(un.prototype,"massSubscribe",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"massSubscribe"),un.prototype),_t(un.prototype,"unsubscribe",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribe"),un.prototype),_t(un.prototype,"unsubscribeDataChannel",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribeDataChannel"),un.prototype),_t(un.prototype,"massUnsubscribe",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"massUnsubscribe"),un.prototype),_t(un.prototype,"muteRemote",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),_t(un.prototype,"unmuteRemote",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),_t(un.prototype,"hasRemoteMediaWithLock",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"hasRemoteMediaWithLock"),un.prototype),_t(un.prototype,"disconnectForReconnect",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"disconnectForReconnect"),un.prototype),_t(un.prototype,"updateBitrateLimit",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"updateBitrateLimit"),un.prototype),_t(un.prototype,"remoteMediaSsrcChanged",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"remoteMediaSsrcChanged"),un.prototype),un);function Qs(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function o9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function a9(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?o9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const vfe=Date.now(),Sfe=20,Sx=new Map,cP=new Map;async function c9(e){const n=Sx.get(e),i=Array.isArray(n)&&n[n.length-1],o=cP.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(n.pop(),l9(i.context,c),m=0):m=Math.min(m,Sfe),setTimeout(()=>n.length&&c9(e),m)}function l9(e,n){e.safeEmit(fn.STREAM_MESSAGE,n.uid,n.payload),e.onStreamMessage&&e.onStreamMessage(n)}function Tfe(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return l9(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=Sx.get(o)||[],u=c.findIndex(y=>e.sendTs>=y.sendTs),h=a9(a9({},e),{},{context:i,mediaDelay:n,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),Sx.set(o,c);let m=!1;var _;cP.has(o)?m=!((_=cP.get(o))===null||_===void 0||!_.isSyncing):cP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||c9(o)}const bfe=Cn().name;function u9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function d9(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?u9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Wv="websdk_ng_cache_parameter",wfe=re("MAX_PRELOAD_ASYNC_LENGTH"),Rfe=1e4,x_=new Map,M_=[];let Tx=null,bx=0,wx=0;const lP=new Map,Cfe=function(e,n){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<n?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new ct(async(_,y)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){y(S)}}),o<n&&(o++,c())})}}(h9,wfe),Rx=Bo.CancelToken.source();async function h9(e,n,i,o,c,u){try{if(!re("ENABLE_PRELOAD"))return;if(!Nn().supportWebCrypto)return void Em(()=>{D.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new De(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Xi(i,"token",1,2047),Xi(e,"appid",1,2047),FA(n),o&&jA(o);const h=v_();D.debug("preload channel ".concat(n,", uid is ").concat(o));const m={appId:e,cname:n,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,y;typeof o=="string"?(m.stringUid=o,[y,_]=await ct.all([cfe(o,{sid:h,appId:e},Rx.token),LG(d9(d9({},m),{},{token:i||e,uid:0}),Rx.token)]),m.uid=y.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await LG(m,Rx.token));const S={sid:h,appId:e,cname:n,token:i||e,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:_};await async function(R){let A;try{R.uid&&f9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const k=E9(R),W=await async function(V,q){try{const Y=await window.crypto.subtle.importKey("raw",i8(q),"AES-GCM",!1,["encrypt"]),ce=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,y_(window.btoa(JSON.stringify(V))));return ym(new Uint8Array(ce))}catch{return}}(R,R.token||R.appId);if(!W)return;A=_9(Wv);const U=A?JSON.parse(A):[];U.push({[k]:W}),U.length>re("AP_CACHE_NUM")&&U.shift(),uP(Wv,JSON.stringify(U))}catch(k){D.warn("Error caching server parameters:",k.message),uP(Wv,"")}}(S),bx++}catch(h){throw wx++,function(m){Tx||(Tx=window.setTimeout(()=>{let y="";lP.forEach((S,R)=>{y+="".concat(R,": ").concat(S," ;")}),bt.reportApiInvoke(null,{name:fi.PRELOAD,options:{success:bx,failed:wx,err:y}}).onError(m),bx=0,wx=0,lP.clear(),Tx=null},Rfe));const _=lP.get(m.code)||0;lP.set(m.code,_+1)}(h),h}}async function p9(e){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const n=f9(e);if(!n||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",i8(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,y_(o));return JSON.parse(window.atob(ym(new Uint8Array(h))))}catch{return}}(n,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<re("AP_CACHE_LIFETIME"))return i}catch(n){D.warn("Error get preloadInfo",n.message)}}function f9(e){let n;try{if(n=_9(Wv),!n)return;const i=JSON.parse(n),o=E9(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return uP(Wv,JSON.stringify(i)),u[o]}catch(i){D.warn("Error delete preload info: ".concat(n),i.message),uP(Wv,"")}}function Cx(e){if(e){let n=x_.get(e);n&&(window.clearTimeout(n),n=null,x_.delete(e)),st(M_).call(M_,e)||e.cloudProxyServer!=="disabled"||M_.push(e)}if(x_.size<re("AP_CACHE_NUM")&&M_.length>0){const n=M_.shift();x_.set(n,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=n;try{await Cfe(i,o,c,h,m,u),x_.has(n)&&Cx(n)}catch(_){D.warn("update preload failed",_.message),m9(n)}},re("AP_UPDATE_INTERVAL")))}}function m9(e){const n=M_.indexOf(e);n!==-1&&M_.splice(n,1);let i=x_.get(e);i&&(window.clearTimeout(i),i=null,x_.delete(e),Cx())}function g9(e,n){const i=e.sua,o=e.ap;n&&i&&bt.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:n,uid:e.intUid,errorCode:null,extend:i.req}),bt.reportResourceTiming(e.ap.url,e.sid),bt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[oi.CHOOSE_SERVER,oi.CLOUD_PROXY_FALLBACK].toString()}),bt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[oi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function _9(e){return window.atob(window.localStorage.getItem(e)||"")}function uP(e,n){window.localStorage.setItem(e,window.btoa(n))}function E9(e){let n="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(n+="_s_".concat(e.uid)),typeof e.uid=="number"&&(n+="_".concat(e.uid)),e.token&&(n+="_".concat(e.token)),d8(n)}function Ife(e){let n=function(){const i=Ofe.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(li(o,10),Pm(o,c));let u=i.cid;u!==void 0&&(li(o,16),li(o,u));let h=i.cname;h!==void 0&&(li(o,26),Pm(o,h));let m=i.deviceId;m!==void 0&&(li(o,34),Pm(o,m));let _=i.elapse;_!==void 0&&(li(o,40),Om(o,_));let y=i.fileSize;y!==void 0&&(li(o,48),Om(o,zv(y)));let S=i.height;S!==void 0&&(li(o,56),Om(o,zv(S)));let R=i.jpg;R!==void 0&&(li(o,66),li(o,R.length),v9(o,R));let A=i.networkType;A!==void 0&&(li(o,72),Om(o,zv(A)));let k=i.osType;k!==void 0&&(li(o,80),Om(o,zv(k)));let W=i.requestId;W!==void 0&&(li(o,90),Pm(o,W));let U=i.sdkVersion;U!==void 0&&(li(o,98),Pm(o,U));let V=i.sequence;V!==void 0&&(li(o,104),Om(o,zv(V)));let q=i.sid;q!==void 0&&(li(o,114),Pm(o,q));let Y=i.timestamp;Y!==void 0&&(li(o,120),Om(o,Y));let ce=i.uid;ce!==void 0&&(li(o,128),li(o,ce));let _e=i.vid;_e!==void 0&&(li(o,136),li(o,_e));let ye=i.width;ye!==void 0&&(li(o,144),Om(o,zv(ye)));let fe=i.service;fe!==void 0&&(li(o,152),li(o,fe));let ke=i.callbackData;ke!==void 0&&(li(o,162),li(o,ke.length),v9(o,ke));let qe=i.ticket;qe!==void 0&&(li(o,170),Pm(o,qe));let lt=i.vendorConfigs;lt!==void 0&&(li(o,178),Pm(o,lt))}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function Afe(e){return function(i){let o={};e:for(;!kfe(i);){let c=_b(i);switch(c>>>3){case 0:break e;case 1:o.code=_b(i);break;case 2:o.msg=S9(i,_b(i));break;case 3:o.requestId=S9(i,_b(i));break;case 4:o.timestamp=Nfe(i,!1);break;default:Pfe(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function Pfe(e,n){switch(n){case 0:for(;128&cu(e););break;case 2:Ix(e,_b(e));break;case 5:Ix(e,4);break;case 1:Ix(e,8);break;default:throw new Error("Unimplemented type: "+n)}}function zv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Ofe=[];function Ix(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function kfe(e){return e.offset>=e.limit}function dP(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function y9(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function v9(e,n){let i=dP(e,n.length);e.bytes.set(n,i)}function S9(e,n){let i=y9(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<n;m++){let _,y,S,R,A=c[m+i];(128&A)==0?h+=o(A):(224&A)==192?m+1>=n?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&A)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&A)==224?m+2>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&A)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&A)==240?m+3>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&A)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Pm(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}li(e,o);let c=dP(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function cu(e){return e.bytes[y9(e,1)]}function T9(e,n){let i=dP(e,1);e.bytes[i]=n}function _b(e){let n,i=0,o=0;do n=cu(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function li(e,n){for(n>>>=0;n>=128;)T9(e,127&n|128),n>>>=7;T9(e,n)}function Nfe(e,n){let i,o=0,c=0,u=0;return i=cu(e),o=127&i,128&i&&(i=cu(e),o|=(127&i)<<7,128&i&&(i=cu(e),o|=(127&i)<<14,128&i&&(i=cu(e),o|=(127&i)<<21,128&i&&(i=cu(e),c=127&i,128&i&&(i=cu(e),c|=(127&i)<<7,128&i&&(i=cu(e),c|=(127&i)<<14,128&i&&(i=cu(e),c|=(127&i)<<21,128&i&&(i=cu(e),u=127&i,128&i&&(i=cu(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:n}}function Om(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=dP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const b9={},w9={},hP=4294967296,Dfe=hP*hP,Lfe=Dfe/2;C9(0,!0);const R9=C9(0),xfe=Eb(0,-2147483648,!1),Mfe=Eb(-1,2147483647,!1);function C9(e,n){let i,o,c;return n?(c=0<=(e>>>=0)&&e<256)&&(o=w9[e],o)?o:(i=Eb(e,0,!0),c&&(w9[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=b9[e],o)?o:(i=Eb(e,e<0?-1:0,!1),c&&(b9[e]=i),i)}function Eb(e,n,i){return{low:0|e,high:0|n,unsigned:!!i}}function I9(e,n){if(isNaN(e))return R9;{if(e<=-9223372036854776e3)return xfe;if(e+1>=Lfe)return Mfe}return e<0?R9:Eb(e%hP|0,e/hP|0,n)}function A9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class Ax extends Ir{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(ad.CONNECTION_STATE_CHANGE,n,i)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var i;super(),$(this,"name","AgoraRTCImageModeration"),$(this,"_connectionState",fl.CONNECTING),$(this,"_sequence",0),$(this,"_moderationStartTime",void 0),$(this,"_workerConnection",void 0),$(this,"_workerMessageLengthLimit",void 0),$(this,"_qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Bo.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"_moderationInterval",void 0),$(this,"_moderationTimer",null),$(this,"_moderationMode",1),$(this,"_quality",1),$(this,"_qualityTimer",null),$(this,"_ticket",void 0),$(this,"_moderationIntervalMinimum",void 0),$(this,"_uploadFailedNum",0),$(this,"_uploadNum",0),$(this,"_uploadTimer",null),$(this,"_extraInfo",void 0),$(this,"_vendor",""),$(this,"_encoder",new TextEncoder),$(this,"_moderationId",void 0),$(this,"inspectImage",()=>{if(this.connectionState!==fl.CONNECTED)throw new Pe(X.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===fl.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=or(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new ab("worker-"+this._moderationId,mi),this.on(ad.STATE_CHANGE,(o,c)=>{D.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Nv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(n,i){this.emit(ad.STATE_CHANGE,Nv.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new ct((c,u)=>{this.on(ad.CONNECTION_STATE_CHANGE,(h,m)=>{h===fl.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(n){var i;this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),D.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===fl.CONNECTED&&this.inspectImage()}async requestAP(n,i,o){const c=re("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,y,S,R){let{appId:A,areaCode:k,cname:W,sid:U,token:V,uid:q}=y;Vv++;const Y="moderation_plugin",ce={service_name:Y,json_body:JSON.stringify({appId:A,areaCode:k,cname:W,command:"allocateEdge",requestId:Vv,seq:Vv,sid:U,appToken:V,ts:Date.now(),uid:q+""})};let _e,ye,fe=_[0];return rd(async()=>{_e=Date.now();const ke=await cd(fe,{data:ce,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-_e,ke.code!==0){const ht=new Pe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ke.code,{retry:!0,responseTime:ye});throw D.error(ht.toString()),ht}const qe=JSON.parse(ke.json_body);if(qe.code!==200){const ht=new Pe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(qe.code,", reason: ").concat(qe.reason),{code:qe.code,responseTime:ye});throw D.error(ht.toString()),ht}if(!qe.servers||!Array.isArray(qe.servers)||qe.servers.length===0){const ht=new Pe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:qe.code,responseTime:ye});throw D.error(ht.toString()),ht}if(!qe.servers.some(ht=>!!ht.wss)){const ht=new Pe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:qe.code,responseTime:ye});throw D.error(ht.toString()),ht}const lt=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:qe.servers.map(ht=>{let{address:yn,wss:vn}=ht;if(yn&&vn)return"wss://".concat(yn.replace(/\./g,"-"),".").concat(lt,":").concat(vn,"/moderation")}).filter(ht=>!!ht),workerToken:qe.workerToken,vid:qe.vid,ticket:qe.appTicket,responseTime:ye}},(ke,qe)=>(bt.apworkerEvent(U,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ke.addressList),firstSuccess:qe===0,responseTime:ye,serverIp:_[qe%_.length]}),!1),(ke,qe)=>(bt.apworkerEvent(U,{success:!1,sc:ke.data&&ke.data.code||200,serviceName:Y,responseTime:ye,serverIp:_[qe%_.length]}),!!(ke.code!==X.OPERATION_ABORTED&&ke.code!==X.UNEXPECTED_RESPONSE||ke.data&&ke.data.retry)&&(fe=_[(qe+1)%_.length],!0)),R)}(c,n,i,o);this.emit(ad.STATE_CHANGE,Nv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(n){this.emit(ad.STATE_CHANGE,Nv.CONNECT_WORKER),await this._workerConnection.init(n,1e4)}handleWorkerEvents(){this._workerConnection.on(qt.CONNECTED,async()=>{this.emit(ad.STATE_CHANGE,Nv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=fl.CONNECTED}),this._workerConnection.on(qt.CLOSED,()=>{this.connectionState=fl.CLOSED}),this._workerConnection.on(qt.FAILED,()=>{this.connectionState=fl.CLOSED}),this._workerConnection.on(qt.RECONNECTING,()=>{this.connectionState=this.connectionState===fl.CONNECTED?fl.RECONNECTING:fl.CONNECTING}),this._workerConnection.on(qt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const i=Afe(new Uint8Array(n.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,D.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{bt.reportApiInvoke(this._connectInfo.sid||null,{name:fi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Dr.TRACER}).onError(new Pe(X.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else D.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(qt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this._workerConnection.on(qt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}async requestToInspectImage(){const n=bc(this,ad.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(n,i);this._workerConnection.sendMessage(o,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being published can be inspected")}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await n.getCurrentFrameImage("image/jpeg",this.quality),R=await eW(S,o,c),A=this._sequence+"-"+u+"-"+_+"-"+y+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:Ax.intToLong(Number(y-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:A,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:I9(y),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const W=Ife(k);if(W.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=function(V){for(var q=1;q<arguments.length;q++){var Y=arguments[q]!=null?arguments[q]:{};q%2?A9(Object(Y),!0).forEach(function(ce){$(V,ce,Y[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Y)):A9(Object(Y)).forEach(function(ce){Object.defineProperty(V,ce,Object.getOwnPropertyDescriptor(Y,ce))})}return V}({},k);delete U.jpg,D.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return W}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Bo.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=fl.CLOSED,this.emit(ad.STATE_CHANGE,Nv.CLOSED)}}function P9(e){if(tr(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Pe(X.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Pe(X.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Ufe={name:"ImageModeration",create:function(e){let{config:n}=e;return P9(n),new Ax(n)}};var O9,k9,N9,D9,L9,x9,M9,U9,V9,F9,j9,B9,W9,z9,G9,H9,$9,K9,q9,Y9,X9,J9,Q9,Z9,eH,tH,nH,rH,iH,sH,oH,aH,cH,lH,uH,dH,hH,pH,fH,mH,gH,dt;function _H(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function lu(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?_H(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_H(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}Ts.setLogger(D);let Vfe=(O9=Mt(),k9=Mt({argsMap:(e,n)=>{if(!Array.isArray(n)){if(!(n instanceof wv))return[n];n=[n]}return n.map(i=>i?Object(i).toString():"null")}}),N9=Mt({argsMap:(e,n)=>(n||(n=[]),Array.isArray(n)||n.trackMediaType!==bv.DATA?(Array.isArray(n)||(n=[n]),n.map(i=>i.getTrackId())):[n.getChannelId()])}),D9=Mt({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),L9=Mt({argsMap:(e,n,i)=>[n,i]}),x9=Mt({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),M9=Mt({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),U9=Mt({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),V9=Mt(),F9=Mt(),j9=Mt(),B9=Mt(),W9=Mt(),z9=Mt(),G9=Mt(),H9=Mt(),$9=Mt(),K9=Mt(),q9=Mt(),Y9=Mt(),X9=Mt(),J9=Mt(),Q9=Mt(),Z9=Mt({argsMap:(e,n)=>[n]}),eH=Mt(),tH=Mt(),nH=Mt(),rH=Mt(),iH=Mt(),sH=Mt(),oH=Mt(),aH=Mt(),cH=Mt({argsMap:(e,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),lH=Mt(),uH=Mt(),dH=Mt(),hH=Mt(),pH=Mt(),fH=Mt(),mH=Mt({reportResult:!0}),gH=Mt(),dt=class extends Ir{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,n){let i;if(super(),$(this,"store",void 0),$(this,"_uid",void 0),$(this,"_channelName",void 0),$(this,"_uintUid",void 0),$(this,"_users",[]),$(this,"_config",void 0),$(this,"_clientId",void 0),$(this,"_appId",void 0),$(this,"_sessionId",null),$(this,"_key",void 0),$(this,"_rtmConfig",{}),$(this,"_joinInfo",void 0),$(this,"_gateway",void 0),$(this,"_statsCollector",void 0),$(this,"_configDistribute",void 0),$(this,"_leaveMutex",void 0),$(this,"_publishMutex",void 0),$(this,"_renewTokenMutex",void 0),$(this,"_subscribeMutex",void 0),$(this,"_encryptionMode","none"),$(this,"_encryptionSecret",null),$(this,"_encryptionSalt",null),$(this,"_encryptDataStream",!1),$(this,"_encryptDataStreamKey",null),$(this,"_encryptDataStreamIv",null),$(this,"_proxyServer",void 0),$(this,"_turnServer",{servers:[],mode:"auto"}),$(this,"_cloudProxyServerMode","disabled"),$(this,"_isDualStreamEnabled",!1),$(this,"_defaultStreamFallbackType",void 0),$(this,"_lowStreamParameter",void 0),$(this,"_streamFallbackTypeCacheMap",new Map),$(this,"_remoteStreamTypeCacheMap",new Map),$(this,"_axiosCancelSource",Bo.CancelToken.source()),$(this,"_audioVolumeIndicationInterval",void 0),$(this,"_networkQualityInterval",void 0),$(this,"_userOfflineTimeout",void 0),$(this,"_streamRemovedTimeout",void 0),$(this,"_liveTranscodeStreamingClient",void 0),$(this,"_liveRawStreamingClient",void 0),$(this,"_channelMediaRelayClient",void 0),$(this,"_networkQualitySensitivity","normal"),$(this,"_p2pChannel",void 0),$(this,"_useLocalAccessPoint",!1),$(this,"_setLocalAPVersion",void 0),$(this,"_joinAndNotLeaveYet",!1),$(this,"_numberOfJoinCount",0),$(this,"_remoteDefaultVideoStreamType",void 0),$(this,"_inspect",void 0),$(this,"_moderation",void 0),$(this,"_license",void 0),$(this,"_pendingPublishedUsers",[]),$(this,"ntpAlignErrorCount",0),$(this,"remoteInboundOffset",0),$(this,"_peerConnectionState",void 0),$(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),$(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),$(this,"_handleUserOnline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&A_(c.uid,this.channelName))return void D.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&D.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(fn.USER_JOINED,u));else{const h=new Im(c.uid,c.uint_id||c.uid);this._users.push(h),D.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(fn.USER_JOINED,h)}}),$(this,"_handleUserOffline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&A_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:fA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),D.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(fn.USER_LEAVED,u,c.reason))}),$(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,y,S)=>{if(re("BLOCK_LOCAL_CLIENT")&&A_(u,this.channelName))return;const R=this._users.find(k=>k.uid===u);if(!R)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const A=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=_||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),y&&(R._audioOrtc=y)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),y&&(R._videoOrtc=y)),(c==="audio"?R.hasAudio:R.hasVideo)&&!A&&(D.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(fn.USER_PUBLISHED,R,c)),c==="video"?bt.onGatewayStream(this._sessionId,Oi.ON_ADD_VIDEO_STREAM,Tr.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:R._videoSSRC}):bt.onGatewayStream(this._sessionId,Oi.ON_ADD_AUDIO_STREAM,Tr.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(k=>{if(k&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof gb))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(W=>{D.error("[".concat(this._clientId,"] resubscribe error"),W.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(k=>{D.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),$(this,"_handleRemoveStream",c=>{if(re("BLOCK_LOCAL_CLIENT")&&A_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));D.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(fn.USER_UNPUBLISHED,u,"audio"),D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(fn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(fn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(fn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof gb&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),bt.onGatewayStream(this._sessionId,Oi.ON_REMOVE_STREAM,Tr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),$(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&A_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void D.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));D.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";D.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(fn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(fn.USER_INFO_UPDATED,u,R)}}const y=c==="audio"?m.hasAudio:m.hasVideo;return _!==y?!_&&y?(D.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(fn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),D.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(fn.USER_UNPUBLISHED,m,c)):void 0}),$(this,"_handleMuteStream",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&A_(c,this.channelName))return;D.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(fn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(fn.USER_INFO_UPDATED,c,R)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(_!==y){if(!_&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(D.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(fn.USER_PUBLISHED,m,u)):void D.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),D.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(fn.USER_UNPUBLISHED,m,u)}}),$(this,"_handleP2PLost",async c=>{D.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():D.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),$(this,"_handleTokenWillExpire",()=>{D.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(fn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),$(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),D.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),$(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(fn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(fn.NETWORK_QUALITY,c)}),$(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const y=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!y&&(D.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(fn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{D.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=n||or(5,"client-"),this.store=new class{constructor(c,u,h,m){Gt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:S_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case mn.SET_SESSION_ID:return pt(pt({},u),{},{sessionId:h.sessionId});case mn.SET_P2P_ID:return pt(pt({},u),{},{p2pId:h.p2pId});case mn.SET_UID:return pt(pt({},u),{},{uid:h.uid});case mn.SET_INT_UID:return pt(pt({},u),{},{intUid:h.intUid});case mn.SET_PUB_ID:return pt(pt({},u),{},{pubId:h.pubId});case mn.KEY_METRIC_CLIENT_CREATED:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{clientCreated:h.metric})});case mn.KEY_METRIC_JOIN_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{joinStart:h.metric})});case mn.AVOID_JOIN_START:return pt(pt({},u),{},{avoidJoinStart:h.avoidJoinStart});case mn.KEY_METRIC_JOIN_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{joinEnd:h.metric})});case mn.KEY_METRIC_REQUEST_AP_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{requestAPStart:h.metric})});case mn.KEY_METRIC_REQUEST_AP_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case mn.KEY_METRIC_JOIN_GATEWAY_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case mn.KEY_METRIC_JOIN_GATEWAY_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case mn.KEY_METRIC_PEER_CONNECTION_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case mn.KEY_METRIC_PEER_CONNECTION_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case mn.KEY_METRIC_DESCRIPTION_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{descriptionStart:h.metric})});case mn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case mn.KEY_METRIC_ICE_CONNECTION_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case mn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(y=>y.trackId===h.metric.trackId);return _!==-1?(m[_]=pt(pt({},m[_]),h.metric),pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{publish:[...m]})})):pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case mn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return _!==-1?(m[_]=pt(pt({},m[_]),h.metric),pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{subscribe:[...m]})})):pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case mn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case mn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=pt(pt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case mn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case mn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case mn.SET_USE_P2P:return pt(pt({},u),{},{useP2P:h.val});case mn.SET_TRANSPORT_TYPE:return pt(pt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:mn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:mn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:mn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:mn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:mn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:mn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:mn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:mn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:mn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:mn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:mn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:mn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:mn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:mn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:mn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:mn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:mn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:mn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:mn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:mn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:mn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:mn.KEY_METRIC_PUBLISH,metric:pt(pt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,y,S){this.dispatch({type:mn.KEY_METRIC_SUBSCRIBE,metric:pt(pt(pt(pt(pt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),y&&{streamAdded:y}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:mn.KEY_METRIC_SUBSCRIBE,metric:pt(pt(pt({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:mn.RECORD_JOIN_CHANNEL_SERVICE,record:pt(pt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:mn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:mn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:mn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:mn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Ts("client-leave",this._clientId),this._publishMutex=new Ts("client-publish",this._clientId),this._renewTokenMutex=new Ts("client-renewtoken",this._clientId),this._subscribeMutex=new Ts("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),D.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(dl," build: ").concat(vL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{aL(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){D.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new fb(this.store),this._statsCollector.onStatsException=(c,u,h)=>{D.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(fn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(y=>y.uid===c);_&&bt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new nfe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||mi,httpRetryConfig:e.httpRetryConfig||mi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new hfe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Gp("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new gb(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,n,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Jn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Jn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof ZL&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,y,S){lA.get(_)||lA.set(_,[]),uA.get(_)||uA.set(_,y),rh.get(_)||rh.set(_,0);const R=lA.get(_),A=uA.get(_);if(!R||!A)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(rh.get(_)===A){const q=HT();R.push(q),await q.promise}rh.set(_,rh.get(_)+1);for(var k=arguments.length,W=new Array(k>3?k-3:0),U=3;U<k;U++)W[U-3]=arguments[U];const V=await S(...W);return rh.set(_,rh.get(_)-1),rh.get(_)===A-1&&R.length>0&&(R[0].resolve(),R.shift()),rh.get(_)===0&&(lA.set(_,[]),uA.set(_,0),rh.set(_,0)),V}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,n,i,o,c)}async join(e,n,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(_A||_A||(_A=(window.location.protocol.split(":")[0]||"").toUpperCase(),_A))==="HTTPS",m=f8()?window.isSecureContext:"Browser Not Support";(!f8()&&!h||!window.isSecureContext)&&D.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),D.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),bt.setAppId(e);try{if(!i&&i!==null)throw new Pe(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Xi(i,"token",1,2047),Xi(e,"appid",1,2047),FA(n),o&&jA(o),c&&Xi(c,"optionalInfo",1,2047)}catch(U){throw bt.reportApiInvoke(v_(),{name:fi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:Dr.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(D.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),D.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw bt.reportApiInvoke(v_(),{name:fi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:Dr.TRACER}).onError(U),U}this._gateway.state="CONNECTING";const _=await p9({appId:e,cname:n,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(_==null?void 0:_.sid)||v_();D.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(u)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const S=bt.reportApiInvoke(y,{id:this._clientId,name:fi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:Dr.TRACER}),R=lu(lu(lu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:n,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async U=>{const V=function(_e){const ye=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),fe=new Uint8Array(new ArrayBuffer(ye.length));for(let ke=0;ke<ye.length;ke+=1)fe[ke]=ye.charCodeAt(ke);return fe}(),q=await window.crypto.subtle.importKey("spki",V,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=sL(U),ce=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Y);return function(_e){let ye="";for(let fe=0;fe<_e.length;fe+=1)ye+=String.fromCharCode(_e[fe]);return window.btoa(ye)}(new Uint8Array(ce))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,V=re("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(R.appId+this._encryptionSecret+this._encryptionSecret):U.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,Y,ce){const _e=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),ye=q==="aes-128-gcm2"?128:256,fe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:w8,hash:"SHA-256",salt:ce},_e,ye+Nhe);return new Uint8Array(fe).subarray(ye/8)}(this._encryptionMode,V,y_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,Y,ce){const _e=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),ye=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:w8,hash:"SHA-256",salt:ce},_e,{name:"AES-GCM",length:ye},!0,["encrypt","decrypt"])}(this._encryptionMode,V,y_(this._encryptionSalt))}else m?D.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):D.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,D.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:n,appId:e,stringUid:R.stringUid});const A=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&A===this._sessionId&&bt.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let U;const V=R.cloudProxyServer;if(st(k=["proxy3","proxy4","proxy5"]).call(k,V)){const ye=re("PROXY_SERVER_TYPE3");Array.isArray(ye)?R.proxyServer=ye[0]:R.proxyServer=ye}if(bt.setProxyServer(R.proxyServer),D.setProxyServer(R.proxyServer),this.store.requestAPStart(),_){if(D.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(_.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=_.intUid),U={gatewayInfo:_.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ye=(await sG(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(fe=>({turnServerURL:fe.address,tcpport:fe.tcpport||ms.tcpport,udpport:fe.udpport||ms.udpport,username:fe.username||ms.username,password:fe.password||ms.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:ye}}g9(_,R.stringUid)}else{if(R.stringUid&&!R.uid){let ye;[ye,U]=await ct.all([DG(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||mi,this.store),NG(R,this._axiosCancelSource.token,this._config.httpRetryConfig||mi,!0,this.store)]),D.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(ye)),R.uid=ye,U.gatewayInfo.uid=ye,U.gatewayInfo.res.uid=ye}else U=await NG(R,this._axiosCancelSource.token,this._config.httpRetryConfig||mi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(sb.UPDATE_BITRATE_LIMIT,ye=>{this._p2pChannel.updateBitrateLimit(ye)}),this._configDistribute.on(sb.UPDATE_CLIENT_ROLE_OPTIONS,ye=>{this._setClientRoleOptions(ye)})},0),this._key=i||e;const q=U.gatewayInfo,Y=R.uid?R.uid:q.uid;this._joinInfo=lu(lu({},R),{},{cid:q.cid,uid:Y,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Y,this.store.cid=q.cid;const ce=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(ce),this._appId=e,this._channelName=R.cname,this._uid=ce,this.store.uid=ce,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(hs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _e=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return D.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(_e)),setTimeout(()=>{D.startUpload()},5e3),this.store.joinEnd(),W=this,st(I_).call(I_,W)||I_.push(W),this._cloudProxyServerMode==="disabled"&&Nn().supportWebCrypto&&re("ENABLE_PRELOAD")&&Cx(this._joinInfo),ce}catch(U){const V=Array.isArray(U)?U[0]:U;throw V&&V.code===X.OPERATION_ABORTED?D.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V):D.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V),V.code!==X.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(V),V}var W}_joinGateway(){if(!this._joinInfo||!this._key)throw new Pe(X.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){D.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(hs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=I_.indexOf(n);i!==-1&&I_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return D.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Wn.LEAVE),D.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof wv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Pe(X.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new Pe(X.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof wv))throw new Pe(X.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&n)throw new Pe(X.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}D.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),n&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof fr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),D.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw D.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){tr(e.id,"id",0,65535,!0),Up(e.ordered,"ordered"),Xi(e.metadata,"metadata",0,512),D.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const n=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Pe(X.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Pe(X.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Pe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return bG(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Pe(X.CREATE_DATACHANNEL_ERROR);try{await ct.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==X.DISCONNECT_P2P)throw c}}return D.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw D.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Pe(X.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let n=[];if(e)if(Array.isArray(e))n=e;else{if(!(e instanceof wv))return this._unpublishDataChannel([e]);n=[e]}else this.store.useP2P||await this._unpublishDataChannel(),n=this._p2pChannel.getAllTracks(!0);D.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(n.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.sendExtensionMessage(Jr.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.unpublish(o,this._uid),D.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(n.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw D.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),D.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const n=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),D.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw D.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{n&&n()}}async subscribe(e,n,i){if(!(e instanceof Im)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Pe(X.INVALID_REMOTE_USER,"user is not in the channel");e=o}return n==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,n)}async presubscribe(e,n){if(bi(n,"mediaType",["audio","video"]),this.store.useP2P)throw new Pe(X.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=n===ft.AUDIO,o=n===ft.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:y}=await this._gateway.presubscribe(e,n,!0);if(u==null)throw new Pe(X.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(A=>A.uid===e);S||(S=new Im(e,y||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=y||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),D.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,n,u,m,h);const R=i?S._audioTrack:S._videoTrack;if(!R)throw new Pe(X.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw D.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,n){var i;if(tr(n,"channelId",0,65535,!0),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Pe(X.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Pe(X.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===n);if(!c)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Pe(X.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&st(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Pe(X.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,n,i){if(bi(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Pe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Pe(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(n==="audio"&&!e.hasAudio||n==="video"&&!e.hasVideo)){const u=new Pe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),u}const c=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const h=n==="audio"?e._audioSSRC:e._videoSSRC,m=n==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,n,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,n,h,m)}catch(h){throw h}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=n==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Pe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,n,i){if(this.store.useP2P)return this._p2pSubscribe(e,n);if(bi(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===e)){const y=new Pe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),y}if(!e.hasAudio&&!e.hasVideo){const y=new Pe(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),y}if(!(i||(n!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(n!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const y=new Pe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),y}let c=n==="audio"?e._audioSSRC:e._videoSSRC,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,m={stream_type:n==="audio"?ft.AUDIO:ft.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const S=n==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,m={stream_type:n==="audio"?ft.AUDIO:ft.VIDEO,ssrcId:c}),Rs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,n,Date.now()),await this._p2pChannel.subscribe(e,n,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,n),R;await this._p2pChannel.unsubscribe(e,n,!0),this._p2pChannel.setPendingRemoteMedia(e,n)}this.store.subscribe(e.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,n)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,n),S}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const y=n==="audio"?e._audioTrack:e._videoTrack;if(!y)throw new Pe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return y}catch(y){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),y),y}finally{_()}}async massSubscribe(e){if(Vp(e,"subscribeList"),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const n=Date.now(),i=new Map,o=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:y}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(y)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:y}=m;return{user:_,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y;if(bi(R,"mediaType",["audio","video"]),!S){const U=new Pe(X.INVALID_PARAMS,"user property does not exist in subscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===S)){const U=new Pe(X.INVALID_REMOTE_USER,"user is not in the channel");D.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=U,e.splice(_,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const U=new Pe(X.REMOTE_USER_IS_NOT_PUBLISHED);D.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[_].error=U,e.splice(_,1);continue}const k=ki.Video|ki.LwoVideo,W=i.get(S);if(W){if(R==="video"?W&k:W&ki.Audio){e.splice(_,1),D.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}i.set(S,W|(R==="video"?k:ki.Audio))}else i.set(S,R==="video"?k:ki.Audio)}for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y,A=ki.Video|ki.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const k=i.get(S);i.set(S,R==="video"?k^A:k^ki.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),n);let m=Fa(h=Array.from(i.entries())).call(h,(_,y)=>{let[S,R]=y;if(R===0)return _;const A={stream_id:S.uid,stream_type:R};return R&ki.Audio&&(A.audio_ssrc=S._audioSSRC),R&ki.Video&&(A.video_ssrc=S._videoSSRC),_.push(A),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:S,mediaType:R}=y;return{user:S,mediaType:R,ssrcId:R===ft.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===ft.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:A,audio_error_code:k,error_code:W}=S;(A||k||W)&&_.set(R,{video_error_code:A,audio_error_code:k,error_code:W})})}if(Array.from(_.entries()).length>0){const y=[];Array.from(_.entries()).forEach(S=>{let[R,A]=S;const k=this.remoteUsers.find(W=>W.uid===R);if(k){let W;A.error_code||A.video_error_code&&A.audio_error_code?W=void 0:A.video_error_code?W=ft.VIDEO:A.audio_error_code&&(W=ft.AUDIO),y.push({user:k,mediaType:W})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of c){const S=_.get(y.user.uid);if(S){const R=S.error_code||y.mediaType==="audio"&&S.audio_error_code||y.mediaType==="video"&&S.video_error_code;if(R){const A=ob(R);D.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(A.desc)),y.error=new Pe(X.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(A.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var S;bt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((S=y.error)===null||S===void 0?void 0:S.code)||null,video:y.mediaType===ft.VIDEO,audio:y.mediaType===ft.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===ft.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-n),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),D.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:S,mediaType:R}=y;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,n,i){if(!(e instanceof Im)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Pe(X.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(n||this.store.useP2P){if(n==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(n&&bi(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Pe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(n));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,n);else{const u=await this._p2pChannel.unsubscribe(e,n);u&&await this._gateway.unsubscribe(u,e.uid),n&&n!=="audio"||(e._audio_pre_subscribed=!1),n&&n!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&fA(this._users,e),D.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(n))}}catch(u){if(u.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,n){if(n&&tr(n,"id",0,65535,!0),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Pe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof n=="number"){const c=e._dataChannels.find(u=>u.id===n);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Pe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(n,", remote datachannel is not published")),c}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),D.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Vp(e,"unsubscribeList"),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");D.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const n=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const m=new Pe(X.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(bi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){D.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=ki.Video|ki.LwoVideo;if(n.has(o)){const m=n.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&ki.Audio;break;default:_=m&(ki.Audio|h)}if(_){D.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?n.set(o,m|ki.Audio):c==="video"&&n.set(o,m|h):n.set(o,m|ki.Audio|h)}else c?c==="audio"?n.set(o,ki.Audio):c==="video"&&n.set(o,h):n.set(o,ki.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),D.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===X.DISCONNECT_P2P)return void D.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw D.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new De(X.INVALID_PARAMS);Nr(i.width)||rL(i.width,"streamParameter.width"),Nr(i.height)||rL(i.height,"streamParameter.height"),Nr(i.framerate)||rL(i.framerate,"streamParameter.framerate"),Nr(i.bitrate)||tr(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&D.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),D.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const n=this._configDistribute.getLowStreamConfigDistribute();if(n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,He.LocalVideoLowTrack)}async enableDualStream(){if(!Nn().supportDualStream)throw bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Pe(X.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Pe(X.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),D.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(He.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,bt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),D.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,n){if(function(o){bi(o,"role",["audience","host"])}(e),n&&aL(n),this.mode==="rtc"||this.mode==="p2p")throw D.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Pe(X.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(n&&n.level&&e==="host")throw new Pe(X.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Pe(X.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,n),this._config.role=e,this._gateway.reconnect("recover",ps.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,n),this._config.role=e),D.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(n&&n.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let n=!1;try{e&&aL(e),await this._gateway.setClientRole(this._config.role,e),n=!0}catch{}finally{D.info("[".concat(this._clientId,"] set client role options ").concat(n?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const n=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!n||!n.timestamp)return 0;const i=n.timestamp-Date.now();return Math.abs(i)>1e3+n.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,n){if(Xi(e,"proxyServer"),!n){if(this.connectionState!=="DISCONNECTED")throw new Pe(X.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Pe(X.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,bt.setProxyServer(this._proxyServer),D.setProxyServer(this._proxyServer),D.info("[".concat(this._clientId,"] Set proxy server ").concat(n?"by initialize call":""," success."))}setTurnServer(e,n){if(Array.isArray(e)||(e=[e]),!n){if(this.connectionState!=="DISCONNECTED")throw new Pe(X.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Pe(X.INVALID_OPERATION,"You have already set the proxy")}if(XT(e))return this._turnServer={servers:e,mode:"original-manual"},void D.info("[".concat(this._clientId,"] Set original turnserver ").concat(n?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>n8(i)),this._turnServer={servers:e,mode:"manual"},D.info("[".concat(this._clientId,"] Set turnserver ").concat(n?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Pe(X.INVALID_OPERATION,"you should set license before join channel");if(Xi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Pe(X.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,D.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Pe(X.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Pe(X.INVALID_OPERATION,"You have already set the proxy");const n=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Pe(X.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new Pe(X.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Pe(X.INVALID_OPERATION,"Stop proxy server after leave channel");bt.setProxyServer(),D.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Pe(X.INVALID_PARAMS,"accessPoints is required.");Vp(e.accessPoints.serverList,"accessPoints.serverList"),Xi(e.accessPoints.domain,"accessPoints.domain");const n=(A,k)=>{tr(A,k,0,65535,!0)};let i=443;if(e.accessPoints.port&&(n(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Pe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(Jn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Jn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(A=>o.test(A)?"".concat(A.replace(/\./g,"-"),".").concat(c):A),h=u.map(A=>"".concat(A,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Jn("WEBCS_DOMAIN",h),Jn("WEBCS_DOMAIN_BACKUP_LIST",h),Jn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Vp(e.report.hostname,"report.hostname"),Jn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Jn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Jn("EVENT_REPORT_DOMAIN",u[0]),Jn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(n(e.report.port,"report.port"),m=e.report.port),Jn("STATS_COLLECTOR_PORT",m),e.report?Jn("ENABLE_EVENT_REPORT",!0):Jn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Vp(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let y=6444;e.log&&e.log.port&&(n(e.log.port,"log.port"),y=e.log.port),Jn("LOG_UPLOAD_SERVER","".concat(_,":").concat(y));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Vp(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(n(e.cds.port,"cds.port"),R=e.cds.port),Jn("CDS_AP",S.map(A=>"".concat(A,":").concat(R))),e.cds?Jn("ENABLE_CONFIG_DISTRIBUTE",!0):Jn("ENABLE_CONFIG_DISTRIBUTE",!1),D.info("set local access point v2 success")}setLocalAccessPoints(e,n){if(Vp(e,"serverList"),Xi(n,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Pe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(n):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Jn("WEBCS_DOMAIN",e),Jn("WEBCS_DOMAIN_BACKUP_LIST",e),Jn("GATEWAY_DOMAINS",[n]),Jn("EVENT_REPORT_DOMAIN",e[0]),Jn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Jn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),D.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(bi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(n){throw D.error("[".concat(this._clientId,"] set default remote video stream type error"),n.toString()),n}else D.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,n){bi(n,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,n),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw D.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}D.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(e,n)}async setStreamFallbackOption(e,n){bi(n,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,n)}catch(i){throw D.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}D.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(e,n)}setEncryptionConfig(e,n,i,o){(function(u){bi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Xi(n,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(st(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new Pe(X.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new Pe(X.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Up(o,"encryptDataStream"),!st(c).call(c,e))throw new Pe(X.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(n)||D.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=n,i&&(this._encryptionSalt=ym(i))}async renewToken(e){if(Xi(e,"token",1,2047),!this._key||!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"renewToken should not be called before user join");const n=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){D.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await dfe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||mi);D.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else D.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});D.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=n,this._joinInfo.token=n,D.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?D.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(fn.VOLUME_INDICATOR,e)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),n=this._gateway.getInChannelInfo();return e.Duration=Math.round(n.duration/1e3),e}async startLiveStreaming(e,n){if(!n){if(this.codec!=="h264")throw new Pe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Pe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Pe(X.LIVE_STREAMING_TASK_CONFLICT);const i=n?Bp.TRANSCODE:Bp.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Bp.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!n.length)throw new Pe(X.INVALID_PARAMS,"can not find live streaming url to stop");await ct.all(n.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){jG(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){jG(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof gb&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var n;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const _=Fa(m=Array.from(h)).call(m,(U,V)=>U+V,0),y={serverTs:0,seq:Dhe++,length:h.length,checkSum:_},S=new Uint8Array(u8(_,2)),R=new ArrayBuffer(_v),A=new DataView(R);A.setUint32(0,y.serverTs),A.setUint16(4,y.seq),A.setUint16(6,y.length),A.setUint16(8,y.checkSum);const k=16-h.length%16;h=s8(h,new Uint8Array(k));const W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:b8,additionalData:S},u,h);return s8(new Uint8Array(R),new Uint8Array(W))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Pe(X.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Bt.DATA_STREAM,{payload:ym(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-vfe},!i)}sendMetadata(e){if(!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Pe(X.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Bt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ym(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Whe),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"can not send custom report, not joined");await bt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,n){bi(n.spatialLayer,"spatialLayer",[0,1,2,3]),bi(n.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,n)}catch(i){throw D.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:n=!1,rtmFlag:i}=e;if(Up(n,"apRTM"),tr(i,"rtmFlag",0),this._rtmConfig.apRTM=n,this._rtmConfig.rtmFlag=i,D.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=n,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(D.debug("[".concat(this._clientId,"] reset client")),function(e){const n=Ov.indexOf(e);n!==-1&&Ov.splice(n,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Bo.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&m9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&bt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(n=>n._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ts("client-publish",this._clientId),this._subscribeMutex=new Ts("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,n){var i;const o=e||v_();e?D.debug("[".concat(this._clientId,"] new Session ").concat(o)):D.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,bt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(n==null?void 0:n.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};bt.sessionInit(this._sessionId,lu({cname:n.channel,appid:n.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Pe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Pe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");D.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Jr.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof fr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{D.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Pe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));D.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const n=()=>{if(!this._joinInfo||!this._appId)return new Pe(X.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Gp("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{bt.reportApiInvoke(this._sessionId,{name:fi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Dr.TRACER}).onSuccess(),this.safeEmit(fn.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{bt.reportApiInvoke(this._sessionId,{name:fi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Dr.TRACER}).onSuccess(),this.safeEmit(fn.LIVE_STREAMING_WARNING,c,u)},i.on(JL.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Pe(X.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,y,S){const R=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(A=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap"));return await sfe(R,m,_,y,S)})(c,this._joinInfo,this._axiosCancelSource.token,mi).then(u).catch(h)}),i};return e===Bp.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||n(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||n(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Pe(X.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:n,height:i}},Gp("ChannelMediaRelay").create(e));o.on("state",c=>{c===_a.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(fn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(fn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,n){const{added:i,deleted:o}=e,c=[];if(n){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:y,metadata:S}=u,R=this._users.find(A=>A._uintid===h);if(!R)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(D.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),st(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(A=>A.id===u.stream_id)===-1){const A={id:m,ordered:!!_,maxRetransmits:y,metadata:S},k=function(W){return bG(W,!0)}(A);R._dataChannels.push(k),D.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),n||this.safeEmit(fn.USER_PUBLISHED,R,"datachannel",A)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(D.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(A=>{D.error("[".concat(this._clientId,"] resubscribe datachannel error"),A.toString())}))}),n&&(this.safeEmit(fn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=_._dataChannels.find(S=>S.id===u.stream_id);y&&(D.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[y]).then(S=>{if(_._dataChannels=_._dataChannels.filter(R=>R!==y),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),D.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(fn.USER_UNPUBLISHED,_,"datachannel",y._config))})}_handleRemoveDataChannels(e){const n=this._users.find(i=>i.uid===e.uid);if(n){if(n._dataChannels!==void 0&&n._dataChannels.length>0){D.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished datachannel")),n._dataChannels.forEach(o=>{this.safeEmit(fn.USER_UNPUBLISHED,n,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(n,n._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,n.uid)}),i()}}else D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Wi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void D.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();Object.keys(n).forEach(o=>{const{value:c,type:u,expires:h}=n[o];h&&h<=i||u||GL()||!Object.prototype.hasOwnProperty.call(vA,o)||(id[o]=c,pr[o]=c,D.debug("Update gateway parameters from config distribute",o,c))})}catch(n){D.error("Error update config from local cache",n.message)}})()}),this._gateway.on(Wi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Wi.CONNECTION_STATE_CHANGE,(e,n,i)=>{var o;if(i===Wn.FALLBACK)return;const c=()=>{this.safeEmit(fn.CONNECTION_STATE_CHANGE,e,n,i)};if(bt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:fi.CONNECTION_STATE_CHANGE,options:[e,n,i],tag:Dr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:n,reason:i})),D.info("[".concat(this._clientId,"] signal connection state change: ").concat(n," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{D.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{D.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{D.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ft.AUDIO,!1)),h._trust_video_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ft.VIDEO,!1)),h._trust_audio_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(D.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(Wi.REQUEST_NEW_GATEWAY_LIST,async(e,n)=>{if(!this._joinInfo)return n(new Pe(X.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await p9(lu(lu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,g9(o),this._joinInfo.preload=!0):(i=await px(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||mi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(i){n(i)}}),this._gateway.on(Wi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(fn.NETWORK_QUALITY,e)}),this._gateway.on(Wi.STREAM_TYPE_CHANGE,(e,n)=>{this.safeEmit(fn.STREAM_TYPE_CHANGED,e,n),bt.reportApiInvoke(this._sessionId,{name:fi.STREAM_TYPE_CHANGE,options:[e,n],tag:Dr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:n}))}),this._gateway.on(Wi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Wi.REQUEST_P2P_CONNECTION_PARAMS,async(e,n,i)=>{try{let o=await this._p2pChannel.getEstablishParams();re("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),n(o)}catch(o){i(o)}}),this._gateway.on(Wi.JOIN_RESPONSE,(e,n)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:D.debug("no attributes in joinResponse");const o=dG(e.ortc,n,i);this._p2pChannel.connect(o)}),this._gateway.on(Wi.PRE_CONNECT_PC,async e=>{const{candidates:n,fingerprint:i}=e;if(this._joinInfo&&n.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=re("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:n,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(gn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(gn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(gn.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(gn.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(gn.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(gn.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(gn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(gn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(gn.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,ft.AUDIO,!0)),this._gateway.signal.on(gn.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,ft.AUDIO,!1)),this._gateway.signal.on(gn.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,ft.VIDEO,!0)),this._gateway.signal.on(gn.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,ft.VIDEO,!1)),this._gateway.signal.on(gn.RECEIVE_METADATA,e=>{const n=y_(e.metadata);this.safeEmit(fn.RECEIVE_METADATA,e.uid,n)}),this._gateway.signal.on(gn.ON_DATA_STREAM,async e=>{var n;if(!e)return;let i=y_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)){if(e.payload.length<_v)throw new Pe(X.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(_v));i=await async function(u,h,m){const _=m.subarray(0,_v),y=_.slice(8,_v),S=(y[0]<<8)+y[1],R=(_[6]<<8)+_[7],A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:b8,additionalData:new Uint8Array(u8(S,2))},h,m.subarray(_v));return new Uint8Array(A).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Tfe(lu(lu({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(gn.ON_CRYPT_ERROR,()=>{Em(()=>{D.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(fn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(gn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{D.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Wn.TOKEN_EXPIRE),this.safeEmit(fn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(gn.ON_STREAM_FALLBACK_UPDATE,e=>{D.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(fn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(gn.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),D.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(gn.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(gn.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Wt.REQUEST_TIMEOUT,(e,n)=>{if(this._joinInfo)switch(e){case Bt.PUBLISH:{if(!n)return;const c=n.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:y}=_;return y===Gn.Audio}),h=c.some(_=>{let{stream_type:y}=_;return y!==Gn.Audio}),m=c.some(_=>{let{stream_type:y}=_;return y===Gn.Screen||y===Gn.ScreenLow});n.state==="offer"&&bt.publish(this._joinInfo.sid,{eventElapse:Rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:X.TIMEOUT,audio:u,video:h,p2pid:n.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(_=>{let{stream_type:y}=_;return y===Gn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:y}=_;return y!==Gn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Bt.SUBSCRIBE:n&&bt.subscribe(this._joinInfo.sid,{succ:!1,ec:X.TIMEOUT,audio:n.stream_type===ft.AUDIO,video:n.stream_type===ft.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:this.store.p2pId,eventElapse:Rs.measureFromSubscribeStart(this.store.clientId,n.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(n.ssrcId)})}}),this._gateway.signal.on(gn.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(gn.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;re("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!A_(o.string_id||o.stream_id,this.channelName)));const n=[],i=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Im(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(fn.PUBLISHED_USER_LIST).length===0&&(D.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(fn.USER_JOINED,c)));const u=ki.Audio&o.stream_type,h=(ki.Video|ki.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(fn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(fn.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(fn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(fn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!y||m)&&n.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(D.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{D.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(fn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=n:(D.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(n.map(o=>o.uid).join(", "))),this.safeEmit(fn.PUBLISHED_USER_LIST,n)):D.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(n.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(gn.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:n}=e;this._p2pChannel instanceof gb&&this._p2pChannel.updateRemoteRTPCapabilities(n.map(i=>i.toLowerCase()).filter(i=>{var o;return st(o=Object.keys(SA)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(gn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Jr.PUBLISH,(e,n,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const y=this._users.find(S=>S.uid===o);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{n()}).catch(i):n(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(Jr.CALL,async(e,n,i)=>{if(this.store.useP2P)try{var o;n(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(Wt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Jr.UNPUBLISH,async(e,n,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void n();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===Gn.Audio?ft.AUDIO:ft.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),n()}catch(h){i(h)}}}),this._gateway.signal.on(Jr.CONTROL,async(e,n)=>{const{action:i}=e;switch(i){case Tm.MUTE_LOCAL_VIDEO:this._handleMuteStream(n,ft.VIDEO,!0);break;case Tm.MUTE_LOCAL_AUDIO:this._handleMuteStream(n,ft.AUDIO,!0);break;case Tm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",n),this._handleMuteStream(n,ft.VIDEO,!1);break;case Tm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",n),this._handleMuteStream(n,ft.AUDIO,!1)}}),this._gateway.signal.on(Jr.RESTART_ICE,async(e,n,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==Eo.SEND_ONLY||c?n(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),n())}catch(o){i(o)}}),this._gateway.signal.on(Jr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:n,direction:i}=e;this._p2pChannel.addRemoteCandidate(n,i)}}),this._p2pChannel.on(Ot.RequestP2PRestartICE,async(e,n,i)=>{try{const{direction:o}=e;n(await this._gateway.sendExtensionMessage(Jr.RESTART_ICE,e,o===Eo.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(Ot.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Jr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ot.RequestP2PMuteLocal,async(e,n,i)=>{try{await this._gateway.sendExtensionMessage(Jr.CONTROL,e,!0),n()}catch(o){i(o)}}),this._p2pChannel.on(Ot.RequestP2PUnmuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===X.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Ot.RequestP2PMuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===X.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Ot.StateChange,(e,n)=>{n===zn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ot.PeerConnectionStateChange,e=>{const n=this._peerConnectionState;e!==n&&(this.safeEmit(fn.PEERCONNECTION_STATE_CHANGE,e,n),this._peerConnectionState=e)}),this._p2pChannel.on(Ot.RequestMuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===X.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Ot.RequestUnmuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===X.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Ot.RequestRePublish,(e,n,i)=>{this.publish(e,!1).then(n).catch(i)}),this._p2pChannel.on(Ot.RequestRePublishDataChannel,(e,n,i)=>{ct.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==X.DISCONNECT_P2P)throw u}})).then(n).catch(i)}),this._p2pChannel.on(Ot.RequestReSubscribe,async(e,n,i)=>{try{for(const{user:o,kind:c}of e)c===ft.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");n()}catch(o){i(o)}}),this._p2pChannel.on(Ot.RequestUpload,(e,n)=>{this._gateway.upload(e,n)}),this._p2pChannel.on(Ot.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ot.MediaReconnectStart,e=>{this.safeEmit(fn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ot.MediaReconnectEnd,e=>{this.safeEmit(fn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ot.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ot.RequestRestartICE,async e=>{if(this.store.useP2P)return;const n=await this._p2pChannel.restartICE(e),i=await n.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void n.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await n.next({remoteIceParameters:u})}),this._p2pChannel.on(Ot.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ot.RequestReconnectPC,async()=>{var e;const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:n,dtlsParameters:i,rtpCapabilities:o}),h=dG(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ot.RequestUnpublishForReconnectPC,async(e,n,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),n()):i()}),this._p2pChannel.on(Ot.P2PLost,()=>{this.safeEmit(fn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ot.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ot.ConnectionTypeChange,e=>{this.safeEmit(fn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ot.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ot.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Ot.AudioMetadata,e=>{this.safeEmit(fn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(n={config:e},Gp("ContentInspect").create(n));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:y}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:y?Number(y):0},mi)}catch(i){throw Array.isArray(i)?i[0]:i}var n}handleVideoInspectEvents(e){e.on(zi.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(fn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,i),i===su.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(fn.CONTENT_INSPECT_ERROR,new Pe(X.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(zi.INSPECT_RESULT,(n,i)=>{var o;if((i==null?void 0:i.code)===X.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return D.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(fn.CONTENT_INSPECT_RESULT,n,i)}),e.on(zi.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,n){if(Up(e,"enabled"),e){if(!n)throw new Pe(X.INVALID_PARAMS,"config is required");if(P9(n),!this._joinInfo)throw new Pe(X.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(n);else{const o=(i={config:n},Gp("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:y,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:y,vid:S?Number(S):0},mi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new Pe(X.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(ad.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(fn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,n,i),n===fl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Pe(X.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(ad.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(n){bi(n,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Pe(X.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,D.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return D.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Up(e,"enabled"),Jn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,n){switch(n){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},_t(dt.prototype,"leave",[O9],Object.getOwnPropertyDescriptor(dt.prototype,"leave"),dt.prototype),_t(dt.prototype,"publish",[k9],Object.getOwnPropertyDescriptor(dt.prototype,"publish"),dt.prototype),_t(dt.prototype,"unpublish",[N9],Object.getOwnPropertyDescriptor(dt.prototype,"unpublish"),dt.prototype),_t(dt.prototype,"subscribe",[D9],Object.getOwnPropertyDescriptor(dt.prototype,"subscribe"),dt.prototype),_t(dt.prototype,"presubscribe",[L9],Object.getOwnPropertyDescriptor(dt.prototype,"presubscribe"),dt.prototype),_t(dt.prototype,"massSubscribe",[x9],Object.getOwnPropertyDescriptor(dt.prototype,"massSubscribe"),dt.prototype),_t(dt.prototype,"unsubscribe",[M9],Object.getOwnPropertyDescriptor(dt.prototype,"unsubscribe"),dt.prototype),_t(dt.prototype,"massUnsubscribe",[U9],Object.getOwnPropertyDescriptor(dt.prototype,"massUnsubscribe"),dt.prototype),_t(dt.prototype,"setLowStreamParameter",[V9],Object.getOwnPropertyDescriptor(dt.prototype,"setLowStreamParameter"),dt.prototype),_t(dt.prototype,"enableDualStream",[F9],Object.getOwnPropertyDescriptor(dt.prototype,"enableDualStream"),dt.prototype),_t(dt.prototype,"disableDualStream",[j9],Object.getOwnPropertyDescriptor(dt.prototype,"disableDualStream"),dt.prototype),_t(dt.prototype,"setClientRole",[B9],Object.getOwnPropertyDescriptor(dt.prototype,"setClientRole"),dt.prototype),_t(dt.prototype,"_setClientRoleOptions",[W9],Object.getOwnPropertyDescriptor(dt.prototype,"_setClientRoleOptions"),dt.prototype),_t(dt.prototype,"setProxyServer",[z9],Object.getOwnPropertyDescriptor(dt.prototype,"setProxyServer"),dt.prototype),_t(dt.prototype,"setTurnServer",[G9],Object.getOwnPropertyDescriptor(dt.prototype,"setTurnServer"),dt.prototype),_t(dt.prototype,"setLicense",[H9],Object.getOwnPropertyDescriptor(dt.prototype,"setLicense"),dt.prototype),_t(dt.prototype,"startProxyServer",[$9],Object.getOwnPropertyDescriptor(dt.prototype,"startProxyServer"),dt.prototype),_t(dt.prototype,"stopProxyServer",[K9],Object.getOwnPropertyDescriptor(dt.prototype,"stopProxyServer"),dt.prototype),_t(dt.prototype,"setLocalAccessPointsV2",[q9],Object.getOwnPropertyDescriptor(dt.prototype,"setLocalAccessPointsV2"),dt.prototype),_t(dt.prototype,"setLocalAccessPoints",[Y9],Object.getOwnPropertyDescriptor(dt.prototype,"setLocalAccessPoints"),dt.prototype),_t(dt.prototype,"setRemoteDefaultVideoStreamType",[X9],Object.getOwnPropertyDescriptor(dt.prototype,"setRemoteDefaultVideoStreamType"),dt.prototype),_t(dt.prototype,"setRemoteVideoStreamType",[J9],Object.getOwnPropertyDescriptor(dt.prototype,"setRemoteVideoStreamType"),dt.prototype),_t(dt.prototype,"setStreamFallbackOption",[Q9],Object.getOwnPropertyDescriptor(dt.prototype,"setStreamFallbackOption"),dt.prototype),_t(dt.prototype,"setEncryptionConfig",[Z9],Object.getOwnPropertyDescriptor(dt.prototype,"setEncryptionConfig"),dt.prototype),_t(dt.prototype,"renewToken",[eH],Object.getOwnPropertyDescriptor(dt.prototype,"renewToken"),dt.prototype),_t(dt.prototype,"enableAudioVolumeIndicator",[tH],Object.getOwnPropertyDescriptor(dt.prototype,"enableAudioVolumeIndicator"),dt.prototype),_t(dt.prototype,"startLiveStreaming",[nH],Object.getOwnPropertyDescriptor(dt.prototype,"startLiveStreaming"),dt.prototype),_t(dt.prototype,"setLiveTranscoding",[rH],Object.getOwnPropertyDescriptor(dt.prototype,"setLiveTranscoding"),dt.prototype),_t(dt.prototype,"stopLiveStreaming",[iH],Object.getOwnPropertyDescriptor(dt.prototype,"stopLiveStreaming"),dt.prototype),_t(dt.prototype,"startChannelMediaRelay",[sH],Object.getOwnPropertyDescriptor(dt.prototype,"startChannelMediaRelay"),dt.prototype),_t(dt.prototype,"updateChannelMediaRelay",[oH],Object.getOwnPropertyDescriptor(dt.prototype,"updateChannelMediaRelay"),dt.prototype),_t(dt.prototype,"stopChannelMediaRelay",[aH],Object.getOwnPropertyDescriptor(dt.prototype,"stopChannelMediaRelay"),dt.prototype),_t(dt.prototype,"sendCustomReportMessage",[cH],Object.getOwnPropertyDescriptor(dt.prototype,"sendCustomReportMessage"),dt.prototype),_t(dt.prototype,"pickSVCLayer",[lH],Object.getOwnPropertyDescriptor(dt.prototype,"pickSVCLayer"),dt.prototype),_t(dt.prototype,"setRTMConfig",[uH],Object.getOwnPropertyDescriptor(dt.prototype,"setRTMConfig"),dt.prototype),_t(dt.prototype,"enableContentInspect",[dH],Object.getOwnPropertyDescriptor(dt.prototype,"enableContentInspect"),dt.prototype),_t(dt.prototype,"disableContentInspect",[hH],Object.getOwnPropertyDescriptor(dt.prototype,"disableContentInspect"),dt.prototype),_t(dt.prototype,"setImageModeration",[pH],Object.getOwnPropertyDescriptor(dt.prototype,"setImageModeration"),dt.prototype),_t(dt.prototype,"setP2PTransport",[fH],Object.getOwnPropertyDescriptor(dt.prototype,"setP2PTransport"),dt.prototype),_t(dt.prototype,"getJoinChannelServiceRecords",[mH],Object.getOwnPropertyDescriptor(dt.prototype,"getJoinChannelServiceRecords"),dt.prototype),_t(dt.prototype,"setPublishAudioFilterEnabled",[gH],Object.getOwnPropertyDescriptor(dt.prototype,"setPublishAudioFilterEnabled"),dt.prototype),dt);class yb{constructor(n,i){$(this,"id",0),$(this,"element",void 0),$(this,"peerPair",void 0),$(this,"context",void 0),$(this,"audioPlayerElement",void 0),$(this,"audioTrack",void 0),yb.count+=1,this.id=yb.count,this.element=n,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const i=document.createElement("audio");i.srcObject=new MediaStream([n.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const n=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new ct(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await n(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await n(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new Pe(X.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(n){if(this.audioTrack)return this.audioTrack;let i;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(n).connect(i)}catch(c){throw new Pe(X.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new Pe(X.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const n=this.element,i=await this.getTracksFromMediaElement(n);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){D.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var EH,pP;$(yb,"count",0);const Ffe=window.AudioContext||window.webkitAudioContext,jfe=new(EH=Mt({report:bt}),_t((pP=class{constructor(){$(this,"units",[]),$(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return D.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ffe);let n=this.units.find(i=>i&&i.getElement()===e);return n||(n=new yb(e,this.context),this.units.push(n)),n.startEchoCancellation(),D.debug("start processing local audio echo cancellation, id is",n.id),n.id}_doesEnvironmentNeedAEC(){return Cn().name!==Un.SAFARI}}).prototype,"processExternalMediaAEC",[EH],Object.getOwnPropertyDescriptor(pP.prototype,"processExternalMediaAEC"),pP.prototype),pP);function yH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function vH(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?yH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Px=window||document;function SH(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Px)return;const i=gi._cspEventHandlerPointer;if(i&&n)return void console.error(i,n);const o=c=>{if(!(c&&c.blockedURI&&(gi.onSecurityPolicyViolation||gi.getListeners(lh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(h=>st(u).call(u,h))&&(gi.onSecurityPolicyViolation&&typeof gi.onSecurityPolicyViolation=="function"&&gi.onSecurityPolicyViolation(c),gi.getListeners(lh.SECURITY_POLICY_VIOLATION).length>0&&gi.safeEmit(lh.SECURITY_POLICY_VIOLATION,c))};i&&Px.removeEventListener("securitypolicyviolation",i),(n||e&&typeof e=="function"||gi.getListeners(lh.SECURITY_POLICY_VIOLATION).length>0)&&Px.addEventListener("securitypolicyviolation",o),gi._cspEventHandlerPointer=o}var Bfe=N,Wfe=i6,TH=RegExp.prototype,zfe=function(e){return e===TH||Bfe(TH,e)?Wfe(e):e.flags},Zs=l(zfe);function Gv(e){let n=e.length;for(;--n>=0;)e[n]=0}const Ox=256,bH=286,vb=30,Sb=15,kx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Gfe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),wH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Kp=new Array(576);Gv(Kp);const Tb=new Array(60);Gv(Tb);const bb=new Array(512);Gv(bb);const wb=new Array(256);Gv(wb);const Nx=new Array(29);Gv(Nx);const mP=new Array(vb);function Dx(e,n,i,o,c){this.static_tree=e,this.extra_bits=n,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let RH,CH,IH;function Lx(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}Gv(mP);const AH=e=>e<256?bb[e]:bb[256+(e>>>7)],Rb=(e,n)=>{e.pending_buf[e.pending++]=255&n,e.pending_buf[e.pending++]=n>>>8&255},Dc=(e,n,i)=>{e.bi_valid>16-i?(e.bi_buf|=n<<e.bi_valid&65535,Rb(e,e.bi_buf),e.bi_buf=n>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=i)},fh=(e,n,i)=>{Dc(e,i[2*n],i[2*n+1])},PH=(e,n)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--n>0);return i>>>1},OH=(e,n,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=Sb;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=n;u++){let m=e[2*u+1];m!==0&&(e[2*u]=PH(o[m]++,m))}},kH=e=>{let n;for(n=0;n<bH;n++)e.dyn_ltree[2*n]=0;for(n=0;n<vb;n++)e.dyn_dtree[2*n]=0;for(n=0;n<19;n++)e.bl_tree[2*n]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},NH=e=>{e.bi_valid>8?Rb(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},DH=(e,n,i,o)=>{const c=2*n,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[n]<=o[i]},xx=(e,n,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&DH(n,e.heap[c+1],e.heap[c],e.depth)&&c++,!DH(n,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},LH=(e,n,i)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?fh(e,c,n):(u=wb[c],fh(e,u+Ox+1,n),h=kx[u],h!==0&&(c-=Nx[u],Dc(e,c,h)),o--,u=AH(o),fh(e,u,i),h=fP[u],h!==0&&(o-=mP[u],Dc(e,o,h)));while(m<e.sym_next);fh(e,256,n)},Mx=(e,n)=>{const i=n.dyn_tree,o=n.stat_desc.static_tree,c=n.stat_desc.has_stree,u=n.stat_desc.elems;let h,m,_,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=y<2?++y:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(n.max_code=y,h=e.heap_len>>1;h>=1;h--)xx(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],xx(e,i,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,i[2*_]=i[2*h]+i[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,i[2*h+1]=i[2*m+1]=_,e.heap[1]=_++,xx(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const A=R.dyn_tree,k=R.max_code,W=R.stat_desc.static_tree,U=R.stat_desc.has_stree,V=R.stat_desc.extra_bits,q=R.stat_desc.extra_base,Y=R.stat_desc.max_length;let ce,_e,ye,fe,ke,qe,lt=0;for(fe=0;fe<=Sb;fe++)S.bl_count[fe]=0;for(A[2*S.heap[S.heap_max]+1]=0,ce=S.heap_max+1;ce<573;ce++)_e=S.heap[ce],fe=A[2*A[2*_e+1]+1]+1,fe>Y&&(fe=Y,lt++),A[2*_e+1]=fe,_e>k||(S.bl_count[fe]++,ke=0,_e>=q&&(ke=V[_e-q]),qe=A[2*_e],S.opt_len+=qe*(fe+ke),U&&(S.static_len+=qe*(W[2*_e+1]+ke)));if(lt!==0){do{for(fe=Y-1;S.bl_count[fe]===0;)fe--;S.bl_count[fe]--,S.bl_count[fe+1]+=2,S.bl_count[Y]--,lt-=2}while(lt>0);for(fe=Y;fe!==0;fe--)for(_e=S.bl_count[fe];_e!==0;)ye=S.heap[--ce],ye>k||(A[2*ye+1]!==fe&&(S.opt_len+=(fe-A[2*ye+1])*A[2*ye],A[2*ye+1]=fe),_e--)}})(e,n),OH(i,y,e.bl_count)},xH=(e,n,i)=>{let o,c,u=-1,h=n[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),n[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=n[2*(o+1)+1],++m<_&&c===h||(m<y?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4))},MH=(e,n,i)=>{let o,c,u=-1,h=n[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),o=0;o<=i;o++)if(c=h,h=n[2*(o+1)+1],!(++m<_&&c===h)){if(m<y)do fh(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(fh(e,c,e.bl_tree),m--),fh(e,16,e.bl_tree),Dc(e,m-3,2)):m<=10?(fh(e,17,e.bl_tree),Dc(e,m-3,3)):(fh(e,18,e.bl_tree),Dc(e,m-11,7));m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4)}};let UH=!1;const VH=(e,n,i,o)=>{Dc(e,0+(o?1:0),3),NH(e),Rb(e,i),Rb(e,~i),i&&e.pending_buf.set(e.window.subarray(n,n+i),e.pending),e.pending+=i};var Hfe=e=>{UH||((()=>{let n,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(Nx[c]=o,n=0;n<1<<kx[c];n++)wb[o++]=c;for(wb[o-1]=c,u=0,c=0;c<16;c++)for(mP[c]=u,n=0;n<1<<fP[c];n++)bb[u++]=c;for(u>>=7;c<vb;c++)for(mP[c]=u<<7,n=0;n<1<<fP[c]-7;n++)bb[256+u++]=c;for(i=0;i<=Sb;i++)h[i]=0;for(n=0;n<=143;)Kp[2*n+1]=8,n++,h[8]++;for(;n<=255;)Kp[2*n+1]=9,n++,h[9]++;for(;n<=279;)Kp[2*n+1]=7,n++,h[7]++;for(;n<=287;)Kp[2*n+1]=8,n++,h[8]++;for(OH(Kp,287,h),n=0;n<vb;n++)Tb[2*n+1]=5,Tb[2*n]=PH(n,5);RH=new Dx(Kp,kx,257,bH,Sb),CH=new Dx(Tb,fP,0,vb,Sb),IH=new Dx(new Array(0),Gfe,0,19,7)})(),UH=!0),e.l_desc=new Lx(e.dyn_ltree,RH),e.d_desc=new Lx(e.dyn_dtree,CH),e.bl_desc=new Lx(e.bl_tree,IH),e.bi_buf=0,e.bi_valid=0,kH(e)},$fe=(e,n,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,y=4093624447;for(_=0;_<=31;_++,y>>>=1)if(1&y&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<Ox;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),Mx(e,e.l_desc),Mx(e,e.d_desc),h=(m=>{let _;for(xH(m,m.dyn_ltree,m.l_desc.max_code),xH(m,m.dyn_dtree,m.d_desc.max_code),Mx(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*wH[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&n!==-1?VH(e,n,i,o):e.strategy===4||u===c?(Dc(e,2+(o?1:0),3),LH(e,Kp,Tb)):(Dc(e,4+(o?1:0),3),((m,_,y,S)=>{let R;for(Dc(m,_-257,5),Dc(m,y-1,5),Dc(m,S-4,4),R=0;R<S;R++)Dc(m,m.bl_tree[2*wH[R]+1],3);MH(m,m.dyn_ltree,_-1),MH(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),LH(e,e.dyn_ltree,e.dyn_dtree)),kH(e),o&&NH(e)},Kfe=(e,n,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=n,e.pending_buf[e.sym_buf+e.sym_next++]=n>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,n===0?e.dyn_ltree[2*i]++:(e.matches++,n--,e.dyn_ltree[2*(wb[i]+Ox+1)]++,e.dyn_dtree[2*AH(n)]++),e.sym_next===e.sym_end),qfe=e=>{Dc(e,2,3),fh(e,256,Kp),(n=>{n.bi_valid===16?(Rb(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(e)},Yfe={_tr_init:Hfe,_tr_stored_block:VH,_tr_flush_block:$fe,_tr_tally:Kfe,_tr_align:qfe},Cb=(e,n,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+n[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Xfe=new Uint32Array((()=>{let e,n=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;n[i]=e}return n})());var vo=(e,n,i,o)=>{const c=Xfe,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^n[h])];return-1^e},U_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},gP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Jfe,_tr_stored_block:Ux,_tr_flush_block:Qfe,_tr_tally:km,_tr_align:Zfe}=Yfe,{Z_NO_FLUSH:Nm,Z_PARTIAL_FLUSH:eme,Z_FULL_FLUSH:tme,Z_FINISH:uu,Z_BLOCK:FH,Z_OK:$o,Z_STREAM_END:jH,Z_STREAM_ERROR:mh,Z_DATA_ERROR:nme,Z_BUF_ERROR:Vx,Z_DEFAULT_COMPRESSION:rme,Z_FILTERED:ime,Z_HUFFMAN_ONLY:_P,Z_RLE:sme,Z_FIXED:ome,Z_DEFAULT_STRATEGY:ame,Z_UNKNOWN:cme,Z_DEFLATED:EP}=gP,Fx=286,lme=30,ume=19,dme=2*Fx+1,hme=15,V_=258,gh=262,Hv=42,F_=113,Ib=666,j_=(e,n)=>(e.msg=U_[n],n),BH=e=>2*e-(e>4?9:0),Dm=e=>{let n=e.length;for(;--n>=0;)e[n]=0},pme=e=>{let n,i,o,c=e.w_size;n=e.hash_size,o=n;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--n);n=c,o=n;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--n)};let Lm=(e,n,i)=>(n<<e.hash_shift^i)&e.hash_mask;const gl=e=>{const n=e.state;let i=n.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),e.next_out),e.next_out+=i,n.pending_out+=i,e.total_out+=i,e.avail_out-=i,n.pending-=i,n.pending===0&&(n.pending_out=0))},_l=(e,n)=>{Qfe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,gl(e.strm)},Gr=(e,n)=>{e.pending_buf[e.pending++]=n},Ab=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=255&n},jx=(e,n,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,n.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=Cb(e.adler,n,c,i):e.state.wrap===2&&(e.adler=vo(e.adler,n,c,i)),e.next_in+=c,e.total_in+=c,c)},WH=(e,n)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-gh?e.strstart-(e.w_size-gh):0,y=e.window,S=e.w_mask,R=e.prev,A=e.strstart+V_;let k=y[u+h-1],W=y[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(i=n,y[i+h]===W&&y[i+h-1]===k&&y[i]===y[u]&&y[++i]===y[u+1]){u+=2,i++;do;while(y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&u<A);if(o=V_-(A-u),u=A-V_,o>h){if(e.match_start=n,h=o,o>=m)break;k=y[u+h-1],W=y[u+h]}}while((n=R[n&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},$v=e=>{const n=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-gh)&&(e.window.set(e.window.subarray(n,n+n-o),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),pme(e),o+=n),e.strm.avail_in===0)break;if(i=jx(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Lm(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Lm(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<gh&&e.strm.avail_in!==0)},zH=(e,n)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&n!==uu||n===Nm||i!==o+e.strm.avail_in)))break;h=n===uu&&i===o+e.strm.avail_in?1:0,Ux(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,gl(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(jx(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:n!==Nm&&n!==uu&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(jx(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||n===uu)&&n!==Nm&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=n===uu&&e.strm.avail_in===0&&i===o?1:0,Ux(e,e.block_start,i,h),e.block_start+=i,gl(e.strm)),h?3:1)},Bx=(e,n)=>{let i,o;for(;;){if(e.lookahead<gh){if($v(e),e.lookahead<gh&&n===Nm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-gh&&(e.match_length=WH(e,i)),e.match_length>=3)if(o=km(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+1]);else o=km(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(_l(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,n===uu?(_l(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(_l(e,!1),e.strm.avail_out===0)?1:2},Kv=(e,n)=>{let i,o,c;for(;;){if(e.lookahead<gh){if($v(e),e.lookahead<gh&&n===Nm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-gh&&(e.match_length=WH(e,i),e.match_length<=5&&(e.strategy===ime||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=km(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(_l(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=km(e,0,e.window[e.strstart-1]),o&&_l(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=km(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,n===uu?(_l(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(_l(e,!1),e.strm.avail_out===0)?1:2};function _h(e,n,i,o,c){this.good_length=e,this.max_lazy=n,this.nice_length=i,this.max_chain=o,this.func=c}const Pb=[new _h(0,0,0,0,zH),new _h(4,4,8,4,Bx),new _h(4,5,16,8,Bx),new _h(4,6,32,32,Bx),new _h(4,4,16,16,Kv),new _h(8,16,32,32,Kv),new _h(8,16,128,128,Kv),new _h(8,32,128,256,Kv),new _h(32,128,258,1024,Kv),new _h(32,258,258,4096,Kv)];function fme(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=EP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*dme),this.dyn_dtree=new Uint16Array(2*(2*lme+1)),this.bl_tree=new Uint16Array(2*(2*ume+1)),Dm(this.dyn_ltree),Dm(this.dyn_dtree),Dm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(hme+1),this.heap=new Uint16Array(2*Fx+1),Dm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Fx+1),Dm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ob=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.status!==Hv&&n.status!==57&&n.status!==69&&n.status!==73&&n.status!==91&&n.status!==103&&n.status!==F_&&n.status!==Ib?1:0},GH=e=>{if(Ob(e))return j_(e,mh);e.total_in=e.total_out=0,e.data_type=cme;const n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?57:n.wrap?Hv:F_,e.adler=n.wrap===2?0:1,n.last_flush=-2,Jfe(n),$o},HH=e=>{const n=GH(e);return n===$o&&(i=>{i.window_size=2*i.w_size,Dm(i.head),i.max_lazy_match=Pb[i.level].max_lazy,i.good_match=Pb[i.level].good_length,i.nice_match=Pb[i.level].nice_length,i.max_chain_length=Pb[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),n},$H=(e,n,i,o,c,u)=>{if(!e)return mh;let h=1;if(n===rme&&(n=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==EP||o<8||o>15||n<0||n>9||u<0||u>ome||o===8&&h!==1)return j_(e,mh);o===8&&(o=9);const m=new fme;return e.state=m,m.strm=e,m.status=Hv,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=n,m.strategy=u,m.method=i,HH(e)};var mme=(e,n)=>{if(Ob(e)||n>FH||n<0)return e?j_(e,mh):mh;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===Ib&&n!==uu)return j_(e,e.avail_out===0?Vx:mh);const o=i.last_flush;if(i.last_flush=n,i.pending!==0){if(gl(e),e.avail_out===0)return i.last_flush=-1,$o}else if(e.avail_in===0&&BH(n)<=BH(o)&&n!==uu)return j_(e,Vx);if(i.status===Ib&&e.avail_in!==0)return j_(e,Vx);if(i.status===Hv&&i.wrap===0&&(i.status=F_),i.status===Hv){let c=EP+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=_P||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,Ab(i,c),i.strstart!==0&&(Ab(i,e.adler>>>16),Ab(i,65535&e.adler)),e.adler=1,i.status=F_,gl(e),i.pending!==0)return i.last_flush=-1,$o}if(i.status===57){if(e.adler=0,Gr(i,31),Gr(i,139),Gr(i,8),i.gzhead)Gr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Gr(i,255&i.gzhead.time),Gr(i,i.gzhead.time>>8&255),Gr(i,i.gzhead.time>>16&255),Gr(i,i.gzhead.time>>24&255),Gr(i,i.level===9?2:i.strategy>=_P||i.level<2?4:0),Gr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Gr(i,255&i.gzhead.extra.length),Gr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=vo(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,i.level===9?2:i.strategy>=_P||i.level<2?4:0),Gr(i,3),i.status=F_,gl(e),i.pending!==0)return i.last_flush=-1,$o}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=vo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,gl(e),i.pending!==0)return i.last_flush=-1,$o;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=vo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=vo(e.adler,i.pending_buf,i.pending-u,u)),gl(e),i.pending!==0)return i.last_flush=-1,$o;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Gr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=vo(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=vo(e.adler,i.pending_buf,i.pending-u,u)),gl(e),i.pending!==0)return i.last_flush=-1,$o;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Gr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=vo(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(gl(e),i.pending!==0))return i.last_flush=-1,$o;Gr(i,255&e.adler),Gr(i,e.adler>>8&255),e.adler=0}if(i.status=F_,gl(e),i.pending!==0)return i.last_flush=-1,$o}if(e.avail_in!==0||i.lookahead!==0||n!==Nm&&i.status!==Ib){let c=i.level===0?zH(i,n):i.strategy===_P?((u,h)=>{let m;for(;;){if(u.lookahead===0&&($v(u),u.lookahead===0)){if(h===Nm)return 1;break}if(u.match_length=0,m=km(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(_l(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===uu?(_l(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(_l(u,!1),u.strm.avail_out===0)?1:2})(i,n):i.strategy===sme?((u,h)=>{let m,_,y,S;const R=u.window;for(;;){if(u.lookahead<=V_){if($v(u),u.lookahead<=V_&&h===Nm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,_=R[y],_===R[++y]&&_===R[++y]&&_===R[++y])){S=u.strstart+V_;do;while(_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&y<S);u.match_length=V_-(S-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=km(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=km(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(_l(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===uu?(_l(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(_l(u,!1),u.strm.avail_out===0)?1:2})(i,n):Pb[i.level].func(i,n);if(c!==3&&c!==4||(i.status=Ib),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),$o;if(c===2&&(n===eme?Zfe(i):n!==FH&&(Ux(i,0,0,!1),n===tme&&(Dm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),gl(e),e.avail_out===0))return i.last_flush=-1,$o}return n!==uu?$o:i.wrap<=0?jH:(i.wrap===2?(Gr(i,255&e.adler),Gr(i,e.adler>>8&255),Gr(i,e.adler>>16&255),Gr(i,e.adler>>24&255),Gr(i,255&e.total_in),Gr(i,e.total_in>>8&255),Gr(i,e.total_in>>16&255),Gr(i,e.total_in>>24&255)):(Ab(i,e.adler>>>16),Ab(i,65535&e.adler)),gl(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?$o:jH)},gme=(e,n)=>{let i=n.length;if(Ob(e))return mh;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==Hv||o.lookahead)return mh;if(c===1&&(e.adler=Cb(e.adler,n,i,0)),o.wrap=0,i>=o.w_size){c===0&&(Dm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(n.subarray(i-o.w_size,i),0),n=_,i=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=i,e.next_in=0,e.input=n,$v(o);o.lookahead>=3;){let _=o.strstart,y=o.lookahead-2;do o.ins_h=Lm(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--y);o.strstart=_,o.lookahead=2,$v(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,$o},kb={deflateInit:(e,n)=>$H(e,n,EP,15,8,ame),deflateInit2:$H,deflateReset:HH,deflateResetKeep:GH,deflateSetHeader:(e,n)=>Ob(e)||e.state.wrap!==2?mh:(e.state.gzhead=n,$o),deflate:mme,deflateEnd:e=>{if(Ob(e))return mh;const n=e.state.status;return e.state=null,n===F_?j_(e,nme):$o},deflateSetDictionary:gme,deflateInfo:"pako deflate (from Nodeca project)"};const _me=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var yP={assign:function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)_me(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let n=0;for(let o=0,c=e.length;o<c;o++)n+=e[o].length;const i=new Uint8Array(n);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let KH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{KH=!1}const Nb=new Uint8Array(256);for(let e=0;e<256;e++)Nb[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Nb[254]=Nb[254]=1;var Db={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,i,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(m),u=0,c=0;u<m;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?n[u++]=i:i<2048?(n[u++]=192|i>>>6,n[u++]=128|63&i):i<65536?(n[u++]=224|i>>>12,n[u++]=128|i>>>6&63,n[u++]=128|63&i):(n[u++]=240|i>>>18,n[u++]=128|i>>>12&63,n[u++]=128|i>>>6&63,n[u++]=128|63&i);return n},buf2string:(e,n)=>{const i=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=Nb[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<i;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&KH)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let y=0;y<m;y++)_+=String.fromCharCode(h[y]);return _})(u,c)},utf8border:(e,n)=>{(n=n||e.length)>e.length&&(n=e.length);let i=n-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?n:i+Nb[e[i]]>n?i:n}},qH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const YH=Object.prototype.toString,{Z_NO_FLUSH:Eme,Z_SYNC_FLUSH:yme,Z_FULL_FLUSH:vme,Z_FINISH:Sme,Z_OK:vP,Z_STREAM_END:Tme,Z_DEFAULT_COMPRESSION:bme,Z_DEFAULT_STRATEGY:wme,Z_DEFLATED:Rme}=gP;function SP(e){this.options=yP.assign({level:bme,method:Rme,chunkSize:16384,windowBits:15,memLevel:8,strategy:wme},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qH,this.strm.avail_out=0;let i=kb.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==vP)throw new Error(U_[i]);if(n.header&&kb.deflateSetHeader(this.strm,n.header),n.dictionary){let o;if(o=typeof n.dictionary=="string"?Db.string2buf(n.dictionary):YH.call(n.dictionary)==="[object ArrayBuffer]"?new Uint8Array(n.dictionary):n.dictionary,i=kb.deflateSetDictionary(this.strm,o),i!==vP)throw new Error(U_[i]);this._dict_set=!0}}function Cme(e,n){const i=new SP(n);if(i.push(e,!0),i.err)throw i.msg||U_[i.err];return i.result}SP.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=n===~~n?n:n===!0?Sme:Eme,typeof e=="string"?i.input=Db.string2buf(e):YH.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===yme||u===vme)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=kb.deflate(i,u),c===Tme)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=kb.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===vP;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},SP.prototype.onData=function(e){this.chunks.push(e)},SP.prototype.onEnd=function(e){e===vP&&(this.result=yP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ime={deflate:Cme};const TP=16209;var Ame=function(e,n){let i,o,c,u,h,m,_,y,S,R,A,k,W,U,V,q,Y,ce,_e,ye,fe,ke,qe,lt;const ht=e.state;i=e.next_in,qe=e.input,o=i+(e.avail_in-5),c=e.next_out,lt=e.output,u=c-(n-e.avail_out),h=c+(e.avail_out-257),m=ht.dmax,_=ht.wsize,y=ht.whave,S=ht.wnext,R=ht.window,A=ht.hold,k=ht.bits,W=ht.lencode,U=ht.distcode,V=(1<<ht.lenbits)-1,q=(1<<ht.distbits)-1;e:do{k<15&&(A+=qe[i++]<<k,k+=8,A+=qe[i++]<<k,k+=8),Y=W[A&V];t:for(;;){if(ce=Y>>>24,A>>>=ce,k-=ce,ce=Y>>>16&255,ce===0)lt[c++]=65535&Y;else{if(!(16&ce)){if((64&ce)==0){Y=W[(65535&Y)+(A&(1<<ce)-1)];continue t}if(32&ce){ht.mode=16191;break e}e.msg="invalid literal/length code",ht.mode=TP;break e}_e=65535&Y,ce&=15,ce&&(k<ce&&(A+=qe[i++]<<k,k+=8),_e+=A&(1<<ce)-1,A>>>=ce,k-=ce),k<15&&(A+=qe[i++]<<k,k+=8,A+=qe[i++]<<k,k+=8),Y=U[A&q];n:for(;;){if(ce=Y>>>24,A>>>=ce,k-=ce,ce=Y>>>16&255,!(16&ce)){if((64&ce)==0){Y=U[(65535&Y)+(A&(1<<ce)-1)];continue n}e.msg="invalid distance code",ht.mode=TP;break e}if(ye=65535&Y,ce&=15,k<ce&&(A+=qe[i++]<<k,k+=8,k<ce&&(A+=qe[i++]<<k,k+=8)),ye+=A&(1<<ce)-1,ye>m){e.msg="invalid distance too far back",ht.mode=TP;break e}if(A>>>=ce,k-=ce,ce=c-u,ye>ce){if(ce=ye-ce,ce>y&&ht.sane){e.msg="invalid distance too far back",ht.mode=TP;break e}if(fe=0,ke=R,S===0){if(fe+=_-ce,ce<_e){_e-=ce;do lt[c++]=R[fe++];while(--ce);fe=c-ye,ke=lt}}else if(S<ce){if(fe+=_+S-ce,ce-=S,ce<_e){_e-=ce;do lt[c++]=R[fe++];while(--ce);if(fe=0,S<_e){ce=S,_e-=ce;do lt[c++]=R[fe++];while(--ce);fe=c-ye,ke=lt}}}else if(fe+=S-ce,ce<_e){_e-=ce;do lt[c++]=R[fe++];while(--ce);fe=c-ye,ke=lt}for(;_e>2;)lt[c++]=ke[fe++],lt[c++]=ke[fe++],lt[c++]=ke[fe++],_e-=3;_e&&(lt[c++]=ke[fe++],_e>1&&(lt[c++]=ke[fe++]))}else{fe=c-ye;do lt[c++]=lt[fe++],lt[c++]=lt[fe++],lt[c++]=lt[fe++],_e-=3;while(_e>2);_e&&(lt[c++]=lt[fe++],_e>1&&(lt[c++]=lt[fe++]))}break}}break}}while(i<o&&c<h);_e=k>>3,i-=_e,k-=_e<<3,A&=(1<<k)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),ht.hold=A,ht.bits=k};const bP=15,Pme=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ome=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),kme=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Nme=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Lb=(e,n,i,o,c,u,h,m)=>{const _=m.bits;let y,S,R,A,k,W,U=0,V=0,q=0,Y=0,ce=0,_e=0,ye=0,fe=0,ke=0,qe=0,lt=null;const ht=new Uint16Array(16),yn=new Uint16Array(16);let vn,cr,Qr,Br=null;for(U=0;U<=bP;U++)ht[U]=0;for(V=0;V<o;V++)ht[n[i+V]]++;for(ce=_,Y=bP;Y>=1&&ht[Y]===0;Y--);if(ce>Y&&(ce=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<Y&&ht[q]===0;q++);for(ce<q&&(ce=q),fe=1,U=1;U<=bP;U++)if(fe<<=1,fe-=ht[U],fe<0)return-1;if(fe>0&&(e===0||Y!==1))return-1;for(yn[1]=0,U=1;U<bP;U++)yn[U+1]=yn[U]+ht[U];for(V=0;V<o;V++)n[i+V]!==0&&(h[yn[n[i+V]]++]=V);if(e===0?(lt=Br=h,W=20):e===1?(lt=Pme,Br=Ome,W=257):(lt=kme,Br=Nme,W=0),qe=0,V=0,U=q,k=u,_e=ce,ye=0,R=-1,ke=1<<ce,A=ke-1,e===1&&ke>852||e===2&&ke>592)return 1;for(;;){vn=U-ye,h[V]+1<W?(cr=0,Qr=h[V]):h[V]>=W?(cr=Br[h[V]-W],Qr=lt[h[V]-W]):(cr=96,Qr=0),y=1<<U-ye,S=1<<_e,q=S;do S-=y,c[k+(qe>>ye)+S]=vn<<24|cr<<16|Qr|0;while(S!==0);for(y=1<<U-1;qe&y;)y>>=1;if(y!==0?(qe&=y-1,qe+=y):qe=0,V++,--ht[U]==0){if(U===Y)break;U=n[i+h[V]]}if(U>ce&&(qe&A)!==R){for(ye===0&&(ye=ce),k+=q,_e=U-ye,fe=1<<_e;_e+ye<Y&&(fe-=ht[_e+ye],!(fe<=0));)_e++,fe<<=1;if(ke+=1<<_e,e===1&&ke>852||e===2&&ke>592)return 1;R=qe&A,c[R]=ce<<24|_e<<16|k-u|0}}return qe!==0&&(c[k+qe]=U-ye<<24|64<<16|0),m.bits=ce,0};const{Z_FINISH:XH,Z_BLOCK:Dme,Z_TREES:wP,Z_OK:B_,Z_STREAM_END:Lme,Z_NEED_DICT:xme,Z_STREAM_ERROR:du,Z_DATA_ERROR:JH,Z_MEM_ERROR:QH,Z_BUF_ERROR:Mme,Z_DEFLATED:ZH}=gP,RP=16180,CP=16190,qp=16191,Wx=16192,zx=16194,IP=16199,AP=16200,Gx=16206,Gi=16209,e7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ume(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const W_=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.mode<RP||n.mode>16211?1:0},t7=e=>{if(W_(e))return du;const n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=RP,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,B_},n7=e=>{if(W_(e))return du;const n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,t7(e)},r7=(e,n)=>{let i;if(W_(e))return du;const o=e.state;return n<0?(i=0,n=-n):(i=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?du:(o.window!==null&&o.wbits!==n&&(o.window=null),o.wrap=i,o.wbits=n,n7(e))},i7=(e,n)=>{if(!e)return du;const i=new Ume;e.state=i,i.strm=e,i.window=null,i.mode=RP;const o=r7(e,n);return o!==B_&&(e.state=null),o};let Hx,$x,s7=!0;const Vme=e=>{if(s7){Hx=new Int32Array(512),$x=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(Lb(1,e.lens,0,288,Hx,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;Lb(2,e.lens,0,32,$x,0,e.work,{bits:5}),s7=!1}e.lencode=Hx,e.lenbits=9,e.distcode=$x,e.distbits=5},o7=(e,n,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(n.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(n.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(n.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Fme=(e,n)=>{let i,o,c,u,h,m,_,y,S,R,A,k,W,U,V,q,Y,ce,_e,ye,fe,ke,qe=0;const lt=new Uint8Array(4);let ht,yn;const vn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(W_(e)||!e.output||!e.input&&e.avail_in!==0)return du;i=e.state,i.mode===qp&&(i.mode=Wx),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,R=m,A=_,ke=B_;e:for(;;)switch(i.mode){case RP:if(i.wrap===0){i.mode=Wx;break}for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(2&i.wrap&&y===35615){i.wbits===0&&(i.wbits=15),i.check=0,lt[0]=255&y,lt[1]=y>>>8&255,i.check=vo(i.check,lt,2,0),y=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",i.mode=Gi;break}if((15&y)!==ZH){e.msg="unknown compression method",i.mode=Gi;break}if(y>>>=4,S-=4,fe=8+(15&y),i.wbits===0&&(i.wbits=fe),fe>15||fe>i.wbits){e.msg="invalid window size",i.mode=Gi;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&y?16189:qp,y=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.flags=y,(255&Zs(i))!==ZH){e.msg="unknown compression method",i.mode=Gi;break}if(57344&Zs(i)){e.msg="unknown header flags set",i.mode=Gi;break}i.head&&(i.head.text=y>>8&1),512&Zs(i)&&4&i.wrap&&(lt[0]=255&y,lt[1]=y>>>8&255,i.check=vo(i.check,lt,2,0)),y=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.time=y),512&Zs(i)&&4&i.wrap&&(lt[0]=255&y,lt[1]=y>>>8&255,lt[2]=y>>>16&255,lt[3]=y>>>24&255,i.check=vo(i.check,lt,4,0)),y=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&Zs(i)&&4&i.wrap&&(lt[0]=255&y,lt[1]=y>>>8&255,i.check=vo(i.check,lt,2,0)),y=0,S=0,i.mode=16184;case 16184:if(1024&Zs(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length=y,i.head&&(i.head.extra_len=y),512&Zs(i)&&4&i.wrap&&(lt[0]=255&y,lt[1]=y>>>8&255,i.check=vo(i.check,lt,2,0)),y=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&Zs(i)&&(k=i.length,k>m&&(k=m),k&&(i.head&&(fe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+k),fe)),512&Zs(i)&&4&i.wrap&&(i.check=vo(i.check,o,k,u)),m-=k,u+=k,i.length-=k),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&Zs(i)){if(m===0)break e;k=0;do fe=o[u+k++],i.head&&fe&&i.length<65536&&(i.head.name+=String.fromCharCode(fe));while(fe&&k<m);if(512&Zs(i)&&4&i.wrap&&(i.check=vo(i.check,o,k,u)),m-=k,u+=k,fe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&Zs(i)){if(m===0)break e;k=0;do fe=o[u+k++],i.head&&fe&&i.length<65536&&(i.head.comment+=String.fromCharCode(fe));while(fe&&k<m);if(512&Zs(i)&&4&i.wrap&&(i.check=vo(i.check,o,k,u)),m-=k,u+=k,fe)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&Zs(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Gi;break}y=0,S=0}i.head&&(i.head.hcrc=Zs(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=qp;break;case 16189:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}e.adler=i.check=e7(y),y=0,S=0,i.mode=CP;case CP:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,xme;e.adler=i.check=1,i.mode=qp;case qp:if(n===Dme||n===wP)break e;case Wx:if(i.last){y>>>=7&S,S-=7&S,i.mode=Gx;break}for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}switch(i.last=1&y,y>>>=1,S-=1,3&y){case 0:i.mode=16193;break;case 1:if(Vme(i),i.mode=IP,n===wP){y>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Gi}y>>>=2,S-=2;break;case 16193:for(y>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Gi;break}if(i.length=65535&y,y=0,S=0,i.mode=zx,n===wP)break e;case zx:i.mode=16195;case 16195:if(k=i.length,k){if(k>m&&(k=m),k>_&&(k=_),k===0)break e;c.set(o.subarray(u,u+k),h),m-=k,u+=k,_-=k,h+=k,i.length-=k;break}i.mode=qp;break;case 16196:for(;S<14;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.nlen=257+(31&y),y>>>=5,S-=5,i.ndist=1+(31&y),y>>>=5,S-=5,i.ncode=4+(15&y),y>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Gi;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.lens[vn[i.have++]]=7&y,y>>>=3,S-=3}for(;i.have<19;)i.lens[vn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ht={bits:i.lenbits},ke=Lb(0,i.lens,0,19,i.lencode,0,i.work,ht),i.lenbits=ht.bits,ke){e.msg="invalid code lengths set",i.mode=Gi;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;qe=i.lencode[y&(1<<i.lenbits)-1],V=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(Y<16)y>>>=V,S-=V,i.lens[i.have++]=Y;else{if(Y===16){for(yn=V+2;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(y>>>=V,S-=V,i.have===0){e.msg="invalid bit length repeat",i.mode=Gi;break}fe=i.lens[i.have-1],k=3+(3&y),y>>>=2,S-=2}else if(Y===17){for(yn=V+3;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=V,S-=V,fe=0,k=3+(7&y),y>>>=3,S-=3}else{for(yn=V+7;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=V,S-=V,fe=0,k=11+(127&y),y>>>=7,S-=7}if(i.have+k>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Gi;break}for(;k--;)i.lens[i.have++]=fe}}if(i.mode===Gi)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Gi;break}if(i.lenbits=9,ht={bits:i.lenbits},ke=Lb(1,i.lens,0,i.nlen,i.lencode,0,i.work,ht),i.lenbits=ht.bits,ke){e.msg="invalid literal/lengths set",i.mode=Gi;break}if(i.distbits=6,i.distcode=i.distdyn,ht={bits:i.distbits},ke=Lb(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ht),i.distbits=ht.bits,ke){e.msg="invalid distances set",i.mode=Gi;break}if(i.mode=IP,n===wP)break e;case IP:i.mode=AP;case AP:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,Ame(e,A),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,i.mode===qp&&(i.back=-1);break}for(i.back=0;qe=i.lencode[y&(1<<i.lenbits)-1],V=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(ce=V,_e=q,ye=Y;qe=i.lencode[ye+((y&(1<<ce+_e)-1)>>ce)],V=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(ce+V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=ce,S-=ce,i.back+=ce}if(y>>>=V,S-=V,i.back+=V,i.length=Y,q===0){i.mode=16205;break}if(32&q){i.back=-1,i.mode=qp;break}if(64&q){e.msg="invalid literal/length code",i.mode=Gi;break}i.extra=15&q,i.mode=16201;case 16201:if(i.extra){for(yn=i.extra;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;qe=i.distcode[y&(1<<i.distbits)-1],V=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((240&q)==0){for(ce=V,_e=q,ye=Y;qe=i.distcode[ye+((y&(1<<ce+_e)-1)>>ce)],V=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(ce+V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=ce,S-=ce,i.back+=ce}if(y>>>=V,S-=V,i.back+=V,64&q){e.msg="invalid distance code",i.mode=Gi;break}i.offset=Y,i.extra=15&q,i.mode=16203;case 16203:if(i.extra){for(yn=i.extra;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Gi;break}i.mode=16204;case 16204:if(_===0)break e;if(k=A-_,i.offset>k){if(k=i.offset-k,k>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Gi;break}k>i.wnext?(k-=i.wnext,W=i.wsize-k):W=i.wnext-k,k>i.length&&(k=i.length),U=i.window}else U=c,W=h-i.offset,k=i.length;k>_&&(k=_),_-=k,i.length-=k;do c[h++]=U[W++];while(--k);i.length===0&&(i.mode=AP);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=AP;break;case Gx:if(i.wrap){for(;S<32;){if(m===0)break e;m--,y|=o[u++]<<S,S+=8}if(A-=_,e.total_out+=A,i.total+=A,4&i.wrap&&A&&(e.adler=i.check=Zs(i)?vo(i.check,c,A,h-A):Cb(i.check,c,A,h-A)),A=_,4&i.wrap&&(Zs(i)?y:e7(y))!==i.check){e.msg="incorrect data check",i.mode=Gi;break}y=0,S=0}i.mode=16207;case 16207:if(i.wrap&&Zs(i)){for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Gi;break}y=0,S=0}i.mode=16208;case 16208:ke=Lme;break e;case Gi:ke=JH;break e;case 16210:return QH;default:return du}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,(i.wsize||A!==e.avail_out&&i.mode<Gi&&(i.mode<Gx||n!==XH))&&o7(e,e.output,e.next_out,A-e.avail_out),R-=e.avail_in,A-=e.avail_out,e.total_in+=R,e.total_out+=A,i.total+=A,4&i.wrap&&A&&(e.adler=i.check=Zs(i)?vo(i.check,c,A,e.next_out-A):Cb(i.check,c,A,e.next_out-A)),e.data_type=i.bits+(i.last?64:0)+(i.mode===qp?128:0)+(i.mode===IP||i.mode===zx?256:0),(R===0&&A===0||n===XH)&&ke===B_&&(ke=Mme),ke},Yp={inflateReset:n7,inflateReset2:r7,inflateResetKeep:t7,inflateInit:e=>i7(e,15),inflateInit2:i7,inflate:Fme,inflateEnd:e=>{if(W_(e))return du;let n=e.state;return n.window&&(n.window=null),e.state=null,B_},inflateGetHeader:(e,n)=>{if(W_(e))return du;const i=e.state;return(2&i.wrap)==0?du:(i.head=n,n.done=!1,B_)},inflateSetDictionary:(e,n)=>{const i=n.length;let o,c,u;return W_(e)?du:(o=e.state,o.wrap!==0&&o.mode!==CP?du:o.mode===CP&&(c=1,c=Cb(c,n,i,0),c!==o.check)?JH:(u=o7(e,n,i,i),u?(o.mode=16210,QH):(o.havedict=1,B_)))},inflateInfo:"pako inflate (from Nodeca project)"},jme=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const a7=Object.prototype.toString,{Z_NO_FLUSH:Bme,Z_FINISH:Wme,Z_OK:xb,Z_STREAM_END:Kx,Z_NEED_DICT:qx,Z_STREAM_ERROR:zme,Z_DATA_ERROR:c7,Z_MEM_ERROR:Gme}=gP;function PP(e){this.options=yP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||e&&e.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(15&n.windowBits)==0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qH,this.strm.avail_out=0;let i=Yp.inflateInit2(this.strm,n.windowBits);if(i!==xb)throw new Error(U_[i]);if(this.header=new jme,Yp.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=Db.string2buf(n.dictionary):a7.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=Yp.inflateSetDictionary(this.strm,n.dictionary),i!==xb)))throw new Error(U_[i])}function Hme(e,n){const i=new PP(n);if(i.push(e),i.err)throw i.msg||U_[i.err];return i.result}PP.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=n===~~n?n:n===!0?Wme:Bme,a7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=Yp.inflate(i,h),u===qx&&c&&(u=Yp.inflateSetDictionary(i,c),u===xb?u=Yp.inflate(i,h):u===c7&&(u=qx));i.avail_in>0&&u===Kx&&i.state.wrap>0&&e[i.next_in]!==0;)Yp.inflateReset(i),u=Yp.inflate(i,h);switch(u){case zme:case c7:case qx:case Gme:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===Kx))if(this.options.to==="string"){let _=Db.utf8border(i.output,i.next_out),y=i.next_out-_,S=Db.buf2string(i.output,_);i.next_out=y,i.avail_out=o-y,y&&i.output.set(i.output.subarray(_,_+y),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==xb||m!==0){if(u===Kx)return u=Yp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},PP.prototype.onData=function(e){this.chunks.push(e)},PP.prototype.onEnd=function(e){e===xb&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=yP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var $me={inflate:Hme};const{deflate:Kme}=Ime,{inflate:qme}=$me;var Yme=Kme,Xme=qme,l7=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(l7||{});class Jme{constructor(){$(this,"_sequence",0),$(this,"_startTime",Date.now()),$(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=y,i.payload=this.compress(n),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&D.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const i=new DataView(n);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,m;if(o+=4,re("SHOW_DATASTREAM2_LOG")&&D.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(n.slice(o)),o+=2+m.length,h=n.slice(o);let _=!1;if(m.datas.length>0){const y=m.datas.find(S=>S.id===0);y&&(_=(1&new DataView(y.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:i,length:o,datas:c}=n,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,i),m.setUint8(_++,o),c.forEach(y=>{i?(m.setUint8(_++,y.id),m.setUint8(_++,y.length),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength):(m.setUint8(_++,y.id|y.length<<4),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(n){const i=new DataView(n);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===l7.TWO_BYTE,m=[],_=new DataView(n,2);let y=0;for(;y<u;){let S=0,R=0,A=new ArrayBuffer(0);h?(S=_.getUint8(y),y++,R=_.getUint8(y),y++):(S=15&_.getUint8(y),R=_.getUint8(y)>>4,y++),R>0&&(A=_.buffer.slice(y+2,y+2+R),y+=A.byteLength),m.push({id:S,length:R,data:A})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(n){return Xme(new Uint8Array(n))}compress(n){return Yme(new Uint8Array(n))}}const Qme={name:"DataStream",create:(e,n)=>{const i=n?new spe(e):new ope(e);return i.useDataStream(new Jme),i}};class Zme extends Ir{constructor(n,i,o){super(),$(this,"ws",void 0),$(this,"requestId",1),$(this,"heartBeatTimer",void 0),$(this,"joinInfo",void 0),$(this,"clientId",void 0),$(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),$(this,"onClose",c=>{this.emit("close"),this.dispose()}),$(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=n,this.clientId=i,this.ws=new ab("cross-channel-".concat(this.clientId),o),this.ws.on(qt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(qt.CONNECTED,this.onOpen),this.ws.on(qt.ON_MESSAGE,this.onMessage),this.ws.on(qt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(n){const i=this.requestId++;return n.requestId=i,n.seq=i,this.ws.sendMessage(n),i}waitStatus(n){return new ct((i,o)=>{const c=window.setTimeout(()=>{o(new Pe(X.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Pe(X.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Pe(X.WS_ABORT))})})}async request(n){if(this.ws.state==="closed")throw new Pe(X.WS_DISCONNECT);const i=()=>new ct((h,m)=>{this.ws.once(qt.CLOSED,()=>m(new Pe(X.WS_ABORT))),this.ws.once(qt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(n),c=new ct((h,m)=>{const _=()=>{m(new Pe(X.WS_ABORT))};this.ws.once(qt.RECONNECTING,_),this.ws.once(qt.CLOSED,_),this.once("req_".concat(o),h),Ji(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(qt.RECONNECTING,_),this.ws.off(qt.CLOSED,_),m(new Pe(X.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Pe(X.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(n){this.ws.removeAllListeners(qt.REQUEST_NEW_URLS),this.ws.on(qt.REQUEST_NEW_URLS,i=>{i(n)}),await this.ws.init(n)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const i=this.requestId++;return n.requestId=i,this.ws.sendMessage(n),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class ege extends Ir{set state(n){n!==this._state&&(n!==_a.RELAY_STATE_FAILURE&&(this.errorCode=kv.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,i,o,c,u){super(),$(this,"joinInfo",void 0),$(this,"sid",void 0),$(this,"clientId",void 0),$(this,"cancelToken",Bo.CancelToken.source()),$(this,"workerToken",void 0),$(this,"requestId",0),$(this,"signal",void 0),$(this,"prevChannelMediaConfig",void 0),$(this,"httpRetryConfig",void 0),$(this,"_resolution",void 0),$(this,"_state",_a.RELAY_STATE_IDLE),$(this,"errorCode",kv.RELAY_OK),$(this,"onStatus",h=>{D.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Wp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Wp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=kv.SRC_TOKEN_EXPIRED,this.state=_a.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=kv.DEST_TOKEN_EXPIRED,this.state=_a.RELAY_STATE_FAILURE))}),$(this,"onReconnect",async()=>{D.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Wp.NETWORK_DISCONNECTED),this.state=_a.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==_a.RELAY_STATE_IDLE&&(D.error("auto restart channel media relay failed",h.toString()),this.errorCode=kv.SERVER_CONNECTION_LOST,this.state=_a.RELAY_STATE_FAILURE)})}),this.joinInfo=n,this.clientId=i,this.sid=v_(),this.signal=new Zme(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(n){if(this.state!==_a.RELAY_STATE_IDLE)throw new Pe(X.INVALID_OPERATION);this.state=_a.RELAY_STATE_CONNECTING,await this.connect(),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(n)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new Pe(X.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new Pe(X.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new Pe(X.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=n}async updateChannelMediaRelay(n){if(this.state!==_a.RELAY_STATE_RUNNING)throw new Pe(X.INVALID_OPERATION);await this.sendUpdateMessage(n),this.prevChannelMediaConfig=n}async setVideoProfile(n){if(this._resolution=n,this.state!==_a.RELAY_STATE_RUNNING)throw new Pe(X.INVALID_OPERATION);const i=this.genMessage(yo.SetVideoProfile);await this.signal.request(i),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),D.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=_a.RELAY_STATE_IDLE,this.dispose()}dispose(){D.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Bo.CancelToken.source(),this.state=_a.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const n=await ufe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=n.workerToken,await this.signal.connect(n.addressList),this.emit("event",Wp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(n){const i=this.genMessage(yo.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(yo.SetSdkProfile,n);await this.signal.request(o),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(yo.SetSourceChannel,n);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Wp.PACKET_JOINED_SRC_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(yo.SetSourceUserId,n);await this.signal.request(u),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(yo.SetDestChannel,n);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Wp.PACKET_JOINED_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(yo.StartPacketTransfer,n);await this.signal.request(m),this.emit("event",Wp.PACKET_SENT_TO_DEST_CHANNEL),this.state=_a.RELAY_STATE_RUNNING,D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(n){const i=this.genMessage(yo.UpdateDestChannel,n);await this.signal.request(i),this.emit("event",Wp.PACKET_UPDATE_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const n=this.genMessage(yo.StopPacketTransfer);await this.signal.request(n),D.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(n,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:dl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(n){case yo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case yo.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Pe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case yo.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Pe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case yo.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Pe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case yo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case yo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case yo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case yo.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Pe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case yo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const tge={name:"ChannelMediaRelay",create:function(e){return new ege(e.joinInfo,e.clientId,e.websocketRetryConfig||mi,e.httpRetryConfig||mi,e.resolution)}};function u7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Mb(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?u7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class nge extends Ir{constructor(n,i,o,c){super(),$(this,"spec",void 0),$(this,"token",void 0),$(this,"websocket",void 0),$(this,"pingpongTimer",void 0),$(this,"reconnectMode","retry"),$(this,"serviceMode",void 0),$(this,"reqId",0),$(this,"commandReqId",0),$(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),$(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(bt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Bp.TRANSCODE?1:2}),this.emit(Sm.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=n,this.serviceMode=c,this.websocket=new ab("live-streaming",o),this.websocket.on(qt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(qt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(qt.REQUEST_NEW_URLS,(u,h)=>{fs(this,Sm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(qt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}async request(n,i,o,c){this.reqId+=1,n==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Pe(X.UNEXPECTED_ERROR);const m=Mb({command:n,sdkVersion:dl==="4.23.2"?"0.0.1":dl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new Pe(X.WS_DISCONNECT);const _=()=>new ct((A,k)=>{this.websocket.once(qt.CLOSED,()=>k(new Pe(X.WS_ABORT))),this.websocket.once(qt.CONNECTED,A)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new ct((A,k)=>{const W=()=>{k(new Pe(X.WS_ABORT))};this.websocket.once(qt.RECONNECTING,W),this.websocket.once(qt.CLOSED,W),this.once("@".concat(h,"-").concat(this.spec.sid),U=>{A(U)})});c&&bt.workerEvent(this.spec.sid,Mb(Mb({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await y}catch(A){if(this.websocket.state==="closed")throw A;return await _(),await this.request(n,i,o)}return c&&bt.workerEvent(this.spec.sid,Mb(Mb({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n=dl==="4.23.2"?"0.0.1":dl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case Si.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void D.warning("live stream response already exists stream");case Si.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Si.LIVE_STREAM_RESPONSE_BAD_STREAM:case Si.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Pe(X.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case Si.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(n.serverResponse.command==="UnpublishStream")return;throw new Pe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Si.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Pe(X.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case Si.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new Pe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Sm.WARNING,i,n.serverResponse.url)}case Si.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new Pe(X.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Sm.WARNING,i,n.serverResponse.url)}case Si.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Pe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Si.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Pe(X.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case Si.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new Pe(X.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Sm.WARNING,i,n.serverResponse.url)}case Si.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Pe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case Si.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Pe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Si.LIVE_STREAM_RESPONSE_WORKER_LOST:case Si.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(n.serverResponse.command==="UnpublishStream")return;throw new Pe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Si.ERROR_FAIL_SEND_MESSAGE:if(n.serverResponse.command==="UnpublishStream")return;if(n.serverResponse.command==="UpdateTranscoding"||n.serverResponse.command==="ControlStream")return new Pe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new Pe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Si.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Pe(X.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(gA)},6e3)}}function d7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Ea(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?d7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class rge extends Ir{constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mi;super(),$(this,"onLiveStreamWarning",void 0),$(this,"onLiveStreamError",void 0),$(this,"spec",void 0),$(this,"retryTimeout",1e4),$(this,"connection",void 0),$(this,"httpRetryConfig",void 0),$(this,"wsRetryConfig",void 0),$(this,"streamingTasks",new Map),$(this,"isStartingStreamingTask",!1),$(this,"taskMutex",new Ts("live-streaming")),$(this,"cancelToken",Bo.CancelToken.source()),$(this,"transcodingConfig",void 0),$(this,"uapResponse",void 0),$(this,"lastTaskId",1),$(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(n){const i=Ea(Ea({},zpe),n);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(D.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>Ea(Ea(Ea({},Wpe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Nr(h.width)||tr(h.width,"config.width",0,1e4),Nr(h.height)||tr(h.height,"config.height",0,1e4),Nr(h.videoBitrate)||tr(h.videoBitrate,"config.videoBitrate",1,1e6),Nr(h.videoFrameRate)||tr(h.videoFrameRate,"config.videoFrameRate"),Nr(h.lowLatency)||Up(h.lowLatency,"config.lowLatency"),Nr(h.audioSampleRate)||bi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Nr(h.audioBitrate)||tr(h.audioBitrate,"config.audioBitrate",1,128),Nr(h.audioChannels)||bi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Nr(h.videoGop)||tr(h.videoGop,"config.videoGop"),Nr(h.videoCodecProfile)||bi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Nr(h.userCount)||tr(h.userCount,"config.userCount",0,17),Nr(h.backgroundColor)||tr(h.backgroundColor,"config.backgroundColor",0,16777215),Nr(h.userConfigExtraInfo)||Xi(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Nr(h.transcodingUsers)&&(Vp(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{jA(m.uid),Nr(m.x)||tr(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Nr(m.y)||tr(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Nr(m.width)||tr(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Nr(m.height)||tr(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Nr(m.zOrder)||tr(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Nr(m.alpha)||tr(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Nr(h.watermark)||XL(h.watermark,"watermark"),Nr(h.backgroundImage)||XL(h.backgroundImage,"backgroundImage"),h.images&&!Nr(h.images)&&(Vp(h.images,"config.images"),h.images.forEach((m,_)=>{XL(m,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>Ea(Ea(Ea({},YL),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(Ea(Ea(Ea({},YL),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(Ea(Ea(Ea({},YL),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>Ea({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?ct.resolve(h.uid):DG(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ct.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Sc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});D.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{D.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{D.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{D.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(n,i,o){if(!this.transcodingConfig&&i===Bp.TRANSCODE)throw new Pe(X.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:n,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};D.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(n)&&!o)return u(),new Pe(X.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case Bp.TRANSCODE:c.transcodingConfig=Ea({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new ct((y,S)=>{Ji(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(n);return R?(this.statusError.delete(n),S(R)):void 0})}),_=await ct.race([this.connection.request("request",{clientRequest:c},!0,{url:n,command:"PublishStream",workerType:i===Bp.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,D.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(n,{clientRequest:c,mode:i,url:n,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(n,i,m)):await this.startLiveStreamingTask(n,i,m)}}stopLiveStreamingTask(n){return new ct((i,o)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new Pe(X.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:u===Bp.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var n;const i=Array.from(Sc(n=this.streamingTasks).call(n));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Bo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(n){if(this.connection)throw new Pe(X.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await fs(this,JL.REQUEST_WORKER_MANAGER_LIST,n);return this.uapResponse=i,this.connection=new nge(i.workerToken,this.spec,this.wsRetryConfig,n),this.connection.on(Sm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Sm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Sm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Pe(X.UNEXPECTED_ERROR,"can not get new live streaming address list"));fs(this,JL.REQUEST_WORKER_MANAGER_LIST,n).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(n){const i=n.serverStatus&&n.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=n.reason;switch(n.code){case Si.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Pe(X.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(o)return D.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case Si.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Pe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case Si.LIVE_STREAM_RESPONSE_WORKER_LOST:case Si.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Sc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(D.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Pe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{D.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{D.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(n){return this.streamingTasks.has(n)}}const ige={name:"LiveStreaming",create:function(e){return new rge(e.joinInfo,e.websocketRetryConfig||mi,e.httpRetryConfig||mi)}};function sge(e){let n=f7();return function(i,o){let c=i.appId;c!==void 0&&(qn(o,10),Eh(o,c));let u=i.cid;u!==void 0&&(qn(o,16),qn(o,u));let h=i.cname;h!==void 0&&(qn(o,26),Eh(o,h));let m=i.deviceId;m!==void 0&&(qn(o,34),Eh(o,m));let _=i.elapse;_!==void 0&&(qn(o,40),xm(o,_));let y=i.fileSize;y!==void 0&&(qn(o,48),xm(o,qv(y)));let S=i.height;S!==void 0&&(qn(o,56),xm(o,qv(S)));let R=i.jpg;R!==void 0&&(qn(o,66),qn(o,R.length),function(Ko,Fe){let rt=Yv(Ko,Fe.length);Ko.bytes.set(Fe,rt)}(o,R));let A=i.networkType;A!==void 0&&(qn(o,72),xm(o,qv(A)));let k=i.osType;k!==void 0&&(qn(o,80),xm(o,qv(k)));let W=i.requestId;W!==void 0&&(qn(o,90),Eh(o,W));let U=i.sdkVersion;U!==void 0&&(qn(o,98),Eh(o,U));let V=i.sequence;V!==void 0&&(qn(o,104),xm(o,qv(V)));let q=i.sid;q!==void 0&&(qn(o,114),Eh(o,q));let Y=i.timestamp;Y!==void 0&&(qn(o,120),xm(o,Y));let ce=i.uid;ce!==void 0&&(qn(o,128),qn(o,ce));let _e=i.vid;_e!==void 0&&(qn(o,136),qn(o,_e));let ye=i.width;ye!==void 0&&(qn(o,144),xm(o,qv(ye)));let fe=i.service;fe!==void 0&&(qn(o,152),qn(o,fe));let ke=i.callbackData;ke!==void 0&&(qn(o,162),Eh(o,ke));let qe=i.jpgEncryption;qe!==void 0&&(qn(o,168),qn(o,qe));let lt=i.requestType;lt!==void 0&&(qn(o,176),qn(o,lt));let ht=i.scorePorn;ht!==void 0&&(qn(o,185),Zx(o,ht));let yn=i.scoreSexy;yn!==void 0&&(qn(o,193),Zx(o,yn));let vn=i.scoreNeutral;vn!==void 0&&(qn(o,201),Zx(o,vn));let cr=i.scene;cr!==void 0&&(qn(o,208),qn(o,cr));let Qr=i.ossFilePrefix;Qr!==void 0&&(qn(o,218),Eh(o,Qr));let Br=i.serviceVendor;if(Br!==void 0)for(let Ko of Br){qn(o,226);let Fe=f7();cge(Ko,Fe),qn(o,Fe.limit),hge(o,Fe),dge(Fe)}}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function oge(e){return function(i){let o={};e:for(;!m7(i);){let c=yh(i);switch(c>>>3){case 0:break e;case 1:o.code=yh(i);break;case 2:o.msg=g7(i,yh(i));break;case 3:{let u=lge(i);o.data=age(i),i.limit=u;break}default:h7(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function age(e){let n={};e:for(;!m7(e);){let i=yh(e);switch(i>>>3){case 0:break e;case 1:n.requestId=g7(e,yh(e));break;case 2:n.requestType=yh(e)>>>0;break;case 3:n.scorePorn=Qx(e);break;case 4:n.scoreSexy=Qx(e);break;case 5:n.scoreNeutral=Qx(e);break;case 6:n.requestScene=yh(e)>>>0;break;case 7:n.scene=yh(e)>>>0;break;default:h7(e,7&i)}}return n}function cge(e,n){let i=e.service;i!==void 0&&(qn(n,8),qn(n,i));let o=e.vendor;o!==void 0&&(qn(n,16),qn(n,o));let c=e.token;c!==void 0&&(qn(n,26),Eh(n,c));let u=e.callbackUrl;u!==void 0&&(qn(n,34),Eh(n,u))}function lge(e){let n=yh(e),i=e.limit;return e.limit=e.offset+n,i}function h7(e,n){switch(n){case 0:for(;128&_7(e););break;case 2:Xx(e,yh(e));break;case 5:Xx(e,4);break;case 1:Xx(e,8);break;default:throw new Error("Unimplemented type: "+n)}}let uge=new Float32Array(1);new Uint8Array(uge.buffer);let Yx=new Float64Array(1),ya=new Uint8Array(Yx.buffer);function qv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let p7=[];function f7(){const e=p7.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function dge(e){p7.push(e)}function Xx(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function m7(e){return e.offset>=e.limit}function Yv(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function Jx(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function g7(e,n){let i=Jx(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<n;m++){let _,y,S,R,A=c[m+i];(128&A)==0?h+=o(A):(224&A)==192?m+1>=n?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&A)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&A)==224?m+2>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&A)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&A)==240?m+3>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&A)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Eh(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}qn(e,o);let c=Yv(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function hge(e,n){let i=Yv(e,n.limit),o=e.bytes,c=n.bytes;for(let u=0,h=n.limit;u<h;u++)o[u+i]=c[u]}function _7(e){return e.bytes[Jx(e,1)]}function E7(e,n){let i=Yv(e,1);e.bytes[i]=n}function Qx(e){let n=Jx(e,8),i=e.bytes;return ya[0]=i[n++],ya[1]=i[n++],ya[2]=i[n++],ya[3]=i[n++],ya[4]=i[n++],ya[5]=i[n++],ya[6]=i[n++],ya[7]=i[n++],Yx[0]}function Zx(e,n){let i=Yv(e,8),o=e.bytes;Yx[0]=n,o[i++]=ya[0],o[i++]=ya[1],o[i++]=ya[2],o[i++]=ya[3],o[i++]=ya[4],o[i++]=ya[5],o[i++]=ya[6],o[i++]=ya[7]}function yh(e){let n,i=0,o=0;do n=_7(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function qn(e,n){for(n>>>=0;n>=128;)E7(e,127&n|128),n>>>=7;E7(e,n)}function xm(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=Yv(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function y7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const pge=new Map([["moderation",1],["supervise",2]]);class fge extends Ir{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(zi.CONNECTION_STATE_CHANGE,i,n)}get inspectType(){return this._inspectType}set inspectType(n){var i;this._inspectMode=Fa(i=n.map(o=>pge.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),$(this,"name","AgoraRTCVideoContentInspect"),$(this,"_connectionState",su.CONNECTING),$(this,"_innerConnectionState",void 0),$(this,"sequence",0),$(this,"inspectStartTime",void 0),$(this,"workerManagerConnection",void 0),$(this,"workerConnection",void 0),$(this,"workerMessageLengthLimit",void 0),$(this,"inspectIntervalMinimum",void 0),$(this,"qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Bo.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"wmSequence",0),$(this,"inspectInterval",void 0),$(this,"inspectTimer",null),$(this,"ossFilePrefix",void 0),$(this,"extraInfo",void 0),$(this,"_inspectType",void 0),$(this,"_inspectMode",void 0),$(this,"_quality",1),$(this,"qualityTimer",null),$(this,"_inspectId",void 0),$(this,"_needWorkUrlOnly",!1),$(this,"inspectImage",()=>{if(this.connectionState!==su.CONNECTED)throw new Pe(X.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===su.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=or(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new ab("worker-manager-"+this._inspectId,mi),this.on(zi.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,D.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ou[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new ab("worker-"+this._inspectId,mi),this.handleWorkerEvents()}async init(n,i){this.emit(zi.STATE_CHANGE,ou.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new ct((c,u)=>{this.on(zi.CONNECTION_STATE_CHANGE,(h,m)=>{m===su.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(n,i,o){const c=re("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,y,S){let{appId:R,areaCode:A,cname:k,sid:W,token:U,uid:V}=_;Vv++;const q="image_moderation_api",Y={service_name:q,json_body:JSON.stringify({appId:R,areaCode:A,cname:k,command:"allocateEdge",requestId:Vv,seq:Vv,sid:W,token:U,ts:Date.now(),uid:V+""})};let ce,_e,ye=m[0];return rd(async()=>{ce=Date.now();const fe=await cd(ye,{data:Y,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ce,fe.code!==0){const ht=new Pe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code"+fe.code,{retry:!0,responseTime:_e});throw D.error(ht.toString()),ht}const ke=JSON.parse(fe.json_body);if(ke.code!==200){const ht=new Pe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ke.code,", reason: ").concat(ke.reason),{code:ke.code,responseTime:_e});throw D.error(ht.toString()),ht}if(!ke.servers||!Array.isArray(ke.servers)||ke.servers.length===0){const ht=new Pe(X.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ke.code,responseTime:_e});throw D.error(ht.toString()),ht}const qe=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),lt=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ke.servers.map(ht=>{let{address:yn,wss:vn}=ht;if(yn&&vn)return"wss://".concat(yn.replace(/\./g,"-"),".").concat(qe,":").concat(lt||vn)}).filter(ht=>!!ht),workerToken:ke.workerToken,vid:ke.vid,responseTime:_e}},(fe,ke)=>(bt.apworkerEvent(W,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(fe.addressList),firstSuccess:ke===0,responseTime:_e,serverIp:m[ke%m.length]}),!1),(fe,ke)=>(bt.apworkerEvent(W,{success:!1,sc:fe.data&&fe.data.code||200,serviceName:q,responseTime:_e,serverIp:m[ke%m.length]}),!!(fe.code!==X.OPERATION_ABORTED&&fe.code!==X.UNEXPECTED_RESPONSE||fe.data&&fe.data.retry)&&(ye=m[(ke+1)%m.length],!0)),S)}(c,n,i,o);this.emit(zi.STATE_CHANGE,ou.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(zi.STATE_CHANGE,ou.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(n,1e4)}async connectWorker(n){await this.workerConnection.init([n])}handleWorkerManagerEvents(){this.workerManagerConnection.on(qt.CONNECTED,async()=>{this.emit(zi.STATE_CHANGE,ou.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(qt.CLOSED,()=>{this._innerConnectionState<ou.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(qt.FAILED,()=>{this._innerConnectionState<ou.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(qt.RECONNECTING,()=>{this._innerConnectionState<ou.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(qt.ON_MESSAGE,async n=>{this.emit(zi.STATE_CHANGE,ou.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(n.data);if(o.code!==200)throw D.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Pe(X.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw D.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Pe(X.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=re("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(zi.STATE_CHANGE,ou.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(zi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(qt.WILL_RECONNECT,(n,i,o)=>{o(n)}),this.workerManagerConnection.on(qt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}handleWorkerEvents(){this.workerConnection.on(qt.CONNECTED,async()=>{this.emit(zi.STATE_CHANGE,ou.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=su.CONNECTED}),this.workerConnection.on(qt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const o=oge(new Uint8Array(n.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&D.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(zi.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Fa(i=Object.keys(c)).call(i,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(zi.INSPECT_RESULT,h)}else this.emit(zi.INSPECT_RESULT,void 0,new Pe(X.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(zi.INSPECT_RESULT,void 0,new Pe(X.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else D.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(zi.INSPECT_RESULT,void 0,new Pe(X.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(qt.CLOSED,()=>{this.connectionState=su.CLOSED}),this.workerConnection.on(qt.FAILED,()=>{this.connectionState=su.CLOSED}),this.workerConnection.on(qt.RECONNECTING,()=>{this.connectionState=this.connectionState===su.CONNECTED?su.RECONNECTING:su.CONNECTING}),this.workerConnection.on(qt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this.workerConnection.on(qt.REQUEST_NEW_URLS,(n,i)=>{this.workerManagerConnection.close(),this.once(zi.REQUEST_NEW_WORKER_URL,o=>{n([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const n=bc(this,zi.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void this.emit(zi.INSPECT_RESULT,void 0,new Pe(X.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(n,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(zi.INSPECT_RESULT,void 0,new Pe(X.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await n.getCurrentFrameImage("image/jpeg",this.quality),R=await eW(S,o,c),A=this.sequence+"-"+u+"-"+_+"-"+y+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:(W=Number(y-this.inspectStartTime),{low:W|=0,high:W>>31,unsigned:W>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:A,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:I9(y),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var W;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const U=sge(k);if(U.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const V=function(q){for(var Y=1;Y<arguments.length;Y++){var ce=arguments[Y]!=null?arguments[Y]:{};Y%2?y7(Object(ce),!0).forEach(function(_e){$(q,_e,ce[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(ce)):y7(Object(ce)).forEach(function(_e){Object.defineProperty(q,_e,Object.getOwnPropertyDescriptor(ce,_e))})}return q}({},k);delete V.jpg,D.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(V))}return U}{const V=this.quality*this.qualityRatio;return this.quality=V,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Bo.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=su.CLOSED,this.emit(zi.STATE_CHANGE,ou.CLOSED)}}const mge={name:"ContentInspect",create:function(e){let{config:n}=e;return function(i){if(!i)throw new Pe(X.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new Pe(X.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!st(u=["supervise","moderation"]).call(u,c))throw new Pe(X.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new Pe(X.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(n),new fge(n)}};var v7=l(Et.Object.getOwnPropertySymbols),gge=Mn,_ge=xo.indexOf,Ege=up,eM=ae([].indexOf),S7=!!eM&&1/eM([1],1,-0)<0;gge({target:"Array",proto:!0,forced:S7||!Ege("indexOf")},{indexOf:function(e){var n=arguments.length>1?arguments[1]:void 0;return S7?eM(this,e,n)||0:_ge(this,e,n)}});var yge=Va("Array").indexOf,vge=N,Sge=yge,tM=Array.prototype,Tge=function(e){var n=e.indexOf;return e===tM||vge(tM,e)&&n===tM.indexOf?Sge:n},T7=l(Tge);function bge(e,n){if(e==null)return{};var i,o,c=function(h,m){if(h==null)return{};var _,y,S={},R=Wz(h);for(y=0;y<R.length;y++)_=R[y],T7(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,n);if(v7){var u=v7(e);for(o=0;o<u.length;o++)i=u[o],T7(n).call(n,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let b7=class{get localCapabilities(){return Lr(this._localCapabilities)}get rtpCapabilities(){return Lr(this._rtpCapabilities)}get candidates(){return Lr(this._candidates)}get iceParameters(){return Lr(this._iceParameters)}get dtlsParameters(){return Lr(this._dtlsParameters)}constructor(e){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname","o/i14u9pJrxRKAsu"),$(this,"firefoxSsrcMidMap",new Map),e=Lr(e);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:y}=e;let S;this.setup=m,S=h===Eo.RECEIVE_ONLY?ga(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ga(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=u;const R=h===Eo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,A=h===Eo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===Eo.RECEIVE_ONLY?c.send.videoCodecs:ub(ft.VIDEO,R,A,_),W=h===Eo.RECEIVE_ONLY?c.send.audioCodecs:ub(ft.AUDIO,R,A,y);for(const U of S.mediaDescriptions)U.attributes.iceUfrag=n.iceUfrag,U.attributes.icePwd=n.icePwd,U.attributes.fingerprints=i.fingerprints,U.attributes.candidates=o,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=k.map(V=>V.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=R.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=W.map(V=>V.payloadType.toString(10)),U.attributes.payloads=W,U.attributes.extmaps=R.audioExtensions,Uv(U));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return vm(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(n=>this.hasMid(n)):this.sessionDesc.mediaDescriptions.some(n=>n.attributes.mid===e)}send(e,n,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=P_(n,this.cname,re("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(kr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let y;return _===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(y=Lr(this.sessionDesc.mediaDescriptions[_]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(y,c)),kr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,n,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",n,i),this.updateBundleMids()):(m=Lr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:n,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),y={foundation:n??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===y.priority&&S.connectionAddress===y.connectionAddress&&S.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,n,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=ub(u,h,this.localCapabilities.send,u===ft.AUDIO?c:o),_=u===ft.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const A=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[A]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,n,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(kr()){if(c){const u=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="recvonly"||n.attributes.direction==="sendrecv");return n.attributes.mid!=="0"&&n.attributes.mid!=="1"&&i})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}restartICE(e){e=Lr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,n,i,o,c,u){const h=this.rtpCapabilities.send,m=e===ft.VIDEO?h.videoCodecs:h.audioCodecs,_=e===ft.VIDEO?h.videoExtensions:h.audioExtensions;kr()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,n,i){const o=Lr(e);return nx(o),Mv(o,n),rx(o,n),pG(o),KA(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,n){const i=Lr(e);return KA(i,n,this.localCapabilities.recv),Uv(i),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var i;return((i=n.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>kr()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}};const wge=["sdp"];var dr;function w7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Mm(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?w7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let R7=(dr=class cS extends qz{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[]}set isInRestartIce(n){this._isInRestartIce=n}get isInRestartIce(){return this._isInRestartIce}constructor(n,i,o){super(n,i),$(this,"direction",void 0),$(this,"name",void 0),$(this,"store",void 0),$(this,"spec",void 0),$(this,"peerConnection",void 0),$(this,"initialOffer",void 0),$(this,"transport",void 0),$(this,"statsFilter",void 0),$(this,"localCandidateCount",0),$(this,"_isInRestartIce",!1),$(this,"mutex",void 0),$(this,"onLocalCandidate",void 0),$(this,"remoteSDP",void 0),$(this,"pendingCandidates",[]),$(this,"localCapabilities",void 0),$(this,"isReady",!1),$(this,"restartCnt",0),$(this,"curTurnServerIndex",0),this.store=i,this.spec=n,this.mutex=new Ts("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(cS.resolvePCConfiguration(n,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Eo.SEND_ONLY,this.name=this.direction===Eo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=gL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(n){try{const i=await mG();if(this.localCapabilities=qA(i),n){const{sdp:o}=n,c=bge(n,wge),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=lb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(au(R,S,"videoExtensions",A,k,W),au(R,S,"videoCodecs",A,k,W),au(R,S,"audioExtensions",A,k,W),au(R,S,"audioCodecs",A,k,W),re("RAISE_H264_BASELINE_PRIORITY")){const U=W.videoCodecs.findIndex(V=>V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&V.fmtp&&V.fmtp.parameters["profile-level-id"]==="42001f");if(U!==-1){const V=W.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(V<U){D.debug("raising H264 baseline profile priority");const q=W.videoCodecs[U];W.videoCodecs.splice(U,1),W.videoCodecs.splice(V,0,q)}V!==-1&&re("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:A,recv:k,sendrecv:W}}({},{},o);this.remoteSDP=new b7({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Rm(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await gG({},{},h.sdp);this.localCapabilities=qA(_);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),Mm(Mm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Rm(o.sdp);return this.initialOffer=o,Mm(Mm({},c),{},{sdp:o.sdp})}}catch(i){throw new De(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=n,u=await gG({},{},i);this.remoteSDP=new b7({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(n){try{n&&this.pendingCandidates.push(n),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new De(X.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return ul(function*(){const u=yield Rn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(n,i,o);n.forEach((V,q)=>{if(m[q].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(V._mediaStreamTrack,{direction:"sendonly"});h.push(Y),V._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(ce=>ce.mid===m[q].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(Y),V._updateRtpTransceiver(Y)}}),kr()&&re("SIMULCAST")===!0&&(yield Rn(c.applySimulcastForFirefox(h,n)));const _=m.map(V=>V.mid),y=yield Rn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(y.sdp,n,_),R=ga(S),A=_.map(V=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return uG(q,re("USE_PUB_RTX"))}),k=h.map((V,q)=>{const Y=_[q];return{localSSRC:A[q],id:Y}});yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield k}catch(V){const q=c.remoteSDP.toString();throw yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Rn(c.stopSending(_,!0)),V}yield Rn(c.applySimulcastEncodings(h,n)),yield Rn(c.applySendEncodings(h,n));const W=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return U==null||U(W),yield Rn(c.setRemoteDescription({type:"answer",sdp:W})),h.map((V,q)=>{const Y=_[q];return{localSSRC:A[q],id:Y}})}catch(h){throw h instanceof De?h:new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var y;_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const _=this.remoteSDP.toString(),y=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,n);y==null||y(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(y.sdp,u,n);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."))}catch(u){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(n){try{if(this.store.p2pTransport===S_.Auto&&(this.store.p2pTransport=S_.SdRtn,Nn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(cS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Nn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(cS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!n){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Rm(i.sdp);return this.store.descriptionStart(),this.direction===Eo.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(n),this.store.descriptionStart(),this.direction===Eo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Rm(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var n;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new De(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?kr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Mm(Mm({},sh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Mm(Mm({},sh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n,i;st(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=n=>{if(n.candidate){var i;n.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,n.candidate.toJSON())),this.localCandidateCount+=1}else D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return n.iceServers?c.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(XT(n.turnServer.servers)?c.iceServers=n.turnServer.servers:(c.iceServers&&c.iceServers.push(...cS.turnServerConfigToIceServers(n.turnServer.servers,i,o)),re("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&n.turnServer.serversFromGateway&&c.iceServers.push(...cS.turnServerConfigToIceServers(n.turnServer.serversFromGateway,i,o)),st(u=[S_.Relay,S_.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&Nn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),D.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=n.filter(m=>m.tcpport);D.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case S_.SdRtn:const m=n.filter(y=>{var S;return st(S=y.username).call(S,"glb:")&&y.turnServerURL==y.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(bm(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(bm(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case S_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(bm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(bm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(n){if(n){this.transport=n,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===n._mediaStreamTrack)),!i)return D.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Nn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(n._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:A}=n._encoderConfig;S&&(u.maxBitrate=1e3*S),st(h=n._hints).call(h,ar.LOW_STREAM)&&(R&&(u.maxFramerate=Ka(R)),A&&A>=1&&(u.scaleResolutionDownBy=A))}if(re("DSCP_TYPE")&&Mp()){var m;const S=re("DSCP_TYPE");st(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=i.getParameters(),y=(o=_.encodings)===null||o===void 0?void 0:o[0];kr()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(_,c),D.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(n,i){try{if(!Nn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof fr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=ga(n);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(Mv(_,u),fG(_,u,this.store.codec))}),vm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,m;const y=n[_],S=i[_];if(S instanceof fr&&!st(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},A={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(n,i){if(!kr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof fr&&this.isVP8Simulcast(c)){const u=n[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof fr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=n._hints).call(i,ar.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(n,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=ga(i).mediaDescriptions.find(m=>m.attributes.mid===n))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(n){var i;await this.peerConnection.setRemoteDescription(n),st(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(n,i,o){const c=ga(n),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===ft.AUDIO&&u.media.mediaType==="audio"&&Uv(u),vm(c)}},_t(dr.prototype,"establish",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"establish"),dr.prototype),_t(dr.prototype,"connect",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"connect"),dr.prototype),_t(dr.prototype,"receive",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"receive"),dr.prototype),_t(dr.prototype,"mockReceive",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"mockReceive"),dr.prototype),_t(dr.prototype,"stopReceiving",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"stopReceiving"),dr.prototype),_t(dr.prototype,"restartICE",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"restartICE"),dr.prototype),_t(dr.prototype,"close",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"close"),dr.prototype),_t(dr.prototype,"updateEncoderConfig",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"updateEncoderConfig"),dr.prototype),_t(dr.prototype,"updateSendParameters",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"updateSendParameters"),dr.prototype),_t(dr.prototype,"replaceTrack",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"replaceTrack"),dr.prototype),_t(dr.prototype,"muteLocal",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"muteLocal"),dr.prototype),_t(dr.prototype,"unmuteLocal",[hu],Object.getOwnPropertyDescriptor(dr.prototype,"unmuteLocal"),dr.prototype),dr);function hu(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}let ud=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var C7,I7,A7,P7,O7,k7,N7,D7,L7,x7,M7,wr;function U7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function OP(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?U7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):U7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Rge=(C7=dd(ud.SEND_ONLY),I7=dd(ud.SEND_ONLY),A7=dd(),P7=dd(ud.RECEIVE_ONLY),O7=dd(ud.RECEIVE_ONLY),k7=dd(ud.RECEIVE_ONLY),N7=dd(ud.RECEIVE_ONLY),D7=dd(ud.RECEIVE_ONLY),L7=dd(ud.RECEIVE_ONLY),x7=dd(),M7=dd(ud.RECEIVE_ONLY),wr=class extends Ir{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(Ot.StateChange,n,this._state)}constructor(e,n){super(),$(this,"isPlanB",!1),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"sendConnection",void 0),$(this,"recvConnection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"statsCollector",void 0),$(this,"dtlsFailedCount",0),$(this,"sendMutex",void 0),$(this,"recvMutex",void 0),$(this,"_state",zn.Disconnected),$(this,"_restartStates",["disconnected","failed"]),$(this,"reconnectInterval",void 0),$(this,"uploadUnplinkStarted",!1),$(this,"uploadDownlinkStarted",!1),$(this,"uplinkStateUploadInterval",void 0),$(this,"downlinkStatsUploadInterval",void 0),$(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==zn.Connected)return void c(new De(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const y=_.find(k=>k[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(k=>{let[,{id:W}]=k;return W}));let S=!1;var h,m;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get(He.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(He.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(_);await sr(this,Ot.RequestMuteLocal,R);const A=i.trackMediaType==="video"?Tm.MUTE_LOCAL_VIDEO:Tm.MUTE_LOCAL_AUDIO;await sr(this,Ot.RequestP2PMuteLocal,{action:A,message:R,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==zn.Connected)return void c(new De(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const m=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?Tm.UNMUTE_LOCAL_VIDEO:Tm.UNMUTE_LOCAL_AUDIO;await sr(this,Ot.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(He.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==zn.Connected)return void o();const{id:y,track:S}=_;y&&(await this.sendConnection.updateSendParameters(y,S),await this.sendConnection.updateEncoderConfig(y,S),this.emit(Ot.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(He.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==zn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==zn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),y[0]===He.LocalVideoTrack&&Nn().supportDualStreamEncoding){const S=this.localTrackMap.get(He.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ct((A,k)=>{this.handleReplaceTrack(S.track,A,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new t9(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ts("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ts("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,n){throw new De(X.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new De(X.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,n){let i;try{if(n){this.recvConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new R7(e,this.store,Eo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(n);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=zn.New,this.sendConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new R7(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new De(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=zn.Connected}async addRemoteCandidate(e,n){if(n===Eo.RECEIVE_ONLY){if(!this.sendConnection)throw new De(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new De(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,n,i){var o=this;return ul(function*(){const c=yield Rn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==zn.Connected){o.throwIfTrackTypeNotMatch(e);const y=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(y))}o.store.pubId=o.store.pubId+1,Rs.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,n,i);if(u.length===0)return void(yield Rn(o.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:S,type:R}=y;const A=Date.now();o.store.publish(S.getTrackId(),R===He.LocalAudioTrack?"audio":"video",A)}),o.bindLocalTrackEvents(u);const h=yield Rn(o.sendConnection.send(u.map(y=>{let{track:S}=y;return S}),o.store.codec,o.store.audioCodec)),m=(yield Rn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(y){throw h.throw(y),(y==null?void 0:y.code)===X.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),y}yield Rn(h.next()),u.forEach(y=>{let{type:S}=y;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(y=>{let{track:S,type:R}=y;const A=Date.now();o.store.publish(S.getTrackId(),R===He.LocalAudioTrack?"audio":"video",void 0,A)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==zn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!st(e).call(e,c)));const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(n);if(await this.sendConnection.stopSending(n.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),n.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===zn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const n=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:gfe(u,c),ssrcs:h};u._muted||!u._enabled?n.push(m):i.push(m)}),n.length>0&&n.forEach(o=>{sr(this,Ot.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{sr(this,Ot.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ul(function*(){throw new De(X.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await fs(this,Ot.RequestRePublish,this.pendingLocalTracks),this.emit(Ot.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new De(X.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,n,i,o){var c;if(!this.recvConnection)throw new De(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(n))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(n,[{ssrcId:i}],String(e.uid),o);n===ft.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Av(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Iv(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(n,h):this.remoteUserMap.set(e,new Map([[n,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:A}=S;return R.uid===e.uid&&n===A});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(Ot.MediaReconnectEnd,e.uid))}async mockSubscribe(e,n,i,o){if(!this.recvConnection)throw new De(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(n,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return n!==void 0?h.uid===e.uid&&n===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var m;if(h===ft.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===ft.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,n);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,y;if(m===ft.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===ft.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===ft.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;sr(this,Ot.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(n=>{let[,i]=n;[ft.VIDEO,ft.AUDIO].forEach(o=>{i.has(o)?sr(this,Ot.RequestP2PUnmuteRemote,o):sr(this,Ot.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new De(X.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new De(X.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new De(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new De(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===ft.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}getAllTracks(e){const n=this.localTrackMap.get(He.LocalAudioTrack);if((n==null?void 0:n.track)instanceof vi){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==He.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===He.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===He.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get(He.LocalAudioTrack),m=o?this.localTrackMap.get(He.LocalVideoLowTrack):this.localTrackMap.get(He.LocalVideoTrack);bt.publish(this.store.sessionId,{eventElapse:Rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof jr),m=o?(u=this.localTrackMap.get(He.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof fr);bt.publish(this.store.sessionId,{eventElapse:Rs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===ft.VIDEO?i._videoSSRC:i._audioSSRC;c&&bt.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===ft.VIDEO,audio:o===ft.AUDIO,peerid:i.uid,subscribeRequestid:o===ft.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Rs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ts("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ts("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(He.LocalAudioTrack);if((e==null?void 0:e.track)instanceof vi){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=zn.Disconnected}getStats(e){var n,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(n=this.sendConnection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.recvConnection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(He.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(He.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof fr||n&&n.track instanceof jr?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(Rc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(He.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=LT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=zn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case He.LocalVideoTrack:st(n=o._hints).call(n,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case He.LocalAudioTrack:o instanceof vi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case He.LocalVideoLowTrack:}}),this.emit(Ot.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(Rc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(Ot.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Im?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}async restartICE(e,n){let i,o;if(e===Eo.SEND_ONLY){if(!this.sendConnection)throw new De(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new De(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(n){const c=await o.restartICE(n);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await fs(this,Ot.RequestP2PRestartICE,{direction:Eo.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),n=this.localTrackMap.get(He.LocalVideoTrack),i=this.localTrackMap.get(He.LocalAudioTrack),o=e.videoSend.find(k=>{var W;return k.ssrc===(n==null||(W=n.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)}),c=e.audioSend.find(k=>{var W;return k.ssrc===(i==null||(W=i.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)});if(!o||!c)return 1;const u=bc(this,Ot.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,A=n==null?void 0:n.track;if(A&&A._encoderConfig&&A._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=A._encoderConfig.bitrateMax,W=e.bitrate.actualEncoded;if(k&&W){const U=(1e3*k-W)/(1e3*k);return Fz[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(W=>W.ssrc===c),m=e.videoRecv.find(W=>W.ssrc===u);if(!h&&!m)return void(n+=1);const _=bc(this,Ot.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,A=e.recvPacketLossRate;let k=.7*A*100/50+.3*S/1500;R&&(k=.6*A*100/50+.2*S/1500+.2*R/400),n+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new ct((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}filterTobePublishedTracks(e,n,i){const o=[],c=Nn(),u=this.getAllTracks();e=fv(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof fr&&(this.localTrackMap.has(He.LocalVideoTrack)||h?new De(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:He.LocalVideoTrack}),h=!0),n)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:He.LocalVideoLowTrack})}if(_ instanceof jr){const y=this.localTrackMap.get(He.LocalAudioTrack);if(y){if(!(y.track instanceof vi))throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(R=>{let{type:A}=R;return A===He.LocalAudioTrack});if(!(S.track instanceof vi))throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof vi||_._bypassWebAudio)o.push({track:_,type:He.LocalAudioTrack});else{const S=new vi;S.addAudioTrack(_),o.push({track:S,type:He.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=fv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof jr){const c=this.localTrackMap.get(He.LocalAudioTrack);if(!c)continue;c.track instanceof vi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([He.LocalAudioTrack,c]),c.track.close())):n.push([He.LocalAudioTrack,c])}if(o instanceof fr){const c=this.localTrackMap.get(He.LocalVideoTrack);if(!c)continue;n.push([He.LocalVideoTrack,c]);const u=this.localTrackMap.get(He.LocalVideoLowTrack);u&&n.push([He.LocalVideoLowTrack,u])}}return n}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case He.LocalVideoTrack:i.addListener(gt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case He.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof vi?e.trackList.forEach(i=>{i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||e.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case He.LocalVideoTrack:i.off(gt.GET_STATS,this.handleGetLocalVideoStats),i.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case He.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof vi?e.trackList.forEach(n=>{n.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(gt.GET_STATS,this.handleGetLocalAudioStats),n.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(gt.GET_STATS,this.handleGetLocalAudioStats),e.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof Iv&&n.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof Av&&n.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(gt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(ft.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(ft.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,{track:h,type:m}=i;switch(m){case He.LocalAudioTrack:u=Gn.Audio;break;case He.LocalVideoTrack:u=st(c=h._hints).call(c,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case He.LocalVideoLowTrack:u=Gn.Low}return{kind:m===He.LocalAudioTrack?ft.AUDIO:ft.VIDEO,stream_type:u,mid:n[o].id,ssrcs:n[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case He.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case He.LocalAudioTrack:o=Gn.Audio;break;case He.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{var i;D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(n,")")),this.emit(Ot.PeerConnectionStateChange,n),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(e.isInRestartIce=!1),st(i=this._restartStates).call(i,n)&&!e.isInRestartIce&&(n==="disconnected"&&await Ji(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),bt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:Dr.TRACER}).onSuccess(),this.emit(Ot.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(Rc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Tv.FIRST_FRAME_DECODED),bt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_DECODE,Tr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Rs.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(Rc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&bt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_RECEIVED,Tr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Rs.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(Rc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&bt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_VIDEO_RECEIVED,Tr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Rs.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(Ot.ConnectionTypeChange,o),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wm(i))," -> ").concat(JSON.stringify(wm(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wm(i))," -> ").concat(JSON.stringify(wm(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.onLocalCandidate=n=>{this.emit(Ot.LocalCandidate,{candidate:n,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const n=e===Eo.SEND_ONLY?this.sendConnection:this.recvConnection;n&&!n.isInRestartIce&&(n.isInRestartIce=!0,D.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(n.name,"] start use restartICE")),e===Eo.SEND_ONLY?this.restartICE(e):fs(this,Ot.RequestP2PRestartICE,{direction:Eo.SEND_ONLY}))}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(He.LocalAudioTrack);if(e instanceof jr&&(i==null?void 0:i.track)instanceof vi)return i.track.isActive||n.push([He.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===He.LocalVideoTrack)){const c=this.localTrackMap.get(He.LocalVideoLowTrack);c&&n.push([He.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(He.LocalAudioTrack);if(e instanceof jr&&(i==null?void 0:i.track)instanceof vi)return i.track.isActive&&n.push([He.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===He.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get(He.LocalVideoLowTrack);c&&n.push([He.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case He.LocalAudioTrack:o=Gn.Audio;break;case He.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case He.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case He.LocalAudioTrack:o=Gn.Audio;break;case He.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case He.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case ft.VIDEO:return void(o._videoSSRC&&n.push({stream_type:ft.VIDEO,ssrcId:o._videoSSRC}));case ft.AUDIO:return void(o._audioSSRC&&n.push({stream_type:ft.AUDIO,ssrcId:o._audioSSRC}))}}),n}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(He.LocalVideoTrack),i=this.localTrackMap.get(He.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new ct((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ct((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,n=this.recvConnection.peerConnectionState;return e!=="connected"&&n!=="connected"}return!0}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof jr){const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await sr(this,Ot.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:n}]=e;return!!n}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.recvConnection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(Ot.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(Ot.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ji(uL(this.dtlsFailedCount,mi)),this.emit(Ot.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(He.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof fr)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof fr).length>1)throw new De(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof jr).length>1&&(e.some(n=>n instanceof jr&&n._bypassWebAudio)||!Nn().webAudioMediaStreamDest))throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof fr&&this.pendingLocalTracks.some(i=>i instanceof fr))throw new De(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof jr&&this.pendingLocalTracks.some(i=>i instanceof jr)&&(!Nn().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof jr&&i._bypassWebAudio)))throw new De(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){const i=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding,o=OP(OP({},{width:160,height:120,framerate:15,bitrate:50}),n);let c;c=i?e._mediaStreamTrack.clone():yx(e,o);const u=or(8,"track-low-"),h=new fr(c,OP(OP({},i&&{scaleResolutionDownBy:tx(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(T_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,vv.LOW_STREAM)}),h._hints.push(ar.LOW_STREAM),e.addListener(gt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(Rc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");bt.firstRemoteVideoDecode(this.store.sessionId,Oi.FIRST_VIDEO_DECODE,Tr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Rs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new De(X.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new De(X.NOT_SUPPORTED)}async subscribeDataChannel(e,n){throw new De(X.NOT_SUPPORTED)}async unsubscribeDataChannel(e,n){throw new De(X.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,n){throw new De(X.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,n){throw new De(X.NOT_SUPPORTED)}async preConnect(e){throw new De(X.NOT_SUPPORTED)}getEstablishParams(){throw new De(X.NOT_SUPPORTED)}async reSubscribe(e){throw new De(X.NOT_SUPPORTED)}async updateVideoStreamParameter(e,n){throw new De(X.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===He.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,vv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},_t(wr.prototype,"p2pConnect",[C7],Object.getOwnPropertyDescriptor(wr.prototype,"p2pConnect"),wr.prototype),_t(wr.prototype,"unpublish",[I7],Object.getOwnPropertyDescriptor(wr.prototype,"unpublish"),wr.prototype),_t(wr.prototype,"unpublishLowStream",[A7],Object.getOwnPropertyDescriptor(wr.prototype,"unpublishLowStream"),wr.prototype),_t(wr.prototype,"subscribe",[P7],Object.getOwnPropertyDescriptor(wr.prototype,"subscribe"),wr.prototype),_t(wr.prototype,"mockSubscribe",[O7],Object.getOwnPropertyDescriptor(wr.prototype,"mockSubscribe"),wr.prototype),_t(wr.prototype,"unsubscribe",[k7],Object.getOwnPropertyDescriptor(wr.prototype,"unsubscribe"),wr.prototype),_t(wr.prototype,"muteRemote",[N7],Object.getOwnPropertyDescriptor(wr.prototype,"muteRemote"),wr.prototype),_t(wr.prototype,"unmuteRemote",[D7],Object.getOwnPropertyDescriptor(wr.prototype,"unmuteRemote"),wr.prototype),_t(wr.prototype,"hasRemoteMediaWithLock",[L7],Object.getOwnPropertyDescriptor(wr.prototype,"hasRemoteMediaWithLock"),wr.prototype),_t(wr.prototype,"disconnectForReconnect",[x7],Object.getOwnPropertyDescriptor(wr.prototype,"disconnectForReconnect"),wr.prototype),_t(wr.prototype,"remoteMediaSsrcChanged",[M7],Object.getOwnPropertyDescriptor(wr.prototype,"remoteMediaSsrcChanged"),wr.prototype),wr);function dd(e){return function(n,i,o){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case ud.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case ud.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),y=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),y()}}}},o}}class z_ extends Ir{constructor(n,i){super(),$(this,"signal",void 0),$(this,"token",void 0),$(this,"tokenTimeout",void 0),$(this,"tokenInterval",void 0),$(this,"_sequence",0),$(this,"userMap",new Map),$(this,"encoder",new TextEncoder),this.signal=n,this.token=i;const o=()=>{this.signal.connectionState===lr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*re("P2P_TOKEN_INTERVAL"))};o()}async send(n,i,o,c,u){var h,m,_;if(this.userMap.size===0)return;const y=Array.from(Sc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(m=c)!==null&&m!==void 0?m:or(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:n,_seq:u,_message:i,token:"".concat(this.token,"_").concat(y)};re("SHOW_P2P_LOG")&&D.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(A=>{this.signal.request(Bt.DATA_STREAM,{payload:ym(this.encoder.encode(A))})});const R=new ct((A,k)=>{const W=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),this.off(Dv.ABORT,V),D.debug("[external-signal] request timeout, type: ".concat(n,", requestId: ").concat(c)),this.userMap.size===0?k(new De(X.INVALID_REMOTE_USER)):k(new De(X.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),U=()=>{W&&window.clearTimeout(W),this.off(Dv.ABORT,V),o&&A()},V=()=>{W&&window.clearTimeout(W),this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),k(new De(X.EXTERNAL_SIGNAL_ABORT,"type: ".concat(n,", requestId: ").concat(c)))};this.once(Dv.ABORT,V),this.once("res-@".concat(c,"_ack"),U);const q=(ce,_e)=>{Y=!0,W&&window.clearTimeout(W),this.off("res-@".concat(c,"_ack"),U),this.off(Dv.ABORT,V),ce==="success"?A(_e):k(new De(X.P2P_MESSAGE_FAILED,"request ".concat(n," failed, requestId: ").concat(c)))};let Y=!1;o||(this.once("res-@".concat(c),q),Ji(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Y||D.warning("external_signal request timeout, type: ".concat(n,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(A){if(A.code===X.TIMEOUT)return await this.send(n,i,o,c,u);throw A}}onMessage(n){var i;const{_uid:o}=n;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in n)||n._type!==Jr.CHECK)return;const{token:y}=n;c=new Map,u={uid:o,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(gn.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in n&&"total"in n){var h;const{id:y,total:S}=n,R=(h=c.get(y))!==null&&h!==void 0?h:[];if(R.push(n),c.has(y)||c.set(y,R),R.length!==S)return;{const A=LT(R).call(R,(k,W)=>k.index-W.index).map(k=>k.payload).join("");c.delete(y),(n=JSON.parse(A))._uid=o}}const{_type:m,token:_}=n;if(st(i=[Jr.ACK,Jr.CHECK]).call(i,m))return m===Jr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(n);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(n):D.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),n)}check(){const n={_id:or(6,""),token:this.token,_type:Jr.CHECK};re("SHOW_P2P_LOG")&&D.debug("send message",n),this.signal.request(Bt.DATA_STREAM,{payload:ym(this.encoder.encode(JSON.stringify(n)))})}ack(n){const i={_id:n,_type:Jr.ACK,token:this.token};re("SHOW_P2P_LOG")&&D.debug("send message",i),this.signal.request(Bt.DATA_STREAM,{payload:ym(this.encoder.encode(JSON.stringify(i)))})}response(n,i,o){this.send(Jr.RESPONSE,JSON.stringify({success:!o,message:i}),!0,n)}handleReceivedMessage(n){const i=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=y;for(;S.has(R);){const A=S.get(R);S.delete(R),this.receiveMessage(A),y.nextExpectedSequenceNumber++}})};if(!n)return void i();const{_uid:o,_seq:c}=n,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(n._id),void D.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(n._message));h.set(c,n),m&&c===_&&(this.receiveMessage(n),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(n){const{_id:i,_type:o,_message:c,_uid:u}=n;if(re("SHOW_P2P_LOG")&&D.debug("receive message",n),i){let h;switch(n._type!==Jr.ACK&&(c&&(h=JSON.parse(c)),this.ack(n._id)),n._type){case Jr.CANDIDATE:case Jr.CONTROL:this.signal.emit(o,h,u);break;case Jr.PUBLISH:case Jr.UNPUBLISH:case Jr.RESTART_ICE:case Jr.CALL:h.uid=u,fs(this.signal,o,h).then(m=>{this.response(n._id,m)}).catch(()=>{this.response(n._id,void 0,!0)});break;case Jr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Jr.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(i),m?"success":"failed",_);break}}}}splitMessage(n){if(n.length<z_.MAX_MESSAGE_SIZE)return[n];const i=[],{remoteToken:o}=JSON.parse(n),c=or(6,"");let u=0,h=800;const m=Math.ceil(n.length/h);for(;n.length>0;){u++;const _={id:c,index:u,total:m,payload:n.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>z_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),n=n.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(n,i){return n.token!==i?(D.debug("token changed, from ".concat(n.token," to ").concat(i)),this.reset(n.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{D.debug("token timeout, ".concat(i)),this.reset(n.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const n=await fs(this.signal,Jr.CALL,void 0),i=await this.send(Jr.CALL,n);this.signal.emit(Wt.P2P_CONNECTION,i,!0)}async reset(n,i){const o=this.userMap.get(n);o&&(this.emit(Dv.ABORT),this.signal.emit(gn.ON_USER_OFFLINE,{uid:o.uid,reason:Gpe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(D.debug("change local token from ".concat(i," to ").concat(i)),this.token=or(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Dv.ABORT)}}$(z_,"MAX_SIZE",1),$(z_,"MAX_MESSAGE_SIZE",1024);class Cge extends Ir{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===lr.CONNECTED?this.emit(Wt.WS_CONNECTED):n===lr.RECONNECTING?this.emit(Wt.WS_RECONNECTING,this._websocketReconnectReason):n===lr.CLOSED&&this.emit(Wt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"p2pToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new p8(5)),$(this,"pingpongTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"_external_signal",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Wt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case gn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case gn.MUTE_AUDIO:case gn.MUTE_VIDEO:case gn.ON_P2P_LOST:case gn.ON_USER_ONLINE:return;case gn.ON_USER_OFFLINE:const{uid:u}=c._message;return D.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===gn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===gn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Wn.UID_BANNED);break;case 15:this.close(Wn.IP_BANNED);break;case 16:this.close(Wn.CHANNEL_BANNED)}if(c._type===gn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Wn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Wn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Wn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Wn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Wn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Wn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new ZL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",ps.OFFLINE)}),this.p2pToken=or(6,""),this._external_signal=new z_(this,this.p2pToken)}async request(n,i,o,c){const u=or(6,""),h={_id:u,_type:n,_message:i},m=this.websocket.connectionID,_=()=>new ct((W,U)=>{if(this.connectionState===lr.CONNECTED)return W();const V=()=>{this.off(Wt.WS_CLOSED,q),W()},q=()=>{this.off(Wt.WS_CONNECTED,V),U(new De(X.WS_ABORT))};this.once(Wt.WS_CONNECTED,V),this.once(Wt.WS_CLOSED,q)});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||n===Bt.JOIN||n===Bt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new ct((W,U)=>{let V=!1;const q=(ce,_e)=>{V=!0,W({isSuccess:ce==="success",message:_e||{}}),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.emit(Wt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new De(X.WS_ABORT,"type: ".concat(n))),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Wt.WS_CLOSED,Y),this.once(Wt.WS_RECONNECTING,Y),Ji(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(Wt.REQUEST_TIMEOUT,n,i))})});let S=null;try{S=await y}catch(W){if(this.connectionState===lr.CLOSED||n===Bt.LEAVE)throw new De(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?W.throw():n===Bt.JOIN||n===Bt.REJOIN?null:(await _(),await this.request(n,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),A=ob(R),k=new De(X.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:A.desc});return A.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(R,", message: ").concat(A.desc,", action: ").concat(A.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((n===Bt.JOIN||n===Bt.REJOIN)&&(this.initError=k,this.close()),k.throw()):A.action==="failed"?k.throw():A.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ps.MULTI_IP)):this.reconnect(A.action,ps.SERVER_ERROR),n===Bt.JOIN||n===Bt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new ct(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(ib.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(n,i,o){return await this._external_signal.send(n,i,o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ct((i,o)=>{this.once(Wt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Wt.WS_CLOSED,()=>o(this.initError||new De(X.WS_ABORT))),this.connectionState=lr.CONNECTING,this.websocket.init(n).catch(o)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=n||Wn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=or(6,""),this._external_signal.clear(),this._external_signal=new z_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Wt.ABORT_P2P_EXECUTION);const n=await fs(this,Wt.REQUEST_JOIN_INFO),i=await this.request(Bt.JOIN,n);if(!i)return this.emit(Wt.REPORT_JOIN_GATEWAY,X.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Wt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleDataStream(n){try{var i;const o=y_(n.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||st(i=Object.values(Jr)).call(i,u._type)?(u._uid=n.uid,this._external_signal.onMessage(u)):this.emit(gn.ON_DATA_STREAM,n)}catch{this.emit(gn.ON_DATA_STREAM,n)}}handleNotification(n){D.debug("[".concat(this.clientId,"] receive notification: "),n);const i=ob(n.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Wn.UID_BANNED),void this.close()):void this.reconnect(i.action,ps.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(D.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ps.TIMEOUT):this.request(Bt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(Bt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(qt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(Wt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(qt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(qt.FAILED,()=>{this._disconnectedReason=Wn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(qt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(qt.WILL_RECONNECT,(n,i,o)=>{n!=="retry"?(D.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0):D.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(n)}),this.websocket.on(qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(n=>{if(this.emit(Wt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof De&&n.code===X.UNEXPECTED_RESPONSE&&n.data.code===Lt.ERR_NO_AUTHORIZED)return D.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ps.SERVER_ERROR);D.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ps.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(qt.REQUEST_NEW_URLS,(n,i)=>{fs(this,Wt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Ige={name:"P2PChannel",create:function(e){let{store:n,statsCollector:i}=e;return new Rge(n,i)},createSubmodule:function(e){let{store:n,spec:i}=e;return new Cge(i,n)}};function V7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function F7(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?V7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):V7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Age{constructor(n){$(this,"sessionDesc",void 0),$(this,"localCapabilities",void 0),$(this,"rtpCapabilities",void 0),$(this,"candidates",void 0),$(this,"_originCandidates",void 0),$(this,"iceParameters",void 0),$(this,"dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),n=Lr(n);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:y}=n,S=ga(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Lr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=y;for(let R=0;R<S.mediaDescriptions.length;R++){const A=S.mediaDescriptions[R];if(A.attributes.iceUfrag=i.iceUfrag,A.attributes.icePwd=i.icePwd,A.attributes.fingerprints=o.fingerprints,A.attributes.candidates=c,A.attributes.setup=h,A.media.mediaType==="video"){A.media.fmts=u.videoCodecs.map(W=>W.payloadType.toString(10));let k=u.videoCodecs.filter(W=>{var U,V;return(U=W.rtpMap)===null||U===void 0?void 0:st(V=U.encodingName.toLowerCase()).call(V,_)});k.length===0&&(k=u.videoCodecs),A.attributes.payloads=k,A.attributes.extmaps=u.videoExtensions}A.media.mediaType==="audio"&&(A.media.fmts=u.audioCodecs.map(k=>k.payloadType.toString(10)),A.attributes.payloads=u.audioCodecs,A.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(A)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return vm(this.sessionDesc)}send(n,i,o){const{ssrcs:c,ssrcGroups:u}=P_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>n===ft.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(n){return n.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(n){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{st(n).call(n,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;st(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(n,i,o){n.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(n){}updateCandidates(n){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(F7(F7({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(n){case ws.TCP_RELAY:this.candidates=o;break;case ws.UDP_TCP_RELAY:case ws.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(n){n=Lr(n),this.iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let o=0;o<n;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(n,i){const o=Lr(n);return Mv(o,i),rx(o,i),o}updateRecvMedia(n,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(n){this.currentMidIndex+=n}updateTrackLabel(n,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>n===ft.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(n){const i=Lr(n);return nx(i),function(o){const c=o.attributes.extmaps.find(u=>$A(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(n){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===n)return[o]}}var ir;function j7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function kP(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?j7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):j7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Pge=(ir=class Sw extends Yz{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return st(i=Object.keys(SA)).call(i,n)}))]}constructor(n,i){super(n,i),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"statsFilter",void 0),$(this,"useRTX",!1),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",void 0),this.store=i,this.mutex=new Ts("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Sw.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=gL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const n=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Rm(n.sdp),o=lb(n.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=n,kP(kP({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:n.sdp})}catch(n){throw new De(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async updateRemoteConnect(){}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Age(kP(kP({},n),{},{rtpCapabilities:n.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(n,i){throw new De(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(n){}send(n,i){var o=this;return ul(function*(){const c=yield Rn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=n.map(A=>o.peerConnection.addTrack(A._mediaStreamTrack)),h=yield Rn(o.peerConnection.createOffer()),m=ga(h.sdp),_=n.map(A=>{const k=A._mediaStreamTrack,W=m.mediaDescriptions.find(U=>U.attributes.mid===k.kind);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return function(U,V,q){const Y=U.attributes.ssrcs.filter(_e=>_e.attributes.label===V),ce=U.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ce&&Y.length>1){const _e=ce.find(ye=>ye.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return _e?[{ssrcId:_e.ssrcIds[0],rtx:q?_e.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(W,k.id,o.useRTX)});let y;try{y=yield _}catch(A){throw u.forEach(k=>{hs()&&k.replaceTrack(null),o.peerConnection.removeTrack(k)}),A}const S=o.mungSendOfferSDP(h.sdp,n);o.remoteSDP.receive(n,i,y);const R=o.remoteSDP.toString();return yield Rn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(o.applySendEncodings(u,n)),yield Rn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),n.map((A,k)=>{const W=A._mediaStreamTrack.id;return{localSSRC:_[k],id:W}})}catch(u){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{hs()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(n);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(n,i,c),m=new ct((S,R)=>{const A=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),k=W=>{const U=Cn();if((U.name==="Safari"&&Number(U.version)===11||mo())&&W.track.id!==u&&W.streams[0].id===h){var V;const q=W.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(n,u,W.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(A),void S(q)}if(W.track.id===u)return this.peerConnection.removeEventListener("track",k),clearTimeout(A),void S(W.track)};this.peerConnection.addEventListener("track",k)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){}async unmuteRemote(n){}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return n.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==n.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(hs()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(hs()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return ul(function*(){const o=yield Rn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Nn().supportPCSetConfiguration;if(n===ws.RELAY&&!c)return;if(c){const y=i.peerConnection.getConfiguration(),S=n===ws.RELAY?"relay":"all";y.iceTransportPolicy!==S&&(D.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(S,"]")),y.iceTransportPolicy=S,i.peerConnection.setConfiguration(y))}n!==ws.RELAY&&i.remoteSDP.updateCandidates(n);const u=yield Rn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Rm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const _=i.remoteSDP.toString();yield Rn(i.peerConnection.setLocalDescription(u)),yield Rn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){D.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var n;this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new De(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===n});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(n._mediaStreamTrack)}createDataChannels(n,i){throw new De(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new De(X.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(XT(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Sw.turnServerConfigToIceServers(n.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Sw.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(y=>{var S;return((S=y.track)===null||S===void 0?void 0:S.id)===n._mediaStreamTrack.id})),!i)return D.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!Nn().supportSetRtpSenderParameters)return D.warn("Browser not support set rtp-sender parameters");const c={},u={};if(n instanceof fr)switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(re("DSCP_TYPE")&&Mp()){var h;const y=re("DSCP_TYPE");st(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),D.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(n,i){try{if(!Nn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i){const o=ga(n);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&Mv(m,c)}),vm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(n).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:y}=n[h];return new ct((S,R)=>{const A=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=W=>{const U=Cn();if(U.name==="Safari"&&Number(U.version)===11&&W.track.id!==m&&W.streams[0].id===_){var V;const q=W.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(y,m,W.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(A),void S({track:q,id:m})}if(W.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(A),void S({track:W.track,id:m})};this.peerConnection.addEventListener("track",k)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ct.all(i)}catch(i){throw new De(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i==null?void 0:i[0].ssrcId}setConfiguration(n){if(Nn().supportPCSetConfiguration){const i=Sw.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},_t(ir.prototype,"connect",[El],Object.getOwnPropertyDescriptor(ir.prototype,"connect"),ir.prototype),_t(ir.prototype,"stopSending",[El],Object.getOwnPropertyDescriptor(ir.prototype,"stopSending"),ir.prototype),_t(ir.prototype,"receive",[El],Object.getOwnPropertyDescriptor(ir.prototype,"receive"),ir.prototype),_t(ir.prototype,"stopReceiving",[El],Object.getOwnPropertyDescriptor(ir.prototype,"stopReceiving"),ir.prototype),_t(ir.prototype,"muteRemote",[El],Object.getOwnPropertyDescriptor(ir.prototype,"muteRemote"),ir.prototype),_t(ir.prototype,"unmuteRemote",[El],Object.getOwnPropertyDescriptor(ir.prototype,"unmuteRemote"),ir.prototype),_t(ir.prototype,"muteLocal",[El],Object.getOwnPropertyDescriptor(ir.prototype,"muteLocal"),ir.prototype),_t(ir.prototype,"unmuteLocal",[El],Object.getOwnPropertyDescriptor(ir.prototype,"unmuteLocal"),ir.prototype),_t(ir.prototype,"close",[El],Object.getOwnPropertyDescriptor(ir.prototype,"close"),ir.prototype),_t(ir.prototype,"updateEncoderConfig",[El],Object.getOwnPropertyDescriptor(ir.prototype,"updateEncoderConfig"),ir.prototype),_t(ir.prototype,"updateSendParameters",[El],Object.getOwnPropertyDescriptor(ir.prototype,"updateSendParameters"),ir.prototype),_t(ir.prototype,"replaceTrack",[El],Object.getOwnPropertyDescriptor(ir.prototype,"replaceTrack"),ir.prototype),_t(ir.prototype,"getRemoteSSRC",[El],Object.getOwnPropertyDescriptor(ir.prototype,"getRemoteSSRC"),ir.prototype),ir);function El(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}const Oge={name:"PlanBConnection",create:function(e){let{store:n,spec:i}=e;return new Pge(i,n)}},kge={interceptLocalAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(OA.has(e)||!e.track)return;const i={track:e.track};if(xp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=n.metadata&&n.metadata();_?function(y,S){const{chunk:R,controller:A}=S,k=re("ENABLE_AUDIO_PTS_METADATA")?jp.AUDIO_64_BIT_PTS:jp.METADATA;R.data=function(W,U,V){const q=V.byteLength,Y=q+jL+Dz,ce=VL+FL+Y,_e=new ArrayBuffer(W.byteLength+ce),ye=new DataView(_e);ye.setUint8(0,Nz),ye.setUint16(1,Y),ye.setUint8(3,U),ye.setUint16(4,q);for(let ke=0;ke<q;ke++)ye.setUint8(6+ke,V[ke]);const fe=new Uint8Array(ye.buffer);return fe.set(new Uint8Array(W),ce),fe.buffer}(R.data,k,y),A.enqueue(R)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(hs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=PA(),u=new MessageChannel;await new ct(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new ct(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(m.data.getMetadata){const y=n.metadata&&n.metadata();y&&u.port1.postMessage({metadata:y})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=OA.get(e);if(c){OA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}OA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(MA.has(e))return;const i={track:e.track,onMetadata:n.onMetadata};if(xp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");QD(Un.CHROME,87,116)||(n.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),n.enableTopn?function(_,y,S){var R;const A=Lz(new DataView(y.data));if(!A)return S.enqueue(y);const k=_.track.id;dpe.set(k,_.track);const W=(R=A.tlv.find(_e=>_e.tag===jp.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let U=0;typeof W=="number"&&(U=127-W);const V=Math.round(Math.pow(10,U/60)-1),{selected:q,speaker:Y}=function(_e,ye){let fe=Pv.get(_e);if(fe||(fe=function(ke){const qe=new Mz;return Pv.set(ke,qe),sd||(sd=new lpe(re("TOPN_SILENCE_THRESHOLD")||500),sd.on("ActiveSpeakerChanged",lt=>{lt!=null&&(DA=lt)})),sd.addSpeakers([qe]),qe}(_e)),Pv.size<=Uz)return{selected:!0,speaker:fe};if(!sd)throw new Error("no active speaker detector");return sd.levelChanged(fe.id,ye),C_=sd.loudest.map(ke=>ke.id),DA&&!st(C_).call(C_,DA)&&C_.length>=Uz&&C_.pop(),{selected:st(C_).call(C_,fe.id)||fe.id===DA,speaker:fe}}(_,V),ce=function(_e,ye,fe){const ke=od.get(_e)||new upe(_e,ye);return ke.score=fe,od.set(_e,ke),function(qe){if(LA.set(qe,!0),!xA)return void(xA=Date.now());const lt=Date.now();lt-xA>1e3&&(LA.get(qe)?LA.set(qe,!1):(Vz(qe),LA.delete(qe)),xA=lt)}(_e),ke}(k,_.track,Y.energyScore);ce.addSample(q),ce.active&&(y.data=A.frame.buffer,S.enqueue(y))}(e,h,m):n.enableMetadata?function(_,y,S){const R=Lz(new DataView(_.data));if(!R)return y.enqueue(_);const A=R.tlv.find(k=>k.tag===jp.METADATA||k.tag===jp.AUDIO_64_BIT_PTS);A&&S&&A.value instanceof Uint8Array&&S(A.value),_.data=R.frame.buffer,y.enqueue(_)}(h,m,n.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(hs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=PA(),u=new MessageChannel;await new ct(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new ct(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.metadata&&i.onMetadata&&i.onMetadata(m.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=MA.get(c);if(u){(function(_){const y=Pv.get(_);y&&(Pv.delete(_),sd&&(sd.removeSpeakers([y]),Pv.size===0&&(sd.destroy(),sd=null)))})(c),Vz(c.track.id),MA.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}}(e)}MA.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,n){if(!Nn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(UA.has(e)||!e.track)return;const i={track:e.track};if(xp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void D.error("create video-encoded-streams error",m&&m.message)}const u=[];n.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const y=u.shift();y&&(m.data=function(S,R){const A=function(Y){const ce=Y.length;let _e=[],ye=0;for(;ye<ce;)ye+2<ce&&Y[ye]===0&&Y[ye+1]===0&&(Y[ye+2]===0||Y[ye+2]===1||Y[ye+2]===2||Y[ye+2]===3)?(_e.push(Y[ye],Y[ye+1],3,Y[ye+2]),ye+=3):(_e.push(Y[ye]),ye++);return new Uint8Array(_e)}(R),k=A.length,W=Math.floor(k/255),U=k%255,V=new Uint8Array(6+W+1+k+S.byteLength);V[0]=0,V[1]=0,V[2]=0,V[3]=1,V[4]=6,V[5]=101;let q=0;for(;q<W;)V[6+q]=255,q++;return V[6+q]=U,q++,V.set(A,6+q),V.set(new Uint8Array(S),6+q+k),V.buffer}(m.data,y)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!hs())return;{if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=PA(),u=new MessageChannel;await new ct(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new ct(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),n.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=UA.get(e);if(c){UA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}UA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(!e.track)return;if(rb.has(e)){const c=rb.get(e);return void(c&&(c.onSei=n.onSei))}const i={track:e.track,onSei:n.onSei};if(xp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(y){const S=new DataView(y.data);let R=0;for(;R+4<y.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let A=R+6,k=0,W=0;for(;(W=S.getUint8(A++))===255;)k+=255;k+=W;const U=hpe(y.data,A,k);return new Uint8Array(U)}R++}return null}(h);_&&i.onSei&&i.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(hs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=PA(),u=new MessageChannel;await new ct(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new ct(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.sei&&i.onSei&&i.onSei(m.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=rb.get(c);if(u){rb.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}})(e)}rb.set(e,i),e.track.addEventListener("ended",o)}},Nge={name:"InterceptFrame",create:()=>kge};_L(),Jn("PROCESS_ID","process-".concat(or(8,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void D.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();D.debug("Loading global parameters from cache",n),Object.keys(n).forEach(o=>{if(Object.prototype.hasOwnProperty.call(pr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;id[o]=c,pr[o]=c}})}catch(n){D.error("Error loading mutableParamsCache: ".concat(e),n.message)}}(),Array.isArray(id.AREAS)&&id.AREAS.length>0&&cx(id.AREAS,!0);const B7=(e,n,i)=>{D.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(n))),Jn(e,n,i)};Cm(tge,!1),Cm(ige,!1),Cm(Ufe,!1),Cm(mge,!1),Cm(Qme,!1),Cm(Ige,!1),Cm(Oge,!1),Cm(Nge,!1);const gi=function(e){const n=new Ir,i=e,o={getListeners:n.getListeners.bind(n),on:(c,u)=>(function(h,m){h===lh.SECURITY_POLICY_VIOLATION&&SH(m,!0)}(c,u),n.on.bind(n)(c,u)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return vH(vH({},i),o)}({__TRACK_LIST__:yv,VERSION:dl,BUILD:vL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:B7,getParameter:re,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let n=new RTCPeerConnection;const i=await async function(o){let c;return Nn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(n);if(!i)return e;n.close(),n=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(n){throw new Pe(X.CREATE_OFFER_FAILED,n.toString&&n.toString()).print()}return e},checkSystemRequirements:function(){const e=bt.reportApiInvoke(null,{name:fi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Dr.TRACER});let n=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;n=!!(u&&h&&m),n&&nL()&&W6(75)&&new u().close()}catch(u){return D.error("check system requirement failed: ",u),!1}let i=!1;const o=Cn();o.name===Un.CHROME&&Number(o.version)>=58&&(nd.engine.name!=="WebKit"||function(){const u=Cn();if(hA()){if(u.os===Pi.MAC_OS)return!0;if(u.os===Pi.IOS){const h=nd.os.version&&nd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===Un.FIREFOX&&Number(o.version)>=56||o.name===Un.OPERA&&Number(o.version)>=45||o.name===Un.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(mo()||tu())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||q6()||Cn().name===Un.QQ)&&(i=!0),D.debug("checkSystemRequirements, api:",n,"browser",i);const c=n&&i;return e.onSuccess(c),c},getDevices:function(e){return Oc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Oc.getRecordingDevices(e)},getCameras:function(e){return Oc.getCamerasDevices(e)},getElectronScreenSources:W8,getPlaybackDevices:function(e){return Oc.getSpeakers(e)},createClient:function(){var e;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=or(5,"client-"),o=bt.reportApiInvoke(null,{id:i,name:fi.CREATE_CLIENT,options:[n],tag:Dr.TRACER});try{(function(c){bi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),bi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&bi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Xi(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&n8(c.turnServer),c.httpRetryConfig!==void 0&&t8(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&t8(c.websocketRetryConfig)})(n)}catch(c){throw o.onError(c),c}return(G6(16,0)||H6(16,0,!0))&&(n.codec==="vp9"&&(n.codec="vp8",D.debug("browser not support vp9, force use vp8")),Jn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),n.audioCodec===void 0&&(n.audioCodec="opus"),o.onSuccess(),new Vfe(lu(lu({forceWaitGatewayResponse:!0},n),{},{role:st(e=["rtc","p2p"]).call(e,n.mode)?"host":n.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=re("CAMERA_CAPTURE_CONFIG"),i=or(8,"track-cam-"),o=bt.reportApiInvoke(null,{id:i,tag:Dr.TRACER,name:fi.CREATE_CAM_VIDEO_TRACK,options:[br({},e),n]});n&&(e.encoderConfig=n);const c=IA(e);let u=null;D.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await Pc({video:c},i)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new De(X.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(D)}e.optimizationMode&&UL(i,u,e,oh(e.encoderConfig));const h=new ML(u,e,c,e.scalabiltyMode?bA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),D.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const n=or(8,"track-cus-"),i=bt.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:fi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new fr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?bA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[ar.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),D.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof n=="object"?function(A){return Q8(A)}(n):void 0;i&&(n="auto");const o=or(8,"track-scr-v-"),c=bt.reportApiInvoke(null,{id:o,tag:Dr.TRACER,name:fi.CREATE_SCREEN_VIDEO_TRACK,options:[br({},e),n]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(A){const k={};A.screenSourceType&&(k.mediaSource=A.screenSourceType),A.extensionId&&xp()&&(k.extensionId=A.extensionId);const{displaySurface:W,selfBrowserSurface:U,surfaceSwitching:V,systemAudio:q,preferCurrentTab:Y}=A;($T(107)||ZD(107)||eL(93))&&(W&&(bi(W,"displaySurface",["browser","window","monitor"]),k.displaySurface=W),U?(bi(U,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=U):k.selfBrowserSurface="include",V&&(bi(V,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=V)),($T(105)||ZD(105)||eL(91))&&q&&(bi(q,"systemAudio",["exclude","include"]),k.systemAudio=q),($T(94)||ZD(94)||eL(80))&&Y&&(k.preferCurrentTab=!0),A.electronScreenSourceId&&(k.sourceId=A.electronScreenSourceId);const ce=A.encoderConfig?RL(A.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:ce?ce.width:void 0,maxHeight:ce?ce.height:void 0},ce&&(ce.frameRate&&(typeof ce.frameRate=="number"?(k.mandatory.maxFrameRate=ce.frameRate,k.mandatory.minFrameRate=ce.frameRate):(k.mandatory.maxFrameRate=ce.frameRate.max||ce.frameRate.ideal||ce.frameRate.exact||void 0,k.mandatory.minFrameRate=ce.frameRate.min||ce.frameRate.ideal||ce.frameRate.exact||void 0),k.frameRate=ce.frameRate),ce.width&&(k.width=ce.width),ce.height&&(k.height=ce.height)),k}(e);let h=null,m=null;const _=Nn();if(!_.supportShareAudio&&n==="enable"){const A=new De(X.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(A),A.throw(D)}D.info("start create screen video track with config",e,"withAudio",n,"trackId",o);const y=_.supportShareAudio&&n!=="disable";try{const A=await Pc({screen:u,screenAudio:y?i||!0:void 0},o);h=A.getVideoTracks()[0]||null,m=A.getAudioTracks()[0]||null}catch(A){throw c.onError(A),A}if(!h){const A=new De(X.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(A),A.throw(D)}if(!m&&n==="enable"){h&&h.stop();const A=new De(X.SHARE_AUDIO_NOT_ALLOWED);return c.onError(A),A.throw(D)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(UL(o,h,e,e.encoderConfig&&RL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new fr(h,e.encoderConfig?RL(e.encoderConfig):{},e.scalabiltyMode?bA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[ar.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),D.info("create screen video track success","video:",S.getTrackId()),S;const R=new jr(m,void 0,or(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),D.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=re("CAMERA_CAPTURE_CONFIG"),o=or(8,"track-mic-"),c=or(8,"track-cam-"),u=bt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Dr.TRACER,name:fi.CREATE_MIC_AND_CAM_TRACKS,options:[e,n,i]});i&&(n.encoderConfig=i);const h=IA(n),m=Z8(e);let _=null,y=null;D.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(n)));try{const A=await Pc({audio:m,video:h},"".concat(o,"-").concat(c));_=A.getAudioTracks()[0],y=A.getVideoTracks()[0]}catch(A){throw u.onError(A),A}if(!_||!y){const A=new De(X.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(A),A.throw(D)}n.optimizationMode&&UL(c,y,n,oh(n.encoderConfig));const S=new AA(_,e,m,o),R=new ML(y,n,h,n.scalabiltyMode?bA(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),D.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=or(8,"track-mic-"),i=bt.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:fi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=Z8(e);let c=null;D.info("start create microphone audio track with config",JSON.stringify(e),"trackId",n);try{c=(await Pc({audio:o},n)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new De(X.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(D)}const u=new AA(c,e,o,n);return i.onSuccess(u.getTrackId()),D.info("create microphone audio track success, trackId:",n),u},createCustomAudioTrack:function(e){const n=or(8,"track-cus-"),i=bt.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:fi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new jr(e.mediaStreamTrack,e.encoderConfig?wA(e.encoderConfig):{},n,!1);return D.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var n;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(n=File.name)!==null&&n!==void 0?n:"File":c,cacheOnlineFile:i,encoderConfig:o},h=or(8,"track-buf-"),m=bt.reportApiInvoke(null,{id:h,tag:Dr.TRACER,name:fi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(re("DISABLE_WEBAUDIO"))throw new De(X.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");D.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,A){let k=null;if(typeof R=="string"){const U=FW.get(R);if(U)return D.debug("use cached audio resource: ",R),U;try{k=(await rd(()=>Bo.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(V){throw new De(X.FETCH_AUDIO_FILE_FAILED,V.toString())}}else k=await new ct((V,q)=>{const Y=new FileReader;Y.onload=ce=>{ce.target?V(ce.target.result):q(new De(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{q(new De(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(R)});const W=await function(U){const V=Rv();return new ct((q,Y)=>{V.decodeAudioData(U,ce=>{q(ce)},ce=>{Y(new De(X.DECODE_AUDIO_FILE_FAILED,ce.toString()))})})}(k);return typeof R=="string"&&A&&FW.set(R,W),W}(c,i)}catch(R){return m.onError(R),R.throw(D)}const y=new ipe(c),S=new rpe(_,y,o?wA(o):{},h);return D.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(D.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw D.debug("Invalid appType"),new Pe(X.INVALID_PARAMS,"invalid app type",e);Jn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){D.setLogLevel(e)},enableLogUpload:function(){re("USE_NEW_LOG")?Jn("UPLOAD_LOG",!0):D.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?Jn("UPLOAD_LOG",!1):D.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new FG},checkAudioTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=bt.reportApiInvoke(null,{tag:Dr.TRACER,name:fi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof jr||e instanceof Av)){const _=new Pe(X.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof jr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new ct(_=>{const y=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,A=Date.now()-m;if(R||A>n){clearInterval(y);const k=R,W={duration:A,deviceLabel:o,maxVolumeLevel:u,result:k};D.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(W))),i.onSuccess(W),_(k)}},200)})},checkVideoTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=bt.reportApiInvoke(null,{tag:Dr.TRACER,name:fi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof fr||e instanceof Iv)){const R=new Pe(X.INVALID_TRACK,"the parameter is not a video track");return i.onError(R),R.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof fr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(hs()||hA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const R=Date.now();m=await function(A,k,W,U){let V,q=0,Y=null;return new ct((ce,_e)=>{function ye(){q>U&&V&&(V(),ce(q));const fe=W.getContext("2d");if(!fe){const lt=new Pe(X.UNEXPECTED_ERROR,"can not get canvas 2d context.");return D.error(lt.toString()),void _e(lt)}fe.drawImage(A,0,0,160,120);const ke=fe.getImageData(0,0,W.width,W.height),qe=Math.floor(ke.data.length/3);if(Y){for(let lt=0;lt<qe;lt+=3)if(ke.data[lt]!==Y[lt])return q+=1,void(Y=ke.data);Y=ke.data}else Y=ke.data}setTimeout(()=>{V&&(V(),ce(q))},k),V=OL(()=>{ye()},30)})}(u,n,h,4),_=Date.now()-R}catch(R){throw i.onError(R),R}bfe===Un.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:y};return D.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),y},setArea:cx,audioElementPlayCenter:Wo,resumeAudioContext:function(){Wo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){jfe.processExternalMediaAEC(e)},registerExtensions:function(e){const n=re("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!st(n).call(n,i.name)&&n.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=D.extLog,o.reporter.hookApiInvoke=bt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=re(c)})}),B7("PLUGIN_INFO",n)},ChannelMediaRelayError:kv,ChannelMediaRelayEvent:Wp,ChannelMediaRelayState:_a,RemoteStreamFallbackType:Xhe,RemoteStreamType:Yhe,ConnectionDisconnectedReason:Wn,AudienceLatencyLevelType:Che,AREAS:Vn,preload:async function(e,n,i,o){return h9(e,n,i,o)}});return Object.defineProperties(gi,{onAudioAutoplayFailed:{get:()=>kc.onAudioAutoplayFailed,set:e=>{kc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>kc.onAutoplayFailed,set:e=>{kc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>gi._onSecurityPolicyViolation,set(e){gi._onSecurityPolicyViolation=e,SH(e)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?I_:[]}}),Oc.on(b_.CAMERA_DEVICE_CHANGED,e=>{D.info("camera device changed",JSON.stringify(e)),gi.onCameraChanged&&gi.onCameraChanged(e),gi.safeEmit(lh.CAMERA_CHANGED,e)}),Oc.on(b_.RECORDING_DEVICE_CHANGED,e=>{D.info("microphone device changed",JSON.stringify(e)),gi.onMicrophoneChanged&&gi.onMicrophoneChanged(e),gi.safeEmit(lh.MICROPHONE_CHANGED,e)}),Oc.on(b_.PLAYOUT_DEVICE_CHANGED,e=>{D.debug("playout device changed",JSON.stringify(e)),gi.onPlaybackDeviceChanged&&gi.onPlaybackDeviceChanged(e),gi.safeEmit(lh.PLAYBACK_DEVICE_CHANGED,e)}),Wo.onAutoplayFailed=()=>{D.info("detect audio element autoplay failed"),kc.onAudioAutoplayFailed&&kc.onAudioAutoplayFailed()},Qn.on("autoplay-failed",()=>{D.info("detect webaudio autoplay failed"),kc.onAudioAutoplayFailed&&kc.onAudioAutoplayFailed(),gi.safeEmit(lh.AUTOPLAY_FAILED)}),Qn.on(Zi.STATE_CHANGE,(e,n)=>{D.info("audio context state changed: ".concat(n," => ").concat(e)),gi.onAudioContextStateChanged&&gi.onAudioContextStateChanged(e,n),gi.safeEmit(lh.AUDIO_CONTEXT_STATE_CHANGED,e,n)}),si.on(pv.NETWORK_STATE_CHANGE,(e,n)=>{D.info("[network-indicator] network state changed, ".concat(n," => ").concat(e))}),window&&(window.__ARTC__=gi),gi})}(HO)),HO.exports}var x5e=L5e();const gR=a0(x5e),M5e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"},qie="a2a7f4eb05284449b1063eb71d8301dc";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",qie);console.log("AgoraProvider: import.meta.env:",M5e);const U5e=gR.createClient({mode:"rtc",codec:"vp8"});let rw=null;const Yie=L.createContext(null),Xie=({children:r,appId:t=qie,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:E=()=>{}})=>{console.log("AgoraProvider: appId prop:",t);const[v,T]=L.useState(!1),[w,I]=L.useState(!1),[N,F]=L.useState([]),[j,G]=L.useState(null),[H,te]=L.useState(null),[K,Q]=L.useState(null),[de,se]=L.useState(!1),[ge,ee]=L.useState(!1),[Z,ne]=L.useState(!1),[ae,me]=L.useState(null),[he,le]=L.useState(!1),Me=Zh(),Ge=L.useRef(U5e),tt=L.useRef({appId:t,channel:s,uid:l,enabled:d}),Ee=L.useRef(!1),we=L.useRef(null);L.useRef(null),L.useEffect(()=>{tt.current={appId:t,channel:s,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:s,uid:l,enabled:d})},[t,s,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:s,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Ge.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,s,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",s),te(s)},[s]),L.useEffect(()=>{if(!Ge.current)return;const et=ut=>{console.log(`Connection state changed to: ${ut}`),ut==="DISCONNECTED"?(T(!1),console.log("Disconnected from Agora")):ut==="CONNECTED"&&(T(!0),G(null))};return Ge.current.on("connection-state-change",et),()=>{Ge.current.off("connection-state-change",et)}},[]),L.useEffect(()=>{if(!s||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:s,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",s,"with UID",l);const et=async(Vt,ln)=>{console.log("AgoraProvider: User published:",Vt.uid,ln);try{await Ge.current.subscribe(Vt,ln),console.log("AgoraProvider: Subscribed to user:",Vt.uid,"mediaType:",ln),ln==="audio"&&(Vt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Vt.uid)),F(xn=>xn.some(Xt=>Xt.uid===Vt.uid)?xn:[...xn,Vt])}catch(xn){console.error("AgoraProvider: Error subscribing to user:",xn)}},ut=(Vt,ln)=>{console.log("AgoraProvider: User unpublished:",Vt.uid,ln),ln==="audio"&&Vt.audioTrack&&(Vt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Vt.uid))},it=Vt=>{console.log("AgoraProvider: User joined:",Vt.uid),F(ln=>ln.some(xn=>xn.uid===Vt.uid)?ln:[...ln,Vt])},Ct=Vt=>{console.log("AgoraProvider: User left:",Vt.uid),F(ln=>ln.filter(xn=>xn.uid!==Vt.uid))};Ge.current.on("user-published",et),Ge.current.on("user-unpublished",ut),Ge.current.on("user-joined",it),Ge.current.on("user-left",Ct);const _n=async()=>{if(Ee.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}Ee.current=!0;try{if(v&&we.current===s){console.log("AgoraProvider: Already joined to channel",s),se(!0),E(Ge.current);return}if(Ge.current.connectionState==="CONNECTING"||Ge.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",Ge.current.connectionState),we.current&&we.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Oe()}catch(Vt){console.error("AgoraProvider: Error leaving channel:",Vt)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),T(!0),se(!0),we.current=s,rw=s,E(Ge.current);return}console.log("AgoraProvider: Joining channel",s,"current joined channel:",we.current),await Be(),console.log("AgoraProvider: Join channel completed")}catch(Vt){console.error("AgoraProvider: Error during initialization:",Vt)}finally{Ee.current=!1}};return console.log("AgoraProvider: Running initialization"),_n(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),Ge.current.off("user-published",et),Ge.current.off("user-unpublished",ut),Ge.current.off("user-joined",it),Ge.current.off("user-left",Ct)}},[s,d,l,E,v]);const ve=async()=>{if(!d||K)return K;console.log("Initializing microphone");try{const et=await gR.createMicrophoneAudioTrack();return await et.setMuted(f),Q(et),console.log("Microphone initialized successfully"),et}catch(et){return console.error("Error initializing microphone:",et),G("Failed to initialize microphone. Please check your permissions."),null}};L.useEffect(()=>{(async()=>{if(s)try{const Ct=await sg(s);Ct&&Ct.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),le(!0),v&&await Oe()):le(!1)}catch(it){console.error("AgoraProvider: Error checking if voice is disabled:",it)}})();const ut=it=>{it.detail&&typeof it.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",it.detail.voiceDisabled),le(it.detail.voiceDisabled),it.detail.voiceDisabled&&v?Oe():!it.detail.voiceDisabled&&!v&&d&&s&&Be())};return window.addEventListener("SpaceVoiceSettingChanged",ut),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ut)}},[s,v,d]);const Be=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(he)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),G("Voice chat is disabled for this space"),!1;if(!s)return console.error("AgoraProvider: No channel specified"),G("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",s,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:ge,connectionState:Ge.current.connectionState,joinedChannel:we.current}),v&&we.current===s)return console.log("AgoraProvider: Already joined to channel:",s),!0;if(ge)return console.log("AgoraProvider: Already in the process of joining"),!1;if(Ge.current.connectionState==="CONNECTED")if(we.current&&we.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Oe()}catch(et){console.error("AgoraProvider: Error leaving channel:",et)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),T(!0),se(!0),we.current=s,rw=s,E(Ge.current),!0;if(Ge.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),ee(!0),new Promise(et=>{const ut=setInterval(()=>{Ge.current.connectionState==="CONNECTED"&&(clearInterval(ut),T(!0),ee(!1),se(!0),we.current=s,rw=s,E(Ge.current),et(!0))},500);setTimeout(()=>{clearInterval(ut),console.log("AgoraProvider: Connection timeout, considering join failed"),ee(!1),et(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",s,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",t,"Type:",typeof t,"Length:",t.length),!t||t.trim()===""){const ut="AgoraProvider: App ID is empty or invalid";return console.error(ut),G(ut),ee(!1),!1}ee(!0);const et=l||Math.floor(Math.random()*1e6);return await Ge.current.join(t,s,a,et),console.log("AgoraProvider: Joined channel successfully with UID:",Ge.current.uid),T(!0),ee(!1),se(!0),we.current=s,rw=s,E(Ge.current),!0}catch(et){return console.error("AgoraProvider: Error joining channel:",et),G(`Error joining channel: ${et.toString()}`),ee(!1),!1}},Oe=async()=>{if(v)try{K&&await Ge.current.unpublish(K),await Ge.current.leave(),rw=null,we.current=null,console.log("Left channel successfully"),T(!1),F([])}catch(et){console.error("Error leaving channel:",et),G(et.message||"Failed to leave channel")}};L.useEffect(()=>()=>{K&&K.close()},[]),L.useEffect(()=>{d&&s&&(!v||we.current!==s)&&Be()},[d,s,v]);const be=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(et){return console.error("Error checking microphone status:",et),!1}};L.useEffect(()=>{const et=()=>{const it=be();it!==w&&(console.log("Syncing microphone state:",{actualStatus:it,currentState:w}),I(it),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:it}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=it,window.agoraClient.microphoneTrack=K))};K&&et();const ut=setInterval(et,1e3);return()=>{clearInterval(ut)}},[K,w]);const Ce=async()=>{var et;if(he)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Me({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const ut=w!==void 0?w:K?!K.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:ut,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ve()))return console.error("AgoraProvider: Failed to initialize microphone"),ut;const it=!ut;if(console.log("AgoraProvider: New voice state will be:",it),ut){if(K)try{console.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(Ct){return console.error("Error muting track:",Ct),ut}}else if(K)try{Ge.current&&v&&!((et=Ge.current.localTracks)!=null&&et.includes(K))&&(console.log("AgoraProvider: Publishing microphone track"),await Ge.current.publish(K),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(Ct){return console.error("Error unmuting track:",Ct),ut}return I(it),it}catch(ut){return console.error("AgoraProvider: Error toggling voice:",ut),w}},xe=async et=>{try{Q(et),console.log("Microphone track updated successfully")}catch(ut){throw console.error("Error updating microphone track:",ut),ut}},ze=async()=>{if(!Ge.current||!s)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(Z)return console.log("AgoraProvider: Stopping screen share"),ae&&(Array.isArray(ae)?(await Ge.current.unpublish(ae),ae.forEach(et=>et.close())):(await Ge.current.unpublish(ae),ae.close()),me(null)),ne(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const et=await gR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",et),et.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),Ge.current.unpublish(et),et.close(),me(null),ne(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await Ge.current.publish(et),me(et),ne(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=et,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(et){return console.error("AgoraProvider: Error creating screen track:",et),ne(!1),me(null),!1}}catch(et){return console.error("AgoraProvider: Error toggling screen share:",et),ne(!1),me(null),!1}};L.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Ge.current,isScreenSharing:!1,screenTrack:null};const et=it=>{console.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(Ct=>{it.detail&&it.detail.callback&&it.detail.callback(!0,Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Ct),it.detail&&it.detail.callback&&it.detail.callback(!1,Z)})},ut=it=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Be().then(Ct=>{it.detail&&it.detail.callback&&it.detail.callback(Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Ct),it.detail&&it.detail.callback&&it.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",et),window.addEventListener("JoinVoiceChat",ut),()=>{window.removeEventListener("ToggleScreenShare",et),window.removeEventListener("JoinVoiceChat",ut),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),L.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=K,window.agoraClient.client=Ge.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,K]);const Qe={client:Ge.current,isJoined:v,isVoiceEnabled:w,users:N,error:j,channel:H,appId:t,toggleVoice:Ce,leaveChannel:Oe,joinChannel:Be,microphoneTrack:K,isReady:de,createMicrophoneTrack:xe,isScreenSharing:Z,screenTrack:ae,toggleScreenShare:ze,voiceDisabled:he};return O.jsx(Yie.Provider,{value:Qe,children:r})},Jie=()=>{const r=L.useContext(Yie);if(!r)throw new Error("useAgoraContext must be used within an AgoraProvider");return r};Xie.propTypes={children:Mr.node.isRequired,appId:Mr.string.isRequired,channel:Mr.string.isRequired,token:Mr.string,uid:Mr.oneOfType([Mr.string,Mr.number])};const V5e=()=>{var Ee,we;const{client:r,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:f,channel:E,appId:v,toggleVoice:T,joinChannel:w,leaveChannel:I,createMicrophoneTrack:N,isScreenSharing:F,screenTrack:j,toggleScreenShare:G,voiceDisabled:H}=Jie(),[te,K]=L.useState(t!==void 0?t:((Ee=window.agoraClient)==null?void 0:Ee.isVoiceEnabled)||!1),[Q,de]=L.useState(F!==void 0?F:((we=window.agoraClient)==null?void 0:we.isScreenSharing)||!1),[se,ge]=L.useState(H!==void 0?H:!1),[ee,Z]=L.useState(!0);L.useEffect(()=>{var ve;t!==void 0?K(t):((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):d&&K(!d.muted)},[t,d]),L.useEffect(()=>{var ve;F!==void 0?de(F):((ve=window.agoraClient)==null?void 0:ve.isScreenSharing)!==void 0&&de(window.agoraClient.isScreenSharing)},[F]),L.useEffect(()=>{H!==void 0&&ge(H)},[H]);const ne=L.useRef({isVoiceEnabled:te,isScreenSharing:Q,isJoined:s,users:a,error:l,isReady:f,channel:E,appId:v,voiceDisabled:se});L.useEffect(()=>{ne.current={isVoiceEnabled:te,isScreenSharing:Q,isJoined:s,users:a,error:l,isReady:f,channel:E,appId:v,voiceDisabled:se}},[te,Q,s,a,l,f,E,v,se]),L.useEffect(()=>{const ve=setTimeout(()=>{Z(!1)},5e3);return()=>clearTimeout(ve)},[]),L.useEffect(()=>{f&&Z(!1)},[f]),L.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:te,contextIsScreenSharing:F,localScreenSharing:Q,isJoined:s,users:a.length,error:l,isReady:f,channel:E,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!j})},[t,te,F,Q,s,a,l,f,E,v,d,j]);const ae=async()=>{try{console.log("useVoiceChat: Toggling voice from:",te);const ve=await T();if(console.log("useVoiceChat: Toggle result:",ve),ve!==void 0)K(ve);else{const Be=!te;K(Be),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Be)}return ve!==void 0?ve:!te}catch(ve){return console.error("useVoiceChat: Error toggling voice:",ve),te}},me=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",Q);const ve=await G();if(console.log("useVoiceChat: Screen share toggle result:",ve),ve!==void 0)de(ve);else{const Be=!Q;de(Be),window.agoraClient&&(window.agoraClient.isScreenSharing=Be)}return ve!==void 0?ve:!Q}catch(ve){return console.error("useVoiceChat: Error toggling screen share:",ve),Q}},he=async()=>{te&&d&&await ae()},le=async()=>{!te&&d&&await ae()},Me=ve=>a.some(Be=>{var Oe;return Be.uid===ve&&((Oe=Be.audioTrack)==null?void 0:Oe.isPlaying)}),Ge=L.useCallback(()=>{if(!d||!te)return 0;try{return d.getVolumeLevel()}catch(ve){return console.error("Error getting volume level:",ve),0}},[d,te]);return{isVoiceEnabled:te,isScreenSharing:Q,isJoined:s,users:a,error:l,toggleVoice:ae,toggleScreenShare:me,mute:he,unmute:le,isUserSpeaking:Me,getVolumeLevel:Ge,microphoneTrack:d,screenTrack:j,isLoading:ee,channel:E,appId:v,joinChannel:w,leaveChannel:I,client:r,setMicrophoneDevice:async ve=>{try{if(!ve){console.error("No device ID provided");return}if(!r||!s){console.error("Client not initialized or not joined to a channel");return}d&&(te&&await r.unpublish(d),await d.close());const Be=await gR.createMicrophoneAudioTrack({microphoneId:ve,encoderConfig:"music_standard"});N&&await N(Be),te&&await r.publish(Be),console.log("Microphone device changed successfully")}catch(Be){throw console.error("Error changing microphone device:",Be),Be}},voiceDisabled:se}},F5e=({size:r="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:E,joinChannel:v,channel:T,client:w,voiceDisabled:I}=V5e(),[N,F]=L.useState(!1),[j,G]=L.useState(!1);L.useEffect(()=>{const K=()=>{Re.log("VoiceButton: Player instantiated, showing button"),G(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(Re.log("VoiceButton: Player was already instantiated"),G(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),L.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:T,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:j,voiceDisabled:I})},[d,E,T,w,j,I]);const H=async()=>{if(!(N||I)){F(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(Q){Q.message&&Q.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",Q)}console.log("VoiceButton: Toggling voice state from:",d);const K=await f();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{F(!1)}}},te=()=>I?"Voice chat is disabled for this space":j?N?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!j||I?null:O.jsx(eg,{label:te(),placement:t,hasArrow:!0,children:O.jsxs(kt,{position:"relative",cursor:"pointer",onClick:H,children:[O.jsx(vf,{size:r,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?O.jsx(iV,{color:"white"}):O.jsx(rV,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&O.jsx(kt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:O.jsx(Af,{size:"sm",color:"white"})})]})})},j5e=ti.createContext({user:null}),B5e=({userNickname:r})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Jie(),[f,E]=L.useState([]),[v,T]=L.useState(!1),[w,I]=L.useState(!0);L.useRef({});const N=L.useRef(null);L.useRef(null);const{user:F}=L.useContext(j5e)||{user:null},[j,G]=L.useState({}),H=L.useRef(a),[te,K]=L.useState(null),{isOpen:Q,onOpen:de,onClose:se}=ag(),[ge,ee]=L.useState(!1),Z=L.useRef(null),ne=L.useRef(null);L.useEffect(()=>{H.current=a},[a]),L.useEffect(()=>{if(!t||!s){T(!1);return}const Me=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const Ge=t.connectionState;if(console.log("Current connection state:",Ge),Ge==="CONNECTED")T(!0),I(!1);else{T(!1);const tt=Ee=>{console.log("Connection state changed:",Ee),Ee==="CONNECTED"?(T(!0),I(!1)):T(!1)};return t.on("connection-state-change",tt),()=>{t.off("connection-state-change",tt),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[t,s]),L.useEffect(()=>{const Me=async()=>{const Ge={...j};let tt=!1;for(const Ee of f){if(j[Ee.uid])continue;let we=null,ve=Ee.uid;if(typeof ve=="string"&&(ve.includes("-")?(we=ve.split("-")[0],ve=ve.split("-")[1]):ve.includes("_")&&(we=ve.split("_")[0],ve=ve.split("_")[1])),ve)try{console.log("Trying to fetch nickname for user ID:",ve);const Be=await Jh(ve);Be&&Be.Nickname?(console.log("Found nickname in Firebase for user ID:",ve,"Nickname:",Be.Nickname),Ge[Ee.uid]=Be.Nickname,tt=!0):we?(console.log("Using extracted name for user ID:",ve,"Name:",we),Ge[Ee.uid]=we,tt=!0):(Ge[Ee.uid]="User",tt=!0)}catch(Be){console.error("Error fetching user profile:",Be),we?(Ge[Ee.uid]=we,tt=!0):(Ge[Ee.uid]="User",tt=!0)}else we?(Ge[Ee.uid]=we,tt=!0):(Ge[Ee.uid]="User",tt=!0)}tt&&G(Ge)};f.length>0&&Me()},[f,j]),L.useEffect(()=>{if(!t||!s||!v)return;console.log("Setting up screen share event handlers");const Me=async(Ee,we)=>{if(console.log("User published:",Ee.uid,we,Ee),we==="video"){console.log("Remote video track detected:",Ee.uid);try{await t.subscribe(Ee,we),console.log("Subscribed to remote video track:",Ee.uid),E(ve=>ve.some(Be=>Be.uid===Ee.uid)?ve:[...ve,Ee])}catch(ve){console.error("Error subscribing to remote video track:",ve)}}},Ge=(Ee,we)=>{if(console.log("User unpublished:",Ee.uid,we),we==="video"){if(console.log("Remote video track unpublished:",Ee.uid),Ee.videoTrack)try{Ee.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(E(ve=>ve.filter(Be=>Be.uid!==Ee.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),H.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}}},tt=Ee=>{console.log("User left:",Ee.uid);const we=f.find(ve=>ve.uid===Ee.uid);if(we&&we.videoTrack)try{we.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(E(ve=>ve.filter(Be=>Be.uid!==Ee.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),H.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}};return t.on("user-published",Me),t.on("user-unpublished",Ge),t.on("user-left",tt),()=>{t.off("user-published",Me),t.off("user-unpublished",Ge),t.off("user-left",tt)}},[t,s,v,f,l]),L.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(Ge){console.error("Error playing video track:",Ge)}}),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),H.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[f,l]),L.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),L.useEffect(()=>()=>{if(f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(Ge){console.error("Error stopping video track on unmount:",Ge)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[f,a]);const ae=()=>{console.log("Stopping local screen share"),d()},me=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&F&&(Me===F.uid||Me===(t==null?void 0:t.uid))?r||"You":j[Me]?j[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),he=Me=>{console.log("Opening modal for remote screen",Me),K(Me),de()},le=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),de()};return L.useEffect(()=>{Q&&te?(console.log("Modal opened, activeScreen:",te),setTimeout(()=>{if(te.isLocal&&H.current)try{console.log("Playing local screen in modal"),H.current.play("modal-screen-container"),ee(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(te.videoTrack)try{console.log("Playing remote screen in modal"),te.videoTrack.play("modal-screen-container"),ee(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):Q||(ee(!1),K(null),setTimeout(()=>{if(l&&H.current)try{H.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(Ge){console.error(`Error playing remote screen ${Me.uid} in small container:`,Ge)}})},500))},[Q,te,l,f]),!v||w&&f.length===0&&!l||f.length===0&&!l?null:O.jsxs(O.Fragment,{children:[!Q&&O.jsxs(kt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Z,children:[l&&a&&O.jsxs(kt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[O.jsx(kt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),O.jsx(kt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:r?`${r}'s Screen`:"Your Screen"})]}),f.map(Me=>{const Ge=j[Me.uid]||me(Me.uid);return O.jsxs(kt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>he(Me),children:[O.jsx(kt,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),O.jsx(kt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${Ge}'s Screen`})]},Me.uid)})]}),Q&&O.jsx(kt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:se,children:O.jsxs(kt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!ge&&O.jsxs(kt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[O.jsx(Af,{size:"xl"}),O.jsx(Rt,{mt:4,children:"Loading screen share..."})]}),O.jsx(kt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:ne}),O.jsx(kt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:se,children:""}),O.jsx(kt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:te!=null&&te.isLocal?r?`${r}'s Screen`:"Your Screen":`${j[te==null?void 0:te.uid]||me(te==null?void 0:te.uid)}'s Screen`}),(te==null?void 0:te.isLocal)&&O.jsx(kt,{position:"absolute",bottom:4,right:4,children:O.jsx(Ps,{colorScheme:"red",size:"sm",onClick:ae,children:"Stop Sharing"})})]})})]})},W5e=({onClose:r})=>{const t=Zh(),[s,a]=L.useState(!1),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const T=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(T),window.removeEventListener("ScreenShareToggled",w)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),r&&r(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const T=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(T)}}catch(T){console.error("Error in screen share handler:",T),a(!1),t({title:"Screen sharing error",description:T.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(T,w)=>{a(!1),T?(d(w),t(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return O.jsx(Rt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function z5e({open:r,onClose:t}){const[s,a]=L.useState(0);return O.jsxs(Yc,{isOpen:r,onClose:t,size:"md",isCentered:!0,children:[O.jsx($c,{backdropFilter:"blur(4px)"}),O.jsxs(Xc,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[O.jsx(Td,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),O.jsx(Ol,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),O.jsx(Hc,{p:0,display:"flex",children:O.jsxs(DR,{orientation:"vertical",variant:"unstyled",index:s,onChange:a,display:"flex",flexGrow:1,children:[O.jsxs(LR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[O.jsxs(Tl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[O.jsx(Hn,{as:_5e,mb:1}),O.jsx(Rt,{fontSize:"xs",children:"Movement"})]}),O.jsxs(Tl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[O.jsx(Hn,{as:E5e,mb:1}),O.jsx(Rt,{fontSize:"xs",children:"Camera"})]}),O.jsxs(Tl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[O.jsx(Hn,{as:m5e,mb:1}),O.jsx(Rt,{fontSize:"xs",children:"Actions"})]}),O.jsxs(Tl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[O.jsx(Hn,{as:g5e,mb:1}),O.jsx(Rt,{fontSize:"xs",children:"Tips"})]})]}),O.jsxs(sN,{flexGrow:1,display:"flex",flexDirection:"column",children:[O.jsxs(yd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[O.jsx(Rt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),O.jsxs(Jo,{wrap:"wrap",gap:3,children:[O.jsx(vl,{keyLabel:"W",description:"Move Forward"}),O.jsx(vl,{keyLabel:"A",description:"Move Left"}),O.jsx(vl,{keyLabel:"S",description:"Move Backward"}),O.jsx(vl,{keyLabel:"D",description:"Move Right"}),O.jsx(vl,{keyLabel:"Shift",description:"Run"}),O.jsx(vl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),O.jsxs(yd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[O.jsx(Rt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),O.jsxs(Jo,{wrap:"wrap",gap:3,children:[O.jsx(vl,{keyLabel:"Mouse",description:"Look Around"}),O.jsx(vl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),O.jsx(vl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),O.jsxs(yd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[O.jsx(Rt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),O.jsxs(Jo,{wrap:"wrap",gap:3,children:[O.jsx(vl,{keyLabel:"E",description:"Interact"}),O.jsx(vl,{keyLabel:"F",description:"Emote Menu"}),O.jsx(vl,{keyLabel:"T",description:"Chat"}),O.jsx(vl,{keyLabel:"M",description:"Mute Mic"})]})]}),O.jsxs(yd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[O.jsx(Rt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),O.jsxs($i,{align:"stretch",spacing:2,children:[O.jsx(Rt,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),O.jsx(Rt,{fontSize:"xs",children:" Press ESC to access settings"}),O.jsx(Rt,{fontSize:"xs",children:" Click on players to view their profile"}),O.jsx(Rt,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const vl=({keyLabel:r,description:t})=>O.jsx(kt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:O.jsxs(wi,{spacing:2,children:[O.jsx(kt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:r}),O.jsx(Rt,{fontSize:"xs",children:t})]})}),G5e=()=>{const[r,t]=L.useState([]),[s,a]=L.useState(""),[l,d]=L.useState(0),[f,E]=L.useState(100),[v,T]=L.useState(100),[w,I]=L.useState(!0),[N,F]=L.useState(!0),[j,G]=L.useState(!1);L.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const se=await gR.getMicrophones();t(se),se.length>0&&a(se[0].deviceId)}catch(se){console.error("Error getting audio devices:",se)}})()},[]),L.useEffect(()=>{const de=setInterval(()=>{d(j?Math.random()*50:0)},100);return()=>clearInterval(de)},[j]);const H=de=>{const se=de.target.value;a(se),console.log("Microphone changed to:",se)},te=de=>{E(de),console.log("Microphone volume set to:",de)},K=de=>{T(de),console.log("Speaker volume set to:",de)},Q=()=>{G(!j)};return O.jsxs($i,{spacing:6,align:"stretch",children:[O.jsxs(Fs,{children:[O.jsxs(Ah,{children:["Microphone",O.jsx(af,{ml:2,colorScheme:j?"green":"red",children:j?"Enabled":"Muted"})]}),O.jsxs(Rte,{value:s,onChange:H,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[r.map(de=>O.jsx("option",{value:de.deviceId,children:de.label||`Microphone ${de.deviceId.slice(0,5)}...`},de.deviceId)),r.length===0&&O.jsx("option",{value:"",children:"No microphones found"})]})]}),O.jsxs(kt,{children:[O.jsx(Rt,{mb:2,children:"Microphone Level"}),O.jsx(ZS,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),O.jsxs(Fs,{children:[O.jsxs(Ah,{children:["Microphone Volume: ",f,"%"]}),O.jsxs(SU,{value:f,onChange:te,min:0,max:100,step:1,colorScheme:"blue",children:[O.jsx(bU,{bg:"gray.700",children:O.jsx(wU,{})}),O.jsx(TU,{boxSize:6})]})]}),O.jsxs(Fs,{children:[O.jsxs(Ah,{children:["Speaker Volume: ",v,"%"]}),O.jsxs(SU,{value:v,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[O.jsx(bU,{bg:"gray.700",children:O.jsx(wU,{})}),O.jsx(TU,{boxSize:6})]})]}),O.jsxs(Fs,{display:"flex",alignItems:"center",children:[O.jsx(Ah,{mb:"0",children:"Microphone Enabled"}),O.jsx(Zm,{isChecked:j,onChange:Q,colorScheme:"green",size:"lg"})]}),O.jsxs(Fs,{display:"flex",alignItems:"center",children:[O.jsx(Ah,{mb:"0",children:"Echo Cancellation"}),O.jsx(Zm,{isChecked:w,onChange:()=>I(!w),colorScheme:"green",size:"lg"})]}),O.jsxs(Fs,{display:"flex",alignItems:"center",children:[O.jsx(Ah,{mb:"0",children:"Noise Suppression"}),O.jsx(Zm,{isChecked:N,onChange:()=>F(!N),colorScheme:"green",size:"lg"})]}),O.jsxs(HS,{status:"info",borderRadius:"md",children:[O.jsx($S,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function H5e({open:r,onClose:t,containerRef:s}){return O.jsx(bu,{containerRef:s,children:O.jsxs(Yc,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[O.jsx($c,{}),O.jsxs(Xc,{bg:"gray.900",color:"white",borderRadius:"lg",children:[O.jsx(Td,{children:"Settings"}),O.jsx(Ol,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),O.jsx(Hc,{children:O.jsxs(DR,{variant:"enclosed",children:[O.jsxs(LR,{mb:4,children:[O.jsx(Tl,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),O.jsx(Tl,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),O.jsxs(sN,{children:[O.jsx(yd,{children:O.jsx(kt,{p:4,bg:"gray.800",borderRadius:"md",children:O.jsx(G5e,{})})}),O.jsx(yd,{children:O.jsx(kt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function $5e(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(r)}function K5e(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(r)}function US(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(r)}function q5e(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(r)}function Y5e(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(r)}function X5e(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(r)}function J5e(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(r)}function Bw(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(r)}function oV(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(r)}function JX(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(r)}function lO(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(r)}function Q5e(r){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(r)}const Z5e=({isOpen:r,onClose:t})=>{const{spaceID:s}=Kc(),[a,l]=L.useState(0),[d,f]=L.useState(null),[E,v]=L.useState(null),[T,w]=L.useState(!1),[I,N]=L.useState(0),[F,j]=L.useState(null),G=L.useRef(null),[H,te]=L.useState(null),[K,Q]=L.useState(null),[de,se]=L.useState(!1),[ge,ee]=L.useState(0),[Z,ne]=L.useState(null),ae=L.useRef(null),[me,he]=L.useState([]),[le,Me]=L.useState([]),[Ge,tt]=L.useState(!1),[Ee,we]=L.useState(!1),[ve,Be]=L.useState(!0),[Oe,be]=L.useState(!1),Ce=Zh();L.useEffect(()=>{r&&s&&ze()},[r,s]);const xe=async Pt=>{if(s&&r){tt(!0);try{const Dt=qre(),Te=`space_${s}_owners`,Ue=gX(Ak(Dt,"users"),_X("groups","array-contains",Te)),$e=await Ok(Ue),mt=[];for(const hn of $e.docs){const Yt=hn.data(),Bn=await Jh(hn.id);mt.push({uid:hn.id,email:Yt.email,displayName:Yt.displayName||Bn.Nickname||"Unknown User",photoURL:Yt.photoURL||Bn.photoURL,firstName:Bn.firstName,lastName:Bn.lastName})}he(mt);const Et=`space_${s}_hosts`,yt=gX(Ak(Dt,"users"),_X("groups","array-contains",Et)),zt=await Ok(yt),dn=[];for(const hn of zt.docs){const Yt=hn.data(),Bn=await Jh(hn.id);dn.push({uid:hn.id,email:Yt.email,displayName:Yt.displayName||Bn.Nickname||"Unknown User",photoURL:Yt.photoURL||Bn.photoURL,firstName:Bn.firstName,lastName:Bn.lastName})}Me(dn)}catch(Dt){Re.error("Error fetching space users:",Dt),Ce({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{tt(!1)}}},ze=async()=>{try{const Pt=await sg(s);Pt.logoUrl&&j(Pt.logoUrl),Pt.backgroundUrl&&ne(Pt.backgroundUrl),Pt.voiceDisabled!==void 0&&we(Pt.voiceDisabled),Pt.accessibleToAllUsers!==void 0&&Be(Pt.accessibleToAllUsers),xe(Pt)}catch(Pt){Re.error("Error fetching space data:",Pt),Ce({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};L.useEffect(()=>{s&&r&&a===3&&xe()},[s,r,a]);const Qe=Pt=>{const Dt=Pt.target.files[0];if(Dt){if(!Dt.type.startsWith("image/")){Ce({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}f(Dt);const Te=new FileReader;Te.onloadend=()=>{v(Te.result)},Te.readAsDataURL(Dt)}},et=Pt=>{const Dt=Pt.target.files[0];if(Dt){if(!Dt.type.startsWith("image/")){Ce({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}te(Dt);const Te=new FileReader;Te.onloadend=()=>{Q(Te.result)},Te.readAsDataURL(Dt)}},ut=async()=>{if(!d){Ce({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{w(!0);const Pt=setInterval(()=>{N(Te=>{const Ue=Te+10;return Ue>=90?90:Ue})},300),Dt=await lBe(s,d);clearInterval(Pt),N(100),j(Dt),Ce({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{f(null),v(null),N(0),w(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:Dt}}))}catch(Pt){console.error("Error uploading logo:",Pt),Ce({title:"Upload failed",description:Pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),w(!1),N(0)}},it=async()=>{if(!H){Ce({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{se(!0);const Pt=setInterval(()=>{ee(Te=>{const Ue=Te+10;return Ue>=90?90:Ue})},300),Dt=await dBe(s,H);clearInterval(Pt),ee(100),ne(Dt),Ce({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{te(null),Q(null),ee(0),se(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:Dt}}))}catch(Pt){console.error("Error uploading background:",Pt),Ce({title:"Upload failed",description:Pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),se(!1),ee(0)}},Ct=async()=>{if(F)try{w(!0),await uBe(s),j(null),Ce({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),w(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Pt){console.error("Error deleting logo:",Pt),Ce({title:"Deletion failed",description:Pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),w(!1)}},_n=async()=>{if(Z)try{se(!0),await hBe(s),ne(null),Ce({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),se(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Pt){console.error("Error deleting background:",Pt),Ce({title:"Deletion failed",description:Pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),se(!1)}},Vt=()=>{G.current&&G.current.click()},ln=()=>{ae.current&&ae.current.click()},xn=async()=>{be(!0);try{await pBe(s,{voiceDisabled:!Ee}),we(!Ee),Ce({title:"Settings Updated",description:`Voice chat has been ${Ee?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Pt){Re.error("Error updating voice settings:",Pt),Ce({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{be(!1)}},Xt=async()=>{be(!0);try{await fBe(s,!ve),Be(!ve),Ce({title:"Settings Updated",description:`Space is now ${ve?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Pt){Re.error("Error updating accessibility settings:",Pt),Ce({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{be(!1)}};return O.jsxs(Yc,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[O.jsx($c,{backdropFilter:"blur(4px)"}),O.jsxs(Xc,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",h:"500px",overflow:"hidden",children:[O.jsx(Td,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),O.jsx(Ol,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),O.jsx(Hc,{p:0,display:"flex",children:O.jsxs(DR,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",flexGrow:1,children:[O.jsxs(LR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[O.jsxs(Tl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[O.jsx(Hn,{as:US,mb:1}),O.jsx(Rt,{fontSize:"xs",children:"Logo"})]}),O.jsxs(Tl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[O.jsx(Hn,{as:K5e,mb:1}),O.jsx(Rt,{fontSize:"xs",children:"Background"})]}),O.jsxs(Tl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[O.jsx(Hn,{as:X5e,mb:1}),O.jsx(Rt,{fontSize:"xs",children:"Settings"})]}),O.jsxs(Tl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[O.jsx(Hn,{as:JX,mb:1}),O.jsx(Rt,{fontSize:"xs",children:"Users"})]})]}),O.jsxs(sN,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",children:[O.jsxs(yd,{p:4,display:"flex",flexDirection:"column",children:[O.jsx(Rt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),O.jsx(Rt,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(F||E)&&O.jsxs(Jo,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[F&&O.jsxs(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[O.jsx(Rt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),O.jsx(Dh,{src:F,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),O.jsx(Ps,{mt:3,colorScheme:"red",leftIcon:O.jsx(Hn,{as:Bw}),onClick:Ct,isLoading:T,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),E&&O.jsxs(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[O.jsx(Rt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),O.jsx(Dh,{src:E,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),O.jsxs(Fs,{children:[O.jsx(Ah,{fontSize:"xs",children:"Upload New Logo"}),O.jsx(Ra,{type:"file",accept:"image/*",onChange:Qe,ref:G,display:"none"}),T&&O.jsxs(kt,{mt:3,mb:3,children:[O.jsxs(Rt,{fontSize:"xs",mb:1,children:["Uploading... ",I,"%"]}),O.jsx(ZS,{value:I,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),O.jsxs(wi,{mt:3,spacing:3,children:[O.jsx(Ps,{colorScheme:"blue",leftIcon:O.jsx(Hn,{as:US}),onClick:Vt,isDisabled:T,size:"sm",variant:"outline",children:"Browse"}),O.jsx(Ps,{colorScheme:"green",leftIcon:O.jsx(Hn,{as:oV}),onClick:ut,isLoading:T,loadingText:"Uploading...",isDisabled:!d||T,size:"sm",children:"Upload"})]}),O.jsx(aU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),O.jsxs(yd,{p:4,display:"flex",flexDirection:"column",children:[O.jsx(Rt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),O.jsx(Rt,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Z||K)&&O.jsxs(Jo,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Z&&O.jsxs(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[O.jsx(Rt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),O.jsx(Dh,{src:Z,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),O.jsx(Ps,{mt:3,colorScheme:"red",leftIcon:O.jsx(Hn,{as:Bw}),onClick:_n,isLoading:de,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),K&&O.jsxs(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[O.jsx(Rt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),O.jsx(Dh,{src:K,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),O.jsxs(Fs,{children:[O.jsx(Ah,{fontSize:"xs",children:"Upload New Background"}),O.jsx(Ra,{type:"file",accept:"image/*",onChange:et,ref:ae,display:"none"}),de&&O.jsxs(kt,{mt:3,mb:3,children:[O.jsxs(Rt,{fontSize:"xs",mb:1,children:["Uploading... ",ge,"%"]}),O.jsx(ZS,{value:ge,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),O.jsxs(wi,{mt:3,spacing:3,children:[O.jsx(Ps,{colorScheme:"blue",leftIcon:O.jsx(Hn,{as:US}),onClick:ln,isDisabled:de,size:"sm",variant:"outline",children:"Browse"}),O.jsx(Ps,{colorScheme:"green",leftIcon:O.jsx(Hn,{as:oV}),onClick:it,isLoading:de,loadingText:"Uploading...",isDisabled:!H||de,size:"sm",children:"Upload"})]}),O.jsx(aU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),O.jsxs(yd,{p:4,display:"flex",flexDirection:"column",children:[O.jsx(Rt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),O.jsx(Rt,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),O.jsxs($i,{spacing:4,align:"stretch",children:[O.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:O.jsxs(wi,{justify:"space-between",align:"center",children:[O.jsxs(kt,{children:[O.jsxs(wi,{mb:1,spacing:2,children:[O.jsxs(kt,{position:"relative",w:"16px",h:"16px",children:[O.jsx(Hn,{as:Q5e,color:Ee?"red.400":"green.400"}),Ee&&O.jsx(kt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),O.jsx(Rt,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),O.jsx(Rt,{fontSize:"xs",color:"whiteAlpha.800",children:Ee?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),O.jsx(Zm,{isChecked:!Ee,onChange:xn,colorScheme:"green",size:"md",isDisabled:Oe})]})}),O.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:O.jsxs(wi,{justify:"space-between",align:"center",children:[O.jsxs(kt,{children:[O.jsxs(wi,{mb:1,spacing:2,children:[O.jsx(kt,{position:"relative",w:"16px",h:"16px",children:O.jsx(Hn,{as:JX,color:ve?"green.400":"red.400"})}),O.jsx(Rt,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),O.jsx(Rt,{fontSize:"xs",color:"whiteAlpha.800",children:ve?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),O.jsx(Rt,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),O.jsx(Zm,{isChecked:ve,onChange:Xt,colorScheme:"green",size:"md",isDisabled:Oe})]})}),O.jsxs(HS,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[O.jsx($S,{color:"blue.300"}),O.jsxs(kt,{children:[O.jsx(ik,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),O.jsx(sk,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),O.jsxs(yd,{p:4,display:"flex",flexDirection:"column",children:[O.jsx(Rt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),O.jsx(Rt,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Ge?O.jsx(Jo,{justify:"center",align:"center",h:"200px",children:O.jsx(Af,{color:"blue.300"})}):O.jsxs($i,{spacing:4,align:"stretch",children:[O.jsxs(kt,{children:[O.jsxs(wi,{mb:2,children:[O.jsx(Hn,{as:$5e,color:"green.400"}),O.jsx(Rt,{fontSize:"sm",fontWeight:"600",children:"Owners"}),O.jsx(af,{colorScheme:"green",ml:2,children:me.length})]}),O.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:me.length===0?O.jsx(Rt,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):O.jsx($i,{spacing:1,align:"stretch",children:me.map(Pt=>O.jsxs(wi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[O.jsx(vf,{size:"xs",src:Pt.photoURL,name:Pt.displayName}),O.jsxs(kt,{children:[O.jsx(Rt,{fontSize:"xs",children:Pt.displayName}),O.jsx(Rt,{fontSize:"xs",color:"whiteAlpha.600",children:Pt.firstName&&Pt.lastName?`${Pt.firstName} ${Pt.lastName}`:"Full name not available"})]}),O.jsx(lk,{}),O.jsx(af,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Pt.uid))})})]}),O.jsxs(kt,{children:[O.jsxs(wi,{mb:2,children:[O.jsx(Hn,{as:J5e,color:"purple.400"}),O.jsx(Rt,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),O.jsx(af,{colorScheme:"purple",ml:2,children:le.length})]}),O.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:le.length===0?O.jsx(Rt,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):O.jsx($i,{spacing:1,align:"stretch",children:le.map(Pt=>O.jsxs(wi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[O.jsx(vf,{size:"xs",src:Pt.photoURL,name:Pt.displayName}),O.jsxs(kt,{children:[O.jsx(Rt,{fontSize:"xs",children:Pt.displayName}),O.jsx(Rt,{fontSize:"xs",color:"whiteAlpha.600",children:Pt.firstName&&Pt.lastName?`${Pt.firstName} ${Pt.lastName}`:"Full name not available"})]}),O.jsx(lk,{}),O.jsx(af,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Pt.uid))})})]}),O.jsx(uE,{borderColor:"whiteAlpha.200"}),O.jsxs(HS,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[O.jsx($S,{color:"blue.300",boxSize:4}),O.jsxs(kt,{children:[O.jsx(ik,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),O.jsx(sk,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]})]})]})})]})]})},e6e=({onTogglePlayerList:r,spaceID:t})=>{const{fullscreenRef:s}=Cd(),[a,l]=L.useState(!0),[d,f]=L.useState(!1),[E,v]=L.useState(!1),[T,w]=L.useState(!1),[I,N]=L.useState(!1),[F,j]=L.useState(!1),[G,H]=L.useState(null),[te,K]=L.useState(!1),[Q,de]=L.useState(!1),[se,ge]=L.useState(!1),[ee,Z]=L.useState(!1),ne=Zh(),{user:ae}=L.useContext(wu),me=(ae==null?void 0:ae.Nickname)||"Unknown",[he,le]=L.useState(!1),Me=async()=>{if(ae!=null&&ae.uid&&t)try{const be=await Jh(ae.uid);let Ce=!1,xe=!1;if(be.groups){const Qe=`space_${t}_owners`,et=`space_${t}_hosts`;Ce=be.groups.includes(Qe),xe=be.groups.includes(et)}const ze=await aie(ae.uid,"disruptiveAdmin");if(Z(ze),H({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),de(Ce||ze),ge(xe),!Ce&&!ze&&te){K(!1);const Qe=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Qe),ne({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),de(!1),ge(!1),Z(!1)}else de(!1),ge(!1),Z(!1)};L.useEffect(()=>{Me()},[ae==null?void 0:ae.uid,t,te]),L.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),L.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&le(window.agoraClient.voiceDisabled)}catch(xe){console.error("Error checking if voice is disabled:",xe)}})();const Ce=xe=>{xe.detail&&typeof xe.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",xe.detail.voiceDisabled),le(xe.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ce),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ce)}},[]);const Ge=()=>v(!E),tt=()=>w(!T),Ee=()=>{j(!F),Be()},we=()=>{N(!1),Me()},ve=be=>{be.stopPropagation(),typeof r=="function"&&(Re.log("CanvasMainMenu: Toggling player list"),r())},Be=()=>{f(!1)},Oe=be=>{if(be.stopPropagation(),!Q){ne({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ce=!te;K(Ce);const xe=new CustomEvent("editModeChanged",{detail:{enabled:Ce}});window.dispatchEvent(xe),ne({title:Ce?"Edit Mode Enabled":"Edit Mode Disabled",description:Ce?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ce?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return O.jsxs(O.Fragment,{children:[O.jsxs(MF,{isOpen:d,onClose:()=>f(!1),children:[O.jsx(UF,{as:Ia,icon:O.jsx(o5e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!d)}),O.jsx(bu,{containerRef:s,children:O.jsx(VF,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:O.jsxs($i,{align:"stretch",spacing:4,children:[O.jsxs(wi,{children:[O.jsx(vf,{size:"md",src:G==null?void 0:G.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),O.jsxs($i,{align:"start",spacing:0,children:[O.jsxs(wi,{children:[O.jsx(Rt,{fontWeight:"bold",children:me}),Q&&!ee&&O.jsx(eg,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:O.jsx(kt,{display:"inline-block",children:O.jsx(Hn,{as:nV,color:"green.400",boxSize:3})})}),!Q&&se&&!ee&&O.jsx(eg,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:O.jsx(kt,{display:"inline-block",children:O.jsx(Hn,{as:sV,color:"purple.400",boxSize:3})})}),ee&&O.jsx(eg,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:O.jsx(kt,{display:"inline-block",children:O.jsx(Hn,{as:v5e,color:"blue.400",boxSize:3})})})]}),O.jsx(Rt,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),O.jsxs(wi,{spacing:4,justify:"center",children:[O.jsx(Ia,{icon:O.jsx(T5e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ve}),Q&&O.jsx(Ia,{icon:O.jsx(p5e,{}),variant:"ghost",colorScheme:te?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Oe}),O.jsx(Ia,{icon:O.jsx(kt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),O.jsx(Ia,{icon:O.jsx(kt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),O.jsx(uE,{borderColor:"whiteAlpha.300"}),O.jsxs($i,{align:"stretch",spacing:2,children:[Q&&O.jsxs(wi,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[O.jsx(Rt,{fontSize:"md",children:"Edit Mode"}),O.jsx(Zm,{id:"edit-mode-toggle",isChecked:te,onChange:Oe,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:te?"green.500":"black"}}})]}),Q&&O.jsx(Rt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Ee,children:"Manage Space"}),ae&&t&&!he&&O.jsx(W5e,{onClose:Be}),O.jsx(Rt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Ge,children:"Settings"}),O.jsx(Rt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:tt,children:"Controls"}),O.jsx(Rt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),O.jsx(Rt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),T&&O.jsx(z5e,{open:T,onClose:tt}),E&&O.jsx(H5e,{open:E,onClose:Ge}),I&&O.jsx(Hie,{open:I,onClose:we}),O.jsx(Z5e,{isOpen:F,onClose:Ee})]})},t6e=({isOpen:r,onClose:t,mediaScreenId:s,onImageChange:a})=>{const{spaceID:l}=Kc(),d=bg(),f=Zh(),E=L.useRef(null),v=L.useRef(null),T=L.useRef(),[w,I]=L.useState(null),[N,F]=L.useState(""),[j,G]=L.useState(!1),[H,te]=L.useState(0),[K,Q]=L.useState(null),[de,se]=L.useState(!0),[ge,ee]=L.useState(!1),[Z,ne]=L.useState(!1),[ae,me]=L.useState(0),[he,le]=L.useState("image"),[Me,Ge]=L.useState(""),[tt,Ee]=L.useState(!1);L.useEffect(()=>{(async()=>{if(r&&s&&l){se(!0);try{const Ct=await df(l,s);if(Ct&&(Ct.imageUrl||Ct.videoUrl)){Q(Ct);const _n=Ct.mediaType==="video";le(_n?"video":"image"),Ee(Ct.displayAsVideo||!1),_n&&Ct.videoUrl&&(Ge(Ct.videoUrl),me(1))}else Q(null)}catch(Ct){Re.error("Error fetching existing image:",Ct),Q(null)}finally{se(!1)}}})()},[r,s,l]),L.useEffect(()=>{r||(I(null),F(""),te(0),Ge(""))},[r]);const we=L.useCallback(it=>{it.preventDefault(),it.stopPropagation(),ne(!0)},[]),ve=L.useCallback(it=>{it.preventDefault(),it.stopPropagation(),ne(!1)},[]),Be=L.useCallback(it=>{it.preventDefault(),it.stopPropagation()},[]),Oe=L.useCallback(it=>{if(it.preventDefault(),it.stopPropagation(),ne(!1),it.dataTransfer.files&&it.dataTransfer.files.length>0){const Ct=it.dataTransfer.files[0];be(Ct)}},[]);L.useEffect(()=>{const it=v.current;if(it)return it.addEventListener("dragenter",we),it.addEventListener("dragleave",ve),it.addEventListener("dragover",Be),it.addEventListener("drop",Oe),()=>{it.removeEventListener("dragenter",we),it.removeEventListener("dragleave",ve),it.removeEventListener("dragover",Be),it.removeEventListener("drop",Oe)}},[we,ve,Be,Oe]);const be=it=>{if(!it)return;if(!it.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(it);const Ct=new FileReader;Ct.onloadend=()=>{F(Ct.result)},Ct.readAsDataURL(it)},Ce=it=>{const Ct=it.target.files[0];be(Ct)},xe=async it=>{const Ct=it.target.checked;if(Ee(Ct),K)try{await DBe(l,s,Ct),Ct?d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),Q({...K,displayAsVideo:Ct}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${Ct?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),Re.log(`Updated display mode for media screen ${s} to ${Ct?"video":"image"}`),a&&a({type:"update",mediaScreenId:s,displayAsVideo:Ct})}catch(_n){Re.error("Error updating display mode:",_n),f({title:"Update failed",description:_n.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),Ee(!Ct)}},ze=async()=>{if(he==="image"&&!w){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(he==="video"&&!Me){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{G(!0);const it=setInterval(()=>{te(ln=>{const xn=ln+10;return xn>=90?90:xn})},300);let Ct;he==="image"?Ct=await UX(l,s,w,{mediaType:he,displayAsVideo:tt}):(Ct=Me,await UX(l,s,null,{mediaType:"video",directUrl:Me,displayAsVideo:tt})),clearInterval(it),te(100);let _n=null,Vt=null;he==="image"?(_n=tt?null:Ct,Vt=(K==null?void 0:K.videoUrl)||null):(_n=!tt&&(K!=null&&K.imageUrl)?K.imageUrl:null,Vt=Ct),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:_n,videoUrl:Vt,mediaType:he,displayAsVideo:tt}),Re.log(`Uploaded and sent ${he} for media screen ${s} (display as video: ${tt})`),a&&a({type:"upload",mediaScreenId:s,imageUrl:he==="image"?Ct:K==null?void 0:K.imageUrl,videoUrl:he==="video"?Ct:K==null?void 0:K.videoUrl,mediaType:he,displayAsVideo:tt}),f({title:"Upload successful",description:`The ${he} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),F(""),G(!1),te(0),t()},1e3)}catch(it){Re.error(`Error uploading ${he}:`,it),f({title:"Upload failed",description:it.message||`An error occurred while uploading the ${he}`,status:"error",duration:5e3,isClosable:!0}),G(!1),te(0)}},Qe=async()=>{ee(!1);try{G(!0),await NBe(l,s),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:he==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:he==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),Re.log(`Deleted ${he} for media screen ${s}`),a&&a({type:"delete",mediaScreenId:s}),f({title:`${he==="image"?"Image":"Video"} deleted`,description:`The ${he} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),Q(null),G(!1),Ge(""),Ee(!1),setTimeout(()=>{t()},500)}catch(it){Re.error(`Error deleting ${he}:`,it),f({title:"Deletion failed",description:it.message||`An error occurred while deleting the ${he}`,status:"error",duration:5e3,isClosable:!0}),G(!1)}},et=()=>{j||(I(null),F(""),te(0),t())},ut=it=>{me(it),le(it===0?"image":"video")};return O.jsxs(O.Fragment,{children:[O.jsxs(Yc,{isOpen:r,onClose:et,size:"xl",children:[O.jsx($c,{backdropFilter:"blur(10px)"}),O.jsxs(Xc,{bg:"gray.800",color:"white",maxW:"900px",children:[O.jsx(Td,{children:"Media Screen Content"}),O.jsx(Ol,{isDisabled:j}),O.jsxs(kt,{px:6,pb:2,children:[O.jsxs(Jo,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[O.jsxs(wi,{spacing:4,children:[O.jsx(Rt,{fontWeight:"medium",children:"Display as:"}),O.jsxs(wi,{spacing:2,children:[O.jsx(Hn,{as:US,color:tt?"gray.400":"green.300"}),O.jsx(Zm,{colorScheme:"purple",size:"md",isChecked:tt,onChange:xe}),O.jsx(Hn,{as:lO,color:tt?"purple.300":"gray.400"})]})]}),O.jsx(af,{colorScheme:tt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:tt?"Video Output":"Image Output"})]}),O.jsxs(Rt,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",O.jsx("strong",{children:s})]}),O.jsx(Rt,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),O.jsx(uE,{mb:4})]}),O.jsx(Hc,{children:O.jsxs(Jo,{children:[O.jsx(DR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:ae,onChange:ut,h:"100%",minW:"120px",mr:4,children:O.jsxs(LR,{children:[O.jsxs(Tl,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[O.jsx(Hn,{as:US,mr:2})," Image"]}),O.jsxs(Tl,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[O.jsx(Hn,{as:lO,mr:2})," Video"]})]})}),O.jsx(kt,{flex:"1",children:de?O.jsx(Jo,{justify:"center",align:"center",h:"150px",children:O.jsx(Af,{size:"xl",color:"blue.400"})}):O.jsxs(O.Fragment,{children:[O.jsx(kt,{children:ae===0?O.jsxs($i,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&he==="image"&&O.jsxs(kt,{children:[O.jsx(Rt,{fontWeight:"semibold",mb:2,children:"Current Image:"}),O.jsxs(Jo,{children:[O.jsx(kt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:O.jsx(Dh,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),O.jsxs($i,{align:"flex-start",spacing:2,children:[O.jsxs(Rt,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),O.jsxs(Rt,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),O.jsx(Ps,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:O.jsx(Hn,{as:Bw}),onClick:()=>ee(!0),isDisabled:j,children:"Delete"})]})]}),O.jsx(uE,{my:4})]}),O.jsx(Rt,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&he==="image"?"Replace with new image:":"Upload new image:"}),O.jsxs(kt,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Z?"blue.400":"gray.500",bg:Z?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>E.current.click(),children:[N?O.jsx(kt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:O.jsx(Dh,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):O.jsxs($i,{spacing:2,children:[O.jsx(Hn,{as:oV,boxSize:"24px",color:"gray.400"}),O.jsx(Rt,{children:"Drag and drop an image here, or click to browse"}),O.jsx(Rt,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),O.jsx(Ra,{type:"file",accept:"image/*",onChange:Ce,ref:E,display:"none"})]}),w&&O.jsxs(Rt,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):O.jsxs($i,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&he==="video"&&O.jsxs(kt,{children:[O.jsx(Rt,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),O.jsxs(Jo,{children:[O.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:O.jsx(Rt,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),O.jsxs($i,{align:"flex-start",spacing:2,children:[O.jsxs(Rt,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),O.jsxs(Rt,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),O.jsx(Ps,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:O.jsx(Hn,{as:Bw}),onClick:()=>ee(!0),isDisabled:j,children:"Delete"})]})]}),O.jsx(uE,{my:4})]}),O.jsx(Rt,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&he==="video"?"Replace with new video:":"Add video URL:"}),O.jsx(kt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:O.jsxs(wi,{children:[O.jsx(Hn,{as:q5e,color:"blue.300"}),O.jsx(Rt,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),O.jsxs(Fs,{children:[O.jsx(Ah,{fontSize:"sm",children:"Video URL"}),O.jsx(Ra,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Me,onChange:it=>Ge(it.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),O.jsx(Rt,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),O.jsxs(kt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[O.jsxs(wi,{children:[O.jsx(Hn,{as:lO,color:"blue.300"}),O.jsx(Rt,{fontWeight:"medium",children:"Video Support"})]}),O.jsx(Rt,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),O.jsx(Rt,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Me&&O.jsxs(kt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[O.jsxs(wi,{mb:2,children:[O.jsx(Hn,{as:Y5e,color:"blue.300"}),O.jsx(Rt,{fontWeight:"medium",children:"URL Preview"})]}),O.jsx(Rt,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Me}),O.jsx(Rt,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),j&&O.jsxs(kt,{mt:4,children:[O.jsxs(Rt,{mb:2,children:["Uploading: ",H,"%"]}),O.jsx(ZS,{value:H,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),O.jsxs(QS,{children:[O.jsx(Ps,{variant:"ghost",mr:3,onClick:et,isDisabled:j,children:"Cancel"}),O.jsx(Ps,{colorScheme:"blue",onClick:ze,isLoading:j,loadingText:"Uploading",isDisabled:he==="image"&&!w||he==="video"&&!Me||j||de,leftIcon:O.jsx(Hn,{as:he==="image"?US:lO}),size:"lg",px:6,children:he==="image"?"Upload Image":"Save Video URL"})]})]})]}),O.jsx(WLe,{isOpen:ge,leastDestructiveRef:T,onClose:()=>ee(!1),children:O.jsx($c,{children:O.jsxs(zLe,{bg:"gray.800",color:"white",children:[O.jsxs(Td,{fontSize:"lg",fontWeight:"bold",children:["Delete ",he==="video"?"Video":"Image"]}),O.jsxs(Hc,{children:["Are you sure you want to delete this ",he,"? This will revert the media screen to its blank state."]}),O.jsxs(QS,{children:[O.jsx(Ps,{ref:T,onClick:()=>ee(!1),children:"Cancel"}),O.jsx(Ps,{colorScheme:"red",onClick:Qe,ml:3,leftIcon:O.jsx(Hn,{as:Bw}),children:"Delete"})]})]})})})]})},n6e=r=>{const[t,s]=L.useState(null),[a,l]=L.useState(""),[d,f]=L.useState(null),[E,v]=L.useState(!1),T=kf(),{spaceID:w}=Kc(),I=L.useCallback(j=>{var G,H;try{if(!j)return null;if(j.includes("youtube.com")||j.includes("youtu.be")){let te="";return j.includes("youtube.com/watch")?te=new URLSearchParams(new URL(j).search).get("v"):j.includes("youtu.be/")&&(te=j.split("youtu.be/")[1].split("?")[0]),te?`https://www.youtube.com/embed/${te}?autoplay=1`:j}if(j.includes("vimeo.com")){if(j.includes("player.vimeo.com/video"))return j;const te=(H=(G=j.split("vimeo.com/")[1])==null?void 0:G.split("?")[0])==null?void 0:H.split("/")[0];return te?`https://player.vimeo.com/video/${te}?autoplay=1`:j}return j}catch(te){return Re.error("Error converting to embed URL:",te),j}},[]),N=L.useCallback(()=>{setTimeout(()=>{v(!1),Re.log("Video processing state reset")},100)},[]);L.useEffect(()=>{let j=!0,G=null;const te=T("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",r),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:Q,videoUrl:de}=K||{};if(!Q){Re.error("Media screen ID is missing in Unity event data."),N();return}if(r){console.log(`[DEBUG] Edit mode is active for screen ${Q}, setting ID but not playing video`),Re.log("Edit mode is active, setting media screen ID but not playing video"),f(Q);return}if(v(!0),G=setTimeout(()=>{j&&(Re.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),de){if(console.log(`Using direct video URL from event: ${de}`),j)try{const se=I(de);console.log(`Setting video URL to: ${se} (original: ${de})`),s(se),l(`Media Screen ${Q}`),f(Q),Re.log("Media screen video URL set directly from event:",se)}catch(se){Re.error("Error setting video URL from direct URL:",se)}finally{N(),clearTimeout(G)}return}console.log(`Fetching media screen data for ID: ${Q}`);try{const se=await df(w,Q);if(console.log("Media screen data from Firestore:",se),!se||!se.videoUrl){Re.error("No video URL found for media screen:",Q),N(),clearTimeout(G);return}if(!se.displayAsVideo){Re.log("Media screen is not set to display as video:",Q),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(G);return}if(j)try{const ge=I(se.videoUrl);console.log(`Setting video URL to: ${ge} (original: ${se.videoUrl})`),s(ge),l(se.title||`Media Screen ${Q}`),f(Q),Re.log("Media screen video URL set to:",ge)}catch(ge){Re.error("Error setting video URL from Firestore:",ge)}finally{N(),clearTimeout(G)}}catch(se){Re.error(`Error fetching media screen data for ${Q}:`,se),N(),clearTimeout(G)}}catch(Q){Re.error("Error handling media screen video play:",Q),console.error("Error handling media screen video play:",Q),N(),clearTimeout(G)}});return()=>{j=!1,G&&clearTimeout(G),te()}},[T,w,r,I,N]);const F=L.useCallback(()=>{s(null),l(""),f(null),v(!1),Re.log("Video player state reset")},[]);return[t,a,d,F,E]},r6e=()=>{const{spaceID:r}=Kc(),t=bg(),s=kf(),[a,l]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Re.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const T=()=>{Re.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",T),()=>{window.removeEventListener("PlayerInstantiated",T)}},[]);const d=L.useCallback(async T=>{try{return T.includes("vimeo.com")?await f(T):T.includes("youtube.com")||T.includes("youtu.be")?await E(T):"https://via.placeholder.com/640x360?text=Video"}catch(w){return Re.error(`Error fetching thumbnail for ${T}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async T=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(T)}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const N=await I.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let G=null;for(let H of j){const te=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(te,{method:"HEAD"})).ok){G=te;break}}catch(K){Re.warn(`Failed to validate thumbnail URL: ${te}`,K)}}return G||N.thumbnail_url}catch(w){return Re.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},E=async T=>{let w="";if(T.includes("youtube.com/watch")?w=new URLSearchParams(new URL(T).search).get("v"):T.includes("youtu.be/")&&(w=T.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(N){Re.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,N)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=L.useCallback(async T=>{try{if(!r||!T)return;Re.log(`Refreshing thumbnail for media screen ${T}`);const w=await df(r,T);if(!w){Re.log(`No media screen found with ID ${T}`);return}if(Re.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){Re.log(`Media screen ${T} is not set to display as video or has no video URL`);return}const I=await d(w.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:T,thumbnailUrl:I}),Re.log(`Sent refreshed thumbnail for media screen ${T}: ${I}`)}catch(w){Re.error(`Error refreshing thumbnail for media screen ${T}:`,w)}},[r,d,t]);L.useEffect(()=>{if(!a){Re.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}Re.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=s("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:N,thumbnailUrl:F}=I;F==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{w()}},[s,v,a]),L.useEffect(()=>{if(!a){Re.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}Re.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const T=async()=>{try{if(!r)throw new Error("spaceID is not defined.");Re.log("Fetching media screens for thumbnails...");const I=await Wj(r);Re.log("All media screens:",I);const N=I.filter(G=>G.displayAsVideo&&G.videoUrl);if(Re.log("Media screens set to display as videos:",N),N.length===0){Re.log("No media screens set to display as videos found.");return}Re.log(`Found ${N.length} media screens set to display as videos.`);const F=N.map(async G=>{try{const H=await d(G.videoUrl);return Re.log(`Fetched thumbnail for ${G.id}: ${H}`),{mediaScreenId:G.id,thumbnailUrl:H}}catch(H){return Re.error(`Error processing thumbnail for media screen ${G.id}:`,H),{mediaScreenId:G.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),j=await Promise.all(F);Re.log("Fetched Media Screen Thumbnails",j),j.forEach(({mediaScreenId:G,thumbnailUrl:H})=>{t("SetMediaScreenThumbnail",{mediaScreenId:G,thumbnailUrl:H}),Re.log(`Sent thumbnail to Unity for media screen ${G}: ${H}`)})}catch(I){Re.error("Error fetching media screen thumbnails:",I)}};T();const w=setInterval(T,5*60*1e3);return()=>{clearInterval(w)}},[t,r,d,a])},QX={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},i6e=()=>O.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),s6e=({videoUrl:r,videoTitle:t,mediaScreenId:s,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Cd();return ON(a,`video-modal-${s}`),L.useEffect(()=>{if(a){const f=T=>{T.target.classList&&T.target.classList.contains("chakra-modal__overlay")&&(T.stopPropagation(),T.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const E=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(E&&(E.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(T){console.error("Error disabling Unity input:",T)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),E&&(E.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(T){console.error("Error re-enabling Unity input:",T)}}}},[a]),O.jsxs(O.Fragment,{children:[O.jsx(i6e,{}),O.jsxs(Yc,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${s}`,children:[O.jsx($c,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),O.jsxs(Xc,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[O.jsx(Ol,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),O.jsx(Hc,{p:0,width:"100%",children:r?O.jsx(kt,{className:"iframe-container",style:QX.iframeContainer,children:O.jsx("iframe",{className:"video-iframe",src:r,style:QX.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):O.jsxs(Jo,{direction:"column",align:"center",justify:"center",h:"400px",children:[O.jsx(Af,{size:"xl",mb:4}),O.jsx(Rt,{children:"Unable to load video"}),O.jsx(Rt,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Cs=(...r)=>{},o6e=()=>{const{isOpen:r,onOpen:t,onClose:s}=ag(),[a,l]=L.useState(null),[d,f]=L.useState("image"),E=L.useRef(null);ON(r,"image-viewer-modal");const v=L.useCallback(I=>{I.stopPropagation()},[]);return L.useEffect(()=>{if(r&&E.current){const I=E.current;I.addEventListener("mousemove",v),I.addEventListener("mousedown",v),I.addEventListener("mouseup",v),I.addEventListener("wheel",v);const N=document.getElementById("unity-canvas");return N&&(N.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",v),I.removeEventListener("mousedown",v),I.removeEventListener("mouseup",v),I.removeEventListener("wheel",v),N&&(N.style.pointerEvents="auto")}}},[r,v]),{isOpen:r,currentImageUrl:a,currentMediaType:d,openImageViewer:(I,N="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${N}`);const F=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),j=F?"image":N;console.log(`[DEBUG] Detected URL as ${F?"image":"non-image"}, using media type: ${j}`),l(I),f(j),t()},closeImageViewer:()=>{s(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:E,preventPropagation:v}},a6e=()=>O.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),R2=r=>{if(!r)return null;try{if(r.includes("firebasestorage.googleapis.com")){const t=new URL(r),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),Cs(`Cleaned Firebase URL from ${r} to ${t.toString()}`),t.toString()}return r}catch(t){return console.error("Error cleaning Firebase URL:",t),r}},c6e=()=>{const{spaceID:r}=Kc(),[t,s]=L.useState(!1),[a,l]=L.useState([]),[d,f]=L.useState(null),{isOpen:E,onOpen:v,onClose:T}=ag(),[w,I]=L.useState({}),[N,F]=L.useState(0);L.useRef(null);const j=bg(),{fullscreenRef:G}=Cd(),H=kf(),[te,K]=L.useState(!1),{isOpen:Q,currentImageUrl:de,currentMediaType:se,openImageViewer:ge,closeImageViewer:ee,modalContentRef:Z,preventPropagation:ne}=o6e(),[ae,me,he,le,Me]=n6e(t),{isOpen:Ge,onOpen:tt,onClose:Ee}=ag();r6e(),Oie(),L.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const be=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]);const we=L.useCallback(be=>{if(Array.isArray(a)&&a.length>0){const Ce=a.find(xe=>xe.mediaScreenId===be);if(Ce){const xe=Ce.imageUrl,ze=Ce.videoUrl;return{screen:Ce,imageUrl:xe,videoUrl:ze,mediaType:Ce.mediaType||"image",displayAsVideo:Ce.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(de){let Ce=null;return Array.isArray(a)&&(Ce=a.find(xe=>xe.mediaScreenId===be)),{screen:Ce||{mediaScreenId:be},imageUrl:de,videoUrl:null,mediaType:(Ce==null?void 0:Ce.mediaType)||"image",displayAsVideo:(Ce==null?void 0:Ce.displayAsVideo)||!1}}return r&&be&&df(r,be).then(Ce=>{Ce&&l(xe=>Array.isArray(xe)&&xe.some(Qe=>Qe.mediaScreenId===be)?xe.map(Qe=>Qe.mediaScreenId===be?{...Qe,imageUrl:Ce.imageUrl,videoUrl:Ce.videoUrl,mediaType:Ce.mediaType||"image",displayAsVideo:Ce.displayAsVideo||!1,hasImage:!!Ce.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Qe):[...Array.isArray(xe)?xe:[],{mediaScreenId:be,imageUrl:Ce.imageUrl,videoUrl:Ce.videoUrl,mediaType:Ce.mediaType||"image",displayAsVideo:Ce.displayAsVideo||!1,hasImage:!!Ce.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ce=>{console.error(`Error fetching media screen data for ${be}:`,Ce)}),console.warn("No screen data found for:",be),null},[a,de,r,l]),ve=L.useCallback(be=>{if(console.log(`[DEBUG] Processing click on screen: ${be}, isEditMode: ${t}`),f(be),t)console.log(`[DEBUG] Opening upload modal for screen: ${be} in edit mode`),v();else{const Ce=we(be);if(Ce){if(console.log(`[DEBUG] Screen data for ${be}:`,Ce),Cs("Screen data details:",{mediaScreenId:be,imageUrl:Ce.imageUrl,videoUrl:Ce.videoUrl,mediaType:Ce.mediaType,displayAsVideo:Ce.displayAsVideo}),Ge&&he===be)return;if(Ce.displayAsVideo&&Ce.videoUrl)Cs(`Opening video player for: ${Ce.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ce.videoUrl});else if(Ce.imageUrl){Cs(`Opening viewer modal with ${Ce.mediaType}: ${Ce.imageUrl}`);const ze=R2(Ce.imageUrl);ge(ze,Ce.mediaType||"image")}else r&&df(r,be).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)Cs(`Opening video player for: ${ze.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:ze.videoUrl});else if(ze.imageUrl){Cs(`Opening viewer modal with image: ${ze.imageUrl}`);const Qe=R2(ze.imageUrl);ge(Qe,ze.mediaType||"image")}l(Qe=>Array.isArray(Qe)&&Qe.some(ut=>ut.mediaScreenId===be)?Qe.map(ut=>ut.mediaScreenId===be?{...ut,...ze,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:ut):[...Array.isArray(Qe)?Qe:[],{...ze,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${be}:`,ze)})}else r&&df(r,be).then(xe=>{if(xe){if(xe.displayAsVideo&&xe.videoUrl)Cs(`Opening video player for: ${xe.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:xe.videoUrl});else if(xe.imageUrl){Cs(`Opening viewer modal with image: ${xe.imageUrl}`);const ze=R2(xe.imageUrl);ge(ze,xe.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(et=>et.mediaScreenId===be)?ze.map(et=>et.mediaScreenId===be?{...et,...xe,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:et):[...Array.isArray(ze)?ze:[],{...xe,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(xe=>{console.error(`Error fetching media screen data for ${be}:`,xe)})}},[t,v,we,Ge,he,j,ge,r]);L.useEffect(()=>{if(!te)return;const be=async()=>{if(r)try{const xe=await Wj(r),ze={};xe.forEach(Qe=>{Qe.id&&Qe.imageUrl&&(ze[Qe.id]=Qe.imageUrl)}),l(Qe=>Qe.map(et=>{const ut=!!ze[et.mediaScreenId],it=ze[et.mediaScreenId],Ct=et.mediaType||"image";return{...et,hasImage:ut,imageUrl:it,mediaType:Ct}}))}catch(xe){console.error("Error fetching media screen images:",xe)}};be();let Ce=null;return t&&(Ce=setInterval(be,5e3)),()=>{Ce&&clearInterval(Ce)}},[r,t,N,te]);const Be=be=>{l(Ce=>Ce.map(xe=>{if(xe.mediaScreenId===be.mediaScreenId){if(be.type==="upload")return{...xe,hasImage:!0,imageUrl:be.imageUrl,mediaType:be.mediaType||"image"};if(be.type==="delete")return{...xe,hasImage:!1,imageUrl:null,mediaType:null}}return xe})),be.type==="delete"?(setTimeout(()=>{l(Ce=>Ce.filter(xe=>xe.mediaScreenId!==be.mediaScreenId))},100),setTimeout(()=>{l(Ce=>Ce.filter(xe=>xe.mediaScreenId!==be.mediaScreenId))},1500)):setTimeout(()=>{l(Ce=>Ce.some(ze=>ze.mediaScreenId===be.mediaScreenId)?Ce.map(ze=>ze.mediaScreenId===be.mediaScreenId?{...ze,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image"}:ze):[...Ce,{mediaScreenId:be.mediaScreenId,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};L.useEffect(()=>{const be=Ce=>{const xe=Ce.detail.enabled;s(xe),xe?j("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):j("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",be),()=>{window.removeEventListener("editModeChanged",be)}},[j]),L.useEffect(()=>(window.JsSendMediaScreenClick=function(be){console.log("Unity: MediaScreenClick received with data:",be);try{const Ce=JSON.parse(be),xe=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ce)});window.dispatchEvent(xe)}catch(Ce){console.error("Error processing MediaScreenClick data:",Ce)}},window.handleMediaScreenClick=function(be){console.log("Direct call to handleMediaScreenClick with ID:",be),ve(be)},window.TestJavaScriptFromUnity=function(be){console.log("Unity called TestJavaScriptFromUnity with:",be),alert("Unity called JavaScript: "+be)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ve]),L.useEffect(()=>{const be=ze=>{try{const Qe=JSON.parse(ze.detail);Re.log(`MediaScreen registered: ${Qe.mediaScreenId}`),Cs("MediaScreen registered from Unity:",Qe),l(ut=>ut.some(Ct=>Ct.mediaScreenId===Qe.mediaScreenId)?ut.map(Ct=>Ct.mediaScreenId===Qe.mediaScreenId?{...Ct,...Qe,source:"event",lastUpdated:new Date().toISOString()}:Ct):[...ut,{...Qe,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:Qe.mediaScreenId,enabled:!0,showUploadIcon:!0});const et=Qe.mediaScreenId;et&&df(r,et).then(ut=>{ut&&(Cs(`Media screen data for ${et}:`,ut),ut.displayAsVideo&&ut.videoUrl&&(Cs(`Media screen ${et} should display as video, sending null imageUrl`),j("SetMediaScreenImage",{mediaScreenId:et,imageUrl:null,displayAsVideo:!0})))}).catch(ut=>{console.error(`Error fetching media screen data for ${et}:`,ut)})}catch(Qe){console.error("Error handling MediaScreen registration:",Qe)}},Ce=ze=>{try{Cs("MediaScreenClick event received:",ze);let Qe;if(typeof ze=="string")Qe=ze,Cs("MediaScreenClick: Direct call with ID:",Qe);else{Cs("MediaScreenClick: Event from Unity:",ze),Cs("MediaScreenClick: Event detail:",ze.detail);try{Qe=JSON.parse(ze.detail).mediaScreenId,Cs("MediaScreenClick: Parsed mediaScreenId:",Qe)}catch(et){if(console.error("MediaScreenClick: Error parsing event detail:",et),ze.detail&&ze.detail.mediaScreenId)Qe=ze.detail.mediaScreenId,Cs("MediaScreenClick: Using direct mediaScreenId from detail:",Qe);else throw new Error("Could not extract mediaScreenId from event")}}Re.log(`MediaScreen clicked: ${Qe}`),Cs("MediaScreen clicked:",Qe),ve(Qe)}catch(Qe){console.error("Error handling MediaScreen click:",Qe)}},xe=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")be({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Ce({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const Qe=JSON.parse(ze.detail.eventData);Qe.mediaScreenId&&(Cs("SetMediaScreenImage event received:",Qe),l(et=>Array.isArray(et)&&et.some(it=>it.mediaScreenId===Qe.mediaScreenId)?et.map(it=>it.mediaScreenId===Qe.mediaScreenId?{...it,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:it):[...Array.isArray(et)?et:[],{mediaScreenId:Qe.mediaScreenId,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Qe){console.error("Error handling SetMediaScreenImage event:",Qe)}};return window.addEventListener("RegisterMediaScreen",be),window.addEventListener("MediaScreenClick",Ce),window.addEventListener("reactUnityEvent",xe),()=>{window.removeEventListener("RegisterMediaScreen",be),window.removeEventListener("MediaScreenClick",Ce),window.removeEventListener("reactUnityEvent",xe)}},[t,v,j,a,Q,Ge,ge,ve,r]),L.useEffect(()=>{const be=Ce=>{try{Cs("Direct MediaScreenClick event received:",Ce);let xe;if(Ce.detail)try{xe=JSON.parse(Ce.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!xe){console.error("No mediaScreenId found in MediaScreenClick event");return}Cs(`Direct handler: Processing click for media screen ${xe}`),ve(xe)}catch(xe){console.error("Error in direct MediaScreenClick handler:",xe)}};return window.addEventListener("MediaScreenClick",be),()=>{window.removeEventListener("MediaScreenClick",be)}},[ve]),L.useEffect(()=>{ae&&tt()},[ae,tt]);const Oe=()=>{le(),Ee()};return L.useEffect(()=>{const Ce=H("RegisterMediaScreen",xe=>{try{if(Re.log("Direct RegisterMediaScreen event received with data:",xe),!xe||!xe.mediaScreenId){Re.warn("RegisterMediaScreen event received with invalid data");return}const ze=xe.mediaScreenId;Re.log(`Media screen registered directly: ${ze}`),l(Qe=>Qe.some(ut=>ut.mediaScreenId===ze)?Qe.map(ut=>ut.mediaScreenId===ze?{...ut,...xe,source:"direct-event",lastUpdated:new Date().toISOString()}:ut):[...Qe,{...xe,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Ce()}},[H,t,j]),L.useEffect(()=>{const Ce=H("MediaScreenClick",xe=>{try{if(Re.log("Direct MediaScreenClick event received with data:",xe),!xe||!xe.mediaScreenId){Re.warn("MediaScreenClick event received with invalid data");return}const ze=xe.mediaScreenId;Re.log(`Media screen clicked directly: ${ze}`),ve(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Ce()}},[H,ve]),L.useEffect(()=>{t&&he&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${he}`),f(he),v(),le())},[t,he,v,le]),O.jsxs(O.Fragment,{children:[O.jsx(t6e,{isOpen:E,onClose:T,mediaScreenId:d,onImageChange:Be}),O.jsx(a6e,{}),O.jsx(bu,{containerRef:G,children:O.jsxs(Yc,{isOpen:Q,onClose:ee,size:"lg",isCentered:!0,portalProps:{containerRef:G},id:"image-viewer-modal",blockScrollOnMount:!0,children:[O.jsx($c,{bg:"rgba(0, 0, 0, 0.8)",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne}),O.jsxs(Xc,{ref:Z,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[O.jsx(Ol,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),O.jsx(Hc,{p:0,width:"100%",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:de?O.jsx(kt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:se==="image"?O.jsx(Dh,{src:de,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",de),onError:be=>console.error("Error loading image:",be,de),onClick:ne}):O.jsxs(kt,{width:"100%",textAlign:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[O.jsx(Rt,{mb:4,fontSize:"lg",children:"Video URL:"}),O.jsx(Rt,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:de}),O.jsx(Rt,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):O.jsx(Jo,{direction:"column",align:"center",justify:"center",h:"400px",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:O.jsx(Rt,{children:"No image available"})})})]})]})}),O.jsx(s6e,{videoUrl:ae,videoTitle:me,mediaScreenId:he,isOpen:Ge,onClose:Oe})]})},Qie=({backgroundUrl:r=null,containerRef:t})=>{const[s,a]=L.useState(!1),[l,d]=L.useState(r),f=L.useRef(null),E=L.useRef(null);return L.useEffect(()=>{const v=T=>{const{backgroundUrl:w}=T.detail;d(w),f.current&&(w?(f.current.style.backgroundImage=`url('${w}')`,f.current.style.display="block",E.current&&(E.current.style.display="block")):(f.current.style.display="none",E.current&&(E.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),L.useEffect(()=>{d(r),f.current&&r!==l&&(f.current.style.backgroundImage=`url('${r}')`)},[r]),L.useEffect(()=>{if(!t||!t.current)return;const v=document.createElement("div");f.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const T=document.createElement("div");E.current=T,Object.assign(T.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),t.current.appendChild(v),t.current.appendChild(T);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",T.style.opacity="0",setTimeout(()=>{t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(T)&&t.current.removeChild(T)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Sd.subscribe(vd.playerInstantiated,w);const I=()=>w();window.addEventListener("PlayerInstantiated",I);const N=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Sd.unsubscribe(vd.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",I),clearTimeout(N),t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(T)&&t.current.removeChild(T)}}},[l,t]),null};Qie.propTypes={backgroundUrl:Mr.string,containerRef:Mr.shape({current:Mr.instanceOf(Element)})};const Zie=({containerRef:r})=>{const{spaceID:t}=Kc(),[s,a]=L.useState(!1),[l,d]=L.useState(!1),[f,E]=L.useState(0),[v,T]=L.useState("Initialising World"),[w,I]=L.useState(null),N=L.useRef(null),F=L.useRef(null),j=L.useRef(null),G=L.useRef(null);L.useEffect(()=>(Re.log("PersistentLoader: Component mounted with spaceID:",t),Re.log("PersistentLoader: Container ref:",r),()=>{Re.log("PersistentLoader: Component unmounting")}),[]);const{error:H}=Kc(),[te,K]=L.useState(!1);return L.useEffect(()=>{H&&(Re.error("PersistentLoader: Unity error detected:",H),K(!0),setTimeout(()=>{if(N.current){const Q=N.current.querySelector("div:first-child");Q&&(Q.textContent="Reconnecting...")}},3e3))},[H]),L.useEffect(()=>{(async()=>{if(t){Re.log(`PersistentLoader: Fetching logo for space ${t}`);try{const de=await sg(t);de&&de.logoUrl?(Re.log(`PersistentLoader: Found logo URL: ${de.logoUrl}`),I(de.logoUrl)):Re.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(de){Re.error("PersistentLoader: Error fetching space logo:",de)}}else Re.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),L.useEffect(()=>{const Q=de=>{const{logoUrl:se}=de.detail;Re.log(`PersistentLoader: Logo update event received with URL: ${se}`),I(se),F.current?se?(Re.log("PersistentLoader: Updating logo element with new URL"),F.current.src=se,j.current.style.display="flex"):(Re.log("PersistentLoader: Hiding logo element (no URL)"),j.current.style.display="none"):Re.warn("PersistentLoader: Logo ref is null during update")};return Re.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",Q),()=>{Re.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",Q)}},[]),L.useEffect(()=>{if(!r||!r.current){Re.error("PersistentLoader: Container ref is null or has no current property");return}Re.log("PersistentLoader: Creating loader elements");const Q=document.createElement("div");if(N.current=Q,Object.assign(Q.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){Re.log(`PersistentLoader: Creating logo element with URL: ${w}`);const Ge=document.createElement("div");j.current=Ge,Object.assign(Ge.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const tt=document.createElement("img");F.current=tt,tt.src=w,tt.alt="Space Logo",tt.style.maxHeight="100px",tt.style.maxWidth="100%",tt.style.objectFit="contain",tt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",Ge.appendChild(tt),r.current.appendChild(Ge),Re.log("PersistentLoader: Logo container added to main container")}else Re.log("PersistentLoader: No logo URL available, skipping logo creation");const de=document.createElement("style");de.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(de),Re.log("PersistentLoader: Animation styles added to document head");const se=document.createElement("div");se.style.fontSize="16px",se.style.fontWeight="bold",se.style.textAlign="center",se.style.marginBottom="16px",se.style.color="#ffffff",se.textContent="Initialising World";const ge=document.createElement("div");ge.style.width="100%",ge.style.height="12px",ge.style.backgroundColor="rgba(255, 255, 255, 0.2)",ge.style.borderRadius="6px",ge.style.overflow="hidden",ge.style.position="relative",ge.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const ee=document.createElement("div");ee.style.height="100%",ee.style.width="0%",ee.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",ee.style.backgroundSize="200% 200%",ee.style.animation="progress-glow 2s ease infinite",ee.style.transition="width 0.5s ease-out",ee.style.borderRadius="6px",ee.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",ge.appendChild(ee);const Z=document.createElement("div");Z.style.marginTop="8px",Z.style.fontSize="14px",Z.style.fontWeight="bold",Z.style.color="#ffffff",Z.textContent="0%",Q.appendChild(se),Q.appendChild(ge),Q.appendChild(Z),r.current.appendChild(Q),Re.log("PersistentLoader: Loader element added to container");const ne=Ge=>{E(Ge),ee.style.width=`${Math.round(Ge*100)}%`,Z.textContent=`${Math.round(Ge*100)}%`,Re.log(`PersistentLoader: Progress updated to ${Math.round(Ge*100)}%`)},ae=Ge=>{T(Ge),se.textContent=Ge,Re.log(`PersistentLoader: Loading stage updated to "${Ge}"`)},me=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];te&&(me[0].stage="Connecting to Space",me[1].stage="Reconnecting...",me[2].stage="Please Wait"),ae(me[0].stage),ne(.05);const he=Ge=>{const tt=Ge.detail.progress;Re.log(`PersistentLoader: Progress event received with value: ${tt}`),ne(tt),tt<.33?ae(me[0].stage):tt<.66?ae(me[1].stage):ae(me[2].stage)},le=()=>{Re.log("PersistentLoader: First scene loaded event received"),a(!0),ae(me[1].stage),ne(.66)},Me=()=>{if(Re.log("PersistentLoader: Player instantiated event received"),G.current&&(clearInterval(G.current),Re.log("PersistentLoader: Progress interval cleared")),d(!0),ae(me[2].stage),ne(1),te){Re.log("PersistentLoader: Keeping loader visible due to Unity error");return}Q.style.opacity="0",j.current&&(j.current.style.opacity="0"),setTimeout(()=>{r.current&&r.current.contains(Q)?(r.current.removeChild(Q),Re.log("PersistentLoader: Loader element removed after fade")):Re.warn("PersistentLoader: Could not remove loader element (not found in container)"),j.current&&r.current&&r.current.contains(j.current)?(r.current.removeChild(j.current),Re.log("PersistentLoader: Logo container removed after fade")):j.current&&Re.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)Re.log("PersistentLoader: Player was already instantiated"),Me();else{Re.log("PersistentLoader: Subscribing to playerInstantiated event"),Sd.subscribe(vd.playerInstantiated,Me);const Ge=()=>Me();Re.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",Ge),Re.log("PersistentLoader: Adding firstSceneLoaded event listener"),Sd.subscribe(vd.firstSceneLoaded,le),Re.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",he),G.current=setInterval(()=>{l||E(Ee=>{const we=Math.min(Ee+.01,.95);return ee.style.width=`${Math.round(we*100)}%`,Z.textContent=`${Math.round(we*100)}%`,we<.33&&v!==me[0].stage?ae(me[0].stage):we>=.33&&we<.66&&v!==me[1].stage?ae(me[1].stage):we>=.66&&v!==me[2].stage&&ae(me[2].stage),we})},500);const tt=setTimeout(()=>{Re.log("PersistentLoader: Forcing loader removal after timeout"),Me()},6e4);return()=>{Re.log("PersistentLoader: Cleaning up event listeners"),Sd.unsubscribe(vd.playerInstantiated,Me),window.removeEventListener("PlayerInstantiated",Ge),Sd.unsubscribe(vd.firstSceneLoaded,le),window.removeEventListener("UnityProgress",he),clearInterval(G.current),clearTimeout(tt),r.current&&r.current.contains(Q)&&(r.current.removeChild(Q),Re.log("PersistentLoader: Loader element removed during cleanup")),j.current&&r.current&&r.current.contains(j.current)&&(r.current.removeChild(j.current),Re.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,r]),null};Zie.propTypes={containerRef:Mr.shape({current:Mr.instanceOf(Element)})};const l6e="a2a7f4eb05284449b1063eb71d8301dc",Yj=L.forwardRef(({settings:r},t)=>{const{unityProvider:s,isLoaded:a,error:l}=Kc(),d=IBe();PBe();const f=bg(),E=xBe(d),{user:v}=L.useContext(wu),[T,w]=L.useState(!1),[I,N]=L.useState(window.devicePixelRatio),[F,j]=kBe();Pie().find(Ee=>Ee.isLocalPlayer);const[H,te]=L.useState(!0),[K,Q]=L.useState(!0),[de,se]=L.useState(!1),[ge,ee]=L.useState(!1),Z=r.spaceID||"default",ne=L.useMemo(()=>{const ve=new URLSearchParams(window.location.search).get("sessionId")||Z;return console.log("WebGLRenderer: Using session ID:",ve),ve},[Z]),[ae,me]=L.useState(null);L.useEffect(()=>{v!=null&&v.uid&&Jh(v.uid).then(Ee=>{me(Ee),console.log("WebGLRenderer: User profile loaded:",(Ee==null?void 0:Ee.Nickname)||"Unknown")}).catch(Ee=>{console.error("Error fetching user profile:",Ee)})},[v==null?void 0:v.uid]),L.useEffect(()=>{if(l||!v){Re.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const Ee=setTimeout(()=>{ee(!0)},1e3);return()=>clearTimeout(Ee)}else ee(!1)},[l,v]),L.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Ee=()=>{console.log("WebGLRenderer: Player instantiated event received"),Q(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),Q(!0)),Sd.subscribe(vd.playerInstantiated,Ee);const we=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),Q(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Sd.unsubscribe(vd.playerInstantiated,Ee),clearTimeout(we)}},[K]),L.useEffect(()=>{a||d?setTimeout(()=>{w(!0),Re.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Re.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),L.useEffect(()=>{const Ee=we=>{Re.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",we)};return Sd.subscribe(vd.sendUserToUnity,Ee),()=>Sd.unsubscribe(vd.sendUserToUnity,Ee)},[f]);const{setFullscreenRef:he,fullscreenRef:le}=Cd();L.useEffect(()=>{he(t.current)},[t,he]);const Me=()=>{te(!H)},Ge=v&&r.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:K,showVoiceChat:Ge,sessionId:ne}),L.useEffect(()=>{const Ee=we=>{se(we.detail.enabled)};return window.addEventListener("editModeChanged",Ee),()=>{window.removeEventListener("editModeChanged",Ee)}},[]),Oie(),OBe();const tt=L.useRef(null);return O.jsxs(kt,{className:"webgl-renderer",children:[r.urlLoadingBackground&&O.jsx(Qie,{backgroundUrl:r.urlLoadingBackground,containerRef:tt}),!ge&&O.jsx(Zie,{containerRef:tt}),ge&&O.jsx(kt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:O.jsx(qj,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),O.jsx(IV,{containerRef:le.current?le:document.body,children:O.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[O.jsxs(kt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[r.showAuthButton&&O.jsx(c5e,{}),Ge&&O.jsxs(Xie,{appId:l6e,channel:ne,uid:v==null?void 0:v.uid,enabled:!0,children:[O.jsx(F5e,{size:"md",defaultMuted:!0,joinOnClick:!0}),O.jsx(B5e,{userNickname:ae==null?void 0:ae.Nickname})]}),O.jsx(C5e,{}),O.jsx(kt,{position:"relative",zIndex:"9999",children:O.jsx(e6e,{onTogglePlayerList:Me,spaceID:Z})})]}),O.jsxs(kt,{ref:tt,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[O.jsx(kt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),O.jsx(kt,{...E,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:s?O.jsx(Aie.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:I}):O.jsx(kt,{width:"100%",height:"100%"})}),O.jsx(kt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:O.jsx(a5e,{})})]}),O.jsx(kt,{...E,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:r.showDisruptiveLogo&&O.jsx(Dh,{src:r.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),O.jsx(kt,{...E,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),O.jsxs(kt,{...E,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[r.showHelpButton&&O.jsx(l5e,{}),O.jsx(P5e,{})]}),O.jsx(O5e,{}),O.jsx(k5e,{isOpen:F!==null,onClose:()=>{console.log(" Closing nameplate modal"),j()},playerName:(F==null?void 0:F.playerName)||"Unknown Player",playerId:(F==null?void 0:F.playerId)||"Unknown ID"}),O.jsx(N5e,{isVisible:H,onToggleVisibility:te,spaceID:Z}),O.jsx(c6e,{})]})})]})});Yj.displayName="WebGLRenderer";Yj.propTypes={settings:Mr.shape({urlLoadingBackground:Mr.string,showAuthButton:Mr.bool,showDisruptiveLogo:Mr.bool,urlDisruptiveLogo:Mr.string,showHelpButton:Mr.bool,enableVoiceChat:Mr.bool,spaceID:Mr.string})};const ese=({spaceID:r,overrideSettings:t})=>{const s=L.useRef(null),[a,l]=L.useState(!0),[d,f]=L.useState({spaceID:r,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,v]=L.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:r});return L.useEffect(()=>{(async()=>{try{const w=await sg(r);if(w){f(F=>({...F,spaceID:r,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const I=await WO(E.urlDisruptiveLogo);let N="";if(w.backgroundUrl)N=w.backgroundUrl;else if(w.backgroundGsUrl)try{N=await WO(w.backgroundGsUrl)}catch(F){Re.warn("WebGLLoader: Error fetching background from GS URL:",F)}else if(w.gsUrlLoadingBackground)try{N=await WO(w.gsUrlLoadingBackground)}catch(F){Re.warn("WebGLLoader: Error fetching background from legacy GS URL:",F)}v(F=>({...F,urlLoadingBackground:N,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:r,...t||{}})),l(!1)}else Re.error(`WebGLLoader: No configuration found for spaceID: ${r}`)}catch(w){Re.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[r,E.urlDisruptiveLogo,t]),L.useEffect(()=>{a||(Re.log("WebGLLoader: Unity config from Firebase",d),Re.log("WebGLLoader: Space settings from Firebase",E))},[a]),O.jsx(O.Fragment,{children:a?O.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):O.jsx(CBe,{...d,children:O.jsx(Yj,{ref:s,settings:E})})})};ese.propTypes={spaceID:Mr.string.isRequired,overrideSettings:Mr.object};const uO=document.getElementById("webgl-root");if(uO){const r=uO.getAttribute("data-space-id"),t=uO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=L.useState(null);return L.useEffect(()=>{xxe(t).then(l)},[]),a?O.jsx(JOe,{theme:a,children:O.jsx(mBe,{children:O.jsx(gBe,{children:O.jsx(ese,{spaceID:r})})})}):O.jsx("div",{children:"Loading theme..."})};Wge.createRoot(uO).render(O.jsx(s,{}))}else console.error("Root element 'webgl-root' not found.");export{r_e as a,Cye as b,Ri as c,bye as d,d6e as e,u6e as f,mye as g,Eu as i,Nh as m,wwe as t};
